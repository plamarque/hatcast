(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Qh(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const lt={},ro=[],rr=()=>{},Kb=()=>!1,wu=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Jh=n=>n.startsWith("onUpdate:"),nn=Object.assign,Yh=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},Hb=Object.prototype.hasOwnProperty,Xe=(n,e)=>Hb.call(n,e),Pe=Array.isArray,so=n=>bu(n)==="[object Map]",G_=n=>bu(n)==="[object Set]",De=n=>typeof n=="function",Gt=n=>typeof n=="string",Ls=n=>typeof n=="symbol",Et=n=>n!==null&&typeof n=="object",K_=n=>(Et(n)||De(n))&&De(n.then)&&De(n.catch),H_=Object.prototype.toString,bu=n=>H_.call(n),Wb=n=>bu(n).slice(8,-1),W_=n=>bu(n)==="[object Object]",Xh=n=>Gt(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Na=Qh(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Iu=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},Qb=/-(\w)/g,Qn=Iu(n=>n.replace(Qb,(e,t)=>t?t.toUpperCase():"")),Jb=/\B([A-Z])/g,Fs=Iu(n=>n.replace(Jb,"-$1").toLowerCase()),Eu=Iu(n=>n.charAt(0).toUpperCase()+n.slice(1)),Ad=Iu(n=>n?`on${Eu(n)}`:""),Es=(n,e)=>!Object.is(n,e),Ac=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},sh=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},ih=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let om;const Tu=()=>om||(om=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function ps(n){if(Pe(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=Gt(r)?eI(r):ps(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(Gt(n)||Et(n))return n}const Yb=/;(?![^(]*\))/g,Xb=/:([^]+)/,Zb=/\/\*[^]*?\*\//g;function eI(n){const e={};return n.replace(Zb,"").split(Yb).forEach(t=>{if(t){const r=t.split(Xb);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function sr(n){let e="";if(Gt(n))e=n;else if(Pe(n))for(let t=0;t<n.length;t++){const r=sr(n[t]);r&&(e+=r+" ")}else if(Et(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const tI="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",nI=Qh(tI);function Q_(n){return!!n||n===""}const J_=n=>!!(n&&n.__v_isRef===!0),ge=n=>Gt(n)?n:n==null?"":Pe(n)||Et(n)&&(n.toString===H_||!De(n.toString))?J_(n)?ge(n.value):JSON.stringify(n,Y_,2):String(n),Y_=(n,e)=>J_(e)?Y_(n,e.value):so(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[xd(r,i)+" =>"]=s,t),{})}:G_(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>xd(t))}:Ls(e)?xd(e):Et(e)&&!Pe(e)&&!W_(e)?String(e):e,xd=(n,e="")=>{var t;return Ls(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let kn;class rI{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=kn,!e&&kn&&(this.index=(kn.scopes||(kn.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=kn;try{return kn=this,e()}finally{kn=t}}}on(){++this._on===1&&(this.prevScope=kn,kn=this)}off(){this._on>0&&--this._on===0&&(kn=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function sI(){return kn}let ht;const Pd=new WeakSet;class X_{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,kn&&kn.active&&kn.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Pd.has(this)&&(Pd.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||ey(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,am(this),ty(this);const e=ht,t=ir;ht=this,ir=!0;try{return this.fn()}finally{ny(this),ht=e,ir=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)tf(e);this.deps=this.depsTail=void 0,am(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Pd.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){oh(this)&&this.run()}get dirty(){return oh(this)}}let Z_=0,Oa,Ma;function ey(n,e=!1){if(n.flags|=8,e){n.next=Ma,Ma=n;return}n.next=Oa,Oa=n}function Zh(){Z_++}function ef(){if(--Z_>0)return;if(Ma){let e=Ma;for(Ma=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Oa;){let e=Oa;for(Oa=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function ty(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function ny(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),tf(r),iI(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function oh(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(ry(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function ry(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Ja)||(n.globalVersion=Ja,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!oh(n))))return;n.flags|=2;const e=n.dep,t=ht,r=ir;ht=n,ir=!0;try{ty(n);const s=n.fn(n._value);(e.version===0||Es(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{ht=t,ir=r,ny(n),n.flags&=-3}}function tf(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)tf(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function iI(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let ir=!0;const sy=[];function Ur(){sy.push(ir),ir=!1}function Br(){const n=sy.pop();ir=n===void 0?!0:n}function am(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=ht;ht=void 0;try{e()}finally{ht=t}}}let Ja=0;class oI{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class nf{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!ht||!ir||ht===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==ht)t=this.activeLink=new oI(ht,this),ht.deps?(t.prevDep=ht.depsTail,ht.depsTail.nextDep=t,ht.depsTail=t):ht.deps=ht.depsTail=t,iy(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=ht.depsTail,t.nextDep=void 0,ht.depsTail.nextDep=t,ht.depsTail=t,ht.deps===t&&(ht.deps=r)}return t}trigger(e){this.version++,Ja++,this.notify(e)}notify(e){Zh();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{ef()}}}function iy(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)iy(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const ah=new WeakMap,ci=Symbol(""),lh=Symbol(""),Ya=Symbol("");function gn(n,e,t){if(ir&&ht){let r=ah.get(n);r||ah.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new nf),s.map=r,s.key=t),s.track()}}function Cr(n,e,t,r,s,i){const o=ah.get(n);if(!o){Ja++;return}const a=l=>{l&&l.trigger()};if(Zh(),e==="clear")o.forEach(a);else{const l=Pe(n),u=l&&Xh(t);if(l&&t==="length"){const d=Number(r);o.forEach((f,g)=>{(g==="length"||g===Ya||!Ls(g)&&g>=d)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),u&&a(o.get(Ya)),e){case"add":l?u&&a(o.get("length")):(a(o.get(ci)),so(n)&&a(o.get(lh)));break;case"delete":l||(a(o.get(ci)),so(n)&&a(o.get(lh)));break;case"set":so(n)&&a(o.get(ci));break}}ef()}function Gi(n){const e=Ye(n);return e===n?e:(gn(e,"iterate",Ya),Wn(n)?e:e.map(cn))}function Au(n){return gn(n=Ye(n),"iterate",Ya),n}const aI={__proto__:null,[Symbol.iterator](){return Sd(this,Symbol.iterator,cn)},concat(...n){return Gi(this).concat(...n.map(e=>Pe(e)?Gi(e):e))},entries(){return Sd(this,"entries",n=>(n[1]=cn(n[1]),n))},every(n,e){return Pr(this,"every",n,e,void 0,arguments)},filter(n,e){return Pr(this,"filter",n,e,t=>t.map(cn),arguments)},find(n,e){return Pr(this,"find",n,e,cn,arguments)},findIndex(n,e){return Pr(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return Pr(this,"findLast",n,e,cn,arguments)},findLastIndex(n,e){return Pr(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return Pr(this,"forEach",n,e,void 0,arguments)},includes(...n){return Rd(this,"includes",n)},indexOf(...n){return Rd(this,"indexOf",n)},join(n){return Gi(this).join(n)},lastIndexOf(...n){return Rd(this,"lastIndexOf",n)},map(n,e){return Pr(this,"map",n,e,void 0,arguments)},pop(){return ma(this,"pop")},push(...n){return ma(this,"push",n)},reduce(n,...e){return lm(this,"reduce",n,e)},reduceRight(n,...e){return lm(this,"reduceRight",n,e)},shift(){return ma(this,"shift")},some(n,e){return Pr(this,"some",n,e,void 0,arguments)},splice(...n){return ma(this,"splice",n)},toReversed(){return Gi(this).toReversed()},toSorted(n){return Gi(this).toSorted(n)},toSpliced(...n){return Gi(this).toSpliced(...n)},unshift(...n){return ma(this,"unshift",n)},values(){return Sd(this,"values",cn)}};function Sd(n,e,t){const r=Au(n),s=r[e]();return r!==n&&!Wn(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const lI=Array.prototype;function Pr(n,e,t,r,s,i){const o=Au(n),a=o!==n&&!Wn(n),l=o[e];if(l!==lI[e]){const f=l.apply(n,i);return a?cn(f):f}let u=t;o!==n&&(a?u=function(f,g){return t.call(this,cn(f),g,n)}:t.length>2&&(u=function(f,g){return t.call(this,f,g,n)}));const d=l.call(o,u,r);return a&&s?s(d):d}function lm(n,e,t,r){const s=Au(n);let i=t;return s!==n&&(Wn(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,cn(a),l,n)}),s[e](i,...r)}function Rd(n,e,t){const r=Ye(n);gn(r,"iterate",Ya);const s=r[e](...t);return(s===-1||s===!1)&&of(t[0])?(t[0]=Ye(t[0]),r[e](...t)):s}function ma(n,e,t=[]){Ur(),Zh();const r=Ye(n)[e].apply(n,t);return ef(),Br(),r}const cI=Qh("__proto__,__v_isRef,__isVue"),oy=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Ls));function uI(n){Ls(n)||(n=String(n));const e=Ye(this);return gn(e,"has",n),e.hasOwnProperty(n)}class ay{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?wI:dy:i?uy:cy).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=Pe(e);if(!s){let l;if(o&&(l=aI[t]))return l;if(t==="hasOwnProperty")return uI}const a=Reflect.get(e,t,yn(e)?e:r);return(Ls(t)?oy.has(t):cI(t))||(s||gn(e,"get",t),i)?a:yn(a)?o&&Xh(t)?a:a.value:Et(a)?s?fy(a):xu(a):a}}class ly extends ay{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=Ps(i);if(!Wn(r)&&!Ps(r)&&(i=Ye(i),r=Ye(r)),!Pe(e)&&yn(i)&&!yn(r))return l?!1:(i.value=r,!0)}const o=Pe(e)&&Xh(t)?Number(t)<e.length:Xe(e,t),a=Reflect.set(e,t,r,yn(e)?e:s);return e===Ye(s)&&(o?Es(r,i)&&Cr(e,"set",t,r):Cr(e,"add",t,r)),a}deleteProperty(e,t){const r=Xe(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&Cr(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!Ls(t)||!oy.has(t))&&gn(e,"has",t),r}ownKeys(e){return gn(e,"iterate",Pe(e)?"length":ci),Reflect.ownKeys(e)}}class dI extends ay{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const hI=new ly,fI=new dI,pI=new ly(!0);const ch=n=>n,fc=n=>Reflect.getPrototypeOf(n);function mI(n,e,t){return function(...r){const s=this.__v_raw,i=Ye(s),o=so(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,u=s[n](...r),d=t?ch:e?zc:cn;return!e&&gn(i,"iterate",l?lh:ci),{next(){const{value:f,done:g}=u.next();return g?{value:f,done:g}:{value:a?[d(f[0]),d(f[1])]:d(f),done:g}},[Symbol.iterator](){return this}}}}function pc(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function gI(n,e){const t={get(s){const i=this.__v_raw,o=Ye(i),a=Ye(s);n||(Es(s,a)&&gn(o,"get",s),gn(o,"get",a));const{has:l}=fc(o),u=e?ch:n?zc:cn;if(l.call(o,s))return u(i.get(s));if(l.call(o,a))return u(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&gn(Ye(s),"iterate",ci),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=Ye(i),a=Ye(s);return n||(Es(s,a)&&gn(o,"has",s),gn(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=Ye(a),u=e?ch:n?zc:cn;return!n&&gn(l,"iterate",ci),a.forEach((d,f)=>s.call(i,u(d),u(f),o))}};return nn(t,n?{add:pc("add"),set:pc("set"),delete:pc("delete"),clear:pc("clear")}:{add(s){!e&&!Wn(s)&&!Ps(s)&&(s=Ye(s));const i=Ye(this);return fc(i).has.call(i,s)||(i.add(s),Cr(i,"add",s,s)),this},set(s,i){!e&&!Wn(i)&&!Ps(i)&&(i=Ye(i));const o=Ye(this),{has:a,get:l}=fc(o);let u=a.call(o,s);u||(s=Ye(s),u=a.call(o,s));const d=l.call(o,s);return o.set(s,i),u?Es(i,d)&&Cr(o,"set",s,i):Cr(o,"add",s,i),this},delete(s){const i=Ye(this),{has:o,get:a}=fc(i);let l=o.call(i,s);l||(s=Ye(s),l=o.call(i,s)),a&&a.call(i,s);const u=i.delete(s);return l&&Cr(i,"delete",s,void 0),u},clear(){const s=Ye(this),i=s.size!==0,o=s.clear();return i&&Cr(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=mI(s,n,e)}),t}function rf(n,e){const t=gI(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(Xe(t,s)&&s in r?t:r,s,i)}const _I={get:rf(!1,!1)},yI={get:rf(!1,!0)},vI={get:rf(!0,!1)};const cy=new WeakMap,uy=new WeakMap,dy=new WeakMap,wI=new WeakMap;function bI(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function II(n){return n.__v_skip||!Object.isExtensible(n)?0:bI(Wb(n))}function xu(n){return Ps(n)?n:sf(n,!1,hI,_I,cy)}function hy(n){return sf(n,!1,pI,yI,uy)}function fy(n){return sf(n,!0,fI,vI,dy)}function sf(n,e,t,r,s){if(!Et(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=II(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function io(n){return Ps(n)?io(n.__v_raw):!!(n&&n.__v_isReactive)}function Ps(n){return!!(n&&n.__v_isReadonly)}function Wn(n){return!!(n&&n.__v_isShallow)}function of(n){return n?!!n.__v_raw:!1}function Ye(n){const e=n&&n.__v_raw;return e?Ye(e):n}function EI(n){return!Xe(n,"__v_skip")&&Object.isExtensible(n)&&sh(n,"__v_skip",!0),n}const cn=n=>Et(n)?xu(n):n,zc=n=>Et(n)?fy(n):n;function yn(n){return n?n.__v_isRef===!0:!1}function q(n){return py(n,!1)}function TI(n){return py(n,!0)}function py(n,e){return yn(n)?n:new AI(n,e)}class AI{constructor(e,t){this.dep=new nf,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Ye(e),this._value=t?e:cn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Wn(e)||Ps(e);e=r?e:Ye(e),Es(e,t)&&(this._rawValue=e,this._value=r?e:cn(e),this.dep.trigger())}}function oo(n){return yn(n)?n.value:n}const xI={get:(n,e,t)=>e==="__v_raw"?n:oo(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return yn(s)&&!yn(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function my(n){return io(n)?n:new Proxy(n,xI)}class PI{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new nf(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Ja-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&ht!==this)return ey(this,!0),!0}get value(){const e=this.dep.track();return ry(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function SI(n,e,t=!1){let r,s;return De(n)?r=n:(r=n.get,s=n.set),new PI(r,s,t)}const mc={},Gc=new WeakMap;let Zs;function RI(n,e=!1,t=Zs){if(t){let r=Gc.get(t);r||Gc.set(t,r=[]),r.push(n)}}function CI(n,e,t=lt){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,u=j=>s?j:Wn(j)||s===!1||s===0?kr(j,1):kr(j);let d,f,g,_,k=!1,P=!1;if(yn(n)?(f=()=>n.value,k=Wn(n)):io(n)?(f=()=>u(n),k=!0):Pe(n)?(P=!0,k=n.some(j=>io(j)||Wn(j)),f=()=>n.map(j=>{if(yn(j))return j.value;if(io(j))return u(j);if(De(j))return l?l(j,2):j()})):De(n)?e?f=l?()=>l(n,2):n:f=()=>{if(g){Ur();try{g()}finally{Br()}}const j=Zs;Zs=d;try{return l?l(n,3,[_]):n(_)}finally{Zs=j}}:f=rr,e&&s){const j=f,O=s===!0?1/0:s;f=()=>kr(j(),O)}const R=sI(),L=()=>{d.stop(),R&&R.active&&Yh(R.effects,d)};if(i&&e){const j=e;e=(...O)=>{j(...O),L()}}let B=P?new Array(n.length).fill(mc):mc;const $=j=>{if(!(!(d.flags&1)||!d.dirty&&!j))if(e){const O=d.run();if(s||k||(P?O.some((ie,x)=>Es(ie,B[x])):Es(O,B))){g&&g();const ie=Zs;Zs=d;try{const x=[O,B===mc?void 0:P&&B[0]===mc?[]:B,_];B=O,l?l(e,3,x):e(...x)}finally{Zs=ie}}}else d.run()};return a&&a($),d=new X_(f),d.scheduler=o?()=>o($,!1):$,_=j=>RI(j,!1,d),g=d.onStop=()=>{const j=Gc.get(d);if(j){if(l)l(j,4);else for(const O of j)O();Gc.delete(d)}},e?r?$(!0):B=d.run():o?o($.bind(null,!0),!0):d.run(),L.pause=d.pause.bind(d),L.resume=d.resume.bind(d),L.stop=L,L}function kr(n,e=1/0,t){if(e<=0||!Et(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,yn(n))kr(n.value,e,t);else if(Pe(n))for(let r=0;r<n.length;r++)kr(n[r],e,t);else if(G_(n)||so(n))n.forEach(r=>{kr(r,e,t)});else if(W_(n)){for(const r in n)kr(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&kr(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function El(n,e,t,r){try{return r?n(...r):n()}catch(s){Pu(s,e,t)}}function yr(n,e,t,r){if(De(n)){const s=El(n,e,t,r);return s&&K_(s)&&s.catch(i=>{Pu(i,e,t)}),s}if(Pe(n)){const s=[];for(let i=0;i<n.length;i++)s.push(yr(n[i],e,t,r));return s}}function Pu(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||lt;if(e){let a=e.parent;const l=e.proxy,u=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const d=a.ec;if(d){for(let f=0;f<d.length;f++)if(d[f](n,l,u)===!1)return}a=a.parent}if(i){Ur(),El(i,null,10,[n,l,u]),Br();return}}kI(n,t,s,r,o)}function kI(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const xn=[];let ur=-1;const ao=[];let ds=null,Ji=0;const gy=Promise.resolve();let Kc=null;function Lr(n){const e=Kc||gy;return n?e.then(this?n.bind(this):n):e}function DI(n){let e=ur+1,t=xn.length;for(;e<t;){const r=e+t>>>1,s=xn[r],i=Xa(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function af(n){if(!(n.flags&1)){const e=Xa(n),t=xn[xn.length-1];!t||!(n.flags&2)&&e>=Xa(t)?xn.push(n):xn.splice(DI(e),0,n),n.flags|=1,_y()}}function _y(){Kc||(Kc=gy.then(vy))}function VI(n){Pe(n)?ao.push(...n):ds&&n.id===-1?ds.splice(Ji+1,0,n):n.flags&1||(ao.push(n),n.flags|=1),_y()}function cm(n,e,t=ur+1){for(;t<xn.length;t++){const r=xn[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;xn.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function yy(n){if(ao.length){const e=[...new Set(ao)].sort((t,r)=>Xa(t)-Xa(r));if(ao.length=0,ds){ds.push(...e);return}for(ds=e,Ji=0;Ji<ds.length;Ji++){const t=ds[Ji];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}ds=null,Ji=0}}const Xa=n=>n.id==null?n.flags&2?-1:1/0:n.id;function vy(n){const e=rr;try{for(ur=0;ur<xn.length;ur++){const t=xn[ur];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),El(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;ur<xn.length;ur++){const t=xn[ur];t&&(t.flags&=-2)}ur=-1,xn.length=0,yy(),Kc=null,(xn.length||ao.length)&&vy()}}let qn=null,wy=null;function Hc(n){const e=qn;return qn=n,wy=n&&n.type.__scopeId||null,e}function NI(n,e=qn,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&ym(-1);const i=Hc(e);let o;try{o=n(...s)}finally{Hc(i),r._d&&ym(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function mt(n,e){if(qn===null)return n;const t=ku(qn),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=lt]=e[s];i&&(De(i)&&(i={mounted:i,updated:i}),i.deep&&kr(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function Js(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(Ur(),yr(l,t,8,[n.el,a,n,e]),Br())}}const OI=Symbol("_vte"),MI=n=>n.__isTeleport;function lf(n,e){n.shapeFlag&6&&n.component?(n.transition=e,lf(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function by(n,e){return De(n)?(()=>nn({name:n.name},e,{setup:n}))():n}function Iy(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function La(n,e,t,r,s=!1){if(Pe(n)){n.forEach((k,P)=>La(k,e&&(Pe(e)?e[P]:e),t,r,s));return}if(Fa(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&La(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?ku(r.component):r.el,o=s?null:i,{i:a,r:l}=n,u=e&&e.r,d=a.refs===lt?a.refs={}:a.refs,f=a.setupState,g=Ye(f),_=f===lt?()=>!1:k=>Xe(g,k);if(u!=null&&u!==l&&(Gt(u)?(d[u]=null,_(u)&&(f[u]=null)):yn(u)&&(u.value=null)),De(l))El(l,a,12,[o,d]);else{const k=Gt(l),P=yn(l);if(k||P){const R=()=>{if(n.f){const L=k?_(l)?f[l]:d[l]:l.value;s?Pe(L)&&Yh(L,i):Pe(L)?L.includes(i)||L.push(i):k?(d[l]=[i],_(l)&&(f[l]=d[l])):(l.value=[i],n.k&&(d[n.k]=l.value))}else k?(d[l]=o,_(l)&&(f[l]=o)):P&&(l.value=o,n.k&&(d[n.k]=o))};o?(R.id=-1,$n(R,t)):R()}}}Tu().requestIdleCallback;Tu().cancelIdleCallback;const Fa=n=>!!n.type.__asyncLoader,Ey=n=>n.type.__isKeepAlive;function LI(n,e){Ty(n,"a",e)}function FI(n,e){Ty(n,"da",e)}function Ty(n,e,t=_n){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(Su(e,r,t),t){let s=t.parent;for(;s&&s.parent;)Ey(s.parent.vnode)&&UI(r,e,t,s),s=s.parent}}function UI(n,e,t,r){const s=Su(e,n,r,!0);cf(()=>{Yh(r[e],s)},t)}function Su(n,e,t=_n,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Ur();const a=Tl(t),l=yr(e,t,n,o);return a(),Br(),l});return r?s.unshift(i):s.push(i),i}}const Hr=n=>(e,t=_n)=>{(!el||n==="sp")&&Su(n,(...r)=>e(...r),t)},BI=Hr("bm"),_o=Hr("m"),$I=Hr("bu"),jI=Hr("u"),Ay=Hr("bum"),cf=Hr("um"),qI=Hr("sp"),zI=Hr("rtg"),GI=Hr("rtc");function KI(n,e=_n){Su("ec",n,e)}const xy="components";function HI(n,e){return QI(xy,n,!0,e)||n}const WI=Symbol.for("v-ndc");function QI(n,e,t=!0,r=!1){const s=qn||_n;if(s){const i=s.type;if(n===xy){const a=OE(i,!1);if(a&&(a===e||a===Qn(e)||a===Eu(Qn(e))))return i}const o=um(s[n]||i[n],e)||um(s.appContext[n],e);return!o&&r?i:o}}function um(n,e){return n&&(n[e]||n[Qn(e)]||n[Eu(Qn(e))])}function Dr(n,e,t,r){let s;const i=t&&t[r],o=Pe(n);if(o||Gt(n)){const a=o&&io(n);let l=!1,u=!1;a&&(l=!Wn(n),u=Ps(n),n=Au(n)),s=new Array(n.length);for(let d=0,f=n.length;d<f;d++)s[d]=e(l?u?zc(cn(n[d])):cn(n[d]):n[d],d,void 0,i&&i[d])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(Et(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,u=a.length;l<u;l++){const d=a[l];s[l]=e(n[d],d,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}const uh=n=>n?Ky(n)?ku(n):uh(n.parent):null,Ua=nn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>uh(n.parent),$root:n=>uh(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>uf(n),$forceUpdate:n=>n.f||(n.f=()=>{af(n.update)}),$nextTick:n=>n.n||(n.n=Lr.bind(n.proxy)),$watch:n=>gE.bind(n)}),Cd=(n,e)=>n!==lt&&!n.__isScriptSetup&&Xe(n,e),JI={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let u;if(e[0]!=="$"){const _=o[e];if(_!==void 0)switch(_){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(Cd(r,e))return o[e]=1,r[e];if(s!==lt&&Xe(s,e))return o[e]=2,s[e];if((u=n.propsOptions[0])&&Xe(u,e))return o[e]=3,i[e];if(t!==lt&&Xe(t,e))return o[e]=4,t[e];dh&&(o[e]=0)}}const d=Ua[e];let f,g;if(d)return e==="$attrs"&&gn(n.attrs,"get",""),d(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==lt&&Xe(t,e))return o[e]=4,t[e];if(g=l.config.globalProperties,Xe(g,e))return g[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return Cd(s,e)?(s[e]=t,!0):r!==lt&&Xe(r,e)?(r[e]=t,!0):Xe(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==lt&&Xe(n,o)||Cd(e,o)||(a=i[0])&&Xe(a,o)||Xe(r,o)||Xe(Ua,o)||Xe(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:Xe(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function dm(n){return Pe(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let dh=!0;function YI(n){const e=uf(n),t=n.proxy,r=n.ctx;dh=!1,e.beforeCreate&&hm(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:u,created:d,beforeMount:f,mounted:g,beforeUpdate:_,updated:k,activated:P,deactivated:R,beforeDestroy:L,beforeUnmount:B,destroyed:$,unmounted:j,render:O,renderTracked:ie,renderTriggered:x,errorCaptured:w,serverPrefetch:I,expose:S,inheritAttrs:T,components:D,directives:E,filters:vt}=e;if(u&&XI(u,r,null),o)for(const Ne in o){const Se=o[Ne];De(Se)&&(r[Ne]=Se.bind(t))}if(s){const Ne=s.call(t,t);Et(Ne)&&(n.data=xu(Ne))}if(dh=!0,i)for(const Ne in i){const Se=i[Ne],$t=De(Se)?Se.bind(t,t):De(Se.get)?Se.get.bind(t,t):rr,Ln=!De(Se)&&De(Se.set)?Se.set.bind(t):rr,rn=Zt({get:$t,set:Ln});Object.defineProperty(r,Ne,{enumerable:!0,configurable:!0,get:()=>rn.value,set:et=>rn.value=et})}if(a)for(const Ne in a)Py(a[Ne],r,t,Ne);if(l){const Ne=De(l)?l.call(t):l;Reflect.ownKeys(Ne).forEach(Se=>{xc(Se,Ne[Se])})}d&&hm(d,n,"c");function He(Ne,Se){Pe(Se)?Se.forEach($t=>Ne($t.bind(t))):Se&&Ne(Se.bind(t))}if(He(BI,f),He(_o,g),He($I,_),He(jI,k),He(LI,P),He(FI,R),He(KI,w),He(GI,ie),He(zI,x),He(Ay,B),He(cf,j),He(qI,I),Pe(S))if(S.length){const Ne=n.exposed||(n.exposed={});S.forEach(Se=>{Object.defineProperty(Ne,Se,{get:()=>t[Se],set:$t=>t[Se]=$t})})}else n.exposed||(n.exposed={});O&&n.render===rr&&(n.render=O),T!=null&&(n.inheritAttrs=T),D&&(n.components=D),E&&(n.directives=E),I&&Iy(n)}function XI(n,e,t=rr){Pe(n)&&(n=hh(n));for(const r in n){const s=n[r];let i;Et(s)?"default"in s?i=or(s.from||r,s.default,!0):i=or(s.from||r):i=or(s),yn(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function hm(n,e,t){yr(Pe(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function Py(n,e,t,r){let s=r.includes(".")?By(t,r):()=>t[r];if(Gt(n)){const i=e[n];De(i)&&ar(s,i)}else if(De(n))ar(s,n.bind(t));else if(Et(n))if(Pe(n))n.forEach(i=>Py(i,e,t,r));else{const i=De(n.handler)?n.handler.bind(t):e[n.handler];De(i)&&ar(s,i,n)}}function uf(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(u=>Wc(l,u,o,!0)),Wc(l,e,o)),Et(e)&&i.set(e,l),l}function Wc(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&Wc(n,i,t,!0),s&&s.forEach(o=>Wc(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=ZI[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const ZI={data:fm,props:pm,emits:pm,methods:xa,computed:xa,beforeCreate:Tn,created:Tn,beforeMount:Tn,mounted:Tn,beforeUpdate:Tn,updated:Tn,beforeDestroy:Tn,beforeUnmount:Tn,destroyed:Tn,unmounted:Tn,activated:Tn,deactivated:Tn,errorCaptured:Tn,serverPrefetch:Tn,components:xa,directives:xa,watch:tE,provide:fm,inject:eE};function fm(n,e){return e?n?function(){return nn(De(n)?n.call(this,this):n,De(e)?e.call(this,this):e)}:e:n}function eE(n,e){return xa(hh(n),hh(e))}function hh(n){if(Pe(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Tn(n,e){return n?[...new Set([].concat(n,e))]:e}function xa(n,e){return n?nn(Object.create(null),n,e):e}function pm(n,e){return n?Pe(n)&&Pe(e)?[...new Set([...n,...e])]:nn(Object.create(null),dm(n),dm(e??{})):e}function tE(n,e){if(!n)return e;if(!e)return n;const t=nn(Object.create(null),n);for(const r in e)t[r]=Tn(n[r],e[r]);return t}function Sy(){return{app:null,config:{isNativeTag:Kb,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let nE=0;function rE(n,e){return function(r,s=null){De(r)||(r=nn({},r)),s!=null&&!Et(s)&&(s=null);const i=Sy(),o=new WeakSet,a=[];let l=!1;const u=i.app={_uid:nE++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:LE,get config(){return i.config},set config(d){},use(d,...f){return o.has(d)||(d&&De(d.install)?(o.add(d),d.install(u,...f)):De(d)&&(o.add(d),d(u,...f))),u},mixin(d){return i.mixins.includes(d)||i.mixins.push(d),u},component(d,f){return f?(i.components[d]=f,u):i.components[d]},directive(d,f){return f?(i.directives[d]=f,u):i.directives[d]},mount(d,f,g){if(!l){const _=u._ceVNode||Lt(r,s);return _.appContext=i,g===!0?g="svg":g===!1&&(g=void 0),f&&e?e(_,d):n(_,d,g),l=!0,u._container=d,d.__vue_app__=u,ku(_.component)}},onUnmount(d){a.push(d)},unmount(){l&&(yr(a,u._instance,16),n(null,u._container),delete u._container.__vue_app__)},provide(d,f){return i.provides[d]=f,u},runWithContext(d){const f=lo;lo=u;try{return d()}finally{lo=f}}};return u}}let lo=null;function xc(n,e){if(_n){let t=_n.provides;const r=_n.parent&&_n.parent.provides;r===t&&(t=_n.provides=Object.create(r)),t[n]=e}}function or(n,e,t=!1){const r=_n||qn;if(r||lo){let s=lo?lo._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&De(e)?e.call(r&&r.proxy):e}}const Ry={},Cy=()=>Object.create(Ry),ky=n=>Object.getPrototypeOf(n)===Ry;function sE(n,e,t,r=!1){const s={},i=Cy();n.propsDefaults=Object.create(null),Dy(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:hy(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function iE(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=Ye(s),[l]=n.propsOptions;let u=!1;if((r||o>0)&&!(o&16)){if(o&8){const d=n.vnode.dynamicProps;for(let f=0;f<d.length;f++){let g=d[f];if(Ru(n.emitsOptions,g))continue;const _=e[g];if(l)if(Xe(i,g))_!==i[g]&&(i[g]=_,u=!0);else{const k=Qn(g);s[k]=fh(l,a,k,_,n,!1)}else _!==i[g]&&(i[g]=_,u=!0)}}}else{Dy(n,e,s,i)&&(u=!0);let d;for(const f in a)(!e||!Xe(e,f)&&((d=Fs(f))===f||!Xe(e,d)))&&(l?t&&(t[f]!==void 0||t[d]!==void 0)&&(s[f]=fh(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!Xe(e,f))&&(delete i[f],u=!0)}u&&Cr(n.attrs,"set","")}function Dy(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(Na(l))continue;const u=e[l];let d;s&&Xe(s,d=Qn(l))?!i||!i.includes(d)?t[d]=u:(a||(a={}))[d]=u:Ru(n.emitsOptions,l)||(!(l in r)||u!==r[l])&&(r[l]=u,o=!0)}if(i){const l=Ye(t),u=a||lt;for(let d=0;d<i.length;d++){const f=i[d];t[f]=fh(s,l,f,u[f],n,!Xe(u,f))}}return o}function fh(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=Xe(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&De(l)){const{propsDefaults:u}=s;if(t in u)r=u[t];else{const d=Tl(s);r=u[t]=l.call(null,e),d()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===Fs(t))&&(r=!0))}return r}const oE=new WeakMap;function Vy(n,e,t=!1){const r=t?oE:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!De(n)){const d=f=>{l=!0;const[g,_]=Vy(f,e,!0);nn(o,g),_&&a.push(..._)};!t&&e.mixins.length&&e.mixins.forEach(d),n.extends&&d(n.extends),n.mixins&&n.mixins.forEach(d)}if(!i&&!l)return Et(n)&&r.set(n,ro),ro;if(Pe(i))for(let d=0;d<i.length;d++){const f=Qn(i[d]);mm(f)&&(o[f]=lt)}else if(i)for(const d in i){const f=Qn(d);if(mm(f)){const g=i[d],_=o[f]=Pe(g)||De(g)?{type:g}:nn({},g),k=_.type;let P=!1,R=!0;if(Pe(k))for(let L=0;L<k.length;++L){const B=k[L],$=De(B)&&B.name;if($==="Boolean"){P=!0;break}else $==="String"&&(R=!1)}else P=De(k)&&k.name==="Boolean";_[0]=P,_[1]=R,(P||Xe(_,"default"))&&a.push(f)}}const u=[o,a];return Et(n)&&r.set(n,u),u}function mm(n){return n[0]!=="$"&&!Na(n)}const df=n=>n[0]==="_"||n==="$stable",hf=n=>Pe(n)?n.map(dr):[dr(n)],aE=(n,e,t)=>{if(e._n)return e;const r=NI((...s)=>hf(e(...s)),t);return r._c=!1,r},Ny=(n,e,t)=>{const r=n._ctx;for(const s in n){if(df(s))continue;const i=n[s];if(De(i))e[s]=aE(s,i,r);else if(i!=null){const o=hf(i);e[s]=()=>o}}},Oy=(n,e)=>{const t=hf(e);n.slots.default=()=>t},My=(n,e,t)=>{for(const r in e)(t||!df(r))&&(n[r]=e[r])},lE=(n,e,t)=>{const r=n.slots=Cy();if(n.vnode.shapeFlag&32){const s=e.__;s&&sh(r,"__",s,!0);const i=e._;i?(My(r,e,t),t&&sh(r,"_",i,!0)):Ny(e,r)}else e&&Oy(n,e)},cE=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=lt;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:My(s,e,t):(i=!e.$stable,Ny(e,s)),o=e}else e&&(Oy(n,e),o={default:1});if(i)for(const a in s)!df(a)&&o[a]==null&&delete s[a]},$n=EE;function uE(n){return dE(n)}function dE(n,e){const t=Tu();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:u,setElementText:d,parentNode:f,nextSibling:g,setScopeId:_=rr,insertStaticContent:k}=n,P=(b,A,M,X=null,z=null,Z=null,ue=void 0,ne=null,re=!!A.dynamicChildren)=>{if(b===A)return;b&&!ga(b,A)&&(X=G(b),et(b,z,Z,!0),b=null),A.patchFlag===-2&&(re=!1,A.dynamicChildren=null);const{type:ee,ref:ve,shapeFlag:Q}=A;switch(ee){case Cu:R(b,A,M,X);break;case Ss:L(b,A,M,X);break;case Pc:b==null&&B(A,M,X,ue);break;case Dt:D(b,A,M,X,z,Z,ue,ne,re);break;default:Q&1?O(b,A,M,X,z,Z,ue,ne,re):Q&6?E(b,A,M,X,z,Z,ue,ne,re):(Q&64||Q&128)&&ee.process(b,A,M,X,z,Z,ue,ne,re,oe)}ve!=null&&z?La(ve,b&&b.ref,Z,A||b,!A):ve==null&&b&&b.ref!=null&&La(b.ref,null,Z,b,!0)},R=(b,A,M,X)=>{if(b==null)r(A.el=a(A.children),M,X);else{const z=A.el=b.el;A.children!==b.children&&u(z,A.children)}},L=(b,A,M,X)=>{b==null?r(A.el=l(A.children||""),M,X):A.el=b.el},B=(b,A,M,X)=>{[b.el,b.anchor]=k(b.children,A,M,X,b.el,b.anchor)},$=({el:b,anchor:A},M,X)=>{let z;for(;b&&b!==A;)z=g(b),r(b,M,X),b=z;r(A,M,X)},j=({el:b,anchor:A})=>{let M;for(;b&&b!==A;)M=g(b),s(b),b=M;s(A)},O=(b,A,M,X,z,Z,ue,ne,re)=>{A.type==="svg"?ue="svg":A.type==="math"&&(ue="mathml"),b==null?ie(A,M,X,z,Z,ue,ne,re):I(b,A,z,Z,ue,ne,re)},ie=(b,A,M,X,z,Z,ue,ne)=>{let re,ee;const{props:ve,shapeFlag:Q,transition:de,dirs:Ae}=b;if(re=b.el=o(b.type,Z,ve&&ve.is,ve),Q&8?d(re,b.children):Q&16&&w(b.children,re,null,X,z,kd(b,Z),ue,ne),Ae&&Js(b,null,X,"created"),x(re,b,b.scopeId,ue,X),ve){for(const Ce in ve)Ce!=="value"&&!Na(Ce)&&i(re,Ce,null,ve[Ce],Z,X);"value"in ve&&i(re,"value",null,ve.value,Z),(ee=ve.onVnodeBeforeMount)&&cr(ee,X,b)}Ae&&Js(b,null,X,"beforeMount");const Te=hE(z,de);Te&&de.beforeEnter(re),r(re,A,M),((ee=ve&&ve.onVnodeMounted)||Te||Ae)&&$n(()=>{ee&&cr(ee,X,b),Te&&de.enter(re),Ae&&Js(b,null,X,"mounted")},z)},x=(b,A,M,X,z)=>{if(M&&_(b,M),X)for(let Z=0;Z<X.length;Z++)_(b,X[Z]);if(z){let Z=z.subTree;if(A===Z||jy(Z.type)&&(Z.ssContent===A||Z.ssFallback===A)){const ue=z.vnode;x(b,ue,ue.scopeId,ue.slotScopeIds,z.parent)}}},w=(b,A,M,X,z,Z,ue,ne,re=0)=>{for(let ee=re;ee<b.length;ee++){const ve=b[ee]=ne?hs(b[ee]):dr(b[ee]);P(null,ve,A,M,X,z,Z,ue,ne)}},I=(b,A,M,X,z,Z,ue)=>{const ne=A.el=b.el;let{patchFlag:re,dynamicChildren:ee,dirs:ve}=A;re|=b.patchFlag&16;const Q=b.props||lt,de=A.props||lt;let Ae;if(M&&Ys(M,!1),(Ae=de.onVnodeBeforeUpdate)&&cr(Ae,M,A,b),ve&&Js(A,b,M,"beforeUpdate"),M&&Ys(M,!0),(Q.innerHTML&&de.innerHTML==null||Q.textContent&&de.textContent==null)&&d(ne,""),ee?S(b.dynamicChildren,ee,ne,M,X,kd(A,z),Z):ue||Se(b,A,ne,null,M,X,kd(A,z),Z,!1),re>0){if(re&16)T(ne,Q,de,M,z);else if(re&2&&Q.class!==de.class&&i(ne,"class",null,de.class,z),re&4&&i(ne,"style",Q.style,de.style,z),re&8){const Te=A.dynamicProps;for(let Ce=0;Ce<Te.length;Ce++){const Le=Te[Ce],Kt=Q[Le],pt=de[Le];(pt!==Kt||Le==="value")&&i(ne,Le,Kt,pt,z,M)}}re&1&&b.children!==A.children&&d(ne,A.children)}else!ue&&ee==null&&T(ne,Q,de,M,z);((Ae=de.onVnodeUpdated)||ve)&&$n(()=>{Ae&&cr(Ae,M,A,b),ve&&Js(A,b,M,"updated")},X)},S=(b,A,M,X,z,Z,ue)=>{for(let ne=0;ne<A.length;ne++){const re=b[ne],ee=A[ne],ve=re.el&&(re.type===Dt||!ga(re,ee)||re.shapeFlag&198)?f(re.el):M;P(re,ee,ve,null,X,z,Z,ue,!0)}},T=(b,A,M,X,z)=>{if(A!==M){if(A!==lt)for(const Z in A)!Na(Z)&&!(Z in M)&&i(b,Z,A[Z],null,z,X);for(const Z in M){if(Na(Z))continue;const ue=M[Z],ne=A[Z];ue!==ne&&Z!=="value"&&i(b,Z,ne,ue,z,X)}"value"in M&&i(b,"value",A.value,M.value,z)}},D=(b,A,M,X,z,Z,ue,ne,re)=>{const ee=A.el=b?b.el:a(""),ve=A.anchor=b?b.anchor:a("");let{patchFlag:Q,dynamicChildren:de,slotScopeIds:Ae}=A;Ae&&(ne=ne?ne.concat(Ae):Ae),b==null?(r(ee,M,X),r(ve,M,X),w(A.children||[],M,ve,z,Z,ue,ne,re)):Q>0&&Q&64&&de&&b.dynamicChildren?(S(b.dynamicChildren,de,M,z,Z,ue,ne),(A.key!=null||z&&A===z.subTree)&&Ly(b,A,!0)):Se(b,A,M,ve,z,Z,ue,ne,re)},E=(b,A,M,X,z,Z,ue,ne,re)=>{A.slotScopeIds=ne,b==null?A.shapeFlag&512?z.ctx.activate(A,M,X,ue,re):vt(A,M,X,z,Z,ue,re):Ot(b,A,re)},vt=(b,A,M,X,z,Z,ue)=>{const ne=b.component=CE(b,X,z);if(Ey(b)&&(ne.ctx.renderer=oe),kE(ne,!1,ue),ne.asyncDep){if(z&&z.registerDep(ne,He,ue),!b.el){const re=ne.subTree=Lt(Ss);L(null,re,A,M)}}else He(ne,b,A,M,z,Z,ue)},Ot=(b,A,M)=>{const X=A.component=b.component;if(bE(b,A,M))if(X.asyncDep&&!X.asyncResolved){Ne(X,A,M);return}else X.next=A,X.update();else A.el=b.el,X.vnode=A},He=(b,A,M,X,z,Z,ue)=>{const ne=()=>{if(b.isMounted){let{next:Q,bu:de,u:Ae,parent:Te,vnode:Ce}=b;{const ut=Fy(b);if(ut){Q&&(Q.el=Ce.el,Ne(b,Q,ue)),ut.asyncDep.then(()=>{b.isUnmounted||ne()});return}}let Le=Q,Kt;Ys(b,!1),Q?(Q.el=Ce.el,Ne(b,Q,ue)):Q=Ce,de&&Ac(de),(Kt=Q.props&&Q.props.onVnodeBeforeUpdate)&&cr(Kt,Te,Q,Ce),Ys(b,!0);const pt=Dd(b),Jt=b.subTree;b.subTree=pt,P(Jt,pt,f(Jt.el),G(Jt),b,z,Z),Q.el=pt.el,Le===null&&IE(b,pt.el),Ae&&$n(Ae,z),(Kt=Q.props&&Q.props.onVnodeUpdated)&&$n(()=>cr(Kt,Te,Q,Ce),z)}else{let Q;const{el:de,props:Ae}=A,{bm:Te,m:Ce,parent:Le,root:Kt,type:pt}=b,Jt=Fa(A);if(Ys(b,!1),Te&&Ac(Te),!Jt&&(Q=Ae&&Ae.onVnodeBeforeMount)&&cr(Q,Le,A),Ys(b,!0),de&&$e){const ut=()=>{b.subTree=Dd(b),$e(de,b.subTree,b,z,null)};Jt&&pt.__asyncHydrate?pt.__asyncHydrate(de,b,ut):ut()}else{Kt.ce&&Kt.ce._def.shadowRoot!==!1&&Kt.ce._injectChildStyle(pt);const ut=b.subTree=Dd(b);P(null,ut,M,X,b,z,Z),A.el=ut.el}if(Ce&&$n(Ce,z),!Jt&&(Q=Ae&&Ae.onVnodeMounted)){const ut=A;$n(()=>cr(Q,Le,ut),z)}(A.shapeFlag&256||Le&&Fa(Le.vnode)&&Le.vnode.shapeFlag&256)&&b.a&&$n(b.a,z),b.isMounted=!0,A=M=X=null}};b.scope.on();const re=b.effect=new X_(ne);b.scope.off();const ee=b.update=re.run.bind(re),ve=b.job=re.runIfDirty.bind(re);ve.i=b,ve.id=b.uid,re.scheduler=()=>af(ve),Ys(b,!0),ee()},Ne=(b,A,M)=>{A.component=b;const X=b.vnode.props;b.vnode=A,b.next=null,iE(b,A.props,X,M),cE(b,A.children,M),Ur(),cm(b),Br()},Se=(b,A,M,X,z,Z,ue,ne,re=!1)=>{const ee=b&&b.children,ve=b?b.shapeFlag:0,Q=A.children,{patchFlag:de,shapeFlag:Ae}=A;if(de>0){if(de&128){Ln(ee,Q,M,X,z,Z,ue,ne,re);return}else if(de&256){$t(ee,Q,M,X,z,Z,ue,ne,re);return}}Ae&8?(ve&16&&jt(ee,z,Z),Q!==ee&&d(M,Q)):ve&16?Ae&16?Ln(ee,Q,M,X,z,Z,ue,ne,re):jt(ee,z,Z,!0):(ve&8&&d(M,""),Ae&16&&w(Q,M,X,z,Z,ue,ne,re))},$t=(b,A,M,X,z,Z,ue,ne,re)=>{b=b||ro,A=A||ro;const ee=b.length,ve=A.length,Q=Math.min(ee,ve);let de;for(de=0;de<Q;de++){const Ae=A[de]=re?hs(A[de]):dr(A[de]);P(b[de],Ae,M,null,z,Z,ue,ne,re)}ee>ve?jt(b,z,Z,!0,!1,Q):w(A,M,X,z,Z,ue,ne,re,Q)},Ln=(b,A,M,X,z,Z,ue,ne,re)=>{let ee=0;const ve=A.length;let Q=b.length-1,de=ve-1;for(;ee<=Q&&ee<=de;){const Ae=b[ee],Te=A[ee]=re?hs(A[ee]):dr(A[ee]);if(ga(Ae,Te))P(Ae,Te,M,null,z,Z,ue,ne,re);else break;ee++}for(;ee<=Q&&ee<=de;){const Ae=b[Q],Te=A[de]=re?hs(A[de]):dr(A[de]);if(ga(Ae,Te))P(Ae,Te,M,null,z,Z,ue,ne,re);else break;Q--,de--}if(ee>Q){if(ee<=de){const Ae=de+1,Te=Ae<ve?A[Ae].el:X;for(;ee<=de;)P(null,A[ee]=re?hs(A[ee]):dr(A[ee]),M,Te,z,Z,ue,ne,re),ee++}}else if(ee>de)for(;ee<=Q;)et(b[ee],z,Z,!0),ee++;else{const Ae=ee,Te=ee,Ce=new Map;for(ee=Te;ee<=de;ee++){const Tt=A[ee]=re?hs(A[ee]):dr(A[ee]);Tt.key!=null&&Ce.set(Tt.key,ee)}let Le,Kt=0;const pt=de-Te+1;let Jt=!1,ut=0;const En=new Array(pt);for(ee=0;ee<pt;ee++)En[ee]=0;for(ee=Ae;ee<=Q;ee++){const Tt=b[ee];if(Kt>=pt){et(Tt,z,Z,!0);continue}let Rn;if(Tt.key!=null)Rn=Ce.get(Tt.key);else for(Le=Te;Le<=de;Le++)if(En[Le-Te]===0&&ga(Tt,A[Le])){Rn=Le;break}Rn===void 0?et(Tt,z,Z,!0):(En[Rn-Te]=ee+1,Rn>=ut?ut=Rn:Jt=!0,P(Tt,A[Rn],M,null,z,Z,ue,ne,re),Kt++)}const Xn=Jt?fE(En):ro;for(Le=Xn.length-1,ee=pt-1;ee>=0;ee--){const Tt=Te+ee,Rn=A[Tt],Vi=Tt+1<ve?A[Tt+1].el:X;En[ee]===0?P(null,Rn,M,Vi,z,Z,ue,ne,re):Jt&&(Le<0||ee!==Xn[Le]?rn(Rn,M,Vi,2):Le--)}}},rn=(b,A,M,X,z=null)=>{const{el:Z,type:ue,transition:ne,children:re,shapeFlag:ee}=b;if(ee&6){rn(b.component.subTree,A,M,X);return}if(ee&128){b.suspense.move(A,M,X);return}if(ee&64){ue.move(b,A,M,oe);return}if(ue===Dt){r(Z,A,M);for(let Q=0;Q<re.length;Q++)rn(re[Q],A,M,X);r(b.anchor,A,M);return}if(ue===Pc){$(b,A,M);return}if(X!==2&&ee&1&&ne)if(X===0)ne.beforeEnter(Z),r(Z,A,M),$n(()=>ne.enter(Z),z);else{const{leave:Q,delayLeave:de,afterLeave:Ae}=ne,Te=()=>{b.ctx.isUnmounted?s(Z):r(Z,A,M)},Ce=()=>{Q(Z,()=>{Te(),Ae&&Ae()})};de?de(Z,Te,Ce):Ce()}else r(Z,A,M)},et=(b,A,M,X=!1,z=!1)=>{const{type:Z,props:ue,ref:ne,children:re,dynamicChildren:ee,shapeFlag:ve,patchFlag:Q,dirs:de,cacheIndex:Ae}=b;if(Q===-2&&(z=!1),ne!=null&&(Ur(),La(ne,null,M,b,!0),Br()),Ae!=null&&(A.renderCache[Ae]=void 0),ve&256){A.ctx.deactivate(b);return}const Te=ve&1&&de,Ce=!Fa(b);let Le;if(Ce&&(Le=ue&&ue.onVnodeBeforeUnmount)&&cr(Le,A,b),ve&6)In(b.component,M,X);else{if(ve&128){b.suspense.unmount(M,X);return}Te&&Js(b,null,A,"beforeUnmount"),ve&64?b.type.remove(b,A,M,oe,X):ee&&!ee.hasOnce&&(Z!==Dt||Q>0&&Q&64)?jt(ee,A,M,!1,!0):(Z===Dt&&Q&384||!z&&ve&16)&&jt(re,A,M),X&&rt(b)}(Ce&&(Le=ue&&ue.onVnodeUnmounted)||Te)&&$n(()=>{Le&&cr(Le,A,b),Te&&Js(b,null,A,"unmounted")},M)},rt=b=>{const{type:A,el:M,anchor:X,transition:z}=b;if(A===Dt){Fn(M,X);return}if(A===Pc){j(b);return}const Z=()=>{s(M),z&&!z.persisted&&z.afterLeave&&z.afterLeave()};if(b.shapeFlag&1&&z&&!z.persisted){const{leave:ue,delayLeave:ne}=z,re=()=>ue(M,Z);ne?ne(b.el,Z,re):re()}else Z()},Fn=(b,A)=>{let M;for(;b!==A;)M=g(b),s(b),b=M;s(A)},In=(b,A,M)=>{const{bum:X,scope:z,job:Z,subTree:ue,um:ne,m:re,a:ee,parent:ve,slots:{__:Q}}=b;gm(re),gm(ee),X&&Ac(X),ve&&Pe(Q)&&Q.forEach(de=>{ve.renderCache[de]=void 0}),z.stop(),Z&&(Z.flags|=8,et(ue,b,A,M)),ne&&$n(ne,A),$n(()=>{b.isUnmounted=!0},A),A&&A.pendingBranch&&!A.isUnmounted&&b.asyncDep&&!b.asyncResolved&&b.suspenseId===A.pendingId&&(A.deps--,A.deps===0&&A.resolve())},jt=(b,A,M,X=!1,z=!1,Z=0)=>{for(let ue=Z;ue<b.length;ue++)et(b[ue],A,M,X,z)},G=b=>{if(b.shapeFlag&6)return G(b.component.subTree);if(b.shapeFlag&128)return b.suspense.next();const A=g(b.anchor||b.el),M=A&&A[OI];return M?g(M):A};let fe=!1;const le=(b,A,M)=>{b==null?A._vnode&&et(A._vnode,null,null,!0):P(A._vnode||null,b,A,null,null,null,M),A._vnode=b,fe||(fe=!0,cm(),yy(),fe=!1)},oe={p:P,um:et,m:rn,r:rt,mt:vt,mc:w,pc:Se,pbc:S,n:G,o:n};let Re,$e;return e&&([Re,$e]=e(oe)),{render:le,hydrate:Re,createApp:rE(le,Re)}}function kd({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Ys({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function hE(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function Ly(n,e,t=!1){const r=n.children,s=e.children;if(Pe(r)&&Pe(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=hs(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&Ly(o,a)),a.type===Cu&&(a.el=o.el),a.type===Ss&&!a.el&&(a.el=o.el)}}function fE(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const u=n[r];if(u!==0){if(s=t[t.length-1],n[s]<u){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<u?i=a+1:o=a;u<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function Fy(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Fy(e)}function gm(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const pE=Symbol.for("v-scx"),mE=()=>or(pE);function ar(n,e,t){return Uy(n,e,t)}function Uy(n,e,t=lt){const{immediate:r,deep:s,flush:i,once:o}=t,a=nn({},t),l=e&&r||!e&&i!=="post";let u;if(el){if(i==="sync"){const _=mE();u=_.__watcherHandles||(_.__watcherHandles=[])}else if(!l){const _=()=>{};return _.stop=rr,_.resume=rr,_.pause=rr,_}}const d=_n;a.call=(_,k,P)=>yr(_,d,k,P);let f=!1;i==="post"?a.scheduler=_=>{$n(_,d&&d.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(_,k)=>{k?_():af(_)}),a.augmentJob=_=>{e&&(_.flags|=4),f&&(_.flags|=2,d&&(_.id=d.uid,_.i=d))};const g=CI(n,e,a);return el&&(u?u.push(g):l&&g()),g}function gE(n,e,t){const r=this.proxy,s=Gt(n)?n.includes(".")?By(r,n):()=>r[n]:n.bind(r,r);let i;De(e)?i=e:(i=e.handler,t=e);const o=Tl(this),a=Uy(s,i.bind(r),t);return o(),a}function By(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const _E=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Qn(e)}Modifiers`]||n[`${Fs(e)}Modifiers`];function yE(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||lt;let s=t;const i=e.startsWith("update:"),o=i&&_E(r,e.slice(7));o&&(o.trim&&(s=t.map(d=>Gt(d)?d.trim():d)),o.number&&(s=t.map(ih)));let a,l=r[a=Ad(e)]||r[a=Ad(Qn(e))];!l&&i&&(l=r[a=Ad(Fs(e))]),l&&yr(l,n,6,s);const u=r[a+"Once"];if(u){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,yr(u,n,6,s)}}function $y(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!De(n)){const l=u=>{const d=$y(u,e,!0);d&&(a=!0,nn(o,d))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(Et(n)&&r.set(n,null),null):(Pe(i)?i.forEach(l=>o[l]=null):nn(o,i),Et(n)&&r.set(n,o),o)}function Ru(n,e){return!n||!wu(e)?!1:(e=e.slice(2).replace(/Once$/,""),Xe(n,e[0].toLowerCase()+e.slice(1))||Xe(n,Fs(e))||Xe(n,e))}function Dd(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:u,renderCache:d,props:f,data:g,setupState:_,ctx:k,inheritAttrs:P}=n,R=Hc(n);let L,B;try{if(t.shapeFlag&4){const j=s||r,O=j;L=dr(u.call(O,j,d,f,_,g,k)),B=a}else{const j=e;L=dr(j.length>1?j(f,{attrs:a,slots:o,emit:l}):j(f,null)),B=e.props?a:vE(a)}}catch(j){Ba.length=0,Pu(j,n,1),L=Lt(Ss)}let $=L;if(B&&P!==!1){const j=Object.keys(B),{shapeFlag:O}=$;j.length&&O&7&&(i&&j.some(Jh)&&(B=wE(B,i)),$=yo($,B,!1,!0))}return t.dirs&&($=yo($,null,!1,!0),$.dirs=$.dirs?$.dirs.concat(t.dirs):t.dirs),t.transition&&lf($,t.transition),L=$,Hc(R),L}const vE=n=>{let e;for(const t in n)(t==="class"||t==="style"||wu(t))&&((e||(e={}))[t]=n[t]);return e},wE=(n,e)=>{const t={};for(const r in n)(!Jh(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function bE(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,u=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?_m(r,o,u):!!o;if(l&8){const d=e.dynamicProps;for(let f=0;f<d.length;f++){const g=d[f];if(o[g]!==r[g]&&!Ru(u,g))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?_m(r,o,u):!0:!!o;return!1}function _m(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!Ru(t,i))return!0}return!1}function IE({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const jy=n=>n.__isSuspense;function EE(n,e){e&&e.pendingBranch?Pe(n)?e.effects.push(...n):e.effects.push(n):VI(n)}const Dt=Symbol.for("v-fgt"),Cu=Symbol.for("v-txt"),Ss=Symbol.for("v-cmt"),Pc=Symbol.for("v-stc"),Ba=[];let zn=null;function H(n=!1){Ba.push(zn=n?null:[])}function TE(){Ba.pop(),zn=Ba[Ba.length-1]||null}let Za=1;function ym(n,e=!1){Za+=n,n<0&&zn&&e&&(zn.hasOnce=!0)}function qy(n){return n.dynamicChildren=Za>0?zn||ro:null,TE(),Za>0&&zn&&zn.push(n),n}function W(n,e,t,r,s,i){return qy(m(n,e,t,r,s,i,!0))}function zy(n,e,t,r,s){return qy(Lt(n,e,t,r,s,!0))}function Qc(n){return n?n.__v_isVNode===!0:!1}function ga(n,e){return n.type===e.type&&n.key===e.key}const Gy=({key:n})=>n??null,Sc=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?Gt(n)||yn(n)||De(n)?{i:qn,r:n,k:e,f:!!t}:n:null);function m(n,e=null,t=null,r=0,s=null,i=n===Dt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&Gy(e),ref:e&&Sc(e),scopeId:wy,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:qn};return a?(ff(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=Gt(t)?8:16),Za>0&&!o&&zn&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&zn.push(l),l}const Lt=AE;function AE(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===WI)&&(n=Ss),Qc(n)){const a=yo(n,e,!0);return t&&ff(a,t),Za>0&&!i&&zn&&(a.shapeFlag&6?zn[zn.indexOf(n)]=a:zn.push(a)),a.patchFlag=-2,a}if(ME(n)&&(n=n.__vccOpts),e){e=xE(e);let{class:a,style:l}=e;a&&!Gt(a)&&(e.class=sr(a)),Et(l)&&(of(l)&&!Pe(l)&&(l=nn({},l)),e.style=ps(l))}const o=Gt(n)?1:jy(n)?128:MI(n)?64:Et(n)?4:De(n)?2:0;return m(n,e,t,r,s,o,i,!0)}function xE(n){return n?of(n)||ky(n)?nn({},n):n:null}function yo(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,u=e?PE(s||{},e):s,d={__v_isVNode:!0,__v_skip:!0,type:n.type,props:u,key:u&&Gy(u),ref:e&&e.ref?t&&i?Pe(i)?i.concat(Sc(e)):[i,Sc(e)]:Sc(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==Dt?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&yo(n.ssContent),ssFallback:n.ssFallback&&yo(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&lf(d,l.clone(d)),d}function jn(n=" ",e=0){return Lt(Cu,null,n,e)}function us(n,e){const t=Lt(Pc,null,n);return t.staticCount=e,t}function Ee(n="",e=!1){return e?(H(),zy(Ss,null,n)):Lt(Ss,null,n)}function dr(n){return n==null||typeof n=="boolean"?Lt(Ss):Pe(n)?Lt(Dt,null,n.slice()):Qc(n)?hs(n):Lt(Cu,null,String(n))}function hs(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:yo(n)}function ff(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(Pe(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),ff(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!ky(e)?e._ctx=qn:s===3&&qn&&(qn.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else De(e)?(e={default:e,_ctx:qn},t=32):(e=String(e),r&64?(t=16,e=[jn(e)]):t=8);n.children=e,n.shapeFlag|=t}function PE(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=sr([e.class,r.class]));else if(s==="style")e.style=ps([e.style,r.style]);else if(wu(s)){const i=e[s],o=r[s];o&&i!==o&&!(Pe(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function cr(n,e,t,r=null){yr(n,e,7,[t,r])}const SE=Sy();let RE=0;function CE(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||SE,i={uid:RE++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new rI(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Vy(r,s),emitsOptions:$y(r,s),emit:null,emitted:null,propsDefaults:lt,inheritAttrs:r.inheritAttrs,ctx:lt,data:lt,props:lt,attrs:lt,slots:lt,refs:lt,setupState:lt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=yE.bind(null,i),n.ce&&n.ce(i),i}let _n=null,Jc,ph;{const n=Tu(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};Jc=e("__VUE_INSTANCE_SETTERS__",t=>_n=t),ph=e("__VUE_SSR_SETTERS__",t=>el=t)}const Tl=n=>{const e=_n;return Jc(n),n.scope.on(),()=>{n.scope.off(),Jc(e)}},vm=()=>{_n&&_n.scope.off(),Jc(null)};function Ky(n){return n.vnode.shapeFlag&4}let el=!1;function kE(n,e=!1,t=!1){e&&ph(e);const{props:r,children:s}=n.vnode,i=Ky(n);sE(n,r,i,e),lE(n,s,t||e);const o=i?DE(n,e):void 0;return e&&ph(!1),o}function DE(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,JI);const{setup:r}=t;if(r){Ur();const s=n.setupContext=r.length>1?NE(n):null,i=Tl(n),o=El(r,n,0,[n.props,s]),a=K_(o);if(Br(),i(),(a||n.sp)&&!Fa(n)&&Iy(n),a){if(o.then(vm,vm),e)return o.then(l=>{wm(n,l,e)}).catch(l=>{Pu(l,n,0)});n.asyncDep=o}else wm(n,o,e)}else Hy(n,e)}function wm(n,e,t){De(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Et(e)&&(n.setupState=my(e)),Hy(n,t)}let bm;function Hy(n,e,t){const r=n.type;if(!n.render){if(!e&&bm&&!r.render){const s=r.template||uf(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,u=nn(nn({isCustomElement:i,delimiters:a},o),l);r.render=bm(s,u)}}n.render=r.render||rr}{const s=Tl(n);Ur();try{YI(n)}finally{Br(),s()}}}const VE={get(n,e){return gn(n,"get",""),n[e]}};function NE(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,VE),slots:n.slots,emit:n.emit,expose:e}}function ku(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(my(EI(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in Ua)return Ua[t](n)},has(e,t){return t in e||t in Ua}})):n.proxy}function OE(n,e=!0){return De(n)?n.displayName||n.name:n.name||e&&n.__name}function ME(n){return De(n)&&"__vccOpts"in n}const Zt=(n,e)=>SI(n,e,el);function Wy(n,e,t){const r=arguments.length;return r===2?Et(e)&&!Pe(e)?Qc(e)?Lt(n,null,[e]):Lt(n,e):Lt(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&Qc(t)&&(t=[t]),Lt(n,e,t))}const LE="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let mh;const Im=typeof window<"u"&&window.trustedTypes;if(Im)try{mh=Im.createPolicy("vue",{createHTML:n=>n})}catch{}const Qy=mh?n=>mh.createHTML(n):n=>n,FE="http://www.w3.org/2000/svg",UE="http://www.w3.org/1998/Math/MathML",Rr=typeof document<"u"?document:null,Em=Rr&&Rr.createElement("template"),BE={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?Rr.createElementNS(FE,n):e==="mathml"?Rr.createElementNS(UE,n):t?Rr.createElement(n,{is:t}):Rr.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>Rr.createTextNode(n),createComment:n=>Rr.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Rr.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{Em.innerHTML=Qy(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=Em.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},$E=Symbol("_vtc");function jE(n,e,t){const r=n[$E];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const Yc=Symbol("_vod"),Jy=Symbol("_vsh"),Tm={beforeMount(n,{value:e},{transition:t}){n[Yc]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):_a(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),_a(n,!0),r.enter(n)):r.leave(n,()=>{_a(n,!1)}):_a(n,e))},beforeUnmount(n,{value:e}){_a(n,e)}};function _a(n,e){n.style.display=e?n[Yc]:"none",n[Jy]=!e}const qE=Symbol(""),zE=/(^|;)\s*display\s*:/;function GE(n,e,t){const r=n.style,s=Gt(t);let i=!1;if(t&&!s){if(e)if(Gt(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&Rc(r,a,"")}else for(const o in e)t[o]==null&&Rc(r,o,"");for(const o in t)o==="display"&&(i=!0),Rc(r,o,t[o])}else if(s){if(e!==t){const o=r[qE];o&&(t+=";"+o),r.cssText=t,i=zE.test(t)}}else e&&n.removeAttribute("style");Yc in n&&(n[Yc]=i?r.display:"",n[Jy]&&(r.display="none"))}const Am=/\s*!important$/;function Rc(n,e,t){if(Pe(t))t.forEach(r=>Rc(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=KE(n,e);Am.test(t)?n.setProperty(Fs(r),t.replace(Am,""),"important"):n[r]=t}}const xm=["Webkit","Moz","ms"],Vd={};function KE(n,e){const t=Vd[e];if(t)return t;let r=Qn(e);if(r!=="filter"&&r in n)return Vd[e]=r;r=Eu(r);for(let s=0;s<xm.length;s++){const i=xm[s]+r;if(i in n)return Vd[e]=i}return e}const Pm="http://www.w3.org/1999/xlink";function Sm(n,e,t,r,s,i=nI(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(Pm,e.slice(6,e.length)):n.setAttributeNS(Pm,e,t):t==null||i&&!Q_(t)?n.removeAttribute(e):n.setAttribute(e,i?"":Ls(t)?String(t):t)}function Rm(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?Qy(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=Q_(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function Yi(n,e,t,r){n.addEventListener(e,t,r)}function HE(n,e,t,r){n.removeEventListener(e,t,r)}const Cm=Symbol("_vei");function WE(n,e,t,r,s=null){const i=n[Cm]||(n[Cm]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=QE(e);if(r){const u=i[e]=XE(r,s);Yi(n,a,u,l)}else o&&(HE(n,a,o,l),i[e]=void 0)}}const km=/(?:Once|Passive|Capture)$/;function QE(n){let e;if(km.test(n)){e={};let r;for(;r=n.match(km);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Fs(n.slice(2)),e]}let Nd=0;const JE=Promise.resolve(),YE=()=>Nd||(JE.then(()=>Nd=0),Nd=Date.now());function XE(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;yr(ZE(r,t.value),e,5,[r])};return t.value=n,t.attached=YE(),t}function ZE(n,e){if(Pe(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const Dm=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,eT=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?jE(n,r,o):e==="style"?GE(n,t,r):wu(e)?Jh(e)||WE(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):tT(n,e,r,o))?(Rm(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Sm(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!Gt(r))?Rm(n,Qn(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),Sm(n,e,r,o))};function tT(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&Dm(e)&&De(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Dm(e)&&Gt(t)?!1:e in n}const Vm=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Pe(e)?t=>Ac(e,t):e};function nT(n){n.target.composing=!0}function Nm(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Od=Symbol("_assign"),Pt={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[Od]=Vm(s);const i=r||s.props&&s.props.type==="number";Yi(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=ih(a)),n[Od](a)}),t&&Yi(n,"change",()=>{n.value=n.value.trim()}),e||(Yi(n,"compositionstart",nT),Yi(n,"compositionend",Nm),Yi(n,"change",Nm))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[Od]=Vm(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?ih(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},rT=["ctrl","shift","alt","meta"],sT={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>rT.some(t=>n[`${t}Key`]&&!e.includes(t))},Hn=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=sT[e[o]];if(a&&a(s,e))return}return n(s,...i)})},iT={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},An=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=Fs(s.key);if(e.some(o=>o===i||iT[o]===i))return n(s)})},oT=nn({patchProp:eT},BE);let Om;function aT(){return Om||(Om=uE(oT))}const lT=(...n)=>{const e=aT().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=uT(r);if(!s)return;const i=e._component;!De(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,cT(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function cT(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function uT(n){return Gt(n)?document.querySelector(n):n}const dT={__name:"App",setup(n){return(e,t)=>{const r=HI("router-view");return H(),zy(r)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const Xi=typeof document<"u";function Yy(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function hT(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&Yy(n.default)}const Je=Object.assign;function Md(n,e){const t={};for(const r in e){const s=e[r];t[r]=lr(s)?s.map(n):n(s)}return t}const $a=()=>{},lr=Array.isArray,Xy=/#/g,fT=/&/g,pT=/\//g,mT=/=/g,gT=/\?/g,Zy=/\+/g,_T=/%5B/g,yT=/%5D/g,ev=/%5E/g,vT=/%60/g,tv=/%7B/g,wT=/%7C/g,nv=/%7D/g,bT=/%20/g;function pf(n){return encodeURI(""+n).replace(wT,"|").replace(_T,"[").replace(yT,"]")}function IT(n){return pf(n).replace(tv,"{").replace(nv,"}").replace(ev,"^")}function gh(n){return pf(n).replace(Zy,"%2B").replace(bT,"+").replace(Xy,"%23").replace(fT,"%26").replace(vT,"`").replace(tv,"{").replace(nv,"}").replace(ev,"^")}function ET(n){return gh(n).replace(mT,"%3D")}function TT(n){return pf(n).replace(Xy,"%23").replace(gT,"%3F")}function AT(n){return n==null?"":TT(n).replace(pT,"%2F")}function tl(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const xT=/\/$/,PT=n=>n.replace(xT,"");function Ld(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=kT(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:tl(o)}}function ST(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function Mm(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function RT(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&vo(e.matched[r],t.matched[s])&&rv(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function vo(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function rv(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!CT(n[t],e[t]))return!1;return!0}function CT(n,e){return lr(n)?Lm(n,e):lr(e)?Lm(e,n):n===e}function Lm(n,e){return lr(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function kT(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const os={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var nl;(function(n){n.pop="pop",n.push="push"})(nl||(nl={}));var ja;(function(n){n.back="back",n.forward="forward",n.unknown=""})(ja||(ja={}));function DT(n){if(!n)if(Xi){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),PT(n)}const VT=/^[^#]+#/;function NT(n,e){return n.replace(VT,"#")+e}function OT(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const Du=()=>({left:window.scrollX,top:window.scrollY});function MT(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=OT(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function Fm(n,e){return(history.state?history.state.position-e:-1)+n}const _h=new Map;function LT(n,e){_h.set(n,e)}function FT(n){const e=_h.get(n);return _h.delete(n),e}let UT=()=>location.protocol+"//"+location.host;function sv(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),Mm(l,"")}return Mm(t,n)+r+s}function BT(n,e,t,r){let s=[],i=[],o=null;const a=({state:g})=>{const _=sv(n,location),k=t.value,P=e.value;let R=0;if(g){if(t.value=_,e.value=g,o&&o===k){o=null;return}R=P?g.position-P.position:0}else r(_);s.forEach(L=>{L(t.value,k,{delta:R,type:nl.pop,direction:R?R>0?ja.forward:ja.back:ja.unknown})})};function l(){o=t.value}function u(g){s.push(g);const _=()=>{const k=s.indexOf(g);k>-1&&s.splice(k,1)};return i.push(_),_}function d(){const{history:g}=window;g.state&&g.replaceState(Je({},g.state,{scroll:Du()}),"")}function f(){for(const g of i)g();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",d)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",d,{passive:!0}),{pauseListeners:l,listen:u,destroy:f}}function Um(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?Du():null}}function $T(n){const{history:e,location:t}=window,r={value:sv(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,u,d){const f=n.indexOf("#"),g=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:UT()+n+l;try{e[d?"replaceState":"pushState"](u,"",g),s.value=u}catch(_){console.error(_),t[d?"replace":"assign"](g)}}function o(l,u){const d=Je({},e.state,Um(s.value.back,l,s.value.forward,!0),u,{position:s.value.position});i(l,d,!0),r.value=l}function a(l,u){const d=Je({},s.value,e.state,{forward:l,scroll:Du()});i(d.current,d,!0);const f=Je({},Um(r.value,l,null),{position:d.position+1},u);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function jT(n){n=DT(n);const e=$T(n),t=BT(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=Je({location:"",base:n,go:r,createHref:NT.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function qT(n){return typeof n=="string"||n&&typeof n=="object"}function iv(n){return typeof n=="string"||typeof n=="symbol"}const ov=Symbol("");var Bm;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(Bm||(Bm={}));function wo(n,e){return Je(new Error,{type:n,[ov]:!0},e)}function Sr(n,e){return n instanceof Error&&ov in n&&(e==null||!!(n.type&e))}const $m="[^/]+?",zT={sensitive:!1,strict:!1,start:!0,end:!0},GT=/[.+*?^${}()[\]/\\]/g;function KT(n,e){const t=Je({},zT,e),r=[];let s=t.start?"^":"";const i=[];for(const u of n){const d=u.length?[]:[90];t.strict&&!u.length&&(s+="/");for(let f=0;f<u.length;f++){const g=u[f];let _=40+(t.sensitive?.25:0);if(g.type===0)f||(s+="/"),s+=g.value.replace(GT,"\\$&"),_+=40;else if(g.type===1){const{value:k,repeatable:P,optional:R,regexp:L}=g;i.push({name:k,repeatable:P,optional:R});const B=L||$m;if(B!==$m){_+=10;try{new RegExp(`(${B})`)}catch(j){throw new Error(`Invalid custom RegExp for param "${k}" (${B}): `+j.message)}}let $=P?`((?:${B})(?:/(?:${B}))*)`:`(${B})`;f||($=R&&u.length<2?`(?:/${$})`:"/"+$),R&&($+="?"),s+=$,_+=20,R&&(_+=-8),P&&(_+=-20),B===".*"&&(_+=-50)}d.push(_)}r.push(d)}if(t.strict&&t.end){const u=r.length-1;r[u][r[u].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(u){const d=u.match(o),f={};if(!d)return null;for(let g=1;g<d.length;g++){const _=d[g]||"",k=i[g-1];f[k.name]=_&&k.repeatable?_.split("/"):_}return f}function l(u){let d="",f=!1;for(const g of n){(!f||!d.endsWith("/"))&&(d+="/"),f=!1;for(const _ of g)if(_.type===0)d+=_.value;else if(_.type===1){const{value:k,repeatable:P,optional:R}=_,L=k in u?u[k]:"";if(lr(L)&&!P)throw new Error(`Provided param "${k}" is an array but it is not repeatable (* or + modifiers)`);const B=lr(L)?L.join("/"):L;if(!B)if(R)g.length<2&&(d.endsWith("/")?d=d.slice(0,-1):f=!0);else throw new Error(`Missing required param "${k}"`);d+=B}}return d||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function HT(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function av(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=HT(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(jm(r))return 1;if(jm(s))return-1}return s.length-r.length}function jm(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const WT={type:0,value:""},QT=/[a-zA-Z0-9_]/;function JT(n){if(!n)return[[]];if(n==="/")return[[WT]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(_){throw new Error(`ERR (${t})/"${u}": ${_}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,u="",d="";function f(){u&&(t===0?i.push({type:0,value:u}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${u}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:u,regexp:d,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),u="")}function g(){u+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(u&&f(),o()):l===":"?(f(),t=1):g();break;case 4:g(),t=r;break;case 1:l==="("?t=2:QT.test(l)?g():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?d[d.length-1]=="\\"?d=d.slice(0,-1)+l:t=3:d+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,d="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${u}"`),f(),o(),s}function YT(n,e,t){const r=KT(JT(n.path),t),s=Je(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function XT(n,e){const t=[],r=new Map;e=Km({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,g,_){const k=!_,P=zm(f);P.aliasOf=_&&_.record;const R=Km(e,f),L=[P];if("alias"in f){const j=typeof f.alias=="string"?[f.alias]:f.alias;for(const O of j)L.push(zm(Je({},P,{components:_?_.record.components:P.components,path:O,aliasOf:_?_.record:P})))}let B,$;for(const j of L){const{path:O}=j;if(g&&O[0]!=="/"){const ie=g.record.path,x=ie[ie.length-1]==="/"?"":"/";j.path=g.record.path+(O&&x+O)}if(B=YT(j,g,R),_?_.alias.push(B):($=$||B,$!==B&&$.alias.push(B),k&&f.name&&!Gm(B)&&o(f.name)),lv(B)&&l(B),P.children){const ie=P.children;for(let x=0;x<ie.length;x++)i(ie[x],B,_&&_.children[x])}_=_||B}return $?()=>{o($)}:$a}function o(f){if(iv(f)){const g=r.get(f);g&&(r.delete(f),t.splice(t.indexOf(g),1),g.children.forEach(o),g.alias.forEach(o))}else{const g=t.indexOf(f);g>-1&&(t.splice(g,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const g=tA(f,t);t.splice(g,0,f),f.record.name&&!Gm(f)&&r.set(f.record.name,f)}function u(f,g){let _,k={},P,R;if("name"in f&&f.name){if(_=r.get(f.name),!_)throw wo(1,{location:f});R=_.record.name,k=Je(qm(g.params,_.keys.filter($=>!$.optional).concat(_.parent?_.parent.keys.filter($=>$.optional):[]).map($=>$.name)),f.params&&qm(f.params,_.keys.map($=>$.name))),P=_.stringify(k)}else if(f.path!=null)P=f.path,_=t.find($=>$.re.test(P)),_&&(k=_.parse(P),R=_.record.name);else{if(_=g.name?r.get(g.name):t.find($=>$.re.test(g.path)),!_)throw wo(1,{location:f,currentLocation:g});R=_.record.name,k=Je({},g.params,f.params),P=_.stringify(k)}const L=[];let B=_;for(;B;)L.unshift(B.record),B=B.parent;return{name:R,path:P,params:k,matched:L,meta:eA(L)}}n.forEach(f=>i(f));function d(){t.length=0,r.clear()}return{addRoute:i,resolve:u,removeRoute:o,clearRoutes:d,getRoutes:a,getRecordMatcher:s}}function qm(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function zm(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:ZT(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function ZT(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function Gm(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function eA(n){return n.reduce((e,t)=>Je(e,t.meta),{})}function Km(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function tA(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;av(n,e[i])<0?r=i:t=i+1}const s=nA(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function nA(n){let e=n;for(;e=e.parent;)if(lv(e)&&av(n,e)===0)return e}function lv({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function rA(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(Zy," "),o=i.indexOf("="),a=tl(o<0?i:i.slice(0,o)),l=o<0?null:tl(i.slice(o+1));if(a in e){let u=e[a];lr(u)||(u=e[a]=[u]),u.push(l)}else e[a]=l}return e}function Hm(n){let e="";for(let t in n){const r=n[t];if(t=ET(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(lr(r)?r.map(i=>i&&gh(i)):[r&&gh(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function sA(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=lr(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const iA=Symbol(""),Wm=Symbol(""),Vu=Symbol(""),mf=Symbol(""),yh=Symbol("");function ya(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function fs(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const u=g=>{g===!1?l(wo(4,{from:t,to:e})):g instanceof Error?l(g):qT(g)?l(wo(2,{from:e,to:g})):(o&&r.enterCallbacks[s]===o&&typeof g=="function"&&o.push(g),a())},d=i(()=>n.call(r&&r.instances[s],e,t,u));let f=Promise.resolve(d);n.length<3&&(f=f.then(u)),f.catch(g=>l(g))})}function Fd(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(Yy(l)){const d=(l.__vccOpts||l)[e];d&&i.push(fs(d,t,r,o,a,s))}else{let u=l();i.push(()=>u.then(d=>{if(!d)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=hT(d)?d.default:d;o.mods[a]=d,o.components[a]=f;const _=(f.__vccOpts||f)[e];return _&&fs(_,t,r,o,a,s)()}))}}return i}function Qm(n){const e=or(Vu),t=or(mf),r=Zt(()=>{const l=oo(n.to);return e.resolve(l)}),s=Zt(()=>{const{matched:l}=r.value,{length:u}=l,d=l[u-1],f=t.matched;if(!d||!f.length)return-1;const g=f.findIndex(vo.bind(null,d));if(g>-1)return g;const _=Jm(l[u-2]);return u>1&&Jm(d)===_&&f[f.length-1].path!==_?f.findIndex(vo.bind(null,l[u-2])):g}),i=Zt(()=>s.value>-1&&uA(t.params,r.value.params)),o=Zt(()=>s.value>-1&&s.value===t.matched.length-1&&rv(t.params,r.value.params));function a(l={}){if(cA(l)){const u=e[oo(n.replace)?"replace":"push"](oo(n.to)).catch($a);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>u),u}return Promise.resolve()}return{route:r,href:Zt(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function oA(n){return n.length===1?n[0]:n}const aA=by({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:Qm,setup(n,{slots:e}){const t=xu(Qm(n)),{options:r}=or(Vu),s=Zt(()=>({[Ym(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[Ym(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&oA(e.default(t));return n.custom?i:Wy("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),lA=aA;function cA(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function uA(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!lr(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function Jm(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const Ym=(n,e,t)=>n??e??t,dA=by({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=or(yh),s=Zt(()=>n.route||r.value),i=or(Wm,0),o=Zt(()=>{let u=oo(i);const{matched:d}=s.value;let f;for(;(f=d[u])&&!f.components;)u++;return u}),a=Zt(()=>s.value.matched[o.value]);xc(Wm,Zt(()=>o.value+1)),xc(iA,a),xc(yh,s);const l=q();return ar(()=>[l.value,a.value,n.name],([u,d,f],[g,_,k])=>{d&&(d.instances[f]=u,_&&_!==d&&u&&u===g&&(d.leaveGuards.size||(d.leaveGuards=_.leaveGuards),d.updateGuards.size||(d.updateGuards=_.updateGuards))),u&&d&&(!_||!vo(d,_)||!g)&&(d.enterCallbacks[f]||[]).forEach(P=>P(u))},{flush:"post"}),()=>{const u=s.value,d=n.name,f=a.value,g=f&&f.components[d];if(!g)return Xm(t.default,{Component:g,route:u});const _=f.props[d],k=_?_===!0?u.params:typeof _=="function"?_(u):_:null,R=Wy(g,Je({},k,e,{onVnodeUnmounted:L=>{L.component.isUnmounted&&(f.instances[d]=null)},ref:l}));return Xm(t.default,{Component:R,route:u})||R}}});function Xm(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const hA=dA;function fA(n){const e=XT(n.routes,n),t=n.parseQuery||rA,r=n.stringifyQuery||Hm,s=n.history,i=ya(),o=ya(),a=ya(),l=TI(os);let u=os;Xi&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=Md.bind(null,G=>""+G),f=Md.bind(null,AT),g=Md.bind(null,tl);function _(G,fe){let le,oe;return iv(G)?(le=e.getRecordMatcher(G),oe=fe):oe=G,e.addRoute(oe,le)}function k(G){const fe=e.getRecordMatcher(G);fe&&e.removeRoute(fe)}function P(){return e.getRoutes().map(G=>G.record)}function R(G){return!!e.getRecordMatcher(G)}function L(G,fe){if(fe=Je({},fe||l.value),typeof G=="string"){const A=Ld(t,G,fe.path),M=e.resolve({path:A.path},fe),X=s.createHref(A.fullPath);return Je(A,M,{params:g(M.params),hash:tl(A.hash),redirectedFrom:void 0,href:X})}let le;if(G.path!=null)le=Je({},G,{path:Ld(t,G.path,fe.path).path});else{const A=Je({},G.params);for(const M in A)A[M]==null&&delete A[M];le=Je({},G,{params:f(A)}),fe.params=f(fe.params)}const oe=e.resolve(le,fe),Re=G.hash||"";oe.params=d(g(oe.params));const $e=ST(r,Je({},G,{hash:IT(Re),path:oe.path})),b=s.createHref($e);return Je({fullPath:$e,hash:Re,query:r===Hm?sA(G.query):G.query||{}},oe,{redirectedFrom:void 0,href:b})}function B(G){return typeof G=="string"?Ld(t,G,l.value.path):Je({},G)}function $(G,fe){if(u!==G)return wo(8,{from:fe,to:G})}function j(G){return x(G)}function O(G){return j(Je(B(G),{replace:!0}))}function ie(G){const fe=G.matched[G.matched.length-1];if(fe&&fe.redirect){const{redirect:le}=fe;let oe=typeof le=="function"?le(G):le;return typeof oe=="string"&&(oe=oe.includes("?")||oe.includes("#")?oe=B(oe):{path:oe},oe.params={}),Je({query:G.query,hash:G.hash,params:oe.path!=null?{}:G.params},oe)}}function x(G,fe){const le=u=L(G),oe=l.value,Re=G.state,$e=G.force,b=G.replace===!0,A=ie(le);if(A)return x(Je(B(A),{state:typeof A=="object"?Je({},Re,A.state):Re,force:$e,replace:b}),fe||le);const M=le;M.redirectedFrom=fe;let X;return!$e&&RT(r,oe,le)&&(X=wo(16,{to:M,from:oe}),rn(oe,oe,!0,!1)),(X?Promise.resolve(X):S(M,oe)).catch(z=>Sr(z)?Sr(z,2)?z:Ln(z):Se(z,M,oe)).then(z=>{if(z){if(Sr(z,2))return x(Je({replace:b},B(z.to),{state:typeof z.to=="object"?Je({},Re,z.to.state):Re,force:$e}),fe||M)}else z=D(M,oe,!0,b,Re);return T(M,oe,z),z})}function w(G,fe){const le=$(G,fe);return le?Promise.reject(le):Promise.resolve()}function I(G){const fe=Fn.values().next().value;return fe&&typeof fe.runWithContext=="function"?fe.runWithContext(G):G()}function S(G,fe){let le;const[oe,Re,$e]=pA(G,fe);le=Fd(oe.reverse(),"beforeRouteLeave",G,fe);for(const A of oe)A.leaveGuards.forEach(M=>{le.push(fs(M,G,fe))});const b=w.bind(null,G,fe);return le.push(b),jt(le).then(()=>{le=[];for(const A of i.list())le.push(fs(A,G,fe));return le.push(b),jt(le)}).then(()=>{le=Fd(Re,"beforeRouteUpdate",G,fe);for(const A of Re)A.updateGuards.forEach(M=>{le.push(fs(M,G,fe))});return le.push(b),jt(le)}).then(()=>{le=[];for(const A of $e)if(A.beforeEnter)if(lr(A.beforeEnter))for(const M of A.beforeEnter)le.push(fs(M,G,fe));else le.push(fs(A.beforeEnter,G,fe));return le.push(b),jt(le)}).then(()=>(G.matched.forEach(A=>A.enterCallbacks={}),le=Fd($e,"beforeRouteEnter",G,fe,I),le.push(b),jt(le))).then(()=>{le=[];for(const A of o.list())le.push(fs(A,G,fe));return le.push(b),jt(le)}).catch(A=>Sr(A,8)?A:Promise.reject(A))}function T(G,fe,le){a.list().forEach(oe=>I(()=>oe(G,fe,le)))}function D(G,fe,le,oe,Re){const $e=$(G,fe);if($e)return $e;const b=fe===os,A=Xi?history.state:{};le&&(oe||b?s.replace(G.fullPath,Je({scroll:b&&A&&A.scroll},Re)):s.push(G.fullPath,Re)),l.value=G,rn(G,fe,le,b),Ln()}let E;function vt(){E||(E=s.listen((G,fe,le)=>{if(!In.listening)return;const oe=L(G),Re=ie(oe);if(Re){x(Je(Re,{replace:!0,force:!0}),oe).catch($a);return}u=oe;const $e=l.value;Xi&&LT(Fm($e.fullPath,le.delta),Du()),S(oe,$e).catch(b=>Sr(b,12)?b:Sr(b,2)?(x(Je(B(b.to),{force:!0}),oe).then(A=>{Sr(A,20)&&!le.delta&&le.type===nl.pop&&s.go(-1,!1)}).catch($a),Promise.reject()):(le.delta&&s.go(-le.delta,!1),Se(b,oe,$e))).then(b=>{b=b||D(oe,$e,!1),b&&(le.delta&&!Sr(b,8)?s.go(-le.delta,!1):le.type===nl.pop&&Sr(b,20)&&s.go(-1,!1)),T(oe,$e,b)}).catch($a)}))}let Ot=ya(),He=ya(),Ne;function Se(G,fe,le){Ln(G);const oe=He.list();return oe.length?oe.forEach(Re=>Re(G,fe,le)):console.error(G),Promise.reject(G)}function $t(){return Ne&&l.value!==os?Promise.resolve():new Promise((G,fe)=>{Ot.add([G,fe])})}function Ln(G){return Ne||(Ne=!G,vt(),Ot.list().forEach(([fe,le])=>G?le(G):fe()),Ot.reset()),G}function rn(G,fe,le,oe){const{scrollBehavior:Re}=n;if(!Xi||!Re)return Promise.resolve();const $e=!le&&FT(Fm(G.fullPath,0))||(oe||!le)&&history.state&&history.state.scroll||null;return Lr().then(()=>Re(G,fe,$e)).then(b=>b&&MT(b)).catch(b=>Se(b,G,fe))}const et=G=>s.go(G);let rt;const Fn=new Set,In={currentRoute:l,listening:!0,addRoute:_,removeRoute:k,clearRoutes:e.clearRoutes,hasRoute:R,getRoutes:P,resolve:L,options:n,push:j,replace:O,go:et,back:()=>et(-1),forward:()=>et(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:He.add,isReady:$t,install(G){const fe=this;G.component("RouterLink",lA),G.component("RouterView",hA),G.config.globalProperties.$router=fe,Object.defineProperty(G.config.globalProperties,"$route",{enumerable:!0,get:()=>oo(l)}),Xi&&!rt&&l.value===os&&(rt=!0,j(s.location).catch(Re=>{}));const le={};for(const Re in os)Object.defineProperty(le,Re,{get:()=>l.value[Re],enumerable:!0});G.provide(Vu,fe),G.provide(mf,hy(le)),G.provide(yh,l);const oe=G.unmount;Fn.add(G),G.unmount=function(){Fn.delete(G),Fn.size<1&&(u=os,E&&E(),E=null,l.value=os,rt=!1,Ne=!1),oe()}}};function jt(G){return G.reduce((fe,le)=>fe.then(()=>I(le)),Promise.resolve())}return In}function pA(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(u=>vo(u,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(u=>vo(u,l))||s.push(l))}return[t,r,s]}function Nu(){return or(Vu)}function cv(n){return or(mf)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uv=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},mA=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},dv={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,u=l?n[s+2]:0,d=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|u>>6,_=u&63;l||(_=64,o||(g=64)),r.push(t[d],t[f],t[g],t[_])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(uv(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):mA(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||f==null)throw new gA;const g=i<<2|a>>4;if(r.push(g),u!==64){const _=a<<4&240|u>>2;if(r.push(_),f!==64){const k=u<<6&192|f;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class gA extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const _A=function(n){const e=uv(n);return dv.encodeByteArray(e,!0)},Xc=function(n){return _A(n).replace(/\./g,"")},hv=function(n){try{return dv.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vA=()=>yA().__FIREBASE_DEFAULTS__,wA=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},bA=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&hv(n[1]);return e&&JSON.parse(e)},Ou=()=>{try{return vA()||wA()||bA()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},fv=n=>{var e,t;return(t=(e=Ou())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},IA=n=>{const e=fv(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},pv=()=>{var n;return(n=Ou())===null||n===void 0?void 0:n.config},mv=n=>{var e;return(e=Ou())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EA{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TA(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[Xc(JSON.stringify(t)),Xc(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function AA(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Wt())}function xA(){var n;const e=(n=Ou())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function PA(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function SA(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function RA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function CA(){const n=Wt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function gv(){return!xA()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function _v(){try{return typeof indexedDB=="object"}catch{return!1}}function kA(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DA="FirebaseError";class Wr extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=DA,Object.setPrototypeOf(this,Wr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Al.prototype.create)}}class Al{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?VA(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Wr(s,a,r)}}function VA(n,e){return n.replace(NA,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const NA=/\{\$([^}]+)}/g;function OA(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Rs(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(Zm(i)&&Zm(o)){if(!Rs(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Zm(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fo(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Pa(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Sa(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function MA(n,e){const t=new LA(n,e);return t.subscribe.bind(t)}class LA{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");FA(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Ud),s.error===void 0&&(s.error=Ud),s.complete===void 0&&(s.complete=Ud);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function FA(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Ud(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function be(n){return n&&n._delegate?n._delegate:n}class fi{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ei="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UA{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new EA;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if($A(e))try{this.getOrInitializeService({instanceIdentifier:ei})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ei){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ei){return this.instances.has(e)}getOptions(e=ei){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:BA(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ei){return this.component?this.component.multipleInstances?e:ei:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function BA(n){return n===ei?void 0:n}function $A(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jA{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new UA(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var je;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(je||(je={}));const qA={debug:je.DEBUG,verbose:je.VERBOSE,info:je.INFO,warn:je.WARN,error:je.ERROR,silent:je.SILENT},zA=je.INFO,GA={[je.DEBUG]:"log",[je.VERBOSE]:"log",[je.INFO]:"info",[je.WARN]:"warn",[je.ERROR]:"error"},KA=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=GA[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class gf{constructor(e){this.name=e,this._logLevel=zA,this._logHandler=KA,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in je))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?qA[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,je.DEBUG,...e),this._logHandler(this,je.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,je.VERBOSE,...e),this._logHandler(this,je.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,je.INFO,...e),this._logHandler(this,je.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,je.WARN,...e),this._logHandler(this,je.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,je.ERROR,...e),this._logHandler(this,je.ERROR,...e)}}const HA=(n,e)=>e.some(t=>n instanceof t);let eg,tg;function WA(){return eg||(eg=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function QA(){return tg||(tg=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const yv=new WeakMap,vh=new WeakMap,vv=new WeakMap,Bd=new WeakMap,_f=new WeakMap;function JA(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Ts(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&yv.set(t,n)}).catch(()=>{}),_f.set(e,n),e}function YA(n){if(vh.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});vh.set(n,e)}let wh={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return vh.get(n);if(e==="objectStoreNames")return n.objectStoreNames||vv.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ts(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function XA(n){wh=n(wh)}function ZA(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call($d(this),e,...t);return vv.set(r,e.sort?e.sort():[e]),Ts(r)}:QA().includes(n)?function(...e){return n.apply($d(this),e),Ts(yv.get(this))}:function(...e){return Ts(n.apply($d(this),e))}}function ex(n){return typeof n=="function"?ZA(n):(n instanceof IDBTransaction&&YA(n),HA(n,WA())?new Proxy(n,wh):n)}function Ts(n){if(n instanceof IDBRequest)return JA(n);if(Bd.has(n))return Bd.get(n);const e=ex(n);return e!==n&&(Bd.set(n,e),_f.set(e,n)),e}const $d=n=>_f.get(n);function tx(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Ts(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Ts(o.result),l.oldVersion,l.newVersion,Ts(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const nx=["get","getKey","getAll","getAllKeys","count"],rx=["put","add","delete","clear"],jd=new Map;function ng(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(jd.get(e))return jd.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=rx.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||nx.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&l.done]))[0]};return jd.set(e,i),i}XA(n=>({...n,get:(e,t,r)=>ng(e,t)||n.get(e,t,r),has:(e,t)=>!!ng(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sx{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(ix(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function ix(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const bh="@firebase/app",rg="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $r=new gf("@firebase/app"),ox="@firebase/app-compat",ax="@firebase/analytics-compat",lx="@firebase/analytics",cx="@firebase/app-check-compat",ux="@firebase/app-check",dx="@firebase/auth",hx="@firebase/auth-compat",fx="@firebase/database",px="@firebase/data-connect",mx="@firebase/database-compat",gx="@firebase/functions",_x="@firebase/functions-compat",yx="@firebase/installations",vx="@firebase/installations-compat",wx="@firebase/messaging",bx="@firebase/messaging-compat",Ix="@firebase/performance",Ex="@firebase/performance-compat",Tx="@firebase/remote-config",Ax="@firebase/remote-config-compat",xx="@firebase/storage",Px="@firebase/storage-compat",Sx="@firebase/firestore",Rx="@firebase/vertexai-preview",Cx="@firebase/firestore-compat",kx="firebase",Dx="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zc="[DEFAULT]",Vx={[bh]:"fire-core",[ox]:"fire-core-compat",[lx]:"fire-analytics",[ax]:"fire-analytics-compat",[ux]:"fire-app-check",[cx]:"fire-app-check-compat",[dx]:"fire-auth",[hx]:"fire-auth-compat",[fx]:"fire-rtdb",[px]:"fire-data-connect",[mx]:"fire-rtdb-compat",[gx]:"fire-fn",[_x]:"fire-fn-compat",[yx]:"fire-iid",[vx]:"fire-iid-compat",[wx]:"fire-fcm",[bx]:"fire-fcm-compat",[Ix]:"fire-perf",[Ex]:"fire-perf-compat",[Tx]:"fire-rc",[Ax]:"fire-rc-compat",[xx]:"fire-gcs",[Px]:"fire-gcs-compat",[Sx]:"fire-fst",[Cx]:"fire-fst-compat",[Rx]:"fire-vertex","fire-js":"fire-js",[kx]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eu=new Map,Nx=new Map,Ih=new Map;function sg(n,e){try{n.container.addComponent(e)}catch(t){$r.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function bo(n){const e=n.name;if(Ih.has(e))return $r.debug(`There were multiple attempts to register component ${e}.`),!1;Ih.set(e,n);for(const t of eu.values())sg(t,n);for(const t of Nx.values())sg(t,n);return!0}function xl(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Ox(n,e,t=Zc){xl(n,e).clearInstance(t)}function Ft(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mx={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},As=new Al("app","Firebase",Mx);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lx{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new fi("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw As.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uo=Dx;function wv(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Zc,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw As.create("bad-app-name",{appName:String(s)});if(t||(t=pv()),!t)throw As.create("no-options");const i=eu.get(s);if(i){if(Rs(t,i.options)&&Rs(r,i.config))return i;throw As.create("duplicate-app",{appName:s})}const o=new jA(s);for(const l of Ih.values())o.addComponent(l);const a=new Lx(t,r,o);return eu.set(s,a),a}function bv(n=Zc){const e=eu.get(n);if(!e&&n===Zc&&pv())return wv();if(!e)throw As.create("no-app",{appName:n});return e}function xs(n,e,t){var r;let s=(r=Vx[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),$r.warn(a.join(" "));return}bo(new fi(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fx="firebase-heartbeat-database",Ux=1,rl="firebase-heartbeat-store";let qd=null;function Iv(){return qd||(qd=tx(Fx,Ux,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(rl)}catch(t){console.warn(t)}}}}).catch(n=>{throw As.create("idb-open",{originalErrorMessage:n.message})})),qd}async function Bx(n){try{const t=(await Iv()).transaction(rl),r=await t.objectStore(rl).get(Ev(n));return await t.done,r}catch(e){if(e instanceof Wr)$r.warn(e.message);else{const t=As.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});$r.warn(t.message)}}}async function ig(n,e){try{const r=(await Iv()).transaction(rl,"readwrite");await r.objectStore(rl).put(e,Ev(n)),await r.done}catch(t){if(t instanceof Wr)$r.warn(t.message);else{const r=As.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});$r.warn(r.message)}}}function Ev(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $x=1024,jx=30*24*60*60*1e3;class qx{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Gx(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=og();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=jx}),this._storage.overwrite(this._heartbeatsCache))}catch(r){$r.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=og(),{heartbeatsToSend:r,unsentEntries:s}=zx(this._heartbeatsCache.heartbeats),i=Xc(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return $r.warn(t),""}}}function og(){return new Date().toISOString().substring(0,10)}function zx(n,e=$x){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),ag(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),ag(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Gx{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return _v()?kA().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Bx(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return ig(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return ig(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function ag(n){return Xc(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kx(n){bo(new fi("platform-logger",e=>new sx(e),"PRIVATE")),bo(new fi("heartbeat",e=>new qx(e),"PRIVATE")),xs(bh,rg,n),xs(bh,rg,"esm2017"),xs("fire-js","")}Kx("");var Hx="firebase",Wx="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */xs(Hx,Wx,"app");var lg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ui,Tv;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(x,w){function I(){}I.prototype=w.prototype,x.D=w.prototype,x.prototype=new I,x.prototype.constructor=x,x.C=function(S,T,D){for(var E=Array(arguments.length-2),vt=2;vt<arguments.length;vt++)E[vt-2]=arguments[vt];return w.prototype[T].apply(S,E)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(x,w,I){I||(I=0);var S=Array(16);if(typeof w=="string")for(var T=0;16>T;++T)S[T]=w.charCodeAt(I++)|w.charCodeAt(I++)<<8|w.charCodeAt(I++)<<16|w.charCodeAt(I++)<<24;else for(T=0;16>T;++T)S[T]=w[I++]|w[I++]<<8|w[I++]<<16|w[I++]<<24;w=x.g[0],I=x.g[1],T=x.g[2];var D=x.g[3],E=w+(D^I&(T^D))+S[0]+3614090360&4294967295;w=I+(E<<7&4294967295|E>>>25),E=D+(T^w&(I^T))+S[1]+3905402710&4294967295,D=w+(E<<12&4294967295|E>>>20),E=T+(I^D&(w^I))+S[2]+606105819&4294967295,T=D+(E<<17&4294967295|E>>>15),E=I+(w^T&(D^w))+S[3]+3250441966&4294967295,I=T+(E<<22&4294967295|E>>>10),E=w+(D^I&(T^D))+S[4]+4118548399&4294967295,w=I+(E<<7&4294967295|E>>>25),E=D+(T^w&(I^T))+S[5]+1200080426&4294967295,D=w+(E<<12&4294967295|E>>>20),E=T+(I^D&(w^I))+S[6]+2821735955&4294967295,T=D+(E<<17&4294967295|E>>>15),E=I+(w^T&(D^w))+S[7]+4249261313&4294967295,I=T+(E<<22&4294967295|E>>>10),E=w+(D^I&(T^D))+S[8]+1770035416&4294967295,w=I+(E<<7&4294967295|E>>>25),E=D+(T^w&(I^T))+S[9]+2336552879&4294967295,D=w+(E<<12&4294967295|E>>>20),E=T+(I^D&(w^I))+S[10]+4294925233&4294967295,T=D+(E<<17&4294967295|E>>>15),E=I+(w^T&(D^w))+S[11]+2304563134&4294967295,I=T+(E<<22&4294967295|E>>>10),E=w+(D^I&(T^D))+S[12]+1804603682&4294967295,w=I+(E<<7&4294967295|E>>>25),E=D+(T^w&(I^T))+S[13]+4254626195&4294967295,D=w+(E<<12&4294967295|E>>>20),E=T+(I^D&(w^I))+S[14]+2792965006&4294967295,T=D+(E<<17&4294967295|E>>>15),E=I+(w^T&(D^w))+S[15]+1236535329&4294967295,I=T+(E<<22&4294967295|E>>>10),E=w+(T^D&(I^T))+S[1]+4129170786&4294967295,w=I+(E<<5&4294967295|E>>>27),E=D+(I^T&(w^I))+S[6]+3225465664&4294967295,D=w+(E<<9&4294967295|E>>>23),E=T+(w^I&(D^w))+S[11]+643717713&4294967295,T=D+(E<<14&4294967295|E>>>18),E=I+(D^w&(T^D))+S[0]+3921069994&4294967295,I=T+(E<<20&4294967295|E>>>12),E=w+(T^D&(I^T))+S[5]+3593408605&4294967295,w=I+(E<<5&4294967295|E>>>27),E=D+(I^T&(w^I))+S[10]+38016083&4294967295,D=w+(E<<9&4294967295|E>>>23),E=T+(w^I&(D^w))+S[15]+3634488961&4294967295,T=D+(E<<14&4294967295|E>>>18),E=I+(D^w&(T^D))+S[4]+3889429448&4294967295,I=T+(E<<20&4294967295|E>>>12),E=w+(T^D&(I^T))+S[9]+568446438&4294967295,w=I+(E<<5&4294967295|E>>>27),E=D+(I^T&(w^I))+S[14]+3275163606&4294967295,D=w+(E<<9&4294967295|E>>>23),E=T+(w^I&(D^w))+S[3]+4107603335&4294967295,T=D+(E<<14&4294967295|E>>>18),E=I+(D^w&(T^D))+S[8]+1163531501&4294967295,I=T+(E<<20&4294967295|E>>>12),E=w+(T^D&(I^T))+S[13]+2850285829&4294967295,w=I+(E<<5&4294967295|E>>>27),E=D+(I^T&(w^I))+S[2]+4243563512&4294967295,D=w+(E<<9&4294967295|E>>>23),E=T+(w^I&(D^w))+S[7]+1735328473&4294967295,T=D+(E<<14&4294967295|E>>>18),E=I+(D^w&(T^D))+S[12]+2368359562&4294967295,I=T+(E<<20&4294967295|E>>>12),E=w+(I^T^D)+S[5]+4294588738&4294967295,w=I+(E<<4&4294967295|E>>>28),E=D+(w^I^T)+S[8]+2272392833&4294967295,D=w+(E<<11&4294967295|E>>>21),E=T+(D^w^I)+S[11]+1839030562&4294967295,T=D+(E<<16&4294967295|E>>>16),E=I+(T^D^w)+S[14]+4259657740&4294967295,I=T+(E<<23&4294967295|E>>>9),E=w+(I^T^D)+S[1]+2763975236&4294967295,w=I+(E<<4&4294967295|E>>>28),E=D+(w^I^T)+S[4]+1272893353&4294967295,D=w+(E<<11&4294967295|E>>>21),E=T+(D^w^I)+S[7]+4139469664&4294967295,T=D+(E<<16&4294967295|E>>>16),E=I+(T^D^w)+S[10]+3200236656&4294967295,I=T+(E<<23&4294967295|E>>>9),E=w+(I^T^D)+S[13]+681279174&4294967295,w=I+(E<<4&4294967295|E>>>28),E=D+(w^I^T)+S[0]+3936430074&4294967295,D=w+(E<<11&4294967295|E>>>21),E=T+(D^w^I)+S[3]+3572445317&4294967295,T=D+(E<<16&4294967295|E>>>16),E=I+(T^D^w)+S[6]+76029189&4294967295,I=T+(E<<23&4294967295|E>>>9),E=w+(I^T^D)+S[9]+3654602809&4294967295,w=I+(E<<4&4294967295|E>>>28),E=D+(w^I^T)+S[12]+3873151461&4294967295,D=w+(E<<11&4294967295|E>>>21),E=T+(D^w^I)+S[15]+530742520&4294967295,T=D+(E<<16&4294967295|E>>>16),E=I+(T^D^w)+S[2]+3299628645&4294967295,I=T+(E<<23&4294967295|E>>>9),E=w+(T^(I|~D))+S[0]+4096336452&4294967295,w=I+(E<<6&4294967295|E>>>26),E=D+(I^(w|~T))+S[7]+1126891415&4294967295,D=w+(E<<10&4294967295|E>>>22),E=T+(w^(D|~I))+S[14]+2878612391&4294967295,T=D+(E<<15&4294967295|E>>>17),E=I+(D^(T|~w))+S[5]+4237533241&4294967295,I=T+(E<<21&4294967295|E>>>11),E=w+(T^(I|~D))+S[12]+1700485571&4294967295,w=I+(E<<6&4294967295|E>>>26),E=D+(I^(w|~T))+S[3]+2399980690&4294967295,D=w+(E<<10&4294967295|E>>>22),E=T+(w^(D|~I))+S[10]+4293915773&4294967295,T=D+(E<<15&4294967295|E>>>17),E=I+(D^(T|~w))+S[1]+2240044497&4294967295,I=T+(E<<21&4294967295|E>>>11),E=w+(T^(I|~D))+S[8]+1873313359&4294967295,w=I+(E<<6&4294967295|E>>>26),E=D+(I^(w|~T))+S[15]+4264355552&4294967295,D=w+(E<<10&4294967295|E>>>22),E=T+(w^(D|~I))+S[6]+2734768916&4294967295,T=D+(E<<15&4294967295|E>>>17),E=I+(D^(T|~w))+S[13]+1309151649&4294967295,I=T+(E<<21&4294967295|E>>>11),E=w+(T^(I|~D))+S[4]+4149444226&4294967295,w=I+(E<<6&4294967295|E>>>26),E=D+(I^(w|~T))+S[11]+3174756917&4294967295,D=w+(E<<10&4294967295|E>>>22),E=T+(w^(D|~I))+S[2]+718787259&4294967295,T=D+(E<<15&4294967295|E>>>17),E=I+(D^(T|~w))+S[9]+3951481745&4294967295,x.g[0]=x.g[0]+w&4294967295,x.g[1]=x.g[1]+(T+(E<<21&4294967295|E>>>11))&4294967295,x.g[2]=x.g[2]+T&4294967295,x.g[3]=x.g[3]+D&4294967295}r.prototype.u=function(x,w){w===void 0&&(w=x.length);for(var I=w-this.blockSize,S=this.B,T=this.h,D=0;D<w;){if(T==0)for(;D<=I;)s(this,x,D),D+=this.blockSize;if(typeof x=="string"){for(;D<w;)if(S[T++]=x.charCodeAt(D++),T==this.blockSize){s(this,S),T=0;break}}else for(;D<w;)if(S[T++]=x[D++],T==this.blockSize){s(this,S),T=0;break}}this.h=T,this.o+=w},r.prototype.v=function(){var x=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);x[0]=128;for(var w=1;w<x.length-8;++w)x[w]=0;var I=8*this.o;for(w=x.length-8;w<x.length;++w)x[w]=I&255,I/=256;for(this.u(x),x=Array(16),w=I=0;4>w;++w)for(var S=0;32>S;S+=8)x[I++]=this.g[w]>>>S&255;return x};function i(x,w){var I=a;return Object.prototype.hasOwnProperty.call(I,x)?I[x]:I[x]=w(x)}function o(x,w){this.h=w;for(var I=[],S=!0,T=x.length-1;0<=T;T--){var D=x[T]|0;S&&D==w||(I[T]=D,S=!1)}this.g=I}var a={};function l(x){return-128<=x&&128>x?i(x,function(w){return new o([w|0],0>w?-1:0)}):new o([x|0],0>x?-1:0)}function u(x){if(isNaN(x)||!isFinite(x))return f;if(0>x)return R(u(-x));for(var w=[],I=1,S=0;x>=I;S++)w[S]=x/I|0,I*=4294967296;return new o(w,0)}function d(x,w){if(x.length==0)throw Error("number format error: empty string");if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(x.charAt(0)=="-")return R(d(x.substring(1),w));if(0<=x.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=u(Math.pow(w,8)),S=f,T=0;T<x.length;T+=8){var D=Math.min(8,x.length-T),E=parseInt(x.substring(T,T+D),w);8>D?(D=u(Math.pow(w,D)),S=S.j(D).add(u(E))):(S=S.j(I),S=S.add(u(E)))}return S}var f=l(0),g=l(1),_=l(16777216);n=o.prototype,n.m=function(){if(P(this))return-R(this).m();for(var x=0,w=1,I=0;I<this.g.length;I++){var S=this.i(I);x+=(0<=S?S:4294967296+S)*w,w*=4294967296}return x},n.toString=function(x){if(x=x||10,2>x||36<x)throw Error("radix out of range: "+x);if(k(this))return"0";if(P(this))return"-"+R(this).toString(x);for(var w=u(Math.pow(x,6)),I=this,S="";;){var T=j(I,w).g;I=L(I,T.j(w));var D=((0<I.g.length?I.g[0]:I.h)>>>0).toString(x);if(I=T,k(I))return D+S;for(;6>D.length;)D="0"+D;S=D+S}},n.i=function(x){return 0>x?0:x<this.g.length?this.g[x]:this.h};function k(x){if(x.h!=0)return!1;for(var w=0;w<x.g.length;w++)if(x.g[w]!=0)return!1;return!0}function P(x){return x.h==-1}n.l=function(x){return x=L(this,x),P(x)?-1:k(x)?0:1};function R(x){for(var w=x.g.length,I=[],S=0;S<w;S++)I[S]=~x.g[S];return new o(I,~x.h).add(g)}n.abs=function(){return P(this)?R(this):this},n.add=function(x){for(var w=Math.max(this.g.length,x.g.length),I=[],S=0,T=0;T<=w;T++){var D=S+(this.i(T)&65535)+(x.i(T)&65535),E=(D>>>16)+(this.i(T)>>>16)+(x.i(T)>>>16);S=E>>>16,D&=65535,E&=65535,I[T]=E<<16|D}return new o(I,I[I.length-1]&-2147483648?-1:0)};function L(x,w){return x.add(R(w))}n.j=function(x){if(k(this)||k(x))return f;if(P(this))return P(x)?R(this).j(R(x)):R(R(this).j(x));if(P(x))return R(this.j(R(x)));if(0>this.l(_)&&0>x.l(_))return u(this.m()*x.m());for(var w=this.g.length+x.g.length,I=[],S=0;S<2*w;S++)I[S]=0;for(S=0;S<this.g.length;S++)for(var T=0;T<x.g.length;T++){var D=this.i(S)>>>16,E=this.i(S)&65535,vt=x.i(T)>>>16,Ot=x.i(T)&65535;I[2*S+2*T]+=E*Ot,B(I,2*S+2*T),I[2*S+2*T+1]+=D*Ot,B(I,2*S+2*T+1),I[2*S+2*T+1]+=E*vt,B(I,2*S+2*T+1),I[2*S+2*T+2]+=D*vt,B(I,2*S+2*T+2)}for(S=0;S<w;S++)I[S]=I[2*S+1]<<16|I[2*S];for(S=w;S<2*w;S++)I[S]=0;return new o(I,0)};function B(x,w){for(;(x[w]&65535)!=x[w];)x[w+1]+=x[w]>>>16,x[w]&=65535,w++}function $(x,w){this.g=x,this.h=w}function j(x,w){if(k(w))throw Error("division by zero");if(k(x))return new $(f,f);if(P(x))return w=j(R(x),w),new $(R(w.g),R(w.h));if(P(w))return w=j(x,R(w)),new $(R(w.g),w.h);if(30<x.g.length){if(P(x)||P(w))throw Error("slowDivide_ only works with positive integers.");for(var I=g,S=w;0>=S.l(x);)I=O(I),S=O(S);var T=ie(I,1),D=ie(S,1);for(S=ie(S,2),I=ie(I,2);!k(S);){var E=D.add(S);0>=E.l(x)&&(T=T.add(I),D=E),S=ie(S,1),I=ie(I,1)}return w=L(x,T.j(w)),new $(T,w)}for(T=f;0<=x.l(w);){for(I=Math.max(1,Math.floor(x.m()/w.m())),S=Math.ceil(Math.log(I)/Math.LN2),S=48>=S?1:Math.pow(2,S-48),D=u(I),E=D.j(w);P(E)||0<E.l(x);)I-=S,D=u(I),E=D.j(w);k(D)&&(D=g),T=T.add(D),x=L(x,E)}return new $(T,x)}n.A=function(x){return j(this,x).h},n.and=function(x){for(var w=Math.max(this.g.length,x.g.length),I=[],S=0;S<w;S++)I[S]=this.i(S)&x.i(S);return new o(I,this.h&x.h)},n.or=function(x){for(var w=Math.max(this.g.length,x.g.length),I=[],S=0;S<w;S++)I[S]=this.i(S)|x.i(S);return new o(I,this.h|x.h)},n.xor=function(x){for(var w=Math.max(this.g.length,x.g.length),I=[],S=0;S<w;S++)I[S]=this.i(S)^x.i(S);return new o(I,this.h^x.h)};function O(x){for(var w=x.g.length+1,I=[],S=0;S<w;S++)I[S]=x.i(S)<<1|x.i(S-1)>>>31;return new o(I,x.h)}function ie(x,w){var I=w>>5;w%=32;for(var S=x.g.length-I,T=[],D=0;D<S;D++)T[D]=0<w?x.i(D+I)>>>w|x.i(D+I+1)<<32-w:x.i(D+I);return new o(T,x.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Tv=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=d,ui=o}).apply(typeof lg<"u"?lg:typeof self<"u"?self:typeof window<"u"?window:{});var gc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Av,Ra,xv,Cc,Eh,Pv,Sv,Rv;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,h,p){return c==Array.prototype||c==Object.prototype||(c[h]=p.value),c};function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof gc=="object"&&gc];for(var h=0;h<c.length;++h){var p=c[h];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var r=t(this);function s(c,h){if(h)e:{var p=r;c=c.split(".");for(var y=0;y<c.length-1;y++){var V=c[y];if(!(V in p))break e;p=p[V]}c=c[c.length-1],y=p[c],h=h(y),h!=y&&h!=null&&e(p,c,{configurable:!0,writable:!0,value:h})}}function i(c,h){c instanceof String&&(c+="");var p=0,y=!1,V={next:function(){if(!y&&p<c.length){var U=p++;return{value:h(U,c[U]),done:!1}}return y=!0,{done:!0,value:void 0}}};return V[Symbol.iterator]=function(){return V},V}s("Array.prototype.values",function(c){return c||function(){return i(this,function(h,p){return p})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(c){var h=typeof c;return h=h!="object"?h:c?Array.isArray(c)?"array":h:"null",h=="array"||h=="object"&&typeof c.length=="number"}function u(c){var h=typeof c;return h=="object"&&c!=null||h=="function"}function d(c,h,p){return c.call.apply(c.bind,arguments)}function f(c,h,p){if(!c)throw Error();if(2<arguments.length){var y=Array.prototype.slice.call(arguments,2);return function(){var V=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(V,y),c.apply(h,V)}}return function(){return c.apply(h,arguments)}}function g(c,h,p){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,g.apply(null,arguments)}function _(c,h){var p=Array.prototype.slice.call(arguments,1);return function(){var y=p.slice();return y.push.apply(y,arguments),c.apply(this,y)}}function k(c,h){function p(){}p.prototype=h.prototype,c.aa=h.prototype,c.prototype=new p,c.prototype.constructor=c,c.Qb=function(y,V,U){for(var ce=Array(arguments.length-2),at=2;at<arguments.length;at++)ce[at-2]=arguments[at];return h.prototype[V].apply(y,ce)}}function P(c){const h=c.length;if(0<h){const p=Array(h);for(let y=0;y<h;y++)p[y]=c[y];return p}return[]}function R(c,h){for(let p=1;p<arguments.length;p++){const y=arguments[p];if(l(y)){const V=c.length||0,U=y.length||0;c.length=V+U;for(let ce=0;ce<U;ce++)c[V+ce]=y[ce]}else c.push(y)}}class L{constructor(h,p){this.i=h,this.j=p,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function B(c){return/^[\s\xa0]*$/.test(c)}function $(){var c=a.navigator;return c&&(c=c.userAgent)?c:""}function j(c){return j[" "](c),c}j[" "]=function(){};var O=$().indexOf("Gecko")!=-1&&!($().toLowerCase().indexOf("webkit")!=-1&&$().indexOf("Edge")==-1)&&!($().indexOf("Trident")!=-1||$().indexOf("MSIE")!=-1)&&$().indexOf("Edge")==-1;function ie(c,h,p){for(const y in c)h.call(p,c[y],y,c)}function x(c,h){for(const p in c)h.call(void 0,c[p],p,c)}function w(c){const h={};for(const p in c)h[p]=c[p];return h}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function S(c,h){let p,y;for(let V=1;V<arguments.length;V++){y=arguments[V];for(p in y)c[p]=y[p];for(let U=0;U<I.length;U++)p=I[U],Object.prototype.hasOwnProperty.call(y,p)&&(c[p]=y[p])}}function T(c){var h=1;c=c.split(":");const p=[];for(;0<h&&c.length;)p.push(c.shift()),h--;return c.length&&p.push(c.join(":")),p}function D(c){a.setTimeout(()=>{throw c},0)}function E(){var c=$t;let h=null;return c.g&&(h=c.g,c.g=c.g.next,c.g||(c.h=null),h.next=null),h}class vt{constructor(){this.h=this.g=null}add(h,p){const y=Ot.get();y.set(h,p),this.h?this.h.next=y:this.g=y,this.h=y}}var Ot=new L(()=>new He,c=>c.reset());class He{constructor(){this.next=this.g=this.h=null}set(h,p){this.h=h,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let Ne,Se=!1,$t=new vt,Ln=()=>{const c=a.Promise.resolve(void 0);Ne=()=>{c.then(rn)}};var rn=()=>{for(var c;c=E();){try{c.h.call(c.g)}catch(p){D(p)}var h=Ot;h.j(c),100>h.h&&(h.h++,c.next=h.g,h.g=c)}Se=!1};function et(){this.s=this.s,this.C=this.C}et.prototype.s=!1,et.prototype.ma=function(){this.s||(this.s=!0,this.N())},et.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function rt(c,h){this.type=c,this.g=this.target=h,this.defaultPrevented=!1}rt.prototype.h=function(){this.defaultPrevented=!0};var Fn=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var c=!1,h=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const p=()=>{};a.addEventListener("test",p,h),a.removeEventListener("test",p,h)}catch{}return c}();function In(c,h){if(rt.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var p=this.type=c.type,y=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=h,h=c.relatedTarget){if(O){e:{try{j(h.nodeName);var V=!0;break e}catch{}V=!1}V||(h=null)}}else p=="mouseover"?h=c.fromElement:p=="mouseout"&&(h=c.toElement);this.relatedTarget=h,y?(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:jt[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&In.aa.h.call(this)}}k(In,rt);var jt={2:"touch",3:"pen",4:"mouse"};In.prototype.h=function(){In.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var G="closure_listenable_"+(1e6*Math.random()|0),fe=0;function le(c,h,p,y,V){this.listener=c,this.proxy=null,this.src=h,this.type=p,this.capture=!!y,this.ha=V,this.key=++fe,this.da=this.fa=!1}function oe(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function Re(c){this.src=c,this.g={},this.h=0}Re.prototype.add=function(c,h,p,y,V){var U=c.toString();c=this.g[U],c||(c=this.g[U]=[],this.h++);var ce=b(c,h,y,V);return-1<ce?(h=c[ce],p||(h.fa=!1)):(h=new le(h,this.src,U,!!y,V),h.fa=p,c.push(h)),h};function $e(c,h){var p=h.type;if(p in c.g){var y=c.g[p],V=Array.prototype.indexOf.call(y,h,void 0),U;(U=0<=V)&&Array.prototype.splice.call(y,V,1),U&&(oe(h),c.g[p].length==0&&(delete c.g[p],c.h--))}}function b(c,h,p,y){for(var V=0;V<c.length;++V){var U=c[V];if(!U.da&&U.listener==h&&U.capture==!!p&&U.ha==y)return V}return-1}var A="closure_lm_"+(1e6*Math.random()|0),M={};function X(c,h,p,y,V){if(y&&y.once)return ue(c,h,p,y,V);if(Array.isArray(h)){for(var U=0;U<h.length;U++)X(c,h[U],p,y,V);return null}return p=Ae(p),c&&c[G]?c.K(h,p,u(y)?!!y.capture:!!y,V):z(c,h,p,!1,y,V)}function z(c,h,p,y,V,U){if(!h)throw Error("Invalid event type");var ce=u(V)?!!V.capture:!!V,at=Q(c);if(at||(c[A]=at=new Re(c)),p=at.add(h,p,y,ce,U),p.proxy)return p;if(y=Z(),p.proxy=y,y.src=c,y.listener=p,c.addEventListener)Fn||(V=ce),V===void 0&&(V=!1),c.addEventListener(h.toString(),y,V);else if(c.attachEvent)c.attachEvent(ee(h.toString()),y);else if(c.addListener&&c.removeListener)c.addListener(y);else throw Error("addEventListener and attachEvent are unavailable.");return p}function Z(){function c(p){return h.call(c.src,c.listener,p)}const h=ve;return c}function ue(c,h,p,y,V){if(Array.isArray(h)){for(var U=0;U<h.length;U++)ue(c,h[U],p,y,V);return null}return p=Ae(p),c&&c[G]?c.L(h,p,u(y)?!!y.capture:!!y,V):z(c,h,p,!0,y,V)}function ne(c,h,p,y,V){if(Array.isArray(h))for(var U=0;U<h.length;U++)ne(c,h[U],p,y,V);else y=u(y)?!!y.capture:!!y,p=Ae(p),c&&c[G]?(c=c.i,h=String(h).toString(),h in c.g&&(U=c.g[h],p=b(U,p,y,V),-1<p&&(oe(U[p]),Array.prototype.splice.call(U,p,1),U.length==0&&(delete c.g[h],c.h--)))):c&&(c=Q(c))&&(h=c.g[h.toString()],c=-1,h&&(c=b(h,p,y,V)),(p=-1<c?h[c]:null)&&re(p))}function re(c){if(typeof c!="number"&&c&&!c.da){var h=c.src;if(h&&h[G])$e(h.i,c);else{var p=c.type,y=c.proxy;h.removeEventListener?h.removeEventListener(p,y,c.capture):h.detachEvent?h.detachEvent(ee(p),y):h.addListener&&h.removeListener&&h.removeListener(y),(p=Q(h))?($e(p,c),p.h==0&&(p.src=null,h[A]=null)):oe(c)}}}function ee(c){return c in M?M[c]:M[c]="on"+c}function ve(c,h){if(c.da)c=!0;else{h=new In(h,this);var p=c.listener,y=c.ha||c.src;c.fa&&re(c),c=p.call(y,h)}return c}function Q(c){return c=c[A],c instanceof Re?c:null}var de="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ae(c){return typeof c=="function"?c:(c[de]||(c[de]=function(h){return c.handleEvent(h)}),c[de])}function Te(){et.call(this),this.i=new Re(this),this.M=this,this.F=null}k(Te,et),Te.prototype[G]=!0,Te.prototype.removeEventListener=function(c,h,p,y){ne(this,c,h,p,y)};function Ce(c,h){var p,y=c.F;if(y)for(p=[];y;y=y.F)p.push(y);if(c=c.M,y=h.type||h,typeof h=="string")h=new rt(h,c);else if(h instanceof rt)h.target=h.target||c;else{var V=h;h=new rt(y,c),S(h,V)}if(V=!0,p)for(var U=p.length-1;0<=U;U--){var ce=h.g=p[U];V=Le(ce,y,!0,h)&&V}if(ce=h.g=c,V=Le(ce,y,!0,h)&&V,V=Le(ce,y,!1,h)&&V,p)for(U=0;U<p.length;U++)ce=h.g=p[U],V=Le(ce,y,!1,h)&&V}Te.prototype.N=function(){if(Te.aa.N.call(this),this.i){var c=this.i,h;for(h in c.g){for(var p=c.g[h],y=0;y<p.length;y++)oe(p[y]);delete c.g[h],c.h--}}this.F=null},Te.prototype.K=function(c,h,p,y){return this.i.add(String(c),h,!1,p,y)},Te.prototype.L=function(c,h,p,y){return this.i.add(String(c),h,!0,p,y)};function Le(c,h,p,y){if(h=c.i.g[String(h)],!h)return!0;h=h.concat();for(var V=!0,U=0;U<h.length;++U){var ce=h[U];if(ce&&!ce.da&&ce.capture==p){var at=ce.listener,an=ce.ha||ce.src;ce.fa&&$e(c.i,ce),V=at.call(an,y)!==!1&&V}}return V&&!y.defaultPrevented}function Kt(c,h,p){if(typeof c=="function")p&&(c=g(c,p));else if(c&&typeof c.handleEvent=="function")c=g(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(c,h||0)}function pt(c){c.g=Kt(()=>{c.g=null,c.i&&(c.i=!1,pt(c))},c.l);const h=c.h;c.h=null,c.m.apply(null,h)}class Jt extends et{constructor(h,p){super(),this.m=h,this.l=p,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:pt(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ut(c){et.call(this),this.h=c,this.g={}}k(ut,et);var En=[];function Xn(c){ie(c.g,function(h,p){this.g.hasOwnProperty(p)&&re(h)},c),c.g={}}ut.prototype.N=function(){ut.aa.N.call(this),Xn(this)},ut.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Tt=a.JSON.stringify,Rn=a.JSON.parse,Vi=class{stringify(c){return a.JSON.stringify(c,void 0)}parse(c){return a.JSON.parse(c,void 0)}};function Xo(){}Xo.prototype.h=null;function Ql(c){return c.h||(c.h=c.i())}function dt(){}var tt={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function At(){rt.call(this,"d")}k(At,rt);function ot(){rt.call(this,"c")}k(ot,rt);var wr={},Zo=null;function Ni(){return Zo=Zo||new Te}wr.La="serverreachability";function Oi(c){rt.call(this,wr.La,c)}k(Oi,rt);function sn(c){const h=Ni();Ce(h,new Oi(h))}wr.STAT_EVENT="statevent";function ea(c,h){rt.call(this,wr.STAT_EVENT,c),this.stat=h}k(ea,rt);function on(c){const h=Ni();Ce(h,new ea(h,c))}wr.Ma="timingevent";function ta(c,h){rt.call(this,wr.Ma,c),this.size=h}k(ta,rt);function zs(c,h){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){c()},h)}function br(){this.g=!0}br.prototype.xa=function(){this.g=!1};function ts(c,h,p,y,V,U){c.info(function(){if(c.g)if(U)for(var ce="",at=U.split("&"),an=0;an<at.length;an++){var Qe=at[an].split("=");if(1<Qe.length){var hn=Qe[0];Qe=Qe[1];var fn=hn.split("_");ce=2<=fn.length&&fn[1]=="type"?ce+(hn+"="+Qe+"&"):ce+(hn+"=redacted&")}}else ce=null;else ce=U;return"XMLHTTP REQ ("+y+") [attempt "+V+"]: "+h+`
`+p+`
`+ce})}function na(c,h,p,y,V,U,ce){c.info(function(){return"XMLHTTP RESP ("+y+") [ attempt "+V+"]: "+h+`
`+p+`
`+U+" "+ce})}function Zn(c,h,p,y){c.info(function(){return"XMLHTTP TEXT ("+h+"): "+pd(c,p)+(y?" "+y:"")})}function Jl(c,h){c.info(function(){return"TIMEOUT: "+h})}br.prototype.info=function(){};function pd(c,h){if(!c.g)return h;if(!h)return null;try{var p=JSON.parse(h);if(p){for(c=0;c<p.length;c++)if(Array.isArray(p[c])){var y=p[c];if(!(2>y.length)){var V=y[1];if(Array.isArray(V)&&!(1>V.length)){var U=V[0];if(U!="noop"&&U!="stop"&&U!="close")for(var ce=1;ce<V.length;ce++)V[ce]=""}}}}return Tt(p)}catch{return h}}var Mi={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ra={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Li;function Ir(){}k(Ir,Xo),Ir.prototype.g=function(){return new XMLHttpRequest},Ir.prototype.i=function(){return{}},Li=new Ir;function Un(c,h,p,y){this.j=c,this.i=h,this.l=p,this.R=y||1,this.U=new ut(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Gs}function Gs(){this.i=null,this.g="",this.h=!1}var Yl={},sa={};function ia(c,h,p){c.L=1,c.v=rs(tr(h)),c.m=p,c.P=!0,Xl(c,null)}function Xl(c,h){c.F=Date.now(),Er(c),c.A=tr(c.v);var p=c.A,y=c.R;Array.isArray(y)||(y=[String(y)]),ke(p.i,"t",y),c.C=0,p=c.j.J,c.h=new Gs,c.g=nm(c.j,p?h:null,!c.m),0<c.O&&(c.M=new Jt(g(c.Y,c,c.g),c.O)),h=c.U,p=c.g,y=c.ca;var V="readystatechange";Array.isArray(V)||(V&&(En[0]=V.toString()),V=En);for(var U=0;U<V.length;U++){var ce=X(p,V[U],y||h.handleEvent,!1,h.h||h);if(!ce)break;h.g[ce.key]=ce}h=c.H?w(c.H):{},c.m?(c.u||(c.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,h)):(c.u="GET",c.g.ea(c.A,c.u,null,h)),sn(),ts(c.i,c.u,c.A,c.l,c.R,c.m)}Un.prototype.ca=function(c){c=c.target;const h=this.M;h&&xr(c)==3?h.j():this.Y(c)},Un.prototype.Y=function(c){try{if(c==this.g)e:{const fn=xr(this.g);var h=this.g.Ba();const zi=this.g.Z();if(!(3>fn)&&(fn!=3||this.g&&(this.h.h||this.g.oa()||Gp(this.g)))){this.J||fn!=4||h==7||(h==8||0>=zi?sn(3):sn(2)),oa(this);var p=this.g.Z();this.X=p;t:if(Zl(this)){var y=Gp(this.g);c="";var V=y.length,U=xr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Tr(this),Ks(this);var ce="";break t}this.h.i=new a.TextDecoder}for(h=0;h<V;h++)this.h.h=!0,c+=this.h.i.decode(y[h],{stream:!(U&&h==V-1)});y.length=0,this.h.g+=c,this.C=0,ce=this.h.g}else ce=this.g.oa();if(this.o=p==200,na(this.i,this.u,this.A,this.l,this.R,fn,p),this.o){if(this.T&&!this.K){t:{if(this.g){var at,an=this.g;if((at=an.g?an.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(at)){var Qe=at;break t}}Qe=null}if(p=Qe)Zn(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Fi(this,p);else{this.o=!1,this.s=3,on(12),Tr(this),Ks(this);break e}}if(this.P){p=!0;let nr;for(;!this.J&&this.C<ce.length;)if(nr=md(this,ce),nr==sa){fn==4&&(this.s=4,on(14),p=!1),Zn(this.i,this.l,null,"[Incomplete Response]");break}else if(nr==Yl){this.s=4,on(15),Zn(this.i,this.l,ce,"[Invalid Chunk]"),p=!1;break}else Zn(this.i,this.l,nr,null),Fi(this,nr);if(Zl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),fn!=4||ce.length!=0||this.h.h||(this.s=1,on(16),p=!1),this.o=this.o&&p,!p)Zn(this.i,this.l,ce,"[Invalid Chunked Response]"),Tr(this),Ks(this);else if(0<ce.length&&!this.W){this.W=!0;var hn=this.j;hn.g==this&&hn.ba&&!hn.M&&(hn.j.info("Great, no buffering proxy detected. Bytes received: "+ce.length),Ed(hn),hn.M=!0,on(11))}}else Zn(this.i,this.l,ce,null),Fi(this,ce);fn==4&&Tr(this),this.o&&!this.J&&(fn==4?Xp(this.j,this):(this.o=!1,Er(this)))}else zb(this.g),p==400&&0<ce.indexOf("Unknown SID")?(this.s=3,on(12)):(this.s=0,on(13)),Tr(this),Ks(this)}}}catch{}finally{}};function Zl(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function md(c,h){var p=c.C,y=h.indexOf(`
`,p);return y==-1?sa:(p=Number(h.substring(p,y)),isNaN(p)?Yl:(y+=1,y+p>h.length?sa:(h=h.slice(y,y+p),c.C=y+p,h)))}Un.prototype.cancel=function(){this.J=!0,Tr(this)};function Er(c){c.S=Date.now()+c.I,ec(c,c.I)}function ec(c,h){if(c.B!=null)throw Error("WatchDog timer not null");c.B=zs(g(c.ba,c),h)}function oa(c){c.B&&(a.clearTimeout(c.B),c.B=null)}Un.prototype.ba=function(){this.B=null;const c=Date.now();0<=c-this.S?(Jl(this.i,this.A),this.L!=2&&(sn(),on(17)),Tr(this),this.s=2,Ks(this)):ec(this,this.S-c)};function Ks(c){c.j.G==0||c.J||Xp(c.j,c)}function Tr(c){oa(c);var h=c.M;h&&typeof h.ma=="function"&&h.ma(),c.M=null,Xn(c.U),c.g&&(h=c.g,c.g=null,h.abort(),h.ma())}function Fi(c,h){try{var p=c.j;if(p.G!=0&&(p.g==c||la(p.h,c))){if(!c.K&&la(p.h,c)&&p.G==3){try{var y=p.Da.g.parse(h)}catch{y=null}if(Array.isArray(y)&&y.length==3){var V=y;if(V[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<c.F)uc(p),lc(p);else break e;Id(p),on(18)}}else p.za=V[1],0<p.za-p.T&&37500>V[2]&&p.F&&p.v==0&&!p.C&&(p.C=zs(g(p.Za,p),6e3));if(1>=nc(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else Qs(p,11)}else if((c.K||p.g==c)&&uc(p),!B(h))for(V=p.Da.g.parse(h),h=0;h<V.length;h++){let Qe=V[h];if(p.T=Qe[0],Qe=Qe[1],p.G==2)if(Qe[0]=="c"){p.K=Qe[1],p.ia=Qe[2];const hn=Qe[3];hn!=null&&(p.la=hn,p.j.info("VER="+p.la));const fn=Qe[4];fn!=null&&(p.Aa=fn,p.j.info("SVER="+p.Aa));const zi=Qe[5];zi!=null&&typeof zi=="number"&&0<zi&&(y=1.5*zi,p.L=y,p.j.info("backChannelRequestTimeoutMs_="+y)),y=p;const nr=c.g;if(nr){const hc=nr.g?nr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(hc){var U=y.h;U.g||hc.indexOf("spdy")==-1&&hc.indexOf("quic")==-1&&hc.indexOf("h2")==-1||(U.j=U.l,U.g=new Set,U.h&&(ca(U,U.h),U.h=null))}if(y.D){const Td=nr.g?nr.g.getResponseHeader("X-HTTP-Session-Id"):null;Td&&(y.ya=Td,st(y.I,y.D,Td))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-c.F,p.j.info("Handshake RTT: "+p.R+"ms")),y=p;var ce=c;if(y.qa=tm(y,y.J?y.ia:null,y.W),ce.K){er(y.h,ce);var at=ce,an=y.L;an&&(at.I=an),at.B&&(oa(at),Er(at)),y.g=ce}else Jp(y);0<p.i.length&&cc(p)}else Qe[0]!="stop"&&Qe[0]!="close"||Qs(p,7);else p.G==3&&(Qe[0]=="stop"||Qe[0]=="close"?Qe[0]=="stop"?Qs(p,7):bd(p):Qe[0]!="noop"&&p.l&&p.l.ta(Qe),p.v=0)}}sn(4)}catch{}}var gd=class{constructor(c,h){this.g=c,this.map=h}};function aa(c){this.l=c||10,a.PerformanceNavigationTiming?(c=a.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function tc(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function nc(c){return c.h?1:c.g?c.g.size:0}function la(c,h){return c.h?c.h==h:c.g?c.g.has(h):!1}function ca(c,h){c.g?c.g.add(h):c.h=h}function er(c,h){c.h&&c.h==h?c.h=null:c.g&&c.g.has(h)&&c.g.delete(h)}aa.prototype.cancel=function(){if(this.i=rc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function rc(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let h=c.i;for(const p of c.g.values())h=h.concat(p.D);return h}return P(c.i)}function _d(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(l(c)){for(var h=[],p=c.length,y=0;y<p;y++)h.push(c[y]);return h}h=[],p=0;for(y in c)h[p++]=c[y];return h}function Ui(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(l(c)||typeof c=="string"){var h=[];c=c.length;for(var p=0;p<c;p++)h.push(p);return h}h=[],p=0;for(const y in c)h[p++]=y;return h}}}function ua(c,h){if(c.forEach&&typeof c.forEach=="function")c.forEach(h,void 0);else if(l(c)||typeof c=="string")Array.prototype.forEach.call(c,h,void 0);else for(var p=Ui(c),y=_d(c),V=y.length,U=0;U<V;U++)h.call(void 0,y[U],p&&p[U],c)}var sc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ic(c,h){if(c){c=c.split("&");for(var p=0;p<c.length;p++){var y=c[p].indexOf("="),V=null;if(0<=y){var U=c[p].substring(0,y);V=c[p].substring(y+1)}else U=c[p];h(U,V?decodeURIComponent(V.replace(/\+/g," ")):"")}}}function Ar(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof Ar){this.h=c.h,Bi(this,c.j),this.o=c.o,this.g=c.g,ns(this,c.s),this.l=c.l;var h=c.i,p=new K;p.i=h.i,h.g&&(p.g=new Map(h.g),p.h=h.h),oc(this,p),this.m=c.m}else c&&(h=String(c).match(sc))?(this.h=!1,Bi(this,h[1]||"",!0),this.o=ss(h[2]||""),this.g=ss(h[3]||"",!0),ns(this,h[4]),this.l=ss(h[5]||"",!0),oc(this,h[6]||"",!0),this.m=ss(h[7]||"")):(this.h=!1,this.i=new K(null,this.h))}Ar.prototype.toString=function(){var c=[],h=this.j;h&&c.push(Hs(h,da,!0),":");var p=this.g;return(p||h=="file")&&(c.push("//"),(h=this.o)&&c.push(Hs(h,da,!0),"@"),c.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&c.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&c.push("/"),c.push(Hs(p,p.charAt(0)=="/"?vd:yd,!0))),(p=this.i.toString())&&c.push("?",p),(p=this.m)&&c.push("#",Hs(p,v)),c.join("")};function tr(c){return new Ar(c)}function Bi(c,h,p){c.j=p?ss(h,!0):h,c.j&&(c.j=c.j.replace(/:$/,""))}function ns(c,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);c.s=h}else c.s=null}function oc(c,h,p){h instanceof K?(c.i=h,Ge(c.i,c.h)):(p||(h=Hs(h,C)),c.i=new K(h,c.h))}function st(c,h,p){c.i.set(h,p)}function rs(c){return st(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function ss(c,h){return c?h?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function Hs(c,h,p){return typeof c=="string"?(c=encodeURI(c).replace(h,$i),p&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function $i(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var da=/[#\/\?@]/g,yd=/[#\?:]/g,vd=/[#\?]/g,C=/[#\?@]/g,v=/#/g;function K(c,h){this.h=this.g=null,this.i=c||null,this.j=!!h}function pe(c){c.g||(c.g=new Map,c.h=0,c.i&&ic(c.i,function(h,p){c.add(decodeURIComponent(h.replace(/\+/g," ")),p)}))}n=K.prototype,n.add=function(c,h){pe(this),this.i=null,c=Fe(this,c);var p=this.g.get(c);return p||this.g.set(c,p=[]),p.push(h),this.h+=1,this};function Ie(c,h){pe(c),h=Fe(c,h),c.g.has(h)&&(c.i=null,c.h-=c.g.get(h).length,c.g.delete(h))}function Me(c,h){return pe(c),h=Fe(c,h),c.g.has(h)}n.forEach=function(c,h){pe(this),this.g.forEach(function(p,y){p.forEach(function(V){c.call(h,V,y,this)},this)},this)},n.na=function(){pe(this);const c=Array.from(this.g.values()),h=Array.from(this.g.keys()),p=[];for(let y=0;y<h.length;y++){const V=c[y];for(let U=0;U<V.length;U++)p.push(h[y])}return p},n.V=function(c){pe(this);let h=[];if(typeof c=="string")Me(this,c)&&(h=h.concat(this.g.get(Fe(this,c))));else{c=Array.from(this.g.values());for(let p=0;p<c.length;p++)h=h.concat(c[p])}return h},n.set=function(c,h){return pe(this),this.i=null,c=Fe(this,c),Me(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[h]),this.h+=1,this},n.get=function(c,h){return c?(c=this.V(c),0<c.length?String(c[0]):h):h};function ke(c,h,p){Ie(c,h),0<p.length&&(c.i=null,c.g.set(Fe(c,h),P(p)),c.h+=p.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],h=Array.from(this.g.keys());for(var p=0;p<h.length;p++){var y=h[p];const U=encodeURIComponent(String(y)),ce=this.V(y);for(y=0;y<ce.length;y++){var V=U;ce[y]!==""&&(V+="="+encodeURIComponent(String(ce[y]))),c.push(V)}}return this.i=c.join("&")};function Fe(c,h){return h=String(h),c.j&&(h=h.toLowerCase()),h}function Ge(c,h){h&&!c.j&&(pe(c),c.i=null,c.g.forEach(function(p,y){var V=y.toLowerCase();y!=V&&(Ie(this,y),ke(this,V,p))},c)),c.j=h}function Ht(c,h){const p=new br;if(a.Image){const y=new Image;y.onload=_(We,p,"TestLoadImage: loaded",!0,h,y),y.onerror=_(We,p,"TestLoadImage: error",!1,h,y),y.onabort=_(We,p,"TestLoadImage: abort",!1,h,y),y.ontimeout=_(We,p,"TestLoadImage: timeout",!1,h,y),a.setTimeout(function(){y.ontimeout&&y.ontimeout()},1e4),y.src=c}else h(!1)}function xt(c,h){const p=new br,y=new AbortController,V=setTimeout(()=>{y.abort(),We(p,"TestPingServer: timeout",!1,h)},1e4);fetch(c,{signal:y.signal}).then(U=>{clearTimeout(V),U.ok?We(p,"TestPingServer: ok",!0,h):We(p,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(V),We(p,"TestPingServer: error",!1,h)})}function We(c,h,p,y,V){try{V&&(V.onload=null,V.onerror=null,V.onabort=null,V.ontimeout=null),y(p)}catch{}}function te(){this.g=new Vi}function Ue(c,h,p){const y=p||"";try{ua(c,function(V,U){let ce=V;u(V)&&(ce=Tt(V)),h.push(y+U+"="+encodeURIComponent(ce))})}catch(V){throw h.push(y+"type="+encodeURIComponent("_badmap")),V}}function Cn(c){this.l=c.Ub||null,this.j=c.eb||!1}k(Cn,Xo),Cn.prototype.g=function(){return new is(this.l,this.j)},Cn.prototype.i=function(c){return function(){return c}}({});function is(c,h){Te.call(this),this.D=c,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(is,Te),n=is.prototype,n.open=function(c,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=h,this.readyState=1,ha(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(h.body=c),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ws(this)),this.readyState=0},n.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,ha(this)),this.g&&(this.readyState=3,ha(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;ji(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function ji(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}n.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var h=c.value?c.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!c.done}))&&(this.response=this.responseText+=h)}c.done?Ws(this):ha(this),this.readyState==3&&ji(this)}},n.Ra=function(c){this.g&&(this.response=this.responseText=c,Ws(this))},n.Qa=function(c){this.g&&(this.response=c,Ws(this))},n.ga=function(){this.g&&Ws(this)};function Ws(c){c.readyState=4,c.l=null,c.j=null,c.v=null,ha(c)}n.setRequestHeader=function(c,h){this.u.append(c,h)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],h=this.h.entries();for(var p=h.next();!p.done;)p=p.value,c.push(p[0]+": "+p[1]),p=h.next();return c.join(`\r
`)};function ha(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(is.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function Bp(c){let h="";return ie(c,function(p,y){h+=y,h+=":",h+=p,h+=`\r
`}),h}function wd(c,h,p){e:{for(y in p){var y=!1;break e}y=!0}y||(p=Bp(p),typeof c=="string"?p!=null&&encodeURIComponent(String(p)):st(c,h,p))}function kt(c){Te.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(kt,Te);var jb=/^https?$/i,qb=["POST","PUT"];n=kt.prototype,n.Ha=function(c){this.J=c},n.ea=function(c,h,p,y){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);h=h?h.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Li.g(),this.v=this.o?Ql(this.o):Ql(Li),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(h,String(c),!0),this.B=!1}catch(U){$p(this,U);return}if(c=p||"",p=new Map(this.headers),y)if(Object.getPrototypeOf(y)===Object.prototype)for(var V in y)p.set(V,y[V]);else if(typeof y.keys=="function"&&typeof y.get=="function")for(const U of y.keys())p.set(U,y.get(U));else throw Error("Unknown input type for opt_headers: "+String(y));y=Array.from(p.keys()).find(U=>U.toLowerCase()=="content-type"),V=a.FormData&&c instanceof a.FormData,!(0<=Array.prototype.indexOf.call(qb,h,void 0))||y||V||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[U,ce]of p)this.g.setRequestHeader(U,ce);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{zp(this),this.u=!0,this.g.send(c),this.u=!1}catch(U){$p(this,U)}};function $p(c,h){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=h,c.m=5,jp(c),ac(c)}function jp(c){c.A||(c.A=!0,Ce(c,"complete"),Ce(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,Ce(this,"complete"),Ce(this,"abort"),ac(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ac(this,!0)),kt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?qp(this):this.bb())},n.bb=function(){qp(this)};function qp(c){if(c.h&&typeof o<"u"&&(!c.v[1]||xr(c)!=4||c.Z()!=2)){if(c.u&&xr(c)==4)Kt(c.Ea,0,c);else if(Ce(c,"readystatechange"),xr(c)==4){c.h=!1;try{const ce=c.Z();e:switch(ce){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var p;if(!(p=h)){var y;if(y=ce===0){var V=String(c.D).match(sc)[1]||null;!V&&a.self&&a.self.location&&(V=a.self.location.protocol.slice(0,-1)),y=!jb.test(V?V.toLowerCase():"")}p=y}if(p)Ce(c,"complete"),Ce(c,"success");else{c.m=6;try{var U=2<xr(c)?c.g.statusText:""}catch{U=""}c.l=U+" ["+c.Z()+"]",jp(c)}}finally{ac(c)}}}}function ac(c,h){if(c.g){zp(c);const p=c.g,y=c.v[0]?()=>{}:null;c.g=null,c.v=null,h||Ce(c,"ready");try{p.onreadystatechange=y}catch{}}}function zp(c){c.I&&(a.clearTimeout(c.I),c.I=null)}n.isActive=function(){return!!this.g};function xr(c){return c.g?c.g.readyState:0}n.Z=function(){try{return 2<xr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(c){if(this.g){var h=this.g.responseText;return c&&h.indexOf(c)==0&&(h=h.substring(c.length)),Rn(h)}};function Gp(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function zb(c){const h={};c=(c.g&&2<=xr(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let y=0;y<c.length;y++){if(B(c[y]))continue;var p=T(c[y]);const V=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();const U=h[V]||[];h[V]=U,U.push(p)}x(h,function(y){return y.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function fa(c,h,p){return p&&p.internalChannelParams&&p.internalChannelParams[c]||h}function Kp(c){this.Aa=0,this.i=[],this.j=new br,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=fa("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=fa("baseRetryDelayMs",5e3,c),this.cb=fa("retryDelaySeedMs",1e4,c),this.Wa=fa("forwardChannelMaxRetries",2,c),this.wa=fa("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new aa(c&&c.concurrentRequestLimit),this.Da=new te,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Kp.prototype,n.la=8,n.G=1,n.connect=function(c,h,p,y){on(0),this.W=c,this.H=h||{},p&&y!==void 0&&(this.H.OSID=p,this.H.OAID=y),this.F=this.X,this.I=tm(this,null,this.W),cc(this)};function bd(c){if(Hp(c),c.G==3){var h=c.U++,p=tr(c.I);if(st(p,"SID",c.K),st(p,"RID",h),st(p,"TYPE","terminate"),pa(c,p),h=new Un(c,c.j,h),h.L=2,h.v=rs(tr(p)),p=!1,a.navigator&&a.navigator.sendBeacon)try{p=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!p&&a.Image&&(new Image().src=h.v,p=!0),p||(h.g=nm(h.j,null),h.g.ea(h.v)),h.F=Date.now(),Er(h)}em(c)}function lc(c){c.g&&(Ed(c),c.g.cancel(),c.g=null)}function Hp(c){lc(c),c.u&&(a.clearTimeout(c.u),c.u=null),uc(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&a.clearTimeout(c.s),c.s=null)}function cc(c){if(!tc(c.h)&&!c.s){c.s=!0;var h=c.Ga;Ne||Ln(),Se||(Ne(),Se=!0),$t.add(h,c),c.B=0}}function Gb(c,h){return nc(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=h.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=zs(g(c.Ga,c,h),Zp(c,c.B)),c.B++,!0)}n.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;const V=new Un(this,this.j,c);let U=this.o;if(this.S&&(U?(U=w(U),S(U,this.S)):U=this.S),this.m!==null||this.O||(V.H=U,U=null),this.P)e:{for(var h=0,p=0;p<this.i.length;p++){t:{var y=this.i[p];if("__data__"in y.map&&(y=y.map.__data__,typeof y=="string")){y=y.length;break t}y=void 0}if(y===void 0)break;if(h+=y,4096<h){h=p;break e}if(h===4096||p===this.i.length-1){h=p+1;break e}}h=1e3}else h=1e3;h=Qp(this,V,h),p=tr(this.I),st(p,"RID",c),st(p,"CVER",22),this.D&&st(p,"X-HTTP-Session-Id",this.D),pa(this,p),U&&(this.O?h="headers="+encodeURIComponent(String(Bp(U)))+"&"+h:this.m&&wd(p,this.m,U)),ca(this.h,V),this.Ua&&st(p,"TYPE","init"),this.P?(st(p,"$req",h),st(p,"SID","null"),V.T=!0,ia(V,p,null)):ia(V,p,h),this.G=2}}else this.G==3&&(c?Wp(this,c):this.i.length==0||tc(this.h)||Wp(this))};function Wp(c,h){var p;h?p=h.l:p=c.U++;const y=tr(c.I);st(y,"SID",c.K),st(y,"RID",p),st(y,"AID",c.T),pa(c,y),c.m&&c.o&&wd(y,c.m,c.o),p=new Un(c,c.j,p,c.B+1),c.m===null&&(p.H=c.o),h&&(c.i=h.D.concat(c.i)),h=Qp(c,p,1e3),p.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),ca(c.h,p),ia(p,y,h)}function pa(c,h){c.H&&ie(c.H,function(p,y){st(h,y,p)}),c.l&&ua({},function(p,y){st(h,y,p)})}function Qp(c,h,p){p=Math.min(c.i.length,p);var y=c.l?g(c.l.Na,c.l,c):null;e:{var V=c.i;let U=-1;for(;;){const ce=["count="+p];U==-1?0<p?(U=V[0].g,ce.push("ofs="+U)):U=0:ce.push("ofs="+U);let at=!0;for(let an=0;an<p;an++){let Qe=V[an].g;const hn=V[an].map;if(Qe-=U,0>Qe)U=Math.max(0,V[an].g-100),at=!1;else try{Ue(hn,ce,"req"+Qe+"_")}catch{y&&y(hn)}}if(at){y=ce.join("&");break e}}}return c=c.i.splice(0,p),h.D=c,y}function Jp(c){if(!c.g&&!c.u){c.Y=1;var h=c.Fa;Ne||Ln(),Se||(Ne(),Se=!0),$t.add(h,c),c.v=0}}function Id(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=zs(g(c.Fa,c),Zp(c,c.v)),c.v++,!0)}n.Fa=function(){if(this.u=null,Yp(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=zs(g(this.ab,this),c)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,on(10),lc(this),Yp(this))};function Ed(c){c.A!=null&&(a.clearTimeout(c.A),c.A=null)}function Yp(c){c.g=new Un(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var h=tr(c.qa);st(h,"RID","rpc"),st(h,"SID",c.K),st(h,"AID",c.T),st(h,"CI",c.F?"0":"1"),!c.F&&c.ja&&st(h,"TO",c.ja),st(h,"TYPE","xmlhttp"),pa(c,h),c.m&&c.o&&wd(h,c.m,c.o),c.L&&(c.g.I=c.L);var p=c.g;c=c.ia,p.L=1,p.v=rs(tr(h)),p.m=null,p.P=!0,Xl(p,c)}n.Za=function(){this.C!=null&&(this.C=null,lc(this),Id(this),on(19))};function uc(c){c.C!=null&&(a.clearTimeout(c.C),c.C=null)}function Xp(c,h){var p=null;if(c.g==h){uc(c),Ed(c),c.g=null;var y=2}else if(la(c.h,h))p=h.D,er(c.h,h),y=1;else return;if(c.G!=0){if(h.o)if(y==1){p=h.m?h.m.length:0,h=Date.now()-h.F;var V=c.B;y=Ni(),Ce(y,new ta(y,p)),cc(c)}else Jp(c);else if(V=h.s,V==3||V==0&&0<h.X||!(y==1&&Gb(c,h)||y==2&&Id(c)))switch(p&&0<p.length&&(h=c.h,h.i=h.i.concat(p)),V){case 1:Qs(c,5);break;case 4:Qs(c,10);break;case 3:Qs(c,6);break;default:Qs(c,2)}}}function Zp(c,h){let p=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(p*=2),p*h}function Qs(c,h){if(c.j.info("Error code "+h),h==2){var p=g(c.fb,c),y=c.Xa;const V=!y;y=new Ar(y||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Bi(y,"https"),rs(y),V?Ht(y.toString(),p):xt(y.toString(),p)}else on(2);c.G=0,c.l&&c.l.sa(h),em(c),Hp(c)}n.fb=function(c){c?(this.j.info("Successfully pinged google.com"),on(2)):(this.j.info("Failed to ping google.com"),on(1))};function em(c){if(c.G=0,c.ka=[],c.l){const h=rc(c.h);(h.length!=0||c.i.length!=0)&&(R(c.ka,h),R(c.ka,c.i),c.h.i.length=0,P(c.i),c.i.length=0),c.l.ra()}}function tm(c,h,p){var y=p instanceof Ar?tr(p):new Ar(p);if(y.g!="")h&&(y.g=h+"."+y.g),ns(y,y.s);else{var V=a.location;y=V.protocol,h=h?h+"."+V.hostname:V.hostname,V=+V.port;var U=new Ar(null);y&&Bi(U,y),h&&(U.g=h),V&&ns(U,V),p&&(U.l=p),y=U}return p=c.D,h=c.ya,p&&h&&st(y,p,h),st(y,"VER",c.la),pa(c,y),y}function nm(c,h,p){if(h&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=c.Ca&&!c.pa?new kt(new Cn({eb:p})):new kt(c.pa),h.Ha(c.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function rm(){}n=rm.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function dc(){}dc.prototype.g=function(c,h){return new Bn(c,h)};function Bn(c,h){Te.call(this),this.g=new Kp(h),this.l=c,this.h=h&&h.messageUrlParams||null,c=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(c?c["X-WebChannel-Content-Type"]=h.messageContentType:c={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(c?c["X-WebChannel-Client-Profile"]=h.va:c={"X-WebChannel-Client-Profile":h.va}),this.g.S=c,(c=h&&h.Sb)&&!B(c)&&(this.g.m=c),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!B(h)&&(this.g.D=h,c=this.h,c!==null&&h in c&&(c=this.h,h in c&&delete c[h])),this.j=new qi(this)}k(Bn,Te),Bn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Bn.prototype.close=function(){bd(this.g)},Bn.prototype.o=function(c){var h=this.g;if(typeof c=="string"){var p={};p.__data__=c,c=p}else this.u&&(p={},p.__data__=Tt(c),c=p);h.i.push(new gd(h.Ya++,c)),h.G==3&&cc(h)},Bn.prototype.N=function(){this.g.l=null,delete this.j,bd(this.g),delete this.g,Bn.aa.N.call(this)};function sm(c){At.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var h=c.__sm__;if(h){e:{for(const p in h){c=p;break e}c=void 0}(this.i=c)&&(c=this.i,h=h!==null&&c in h?h[c]:void 0),this.data=h}else this.data=c}k(sm,At);function im(){ot.call(this),this.status=1}k(im,ot);function qi(c){this.g=c}k(qi,rm),qi.prototype.ua=function(){Ce(this.g,"a")},qi.prototype.ta=function(c){Ce(this.g,new sm(c))},qi.prototype.sa=function(c){Ce(this.g,new im)},qi.prototype.ra=function(){Ce(this.g,"b")},dc.prototype.createWebChannel=dc.prototype.g,Bn.prototype.send=Bn.prototype.o,Bn.prototype.open=Bn.prototype.m,Bn.prototype.close=Bn.prototype.close,Rv=function(){return new dc},Sv=function(){return Ni()},Pv=wr,Eh={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Mi.NO_ERROR=0,Mi.TIMEOUT=8,Mi.HTTP_ERROR=6,Cc=Mi,ra.COMPLETE="complete",xv=ra,dt.EventType=tt,tt.OPEN="a",tt.CLOSE="b",tt.ERROR="c",tt.MESSAGE="d",Te.prototype.listen=Te.prototype.K,Ra=dt,kt.prototype.listenOnce=kt.prototype.L,kt.prototype.getLastError=kt.prototype.Ka,kt.prototype.getLastErrorCode=kt.prototype.Ba,kt.prototype.getStatus=kt.prototype.Z,kt.prototype.getResponseJson=kt.prototype.Oa,kt.prototype.getResponseText=kt.prototype.oa,kt.prototype.send=kt.prototype.ea,kt.prototype.setWithCredentials=kt.prototype.Ha,Av=kt}).apply(typeof gc<"u"?gc:typeof self<"u"?self:typeof window<"u"?window:{});const cg="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Xt.UNAUTHENTICATED=new Xt(null),Xt.GOOGLE_CREDENTIALS=new Xt("google-credentials-uid"),Xt.FIRST_PARTY=new Xt("first-party-uid"),Xt.MOCK_USER=new Xt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bo="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cs=new gf("@firebase/firestore");function Zi(){return Cs.logLevel}function aL(n){Cs.setLogLevel(n)}function J(n,...e){if(Cs.logLevel<=je.DEBUG){const t=e.map(yf);Cs.debug(`Firestore (${Bo}): ${n}`,...t)}}function Mt(n,...e){if(Cs.logLevel<=je.ERROR){const t=e.map(yf);Cs.error(`Firestore (${Bo}): ${n}`,...t)}}function Jn(n,...e){if(Cs.logLevel<=je.WARN){const t=e.map(yf);Cs.warn(`Firestore (${Bo}): ${n}`,...t)}}function yf(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function me(n="Unexpected state"){const e=`FIRESTORE (${Bo}) INTERNAL ASSERTION FAILED: `+n;throw Mt(e),new Error(e)}function _e(n,e){n||me()}function lL(n,e){n||me()}function ae(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Y extends Wr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cv{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Qx{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Xt.UNAUTHENTICATED))}shutdown(){}}class Jx{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Yx{constructor(e){this.t=e,this.currentUser=Xt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){_e(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new en;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new en,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{J("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(J("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new en)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(J("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(_e(typeof r.accessToken=="string"),new Cv(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return _e(e===null||typeof e=="string"),new Xt(e)}}class Xx{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Xt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Zx{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Xx(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Xt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class kv{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class eP{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){_e(this.o===void 0);const r=i=>{i.error!=null&&J("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,J("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{J("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):J("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(_e(typeof t.token=="string"),this.R=t.token,new kv(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class cL{getToken(){return Promise.resolve(new kv(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tP(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dv{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=tP(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function xe(n,e){return n<e?-1:n>e?1:0}function Io(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function Vv(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Y(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Y(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Y(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Y(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Rt.fromMillis(Date.now())}static fromDate(e){return Rt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Rt(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?xe(this.nanoseconds,e.nanoseconds):xe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class we{constructor(e){this.timestamp=e}static fromTimestamp(e){return new we(e)}static min(){return new we(new Rt(0,0))}static max(){return new we(new Rt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sl{constructor(e,t,r){t===void 0?t=0:t>e.length&&me(),r===void 0?r=e.length-t:r>e.length-t&&me(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return sl.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof sl?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class qe extends sl{construct(e,t,r){return new qe(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Y(F.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new qe(t)}static emptyPath(){return new qe([])}}const nP=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class bt extends sl{construct(e,t,r){return new bt(e,t,r)}static isValidIdentifier(e){return nP.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),bt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new bt(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new Y(F.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new Y(F.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Y(F.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new Y(F.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new bt(t)}static emptyPath(){return new bt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class he{constructor(e){this.path=e}static fromPath(e){return new he(qe.fromString(e))}static fromName(e){return new he(qe.fromString(e).popFirst(5))}static empty(){return new he(qe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&qe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return qe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new he(new qe(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eo{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function Th(n){return n.fields.find(e=>e.kind===2)}function ti(n){return n.fields.filter(e=>e.kind!==2)}function rP(n,e){let t=xe(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=sP(n.fields[r],e.fields[r]),t!==0)return t;return xe(n.fields.length,e.fields.length)}Eo.UNKNOWN_ID=-1;class di{constructor(e,t){this.fieldPath=e,this.kind=t}}function sP(n,e){const t=bt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:xe(n.kind,e.kind)}class To{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new To(0,Gn.min())}}function Nv(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=we.fromTimestamp(r===1e9?new Rt(t+1,0):new Rt(t,r));return new Gn(s,he.empty(),e)}function Ov(n){return new Gn(n.readTime,n.key,-1)}class Gn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Gn(we.min(),he.empty(),-1)}static max(){return new Gn(we.max(),he.empty(),-1)}}function vf(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=he.comparator(n.documentKey,e.documentKey),t!==0?t:xe(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mv="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Lv{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Us(n){if(n.code!==F.FAILED_PRECONDITION||n.message!==Mv)throw n;J("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&me(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new N((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof N?t:N.resolve(t)}catch(t){return N.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):N.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):N.reject(t)}static resolve(e){return new N((t,r)=>{t(e)})}static reject(e){return new N((t,r)=>{r(e)})}static waitFor(e){return new N((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=N.resolve(!1);for(const r of e)t=t.next(s=>s?N.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new N((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next(d=>{o[u]=d,++a,a===i&&r(o)},d=>s(d))}})}static doWhile(e,t){return new N((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mu{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new en,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new qa(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=wf(r.target.error);this.V.reject(new qa(e,s))}}static open(e,t,r,s){try{return new Mu(t,e.transaction(s,r))}catch(i){throw new qa(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(J("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new oP(t)}}class mr{constructor(e,t,r){this.name=e,this.version=t,this.p=r,mr.S(Wt())===12.2&&Mt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return J("SimpleDb","Removing database:",e),ni(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!_v())return!1;if(mr.v())return!0;const e=Wt(),t=mr.S(e),r=0<t&&t<10,s=Fv(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(J("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new qa(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new Y(F.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new Y(F.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new qa(e,o))},s.onupgradeneeded=i=>{J("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{J("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=Mu.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(u=>(a.g(),u)).catch(u=>(a.abort(u),N.reject(u))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,u=l.name!=="FirebaseError"&&o<3;if(J("SimpleDb","Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Fv(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class iP{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return ni(this.B.delete())}}class qa extends Y{constructor(e,t){super(F.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Bs(n){return n.name==="IndexedDbTransactionError"}class oP{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(J("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(J("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ni(r)}add(e){return J("SimpleDb","ADD",this.store.name,e,e),ni(this.store.add(e))}get(e){return ni(this.store.get(e)).next(t=>(t===void 0&&(t=null),J("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return J("SimpleDb","DELETE",this.store.name,e),ni(this.store.delete(e))}count(){return J("SimpleDb","COUNT",this.store.name),ni(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new N((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new N((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){J("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new N((r,s)=>{t.onerror=i=>{const o=wf(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new N((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new iP(a),u=t(a.primaryKey,a.value,l);if(u instanceof N){const d=u.catch(f=>(l.done(),N.reject(f)));r.push(d)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>N.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ni(n){return new N((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=wf(r.target.error);t(s)}})}let ug=!1;function wf(n){const e=mr.S(Wt());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new Y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ug||(ug=!0,setTimeout(()=>{throw r},0)),r}}return n}class aP{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){J("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{J("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){Bs(t)?J("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await Us(t)}await this.X(6e4)})}}class lP{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return N.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return J("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(J("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=Ov(i);vf(o,r)>0&&(r=o)}),new Gn(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Vn.oe=-1;function Pl(n){return n==null}function il(n){return n===0&&1/n==-1/0}function Uv(n){return typeof n=="number"&&Number.isInteger(n)&&!il(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=dg(e)),e=cP(n.get(t),e);return dg(e)}function cP(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function dg(n){return n+""}function hr(n){const e=n.length;if(_e(e>=2),e===2)return _e(n.charAt(0)===""&&n.charAt(1)===""),qe.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&me(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:me()}i=o+2}return new qe(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hg=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kc(n,e){return[n,vn(e)]}function Bv(n,e,t){return[n,vn(e),t]}const uP={},dP=["prefixPath","collectionGroup","readTime","documentId"],hP=["prefixPath","collectionGroup","documentId"],fP=["collectionGroup","readTime","prefixPath","documentId"],pP=["canonicalId","targetId"],mP=["targetId","path"],gP=["path","targetId"],_P=["collectionId","parent"],yP=["indexId","uid"],vP=["uid","sequenceNumber"],wP=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],bP=["indexId","uid","orderedDocumentKey"],IP=["userId","collectionPath","documentId"],EP=["userId","collectionPath","largestBatchId"],TP=["userId","collectionGroup","largestBatchId"],$v=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],AP=[...$v,"documentOverlays"],jv=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],qv=jv,bf=[...qv,"indexConfiguration","indexState","indexEntries"],xP=bf,PP=[...bf,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ah extends Lv{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function Qt(n,e){const t=ae(n);return mr.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fg(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function $s(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function zv(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function Gv(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ft{constructor(e,t){this.comparator=e,this.root=t||ln.EMPTY}insert(e,t){return new ft(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ln.BLACK,null,null))}remove(e){return new ft(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ln.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new _c(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new _c(this.root,e,this.comparator,!1)}getReverseIterator(){return new _c(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new _c(this.root,e,this.comparator,!0)}}class _c{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ln{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??ln.RED,this.left=s??ln.EMPTY,this.right=i??ln.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new ln(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ln.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return ln.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ln.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ln.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw me();const e=this.left.check();if(e!==this.right.check())throw me();return e+(this.isRed()?0:1)}}ln.EMPTY=null,ln.RED=!0,ln.BLACK=!1;ln.EMPTY=new class{constructor(){this.size=0}get key(){throw me()}get value(){throw me()}get color(){throw me()}get left(){throw me()}get right(){throw me()}copy(e,t,r,s,i){return this}insert(e,t,r){return new ln(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class it{constructor(e){this.comparator=e,this.data=new ft(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new pg(this.data.getIterator())}getIteratorFrom(e){return new pg(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof it)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new it(this.comparator);return t.data=e,t}}class pg{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ki(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nn{constructor(e){this.fields=e,e.sort(bt.comparator)}static empty(){return new Nn([])}unionWith(e){let t=new it(bt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Nn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Io(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kv extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dL(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Kv("Invalid base64 string: "+i):i}}(e);return new Vt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Vt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return xe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Vt.EMPTY_BYTE_STRING=new Vt("");const SP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function jr(n){if(_e(!!n),typeof n=="string"){let e=0;const t=SP.exec(n);if(_e(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:wt(n.seconds),nanos:wt(n.nanos)}}function wt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function qr(n){return typeof n=="string"?Vt.fromBase64String(n):Vt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lu(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Fu(n){const e=n.mapValue.fields.__previous_value__;return Lu(e)?Fu(e):e}function ol(n){const e=jr(n.mapValue.fields.__local_write_time__.timestampValue);return new Rt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RP{constructor(e,t,r,s,i,o,a,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u}}class pi{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new pi("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof pi&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Is={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Dc={nullValue:"NULL_VALUE"};function ks(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Lu(n)?4:Hv(n)?9007199254740991:Uu(n)?10:11:me()}function vr(n,e){if(n===e)return!0;const t=ks(n);if(t!==ks(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ol(n).isEqual(ol(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=jr(s.timestampValue),a=jr(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return qr(s.bytesValue).isEqual(qr(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return wt(s.geoPointValue.latitude)===wt(i.geoPointValue.latitude)&&wt(s.geoPointValue.longitude)===wt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return wt(s.integerValue)===wt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=wt(s.doubleValue),a=wt(i.doubleValue);return o===a?il(o)===il(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Io(n.arrayValue.values||[],e.arrayValue.values||[],vr);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(fg(o)!==fg(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!vr(o[l],a[l])))return!1;return!0}(n,e);default:return me()}}function al(n,e){return(n.values||[]).find(t=>vr(t,e))!==void 0}function Ds(n,e){if(n===e)return 0;const t=ks(n),r=ks(e);if(t!==r)return xe(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return xe(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=wt(i.integerValue||i.doubleValue),l=wt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return mg(n.timestampValue,e.timestampValue);case 4:return mg(ol(n),ol(e));case 5:return xe(n.stringValue,e.stringValue);case 6:return function(i,o){const a=qr(i),l=qr(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const d=xe(a[u],l[u]);if(d!==0)return d}return xe(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=xe(wt(i.latitude),wt(o.latitude));return a!==0?a:xe(wt(i.longitude),wt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return gg(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,u,d;const f=i.fields||{},g=o.fields||{},_=(a=f.value)===null||a===void 0?void 0:a.arrayValue,k=(l=g.value)===null||l===void 0?void 0:l.arrayValue,P=xe(((u=_==null?void 0:_.values)===null||u===void 0?void 0:u.length)||0,((d=k==null?void 0:k.values)===null||d===void 0?void 0:d.length)||0);return P!==0?P:gg(_,k)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Is.mapValue&&o===Is.mapValue)return 0;if(i===Is.mapValue)return 1;if(o===Is.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},d=Object.keys(u);l.sort(),d.sort();for(let f=0;f<l.length&&f<d.length;++f){const g=xe(l[f],d[f]);if(g!==0)return g;const _=Ds(a[l[f]],u[d[f]]);if(_!==0)return _}return xe(l.length,d.length)}(n.mapValue,e.mapValue);default:throw me()}}function mg(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return xe(n,e);const t=jr(n),r=jr(e),s=xe(t.seconds,r.seconds);return s!==0?s:xe(t.nanos,r.nanos)}function gg(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Ds(t[s],r[s]);if(i)return i}return xe(t.length,r.length)}function Ao(n){return xh(n)}function xh(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=jr(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return qr(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return he.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=xh(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${xh(t.fields[o])}`;return s+"}"}(n.mapValue):me()}function Vc(n){switch(ks(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Fu(n);return e?16+Vc(e):16;case 5:return 2*n.stringValue.length;case 6:return qr(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Vc(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return $s(r.fields,(i,o)=>{s+=i.length+Vc(o)}),s}(n.mapValue);default:throw me()}}function mi(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ph(n){return!!n&&"integerValue"in n}function ll(n){return!!n&&"arrayValue"in n}function _g(n){return!!n&&"nullValue"in n}function yg(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Nc(n){return!!n&&"mapValue"in n}function Uu(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function za(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return $s(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=za(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=za(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Hv(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const Wv={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function CP(n){return"nullValue"in n?Dc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?mi(pi.empty(),he.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Uu(n)?Wv:{mapValue:{}}:me()}function kP(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?mi(pi.empty(),he.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Wv:"mapValue"in n?Uu(n)?{mapValue:{}}:Is:me()}function vg(n,e){const t=Ds(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function wg(n,e){const t=Ds(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un{constructor(e){this.value=e}static empty(){return new un({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Nc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=za(t)}setAll(e){let t=bt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=za(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Nc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return vr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Nc(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){$s(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new un(za(this.value))}}function Qv(n){const e=[];return $s(n.fields,(t,r)=>{const s=new bt([t]);if(Nc(r)){const i=Qv(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Nn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new gt(e,0,we.min(),we.min(),we.min(),un.empty(),0)}static newFoundDocument(e,t,r,s){return new gt(e,1,t,we.min(),r,s,0)}static newNoDocument(e,t){return new gt(e,2,t,we.min(),we.min(),un.empty(),0)}static newUnknownDocument(e,t){return new gt(e,3,t,we.min(),we.min(),un.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(we.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=un.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=un.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=we.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof gt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new gt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vs{constructor(e,t){this.position=e,this.inclusive=t}}function bg(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=he.comparator(he.fromName(o.referenceValue),t.key):r=Ds(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ig(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!vr(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cl{constructor(e,t="asc"){this.field=e,this.dir=t}}function DP(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jv{}class ze extends Jv{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new VP(e,t,r):t==="array-contains"?new MP(e,r):t==="in"?new n0(e,r):t==="not-in"?new LP(e,r):t==="array-contains-any"?new FP(e,r):new ze(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new NP(e,r):new OP(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ds(t,this.value)):t!==null&&ks(this.value)===ks(t)&&this.matchesComparison(Ds(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return me()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class nt extends Jv{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new nt(e,t)}matches(e){return xo(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function xo(n){return n.op==="and"}function Sh(n){return n.op==="or"}function If(n){return Yv(n)&&xo(n)}function Yv(n){for(const e of n.filters)if(e instanceof nt)return!1;return!0}function Rh(n){if(n instanceof ze)return n.field.canonicalString()+n.op.toString()+Ao(n.value);if(If(n))return n.filters.map(e=>Rh(e)).join(",");{const e=n.filters.map(t=>Rh(t)).join(",");return`${n.op}(${e})`}}function Xv(n,e){return n instanceof ze?function(r,s){return s instanceof ze&&r.op===s.op&&r.field.isEqual(s.field)&&vr(r.value,s.value)}(n,e):n instanceof nt?function(r,s){return s instanceof nt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&Xv(o,s.filters[a]),!0):!1}(n,e):void me()}function Zv(n,e){const t=n.filters.concat(e);return nt.create(t,n.op)}function e0(n){return n instanceof ze?function(t){return`${t.field.canonicalString()} ${t.op} ${Ao(t.value)}`}(n):n instanceof nt?function(t){return t.op.toString()+" {"+t.getFilters().map(e0).join(" ,")+"}"}(n):"Filter"}class VP extends ze{constructor(e,t,r){super(e,t,r),this.key=he.fromName(r.referenceValue)}matches(e){const t=he.comparator(e.key,this.key);return this.matchesComparison(t)}}class NP extends ze{constructor(e,t){super(e,"in",t),this.keys=t0("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class OP extends ze{constructor(e,t){super(e,"not-in",t),this.keys=t0("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function t0(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>he.fromName(r.referenceValue))}class MP extends ze{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ll(t)&&al(t.arrayValue,this.value)}}class n0 extends ze{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&al(this.value.arrayValue,t)}}class LP extends ze{constructor(e,t){super(e,"not-in",t)}matches(e){if(al(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!al(this.value.arrayValue,t)}}class FP extends ze{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ll(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>al(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UP{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function Ch(n,e=null,t=[],r=[],s=null,i=null,o=null){return new UP(n,e,t,r,s,i,o)}function gi(n){const e=ae(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Rh(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Pl(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ao(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ao(r)).join(",")),e.ue=t}return e.ue}function Sl(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!DP(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Xv(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ig(n.startAt,e.startAt)&&Ig(n.endAt,e.endAt)}function tu(n){return he.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function nu(n,e){return n.filters.filter(t=>t instanceof ze&&t.field.isEqual(e))}function Eg(n,e,t){let r=Dc,s=!0;for(const i of nu(n,e)){let o=Dc,a=!0;switch(i.op){case"<":case"<=":o=CP(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Dc}vg({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];vg({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function Tg(n,e,t){let r=Is,s=!0;for(const i of nu(n,e)){let o=Is,a=!0;switch(i.op){case">=":case">":o=kP(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Is}wg({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];wg({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qr{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function r0(n,e,t,r,s,i,o,a){return new Qr(n,e,t,r,s,i,o,a)}function $o(n){return new Qr(n)}function Ag(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Ef(n){return n.collectionGroup!==null}function co(n){const e=ae(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new it(bt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new cl(i,r))}),t.has(bt.keyField().canonicalString())||e.ce.push(new cl(bt.keyField(),r))}return e.ce}function wn(n){const e=ae(n);return e.le||(e.le=i0(e,co(n))),e.le}function s0(n){const e=ae(n);return e.he||(e.he=i0(e,n.explicitOrderBy)),e.he}function i0(n,e){if(n.limitType==="F")return Ch(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new cl(s.field,i)});const t=n.endAt?new Vs(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Vs(n.startAt.position,n.startAt.inclusive):null;return Ch(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function kh(n,e){const t=n.filters.concat([e]);return new Qr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function ru(n,e,t){return new Qr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Rl(n,e){return Sl(wn(n),wn(e))&&n.limitType===e.limitType}function o0(n){return`${gi(wn(n))}|lt:${n.limitType}`}function eo(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>e0(s)).join(", ")}]`),Pl(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Ao(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Ao(s)).join(",")),`Target(${r})`}(wn(n))}; limitType=${n.limitType})`}function Cl(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):he.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of co(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const u=bg(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,co(r),s)||r.endAt&&!function(o,a,l){const u=bg(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,co(r),s))}(n,e)}function a0(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function l0(n){return(e,t)=>{let r=!1;for(const s of co(n)){const i=BP(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function BP(n,e,t){const r=n.field.isKeyField()?he.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?Ds(l,u):me()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return me()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){$s(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Gv(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $P=new ft(he.comparator);function On(){return $P}const c0=new ft(he.comparator);function Ca(...n){let e=c0;for(const t of n)e=e.insert(t.key,t);return e}function u0(n){let e=c0;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function fr(){return Ga()}function d0(){return Ga()}function Ga(){return new Jr(n=>n.toString(),(n,e)=>n.isEqual(e))}const jP=new ft(he.comparator),qP=new it(he.comparator);function Oe(...n){let e=qP;for(const t of n)e=e.add(t);return e}const zP=new it(xe);function Tf(){return zP}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Af(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:il(e)?"-0":e}}function h0(n){return{integerValue:""+n}}function f0(n,e){return Uv(e)?h0(e):Af(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bu{constructor(){this._=void 0}}function GP(n,e,t){return n instanceof Po?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Lu(i)&&(i=Fu(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof _i?m0(n,e):n instanceof yi?g0(n,e):function(s,i){const o=p0(s,i),a=xg(o)+xg(s.Pe);return Ph(o)&&Ph(s.Pe)?h0(a):Af(s.serializer,a)}(n,e)}function KP(n,e,t){return n instanceof _i?m0(n,e):n instanceof yi?g0(n,e):t}function p0(n,e){return n instanceof So?function(r){return Ph(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Po extends Bu{}class _i extends Bu{constructor(e){super(),this.elements=e}}function m0(n,e){const t=_0(e);for(const r of n.elements)t.some(s=>vr(s,r))||t.push(r);return{arrayValue:{values:t}}}class yi extends Bu{constructor(e){super(),this.elements=e}}function g0(n,e){let t=_0(e);for(const r of n.elements)t=t.filter(s=>!vr(s,r));return{arrayValue:{values:t}}}class So extends Bu{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function xg(n){return wt(n.integerValue||n.doubleValue)}function _0(n){return ll(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kl{constructor(e,t){this.field=e,this.transform=t}}function HP(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof _i&&s instanceof _i||r instanceof yi&&s instanceof yi?Io(r.elements,s.elements,vr):r instanceof So&&s instanceof So?vr(r.Pe,s.Pe):r instanceof Po&&s instanceof Po}(n.transform,e.transform)}class WP{constructor(e,t){this.version=e,this.transformResults=t}}class It{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new It}static exists(e){return new It(void 0,e)}static updateTime(e){return new It(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Oc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class $u{}function y0(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new qo(n.key,It.none()):new jo(n.key,n.data,It.none());{const t=n.data,r=un.empty();let s=new it(bt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Yr(n.key,r,new Nn(s.toArray()),It.none())}}function QP(n,e,t){n instanceof jo?function(s,i,o){const a=s.value.clone(),l=Sg(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Yr?function(s,i,o){if(!Oc(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=Sg(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(v0(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Ka(n,e,t,r){return n instanceof jo?function(i,o,a,l){if(!Oc(i.precondition,o))return a;const u=i.value.clone(),d=Rg(i.fieldTransforms,l,o);return u.setAll(d),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Yr?function(i,o,a,l){if(!Oc(i.precondition,o))return a;const u=Rg(i.fieldTransforms,l,o),d=o.data;return d.setAll(v0(i)),d.setAll(u),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Oc(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function JP(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=p0(r.transform,s||null);i!=null&&(t===null&&(t=un.empty()),t.set(r.field,i))}return t||null}function Pg(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Io(r,s,(i,o)=>HP(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class jo extends $u{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Yr extends $u{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function v0(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Sg(n,e,t){const r=new Map;_e(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,KP(o,a,t[s]))}return r}function Rg(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,GP(i,o,e))}return r}class qo extends $u{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class xf extends $u{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&QP(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ka(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Ka(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=d0();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=y0(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(we.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Oe())}isEqual(e){return this.batchId===e.batchId&&Io(this.mutations,e.mutations,(t,r)=>Pg(t,r))&&Io(this.baseMutations,e.baseMutations,(t,r)=>Pg(t,r))}}class Sf{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){_e(e.mutations.length===r.length);let s=function(){return jP}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Sf(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rf{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w0{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YP{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qt,Ke;function b0(n){switch(n){default:return me();case F.CANCELLED:case F.UNKNOWN:case F.DEADLINE_EXCEEDED:case F.RESOURCE_EXHAUSTED:case F.INTERNAL:case F.UNAVAILABLE:case F.UNAUTHENTICATED:return!1;case F.INVALID_ARGUMENT:case F.NOT_FOUND:case F.ALREADY_EXISTS:case F.PERMISSION_DENIED:case F.FAILED_PRECONDITION:case F.ABORTED:case F.OUT_OF_RANGE:case F.UNIMPLEMENTED:case F.DATA_LOSS:return!0}}function I0(n){if(n===void 0)return Mt("GRPC error has no .code"),F.UNKNOWN;switch(n){case qt.OK:return F.OK;case qt.CANCELLED:return F.CANCELLED;case qt.UNKNOWN:return F.UNKNOWN;case qt.DEADLINE_EXCEEDED:return F.DEADLINE_EXCEEDED;case qt.RESOURCE_EXHAUSTED:return F.RESOURCE_EXHAUSTED;case qt.INTERNAL:return F.INTERNAL;case qt.UNAVAILABLE:return F.UNAVAILABLE;case qt.UNAUTHENTICATED:return F.UNAUTHENTICATED;case qt.INVALID_ARGUMENT:return F.INVALID_ARGUMENT;case qt.NOT_FOUND:return F.NOT_FOUND;case qt.ALREADY_EXISTS:return F.ALREADY_EXISTS;case qt.PERMISSION_DENIED:return F.PERMISSION_DENIED;case qt.FAILED_PRECONDITION:return F.FAILED_PRECONDITION;case qt.ABORTED:return F.ABORTED;case qt.OUT_OF_RANGE:return F.OUT_OF_RANGE;case qt.UNIMPLEMENTED:return F.UNIMPLEMENTED;case qt.DATA_LOSS:return F.DATA_LOSS;default:return me()}}(Ke=qt||(qt={}))[Ke.OK=0]="OK",Ke[Ke.CANCELLED=1]="CANCELLED",Ke[Ke.UNKNOWN=2]="UNKNOWN",Ke[Ke.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ke[Ke.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ke[Ke.NOT_FOUND=5]="NOT_FOUND",Ke[Ke.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ke[Ke.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ke[Ke.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ke[Ke.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ke[Ke.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ke[Ke.ABORTED=10]="ABORTED",Ke[Ke.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ke[Ke.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ke[Ke.INTERNAL=13]="INTERNAL",Ke[Ke.UNAVAILABLE=14]="UNAVAILABLE",Ke[Ke.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let su=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E0(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XP=new ui([4294967295,4294967295],0);function Cg(n){const e=E0().encode(n),t=new Tv;return t.update(e),new Uint8Array(t.digest())}function kg(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new ui([t,r],0),new ui([s,i],0)]}class Cf{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ka(`Invalid padding: ${t}`);if(r<0)throw new ka(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ka(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ka(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=ui.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(ui.fromNumber(r)));return s.compare(XP)===1&&(s=new ui([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Cg(e),[r,s]=kg(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Cf(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=Cg(e),[r,s]=kg(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class ka extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dl{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Vl.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Dl(we.min(),s,new ft(xe),On(),Oe())}}class Vl{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Vl(r,t,Oe(),Oe(),Oe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mc{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class T0{constructor(e,t){this.targetId=e,this.me=t}}class A0{constructor(e,t,r=Vt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Dg{constructor(){this.fe=0,this.ge=Ng(),this.pe=Vt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Oe(),t=Oe(),r=Oe();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:me()}}),new Vl(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=Ng()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,_e(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class ZP{constructor(e){this.Le=e,this.Be=new Map,this.ke=On(),this.qe=Vg(),this.Qe=new ft(xe)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:me()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(tu(i))if(r===0){const o=new he(i.path);this.Ue(t,o,gt.newNoDocument(o,we.min()))}else _e(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,u)}su==null||su.et(function(d,f,g,_,k){var P,R,L,B,$,j;const O={localCacheCount:d,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},ie=f.unchangedNames;return ie&&(O.bloomFilter={applied:k===0,hashCount:(P=ie==null?void 0:ie.hashCount)!==null&&P!==void 0?P:0,bitmapLength:(B=(L=(R=ie==null?void 0:ie.bits)===null||R===void 0?void 0:R.bitmap)===null||L===void 0?void 0:L.length)!==null&&B!==void 0?B:0,padding:(j=($=ie==null?void 0:ie.bits)===null||$===void 0?void 0:$.padding)!==null&&j!==void 0?j:0,mightContain:x=>{var w;return(w=_==null?void 0:_.mightContain(x))!==null&&w!==void 0&&w}}),O}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=qr(r).toUint8Array()}catch(l){if(l instanceof Kv)return Jn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Cf(o,s,i)}catch(l){return Jn(l instanceof ka?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&tu(a.target)){const l=new he(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,gt.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=Oe();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.Je(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new Dl(e,t,this.Qe,this.ke,r);return this.ke=On(),this.qe=Vg(),this.Qe=new ft(xe),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Dg,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new it(xe),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||J("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Dg),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Vg(){return new ft(he.comparator)}function Ng(){return new ft(he.comparator)}const eS=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),tS=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),nS=(()=>({and:"AND",or:"OR"}))();class rS{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Dh(n,e){return n.useProto3Json||Pl(e)?e:{value:e}}function Ro(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function x0(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function sS(n,e){return Ro(n,e.toTimestamp())}function Ut(n){return _e(!!n),we.fromTimestamp(function(t){const r=jr(t);return new Rt(r.seconds,r.nanos)}(n))}function kf(n,e){return Vh(n,e).canonicalString()}function Vh(n,e){const t=function(s){return new qe(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function P0(n){const e=qe.fromString(n);return _e(L0(e)),e}function ul(n,e){return kf(n.databaseId,e.path)}function gr(n,e){const t=P0(e);if(t.get(1)!==n.databaseId.projectId)throw new Y(F.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Y(F.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new he(C0(t))}function S0(n,e){return kf(n.databaseId,e)}function R0(n){const e=P0(n);return e.length===4?qe.emptyPath():C0(e)}function Nh(n){return new qe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function C0(n){return _e(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Og(n,e,t){return{name:ul(n,e),fields:t.value.mapValue.fields}}function k0(n,e,t){const r=gr(n,e.name),s=Ut(e.updateTime),i=e.createTime?Ut(e.createTime):we.min(),o=new un({mapValue:{fields:e.fields}}),a=gt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function iS(n,e){return"found"in e?function(r,s){_e(!!s.found),s.found.name,s.found.updateTime;const i=gr(r,s.found.name),o=Ut(s.found.updateTime),a=s.found.createTime?Ut(s.found.createTime):we.min(),l=new un({mapValue:{fields:s.found.fields}});return gt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){_e(!!s.missing),_e(!!s.readTime);const i=gr(r,s.missing),o=Ut(s.readTime);return gt.newNoDocument(i,o)}(n,e):me()}function oS(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:me()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,d){return u.useProto3Json?(_e(d===void 0||typeof d=="string"),Vt.fromBase64String(d||"")):(_e(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Vt.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const d=u.code===void 0?F.UNKNOWN:I0(u.code);return new Y(d,u.message||"")}(o);t=new A0(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=gr(n,r.document.name),i=Ut(r.document.updateTime),o=r.document.createTime?Ut(r.document.createTime):we.min(),a=new un({mapValue:{fields:r.document.fields}}),l=gt.newFoundDocument(s,i,o,a),u=r.targetIds||[],d=r.removedTargetIds||[];t=new Mc(u,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=gr(n,r.document),i=r.readTime?Ut(r.readTime):we.min(),o=gt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Mc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=gr(n,r.document),i=r.removedTargetIds||[];t=new Mc([],i,s,null)}else{if(!("filter"in e))return me();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new YP(s,i),a=r.targetId;t=new T0(a,o)}}return t}function dl(n,e){let t;if(e instanceof jo)t={update:Og(n,e.key,e.value)};else if(e instanceof qo)t={delete:ul(n,e.key)};else if(e instanceof Yr)t={update:Og(n,e.key,e.data),updateMask:hS(e.fieldMask)};else{if(!(e instanceof xf))return me();t={verify:ul(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Po)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof _i)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof yi)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof So)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw me()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:sS(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:me()}(n,e.precondition)),t}function Oh(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?It.updateTime(Ut(i.updateTime)):i.exists!==void 0?It.exists(i.exists):It.none()}(e.currentDocument):It.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)_e(a.setToServerValue==="REQUEST_TIME"),l=new Po;else if("appendMissingElements"in a){const d=a.appendMissingElements.values||[];l=new _i(d)}else if("removeAllFromArray"in a){const d=a.removeAllFromArray.values||[];l=new yi(d)}else"increment"in a?l=new So(o,a.increment):me();const u=bt.fromServerFormat(a.fieldPath);return new kl(u,l)}(n,s)):[];if(e.update){e.update.name;const s=gr(n,e.update.name),i=new un({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const u=l.fieldPaths||[];return new Nn(u.map(d=>bt.fromServerFormat(d)))}(e.updateMask);return new Yr(s,i,o,t,r)}return new jo(s,i,t,r)}if(e.delete){const s=gr(n,e.delete);return new qo(s,t)}if(e.verify){const s=gr(n,e.verify);return new xf(s,t)}return me()}function aS(n,e){return n&&n.length>0?(_e(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?Ut(s.updateTime):Ut(i);return o.isEqual(we.min())&&(o=Ut(i)),new WP(o,s.transformResults||[])}(t,e))):[]}function D0(n,e){return{documents:[S0(n,e.path)]}}function ju(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=S0(n,s);const i=function(u){if(u.length!==0)return M0(nt.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(d=>function(g){return{field:ms(g.field),direction:cS(g.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Dh(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:t,parent:s}}function V0(n,e,t,r){const{_t:s,parent:i}=ju(n,e),o={},a=[];let l=0;return t.forEach(u=>{const d=r?u.alias:"aggregate_"+l++;o[d]=u.alias,u.aggregateType==="count"?a.push({alias:d,count:{}}):u.aggregateType==="avg"?a.push({alias:d,avg:{field:ms(u.fieldPath)}}):u.aggregateType==="sum"&&a.push({alias:d,sum:{field:ms(u.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function N0(n){let e=R0(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){_e(r===1);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(f){const g=O0(f);return g instanceof nt&&If(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(k){return new cl(to(k.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,Pl(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,_=f.values||[];return new Vs(_,g)}(t.startAt));let u=null;return t.endAt&&(u=function(f){const g=!f.before,_=f.values||[];return new Vs(_,g)}(t.endAt)),r0(e,s,o,i,a,"F",l,u)}function lS(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return me()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function O0(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=to(t.unaryFilter.field);return ze.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=to(t.unaryFilter.field);return ze.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=to(t.unaryFilter.field);return ze.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=to(t.unaryFilter.field);return ze.create(o,"!=",{nullValue:"NULL_VALUE"});default:return me()}}(n):n.fieldFilter!==void 0?function(t){return ze.create(to(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return me()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return nt.create(t.compositeFilter.filters.map(r=>O0(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return me()}}(t.compositeFilter.op))}(n):me()}function cS(n){return eS[n]}function uS(n){return tS[n]}function dS(n){return nS[n]}function ms(n){return{fieldPath:n.canonicalString()}}function to(n){return bt.fromServerFormat(n.fieldPath)}function M0(n){return n instanceof ze?function(t){if(t.op==="=="){if(yg(t.value))return{unaryFilter:{field:ms(t.field),op:"IS_NAN"}};if(_g(t.value))return{unaryFilter:{field:ms(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(yg(t.value))return{unaryFilter:{field:ms(t.field),op:"IS_NOT_NAN"}};if(_g(t.value))return{unaryFilter:{field:ms(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ms(t.field),op:uS(t.op),value:t.value}}}(n):n instanceof nt?function(t){const r=t.getFilters().map(s=>M0(s));return r.length===1?r[0]:{compositeFilter:{op:dS(t.op),filters:r}}}(n):me()}function hS(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function L0(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vr{constructor(e,t,r,s,i=we.min(),o=we.min(),a=Vt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Vr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Vr(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Vr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Vr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F0{constructor(e){this.ct=e}}function fS(n,e){let t;if(e.document)t=k0(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=he.fromSegments(e.noDocument.path),s=wi(e.noDocument.readTime);t=gt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return me();{const r=he.fromSegments(e.unknownDocument.path),s=wi(e.unknownDocument.version);t=gt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Rt(s[0],s[1]);return we.fromTimestamp(i)}(e.readTime)),t}function Mg(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:iu(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:ul(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Ro(i,o.version.toTimestamp()),createTime:Ro(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:vi(e.version)};else{if(!e.isUnknownDocument())return me();r.unknownDocument={path:t.path.toArray(),version:vi(e.version)}}return r}function iu(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function vi(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function wi(n){const e=new Rt(n.seconds,n.nanoseconds);return we.fromTimestamp(e)}function ri(n,e){const t=(e.baseMutations||[]).map(i=>Oh(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Oh(n.ct,i)),s=Rt.fromMillis(e.localWriteTimeMs);return new Pf(e.batchId,s,t,r)}function Da(n){const e=wi(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?wi(n.lastLimboFreeSnapshotVersion):we.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return _e(i.documents.length===1),wn($o(R0(i.documents[0])))}(n.query):function(i){return wn(N0(i))}(n.query),new Vr(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Vt.fromBase64String(n.resumeToken))}function U0(n,e){const t=vi(e.snapshotVersion),r=vi(e.lastLimboFreeSnapshotVersion);let s;s=tu(e.target)?D0(n.ct,e.target):ju(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:gi(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Df(n){const e=N0({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ru(e,e.limit,"L"):e}function zd(n,e){return new Rf(e.largestBatchId,Oh(n.ct,e.overlayMutation))}function Lg(n,e){const t=e.path.lastSegment();return[n,vn(e.path.popLast()),t]}function Fg(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:vi(r.readTime),documentKey:vn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pS{getBundleMetadata(e,t){return Ug(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:wi(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return Ug(e).put(function(s){return{bundleId:s.id,createTime:vi(Ut(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return Bg(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Df(i.bundledQuery),readTime:wi(i.readTime)}}(r)})}saveNamedQuery(e,t){return Bg(e).put(function(s){return{name:s.name,readTime:vi(Ut(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function Ug(n){return Qt(n,"bundles")}function Bg(n){return Qt(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new qu(e,r)}getOverlay(e,t){return va(e).get(Lg(this.userId,t)).next(r=>r?zd(this.serializer,r):null)}getOverlays(e,t){const r=fr();return N.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Rf(t,o);s.push(this.ht(e,a))}),N.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(vn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(va(e).j("collectionPathOverlayIndex",a))}),N.waitFor(i)}getOverlaysForCollection(e,t,r){const s=fr(),i=vn(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return va(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const u=zd(this.serializer,l);s.set(u.getKey(),u)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=fr();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return va(e).J({index:"collectionGroupOverlayIndex",range:a},(l,u,d)=>{const f=zd(this.serializer,u);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>i)}ht(e,t){return va(e).put(function(s,i,o){const[a,l,u]=Lg(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:dl(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function va(n){return Qt(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mS{Pt(e){return Qt(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?Vt.fromUint8Array(r):Vt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class si{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(wt(e.integerValue));else if("doubleValue"in e){const r=wt(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),il(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=jr(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(qr(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?Hv(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Uu(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):me()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(wt(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),he.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}si.vt=new si;function gS(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function $g(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=gS(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class _S{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=$g(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=$g(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class yS{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class vS{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class wa{constructor(){this.jt=new _S,this.Ht=new yS(this.jt),this.Jt=new vS(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ii{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new ii(this.indexId,this.documentKey,this.arrayValue,r)}}function as(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=jg(n.arrayValue,e.arrayValue),t!==0?t:(t=jg(n.directionalValue,e.directionalValue),t!==0?t:he.comparator(n.documentKey,e.documentKey)))}function jg(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qg{constructor(e){this.Xt=new it((t,r)=>bt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(_e(e.collectionGroup===this.collectionId),this.nn)return!1;const t=Th(e);if(t!==void 0&&!this.sn(t))return!1;const r=ti(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new it(bt.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new di(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new di(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new di(r.field,r.dir==="asc"?0:1)));return new Eo(Eo.UNKNOWN_ID,this.collectionId,t,To.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B0(n){var e,t;if(_e(n instanceof ze||n instanceof nt),n instanceof ze){if(n instanceof n0){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>ze.create(n.field,"==",i)))||[];return nt.create(s,"or")}return n}const r=n.filters.map(s=>B0(s));return nt.create(r,n.op)}function wS(n){if(n.getFilters().length===0)return[];const e=Fh(B0(n));return _e($0(e)),Mh(e)||Lh(e)?[e]:e.getFilters()}function Mh(n){return n instanceof ze}function Lh(n){return n instanceof nt&&If(n)}function $0(n){return Mh(n)||Lh(n)||function(t){if(t instanceof nt&&Sh(t)){for(const r of t.getFilters())if(!Mh(r)&&!Lh(r))return!1;return!0}return!1}(n)}function Fh(n){if(_e(n instanceof ze||n instanceof nt),n instanceof ze)return n;if(n.filters.length===1)return Fh(n.filters[0]);const e=n.filters.map(r=>Fh(r));let t=nt.create(e,n.op);return t=ou(t),$0(t)?t:(_e(t instanceof nt),_e(xo(t)),_e(t.filters.length>1),t.filters.reduce((r,s)=>Vf(r,s)))}function Vf(n,e){let t;return _e(n instanceof ze||n instanceof nt),_e(e instanceof ze||e instanceof nt),t=n instanceof ze?e instanceof ze?function(s,i){return nt.create([s,i],"and")}(n,e):zg(n,e):e instanceof ze?zg(e,n):function(s,i){if(_e(s.filters.length>0&&i.filters.length>0),xo(s)&&xo(i))return Zv(s,i.getFilters());const o=Sh(s)?s:i,a=Sh(s)?i:s,l=o.filters.map(u=>Vf(u,a));return nt.create(l,"or")}(n,e),ou(t)}function zg(n,e){if(xo(e))return Zv(e,n.getFilters());{const t=e.filters.map(r=>Vf(n,r));return nt.create(t,"or")}}function ou(n){if(_e(n instanceof ze||n instanceof nt),n instanceof ze)return n;const e=n.getFilters();if(e.length===1)return ou(e[0]);if(Yv(n))return n;const t=e.map(s=>ou(s)),r=[];return t.forEach(s=>{s instanceof ze?r.push(s):s instanceof nt&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:nt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bS{constructor(){this.un=new Nf}addToCollectionParentIndex(e,t){return this.un.add(t),N.resolve()}getCollectionParents(e,t){return N.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return N.resolve()}deleteFieldIndex(e,t){return N.resolve()}deleteAllFieldIndexes(e){return N.resolve()}createTargetIndexes(e,t){return N.resolve()}getDocumentsMatchingTarget(e,t){return N.resolve(null)}getIndexType(e,t){return N.resolve(0)}getFieldIndexes(e,t){return N.resolve([])}getNextCollectionGroupToUpdate(e){return N.resolve(null)}getMinOffset(e,t){return N.resolve(Gn.min())}getMinOffsetFromCollectionGroup(e,t){return N.resolve(Gn.min())}updateCollectionGroup(e,t,r){return N.resolve()}updateIndexEntries(e,t){return N.resolve()}}class Nf{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new it(qe.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new it(qe.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yc=new Uint8Array(0);class IS{constructor(e,t){this.databaseId=t,this.cn=new Nf,this.ln=new Jr(r=>gi(r),(r,s)=>Sl(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:vn(s)};return Gg(e).put(i)}return N.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[Vv(t),""],!1,!0);return Gg(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(hr(o.parent))}return r})}addFieldIndex(e,t){const r=ba(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Wi(e);return i.next(a=>{o.put(Fg(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=ba(e),s=Wi(e),i=Hi(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=ba(e),r=Hi(e),s=Wi(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return N.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new qg(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Hi(e);let s=!0;const i=new Map;return N.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Oe();const a=[];return N.forEach(i,(l,u)=>{J("IndexedDbIndexManager",`Using index ${function($){return`id=${$.indexId}|cg=${$.collectionGroup}|f=${$.fields.map(j=>`${j.fieldPath}:${j.kind}`).join(",")}`}(l)} to execute ${gi(t)}`);const d=function($,j){const O=Th(j);if(O===void 0)return null;for(const ie of nu($,O.fieldPath))switch(ie.op){case"array-contains-any":return ie.value.arrayValue.values||[];case"array-contains":return[ie.value]}return null}(u,l),f=function($,j){const O=new Map;for(const ie of ti(j))for(const x of nu($,ie.fieldPath))switch(x.op){case"==":case"in":O.set(ie.fieldPath.canonicalString(),x.value);break;case"not-in":case"!=":return O.set(ie.fieldPath.canonicalString(),x.value),Array.from(O.values())}return null}(u,l),g=function($,j){const O=[];let ie=!0;for(const x of ti(j)){const w=x.kind===0?Eg($,x.fieldPath,$.startAt):Tg($,x.fieldPath,$.startAt);O.push(w.value),ie&&(ie=w.inclusive)}return new Vs(O,ie)}(u,l),_=function($,j){const O=[];let ie=!0;for(const x of ti(j)){const w=x.kind===0?Tg($,x.fieldPath,$.endAt):Eg($,x.fieldPath,$.endAt);O.push(w.value),ie&&(ie=w.inclusive)}return new Vs(O,ie)}(u,l),k=this.In(l,u,g),P=this.In(l,u,_),R=this.Tn(l,u,f),L=this.En(l.indexId,d,k,g.inclusive,P,_.inclusive,R);return N.forEach(L,B=>r.G(B,t.limit).next($=>{$.forEach(j=>{const O=he.fromSegments(j.documentKey);o.has(O)||(o=o.add(O),a.push(O))})}))}).next(()=>a)}return N.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=wS(nt.create(e.filters,"and")).map(r=>Ch(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),u=l/(t!=null?t.length:1),d=[];for(let f=0;f<l;++f){const g=t?this.dn(t[f/u]):yc,_=this.An(e,g,r[f%u],s),k=this.Rn(e,g,i[f%u],o),P=a.map(R=>this.An(e,g,R,!0));d.push(...this.createRange(_,k,P))}return d}An(e,t,r,s){const i=new ii(e,he.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new ii(e,he.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new qg(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return N.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let u=new it(bt.comparator),d=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?d=!0:u=u.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(u=u.add(f.field));return u.size+(d?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new wa;for(const s of ti(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);si.vt.It(i,o)}return r.zt()}dn(e){const t=new wa;return si.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new wa;return si.vt.It(mi(this.databaseId,t),r.Yt(function(i){const o=ti(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new wa);let i=0;for(const o of ti(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&ll(a))s=this.gn(s,o,a);else{const u=l.Yt(o.kind);si.vt.It(a,u)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new wa;l.seed(a.zt()),si.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof ze&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=ba(e),s=Wi(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return N.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(d,f){const g=f?new To(f.sequenceNumber,new Gn(wi(f.readTime),new he(hr(f.documentKey)),f.largestBatchId)):To.empty(),_=d.fields.map(([k,P])=>new di(bt.fromServerFormat(k),P));return new Eo(d.indexId,d.collectionGroup,_,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:xe(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=ba(e),i=Wi(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>N.forEach(a,l=>i.put(Fg(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return N.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?N.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),N.forEach(a,l=>this.wn(e,s,l).next(u=>{const d=this.Sn(i,l);return u.isEqual(d)?N.resolve():this.bn(e,i,l,u,d)}))))})}Dn(e,t,r,s){return Hi(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return Hi(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=Hi(e);let i=new it(as);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new ii(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new it(as);const s=this.Vn(t,e);if(s==null)return r;const i=Th(t);if(i!=null){const o=e.data.field(i.fieldPath);if(ll(o))for(const a of o.arrayValue.values||[])r=r.add(new ii(t.indexId,e.key,this.dn(a),s))}else r=r.add(new ii(t.indexId,e.key,yc,s));return r}bn(e,t,r,s,i){J("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,u,d,f,g){const _=l.getIterator(),k=u.getIterator();let P=Ki(_),R=Ki(k);for(;P||R;){let L=!1,B=!1;if(P&&R){const $=d(P,R);$<0?B=!0:$>0&&(L=!0)}else P!=null?B=!0:L=!0;L?(f(R),R=Ki(k)):B?(g(P),P=Ki(_)):(P=Ki(_),R=Ki(k))}}(s,i,as,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),N.waitFor(o)}yn(e){let t=1;return Wi(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>as(o,a)).filter((o,a,l)=>!a||as(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=as(o,e),l=as(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,yc,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,yc,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return as(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Kg)}getMinOffset(e,t){return N.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||me())).next(Kg)}}function Gg(n){return Qt(n,"collectionParents")}function Hi(n){return Qt(n,"indexEntries")}function ba(n){return Qt(n,"indexConfiguration")}function Wi(n){return Qt(n,"indexState")}function Kg(n){_e(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;vf(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Gn(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hg={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class mn{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new mn(e,mn.DEFAULT_COLLECTION_PERCENTILE,mn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j0(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(d,f,g)=>(a++,g.delete()));i.push(l.next(()=>{_e(a===1)}));const u=[];for(const d of t.mutations){const f=Bv(e,d.key.path,t.batchId);i.push(s.delete(f)),u.push(d.key)}return N.waitFor(i).next(()=>u)}function au(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw me();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */mn.DEFAULT_COLLECTION_PERCENTILE=10,mn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,mn.DEFAULT=new mn(41943040,mn.DEFAULT_COLLECTION_PERCENTILE,mn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),mn.DISABLED=new mn(-1,0,0);class zu{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){_e(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new zu(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ls(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=no(e),o=ls(e);return o.add({}).next(a=>{_e(typeof a=="number");const l=new Pf(a,t,r,s),u=function(_,k,P){const R=P.baseMutations.map(B=>dl(_.ct,B)),L=P.mutations.map(B=>dl(_.ct,B));return{userId:k,batchId:P.batchId,localWriteTimeMs:P.localWriteTime.toMillis(),baseMutations:R,mutations:L}}(this.serializer,this.userId,l),d=[];let f=new it((g,_)=>xe(g.canonicalString(),_.canonicalString()));for(const g of s){const _=Bv(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),d.push(o.put(u)),d.push(i.put(_,uP))}return f.forEach(g=>{d.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),N.waitFor(d).next(()=>l)})}lookupMutationBatch(e,t){return ls(e).get(t).next(r=>r?(_e(r.userId===this.userId),ri(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?N.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ls(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(_e(a.batchId>=r),i=ri(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ls(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ls(e).U("userMutationsIndex",t).next(r=>r.map(s=>ri(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=kc(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return no(e).J({range:s},(o,a,l)=>{const[u,d,f]=o,g=hr(d);if(u===this.userId&&t.path.isEqual(g))return ls(e).get(f).next(_=>{if(!_)throw me();_e(_.userId===this.userId),i.push(ri(this.serializer,_))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new it(xe);const s=[];return t.forEach(i=>{const o=kc(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=no(e).J({range:a},(u,d,f)=>{const[g,_,k]=u,P=hr(_);g===this.userId&&i.path.isEqual(P)?r=r.add(k):f.done()});s.push(l)}),N.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=kc(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new it(xe);return no(e).J({range:o},(l,u,d)=>{const[f,g,_]=l,k=hr(g);f===this.userId&&r.isPrefixOf(k)?k.length===s&&(a=a.add(_)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ls(e).get(i).next(o=>{if(o===null)throw me();_e(o.userId===this.userId),r.push(ri(this.serializer,o))}))}),N.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return j0(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),N.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return N.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return no(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=hr(i[1]);s.push(l)}else a.done()}).next(()=>{_e(s.length===0)})})}containsKey(e,t){return q0(e,this.userId,t)}Nn(e){return z0(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function q0(n,e,t){const r=kc(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return no(n).J({range:i,H:!0},(a,l,u)=>{const[d,f,g]=a;d===e&&f===s&&(o=!0),u.done()}).next(()=>o)}function ls(n){return Qt(n,"mutations")}function no(n){return Qt(n,"documentMutations")}function z0(n){return Qt(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bi{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new bi(0)}static kn(){return new bi(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ES{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new bi(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>we.fromTimestamp(new Rt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Qi(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(_e(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Qi(e).J((o,a)=>{const l=Da(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>N.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Qi(e).J((r,s)=>{const i=Da(s);t(i)})}qn(e){return Wg(e).get("targetGlobalKey").next(t=>(_e(t!==null),t))}Qn(e,t){return Wg(e).put("targetGlobalKey",t)}Kn(e,t){return Qi(e).put(U0(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=gi(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Qi(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const u=Da(a);Sl(t,u.target)&&(i=u,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=gs(e);return t.forEach(o=>{const a=vn(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),N.waitFor(s)}removeMatchingKeys(e,t,r){const s=gs(e);return N.forEach(t,i=>{const o=vn(i.path);return N.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=gs(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=gs(e);let i=Oe();return s.J({range:r,H:!0},(o,a,l)=>{const u=hr(o[1]),d=new he(u);i=i.add(d)}).next(()=>i)}containsKey(e,t){const r=vn(t.path),s=IDBKeyRange.bound([r],[Vv(r)],!1,!0);let i=0;return gs(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,u)=>{o!==0&&(i++,u.done())}).next(()=>i>0)}ot(e,t){return Qi(e).get(t).next(r=>r?Da(r):null)}}function Qi(n){return Qt(n,"targets")}function Wg(n){return Qt(n,"targetGlobal")}function gs(n){return Qt(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qg([n,e],[t,r]){const s=xe(n,t);return s===0?xe(e,r):s}class TS{constructor(e){this.Un=e,this.buffer=new it(Qg),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Qg(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class G0{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){J("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Bs(t)?J("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Us(t)}await this.Hn(3e5)})}}class AS{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return N.resolve(Vn.oe);const r=new TS(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(J("LruGarbageCollector","Garbage collection skipped; disabled"),N.resolve(Hg)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(J("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Hg):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,u;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(J("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(u=Date.now(),Zi()<=je.DEBUG&&J("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(u-l)+`ms
Total Duration: ${u-d}ms`),N.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function K0(n,e){return new AS(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xS{constructor(e,t){this.db=e,this.garbageCollector=K0(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return vc(e,r)}removeReference(e,t,r){return vc(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return vc(e,t)}nr(e,t){return function(s,i){let o=!1;return z0(s).Y(a=>q0(s,a,i).next(l=>(l&&(o=!0),N.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(u=>{if(!u)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,we.min()),gs(e).delete(function(f){return[0,vn(f.path)]}(o))))});s.push(l)}}).next(()=>N.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return vc(e,t)}tr(e,t){const r=gs(e);let s,i=Vn.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:u})=>{o===0?(i!==Vn.oe&&t(new he(hr(s)),i),i=u,s=l):i=Vn.oe}).next(()=>{i!==Vn.oe&&t(new he(hr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function vc(n,e){return gs(n).put(function(r,s){return{targetId:0,path:vn(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H0{constructor(){this.changes=new Jr(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,gt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?N.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PS{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Xs(e).put(r)}removeEntry(e,t,r){return Xs(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],iu(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=gt.newInvalidDocument(t);return Xs(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ia(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:gt.newInvalidDocument(t)};return Xs(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ia(t))},(s,i)=>{r={document:this.ir(t,i),size:au(i)}}).next(()=>r)}getEntries(e,t){let r=On();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=On(),s=new ft(he.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,au(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return N.resolve();let s=new it(Xg);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Ia(s.first()),Ia(s.last())),o=s.getIterator();let a=o.getNext();return Xs(e).J({index:"documentKeyIndex",range:i},(l,u,d)=>{const f=he.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&Xg(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?d.$(Ia(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),iu(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Xs(e).U(IDBKeyRange.bound(a,l,!0)).next(u=>{i==null||i.incrementDocumentReadCount(u.length);let d=On();for(const f of u){const g=this.ir(he.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(Cl(t,g)||s.has(g.key))&&(d=d.insert(g.key,g))}return d})}getAllFromCollectionGroup(e,t,r,s){let i=On();const o=Yg(t,r),a=Yg(t,Gn.max());return Xs(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,u,d)=>{const f=this.ir(he.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(f.key,f),i.size===s&&d.done()}).next(()=>i)}newChangeBuffer(e){return new SS(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Jg(e).get("remoteDocumentGlobalKey").next(t=>(_e(!!t),t))}rr(e,t){return Jg(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=fS(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(we.min())))return r}return gt.newInvalidDocument(e)}}function W0(n){return new PS(n)}class SS extends H0{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Jr(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new it((i,o)=>xe(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=Mg(this.cr.serializer,o);s=s.add(i.path.popLast());const u=au(l);r+=u-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=Mg(this.cr.serializer,o.convertToNoDocument(we.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),N.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function Jg(n){return Qt(n,"remoteDocumentGlobal")}function Xs(n){return Qt(n,"remoteDocumentsV14")}function Ia(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Yg(n,e){const t=e.documentKey.path.toArray();return[n,iu(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Xg(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=xe(t[i],r[i]),s)return s;return s=xe(t.length,r.length),s||(s=xe(t[t.length-2],r[r.length-2]),s||xe(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RS{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q0{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Ka(r.mutation,s,Nn.empty(),Rt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Oe()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Oe()){const s=fr();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Ca();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=fr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Oe()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=On();const o=Ga(),a=function(){return Ga()}();return t.forEach((l,u)=>{const d=r.get(u.key);s.has(u.key)&&(d===void 0||d.mutation instanceof Yr)?i=i.insert(u.key,u):d!==void 0?(o.set(u.key,d.mutation.getFieldMask()),Ka(d.mutation,u,d.mutation.getFieldMask(),Rt.now())):o.set(u.key,Nn.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,d)=>o.set(u,d)),t.forEach((u,d)=>{var f;return a.set(u,new RS(d,(f=o.get(u))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Ga();let s=new ft((o,a)=>o-a),i=Oe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let d=r.get(l)||Nn.empty();d=a.applyToLocalView(u,d),r.set(l,d);const f=(s.get(a.batchId)||Oe()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,d=l.value,f=d0();d.forEach(g=>{if(!i.has(g)){const _=y0(t.get(g),r.get(g));_!==null&&f.set(g,_),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return N.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return he.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Ef(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):N.resolve(fr());let a=-1,l=i;return o.next(u=>N.forEach(u,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(d)?N.resolve():this.remoteDocumentCache.getEntry(e,d).next(g=>{l=l.insert(d,g)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,Oe())).next(d=>({batchId:a,changes:u0(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new he(t)).next(r=>{let s=Ca();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Ca();return this.indexManager.getCollectionParents(e,i).next(a=>N.forEach(a,l=>{const u=function(f,g){return new Qr(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(d=>{d.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,u)=>{const d=u.getKey();o.get(d)===null&&(o=o.insert(d,gt.newInvalidDocument(d)))});let a=Ca();return o.forEach((l,u)=>{const d=i.get(l);d!==void 0&&Ka(d.mutation,u,Nn.empty(),Rt.now()),Cl(t,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CS{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return N.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Ut(s.createTime)}}(t)),N.resolve()}getNamedQuery(e,t){return N.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Df(s.bundledQuery),readTime:Ut(s.readTime)}}(t)),N.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kS{constructor(){this.overlays=new ft(he.comparator),this.Ir=new Map}getOverlay(e,t){return N.resolve(this.overlays.get(t))}getOverlays(e,t){const r=fr();return N.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),N.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),N.resolve()}getOverlaysForCollection(e,t,r){const s=fr(),i=t.length+1,o=new he(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return N.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new ft((u,d)=>u-d);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let d=i.get(u.largestBatchId);d===null&&(d=fr(),i=i.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}const a=fr(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,d)=>a.set(u,d)),!(a.size()>=s)););return N.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Rf(t,r));let i=this.Ir.get(t);i===void 0&&(i=Oe(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DS{constructor(){this.sessionToken=Vt.EMPTY_BYTE_STRING}getSessionToken(e){return N.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,N.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Of{constructor(){this.Tr=new it(Yt.Er),this.dr=new it(Yt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new Yt(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Yt(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new he(new qe([])),r=new Yt(t,e),s=new Yt(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new he(new qe([])),r=new Yt(t,e),s=new Yt(t,e+1);let i=Oe();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Yt(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Yt{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return he.comparator(e.key,t.key)||xe(e.wr,t.wr)}static Ar(e,t){return xe(e.wr,t.wr)||he.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VS{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new it(Yt.Er)}checkEmpty(e){return N.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Pf(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new Yt(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return N.resolve(o)}lookupMutationBatch(e,t){return N.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return N.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return N.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return N.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Yt(t,0),s=new Yt(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),N.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new it(xe);return t.forEach(s=>{const i=new Yt(s,0),o=new Yt(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),N.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;he.isDocumentKey(i)||(i=i.child(""));const o=new Yt(new he(i),0);let a=new it(xe);return this.br.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(l.wr)),!0)},o),N.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){_e(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return N.forEach(t.mutations,s=>{const i=new Yt(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new Yt(t,0),s=this.br.firstAfterOrEqual(r);return N.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,N.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NS{constructor(e){this.Mr=e,this.docs=function(){return new ft(he.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return N.resolve(r?r.document.mutableCopy():gt.newInvalidDocument(t))}getEntries(e,t){let r=On();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():gt.newInvalidDocument(s))}),N.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=On();const o=t.path,a=new he(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:d}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||vf(Ov(d),r)<=0||(s.has(d.key)||Cl(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return N.resolve(i)}getAllFromCollectionGroup(e,t,r,s){me()}Or(e,t){return N.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new OS(this)}getSize(e){return N.resolve(this.size)}}class OS extends H0{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),N.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MS{constructor(e){this.persistence=e,this.Nr=new Jr(t=>gi(t),Sl),this.lastRemoteSnapshotVersion=we.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Of,this.targetCount=0,this.kr=bi.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),N.resolve()}getLastRemoteSnapshotVersion(e){return N.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return N.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),N.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),N.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new bi(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,N.resolve()}updateTargetData(e,t){return this.Kn(t),N.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,N.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),N.waitFor(i).next(()=>s)}getTargetCount(e){return N.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return N.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),N.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),N.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),N.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return N.resolve(r)}containsKey(e,t){return N.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mf{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Vn(0),this.Kr=!1,this.Kr=!0,this.$r=new DS,this.referenceDelegate=e(this),this.Ur=new MS(this),this.indexManager=new bS,this.remoteDocumentCache=function(s){return new NS(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new F0(t),this.Gr=new CS(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new kS,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new VS(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){J("MemoryPersistence","Starting transaction:",e);const s=new LS(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return N.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class LS extends Lv{constructor(e){super(),this.currentSequenceNumber=e}}class Gu{constructor(e){this.persistence=e,this.Jr=new Of,this.Yr=null}static Zr(e){return new Gu(e)}get Xr(){if(this.Yr)return this.Yr;throw me()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),N.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),N.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),N.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return N.forEach(this.Xr,r=>{const s=he.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,we.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return N.or([()=>N.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class lu{constructor(e,t){this.persistence=e,this.ti=new Jr(r=>vn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=K0(this,t)}static Zr(e,t){return new lu(e,t)}zr(){}jr(e){return N.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return N.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?N.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,we.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),N.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),N.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),N.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),N.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Vc(e.data.value)),t}nr(e,t,r){return N.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return N.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FS{constructor(e){this.serializer=e}O(e,t,r,s){const i=new Mu("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",hg,{unique:!0}),l.createObjectStore("documentMutations")}(e),Zg(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=N.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),Zg(e)),o=o.next(()=>function(l){const u=l.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:we.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",d)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,u){return u.store("mutations").U().next(d=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",hg,{unique:!0});const f=u.store("mutations"),g=d.map(_=>f.put(_));return N.waitFor(g)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const u=l.createObjectStore("documentOverlays",{keyPath:IP});u.createIndex("collectionPathOverlayIndex",EP,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",TP,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const u=l.createObjectStore("remoteDocumentsV14",{keyPath:dP});u.createIndex("documentKeyIndex",hP),u.createIndex("collectionGroupIndex",fP)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:yP}).createIndex("sequenceNumberIndex",vP,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:wP}).createIndex("documentKeyIndex",bP,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=au(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>N.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>N.forEach(a,l=>{_e(l.userId===i.userId);const u=ri(this.serializer,l);return j0(e,i.userId,u).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new qe(o),u=function(f){return[0,vn(f)]}(l);i.push(t.get(u).next(d=>d?N.resolve():(f=>t.put({targetId:0,path:vn(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>N.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:_P});const r=t.store("collectionParents"),s=new Nf,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:vn(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new qe(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],u)=>{const d=hr(a);return i(d.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=Da(s),o=U0(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new he(qe.fromString(f.document.name).popFirst(5)):f.noDocument?he.fromSegments(f.noDocument.path):f.unknownDocument?he.fromSegments(f.unknownDocument.path):me()}(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))}).next(()=>N.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=W0(this.serializer),i=new Mf(Gu.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var u;let d=(u=a.get(l.userId))!==null&&u!==void 0?u:Oe();ri(this.serializer,l).keys().forEach(f=>d=d.add(f)),a.set(l.userId,d)}),N.forEach(a,(l,u)=>{const d=new Xt(u),f=qu.lt(this.serializer,d),g=i.getIndexManager(d),_=zu.lt(d,this.serializer,g,i.referenceDelegate);return new Q0(s,_,f,g).recalculateAndSaveOverlaysForDocumentKeys(new Ah(t,Vn.oe),l).next()})})}}function Zg(n){n.createObjectStore("targetDocuments",{keyPath:mP}).createIndex("documentTargetsIndex",gP,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",pP,{unique:!0}),n.createObjectStore("targetGlobal")}const Gd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Lf{constructor(e,t,r,s,i,o,a,l,u,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=u,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!Lf.D())throw new Y(F.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new xS(this,s),this.Ai=t+"main",this.serializer=new F0(l),this.Ri=new mr(this.Ai,this.hi,new FS(this.serializer)),this.$r=new mS,this.Ur=new ES(this.referenceDelegate,this.serializer),this.remoteDocumentCache=W0(this.serializer),this.Gr=new pS,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&Mt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Y(F.FAILED_PRECONDITION,Gd);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Vn(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>wc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Bs(e))return J("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return J("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Ea(e).get("owner").next(t=>N.resolve(this.vi(t)))}Ci(e){return wc(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=Qt(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return N.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?N.resolve(!0):Ea(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new Y(F.FAILED_PRECONDITION,Gd);return!1}}return!(!this.networkEnabled||!this.inForeground)||wc(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&J("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Ah(e,Vn.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>wc(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return zu.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new IS(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return qu.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){J("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?PP:l===16?xP:l===15?bf:l===14?qv:l===13?jv:l===12?AP:l===11?$v:void me()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new Ah(a,this.Qr?this.Qr.next():Vn.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw Mt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new Y(F.FAILED_PRECONDITION,Mv);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Ea(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Y(F.FAILED_PRECONDITION,Gd)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ea(e).put("owner",t)}static D(){return mr.D()}bi(e){const t=Ea(e);return t.get("owner").next(r=>this.vi(r)?(J("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):N.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Mt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;gv()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return J("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Mt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Mt("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Ea(n){return Qt(n,"owner")}function wc(n){return Qt(n,"clientMetadata")}function Ff(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uf{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=Oe(),s=Oe();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Uf(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class US{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J0{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return gv()?8:Fv(Wt())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new US;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(Zi()<=je.DEBUG&&J("QueryEngine","SDK will not create cache indexes for query:",eo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),N.resolve()):(Zi()<=je.DEBUG&&J("QueryEngine","Query:",eo(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Zi()<=je.DEBUG&&J("QueryEngine","The SDK decides to create cache indexes for query:",eo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,wn(t))):N.resolve())}Yi(e,t){if(Ag(t))return N.resolve(null);let r=wn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=ru(t,null,"F"),r=wn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Oe(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.ts(t,a);return this.ns(t,u,o,l.readTime)?this.Yi(e,ru(t,null,"F")):this.rs(e,u,t,l)}))})))}Zi(e,t,r,s){return Ag(t)||s.isEqual(we.min())?N.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?N.resolve(null):(Zi()<=je.DEBUG&&J("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),eo(t)),this.rs(e,o,t,Nv(s,-1)).next(a=>a))})}ts(e,t){let r=new it(l0(e));return t.forEach((s,i)=>{Cl(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return Zi()<=je.DEBUG&&J("QueryEngine","Using full collection scan to execute query:",eo(t)),this.Ji.getDocumentsMatchingQuery(e,t,Gn.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BS{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new ft(xe),this._s=new Jr(i=>gi(i),Sl),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Q0(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function Y0(n,e,t,r){return new BS(n,e,t,r)}async function X0(n,e){const t=ae(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=Oe();for(const u of s){o.push(u.batchId);for(const d of u.mutations)l=l.add(d.key)}for(const u of i){a.push(u.batchId);for(const d of u.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(r,l).next(u=>({hs:u,removedBatchIds:o,addedBatchIds:a}))})})}function $S(n,e){const t=ae(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,u,d){const f=u.batch,g=f.keys();let _=N.resolve();return g.forEach(k=>{_=_.next(()=>d.getEntry(l,k)).next(P=>{const R=u.docVersions.get(k);_e(R!==null),P.version.compareTo(R)<0&&(f.applyToRemoteDocument(P,u),P.isValidDocument()&&(P.setReadTime(u.commitVersion),d.addEntry(P)))})}),_.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=Oe();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function Z0(n){const e=ae(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function jS(n,e){const t=ae(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((d,f)=>{const g=s.get(f);if(!g)return;a.push(t.Ur.removeMatchingKeys(i,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,d.addedDocuments,f)));let _=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?_=_.withResumeToken(Vt.EMPTY_BYTE_STRING,we.min()).withLastLimboFreeSnapshotVersion(we.min()):d.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(d.resumeToken,r)),s=s.insert(f,_),function(P,R,L){return P.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-P.snapshotVersion.toMicroseconds()>=3e8?!0:L.addedDocuments.size+L.modifiedDocuments.size+L.removedDocuments.size>0}(g,_,d)&&a.push(t.Ur.updateTargetData(i,_))});let l=On(),u=Oe();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),a.push(ew(i,o,e.documentUpdates).next(d=>{l=d.Ps,u=d.Is})),!r.isEqual(we.min())){const d=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(d)}return N.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,u)).next(()=>l)}).then(i=>(t.os=s,i))}function ew(n,e,t){let r=Oe(),s=Oe();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=On();return t.forEach((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(we.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):J("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function qS(n,e){const t=ae(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Co(n,e){const t=ae(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,N.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new Vr(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function ko(n,e,t){const r=ae(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Bs(o))throw o;J("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function cu(n,e,t){const r=ae(n);let s=we.min(),i=Oe();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,d){const f=ae(l),g=f._s.get(d);return g!==void 0?N.resolve(f.os.get(g)):f.Ur.getTargetData(u,d)}(r,o,wn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:we.min(),t?i:Oe())).next(a=>(rw(r,a0(e),a),{documents:a,Ts:i})))}function tw(n,e){const t=ae(n),r=ae(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function nw(n,e){const t=ae(n),r=t.us.get(e)||we.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,Nv(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(rw(t,e,s),s))}function rw(n,e,t){let r=n.us.get(e)||we.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function zS(n,e,t,r){const s=ae(n);let i=Oe(),o=On();for(const u of t){const d=e.Es(u.metadata.name);u.document&&(i=i.add(d));const f=e.ds(u);f.setReadTime(e.As(u.metadata.readTime)),o=o.insert(d,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await Co(s,function(d){return wn($o(qe.fromString(`__bundle__/docs/${d}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",u=>ew(u,a,o).next(d=>(a.apply(u),d)).next(d=>s.Ur.removeMatchingKeysForTargetId(u,l.targetId).next(()=>s.Ur.addMatchingKeys(u,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(u,d.Ps,d.Is)).next(()=>d.Ps)))}async function GS(n,e,t=Oe()){const r=await Co(n,wn(Df(e.bundledQuery))),s=ae(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=Ut(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(Vt.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function e_(n,e){return`firestore_clients_${n}_${e}`}function t_(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Kd(n,e){return`firestore_targets_${n}_${e}`}class uu{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new Y(s.error.code,s.error.message))),o?new uu(e,t,s.state,i):(Mt("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ha{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new Y(r.error.code,r.error.message))),i?new Ha(e,r.state,s):(Mt("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class du{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Tf();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=Uv(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new du(e,i):(Mt("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Bf{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Bf(t.clientId,t.onlineState):(Mt("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Uh{constructor(){this.activeTargetIds=Tf()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Hd{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new ft(xe),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=e_(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Uh),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(e_(this.persistenceKey,r));if(s){const i=du.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Kd(this.persistenceKey,e));if(s){const i=Ha.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Kd(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return J("SharedClientState","READ",e,t),t}setItem(e,t){J("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){J("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(J("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Mt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=Vn.oe;if(i!=null)try{const a=JSON.parse(i);_e(typeof a=="number"),o=a}catch(a){Mt("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Vn.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new uu(this.currentUser,e,t,r),i=t_(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=t_(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Kd(this.persistenceKey,e),i=new Ha(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return du.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return uu.Rs(new Xt(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return Ha.Rs(s,t)}Ls(e){return Bf.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);J("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Tf();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class sw{constructor(){this.so=new Uh,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Uh,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KS{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n_{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){J("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){J("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bc=null;function Wd(){return bc===null?bc=function(){return 268435456+Math.round(2147483648*Math.random())}():bc++,"0x"+bc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HS={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WS{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pn="WebChannelConnection";class QS extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=Wd(),l=this.xo(t,r.toUriEncodedString());J("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,i,o),this.No(t,l,u,s).then(d=>(J("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw Jn("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",l,"request:",s),d})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Bo}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=HS[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Wd();return new Promise((o,a)=>{const l=new Av;l.setWithCredentials(!0),l.listenOnce(xv.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Cc.NO_ERROR:const d=l.getResponseJson();J(pn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(d)),o(d);break;case Cc.TIMEOUT:J(pn,`RPC '${e}' ${i} timed out`),a(new Y(F.DEADLINE_EXCEEDED,"Request time out"));break;case Cc.HTTP_ERROR:const f=l.getStatus();if(J(pn,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const _=g==null?void 0:g.error;if(_&&_.status&&_.message){const k=function(R){const L=R.toLowerCase().replace(/_/g,"-");return Object.values(F).indexOf(L)>=0?L:F.UNKNOWN}(_.status);a(new Y(k,_.message))}else a(new Y(F.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new Y(F.UNAVAILABLE,"Connection failed."));break;default:me()}}finally{J(pn,`RPC '${e}' ${i} completed.`)}});const u=JSON.stringify(s);J(pn,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",u,r,15)})}Bo(e,t,r){const s=Wd(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Rv(),a=Sv(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=i.join("");J(pn,`Creating RPC '${e}' stream ${s}: ${d}`,l);const f=o.createWebChannel(d,l);let g=!1,_=!1;const k=new WS({Io:R=>{_?J(pn,`Not sending because RPC '${e}' stream ${s} is closed:`,R):(g||(J(pn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),J(pn,`RPC '${e}' stream ${s} sending:`,R),f.send(R))},To:()=>f.close()}),P=(R,L,B)=>{R.listen(L,$=>{try{B($)}catch(j){setTimeout(()=>{throw j},0)}})};return P(f,Ra.EventType.OPEN,()=>{_||(J(pn,`RPC '${e}' stream ${s} transport opened.`),k.yo())}),P(f,Ra.EventType.CLOSE,()=>{_||(_=!0,J(pn,`RPC '${e}' stream ${s} transport closed`),k.So())}),P(f,Ra.EventType.ERROR,R=>{_||(_=!0,Jn(pn,`RPC '${e}' stream ${s} transport errored:`,R),k.So(new Y(F.UNAVAILABLE,"The operation could not be completed")))}),P(f,Ra.EventType.MESSAGE,R=>{var L;if(!_){const B=R.data[0];_e(!!B);const $=B,j=$.error||((L=$[0])===null||L===void 0?void 0:L.error);if(j){J(pn,`RPC '${e}' stream ${s} received error:`,j);const O=j.status;let ie=function(I){const S=qt[I];if(S!==void 0)return I0(S)}(O),x=j.message;ie===void 0&&(ie=F.INTERNAL,x="Unknown error status: "+O+" with message "+j.message),_=!0,k.So(new Y(ie,x)),f.close()}else J(pn,`RPC '${e}' stream ${s} received:`,B),k.bo(B)}}),P(a,Pv.STAT_EVENT,R=>{R.stat===Eh.PROXY?J(pn,`RPC '${e}' stream ${s} detected buffering proxy`):R.stat===Eh.NOPROXY&&J(pn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{k.wo()},0),k}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iw(){return typeof window<"u"?window:null}function Lc(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nl(n){return new rS(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $f{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&J("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ow{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new $f(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===F.RESOURCE_EXHAUSTED?(Mt(t.toString()),Mt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===F.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new Y(F.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return J("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(J("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class JS extends ow{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=oS(this.serializer,e),r=function(i){if(!("targetChange"in i))return we.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?we.min():o.readTime?Ut(o.readTime):we.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=Nh(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=tu(l)?{documents:D0(i,l)}:{query:ju(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=x0(i,o.resumeToken);const u=Dh(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(we.min())>0){a.readTime=Ro(i,o.snapshotVersion.toTimestamp());const u=Dh(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=lS(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=Nh(this.serializer),t.removeTarget=e,this.a_(t)}}class YS extends ow{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return _e(!!e.streamToken),this.lastStreamToken=e.streamToken,_e(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){_e(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=aS(e.writeResults,e.commitTime),r=Ut(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=Nh(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>dl(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XS extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new Y(F.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Vh(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Y(F.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Vh(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Y(F.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class ZS{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Mt(t),this.D_=!1):J("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eR{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{js(this)&&(J("RemoteStore","Restarting streams for network reachability change."),await async function(l){const u=ae(l);u.L_.add(4),await zo(u),u.q_.set("Unknown"),u.L_.delete(4),await Ol(u)}(this))})}),this.q_=new ZS(r,s)}}async function Ol(n){if(js(n))for(const e of n.B_)await e(!0)}async function zo(n){for(const e of n.B_)await e(!1)}function Ku(n,e){const t=ae(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),zf(t)?qf(t):Ko(t).r_()&&jf(t,e))}function Do(n,e){const t=ae(n),r=Ko(t);t.N_.delete(e),r.r_()&&aw(t,e),t.N_.size===0&&(r.r_()?r.o_():js(t)&&t.q_.set("Unknown"))}function jf(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(we.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ko(n).A_(e)}function aw(n,e){n.Q_.xe(e),Ko(n).R_(e)}function qf(n){n.Q_=new ZP({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Ko(n).start(),n.q_.v_()}function zf(n){return js(n)&&!Ko(n).n_()&&n.N_.size>0}function js(n){return ae(n).L_.size===0}function lw(n){n.Q_=void 0}async function tR(n){n.q_.set("Online")}async function nR(n){n.N_.forEach((e,t)=>{jf(n,e)})}async function rR(n,e){lw(n),zf(n)?(n.q_.M_(e),qf(n)):n.q_.set("Unknown")}async function sR(n,e,t){if(n.q_.set("Online"),e instanceof A0&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){J("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await hu(n,r)}else if(e instanceof Mc?n.Q_.Ke(e):e instanceof T0?n.Q_.He(e):n.Q_.We(e),!t.isEqual(we.min()))try{const r=await Z0(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.N_.get(u);d&&i.N_.set(u,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const d=i.N_.get(l);if(!d)return;i.N_.set(l,d.withResumeToken(Vt.EMPTY_BYTE_STRING,d.snapshotVersion)),aw(i,l);const f=new Vr(d.target,l,u,d.sequenceNumber);jf(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){J("RemoteStore","Failed to raise snapshot:",r),await hu(n,r)}}async function hu(n,e,t){if(!Bs(e))throw e;n.L_.add(1),await zo(n),n.q_.set("Offline"),t||(t=()=>Z0(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{J("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Ol(n)})}function cw(n,e){return e().catch(t=>hu(n,t,e))}async function Go(n){const e=ae(n),t=Ns(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;iR(e);)try{const s=await qS(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,oR(e,s)}catch(s){await hu(e,s)}uw(e)&&dw(e)}function iR(n){return js(n)&&n.O_.length<10}function oR(n,e){n.O_.push(e);const t=Ns(n);t.r_()&&t.V_&&t.m_(e.mutations)}function uw(n){return js(n)&&!Ns(n).n_()&&n.O_.length>0}function dw(n){Ns(n).start()}async function aR(n){Ns(n).p_()}async function lR(n){const e=Ns(n);for(const t of n.O_)e.m_(t.mutations)}async function cR(n,e,t){const r=n.O_.shift(),s=Sf.from(r,e,t);await cw(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Go(n)}async function uR(n,e){e&&Ns(n).V_&&await async function(r,s){if(function(o){return b0(o)&&o!==F.ABORTED}(s.code)){const i=r.O_.shift();Ns(r).s_(),await cw(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Go(r)}}(n,e),uw(n)&&dw(n)}async function r_(n,e){const t=ae(n);t.asyncQueue.verifyOperationInProgress(),J("RemoteStore","RemoteStore received new credentials");const r=js(t);t.L_.add(3),await zo(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Ol(t)}async function Bh(n,e){const t=ae(n);e?(t.L_.delete(2),await Ol(t)):e||(t.L_.add(2),await zo(t),t.q_.set("Unknown"))}function Ko(n){return n.K_||(n.K_=function(t,r,s){const i=ae(t);return i.w_(),new JS(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:tR.bind(null,n),Ro:nR.bind(null,n),mo:rR.bind(null,n),d_:sR.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),zf(n)?qf(n):n.q_.set("Unknown")):(await n.K_.stop(),lw(n))})),n.K_}function Ns(n){return n.U_||(n.U_=function(t,r,s){const i=ae(t);return i.w_(),new YS(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:aR.bind(null,n),mo:uR.bind(null,n),f_:lR.bind(null,n),g_:cR.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await Go(n)):(await n.U_.stop(),n.O_.length>0&&(J("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gf{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new en,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Gf(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Y(F.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ho(n,e){if(Mt("AsyncQueue",`${e}: ${n}`),Bs(n))return new Y(F.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uo{constructor(e){this.comparator=e?(t,r)=>e(t,r)||he.comparator(t.key,r.key):(t,r)=>he.comparator(t.key,r.key),this.keyedMap=Ca(),this.sortedSet=new ft(this.comparator)}static emptySet(e){return new uo(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof uo)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new uo;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s_{constructor(){this.W_=new ft(he.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):me():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Vo{constructor(e,t,r,s,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Vo(e,t,uo.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Rl(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dR{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class hR{constructor(){this.queries=i_(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=ae(t),i=s.queries;s.queries=i_(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new Y(F.ABORTED,"Firestore shutting down"))}}function i_(){return new Jr(n=>o0(n),Rl)}async function Kf(n,e){const t=ae(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new dR,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Ho(o,`Initialization of query '${eo(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Wf(t)}async function Hf(n,e){const t=ae(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function fR(n,e){const t=ae(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&Wf(t)}function pR(n,e,t){const r=ae(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function Wf(n){n.Y_.forEach(e=>{e.next()})}var $h,o_;(o_=$h||($h={})).ea="default",o_.Cache="cache";class Qf{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Vo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Vo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==$h.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mR{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a_{constructor(e){this.serializer=e}Es(e){return gr(this.serializer,e)}ds(e){return e.metadata.exists?k0(this.serializer,e.document,!1):gt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Ut(e)}}class gR{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=hw(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=qe.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new a_(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Oe()).add(i);t.set(o,a)}}return t}async complete(){const e=await zS(this.localStore,new a_(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await GS(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function hw(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fw{constructor(e){this.key=e}}class pw{constructor(e){this.key=e}}class mw{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Oe(),this.mutatedKeys=Oe(),this.Aa=l0(e),this.Ra=new uo(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new s_,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,f)=>{const g=s.get(d),_=Cl(this.query,f)?f:null,k=!!g&&this.mutatedKeys.has(g.key),P=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let R=!1;g&&_?g.data.isEqual(_.data)?k!==P&&(r.track({type:3,doc:_}),R=!0):this.ga(g,_)||(r.track({type:2,doc:_}),R=!0,(l&&this.Aa(_,l)>0||u&&this.Aa(_,u)<0)&&(a=!0)):!g&&_?(r.track({type:0,doc:_}),R=!0):g&&!_&&(r.track({type:1,doc:g}),R=!0,(l||u)&&(a=!0)),R&&(_?(o=o.add(_),i=P?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((d,f)=>function(_,k){const P=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return me()}};return P(_)-P(k)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,u=l!==this.Ea;return this.Ea=l,o.length!==0||u?{snapshot:new Vo(this.query,e.Ra,i,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new s_,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Oe(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new pw(r))}),this.da.forEach(r=>{e.has(r)||t.push(new fw(r))}),t}ba(e){this.Ta=e.Ts,this.da=Oe();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Vo.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class _R{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class yR{constructor(e){this.key=e,this.va=!1}}class vR{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Jr(a=>o0(a),Rl),this.Ma=new Map,this.xa=new Set,this.Oa=new ft(he.comparator),this.Na=new Map,this.La=new Of,this.Ba={},this.ka=new Map,this.qa=bi.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function wR(n,e,t=!0){const r=Hu(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await gw(r,e,t,!0),s}async function bR(n,e){const t=Hu(n);await gw(t,e,!0,!1)}async function gw(n,e,t,r){const s=await Co(n.localStore,wn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await Jf(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&Ku(n.remoteStore,s),a}async function Jf(n,e,t,r,s){n.Ka=(f,g,_)=>async function(P,R,L,B){let $=R.view.ma(L);$.ns&&($=await cu(P.localStore,R.query,!1).then(({documents:x})=>R.view.ma(x,$)));const j=B&&B.targetChanges.get(R.targetId),O=B&&B.targetMismatches.get(R.targetId)!=null,ie=R.view.applyChanges($,P.isPrimaryClient,j,O);return jh(P,R.targetId,ie.wa),ie.snapshot}(n,f,g,_);const i=await cu(n.localStore,e,!0),o=new mw(e,i.Ts),a=o.ma(i.documents),l=Vl.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,l);jh(n,t,u.wa);const d=new _R(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),u.snapshot}async function IR(n,e,t){const r=ae(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Rl(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await ko(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Do(r.remoteStore,s.targetId),No(r,s.targetId)}).catch(Us)):(No(r,s.targetId),await ko(r.localStore,s.targetId,!0))}async function ER(n,e){const t=ae(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Do(t.remoteStore,r.targetId))}async function TR(n,e,t){const r=ep(n);try{const s=await function(o,a){const l=ae(o),u=Rt.now(),d=a.reduce((_,k)=>_.add(k.key),Oe());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",_=>{let k=On(),P=Oe();return l.cs.getEntries(_,d).next(R=>{k=R,k.forEach((L,B)=>{B.isValidDocument()||(P=P.add(L))})}).next(()=>l.localDocuments.getOverlayedDocuments(_,k)).next(R=>{f=R;const L=[];for(const B of a){const $=JP(B,f.get(B.key).overlayedDocument);$!=null&&L.push(new Yr(B.key,$,Qv($.value.mapValue),It.exists(!0)))}return l.mutationQueue.addMutationBatch(_,u,L,a)}).next(R=>{g=R;const L=R.applyToLocalDocumentSet(f,P);return l.documentOverlayCache.saveOverlays(_,R.batchId,L)})}).then(()=>({batchId:g.batchId,changes:u0(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let u=o.Ba[o.currentUser.toKey()];u||(u=new ft(xe)),u=u.insert(a,l),o.Ba[o.currentUser.toKey()]=u}(r,s.batchId,t),await Xr(r,s.changes),await Go(r.remoteStore)}catch(s){const i=Ho(s,"Failed to persist write");t.reject(i)}}async function _w(n,e){const t=ae(n);try{const r=await jS(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(_e(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?_e(o.va):s.removedDocuments.size>0&&(_e(o.va),o.va=!1))}),await Xr(t,r,e)}catch(r){await Us(r)}}function l_(n,e,t){const r=ae(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=ae(o);l.onlineState=a;let u=!1;l.queries.forEach((d,f)=>{for(const g of f.j_)g.Z_(a)&&(u=!0)}),u&&Wf(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function AR(n,e,t){const r=ae(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new ft(he.comparator);o=o.insert(i,gt.newNoDocument(i,we.min()));const a=Oe().add(i),l=new Dl(we.min(),new Map,new ft(xe),o,a);await _w(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),Zf(r)}else await ko(r.localStore,e,!1).then(()=>No(r,e,t)).catch(Us)}async function xR(n,e){const t=ae(n),r=e.batch.batchId;try{const s=await $S(t.localStore,e);Xf(t,r,null),Yf(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Xr(t,s)}catch(s){await Us(s)}}async function PR(n,e,t){const r=ae(n);try{const s=await function(o,a){const l=ae(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let d;return l.mutationQueue.lookupMutationBatch(u,a).next(f=>(_e(f!==null),d=f.keys(),l.mutationQueue.removeMutationBatch(u,f))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,d)).next(()=>l.localDocuments.getDocuments(u,d))})}(r.localStore,e);Xf(r,e,t),Yf(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Xr(r,s)}catch(s){await Us(s)}}async function SR(n,e){const t=ae(n);js(t.remoteStore)||J("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=ae(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Ho(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function Yf(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function Xf(n,e,t){const r=ae(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function No(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||yw(n,r)})}function yw(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Do(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Zf(n))}function jh(n,e,t){for(const r of t)r instanceof fw?(n.La.addReference(r.key,e),RR(n,r)):r instanceof pw?(J("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||yw(n,r.key)):me()}function RR(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(J("SyncEngine","New document in limbo: "+t),n.xa.add(r),Zf(n))}function Zf(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new he(qe.fromString(e)),r=n.qa.next();n.Na.set(r,new yR(t)),n.Oa=n.Oa.insert(t,r),Ku(n.remoteStore,new Vr(wn($o(t.path)),r,"TargetPurposeLimboResolution",Vn.oe))}}async function Xr(n,e,t){const r=ae(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(u=>{var d;if((u||t)&&r.isPrimaryClient){const f=u?!u.fromCache:(d=t==null?void 0:t.targetChanges.get(l.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(u){s.push(u);const f=Uf.Wi(l.targetId,u);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,u){const d=ae(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>N.forEach(u,g=>N.forEach(g.$i,_=>d.persistence.referenceDelegate.addReference(f,g.targetId,_)).next(()=>N.forEach(g.Ui,_=>d.persistence.referenceDelegate.removeReference(f,g.targetId,_)))))}catch(f){if(!Bs(f))throw f;J("LocalStore","Failed to update sequence numbers: "+f)}for(const f of u){const g=f.targetId;if(!f.fromCache){const _=d.os.get(g),k=_.snapshotVersion,P=_.withLastLimboFreeSnapshotVersion(k);d.os=d.os.insert(g,P)}}}(r.localStore,i))}async function CR(n,e){const t=ae(n);if(!t.currentUser.isEqual(e)){J("SyncEngine","User change. New user:",e.toKey());const r=await X0(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new Y(F.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Xr(t,r.hs)}}function kR(n,e){const t=ae(n),r=t.Na.get(e);if(r&&r.va)return Oe().add(r.key);{let s=Oe();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function DR(n,e){const t=ae(n),r=await cu(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&jh(t,e.targetId,s.wa),s}async function VR(n,e){const t=ae(n);return nw(t.localStore,e).then(r=>Xr(t,r))}async function NR(n,e,t,r){const s=ae(n),i=await function(a,l){const u=ae(a),d=ae(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,l).next(g=>g?u.localDocuments.getDocuments(f,g):N.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Go(s.remoteStore):t==="acknowledged"||t==="rejected"?(Xf(s,e,r||null),Yf(s,e),function(a,l){ae(ae(a).mutationQueue).On(l)}(s.localStore,e)):me(),await Xr(s,i)):J("SyncEngine","Cannot apply mutation batch with id: "+e)}async function OR(n,e){const t=ae(n);if(Hu(t),ep(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await c_(t,r.toArray());t.Qa=!0,await Bh(t.remoteStore,!0);for(const i of s)Ku(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(No(t,o),ko(t.localStore,o,!0))),Do(t.remoteStore,o)}),await s,await c_(t,r),function(o){const a=ae(o);a.Na.forEach((l,u)=>{Do(a.remoteStore,u)}),a.La.pr(),a.Na=new Map,a.Oa=new ft(he.comparator)}(t),t.Qa=!1,await Bh(t.remoteStore,!1)}}async function c_(n,e,t){const r=ae(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await Co(r.localStore,wn(l[0]));for(const u of l){const d=r.Fa.get(u),f=await DR(r,d);f.snapshot&&i.push(f.snapshot)}}else{const u=await tw(r.localStore,o);a=await Co(r.localStore,u),await Jf(r,vw(u),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function vw(n){return r0(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function MR(n){return function(t){return ae(ae(t).persistence).Qi()}(ae(n).localStore)}async function LR(n,e,t,r){const s=ae(n);if(s.Qa)return void J("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await nw(s.localStore,a0(i[0])),a=Dl.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Vt.EMPTY_BYTE_STRING);await Xr(s,o,a);break}case"rejected":await ko(s.localStore,e,!0),No(s,e,r);break;default:me()}}async function FR(n,e,t){const r=Hu(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){J("SyncEngine","Adding an already active target "+s);continue}const i=await tw(r.localStore,s),o=await Co(r.localStore,i);await Jf(r,vw(i),o.targetId,!1,o.resumeToken),Ku(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await ko(r.localStore,s,!1).then(()=>{Do(r.remoteStore,s),No(r,s)}).catch(Us)}}function Hu(n){const e=ae(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=_w.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=kR.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=AR.bind(null,e),e.Ca.d_=fR.bind(null,e.eventManager),e.Ca.$a=pR.bind(null,e.eventManager),e}function ep(n){const e=ae(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=xR.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=PR.bind(null,e),e}function UR(n,e,t){const r=ae(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(_,k){const P=ae(_),R=Ut(k.createTime);return P.persistence.runTransaction("hasNewerBundle","readonly",L=>P.Gr.getBundleMetadata(L,k.id)).then(L=>!!L&&L.createTime.compareTo(R)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(_){return{taskState:"Success",documentsLoaded:_.totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(hw(l));const u=new gR(l,i.localStore,o.serializer);let d=await o.Ua();for(;d;){const g=await u.la(d);g&&a._updateProgress(g),d=await o.Ua()}const f=await u.complete();return await Xr(i,f.Ia,void 0),await function(_,k){const P=ae(_);return P.persistence.runTransaction("Save bundle","readwrite",R=>P.Gr.saveBundleMetadata(R,k))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return Jn("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Os{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Nl(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return Y0(this.persistence,new J0,e.initialUser,this.serializer)}Ga(e){return new Mf(Gu.Zr,this.serializer)}Wa(e){return new sw}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Os.provider={build:()=>new Os};class BR extends Os{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){_e(this.persistence.referenceDelegate instanceof lu);const r=this.persistence.referenceDelegate.garbageCollector;return new G0(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?mn.withCacheSize(this.cacheSizeBytes):mn.DEFAULT;return new Mf(r=>lu.Zr(r,t),this.serializer)}}class tp extends Os{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await ep(this.Ja.syncEngine),await Go(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return Y0(this.persistence,new J0,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new G0(r,e.asyncQueue,t)}Ha(e,t){const r=new lP(t,this.persistence);return new aP(e.asyncQueue,r)}Ga(e){const t=Ff(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?mn.withCacheSize(this.cacheSizeBytes):mn.DEFAULT;return new Lf(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,iw(),Lc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new sw}}class ww extends tp{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Hd&&(this.sharedClientState.syncEngine={no:NR.bind(null,t),ro:LR.bind(null,t),io:FR.bind(null,t),Qi:MR.bind(null,t),eo:VR.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await OR(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=iw();if(!Hd.D(t))throw new Y(F.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Ff(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Hd(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Ms{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>l_(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=CR.bind(null,this.syncEngine),await Bh(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new hR}()}createDatastore(e){const t=Nl(e.databaseInfo.databaseId),r=function(i){return new QS(i)}(e.databaseInfo);return function(i,o,a,l){return new XS(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new eR(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>l_(this.syncEngine,t,0),function(){return n_.D()?new n_:new KS}())}createSyncEngine(e,t){return function(s,i,o,a,l,u,d){const f=new vR(s,i,o,a,l,u);return d&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=ae(s);J("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await zo(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Ms.provider={build:()=>new Ms};function u_(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wu{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Mt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $R{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new en,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new mR(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jR{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new Y(F.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=ae(s),a={documents:i.map(f=>ul(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,qe.emptyPath(),a,i.length),u=new Map;l.forEach(f=>{const g=iS(o.serializer,f);u.set(g.key.toString(),g)});const d=[];return i.forEach(f=>{const g=u.get(f.toString());_e(!!g),d.push(g)}),d}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new qo(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=he.fromPath(r);this.mutations.push(new xf(s,this.precondition(s)))}),await async function(r,s){const i=ae(r),o={writes:s.map(a=>dl(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,qe.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw me();t=we.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new Y(F.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(we.min())?It.exists(!1):It.updateTime(t):It.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(we.min()))throw new Y(F.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return It.updateTime(t)}return It.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qR{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new $f(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new jR(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!Pl(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!b0(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zR{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Xt.UNAUTHENTICATED,this.clientId=Dv.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{J("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(J("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new en;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Ho(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Qd(n,e){n.asyncQueue.verifyOperationInProgress(),J("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await X0(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function d_(n,e){n.asyncQueue.verifyOperationInProgress();const t=await np(n);J("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>r_(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>r_(e.remoteStore,s)),n._onlineComponents=e}async function np(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){J("FirestoreClient","Using user provided OfflineComponentProvider");try{await Qd(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===F.FAILED_PRECONDITION||s.code===F.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Jn("Error using user provided cache. Falling back to memory cache: "+t),await Qd(n,new Os)}}else J("FirestoreClient","Using default OfflineComponentProvider"),await Qd(n,new Os);return n._offlineComponents}async function Qu(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(J("FirestoreClient","Using user provided OnlineComponentProvider"),await d_(n,n._uninitializedComponentsProvider._online)):(J("FirestoreClient","Using default OnlineComponentProvider"),await d_(n,new Ms))),n._onlineComponents}function bw(n){return np(n).then(e=>e.persistence)}function Wo(n){return np(n).then(e=>e.localStore)}function Iw(n){return Qu(n).then(e=>e.remoteStore)}function rp(n){return Qu(n).then(e=>e.syncEngine)}function Ew(n){return Qu(n).then(e=>e.datastore)}async function Oo(n){const e=await Qu(n),t=e.eventManager;return t.onListen=wR.bind(null,e.syncEngine),t.onUnlisten=IR.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=bR.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=ER.bind(null,e.syncEngine),t}function GR(n){return n.asyncQueue.enqueue(async()=>{const e=await bw(n),t=await Iw(n);return e.setNetworkEnabled(!0),function(s){const i=ae(s);return i.L_.delete(0),Ol(i)}(t)})}function KR(n){return n.asyncQueue.enqueue(async()=>{const e=await bw(n),t=await Iw(n);return e.setNetworkEnabled(!1),async function(s){const i=ae(s);i.L_.add(0),await zo(i),i.q_.set("Offline")}(t)})}function HR(n,e){const t=new en;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(u,d){const f=ae(u);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,d))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new Y(F.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Ho(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Wo(n),e,t)),t.promise}function Tw(n,e,t={}){const r=new en;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const d=new Wu({next:g=>{d.Za(),o.enqueueAndForget(()=>Hf(i,f));const _=g.docs.has(a);!_&&g.fromCache?u.reject(new Y(F.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&g.fromCache&&l&&l.source==="server"?u.reject(new Y(F.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(g)},error:g=>u.reject(g)}),f=new Qf($o(a.path),d,{includeMetadataChanges:!0,_a:!0});return Kf(i,f)}(await Oo(n),n.asyncQueue,e,t,r)),r.promise}function WR(n,e){const t=new en;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await cu(s,i,!0),l=new mw(i,a.Ts),u=l.ma(a.documents),d=l.applyChanges(u,!1);o.resolve(d.snapshot)}catch(a){const l=Ho(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Wo(n),e,t)),t.promise}function Aw(n,e,t={}){const r=new en;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const d=new Wu({next:g=>{d.Za(),o.enqueueAndForget(()=>Hf(i,f)),g.fromCache&&l.source==="server"?u.reject(new Y(F.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(g)},error:g=>u.reject(g)}),f=new Qf(a,d,{includeMetadataChanges:!0,_a:!0});return Kf(i,f)}(await Oo(n),n.asyncQueue,e,t,r)),r.promise}function QR(n,e,t){const r=new en;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await Ew(n);r.resolve(async function(o,a,l){var u;const d=ae(o),{request:f,ut:g,parent:_}=V0(d.serializer,s0(a),l);d.connection.Fo||delete f.parent;const k=(await d.Lo("RunAggregationQuery",d.serializer.databaseId,_,f,1)).filter(R=>!!R.result);_e(k.length===1);const P=(u=k[0].result)===null||u===void 0?void 0:u.aggregateFields;return Object.keys(P).reduce((R,L)=>(R[g[L]]=P[L],R),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function JR(n,e){const t=new Wu(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){ae(s).Y_.add(i),i.next()}(await Oo(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){ae(s).Y_.delete(i)}(await Oo(n),t))}}function YR(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?E0().encode(o):o,function(d,f){return new $R(d,f)}(function(d,f){if(d instanceof Uint8Array)return u_(d,f);if(d instanceof ArrayBuffer)return u_(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,Nl(e));n.asyncQueue.enqueueAndForget(async()=>{UR(await rp(n),s,r)})}function XR(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=ae(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await Wo(n),e))}function ZR(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=ae(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(u=>function(f,g,_,k,P){f=[...f],g=[...g],f.sort(_),g.sort(_);const R=f.length,L=g.length;let B=0,$=0;for(;B<L&&$<R;){const j=_(f[$],g[B]);j<0?P(f[$++]):j>0?k(g[B++]):(B++,$++)}for(;B<L;)k(g[B++]);for(;$<R;)P(f[$++])}(u,s,rP,d=>{a.push(o.addFieldIndex(l,d))},d=>{a.push(o.deleteFieldIndex(l,d))})).next(()=>N.waitFor(a)))}(await Wo(n),e))}function eC(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){ae(r).ss.zi=s}(await Wo(n),e))}function tC(n){return n.asyncQueue.enqueue(async()=>function(t){const r=ae(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Wo(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xw(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h_=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sp(n,e,t){if(!t)throw new Y(F.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function nC(n,e,t,r){if(e===!0&&r===!0)throw new Y(F.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function f_(n){if(!he.isDocumentKey(n))throw new Y(F.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function p_(n){if(he.isDocumentKey(n))throw new Y(F.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ju(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":me()}function Be(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Y(F.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ju(n);throw new Y(F.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Pw(n,e){if(e<=0)throw new Y(F.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m_{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Y(F.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Y(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}nC("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=xw((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Y(F.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Y(F.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Y(F.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ml{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new m_({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Y(F.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Y(F.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new m_(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Qx;switch(r.type){case"firstParty":return new Zx(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Y(F.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=h_.get(t);r&&(J("ComponentProvider","Removing Datastore"),h_.delete(t),r.terminate())}(this),Promise.resolve()}}function rC(n,e,t,r={}){var s;const i=(n=Be(n,Ml))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Jn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=Xt.MOCK_USER;else{a=TA(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new Y(F.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Xt(u)}n._authCredentials=new Jx(new Cv(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new dn(this.firestore,e,this._query)}}class Bt{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _r(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Bt(this.firestore,e,this._key)}}class _r extends dn{constructor(e,t,r){super(e,t,$o(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Bt(this.firestore,null,new he(e))}withConverter(e){return new _r(this.firestore,e,this._path)}}function Ze(n,e,...t){if(n=be(n),sp("collection","path",e),n instanceof Ml){const r=qe.fromString(e,...t);return p_(r),new _r(n,null,r)}{if(!(n instanceof Bt||n instanceof _r))throw new Y(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(qe.fromString(e,...t));return p_(r),new _r(n.firestore,null,r)}}function pL(n,e){if(n=Be(n,Ml),sp("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Y(F.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new dn(n,null,function(r){return new Qr(qe.emptyPath(),r)}(e))}function Ve(n,e,...t){if(n=be(n),arguments.length===1&&(e=Dv.newId()),sp("doc","path",e),n instanceof Ml){const r=qe.fromString(e,...t);return f_(r),new Bt(n,null,new he(r))}{if(!(n instanceof Bt||n instanceof _r))throw new Y(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(qe.fromString(e,...t));return f_(r),new Bt(n.firestore,n instanceof _r?n.converter:null,new he(r))}}function mL(n,e){return n=be(n),e=be(e),(n instanceof Bt||n instanceof _r)&&(e instanceof Bt||e instanceof _r)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Sw(n,e){return n=be(n),e=be(e),n instanceof dn&&e instanceof dn&&n.firestore===e.firestore&&Rl(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g_{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new $f(this,"async_queue_retry"),this.Vu=()=>{const r=Lc();r&&J("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Lc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Lc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new en;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Bs(e))throw e;J("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Mt("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Gf.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&me()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function qh(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class sC{constructor(){this._progressObserver={},this._taskCompletionResolver=new en,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gL=-1;class ct extends Ml{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new g_,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new g_(e),this._firestoreClient=void 0,await e}}}function _L(n,e,t){t||(t="(default)");const r=xl(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(Rs(i,e))return s;throw new Y(F.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new Y(F.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Y(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function iC(n,e){const t=typeof n=="object"?n:bv(),r=typeof n=="string"?n:e||"(default)",s=xl(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=IA("firestore");i&&rC(s,...i)}return s}function Ct(n){if(n._terminated)throw new Y(F.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Rw(n),n._firestoreClient}function Rw(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,u,d){return new RP(a,l,u,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,xw(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new zR(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function yL(n,e){Jn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return Cw(n,Ms.provider,{build:r=>new tp(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function vL(n){Jn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();Cw(n,Ms.provider,{build:t=>new ww(t,e.cacheSizeBytes)})}function Cw(n,e,t){if((n=Be(n,ct))._firestoreClient||n._terminated)throw new Y(F.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new Y(F.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},Rw(n)}function wL(n){if(n._initialized&&!n._terminated)throw new Y(F.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new en;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!mr.D())return Promise.resolve();const s=r+"main";await mr.delete(s)}(Ff(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function bL(n){return function(t){const r=new en;return t.asyncQueue.enqueueAndForget(async()=>SR(await rp(t),r)),r.promise}(Ct(n=Be(n,ct)))}function IL(n){return GR(Ct(n=Be(n,ct)))}function EL(n){return KR(Ct(n=Be(n,ct)))}function TL(n){return Ox(n.app,"firestore",n._databaseId.database),n._delete()}function AL(n,e){const t=Ct(n=Be(n,ct)),r=new sC;return YR(t,n._databaseId,e,r),r}function xL(n,e){return XR(Ct(n=Be(n,ct)),e).then(t=>t?new dn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class oC{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ii{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ii(Vt.fromBase64String(e))}catch(t){throw new Y(F.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ii(Vt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ai{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Y(F.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new bt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function PL(){return new Ai("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ip{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Y(F.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Y(F.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return xe(this._lat,e._lat)||xe(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aC=/^__.*__$/;class lC{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Yr(e,this.data,this.fieldMask,t,this.fieldTransforms):new jo(e,this.data,t,this.fieldTransforms)}}class kw{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Yr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Dw(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw me()}}class Xu{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Xu(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return fu(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Dw(this.Cu)&&aC.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class cC{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Nl(e)}Qu(e,t,r,s=!1){return new Xu({Cu:e,methodName:t,qu:r,path:bt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Pi(n){const e=n._freezeSettings(),t=Nl(n._databaseId);return new cC(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Zu(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);hp("Data must be an object, but it was:",o,r);const a=Ow(r,o);let l,u;if(i.merge)l=new Nn(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const f of i.mergeFields){const g=fl(e,f,t);if(!o.contains(g))throw new Y(F.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);Lw(d,g)||d.push(g)}l=new Nn(d),u=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,u=o.fieldTransforms;return new lC(new un(a),l,u)}class Ll extends xi{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ll}}function Vw(n,e,t){return new Xu({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class op extends xi{_toFieldTransform(e){return new kl(e.path,new Po)}isEqual(e){return e instanceof op}}class ap extends xi{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=Vw(this,e,!0),r=this.Ku.map(i=>Si(i,t)),s=new _i(r);return new kl(e.path,s)}isEqual(e){return e instanceof ap&&Rs(this.Ku,e.Ku)}}class lp extends xi{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=Vw(this,e,!0),r=this.Ku.map(i=>Si(i,t)),s=new yi(r);return new kl(e.path,s)}isEqual(e){return e instanceof lp&&Rs(this.Ku,e.Ku)}}class cp extends xi{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new So(e.serializer,f0(e.serializer,this.$u));return new kl(e.path,t)}isEqual(e){return e instanceof cp&&this.$u===e.$u}}function up(n,e,t,r){const s=n.Qu(1,e,t);hp("Data must be an object, but it was:",s,r);const i=[],o=un.empty();$s(r,(l,u)=>{const d=ed(e,l,t);u=be(u);const f=s.Nu(d);if(u instanceof Ll)i.push(d);else{const g=Si(u,f);g!=null&&(i.push(d),o.set(d,g))}});const a=new Nn(i);return new kw(o,a,s.fieldTransforms)}function dp(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[fl(e,r,t)],l=[s];if(i.length%2!=0)throw new Y(F.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(fl(e,i[g])),l.push(i[g+1]);const u=[],d=un.empty();for(let g=a.length-1;g>=0;--g)if(!Lw(u,a[g])){const _=a[g];let k=l[g];k=be(k);const P=o.Nu(_);if(k instanceof Ll)u.push(_);else{const R=Si(k,P);R!=null&&(u.push(_),d.set(_,R))}}const f=new Nn(u);return new kw(d,f,o.fieldTransforms)}function Nw(n,e,t,r=!1){return Si(t,n.Qu(r?4:3,e))}function Si(n,e){if(Mw(n=be(n)))return hp("Unsupported field value:",e,n),Ow(n,e);if(n instanceof xi)return function(r,s){if(!Dw(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=Si(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=be(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return f0(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Rt.fromDate(r);return{timestampValue:Ro(s.serializer,i)}}if(r instanceof Rt){const i=new Rt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ro(s.serializer,i)}}if(r instanceof ip)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ii)return{bytesValue:x0(s.serializer,r._byteString)};if(r instanceof Bt){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:kf(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Yu)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Af(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Ju(r)}`)}(n,e)}function Ow(n,e){const t={};return Gv(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):$s(n,(r,s)=>{const i=Si(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function Mw(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Rt||n instanceof ip||n instanceof Ii||n instanceof Bt||n instanceof xi||n instanceof Yu)}function hp(n,e,t){if(!Mw(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=Ju(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function fl(n,e,t){if((e=be(e))instanceof Ai)return e._internalPath;if(typeof e=="string")return ed(n,e);throw fu("Field path arguments must be of type string or ",n,!1,void 0,t)}const uC=new RegExp("[~\\*/\\[\\]]");function ed(n,e,t){if(e.search(uC)>=0)throw fu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ai(...e.split("."))._internalPath}catch{throw fu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function fu(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new Y(F.INVALID_ARGUMENT,a+n+l)}function Lw(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pl{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Bt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new dC(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(td("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class dC extends pl{data(){return super.data()}}function td(n,e){return typeof e=="string"?ed(n,e):e instanceof Ai?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Y(F.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class fp{}class Fl extends fp{}function Uw(n,e,...t){let r=[];e instanceof fp&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Qo).length,a=i.filter(l=>l instanceof Ul).length;if(o>1||o>0&&a>0)throw new Y(F.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Ul extends Fl{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Ul(e,t,r)}_apply(e){const t=this._parse(e);return $w(e._query,t),new dn(e.firestore,e.converter,kh(e._query,t))}_parse(e){const t=Pi(e.firestore);return function(i,o,a,l,u,d,f){let g;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new Y(F.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){y_(f,d);const _=[];for(const k of f)_.push(__(l,i,k));g={arrayValue:{values:_}}}else g=__(l,i,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||y_(f,d),g=Nw(a,o,f,d==="in"||d==="not-in");return ze.create(u,d,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function hC(n,e,t){const r=e,s=td("where",n);return Ul._create(s,r,t)}class Qo extends fp{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Qo(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:nt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)$w(o,l),o=kh(o,l)}(e._query,t),new dn(e.firestore,e.converter,kh(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function SL(...n){return n.forEach(e=>jw("or",e)),Qo._create("or",n)}function RL(...n){return n.forEach(e=>jw("and",e)),Qo._create("and",n)}class pp extends Fl{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new pp(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new Y(F.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new Y(F.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new cl(i,o)}(e._query,this._field,this._direction);return new dn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Qr(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function fC(n,e="asc"){const t=e,r=td("orderBy",n);return pp._create(r,t)}class nd extends Fl{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new nd(e,t,r)}_apply(e){return new dn(e.firestore,e.converter,ru(e._query,this._limit,this._limitType))}}function CL(n){return Pw("limit",n),nd._create("limit",n,"F")}function kL(n){return Pw("limitToLast",n),nd._create("limitToLast",n,"L")}class rd extends Fl{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new rd(e,t,r)}_apply(e){const t=Bw(e,this.type,this._docOrFields,this._inclusive);return new dn(e.firestore,e.converter,function(s,i){return new Qr(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function DL(...n){return rd._create("startAt",n,!0)}function VL(...n){return rd._create("startAfter",n,!1)}class sd extends Fl{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new sd(e,t,r)}_apply(e){const t=Bw(e,this.type,this._docOrFields,this._inclusive);return new dn(e.firestore,e.converter,function(s,i){return new Qr(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function NL(...n){return sd._create("endBefore",n,!1)}function OL(...n){return sd._create("endAt",n,!0)}function Bw(n,e,t,r){if(t[0]=be(t[0]),t[0]instanceof pl)return function(i,o,a,l,u){if(!l)throw new Y(F.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const d=[];for(const f of co(i))if(f.field.isKeyField())d.push(mi(o,l.key));else{const g=l.data.field(f.field);if(Lu(g))throw new Y(F.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const _=f.field.canonicalString();throw new Y(F.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}d.push(g)}return new Vs(d,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Pi(n.firestore);return function(o,a,l,u,d,f){const g=o.explicitOrderBy;if(d.length>g.length)throw new Y(F.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const _=[];for(let k=0;k<d.length;k++){const P=d[k];if(g[k].field.isKeyField()){if(typeof P!="string")throw new Y(F.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof P}`);if(!Ef(o)&&P.indexOf("/")!==-1)throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${P}' contains a slash.`);const R=o.path.child(qe.fromString(P));if(!he.isDocumentKey(R))throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);const L=new he(R);_.push(mi(a,L))}else{const R=Nw(l,u,P);_.push(R)}}return new Vs(_,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function __(n,e,t){if(typeof(t=be(t))=="string"){if(t==="")throw new Y(F.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ef(e)&&t.indexOf("/")!==-1)throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(qe.fromString(t));if(!he.isDocumentKey(r))throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return mi(n,new he(r))}if(t instanceof Bt)return mi(n,t._key);throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ju(t)}.`)}function y_(n,e){if(!Array.isArray(n)||n.length===0)throw new Y(F.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function $w(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Y(F.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Y(F.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function jw(n,e){if(!(e instanceof Ul||e instanceof Qo))throw new Y(F.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class qw{convertValue(e,t="none"){switch(ks(e)){case 0:return null;case 1:return e.booleanValue;case 2:return wt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(qr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw me()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return $s(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>wt(o.doubleValue));return new Yu(i)}convertGeoPoint(e){return new ip(wt(e.latitude),wt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Fu(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ol(e));default:return null}}convertTimestamp(e){const t=jr(e);return new Rt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=qe.fromString(e);_e(L0(r));const s=new pi(r.get(1),r.get(3)),i=new he(r.popFirst(5));return s.isEqual(t)||Mt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function id(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class pC extends qw{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ii(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Bt(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ML(n){return new hl("sum",fl("sum",n))}function LL(n){return new hl("avg",fl("average",n))}function mC(){return new hl("count")}function FL(n,e){var t,r;return n instanceof hl&&e instanceof hl&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function UL(n,e){return Sw(n.query,e.query)&&Rs(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Mo extends pl{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Fc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(td("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Fc extends Mo{data(e={}){return super.data(e)}}class Lo{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new oi(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Fc(this._firestore,this._userDataWriter,r.key,r,new oi(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Y(F.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Fc(s._firestore,s._userDataWriter,a.doc.key,a.doc,new oi(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Fc(s._firestore,s._userDataWriter,a.doc.key,a.doc,new oi(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,d=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:gC(a.type),doc:l,oldIndex:u,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function gC(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return me()}}function BL(n,e){return n instanceof Mo&&e instanceof Mo?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Lo&&e instanceof Lo&&n._firestore===e._firestore&&Sw(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ri(n){n=Be(n,Bt);const e=Be(n.firestore,ct);return Tw(Ct(e),n._key).then(t=>mp(e,n,t))}class qs extends qw{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ii(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Bt(this.firestore,null,t)}}function $L(n){n=Be(n,Bt);const e=Be(n.firestore,ct),t=Ct(e),r=new qs(e);return HR(t,n._key).then(s=>new Mo(e,r,n._key,s,new oi(s!==null&&s.hasLocalMutations,!0),n.converter))}function jL(n){n=Be(n,Bt);const e=Be(n.firestore,ct);return Tw(Ct(e),n._key,{source:"server"}).then(t=>mp(e,n,t))}function St(n){n=Be(n,dn);const e=Be(n.firestore,ct),t=Ct(e),r=new qs(e);return Fw(n._query),Aw(t,n._query).then(s=>new Lo(e,r,n,s))}function qL(n){n=Be(n,dn);const e=Be(n.firestore,ct),t=Ct(e),r=new qs(e);return WR(t,n._query).then(s=>new Lo(e,r,n,s))}function zL(n){n=Be(n,dn);const e=Be(n.firestore,ct),t=Ct(e),r=new qs(e);return Aw(t,n._query,{source:"server"}).then(s=>new Lo(e,r,n,s))}function Pn(n,e,t){n=Be(n,Bt);const r=Be(n.firestore,ct),s=id(n.converter,e,t);return Bl(r,[Zu(Pi(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,It.none())])}function GL(n,e,t,...r){n=Be(n,Bt);const s=Be(n.firestore,ct),i=Pi(s);let o;return o=typeof(e=be(e))=="string"||e instanceof Ai?dp(i,"updateDoc",n._key,e,t,r):up(i,"updateDoc",n._key,e),Bl(s,[o.toMutation(n._key,It.exists(!0))])}function ml(n){return Bl(Be(n.firestore,ct),[new qo(n._key,It.none())])}function zw(n,e){const t=Be(n.firestore,ct),r=Ve(n),s=id(n.converter,e);return Bl(t,[Zu(Pi(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,It.exists(!1))]).then(()=>r)}function KL(n,...e){var t,r,s;n=be(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||qh(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(qh(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,u,d;if(n instanceof Bt)u=Be(n.firestore,ct),d=$o(n._key.path),l={next:f=>{e[o]&&e[o](mp(u,n,f))},error:e[o+1],complete:e[o+2]};else{const f=Be(n,dn);u=Be(f.firestore,ct),d=f._query;const g=new qs(u);l={next:_=>{e[o]&&e[o](new Lo(u,g,f,_))},error:e[o+1],complete:e[o+2]},Fw(n._query)}return function(g,_,k,P){const R=new Wu(P),L=new Qf(_,R,k);return g.asyncQueue.enqueueAndForget(async()=>Kf(await Oo(g),L)),()=>{R.Za(),g.asyncQueue.enqueueAndForget(async()=>Hf(await Oo(g),L))}}(Ct(u),d,a,l)}function HL(n,e){return JR(Ct(n=Be(n,ct)),qh(e)?e:{next:e})}function Bl(n,e){return function(r,s){const i=new en;return r.asyncQueue.enqueueAndForget(async()=>TR(await rp(r),s,i)),i.promise}(Ct(n),e)}function mp(n,e,t){const r=t.docs.get(e._key),s=new qs(n);return new Mo(n,s,e._key,r,new oi(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WL(n){return _C(n,{count:mC()})}function _C(n,e){const t=Be(n.firestore,ct),r=Ct(t),s=zv(e,(i,o)=>new w0(o,i.aggregateType,i._internalFieldPath));return QR(r,n._query,s).then(i=>function(a,l,u){const d=new qs(a);return new oC(l,d,u)}(t,n,i))}class yC{constructor(e){this.kind="memory",this._onlineComponentProvider=Ms.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=Os.provider}toJSON(){return{kind:this.kind}}}class vC{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=TC(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class wC{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Os.provider}toJSON(){return{kind:this.kind}}}class bC{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new BR(e)}}toJSON(){return{kind:this.kind}}}function QL(){return new wC}function JL(n){return new bC(n==null?void 0:n.cacheSizeBytes)}function YL(n){return new yC(n)}function XL(n){return new vC(n)}class IC{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Ms.provider,this._offlineComponentProvider={build:t=>new tp(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class EC{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Ms.provider,this._offlineComponentProvider={build:t=>new ww(t,e==null?void 0:e.cacheSizeBytes)}}}function TC(n){return new IC(n==null?void 0:n.forceOwnership)}function ZL(){return new EC}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AC={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xC{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Pi(e)}set(e,t,r){this._verifyNotCommitted();const s=_s(e,this._firestore),i=id(s.converter,t,r),o=Zu(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,It.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=_s(e,this._firestore);let o;return o=typeof(t=be(t))=="string"||t instanceof Ai?dp(this._dataReader,"WriteBatch.update",i._key,t,r,s):up(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,It.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=_s(e,this._firestore);return this._mutations=this._mutations.concat(new qo(t._key,It.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Y(F.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function _s(n,e){if((n=be(n)).firestore!==e)throw new Y(F.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Pi(t)}get(t){const r=_s(t,this._firestore),s=new pC(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return me();const o=i[0];if(o.isFoundDocument())return new pl(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new pl(this._firestore,s,r._key,null,r.converter);throw me()})}set(t,r,s){const i=_s(t,this._firestore),o=id(i.converter,r,s),a=Zu(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=_s(t,this._firestore);let a;return a=typeof(r=be(r))=="string"||r instanceof Ai?dp(this._dataReader,"Transaction.update",o._key,r,s,i):up(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=_s(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=_s(e,this._firestore),r=new qs(this._firestore);return super.get(e).then(s=>new Mo(this._firestore,r,t._key,s._document,new oi(!1,!1),t.converter))}}function tF(n,e,t){n=Be(n,ct);const r=Object.assign(Object.assign({},AC),t);return function(i){if(i.maxAttempts<1)throw new Y(F.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new en;return i.asyncQueue.enqueueAndForget(async()=>{const u=await Ew(i);new qR(i.asyncQueue,u,a,o,l).au()}),l.promise}(Ct(n),s=>e(new PC(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nF(){return new Ll("deleteField")}function gp(){return new op("serverTimestamp")}function rF(...n){return new ap("arrayUnion",n)}function sF(...n){return new lp("arrayRemove",n)}function iF(n){return new cp("increment",n)}function oF(n){return new Yu(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gw(n){return Ct(n=Be(n,ct)),new xC(n,e=>Bl(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aF(n,e){const t=Ct(n=Be(n,ct));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Jn("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(u){try{return JSON.parse(u)}catch(d){throw new Y(F.INVALID_ARGUMENT,"Failed to parse JSON: "+(d==null?void 0:d.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const u=v_(l,"collectionGroup"),d=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=ed("setIndexConfiguration",v_(f,"fieldPath"));f.arrayConfig==="CONTAINS"?d.push(new di(g,2)):f.order==="ASCENDING"?d.push(new di(g,0)):f.order==="DESCENDING"&&d.push(new di(g,1))}a.push(new Eo(Eo.UNKNOWN_ID,u,d,To.empty()))}return a}(e);return ZR(t,r)}function v_(n,e){if(typeof n[e]!="string")throw new Y(F.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SC{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function lF(n){var e;n=Be(n,ct);const t=w_.get(n);if(t)return t;if(((e=Ct(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new SC(n);return w_.set(n,r),r}function cF(n){Kw(n,!0)}function uF(n){Kw(n,!1)}function dF(n){tC(Ct(n._firestore)).then(e=>J("deleting all persistent cache indexes succeeded")).catch(e=>Jn("deleting all persistent cache indexes failed",e))}function Kw(n,e){eC(Ct(n._firestore),e).then(t=>J(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>Jn(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const w_=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hF(n){var e;const t=(e=Ct(Be(n.firestore,ct))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:ju(t,wn(n._query))._t}function fF(n,e){var t;const r=zv(e,(i,o)=>new w0(o,i.aggregateType,i._internalFieldPath)),s=(t=Ct(Be(n.firestore,ct))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:V0(s,s0(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pF{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return _p.instance.onExistenceFilterMismatch(e)}}class _p{constructor(){this.Uu=new Map}static get instance(){return Ic||(Ic=new _p,function(t){if(su)throw new Error("a TestingHooksSpi instance is already set");su=t}(Ic)),Ic}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let Ic=null;(function(e,t=!0){(function(s){Bo=s})(Uo),bo(new fi("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new ct(new Yx(r.getProvider("auth-internal")),new eP(r.getProvider("app-check-internal")),function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new Y(F.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new pi(u.options.projectId,d)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),xs(cg,"4.7.3",e),xs(cg,"4.7.3","esm2017")})();function yp(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mF={PHONE:"phone",TOTP:"totp"},gF={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},_F={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},yF={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},vF={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RC(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function Hw(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const wF=RC,CC=Hw,Ww=new Al("auth","Firebase",Hw()),bF={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pu=new gf("@firebase/auth");function kC(n,...e){pu.logLevel<=je.WARN&&pu.warn(`Auth (${Uo}): ${n}`,...e)}function Uc(n,...e){pu.logLevel<=je.ERROR&&pu.error(`Auth (${Uo}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mn(n,...e){throw wp(n,...e)}function Sn(n,...e){return wp(n,...e)}function vp(n,e,t){const r=Object.assign(Object.assign({},CC()),{[e]:t});return new Al("auth","Firebase",r).create(e,{appName:n.name})}function tn(n){return vp(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Jo(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Mn(n,"argument-error"),vp(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function wp(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Ww.create(n,...e)}function se(n,e,...t){if(!n)throw wp(e,...t)}function pr(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Uc(e),new Error(e)}function zr(n,e){n||pr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gl(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function bp(){return b_()==="http:"||b_()==="https:"}function b_(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DC(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(bp()||SA()||"connection"in navigator)?navigator.onLine:!0}function VC(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $l{constructor(e,t){this.shortDelay=e,this.longDelay=t,zr(t>e,"Short delay should be less than long delay!"),this.isMobile=AA()||RA()}get(){return DC()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ip(n,e){zr(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qw{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;pr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;pr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;pr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NC={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OC=new $l(3e4,6e4);function _t(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function yt(n,e,t,r,s={}){return Jw(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Fo(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u=Object.assign({method:e,headers:l},i);return PA()||(u.referrerPolicy="no-referrer"),Qw.fetch()(Yw(n,n.config.apiHost,t,a),u)})}async function Jw(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},NC),e);try{const s=new LC(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Va(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Va(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Va(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Va(n,"user-disabled",o);const d=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw vp(n,d,u);Mn(n,d)}}catch(s){if(s instanceof Wr)throw s;Mn(n,"network-request-failed",{message:String(s)})}}async function Zr(n,e,t,r,s={}){const i=await yt(n,e,t,r,s);return"mfaPendingCredential"in i&&Mn(n,"multi-factor-auth-required",{_serverResponse:i}),i}function Yw(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Ip(n.config,s):`${n.config.apiScheme}://${s}`}function MC(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class LC{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Sn(this.auth,"network-request-failed")),OC.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Va(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Sn(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I_(n){return n!==void 0&&n.getResponse!==void 0}function E_(n){return n!==void 0&&n.enterprise!==void 0}class Xw{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return MC(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FC(n){return(await yt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function Zw(n,e){return yt(n,"GET","/v2/recaptchaConfig",_t(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UC(n,e){return yt(n,"POST","/v1/accounts:delete",e)}async function BC(n,e){return yt(n,"POST","/v1/accounts:update",e)}async function eb(n,e){return yt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wa(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IF(n,e=!1){return be(n).getIdToken(e)}async function $C(n,e=!1){const t=be(n),r=await t.getIdToken(e),s=od(r);se(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Wa(Jd(s.auth_time)),issuedAtTime:Wa(Jd(s.iat)),expirationTime:Wa(Jd(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Jd(n){return Number(n)*1e3}function od(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Uc("JWT malformed, contained fewer than 3 sections"),null;try{const s=hv(t);return s?JSON.parse(s):(Uc("Failed to decode base64 JWT payload"),null)}catch(s){return Uc("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function T_(n){const e=od(n);return se(e,"internal-error"),se(typeof e.exp<"u","internal-error"),se(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gr(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Wr&&jC(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function jC({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qC{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zh{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Wa(this.lastLoginAt),this.creationTime=Wa(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _l(n){var e;const t=n.auth,r=await n.getIdToken(),s=await Gr(n,eb(t,{idToken:r}));se(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?tb(i.providerUserInfo):[],a=GC(n.providerData,o),l=n.isAnonymous,u=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),d=l?u:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new zh(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function zC(n){const e=be(n);await _l(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function GC(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function tb(n){return n.map(e=>{var{providerId:t}=e,r=yp(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KC(n,e){const t=await Jw(n,{},async()=>{const r=Fo({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=Yw(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Qw.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function HC(n,e){return yt(n,"POST","/v2/accounts:revokeToken",_t(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ho{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){se(e.idToken,"internal-error"),se(typeof e.idToken<"u","internal-error"),se(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):T_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){se(e.length!==0,"internal-error");const t=T_(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(se(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await KC(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new ho;return r&&(se(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(se(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(se(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ho,this.toJSON())}_performRefresh(){return pr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cs(n,e){se(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Nr{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=yp(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new qC(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new zh(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Gr(this,this.stsTokenManager.getToken(this.auth,e));return se(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return $C(this,e)}reload(){return zC(this)}_assign(e){this!==e&&(se(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Nr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){se(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await _l(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ft(this.auth.app))return Promise.reject(tn(this.auth));const e=await this.getIdToken();return await Gr(this,UC(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,u,d;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(s=t.email)!==null&&s!==void 0?s:void 0,_=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,k=(o=t.photoURL)!==null&&o!==void 0?o:void 0,P=(a=t.tenantId)!==null&&a!==void 0?a:void 0,R=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,L=(u=t.createdAt)!==null&&u!==void 0?u:void 0,B=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:$,emailVerified:j,isAnonymous:O,providerData:ie,stsTokenManager:x}=t;se($&&x,e,"internal-error");const w=ho.fromJSON(this.name,x);se(typeof $=="string",e,"internal-error"),cs(f,e.name),cs(g,e.name),se(typeof j=="boolean",e,"internal-error"),se(typeof O=="boolean",e,"internal-error"),cs(_,e.name),cs(k,e.name),cs(P,e.name),cs(R,e.name),cs(L,e.name),cs(B,e.name);const I=new Nr({uid:$,auth:e,email:g,emailVerified:j,displayName:f,isAnonymous:O,photoURL:k,phoneNumber:_,tenantId:P,stsTokenManager:w,createdAt:L,lastLoginAt:B});return ie&&Array.isArray(ie)&&(I.providerData=ie.map(S=>Object.assign({},S))),R&&(I._redirectEventId=R),I}static async _fromIdTokenResponse(e,t,r=!1){const s=new ho;s.updateFromServerResponse(t);const i=new Nr({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await _l(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];se(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?tb(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new ho;a.updateFromIdToken(r);const l=new Nr({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new zh(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A_=new Map;function Or(n){zr(n instanceof Function,"Expected a class definition");let e=A_.get(n);return e?(zr(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,A_.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nb{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}nb.type="NONE";const x_=nb;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bc(n,e,t){return`firebase:${n}:${e}:${t}`}class fo{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Bc(this.userKey,s.apiKey,i),this.fullPersistenceKey=Bc("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Nr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new fo(Or(x_),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||Or(x_);const o=Bc(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const d=await u._get(o);if(d){const f=Nr._fromJSON(e,d);u!==i&&(a=f),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new fo(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new fo(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P_(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(ob(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(rb(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(lb(e))return"Blackberry";if(cb(e))return"Webos";if(sb(e))return"Safari";if((e.includes("chrome/")||ib(e))&&!e.includes("edge/"))return"Chrome";if(ab(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function rb(n=Wt()){return/firefox\//i.test(n)}function sb(n=Wt()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function ib(n=Wt()){return/crios\//i.test(n)}function ob(n=Wt()){return/iemobile/i.test(n)}function ab(n=Wt()){return/android/i.test(n)}function lb(n=Wt()){return/blackberry/i.test(n)}function cb(n=Wt()){return/webos/i.test(n)}function Ep(n=Wt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function WC(n=Wt()){var e;return Ep(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function QC(){return CA()&&document.documentMode===10}function ub(n=Wt()){return Ep(n)||ab(n)||cb(n)||lb(n)||/windows phone/i.test(n)||ob(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function db(n,e=[]){let t;switch(n){case"Browser":t=P_(Wt());break;case"Worker":t=`${P_(Wt())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Uo}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YC(n,e={}){return yt(n,"GET","/v2/passwordPolicy",_t(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XC=6;class ZC{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:XC,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e1{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new S_(this),this.idTokenSubscription=new S_(this),this.beforeStateQueue=new JC(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Ww,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Or(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await fo.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await eb(this,{idToken:e}),r=await Nr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Ft(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return se(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await _l(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=VC()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ft(this.app))return Promise.reject(tn(this));const t=e?be(e):null;return t&&se(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&se(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ft(this.app)?Promise.reject(tn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ft(this.app)?Promise.reject(tn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Or(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await YC(this),t=new ZC(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Al("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await HC(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Or(e)||this._popupRedirectResolver;se(t,this,"argument-error"),this.redirectPersistenceManager=await fo.create(this,[Or(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(se(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return se(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=db(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&kC(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Nt(n){return be(n)}class S_{constructor(e){this.auth=e,this.observer=null,this.addObserver=MA(t=>this.observer=t)}get next(){return se(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jl={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function t1(n){jl=n}function Tp(n){return jl.loadJS(n)}function n1(){return jl.recaptchaV2Script}function r1(){return jl.recaptchaEnterpriseScript}function s1(){return jl.gapiScript}function hb(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const i1="recaptcha-enterprise",o1="NO_RECAPTCHA";class fb{constructor(e){this.type=i1,this.auth=Nt(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{Zw(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new Xw(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;E_(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(o1)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&E_(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=r1();l.length!==0&&(l+=a),Tp(l).then(()=>{s(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function R_(n,e,t,r=!1){const s=new fb(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function yl(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await R_(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await R_(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function a1(n){const e=Nt(n),t=await Zw(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new Xw(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new fb(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l1(n,e){const t=xl(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Rs(i,e??{}))return s;Mn(s,"already-initialized")}return t.initialize({options:e})}function c1(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Or);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function u1(n,e,t){const r=Nt(n);se(r._canInitEmulator,r,"emulator-config-failed"),se(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=pb(e),{host:o,port:a}=d1(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||h1()}function pb(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function d1(n){const e=pb(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:C_(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:C_(o)}}}function C_(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function h1(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ql{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return pr("not implemented")}_getIdTokenResponse(e){return pr("not implemented")}_linkToIdToken(e,t){return pr("not implemented")}_getReauthenticationResolver(e){return pr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mb(n,e){return yt(n,"POST","/v1/accounts:resetPassword",_t(n,e))}async function f1(n,e){return yt(n,"POST","/v1/accounts:update",e)}async function p1(n,e){return yt(n,"POST","/v1/accounts:signUp",e)}async function m1(n,e){return yt(n,"POST","/v1/accounts:update",_t(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function g1(n,e){return Zr(n,"POST","/v1/accounts:signInWithPassword",_t(n,e))}async function ad(n,e){return yt(n,"POST","/v1/accounts:sendOobCode",_t(n,e))}async function _1(n,e){return ad(n,e)}async function y1(n,e){return ad(n,e)}async function v1(n,e){return ad(n,e)}async function w1(n,e){return ad(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function b1(n,e){return Zr(n,"POST","/v1/accounts:signInWithEmailLink",_t(n,e))}async function I1(n,e){return Zr(n,"POST","/v1/accounts:signInWithEmailLink",_t(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vl extends ql{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new vl(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new vl(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yl(e,t,"signInWithPassword",g1);case"emailLink":return b1(e,{email:this._email,oobCode:this._password});default:Mn(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yl(e,r,"signUpPassword",p1);case"emailLink":return I1(e,{idToken:t,email:this._email,oobCode:this._password});default:Mn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fr(n,e){return Zr(n,"POST","/v1/accounts:signInWithIdp",_t(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E1="http://localhost";class Kr extends ql{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Kr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Mn("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=yp(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new Kr(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Fr(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Fr(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Fr(e,t)}buildRequest(){const e={requestUri:E1,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Fo(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T1(n,e){return yt(n,"POST","/v1/accounts:sendVerificationCode",_t(n,e))}async function A1(n,e){return Zr(n,"POST","/v1/accounts:signInWithPhoneNumber",_t(n,e))}async function x1(n,e){const t=await Zr(n,"POST","/v1/accounts:signInWithPhoneNumber",_t(n,e));if(t.temporaryProof)throw Va(n,"account-exists-with-different-credential",t);return t}const P1={USER_NOT_FOUND:"user-not-found"};async function S1(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Zr(n,"POST","/v1/accounts:signInWithPhoneNumber",_t(n,t),P1)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hi extends ql{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new hi({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new hi({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return A1(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return x1(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return S1(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new hi({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R1(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function C1(n){const e=Pa(Sa(n)).link,t=e?Pa(Sa(e)).deep_link_id:null,r=Pa(Sa(n)).deep_link_id;return(r?Pa(Sa(r)).link:null)||r||t||e||n}class zl{constructor(e){var t,r,s,i,o,a;const l=Pa(Sa(e)),u=(t=l.apiKey)!==null&&t!==void 0?t:null,d=(r=l.oobCode)!==null&&r!==void 0?r:null,f=R1((s=l.mode)!==null&&s!==void 0?s:null);se(u&&d&&f,"argument-error"),this.apiKey=u,this.operation=f,this.code=d,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=C1(e);try{return new zl(t)}catch{return null}}}function EF(n){return zl.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ci{constructor(){this.providerId=Ci.PROVIDER_ID}static credential(e,t){return vl._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=zl.parseLink(t);return se(r,"argument-error"),vl._fromEmailAndCode(e,r.code,r.tenantId)}}Ci.PROVIDER_ID="password";Ci.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ci.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class es{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yo extends es{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class $c extends Yo{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return se("providerId"in t&&"signInMethod"in t,"argument-error"),Kr._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return se(e.idToken||e.accessToken,"argument-error"),Kr._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return $c.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return $c.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new $c(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys extends Yo{constructor(){super("facebook.com")}static credential(e){return Kr._fromParams({providerId:ys.PROVIDER_ID,signInMethod:ys.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ys.credentialFromTaggedObject(e)}static credentialFromError(e){return ys.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ys.credential(e.oauthAccessToken)}catch{return null}}}ys.FACEBOOK_SIGN_IN_METHOD="facebook.com";ys.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vs extends Yo{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Kr._fromParams({providerId:vs.PROVIDER_ID,signInMethod:vs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return vs.credentialFromTaggedObject(e)}static credentialFromError(e){return vs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return vs.credential(t,r)}catch{return null}}}vs.GOOGLE_SIGN_IN_METHOD="google.com";vs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends Yo{constructor(){super("github.com")}static credential(e){return Kr._fromParams({providerId:ws.PROVIDER_ID,signInMethod:ws.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ws.credentialFromTaggedObject(e)}static credentialFromError(e){return ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ws.credential(e.oauthAccessToken)}catch{return null}}}ws.GITHUB_SIGN_IN_METHOD="github.com";ws.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k1="http://localhost";class wl extends ql{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Fr(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Fr(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Fr(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new wl(r,i)}static _create(e,t){return new wl(e,t)}buildRequest(){return{requestUri:k1,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D1="saml.";class Gh extends es{constructor(e){se(e.startsWith(D1),"argument-error"),super(e)}static credentialFromResult(e){return Gh.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Gh.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=wl.fromJSON(e);return se(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return wl._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs extends Yo{constructor(){super("twitter.com")}static credential(e,t){return Kr._fromParams({providerId:bs.PROVIDER_ID,signInMethod:bs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return bs.credentialFromTaggedObject(e)}static credentialFromError(e){return bs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return bs.credential(t,r)}catch{return null}}}bs.TWITTER_SIGN_IN_METHOD="twitter.com";bs.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gb(n,e){return Zr(n,"POST","/v1/accounts:signUp",_t(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Nr._fromIdTokenResponse(e,r,s),o=k_(r);return new Yn({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=k_(r);return new Yn({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function k_(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V1(n){var e;if(Ft(n.app))return Promise.reject(tn(n));const t=Nt(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Yn({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await gb(t,{returnSecureToken:!0}),s=await Yn._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mu extends Wr{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,mu.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new mu(e,t,r,s)}}function _b(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?mu._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yb(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TF(n,e){const t=be(n);await ld(!0,t,e);const{providerUserInfo:r}=await BC(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=yb(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Ap(n,e,t=!1){const r=await Gr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Yn._forOperation(n,"link",r)}async function ld(n,e,t){await _l(e);const r=yb(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";se(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vb(n,e,t=!1){const{auth:r}=n;if(Ft(r.app))return Promise.reject(tn(r));const s="reauthenticate";try{const i=await Gr(n,_b(r,s,e,n),t);se(i.idToken,r,"internal-error");const o=od(i.idToken);se(o,r,"internal-error");const{sub:a}=o;return se(n.uid===a,r,"user-mismatch"),Yn._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Mn(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wb(n,e,t=!1){if(Ft(n.app))return Promise.reject(tn(n));const r="signIn",s=await _b(n,r,e),i=await Yn._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function xp(n,e){return wb(Nt(n),e)}async function N1(n,e){const t=be(n);return await ld(!1,t,e.providerId),Ap(t,e)}async function O1(n,e){return vb(be(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M1(n,e){return Zr(n,"POST","/v1/accounts:signInWithCustomToken",_t(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AF(n,e){if(Ft(n.app))return Promise.reject(tn(n));const t=Nt(n),r=await M1(t,{token:e,returnSecureToken:!0}),s=await Yn._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gl{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Pp._fromServerResponse(e,t):"totpInfo"in t?Sp._fromServerResponse(e,t):Mn(e,"internal-error")}}class Pp extends Gl{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Pp(t)}}class Sp extends Gl{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Sp(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cd(n,e,t){var r;se(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),se(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(se(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(se(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rp(n){const e=Nt(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function L1(n,e,t){const r=Nt(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&cd(r,s,t),await yl(r,s,"getOobCode",y1)}async function F1(n,e,t){await mb(be(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Rp(n),r})}async function xF(n,e){await m1(be(n),{oobCode:e})}async function U1(n,e){const t=be(n),r=await mb(t,{oobCode:e}),s=r.requestType;switch(se(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":se(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":se(r.mfaInfo,t,"internal-error");default:se(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Gl._fromServerResponse(Nt(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function PF(n,e){const{data:t}=await U1(be(n),e);return t.email}async function B1(n,e,t){if(Ft(n.app))return Promise.reject(tn(n));const r=Nt(n),o=await yl(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",gb).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Rp(n),l}),a=await Yn._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function $1(n,e,t){return Ft(n.app)?Promise.reject(tn(n)):xp(be(n),Ci.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Rp(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SF(n,e,t){const r=Nt(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){se(a.handleCodeInApp,r,"argument-error"),a&&cd(r,o,a)}i(s,t),await yl(r,s,"getOobCode",v1)}function RF(n,e){const t=zl.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function CF(n,e,t){if(Ft(n.app))return Promise.reject(tn(n));const r=be(n),s=Ci.credentialWithLink(e,t||gl());return se(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),xp(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j1(n,e){return yt(n,"POST","/v1/accounts:createAuthUri",_t(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kF(n,e){const t=bp()?gl():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await j1(be(n),r);return s||[]}async function DF(n,e){const t=be(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&cd(t.auth,s,e);const{email:i}=await _1(t.auth,s);i!==n.email&&await n.reload()}async function VF(n,e,t){const r=be(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&cd(r.auth,i,t);const{email:o}=await w1(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function q1(n,e){return yt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NF(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=be(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Gr(r,q1(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function OF(n,e){const t=be(n);return Ft(t.auth.app)?Promise.reject(tn(t.auth)):bb(t,e,null)}function z1(n,e){return bb(be(n),null,e)}async function bb(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Gr(n,f1(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G1(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=od(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new po(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new K1(i,s);case"github.com":return new H1(i,s);case"google.com":return new W1(i,s);case"twitter.com":return new Q1(i,s,n.screenName||null);case"custom":case"anonymous":return new po(i,null);default:return new po(i,r,s)}}class po{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class Ib extends po{constructor(e,t,r,s){super(e,t,r),this.username=s}}class K1 extends po{constructor(e,t){super(e,"facebook.com",t)}}class H1 extends Ib{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class W1 extends po{constructor(e,t){super(e,"google.com",t)}}class Q1 extends Ib{constructor(e,t,r){super(e,"twitter.com",t,r)}}function MF(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:G1(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LF(n,e){return be(n).setPersistence(e)}function FF(n){return a1(n)}async function UF(n,e){return Nt(n).validatePassword(e)}function J1(n,e,t,r){return be(n).onIdTokenChanged(e,t,r)}function Y1(n,e,t){return be(n).beforeAuthStateChanged(e,t)}function BF(n,e,t,r){return be(n).onAuthStateChanged(e,t,r)}function $F(n){be(n).useDeviceLanguage()}function jF(n,e){return be(n).updateCurrentUser(e)}function qF(n){return be(n).signOut()}function zF(n,e){return Nt(n).revokeAccessToken(e)}async function GF(n){return be(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new ai("enroll",e,t)}static _fromMfaPendingCredential(e){return new ai("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return ai._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return ai._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cp{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=Nt(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Gl._fromServerResponse(r,a));se(s.mfaPendingCredential,r,"internal-error");const o=ai._fromMfaPendingCredential(s.mfaPendingCredential);return new Cp(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const u=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const d=await Yn._fromIdTokenResponse(r,t.operationType,u);return await r._updateCurrentUser(d.user),d;case"reauthenticate":return se(t.user,r,"internal-error"),Yn._forOperation(t.user,t.operationType,u);default:Mn(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function KF(n,e){var t;const r=be(n),s=e;return se(e.customData.operationType,r,"argument-error"),se((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Cp._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X1(n,e){return yt(n,"POST","/v2/accounts/mfaEnrollment:start",_t(n,e))}function Z1(n,e){return yt(n,"POST","/v2/accounts/mfaEnrollment:finalize",_t(n,e))}function ek(n,e){return yt(n,"POST","/v2/accounts/mfaEnrollment:start",_t(n,e))}function tk(n,e){return yt(n,"POST","/v2/accounts/mfaEnrollment:finalize",_t(n,e))}function nk(n,e){return yt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",_t(n,e))}class kp{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Gl._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new kp(e)}async getSession(){return ai._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Gr(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Gr(this.user,nk(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Yd=new WeakMap;function HF(n){const e=be(n);return Yd.has(e)||Yd.set(e,kp._fromUser(e)),Yd.get(e)}const gu="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eb{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(gu,"1"),this.storage.removeItem(gu),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rk=1e3,sk=10;class Tb extends Eb{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ub(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);QC()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,sk):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},rk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Tb.type="LOCAL";const ik=Tb;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ab extends Eb{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Ab.type="SESSION";const xb=Ab;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ok(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ud{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new ud(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await ok(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ud.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dd(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ak{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=dd("",20);s.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===u)switch(g.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zt(){return window}function lk(n){zt().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dp(){return typeof zt().WorkerGlobalScope<"u"&&typeof zt().importScripts=="function"}async function ck(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function uk(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function dk(){return Dp()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pb="firebaseLocalStorageDb",hk=1,_u="firebaseLocalStorage",Sb="fbase_key";class Kl{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function hd(n,e){return n.transaction([_u],e?"readwrite":"readonly").objectStore(_u)}function fk(){const n=indexedDB.deleteDatabase(Pb);return new Kl(n).toPromise()}function Kh(){const n=indexedDB.open(Pb,hk);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(_u,{keyPath:Sb})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(_u)?e(r):(r.close(),await fk(),e(await Kh()))})})}async function D_(n,e,t){const r=hd(n,!0).put({[Sb]:e,value:t});return new Kl(r).toPromise()}async function pk(n,e){const t=hd(n,!1).get(e),r=await new Kl(t).toPromise();return r===void 0?null:r.value}function V_(n,e){const t=hd(n,!0).delete(e);return new Kl(t).toPromise()}const mk=800,gk=3;class Rb{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Kh(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>gk)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Dp()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ud._getInstance(dk()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await ck(),!this.activeServiceWorker)return;this.sender=new ak(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||uk()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Kh();return await D_(e,gu,"1"),await V_(e,gu),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>D_(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>pk(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>V_(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=hd(s,!1).getAll();return new Kl(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),mk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Rb.type="LOCAL";const _k=Rb;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yk(n,e){return yt(n,"POST","/v2/accounts/mfaSignIn:start",_t(n,e))}function vk(n,e){return yt(n,"POST","/v2/accounts/mfaSignIn:finalize",_t(n,e))}function wk(n,e){return yt(n,"POST","/v2/accounts/mfaSignIn:finalize",_t(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bk=500,Ik=6e4,Ec=1e12;class Ek{constructor(e){this.auth=e,this.counter=Ec,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new Tk(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Ec;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Ec;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Ec;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class Tk{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;se(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=Ak(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},Ik)},bk))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function Ak(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xd=hb("rcb"),xk=new $l(3e4,6e4);class Pk{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=zt().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return se(Sk(t),e,"argument-error"),this.shouldResolveImmediately(t)&&I_(zt().grecaptcha)?Promise.resolve(zt().grecaptcha):new Promise((r,s)=>{const i=zt().setTimeout(()=>{s(Sn(e,"network-request-failed"))},xk.get());zt()[Xd]=()=>{zt().clearTimeout(i),delete zt()[Xd];const a=zt().grecaptcha;if(!a||!I_(a)){s(Sn(e,"internal-error"));return}const l=a.render;a.render=(u,d)=>{const f=l(u,d);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${n1()}?${Fo({onload:Xd,render:"explicit",hl:t})}`;Tp(o).catch(()=>{clearTimeout(i),s(Sn(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=zt().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function Sk(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class Rk{async load(e){return new Ek(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cb="recaptcha",Ck={theme:"light",type:"image"};class WF{constructor(e,t,r=Object.assign({},Ck)){this.parameters=r,this.type=Cb,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Nt(e),this.isInvisible=this.parameters.size==="invisible",se(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;se(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Rk:new Pk,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){se(!this.parameters.sitekey,this.auth,"argument-error"),se(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),se(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=zt()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){se(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){se(bp()&&!Dp(),this.auth,"internal-error"),await kk(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await FC(this.auth);se(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return se(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function kk(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vp{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=hi._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function QF(n,e,t){if(Ft(n.app))return Promise.reject(tn(n));const r=Nt(n),s=await fd(r,e,be(t));return new Vp(s,i=>xp(r,i))}async function JF(n,e,t){const r=be(n);await ld(!1,r,"phone");const s=await fd(r.auth,e,be(t));return new Vp(s,i=>N1(r,i))}async function YF(n,e,t){const r=be(n);if(Ft(r.auth.app))return Promise.reject(tn(r.auth));const s=await fd(r.auth,e,be(t));return new Vp(s,i=>O1(r,i))}async function fd(n,e,t){var r;const s=await t.verify();try{se(typeof s=="string",n,"argument-error"),se(t.type===Cb,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return se(o.type==="enroll",n,"internal-error"),(await X1(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{se(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return se(a,n,"missing-multi-factor-info"),(await yk(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await T1(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function XF(n,e){const t=be(n);if(Ft(t.auth.app))return Promise.reject(tn(t.auth));await Ap(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo{constructor(e){this.providerId=mo.PROVIDER_ID,this.auth=Nt(e)}verifyPhoneNumber(e,t){return fd(this.auth,e,be(t))}static credential(e,t){return hi._fromVerification(e,t)}static credentialFromResult(e){const t=e;return mo.credentialFromTaggedObject(t)}static credentialFromError(e){return mo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?hi._fromTokenResponse(t,r):null}}mo.PROVIDER_ID="phone";mo.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ki(n,e){return e?Or(e):(se(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Np extends ql{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Fr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Fr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Fr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Dk(n){return wb(n.auth,new Np(n),n.bypassAuthState)}function Vk(n){const{auth:e,user:t}=n;return se(t,e,"internal-error"),vb(t,new Np(n),n.bypassAuthState)}async function Nk(n){const{auth:e,user:t}=n;return se(t,e,"internal-error"),Ap(t,new Np(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kb{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Dk;case"linkViaPopup":case"linkViaRedirect":return Nk;case"reauthViaPopup":case"reauthViaRedirect":return Vk;default:Mn(this.auth,"internal-error")}}resolve(e){zr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){zr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ok=new $l(2e3,1e4);async function ZF(n,e,t){if(Ft(n.app))return Promise.reject(Sn(n,"operation-not-supported-in-this-environment"));const r=Nt(n);Jo(n,e,es);const s=ki(r,t);return new Mr(r,"signInViaPopup",e,s).executeNotNull()}async function e4(n,e,t){const r=be(n);if(Ft(r.auth.app))return Promise.reject(Sn(r.auth,"operation-not-supported-in-this-environment"));Jo(r.auth,e,es);const s=ki(r.auth,t);return new Mr(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function t4(n,e,t){const r=be(n);Jo(r.auth,e,es);const s=ki(r.auth,t);return new Mr(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Mr extends kb{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Mr.currentPopupAction&&Mr.currentPopupAction.cancel(),Mr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return se(e,this.auth,"internal-error"),e}async onExecution(){zr(this.filter.length===1,"Popup operations only handle one event");const e=dd();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Sn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Sn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Mr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Sn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Ok.get())};e()}}Mr.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mk="pendingRedirect",jc=new Map;class Lk extends kb{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=jc.get(this.auth._key());if(!e){try{const r=await Fk(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}jc.set(this.auth._key(),e)}return this.bypassAuthState||jc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Fk(n,e){const t=Vb(e),r=Db(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function Op(n,e){return Db(n)._set(Vb(e),"true")}function Uk(n,e){jc.set(n._key(),e)}function Db(n){return Or(n._redirectPersistence)}function Vb(n){return Bc(Mk,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n4(n,e,t){return Bk(n,e,t)}async function Bk(n,e,t){if(Ft(n.app))return Promise.reject(tn(n));const r=Nt(n);Jo(n,e,es),await r._initializationPromise;const s=ki(r,t);return await Op(s,r),s._openRedirect(r,e,"signInViaRedirect")}function r4(n,e,t){return $k(n,e,t)}async function $k(n,e,t){const r=be(n);if(Jo(r.auth,e,es),Ft(r.auth.app))return Promise.reject(tn(r.auth));await r.auth._initializationPromise;const s=ki(r.auth,t);await Op(s,r.auth);const i=await Ob(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function s4(n,e,t){return jk(n,e,t)}async function jk(n,e,t){const r=be(n);Jo(r.auth,e,es),await r.auth._initializationPromise;const s=ki(r.auth,t);await ld(!1,r,e.providerId),await Op(s,r.auth);const i=await Ob(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function i4(n,e){return await Nt(n)._initializationPromise,Nb(n,e,!1)}async function Nb(n,e,t=!1){if(Ft(n.app))return Promise.reject(tn(n));const r=Nt(n),s=ki(r,e),o=await new Lk(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function Ob(n){const e=dd(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qk=10*60*1e3;class zk{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Gk(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!Mb(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Sn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=qk&&this.cachedEventUids.clear(),this.cachedEventUids.has(N_(e))}saveEventToCache(e){this.cachedEventUids.add(N_(e)),this.lastProcessedEventTime=Date.now()}}function N_(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Mb({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Gk(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Mb(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kk(n,e={}){return yt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hk=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Wk=/^https?/;async function Qk(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Kk(n);for(const t of e)try{if(Jk(t))return}catch{}Mn(n,"unauthorized-domain")}function Jk(n){const e=gl(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!Wk.test(t))return!1;if(Hk.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yk=new $l(3e4,6e4);function O_(){const n=zt().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Xk(n){return new Promise((e,t)=>{var r,s,i;function o(){O_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{O_(),t(Sn(n,"network-request-failed"))},timeout:Yk.get()})}if(!((s=(r=zt().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=zt().gapi)===null||i===void 0)&&i.load)o();else{const a=hb("iframefcb");return zt()[a]=()=>{gapi.load?o():t(Sn(n,"network-request-failed"))},Tp(`${s1()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw qc=null,e})}let qc=null;function Zk(n){return qc=qc||Xk(n),qc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eD=new $l(5e3,15e3),tD="__/auth/iframe",nD="emulator/auth/iframe",rD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},sD=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function iD(n){const e=n.config;se(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Ip(e,nD):`https://${n.config.authDomain}/${tD}`,r={apiKey:e.apiKey,appName:n.name,v:Uo},s=sD.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Fo(r).slice(1)}`}async function oD(n){const e=await Zk(n),t=zt().gapi;return se(t,n,"internal-error"),e.open({where:document.body,url:iD(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:rD,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Sn(n,"network-request-failed"),a=zt().setTimeout(()=>{i(o)},eD.get());function l(){zt().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aD={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},lD=500,cD=600,uD="_blank",dD="http://localhost";class M_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function hD(n,e,t,r=lD,s=cD){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},aD),{width:r.toString(),height:s.toString(),top:i,left:o}),u=Wt().toLowerCase();t&&(a=ib(u)?uD:t),rb(u)&&(e=e||dD,l.scrollbars="yes");const d=Object.entries(l).reduce((g,[_,k])=>`${g}${_}=${k},`,"");if(WC(u)&&a!=="_self")return fD(e||"",a),new M_(null);const f=window.open(e||"",a,d);se(f,n,"popup-blocked");try{f.focus()}catch{}return new M_(f)}function fD(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pD="__/auth/handler",mD="emulator/auth/handler",gD=encodeURIComponent("fac");async function L_(n,e,t,r,s,i){se(n.config.authDomain,n,"auth-domain-config-required"),se(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Uo,eventId:s};if(e instanceof es){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",OA(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,f]of Object.entries(i||{}))o[d]=f}if(e instanceof Yo){const d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const l=await n._getAppCheckToken(),u=l?`#${gD}=${encodeURIComponent(l)}`:"";return`${_D(n)}?${Fo(a).slice(1)}${u}`}function _D({config:n}){return n.emulator?Ip(n,mD):`https://${n.authDomain}/${pD}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zd="webStorageSupport";class yD{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=xb,this._completeRedirectFn=Nb,this._overrideRedirectResult=Uk}async _openPopup(e,t,r,s){var i;zr((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await L_(e,t,r,gl(),s);return hD(e,o,dd())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await L_(e,t,r,gl(),s);return lk(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(zr(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await oD(e),r=new zk(e);return t.register("authEvent",s=>(se(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Zd,{type:Zd},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Zd];o!==void 0&&t(!!o),Mn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Qk(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ub()||sb()||Ep()}}const vD=yD;class Lb{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return pr("unexpected MultiFactorSessionType")}}}class Mp extends Lb{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Mp(e)}_finalizeEnroll(e,t,r){return Z1(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return vk(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class wD{constructor(){}static assertion(e){return Mp._fromCredential(e)}}wD.FACTOR_ID="phone";class bD{static assertionForEnrollment(e,t){return bl._fromSecret(e,t)}static assertionForSignIn(e,t){return bl._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;se(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await ek(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return Lp._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}bD.FACTOR_ID="totp";class bl extends Lb{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new bl(t,void 0,e)}static _fromEnrollmentId(e,t){return new bl(t,e)}async _finalizeEnroll(e,t,r){return se(typeof this.secret<"u",e,"argument-error"),tk(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){se(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return wk(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class Lp{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new Lp(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(Tc(e)||Tc(t))&&(s=!0),s&&(Tc(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),Tc(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Tc(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var F_="@firebase/auth",U_="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ID{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){se(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ED(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function TD(n){bo(new fi("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;se(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:db(n)},u=new e1(r,s,i,l);return c1(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),bo(new fi("auth-internal",e=>{const t=Nt(e.getProvider("auth").getImmediate());return(r=>new ID(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),xs(F_,U_,ED(n)),xs(F_,U_,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AD=5*60,xD=mv("authIdTokenMaxAge")||AD;let B_=null;const PD=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>xD)return;const s=t==null?void 0:t.token;B_!==s&&(B_=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function SD(n=bv()){const e=xl(n,"auth");if(e.isInitialized())return e.getImmediate();const t=l1(n,{popupRedirectResolver:vD,persistence:[_k,ik,xb]}),r=mv("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=PD(i.toString());Y1(t,o,()=>o(t.currentUser)),J1(t,a=>o(a))}}const s=fv("auth");return s&&u1(t,`http://${s}`),t}function RD(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}t1({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Sn("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",RD().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});TD("Browser");const CD={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},Fb=wv(CD),ye=iC(Fb),Di=SD(Fb);V1(Di);async function kD(n,e){try{return(await B1(Di,n,e)).user}catch(t){throw t}}async function DD(n,e){try{return(await $1(Di,n,e)).user}catch(t){throw t}}async function VD(n){try{await L1(Di,n)}catch(e){throw e}}async function ND(n){try{const e=Di.currentUser;if(e)await z1(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const go=Object.freeze(Object.defineProperty({__proto__:null,auth:Di,createPlayerAccount:kD,db:ye,resetPlayerPassword:VD,signInPlayer:DD,updatePlayerPassword:ND},Symbol.toStringTag,{value:"Module"})),Hl="seasons";async function OD(n,e,t){return await zw(Ze(ye,Hl),{name:n,slug:e,pinCode:t,createdAt:gp()})}async function MD(n){return await ml(Ve(ye,Hl,n))}async function eh(){const n=Uw(Ze(ye,Hl),fC("createdAt","desc"));return(await St(n)).docs.map(t=>({id:t.id,...t.data()}))}async function yu(n,e){const t=await Ri(Ve(ye,Hl,n));return t.exists()?t.data().pinCode===e:!1}async function Hh(n){const e=await Ri(Ve(ye,Hl,n));return e.exists()?e.data().pinCode:null}const th=10*60*1e3,nh="impro_selector_pin_session";class LD{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(nh);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<th)return t;this.clearSession()}}catch(e){console.error("Erreur lors du chargement de la session PIN:",e)}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(nh,JSON.stringify(r)),this.sessionData=r}catch(r){console.error("Erreur lors de la sauvegarde de la session PIN:",r)}}isPinCached(e){return this.sessionData?this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<th:!1}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(nh),this.sessionData=null}catch(e){console.error("Erreur lors de la suppression de la session PIN:",e)}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=th-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const Dn=new LD,FD={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},UD={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},BD={class:"text-center mb-6"},$D={class:"text-gray-300"},jD={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},qD={class:"text-sm text-green-400"},zD={class:"mb-4 flex justify-center"},GD={class:"flex bg-gray-800 rounded-lg p-1"},KD={key:0,class:"mb-6"},HD={class:"mb-4"},WD={key:1,class:"mb-6"},QD={class:"flex justify-center space-x-3 mb-4"},JD={class:"grid grid-cols-3 gap-3 mb-4"},YD=["onClick"],XD={key:2,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},ZD={class:"flex justify-end space-x-3"},eV=["disabled"],Ub={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=q(""),i=q(""),o=q("direct"),a=q(null);ar(()=>t.show,P=>{P&&(s.value="",i.value="",o.value==="direct"&&Lr(()=>{var R;(R=a.value)==null||R.focus()}))}),ar(o,P=>{P==="direct"&&t.show&&Lr(()=>{var R;(R=a.value)==null||R.focus()})});function l(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function u(P){s.value.length<4&&(s.value+=P.toString())}function d(){s.value=s.value.slice(0,-1)}function f(){s.value="",i.value=""}function g(){s.value.length===4&&r("submit",s.value)}function _(){r("cancel")}const k=P=>{t.show&&(P.key>="0"&&P.key<="9"?o.value==="keypad"&&u(parseInt(P.key)):P.key==="Backspace"?o.value==="keypad"&&d():P.key==="Enter"?g():P.key==="Escape"&&_())};return typeof window<"u"&&window.addEventListener("keydown",k),(P,R)=>n.show?(H(),W("div",FD,[m("div",UD,[m("div",BD,[R[4]||(R[4]=m("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[m("span",{class:"text-2xl"},"🔒")],-1)),R[5]||(R[5]=m("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),m("p",$D,ge(n.message),1),n.sessionInfo?(H(),W("div",jD,[m("p",qD," Session active : "+ge(n.sessionInfo.timeRemaining)+" min restantes ",1)])):Ee("",!0)]),m("div",zD,[m("div",GD,[m("button",{onClick:R[0]||(R[0]=L=>o.value="direct"),class:sr(["px-4 py-2 rounded-md text-sm font-medium transition-all duration-200",o.value==="direct"?"bg-purple-600 text-white":"text-gray-400 hover:text-white"])}," Saisie directe ",2),m("button",{onClick:R[1]||(R[1]=L=>o.value="keypad"),class:sr(["px-4 py-2 rounded-md text-sm font-medium transition-all duration-200",o.value==="keypad"?"bg-purple-600 text-white":"text-gray-400 hover:text-white"])}," Pavé numérique ",2)])]),o.value==="direct"?(H(),W("div",KD,[m("div",HD,[R[6]||(R[6]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),mt(m("input",{"onUpdate:modelValue":R[2]||(R[2]=L=>s.value=L),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:l,onKeydown:[An(g,["enter"]),An(_,["escape"])],ref_key:"pinInput",ref:a},null,544),[[Pt,s.value]])]),R[7]||(R[7]=m("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))])):(H(),W("div",WD,[m("div",QD,[(H(),W(Dt,null,Dr(4,(L,B)=>m("div",{key:B,class:sr(["w-12 h-12 border-2 border-gray-600 rounded-lg flex items-center justify-center text-2xl font-bold text-white bg-gray-800",{"border-purple-500 bg-purple-900/20":s.value.length>B}])},ge(s.value[B]||"•"),3)),64))]),m("div",JD,[(H(),W(Dt,null,Dr([1,2,3,4,5,6,7,8,9],L=>m("button",{key:L,onClick:B=>u(L),class:"w-12 h-12 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-bold text-xl transition-all duration-200 hover:scale-105"},ge(L),9,YD)),64)),m("button",{onClick:f,class:"w-12 h-12 bg-red-600 hover:bg-red-500 text-white rounded-lg font-bold text-lg transition-all duration-200 hover:scale-105"}," C "),m("button",{onClick:R[3]||(R[3]=L=>u(0)),class:"w-12 h-12 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-bold text-xl transition-all duration-200 hover:scale-105"}," 0 "),m("button",{onClick:d,class:"w-12 h-12 bg-gray-600 hover:bg-gray-500 text-white rounded-lg font-bold text-lg transition-all duration-200 hover:scale-105"}," ← ")])])),i.value||t.error?(H(),W("div",XD,ge(i.value||t.error),1)):Ee("",!0),m("div",ZD,[m("button",{onClick:_,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),m("button",{onClick:g,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,eV)])])])):Ee("",!0)}},tV={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},nV={class:"container mx-auto px-4 pb-16"},rV={class:"flex justify-center mb-12"},sV={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto"},iV=["onClick"],oV={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},aV=["onClick"],lV={key:0,class:"text-center py-16"},cV={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},uV={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},dV={class:"mb-6"},hV={class:"mb-6"},fV={class:"mb-6"},pV={class:"flex justify-end space-x-3"},mV=["disabled"],gV={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},_V={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},yV={class:"text-center mb-6"},vV={class:"text-gray-300"},wV={__name:"Home",setup(n){const e=q([]),t=Nu(),r=q(!1),s=q(!1),i=q(""),o=q(""),a=q(""),l=q(null),u=q(!1),d=q(null),f=q("");_o(async()=>{e.value=await eh(),console.log("Saisons chargées:",e.value)});function g(S){t.push(`/season/${S}`)}function _(){i.value&&(o.value=i.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function k(){a.value=a.value.replace(/[^0-9]/g,""),a.value.length>4&&(a.value=a.value.slice(0,4))}async function P(){if(!i.value.trim()||!o.value.trim()||!a.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(a.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await OD(i.value.trim(),o.value.trim(),a.value.trim()),e.value=await eh(),R()}catch(S){console.error("Erreur lors de la création de la saison:",S),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function R(){r.value=!1,i.value="",o.value="",a.value=""}function L(S){l.value=S,s.value=!0}async function B(){s.value=!1,await O({type:"deleteSeason",data:{seasonId:l.value.id,seasonName:l.value.name}})}function $(){s.value=!1,l.value=null}function j(){return d.value?{deleteSeason:"Suppression de saison - Code PIN requis"}[d.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function O(S){if(Dn.isPinCached(l.value.id)){const T=Dn.getCachedPin(l.value.id);if(console.log("PIN en cache trouvé, utilisation automatique"),await yu(l.value.id,T)){await I(S);return}else Dn.clearSession()}d.value=S,u.value=!0}async function ie(S){var T,D,E;console.log("PIN soumis:",S,"pour l'opération:",d.value);try{const vt=((D=(T=d.value)==null?void 0:T.data)==null?void 0:D.seasonId)||((E=l.value)==null?void 0:E.id),Ot=await yu(vt,S);if(console.log("PIN valide:",Ot),Ot){Dn.saveSession(vt,S),console.log("PIN correct, fermeture de la modal et exécution de l'opération"),u.value=!1;const He=d.value;d.value=null,console.log("Appel de executePendingOperation avec:",He),await I(He)}else f.value="Code PIN incorrect",setTimeout(()=>{f.value=""},3e3)}catch(vt){console.error("Erreur lors de la vérification du PIN:",vt),f.value="Erreur lors de la vérification du code PIN"}}function x(){u.value=!1,d.value=null,f.value=""}function w(){return l.value&&Dn.isPinCached(l.value.id)?{timeRemaining:Dn.getTimeRemaining(),isExpiringSoon:Dn.isExpiringSoon()}:null}async function I(S){if(console.log("executePendingOperation appelé avec:",S),!S){console.log("Aucune opération à exécuter");return}const{type:T,data:D}=S;console.log("Exécution de l'opération:",T,"avec données:",D);try{switch(T){case"deleteSeason":console.log("Suppression de la saison ID:",D.seasonId),await MD(D.seasonId),console.log("Saison supprimée, rechargement de la liste..."),e.value=await eh(),console.log("Nouvelle liste des saisons:",e.value);break;default:console.log("Type d'opération non reconnu:",T)}}catch(E){console.error("Erreur lors de l'exécution de l'opération:",E),alert("Erreur lors de l'opération. Veuillez réessayer.")}}return(S,T)=>{var D;return H(),W("div",tV,[T[20]||(T[20]=m("div",{class:"text-center py-16 px-4"},[m("h1",{class:"text-6xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent animate-pulse"}," Sélections Spectacle "),m("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto leading-relaxed"}," Gérez facilement les sélections pour vos spectacles. ")],-1)),m("div",nV,[m("div",rV,[m("button",{onClick:T[0]||(T[0]=E=>r.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105"}," ✨ Nouvelle saison ")]),m("div",sV,[(H(!0),W(Dt,null,Dr(e.value,E=>(H(),W("div",{key:E.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 cursor-pointer hover:scale-105 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20"},[m("div",{onClick:vt=>g(E.slug),class:"text-center"},[T[5]||(T[5]=m("div",{class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg"},[m("span",{class:"text-2xl"},"🎭")],-1)),m("h2",oV,ge(E.name),1),T[6]||(T[6]=m("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),T[7]||(T[7]=m("p",{class:"text-gray-300 text-sm"}," Cliquez pour accéder ",-1))],8,iV),m("button",{onClick:Hn(vt=>L(E),["stop"]),class:"absolute top-4 right-4 text-red-400 hover:text-red-300 hover:scale-110 transition-all duration-200 opacity-0 group-hover:opacity-100",title:"Supprimer cette saison"},T[8]||(T[8]=[m("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,aV)]))),128))]),e.value.length===0?(H(),W("div",lV,[T[9]||(T[9]=m("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[m("span",{class:"text-4xl"},"🎪")],-1)),T[10]||(T[10]=m("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),T[11]||(T[11]=m("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),m("button",{onClick:T[1]||(T[1]=E=>r.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):Ee("",!0)]),r.value?(H(),W("div",cV,[m("div",uV,[T[16]||(T[16]=m("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),m("div",dV,[T[12]||(T[12]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),mt(m("input",{"onUpdate:modelValue":T[2]||(T[2]=E=>i.value=E),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:_},null,544),[[Pt,i.value]])]),m("div",hV,[T[13]||(T[13]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),mt(m("input",{"onUpdate:modelValue":T[3]||(T[3]=E=>o.value=E),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[Pt,o.value]])]),m("div",fV,[T[14]||(T[14]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),mt(m("input",{"onUpdate:modelValue":T[4]||(T[4]=E=>a.value=E),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:k},null,544),[[Pt,a.value]]),T[15]||(T[15]=m("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),m("div",pV,[m("button",{onClick:R,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),m("button",{onClick:P,disabled:!i.value.trim()||!o.value.trim()||!a.value.trim()||a.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,mV)])])])):Ee("",!0),s.value?(H(),W("div",gV,[m("div",_V,[m("div",yV,[T[17]||(T[17]=m("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[m("span",{class:"text-2xl"},"⚠️")],-1)),T[18]||(T[18]=m("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),m("p",vV,'Êtes-vous sûr de vouloir supprimer la saison "'+ge((D=l.value)==null?void 0:D.name)+'" ?',1)]),T[19]||(T[19]=m("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),m("div",{class:"flex justify-end space-x-3"},[m("button",{onClick:$,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),m("button",{onClick:B,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):Ee("",!0),Lt(Ub,{show:u.value,message:j(),error:f.value,"session-info":w(),onSubmit:ie,onCancel:x},null,8,["show","message","error","session-info"])])}}};let bn="mock",Ei=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],Ti=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function bV(n){bn=n}async function IV(){if(bn!=="firebase"||!(await St(Ze(ye,"seasons"))).empty)return;const e=Ve(Ze(ye,"seasons"));await Pn(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:gp()});const t=await St(Ze(ye,"players"));for(const o of t.docs)await Pn(Ve(e,"players",o.id),o.data());const r=await St(Ze(ye,"events"));for(const o of r.docs)await Pn(Ve(e,"events",o.id),o.data());const s=await St(Ze(ye,"availability"));for(const o of s.docs)await Pn(Ve(e,"availability",o.id),o.data());const i=await St(Ze(ye,"selections"));for(const o of i.docs)await Pn(Ve(e,"selections",o.id),o.data())}async function EV(){bn==="firebase"&&await IV()}async function $_(n=null){return(bn==="firebase"?n?(await St(Ze(ye,"seasons",n,"events"))).docs.map(t=>({id:t.id,...t.data()})):(await St(Ze(ye,"events"))).docs.map(t=>({id:t.id,...t.data()})):Ti).sort((t,r)=>{const s=new Date(t.date),i=new Date(r.date);return s<i?-1:s>i?1:t.title.localeCompare(r.title)})}async function rh(n=null){return(bn==="firebase"?n?(await St(Ze(ye,"seasons",n,"players"))).docs.map(t=>({id:t.id,...t.data()})):(await St(Ze(ye,"players"))).docs.map(t=>({id:t.id,...t.data()})):Ei).sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function TV(n,e=null){if(bn==="firebase"){const t=Ve(e?Ze(ye,"seasons",e,"players"):Ze(ye,"players"));return await Pn(t,{name:n}),t.id}else{const t=`p${Ei.length+1}`;return Ei.push({id:t,name:n}),t}}async function AV(n,e=null){if(bn==="firebase"){const t=e?Ve(ye,"seasons",e,"players",n):Ve(ye,"players",n);await ml(t);const r=e?await St(Ze(ye,"seasons",e,"availability")):await St(Ze(ye,"availability")),s=Gw(ye);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else Ei=Ei.filter(t=>t.id!==n)}async function xV(n,e,t=null){if(bn==="firebase"){const r=t?Ve(ye,"seasons",t,"players",n):Ve(ye,"players",n);await Pn(r,{name:e})}else{const r=Ei.findIndex(s=>s.id===n);r!==-1&&(Ei[r]=e)}}async function Ta(n,e,t=null){if(bn==="firebase"){const r=t?await St(Ze(ye,"seasons",t,"availability")):await St(Ze(ye,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function Aa(n=null){if(bn==="firebase"){const e=n?await St(Ze(ye,"seasons",n,"selections")):await St(Ze(ye,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function j_(n,e,t=null){if(bn==="firebase"){const r=t?Ve(ye,"seasons",t,"availability",n):Ve(ye,"availability",n);await Pn(r,e)}}async function PV({seasonId:n,playerName:e,eventId:t,value:r}){if(bn!=="firebase")return;const s=n?Ve(ye,"seasons",n,"availability",e):Ve(ye,"availability",e),i=await Ri(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await Pn(s,a)}async function SV(n,e,t=null){if(bn==="firebase"){const r=t?Ve(ye,"seasons",t,"selections",n):Ve(ye,"selections",n);await Pn(r,{players:e})}}async function RV(n,e=null){if(console.log("Suppression de l'événement:",n),bn==="firebase")try{console.log("Suppression de l'événement dans Firestore");const t=e?Ve(ye,"seasons",e,"events",n):Ve(ye,"events",n);await ml(t),console.log("Suppression de la sélection associée");const r=e?Ve(ye,"seasons",e,"selections",n):Ve(ye,"selections",n);await ml(r),console.log("Suppression des disponibilités");const s=e?await St(Ze(ye,"seasons",e,"availability")):await St(Ze(ye,"availability")),i=Gw(ye);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){console.log("Mise à jour de la disponibilité pour:",o.id);const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),console.log("Opérations de suppression terminées avec succès")}catch(t){throw console.error("Erreur lors de la suppression:",t),t}else Ti=Ti.filter(t=>t.id!==n)}async function CV(n,e=null){if(bn==="firebase"){const t=Ve(e?Ze(ye,"seasons",e,"events"):Ze(ye,"events"));return await Pn(t,n),t.id}else{const t=`event${Ti.length+1}`;return Ti.push({id:t,...n}),t}}async function kV(n,e,t=null){if(bn==="firebase"){const r=t?Ve(ye,"seasons",t,"events",n):Ve(ye,"events",n);await Pn(r,e)}else{const r=Ti.findIndex(s=>s.id===n);r!==-1&&(Ti[r]={id:n,...e})}}class DV{constructor(){this.sessions=new Map,this.sessionDuration=10*60*1e3}isPasswordCached(e){const t=this.sessions.get(e);return t?Date.now()-t.timestamp>this.sessionDuration?(this.sessions.delete(e),!1):!0:!1}getCachedPassword(e){const t=this.sessions.get(e);return t?Date.now()-t.timestamp>this.sessionDuration?(this.sessions.delete(e),null):t.password:null}saveSession(e,t){this.sessions.set(e,{password:t,timestamp:Date.now()})}clearSession(e){this.sessions.delete(e)}clearExpiredSessions(){const e=Date.now();for(const[t,r]of this.sessions.entries())e-r.timestamp>this.sessionDuration&&this.sessions.delete(t)}clearAllSessions(){this.sessions.clear()}}const Il=new DV,VV="modulepreload",NV=function(n){return"/impro-selector/"+n},q_={},Kn=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=NV(i),i in q_)return;q_[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":VV,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((d,f)=>{u.addEventListener("load",d),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function Bb(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}async function OV(n,e,t,r=null){try{console.log("🔍 [DEBUG] Début protectPlayer:",{playerId:n,email:e,seasonId:r});const s=await Wl(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await Kn(()=>import("./index.esm-6c8b1a7d.js"),[]),{db:u}=await Kn(()=>Promise.resolve().then(()=>go),void 0),d=r?i(u,"seasons",r,"playerProtection"):i(u,"playerProtection"),f=o(d,a("email","==",e)),g=await l(f);if(!g.empty&&g.docs.find($=>$.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");console.log("🔍 [DEBUG] Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:_}=await Kn(()=>import("./index.esm-008f5d38.js"),[]),{auth:k}=await Kn(()=>Promise.resolve().then(()=>go),void 0),P=await _(k,e,t);console.log("🔍 [DEBUG] Compte Firebase Auth créé:",P.user.uid);const R=Bb(t),L=r?Ve(u,"seasons",r,"playerProtection",n):Ve(u,"playerProtection",n);return await Pn(L,{playerId:n,email:e,passwordHash:R,firebaseUid:P.user.uid,isProtected:!0,createdAt:new Date}),console.log("🔍 [DEBUG] Protection sauvegardée dans Firestore"),{success:!0}}catch(s){throw console.error("❌ [ERROR] Erreur lors de la protection du joueur:",s),s}}async function MV(n,e=null){try{const t=e?Ve(ye,"seasons",e,"playerProtection",n):Ve(ye,"playerProtection",n),r=await Wl(n,e),s=(r==null?void 0:r.email)||"";return await Pn(t,{playerId:n,email:s,isProtected:!1,updatedAt:new Date}),{success:!0,email:s}}catch(t){throw console.error("Erreur lors de la suppression de la protection:",t),t}}async function li(n,e=null){try{const t=e?Ve(ye,"seasons",e,"playerProtection",n):Ve(ye,"playerProtection",n),r=await Ri(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return console.error("Erreur lors de la vérification de protection:",t),!1}}async function Wl(n,e=null){try{const t=e?Ve(ye,"seasons",e,"playerProtection",n):Ve(ye,"playerProtection",n),r=await Ri(t);return r.exists()?r.data():null}catch(t){return console.error("Erreur lors de la récupération des données de protection:",t),null}}async function $b(n,e=null){try{const t=await Wl(n,e);return(t==null?void 0:t.email)||""}catch(t){return console.error("Erreur lors de la récupération de l'email:",t),""}}async function vu(n,e,t=null){try{const r=await Wl(n,t);if(!r||!r.isProtected)return!1;if(r.firebaseUid){console.log("🔍 [DEBUG] Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await Kn(()=>import("./index.esm-008f5d38.js"),[]),{auth:i}=await Kn(()=>Promise.resolve().then(()=>go),void 0);return await s(i,r.email,e),console.log("🔍 [DEBUG] Mot de passe Firebase Auth valide"),Il.saveSession(n,e),!0}catch(s){return console.log("🔍 [DEBUG] Mot de passe Firebase Auth invalide:",s.code),!1}}else{console.log("🔍 [DEBUG] Vérification avec hash local");const s=Bb(e),i=r.passwordHash===s;return i&&Il.saveSession(n,e),i}}catch(r){return console.error("Erreur lors de la vérification du mot de passe:",r),!1}}function Qa(n){return Il.isPasswordCached(n)}async function Wh(n,e=null){try{console.log("🔍 [DEBUG] Début sendPasswordResetEmail:",{playerId:n,seasonId:e});const t=await Wl(n,e);if(console.log("🔍 [DEBUG] Protection data:",t),!t||!t.isProtected)throw new Error("Joueur non protégé");if(console.log("🔍 [DEBUG] Email à utiliser:",t.email),t.firebaseUid){console.log("🔍 [DEBUG] Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await Kn(()=>import("./index.esm-008f5d38.js"),[]),{auth:s}=await Kn(()=>Promise.resolve().then(()=>go),void 0);console.log("🔍 [DEBUG] Tentative d'envoi d'email à:",t.email),await r(s,t.email),console.log("🔍 [DEBUG] Email envoyé avec succès via Firebase Auth!"),console.log("🔍 [DEBUG] Vérifiez votre boîte mail:",t.email)}else{console.log("🔍 [DEBUG] Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await Kn(()=>import("./index.esm-008f5d38.js"),[]),{auth:i}=await Kn(()=>Promise.resolve().then(()=>go),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);console.log("🔍 [DEBUG] Compte temporaire créé:",a.user.uid),await s(i,t.email),console.log("🔍 [DEBUG] Email envoyé avec succès!");const{updateDoc:l}=await Kn(()=>import("./index.esm-6c8b1a7d.js"),[]),{db:u}=await Kn(()=>Promise.resolve().then(()=>go),void 0),d=e?Ve(u,"seasons",e,"playerProtection",n):Ve(u,"playerProtection",n);await l(d,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")console.log("🔍 [DEBUG] Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),console.log("🔍 [DEBUG] Email envoyé avec succès!");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw console.error("❌ [ERROR] Erreur lors de l'envoi de l'email de réinitialisation:",t),console.error("❌ [ERROR] Code d'erreur:",t.code),console.error("❌ [ERROR] Message d'erreur:",t.message),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}const Fp="magicLinks";function Up({seasonId:n,playerId:e,eventId:t}){return`${n}__${e}__${t}`}function LV(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function z_({seasonId:n,playerId:e,eventId:t,action:r}){const s=Up({seasonId:n,playerId:e,eventId:t}),i=LV(40),o=Ve(ye,Fp,s),a=Date.now()+1e3*60*60*24*7;await Pn(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const u=`${window.location.origin+"/impro-selector/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:u}}async function FV({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=Up({seasonId:n,playerId:e,eventId:t}),o=Ve(ye,Fp,i),a=await Ri(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function UV({seasonId:n,playerId:e,eventId:t}){const r=Up({seasonId:n,playerId:e,eventId:t}),s=Ve(ye,Fp,r);await ml(s)}async function BV({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,reason:o="new_event",fromEmail:a=void 0}){const l=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>Disponibilité demandée</h2>
      <p>Bonjour ${e},</p>
      <p>Peux-tu indiquer ta disponibilité pour <strong>${t}</strong> (${r}) ?</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;margin-right:8px;background:#16a34a;color:#fff;border-radius:8px;text-decoration:none;">Je suis dispo ✅</a>
        <a href="${i}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Pas dispo ❌</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: ${o}</p>
    </div>
  `,u=`Disponibilité demandée · ${t}`,d={to:n,message:{subject:u,html:l},createdAt:gp(),meta:{reason:o,eventTitle:t,eventDate:r,playerName:e}};return a&&(d.from=a,d.replyTo=a),await zw(Ze(ye,"mail"),d),{success:!0}}const $V={class:"text-center mb-6"},jV={class:"text-lg text-gray-300"},qV={class:"mb-6"},zV={class:"flex items-center space-x-3"},GV={class:"text-2xl"},KV={class:"font-semibold text-white"},HV={class:"text-sm text-gray-300"},WV={class:"mb-6"},QV={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-1"},JV={key:0,class:"mb-6"},YV={class:"space-y-4"},XV=["disabled"],ZV={key:0,class:"animate-spin"},eN={key:1},tN={key:1,class:"mb-6"},nN={key:0,class:"space-y-4 mb-4"},rN=["disabled"],sN={key:0,class:"animate-spin"},iN={key:1},oN=["disabled"],aN={key:2,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},lN={class:"text-red-300 text-sm"},cN={key:3,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},uN={class:"text-green-300 text-sm"},dN={__name:"PlayerProtectionModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","update"],setup(n,{emit:e}){const t=n,r=e,s=q(!1),i=q(""),o=q(""),a=q(""),l=q(!1),u=q(""),d=q(""),f=q(!1),g=q(!1),_=q(""),k=Zt(()=>i.value&&o.value&&a.value&&o.value===a.value&&o.value.length>=6&&i.value.includes("@"));async function P(){var j;if((j=t.player)!=null&&j.id&&(s.value=await li(t.player.id,t.seasonId),!s.value)){const O=await $b(t.player.id,t.seasonId);O&&(i.value=O)}}async function R(){if(k.value){l.value=!0,u.value="",d.value="";try{await OV(t.player.id,i.value,o.value,t.seasonId),d.value="Protection activée avec succès !",s.value=!0,i.value="",o.value="",a.value="",r("update")}catch(j){console.error("Erreur lors de l'activation de la protection:",j),j.message&&j.message.includes("email")?u.value="Cette adresse email est déjà utilisée par un autre joueur.":u.value="Erreur lors de l'activation de la protection. Veuillez réessayer."}finally{l.value=!1}}}function L(){g.value=!0,_.value="",u.value=""}async function B(){if(_.value){l.value=!0,u.value="",d.value="";try{if(!await vu(t.player.id,_.value,t.seasonId)){u.value="Mot de passe incorrect. Veuillez réessayer.";return}const O=await MV(t.player.id,t.seasonId);d.value="Protection désactivée avec succès !",s.value=!1,g.value=!1,_.value="",O.email&&(i.value=O.email),r("update")}catch(j){console.error("Erreur lors de la désactivation de la protection:",j),u.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{l.value=!1}}}function $(){r("close")}return ar(()=>t.player,()=>{t.show&&t.player&&P()},{immediate:!0}),ar(()=>t.show,j=>{j&&t.player&&(o.value="",a.value="",u.value="",d.value="",f.value=!1,g.value=!1,_.value="",P())}),(j,O)=>{var ie;return n.show?(H(),W("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:$},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:O[6]||(O[6]=Hn(()=>{},["stop"]))},[m("div",$V,[O[7]||(O[7]=m("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[m("span",{class:"text-2xl"},"🔒")],-1)),O[8]||(O[8]=m("h2",{class:"text-2xl font-bold text-white mb-2"},"Protection du joueur",-1)),m("p",jV,ge((ie=n.player)==null?void 0:ie.name),1)]),m("div",qV,[m("div",{class:sr(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[m("div",zV,[m("span",GV,ge(s.value?"🔒":"🔓"),1),m("div",null,[m("div",KV,ge(s.value?"Protégé":"Non protégé"),1),m("div",HV,ge(s.value?"Modifications sécurisées":"Modifications libres"),1)])])],2)]),m("div",WV,[m("button",{onClick:O[0]||(O[0]=x=>f.value=!f.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[O[9]||(O[9]=m("h3",{class:"text-sm font-semibold text-blue-300"},"💡 Pourquoi protéger son joueur ?",-1)),m("span",{class:sr(["text-blue-300 transition-transform duration-200",{"rotate-180":f.value}])},"▼",2)]),f.value?(H(),W("div",QV,O[10]||(O[10]=[m("div",null,[jn("• "),m("span",{class:"text-blue-300"},"Protection des disponibilités :"),jn(" Seul vous pouvez modifier vos disponibilités")],-1),m("div",null,[jn("• "),m("span",{class:"text-blue-300"},"Protection du nom :"),jn(" Seul vous pouvez changer votre nom de joueur")],-1),m("div",null,[jn("• "),m("span",{class:"text-blue-300"},"Email requis :"),jn(" Permet de réinitialiser le mot de passe en cas d'oubli")],-1)]))):Ee("",!0)]),s.value?Ee("",!0):(H(),W("div",JV,[O[14]||(O[14]=m("h3",{class:"text-lg font-semibold text-white mb-4"},"🔐 Activer la protection",-1)),m("div",YV,[m("div",null,[O[11]||(O[11]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),mt(m("input",{"onUpdate:modelValue":O[1]||(O[1]=x=>i.value=x),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Pt,i.value]])]),m("div",null,[O[12]||(O[12]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),mt(m("input",{"onUpdate:modelValue":O[2]||(O[2]=x=>o.value=x),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé"},null,512),[[Pt,o.value]])]),m("div",null,[O[13]||(O[13]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),mt(m("input",{"onUpdate:modelValue":O[3]||(O[3]=x=>a.value=x),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[Pt,a.value]])])]),m("button",{onClick:R,disabled:!k.value||l.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[l.value?(H(),W("span",ZV,"⏳")):(H(),W("span",eN,"🔒")),m("span",null,ge(l.value?"Activation...":"Activer la protection"),1)],8,XV)])),s.value?(H(),W("div",tN,[O[17]||(O[17]=m("h3",{class:"text-lg font-semibold text-white mb-4"},"🔓 Désactiver la protection",-1)),O[18]||(O[18]=m("p",{class:"text-sm text-gray-300 mb-4"}," Attention : désactiver la protection supprimera définitivement le mot de passe et l'email associés. ",-1)),g.value?(H(),W("div",nN,[m("div",null,[O[15]||(O[15]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe de confirmation",-1)),mt(m("input",{"onUpdate:modelValue":O[4]||(O[4]=x=>_.value=x),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe pour confirmer"},null,512),[[Pt,_.value]])]),m("button",{onClick:B,disabled:!_.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[l.value?(H(),W("span",sN,"⏳")):(H(),W("span",iN,"🔓")),m("span",null,ge(l.value?"Désactivation...":"Confirmer la désactivation"),1)],8,rN),m("button",{onClick:O[5]||(O[5]=x=>g.value=!1),class:"w-full px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])):Ee("",!0),g.value?Ee("",!0):(H(),W("button",{key:1,onClick:L,disabled:l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},O[16]||(O[16]=[m("span",null,"🔓",-1),m("span",null,"Désactiver la protection",-1)]),8,oN))])):Ee("",!0),u.value?(H(),W("div",aN,[m("div",lN,ge(u.value),1)])):Ee("",!0),d.value?(H(),W("div",cN,[m("div",uN,ge(d.value),1)])):Ee("",!0),m("div",{class:"flex justify-center"},[m("button",{onClick:$,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):Ee("",!0)}}},hN={class:"text-center mb-6"},fN={class:"text-lg text-gray-300"},pN={class:"mb-6"},mN={class:"space-y-4"},gN=["disabled"],_N={key:0,class:"animate-spin"},yN={key:1},vN={class:"mb-6 text-center"},wN={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},bN={class:"text-red-300 text-sm"},IN={class:"text-center mb-6"},EN={class:"text-lg text-gray-300"},TN={class:"mb-6"},AN=["disabled"],xN={key:0,class:"animate-spin"},PN={key:1},SN={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},RN={class:"text-red-300 text-sm"},CN={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},kN={class:"text-green-300 text-sm"},DN={class:"flex justify-center"},VN={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=q(""),i=q(!1),o=q(""),a=q(!1),l=q(""),u=q(""),d=q(null);async function f(){if(s.value){i.value=!0,o.value="";try{const k=await Hh(t.seasonId);if(s.value===k){r("verified",{type:"season_pin"}),_();return}await vu(t.player.id,s.value,t.seasonId)?(r("verified",{type:"player_password"}),_()):o.value="Mot de passe incorrect. Veuillez réessayer."}catch(k){console.error("Erreur lors de la vérification:",k),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function g(){i.value=!0,l.value="",u.value="";try{const k=await Wh(t.player.id,t.seasonId);u.value=k.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(k){console.error("Erreur lors de l'envoi de l'email:",k),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function _(){r("close"),s.value="",o.value="",a.value=!1,l.value="",u.value=""}return ar(()=>t.show,k=>{k&&Lr(()=>{d.value&&d.value.focus()})}),(k,P)=>{var R,L;return H(),W(Dt,null,[n.show?(H(),W("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:_},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:P[2]||(P[2]=Hn(()=>{},["stop"]))},[m("div",hN,[P[6]||(P[6]=m("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[m("span",{class:"text-2xl"},"🔐")],-1)),P[7]||(P[7]=m("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),m("p",fN,ge((R=n.player)==null?void 0:R.name),1),P[8]||(P[8]=m("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),m("div",pN,[m("div",mN,[m("div",null,[P[9]||(P[9]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),mt(m("input",{"onUpdate:modelValue":P[0]||(P[0]=B=>s.value=B),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:An(f,["enter"]),ref_key:"passwordInput",ref:d},null,544),[[Pt,s.value]])])]),m("button",{onClick:f,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(H(),W("span",_N,"⏳")):(H(),W("span",yN,"🔓")),m("span",null,ge(i.value?"Vérification...":"Vérifier"),1)],8,gN)]),m("div",vN,[m("button",{onClick:P[1]||(P[1]=B=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(H(),W("div",wN,[m("div",bN,ge(o.value),1)])):Ee("",!0),m("div",{class:"flex justify-center"},[m("button",{onClick:_,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):Ee("",!0),a.value?(H(),W("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:P[5]||(P[5]=B=>a.value=!1)},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:P[4]||(P[4]=Hn(()=>{},["stop"]))},[m("div",IN,[P[10]||(P[10]=m("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[m("span",{class:"text-2xl"},"📧")],-1)),P[11]||(P[11]=m("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),m("p",EN,ge((L=n.player)==null?void 0:L.name),1)]),m("div",TN,[P[12]||(P[12]=m("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),m("button",{onClick:g,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(H(),W("span",xN,"⏳")):(H(),W("span",PN,"📧")),m("span",null,ge(i.value?"Envoi...":"Envoyer l'email"),1)],8,AN)]),l.value?(H(),W("div",SN,[m("div",RN,ge(l.value),1)])):Ee("",!0),u.value?(H(),W("div",CN,[m("div",kN,ge(u.value),1)])):Ee("",!0),m("div",DN,[m("button",{onClick:P[3]||(P[3]=B=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):Ee("",!0)],64)}}},NN={class:"relative text-center p-6 pb-4 border-b border-white/10"},ON={class:"text-2xl md:text-3xl font-bold text-white mb-1"},MN={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},LN={class:"grid grid-cols-3 gap-3 md:gap-4"},FN={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},UN={class:"text-xl md:text-2xl font-bold text-white"},BN={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},$N={class:"text-xl md:text-2xl font-bold text-white"},jN={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},qN={class:"text-xl md:text-2xl font-bold text-white"},zN={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},GN={key:0,class:"md:hidden mt-3 space-y-2"},KN={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},HN={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},WN={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},QN={class:"mb-6"},JN={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null}},emits:["close","update","delete","refresh"],setup(n,{emit:e}){const t=n,r=e,s=q(!1),i=q(""),o=q(null),a=q(!1),l=q(!1),u=q(null),d=q(!1);function f(){r("close")}function g(){var j;i.value=((j=t.player)==null?void 0:j.name)||"",s.value=!0,Lr(()=>{o.value&&o.value.focus()})}function _(){s.value=!1,i.value=""}async function k(){var O,ie;if(!i.value.trim())return;if(await li((O=t.player)==null?void 0:O.id,t.seasonId)){Qa((ie=t.player)==null?void 0:ie.id)?P():(u.value="update",l.value=!0);return}P()}function P(){var j;r("update",{playerId:(j=t.player)==null?void 0:j.id,newName:i.value.trim()}),s.value=!1,i.value=""}async function R(){var O,ie;if(await li((O=t.player)==null?void 0:O.id,t.seasonId)){Qa((ie=t.player)==null?void 0:ie.id)?L():(u.value="delete",l.value=!0);return}L()}function L(){var j;r("delete",(j=t.player)==null?void 0:j.id)}function B(){r("refresh")}function $(j){u.value==="update"?P():u.value==="delete"&&L(),u.value=null}return ar(()=>t.show,j=>{j||(s.value=!1,i.value="",u.value=null)}),(j,O)=>{var ie;return H(),W(Dt,null,[n.show?(H(),W("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:f},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:O[5]||(O[5]=Hn(()=>{},["stop"]))},[m("div",NN,[m("button",{onClick:f,class:"absolute right-3 top-3 text-white/80 hover:text-white"},"✖️"),O[9]||(O[9]=m("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[m("span",{class:"text-2xl md:text-3xl"},"👤")],-1)),m("h2",ON,ge((ie=n.player)==null?void 0:ie.name),1)]),m("div",MN,[m("div",null,[m("div",LN,[m("div",FN,[m("div",UN,ge(t.stats.availability),1),O[10]||(O[10]=m("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),m("div",BN,[m("div",$N,ge(t.stats.selection),1),O[11]||(O[11]=m("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),m("div",jN,[m("div",qN,ge(t.stats.ratio)+"%",1),O[12]||(O[12]=m("div",{class:"text-xs md:text-sm text-gray-300"},"Taux",-1))])])]),m("div",zN,[m("button",{onClick:g,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},O[13]||(O[13]=[m("span",null,"✏️",-1),m("span",null,"Modifier",-1)])),m("button",{onClick:O[0]||(O[0]=x=>a.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},O[14]||(O[14]=[m("span",null,"🔒",-1),m("span",null,"Protection",-1)])),m("button",{onClick:R,class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},O[15]||(O[15]=[m("span",null,"🗑️",-1),m("span",null,"Supprimer",-1)])),m("button",{onClick:f,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")]),d.value?(H(),W("div",GN,[m("button",{onClick:O[1]||(O[1]=x=>{g(),d.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"}," ✏️ Modifier "),m("button",{onClick:O[2]||(O[2]=x=>{R(),d.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"}," 🗑️ Supprimer ")])):Ee("",!0)]),m("div",KN,[m("button",{onClick:O[3]||(O[3]=x=>a.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"}," 🔒 Protection "),m("button",{onClick:f,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer "),m("button",{onClick:O[4]||(O[4]=x=>d.value=!d.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ ")])])])):Ee("",!0),s.value?(H(),W("div",HN,[m("div",WN,[O[17]||(O[17]=m("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier le joueur",-1)),m("div",QN,[O[16]||(O[16]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),mt(m("input",{"onUpdate:modelValue":O[6]||(O[6]=x=>i.value=x),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[An(_,["esc"]),An(k,["enter"])],ref_key:"editNameInput",ref:o},null,544),[[Pt,i.value]])]),m("div",{class:"flex justify-end space-x-3"},[m("button",{onClick:_,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),m("button",{onClick:k,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):Ee("",!0),Lt(dN,{show:a.value,player:n.player,seasonId:n.seasonId,onClose:O[7]||(O[7]=x=>a.value=!1),onUpdate:B},null,8,["show","player","seasonId"]),Lt(VN,{show:l.value,player:n.player,seasonId:n.seasonId,onClose:O[8]||(O[8]=x=>l.value=!1),onVerified:$},null,8,["show","player","seasonId"])],64)}}},YN={class:"relative p-5 pb-4 border-b border-white/10"},XN={key:0,class:"text-sm text-purple-300 mt-1"},ZN={class:"px-4 md:px-6 py-4 md:py-6 space-y-4 overflow-y-auto"},eO={class:"relative"},tO=["value"],nO=["title"],rO={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},sO={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},iO={class:"text-sm text-gray-300"},oO={key:0,class:"mb-1"},aO={key:1},lO={__name:"AnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},message:{type:String,default:""},isPartial:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=n,r=e,s=q(!1),i=q("Copier le message");function o(){r("close")}function a(u){var f;return u?(typeof u=="string"?new Date(u):((f=u.toDate)==null?void 0:f.call(u))||u).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function l(){const u=t.message||"";navigator.clipboard.writeText(u).then(()=>{s.value=!0,i.value="Copié !",setTimeout(()=>{s.value=!1,i.value="Copier le message"},2e3)}).catch(d=>{console.error("Erreur lors de la copie du texte:",d),alert("Impossible de copier le message.")})}return(u,d)=>n.show?(H(),W("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:o},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:d[0]||(d[0]=Hn(()=>{},["stop"]))},[m("div",YN,[m("button",{onClick:o,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d[1]||(d[1]=m("h2",{class:"text-xl md:text-2xl font-bold text-white pr-10"},"Annoncer la sélection",-1)),n.event?(H(),W("p",XN,ge(n.event.title)+" — "+ge(a(n.event.date)),1)):Ee("",!0)]),m("div",ZN,[d[4]||(d[4]=m("div",{class:"bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20 p-3"},[m("p",{class:"text-blue-200 text-sm"},"Le message ci-dessous est prêt à être copié/collé dans WhatsApp, Messenger, email, etc.")],-1)),m("div",eO,[m("textarea",{value:n.message,class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",rows:"6",readonly:""},null,8,tO),m("button",{onClick:l,class:"absolute top-2 right-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg p-2 hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:i.value},[s.value?(H(),W("svg",sO,d[3]||(d[3]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(H(),W("svg",rO,d[2]||(d[2]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2z"},null,-1)])))],8,nO)]),m("div",iO,[n.isPartial?(H(),W("p",oO,"Note: cette annonce concerne une mise à jour partielle de la sélection.")):(H(),W("p",aO,"Vérifie le message si besoin avant de l'envoyer."))])]),m("div",{class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},[m("button",{onClick:l,class:"h-12 px-4 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 flex-1"}," 📋 Copier "),m("button",{onClick:o,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer ")])])])):Ee("",!0)}},cO={class:"relative text-center p-6 pb-4 border-b border-white/10"},uO={class:"text-2xl md:text-3xl font-bold text-white mb-1"},dO={class:"text-sm md:text-base text-purple-300"},hO={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},fO={key:0,class:"mb-3"},pO={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},mO={class:"text-white font-medium"},gO={key:0,class:"text-purple-400 mr-2"},_O={key:1,class:"text-green-400 mr-2"},yO={key:2,class:"text-red-400 mr-2"},vO={key:3,class:"text-gray-400 mr-2"},wO={key:1,class:"mb-3"},bO={class:"grid grid-cols-3 gap-2 md:gap-3 mb-3"},IO={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},EO={class:"text-cyan-300 text-lg md:text-xl font-semibold"},TO={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},AO={class:"text-green-400 text-lg md:text-xl font-semibold"},xO={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},PO={class:"text-purple-400 text-lg md:text-xl font-semibold"},SO={key:2,class:"mb-3"},RO={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},CO={class:"flex-1"},kO={class:"text-blue-300 text-sm font-medium"},DO={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},VO=["disabled","title"],NO=["disabled"],OO={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})}},emits:["close","selection","perfect"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=q(!1),o=q("Copier le message"),a=q(!1),l=q(!1),u=q(""),d=q(!1),f=Zt(()=>r.currentSelection&&r.currentSelection.length>0),g=Zt(()=>{var T;if(!f.value)return!1;const w=r.currentSelection.some(D=>!$(D)),I=((T=r.event)==null?void 0:T.playerCount)||6,S=r.availableCount<I;return w||S});Zt(()=>{var S;if(!g.value)return"";const w=r.currentSelection.filter(T=>!$(T)),I=((S=r.event)==null?void 0:S.playerCount)||6;return w.length>0?w.length===1?`${w[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${w.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<I?`Seulement ${r.availableCount} joueurs disponibles pour ${I} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"});const _=Zt(()=>{if(!r.event||!f.value)return"";const w=k(r.event.date),I=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${w} : ${I}`});ar(()=>r.show,w=>{w&&(i.value=!1,o.value="Copier le message",l.value=!1,u.value="",d.value=!1,a.value=!1)});function k(w){var S;return w?(typeof w=="string"?new Date(w):((S=w.toDate)==null?void 0:S.call(w))||w).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function P(){s("selection")}function R(){s("perfect")}function L(){s("close")}function B(){a.value=!0}function $(w){return r.playerAvailability[w]===!0}function j(w){return r.playerAvailability[w]===!1}function O(w){return r.currentSelection.includes(w)&&$(w)}function ie(w=!1,I=!1){if(d.value=w,w){const S=k(r.event.date),T=r.currentSelection.join(", ");I?u.value=`Sélection mise à jour pour ${r.event.title} du ${S} : ${T}`:u.value=`Nouvelle sélection pour ${r.event.title} du ${S} : ${T}`}else u.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function x(){l.value=!1}return e({showSuccess:ie}),(w,I)=>{var S,T,D;return H(),W(Dt,null,[n.show?(H(),W("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:L},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:I[0]||(I[0]=Hn(()=>{},["stop"]))},[m("div",cO,[m("button",{onClick:L,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),I[2]||(I[2]=m("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[m("span",{class:"text-3xl"},"🎭")],-1)),m("h2",uO,"Sélection pour "+ge((S=n.event)==null?void 0:S.title),1),m("p",dO,ge(k((T=n.event)==null?void 0:T.date)),1)]),m("div",hO,[f.value?(H(),W("div",fO,[I[3]||(I[3]=m("h3",{class:"text-base md:text-lg font-semibold text-white mb-2"},"Joueurs sélectionnés",-1)),m("div",pO,[(H(!0),W(Dt,null,Dr(n.currentSelection,E=>(H(),W("div",{key:E,class:sr(["bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 rounded-lg border border-green-500/30 text-center",{"from-red-500/20 to-red-600/20 border-red-500/30":!$(E),"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":j(E)}])},[m("span",mO,[O(E)?(H(),W("span",gO,"🎭")):$(E)?(H(),W("span",_O,"✅")):j(E)?(H(),W("span",yO,"❌")):(H(),W("span",vO,"–")),jn(" "+ge(E),1)])],2))),128))])])):Ee("",!0),g.value?(H(),W("div",wO,I[4]||(I[4]=[m("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[m("div",{class:"text-yellow-400"},"⚠️"),m("div",{class:"text-yellow-200 text-sm"},"Sélection incomplète. Vérifie ci-dessous.")],-1)]))):Ee("",!0),m("div",bO,[m("div",IO,[m("div",EO,ge(((D=n.event)==null?void 0:D.playerCount)||6),1),I[5]||(I[5]=m("div",{class:"text-xs md:text-sm text-gray-400"},"À sélectionner",-1))]),m("div",TO,[m("div",AO,ge(n.availableCount),1),I[6]||(I[6]=m("div",{class:"text-xs md:text-sm text-gray-400"},"Disponibles",-1))]),m("div",xO,[m("div",PO,ge(n.selectedCount),1),I[7]||(I[7]=m("div",{class:"text-xs md:text-sm text-gray-400"},"Sélectionnés",-1))])]),l.value?(H(),W("div",SO,[m("div",RO,[I[9]||(I[9]=m("div",{class:"text-blue-400 text-xl"},"✨",-1)),m("div",CO,[m("p",kO,ge(u.value),1)]),m("button",{onClick:x,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},I[8]||(I[8]=[m("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):Ee("",!0)]),m("div",DO,[m("button",{onClick:P,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":f.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},I[10]||(I[10]=[jn(" ✨ "),m("span",{class:"hidden sm:inline"},"Sélection Auto",-1),m("span",{class:"sm:hidden"},"Auto",-1)]),8,VO),f.value?(H(),W("button",{key:0,onClick:R,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap"},I[11]||(I[11]=[jn(" 👍 "),m("span",{class:"hidden sm:inline"},"Parfait",-1)]))):Ee("",!0),m("button",{onClick:B,disabled:!f.value,class:"h-12 px-3 md:px-4 bg-gray-700 text-white rounded-lg flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},I[12]||(I[12]=[jn(" 📣 "),m("span",{class:"hidden sm:inline"},"Annoncer",-1)]),8,NO)])])])):Ee("",!0),Lt(lO,{show:a.value,event:n.event,message:_.value,"is-partial":d.value,onClose:I[1]||(I[1]=E=>a.value=!1)},null,8,["show","event","message","is-partial"])],64)}}};const MO={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},LO={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},FO={class:"w-full px-2 md:px-4 pb-4"},UO={class:"text-white"},BO=["onClick"],$O={class:"flex flex-col items-center gap-1"},jO=["title"],qO=["title"],zO=["title","onClick"],GO=["title","onClick"],KO=["data-player-id"],HO={class:"p-4 md:p-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900"},WO={class:"font-bold text-xl md:text-2xl whitespace-pre-wrap flex items-center"},QO={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},JO=["onClick","title"],YO=["onClick"],XO={class:"flex items-center justify-center"},ZO=["title"],e2=["title"],t2=["title"],n2=["title"],r2={class:"border-t border-white/10"},s2={class:"p-4 md:p-5 sticky left-0 z-40 bg-gray-900"},i2={class:"flex items-center"},o2={class:"pointer-events-none absolute inset-y-0 left-2 w-6 flex items-center justify-center z-[60]"},a2={class:"pointer-events-none absolute inset-y-0 right-2 w-6 flex items-center justify-center z-[60]"},l2={key:0,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-50"},c2={class:"flex items-center space-x-2"},u2={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},d2={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},h2={class:"mb-6"},f2={class:"mb-6"},p2={class:"mb-6"},m2={class:"mb-6"},g2={key:2,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},_2={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},y2={class:"mb-6"},v2={class:"flex justify-end space-x-3"},w2={key:3,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},b2={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},I2={class:"flex justify-end space-x-3"},E2={key:4,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},T2={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},A2={class:"flex justify-end space-x-3"},x2={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},P2={class:"relative text-center p-6 pb-4 border-b border-white/10"},S2={class:"text-2xl md:text-3xl font-bold text-white mb-1"},R2={class:"text-sm md:text-base text-purple-300"},C2={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},k2={key:0,class:"mb-4 md:mb-6"},D2={class:"text-gray-300 bg-gray-800/50 p-4 rounded-lg border border-gray-600/50"},V2={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},N2={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},O2={class:"text-xl md:text-2xl font-bold text-white"},M2={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},L2={class:"text-xl md:text-2xl font-bold text-white"},F2={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},U2={class:"text-xl md:text-2xl font-bold text-white"},B2={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},$2={key:1,class:"md:hidden mt-3 space-y-2"},j2={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},q2={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},z2={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},G2={class:"mb-6"},K2={class:"mb-6"},H2={class:"mb-6"},W2={class:"mb-6"},Q2={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},J2={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},Y2={class:"mb-6"},X2={class:"space-y-4"},Z2=["disabled"],eM={key:0,class:"animate-spin"},tM={key:1},nM={class:"mb-6 text-center"},rM={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},sM={class:"text-red-300 text-sm"},iM={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},oM={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},aM={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},lM={class:"space-y-4"},cM={class:"mt-2 text-center"},uM={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},dM={class:"text-red-300 text-sm"},hM={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},fM=["disabled"],pM={key:0,class:"animate-spin"},mM={key:1},gM={class:"mb-6"},_M=["disabled"],yM={key:0,class:"animate-spin"},vM={key:1},wM={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},bM={class:"text-red-300 text-sm"},IM={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},EM={class:"text-green-300 text-sm"},TM={class:"flex justify-center"},AM={class:"mb-6"},xM=["disabled"],PM={key:0,class:"animate-spin"},SM={key:1},RM={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},CM={class:"text-red-300 text-sm"},kM={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},DM={class:"text-green-300 text-sm"},VM={class:"flex justify-center"},NM={__name:"GridBoard",props:{slug:{type:String,required:!0}},setup(n){const e=q(null),t=q(64);_o(async()=>{await Lr();const C=e.value;t.value=C?C.offsetHeight:64,window.addEventListener("resize",r)}),Ay(()=>{window.removeEventListener("resize",r)});function r(){const C=e.value;t.value=C?C.offsetHeight:64}const s=n,i=Nu(),o=s.slug,a=q(""),l=q(""),u=q(!1),d=q(null),f=q(null),g=q(""),_=q(""),k=q(6),P=q(!1),R=q(""),L=q(null),B=q(!1),$=q(null),j=q(!1),O=q(null),ie=q(!1),x=q(null),w=q(""),I=q(!1),S=q(null),T=q(""),D=q(""),E=q(!1),vt=q(null),Ot=q(!1),He=q(null),Ne=q(""),Se=q(""),$t=q(!1),Ln=q(null),rn=q(!1),et=q(!1),rt=q(""),Fn=q(""),In=q(!1),jt=q(!1),G=q(""),fe=q(""),le=q(!1),oe=q(null),Re=q(""),$e=q(!1),b=q(!1),A=q(null),M=q(null),X=q(new Set),z=q(null),Z=q(!1),ue=q(!1);function ne(){const C=z.value;if(!C)return;const{scrollLeft:v,scrollWidth:K,clientWidth:pe}=C;Z.value=v>2,ue.value=v<K-pe-2}function re(C){L.value=C;const v=document.querySelector(`[data-player-id="${C}"]`);v&&v.scrollIntoView({behavior:"smooth",block:"center"}),Q.value=!0,de.value="Nouveau joueur ajouté !",setTimeout(()=>{Q.value=!1},3e3)}function ee(C){return X.value.has(C)}async function ve(){if(!l.value)return;const C=new Set;for(const v of tt.value)await li(v.id,l.value)&&C.add(v.id);X.value=C}const Q=q(!1),de=q("");async function Ae(C){await Er({type:"deleteEvent",data:{eventId:C}})}async function Te(C=null){const v=C||d.value;if(console.log("deleteEventConfirmed - eventId param:",C),console.log("deleteEventConfirmed - eventToDelete.value:",d.value),console.log("deleteEventConfirmed - eventIdToDelete:",v),console.log("deleteEventConfirmed - type de eventIdToDelete:",typeof v),!v){console.error("Aucun événement à supprimer");return}try{await RV(v,l.value),dt.value=dt.value.filter(K=>K.id!==v),await Promise.all([$_(l.value),Ta(tt.value,dt.value,l.value),Aa(l.value)]).then(([K,pe,Ie])=>{dt.value=K,At.value=pe,ot.value=Ie}),u.value=!1,d.value=null,Q.value=!0,de.value="Événement supprimé avec succès !",setTimeout(()=>{Q.value=!1},3e3)}catch(K){console.error("Erreur lors de la suppression de l'événement:",K),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function Ce(){u.value=!1,d.value=null}async function Le(){if(!f.value||!g.value.trim()||!_.value)return;const C=parseInt(k.value);if(isNaN(C)||C<1||C>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const v={title:g.value.trim(),date:_.value,description:Re.value.trim()||"",playerCount:C};await kV(f.value,v,l.value),await rs({eventId:f.value,eventData:v,reason:"updated"}),await Promise.all([$_(l.value),Ta(tt.value,dt.value,l.value),Aa(l.value)]).then(([K,pe,Ie])=>{dt.value=K,At.value=pe,ot.value=Ie}),f.value=null,g.value="",_.value="",Re.value="",k.value=6,Q.value=!0,de.value="Événement mis à jour avec succès !",setTimeout(()=>{Q.value=!1},3e3)}catch(v){console.error("Erreur lors de l'édition de l'événement:",v),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function Kt(){if(R.value.trim())try{const C=R.value.trim(),v=await TV(C,l.value);await Promise.all([rh(l.value),Ta(tt.value,dt.value,l.value),Aa(l.value)]).then(([K,pe,Ie])=>{tt.value=K,At.value=pe,ot.value=Ie,ve();const Me=tt.value.find(Fe=>Fe.id===v);re(v);const ke=document.querySelector(`[data-player-id="${v}"]`);ke&&ke.scrollIntoView({behavior:"smooth",block:"center"}),Q.value=!0,de.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Q.value=!1},3e3),setTimeout(()=>{Q.value=!1,de.value=""},5e3)}),P.value=!1,R.value=""}catch(C){console.error("Erreur lors de l'ajout du joueur:",C),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function pt(){f.value=null,g.value="",_.value="",Re.value="",k.value=6}q(null);const Jt=q(!1),ut=q(""),En=q(""),Xn=q(""),Tt=q(6);async function Rn(){if(!ut.value.trim()||!En.value){alert("Veuillez remplir le titre et la date de l'événement");return}const C=parseInt(Tt.value);if(isNaN(C)||C<1||C>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const v={title:ut.value.trim(),date:En.value,description:Xn.value.trim()||"",playerCount:C};await Vi(v)}async function Vi(C){try{const v=await CV(C,l.value);dt.value=[...dt.value,{id:v,...C}];const K={};for(const pe of tt.value)K[pe.name]=At.value[pe.name]||{},K[pe.name][v]=null,await j_(pe.name,K[pe.name],l.value);ut.value="",En.value="",Xn.value="",Tt.value=6,Jt.value=!1,await Promise.resolve(),Q.value=!0,de.value="Événement créé avec succès !";try{await rs({eventId:v,eventData:C,reason:"created"})}catch(pe){console.warn("Envoi des emails partiellement en échec:",pe)}setTimeout(()=>{Q.value=!1},3e3)}catch(v){console.error("Erreur lors de la création de l'événement:",(v==null?void 0:v.message)||v),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function Xo(){ut.value="",En.value="",Xn.value="",Tt.value=6,Jt.value=!1}async function Ql(){await Er({type:"addEvent",data:{}})}const dt=q([]),tt=q([]),At=q({}),ot=q({}),wr=q({}),Zo=q({});_o(async()=>{bV("firebase"),await EV();const C=Uw(Ze(ye,"seasons"),hC("slug","==",s.slug)),v=await St(C);if(!v.empty){const K=v.docs[0];l.value=K.id,a.value=K.data().name,document.title=`Saison : ${a.value}`}if(l.value){const K=await St(Ze(ye,"seasons",l.value,"players"));tt.value=K.docs.map(Ge=>({id:Ge.id,...Ge.data()})),await ve();const pe=await St(Ze(ye,"seasons",l.value,"events"));dt.value=pe.docs.map(Ge=>({id:Ge.id,...Ge.data(),playerCount:Ge.data().playerCount||6}));const Ie=await St(Ze(ye,"seasons",l.value,"availability")),Me={};Ie.docs.forEach(Ge=>{const Ht=Ge.data(),xt={};Object.keys(Ht).forEach(We=>{const te=Ht[We];te==="oui"?xt[We]=!0:te==="non"?xt[We]=!1:xt[We]=te}),Me[Ge.id]=xt}),At.value=Me;const ke=await St(Ze(ye,"seasons",l.value,"selections")),Fe={};ke.docs.forEach(Ge=>{Fe[Ge.id]=Ge.data().players||[]}),ot.value=Fe}ra(),Li(),console.log("players (deduplicated):",tt.value.map(K=>({id:K.id,name:K.name}))),console.log("availability loaded:",At.value),Lr(()=>{ne();const K=z.value;K&&(K.addEventListener("scroll",ne,{passive:!0}),window.addEventListener("resize",ne))})});async function Ni(C,v){const K=tt.value.find(Me=>Me.name===C);if(!K){console.error("Joueur non trouvé:",C);return}if(!dt.value.find(Me=>Me.id===v)){console.error("Événement non trouvé:",v);return}if(await li(K.id,l.value)){Qa(K.id)?Oi(K,v):await oa({type:"toggleAvailability",data:{player:K,eventId:v}});return}Oi(K,v)}function Oi(C,v){var Ie;const K=(Ie=At.value[C.name])==null?void 0:Ie[v];console.log(`toggleAvailability - ${C.name} pour ${v}:`,K);let pe;K===!0?pe=!1:K===!1?pe=void 0:pe=!0,pe===void 0?At.value[C.name]&&delete At.value[C.name][v]:(At.value[C.name]||(At.value[C.name]={}),At.value[C.name][v]=pe),j_(C.name,At.value[C.name],l.value).then(()=>{Q.value=!0,de.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Q.value=!1},3e3)}).catch(Me=>{console.error("Erreur lors de la mise à jour de la disponibilité:",Me),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function sn(C,v){var K;return(K=At.value[C])==null?void 0:K[v]}function ea(C,v){var Ie;const K=ot.value[v]||[],pe=(Ie=At.value[C])==null?void 0:Ie[v];return K.includes(C)&&pe===!0}async function on(C,v=6){const K=dt.value.find(ke=>ke.id===C),pe=(K==null?void 0:K.playerCount)||6,Ie=ot.value[C]||[];if(Ie.length>0&&Ie.every(ke=>sn(ke,C))){console.log("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const Fe=tt.value.filter(xt=>sn(xt.name,C)).map(xt=>{const We=ts(xt.name);return{name:xt.name,weight:1/(1+We)}}),Ge=[],Ht=[...Fe];for(;Ge.length<pe&&Ht.length>0;){const xt=Ht.reduce((Ue,Cn)=>Ue+Cn.weight,0);let We=Math.random()*xt;const te=Ht.findIndex(Ue=>(We-=Ue.weight,We<=0));te>=0&&(Ge.push(Ht[te].name),Ht.splice(te,1))}ot.value[C]=Ge}else{const ke=Ie.filter(Ge=>sn(Ge,C)),Fe=pe-ke.length;if(Fe<=0)ot.value[C]=ke;else{const Ge=new Set(ke),xt=tt.value.filter(Ue=>sn(Ue.name,C)&&!Ge.has(Ue.name)).map(Ue=>{const Cn=ts(Ue.name);return{name:Ue.name,weight:1/(1+Cn)}}),We=[],te=[...xt];for(;We.length<Fe&&te.length>0;){const Ue=te.reduce((ji,Ws)=>ji+Ws.weight,0);let Cn=Math.random()*Ue;const is=te.findIndex(ji=>(Cn-=ji.weight,Cn<=0));is>=0&&(We.push(te[is].name),te.splice(is,1))}ot.value[C]=[...ke,...We]}}await SV(C,ot.value[C],l.value),ra(),Li()}async function ta(C,v=6){var ke,Fe,Ge,Ht,xt;console.log("tirerProtected appelé avec eventId:",C),console.log("showSelectionModal.value AVANT:",b.value),console.log("selectionModalEvent.value?.id AVANT:",(ke=A.value)==null?void 0:ke.id);const K=b.value,pe=(Fe=A.value)==null?void 0:Fe.id,Ie=ot.value[C]&&ot.value[C].length>0,Me=Ie?[...ot.value[C]]:[];if(await on(C,v),console.log("showSelectionModal.value APRÈS tirage:",b.value),console.log("selectionModalEvent.value?.id APRÈS tirage:",(Ge=A.value)==null?void 0:Ge.id),K&&!b.value&&(console.log("Restauration de la popin de sélection..."),b.value=!0,A.value=dt.value.find(We=>We.id===pe)),b.value&&((Ht=A.value)==null?void 0:Ht.id)===C)if(console.log("Popin de sélection ouverte, mise à jour..."),await Lr(),M.value&&M.value.showSuccess){console.log("Appel de showSuccess sur la popin de sélection");const We=ot.value[C]||[],te=Me.filter(Cn=>We.includes(Cn)),Ue=te.length>0&&te.length<Me.length;M.value.showSuccess(Ie,Ue)}else console.log("selectionModalRef.value:",M.value),console.log("showSuccess disponible:",(xt=M.value)==null?void 0:xt.showSuccess);else console.log("Popin de sélection fermée, affichage message global"),Q.value=!0,dt.value.find(We=>We.id===C),ot.value[C],Ie?de.value="Sélection mise à jour avec succès !":de.value="Sélection effectuée avec succès !",setTimeout(()=>{Q.value=!1},3e3)}function zs(C){var K;return C?(typeof C=="string"?new Date(C):((K=C.toDate)==null?void 0:K.call(C))||C).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function br(C){var K;return C?(typeof C=="string"?new Date(C):((K=C.toDate)==null?void 0:K.call(C))||C).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function ts(C){return Object.values(ot.value).filter(v=>v.includes(C)).length}function na(C){const v=At.value[C]||{};return Object.values(v).filter(K=>K===!0).length}function Zn(C){return C?Object.values(At.value).filter(v=>v[C]===!0).length:0}function Jl(C){return C?(ot.value[C]||[]).length:0}function pd(C){const v=na(C),K=ts(C);return v===0?0:K/v}function Mi(C){wr.value[C]={availability:na(C),selection:ts(C),ratio:pd(C)}}function ra(){tt.value.forEach(C=>Mi(C.name))}function Li(){const C={};dt.value.forEach(v=>{const K=v.playerCount||6,Ie=tt.value.filter(ke=>sn(ke.name,v.id)===!0).map(ke=>{const Fe=ts(ke.name);return{name:ke.name,weight:1/(1+Fe)}}),Me=Ie.reduce((ke,Fe)=>ke+Fe.weight,0);Ie.forEach(ke=>{const Fe=Math.min(1,ke.weight/Me*K);C[ke.name]||(C[ke.name]={}),C[ke.name][v.id]=Math.round(Fe*100)})}),Zo.value=C}function Ir(C,v){var ke,Fe;const K=C.name,pe=sn(K,v),Ie=ea(K,v),Me=((Fe=(ke=Zo.value)==null?void 0:ke[K])==null?void 0:Fe[v])??0;return pe===!1?"Non disponible – cliquez pour changer":Ie?`Sélectionné · Chance estimée : ${Me}%`:pe===!0?`Disponible · Chance estimée : ${Me}%`:"Cliquez pour indiquer votre disponibilité"}const Un=q(null),Gs=q(!1);async function Yl(C=null){const v=C||Un.value;if(!v){console.error("Aucun joueur à supprimer");return}try{await AV(v,l.value),tt.value=tt.value.filter(K=>K.id!==v),Gs.value=!1,Un.value=null,Q.value=!0,de.value="Joueur supprimé avec succès !",setTimeout(()=>{Q.value=!1},3e3)}catch(K){console.error("Erreur lors de la suppression du joueur :",K),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function sa(){Gs.value=!1,Un.value=null}async function ia(C){ic(),await li(C,l.value)?await ec({type:"deletePlayer",data:{playerId:C}}):await Er({type:"deletePlayer",data:{playerId:C}})}async function Xl(){if($.value){const C=dt.value.find(K=>K.id===$.value),v=(C==null?void 0:C.playerCount)||6;await ta($.value,v),B.value=!1,$.value=null}}function Zl(){B.value=!1,$.value=null}function md(){return x.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis"}[x.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function Er(C){if(Dn.isPinCached(l.value)){const v=Dn.getCachedPin(l.value);if(console.log("PIN en cache trouvé, utilisation automatique"),await yu(l.value,v)){await er(C);return}else Dn.clearSession()}x.value=C,ie.value=!0}async function ec(C){const v=C.data.playerId;if(Qa(v)){console.log("Mot de passe du joueur en cache trouvé, utilisation automatique"),await er(C);return}S.value=C,I.value=!0}async function oa(C){const v=C.data.player.id;if(Qa(v)){console.log("Mot de passe du joueur en cache trouvé, utilisation automatique"),await er(C);return}He.value=C,Ot.value=!0}async function Ks(C){try{if(await yu(l.value,C)){Dn.saveSession(l.value,C),ie.value=!1;const K=x.value;x.value=null,await er(K)}else w.value="Code PIN incorrect",setTimeout(()=>{w.value=""},3e3)}catch(v){console.error("Erreur lors de la vérification du PIN:",v),w.value="Erreur lors de la vérification du code PIN"}}function Tr(){ie.value=!1,x.value=null,w.value=""}async function Fi(C){if(C){E.value=!0,T.value="";try{const v=S.value.data.playerId,K=await Hh(l.value);if(C===K){try{Il.saveSession(S.value.data.playerId,C)}catch{}I.value=!1;const Ie=S.value;S.value=null,D.value="",await er(Ie);return}if(await vu(v,C,l.value)){I.value=!1;const Ie=S.value;S.value=null,D.value="",await er(Ie)}else T.value="Mot de passe incorrect",setTimeout(()=>{T.value=""},3e3)}catch(v){console.error("Erreur lors de la vérification du mot de passe:",v),T.value="Erreur lors de la vérification du mot de passe"}finally{E.value=!1}}}function gd(){I.value=!1,S.value=null,T.value="",D.value="",E.value=!1}async function aa(C){if(C){$t.value=!0,Ne.value="";try{const v=He.value.data.player,K=await Hh(l.value);if(C===K){try{Il.saveSession(He.value.data.player.id,C)}catch{}Ot.value=!1;const Ie=He.value;He.value=null,Se.value="",await er(Ie);return}if(await vu(v.id,C,l.value)){Ot.value=!1;const Ie=He.value;He.value=null,Se.value="",await er(Ie)}else Ne.value="Mot de passe incorrect",setTimeout(()=>{Ne.value=""},3e3)}catch(v){console.error("Erreur lors de la vérification du mot de passe:",v),Ne.value="Erreur lors de la vérification du mot de passe"}finally{$t.value=!1}}}function tc(){Ot.value=!1,He.value=null,Ne.value="",Se.value="",$t.value=!1}async function nc(){et.value=!0,rt.value="",Fn.value="";try{const C=He.value.data.player,v=await Wh(C.id,l.value);Fn.value=v.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(C){console.error("Erreur lors de l'envoi de l'email:",C),rt.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{et.value=!1}}async function la(){jt.value=!0,G.value="",fe.value="";try{const C=S.value.data.playerId,v=await Wh(C,l.value);fe.value=v.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(C){console.error("Erreur lors de l'envoi de l'email:",C),G.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{jt.value=!1}}function ca(){return Dn.isPinCached(l.value)?{timeRemaining:Dn.getTimeRemaining(),isExpiringSoon:Dn.isExpiringSoon()}:null}async function er(C){if(!C)return;const{type:v,data:K}=C;try{switch(v){case"deleteEvent":console.log("executePendingOperation - data.eventId:",K.eventId),console.log("executePendingOperation - type de data.eventId:",typeof K.eventId),d.value=K.eventId,u.value=!0;break;case"addEvent":Jt.value=!0;break;case"deletePlayer":Un.value=K.playerId,Gs.value=!0;break;case"launchSelection":ot.value[K.eventId]&&ot.value[K.eventId].length>0?($.value=K.eventId,B.value=!0,le.value=!1):(await ta(K.eventId,K.count),le.value=!1);break;case"toggleAvailability":Oi(K.player,K.eventId);break}}catch(pe){console.error("Erreur lors de l'exécution de l'opération:",pe),Q.value=!0,de.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Q.value=!1},3e3)}}function rc(){i.push("/")}cf(()=>{const C=z.value;C&&C.removeEventListener("scroll",ne),window.removeEventListener("resize",ne)});function _d(C){oe.value=C,Re.value=C.description||"",le.value=!0}function Ui(){le.value=!1,oe.value=null,Re.value="",$e.value=!1}function ua(){f.value=oe.value.id,g.value=oe.value.title,_.value=oe.value.date,Re.value=oe.value.description||"",k.value=oe.value.playerCount||6,le.value=!1}function sc(C){O.value=C,j.value=!0}function ic(){j.value=!1,O.value=null}async function Ar({playerId:C,newName:v}){try{await xV(C,v,l.value),await Promise.all([rh(l.value),Ta(tt.value,dt.value,l.value),Aa(l.value)]).then(([K,pe,Ie])=>{if(tt.value=K,At.value=pe,ot.value=Ie,ve(),O.value&&O.value.id===C){const Me=K.find(ke=>ke.id===C);Me&&(O.value=Me)}}),Q.value=!0,de.value="Joueur mis à jour avec succès !",setTimeout(()=>{Q.value=!1},3e3)}catch(K){console.error("Erreur lors de l'édition du joueur:",K),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function tr(){try{await Promise.all([rh(l.value),Ta(tt.value,dt.value,l.value),Aa(l.value)]).then(([C,v,K])=>{if(tt.value=C,At.value=v,ot.value=K,ve(),O.value){const pe=C.find(Ie=>Ie.id===O.value.id);pe&&(O.value=pe)}}),Q.value=!0,de.value="Données mises à jour !",setTimeout(()=>{Q.value=!1},3e3)}catch(C){console.error("Erreur lors du rafraîchissement:",C)}}function Bi(C){if(!C)return{availability:0,selection:0,ratio:0};const v=na(C.name),K=ts(C.name),pe=v===0?0:Math.round(K/v*100);return{availability:v,selection:K,ratio:pe}}function ns(C){const v=ot.value[C]||[],K=dt.value.find(Me=>Me.id===C),pe=(K==null?void 0:K.playerCount)||6,Ie=Zn(C);if(v.length>0){const Me=v.some(Fe=>!sn(Fe,C)),ke=Ie<pe;if(Me||ke)return{type:"incomplete",hasUnavailablePlayers:Me,hasInsufficientPlayers:ke,unavailablePlayers:v.filter(Fe=>!sn(Fe,C)),availableCount:Ie,requiredCount:pe}}return Ie<pe?{type:"insufficient",availableCount:Ie,requiredCount:pe}:v.length===0?{type:"ready",availableCount:Ie,requiredCount:pe}:{type:"complete",availableCount:Ie,requiredCount:pe}}function oc(C){const v=ns(C);return v.type==="incomplete"||v.type==="insufficient"}function st(C){const v=ns(C);switch(v.type){case"incomplete":return v.hasUnavailablePlayers?v.unavailablePlayers.length===1?`Sélection incomplète : ${v.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${v.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${v.availableCount} joueurs disponibles pour ${v.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${v.availableCount} disponibles pour ${v.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${v.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${v.availableCount} joueurs disponibles`;default:return""}}async function rs({eventId:C,eventData:v,reason:K}){if(!l.value)return;const pe={id:C,...v},Ie=[];for(const Me of tt.value){if(!await li(Me.id,l.value))continue;const Fe=await $b(Me.id,l.value);if(Fe)try{const Ge=await z_({seasonId:l.value,playerId:Me.id,eventId:pe.id,action:"yes"}),Ht=await z_({seasonId:l.value,playerId:Me.id,eventId:pe.id,action:"no"}),xt=`${Ge.url}&slug=${encodeURIComponent(o)}`,We=`${Ht.url}&slug=${encodeURIComponent(o)}`;await BV({toEmail:Fe,playerName:Me.name,eventTitle:pe.title,eventDate:br(pe.date),yesUrl:xt,noUrl:We,reason:K})}catch(Ge){console.error("Email non envoyé pour",Me.name,(Ge==null?void 0:Ge.message)||Ge),Ie.push(Me.id)}}Q.value=!0,de.value=Ie.length>0?`Emails envoyés (avec ${Ie.length} échec(s))`:"Emails envoyés aux joueurs protégés.",setTimeout(()=>{Q.value=!1},3e3)}async function ss(C){await rs({eventId:C.id,eventData:C,reason:"manual"})}function Hs(C){if(!C)return{};const v={};return tt.value.forEach(K=>{v[K.name]=sn(K.name,C)}),v}function $i(C){A.value=C,b.value=!0}function da(){b.value=!1,A.value=null}async function yd(){if(!A.value)return;const C=A.value.id,v=A.value.playerCount||6;if(Zn(C)===0){Q.value=!0,de.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Q.value=!1},3e3);return}await Er({type:"launchSelection",data:{eventId:C,count:v}})}function vd(){da(),Q.value=!0,de.value="Sélection validée !",setTimeout(()=>{Q.value=!1},3e3)}return(C,v)=>{var K,pe,Ie,Me,ke,Fe,Ge,Ht,xt,We;return H(),W(Dt,null,[m("div",MO,[m("div",{ref_key:"pageHeaderRef",ref:e,class:"sticky top-0 z-[70] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},[m("button",{onClick:rc,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour à l'accueil"},v[36]||(v[36]=[m("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),m("h1",LO,ge(a.value?a.value:"Chargement..."),1)],512),m("div",FO,[m("div",{ref_key:"gridboardRef",ref:z,class:"gridboard relative overflow-x-auto bg-gradient-to-br from-white/5 to-white/10 backdrop-blur-sm border border-white/20 rounded-2xl"},[m("table",{class:"table-auto border-collapse table-fixed w-full min-w-max",style:ps({marginTop:(t.value,"0")})},[m("colgroup",null,[v[37]||(v[37]=m("col",{class:"col-left"},null,-1)),(H(!0),W(Dt,null,Dr(dt.value,(te,Ue)=>(H(),W("col",{key:"c"+Ue,class:"col-event"}))),128)),v[38]||(v[38]=m("col",{class:"col-right"},null,-1))]),m("thead",{style:ps({position:"sticky",top:t.value+"px",zIndex:60})},[m("tr",UO,[m("th",{class:"p-3 md:p-4 text-left sticky left-0 bg-gray-900",style:ps({top:t.value+"px",zIndex:56})},[m("div",{class:"flex items-center justify-center"},[m("button",{onClick:Ql,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},v[39]||(v[39]=[m("span",{class:"text-lg"},"➕",-1),m("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),m("span",{class:"sm:hidden"},"Événement",-1)]))])],4),(H(!0),W(Dt,null,Dr(dt.value,te=>(H(),W("th",{key:te.id,class:"p-3 text-center align-top cursor-pointer sticky bg-gray-900",style:ps({top:t.value+"px",zIndex:55}),onClick:Ue=>_d(te)},[m("div",$O,[m("div",{class:"header-date text-[16px] md:text-base text-gray-300",title:br(te.date)},ge(zs(te.date)),9,jO),m("div",{class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2",title:te.title},ge(te.title||"Sans titre"),9,qO),oc(te.id)?(H(),W("div",{key:0,class:"mt-1 w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center hover:bg-yellow-400 transition-colors duration-200",title:st(te.id)+" - Cliquez pour ouvrir la sélection",onClick:Hn(Ue=>$i(te),["stop"])},v[40]||(v[40]=[m("span",{class:"text-xs text-white font-bold"},"⚠️",-1)]),8,zO)):ns(te.id).type==="ready"?(H(),W("div",{key:1,class:"mt-1 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center hover:bg-green-400 transition-colors duration-200",title:st(te.id)+" - Cliquez pour ouvrir la sélection",onClick:Hn(Ue=>$i(te),["stop"])},v[41]||(v[41]=[m("span",{class:"text-xs text-white font-bold"},"🎲",-1)]),8,GO)):Ee("",!0)])],12,BO))),128)),m("th",{class:"p-3 text-center align-top sticky bg-gray-900",style:ps({top:t.value+"px",zIndex:55})},null,4)])],4),m("tbody",null,[(H(!0),W(Dt,null,Dr(tt.value,te=>(H(),W("tr",{key:te.id,class:sr(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":te.id===L.value}]),"data-player-id":te.id},[m("td",HO,[m("div",WO,[ee(te.id)?(H(),W("span",QO," 🔒 ")):Ee("",!0),m("span",{onClick:Ue=>sc(te),class:"player-name hover:border-b-2 hover:border-dashed hover:border-purple-400 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight",title:"Cliquez pour voir les détails : "+te.name},ge(te.name),9,JO)])]),(H(!0),W(Dt,null,Dr(dt.value,Ue=>(H(),W("td",{key:Ue.id,class:"p-3 md:p-5 text-center cursor-pointer hover:bg-white/10 transition-all duration-200 min-h-20",onClick:Cn=>Ni(te.name,Ue.id)},[m("div",XO,[ea(te.name,Ue.id)?(H(),W("span",{key:0,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:Ir(te,Ue.id)}," 🎭 ",8,ZO)):sn(te.name,Ue.id)?(H(),W("span",{key:1,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:Ir(te,Ue.id)}," ✅ ",8,e2)):sn(te.name,Ue.id)===!1?(H(),W("span",{key:2,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:Ir(te,Ue.id)}," ❌ ",8,t2)):(H(),W("span",{key:3,class:"text-gray-500 hover:text-white transition-colors duration-200 text-xl",title:Ir(te,Ue.id)}," – ",8,n2))])],8,YO))),128)),v[42]||(v[42]=m("td",{class:"p-3 md:p-4"},null,-1))],10,KO))),128)),m("tr",r2,[m("td",s2,[m("div",i2,[m("button",{onClick:v[0]||(v[0]=te=>P.value=!0),class:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur"},v[43]||(v[43]=[m("span",{class:"text-lg"},"➕",-1),m("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),m("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(H(!0),W(Dt,null,Dr(dt.value,te=>(H(),W("td",{key:"add-row-"+te.id,class:"p-3 md:p-5"}))),128)),v[44]||(v[44]=m("td",{class:"p-3 md:p-4"},null,-1))])])],4)],512),mt(m("div",o2,v[45]||(v[45]=[m("div",{class:"h-[80%] w-6 bg-gradient-to-r from-black/40 to-transparent rounded-r-lg"},null,-1),m("div",{class:"absolute text-white/80"},"‹",-1)]),512),[[Tm,Z.value]]),mt(m("div",a2,v[46]||(v[46]=[m("div",{class:"h-[80%] w-6 bg-gradient-to-l from-black/40 to-transparent rounded-l-lg"},null,-1),m("div",{class:"absolute text-white/80"},"›",-1)]),512),[[Tm,ue.value]])])]),Q.value?(H(),W("div",l2,[m("div",c2,[v[47]||(v[47]=m("span",{class:"text-xl"},"✨",-1)),m("span",null,ge(de.value),1)])])):Ee("",!0),Jt.value?(H(),W("div",u2,[m("div",d2,[v[52]||(v[52]=m("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),m("div",h2,[v[48]||(v[48]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),mt(m("input",{"onUpdate:modelValue":v[1]||(v[1]=te=>ut.value=te),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[Pt,ut.value]])]),m("div",f2,[v[49]||(v[49]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),mt(m("input",{"onUpdate:modelValue":v[2]||(v[2]=te=>En.value=te),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[Pt,En.value]])]),m("div",p2,[v[50]||(v[50]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),mt(m("textarea",{"onUpdate:modelValue":v[3]||(v[3]=te=>Xn.value=te),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[Pt,Xn.value]])]),m("div",m2,[v[51]||(v[51]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),mt(m("input",{"onUpdate:modelValue":v[4]||(v[4]=te=>Tt.value=te),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[Pt,Tt.value]])]),m("div",{class:"flex justify-end space-x-3"},[m("button",{onClick:Xo,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),m("button",{onClick:Rn,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):Ee("",!0),P.value?(H(),W("div",g2,[m("div",_2,[v[54]||(v[54]=m("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),m("div",y2,[v[53]||(v[53]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),mt(m("input",{"onUpdate:modelValue":v[5]||(v[5]=te=>R.value=te),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[Pt,R.value]])]),m("div",v2,[m("button",{onClick:v[6]||(v[6]=te=>P.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),m("button",{onClick:Kt,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):Ee("",!0),u.value?(H(),W("div",w2,[m("div",b2,[v[55]||(v[55]=us('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),m("div",I2,[m("button",{onClick:Ce,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),m("button",{onClick:v[7]||(v[7]=()=>Te()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):Ee("",!0),Gs.value?(H(),W("div",E2,[m("div",T2,[v[56]||(v[56]=us('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),m("div",A2,[m("button",{onClick:sa,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),m("button",{onClick:v[8]||(v[8]=()=>Yl()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):Ee("",!0),B.value?(H(),W("div",x2,[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},[v[57]||(v[57]=us('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🎭</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.</p></div><p class="mb-6 text-sm text-yellow-400 bg-yellow-900/20 p-3 rounded-lg border border-yellow-500/20"> ⚠️ Pensez à prévenir les gens du changement ! </p>',2)),m("div",{class:"flex justify-end space-x-3"},[m("button",{onClick:Zl,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),m("button",{onClick:Xl,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):Ee("",!0),le.value?(H(),W("div",{key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:Ui},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:v[17]||(v[17]=Hn(()=>{},["stop"]))},[m("div",P2,[m("button",{onClick:Ui,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),v[58]||(v[58]=m("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[m("span",{class:"text-2xl md:text-3xl"},"🎭")],-1)),m("h2",S2,ge((K=oe.value)==null?void 0:K.title),1),m("p",R2,ge(br((pe=oe.value)==null?void 0:pe.date)),1)]),m("div",C2,[(Ie=oe.value)!=null&&Ie.description?(H(),W("div",k2,[m("p",D2,ge(oe.value.description),1)])):Ee("",!0),m("div",V2,[m("div",N2,[m("div",O2,ge(Zn((Me=oe.value)==null?void 0:Me.id)),1),v[59]||(v[59]=m("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),m("div",M2,[m("div",L2,ge(Jl((ke=oe.value)==null?void 0:ke.id)),1),v[60]||(v[60]=m("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),m("div",F2,[m("div",U2,ge(((Fe=oe.value)==null?void 0:Fe.playerCount)||6),1),v[61]||(v[61]=m("div",{class:"text-xs md:text-sm text-gray-300"},"À sélectionner",-1))])]),m("div",B2,[m("button",{onClick:ua,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},v[62]||(v[62]=[m("span",null,"✏️",-1),m("span",null,"Modifier",-1)])),m("button",{onClick:v[9]||(v[9]=te=>ss(oe.value)),class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2",title:"Envoyer un email aux joueurs protégés pour indiquer leur disponibilité"},v[63]||(v[63]=[m("span",null,"📧",-1),m("span",null,"Relancer",-1)])),m("button",{onClick:v[10]||(v[10]=te=>$i(oe.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},v[64]||(v[64]=[m("span",null,"🎭",-1),m("span",null,"Sélection",-1)])),m("button",{onClick:v[11]||(v[11]=te=>{var Ue;return Ae((Ue=oe.value)==null?void 0:Ue.id)}),class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},v[65]||(v[65]=[m("span",null,"🗑️",-1),m("span",null,"Supprimer",-1)])),m("button",{onClick:Ui,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")]),$e.value?(H(),W("div",$2,[m("button",{onClick:v[12]||(v[12]=te=>{ua(),$e.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"},"✏️ Modifier"),m("button",{onClick:v[13]||(v[13]=te=>{ss(oe.value),$e.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-amber-600/20 text-amber-200 border border-amber-500/30"},"📧 Relancer"),m("button",{onClick:v[14]||(v[14]=te=>{var Ue;Ae((Ue=oe.value)==null?void 0:Ue.id),$e.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"},"🗑️ Supprimer")])):Ee("",!0)]),m("div",j2,[m("button",{onClick:v[15]||(v[15]=te=>$i(oe.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélection"),m("button",{onClick:Ui,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),m("button",{onClick:v[16]||(v[16]=te=>$e.value=!$e.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):Ee("",!0),f.value?(H(),W("div",q2,[m("div",z2,[v[70]||(v[70]=m("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),m("div",G2,[v[66]||(v[66]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),mt(m("input",{"onUpdate:modelValue":v[18]||(v[18]=te=>g.value=te),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[An(pt,["esc"]),An(Le,["enter"])],ref:"editTitleInput"},null,544),[[Pt,g.value]])]),m("div",K2,[v[67]||(v[67]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),mt(m("input",{"onUpdate:modelValue":v[19]||(v[19]=te=>_.value=te),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[An(pt,["esc"]),An(Le,["enter"])]},null,544),[[Pt,_.value]])]),m("div",H2,[v[68]||(v[68]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),mt(m("textarea",{"onUpdate:modelValue":v[20]||(v[20]=te=>Re.value=te),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:An(pt,["esc"])},null,544),[[Pt,Re.value]])]),m("div",W2,[v[69]||(v[69]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),mt(m("input",{"onUpdate:modelValue":v[21]||(v[21]=te=>k.value=te),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:An(pt,["esc"])},null,544),[[Pt,k.value]])]),m("div",{class:"flex justify-end space-x-3"},[m("button",{onClick:pt,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),m("button",{onClick:Le,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):Ee("",!0),Lt(Ub,{show:ie.value,message:md(),error:w.value,"session-info":ca(),onSubmit:Ks,onCancel:Tr},null,8,["show","message","error","session-info"]),I.value?(H(),W("div",Q2,[m("div",J2,[v[72]||(v[72]=us('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),m("div",Y2,[m("div",X2,[m("div",null,[v[71]||(v[71]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),mt(m("input",{"onUpdate:modelValue":v[22]||(v[22]=te=>D.value=te),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:v[23]||(v[23]=An(te=>Fi(D.value),["enter"])),ref_key:"playerPasswordInputRef",ref:vt},null,544),[[Pt,D.value]])])]),m("button",{onClick:v[24]||(v[24]=te=>Fi(D.value)),disabled:!D.value||E.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[E.value?(H(),W("span",eM,"⏳")):(H(),W("span",tM,"🔓")),m("span",null,ge(E.value?"Vérification...":"Vérifier et supprimer"),1)],8,Z2)]),m("div",nM,[m("button",{onClick:v[25]||(v[25]=te=>In.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),T.value?(H(),W("div",rM,[m("div",sM,ge(T.value),1)])):Ee("",!0),m("div",{class:"flex justify-center"},[m("button",{onClick:gd,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):Ee("",!0),Ot.value?(H(),W("div",iM,[m("div",oM,[v[75]||(v[75]=us('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),m("div",aM,[m("div",lM,[m("div",null,[v[73]||(v[73]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),mt(m("input",{"onUpdate:modelValue":v[26]||(v[26]=te=>Se.value=te),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:v[27]||(v[27]=An(te=>aa(Se.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:Ln},null,544),[[Pt,Se.value]])])]),m("div",cM,[m("button",{onClick:v[28]||(v[28]=te=>rn.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),Ne.value?(H(),W("div",uM,[m("div",dM,ge(Ne.value),1)])):Ee("",!0)]),m("div",hM,[m("button",{onClick:tc,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),m("button",{onClick:v[29]||(v[29]=te=>aa(Se.value)),disabled:!Se.value||$t.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[$t.value?(H(),W("span",pM,"⏳")):(H(),W("span",mM,"🔓")),m("span",null,[jn(ge($t.value?"Vérification...":"Vérifier"),1),v[74]||(v[74]=m("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,fM)])])])):Ee("",!0),rn.value?(H(),W("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:v[32]||(v[32]=te=>rn.value=!1)},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:v[31]||(v[31]=Hn(()=>{},["stop"]))},[v[77]||(v[77]=us('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),m("div",gM,[v[76]||(v[76]=m("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),m("button",{onClick:nc,disabled:et.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[et.value?(H(),W("span",yM,"⏳")):(H(),W("span",vM,"📧")),m("span",null,ge(et.value?"Envoi...":"Envoyer l'email"),1)],8,_M)]),rt.value?(H(),W("div",wM,[m("div",bM,ge(rt.value),1)])):Ee("",!0),Fn.value?(H(),W("div",IM,[m("div",EM,ge(Fn.value),1)])):Ee("",!0),m("div",TM,[m("button",{onClick:v[30]||(v[30]=te=>rn.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):Ee("",!0),In.value?(H(),W("div",{key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:v[35]||(v[35]=te=>In.value=!1)},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:v[34]||(v[34]=Hn(()=>{},["stop"]))},[v[79]||(v[79]=us('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),m("div",AM,[v[78]||(v[78]=m("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),m("button",{onClick:la,disabled:jt.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[jt.value?(H(),W("span",PM,"⏳")):(H(),W("span",SM,"📧")),m("span",null,ge(jt.value?"Envoi...":"Envoyer l'email"),1)],8,xM)]),G.value?(H(),W("div",RM,[m("div",CM,ge(G.value),1)])):Ee("",!0),fe.value?(H(),W("div",kM,[m("div",DM,ge(fe.value),1)])):Ee("",!0),m("div",VM,[m("button",{onClick:v[33]||(v[33]=te=>In.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):Ee("",!0),Lt(JN,{show:j.value,player:O.value,stats:Bi(O.value),seasonId:l.value,onClose:ic,onUpdate:Ar,onDelete:ia,onRefresh:tr},null,8,["show","player","stats","seasonId"]),Lt(OO,{ref_key:"selectionModalRef",ref:M,show:b.value,event:A.value,"current-selection":ot.value[(Ge=A.value)==null?void 0:Ge.id]||[],"available-count":Zn((Ht=A.value)==null?void 0:Ht.id),"selected-count":Jl((xt=A.value)==null?void 0:xt.id),"player-availability":Hs((We=A.value)==null?void 0:We.id),onClose:da,onSelection:yd,onPerfect:vd},null,8,["show","event","current-selection","available-count","selected-count","player-availability"])],64)}}},OM={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},MM={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},LM={key:0,class:"text-center py-8"},FM={key:1,class:"text-center py-8"},UM={class:"text-gray-300 mb-6"},BM={key:2,class:"space-y-6"},$M={class:"text-center"},jM={class:"text-gray-300"},qM={class:"font-semibold text-white"},zM={class:"space-y-4"},GM=["disabled"],KM={key:0,class:"animate-spin"},HM={key:1},WM={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},QM={class:"text-red-300 text-sm"},JM={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},YM={class:"text-green-300 text-sm"},XM={__name:"PasswordReset",setup(n){const e=cv(),t=Nu(),r=q(!0),s=q(""),i=q(""),o=q(""),a=q(""),l=q(""),u=q(!1),d=q(""),f=q(""),g=Zt(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);_o(async()=>{try{const{oobCode:P}=e.query;if(console.log("🔍 [DEBUG] Token reçu:",P),!P){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=P,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(P){console.error("Erreur lors de la vérification du lien:",P),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function _(){if(g.value){u.value=!0,d.value="",f.value="";try{console.log("🔍 [DEBUG] Début réinitialisation avec token:",o.value),await F1(Di,o.value,a.value),console.log("🔍 [DEBUG] Mot de passe Firebase Auth mis à jour"),console.log("🔍 [DEBUG] Réinitialisation terminée avec Firebase Auth"),f.value="Mot de passe réinitialisé avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{k()},3e3)}catch(P){console.error("❌ [ERROR] Erreur lors de la réinitialisation:",P),P.code==="auth/weak-password"?d.value="Le mot de passe doit contenir au moins 6 caractères":P.code==="auth/invalid-action-code"?d.value="Lien de réinitialisation invalide ou expiré":d.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{u.value=!1}}}function k(){t.push("/")}return(P,R)=>(H(),W("div",OM,[m("div",MM,[R[8]||(R[8]=us('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(H(),W("div",LM,R[2]||(R[2]=[m("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),m("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(H(),W("div",FM,[R[3]||(R[3]=m("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[m("span",{class:"text-2xl"},"❌")],-1)),R[4]||(R[4]=m("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),m("p",UM,ge(s.value),1),m("button",{onClick:k,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):i.value?(H(),W("div",BM,[m("div",$M,[m("p",jM,[R[5]||(R[5]=jn("Email : ")),m("span",qM,ge(i.value),1)])]),m("div",zM,[m("div",null,[R[6]||(R[6]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),mt(m("input",{"onUpdate:modelValue":R[0]||(R[0]=L=>a.value=L),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:An(_,["enter"])},null,544),[[Pt,a.value]])]),m("div",null,[R[7]||(R[7]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),mt(m("input",{"onUpdate:modelValue":R[1]||(R[1]=L=>l.value=L),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:An(_,["enter"])},null,544),[[Pt,l.value]])])]),m("button",{onClick:_,disabled:!g.value||u.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[u.value?(H(),W("span",KM,"⏳")):(H(),W("span",HM,"🔑")),m("span",null,ge(u.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,GM),d.value?(H(),W("div",WM,[m("div",QM,ge(d.value),1)])):Ee("",!0),f.value?(H(),W("div",JM,[m("div",YM,ge(f.value),1)])):Ee("",!0)])):Ee("",!0)])]))}},ZM={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},eL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},tL={class:"text-3xl"},nL={class:"text-2xl font-bold text-white mb-2"},rL={class:"text-gray-300 mb-6"},sL={__name:"MagicLink",setup(n){const e=cv(),t=Nu(),r=q("loading"),s=q("Traitement en cours..."),i=q("Merci de patienter pendant la validation du lien."),o=Zt(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/")}return _o(async()=>{try{const l=String(e.query.sid||""),u=String(e.query.pid||""),d=String(e.query.eid||""),f=String(e.query.t||""),g=String(e.query.a||""),_=String(e.query.slug||"");if(!l||!u||!d||!f||!g){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(!(await FV({seasonId:l,playerId:u,eventId:d,token:f,action:g})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}const P=Ve(ye,"seasons",l,"players",u),R=await Ri(P),L=R.exists()&&R.data().name||"";if(!L){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}await PV({seasonId:l,playerName:L,eventId:d,value:g==="yes"}),await UV({seasonId:l,playerId:u,eventId:d}),r.value="ok",s.value="Merci !",i.value=g==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible.",setTimeout(()=>a(),2e3)}catch(l){console.error("Magic link error:",l),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,u)=>(H(),W("div",ZM,[m("div",eL,[m("div",{class:sr(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[m("span",tL,ge(o.value),1)],2),m("h1",nL,ge(s.value),1),m("p",rL,ge(i.value),1),m("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},iL=[{path:"/",component:wV},{path:"/season/:slug",component:NM,props:!0},{path:"/reset-password",component:XM},{path:"/magic",component:sL}],oL=fA({history:jT("/impro-selector/"),routes:iL});lT(dT).use(oL).mount("#app");export{Ze as $,qw as A,Ii as B,_r as C,Bt as D,fF as E,Ai as F,ip as G,hF as H,dL as I,Jn as J,nC as K,sC as L,zw as M,FL as N,UL as O,SC as P,dn as Q,RL as R,gL as S,Rt as T,sF as U,Yu as V,xC as W,rF as X,LL as Y,wL as Z,Dv as _,hl as a,zl as a$,pL as a0,rC as a1,mC as a2,dF as a3,ml as a4,nF as a5,EL as a6,uF as a7,Ve as a8,PL as a9,xL as aA,KL as aB,HL as aC,SL as aD,fC as aE,XL as aF,ZL as aG,TC as aH,Uw as aI,Sw as aJ,mL as aK,tF as aL,gp as aM,Pn as aN,aF as aO,aL as aP,BL as aQ,VL as aR,DL as aS,ML as aT,TL as aU,GL as aV,oF as aW,bL as aX,hC as aY,Gw as aZ,vF as a_,yL as aa,vL as ab,IL as ac,cF as ad,OL as ae,NL as af,Ct as ag,Bl as ah,_C as ai,WL as aj,Ri as ak,$L as al,jL as am,St as an,qL as ao,zL as ap,iC as aq,lF as ar,iF as as,_L as at,CL as au,kL as av,AL as aw,QL as ax,YL as ay,JL as az,oC as b,V1 as b$,ql as b0,bF as b1,vl as b2,Ci as b3,ys as b4,mF as b5,ws as b6,vs as b7,Kr as b8,$c as b9,$C as bA,KF as bB,i4 as bC,x_ as bD,_k as bE,l1 as bF,FF as bG,RF as bH,N1 as bI,JF as bJ,t4 as bK,s4 as bL,HF as bM,BF as bN,J1 as bO,EF as bP,CC as bQ,O1 as bR,YF as bS,e4 as bT,r4 as bU,zC as bV,zF as bW,DF as bX,L1 as bY,SF as bZ,LF as b_,yF as ba,hi as bb,mo as bc,wD as bd,gF as be,WF as bf,Gh as bg,_F as bh,bD as bi,Lp as bj,bs as bk,xF as bl,Y1 as bm,ik as bn,vD as bo,xb as bp,U1 as bq,F1 as br,u1 as bs,B1 as bt,wF as bu,GF as bv,kF as bw,MF as bx,SD as by,IF as bz,Mo as c,xp as c0,AF as c1,$1 as c2,CF as c3,QF as c4,ZF as c5,n4 as c6,qF as c7,TF as c8,jF as c9,OF as ca,z1 as cb,XF as cc,NF as cd,$F as ce,UF as cf,VF as cg,PF as ch,xi as d,ct as e,Y as f,Qo as g,Fl as h,Fc as i,sd as j,Ul as k,nd as l,pp as m,Lo as n,rd as o,oi as p,PC as q,Vt as r,pi as s,he as t,cL as u,Qx as v,bt as w,pF as x,Be as y,lL as z};
