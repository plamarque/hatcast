(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function xm(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const Dt={},qa=[],Ur=()=>{},EA=()=>!1,Th=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Im=n=>n.startsWith("onUpdate:"),_n=Object.assign,Em=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},TA=Object.prototype.hasOwnProperty,At=(n,e)=>TA.call(n,e),qe=Array.isArray,za=n=>yc(n)==="[object Map]",xl=n=>yc(n)==="[object Set]",Wv=n=>yc(n)==="[object Date]",et=n=>typeof n=="function",on=n=>typeof n=="string",zr=n=>typeof n=="symbol",Nt=n=>n!==null&&typeof n=="object",ab=n=>(Nt(n)||et(n))&&et(n.then)&&et(n.catch),lb=Object.prototype.toString,yc=n=>lb.call(n),AA=n=>yc(n).slice(8,-1),ub=n=>yc(n)==="[object Object]",Tm=n=>on(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,xu=xm(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Ah=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},SA=/-(\w)/g,Dr=Ah(n=>n.replace(SA,(e,t)=>t?t.toUpperCase():"")),PA=/\B([A-Z])/g,to=Ah(n=>n.replace(PA,"-$1").toLowerCase()),Sh=Ah(n=>n.charAt(0).toUpperCase()+n.slice(1)),Lf=Ah(n=>n?`on${Sh(n)}`:""),Fi=(n,e)=>!Object.is(n,e),Ed=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},xp=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},Hd=n=>{const e=parseFloat(n);return isNaN(e)?n:e},CA=n=>{const e=on(n)?Number(n):NaN;return isNaN(e)?n:e};let Qv;const Ph=()=>Qv||(Qv=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function br(n){if(qe(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=on(r)?NA(r):br(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(on(n)||Nt(n))return n}const RA=/;(?![^(]*\))/g,kA=/:([^]+)/,DA=/\/\*[^]*?\*\//g;function NA(n){const e={};return n.replace(DA,"").split(RA).forEach(t=>{if(t){const r=t.split(kA);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function Qt(n){let e="";if(on(n))e=n;else if(qe(n))for(let t=0;t<n.length;t++){const r=Qt(n[t]);r&&(e+=r+" ")}else if(Nt(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const VA="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",OA=xm(VA);function cb(n){return!!n||n===""}function MA(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=_c(n[r],e[r]);return t}function _c(n,e){if(n===e)return!0;let t=Wv(n),r=Wv(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=zr(n),r=zr(e),t||r)return n===e;if(t=qe(n),r=qe(e),t||r)return t&&r?MA(n,e):!1;if(t=Nt(n),r=Nt(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!_c(n[o],e[o]))return!1}}return String(n)===String(e)}function Am(n,e){return n.findIndex(t=>_c(t,e))}const db=n=>!!(n&&n.__v_isRef===!0),re=n=>on(n)?n:n==null?"":qe(n)||Nt(n)&&(n.toString===lb||!et(n.toString))?db(n)?re(n.value):JSON.stringify(n,hb,2):String(n),hb=(n,e)=>db(e)?hb(n,e.value):za(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[$f(r,i)+" =>"]=s,t),{})}:xl(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>$f(t))}:zr(e)?$f(e):Nt(e)&&!qe(e)&&!ub(e)?String(e):e,$f=(n,e="")=>{var t;return zr(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let ur;class LA{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=ur,!e&&ur&&(this.index=(ur.scopes||(ur.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=ur;try{return ur=this,e()}finally{ur=t}}}on(){++this._on===1&&(this.prevScope=ur,ur=this)}off(){this._on>0&&--this._on===0&&(ur=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function $A(){return ur}let $t;const Ff=new WeakSet;class fb{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,ur&&ur.active&&ur.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Ff.has(this)&&(Ff.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||mb(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Jv(this),gb(this);const e=$t,t=jr;$t=this,jr=!0;try{return this.fn()}finally{vb(this),$t=e,jr=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Cm(e);this.deps=this.depsTail=void 0,Jv(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Ff.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Ip(this)&&this.run()}get dirty(){return Ip(this)}}let pb=0,Iu,Eu;function mb(n,e=!1){if(n.flags|=8,e){n.next=Eu,Eu=n;return}n.next=Iu,Iu=n}function Sm(){pb++}function Pm(){if(--pb>0)return;if(Eu){let e=Eu;for(Eu=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Iu;){let e=Iu;for(Iu=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function gb(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function vb(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),Cm(r),FA(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function Ip(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(yb(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function yb(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Fu)||(n.globalVersion=Fu,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!Ip(n))))return;n.flags|=2;const e=n.dep,t=$t,r=jr;$t=n,jr=!0;try{gb(n);const s=n.fn(n._value);(e.version===0||Fi(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{$t=t,jr=r,vb(n),n.flags&=-3}}function Cm(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)Cm(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function FA(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let jr=!0;const _b=[];function qs(){_b.push(jr),jr=!1}function zs(){const n=_b.pop();jr=n===void 0?!0:n}function Jv(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=$t;$t=void 0;try{e()}finally{$t=t}}}let Fu=0;class UA{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Rm{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!$t||!jr||$t===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==$t)t=this.activeLink=new UA($t,this),$t.deps?(t.prevDep=$t.depsTail,$t.depsTail.nextDep=t,$t.depsTail=t):$t.deps=$t.depsTail=t,bb(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=$t.depsTail,t.nextDep=void 0,$t.depsTail.nextDep=t,$t.depsTail=t,$t.deps===t&&($t.deps=r)}return t}trigger(e){this.version++,Fu++,this.notify(e)}notify(e){Sm();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Pm()}}}function bb(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)bb(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const Ep=new WeakMap,qo=Symbol(""),Tp=Symbol(""),Uu=Symbol("");function Kn(n,e,t){if(jr&&$t){let r=Ep.get(n);r||Ep.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new Rm),s.map=r,s.key=t),s.track()}}function Rs(n,e,t,r,s,i){const o=Ep.get(n);if(!o){Fu++;return}const a=l=>{l&&l.trigger()};if(Sm(),e==="clear")o.forEach(a);else{const l=qe(n),c=l&&Tm(t);if(l&&t==="length"){const h=Number(r);o.forEach((f,g)=>{(g==="length"||g===Uu||!zr(g)&&g>=h)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(Uu)),e){case"add":l?c&&a(o.get("length")):(a(o.get(qo)),za(n)&&a(o.get(Tp)));break;case"delete":l||(a(o.get(qo)),za(n)&&a(o.get(Tp)));break;case"set":za(n)&&a(o.get(qo));break}}Pm()}function ka(n){const e=wt(n);return e===n?e:(Kn(e,"iterate",Uu),Rr(n)?e:e.map(Ln))}function Ch(n){return Kn(n=wt(n),"iterate",Uu),n}const jA={__proto__:null,[Symbol.iterator](){return Uf(this,Symbol.iterator,Ln)},concat(...n){return ka(this).concat(...n.map(e=>qe(e)?ka(e):e))},entries(){return Uf(this,"entries",n=>(n[1]=Ln(n[1]),n))},every(n,e){return Ts(this,"every",n,e,void 0,arguments)},filter(n,e){return Ts(this,"filter",n,e,t=>t.map(Ln),arguments)},find(n,e){return Ts(this,"find",n,e,Ln,arguments)},findIndex(n,e){return Ts(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return Ts(this,"findLast",n,e,Ln,arguments)},findLastIndex(n,e){return Ts(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return Ts(this,"forEach",n,e,void 0,arguments)},includes(...n){return jf(this,"includes",n)},indexOf(...n){return jf(this,"indexOf",n)},join(n){return ka(this).join(n)},lastIndexOf(...n){return jf(this,"lastIndexOf",n)},map(n,e){return Ts(this,"map",n,e,void 0,arguments)},pop(){return ru(this,"pop")},push(...n){return ru(this,"push",n)},reduce(n,...e){return Yv(this,"reduce",n,e)},reduceRight(n,...e){return Yv(this,"reduceRight",n,e)},shift(){return ru(this,"shift")},some(n,e){return Ts(this,"some",n,e,void 0,arguments)},splice(...n){return ru(this,"splice",n)},toReversed(){return ka(this).toReversed()},toSorted(n){return ka(this).toSorted(n)},toSpliced(...n){return ka(this).toSpliced(...n)},unshift(...n){return ru(this,"unshift",n)},values(){return Uf(this,"values",Ln)}};function Uf(n,e,t){const r=Ch(n),s=r[e]();return r!==n&&!Rr(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const BA=Array.prototype;function Ts(n,e,t,r,s,i){const o=Ch(n),a=o!==n&&!Rr(n),l=o[e];if(l!==BA[e]){const f=l.apply(n,i);return a?Ln(f):f}let c=t;o!==n&&(a?c=function(f,g){return t.call(this,Ln(f),g,n)}:t.length>2&&(c=function(f,g){return t.call(this,f,g,n)}));const h=l.call(o,c,r);return a&&s?s(h):h}function Yv(n,e,t,r){const s=Ch(n);let i=t;return s!==n&&(Rr(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,Ln(a),l,n)}),s[e](i,...r)}function jf(n,e,t){const r=wt(n);Kn(r,"iterate",Uu);const s=r[e](...t);return(s===-1||s===!1)&&Nm(t[0])?(t[0]=wt(t[0]),r[e](...t)):s}function ru(n,e,t=[]){qs(),Sm();const r=wt(n)[e].apply(n,t);return Pm(),zs(),r}const qA=xm("__proto__,__v_isRef,__isVue"),wb=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(zr));function zA(n){zr(n)||(n=String(n));const e=wt(this);return Kn(e,"has",n),e.hasOwnProperty(n)}class xb{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?e1:Ab:i?Tb:Eb).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=qe(e);if(!s){let l;if(o&&(l=jA[t]))return l;if(t==="hasOwnProperty")return zA}const a=Reflect.get(e,t,Wn(e)?e:r);return(zr(t)?wb.has(t):qA(t))||(s||Kn(e,"get",t),i)?a:Wn(a)?o&&Tm(t)?a:a.value:Nt(a)?s?Pb(a):Rh(a):a}}class Ib extends xb{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=zi(i);if(!Rr(r)&&!zi(r)&&(i=wt(i),r=wt(r)),!qe(e)&&Wn(i)&&!Wn(r))return l?!1:(i.value=r,!0)}const o=qe(e)&&Tm(t)?Number(t)<e.length:At(e,t),a=Reflect.set(e,t,r,Wn(e)?e:s);return e===wt(s)&&(o?Fi(r,i)&&Rs(e,"set",t,r):Rs(e,"add",t,r)),a}deleteProperty(e,t){const r=At(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&Rs(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!zr(t)||!wb.has(t))&&Kn(e,"has",t),r}ownKeys(e){return Kn(e,"iterate",qe(e)?"length":qo),Reflect.ownKeys(e)}}class HA extends xb{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const KA=new Ib,GA=new HA,WA=new Ib(!0);const Ap=n=>n,ud=n=>Reflect.getPrototypeOf(n);function QA(n,e,t){return function(...r){const s=this.__v_raw,i=wt(s),o=za(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),h=t?Ap:e?Kd:Ln;return!e&&Kn(i,"iterate",l?Tp:qo),{next(){const{value:f,done:g}=c.next();return g?{value:f,done:g}:{value:a?[h(f[0]),h(f[1])]:h(f),done:g}},[Symbol.iterator](){return this}}}}function cd(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function JA(n,e){const t={get(s){const i=this.__v_raw,o=wt(i),a=wt(s);n||(Fi(s,a)&&Kn(o,"get",s),Kn(o,"get",a));const{has:l}=ud(o),c=e?Ap:n?Kd:Ln;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&Kn(wt(s),"iterate",qo),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=wt(i),a=wt(s);return n||(Fi(s,a)&&Kn(o,"has",s),Kn(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=wt(a),c=e?Ap:n?Kd:Ln;return!n&&Kn(l,"iterate",qo),a.forEach((h,f)=>s.call(i,c(h),c(f),o))}};return _n(t,n?{add:cd("add"),set:cd("set"),delete:cd("delete"),clear:cd("clear")}:{add(s){!e&&!Rr(s)&&!zi(s)&&(s=wt(s));const i=wt(this);return ud(i).has.call(i,s)||(i.add(s),Rs(i,"add",s,s)),this},set(s,i){!e&&!Rr(i)&&!zi(i)&&(i=wt(i));const o=wt(this),{has:a,get:l}=ud(o);let c=a.call(o,s);c||(s=wt(s),c=a.call(o,s));const h=l.call(o,s);return o.set(s,i),c?Fi(i,h)&&Rs(o,"set",s,i):Rs(o,"add",s,i),this},delete(s){const i=wt(this),{has:o,get:a}=ud(i);let l=o.call(i,s);l||(s=wt(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&Rs(i,"delete",s,void 0),c},clear(){const s=wt(this),i=s.size!==0,o=s.clear();return i&&Rs(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=QA(s,n,e)}),t}function km(n,e){const t=JA(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(At(t,s)&&s in r?t:r,s,i)}const YA={get:km(!1,!1)},XA={get:km(!1,!0)},ZA={get:km(!0,!1)};const Eb=new WeakMap,Tb=new WeakMap,Ab=new WeakMap,e1=new WeakMap;function t1(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function n1(n){return n.__v_skip||!Object.isExtensible(n)?0:t1(AA(n))}function Rh(n){return zi(n)?n:Dm(n,!1,KA,YA,Eb)}function Sb(n){return Dm(n,!1,WA,XA,Tb)}function Pb(n){return Dm(n,!0,GA,ZA,Ab)}function Dm(n,e,t,r,s){if(!Nt(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=n1(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function Ha(n){return zi(n)?Ha(n.__v_raw):!!(n&&n.__v_isReactive)}function zi(n){return!!(n&&n.__v_isReadonly)}function Rr(n){return!!(n&&n.__v_isShallow)}function Nm(n){return n?!!n.__v_raw:!1}function wt(n){const e=n&&n.__v_raw;return e?wt(e):n}function r1(n){return!At(n,"__v_skip")&&Object.isExtensible(n)&&xp(n,"__v_skip",!0),n}const Ln=n=>Nt(n)?Rh(n):n,Kd=n=>Nt(n)?Pb(n):n;function Wn(n){return n?n.__v_isRef===!0:!1}function C(n){return Cb(n,!1)}function s1(n){return Cb(n,!0)}function Cb(n,e){return Wn(n)?n:new i1(n,e)}class i1{constructor(e,t){this.dep=new Rm,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:wt(e),this._value=t?e:Ln(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Rr(e)||zi(e);e=r?e:wt(e),Fi(e,t)&&(this._rawValue=e,this._value=r?e:Ln(e),this.dep.trigger())}}function Br(n){return Wn(n)?n.value:n}const o1={get:(n,e,t)=>e==="__v_raw"?n:Br(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return Wn(s)&&!Wn(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function Rb(n){return Ha(n)?n:new Proxy(n,o1)}class a1{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Rm(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Fu-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&$t!==this)return mb(this,!0),!0}get value(){const e=this.dep.track();return yb(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function l1(n,e,t=!1){let r,s;return et(n)?r=n:(r=n.get,s=n.set),new a1(r,s,t)}const dd={},Gd=new WeakMap;let Ro;function u1(n,e=!1,t=Ro){if(t){let r=Gd.get(t);r||Gd.set(t,r=[]),r.push(n)}}function c1(n,e,t=Dt){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=$=>s?$:Rr($)||s===!1||s===0?ks($,1):ks($);let h,f,g,v,I=!1,T=!1;if(Wn(n)?(f=()=>n.value,I=Rr(n)):Ha(n)?(f=()=>c(n),I=!0):qe(n)?(T=!0,I=n.some($=>Ha($)||Rr($)),f=()=>n.map($=>{if(Wn($))return $.value;if(Ha($))return c($);if(et($))return l?l($,2):$()})):et(n)?e?f=l?()=>l(n,2):n:f=()=>{if(g){qs();try{g()}finally{zs()}}const $=Ro;Ro=h;try{return l?l(n,3,[v]):n(v)}finally{Ro=$}}:f=Ur,e&&s){const $=f,ue=s===!0?1/0:s;f=()=>ks($(),ue)}const A=$A(),F=()=>{h.stop(),A&&A.active&&Em(A.effects,h)};if(i&&e){const $=e;e=(...ue)=>{$(...ue),F()}}let U=T?new Array(n.length).fill(dd):dd;const L=$=>{if(!(!(h.flags&1)||!h.dirty&&!$))if(e){const ue=h.run();if(s||I||(T?ue.some((se,E)=>Fi(se,U[E])):Fi(ue,U))){g&&g();const se=Ro;Ro=h;try{const E=[ue,U===dd?void 0:T&&U[0]===dd?[]:U,v];U=ue,l?l(e,3,E):e(...E)}finally{Ro=se}}}else h.run()};return a&&a(L),h=new fb(f),h.scheduler=o?()=>o(L,!1):L,v=$=>u1($,!1,h),g=h.onStop=()=>{const $=Gd.get(h);if($){if(l)l($,4);else for(const ue of $)ue();Gd.delete(h)}},e?r?L(!0):U=h.run():o?o(L.bind(null,!0),!0):h.run(),F.pause=h.pause.bind(h),F.resume=h.resume.bind(h),F.stop=F,F}function ks(n,e=1/0,t){if(e<=0||!Nt(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,Wn(n))ks(n.value,e,t);else if(qe(n))for(let r=0;r<n.length;r++)ks(n[r],e,t);else if(xl(n)||za(n))n.forEach(r=>{ks(r,e,t)});else if(ub(n)){for(const r in n)ks(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&ks(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function bc(n,e,t,r){try{return r?n(...r):n()}catch(s){kh(s,e,t)}}function Hr(n,e,t,r){if(et(n)){const s=bc(n,e,t,r);return s&&ab(s)&&s.catch(i=>{kh(i,e,t)}),s}if(qe(n)){const s=[];for(let i=0;i<n.length;i++)s.push(Hr(n[i],e,t,r));return s}}function kh(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||Dt;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const h=a.ec;if(h){for(let f=0;f<h.length;f++)if(h[f](n,l,c)===!1)return}a=a.parent}if(i){qs(),bc(i,null,10,[n,l,c]),zs();return}}d1(n,t,s,r,o)}function d1(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const er=[];let rs=-1;const Ka=[];let Ei=null,Ma=0;const kb=Promise.resolve();let Wd=null;function Gt(n){const e=Wd||kb;return n?e.then(this?n.bind(this):n):e}function h1(n){let e=rs+1,t=er.length;for(;e<t;){const r=e+t>>>1,s=er[r],i=ju(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function Vm(n){if(!(n.flags&1)){const e=ju(n),t=er[er.length-1];!t||!(n.flags&2)&&e>=ju(t)?er.push(n):er.splice(h1(e),0,n),n.flags|=1,Db()}}function Db(){Wd||(Wd=kb.then(Vb))}function f1(n){qe(n)?Ka.push(...n):Ei&&n.id===-1?Ei.splice(Ma+1,0,n):n.flags&1||(Ka.push(n),n.flags|=1),Db()}function Xv(n,e,t=rs+1){for(;t<er.length;t++){const r=er[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;er.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function Nb(n){if(Ka.length){const e=[...new Set(Ka)].sort((t,r)=>ju(t)-ju(r));if(Ka.length=0,Ei){Ei.push(...e);return}for(Ei=e,Ma=0;Ma<Ei.length;Ma++){const t=Ei[Ma];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Ei=null,Ma=0}}const ju=n=>n.id==null?n.flags&2?-1:1/0:n.id;function Vb(n){const e=Ur;try{for(rs=0;rs<er.length;rs++){const t=er[rs];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),bc(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;rs<er.length;rs++){const t=er[rs];t&&(t.flags&=-2)}rs=-1,er.length=0,Nb(),Wd=null,(er.length||Ka.length)&&Vb()}}let Rn=null,Ob=null;function Qd(n){const e=Rn;return Rn=n,Ob=n&&n.type.__scopeId||null,e}function Td(n,e=Rn,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&dy(-1);const i=Qd(e);let o;try{o=n(...s)}finally{Qd(i),r._d&&dy(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function ut(n,e){if(Rn===null)return n;const t=Mh(Rn),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=Dt]=e[s];i&&(et(i)&&(i={mounted:i,updated:i}),i.deep&&ks(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function To(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(qs(),Hr(l,t,8,[n.el,a,n,e]),zs())}}const Mb=Symbol("_vte"),Lb=n=>n.__isTeleport,Tu=n=>n&&(n.disabled||n.disabled===""),Zv=n=>n&&(n.defer||n.defer===""),ey=n=>typeof SVGElement<"u"&&n instanceof SVGElement,ty=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,Sp=(n,e)=>{const t=n&&n.to;return on(t)?e?e(t):null:t},$b={name:"Teleport",__isTeleport:!0,process(n,e,t,r,s,i,o,a,l,c){const{mc:h,pc:f,pbc:g,o:{insert:v,querySelector:I,createText:T,createComment:A}}=c,F=Tu(e.props);let{shapeFlag:U,children:L,dynamicChildren:$}=e;if(n==null){const ue=e.el=T(""),se=e.anchor=T("");v(ue,t,r),v(se,t,r);const E=(x,R)=>{U&16&&(s&&s.isCE&&(s.ce._teleportTarget=x),h(L,x,R,s,i,o,a,l))},_=()=>{const x=e.target=Sp(e.props,I),R=Fb(x,e,T,v);x&&(o!=="svg"&&ey(x)?o="svg":o!=="mathml"&&ty(x)&&(o="mathml"),F||(E(x,R),Ad(e,!1)))};F&&(E(t,se),Ad(e,!0)),Zv(e.props)?(e.el.__isMounted=!1,Zn(()=>{_(),delete e.el.__isMounted},i)):_()}else{if(Zv(e.props)&&n.el.__isMounted===!1){Zn(()=>{$b.process(n,e,t,r,s,i,o,a,l,c)},i);return}e.el=n.el,e.targetStart=n.targetStart;const ue=e.anchor=n.anchor,se=e.target=n.target,E=e.targetAnchor=n.targetAnchor,_=Tu(n.props),x=_?t:se,R=_?ue:E;if(o==="svg"||ey(se)?o="svg":(o==="mathml"||ty(se))&&(o="mathml"),$?(g(n.dynamicChildren,$,x,s,i,o,a),Fm(n,e,!0)):l||f(n,e,x,R,s,i,o,a,!1),F)_?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):hd(e,t,ue,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const M=e.target=Sp(e.props,I);M&&hd(e,M,null,c,0)}else _&&hd(e,se,E,c,1);Ad(e,F)}},remove(n,e,t,{um:r,o:{remove:s}},i){const{shapeFlag:o,children:a,anchor:l,targetStart:c,targetAnchor:h,target:f,props:g}=n;if(f&&(s(c),s(h)),i&&s(l),o&16){const v=i||!Tu(g);for(let I=0;I<a.length;I++){const T=a[I];r(T,e,t,v,!!T.dynamicChildren)}}},move:hd,hydrate:p1};function hd(n,e,t,{o:{insert:r},m:s},i=2){i===0&&r(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:h}=n,f=i===2;if(f&&r(o,e,t),(!f||Tu(h))&&l&16)for(let g=0;g<c.length;g++)s(c[g],e,t,2);f&&r(a,e,t)}function p1(n,e,t,r,s,i,{o:{nextSibling:o,parentNode:a,querySelector:l,insert:c,createText:h}},f){const g=e.target=Sp(e.props,l);if(g){const v=Tu(e.props),I=g._lpa||g.firstChild;if(e.shapeFlag&16)if(v)e.anchor=f(o(n),e,a(n),t,r,s,i),e.targetStart=I,e.targetAnchor=I&&o(I);else{e.anchor=o(n);let T=I;for(;T;){if(T&&T.nodeType===8){if(T.data==="teleport start anchor")e.targetStart=T;else if(T.data==="teleport anchor"){e.targetAnchor=T,g._lpa=e.targetAnchor&&o(e.targetAnchor);break}}T=o(T)}e.targetAnchor||Fb(g,e,h,c),f(I&&o(I),e,g,t,r,s,i)}Ad(e,v)}return e.anchor&&o(e.anchor)}const Bu=$b;function Ad(n,e){const t=n.ctx;if(t&&t.ut){let r,s;for(e?(r=n.el,s=n.anchor):(r=n.targetStart,s=n.targetAnchor);r&&r!==s;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function Fb(n,e,t,r){const s=e.targetStart=t(""),i=e.targetAnchor=t("");return s[Mb]=i,n&&(r(s,n),r(i,n)),i}const Ti=Symbol("_leaveCb"),fd=Symbol("_enterCb");function m1(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return pn(()=>{n.isMounted=!0}),Om(()=>{n.isUnmounting=!0}),n}const Cr=[Function,Array],Ub={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Cr,onEnter:Cr,onAfterEnter:Cr,onEnterCancelled:Cr,onBeforeLeave:Cr,onLeave:Cr,onAfterLeave:Cr,onLeaveCancelled:Cr,onBeforeAppear:Cr,onAppear:Cr,onAfterAppear:Cr,onAppearCancelled:Cr},jb=n=>{const e=n.subTree;return e.component?jb(e.component):e},g1={name:"BaseTransition",props:Ub,setup(n,{slots:e}){const t=fS(),r=m1();return()=>{const s=e.default&&zb(e.default(),!0);if(!s||!s.length)return;const i=Bb(s),o=wt(n),{mode:a}=o;if(r.isLeaving)return Bf(i);const l=ny(i);if(!l)return Bf(i);let c=Pp(l,o,r,t,f=>c=f);l.type!==Gn&&qu(l,c);let h=t.subTree&&ny(t.subTree);if(h&&h.type!==Gn&&!Oo(l,h)&&jb(t).type!==Gn){let f=Pp(h,o,r,t);if(qu(h,f),a==="out-in"&&l.type!==Gn)return r.isLeaving=!0,f.afterLeave=()=>{r.isLeaving=!1,t.job.flags&8||t.update(),delete f.afterLeave,h=void 0},Bf(i);a==="in-out"&&l.type!==Gn?f.delayLeave=(g,v,I)=>{const T=qb(r,h);T[String(h.key)]=h,g[Ti]=()=>{v(),g[Ti]=void 0,delete c.delayedLeave,h=void 0},c.delayedLeave=()=>{I(),delete c.delayedLeave,h=void 0}}:h=void 0}else h&&(h=void 0);return i}}};function Bb(n){let e=n[0];if(n.length>1){for(const t of n)if(t.type!==Gn){e=t;break}}return e}const v1=g1;function qb(n,e){const{leavingVNodes:t}=n;let r=t.get(e.type);return r||(r=Object.create(null),t.set(e.type,r)),r}function Pp(n,e,t,r,s){const{appear:i,mode:o,persisted:a=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:h,onEnterCancelled:f,onBeforeLeave:g,onLeave:v,onAfterLeave:I,onLeaveCancelled:T,onBeforeAppear:A,onAppear:F,onAfterAppear:U,onAppearCancelled:L}=e,$=String(n.key),ue=qb(t,n),se=(x,R)=>{x&&Hr(x,r,9,R)},E=(x,R)=>{const M=R[1];se(x,R),qe(x)?x.every(k=>k.length<=1)&&M():x.length<=1&&M()},_={mode:o,persisted:a,beforeEnter(x){let R=l;if(!t.isMounted)if(i)R=A||l;else return;x[Ti]&&x[Ti](!0);const M=ue[$];M&&Oo(n,M)&&M.el[Ti]&&M.el[Ti](),se(R,[x])},enter(x){let R=c,M=h,k=f;if(!t.isMounted)if(i)R=F||c,M=U||h,k=L||f;else return;let P=!1;const Qe=x[fd]=nt=>{P||(P=!0,nt?se(k,[x]):se(M,[x]),_.delayedLeave&&_.delayedLeave(),x[fd]=void 0)};R?E(R,[x,Qe]):Qe()},leave(x,R){const M=String(n.key);if(x[fd]&&x[fd](!0),t.isUnmounting)return R();se(g,[x]);let k=!1;const P=x[Ti]=Qe=>{k||(k=!0,R(),Qe?se(T,[x]):se(I,[x]),x[Ti]=void 0,ue[M]===n&&delete ue[M])};ue[M]=n,v?E(v,[x,P]):P()},clone(x){const R=Pp(x,e,t,r,s);return s&&s(R),R}};return _}function Bf(n){if(Dh(n))return n=Hi(n),n.children=null,n}function ny(n){if(!Dh(n))return Lb(n.type)&&n.children?Bb(n.children):n;if(n.component)return n.component.subTree;const{shapeFlag:e,children:t}=n;if(t){if(e&16)return t[0];if(e&32&&et(t.default))return t.default()}}function qu(n,e){n.shapeFlag&6&&n.component?(n.transition=e,qu(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function zb(n,e=!1,t){let r=[],s=0;for(let i=0;i<n.length;i++){let o=n[i];const a=t==null?o.key:String(t)+String(o.key!=null?o.key:i);o.type===it?(o.patchFlag&128&&s++,r=r.concat(zb(o.children,e,a))):(e||o.type!==Gn)&&r.push(a!=null?Hi(o,{key:a}):o)}if(s>1)for(let i=0;i<r.length;i++)r[i].patchFlag=-2;return r}/*! #__NO_SIDE_EFFECTS__ */function Hb(n,e){return et(n)?(()=>_n({name:n.name},e,{setup:n}))():n}function Kb(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function Au(n,e,t,r,s=!1){if(qe(n)){n.forEach((I,T)=>Au(I,e&&(qe(e)?e[T]:e),t,r,s));return}if(Ga(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&Au(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?Mh(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,h=a.refs===Dt?a.refs={}:a.refs,f=a.setupState,g=wt(f),v=f===Dt?()=>!1:I=>At(g,I);if(c!=null&&c!==l&&(on(c)?(h[c]=null,v(c)&&(f[c]=null)):Wn(c)&&(c.value=null)),et(l))bc(l,a,12,[o,h]);else{const I=on(l),T=Wn(l);if(I||T){const A=()=>{if(n.f){const F=I?v(l)?f[l]:h[l]:l.value;s?qe(F)&&Em(F,i):qe(F)?F.includes(i)||F.push(i):I?(h[l]=[i],v(l)&&(f[l]=h[l])):(l.value=[i],n.k&&(h[n.k]=l.value))}else I?(h[l]=o,v(l)&&(f[l]=o)):T&&(l.value=o,n.k&&(h[n.k]=o))};o?(A.id=-1,Zn(A,t)):A()}}}Ph().requestIdleCallback;Ph().cancelIdleCallback;const Ga=n=>!!n.type.__asyncLoader,Dh=n=>n.type.__isKeepAlive;function y1(n,e){Gb(n,"a",e)}function _1(n,e){Gb(n,"da",e)}function Gb(n,e,t=$n){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(Nh(e,r,t),t){let s=t.parent;for(;s&&s.parent;)Dh(s.parent.vnode)&&b1(r,e,t,s),s=s.parent}}function b1(n,e,t,r){const s=Nh(e,n,r,!0);Ls(()=>{Em(r[e],s)},t)}function Nh(n,e,t=$n,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{qs();const a=wc(t),l=Hr(e,t,n,o);return a(),zs(),l});return r?s.unshift(i):s.push(i),i}}const Xs=n=>(e,t=$n)=>{(!Ku||n==="sp")&&Nh(n,(...r)=>e(...r),t)},w1=Xs("bm"),pn=Xs("m"),x1=Xs("bu"),I1=Xs("u"),Om=Xs("bum"),Ls=Xs("um"),E1=Xs("sp"),T1=Xs("rtg"),A1=Xs("rtc");function S1(n,e=$n){Nh("ec",n,e)}const Wb="components";function P1(n,e){return R1(Wb,n,!0,e)||n}const C1=Symbol.for("v-ndc");function R1(n,e,t=!0,r=!1){const s=Rn||$n;if(s){const i=s.type;if(n===Wb){const a=yS(i,!1);if(a&&(a===e||a===Dr(e)||a===Sh(Dr(e))))return i}const o=ry(s[n]||i[n],e)||ry(s.appContext[n],e);return!o&&r?i:o}}function ry(n,e){return n&&(n[e]||n[Dr(e)]||n[Sh(Dr(e))])}function wr(n,e,t,r){let s;const i=t&&t[r],o=qe(n);if(o||on(n)){const a=o&&Ha(n);let l=!1,c=!1;a&&(l=!Rr(n),c=zi(n),n=Ch(n)),s=new Array(n.length);for(let h=0,f=n.length;h<f;h++)s[h]=e(l?c?Kd(Ln(n[h])):Ln(n[h]):n[h],h,void 0,i&&i[h])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(Nt(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const h=a[l];s[l]=e(n[h],h,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}function k1(n,e,t={},r,s){if(Rn.ce||Rn.parent&&Ga(Rn.parent)&&Rn.parent.ce)return e!=="default"&&(t.name=e),D(),$s(it,null,[Ke("slot",t,r&&r())],64);let i=n[e];i&&i._c&&(i._d=!1),D();const o=i&&Qb(i(t)),a=t.key||o&&o.key,l=$s(it,{key:(a&&!zr(a)?a:`_${e}`)+(!o&&r?"_fb":"")},o||(r?r():[]),o&&n._===1?64:-2);return!s&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),i&&i._c&&(i._d=!0),l}function Qb(n){return n.some(e=>Hu(e)?!(e.type===Gn||e.type===it&&!Qb(e.children)):!0)?n:null}const Cp=n=>n?fw(n)?Mh(n):Cp(n.parent):null,Su=_n(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Cp(n.parent),$root:n=>Cp(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>Mm(n),$forceUpdate:n=>n.f||(n.f=()=>{Vm(n.update)}),$nextTick:n=>n.n||(n.n=Gt.bind(n.proxy)),$watch:n=>X1.bind(n)}),qf=(n,e)=>n!==Dt&&!n.__isScriptSetup&&At(n,e),D1={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const v=o[e];if(v!==void 0)switch(v){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(qf(r,e))return o[e]=1,r[e];if(s!==Dt&&At(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&At(c,e))return o[e]=3,i[e];if(t!==Dt&&At(t,e))return o[e]=4,t[e];Rp&&(o[e]=0)}}const h=Su[e];let f,g;if(h)return e==="$attrs"&&Kn(n.attrs,"get",""),h(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==Dt&&At(t,e))return o[e]=4,t[e];if(g=l.config.globalProperties,At(g,e))return g[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return qf(s,e)?(s[e]=t,!0):r!==Dt&&At(r,e)?(r[e]=t,!0):At(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==Dt&&At(n,o)||qf(e,o)||(a=i[0])&&At(a,o)||At(r,o)||At(Su,o)||At(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:At(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function sy(n){return qe(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let Rp=!0;function N1(n){const e=Mm(n),t=n.proxy,r=n.ctx;Rp=!1,e.beforeCreate&&iy(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:h,beforeMount:f,mounted:g,beforeUpdate:v,updated:I,activated:T,deactivated:A,beforeDestroy:F,beforeUnmount:U,destroyed:L,unmounted:$,render:ue,renderTracked:se,renderTriggered:E,errorCaptured:_,serverPrefetch:x,expose:R,inheritAttrs:M,components:k,directives:P,filters:Qe}=e;if(c&&V1(c,r,null),o)for(const ne in o){const ae=o[ne];et(ae)&&(r[ne]=ae.bind(t))}if(s){const ne=s.call(t,t);Nt(ne)&&(n.data=Rh(ne))}if(Rp=!0,i)for(const ne in i){const ae=i[ne],ie=et(ae)?ae.bind(t,t):et(ae.get)?ae.get.bind(t,t):Ur,ke=!et(ae)&&et(ae.set)?ae.set.bind(t):Ur,Z=Fe({get:ie,set:ke});Object.defineProperty(r,ne,{enumerable:!0,configurable:!0,get:()=>Z.value,set:Q=>Z.value=Q})}if(a)for(const ne in a)Jb(a[ne],r,t,ne);if(l){const ne=et(l)?l.call(t):l;Reflect.ownKeys(ne).forEach(ae=>{Sd(ae,ne[ae])})}h&&iy(h,n,"c");function be(ne,ae){qe(ae)?ae.forEach(ie=>ne(ie.bind(t))):ae&&ne(ae.bind(t))}if(be(w1,f),be(pn,g),be(x1,v),be(I1,I),be(y1,T),be(_1,A),be(S1,_),be(A1,se),be(T1,E),be(Om,U),be(Ls,$),be(E1,x),qe(R))if(R.length){const ne=n.exposed||(n.exposed={});R.forEach(ae=>{Object.defineProperty(ne,ae,{get:()=>t[ae],set:ie=>t[ae]=ie})})}else n.exposed||(n.exposed={});ue&&n.render===Ur&&(n.render=ue),M!=null&&(n.inheritAttrs=M),k&&(n.components=k),P&&(n.directives=P),x&&Kb(n)}function V1(n,e,t=Ur){qe(n)&&(n=kp(n));for(const r in n){const s=n[r];let i;Nt(s)?"default"in s?i=qr(s.from||r,s.default,!0):i=qr(s.from||r):i=qr(s),Wn(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function iy(n,e,t){Hr(qe(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function Jb(n,e,t,r){let s=r.includes(".")?lw(t,r):()=>t[r];if(on(n)){const i=e[n];et(i)&&bt(s,i)}else if(et(n))bt(s,n.bind(t));else if(Nt(n))if(qe(n))n.forEach(i=>Jb(i,e,t,r));else{const i=et(n.handler)?n.handler.bind(t):e[n.handler];et(i)&&bt(s,i,n)}}function Mm(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>Jd(l,c,o,!0)),Jd(l,e,o)),Nt(e)&&i.set(e,l),l}function Jd(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&Jd(n,i,t,!0),s&&s.forEach(o=>Jd(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=O1[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const O1={data:oy,props:ay,emits:ay,methods:pu,computed:pu,beforeCreate:Xn,created:Xn,beforeMount:Xn,mounted:Xn,beforeUpdate:Xn,updated:Xn,beforeDestroy:Xn,beforeUnmount:Xn,destroyed:Xn,unmounted:Xn,activated:Xn,deactivated:Xn,errorCaptured:Xn,serverPrefetch:Xn,components:pu,directives:pu,watch:L1,provide:oy,inject:M1};function oy(n,e){return e?n?function(){return _n(et(n)?n.call(this,this):n,et(e)?e.call(this,this):e)}:e:n}function M1(n,e){return pu(kp(n),kp(e))}function kp(n){if(qe(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Xn(n,e){return n?[...new Set([].concat(n,e))]:e}function pu(n,e){return n?_n(Object.create(null),n,e):e}function ay(n,e){return n?qe(n)&&qe(e)?[...new Set([...n,...e])]:_n(Object.create(null),sy(n),sy(e??{})):e}function L1(n,e){if(!n)return e;if(!e)return n;const t=_n(Object.create(null),n);for(const r in e)t[r]=Xn(n[r],e[r]);return t}function Yb(){return{app:null,config:{isNativeTag:EA,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let $1=0;function F1(n,e){return function(r,s=null){et(r)||(r=_n({},r)),s!=null&&!Nt(s)&&(s=null);const i=Yb(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:$1++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:bS,get config(){return i.config},set config(h){},use(h,...f){return o.has(h)||(h&&et(h.install)?(o.add(h),h.install(c,...f)):et(h)&&(o.add(h),h(c,...f))),c},mixin(h){return i.mixins.includes(h)||i.mixins.push(h),c},component(h,f){return f?(i.components[h]=f,c):i.components[h]},directive(h,f){return f?(i.directives[h]=f,c):i.directives[h]},mount(h,f,g){if(!l){const v=c._ceVNode||Ke(r,s);return v.appContext=i,g===!0?g="svg":g===!1&&(g=void 0),f&&e?e(v,h):n(v,h,g),l=!0,c._container=h,h.__vue_app__=c,Mh(v.component)}},onUnmount(h){a.push(h)},unmount(){l&&(Hr(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(h,f){return i.provides[h]=f,c},runWithContext(h){const f=Wa;Wa=c;try{return h()}finally{Wa=f}}};return c}}let Wa=null;function Sd(n,e){if($n){let t=$n.provides;const r=$n.parent&&$n.parent.provides;r===t&&(t=$n.provides=Object.create(r)),t[n]=e}}function qr(n,e,t=!1){const r=$n||Rn;if(r||Wa){let s=Wa?Wa._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&et(e)?e.call(r&&r.proxy):e}}const Xb={},Zb=()=>Object.create(Xb),ew=n=>Object.getPrototypeOf(n)===Xb;function U1(n,e,t,r=!1){const s={},i=Zb();n.propsDefaults=Object.create(null),tw(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:Sb(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function j1(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=wt(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let f=0;f<h.length;f++){let g=h[f];if(Vh(n.emitsOptions,g))continue;const v=e[g];if(l)if(At(i,g))v!==i[g]&&(i[g]=v,c=!0);else{const I=Dr(g);s[I]=Dp(l,a,I,v,n,!1)}else v!==i[g]&&(i[g]=v,c=!0)}}}else{tw(n,e,s,i)&&(c=!0);let h;for(const f in a)(!e||!At(e,f)&&((h=to(f))===f||!At(e,h)))&&(l?t&&(t[f]!==void 0||t[h]!==void 0)&&(s[f]=Dp(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!At(e,f))&&(delete i[f],c=!0)}c&&Rs(n.attrs,"set","")}function tw(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(xu(l))continue;const c=e[l];let h;s&&At(s,h=Dr(l))?!i||!i.includes(h)?t[h]=c:(a||(a={}))[h]=c:Vh(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=wt(t),c=a||Dt;for(let h=0;h<i.length;h++){const f=i[h];t[f]=Dp(s,l,f,c[f],n,!At(c,f))}}return o}function Dp(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=At(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&et(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const h=wc(s);r=c[t]=l.call(null,e),h()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===to(t))&&(r=!0))}return r}const B1=new WeakMap;function nw(n,e,t=!1){const r=t?B1:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!et(n)){const h=f=>{l=!0;const[g,v]=nw(f,e,!0);_n(o,g),v&&a.push(...v)};!t&&e.mixins.length&&e.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!i&&!l)return Nt(n)&&r.set(n,qa),qa;if(qe(i))for(let h=0;h<i.length;h++){const f=Dr(i[h]);ly(f)&&(o[f]=Dt)}else if(i)for(const h in i){const f=Dr(h);if(ly(f)){const g=i[h],v=o[f]=qe(g)||et(g)?{type:g}:_n({},g),I=v.type;let T=!1,A=!0;if(qe(I))for(let F=0;F<I.length;++F){const U=I[F],L=et(U)&&U.name;if(L==="Boolean"){T=!0;break}else L==="String"&&(A=!1)}else T=et(I)&&I.name==="Boolean";v[0]=T,v[1]=A,(T||At(v,"default"))&&a.push(f)}}const c=[o,a];return Nt(n)&&r.set(n,c),c}function ly(n){return n[0]!=="$"&&!xu(n)}const Lm=n=>n[0]==="_"||n==="$stable",$m=n=>qe(n)?n.map(ss):[ss(n)],q1=(n,e,t)=>{if(e._n)return e;const r=Td((...s)=>$m(e(...s)),t);return r._c=!1,r},rw=(n,e,t)=>{const r=n._ctx;for(const s in n){if(Lm(s))continue;const i=n[s];if(et(i))e[s]=q1(s,i,r);else if(i!=null){const o=$m(i);e[s]=()=>o}}},sw=(n,e)=>{const t=$m(e);n.slots.default=()=>t},iw=(n,e,t)=>{for(const r in e)(t||!Lm(r))&&(n[r]=e[r])},z1=(n,e,t)=>{const r=n.slots=Zb();if(n.vnode.shapeFlag&32){const s=e.__;s&&xp(r,"__",s,!0);const i=e._;i?(iw(r,e,t),t&&xp(r,"_",i,!0)):rw(e,r)}else e&&sw(n,e)},H1=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=Dt;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:iw(s,e,t):(i=!e.$stable,rw(e,s)),o=e}else e&&(sw(n,e),o={default:1});if(i)for(const a in s)!Lm(a)&&o[a]==null&&delete s[a]},Zn=iS;function K1(n){return G1(n)}function G1(n,e){const t=Ph();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:h,parentNode:f,nextSibling:g,setScopeId:v=Ur,insertStaticContent:I}=n,T=(S,N,K,G=null,te=null,de=null,we=void 0,_e=null,Ie=!!N.dynamicChildren)=>{if(S===N)return;S&&!Oo(S,N)&&(G=X(S),Q(S,te,de,!0),S=null),N.patchFlag===-2&&(Ie=!1,N.dynamicChildren=null);const{type:ye,ref:$e,shapeFlag:Re}=N;switch(ye){case Oh:A(S,N,K,G);break;case Gn:F(S,N,K,G);break;case Pd:S==null&&U(N,K,G,we);break;case it:k(S,N,K,G,te,de,we,_e,Ie);break;default:Re&1?ue(S,N,K,G,te,de,we,_e,Ie):Re&6?P(S,N,K,G,te,de,we,_e,Ie):(Re&64||Re&128)&&ye.process(S,N,K,G,te,de,we,_e,Ie,Ve)}$e!=null&&te?Au($e,S&&S.ref,de,N||S,!N):$e==null&&S&&S.ref!=null&&Au(S.ref,null,de,S,!0)},A=(S,N,K,G)=>{if(S==null)r(N.el=a(N.children),K,G);else{const te=N.el=S.el;N.children!==S.children&&c(te,N.children)}},F=(S,N,K,G)=>{S==null?r(N.el=l(N.children||""),K,G):N.el=S.el},U=(S,N,K,G)=>{[S.el,S.anchor]=I(S.children,N,K,G,S.el,S.anchor)},L=({el:S,anchor:N},K,G)=>{let te;for(;S&&S!==N;)te=g(S),r(S,K,G),S=te;r(N,K,G)},$=({el:S,anchor:N})=>{let K;for(;S&&S!==N;)K=g(S),s(S),S=K;s(N)},ue=(S,N,K,G,te,de,we,_e,Ie)=>{N.type==="svg"?we="svg":N.type==="math"&&(we="mathml"),S==null?se(N,K,G,te,de,we,_e,Ie):x(S,N,te,de,we,_e,Ie)},se=(S,N,K,G,te,de,we,_e)=>{let Ie,ye;const{props:$e,shapeFlag:Re,transition:q,dirs:j}=S;if(Ie=S.el=o(S.type,de,$e&&$e.is,$e),Re&8?h(Ie,S.children):Re&16&&_(S.children,Ie,null,G,te,zf(S,de),we,_e),j&&To(S,null,G,"created"),E(Ie,S,S.scopeId,we,G),$e){for(const he in $e)he!=="value"&&!xu(he)&&i(Ie,he,null,$e[he],de,G);"value"in $e&&i(Ie,"value",null,$e.value,de),(ye=$e.onVnodeBeforeMount)&&ns(ye,G,S)}j&&To(S,null,G,"beforeMount");const ge=W1(te,q);ge&&q.beforeEnter(Ie),r(Ie,N,K),((ye=$e&&$e.onVnodeMounted)||ge||j)&&Zn(()=>{ye&&ns(ye,G,S),ge&&q.enter(Ie),j&&To(S,null,G,"mounted")},te)},E=(S,N,K,G,te)=>{if(K&&v(S,K),G)for(let de=0;de<G.length;de++)v(S,G[de]);if(te){let de=te.subTree;if(N===de||cw(de.type)&&(de.ssContent===N||de.ssFallback===N)){const we=te.vnode;E(S,we,we.scopeId,we.slotScopeIds,te.parent)}}},_=(S,N,K,G,te,de,we,_e,Ie=0)=>{for(let ye=Ie;ye<S.length;ye++){const $e=S[ye]=_e?Ai(S[ye]):ss(S[ye]);T(null,$e,N,K,G,te,de,we,_e)}},x=(S,N,K,G,te,de,we)=>{const _e=N.el=S.el;let{patchFlag:Ie,dynamicChildren:ye,dirs:$e}=N;Ie|=S.patchFlag&16;const Re=S.props||Dt,q=N.props||Dt;let j;if(K&&Ao(K,!1),(j=q.onVnodeBeforeUpdate)&&ns(j,K,N,S),$e&&To(N,S,K,"beforeUpdate"),K&&Ao(K,!0),(Re.innerHTML&&q.innerHTML==null||Re.textContent&&q.textContent==null)&&h(_e,""),ye?R(S.dynamicChildren,ye,_e,K,G,zf(N,te),de):we||ae(S,N,_e,null,K,G,zf(N,te),de,!1),Ie>0){if(Ie&16)M(_e,Re,q,K,te);else if(Ie&2&&Re.class!==q.class&&i(_e,"class",null,q.class,te),Ie&4&&i(_e,"style",Re.style,q.style,te),Ie&8){const ge=N.dynamicProps;for(let he=0;he<ge.length;he++){const De=ge[he],We=Re[De],Ze=q[De];(Ze!==We||De==="value")&&i(_e,De,We,Ze,te,K)}}Ie&1&&S.children!==N.children&&h(_e,N.children)}else!we&&ye==null&&M(_e,Re,q,K,te);((j=q.onVnodeUpdated)||$e)&&Zn(()=>{j&&ns(j,K,N,S),$e&&To(N,S,K,"updated")},G)},R=(S,N,K,G,te,de,we)=>{for(let _e=0;_e<N.length;_e++){const Ie=S[_e],ye=N[_e],$e=Ie.el&&(Ie.type===it||!Oo(Ie,ye)||Ie.shapeFlag&198)?f(Ie.el):K;T(Ie,ye,$e,null,G,te,de,we,!0)}},M=(S,N,K,G,te)=>{if(N!==K){if(N!==Dt)for(const de in N)!xu(de)&&!(de in K)&&i(S,de,N[de],null,te,G);for(const de in K){if(xu(de))continue;const we=K[de],_e=N[de];we!==_e&&de!=="value"&&i(S,de,_e,we,te,G)}"value"in K&&i(S,"value",N.value,K.value,te)}},k=(S,N,K,G,te,de,we,_e,Ie)=>{const ye=N.el=S?S.el:a(""),$e=N.anchor=S?S.anchor:a("");let{patchFlag:Re,dynamicChildren:q,slotScopeIds:j}=N;j&&(_e=_e?_e.concat(j):j),S==null?(r(ye,K,G),r($e,K,G),_(N.children||[],K,$e,te,de,we,_e,Ie)):Re>0&&Re&64&&q&&S.dynamicChildren?(R(S.dynamicChildren,q,K,te,de,we,_e),(N.key!=null||te&&N===te.subTree)&&Fm(S,N,!0)):ae(S,N,K,$e,te,de,we,_e,Ie)},P=(S,N,K,G,te,de,we,_e,Ie)=>{N.slotScopeIds=_e,S==null?N.shapeFlag&512?te.ctx.activate(N,K,G,we,Ie):Qe(N,K,G,te,de,we,Ie):nt(S,N,Ie)},Qe=(S,N,K,G,te,de,we)=>{const _e=S.component=hS(S,G,te);if(Dh(S)&&(_e.ctx.renderer=Ve),pS(_e,!1,we),_e.asyncDep){if(te&&te.registerDep(_e,be,we),!S.el){const Ie=_e.subTree=Ke(Gn);F(null,Ie,N,K)}}else be(_e,S,N,K,te,de,we)},nt=(S,N,K)=>{const G=N.component=S.component;if(rS(S,N,K))if(G.asyncDep&&!G.asyncResolved){ne(G,N,K);return}else G.next=N,G.update();else N.el=S.el,G.vnode=N},be=(S,N,K,G,te,de,we)=>{const _e=()=>{if(S.isMounted){let{next:Re,bu:q,u:j,parent:ge,vnode:he}=S;{const Mt=ow(S);if(Mt){Re&&(Re.el=he.el,ne(S,Re,we)),Mt.asyncDep.then(()=>{S.isUnmounted||_e()});return}}let De=Re,We;Ao(S,!1),Re?(Re.el=he.el,ne(S,Re,we)):Re=he,q&&Ed(q),(We=Re.props&&Re.props.onVnodeBeforeUpdate)&&ns(We,ge,Re,he),Ao(S,!0);const Ze=Hf(S),gt=S.subTree;S.subTree=Ze,T(gt,Ze,f(gt.el),X(gt),S,te,de),Re.el=Ze.el,De===null&&sS(S,Ze.el),j&&Zn(j,te),(We=Re.props&&Re.props.onVnodeUpdated)&&Zn(()=>ns(We,ge,Re,he),te)}else{let Re;const{el:q,props:j}=N,{bm:ge,m:he,parent:De,root:We,type:Ze}=S,gt=Ga(N);if(Ao(S,!1),ge&&Ed(ge),!gt&&(Re=j&&j.onVnodeBeforeMount)&&ns(Re,De,N),Ao(S,!0),q&&dt){const Mt=()=>{S.subTree=Hf(S),dt(q,S.subTree,S,te,null)};gt&&Ze.__asyncHydrate?Ze.__asyncHydrate(q,S,Mt):Mt()}else{We.ce&&We.ce._def.shadowRoot!==!1&&We.ce._injectChildStyle(Ze);const Mt=S.subTree=Hf(S);T(null,Mt,K,G,S,te,de),N.el=Mt.el}if(he&&Zn(he,te),!gt&&(Re=j&&j.onVnodeMounted)){const Mt=N;Zn(()=>ns(Re,De,Mt),te)}(N.shapeFlag&256||De&&Ga(De.vnode)&&De.vnode.shapeFlag&256)&&S.a&&Zn(S.a,te),S.isMounted=!0,N=K=G=null}};S.scope.on();const Ie=S.effect=new fb(_e);S.scope.off();const ye=S.update=Ie.run.bind(Ie),$e=S.job=Ie.runIfDirty.bind(Ie);$e.i=S,$e.id=S.uid,Ie.scheduler=()=>Vm($e),Ao(S,!0),ye()},ne=(S,N,K)=>{N.component=S;const G=S.vnode.props;S.vnode=N,S.next=null,j1(S,N.props,G,K),H1(S,N.children,K),qs(),Xv(S),zs()},ae=(S,N,K,G,te,de,we,_e,Ie=!1)=>{const ye=S&&S.children,$e=S?S.shapeFlag:0,Re=N.children,{patchFlag:q,shapeFlag:j}=N;if(q>0){if(q&128){ke(ye,Re,K,G,te,de,we,_e,Ie);return}else if(q&256){ie(ye,Re,K,G,te,de,we,_e,Ie);return}}j&8?($e&16&&Ot(ye,te,de),Re!==ye&&h(K,Re)):$e&16?j&16?ke(ye,Re,K,G,te,de,we,_e,Ie):Ot(ye,te,de,!0):($e&8&&h(K,""),j&16&&_(Re,K,G,te,de,we,_e,Ie))},ie=(S,N,K,G,te,de,we,_e,Ie)=>{S=S||qa,N=N||qa;const ye=S.length,$e=N.length,Re=Math.min(ye,$e);let q;for(q=0;q<Re;q++){const j=N[q]=Ie?Ai(N[q]):ss(N[q]);T(S[q],j,K,null,te,de,we,_e,Ie)}ye>$e?Ot(S,te,de,!0,!1,Re):_(N,K,G,te,de,we,_e,Ie,Re)},ke=(S,N,K,G,te,de,we,_e,Ie)=>{let ye=0;const $e=N.length;let Re=S.length-1,q=$e-1;for(;ye<=Re&&ye<=q;){const j=S[ye],ge=N[ye]=Ie?Ai(N[ye]):ss(N[ye]);if(Oo(j,ge))T(j,ge,K,null,te,de,we,_e,Ie);else break;ye++}for(;ye<=Re&&ye<=q;){const j=S[Re],ge=N[q]=Ie?Ai(N[q]):ss(N[q]);if(Oo(j,ge))T(j,ge,K,null,te,de,we,_e,Ie);else break;Re--,q--}if(ye>Re){if(ye<=q){const j=q+1,ge=j<$e?N[j].el:G;for(;ye<=q;)T(null,N[ye]=Ie?Ai(N[ye]):ss(N[ye]),K,ge,te,de,we,_e,Ie),ye++}}else if(ye>q)for(;ye<=Re;)Q(S[ye],te,de,!0),ye++;else{const j=ye,ge=ye,he=new Map;for(ye=ge;ye<=q;ye++){const Lt=N[ye]=Ie?Ai(N[ye]):ss(N[ye]);Lt.key!=null&&he.set(Lt.key,ye)}let De,We=0;const Ze=q-ge+1;let gt=!1,Mt=0;const Er=new Array(Ze);for(ye=0;ye<Ze;ye++)Er[ye]=0;for(ye=j;ye<=Re;ye++){const Lt=S[ye];if(We>=Ze){Q(Lt,te,de,!0);continue}let Bt;if(Lt.key!=null)Bt=he.get(Lt.key);else for(De=ge;De<=q;De++)if(Er[De-ge]===0&&Oo(Lt,N[De])){Bt=De;break}Bt===void 0?Q(Lt,te,de,!0):(Er[Bt-ge]=ye+1,Bt>=Mt?Mt=Bt:gt=!0,T(Lt,N[Bt],K,null,te,de,we,_e,Ie),We++)}const Tr=gt?Q1(Er):qa;for(De=Tr.length-1,ye=Ze-1;ye>=0;ye--){const Lt=ge+ye,Bt=N[Lt],jn=Lt+1<$e?N[Lt+1].el:G;Er[ye]===0?T(null,Bt,K,jn,te,de,we,_e,Ie):gt&&(De<0||ye!==Tr[De]?Z(Bt,K,jn,2):De--)}}},Z=(S,N,K,G,te=null)=>{const{el:de,type:we,transition:_e,children:Ie,shapeFlag:ye}=S;if(ye&6){Z(S.component.subTree,N,K,G);return}if(ye&128){S.suspense.move(N,K,G);return}if(ye&64){we.move(S,N,K,Ve);return}if(we===it){r(de,N,K);for(let Re=0;Re<Ie.length;Re++)Z(Ie[Re],N,K,G);r(S.anchor,N,K);return}if(we===Pd){L(S,N,K);return}if(G!==2&&ye&1&&_e)if(G===0)_e.beforeEnter(de),r(de,N,K),Zn(()=>_e.enter(de),te);else{const{leave:Re,delayLeave:q,afterLeave:j}=_e,ge=()=>{S.ctx.isUnmounted?s(de):r(de,N,K)},he=()=>{Re(de,()=>{ge(),j&&j()})};q?q(de,ge,he):he()}else r(de,N,K)},Q=(S,N,K,G=!1,te=!1)=>{const{type:de,props:we,ref:_e,children:Ie,dynamicChildren:ye,shapeFlag:$e,patchFlag:Re,dirs:q,cacheIndex:j}=S;if(Re===-2&&(te=!1),_e!=null&&(qs(),Au(_e,null,K,S,!0),zs()),j!=null&&(N.renderCache[j]=void 0),$e&256){N.ctx.deactivate(S);return}const ge=$e&1&&q,he=!Ga(S);let De;if(he&&(De=we&&we.onVnodeBeforeUnmount)&&ns(De,N,S),$e&6)ct(S.component,K,G);else{if($e&128){S.suspense.unmount(K,G);return}ge&&To(S,null,N,"beforeUnmount"),$e&64?S.type.remove(S,N,K,Ve,G):ye&&!ye.hasOnce&&(de!==it||Re>0&&Re&64)?Ot(ye,N,K,!1,!0):(de===it&&Re&384||!te&&$e&16)&&Ot(Ie,N,K),G&&Ee(S)}(he&&(De=we&&we.onVnodeUnmounted)||ge)&&Zn(()=>{De&&ns(De,N,S),ge&&To(S,null,N,"unmounted")},K)},Ee=S=>{const{type:N,el:K,anchor:G,transition:te}=S;if(N===it){Je(K,G);return}if(N===Pd){$(S);return}const de=()=>{s(K),te&&!te.persisted&&te.afterLeave&&te.afterLeave()};if(S.shapeFlag&1&&te&&!te.persisted){const{leave:we,delayLeave:_e}=te,Ie=()=>we(K,de);_e?_e(S.el,de,Ie):Ie()}else de()},Je=(S,N)=>{let K;for(;S!==N;)K=g(S),s(S),S=K;s(N)},ct=(S,N,K)=>{const{bum:G,scope:te,job:de,subTree:we,um:_e,m:Ie,a:ye,parent:$e,slots:{__:Re}}=S;uy(Ie),uy(ye),G&&Ed(G),$e&&qe(Re)&&Re.forEach(q=>{$e.renderCache[q]=void 0}),te.stop(),de&&(de.flags|=8,Q(we,S,N,K)),_e&&Zn(_e,N),Zn(()=>{S.isUnmounted=!0},N),N&&N.pendingBranch&&!N.isUnmounted&&S.asyncDep&&!S.asyncResolved&&S.suspenseId===N.pendingId&&(N.deps--,N.deps===0&&N.resolve())},Ot=(S,N,K,G=!1,te=!1,de=0)=>{for(let we=de;we<S.length;we++)Q(S[we],N,K,G,te)},X=S=>{if(S.shapeFlag&6)return X(S.component.subTree);if(S.shapeFlag&128)return S.suspense.next();const N=g(S.anchor||S.el),K=N&&N[Mb];return K?g(K):N};let Ae=!1;const xe=(S,N,K)=>{S==null?N._vnode&&Q(N._vnode,null,null,!0):T(N._vnode||null,S,N,null,null,null,K),N._vnode=S,Ae||(Ae=!0,Xv(),Nb(),Ae=!1)},Ve={p:T,um:Q,m:Z,r:Ee,mt:Qe,mc:_,pc:ae,pbc:R,n:X,o:n};let rt,dt;return e&&([rt,dt]=e(Ve)),{render:xe,hydrate:rt,createApp:F1(xe,rt)}}function zf({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Ao({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function W1(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function Fm(n,e,t=!1){const r=n.children,s=e.children;if(qe(r)&&qe(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=Ai(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&Fm(o,a)),a.type===Oh&&(a.el=o.el),a.type===Gn&&!a.el&&(a.el=o.el)}}function Q1(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function ow(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:ow(e)}function uy(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const J1=Symbol.for("v-scx"),Y1=()=>qr(J1);function bt(n,e,t){return aw(n,e,t)}function aw(n,e,t=Dt){const{immediate:r,deep:s,flush:i,once:o}=t,a=_n({},t),l=e&&r||!e&&i!=="post";let c;if(Ku){if(i==="sync"){const v=Y1();c=v.__watcherHandles||(v.__watcherHandles=[])}else if(!l){const v=()=>{};return v.stop=Ur,v.resume=Ur,v.pause=Ur,v}}const h=$n;a.call=(v,I,T)=>Hr(v,h,I,T);let f=!1;i==="post"?a.scheduler=v=>{Zn(v,h&&h.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(v,I)=>{I?v():Vm(v)}),a.augmentJob=v=>{e&&(v.flags|=4),f&&(v.flags|=2,h&&(v.id=h.uid,v.i=h))};const g=c1(n,e,a);return Ku&&(c?c.push(g):l&&g()),g}function X1(n,e,t){const r=this.proxy,s=on(n)?n.includes(".")?lw(r,n):()=>r[n]:n.bind(r,r);let i;et(e)?i=e:(i=e.handler,t=e);const o=wc(this),a=aw(s,i.bind(r),t);return o(),a}function lw(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const Z1=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Dr(e)}Modifiers`]||n[`${to(e)}Modifiers`];function eS(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||Dt;let s=t;const i=e.startsWith("update:"),o=i&&Z1(r,e.slice(7));o&&(o.trim&&(s=t.map(h=>on(h)?h.trim():h)),o.number&&(s=t.map(Hd)));let a,l=r[a=Lf(e)]||r[a=Lf(Dr(e))];!l&&i&&(l=r[a=Lf(to(e))]),l&&Hr(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,Hr(c,n,6,s)}}function uw(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!et(n)){const l=c=>{const h=uw(c,e,!0);h&&(a=!0,_n(o,h))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(Nt(n)&&r.set(n,null),null):(qe(i)?i.forEach(l=>o[l]=null):_n(o,i),Nt(n)&&r.set(n,o),o)}function Vh(n,e){return!n||!Th(e)?!1:(e=e.slice(2).replace(/Once$/,""),At(n,e[0].toLowerCase()+e.slice(1))||At(n,to(e))||At(n,e))}function Hf(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:h,props:f,data:g,setupState:v,ctx:I,inheritAttrs:T}=n,A=Qd(n);let F,U;try{if(t.shapeFlag&4){const $=s||r,ue=$;F=ss(c.call(ue,$,h,f,v,g,I)),U=a}else{const $=e;F=ss($.length>1?$(f,{attrs:a,slots:o,emit:l}):$(f,null)),U=e.props?a:tS(a)}}catch($){Pu.length=0,kh($,n,1),F=Ke(Gn)}let L=F;if(U&&T!==!1){const $=Object.keys(U),{shapeFlag:ue}=L;$.length&&ue&7&&(i&&$.some(Im)&&(U=nS(U,i)),L=Hi(L,U,!1,!0))}return t.dirs&&(L=Hi(L,null,!1,!0),L.dirs=L.dirs?L.dirs.concat(t.dirs):t.dirs),t.transition&&qu(L,t.transition),F=L,Qd(A),F}const tS=n=>{let e;for(const t in n)(t==="class"||t==="style"||Th(t))&&((e||(e={}))[t]=n[t]);return e},nS=(n,e)=>{const t={};for(const r in n)(!Im(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function rS(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?cy(r,o,c):!!o;if(l&8){const h=e.dynamicProps;for(let f=0;f<h.length;f++){const g=h[f];if(o[g]!==r[g]&&!Vh(c,g))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?cy(r,o,c):!0:!!o;return!1}function cy(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!Vh(t,i))return!0}return!1}function sS({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const cw=n=>n.__isSuspense;function iS(n,e){e&&e.pendingBranch?qe(n)?e.effects.push(...n):e.effects.push(n):f1(n)}const it=Symbol.for("v-fgt"),Oh=Symbol.for("v-txt"),Gn=Symbol.for("v-cmt"),Pd=Symbol.for("v-stc"),Pu=[];let xr=null;function D(n=!1){Pu.push(xr=n?null:[])}function oS(){Pu.pop(),xr=Pu[Pu.length-1]||null}let zu=1;function dy(n,e=!1){zu+=n,n<0&&xr&&e&&(xr.hasOnce=!0)}function dw(n){return n.dynamicChildren=zu>0?xr||qa:null,oS(),zu>0&&xr&&xr.push(n),n}function O(n,e,t,r,s,i){return dw(d(n,e,t,r,s,i,!0))}function $s(n,e,t,r,s){return dw(Ke(n,e,t,r,s,!0))}function Hu(n){return n?n.__v_isVNode===!0:!1}function Oo(n,e){return n.type===e.type&&n.key===e.key}const hw=({key:n})=>n??null,Cd=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?on(n)||Wn(n)||et(n)?{i:Rn,r:n,k:e,f:!!t}:n:null);function d(n,e=null,t=null,r=0,s=null,i=n===it?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&hw(e),ref:e&&Cd(e),scopeId:Ob,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Rn};return a?(Um(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=on(t)?8:16),zu>0&&!o&&xr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&xr.push(l),l}const Ke=aS;function aS(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===C1)&&(n=Gn),Hu(n)){const a=Hi(n,e,!0);return t&&Um(a,t),zu>0&&!i&&xr&&(a.shapeFlag&6?xr[xr.indexOf(n)]=a:xr.push(a)),a.patchFlag=-2,a}if(_S(n)&&(n=n.__vccOpts),e){e=lS(e);let{class:a,style:l}=e;a&&!on(a)&&(e.class=Qt(a)),Nt(l)&&(Nm(l)&&!qe(l)&&(l=_n({},l)),e.style=br(l))}const o=on(n)?1:cw(n)?128:Lb(n)?64:Nt(n)?4:et(n)?2:0;return d(n,e,t,r,s,o,i,!0)}function lS(n){return n?Nm(n)||ew(n)?_n({},n):n:null}function Hi(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?uS(s||{},e):s,h={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&hw(c),ref:e&&e.ref?t&&i?qe(i)?i.concat(Cd(e)):[i,Cd(e)]:Cd(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==it?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Hi(n.ssContent),ssFallback:n.ssFallback&&Hi(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&qu(h,l.clone(h)),h}function St(n=" ",e=0){return Ke(Oh,null,n,e)}function Cn(n,e){const t=Ke(Pd,null,n);return t.staticCount=e,t}function ce(n="",e=!1){return e?(D(),$s(Gn,null,n)):Ke(Gn,null,n)}function ss(n){return n==null||typeof n=="boolean"?Ke(Gn):qe(n)?Ke(it,null,n.slice()):Hu(n)?Ai(n):Ke(Oh,null,String(n))}function Ai(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Hi(n)}function Um(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(qe(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),Um(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!ew(e)?e._ctx=Rn:s===3&&Rn&&(Rn.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else et(e)?(e={default:e,_ctx:Rn},t=32):(e=String(e),r&64?(t=16,e=[St(e)]):t=8);n.children=e,n.shapeFlag|=t}function uS(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=Qt([e.class,r.class]));else if(s==="style")e.style=br([e.style,r.style]);else if(Th(s)){const i=e[s],o=r[s];o&&i!==o&&!(qe(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function ns(n,e,t,r=null){Hr(n,e,7,[t,r])}const cS=Yb();let dS=0;function hS(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||cS,i={uid:dS++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new LA(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:nw(r,s),emitsOptions:uw(r,s),emit:null,emitted:null,propsDefaults:Dt,inheritAttrs:r.inheritAttrs,ctx:Dt,data:Dt,props:Dt,attrs:Dt,slots:Dt,refs:Dt,setupState:Dt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=eS.bind(null,i),n.ce&&n.ce(i),i}let $n=null;const fS=()=>$n||Rn;let Yd,Np;{const n=Ph(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};Yd=e("__VUE_INSTANCE_SETTERS__",t=>$n=t),Np=e("__VUE_SSR_SETTERS__",t=>Ku=t)}const wc=n=>{const e=$n;return Yd(n),n.scope.on(),()=>{n.scope.off(),Yd(e)}},hy=()=>{$n&&$n.scope.off(),Yd(null)};function fw(n){return n.vnode.shapeFlag&4}let Ku=!1;function pS(n,e=!1,t=!1){e&&Np(e);const{props:r,children:s}=n.vnode,i=fw(n);U1(n,r,i,e),z1(n,s,t||e);const o=i?mS(n,e):void 0;return e&&Np(!1),o}function mS(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,D1);const{setup:r}=t;if(r){qs();const s=n.setupContext=r.length>1?vS(n):null,i=wc(n),o=bc(r,n,0,[n.props,s]),a=ab(o);if(zs(),i(),(a||n.sp)&&!Ga(n)&&Kb(n),a){if(o.then(hy,hy),e)return o.then(l=>{fy(n,l,e)}).catch(l=>{kh(l,n,0)});n.asyncDep=o}else fy(n,o,e)}else pw(n,e)}function fy(n,e,t){et(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Nt(e)&&(n.setupState=Rb(e)),pw(n,t)}let py;function pw(n,e,t){const r=n.type;if(!n.render){if(!e&&py&&!r.render){const s=r.template||Mm(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=_n(_n({isCustomElement:i,delimiters:a},o),l);r.render=py(s,c)}}n.render=r.render||Ur}{const s=wc(n);qs();try{N1(n)}finally{zs(),s()}}}const gS={get(n,e){return Kn(n,"get",""),n[e]}};function vS(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,gS),slots:n.slots,emit:n.emit,expose:e}}function Mh(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(Rb(r1(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in Su)return Su[t](n)},has(e,t){return t in e||t in Su}})):n.proxy}function yS(n,e=!0){return et(n)?n.displayName||n.name:n.name||e&&n.__name}function _S(n){return et(n)&&"__vccOpts"in n}const Fe=(n,e)=>l1(n,e,Ku);function jm(n,e,t){const r=arguments.length;return r===2?Nt(e)&&!qe(e)?Hu(e)?Ke(n,null,[e]):Ke(n,e):Ke(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&Hu(t)&&(t=[t]),Ke(n,e,t))}const bS="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Vp;const my=typeof window<"u"&&window.trustedTypes;if(my)try{Vp=my.createPolicy("vue",{createHTML:n=>n})}catch{}const mw=Vp?n=>Vp.createHTML(n):n=>n,wS="http://www.w3.org/2000/svg",xS="http://www.w3.org/1998/Math/MathML",Ps=typeof document<"u"?document:null,gy=Ps&&Ps.createElement("template"),IS={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?Ps.createElementNS(wS,n):e==="mathml"?Ps.createElementNS(xS,n):t?Ps.createElement(n,{is:t}):Ps.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>Ps.createTextNode(n),createComment:n=>Ps.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Ps.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{gy.innerHTML=mw(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=gy.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},_i="transition",su="animation",Gu=Symbol("_vtc"),gw={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},ES=_n({},Ub,gw),TS=n=>(n.displayName="Transition",n.props=ES,n),Kf=TS((n,{slots:e})=>jm(v1,AS(n),e)),So=(n,e=[])=>{qe(n)?n.forEach(t=>t(...e)):n&&n(...e)},vy=n=>n?qe(n)?n.some(e=>e.length>1):n.length>1:!1;function AS(n){const e={};for(const k in n)k in gw||(e[k]=n[k]);if(n.css===!1)return e;const{name:t="v",type:r,duration:s,enterFromClass:i=`${t}-enter-from`,enterActiveClass:o=`${t}-enter-active`,enterToClass:a=`${t}-enter-to`,appearFromClass:l=i,appearActiveClass:c=o,appearToClass:h=a,leaveFromClass:f=`${t}-leave-from`,leaveActiveClass:g=`${t}-leave-active`,leaveToClass:v=`${t}-leave-to`}=n,I=SS(s),T=I&&I[0],A=I&&I[1],{onBeforeEnter:F,onEnter:U,onEnterCancelled:L,onLeave:$,onLeaveCancelled:ue,onBeforeAppear:se=F,onAppear:E=U,onAppearCancelled:_=L}=e,x=(k,P,Qe,nt)=>{k._enterCancelled=nt,Po(k,P?h:a),Po(k,P?c:o),Qe&&Qe()},R=(k,P)=>{k._isLeaving=!1,Po(k,f),Po(k,v),Po(k,g),P&&P()},M=k=>(P,Qe)=>{const nt=k?E:U,be=()=>x(P,k,Qe);So(nt,[P,be]),yy(()=>{Po(P,k?l:i),As(P,k?h:a),vy(nt)||_y(P,r,T,be)})};return _n(e,{onBeforeEnter(k){So(F,[k]),As(k,i),As(k,o)},onBeforeAppear(k){So(se,[k]),As(k,l),As(k,c)},onEnter:M(!1),onAppear:M(!0),onLeave(k,P){k._isLeaving=!0;const Qe=()=>R(k,P);As(k,f),k._enterCancelled?(As(k,g),xy()):(xy(),As(k,g)),yy(()=>{k._isLeaving&&(Po(k,f),As(k,v),vy($)||_y(k,r,A,Qe))}),So($,[k,Qe])},onEnterCancelled(k){x(k,!1,void 0,!0),So(L,[k])},onAppearCancelled(k){x(k,!0,void 0,!0),So(_,[k])},onLeaveCancelled(k){R(k),So(ue,[k])}})}function SS(n){if(n==null)return null;if(Nt(n))return[Gf(n.enter),Gf(n.leave)];{const e=Gf(n);return[e,e]}}function Gf(n){return CA(n)}function As(n,e){e.split(/\s+/).forEach(t=>t&&n.classList.add(t)),(n[Gu]||(n[Gu]=new Set)).add(e)}function Po(n,e){e.split(/\s+/).forEach(r=>r&&n.classList.remove(r));const t=n[Gu];t&&(t.delete(e),t.size||(n[Gu]=void 0))}function yy(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let PS=0;function _y(n,e,t,r){const s=n._endId=++PS,i=()=>{s===n._endId&&r()};if(t!=null)return setTimeout(i,t);const{type:o,timeout:a,propCount:l}=CS(n,e);if(!o)return r();const c=o+"end";let h=0;const f=()=>{n.removeEventListener(c,g),i()},g=v=>{v.target===n&&++h>=l&&f()};setTimeout(()=>{h<l&&f()},a+1),n.addEventListener(c,g)}function CS(n,e){const t=window.getComputedStyle(n),r=I=>(t[I]||"").split(", "),s=r(`${_i}Delay`),i=r(`${_i}Duration`),o=by(s,i),a=r(`${su}Delay`),l=r(`${su}Duration`),c=by(a,l);let h=null,f=0,g=0;e===_i?o>0&&(h=_i,f=o,g=i.length):e===su?c>0&&(h=su,f=c,g=l.length):(f=Math.max(o,c),h=f>0?o>c?_i:su:null,g=h?h===_i?i.length:l.length:0);const v=h===_i&&/\b(transform|all)(,|$)/.test(r(`${_i}Property`).toString());return{type:h,timeout:f,propCount:g,hasTransform:v}}function by(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max(...e.map((t,r)=>wy(t)+wy(n[r])))}function wy(n){return n==="auto"?0:Number(n.slice(0,-1).replace(",","."))*1e3}function xy(){return document.body.offsetHeight}function RS(n,e,t){const r=n[Gu];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const Xd=Symbol("_vod"),vw=Symbol("_vsh"),Wf={beforeMount(n,{value:e},{transition:t}){n[Xd]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):iu(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),iu(n,!0),r.enter(n)):r.leave(n,()=>{iu(n,!1)}):iu(n,e))},beforeUnmount(n,{value:e}){iu(n,e)}};function iu(n,e){n.style.display=e?n[Xd]:"none",n[vw]=!e}const kS=Symbol(""),DS=/(^|;)\s*display\s*:/;function NS(n,e,t){const r=n.style,s=on(t);let i=!1;if(t&&!s){if(e)if(on(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&Rd(r,a,"")}else for(const o in e)t[o]==null&&Rd(r,o,"");for(const o in t)o==="display"&&(i=!0),Rd(r,o,t[o])}else if(s){if(e!==t){const o=r[kS];o&&(t+=";"+o),r.cssText=t,i=DS.test(t)}}else e&&n.removeAttribute("style");Xd in n&&(n[Xd]=i?r.display:"",n[vw]&&(r.display="none"))}const Iy=/\s*!important$/;function Rd(n,e,t){if(qe(t))t.forEach(r=>Rd(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=VS(n,e);Iy.test(t)?n.setProperty(to(r),t.replace(Iy,""),"important"):n[r]=t}}const Ey=["Webkit","Moz","ms"],Qf={};function VS(n,e){const t=Qf[e];if(t)return t;let r=Dr(e);if(r!=="filter"&&r in n)return Qf[e]=r;r=Sh(r);for(let s=0;s<Ey.length;s++){const i=Ey[s]+r;if(i in n)return Qf[e]=i}return e}const Ty="http://www.w3.org/1999/xlink";function Ay(n,e,t,r,s,i=OA(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(Ty,e.slice(6,e.length)):n.setAttributeNS(Ty,e,t):t==null||i&&!cb(t)?n.removeAttribute(e):n.setAttribute(e,i?"":zr(t)?String(t):t)}function Sy(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?mw(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=cb(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function Pi(n,e,t,r){n.addEventListener(e,t,r)}function OS(n,e,t,r){n.removeEventListener(e,t,r)}const Py=Symbol("_vei");function MS(n,e,t,r,s=null){const i=n[Py]||(n[Py]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=LS(e);if(r){const c=i[e]=US(r,s);Pi(n,a,c,l)}else o&&(OS(n,a,o,l),i[e]=void 0)}}const Cy=/(?:Once|Passive|Capture)$/;function LS(n){let e;if(Cy.test(n)){e={};let r;for(;r=n.match(Cy);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):to(n.slice(2)),e]}let Jf=0;const $S=Promise.resolve(),FS=()=>Jf||($S.then(()=>Jf=0),Jf=Date.now());function US(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;Hr(jS(r,t.value),e,5,[r])};return t.value=n,t.attached=FS(),t}function jS(n,e){if(qe(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const Ry=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,BS=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?RS(n,r,o):e==="style"?NS(n,t,r):Th(e)?Im(e)||MS(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):qS(n,e,r,o))?(Sy(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Ay(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!on(r))?Sy(n,Dr(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),Ay(n,e,r,o))};function qS(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&Ry(e)&&et(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Ry(e)&&on(t)?!1:e in n}const nl=n=>{const e=n.props["onUpdate:modelValue"]||!1;return qe(e)?t=>Ed(e,t):e};function zS(n){n.target.composing=!0}function ky(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Fs=Symbol("_assign"),Ft={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[Fs]=nl(s);const i=r||s.props&&s.props.type==="number";Pi(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=Hd(a)),n[Fs](a)}),t&&Pi(n,"change",()=>{n.value=n.value.trim()}),e||(Pi(n,"compositionstart",zS),Pi(n,"compositionend",ky),Pi(n,"change",ky))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[Fs]=nl(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?Hd(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},Mi={deep:!0,created(n,e,t){n[Fs]=nl(t),Pi(n,"change",()=>{const r=n._modelValue,s=Wu(n),i=n.checked,o=n[Fs];if(qe(r)){const a=Am(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(xl(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(yw(n,i))})},mounted:Dy,beforeUpdate(n,e,t){n[Fs]=nl(t),Dy(n,e,t)}};function Dy(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(qe(e))s=Am(e,r.props.value)>-1;else if(xl(e))s=e.has(r.props.value);else{if(e===t)return;s=_c(e,yw(n,!0))}n.checked!==s&&(n.checked=s)}const HS={deep:!0,created(n,{value:e,modifiers:{number:t}},r){const s=xl(e);Pi(n,"change",()=>{const i=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>t?Hd(Wu(o)):Wu(o));n[Fs](n.multiple?s?new Set(i):i:i[0]),n._assigning=!0,Gt(()=>{n._assigning=!1})}),n[Fs]=nl(r)},mounted(n,{value:e}){Ny(n,e)},beforeUpdate(n,e,t){n[Fs]=nl(t)},updated(n,{value:e}){n._assigning||Ny(n,e)}};function Ny(n,e){const t=n.multiple,r=qe(e);if(!(t&&!r&&!xl(e))){for(let s=0,i=n.options.length;s<i;s++){const o=n.options[s],a=Wu(o);if(t)if(r){const l=typeof a;l==="string"||l==="number"?o.selected=e.some(c=>String(c)===String(a)):o.selected=Am(e,a)>-1}else o.selected=e.has(a);else if(_c(Wu(o),e)){n.selectedIndex!==s&&(n.selectedIndex=s);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function Wu(n){return"_value"in n?n._value:n.value}function yw(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const KS=["ctrl","shift","alt","meta"],GS={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>KS.some(t=>n[`${t}Key`]&&!e.includes(t))},lt=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=GS[e[o]];if(a&&a(s,e))return}return n(s,...i)})},WS={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},zn=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=to(s.key);if(e.some(o=>o===i||WS[o]===i))return n(s)})},QS=_n({patchProp:BS},IS);let Vy;function JS(){return Vy||(Vy=K1(QS))}const YS=(...n)=>{const e=JS().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=ZS(r);if(!s)return;const i=e._component;!et(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,XS(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function XS(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function ZS(n){return on(n)?document.querySelector(n):n}const eP="/icons/icon-48x48.png";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _w=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},tP=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},bw={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|c>>6,v=c&63;l||(v=64,o||(g=64)),r.push(t[h],t[f],t[g],t[v])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(_w(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):tP(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new nP;const g=i<<2|a>>4;if(r.push(g),c!==64){const v=a<<4&240|c>>2;if(r.push(v),f!==64){const I=c<<6&192|f;r.push(I)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class nP extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const rP=function(n){const e=_w(n);return bw.encodeByteArray(e,!0)},Zd=function(n){return rP(n).replace(/\./g,"")},ww=function(n){try{return bw.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sP(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iP=()=>sP().__FIREBASE_DEFAULTS__,oP=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},aP=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&ww(n[1]);return e&&JSON.parse(e)},Lh=()=>{try{return iP()||oP()||aP()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},xw=n=>{var e,t;return(t=(e=Lh())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},lP=n=>{const e=xw(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Iw=()=>{var n;return(n=Lh())===null||n===void 0?void 0:n.config},Ew=n=>{var e;return(e=Lh())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uP{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cP(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[Zd(JSON.stringify(t)),Zd(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function dP(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(xn())}function hP(){var n;const e=(n=Lh())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function fP(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function pP(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function mP(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function gP(){const n=xn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Tw(){return!hP()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Bm(){try{return typeof indexedDB=="object"}catch{return!1}}function Aw(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}function vP(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yP="FirebaseError";class fs extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=yP,Object.setPrototypeOf(this,fs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,oa.prototype.create)}}class oa{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?_P(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new fs(s,a,r)}}function _P(n,e){return n.replace(bP,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const bP=/\{\$([^}]+)}/g;function wP(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ki(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(Oy(i)&&Oy(o)){if(!Ki(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Oy(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Il(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function mu(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function gu(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function xP(n,e){const t=new IP(n,e);return t.subscribe.bind(t)}class IP{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");EP(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Yf),s.error===void 0&&(s.error=Yf),s.complete===void 0&&(s.complete=Yf);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function EP(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Yf(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function je(n){return n&&n._delegate?n._delegate:n}class Kr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ko="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TP{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new uP;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(SP(e))try{this.getOrInitializeService({instanceIdentifier:ko})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ko){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ko){return this.instances.has(e)}getOptions(e=ko){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:AP(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ko){return this.component?this.component.multipleInstances?e:ko:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function AP(n){return n===ko?void 0:n}function SP(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new TP(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ft;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ft||(ft={}));const CP={debug:ft.DEBUG,verbose:ft.VERBOSE,info:ft.INFO,warn:ft.WARN,error:ft.ERROR,silent:ft.SILENT},RP=ft.INFO,kP={[ft.DEBUG]:"log",[ft.VERBOSE]:"log",[ft.INFO]:"info",[ft.WARN]:"warn",[ft.ERROR]:"error"},DP=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=kP[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class qm{constructor(e){this.name=e,this._logLevel=RP,this._logHandler=DP,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ft))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?CP[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ft.DEBUG,...e),this._logHandler(this,ft.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ft.VERBOSE,...e),this._logHandler(this,ft.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ft.INFO,...e),this._logHandler(this,ft.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ft.WARN,...e),this._logHandler(this,ft.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ft.ERROR,...e),this._logHandler(this,ft.ERROR,...e)}}const NP=(n,e)=>e.some(t=>n instanceof t);let My,Ly;function VP(){return My||(My=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function OP(){return Ly||(Ly=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Sw=new WeakMap,Op=new WeakMap,Pw=new WeakMap,Xf=new WeakMap,zm=new WeakMap;function MP(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Us(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Sw.set(t,n)}).catch(()=>{}),zm.set(e,n),e}function LP(n){if(Op.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});Op.set(n,e)}let Mp={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Op.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Pw.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Us(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function $P(n){Mp=n(Mp)}function FP(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Zf(this),e,...t);return Pw.set(r,e.sort?e.sort():[e]),Us(r)}:OP().includes(n)?function(...e){return n.apply(Zf(this),e),Us(Sw.get(this))}:function(...e){return Us(n.apply(Zf(this),e))}}function UP(n){return typeof n=="function"?FP(n):(n instanceof IDBTransaction&&LP(n),NP(n,VP())?new Proxy(n,Mp):n)}function Us(n){if(n instanceof IDBRequest)return MP(n);if(Xf.has(n))return Xf.get(n);const e=UP(n);return e!==n&&(Xf.set(n,e),zm.set(e,n)),e}const Zf=n=>zm.get(n);function $h(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Us(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Us(o.result),l.oldVersion,l.newVersion,Us(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function ep(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),Us(t).then(()=>{})}const jP=["get","getKey","getAll","getAllKeys","count"],BP=["put","add","delete","clear"],tp=new Map;function $y(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(tp.get(e))return tp.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=BP.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||jP.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return tp.set(e,i),i}$P(n=>({...n,get:(e,t,r)=>$y(e,t)||n.get(e,t,r),has:(e,t)=>!!$y(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qP{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(zP(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function zP(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Lp="@firebase/app",Fy="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hs=new qm("@firebase/app"),HP="@firebase/app-compat",KP="@firebase/analytics-compat",GP="@firebase/analytics",WP="@firebase/app-check-compat",QP="@firebase/app-check",JP="@firebase/auth",YP="@firebase/auth-compat",XP="@firebase/database",ZP="@firebase/data-connect",eC="@firebase/database-compat",tC="@firebase/functions",nC="@firebase/functions-compat",rC="@firebase/installations",sC="@firebase/installations-compat",iC="@firebase/messaging",oC="@firebase/messaging-compat",aC="@firebase/performance",lC="@firebase/performance-compat",uC="@firebase/remote-config",cC="@firebase/remote-config-compat",dC="@firebase/storage",hC="@firebase/storage-compat",fC="@firebase/firestore",pC="@firebase/vertexai-preview",mC="@firebase/firestore-compat",gC="firebase",vC="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eh="[DEFAULT]",yC={[Lp]:"fire-core",[HP]:"fire-core-compat",[GP]:"fire-analytics",[KP]:"fire-analytics-compat",[QP]:"fire-app-check",[WP]:"fire-app-check-compat",[JP]:"fire-auth",[YP]:"fire-auth-compat",[XP]:"fire-rtdb",[ZP]:"fire-data-connect",[eC]:"fire-rtdb-compat",[tC]:"fire-fn",[nC]:"fire-fn-compat",[rC]:"fire-iid",[sC]:"fire-iid-compat",[iC]:"fire-fcm",[oC]:"fire-fcm-compat",[aC]:"fire-perf",[lC]:"fire-perf-compat",[uC]:"fire-rc",[cC]:"fire-rc-compat",[dC]:"fire-gcs",[hC]:"fire-gcs-compat",[fC]:"fire-fst",[mC]:"fire-fst-compat",[pC]:"fire-vertex","fire-js":"fire-js",[gC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const th=new Map,_C=new Map,$p=new Map;function Uy(n,e){try{n.container.addComponent(e)}catch(t){Hs.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function ds(n){const e=n.name;if($p.has(e))return Hs.debug(`There were multiple attempts to register component ${e}.`),!1;$p.set(e,n);for(const t of th.values())Uy(t,n);for(const t of _C.values())Uy(t,n);return!0}function no(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function bC(n,e,t=eh){no(n,e).clearInstance(t)}function fn(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ui=new oa("app","Firebase",wC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xC{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Kr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ui.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const El=vC;function Cw(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:eh,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Ui.create("bad-app-name",{appName:String(s)});if(t||(t=Iw()),!t)throw Ui.create("no-options");const i=th.get(s);if(i){if(Ki(t,i.options)&&Ki(r,i.config))return i;throw Ui.create("duplicate-app",{appName:s})}const o=new PP(s);for(const l of $p.values())o.addComponent(l);const a=new xC(t,r,o);return th.set(s,a),a}function Hm(n=eh){const e=th.get(n);if(!e&&n===eh&&Iw())return Cw();if(!e)throw Ui.create("no-app",{appName:n});return e}function kr(n,e,t){var r;let s=(r=yC[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Hs.warn(a.join(" "));return}ds(new Kr(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IC="firebase-heartbeat-database",EC=1,Qu="firebase-heartbeat-store";let np=null;function Rw(){return np||(np=$h(IC,EC,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Qu)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ui.create("idb-open",{originalErrorMessage:n.message})})),np}async function TC(n){try{const t=(await Rw()).transaction(Qu),r=await t.objectStore(Qu).get(kw(n));return await t.done,r}catch(e){if(e instanceof fs)Hs.warn(e.message);else{const t=Ui.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Hs.warn(t.message)}}}async function jy(n,e){try{const r=(await Rw()).transaction(Qu,"readwrite");await r.objectStore(Qu).put(e,kw(n)),await r.done}catch(t){if(t instanceof fs)Hs.warn(t.message);else{const r=Ui.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Hs.warn(r.message)}}}function kw(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AC=1024,SC=30*24*60*60*1e3;class PC{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new RC(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=By();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=SC}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Hs.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=By(),{heartbeatsToSend:r,unsentEntries:s}=CC(this._heartbeatsCache.heartbeats),i=Zd(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Hs.warn(t),""}}}function By(){return new Date().toISOString().substring(0,10)}function CC(n,e=AC){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),qy(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),qy(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class RC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Bm()?Aw().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await TC(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return jy(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return jy(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function qy(n){return Zd(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kC(n){ds(new Kr("platform-logger",e=>new qP(e),"PRIVATE")),ds(new Kr("heartbeat",e=>new PC(e),"PRIVATE")),kr(Lp,Fy,n),kr(Lp,Fy,"esm2017"),kr("fire-js","")}kC("");const Dw="@firebase/installations",Km="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nw=1e4,Vw=`w:${Km}`,Ow="FIS_v2",DC="https://firebaseinstallations.googleapis.com/v1",NC=60*60*1e3,VC="installations",OC="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MC={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Wo=new oa(VC,OC,MC);function Mw(n){return n instanceof fs&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lw({projectId:n}){return`${DC}/projects/${n}/installations`}function $w(n){return{token:n.token,requestStatus:2,expiresIn:$C(n.expiresIn),creationTime:Date.now()}}async function Fw(n,e){const r=(await e.json()).error;return Wo.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function Uw({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function LC(n,{refreshToken:e}){const t=Uw(n);return t.append("Authorization",FC(e)),t}async function jw(n){const e=await n();return e.status>=500&&e.status<600?n():e}function $C(n){return Number(n.replace("s","000"))}function FC(n){return`${Ow} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UC({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=Lw(n),s=Uw(n),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={fid:t,authVersion:Ow,appId:n.appId,sdkVersion:Vw},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await jw(()=>fetch(r,a));if(l.ok){const c=await l.json();return{fid:c.fid||t,registrationStatus:2,refreshToken:c.refreshToken,authToken:$w(c.authToken)}}else throw await Fw("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bw(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jC(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BC=/^[cdef][\w-]{21}$/,Fp="";function qC(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=zC(n);return BC.test(t)?t:Fp}catch{return Fp}}function zC(n){return jC(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fh(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qw=new Map;function zw(n,e){const t=Fh(n);Hw(t,e),HC(t,e)}function Hw(n,e){const t=qw.get(n);if(t)for(const r of t)r(e)}function HC(n,e){const t=KC();t&&t.postMessage({key:n,fid:e}),GC()}let Uo=null;function KC(){return!Uo&&"BroadcastChannel"in self&&(Uo=new BroadcastChannel("[Firebase] FID Change"),Uo.onmessage=n=>{Hw(n.data.key,n.data.fid)}),Uo}function GC(){qw.size===0&&Uo&&(Uo.close(),Uo=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WC="firebase-installations-database",QC=1,Qo="firebase-installations-store";let rp=null;function Gm(){return rp||(rp=$h(WC,QC,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Qo)}}})),rp}async function nh(n,e){const t=Fh(n),s=(await Gm()).transaction(Qo,"readwrite"),i=s.objectStore(Qo),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&zw(n,e.fid),e}async function Kw(n){const e=Fh(n),r=(await Gm()).transaction(Qo,"readwrite");await r.objectStore(Qo).delete(e),await r.done}async function Uh(n,e){const t=Fh(n),s=(await Gm()).transaction(Qo,"readwrite"),i=s.objectStore(Qo),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&zw(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wm(n){let e;const t=await Uh(n.appConfig,r=>{const s=JC(r),i=YC(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===Fp?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function JC(n){const e=n||{fid:qC(),registrationStatus:0};return Gw(e)}function YC(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Wo.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=XC(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:ZC(n)}:{installationEntry:e}}async function XC(n,e){try{const t=await UC(n,e);return nh(n.appConfig,t)}catch(t){throw Mw(t)&&t.customData.serverCode===409?await Kw(n.appConfig):await nh(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function ZC(n){let e=await zy(n.appConfig);for(;e.registrationStatus===1;)await Bw(100),e=await zy(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await Wm(n);return r||t}return e}function zy(n){return Uh(n,e=>{if(!e)throw Wo.create("installation-not-found");return Gw(e)})}function Gw(n){return eR(n)?{fid:n.fid,registrationStatus:0}:n}function eR(n){return n.registrationStatus===1&&n.registrationTime+Nw<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tR({appConfig:n,heartbeatServiceProvider:e},t){const r=nR(n,t),s=LC(n,t),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={installation:{sdkVersion:Vw,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await jw(()=>fetch(r,a));if(l.ok){const c=await l.json();return $w(c)}else throw await Fw("Generate Auth Token",l)}function nR(n,{fid:e}){return`${Lw(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qm(n,e=!1){let t;const r=await Uh(n.appConfig,i=>{if(!Ww(i))throw Wo.create("not-registered");const o=i.authToken;if(!e&&iR(o))return i;if(o.requestStatus===1)return t=rR(n,e),i;{if(!navigator.onLine)throw Wo.create("app-offline");const a=aR(i);return t=sR(n,a),a}});return t?await t:r.authToken}async function rR(n,e){let t=await Hy(n.appConfig);for(;t.authToken.requestStatus===1;)await Bw(100),t=await Hy(n.appConfig);const r=t.authToken;return r.requestStatus===0?Qm(n,e):r}function Hy(n){return Uh(n,e=>{if(!Ww(e))throw Wo.create("not-registered");const t=e.authToken;return lR(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function sR(n,e){try{const t=await tR(n,e),r=Object.assign(Object.assign({},e),{authToken:t});return await nh(n.appConfig,r),t}catch(t){if(Mw(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await Kw(n.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await nh(n.appConfig,r)}throw t}}function Ww(n){return n!==void 0&&n.registrationStatus===2}function iR(n){return n.requestStatus===2&&!oR(n)}function oR(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+NC}function aR(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function lR(n){return n.requestStatus===1&&n.requestTime+Nw<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uR(n){const e=n,{installationEntry:t,registrationPromise:r}=await Wm(e);return r?r.catch(console.error):Qm(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cR(n,e=!1){const t=n;return await dR(t),(await Qm(t,e)).token}async function dR(n){const{registrationPromise:e}=await Wm(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hR(n){if(!n||!n.options)throw sp("App Configuration");if(!n.name)throw sp("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw sp(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function sp(n){return Wo.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qw="installations",fR="installations-internal",pR=n=>{const e=n.getProvider("app").getImmediate(),t=hR(e),r=no(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},mR=n=>{const e=n.getProvider("app").getImmediate(),t=no(e,Qw).getImmediate();return{getId:()=>uR(t),getToken:s=>cR(t,s)}};function gR(){ds(new Kr(Qw,pR,"PUBLIC")),ds(new Kr(fR,mR,"PRIVATE"))}gR();kr(Dw,Km);kr(Dw,Km,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vR="/firebase-messaging-sw.js",yR="/firebase-cloud-messaging-push-scope",Jw="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",_R="https://fcmregistrations.googleapis.com/v1",Yw="google.c.a.c_id",bR="google.c.a.c_l",wR="google.c.a.ts",xR="google.c.a.e";var Ky;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(Ky||(Ky={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var Ju;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(Ju||(Ju={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cs(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function IR(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),s=new Uint8Array(r.length);for(let i=0;i<r.length;++i)s[i]=r.charCodeAt(i);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ip="fcm_token_details_db",ER=5,Gy="fcm_token_object_Store";async function TR(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(i=>i.name).includes(ip))return null;let e=null;return(await $h(ip,ER,{upgrade:async(r,s,i,o)=>{var a;if(s<2||!r.objectStoreNames.contains(Gy))return;const l=o.objectStore(Gy),c=await l.index("fcmSenderId").get(n);if(await l.clear(),!!c){if(s===2){const h=c;if(!h.auth||!h.p256dh||!h.endpoint)return;e={token:h.fcmToken,createTime:(a=h.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:h.auth,p256dh:h.p256dh,endpoint:h.endpoint,swScope:h.swScope,vapidKey:typeof h.vapidKey=="string"?h.vapidKey:Cs(h.vapidKey)}}}else if(s===3){const h=c;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:Cs(h.auth),p256dh:Cs(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:Cs(h.vapidKey)}}}else if(s===4){const h=c;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:Cs(h.auth),p256dh:Cs(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:Cs(h.vapidKey)}}}}}})).close(),await ep(ip),await ep("fcm_vapid_details_db"),await ep("undefined"),AR(e)?e:null}function AR(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SR="firebase-messaging-database",PR=1,Yu="firebase-messaging-store";let op=null;function Xw(){return op||(op=$h(SR,PR,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Yu)}}})),op}async function CR(n){const e=Zw(n),r=await(await Xw()).transaction(Yu).objectStore(Yu).get(e);if(r)return r;{const s=await TR(n.appConfig.senderId);if(s)return await Jm(n,s),s}}async function Jm(n,e){const t=Zw(n),s=(await Xw()).transaction(Yu,"readwrite");return await s.objectStore(Yu).put(e,t),await s.done,e}function Zw({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RR={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},tr=new oa("messaging","Messaging",RR);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kR(n,e){const t=await Xm(n),r=ex(e),s={method:"POST",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(Ym(n.appConfig),s)).json()}catch(o){throw tr.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw tr.create("token-subscribe-failed",{errorInfo:o})}if(!i.token)throw tr.create("token-subscribe-no-token");return i.token}async function DR(n,e){const t=await Xm(n),r=ex(e.subscriptionOptions),s={method:"PATCH",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(`${Ym(n.appConfig)}/${e.token}`,s)).json()}catch(o){throw tr.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw tr.create("token-update-failed",{errorInfo:o})}if(!i.token)throw tr.create("token-update-no-token");return i.token}async function NR(n,e){const r={method:"DELETE",headers:await Xm(n)};try{const i=await(await fetch(`${Ym(n.appConfig)}/${e}`,r)).json();if(i.error){const o=i.error.message;throw tr.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw tr.create("token-unsubscribe-failed",{errorInfo:s==null?void 0:s.toString()})}}function Ym({projectId:n}){return`${_R}/projects/${n}/registrations`}async function Xm({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function ex({p256dh:n,auth:e,endpoint:t,vapidKey:r}){const s={web:{endpoint:t,auth:e,p256dh:n}};return r!==Jw&&(s.web.applicationPubKey=r),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VR=7*24*60*60*1e3;async function OR(n){const e=await LR(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:Cs(e.getKey("auth")),p256dh:Cs(e.getKey("p256dh"))},r=await CR(n.firebaseDependencies);if(r){if($R(r.subscriptionOptions,t))return Date.now()>=r.createTime+VR?MR(n,{token:r.token,createTime:Date.now(),subscriptionOptions:t}):r.token;try{await NR(n.firebaseDependencies,r.token)}catch(s){console.warn(s)}return Wy(n.firebaseDependencies,t)}else return Wy(n.firebaseDependencies,t)}async function MR(n,e){try{const t=await DR(n.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await Jm(n.firebaseDependencies,r),t}catch(t){throw t}}async function Wy(n,e){const r={token:await kR(n,e),createTime:Date.now(),subscriptionOptions:e};return await Jm(n,r),r.token}async function LR(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:IR(e)})}function $R(n,e){const t=e.vapidKey===n.vapidKey,r=e.endpoint===n.endpoint,s=e.auth===n.auth,i=e.p256dh===n.p256dh;return t&&r&&s&&i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qy(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return FR(e,n),UR(e,n),jR(e,n),e}function FR(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const r=e.notification.body;r&&(n.notification.body=r);const s=e.notification.image;s&&(n.notification.image=s);const i=e.notification.icon;i&&(n.notification.icon=i)}function UR(n,e){e.data&&(n.data=e.data)}function jR(n,e){var t,r,s,i,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(s=(r=e.fcmOptions)===null||r===void 0?void 0:r.link)!==null&&s!==void 0?s:(i=e.notification)===null||i===void 0?void 0:i.click_action;a&&(n.fcmOptions.link=a);const l=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;l&&(n.fcmOptions.analyticsLabel=l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BR(n){return typeof n=="object"&&!!n&&Yw in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */qR("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function qR(n,e){const t=[];for(let r=0;r<n.length;r++)t.push(n.charAt(r)),r<e.length&&t.push(e.charAt(r));return t.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zR(n){if(!n||!n.options)throw ap("App Configuration Object");if(!n.name)throw ap("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const r of e)if(!t[r])throw ap(r);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function ap(n){return tr.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HR{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=zR(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KR(n){try{n.swRegistration=await navigator.serviceWorker.register(vR,{scope:yR}),n.swRegistration.update().catch(()=>{})}catch(e){throw tr.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GR(n,e){if(!e&&!n.swRegistration&&await KR(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw tr.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WR(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=Jw)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tx(n,e){if(!navigator)throw tr.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw tr.create("permission-blocked");return await WR(n,e==null?void 0:e.vapidKey),await GR(n,e==null?void 0:e.serviceWorkerRegistration),OR(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QR(n,e,t){const r=JR(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:t[Yw],message_name:t[bR],message_time:t[wR],message_device_time:Math.floor(Date.now()/1e3)})}function JR(n){switch(n){case Ju.NOTIFICATION_CLICKED:return"notification_open";case Ju.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YR(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===Ju.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(Qy(t)):n.onMessageHandler.next(Qy(t)));const r=t.data;BR(r)&&r[xR]==="1"&&await QR(n,t.messageType,r)}const Jy="@firebase/messaging",Yy="0.12.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XR=n=>{const e=new HR(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>YR(e,t)),e},ZR=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:r=>tx(e,r)}};function ek(){ds(new Kr("messaging",XR,"PUBLIC")),ds(new Kr("messaging-internal",ZR,"PRIVATE")),kr(Jy,Yy),kr(Jy,Yy,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nx(){try{await Aw()}catch{return!1}return typeof window<"u"&&Bm()&&vP()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rx(n=Hm()){return nx().then(e=>{if(!e)throw tr.create("unsupported-browser")},e=>{throw tr.create("indexed-db-unsupported")}),no(je(n),"messaging").getImmediate()}async function sx(n,e){return n=je(n),tx(n,e)}ek();var tk="firebase",nk="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */kr(tk,nk,"app");var Xy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var zo,ix;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(E,_){function x(){}x.prototype=_.prototype,E.D=_.prototype,E.prototype=new x,E.prototype.constructor=E,E.C=function(R,M,k){for(var P=Array(arguments.length-2),Qe=2;Qe<arguments.length;Qe++)P[Qe-2]=arguments[Qe];return _.prototype[M].apply(R,P)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,_,x){x||(x=0);var R=Array(16);if(typeof _=="string")for(var M=0;16>M;++M)R[M]=_.charCodeAt(x++)|_.charCodeAt(x++)<<8|_.charCodeAt(x++)<<16|_.charCodeAt(x++)<<24;else for(M=0;16>M;++M)R[M]=_[x++]|_[x++]<<8|_[x++]<<16|_[x++]<<24;_=E.g[0],x=E.g[1],M=E.g[2];var k=E.g[3],P=_+(k^x&(M^k))+R[0]+3614090360&4294967295;_=x+(P<<7&4294967295|P>>>25),P=k+(M^_&(x^M))+R[1]+3905402710&4294967295,k=_+(P<<12&4294967295|P>>>20),P=M+(x^k&(_^x))+R[2]+606105819&4294967295,M=k+(P<<17&4294967295|P>>>15),P=x+(_^M&(k^_))+R[3]+3250441966&4294967295,x=M+(P<<22&4294967295|P>>>10),P=_+(k^x&(M^k))+R[4]+4118548399&4294967295,_=x+(P<<7&4294967295|P>>>25),P=k+(M^_&(x^M))+R[5]+1200080426&4294967295,k=_+(P<<12&4294967295|P>>>20),P=M+(x^k&(_^x))+R[6]+2821735955&4294967295,M=k+(P<<17&4294967295|P>>>15),P=x+(_^M&(k^_))+R[7]+4249261313&4294967295,x=M+(P<<22&4294967295|P>>>10),P=_+(k^x&(M^k))+R[8]+1770035416&4294967295,_=x+(P<<7&4294967295|P>>>25),P=k+(M^_&(x^M))+R[9]+2336552879&4294967295,k=_+(P<<12&4294967295|P>>>20),P=M+(x^k&(_^x))+R[10]+4294925233&4294967295,M=k+(P<<17&4294967295|P>>>15),P=x+(_^M&(k^_))+R[11]+2304563134&4294967295,x=M+(P<<22&4294967295|P>>>10),P=_+(k^x&(M^k))+R[12]+1804603682&4294967295,_=x+(P<<7&4294967295|P>>>25),P=k+(M^_&(x^M))+R[13]+4254626195&4294967295,k=_+(P<<12&4294967295|P>>>20),P=M+(x^k&(_^x))+R[14]+2792965006&4294967295,M=k+(P<<17&4294967295|P>>>15),P=x+(_^M&(k^_))+R[15]+1236535329&4294967295,x=M+(P<<22&4294967295|P>>>10),P=_+(M^k&(x^M))+R[1]+4129170786&4294967295,_=x+(P<<5&4294967295|P>>>27),P=k+(x^M&(_^x))+R[6]+3225465664&4294967295,k=_+(P<<9&4294967295|P>>>23),P=M+(_^x&(k^_))+R[11]+643717713&4294967295,M=k+(P<<14&4294967295|P>>>18),P=x+(k^_&(M^k))+R[0]+3921069994&4294967295,x=M+(P<<20&4294967295|P>>>12),P=_+(M^k&(x^M))+R[5]+3593408605&4294967295,_=x+(P<<5&4294967295|P>>>27),P=k+(x^M&(_^x))+R[10]+38016083&4294967295,k=_+(P<<9&4294967295|P>>>23),P=M+(_^x&(k^_))+R[15]+3634488961&4294967295,M=k+(P<<14&4294967295|P>>>18),P=x+(k^_&(M^k))+R[4]+3889429448&4294967295,x=M+(P<<20&4294967295|P>>>12),P=_+(M^k&(x^M))+R[9]+568446438&4294967295,_=x+(P<<5&4294967295|P>>>27),P=k+(x^M&(_^x))+R[14]+3275163606&4294967295,k=_+(P<<9&4294967295|P>>>23),P=M+(_^x&(k^_))+R[3]+4107603335&4294967295,M=k+(P<<14&4294967295|P>>>18),P=x+(k^_&(M^k))+R[8]+1163531501&4294967295,x=M+(P<<20&4294967295|P>>>12),P=_+(M^k&(x^M))+R[13]+2850285829&4294967295,_=x+(P<<5&4294967295|P>>>27),P=k+(x^M&(_^x))+R[2]+4243563512&4294967295,k=_+(P<<9&4294967295|P>>>23),P=M+(_^x&(k^_))+R[7]+1735328473&4294967295,M=k+(P<<14&4294967295|P>>>18),P=x+(k^_&(M^k))+R[12]+2368359562&4294967295,x=M+(P<<20&4294967295|P>>>12),P=_+(x^M^k)+R[5]+4294588738&4294967295,_=x+(P<<4&4294967295|P>>>28),P=k+(_^x^M)+R[8]+2272392833&4294967295,k=_+(P<<11&4294967295|P>>>21),P=M+(k^_^x)+R[11]+1839030562&4294967295,M=k+(P<<16&4294967295|P>>>16),P=x+(M^k^_)+R[14]+4259657740&4294967295,x=M+(P<<23&4294967295|P>>>9),P=_+(x^M^k)+R[1]+2763975236&4294967295,_=x+(P<<4&4294967295|P>>>28),P=k+(_^x^M)+R[4]+1272893353&4294967295,k=_+(P<<11&4294967295|P>>>21),P=M+(k^_^x)+R[7]+4139469664&4294967295,M=k+(P<<16&4294967295|P>>>16),P=x+(M^k^_)+R[10]+3200236656&4294967295,x=M+(P<<23&4294967295|P>>>9),P=_+(x^M^k)+R[13]+681279174&4294967295,_=x+(P<<4&4294967295|P>>>28),P=k+(_^x^M)+R[0]+3936430074&4294967295,k=_+(P<<11&4294967295|P>>>21),P=M+(k^_^x)+R[3]+3572445317&4294967295,M=k+(P<<16&4294967295|P>>>16),P=x+(M^k^_)+R[6]+76029189&4294967295,x=M+(P<<23&4294967295|P>>>9),P=_+(x^M^k)+R[9]+3654602809&4294967295,_=x+(P<<4&4294967295|P>>>28),P=k+(_^x^M)+R[12]+3873151461&4294967295,k=_+(P<<11&4294967295|P>>>21),P=M+(k^_^x)+R[15]+530742520&4294967295,M=k+(P<<16&4294967295|P>>>16),P=x+(M^k^_)+R[2]+3299628645&4294967295,x=M+(P<<23&4294967295|P>>>9),P=_+(M^(x|~k))+R[0]+4096336452&4294967295,_=x+(P<<6&4294967295|P>>>26),P=k+(x^(_|~M))+R[7]+1126891415&4294967295,k=_+(P<<10&4294967295|P>>>22),P=M+(_^(k|~x))+R[14]+2878612391&4294967295,M=k+(P<<15&4294967295|P>>>17),P=x+(k^(M|~_))+R[5]+4237533241&4294967295,x=M+(P<<21&4294967295|P>>>11),P=_+(M^(x|~k))+R[12]+1700485571&4294967295,_=x+(P<<6&4294967295|P>>>26),P=k+(x^(_|~M))+R[3]+2399980690&4294967295,k=_+(P<<10&4294967295|P>>>22),P=M+(_^(k|~x))+R[10]+4293915773&4294967295,M=k+(P<<15&4294967295|P>>>17),P=x+(k^(M|~_))+R[1]+2240044497&4294967295,x=M+(P<<21&4294967295|P>>>11),P=_+(M^(x|~k))+R[8]+1873313359&4294967295,_=x+(P<<6&4294967295|P>>>26),P=k+(x^(_|~M))+R[15]+4264355552&4294967295,k=_+(P<<10&4294967295|P>>>22),P=M+(_^(k|~x))+R[6]+2734768916&4294967295,M=k+(P<<15&4294967295|P>>>17),P=x+(k^(M|~_))+R[13]+1309151649&4294967295,x=M+(P<<21&4294967295|P>>>11),P=_+(M^(x|~k))+R[4]+4149444226&4294967295,_=x+(P<<6&4294967295|P>>>26),P=k+(x^(_|~M))+R[11]+3174756917&4294967295,k=_+(P<<10&4294967295|P>>>22),P=M+(_^(k|~x))+R[2]+718787259&4294967295,M=k+(P<<15&4294967295|P>>>17),P=x+(k^(M|~_))+R[9]+3951481745&4294967295,E.g[0]=E.g[0]+_&4294967295,E.g[1]=E.g[1]+(M+(P<<21&4294967295|P>>>11))&4294967295,E.g[2]=E.g[2]+M&4294967295,E.g[3]=E.g[3]+k&4294967295}r.prototype.u=function(E,_){_===void 0&&(_=E.length);for(var x=_-this.blockSize,R=this.B,M=this.h,k=0;k<_;){if(M==0)for(;k<=x;)s(this,E,k),k+=this.blockSize;if(typeof E=="string"){for(;k<_;)if(R[M++]=E.charCodeAt(k++),M==this.blockSize){s(this,R),M=0;break}}else for(;k<_;)if(R[M++]=E[k++],M==this.blockSize){s(this,R),M=0;break}}this.h=M,this.o+=_},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var _=1;_<E.length-8;++_)E[_]=0;var x=8*this.o;for(_=E.length-8;_<E.length;++_)E[_]=x&255,x/=256;for(this.u(E),E=Array(16),_=x=0;4>_;++_)for(var R=0;32>R;R+=8)E[x++]=this.g[_]>>>R&255;return E};function i(E,_){var x=a;return Object.prototype.hasOwnProperty.call(x,E)?x[E]:x[E]=_(E)}function o(E,_){this.h=_;for(var x=[],R=!0,M=E.length-1;0<=M;M--){var k=E[M]|0;R&&k==_||(x[M]=k,R=!1)}this.g=x}var a={};function l(E){return-128<=E&&128>E?i(E,function(_){return new o([_|0],0>_?-1:0)}):new o([E|0],0>E?-1:0)}function c(E){if(isNaN(E)||!isFinite(E))return f;if(0>E)return A(c(-E));for(var _=[],x=1,R=0;E>=x;R++)_[R]=E/x|0,x*=4294967296;return new o(_,0)}function h(E,_){if(E.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(E.charAt(0)=="-")return A(h(E.substring(1),_));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var x=c(Math.pow(_,8)),R=f,M=0;M<E.length;M+=8){var k=Math.min(8,E.length-M),P=parseInt(E.substring(M,M+k),_);8>k?(k=c(Math.pow(_,k)),R=R.j(k).add(c(P))):(R=R.j(x),R=R.add(c(P)))}return R}var f=l(0),g=l(1),v=l(16777216);n=o.prototype,n.m=function(){if(T(this))return-A(this).m();for(var E=0,_=1,x=0;x<this.g.length;x++){var R=this.i(x);E+=(0<=R?R:4294967296+R)*_,_*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(I(this))return"0";if(T(this))return"-"+A(this).toString(E);for(var _=c(Math.pow(E,6)),x=this,R="";;){var M=$(x,_).g;x=F(x,M.j(_));var k=((0<x.g.length?x.g[0]:x.h)>>>0).toString(E);if(x=M,I(x))return k+R;for(;6>k.length;)k="0"+k;R=k+R}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function I(E){if(E.h!=0)return!1;for(var _=0;_<E.g.length;_++)if(E.g[_]!=0)return!1;return!0}function T(E){return E.h==-1}n.l=function(E){return E=F(this,E),T(E)?-1:I(E)?0:1};function A(E){for(var _=E.g.length,x=[],R=0;R<_;R++)x[R]=~E.g[R];return new o(x,~E.h).add(g)}n.abs=function(){return T(this)?A(this):this},n.add=function(E){for(var _=Math.max(this.g.length,E.g.length),x=[],R=0,M=0;M<=_;M++){var k=R+(this.i(M)&65535)+(E.i(M)&65535),P=(k>>>16)+(this.i(M)>>>16)+(E.i(M)>>>16);R=P>>>16,k&=65535,P&=65535,x[M]=P<<16|k}return new o(x,x[x.length-1]&-2147483648?-1:0)};function F(E,_){return E.add(A(_))}n.j=function(E){if(I(this)||I(E))return f;if(T(this))return T(E)?A(this).j(A(E)):A(A(this).j(E));if(T(E))return A(this.j(A(E)));if(0>this.l(v)&&0>E.l(v))return c(this.m()*E.m());for(var _=this.g.length+E.g.length,x=[],R=0;R<2*_;R++)x[R]=0;for(R=0;R<this.g.length;R++)for(var M=0;M<E.g.length;M++){var k=this.i(R)>>>16,P=this.i(R)&65535,Qe=E.i(M)>>>16,nt=E.i(M)&65535;x[2*R+2*M]+=P*nt,U(x,2*R+2*M),x[2*R+2*M+1]+=k*nt,U(x,2*R+2*M+1),x[2*R+2*M+1]+=P*Qe,U(x,2*R+2*M+1),x[2*R+2*M+2]+=k*Qe,U(x,2*R+2*M+2)}for(R=0;R<_;R++)x[R]=x[2*R+1]<<16|x[2*R];for(R=_;R<2*_;R++)x[R]=0;return new o(x,0)};function U(E,_){for(;(E[_]&65535)!=E[_];)E[_+1]+=E[_]>>>16,E[_]&=65535,_++}function L(E,_){this.g=E,this.h=_}function $(E,_){if(I(_))throw Error("division by zero");if(I(E))return new L(f,f);if(T(E))return _=$(A(E),_),new L(A(_.g),A(_.h));if(T(_))return _=$(E,A(_)),new L(A(_.g),_.h);if(30<E.g.length){if(T(E)||T(_))throw Error("slowDivide_ only works with positive integers.");for(var x=g,R=_;0>=R.l(E);)x=ue(x),R=ue(R);var M=se(x,1),k=se(R,1);for(R=se(R,2),x=se(x,2);!I(R);){var P=k.add(R);0>=P.l(E)&&(M=M.add(x),k=P),R=se(R,1),x=se(x,1)}return _=F(E,M.j(_)),new L(M,_)}for(M=f;0<=E.l(_);){for(x=Math.max(1,Math.floor(E.m()/_.m())),R=Math.ceil(Math.log(x)/Math.LN2),R=48>=R?1:Math.pow(2,R-48),k=c(x),P=k.j(_);T(P)||0<P.l(E);)x-=R,k=c(x),P=k.j(_);I(k)&&(k=g),M=M.add(k),E=F(E,P)}return new L(M,E)}n.A=function(E){return $(this,E).h},n.and=function(E){for(var _=Math.max(this.g.length,E.g.length),x=[],R=0;R<_;R++)x[R]=this.i(R)&E.i(R);return new o(x,this.h&E.h)},n.or=function(E){for(var _=Math.max(this.g.length,E.g.length),x=[],R=0;R<_;R++)x[R]=this.i(R)|E.i(R);return new o(x,this.h|E.h)},n.xor=function(E){for(var _=Math.max(this.g.length,E.g.length),x=[],R=0;R<_;R++)x[R]=this.i(R)^E.i(R);return new o(x,this.h^E.h)};function ue(E){for(var _=E.g.length+1,x=[],R=0;R<_;R++)x[R]=E.i(R)<<1|E.i(R-1)>>>31;return new o(x,E.h)}function se(E,_){var x=_>>5;_%=32;for(var R=E.g.length-x,M=[],k=0;k<R;k++)M[k]=0<_?E.i(k+x)>>>_|E.i(k+x+1)<<32-_:E.i(k+x);return new o(M,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,ix=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=h,zo=o}).apply(typeof Xy<"u"?Xy:typeof self<"u"?self:typeof window<"u"?window:{});var pd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ox,vu,ax,kd,Up,lx,ux,cx;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,y){return u==Array.prototype||u==Object.prototype||(u[p]=y.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof pd=="object"&&pd];for(var p=0;p<u.length;++p){var y=u[p];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var y=r;u=u.split(".");for(var w=0;w<u.length-1;w++){var B=u[w];if(!(B in y))break e;y=y[B]}u=u[u.length-1],w=y[u],p=p(w),p!=w&&p!=null&&e(y,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var y=0,w=!1,B={next:function(){if(!w&&y<u.length){var Y=y++;return{value:p(Y,u[Y]),done:!1}}return w=!0,{done:!0,value:void 0}}};return B[Symbol.iterator]=function(){return B},B}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,y){return y})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function c(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function h(u,p,y){return u.call.apply(u.bind,arguments)}function f(u,p,y){if(!u)throw Error();if(2<arguments.length){var w=Array.prototype.slice.call(arguments,2);return function(){var B=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(B,w),u.apply(p,B)}}return function(){return u.apply(p,arguments)}}function g(u,p,y){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,g.apply(null,arguments)}function v(u,p){var y=Array.prototype.slice.call(arguments,1);return function(){var w=y.slice();return w.push.apply(w,arguments),u.apply(this,w)}}function I(u,p){function y(){}y.prototype=p.prototype,u.aa=p.prototype,u.prototype=new y,u.prototype.constructor=u,u.Qb=function(w,B,Y){for(var Se=Array(arguments.length-2),xt=2;xt<arguments.length;xt++)Se[xt-2]=arguments[xt];return p.prototype[B].apply(w,Se)}}function T(u){const p=u.length;if(0<p){const y=Array(p);for(let w=0;w<p;w++)y[w]=u[w];return y}return[]}function A(u,p){for(let y=1;y<arguments.length;y++){const w=arguments[y];if(l(w)){const B=u.length||0,Y=w.length||0;u.length=B+Y;for(let Se=0;Se<Y;Se++)u[B+Se]=w[Se]}else u.push(w)}}class F{constructor(p,y){this.i=p,this.j=y,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function U(u){return/^[\s\xa0]*$/.test(u)}function L(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function $(u){return $[" "](u),u}$[" "]=function(){};var ue=L().indexOf("Gecko")!=-1&&!(L().toLowerCase().indexOf("webkit")!=-1&&L().indexOf("Edge")==-1)&&!(L().indexOf("Trident")!=-1||L().indexOf("MSIE")!=-1)&&L().indexOf("Edge")==-1;function se(u,p,y){for(const w in u)p.call(y,u[w],w,u)}function E(u,p){for(const y in u)p.call(void 0,u[y],y,u)}function _(u){const p={};for(const y in u)p[y]=u[y];return p}const x="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function R(u,p){let y,w;for(let B=1;B<arguments.length;B++){w=arguments[B];for(y in w)u[y]=w[y];for(let Y=0;Y<x.length;Y++)y=x[Y],Object.prototype.hasOwnProperty.call(w,y)&&(u[y]=w[y])}}function M(u){var p=1;u=u.split(":");const y=[];for(;0<p&&u.length;)y.push(u.shift()),p--;return u.length&&y.push(u.join(":")),y}function k(u){a.setTimeout(()=>{throw u},0)}function P(){var u=ie;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class Qe{constructor(){this.h=this.g=null}add(p,y){const w=nt.get();w.set(p,y),this.h?this.h.next=w:this.g=w,this.h=w}}var nt=new F(()=>new be,u=>u.reset());class be{constructor(){this.next=this.g=this.h=null}set(p,y){this.h=p,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let ne,ae=!1,ie=new Qe,ke=()=>{const u=a.Promise.resolve(void 0);ne=()=>{u.then(Z)}};var Z=()=>{for(var u;u=P();){try{u.h.call(u.g)}catch(y){k(y)}var p=nt;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}ae=!1};function Q(){this.s=this.s,this.C=this.C}Q.prototype.s=!1,Q.prototype.ma=function(){this.s||(this.s=!0,this.N())},Q.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ee(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}Ee.prototype.h=function(){this.defaultPrevented=!0};var Je=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const y=()=>{};a.addEventListener("test",y,p),a.removeEventListener("test",y,p)}catch{}return u}();function ct(u,p){if(Ee.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var y=this.type=u.type,w=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(ue){e:{try{$(p.nodeName);var B=!0;break e}catch{}B=!1}B||(p=null)}}else y=="mouseover"?p=u.fromElement:y=="mouseout"&&(p=u.toElement);this.relatedTarget=p,w?(this.clientX=w.clientX!==void 0?w.clientX:w.pageX,this.clientY=w.clientY!==void 0?w.clientY:w.pageY,this.screenX=w.screenX||0,this.screenY=w.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:Ot[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&ct.aa.h.call(this)}}I(ct,Ee);var Ot={2:"touch",3:"pen",4:"mouse"};ct.prototype.h=function(){ct.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var X="closure_listenable_"+(1e6*Math.random()|0),Ae=0;function xe(u,p,y,w,B){this.listener=u,this.proxy=null,this.src=p,this.type=y,this.capture=!!w,this.ha=B,this.key=++Ae,this.da=this.fa=!1}function Ve(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function rt(u){this.src=u,this.g={},this.h=0}rt.prototype.add=function(u,p,y,w,B){var Y=u.toString();u=this.g[Y],u||(u=this.g[Y]=[],this.h++);var Se=S(u,p,w,B);return-1<Se?(p=u[Se],y||(p.fa=!1)):(p=new xe(p,this.src,Y,!!w,B),p.fa=y,u.push(p)),p};function dt(u,p){var y=p.type;if(y in u.g){var w=u.g[y],B=Array.prototype.indexOf.call(w,p,void 0),Y;(Y=0<=B)&&Array.prototype.splice.call(w,B,1),Y&&(Ve(p),u.g[y].length==0&&(delete u.g[y],u.h--))}}function S(u,p,y,w){for(var B=0;B<u.length;++B){var Y=u[B];if(!Y.da&&Y.listener==p&&Y.capture==!!y&&Y.ha==w)return B}return-1}var N="closure_lm_"+(1e6*Math.random()|0),K={};function G(u,p,y,w,B){if(w&&w.once)return we(u,p,y,w,B);if(Array.isArray(p)){for(var Y=0;Y<p.length;Y++)G(u,p[Y],y,w,B);return null}return y=j(y),u&&u[X]?u.K(p,y,c(w)?!!w.capture:!!w,B):te(u,p,y,!1,w,B)}function te(u,p,y,w,B,Y){if(!p)throw Error("Invalid event type");var Se=c(B)?!!B.capture:!!B,xt=Re(u);if(xt||(u[N]=xt=new rt(u)),y=xt.add(p,y,w,Se,Y),y.proxy)return y;if(w=de(),y.proxy=w,w.src=u,w.listener=y,u.addEventListener)Je||(B=Se),B===void 0&&(B=!1),u.addEventListener(p.toString(),w,B);else if(u.attachEvent)u.attachEvent(ye(p.toString()),w);else if(u.addListener&&u.removeListener)u.addListener(w);else throw Error("addEventListener and attachEvent are unavailable.");return y}function de(){function u(y){return p.call(u.src,u.listener,y)}const p=$e;return u}function we(u,p,y,w,B){if(Array.isArray(p)){for(var Y=0;Y<p.length;Y++)we(u,p[Y],y,w,B);return null}return y=j(y),u&&u[X]?u.L(p,y,c(w)?!!w.capture:!!w,B):te(u,p,y,!0,w,B)}function _e(u,p,y,w,B){if(Array.isArray(p))for(var Y=0;Y<p.length;Y++)_e(u,p[Y],y,w,B);else w=c(w)?!!w.capture:!!w,y=j(y),u&&u[X]?(u=u.i,p=String(p).toString(),p in u.g&&(Y=u.g[p],y=S(Y,y,w,B),-1<y&&(Ve(Y[y]),Array.prototype.splice.call(Y,y,1),Y.length==0&&(delete u.g[p],u.h--)))):u&&(u=Re(u))&&(p=u.g[p.toString()],u=-1,p&&(u=S(p,y,w,B)),(y=-1<u?p[u]:null)&&Ie(y))}function Ie(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[X])dt(p.i,u);else{var y=u.type,w=u.proxy;p.removeEventListener?p.removeEventListener(y,w,u.capture):p.detachEvent?p.detachEvent(ye(y),w):p.addListener&&p.removeListener&&p.removeListener(w),(y=Re(p))?(dt(y,u),y.h==0&&(y.src=null,p[N]=null)):Ve(u)}}}function ye(u){return u in K?K[u]:K[u]="on"+u}function $e(u,p){if(u.da)u=!0;else{p=new ct(p,this);var y=u.listener,w=u.ha||u.src;u.fa&&Ie(u),u=y.call(w,p)}return u}function Re(u){return u=u[N],u instanceof rt?u:null}var q="__closure_events_fn_"+(1e9*Math.random()>>>0);function j(u){return typeof u=="function"?u:(u[q]||(u[q]=function(p){return u.handleEvent(p)}),u[q])}function ge(){Q.call(this),this.i=new rt(this),this.M=this,this.F=null}I(ge,Q),ge.prototype[X]=!0,ge.prototype.removeEventListener=function(u,p,y,w){_e(this,u,p,y,w)};function he(u,p){var y,w=u.F;if(w)for(y=[];w;w=w.F)y.push(w);if(u=u.M,w=p.type||p,typeof p=="string")p=new Ee(p,u);else if(p instanceof Ee)p.target=p.target||u;else{var B=p;p=new Ee(w,u),R(p,B)}if(B=!0,y)for(var Y=y.length-1;0<=Y;Y--){var Se=p.g=y[Y];B=De(Se,w,!0,p)&&B}if(Se=p.g=u,B=De(Se,w,!0,p)&&B,B=De(Se,w,!1,p)&&B,y)for(Y=0;Y<y.length;Y++)Se=p.g=y[Y],B=De(Se,w,!1,p)&&B}ge.prototype.N=function(){if(ge.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var y=u.g[p],w=0;w<y.length;w++)Ve(y[w]);delete u.g[p],u.h--}}this.F=null},ge.prototype.K=function(u,p,y,w){return this.i.add(String(u),p,!1,y,w)},ge.prototype.L=function(u,p,y,w){return this.i.add(String(u),p,!0,y,w)};function De(u,p,y,w){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var B=!0,Y=0;Y<p.length;++Y){var Se=p[Y];if(Se&&!Se.da&&Se.capture==y){var xt=Se.listener,wn=Se.ha||Se.src;Se.fa&&dt(u.i,Se),B=xt.call(wn,w)!==!1&&B}}return B&&!w.defaultPrevented}function We(u,p,y){if(typeof u=="function")y&&(u=g(u,y));else if(u&&typeof u.handleEvent=="function")u=g(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(u,p||0)}function Ze(u){u.g=We(()=>{u.g=null,u.i&&(u.i=!1,Ze(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class gt extends Q{constructor(p,y){super(),this.m=p,this.l=y,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Ze(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Mt(u){Q.call(this),this.h=u,this.g={}}I(Mt,Q);var Er=[];function Tr(u){se(u.g,function(p,y){this.g.hasOwnProperty(y)&&Ie(p)},u),u.g={}}Mt.prototype.N=function(){Mt.aa.N.call(this),Tr(this)},Mt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Lt=a.JSON.stringify,Bt=a.JSON.parse,jn=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function Ar(){}Ar.prototype.h=null;function Xt(u){return u.h||(u.h=u.i())}function pa(){}var Bn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Nn(){Ee.call(this,"d")}I(Nn,Ee);function ps(){Ee.call(this,"c")}I(ps,Ee);var Or={},lo=null;function ms(){return lo=lo||new ge}Or.La="serverreachability";function uo(u){Ee.call(this,Or.La,u)}I(uo,Ee);function gs(u){const p=ms();he(p,new uo(p))}Or.STAT_EVENT="statevent";function vs(u,p){Ee.call(this,Or.STAT_EVENT,u),this.stat=p}I(vs,Ee);function bn(u){const p=ms();he(p,new vs(p,u))}Or.Ma="timingevent";function co(u,p){Ee.call(this,Or.Ma,u),this.size=p}I(co,Ee);function ys(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function _s(){this.g=!0}_s.prototype.xa=function(){this.g=!1};function Hc(u,p,y,w,B,Y){u.info(function(){if(u.g)if(Y)for(var Se="",xt=Y.split("&"),wn=0;wn<xt.length;wn++){var yt=xt[wn].split("=");if(1<yt.length){var Tn=yt[0];yt=yt[1];var An=Tn.split("_");Se=2<=An.length&&An[1]=="type"?Se+(Tn+"="+yt+"&"):Se+(Tn+"=redacted&")}}else Se=null;else Se=Y;return"XMLHTTP REQ ("+w+") [attempt "+B+"]: "+p+`
`+y+`
`+Se})}function Sf(u,p,y,w,B,Y,Se){u.info(function(){return"XMLHTTP RESP ("+w+") [ attempt "+B+"]: "+p+`
`+y+`
`+Y+" "+Se})}function Wr(u,p,y,w){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+Cf(u,y)+(w?" "+w:"")})}function Pf(u,p){u.info(function(){return"TIMEOUT: "+p})}_s.prototype.info=function(){};function Cf(u,p){if(!u.g)return p;if(!p)return null;try{var y=JSON.parse(p);if(y){for(u=0;u<y.length;u++)if(Array.isArray(y[u])){var w=y[u];if(!(2>w.length)){var B=w[1];if(Array.isArray(B)&&!(1>B.length)){var Y=B[0];if(Y!="noop"&&Y!="stop"&&Y!="close")for(var Se=1;Se<B.length;Se++)B[Se]=""}}}}return Lt(y)}catch{return p}}var ma={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Kc={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ga;function va(){}I(va,Ar),va.prototype.g=function(){return new XMLHttpRequest},va.prototype.i=function(){return{}},ga=new va;function Mr(u,p,y,w){this.j=u,this.i=p,this.l=y,this.R=w||1,this.U=new Mt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Gc}function Gc(){this.i=null,this.g="",this.h=!1}var Bl={},ql={};function Sr(u,p,y){u.L=1,u.v=po(sr(p)),u.m=y,u.P=!0,Qr(u,null)}function Qr(u,p){u.F=Date.now(),pr(u),u.A=sr(u.v);var y=u.A,w=u.R;Array.isArray(w)||(w=[String(w)]),Zc(y.i,"t",w),u.C=0,y=u.j.J,u.h=new Gc,u.g=eu(u.j,y?p:null,!u.m),0<u.O&&(u.M=new gt(g(u.Y,u,u.g),u.O)),p=u.U,y=u.g,w=u.ca;var B="readystatechange";Array.isArray(B)||(B&&(Er[0]=B.toString()),B=Er);for(var Y=0;Y<B.length;Y++){var Se=G(y,B[Y],w||p.handleEvent,!1,p.h||p);if(!Se)break;p.g[Se.key]=Se}p=u.H?_(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),gs(),Hc(u.i,u.u,u.A,u.l,u.R,u.m)}Mr.prototype.ca=function(u){u=u.target;const p=this.M;p&&un(u)==3?p.j():this.Y(u)},Mr.prototype.Y=function(u){try{if(u==this.g)e:{const An=un(this.g);var p=this.g.Ba();const yi=this.g.Z();if(!(3>An)&&(An!=3||this.g&&(this.h.h||this.g.oa()||td(this.g)))){this.J||An!=4||p==7||(p==8||0>=yi?gs(3):gs(2)),oi(this);var y=this.g.Z();this.X=y;t:if(Lr(this)){var w=td(this.g);u="";var B=w.length,Y=un(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){bs(this),$r(this);var Se="";break t}this.h.i=new a.TextDecoder}for(p=0;p<B;p++)this.h.h=!0,u+=this.h.i.decode(w[p],{stream:!(Y&&p==B-1)});w.length=0,this.h.g+=u,this.C=0,Se=this.h.g}else Se=this.g.oa();if(this.o=y==200,Sf(this.i,this.u,this.A,this.l,this.R,An,y),this.o){if(this.T&&!this.K){t:{if(this.g){var xt,wn=this.g;if((xt=wn.g?wn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(xt)){var yt=xt;break t}}yt=null}if(y=yt)Wr(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,rr(this,y);else{this.o=!1,this.s=3,bn(12),bs(this),$r(this);break e}}if(this.P){y=!0;let vr;for(;!this.J&&this.C<Se.length;)if(vr=ii(this,Se),vr==ql){An==4&&(this.s=4,bn(14),y=!1),Wr(this.i,this.l,null,"[Incomplete Response]");break}else if(vr==Bl){this.s=4,bn(15),Wr(this.i,this.l,Se,"[Invalid Chunk]"),y=!1;break}else Wr(this.i,this.l,vr,null),rr(this,vr);if(Lr(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),An!=4||Se.length!=0||this.h.h||(this.s=1,bn(16),y=!1),this.o=this.o&&y,!y)Wr(this.i,this.l,Se,"[Invalid Chunked Response]"),bs(this),$r(this);else if(0<Se.length&&!this.W){this.W=!0;var Tn=this.j;Tn.g==this&&Tn.ba&&!Tn.M&&(Tn.j.info("Great, no buffering proxy detected. Bytes received: "+Se.length),Sa(Tn),Tn.M=!0,bn(11))}}else Wr(this.i,this.l,Se,null),rr(this,Se);An==4&&bs(this),this.o&&!this.J&&(An==4?bo(this.j,this):(this.o=!1,pr(this)))}else Jl(this.g),y==400&&0<Se.indexOf("Unknown SID")?(this.s=3,bn(12)):(this.s=0,bn(13)),bs(this),$r(this)}}}catch{}finally{}};function Lr(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function ii(u,p){var y=u.C,w=p.indexOf(`
`,y);return w==-1?ql:(y=Number(p.substring(y,w)),isNaN(y)?Bl:(w+=1,w+y>p.length?ql:(p=p.slice(w,w+y),u.C=w+y,p)))}Mr.prototype.cancel=function(){this.J=!0,bs(this)};function pr(u){u.S=Date.now()+u.I,zl(u,u.I)}function zl(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=ys(g(u.ba,u),p)}function oi(u){u.B&&(a.clearTimeout(u.B),u.B=null)}Mr.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(Pf(this.i,this.A),this.L!=2&&(gs(),bn(17)),bs(this),this.s=2,$r(this)):zl(this,this.S-u)};function $r(u){u.j.G==0||u.J||bo(u.j,u)}function bs(u){oi(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,Tr(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function rr(u,p){try{var y=u.j;if(y.G!=0&&(y.g==u||Vn(y.h,u))){if(!u.K&&Vn(y.h,u)&&y.G==3){try{var w=y.Da.g.parse(p)}catch{w=null}if(Array.isArray(w)&&w.length==3){var B=w;if(B[0]==0){e:if(!y.u){if(y.g)if(y.g.F+3e3<u.F)gi(y),vo(y);else break e;Zl(y),bn(18)}}else y.za=B[1],0<y.za-y.T&&37500>B[2]&&y.F&&y.v==0&&!y.C&&(y.C=ys(g(y.Za,y),6e3));if(1>=Qc(y.h)&&y.ca){try{y.ca()}catch{}y.ca=void 0}}else ts(y,11)}else if((u.K||y.g==u)&&gi(y),!U(p))for(B=y.Da.g.parse(p),p=0;p<B.length;p++){let yt=B[p];if(y.T=yt[0],yt=yt[1],y.G==2)if(yt[0]=="c"){y.K=yt[1],y.ia=yt[2];const Tn=yt[3];Tn!=null&&(y.la=Tn,y.j.info("VER="+y.la));const An=yt[4];An!=null&&(y.Aa=An,y.j.info("SVER="+y.Aa));const yi=yt[5];yi!=null&&typeof yi=="number"&&0<yi&&(w=1.5*yi,y.L=w,y.j.info("backChannelRequestTimeoutMs_="+w)),w=y;const vr=u.g;if(vr){const yr=vr.g?vr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(yr){var Y=w.h;Y.g||yr.indexOf("spdy")==-1&&yr.indexOf("quic")==-1&&yr.indexOf("h2")==-1||(Y.j=Y.l,Y.g=new Set,Y.h&&(ai(Y,Y.h),Y.h=null))}if(w.D){const tu=vr.g?vr.g.getResponseHeader("X-HTTP-Session-Id"):null;tu&&(w.ya=tu,kt(w.I,w.D,tu))}}y.G=3,y.l&&y.l.ua(),y.ba&&(y.R=Date.now()-u.F,y.j.info("Handshake RTT: "+y.R+"ms")),w=y;var Se=u;if(w.qa=id(w,w.J?w.ia:null,w.W),Se.K){mr(w.h,Se);var xt=Se,wn=w.L;wn&&(xt.I=wn),xt.B&&(oi(xt),pr(xt)),w.g=Se}else Aa(w);0<y.i.length&&mi(y)}else yt[0]!="stop"&&yt[0]!="close"||ts(y,7);else y.G==3&&(yt[0]=="stop"||yt[0]=="close"?yt[0]=="stop"?ts(y,7):Yl(y):yt[0]!="noop"&&y.l&&y.l.ta(yt),y.v=0)}}gs(4)}catch{}}var Wc=class{constructor(u,p){this.g=u,this.map=p}};function Hl(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ya(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function Qc(u){return u.h?1:u.g?u.g.size:0}function Vn(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function ai(u,p){u.g?u.g.add(p):u.h=p}function mr(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}Hl.prototype.cancel=function(){if(this.i=Kl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function Kl(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const y of u.g.values())p=p.concat(y.D);return p}return T(u.i)}function Jc(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],y=u.length,w=0;w<y;w++)p.push(u[w]);return p}p=[],y=0;for(w in u)p[y++]=u[w];return p}function ho(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var y=0;y<u;y++)p.push(y);return p}p=[],y=0;for(const w in u)p[y++]=w;return p}}}function li(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var y=ho(u),w=Jc(u),B=w.length,Y=0;Y<B;Y++)p.call(void 0,w[Y],y&&y[Y],u)}var fo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ui(u,p){if(u){u=u.split("&");for(var y=0;y<u.length;y++){var w=u[y].indexOf("="),B=null;if(0<=w){var Y=u[y].substring(0,w);B=u[y].substring(w+1)}else Y=u[y];p(Y,B?decodeURIComponent(B.replace(/\+/g," ")):"")}}}function Jr(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof Jr){this.h=u.h,ir(this,u.j),this.o=u.o,this.g=u.g,_a(this,u.s),this.l=u.l;var p=u.i,y=new di;y.i=p.i,p.g&&(y.g=new Map(p.g),y.h=p.h),Yc(this,y),this.m=u.m}else u&&(p=String(u).match(fo))?(this.h=!1,ir(this,p[1]||"",!0),this.o=Yr(p[2]||""),this.g=Yr(p[3]||"",!0),_a(this,p[4]),this.l=Yr(p[5]||"",!0),Yc(this,p[6]||"",!0),this.m=Yr(p[7]||"")):(this.h=!1,this.i=new di(null,this.h))}Jr.prototype.toString=function(){var u=[],p=this.j;p&&u.push(Xr(p,Ue,!0),":");var y=this.g;return(y||p=="file")&&(u.push("//"),(p=this.o)&&u.push(Xr(p,Ue,!0),"@"),u.push(encodeURIComponent(String(y)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.s,y!=null&&u.push(":",String(y))),(y=this.l)&&(this.g&&y.charAt(0)!="/"&&u.push("/"),u.push(Xr(y,y.charAt(0)=="/"?gr:vt,!0))),(y=this.i.toString())&&u.push("?",y),(y=this.m)&&u.push("#",Xr(y,Rf)),u.join("")};function sr(u){return new Jr(u)}function ir(u,p,y){u.j=y?Yr(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function _a(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function Yc(u,p,y){p instanceof di?(u.i=p,wa(u.i,u.h)):(y||(p=Xr(p,ci)),u.i=new di(p,u.h))}function kt(u,p,y){u.i.set(p,y)}function po(u){return kt(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Yr(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Xr(u,p,y){return typeof u=="string"?(u=encodeURI(u).replace(p,Gl),y&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Gl(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var Ue=/[#\/\?@]/g,vt=/[#\?:]/g,gr=/[#\?]/g,ci=/[#\?@]/g,Rf=/#/g;function di(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Zr(u){u.g||(u.g=new Map,u.h=0,u.i&&ui(u.i,function(p,y){u.add(decodeURIComponent(p.replace(/\+/g," ")),y)}))}n=di.prototype,n.add=function(u,p){Zr(this),this.i=null,u=Pr(this,u);var y=this.g.get(u);return y||this.g.set(u,y=[]),y.push(p),this.h+=1,this};function Xc(u,p){Zr(u),p=Pr(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function ba(u,p){return Zr(u),p=Pr(u,p),u.g.has(p)}n.forEach=function(u,p){Zr(this),this.g.forEach(function(y,w){y.forEach(function(B){u.call(p,B,w,this)},this)},this)},n.na=function(){Zr(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),y=[];for(let w=0;w<p.length;w++){const B=u[w];for(let Y=0;Y<B.length;Y++)y.push(p[w])}return y},n.V=function(u){Zr(this);let p=[];if(typeof u=="string")ba(this,u)&&(p=p.concat(this.g.get(Pr(this,u))));else{u=Array.from(this.g.values());for(let y=0;y<u.length;y++)p=p.concat(u[y])}return p},n.set=function(u,p){return Zr(this),this.i=null,u=Pr(this,u),ba(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function Zc(u,p,y){Xc(u,p),0<y.length&&(u.i=null,u.g.set(Pr(u,p),T(y)),u.h+=y.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var y=0;y<p.length;y++){var w=p[y];const Y=encodeURIComponent(String(w)),Se=this.V(w);for(w=0;w<Se.length;w++){var B=Y;Se[w]!==""&&(B+="="+encodeURIComponent(String(Se[w]))),u.push(B)}}return this.i=u.join("&")};function Pr(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function wa(u,p){p&&!u.j&&(Zr(u),u.i=null,u.g.forEach(function(y,w){var B=w.toLowerCase();w!=B&&(Xc(this,w),Zc(this,B,y))},u)),u.j=p}function hi(u,p){const y=new _s;if(a.Image){const w=new Image;w.onload=v(or,y,"TestLoadImage: loaded",!0,p,w),w.onerror=v(or,y,"TestLoadImage: error",!1,p,w),w.onabort=v(or,y,"TestLoadImage: abort",!1,p,w),w.ontimeout=v(or,y,"TestLoadImage: timeout",!1,p,w),a.setTimeout(function(){w.ontimeout&&w.ontimeout()},1e4),w.src=u}else p(!1)}function fi(u,p){const y=new _s,w=new AbortController,B=setTimeout(()=>{w.abort(),or(y,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:w.signal}).then(Y=>{clearTimeout(B),Y.ok?or(y,"TestPingServer: ok",!0,p):or(y,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(B),or(y,"TestPingServer: error",!1,p)})}function or(u,p,y,w,B){try{B&&(B.onload=null,B.onerror=null,B.onabort=null,B.ontimeout=null),w(y)}catch{}}function mo(){this.g=new jn}function xa(u,p,y){const w=y||"";try{li(u,function(B,Y){let Se=B;c(B)&&(Se=Lt(B)),p.push(w+Y+"="+encodeURIComponent(Se))})}catch(B){throw p.push(w+"type="+encodeURIComponent("_badmap")),B}}function Ia(u){this.l=u.Ub||null,this.j=u.eb||!1}I(Ia,Ar),Ia.prototype.g=function(){return new Ea(this.l,this.j)},Ia.prototype.i=function(u){return function(){return u}}({});function Ea(u,p){ge.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}I(Ea,ge),n=Ea.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,He(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,pi(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,He(this)),this.g&&(this.readyState=3,He(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;ed(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function ed(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?pi(this):He(this),this.readyState==3&&ed(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,pi(this))},n.Qa=function(u){this.g&&(this.response=u,pi(this))},n.ga=function(){this.g&&pi(this)};function pi(u){u.readyState=4,u.l=null,u.j=null,u.v=null,He(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var y=p.next();!y.done;)y=y.value,u.push(y[0]+": "+y[1]),y=p.next();return u.join(`\r
`)};function He(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(Ea.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function ot(u){let p="";return se(u,function(y,w){p+=w,p+=":",p+=y,p+=`\r
`}),p}function Kt(u,p,y){e:{for(w in y){var w=!1;break e}w=!0}w||(y=ot(y),typeof u=="string"?y!=null&&encodeURIComponent(String(y)):kt(u,p,y))}function ze(u){ge.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}I(ze,ge);var kf=/^https?$/i,Wl=["POST","PUT"];n=ze.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,y,w){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ga.g(),this.v=this.o?Xt(this.o):Xt(ga),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(Y){Ql(this,Y);return}if(u=y||"",y=new Map(this.headers),w)if(Object.getPrototypeOf(w)===Object.prototype)for(var B in w)y.set(B,w[B]);else if(typeof w.keys=="function"&&typeof w.get=="function")for(const Y of w.keys())y.set(Y,w.get(Y));else throw Error("Unknown input type for opt_headers: "+String(w));w=Array.from(y.keys()).find(Y=>Y.toLowerCase()=="content-type"),B=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(Wl,p,void 0))||w||B||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Y,Se]of y)this.g.setRequestHeader(Y,Se);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{xs(this),this.u=!0,this.g.send(u),this.u=!1}catch(Y){Ql(this,Y)}};function Ql(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,ws(u),Ta(u)}function ws(u){u.A||(u.A=!0,he(u,"complete"),he(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,he(this,"complete"),he(this,"abort"),Ta(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ta(this,!0)),ze.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?es(this):this.bb())},n.bb=function(){es(this)};function es(u){if(u.h&&typeof o<"u"&&(!u.v[1]||un(u)!=4||u.Z()!=2)){if(u.u&&un(u)==4)We(u.Ea,0,u);else if(he(u,"readystatechange"),un(u)==4){u.h=!1;try{const Se=u.Z();e:switch(Se){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var y;if(!(y=p)){var w;if(w=Se===0){var B=String(u.D).match(fo)[1]||null;!B&&a.self&&a.self.location&&(B=a.self.location.protocol.slice(0,-1)),w=!kf.test(B?B.toLowerCase():"")}y=w}if(y)he(u,"complete"),he(u,"success");else{u.m=6;try{var Y=2<un(u)?u.g.statusText:""}catch{Y=""}u.l=Y+" ["+u.Z()+"]",ws(u)}}finally{Ta(u)}}}}function Ta(u,p){if(u.g){xs(u);const y=u.g,w=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||he(u,"ready");try{y.onreadystatechange=w}catch{}}}function xs(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function un(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<un(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),Bt(p)}};function td(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Jl(u){const p={};u=(u.g&&2<=un(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let w=0;w<u.length;w++){if(U(u[w]))continue;var y=M(u[w]);const B=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const Y=p[B]||[];p[B]=Y,Y.push(y)}E(p,function(w){return w.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function go(u,p,y){return y&&y.internalChannelParams&&y.internalChannelParams[u]||p}function nd(u){this.Aa=0,this.i=[],this.j=new _s,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=go("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=go("baseRetryDelayMs",5e3,u),this.cb=go("retryDelaySeedMs",1e4,u),this.Wa=go("forwardChannelMaxRetries",2,u),this.wa=go("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new Hl(u&&u.concurrentRequestLimit),this.Da=new mo,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=nd.prototype,n.la=8,n.G=1,n.connect=function(u,p,y,w){bn(0),this.W=u,this.H=p||{},y&&w!==void 0&&(this.H.OSID=y,this.H.OAID=w),this.F=this.X,this.I=id(this,null,this.W),mi(this)};function Yl(u){if(yo(u),u.G==3){var p=u.U++,y=sr(u.I);if(kt(y,"SID",u.K),kt(y,"RID",p),kt(y,"TYPE","terminate"),_o(u,y),p=new Mr(u,u.j,p),p.L=2,p.v=po(sr(y)),y=!1,a.navigator&&a.navigator.sendBeacon)try{y=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!y&&a.Image&&(new Image().src=p.v,y=!0),y||(p.g=eu(p.j,null),p.g.ea(p.v)),p.F=Date.now(),pr(p)}sd(u)}function vo(u){u.g&&(Sa(u),u.g.cancel(),u.g=null)}function yo(u){vo(u),u.u&&(a.clearTimeout(u.u),u.u=null),gi(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function mi(u){if(!ya(u.h)&&!u.s){u.s=!0;var p=u.Ga;ne||ke(),ae||(ne(),ae=!0),ie.add(p,u),u.B=0}}function ar(u,p){return Qc(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=ys(g(u.Ga,u,p),wo(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const B=new Mr(this,this.j,u);let Y=this.o;if(this.S&&(Y?(Y=_(Y),R(Y,this.S)):Y=this.S),this.m!==null||this.O||(B.H=Y,Y=null),this.P)e:{for(var p=0,y=0;y<this.i.length;y++){t:{var w=this.i[y];if("__data__"in w.map&&(w=w.map.__data__,typeof w=="string")){w=w.length;break t}w=void 0}if(w===void 0)break;if(p+=w,4096<p){p=y;break e}if(p===4096||y===this.i.length-1){p=y+1;break e}}p=1e3}else p=1e3;p=Xl(this,B,p),y=sr(this.I),kt(y,"RID",u),kt(y,"CVER",22),this.D&&kt(y,"X-HTTP-Session-Id",this.D),_o(this,y),Y&&(this.O?p="headers="+encodeURIComponent(String(ot(Y)))+"&"+p:this.m&&Kt(y,this.m,Y)),ai(this.h,B),this.Ua&&kt(y,"TYPE","init"),this.P?(kt(y,"$req",p),kt(y,"SID","null"),B.T=!0,Sr(B,y,null)):Sr(B,y,p),this.G=2}}else this.G==3&&(u?rd(this,u):this.i.length==0||ya(this.h)||rd(this))};function rd(u,p){var y;p?y=p.l:y=u.U++;const w=sr(u.I);kt(w,"SID",u.K),kt(w,"RID",y),kt(w,"AID",u.T),_o(u,w),u.m&&u.o&&Kt(w,u.m,u.o),y=new Mr(u,u.j,y,u.B+1),u.m===null&&(y.H=u.o),p&&(u.i=p.D.concat(u.i)),p=Xl(u,y,1e3),y.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),ai(u.h,y),Sr(y,w,p)}function _o(u,p){u.H&&se(u.H,function(y,w){kt(p,w,y)}),u.l&&li({},function(y,w){kt(p,w,y)})}function Xl(u,p,y){y=Math.min(u.i.length,y);var w=u.l?g(u.l.Na,u.l,u):null;e:{var B=u.i;let Y=-1;for(;;){const Se=["count="+y];Y==-1?0<y?(Y=B[0].g,Se.push("ofs="+Y)):Y=0:Se.push("ofs="+Y);let xt=!0;for(let wn=0;wn<y;wn++){let yt=B[wn].g;const Tn=B[wn].map;if(yt-=Y,0>yt)Y=Math.max(0,B[wn].g-100),xt=!1;else try{xa(Tn,Se,"req"+yt+"_")}catch{w&&w(Tn)}}if(xt){w=Se.join("&");break e}}}return u=u.i.splice(0,y),p.D=u,w}function Aa(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;ne||ke(),ae||(ne(),ae=!0),ie.add(p,u),u.v=0}}function Zl(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=ys(g(u.Fa,u),wo(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,Is(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=ys(g(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,bn(10),vo(this),Is(this))};function Sa(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function Is(u){u.g=new Mr(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=sr(u.qa);kt(p,"RID","rpc"),kt(p,"SID",u.K),kt(p,"AID",u.T),kt(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&kt(p,"TO",u.ja),kt(p,"TYPE","xmlhttp"),_o(u,p),u.m&&u.o&&Kt(p,u.m,u.o),u.L&&(u.g.I=u.L);var y=u.g;u=u.ia,y.L=1,y.v=po(sr(p)),y.m=null,y.P=!0,Qr(y,u)}n.Za=function(){this.C!=null&&(this.C=null,vo(this),Zl(this),bn(19))};function gi(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function bo(u,p){var y=null;if(u.g==p){gi(u),Sa(u),u.g=null;var w=2}else if(Vn(u.h,p))y=p.D,mr(u.h,p),w=1;else return;if(u.G!=0){if(p.o)if(w==1){y=p.m?p.m.length:0,p=Date.now()-p.F;var B=u.B;w=ms(),he(w,new co(w,y)),mi(u)}else Aa(u);else if(B=p.s,B==3||B==0&&0<p.X||!(w==1&&ar(u,p)||w==2&&Zl(u)))switch(y&&0<y.length&&(p=u.h,p.i=p.i.concat(y)),B){case 1:ts(u,5);break;case 4:ts(u,10);break;case 3:ts(u,6);break;default:ts(u,2)}}}function wo(u,p){let y=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(y*=2),y*p}function ts(u,p){if(u.j.info("Error code "+p),p==2){var y=g(u.fb,u),w=u.Xa;const B=!w;w=new Jr(w||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||ir(w,"https"),po(w),B?hi(w.toString(),y):fi(w.toString(),y)}else bn(2);u.G=0,u.l&&u.l.sa(p),sd(u),yo(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),bn(2)):(this.j.info("Failed to ping google.com"),bn(1))};function sd(u){if(u.G=0,u.ka=[],u.l){const p=Kl(u.h);(p.length!=0||u.i.length!=0)&&(A(u.ka,p),A(u.ka,u.i),u.h.i.length=0,T(u.i),u.i.length=0),u.l.ra()}}function id(u,p,y){var w=y instanceof Jr?sr(y):new Jr(y);if(w.g!="")p&&(w.g=p+"."+w.g),_a(w,w.s);else{var B=a.location;w=B.protocol,p=p?p+"."+B.hostname:B.hostname,B=+B.port;var Y=new Jr(null);w&&ir(Y,w),p&&(Y.g=p),B&&_a(Y,B),y&&(Y.l=y),w=Y}return y=u.D,p=u.ya,y&&p&&kt(w,y,p),kt(w,"VER",u.la),_o(u,w),w}function eu(u,p,y){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new ze(new Ia({eb:y})):new ze(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Pa(){}n=Pa.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Es(){}Es.prototype.g=function(u,p){return new En(u,p)};function En(u,p){ge.call(this),this.g=new nd(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!U(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!U(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new vi(this)}I(En,ge),En.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},En.prototype.close=function(){Yl(this.g)},En.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var y={};y.__data__=u,u=y}else this.u&&(y={},y.__data__=Lt(u),u=y);p.i.push(new Wc(p.Ya++,u)),p.G==3&&mi(p)},En.prototype.N=function(){this.g.l=null,delete this.j,Yl(this.g),delete this.g,En.aa.N.call(this)};function od(u){Nn.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const y in p){u=y;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}I(od,Nn);function ad(){ps.call(this),this.status=1}I(ad,ps);function vi(u){this.g=u}I(vi,Pa),vi.prototype.ua=function(){he(this.g,"a")},vi.prototype.ta=function(u){he(this.g,new od(u))},vi.prototype.sa=function(u){he(this.g,new ad)},vi.prototype.ra=function(){he(this.g,"b")},Es.prototype.createWebChannel=Es.prototype.g,En.prototype.send=En.prototype.o,En.prototype.open=En.prototype.m,En.prototype.close=En.prototype.close,cx=function(){return new Es},ux=function(){return ms()},lx=Or,Up={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ma.NO_ERROR=0,ma.TIMEOUT=8,ma.HTTP_ERROR=6,kd=ma,Kc.COMPLETE="complete",ax=Kc,pa.EventType=Bn,Bn.OPEN="a",Bn.CLOSE="b",Bn.ERROR="c",Bn.MESSAGE="d",ge.prototype.listen=ge.prototype.K,vu=pa,ze.prototype.listenOnce=ze.prototype.L,ze.prototype.getLastError=ze.prototype.Ka,ze.prototype.getLastErrorCode=ze.prototype.Ba,ze.prototype.getStatus=ze.prototype.Z,ze.prototype.getResponseJson=ze.prototype.Oa,ze.prototype.getResponseText=ze.prototype.oa,ze.prototype.send=ze.prototype.ea,ze.prototype.setWithCredentials=ze.prototype.Ha,ox=ze}).apply(typeof pd<"u"?pd:typeof self<"u"?self:typeof window<"u"?window:{});const Zy="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Pn.UNAUTHENTICATED=new Pn(null),Pn.GOOGLE_CREDENTIALS=new Pn("google-credentials-uid"),Pn.FIRST_PARTY=new Pn("first-party-uid"),Pn.MOCK_USER=new Pn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tl="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gi=new qm("@firebase/firestore");function La(){return Gi.logLevel}function U9(n){Gi.setLogLevel(n)}function pe(n,...e){if(Gi.logLevel<=ft.DEBUG){const t=e.map(Zm);Gi.debug(`Firestore (${Tl}): ${n}`,...t)}}function hn(n,...e){if(Gi.logLevel<=ft.ERROR){const t=e.map(Zm);Gi.error(`Firestore (${Tl}): ${n}`,...t)}}function Nr(n,...e){if(Gi.logLevel<=ft.WARN){const t=e.map(Zm);Gi.warn(`Firestore (${Tl}): ${n}`,...t)}}function Zm(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oe(n="Unexpected state"){const e=`FIRESTORE (${Tl}) INTERNAL ASSERTION FAILED: `+n;throw hn(e),new Error(e)}function Le(n,e){n||Oe()}function j9(n,e){n||Oe()}function Ce(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class me extends fs{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dx{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class rk{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Pn.UNAUTHENTICATED))}shutdown(){}}class sk{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class ik{constructor(e){this.t=e,this.currentUser=Pn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Le(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new kn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new kn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{pe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(pe("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new kn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(pe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Le(typeof r.accessToken=="string"),new dx(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Le(e===null||typeof e=="string"),new Pn(e)}}class ok{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Pn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class ak{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new ok(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Pn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class hx{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class lk{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Le(this.o===void 0);const r=i=>{i.error!=null&&pe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,pe("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{pe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):pe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Le(typeof t.token=="string"),this.R=t.token,new hx(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class B9{getToken(){return Promise.resolve(new hx(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uk(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fx{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=uk(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Ye(n,e){return n<e?-1:n>e?1:0}function rl(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function px(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new me(J.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new me(J.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new me(J.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new me(J.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return tn.fromMillis(Date.now())}static fromDate(e){return tn.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new tn(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ye(this.nanoseconds,e.nanoseconds):Ye(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Be{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Be(e)}static min(){return new Be(new tn(0,0))}static max(){return new Be(new tn(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xu{constructor(e,t,r){t===void 0?t=0:t>e.length&&Oe(),r===void 0?r=e.length-t:r>e.length-t&&Oe(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Xu.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Xu?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class pt extends Xu{construct(e,t,r){return new pt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new me(J.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new pt(t)}static emptyPath(){return new pt([])}}const ck=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Jt extends Xu{construct(e,t,r){return new Jt(e,t,r)}static isValidIdentifier(e){return ck.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Jt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Jt(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new me(J.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new me(J.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new me(J.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new me(J.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Jt(t)}static emptyPath(){return new Jt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ne{constructor(e){this.path=e}static fromPath(e){return new Ne(pt.fromString(e))}static fromName(e){return new Ne(pt.fromString(e).popFirst(5))}static empty(){return new Ne(pt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&pt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return pt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ne(new pt(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sl{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function jp(n){return n.fields.find(e=>e.kind===2)}function Do(n){return n.fields.filter(e=>e.kind!==2)}function dk(n,e){let t=Ye(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=hk(n.fields[r],e.fields[r]),t!==0)return t;return Ye(n.fields.length,e.fields.length)}sl.UNKNOWN_ID=-1;class Ho{constructor(e,t){this.fieldPath=e,this.kind=t}}function hk(n,e){const t=Jt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Ye(n.kind,e.kind)}class il{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new il(0,Ir.min())}}function mx(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Be.fromTimestamp(r===1e9?new tn(t+1,0):new tn(t,r));return new Ir(s,Ne.empty(),e)}function gx(n){return new Ir(n.readTime,n.key,-1)}class Ir{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Ir(Be.min(),Ne.empty(),-1)}static max(){return new Ir(Be.max(),Ne.empty(),-1)}}function eg(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Ne.comparator(n.documentKey,e.documentKey),t!==0?t:Ye(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vx="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class yx{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ro(n){if(n.code!==J.FAILED_PRECONDITION||n.message!==vx)throw n;pe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Oe(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new z((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof z?t:z.resolve(t)}catch(t){return z.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):z.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):z.reject(t)}static resolve(e){return new z((t,r)=>{t(e)})}static reject(e){return new z((t,r)=>{r(e)})}static waitFor(e){return new z((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=z.resolve(!1);for(const r of e)t=t.next(s=>s?z.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new z((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(h=>{o[c]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new z((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jh{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new kn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Cu(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=tg(r.target.error);this.V.reject(new Cu(e,s))}}static open(e,t,r,s){try{return new jh(t,e.transaction(s,r))}catch(i){throw new Cu(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(pe("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new pk(t)}}class ls{constructor(e,t,r){this.name=e,this.version=t,this.p=r,ls.S(xn())===12.2&&hn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return pe("SimpleDb","Removing database:",e),Mo(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Bm())return!1;if(ls.v())return!0;const e=xn(),t=ls.S(e),r=0<t&&t<10,s=_x(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(pe("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Cu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new me(J.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new me(J.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Cu(e,o))},s.onupgradeneeded=i=>{pe("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{pe("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=jh.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),z.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(pe("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function _x(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class fk{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Mo(this.B.delete())}}class Cu extends me{constructor(e,t){super(J.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function so(n){return n.name==="IndexedDbTransactionError"}class pk{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(pe("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(pe("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Mo(r)}add(e){return pe("SimpleDb","ADD",this.store.name,e,e),Mo(this.store.add(e))}get(e){return Mo(this.store.get(e)).next(t=>(t===void 0&&(t=null),pe("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return pe("SimpleDb","DELETE",this.store.name,e),Mo(this.store.delete(e))}count(){return pe("SimpleDb","COUNT",this.store.name),Mo(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new z((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new z((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){pe("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new z((r,s)=>{t.onerror=i=>{const o=tg(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new z((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new fk(a),c=t(a.primaryKey,a.value,l);if(c instanceof z){const h=c.catch(f=>(l.done(),z.reject(f)));r.push(h)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>z.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Mo(n){return new z((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=tg(r.target.error);t(s)}})}let e0=!1;function tg(n){const e=ls.S(xn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new me("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return e0||(e0=!0,setTimeout(()=>{throw r},0)),r}}return n}class mk{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){pe("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{pe("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){so(t)?pe("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await ro(t)}await this.X(6e4)})}}class gk{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return z.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return pe("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(pe("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=gx(i);eg(o,r)>0&&(r=o)}),new Ir(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}cr.oe=-1;function xc(n){return n==null}function Zu(n){return n===0&&1/n==-1/0}function bx(n){return typeof n=="number"&&Number.isInteger(n)&&!Zu(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=t0(e)),e=vk(n.get(t),e);return t0(e)}function vk(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function t0(n){return n+""}function is(n){const e=n.length;if(Le(e>=2),e===2)return Le(n.charAt(0)===""&&n.charAt(1)===""),pt.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&Oe(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:Oe()}i=o+2}return new pt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n0=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dd(n,e){return[n,Qn(e)]}function wx(n,e,t){return[n,Qn(e),t]}const yk={},_k=["prefixPath","collectionGroup","readTime","documentId"],bk=["prefixPath","collectionGroup","documentId"],wk=["collectionGroup","readTime","prefixPath","documentId"],xk=["canonicalId","targetId"],Ik=["targetId","path"],Ek=["path","targetId"],Tk=["collectionId","parent"],Ak=["indexId","uid"],Sk=["uid","sequenceNumber"],Pk=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Ck=["indexId","uid","orderedDocumentKey"],Rk=["userId","collectionPath","documentId"],kk=["userId","collectionPath","largestBatchId"],Dk=["userId","collectionGroup","largestBatchId"],xx=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Nk=[...xx,"documentOverlays"],Ix=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ex=Ix,ng=[...Ex,"indexConfiguration","indexState","indexEntries"],Vk=ng,Ok=[...ng,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bp extends yx{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function In(n,e){const t=Ce(n);return ls.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r0(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function io(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Tx(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function Ax(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e,t){this.comparator=e,this.root=t||Mn.EMPTY}insert(e,t){return new Ut(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Mn.BLACK,null,null))}remove(e){return new Ut(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Mn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new md(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new md(this.root,e,this.comparator,!1)}getReverseIterator(){return new md(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new md(this.root,e,this.comparator,!0)}}class md{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Mn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Mn.RED,this.left=s??Mn.EMPTY,this.right=i??Mn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Mn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Mn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Mn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Mn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Mn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Oe();const e=this.left.check();if(e!==this.right.check())throw Oe();return e+(this.isRed()?0:1)}}Mn.EMPTY=null,Mn.RED=!0,Mn.BLACK=!1;Mn.EMPTY=new class{constructor(){this.size=0}get key(){throw Oe()}get value(){throw Oe()}get color(){throw Oe()}get left(){throw Oe()}get right(){throw Oe()}copy(e,t,r,s,i){return this}insert(e,t,r){return new Mn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rt{constructor(e){this.comparator=e,this.data=new Ut(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new s0(this.data.getIterator())}getIteratorFrom(e){return new s0(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Rt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Rt(this.comparator);return t.data=e,t}}class s0{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Da(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr{constructor(e){this.fields=e,e.sort(Jt.comparator)}static empty(){return new dr([])}unionWith(e){let t=new Rt(Jt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new dr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return rl(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sx extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z9(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Sx("Invalid base64 string: "+i):i}}(e);return new an(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new an(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ye(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}an.EMPTY_BYTE_STRING=new an("");const Mk=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ks(n){if(Le(!!n),typeof n=="string"){let e=0;const t=Mk.exec(n);if(Le(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Wt(n.seconds),nanos:Wt(n.nanos)}}function Wt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Gs(n){return typeof n=="string"?an.fromBase64String(n):an.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bh(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function qh(n){const e=n.mapValue.fields.__previous_value__;return Bh(e)?qh(e):e}function ec(n){const e=Ks(n.mapValue.fields.__local_write_time__.timestampValue);return new tn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lk{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class Jo{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Jo("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Jo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Li={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Nd={nullValue:"NULL_VALUE"};function Wi(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Bh(n)?4:Px(n)?9007199254740991:zh(n)?10:11:Oe()}function hs(n,e){if(n===e)return!0;const t=Wi(n);if(t!==Wi(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ec(n).isEqual(ec(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Ks(s.timestampValue),a=Ks(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Gs(s.bytesValue).isEqual(Gs(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Wt(s.geoPointValue.latitude)===Wt(i.geoPointValue.latitude)&&Wt(s.geoPointValue.longitude)===Wt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Wt(s.integerValue)===Wt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Wt(s.doubleValue),a=Wt(i.doubleValue);return o===a?Zu(o)===Zu(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return rl(n.arrayValue.values||[],e.arrayValue.values||[],hs);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(r0(o)!==r0(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!hs(o[l],a[l])))return!1;return!0}(n,e);default:return Oe()}}function tc(n,e){return(n.values||[]).find(t=>hs(t,e))!==void 0}function Qi(n,e){if(n===e)return 0;const t=Wi(n),r=Wi(e);if(t!==r)return Ye(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ye(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Wt(i.integerValue||i.doubleValue),l=Wt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return i0(n.timestampValue,e.timestampValue);case 4:return i0(ec(n),ec(e));case 5:return Ye(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Gs(i),l=Gs(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const h=Ye(a[c],l[c]);if(h!==0)return h}return Ye(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Ye(Wt(i.latitude),Wt(o.latitude));return a!==0?a:Ye(Wt(i.longitude),Wt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return o0(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,h;const f=i.fields||{},g=o.fields||{},v=(a=f.value)===null||a===void 0?void 0:a.arrayValue,I=(l=g.value)===null||l===void 0?void 0:l.arrayValue,T=Ye(((c=v==null?void 0:v.values)===null||c===void 0?void 0:c.length)||0,((h=I==null?void 0:I.values)===null||h===void 0?void 0:h.length)||0);return T!==0?T:o0(v,I)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Li.mapValue&&o===Li.mapValue)return 0;if(i===Li.mapValue)return 1;if(o===Li.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},h=Object.keys(c);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const g=Ye(l[f],h[f]);if(g!==0)return g;const v=Qi(a[l[f]],c[h[f]]);if(v!==0)return v}return Ye(l.length,h.length)}(n.mapValue,e.mapValue);default:throw Oe()}}function i0(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ye(n,e);const t=Ks(n),r=Ks(e),s=Ye(t.seconds,r.seconds);return s!==0?s:Ye(t.nanos,r.nanos)}function o0(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Qi(t[s],r[s]);if(i)return i}return Ye(t.length,r.length)}function ol(n){return qp(n)}function qp(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Ks(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Gs(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Ne.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=qp(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${qp(t.fields[o])}`;return s+"}"}(n.mapValue):Oe()}function Vd(n){switch(Wi(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=qh(n);return e?16+Vd(e):16;case 5:return 2*n.stringValue.length;case 6:return Gs(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Vd(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return io(r.fields,(i,o)=>{s+=i.length+Vd(o)}),s}(n.mapValue);default:throw Oe()}}function Yo(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function zp(n){return!!n&&"integerValue"in n}function nc(n){return!!n&&"arrayValue"in n}function a0(n){return!!n&&"nullValue"in n}function l0(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Od(n){return!!n&&"mapValue"in n}function zh(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Ru(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return io(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ru(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ru(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Px(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const Cx={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function $k(n){return"nullValue"in n?Nd:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Yo(Jo.empty(),Ne.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?zh(n)?Cx:{mapValue:{}}:Oe()}function Fk(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Yo(Jo.empty(),Ne.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Cx:"mapValue"in n?zh(n)?{mapValue:{}}:Li:Oe()}function u0(n,e){const t=Qi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function c0(n,e){const t=Qi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn{constructor(e){this.value=e}static empty(){return new Fn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Od(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ru(t)}setAll(e){let t=Jt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Ru(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Od(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return hs(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Od(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){io(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Fn(Ru(this.value))}}function Rx(n){const e=[];return io(n.fields,(t,r)=>{const s=new Jt([t]);if(Od(r)){const i=Rx(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new dr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new qt(e,0,Be.min(),Be.min(),Be.min(),Fn.empty(),0)}static newFoundDocument(e,t,r,s){return new qt(e,1,t,Be.min(),r,s,0)}static newNoDocument(e,t){return new qt(e,2,t,Be.min(),Be.min(),Fn.empty(),0)}static newUnknownDocument(e,t){return new qt(e,3,t,Be.min(),Be.min(),Fn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Be.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Fn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Fn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Be.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof qt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new qt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji{constructor(e,t){this.position=e,this.inclusive=t}}function d0(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=Ne.comparator(Ne.fromName(o.referenceValue),t.key):r=Qi(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function h0(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!hs(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rc{constructor(e,t="asc"){this.field=e,this.dir=t}}function Uk(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kx{}class mt extends kx{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new jk(e,t,r):t==="array-contains"?new zk(e,r):t==="in"?new Lx(e,r):t==="not-in"?new Hk(e,r):t==="array-contains-any"?new Kk(e,r):new mt(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Bk(e,r):new qk(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Qi(t,this.value)):t!==null&&Wi(this.value)===Wi(t)&&this.matchesComparison(Qi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Oe()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ct extends kx{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Ct(e,t)}matches(e){return al(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function al(n){return n.op==="and"}function Hp(n){return n.op==="or"}function rg(n){return Dx(n)&&al(n)}function Dx(n){for(const e of n.filters)if(e instanceof Ct)return!1;return!0}function Kp(n){if(n instanceof mt)return n.field.canonicalString()+n.op.toString()+ol(n.value);if(rg(n))return n.filters.map(e=>Kp(e)).join(",");{const e=n.filters.map(t=>Kp(t)).join(",");return`${n.op}(${e})`}}function Nx(n,e){return n instanceof mt?function(r,s){return s instanceof mt&&r.op===s.op&&r.field.isEqual(s.field)&&hs(r.value,s.value)}(n,e):n instanceof Ct?function(r,s){return s instanceof Ct&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&Nx(o,s.filters[a]),!0):!1}(n,e):void Oe()}function Vx(n,e){const t=n.filters.concat(e);return Ct.create(t,n.op)}function Ox(n){return n instanceof mt?function(t){return`${t.field.canonicalString()} ${t.op} ${ol(t.value)}`}(n):n instanceof Ct?function(t){return t.op.toString()+" {"+t.getFilters().map(Ox).join(" ,")+"}"}(n):"Filter"}class jk extends mt{constructor(e,t,r){super(e,t,r),this.key=Ne.fromName(r.referenceValue)}matches(e){const t=Ne.comparator(e.key,this.key);return this.matchesComparison(t)}}class Bk extends mt{constructor(e,t){super(e,"in",t),this.keys=Mx("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class qk extends mt{constructor(e,t){super(e,"not-in",t),this.keys=Mx("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Mx(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Ne.fromName(r.referenceValue))}class zk extends mt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return nc(t)&&tc(t.arrayValue,this.value)}}class Lx extends mt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&tc(this.value.arrayValue,t)}}class Hk extends mt{constructor(e,t){super(e,"not-in",t)}matches(e){if(tc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!tc(this.value.arrayValue,t)}}class Kk extends mt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!nc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>tc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gk{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function Gp(n,e=null,t=[],r=[],s=null,i=null,o=null){return new Gk(n,e,t,r,s,i,o)}function Xo(n){const e=Ce(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Kp(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),xc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>ol(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>ol(r)).join(",")),e.ue=t}return e.ue}function Ic(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Uk(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Nx(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!h0(n.startAt,e.startAt)&&h0(n.endAt,e.endAt)}function rh(n){return Ne.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function sh(n,e){return n.filters.filter(t=>t instanceof mt&&t.field.isEqual(e))}function f0(n,e,t){let r=Nd,s=!0;for(const i of sh(n,e)){let o=Nd,a=!0;switch(i.op){case"<":case"<=":o=$k(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Nd}u0({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];u0({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function p0(n,e,t){let r=Li,s=!0;for(const i of sh(n,e)){let o=Li,a=!0;switch(i.op){case">=":case">":o=Fk(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Li}c0({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];c0({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zs{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function $x(n,e,t,r,s,i,o,a){return new Zs(n,e,t,r,s,i,o,a)}function Al(n){return new Zs(n)}function m0(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function sg(n){return n.collectionGroup!==null}function Qa(n){const e=Ce(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Rt(Jt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new rc(i,r))}),t.has(Jt.keyField().canonicalString())||e.ce.push(new rc(Jt.keyField(),r))}return e.ce}function Jn(n){const e=Ce(n);return e.le||(e.le=Ux(e,Qa(n))),e.le}function Fx(n){const e=Ce(n);return e.he||(e.he=Ux(e,n.explicitOrderBy)),e.he}function Ux(n,e){if(n.limitType==="F")return Gp(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new rc(s.field,i)});const t=n.endAt?new Ji(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Ji(n.startAt.position,n.startAt.inclusive):null;return Gp(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Wp(n,e){const t=n.filters.concat([e]);return new Zs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function ih(n,e,t){return new Zs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ec(n,e){return Ic(Jn(n),Jn(e))&&n.limitType===e.limitType}function jx(n){return`${Xo(Jn(n))}|lt:${n.limitType}`}function $a(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>Ox(s)).join(", ")}]`),xc(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>ol(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>ol(s)).join(",")),`Target(${r})`}(Jn(n))}; limitType=${n.limitType})`}function Tc(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Ne.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of Qa(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=d0(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,Qa(r),s)||r.endAt&&!function(o,a,l){const c=d0(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,Qa(r),s))}(n,e)}function Bx(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function qx(n){return(e,t)=>{let r=!1;for(const s of Qa(n)){const i=Wk(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function Wk(n,e,t){const r=n.field.isKeyField()?Ne.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?Qi(l,c):Oe()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Oe()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){io(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Ax(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qk=new Ut(Ne.comparator);function hr(){return Qk}const zx=new Ut(Ne.comparator);function yu(...n){let e=zx;for(const t of n)e=e.insert(t.key,t);return e}function Hx(n){let e=zx;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function os(){return ku()}function Kx(){return ku()}function ku(){return new ei(n=>n.toString(),(n,e)=>n.isEqual(e))}const Jk=new Ut(Ne.comparator),Yk=new Rt(Ne.comparator);function st(...n){let e=Yk;for(const t of n)e=e.add(t);return e}const Xk=new Rt(Ye);function ig(){return Xk}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function og(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Zu(e)?"-0":e}}function Gx(n){return{integerValue:""+n}}function Wx(n,e){return bx(e)?Gx(e):og(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hh{constructor(){this._=void 0}}function Zk(n,e,t){return n instanceof ll?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Bh(i)&&(i=qh(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof Zo?Jx(n,e):n instanceof ea?Yx(n,e):function(s,i){const o=Qx(s,i),a=g0(o)+g0(s.Pe);return zp(o)&&zp(s.Pe)?Gx(a):og(s.serializer,a)}(n,e)}function e2(n,e,t){return n instanceof Zo?Jx(n,e):n instanceof ea?Yx(n,e):t}function Qx(n,e){return n instanceof ul?function(r){return zp(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class ll extends Hh{}class Zo extends Hh{constructor(e){super(),this.elements=e}}function Jx(n,e){const t=Xx(e);for(const r of n.elements)t.some(s=>hs(s,r))||t.push(r);return{arrayValue:{values:t}}}class ea extends Hh{constructor(e){super(),this.elements=e}}function Yx(n,e){let t=Xx(e);for(const r of n.elements)t=t.filter(s=>!hs(s,r));return{arrayValue:{values:t}}}class ul extends Hh{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function g0(n){return Wt(n.integerValue||n.doubleValue)}function Xx(n){return nc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ac{constructor(e,t){this.field=e,this.transform=t}}function t2(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof Zo&&s instanceof Zo||r instanceof ea&&s instanceof ea?rl(r.elements,s.elements,hs):r instanceof ul&&s instanceof ul?hs(r.Pe,s.Pe):r instanceof ll&&s instanceof ll}(n.transform,e.transform)}class n2{constructor(e,t){this.version=e,this.transformResults=t}}class Yt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Yt}static exists(e){return new Yt(void 0,e)}static updateTime(e){return new Yt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Md(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Kh{}function Zx(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Pl(n.key,Yt.none()):new Sl(n.key,n.data,Yt.none());{const t=n.data,r=Fn.empty();let s=new Rt(Jt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new ti(n.key,r,new dr(s.toArray()),Yt.none())}}function r2(n,e,t){n instanceof Sl?function(s,i,o){const a=s.value.clone(),l=y0(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof ti?function(s,i,o){if(!Md(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=y0(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(eI(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Du(n,e,t,r){return n instanceof Sl?function(i,o,a,l){if(!Md(i.precondition,o))return a;const c=i.value.clone(),h=_0(i.fieldTransforms,l,o);return c.setAll(h),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof ti?function(i,o,a,l){if(!Md(i.precondition,o))return a;const c=_0(i.fieldTransforms,l,o),h=o.data;return h.setAll(eI(i)),h.setAll(c),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Md(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function s2(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Qx(r.transform,s||null);i!=null&&(t===null&&(t=Fn.empty()),t.set(r.field,i))}return t||null}function v0(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&rl(r,s,(i,o)=>t2(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Sl extends Kh{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class ti extends Kh{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function eI(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function y0(n,e,t){const r=new Map;Le(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,e2(o,a,t[s]))}return r}function _0(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,Zk(i,o,e))}return r}class Pl extends Kh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ag extends Kh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lg{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&r2(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Du(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Du(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Kx();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=Zx(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Be.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),st())}isEqual(e){return this.batchId===e.batchId&&rl(this.mutations,e.mutations,(t,r)=>v0(t,r))&&rl(this.baseMutations,e.baseMutations,(t,r)=>v0(t,r))}}class ug{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Le(e.mutations.length===r.length);let s=function(){return Jk}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new ug(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cg{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tI{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i2{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vn,_t;function nI(n){switch(n){default:return Oe();case J.CANCELLED:case J.UNKNOWN:case J.DEADLINE_EXCEEDED:case J.RESOURCE_EXHAUSTED:case J.INTERNAL:case J.UNAVAILABLE:case J.UNAUTHENTICATED:return!1;case J.INVALID_ARGUMENT:case J.NOT_FOUND:case J.ALREADY_EXISTS:case J.PERMISSION_DENIED:case J.FAILED_PRECONDITION:case J.ABORTED:case J.OUT_OF_RANGE:case J.UNIMPLEMENTED:case J.DATA_LOSS:return!0}}function rI(n){if(n===void 0)return hn("GRPC error has no .code"),J.UNKNOWN;switch(n){case vn.OK:return J.OK;case vn.CANCELLED:return J.CANCELLED;case vn.UNKNOWN:return J.UNKNOWN;case vn.DEADLINE_EXCEEDED:return J.DEADLINE_EXCEEDED;case vn.RESOURCE_EXHAUSTED:return J.RESOURCE_EXHAUSTED;case vn.INTERNAL:return J.INTERNAL;case vn.UNAVAILABLE:return J.UNAVAILABLE;case vn.UNAUTHENTICATED:return J.UNAUTHENTICATED;case vn.INVALID_ARGUMENT:return J.INVALID_ARGUMENT;case vn.NOT_FOUND:return J.NOT_FOUND;case vn.ALREADY_EXISTS:return J.ALREADY_EXISTS;case vn.PERMISSION_DENIED:return J.PERMISSION_DENIED;case vn.FAILED_PRECONDITION:return J.FAILED_PRECONDITION;case vn.ABORTED:return J.ABORTED;case vn.OUT_OF_RANGE:return J.OUT_OF_RANGE;case vn.UNIMPLEMENTED:return J.UNIMPLEMENTED;case vn.DATA_LOSS:return J.DATA_LOSS;default:return Oe()}}(_t=vn||(vn={}))[_t.OK=0]="OK",_t[_t.CANCELLED=1]="CANCELLED",_t[_t.UNKNOWN=2]="UNKNOWN",_t[_t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_t[_t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_t[_t.NOT_FOUND=5]="NOT_FOUND",_t[_t.ALREADY_EXISTS=6]="ALREADY_EXISTS",_t[_t.PERMISSION_DENIED=7]="PERMISSION_DENIED",_t[_t.UNAUTHENTICATED=16]="UNAUTHENTICATED",_t[_t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_t[_t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_t[_t.ABORTED=10]="ABORTED",_t[_t.OUT_OF_RANGE=11]="OUT_OF_RANGE",_t[_t.UNIMPLEMENTED=12]="UNIMPLEMENTED",_t[_t.INTERNAL=13]="INTERNAL",_t[_t.UNAVAILABLE=14]="UNAVAILABLE",_t[_t.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oh=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sI(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o2=new zo([4294967295,4294967295],0);function b0(n){const e=sI().encode(n),t=new ix;return t.update(e),new Uint8Array(t.digest())}function w0(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new zo([t,r],0),new zo([s,i],0)]}class dg{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new _u(`Invalid padding: ${t}`);if(r<0)throw new _u(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new _u(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new _u(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=zo.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(zo.fromNumber(r)));return s.compare(o2)===1&&(s=new zo([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=b0(e),[r,s]=w0(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new dg(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=b0(e),[r,s]=w0(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class _u extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sc{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Pc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Sc(Be.min(),s,new Ut(Ye),hr(),st())}}class Pc{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Pc(r,t,st(),st(),st())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ld{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class iI{constructor(e,t){this.targetId=e,this.me=t}}class oI{constructor(e,t,r=an.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class x0{constructor(){this.fe=0,this.ge=E0(),this.pe=an.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=st(),t=st(),r=st();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:Oe()}}),new Pc(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=E0()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Le(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class a2{constructor(e){this.Le=e,this.Be=new Map,this.ke=hr(),this.qe=I0(),this.Qe=new Ut(Ye)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Oe()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(rh(i))if(r===0){const o=new Ne(i.path);this.Ue(t,o,qt.newNoDocument(o,Be.min()))}else Le(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}oh==null||oh.et(function(h,f,g,v,I){var T,A,F,U,L,$;const ue={localCacheCount:h,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},se=f.unchangedNames;return se&&(ue.bloomFilter={applied:I===0,hashCount:(T=se==null?void 0:se.hashCount)!==null&&T!==void 0?T:0,bitmapLength:(U=(F=(A=se==null?void 0:se.bits)===null||A===void 0?void 0:A.bitmap)===null||F===void 0?void 0:F.length)!==null&&U!==void 0?U:0,padding:($=(L=se==null?void 0:se.bits)===null||L===void 0?void 0:L.padding)!==null&&$!==void 0?$:0,mightContain:E=>{var _;return(_=v==null?void 0:v.mightContain(E))!==null&&_!==void 0&&_}}),ue}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Gs(r).toUint8Array()}catch(l){if(l instanceof Sx)return Nr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new dg(o,s,i)}catch(l){return Nr(l instanceof _u?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&rh(a.target)){const l=new Ne(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,qt.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=st();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new Sc(e,t,this.Qe,this.ke,r);return this.ke=hr(),this.qe=I0(),this.Qe=new Ut(Ye),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new x0,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Rt(Ye),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||pe("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new x0),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function I0(){return new Ut(Ne.comparator)}function E0(){return new Ut(Ne.comparator)}const l2=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),u2=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),c2=(()=>({and:"AND",or:"OR"}))();class d2{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Qp(n,e){return n.useProto3Json||xc(e)?e:{value:e}}function cl(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function aI(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function h2(n,e){return cl(n,e.toTimestamp())}function mn(n){return Le(!!n),Be.fromTimestamp(function(t){const r=Ks(t);return new tn(r.seconds,r.nanos)}(n))}function hg(n,e){return Jp(n,e).canonicalString()}function Jp(n,e){const t=function(s){return new pt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function lI(n){const e=pt.fromString(n);return Le(yI(e)),e}function sc(n,e){return hg(n.databaseId,e.path)}function us(n,e){const t=lI(e);if(t.get(1)!==n.databaseId.projectId)throw new me(J.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new me(J.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Ne(dI(t))}function uI(n,e){return hg(n.databaseId,e)}function cI(n){const e=lI(n);return e.length===4?pt.emptyPath():dI(e)}function Yp(n){return new pt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function dI(n){return Le(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function T0(n,e,t){return{name:sc(n,e),fields:t.value.mapValue.fields}}function hI(n,e,t){const r=us(n,e.name),s=mn(e.updateTime),i=e.createTime?mn(e.createTime):Be.min(),o=new Fn({mapValue:{fields:e.fields}}),a=qt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function f2(n,e){return"found"in e?function(r,s){Le(!!s.found),s.found.name,s.found.updateTime;const i=us(r,s.found.name),o=mn(s.found.updateTime),a=s.found.createTime?mn(s.found.createTime):Be.min(),l=new Fn({mapValue:{fields:s.found.fields}});return qt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Le(!!s.missing),Le(!!s.readTime);const i=us(r,s.missing),o=mn(s.readTime);return qt.newNoDocument(i,o)}(n,e):Oe()}function p2(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Oe()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,h){return c.useProto3Json?(Le(h===void 0||typeof h=="string"),an.fromBase64String(h||"")):(Le(h===void 0||h instanceof Buffer||h instanceof Uint8Array),an.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const h=c.code===void 0?J.UNKNOWN:rI(c.code);return new me(h,c.message||"")}(o);t=new oI(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=us(n,r.document.name),i=mn(r.document.updateTime),o=r.document.createTime?mn(r.document.createTime):Be.min(),a=new Fn({mapValue:{fields:r.document.fields}}),l=qt.newFoundDocument(s,i,o,a),c=r.targetIds||[],h=r.removedTargetIds||[];t=new Ld(c,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=us(n,r.document),i=r.readTime?mn(r.readTime):Be.min(),o=qt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Ld([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=us(n,r.document),i=r.removedTargetIds||[];t=new Ld([],i,s,null)}else{if(!("filter"in e))return Oe();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new i2(s,i),a=r.targetId;t=new iI(a,o)}}return t}function ic(n,e){let t;if(e instanceof Sl)t={update:T0(n,e.key,e.value)};else if(e instanceof Pl)t={delete:sc(n,e.key)};else if(e instanceof ti)t={update:T0(n,e.key,e.data),updateMask:b2(e.fieldMask)};else{if(!(e instanceof ag))return Oe();t={verify:sc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof ll)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Zo)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ea)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof ul)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Oe()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:h2(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Oe()}(n,e.precondition)),t}function Xp(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Yt.updateTime(mn(i.updateTime)):i.exists!==void 0?Yt.exists(i.exists):Yt.none()}(e.currentDocument):Yt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Le(a.setToServerValue==="REQUEST_TIME"),l=new ll;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new Zo(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new ea(h)}else"increment"in a?l=new ul(o,a.increment):Oe();const c=Jt.fromServerFormat(a.fieldPath);return new Ac(c,l)}(n,s)):[];if(e.update){e.update.name;const s=us(n,e.update.name),i=new Fn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new dr(c.map(h=>Jt.fromServerFormat(h)))}(e.updateMask);return new ti(s,i,o,t,r)}return new Sl(s,i,t,r)}if(e.delete){const s=us(n,e.delete);return new Pl(s,t)}if(e.verify){const s=us(n,e.verify);return new ag(s,t)}return Oe()}function m2(n,e){return n&&n.length>0?(Le(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?mn(s.updateTime):mn(i);return o.isEqual(Be.min())&&(o=mn(i)),new n2(o,s.transformResults||[])}(t,e))):[]}function fI(n,e){return{documents:[uI(n,e.path)]}}function Gh(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=uI(n,s);const i=function(c){if(c.length!==0)return vI(Ct.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(h=>function(g){return{field:Ci(g.field),direction:v2(g.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Qp(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function pI(n,e,t,r){const{_t:s,parent:i}=Gh(n,e),o={},a=[];let l=0;return t.forEach(c=>{const h=r?c.alias:"aggregate_"+l++;o[h]=c.alias,c.aggregateType==="count"?a.push({alias:h,count:{}}):c.aggregateType==="avg"?a.push({alias:h,avg:{field:Ci(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:h,sum:{field:Ci(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function mI(n){let e=cI(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Le(r===1);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const g=gI(f);return g instanceof Ct&&rg(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(I){return new rc(Fa(I.field),function(A){switch(A){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(I.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,xc(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,v=f.values||[];return new Ji(v,g)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const g=!f.before,v=f.values||[];return new Ji(v,g)}(t.endAt)),$x(e,s,o,i,a,"F",l,c)}function g2(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Oe()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function gI(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Fa(t.unaryFilter.field);return mt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Fa(t.unaryFilter.field);return mt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Fa(t.unaryFilter.field);return mt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Fa(t.unaryFilter.field);return mt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Oe()}}(n):n.fieldFilter!==void 0?function(t){return mt.create(Fa(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Oe()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Ct.create(t.compositeFilter.filters.map(r=>gI(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Oe()}}(t.compositeFilter.op))}(n):Oe()}function v2(n){return l2[n]}function y2(n){return u2[n]}function _2(n){return c2[n]}function Ci(n){return{fieldPath:n.canonicalString()}}function Fa(n){return Jt.fromServerFormat(n.fieldPath)}function vI(n){return n instanceof mt?function(t){if(t.op==="=="){if(l0(t.value))return{unaryFilter:{field:Ci(t.field),op:"IS_NAN"}};if(a0(t.value))return{unaryFilter:{field:Ci(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(l0(t.value))return{unaryFilter:{field:Ci(t.field),op:"IS_NOT_NAN"}};if(a0(t.value))return{unaryFilter:{field:Ci(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ci(t.field),op:y2(t.op),value:t.value}}}(n):n instanceof Ct?function(t){const r=t.getFilters().map(s=>vI(s));return r.length===1?r[0]:{compositeFilter:{op:_2(t.op),filters:r}}}(n):Oe()}function b2(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function yI(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns{constructor(e,t,r,s,i=Be.min(),o=Be.min(),a=an.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Ns(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ns(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ns(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ns(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _I{constructor(e){this.ct=e}}function w2(n,e){let t;if(e.document)t=hI(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Ne.fromSegments(e.noDocument.path),s=na(e.noDocument.readTime);t=qt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Oe();{const r=Ne.fromSegments(e.unknownDocument.path),s=na(e.unknownDocument.version);t=qt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new tn(s[0],s[1]);return Be.fromTimestamp(i)}(e.readTime)),t}function A0(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:ah(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:sc(i,o.key),fields:o.data.value.mapValue.fields,updateTime:cl(i,o.version.toTimestamp()),createTime:cl(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:ta(e.version)};else{if(!e.isUnknownDocument())return Oe();r.unknownDocument={path:t.path.toArray(),version:ta(e.version)}}return r}function ah(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function ta(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function na(n){const e=new tn(n.seconds,n.nanoseconds);return Be.fromTimestamp(e)}function Lo(n,e){const t=(e.baseMutations||[]).map(i=>Xp(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Xp(n.ct,i)),s=tn.fromMillis(e.localWriteTimeMs);return new lg(e.batchId,s,t,r)}function bu(n){const e=na(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?na(n.lastLimboFreeSnapshotVersion):Be.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Le(i.documents.length===1),Jn(Al(cI(i.documents[0])))}(n.query):function(i){return Jn(mI(i))}(n.query),new Ns(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,an.fromBase64String(n.resumeToken))}function bI(n,e){const t=ta(e.snapshotVersion),r=ta(e.lastLimboFreeSnapshotVersion);let s;s=rh(e.target)?fI(n.ct,e.target):Gh(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Xo(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function fg(n){const e=mI({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ih(e,e.limit,"L"):e}function lp(n,e){return new cg(e.largestBatchId,Xp(n.ct,e.overlayMutation))}function S0(n,e){const t=e.path.lastSegment();return[n,Qn(e.path.popLast()),t]}function P0(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:ta(r.readTime),documentKey:Qn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x2{getBundleMetadata(e,t){return C0(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:na(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return C0(e).put(function(s){return{bundleId:s.id,createTime:ta(mn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return R0(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:fg(i.bundledQuery),readTime:na(i.readTime)}}(r)})}saveNamedQuery(e,t){return R0(e).put(function(s){return{name:s.name,readTime:ta(mn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function C0(n){return In(n,"bundles")}function R0(n){return In(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wh{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new Wh(e,r)}getOverlay(e,t){return ou(e).get(S0(this.userId,t)).next(r=>r?lp(this.serializer,r):null)}getOverlays(e,t){const r=os();return z.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new cg(t,o);s.push(this.ht(e,a))}),z.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(Qn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(ou(e).j("collectionPathOverlayIndex",a))}),z.waitFor(i)}getOverlaysForCollection(e,t,r){const s=os(),i=Qn(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return ou(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=lp(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=os();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ou(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,h)=>{const f=lp(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}ht(e,t){return ou(e).put(function(s,i,o){const[a,l,c]=S0(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:ic(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function ou(n){return In(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I2{Pt(e){return In(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?an.fromUint8Array(r):an.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Wt(e.integerValue));else if("doubleValue"in e){const r=Wt(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Zu(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=Ks(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Gs(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?Px(e)?this.dt(t,Number.MAX_SAFE_INTEGER):zh(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Oe()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(Wt(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),Ne.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}$o.vt=new $o;function E2(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function k0(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=E2(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class T2{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=k0(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=k0(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class A2{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class S2{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class au{constructor(){this.jt=new T2,this.Ht=new A2(this.jt),this.Jt=new S2(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Fo(this.indexId,this.documentKey,this.arrayValue,r)}}function bi(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=D0(n.arrayValue,e.arrayValue),t!==0?t:(t=D0(n.directionalValue,e.directionalValue),t!==0?t:Ne.comparator(n.documentKey,e.documentKey)))}function D0(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N0{constructor(e){this.Xt=new Rt((t,r)=>Jt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Le(e.collectionGroup===this.collectionId),this.nn)return!1;const t=jp(e);if(t!==void 0&&!this.sn(t))return!1;const r=Do(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new Rt(Jt.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Ho(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Ho(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Ho(r.field,r.dir==="asc"?0:1)));return new sl(sl.UNKNOWN_ID,this.collectionId,t,il.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wI(n){var e,t;if(Le(n instanceof mt||n instanceof Ct),n instanceof mt){if(n instanceof Lx){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>mt.create(n.field,"==",i)))||[];return Ct.create(s,"or")}return n}const r=n.filters.map(s=>wI(s));return Ct.create(r,n.op)}function P2(n){if(n.getFilters().length===0)return[];const e=tm(wI(n));return Le(xI(e)),Zp(e)||em(e)?[e]:e.getFilters()}function Zp(n){return n instanceof mt}function em(n){return n instanceof Ct&&rg(n)}function xI(n){return Zp(n)||em(n)||function(t){if(t instanceof Ct&&Hp(t)){for(const r of t.getFilters())if(!Zp(r)&&!em(r))return!1;return!0}return!1}(n)}function tm(n){if(Le(n instanceof mt||n instanceof Ct),n instanceof mt)return n;if(n.filters.length===1)return tm(n.filters[0]);const e=n.filters.map(r=>tm(r));let t=Ct.create(e,n.op);return t=lh(t),xI(t)?t:(Le(t instanceof Ct),Le(al(t)),Le(t.filters.length>1),t.filters.reduce((r,s)=>pg(r,s)))}function pg(n,e){let t;return Le(n instanceof mt||n instanceof Ct),Le(e instanceof mt||e instanceof Ct),t=n instanceof mt?e instanceof mt?function(s,i){return Ct.create([s,i],"and")}(n,e):V0(n,e):e instanceof mt?V0(e,n):function(s,i){if(Le(s.filters.length>0&&i.filters.length>0),al(s)&&al(i))return Vx(s,i.getFilters());const o=Hp(s)?s:i,a=Hp(s)?i:s,l=o.filters.map(c=>pg(c,a));return Ct.create(l,"or")}(n,e),lh(t)}function V0(n,e){if(al(e))return Vx(e,n.getFilters());{const t=e.filters.map(r=>pg(n,r));return Ct.create(t,"or")}}function lh(n){if(Le(n instanceof mt||n instanceof Ct),n instanceof mt)return n;const e=n.getFilters();if(e.length===1)return lh(e[0]);if(Dx(n))return n;const t=e.map(s=>lh(s)),r=[];return t.forEach(s=>{s instanceof mt?r.push(s):s instanceof Ct&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Ct.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C2{constructor(){this.un=new mg}addToCollectionParentIndex(e,t){return this.un.add(t),z.resolve()}getCollectionParents(e,t){return z.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return z.resolve()}deleteFieldIndex(e,t){return z.resolve()}deleteAllFieldIndexes(e){return z.resolve()}createTargetIndexes(e,t){return z.resolve()}getDocumentsMatchingTarget(e,t){return z.resolve(null)}getIndexType(e,t){return z.resolve(0)}getFieldIndexes(e,t){return z.resolve([])}getNextCollectionGroupToUpdate(e){return z.resolve(null)}getMinOffset(e,t){return z.resolve(Ir.min())}getMinOffsetFromCollectionGroup(e,t){return z.resolve(Ir.min())}updateCollectionGroup(e,t,r){return z.resolve()}updateIndexEntries(e,t){return z.resolve()}}class mg{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Rt(pt.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Rt(pt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gd=new Uint8Array(0);class R2{constructor(e,t){this.databaseId=t,this.cn=new mg,this.ln=new ei(r=>Xo(r),(r,s)=>Ic(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:Qn(s)};return O0(e).put(i)}return z.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[px(t),""],!1,!0);return O0(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(is(o.parent))}return r})}addFieldIndex(e,t){const r=lu(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Va(e);return i.next(a=>{o.put(P0(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=lu(e),s=Va(e),i=Na(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=lu(e),r=Na(e),s=Va(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return z.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new N0(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Na(e);let s=!0;const i=new Map;return z.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=st();const a=[];return z.forEach(i,(l,c)=>{pe("IndexedDbIndexManager",`Using index ${function(L){return`id=${L.indexId}|cg=${L.collectionGroup}|f=${L.fields.map($=>`${$.fieldPath}:${$.kind}`).join(",")}`}(l)} to execute ${Xo(t)}`);const h=function(L,$){const ue=jp($);if(ue===void 0)return null;for(const se of sh(L,ue.fieldPath))switch(se.op){case"array-contains-any":return se.value.arrayValue.values||[];case"array-contains":return[se.value]}return null}(c,l),f=function(L,$){const ue=new Map;for(const se of Do($))for(const E of sh(L,se.fieldPath))switch(E.op){case"==":case"in":ue.set(se.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return ue.set(se.fieldPath.canonicalString(),E.value),Array.from(ue.values())}return null}(c,l),g=function(L,$){const ue=[];let se=!0;for(const E of Do($)){const _=E.kind===0?f0(L,E.fieldPath,L.startAt):p0(L,E.fieldPath,L.startAt);ue.push(_.value),se&&(se=_.inclusive)}return new Ji(ue,se)}(c,l),v=function(L,$){const ue=[];let se=!0;for(const E of Do($)){const _=E.kind===0?p0(L,E.fieldPath,L.endAt):f0(L,E.fieldPath,L.endAt);ue.push(_.value),se&&(se=_.inclusive)}return new Ji(ue,se)}(c,l),I=this.In(l,c,g),T=this.In(l,c,v),A=this.Tn(l,c,f),F=this.En(l.indexId,h,I,g.inclusive,T,v.inclusive,A);return z.forEach(F,U=>r.G(U,t.limit).next(L=>{L.forEach($=>{const ue=Ne.fromSegments($.documentKey);o.has(ue)||(o=o.add(ue),a.push(ue))})}))}).next(()=>a)}return z.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=P2(Ct.create(e.filters,"and")).map(r=>Gp(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const g=t?this.dn(t[f/c]):gd,v=this.An(e,g,r[f%c],s),I=this.Rn(e,g,i[f%c],o),T=a.map(A=>this.An(e,g,A,!0));h.push(...this.createRange(v,I,T))}return h}An(e,t,r,s){const i=new Fo(e,Ne.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new Fo(e,Ne.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new N0(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return z.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new Rt(Jt.comparator),h=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?h=!0:c=c.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new au;for(const s of Do(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);$o.vt.It(i,o)}return r.zt()}dn(e){const t=new au;return $o.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new au;return $o.vt.It(Yo(this.databaseId,t),r.Yt(function(i){const o=Do(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new au);let i=0;for(const o of Do(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&nc(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);$o.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new au;l.seed(a.zt()),$o.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof mt&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=lu(e),s=Va(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return z.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const g=f?new il(f.sequenceNumber,new Ir(na(f.readTime),new Ne(is(f.documentKey)),f.largestBatchId)):il.empty(),v=h.fields.map(([I,T])=>new Ho(Jt.fromServerFormat(I),T));return new sl(h.indexId,h.collectionGroup,v,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Ye(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=lu(e),i=Va(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>z.forEach(a,l=>i.put(P0(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return z.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?z.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),z.forEach(a,l=>this.wn(e,s,l).next(c=>{const h=this.Sn(i,l);return c.isEqual(h)?z.resolve():this.bn(e,i,l,c,h)}))))})}Dn(e,t,r,s){return Na(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return Na(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=Na(e);let i=new Rt(bi);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new Fo(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new Rt(bi);const s=this.Vn(t,e);if(s==null)return r;const i=jp(t);if(i!=null){const o=e.data.field(i.fieldPath);if(nc(o))for(const a of o.arrayValue.values||[])r=r.add(new Fo(t.indexId,e.key,this.dn(a),s))}else r=r.add(new Fo(t.indexId,e.key,gd,s));return r}bn(e,t,r,s,i){pe("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,h,f,g){const v=l.getIterator(),I=c.getIterator();let T=Da(v),A=Da(I);for(;T||A;){let F=!1,U=!1;if(T&&A){const L=h(T,A);L<0?U=!0:L>0&&(F=!0)}else T!=null?U=!0:F=!0;F?(f(A),A=Da(I)):U?(g(T),T=Da(v)):(T=Da(v),A=Da(I))}}(s,i,bi,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),z.waitFor(o)}yn(e){let t=1;return Va(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>bi(o,a)).filter((o,a,l)=>!a||bi(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=bi(o,e),l=bi(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,gd,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,gd,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return bi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(M0)}getMinOffset(e,t){return z.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||Oe())).next(M0)}}function O0(n){return In(n,"collectionParents")}function Na(n){return In(n,"indexEntries")}function lu(n){return In(n,"indexConfiguration")}function Va(n){return In(n,"indexState")}function M0(n){Le(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;eg(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Ir(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L0={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Hn{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Hn(e,Hn.DEFAULT_COLLECTION_PERCENTILE,Hn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function II(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(h,f,g)=>(a++,g.delete()));i.push(l.next(()=>{Le(a===1)}));const c=[];for(const h of t.mutations){const f=wx(e,h.key.path,t.batchId);i.push(s.delete(f)),c.push(h.key)}return z.waitFor(i).next(()=>c)}function uh(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Oe();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Hn.DEFAULT_COLLECTION_PERCENTILE=10,Hn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Hn.DEFAULT=new Hn(41943040,Hn.DEFAULT_COLLECTION_PERCENTILE,Hn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Hn.DISABLED=new Hn(-1,0,0);class Qh{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Le(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new Qh(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return wi(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Ua(e),o=wi(e);return o.add({}).next(a=>{Le(typeof a=="number");const l=new lg(a,t,r,s),c=function(v,I,T){const A=T.baseMutations.map(U=>ic(v.ct,U)),F=T.mutations.map(U=>ic(v.ct,U));return{userId:I,batchId:T.batchId,localWriteTimeMs:T.localWriteTime.toMillis(),baseMutations:A,mutations:F}}(this.serializer,this.userId,l),h=[];let f=new Rt((g,v)=>Ye(g.canonicalString(),v.canonicalString()));for(const g of s){const v=wx(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),h.push(o.put(c)),h.push(i.put(v,yk))}return f.forEach(g=>{h.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),z.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return wi(e).get(t).next(r=>r?(Le(r.userId===this.userId),Lo(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?z.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return wi(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Le(a.batchId>=r),i=Lo(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return wi(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return wi(e).U("userMutationsIndex",t).next(r=>r.map(s=>Lo(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Dd(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Ua(e).J({range:s},(o,a,l)=>{const[c,h,f]=o,g=is(h);if(c===this.userId&&t.path.isEqual(g))return wi(e).get(f).next(v=>{if(!v)throw Oe();Le(v.userId===this.userId),i.push(Lo(this.serializer,v))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Rt(Ye);const s=[];return t.forEach(i=>{const o=Dd(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Ua(e).J({range:a},(c,h,f)=>{const[g,v,I]=c,T=is(v);g===this.userId&&i.path.isEqual(T)?r=r.add(I):f.done()});s.push(l)}),z.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Dd(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new Rt(Ye);return Ua(e).J({range:o},(l,c,h)=>{const[f,g,v]=l,I=is(g);f===this.userId&&r.isPrefixOf(I)?I.length===s&&(a=a.add(v)):h.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(wi(e).get(i).next(o=>{if(o===null)throw Oe();Le(o.userId===this.userId),r.push(Lo(this.serializer,o))}))}),z.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return II(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),z.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return z.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Ua(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=is(i[1]);s.push(l)}else a.done()}).next(()=>{Le(s.length===0)})})}containsKey(e,t){return EI(e,this.userId,t)}Nn(e){return TI(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function EI(n,e,t){const r=Dd(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Ua(n).J({range:i,H:!0},(a,l,c)=>{const[h,f,g]=a;h===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function wi(n){return In(n,"mutations")}function Ua(n){return In(n,"documentMutations")}function TI(n){return In(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ra{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new ra(0)}static kn(){return new ra(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k2{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new ra(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Be.fromTimestamp(new tn(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Oa(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Le(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Oa(e).J((o,a)=>{const l=bu(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>z.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Oa(e).J((r,s)=>{const i=bu(s);t(i)})}qn(e){return $0(e).get("targetGlobalKey").next(t=>(Le(t!==null),t))}Qn(e,t){return $0(e).put("targetGlobalKey",t)}Kn(e,t){return Oa(e).put(bI(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Xo(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Oa(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=bu(a);Ic(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Ri(e);return t.forEach(o=>{const a=Qn(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),z.waitFor(s)}removeMatchingKeys(e,t,r){const s=Ri(e);return z.forEach(t,i=>{const o=Qn(i.path);return z.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Ri(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Ri(e);let i=st();return s.J({range:r,H:!0},(o,a,l)=>{const c=is(o[1]),h=new Ne(c);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=Qn(t.path),s=IDBKeyRange.bound([r],[px(r)],!1,!0);let i=0;return Ri(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return Oa(e).get(t).next(r=>r?bu(r):null)}}function Oa(n){return In(n,"targets")}function $0(n){return In(n,"targetGlobal")}function Ri(n){return In(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F0([n,e],[t,r]){const s=Ye(n,t);return s===0?Ye(e,r):s}class D2{constructor(e){this.Un=e,this.buffer=new Rt(F0),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();F0(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class AI{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){pe("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){so(t)?pe("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await ro(t)}await this.Hn(3e5)})}}class N2{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return z.resolve(cr.oe);const r=new D2(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(pe("LruGarbageCollector","Garbage collection skipped; disabled"),z.resolve(L0)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(pe("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),L0):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(pe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),La()<=ft.DEBUG&&pe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-h}ms`),z.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function SI(n,e){return new N2(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V2{constructor(e,t){this.db=e,this.garbageCollector=SI(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return vd(e,r)}removeReference(e,t,r){return vd(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return vd(e,t)}nr(e,t){return function(s,i){let o=!1;return TI(s).Y(a=>EI(s,a,i).next(l=>(l&&(o=!0),z.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Be.min()),Ri(e).delete(function(f){return[0,Qn(f.path)]}(o))))});s.push(l)}}).next(()=>z.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return vd(e,t)}tr(e,t){const r=Ri(e);let s,i=cr.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==cr.oe&&t(new Ne(is(s)),i),i=c,s=l):i=cr.oe}).next(()=>{i!==cr.oe&&t(new Ne(is(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function vd(n,e){return Ri(n).put(function(r,s){return{targetId:0,path:Qn(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PI{constructor(){this.changes=new ei(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,qt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?z.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O2{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Co(e).put(r)}removeEntry(e,t,r){return Co(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],ah(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=qt.newInvalidDocument(t);return Co(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(uu(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:qt.newInvalidDocument(t)};return Co(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(uu(t))},(s,i)=>{r={document:this.ir(t,i),size:uh(i)}}).next(()=>r)}getEntries(e,t){let r=hr();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=hr(),s=new Ut(Ne.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,uh(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return z.resolve();let s=new Rt(B0);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(uu(s.first()),uu(s.last())),o=s.getIterator();let a=o.getNext();return Co(e).J({index:"documentKeyIndex",range:i},(l,c,h)=>{const f=Ne.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&B0(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?h.$(uu(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),ah(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Co(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let h=hr();for(const f of c){const g=this.ir(Ne.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(Tc(t,g)||s.has(g.key))&&(h=h.insert(g.key,g))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=hr();const o=j0(t,r),a=j0(t,Ir.max());return Co(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,h)=>{const f=this.ir(Ne.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new M2(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return U0(e).get("remoteDocumentGlobalKey").next(t=>(Le(!!t),t))}rr(e,t){return U0(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=w2(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Be.min())))return r}return qt.newInvalidDocument(e)}}function CI(n){return new O2(n)}class M2 extends PI{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new ei(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new Rt((i,o)=>Ye(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=A0(this.cr.serializer,o);s=s.add(i.path.popLast());const c=uh(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=A0(this.cr.serializer,o.convertToNoDocument(Be.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),z.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function U0(n){return In(n,"remoteDocumentGlobal")}function Co(n){return In(n,"remoteDocumentsV14")}function uu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function j0(n,e){const t=e.documentKey.path.toArray();return[n,ah(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function B0(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Ye(t[i],r[i]),s)return s;return s=Ye(t.length,r.length),s||(s=Ye(t[t.length-2],r[r.length-2]),s||Ye(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L2{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RI{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Du(r.mutation,s,dr.empty(),tn.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,st()).next(()=>r))}getLocalViewOfDocuments(e,t,r=st()){const s=os();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=yu();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=os();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,st()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=hr();const o=ku(),a=function(){return ku()}();return t.forEach((l,c)=>{const h=r.get(c.key);s.has(c.key)&&(h===void 0||h.mutation instanceof ti)?i=i.insert(c.key,c):h!==void 0?(o.set(c.key,h.mutation.getFieldMask()),Du(h.mutation,c,h.mutation.getFieldMask(),tn.now())):o.set(c.key,dr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,h)=>o.set(c,h)),t.forEach((c,h)=>{var f;return a.set(c,new L2(h,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=ku();let s=new Ut((o,a)=>o-a),i=st();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let h=r.get(l)||dr.empty();h=a.applyToLocalView(c,h),r.set(l,h);const f=(s.get(a.batchId)||st()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,h=l.value,f=Kx();h.forEach(g=>{if(!i.has(g)){const v=Zx(t.get(g),r.get(g));v!==null&&f.set(g,v),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return z.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return Ne.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):sg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):z.resolve(os());let a=-1,l=i;return o.next(c=>z.forEach(c,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?z.resolve():this.remoteDocumentCache.getEntry(e,h).next(g=>{l=l.insert(h,g)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,st())).next(h=>({batchId:a,changes:Hx(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ne(t)).next(r=>{let s=yu();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=yu();return this.indexManager.getCollectionParents(e,i).next(a=>z.forEach(a,l=>{const c=function(f,g){return new Zs(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(h=>{h.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const h=c.getKey();o.get(h)===null&&(o=o.insert(h,qt.newInvalidDocument(h)))});let a=yu();return o.forEach((l,c)=>{const h=i.get(l);h!==void 0&&Du(h.mutation,c,dr.empty(),tn.now()),Tc(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $2{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return z.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:mn(s.createTime)}}(t)),z.resolve()}getNamedQuery(e,t){return z.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:fg(s.bundledQuery),readTime:mn(s.readTime)}}(t)),z.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F2{constructor(){this.overlays=new Ut(Ne.comparator),this.Ir=new Map}getOverlay(e,t){return z.resolve(this.overlays.get(t))}getOverlays(e,t){const r=os();return z.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),z.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),z.resolve()}getOverlaysForCollection(e,t,r){const s=os(),i=t.length+1,o=new Ne(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return z.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Ut((c,h)=>c-h);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let h=i.get(c.largestBatchId);h===null&&(h=os(),i=i.insert(c.largestBatchId,h)),h.set(c.getKey(),c)}}const a=os(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,h)=>a.set(c,h)),!(a.size()>=s)););return z.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new cg(t,r));let i=this.Ir.get(t);i===void 0&&(i=st(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U2{constructor(){this.sessionToken=an.EMPTY_BYTE_STRING}getSessionToken(e){return z.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,z.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gg{constructor(){this.Tr=new Rt(Sn.Er),this.dr=new Rt(Sn.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new Sn(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Sn(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new Ne(new pt([])),r=new Sn(t,e),s=new Sn(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Ne(new pt([])),r=new Sn(t,e),s=new Sn(t,e+1);let i=st();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Sn(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Sn{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Ne.comparator(e.key,t.key)||Ye(e.wr,t.wr)}static Ar(e,t){return Ye(e.wr,t.wr)||Ne.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j2{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Rt(Sn.Er)}checkEmpty(e){return z.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new lg(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new Sn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return z.resolve(o)}lookupMutationBatch(e,t){return z.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return z.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return z.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return z.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Sn(t,0),s=new Sn(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),z.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Rt(Ye);return t.forEach(s=>{const i=new Sn(s,0),o=new Sn(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),z.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Ne.isDocumentKey(i)||(i=i.child(""));const o=new Sn(new Ne(i),0);let a=new Rt(Ye);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),z.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Le(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return z.forEach(t.mutations,s=>{const i=new Sn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new Sn(t,0),s=this.br.firstAfterOrEqual(r);return z.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,z.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B2{constructor(e){this.Mr=e,this.docs=function(){return new Ut(Ne.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return z.resolve(r?r.document.mutableCopy():qt.newInvalidDocument(t))}getEntries(e,t){let r=hr();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():qt.newInvalidDocument(s))}),z.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=hr();const o=t.path,a=new Ne(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:h}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||eg(gx(h),r)<=0||(s.has(h.key)||Tc(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return z.resolve(i)}getAllFromCollectionGroup(e,t,r,s){Oe()}Or(e,t){return z.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new q2(this)}getSize(e){return z.resolve(this.size)}}class q2 extends PI{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),z.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z2{constructor(e){this.persistence=e,this.Nr=new ei(t=>Xo(t),Ic),this.lastRemoteSnapshotVersion=Be.min(),this.highestTargetId=0,this.Lr=0,this.Br=new gg,this.targetCount=0,this.kr=ra.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),z.resolve()}getLastRemoteSnapshotVersion(e){return z.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return z.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),z.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),z.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new ra(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,z.resolve()}updateTargetData(e,t){return this.Kn(t),z.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,z.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),z.waitFor(i).next(()=>s)}getTargetCount(e){return z.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return z.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),z.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),z.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),z.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return z.resolve(r)}containsKey(e,t){return z.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg{constructor(e,t){this.qr={},this.overlays={},this.Qr=new cr(0),this.Kr=!1,this.Kr=!0,this.$r=new U2,this.referenceDelegate=e(this),this.Ur=new z2(this),this.indexManager=new C2,this.remoteDocumentCache=function(s){return new B2(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new _I(t),this.Gr=new $2(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new F2,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new j2(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){pe("MemoryPersistence","Starting transaction:",e);const s=new H2(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return z.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class H2 extends yx{constructor(e){super(),this.currentSequenceNumber=e}}class Jh{constructor(e){this.persistence=e,this.Jr=new gg,this.Yr=null}static Zr(e){return new Jh(e)}get Xr(){if(this.Yr)return this.Yr;throw Oe()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),z.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),z.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),z.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return z.forEach(this.Xr,r=>{const s=Ne.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Be.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return z.or([()=>z.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class ch{constructor(e,t){this.persistence=e,this.ti=new ei(r=>Qn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=SI(this,t)}static Zr(e,t){return new ch(e,t)}zr(){}jr(e){return z.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return z.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?z.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Be.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),z.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),z.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),z.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),z.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Vd(e.data.value)),t}nr(e,t,r){return z.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return z.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K2{constructor(e){this.serializer=e}O(e,t,r,s){const i=new jh("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",n0,{unique:!0}),l.createObjectStore("documentMutations")}(e),q0(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=z.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),q0(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Be.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(h=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",n0,{unique:!0});const f=c.store("mutations"),g=h.map(v=>f.put(v));return z.waitFor(g)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:Rk});c.createIndex("collectionPathOverlayIndex",kk,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",Dk,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:_k});c.createIndex("documentKeyIndex",bk),c.createIndex("collectionGroupIndex",wk)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:Ak}).createIndex("sequenceNumberIndex",Sk,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:Pk}).createIndex("documentKeyIndex",Ck,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=uh(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>z.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>z.forEach(a,l=>{Le(l.userId===i.userId);const c=Lo(this.serializer,l);return II(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new pt(o),c=function(f){return[0,Qn(f)]}(l);i.push(t.get(c).next(h=>h?z.resolve():(f=>t.put({targetId:0,path:Qn(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>z.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:Tk});const r=t.store("collectionParents"),s=new mg,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Qn(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new pt(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const h=is(a);return i(h.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=bu(s),o=bI(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new Ne(pt.fromString(f.document.name).popFirst(5)):f.noDocument?Ne.fromSegments(f.noDocument.path):f.unknownDocument?Ne.fromSegments(f.unknownDocument.path):Oe()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>z.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=CI(this.serializer),i=new vg(Jh.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let h=(c=a.get(l.userId))!==null&&c!==void 0?c:st();Lo(this.serializer,l).keys().forEach(f=>h=h.add(f)),a.set(l.userId,h)}),z.forEach(a,(l,c)=>{const h=new Pn(c),f=Wh.lt(this.serializer,h),g=i.getIndexManager(h),v=Qh.lt(h,this.serializer,g,i.referenceDelegate);return new RI(s,v,f,g).recalculateAndSaveOverlaysForDocumentKeys(new Bp(t,cr.oe),l).next()})})}}function q0(n){n.createObjectStore("targetDocuments",{keyPath:Ik}).createIndex("documentTargetsIndex",Ek,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",xk,{unique:!0}),n.createObjectStore("targetGlobal")}const up="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class yg{constructor(e,t,r,s,i,o,a,l,c,h,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=h,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!yg.D())throw new me(J.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new V2(this,s),this.Ai=t+"main",this.serializer=new _I(l),this.Ri=new ls(this.Ai,this.hi,new K2(this.serializer)),this.$r=new I2,this.Ur=new k2(this.referenceDelegate,this.serializer),this.remoteDocumentCache=CI(this.serializer),this.Gr=new x2,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,h===!1&&hn("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new me(J.FAILED_PRECONDITION,up);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new cr(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>yd(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(so(e))return pe("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return pe("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return cu(e).get("owner").next(t=>z.resolve(this.vi(t)))}Ci(e){return yd(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=In(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return z.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?z.resolve(!0):cu(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new me(J.FAILED_PRECONDITION,up);return!1}}return!(!this.networkEnabled||!this.inForeground)||yd(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&pe("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Bp(e,cr.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>yd(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Qh.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new R2(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Wh.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){pe("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?Ok:l===16?Vk:l===15?ng:l===14?Ex:l===13?Ix:l===12?Nk:l===11?xx:void Oe()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new Bp(a,this.Qr?this.Qr.next():cr.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw hn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new me(J.FAILED_PRECONDITION,vx);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return cu(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new me(J.FAILED_PRECONDITION,up)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return cu(e).put("owner",t)}static D(){return ls.D()}bi(e){const t=cu(e);return t.get("owner").next(r=>this.vi(r)?(pe("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):z.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(hn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;Tw()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return pe("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return hn("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){hn("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function cu(n){return In(n,"owner")}function yd(n){return In(n,"clientMetadata")}function _g(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bg{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=st(),s=st();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new bg(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G2{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kI{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Tw()?8:_x(xn())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new G2;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(La()<=ft.DEBUG&&pe("QueryEngine","SDK will not create cache indexes for query:",$a(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),z.resolve()):(La()<=ft.DEBUG&&pe("QueryEngine","Query:",$a(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(La()<=ft.DEBUG&&pe("QueryEngine","The SDK decides to create cache indexes for query:",$a(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Jn(t))):z.resolve())}Yi(e,t){if(m0(t))return z.resolve(null);let r=Jn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=ih(t,null,"F"),r=Jn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=st(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,ih(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return m0(t)||s.isEqual(Be.min())?z.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?z.resolve(null):(La()<=ft.DEBUG&&pe("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),$a(t)),this.rs(e,o,t,mx(s,-1)).next(a=>a))})}ts(e,t){let r=new Rt(qx(e));return t.forEach((s,i)=>{Tc(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return La()<=ft.DEBUG&&pe("QueryEngine","Using full collection scan to execute query:",$a(t)),this.Ji.getDocumentsMatchingQuery(e,t,Ir.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W2{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Ut(Ye),this._s=new ei(i=>Xo(i),Ic),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new RI(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function DI(n,e,t,r){return new W2(n,e,t,r)}async function NI(n,e){const t=Ce(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=st();for(const c of s){o.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}for(const c of i){a.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function Q2(n,e){const t=Ce(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,h){const f=c.batch,g=f.keys();let v=z.resolve();return g.forEach(I=>{v=v.next(()=>h.getEntry(l,I)).next(T=>{const A=c.docVersions.get(I);Le(A!==null),T.version.compareTo(A)<0&&(f.applyToRemoteDocument(T,c),T.isValidDocument()&&(T.setReadTime(c.commitVersion),h.addEntry(T)))})}),v.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=st();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function VI(n){const e=Ce(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function J2(n,e){const t=Ce(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((h,f)=>{const g=s.get(f);if(!g)return;a.push(t.Ur.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,h.addedDocuments,f)));let v=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?v=v.withResumeToken(an.EMPTY_BYTE_STRING,Be.min()).withLastLimboFreeSnapshotVersion(Be.min()):h.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(h.resumeToken,r)),s=s.insert(f,v),function(T,A,F){return T.resumeToken.approximateByteSize()===0||A.snapshotVersion.toMicroseconds()-T.snapshotVersion.toMicroseconds()>=3e8?!0:F.addedDocuments.size+F.modifiedDocuments.size+F.removedDocuments.size>0}(g,v,h)&&a.push(t.Ur.updateTargetData(i,v))});let l=hr(),c=st();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(OI(i,o,e.documentUpdates).next(h=>{l=h.Ps,c=h.Is})),!r.isEqual(Be.min())){const h=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return z.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function OI(n,e,t){let r=st(),s=st();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=hr();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(Be.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):pe("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function Y2(n,e){const t=Ce(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function dl(n,e){const t=Ce(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,z.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new Ns(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function hl(n,e,t){const r=Ce(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!so(o))throw o;pe("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function dh(n,e,t){const r=Ce(n);let s=Be.min(),i=st();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,h){const f=Ce(l),g=f._s.get(h);return g!==void 0?z.resolve(f.os.get(g)):f.Ur.getTargetData(c,h)}(r,o,Jn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:Be.min(),t?i:st())).next(a=>($I(r,Bx(e),a),{documents:a,Ts:i})))}function MI(n,e){const t=Ce(n),r=Ce(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function LI(n,e){const t=Ce(n),r=t.us.get(e)||Be.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,mx(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>($I(t,e,s),s))}function $I(n,e,t){let r=n.us.get(e)||Be.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function X2(n,e,t,r){const s=Ce(n);let i=st(),o=hr();for(const c of t){const h=e.Es(c.metadata.name);c.document&&(i=i.add(h));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(h,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await dl(s,function(h){return Jn(Al(pt.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>OI(c,a,o).next(h=>(a.apply(c),h)).next(h=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,h.Ps,h.Is)).next(()=>h.Ps)))}async function Z2(n,e,t=st()){const r=await dl(n,Jn(fg(e.bundledQuery))),s=Ce(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=mn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(an.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function z0(n,e){return`firestore_clients_${n}_${e}`}function H0(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function cp(n,e){return`firestore_targets_${n}_${e}`}class hh{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new me(s.error.code,s.error.message))),o?new hh(e,t,s.state,i):(hn("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Nu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new me(r.error.code,r.error.message))),i?new Nu(e,r.state,s):(hn("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class fh{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=ig();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=bx(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new fh(e,i):(hn("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class wg{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new wg(t.clientId,t.onlineState):(hn("SharedClientState",`Failed to parse online state: ${e}`),null)}}class nm{constructor(){this.activeTargetIds=ig()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class dp{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Ut(Ye),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=z0(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new nm),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(z0(this.persistenceKey,r));if(s){const i=fh.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(cp(this.persistenceKey,e));if(s){const i=Nu.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(cp(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return pe("SharedClientState","READ",e,t),t}setItem(e,t){pe("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){pe("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(pe("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void hn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=cr.oe;if(i!=null)try{const a=JSON.parse(i);Le(typeof a=="number"),o=a}catch(a){hn("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==cr.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new hh(this.currentUser,e,t,r),i=H0(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=H0(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=cp(this.persistenceKey,e),i=new Nu(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return fh.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return hh.Rs(new Pn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return Nu.Rs(s,t)}Ls(e){return wg.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);pe("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=ig();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class FI{constructor(){this.so=new nm,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new nm,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eD{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K0{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){pe("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){pe("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _d=null;function hp(){return _d===null?_d=function(){return 268435456+Math.round(2147483648*Math.random())}():_d++,"0x"+_d.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tD={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nD{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qn="WebChannelConnection";class rD extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=hp(),l=this.xo(t,r.toUriEncodedString());pe("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(h=>(pe("RestConnection",`Received RPC '${t}' ${a}: `,h),h),h=>{throw Nr("RestConnection",`RPC '${t}' ${a} failed with error: `,h,"url: ",l,"request:",s),h})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Tl}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=tD[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=hp();return new Promise((o,a)=>{const l=new ox;l.setWithCredentials(!0),l.listenOnce(ax.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case kd.NO_ERROR:const h=l.getResponseJson();pe(qn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),o(h);break;case kd.TIMEOUT:pe(qn,`RPC '${e}' ${i} timed out`),a(new me(J.DEADLINE_EXCEEDED,"Request time out"));break;case kd.HTTP_ERROR:const f=l.getStatus();if(pe(qn,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const v=g==null?void 0:g.error;if(v&&v.status&&v.message){const I=function(A){const F=A.toLowerCase().replace(/_/g,"-");return Object.values(J).indexOf(F)>=0?F:J.UNKNOWN}(v.status);a(new me(I,v.message))}else a(new me(J.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new me(J.UNAVAILABLE,"Connection failed."));break;default:Oe()}}finally{pe(qn,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);pe(qn,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=hp(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=cx(),a=ux(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");pe(qn,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=o.createWebChannel(h,l);let g=!1,v=!1;const I=new nD({Io:A=>{v?pe(qn,`Not sending because RPC '${e}' stream ${s} is closed:`,A):(g||(pe(qn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),pe(qn,`RPC '${e}' stream ${s} sending:`,A),f.send(A))},To:()=>f.close()}),T=(A,F,U)=>{A.listen(F,L=>{try{U(L)}catch($){setTimeout(()=>{throw $},0)}})};return T(f,vu.EventType.OPEN,()=>{v||(pe(qn,`RPC '${e}' stream ${s} transport opened.`),I.yo())}),T(f,vu.EventType.CLOSE,()=>{v||(v=!0,pe(qn,`RPC '${e}' stream ${s} transport closed`),I.So())}),T(f,vu.EventType.ERROR,A=>{v||(v=!0,Nr(qn,`RPC '${e}' stream ${s} transport errored:`,A),I.So(new me(J.UNAVAILABLE,"The operation could not be completed")))}),T(f,vu.EventType.MESSAGE,A=>{var F;if(!v){const U=A.data[0];Le(!!U);const L=U,$=L.error||((F=L[0])===null||F===void 0?void 0:F.error);if($){pe(qn,`RPC '${e}' stream ${s} received error:`,$);const ue=$.status;let se=function(x){const R=vn[x];if(R!==void 0)return rI(R)}(ue),E=$.message;se===void 0&&(se=J.INTERNAL,E="Unknown error status: "+ue+" with message "+$.message),v=!0,I.So(new me(se,E)),f.close()}else pe(qn,`RPC '${e}' stream ${s} received:`,U),I.bo(U)}}),T(a,lx.STAT_EVENT,A=>{A.stat===Up.PROXY?pe(qn,`RPC '${e}' stream ${s} detected buffering proxy`):A.stat===Up.NOPROXY&&pe(qn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{I.wo()},0),I}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UI(){return typeof window<"u"?window:null}function $d(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cc(n){return new d2(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xg{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&pe("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jI{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new xg(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===J.RESOURCE_EXHAUSTED?(hn(t.toString()),hn("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===J.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new me(J.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return pe("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(pe("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class sD extends jI{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=p2(this.serializer,e),r=function(i){if(!("targetChange"in i))return Be.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Be.min():o.readTime?mn(o.readTime):Be.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=Yp(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=rh(l)?{documents:fI(i,l)}:{query:Gh(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=aI(i,o.resumeToken);const c=Qp(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(Be.min())>0){a.readTime=cl(i,o.snapshotVersion.toTimestamp());const c=Qp(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=g2(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=Yp(this.serializer),t.removeTarget=e,this.a_(t)}}class iD extends jI{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Le(!!e.streamToken),this.lastStreamToken=e.streamToken,Le(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Le(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=m2(e.writeResults,e.commitTime),r=mn(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=Yp(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>ic(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oD extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new me(J.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Jp(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===J.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new me(J.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Jp(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===J.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new me(J.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class aD{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(hn(t),this.D_=!1):pe("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lD{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{oo(this)&&(pe("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=Ce(l);c.L_.add(4),await Cl(c),c.q_.set("Unknown"),c.L_.delete(4),await Rc(c)}(this))})}),this.q_=new aD(r,s)}}async function Rc(n){if(oo(n))for(const e of n.B_)await e(!0)}async function Cl(n){for(const e of n.B_)await e(!1)}function Yh(n,e){const t=Ce(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Tg(t)?Eg(t):kl(t).r_()&&Ig(t,e))}function fl(n,e){const t=Ce(n),r=kl(t);t.N_.delete(e),r.r_()&&BI(t,e),t.N_.size===0&&(r.r_()?r.o_():oo(t)&&t.q_.set("Unknown"))}function Ig(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Be.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}kl(n).A_(e)}function BI(n,e){n.Q_.xe(e),kl(n).R_(e)}function Eg(n){n.Q_=new a2({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),kl(n).start(),n.q_.v_()}function Tg(n){return oo(n)&&!kl(n).n_()&&n.N_.size>0}function oo(n){return Ce(n).L_.size===0}function qI(n){n.Q_=void 0}async function uD(n){n.q_.set("Online")}async function cD(n){n.N_.forEach((e,t)=>{Ig(n,e)})}async function dD(n,e){qI(n),Tg(n)?(n.q_.M_(e),Eg(n)):n.q_.set("Unknown")}async function hD(n,e,t){if(n.q_.set("Online"),e instanceof oI&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){pe("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await ph(n,r)}else if(e instanceof Ld?n.Q_.Ke(e):e instanceof iI?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Be.min()))try{const r=await VI(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.N_.get(c);h&&i.N_.set(c,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const h=i.N_.get(l);if(!h)return;i.N_.set(l,h.withResumeToken(an.EMPTY_BYTE_STRING,h.snapshotVersion)),BI(i,l);const f=new Ns(h.target,l,c,h.sequenceNumber);Ig(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){pe("RemoteStore","Failed to raise snapshot:",r),await ph(n,r)}}async function ph(n,e,t){if(!so(e))throw e;n.L_.add(1),await Cl(n),n.q_.set("Offline"),t||(t=()=>VI(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{pe("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Rc(n)})}function zI(n,e){return e().catch(t=>ph(n,t,e))}async function Rl(n){const e=Ce(n),t=Yi(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;fD(e);)try{const s=await Y2(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,pD(e,s)}catch(s){await ph(e,s)}HI(e)&&KI(e)}function fD(n){return oo(n)&&n.O_.length<10}function pD(n,e){n.O_.push(e);const t=Yi(n);t.r_()&&t.V_&&t.m_(e.mutations)}function HI(n){return oo(n)&&!Yi(n).n_()&&n.O_.length>0}function KI(n){Yi(n).start()}async function mD(n){Yi(n).p_()}async function gD(n){const e=Yi(n);for(const t of n.O_)e.m_(t.mutations)}async function vD(n,e,t){const r=n.O_.shift(),s=ug.from(r,e,t);await zI(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Rl(n)}async function yD(n,e){e&&Yi(n).V_&&await async function(r,s){if(function(o){return nI(o)&&o!==J.ABORTED}(s.code)){const i=r.O_.shift();Yi(r).s_(),await zI(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Rl(r)}}(n,e),HI(n)&&KI(n)}async function G0(n,e){const t=Ce(n);t.asyncQueue.verifyOperationInProgress(),pe("RemoteStore","RemoteStore received new credentials");const r=oo(t);t.L_.add(3),await Cl(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Rc(t)}async function rm(n,e){const t=Ce(n);e?(t.L_.delete(2),await Rc(t)):e||(t.L_.add(2),await Cl(t),t.q_.set("Unknown"))}function kl(n){return n.K_||(n.K_=function(t,r,s){const i=Ce(t);return i.w_(),new sD(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:uD.bind(null,n),Ro:cD.bind(null,n),mo:dD.bind(null,n),d_:hD.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Tg(n)?Eg(n):n.q_.set("Unknown")):(await n.K_.stop(),qI(n))})),n.K_}function Yi(n){return n.U_||(n.U_=function(t,r,s){const i=Ce(t);return i.w_(),new iD(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:mD.bind(null,n),mo:yD.bind(null,n),f_:gD.bind(null,n),g_:vD.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await Rl(n)):(await n.U_.stop(),n.O_.length>0&&(pe("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ag{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new kn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Ag(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new me(J.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Dl(n,e){if(hn("AsyncQueue",`${e}: ${n}`),so(n))return new me(J.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ja{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Ne.comparator(t.key,r.key):(t,r)=>Ne.comparator(t.key,r.key),this.keyedMap=yu(),this.sortedSet=new Ut(this.comparator)}static emptySet(e){return new Ja(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ja)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Ja;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W0{constructor(){this.W_=new Ut(Ne.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Oe():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class pl{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new pl(e,t,Ja.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ec(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _D{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class bD{constructor(){this.queries=Q0(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=Ce(t),i=s.queries;s.queries=Q0(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new me(J.ABORTED,"Firestore shutting down"))}}function Q0(){return new ei(n=>jx(n),Ec)}async function Sg(n,e){const t=Ce(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new _D,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Dl(o,`Initialization of query '${$a(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Cg(t)}async function Pg(n,e){const t=Ce(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function wD(n,e){const t=Ce(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&Cg(t)}function xD(n,e,t){const r=Ce(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function Cg(n){n.Y_.forEach(e=>{e.next()})}var sm,J0;(J0=sm||(sm={})).ea="default",J0.Cache="cache";class Rg{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new pl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=pl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==sm.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ID{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y0{constructor(e){this.serializer=e}Es(e){return us(this.serializer,e)}ds(e){return e.metadata.exists?hI(this.serializer,e.document,!1):qt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return mn(e)}}class ED{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=GI(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=pt.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new Y0(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||st()).add(i);t.set(o,a)}}return t}async complete(){const e=await X2(this.localStore,new Y0(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await Z2(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function GI(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WI{constructor(e){this.key=e}}class QI{constructor(e){this.key=e}}class JI{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=st(),this.mutatedKeys=st(),this.Aa=qx(e),this.Ra=new Ja(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new W0,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const g=s.get(h),v=Tc(this.query,f)?f:null,I=!!g&&this.mutatedKeys.has(g.key),T=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let A=!1;g&&v?g.data.isEqual(v.data)?I!==T&&(r.track({type:3,doc:v}),A=!0):this.ga(g,v)||(r.track({type:2,doc:v}),A=!0,(l&&this.Aa(v,l)>0||c&&this.Aa(v,c)<0)&&(a=!0)):!g&&v?(r.track({type:0,doc:v}),A=!0):g&&!v&&(r.track({type:1,doc:g}),A=!0,(l||c)&&(a=!0)),A&&(v?(o=o.add(v),i=T?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((h,f)=>function(v,I){const T=A=>{switch(A){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Oe()}};return T(v)-T(I)}(h.type,f.type)||this.Aa(h.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new pl(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new W0,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=st(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new QI(r))}),this.da.forEach(r=>{e.has(r)||t.push(new WI(r))}),t}ba(e){this.Ta=e.Ts,this.da=st();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return pl.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class TD{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class AD{constructor(e){this.key=e,this.va=!1}}class SD{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new ei(a=>jx(a),Ec),this.Ma=new Map,this.xa=new Set,this.Oa=new Ut(Ne.comparator),this.Na=new Map,this.La=new gg,this.Ba={},this.ka=new Map,this.qa=ra.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function PD(n,e,t=!0){const r=Xh(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await YI(r,e,t,!0),s}async function CD(n,e){const t=Xh(n);await YI(t,e,!0,!1)}async function YI(n,e,t,r){const s=await dl(n.localStore,Jn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await kg(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&Yh(n.remoteStore,s),a}async function kg(n,e,t,r,s){n.Ka=(f,g,v)=>async function(T,A,F,U){let L=A.view.ma(F);L.ns&&(L=await dh(T.localStore,A.query,!1).then(({documents:E})=>A.view.ma(E,L)));const $=U&&U.targetChanges.get(A.targetId),ue=U&&U.targetMismatches.get(A.targetId)!=null,se=A.view.applyChanges(L,T.isPrimaryClient,$,ue);return im(T,A.targetId,se.wa),se.snapshot}(n,f,g,v);const i=await dh(n.localStore,e,!0),o=new JI(e,i.Ts),a=o.ma(i.documents),l=Pc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);im(n,t,c.wa);const h=new TD(e,t,o);return n.Fa.set(e,h),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function RD(n,e,t){const r=Ce(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Ec(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await hl(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&fl(r.remoteStore,s.targetId),ml(r,s.targetId)}).catch(ro)):(ml(r,s.targetId),await hl(r.localStore,s.targetId,!0))}async function kD(n,e){const t=Ce(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),fl(t.remoteStore,r.targetId))}async function DD(n,e,t){const r=Og(n);try{const s=await function(o,a){const l=Ce(o),c=tn.now(),h=a.reduce((v,I)=>v.add(I.key),st());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",v=>{let I=hr(),T=st();return l.cs.getEntries(v,h).next(A=>{I=A,I.forEach((F,U)=>{U.isValidDocument()||(T=T.add(F))})}).next(()=>l.localDocuments.getOverlayedDocuments(v,I)).next(A=>{f=A;const F=[];for(const U of a){const L=s2(U,f.get(U.key).overlayedDocument);L!=null&&F.push(new ti(U.key,L,Rx(L.value.mapValue),Yt.exists(!0)))}return l.mutationQueue.addMutationBatch(v,c,F,a)}).next(A=>{g=A;const F=A.applyToLocalDocumentSet(f,T);return l.documentOverlayCache.saveOverlays(v,A.batchId,F)})}).then(()=>({batchId:g.batchId,changes:Hx(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new Ut(Ye)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await ni(r,s.changes),await Rl(r.remoteStore)}catch(s){const i=Dl(s,"Failed to persist write");t.reject(i)}}async function XI(n,e){const t=Ce(n);try{const r=await J2(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Le(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Le(o.va):s.removedDocuments.size>0&&(Le(o.va),o.va=!1))}),await ni(t,r,e)}catch(r){await ro(r)}}function X0(n,e,t){const r=Ce(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Ce(o);l.onlineState=a;let c=!1;l.queries.forEach((h,f)=>{for(const g of f.j_)g.Z_(a)&&(c=!0)}),c&&Cg(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function ND(n,e,t){const r=Ce(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Ut(Ne.comparator);o=o.insert(i,qt.newNoDocument(i,Be.min()));const a=st().add(i),l=new Sc(Be.min(),new Map,new Ut(Ye),o,a);await XI(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),Vg(r)}else await hl(r.localStore,e,!1).then(()=>ml(r,e,t)).catch(ro)}async function VD(n,e){const t=Ce(n),r=e.batch.batchId;try{const s=await Q2(t.localStore,e);Ng(t,r,null),Dg(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await ni(t,s)}catch(s){await ro(s)}}async function OD(n,e,t){const r=Ce(n);try{const s=await function(o,a){const l=Ce(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let h;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(Le(f!==null),h=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,h)).next(()=>l.localDocuments.getDocuments(c,h))})}(r.localStore,e);Ng(r,e,t),Dg(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await ni(r,s)}catch(s){await ro(s)}}async function MD(n,e){const t=Ce(n);oo(t.remoteStore)||pe("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=Ce(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Dl(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function Dg(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function Ng(n,e,t){const r=Ce(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function ml(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||ZI(n,r)})}function ZI(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(fl(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Vg(n))}function im(n,e,t){for(const r of t)r instanceof WI?(n.La.addReference(r.key,e),LD(n,r)):r instanceof QI?(pe("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||ZI(n,r.key)):Oe()}function LD(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(pe("SyncEngine","New document in limbo: "+t),n.xa.add(r),Vg(n))}function Vg(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Ne(pt.fromString(e)),r=n.qa.next();n.Na.set(r,new AD(t)),n.Oa=n.Oa.insert(t,r),Yh(n.remoteStore,new Ns(Jn(Al(t.path)),r,"TargetPurposeLimboResolution",cr.oe))}}async function ni(n,e,t){const r=Ce(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var h;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=bg.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const h=Ce(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>z.forEach(c,g=>z.forEach(g.$i,v=>h.persistence.referenceDelegate.addReference(f,g.targetId,v)).next(()=>z.forEach(g.Ui,v=>h.persistence.referenceDelegate.removeReference(f,g.targetId,v)))))}catch(f){if(!so(f))throw f;pe("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const g=f.targetId;if(!f.fromCache){const v=h.os.get(g),I=v.snapshotVersion,T=v.withLastLimboFreeSnapshotVersion(I);h.os=h.os.insert(g,T)}}}(r.localStore,i))}async function $D(n,e){const t=Ce(n);if(!t.currentUser.isEqual(e)){pe("SyncEngine","User change. New user:",e.toKey());const r=await NI(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new me(J.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await ni(t,r.hs)}}function FD(n,e){const t=Ce(n),r=t.Na.get(e);if(r&&r.va)return st().add(r.key);{let s=st();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function UD(n,e){const t=Ce(n),r=await dh(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&im(t,e.targetId,s.wa),s}async function jD(n,e){const t=Ce(n);return LI(t.localStore,e).then(r=>ni(t,r))}async function BD(n,e,t,r){const s=Ce(n),i=await function(a,l){const c=Ce(a),h=Ce(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.Mn(f,l).next(g=>g?c.localDocuments.getDocuments(f,g):z.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Rl(s.remoteStore):t==="acknowledged"||t==="rejected"?(Ng(s,e,r||null),Dg(s,e),function(a,l){Ce(Ce(a).mutationQueue).On(l)}(s.localStore,e)):Oe(),await ni(s,i)):pe("SyncEngine","Cannot apply mutation batch with id: "+e)}async function qD(n,e){const t=Ce(n);if(Xh(t),Og(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await Z0(t,r.toArray());t.Qa=!0,await rm(t.remoteStore,!0);for(const i of s)Yh(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(ml(t,o),hl(t.localStore,o,!0))),fl(t.remoteStore,o)}),await s,await Z0(t,r),function(o){const a=Ce(o);a.Na.forEach((l,c)=>{fl(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Ut(Ne.comparator)}(t),t.Qa=!1,await rm(t.remoteStore,!1)}}async function Z0(n,e,t){const r=Ce(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await dl(r.localStore,Jn(l[0]));for(const c of l){const h=r.Fa.get(c),f=await UD(r,h);f.snapshot&&i.push(f.snapshot)}}else{const c=await MI(r.localStore,o);a=await dl(r.localStore,c),await kg(r,eE(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function eE(n){return $x(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function zD(n){return function(t){return Ce(Ce(t).persistence).Qi()}(Ce(n).localStore)}async function HD(n,e,t,r){const s=Ce(n);if(s.Qa)return void pe("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await LI(s.localStore,Bx(i[0])),a=Sc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",an.EMPTY_BYTE_STRING);await ni(s,o,a);break}case"rejected":await hl(s.localStore,e,!0),ml(s,e,r);break;default:Oe()}}async function KD(n,e,t){const r=Xh(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){pe("SyncEngine","Adding an already active target "+s);continue}const i=await MI(r.localStore,s),o=await dl(r.localStore,i);await kg(r,eE(i),o.targetId,!1,o.resumeToken),Yh(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await hl(r.localStore,s,!1).then(()=>{fl(r.remoteStore,s),ml(r,s)}).catch(ro)}}function Xh(n){const e=Ce(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=XI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=FD.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ND.bind(null,e),e.Ca.d_=wD.bind(null,e.eventManager),e.Ca.$a=xD.bind(null,e.eventManager),e}function Og(n){const e=Ce(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=VD.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=OD.bind(null,e),e}function GD(n,e,t){const r=Ce(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(v,I){const T=Ce(v),A=mn(I.createTime);return T.persistence.runTransaction("hasNewerBundle","readonly",F=>T.Gr.getBundleMetadata(F,I.id)).then(F=>!!F&&F.createTime.compareTo(A)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(v){return{taskState:"Success",documentsLoaded:v.totalDocuments,bytesLoaded:v.totalBytes,totalDocuments:v.totalDocuments,totalBytes:v.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(GI(l));const c=new ED(l,i.localStore,o.serializer);let h=await o.Ua();for(;h;){const g=await c.la(h);g&&a._updateProgress(g),h=await o.Ua()}const f=await c.complete();return await ni(i,f.Ia,void 0),await function(v,I){const T=Ce(v);return T.persistence.runTransaction("Save bundle","readwrite",A=>T.Gr.saveBundleMetadata(A,I))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return Nr("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Xi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Cc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return DI(this.persistence,new kI,e.initialUser,this.serializer)}Ga(e){return new vg(Jh.Zr,this.serializer)}Wa(e){return new FI}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Xi.provider={build:()=>new Xi};class WD extends Xi{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Le(this.persistence.referenceDelegate instanceof ch);const r=this.persistence.referenceDelegate.garbageCollector;return new AI(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?Hn.withCacheSize(this.cacheSizeBytes):Hn.DEFAULT;return new vg(r=>ch.Zr(r,t),this.serializer)}}class Mg extends Xi{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await Og(this.Ja.syncEngine),await Rl(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return DI(this.persistence,new kI,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new AI(r,e.asyncQueue,t)}Ha(e,t){const r=new gk(t,this.persistence);return new mk(e.asyncQueue,r)}Ga(e){const t=_g(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Hn.withCacheSize(this.cacheSizeBytes):Hn.DEFAULT;return new yg(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,UI(),$d(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new FI}}class tE extends Mg{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof dp&&(this.sharedClientState.syncEngine={no:BD.bind(null,t),ro:HD.bind(null,t),io:KD.bind(null,t),Qi:zD.bind(null,t),eo:jD.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await qD(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=UI();if(!dp.D(t))throw new me(J.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=_g(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new dp(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Zi{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>X0(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=$D.bind(null,this.syncEngine),await rm(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new bD}()}createDatastore(e){const t=Cc(e.databaseInfo.databaseId),r=function(i){return new rD(i)}(e.databaseInfo);return function(i,o,a,l){return new oD(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new lD(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>X0(this.syncEngine,t,0),function(){return K0.D()?new K0:new eD}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,h){const f=new SD(s,i,o,a,l,c);return h&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Ce(s);pe("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Cl(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Zi.provider={build:()=>new Zi};function e_(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):hn("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QD{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new kn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new ID(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JD{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new me(J.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=Ce(s),a={documents:i.map(f=>sc(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,pt.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const g=f2(o.serializer,f);c.set(g.key.toString(),g)});const h=[];return i.forEach(f=>{const g=c.get(f.toString());Le(!!g),h.push(g)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Pl(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=Ne.fromPath(r);this.mutations.push(new ag(s,this.precondition(s)))}),await async function(r,s){const i=Ce(r),o={writes:s.map(a=>ic(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,pt.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Oe();t=Be.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new me(J.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Be.min())?Yt.exists(!1):Yt.updateTime(t):Yt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Be.min()))throw new me(J.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Yt.updateTime(t)}return Yt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YD{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new xg(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new JD(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!xc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!nI(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XD{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Pn.UNAUTHENTICATED,this.clientId=fx.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{pe("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(pe("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new kn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Dl(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function fp(n,e){n.asyncQueue.verifyOperationInProgress(),pe("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await NI(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function t_(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Lg(n);pe("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>G0(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>G0(e.remoteStore,s)),n._onlineComponents=e}async function Lg(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){pe("FirestoreClient","Using user provided OfflineComponentProvider");try{await fp(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===J.FAILED_PRECONDITION||s.code===J.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Nr("Error using user provided cache. Falling back to memory cache: "+t),await fp(n,new Xi)}}else pe("FirestoreClient","Using default OfflineComponentProvider"),await fp(n,new Xi);return n._offlineComponents}async function ef(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(pe("FirestoreClient","Using user provided OnlineComponentProvider"),await t_(n,n._uninitializedComponentsProvider._online)):(pe("FirestoreClient","Using default OnlineComponentProvider"),await t_(n,new Zi))),n._onlineComponents}function nE(n){return Lg(n).then(e=>e.persistence)}function Nl(n){return Lg(n).then(e=>e.localStore)}function rE(n){return ef(n).then(e=>e.remoteStore)}function $g(n){return ef(n).then(e=>e.syncEngine)}function sE(n){return ef(n).then(e=>e.datastore)}async function gl(n){const e=await ef(n),t=e.eventManager;return t.onListen=PD.bind(null,e.syncEngine),t.onUnlisten=RD.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=CD.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=kD.bind(null,e.syncEngine),t}function ZD(n){return n.asyncQueue.enqueue(async()=>{const e=await nE(n),t=await rE(n);return e.setNetworkEnabled(!0),function(s){const i=Ce(s);return i.L_.delete(0),Rc(i)}(t)})}function eN(n){return n.asyncQueue.enqueue(async()=>{const e=await nE(n),t=await rE(n);return e.setNetworkEnabled(!1),async function(s){const i=Ce(s);i.L_.add(0),await Cl(i),i.q_.set("Offline")}(t)})}function tN(n,e){const t=new kn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,h){const f=Ce(c);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new me(J.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Dl(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Nl(n),e,t)),t.promise}function iE(n,e,t={}){const r=new kn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const h=new Zh({next:g=>{h.Za(),o.enqueueAndForget(()=>Pg(i,f));const v=g.docs.has(a);!v&&g.fromCache?c.reject(new me(J.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&g.fromCache&&l&&l.source==="server"?c.reject(new me(J.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new Rg(Al(a.path),h,{includeMetadataChanges:!0,_a:!0});return Sg(i,f)}(await gl(n),n.asyncQueue,e,t,r)),r.promise}function nN(n,e){const t=new kn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await dh(s,i,!0),l=new JI(i,a.Ts),c=l.ma(a.documents),h=l.applyChanges(c,!1);o.resolve(h.snapshot)}catch(a){const l=Dl(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Nl(n),e,t)),t.promise}function oE(n,e,t={}){const r=new kn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const h=new Zh({next:g=>{h.Za(),o.enqueueAndForget(()=>Pg(i,f)),g.fromCache&&l.source==="server"?c.reject(new me(J.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new Rg(a,h,{includeMetadataChanges:!0,_a:!0});return Sg(i,f)}(await gl(n),n.asyncQueue,e,t,r)),r.promise}function rN(n,e,t){const r=new kn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await sE(n);r.resolve(async function(o,a,l){var c;const h=Ce(o),{request:f,ut:g,parent:v}=pI(h.serializer,Fx(a),l);h.connection.Fo||delete f.parent;const I=(await h.Lo("RunAggregationQuery",h.serializer.databaseId,v,f,1)).filter(A=>!!A.result);Le(I.length===1);const T=(c=I[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(T).reduce((A,F)=>(A[g[F]]=T[F],A),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function sN(n,e){const t=new Zh(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){Ce(s).Y_.add(i),i.next()}(await gl(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){Ce(s).Y_.delete(i)}(await gl(n),t))}}function iN(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?sI().encode(o):o,function(h,f){return new QD(h,f)}(function(h,f){if(h instanceof Uint8Array)return e_(h,f);if(h instanceof ArrayBuffer)return e_(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,Cc(e));n.asyncQueue.enqueueAndForget(async()=>{GD(await $g(n),s,r)})}function oN(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=Ce(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await Nl(n),e))}function aN(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=Ce(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,g,v,I,T){f=[...f],g=[...g],f.sort(v),g.sort(v);const A=f.length,F=g.length;let U=0,L=0;for(;U<F&&L<A;){const $=v(f[L],g[U]);$<0?T(f[L++]):$>0?I(g[U++]):(U++,L++)}for(;U<F;)I(g[U++]);for(;L<A;)T(f[L++])}(c,s,dk,h=>{a.push(o.addFieldIndex(l,h))},h=>{a.push(o.deleteFieldIndex(l,h))})).next(()=>z.waitFor(a)))}(await Nl(n),e))}function lN(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){Ce(r).ss.zi=s}(await Nl(n),e))}function uN(n){return n.asyncQueue.enqueue(async()=>function(t){const r=Ce(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Nl(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aE(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n_=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fg(n,e,t){if(!t)throw new me(J.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function cN(n,e,t,r){if(e===!0&&r===!0)throw new me(J.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function r_(n){if(!Ne.isDocumentKey(n))throw new me(J.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function s_(n){if(Ne.isDocumentKey(n))throw new me(J.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function tf(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Oe()}function ht(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new me(J.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=tf(n);throw new me(J.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function lE(n,e){if(e<=0)throw new me(J.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i_{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new me(J.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new me(J.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}cN("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=aE((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new me(J.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new me(J.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new me(J.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class kc{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new i_({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new me(J.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new me(J.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new i_(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new rk;switch(r.type){case"firstParty":return new ak(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new me(J.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=n_.get(t);r&&(pe("ComponentProvider","Removing Datastore"),n_.delete(t),r.terminate())}(this),Promise.resolve()}}function dN(n,e,t,r={}){var s;const i=(n=ht(n,kc))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Nr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=Pn.MOCK_USER;else{a=cP(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new me(J.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Pn(c)}n._authCredentials=new sk(new dx(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Un{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Un(this.firestore,e,this._query)}}class gn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new cs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new gn(this.firestore,e,this._key)}}class cs extends Un{constructor(e,t,r){super(e,t,Al(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new gn(this.firestore,null,new Ne(e))}withConverter(e){return new cs(this.firestore,e,this._path)}}function tt(n,e,...t){if(n=je(n),Fg("collection","path",e),n instanceof kc){const r=pt.fromString(e,...t);return s_(r),new cs(n,null,r)}{if(!(n instanceof gn||n instanceof cs))throw new me(J.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(pt.fromString(e,...t));return s_(r),new cs(n.firestore,null,r)}}function G9(n,e){if(n=ht(n,kc),Fg("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new me(J.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Un(n,null,function(r){return new Zs(pt.emptyPath(),r)}(e))}function Pe(n,e,...t){if(n=je(n),arguments.length===1&&(e=fx.newId()),Fg("doc","path",e),n instanceof kc){const r=pt.fromString(e,...t);return r_(r),new gn(n,null,new Ne(r))}{if(!(n instanceof gn||n instanceof cs))throw new me(J.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(pt.fromString(e,...t));return r_(r),new gn(n.firestore,n instanceof cs?n.converter:null,new Ne(r))}}function W9(n,e){return n=je(n),e=je(e),(n instanceof gn||n instanceof cs)&&(e instanceof gn||e instanceof cs)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function uE(n,e){return n=je(n),e=je(e),n instanceof Un&&e instanceof Un&&n.firestore===e.firestore&&Ec(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o_{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new xg(this,"async_queue_retry"),this.Vu=()=>{const r=$d();r&&pe("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=$d();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=$d();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new kn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!so(e))throw e;pe("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw hn("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Ag.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&Oe()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function om(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class hN{constructor(){this._progressObserver={},this._taskCompletionResolver=new kn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q9=-1;class Vt extends kc{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new o_,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new o_(e),this._firestoreClient=void 0,await e}}}function J9(n,e,t){t||(t="(default)");const r=no(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(Ki(i,e))return s;throw new me(J.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new me(J.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new me(J.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function fN(n,e){const t=typeof n=="object"?n:Hm(),r=typeof n=="string"?n:e||"(default)",s=no(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=lP("firestore");i&&dN(s,...i)}return s}function nn(n){if(n._terminated)throw new me(J.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||cE(n),n._firestoreClient}function cE(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,h){return new Lk(a,l,c,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,aE(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new XD(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function pN(n,e){Nr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return dE(n,Zi.provider,{build:r=>new Mg(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function Y9(n){Nr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();dE(n,Zi.provider,{build:t=>new tE(t,e.cacheSizeBytes)})}function dE(n,e,t){if((n=ht(n,Vt))._firestoreClient||n._terminated)throw new me(J.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new me(J.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},cE(n)}function X9(n){if(n._initialized&&!n._terminated)throw new me(J.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new kn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!ls.D())return Promise.resolve();const s=r+"main";await ls.delete(s)}(_g(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function Z9(n){return function(t){const r=new kn;return t.asyncQueue.enqueueAndForget(async()=>MD(await $g(t),r)),r.promise}(nn(n=ht(n,Vt)))}function ez(n){return ZD(nn(n=ht(n,Vt)))}function tz(n){return eN(nn(n=ht(n,Vt)))}function nz(n){return bC(n.app,"firestore",n._databaseId.database),n._delete()}function rz(n,e){const t=nn(n=ht(n,Vt)),r=new hN;return iN(t,n._databaseId,e,r),r}function sz(n,e){return oN(nn(n=ht(n,Vt)),e).then(t=>t?new Un(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class mN{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa{constructor(e){this._byteString=e}static fromBase64String(e){try{return new sa(an.fromBase64String(e))}catch(t){throw new me(J.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new sa(an.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new me(J.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Jt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function iz(){return new aa("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ug{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new me(J.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new me(J.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ye(this._lat,e._lat)||Ye(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nf{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gN=/^__.*__$/;class vN{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ti(e,this.data,this.fieldMask,t,this.fieldTransforms):new Sl(e,this.data,t,this.fieldTransforms)}}class hE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ti(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function fE(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Oe()}}class rf{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new rf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return mh(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(fE(this.Cu)&&gN.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class yN{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Cc(e)}Qu(e,t,r,s=!1){return new rf({Cu:e,methodName:t,qu:r,path:Jt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ua(n){const e=n._freezeSettings(),t=Cc(n._databaseId);return new yN(n._databaseId,!!e.ignoreUndefinedProperties,t)}function sf(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);Gg("Data must be an object, but it was:",o,r);const a=gE(r,o);let l,c;if(i.merge)l=new dr(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const g=ac(e,f,t);if(!o.contains(g))throw new me(J.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);yE(h,g)||h.push(g)}l=new dr(h),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new vN(new Fn(a),l,c)}class Dc extends la{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Dc}}function pE(n,e,t){return new rf({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class jg extends la{_toFieldTransform(e){return new Ac(e.path,new ll)}isEqual(e){return e instanceof jg}}class Bg extends la{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=pE(this,e,!0),r=this.Ku.map(i=>ca(i,t)),s=new Zo(r);return new Ac(e.path,s)}isEqual(e){return e instanceof Bg&&Ki(this.Ku,e.Ku)}}class qg extends la{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=pE(this,e,!0),r=this.Ku.map(i=>ca(i,t)),s=new ea(r);return new Ac(e.path,s)}isEqual(e){return e instanceof qg&&Ki(this.Ku,e.Ku)}}class zg extends la{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new ul(e.serializer,Wx(e.serializer,this.$u));return new Ac(e.path,t)}isEqual(e){return e instanceof zg&&this.$u===e.$u}}function Hg(n,e,t,r){const s=n.Qu(1,e,t);Gg("Data must be an object, but it was:",s,r);const i=[],o=Fn.empty();io(r,(l,c)=>{const h=of(e,l,t);c=je(c);const f=s.Nu(h);if(c instanceof Dc)i.push(h);else{const g=ca(c,f);g!=null&&(i.push(h),o.set(h,g))}});const a=new dr(i);return new hE(o,a,s.fieldTransforms)}function Kg(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[ac(e,r,t)],l=[s];if(i.length%2!=0)throw new me(J.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(ac(e,i[g])),l.push(i[g+1]);const c=[],h=Fn.empty();for(let g=a.length-1;g>=0;--g)if(!yE(c,a[g])){const v=a[g];let I=l[g];I=je(I);const T=o.Nu(v);if(I instanceof Dc)c.push(v);else{const A=ca(I,T);A!=null&&(c.push(v),h.set(v,A))}}const f=new dr(c);return new hE(h,f,o.fieldTransforms)}function mE(n,e,t,r=!1){return ca(t,n.Qu(r?4:3,e))}function ca(n,e){if(vE(n=je(n)))return Gg("Unsupported field value:",e,n),gE(n,e);if(n instanceof la)return function(r,s){if(!fE(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=ca(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=je(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Wx(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=tn.fromDate(r);return{timestampValue:cl(s.serializer,i)}}if(r instanceof tn){const i=new tn(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:cl(s.serializer,i)}}if(r instanceof Ug)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof sa)return{bytesValue:aI(s.serializer,r._byteString)};if(r instanceof gn){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:hg(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof nf)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return og(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${tf(r)}`)}(n,e)}function gE(n,e){const t={};return Ax(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):io(n,(r,s)=>{const i=ca(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function vE(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof tn||n instanceof Ug||n instanceof sa||n instanceof gn||n instanceof la||n instanceof nf)}function Gg(n,e,t){if(!vE(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=tf(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function ac(n,e,t){if((e=je(e))instanceof aa)return e._internalPath;if(typeof e=="string")return of(n,e);throw mh("Field path arguments must be of type string or ",n,!1,void 0,t)}const _N=new RegExp("[~\\*/\\[\\]]");function of(n,e,t){if(e.search(_N)>=0)throw mh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new aa(...e.split("."))._internalPath}catch{throw mh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function mh(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new me(J.INVALID_ARGUMENT,a+n+l)}function yE(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lc{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new gn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new bN(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(af("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class bN extends lc{data(){return super.data()}}function af(n,e){return typeof e=="string"?of(n,e):e instanceof aa?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _E(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new me(J.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Wg{}class Nc extends Wg{}function uc(n,e,...t){let r=[];e instanceof Wg&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Vl).length,a=i.filter(l=>l instanceof Vc).length;if(o>1||o>0&&a>0)throw new me(J.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Vc extends Nc{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Vc(e,t,r)}_apply(e){const t=this._parse(e);return wE(e._query,t),new Un(e.firestore,e.converter,Wp(e._query,t))}_parse(e){const t=ua(e.firestore);return function(i,o,a,l,c,h,f){let g;if(c.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new me(J.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){l_(f,h);const v=[];for(const I of f)v.push(a_(l,i,I));g={arrayValue:{values:v}}}else g=a_(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||l_(f,h),g=mE(a,o,f,h==="in"||h==="not-in");return mt.create(c,h,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function gh(n,e,t){const r=e,s=af("where",n);return Vc._create(s,r,t)}class Vl extends Wg{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Vl(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Ct.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)wE(o,l),o=Wp(o,l)}(e._query,t),new Un(e.firestore,e.converter,Wp(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function oz(...n){return n.forEach(e=>xE("or",e)),Vl._create("or",n)}function az(...n){return n.forEach(e=>xE("and",e)),Vl._create("and",n)}class Qg extends Nc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Qg(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new me(J.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new me(J.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new rc(i,o)}(e._query,this._field,this._direction);return new Un(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Zs(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function wN(n,e="asc"){const t=e,r=af("orderBy",n);return Qg._create(r,t)}class lf extends Nc{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new lf(e,t,r)}_apply(e){return new Un(e.firestore,e.converter,ih(e._query,this._limit,this._limitType))}}function lz(n){return lE("limit",n),lf._create("limit",n,"F")}function uz(n){return lE("limitToLast",n),lf._create("limitToLast",n,"L")}class uf extends Nc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new uf(e,t,r)}_apply(e){const t=bE(e,this.type,this._docOrFields,this._inclusive);return new Un(e.firestore,e.converter,function(s,i){return new Zs(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function cz(...n){return uf._create("startAt",n,!0)}function dz(...n){return uf._create("startAfter",n,!1)}class cf extends Nc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new cf(e,t,r)}_apply(e){const t=bE(e,this.type,this._docOrFields,this._inclusive);return new Un(e.firestore,e.converter,function(s,i){return new Zs(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function hz(...n){return cf._create("endBefore",n,!1)}function fz(...n){return cf._create("endAt",n,!0)}function bE(n,e,t,r){if(t[0]=je(t[0]),t[0]instanceof lc)return function(i,o,a,l,c){if(!l)throw new me(J.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of Qa(i))if(f.field.isKeyField())h.push(Yo(o,l.key));else{const g=l.data.field(f.field);if(Bh(g))throw new me(J.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const v=f.field.canonicalString();throw new me(J.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${v}' (used as the orderBy) does not exist.`)}h.push(g)}return new Ji(h,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=ua(n.firestore);return function(o,a,l,c,h,f){const g=o.explicitOrderBy;if(h.length>g.length)throw new me(J.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const v=[];for(let I=0;I<h.length;I++){const T=h[I];if(g[I].field.isKeyField()){if(typeof T!="string")throw new me(J.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof T}`);if(!sg(o)&&T.indexOf("/")!==-1)throw new me(J.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${T}' contains a slash.`);const A=o.path.child(pt.fromString(T));if(!Ne.isDocumentKey(A))throw new me(J.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${A}' is not because it contains an odd number of segments.`);const F=new Ne(A);v.push(Yo(a,F))}else{const A=mE(l,c,T);v.push(A)}}return new Ji(v,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function a_(n,e,t){if(typeof(t=je(t))=="string"){if(t==="")throw new me(J.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!sg(e)&&t.indexOf("/")!==-1)throw new me(J.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(pt.fromString(t));if(!Ne.isDocumentKey(r))throw new me(J.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Yo(n,new Ne(r))}if(t instanceof gn)return Yo(n,t._key);throw new me(J.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${tf(t)}.`)}function l_(n,e){if(!Array.isArray(n)||n.length===0)throw new me(J.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function wE(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new me(J.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new me(J.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function xE(n,e){if(!(e instanceof Vc||e instanceof Vl))throw new me(J.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class IE{convertValue(e,t="none"){switch(Wi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Wt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Gs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Oe()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return io(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>Wt(o.doubleValue));return new nf(i)}convertGeoPoint(e){return new Ug(Wt(e.latitude),Wt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=qh(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ec(e));default:return null}}convertTimestamp(e){const t=Ks(e);return new tn(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=pt.fromString(e);Le(yI(r));const s=new Jo(r.get(1),r.get(3)),i=new Ne(r.popFirst(5));return s.isEqual(t)||hn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function df(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class xN extends IE{constructor(e){super(),this.firestore=e}convertBytes(e){return new sa(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new gn(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pz(n){return new oc("sum",ac("sum",n))}function mz(n){return new oc("avg",ac("average",n))}function IN(){return new oc("count")}function gz(n,e){var t,r;return n instanceof oc&&e instanceof oc&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function vz(n,e){return uE(n.query,e.query)&&Ki(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class vl extends lc{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Fd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(af("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Fd extends vl{data(e={}){return super.data(e)}}class yl{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new jo(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Fd(this._firestore,this._userDataWriter,r.key,r,new jo(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new me(J.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Fd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new jo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Fd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new jo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,h=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:EN(a.type),doc:l,oldIndex:c,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function EN(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Oe()}}function yz(n,e){return n instanceof vl&&e instanceof vl?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof yl&&e instanceof yl&&n._firestore===e._firestore&&uE(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jt(n){n=ht(n,gn);const e=ht(n.firestore,Vt);return iE(nn(e),n._key).then(t=>Jg(e,n,t))}class ao extends IE{constructor(e){super(),this.firestore=e}convertBytes(e){return new sa(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new gn(this.firestore,null,t)}}function _z(n){n=ht(n,gn);const e=ht(n.firestore,Vt),t=nn(e),r=new ao(e);return tN(t,n._key).then(s=>new vl(e,r,n._key,s,new jo(s!==null&&s.hasLocalMutations,!0),n.converter))}function bz(n){n=ht(n,gn);const e=ht(n.firestore,Vt);return iE(nn(e),n._key,{source:"server"}).then(t=>Jg(e,n,t))}function Pt(n){n=ht(n,Un);const e=ht(n.firestore,Vt),t=nn(e),r=new ao(e);return _E(n._query),oE(t,n._query).then(s=>new yl(e,r,n,s))}function wz(n){n=ht(n,Un);const e=ht(n.firestore,Vt),t=nn(e),r=new ao(e);return nN(t,n._query).then(s=>new yl(e,r,n,s))}function xz(n){n=ht(n,Un);const e=ht(n.firestore,Vt),t=nn(e),r=new ao(e);return oE(t,n._query,{source:"server"}).then(s=>new yl(e,r,n,s))}function sn(n,e,t){n=ht(n,gn);const r=ht(n.firestore,Vt),s=df(n.converter,e,t);return Oc(r,[sf(ua(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Yt.none())])}function Ol(n,e,t,...r){n=ht(n,gn);const s=ht(n.firestore,Vt),i=ua(s);let o;return o=typeof(e=je(e))=="string"||e instanceof aa?Kg(i,"updateDoc",n._key,e,t,r):Hg(i,"updateDoc",n._key,e),Oc(s,[o.toMutation(n._key,Yt.exists(!0))])}function _l(n){return Oc(ht(n.firestore,Vt),[new Pl(n._key,Yt.none())])}function Ml(n,e){const t=ht(n.firestore,Vt),r=Pe(n),s=df(n.converter,e);return Oc(t,[sf(ua(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Yt.exists(!1))]).then(()=>r)}function Iz(n,...e){var t,r,s;n=je(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||om(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(om(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,h;if(n instanceof gn)c=ht(n.firestore,Vt),h=Al(n._key.path),l={next:f=>{e[o]&&e[o](Jg(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=ht(n,Un);c=ht(f.firestore,Vt),h=f._query;const g=new ao(c);l={next:v=>{e[o]&&e[o](new yl(c,g,f,v))},error:e[o+1],complete:e[o+2]},_E(n._query)}return function(g,v,I,T){const A=new Zh(T),F=new Rg(v,A,I);return g.asyncQueue.enqueueAndForget(async()=>Sg(await gl(g),F)),()=>{A.Za(),g.asyncQueue.enqueueAndForget(async()=>Pg(await gl(g),F))}}(nn(c),h,a,l)}function Ez(n,e){return sN(nn(n=ht(n,Vt)),om(e)?e:{next:e})}function Oc(n,e){return function(r,s){const i=new kn;return r.asyncQueue.enqueueAndForget(async()=>DD(await $g(r),s,i)),i.promise}(nn(n),e)}function Jg(n,e,t){const r=t.docs.get(e._key),s=new ao(n);return new vl(n,s,e._key,r,new jo(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tz(n){return TN(n,{count:IN()})}function TN(n,e){const t=ht(n.firestore,Vt),r=nn(t),s=Tx(e,(i,o)=>new tI(o,i.aggregateType,i._internalFieldPath));return rN(r,n._query,s).then(i=>function(a,l,c){const h=new ao(a);return new mN(l,h,c)}(t,n,i))}class AN{constructor(e){this.kind="memory",this._onlineComponentProvider=Zi.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=Xi.provider}toJSON(){return{kind:this.kind}}}class SN{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=DN(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class PN{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Xi.provider}toJSON(){return{kind:this.kind}}}class CN{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new WD(e)}}toJSON(){return{kind:this.kind}}}function Az(){return new PN}function Sz(n){return new CN(n==null?void 0:n.cacheSizeBytes)}function Pz(n){return new AN(n)}function Cz(n){return new SN(n)}class RN{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Zi.provider,this._offlineComponentProvider={build:t=>new Mg(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class kN{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Zi.provider,this._offlineComponentProvider={build:t=>new tE(t,e==null?void 0:e.cacheSizeBytes)}}}function DN(n){return new RN(n==null?void 0:n.forceOwnership)}function Rz(){return new kN}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NN={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VN{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ua(e)}set(e,t,r){this._verifyNotCommitted();const s=ki(e,this._firestore),i=df(s.converter,t,r),o=sf(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Yt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=ki(e,this._firestore);let o;return o=typeof(t=je(t))=="string"||t instanceof aa?Kg(this._dataReader,"WriteBatch.update",i._key,t,r,s):Hg(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Yt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ki(e,this._firestore);return this._mutations=this._mutations.concat(new Pl(t._key,Yt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new me(J.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ki(n,e){if((n=je(n)).firestore!==e)throw new me(J.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ON extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=ua(t)}get(t){const r=ki(t,this._firestore),s=new xN(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return Oe();const o=i[0];if(o.isFoundDocument())return new lc(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new lc(this._firestore,s,r._key,null,r.converter);throw Oe()})}set(t,r,s){const i=ki(t,this._firestore),o=df(i.converter,r,s),a=sf(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=ki(t,this._firestore);let a;return a=typeof(r=je(r))=="string"||r instanceof aa?Kg(this._dataReader,"Transaction.update",o._key,r,s,i):Hg(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=ki(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ki(e,this._firestore),r=new ao(this._firestore);return super.get(e).then(s=>new vl(this._firestore,r,t._key,s._document,new jo(!1,!1),t.converter))}}function Dz(n,e,t){n=ht(n,Vt);const r=Object.assign(Object.assign({},NN),t);return function(i){if(i.maxAttempts<1)throw new me(J.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new kn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await sE(i);new YD(i.asyncQueue,c,a,o,l).au()}),l.promise}(nn(n),s=>e(new ON(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nz(){return new Dc("deleteField")}function Ws(){return new jg("serverTimestamp")}function MN(...n){return new Bg("arrayUnion",n)}function Vz(...n){return new qg("arrayRemove",n)}function Oz(n){return new zg("increment",n)}function Mz(n){return new nf(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yg(n){return nn(n=ht(n,Vt)),new VN(n,e=>Oc(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lz(n,e){const t=nn(n=ht(n,Vt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Nr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(h){throw new me(J.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=u_(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=of("setIndexConfiguration",u_(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new Ho(g,2)):f.order==="ASCENDING"?h.push(new Ho(g,0)):f.order==="DESCENDING"&&h.push(new Ho(g,1))}a.push(new sl(sl.UNKNOWN_ID,c,h,il.empty()))}return a}(e);return aN(t,r)}function u_(n,e){if(typeof n[e]!="string")throw new me(J.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LN{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function $z(n){var e;n=ht(n,Vt);const t=c_.get(n);if(t)return t;if(((e=nn(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new LN(n);return c_.set(n,r),r}function Fz(n){EE(n,!0)}function Uz(n){EE(n,!1)}function jz(n){uN(nn(n._firestore)).then(e=>pe("deleting all persistent cache indexes succeeded")).catch(e=>Nr("deleting all persistent cache indexes failed",e))}function EE(n,e){lN(nn(n._firestore),e).then(t=>pe(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>Nr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const c_=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bz(n){var e;const t=(e=nn(ht(n.firestore,Vt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Gh(t,Jn(n._query))._t}function qz(n,e){var t;const r=Tx(e,(i,o)=>new tI(o,i.aggregateType,i._internalFieldPath)),s=(t=nn(ht(n.firestore,Vt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:pI(s,Fx(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zz{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Xg.instance.onExistenceFilterMismatch(e)}}class Xg{constructor(){this.Uu=new Map}static get instance(){return bd||(bd=new Xg,function(t){if(oh)throw new Error("a TestingHooksSpi instance is already set");oh=t}(bd)),bd}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let bd=null;(function(e,t=!0){(function(s){Tl=s})(El),ds(new Kr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Vt(new ik(r.getProvider("auth-internal")),new lk(r.getProvider("app-check-internal")),function(c,h){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new me(J.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Jo(c.options.projectId,h)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),kr(Zy,"4.7.3",e),kr(Zy,"4.7.3","esm2017")})();function Zg(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hz={PHONE:"phone",TOTP:"totp"},Kz={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Gz={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},Wz={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},Qz={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $N(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function TE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Jz=$N,FN=TE,AE=new oa("auth","Firebase",TE()),Yz={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vh=new qm("@firebase/auth");function UN(n,...e){vh.logLevel<=ft.WARN&&vh.warn(`Auth (${El}): ${n}`,...e)}function Ud(n,...e){vh.logLevel<=ft.ERROR&&vh.error(`Auth (${El}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fr(n,...e){throw tv(n,...e)}function nr(n,...e){return tv(n,...e)}function ev(n,e,t){const r=Object.assign(Object.assign({},FN()),{[e]:t});return new oa("auth","Firebase",r).create(e,{appName:n.name})}function Dn(n){return ev(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ll(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&fr(n,"argument-error"),ev(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function tv(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return AE.create(n,...e)}function Te(n,e,...t){if(!n)throw tv(e,...t)}function as(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Ud(e),new Error(e)}function Qs(n,e){n||as(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cc(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function nv(){return d_()==="http:"||d_()==="https:"}function d_(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jN(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(nv()||pP()||"connection"in navigator)?navigator.onLine:!0}function BN(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mc{constructor(e,t){this.shortDelay=e,this.longDelay=t,Qs(t>e,"Short delay should be less than long delay!"),this.isMobile=dP()||mP()}get(){return jN()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rv(n,e){Qs(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SE{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;as("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;as("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;as("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qN={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zN=new Mc(3e4,6e4);function zt(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Ht(n,e,t,r,s={}){return PE(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Il(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return fP()||(c.referrerPolicy="no-referrer"),SE.fetch()(CE(n,n.config.apiHost,t,a),c)})}async function PE(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},qN),e);try{const s=new KN(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw wu(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw wu(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw wu(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw wu(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw ev(n,h,c);fr(n,h)}}catch(s){if(s instanceof fs)throw s;fr(n,"network-request-failed",{message:String(s)})}}async function ri(n,e,t,r,s={}){const i=await Ht(n,e,t,r,s);return"mfaPendingCredential"in i&&fr(n,"multi-factor-auth-required",{_serverResponse:i}),i}function CE(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?rv(n.config,s):`${n.config.apiScheme}://${s}`}function HN(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class KN{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(nr(this.auth,"network-request-failed")),zN.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function wu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=nr(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h_(n){return n!==void 0&&n.getResponse!==void 0}function f_(n){return n!==void 0&&n.enterprise!==void 0}class RE{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return HN(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GN(n){return(await Ht(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function kE(n,e){return Ht(n,"GET","/v2/recaptchaConfig",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WN(n,e){return Ht(n,"POST","/v1/accounts:delete",e)}async function QN(n,e){return Ht(n,"POST","/v1/accounts:update",e)}async function DE(n,e){return Ht(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vu(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xz(n,e=!1){return je(n).getIdToken(e)}async function JN(n,e=!1){const t=je(n),r=await t.getIdToken(e),s=hf(r);Te(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Vu(pp(s.auth_time)),issuedAtTime:Vu(pp(s.iat)),expirationTime:Vu(pp(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function pp(n){return Number(n)*1e3}function hf(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Ud("JWT malformed, contained fewer than 3 sections"),null;try{const s=ww(t);return s?JSON.parse(s):(Ud("Failed to decode base64 JWT payload"),null)}catch(s){return Ud("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function p_(n){const e=hf(n);return Te(e,"internal-error"),Te(typeof e.exp<"u","internal-error"),Te(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Js(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof fs&&YN(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function YN({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XN{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class am{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Vu(this.lastLoginAt),this.creationTime=Vu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dc(n){var e;const t=n.auth,r=await n.getIdToken(),s=await Js(n,DE(t,{idToken:r}));Te(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?NE(i.providerUserInfo):[],a=eV(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),h=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new am(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function ZN(n){const e=je(n);await dc(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function eV(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function NE(n){return n.map(e=>{var{providerId:t}=e,r=Zg(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tV(n,e){const t=await PE(n,{},async()=>{const r=Il({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=CE(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",SE.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function nV(n,e){return Ht(n,"POST","/v2/accounts:revokeToken",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ya{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Te(e.idToken,"internal-error"),Te(typeof e.idToken<"u","internal-error"),Te(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):p_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Te(e.length!==0,"internal-error");const t=p_(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Te(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await tV(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new Ya;return r&&(Te(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Te(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Te(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ya,this.toJSON())}_performRefresh(){return as("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xi(n,e){Te(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Vs{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=Zg(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new XN(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new am(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Js(this,this.stsTokenManager.getToken(this.auth,e));return Te(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return JN(this,e)}reload(){return ZN(this)}_assign(e){this!==e&&(Te(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Vs(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Te(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await dc(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(fn(this.auth.app))return Promise.reject(Dn(this.auth));const e=await this.getIdToken();return await Js(this,WN(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,h;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(s=t.email)!==null&&s!==void 0?s:void 0,v=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,I=(o=t.photoURL)!==null&&o!==void 0?o:void 0,T=(a=t.tenantId)!==null&&a!==void 0?a:void 0,A=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,F=(c=t.createdAt)!==null&&c!==void 0?c:void 0,U=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:L,emailVerified:$,isAnonymous:ue,providerData:se,stsTokenManager:E}=t;Te(L&&E,e,"internal-error");const _=Ya.fromJSON(this.name,E);Te(typeof L=="string",e,"internal-error"),xi(f,e.name),xi(g,e.name),Te(typeof $=="boolean",e,"internal-error"),Te(typeof ue=="boolean",e,"internal-error"),xi(v,e.name),xi(I,e.name),xi(T,e.name),xi(A,e.name),xi(F,e.name),xi(U,e.name);const x=new Vs({uid:L,auth:e,email:g,emailVerified:$,displayName:f,isAnonymous:ue,photoURL:I,phoneNumber:v,tenantId:T,stsTokenManager:_,createdAt:F,lastLoginAt:U});return se&&Array.isArray(se)&&(x.providerData=se.map(R=>Object.assign({},R))),A&&(x._redirectEventId=A),x}static async _fromIdTokenResponse(e,t,r=!1){const s=new Ya;s.updateFromServerResponse(t);const i=new Vs({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await dc(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];Te(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?NE(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new Ya;a.updateFromIdToken(r);const l=new Vs({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new am(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m_=new Map;function Os(n){Qs(n instanceof Function,"Expected a class definition");let e=m_.get(n);return e?(Qs(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,m_.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}VE.type="NONE";const g_=VE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jd(n,e,t){return`firebase:${n}:${e}:${t}`}class Xa{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=jd(this.userKey,s.apiKey,i),this.fullPersistenceKey=jd("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Vs._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Xa(Os(g_),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||Os(g_);const o=jd(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const h=await c._get(o);if(h){const f=Vs._fromJSON(e,h);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Xa(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new Xa(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v_(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if($E(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(OE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(UE(e))return"Blackberry";if(jE(e))return"Webos";if(ME(e))return"Safari";if((e.includes("chrome/")||LE(e))&&!e.includes("edge/"))return"Chrome";if(FE(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function OE(n=xn()){return/firefox\//i.test(n)}function ME(n=xn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function LE(n=xn()){return/crios\//i.test(n)}function $E(n=xn()){return/iemobile/i.test(n)}function FE(n=xn()){return/android/i.test(n)}function UE(n=xn()){return/blackberry/i.test(n)}function jE(n=xn()){return/webos/i.test(n)}function sv(n=xn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function rV(n=xn()){var e;return sv(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function sV(){return gP()&&document.documentMode===10}function BE(n=xn()){return sv(n)||FE(n)||jE(n)||UE(n)||/windows phone/i.test(n)||$E(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qE(n,e=[]){let t;switch(n){case"Browser":t=v_(xn());break;case"Worker":t=`${v_(xn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${El}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iV{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oV(n,e={}){return Ht(n,"GET","/v2/passwordPolicy",zt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aV=6;class lV{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:aV,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uV{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new y_(this),this.idTokenSubscription=new y_(this),this.beforeStateQueue=new iV(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=AE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Os(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Xa.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await DE(this,{idToken:e}),r=await Vs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(fn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Te(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await dc(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=BN()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(fn(this.app))return Promise.reject(Dn(this));const t=e?je(e):null;return t&&Te(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Te(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return fn(this.app)?Promise.reject(Dn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return fn(this.app)?Promise.reject(Dn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Os(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await oV(this),t=new lV(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new oa("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await nV(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Os(e)||this._popupRedirectResolver;Te(t,this,"argument-error"),this.redirectPersistenceManager=await Xa.create(this,[Os(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Te(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Te(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=qE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&UN(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function ln(n){return je(n)}class y_{constructor(e){this.auth=e,this.observer=null,this.addObserver=xP(t=>this.observer=t)}get next(){return Te(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Lc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function cV(n){Lc=n}function iv(n){return Lc.loadJS(n)}function dV(){return Lc.recaptchaV2Script}function hV(){return Lc.recaptchaEnterpriseScript}function fV(){return Lc.gapiScript}function zE(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const pV="recaptcha-enterprise",mV="NO_RECAPTCHA";class HE{constructor(e){this.type=pV,this.auth=ln(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{kE(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new RE(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;f_(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(mV)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&f_(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=hV();l.length!==0&&(l+=a),iv(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function __(n,e,t,r=!1){const s=new HE(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function hc(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await __(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await __(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function gV(n){const e=ln(n),t=await kE(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new RE(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new HE(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vV(n,e){const t=no(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Ki(i,e??{}))return s;fr(s,"already-initialized")}return t.initialize({options:e})}function yV(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Os);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function _V(n,e,t){const r=ln(n);Te(r._canInitEmulator,r,"emulator-config-failed"),Te(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=KE(e),{host:o,port:a}=bV(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||wV()}function KE(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function bV(n){const e=KE(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:b_(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:b_(o)}}}function b_(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function wV(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $c{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return as("not implemented")}_getIdTokenResponse(e){return as("not implemented")}_linkToIdToken(e,t){return as("not implemented")}_getReauthenticationResolver(e){return as("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GE(n,e){return Ht(n,"POST","/v1/accounts:resetPassword",zt(n,e))}async function xV(n,e){return Ht(n,"POST","/v1/accounts:update",e)}async function IV(n,e){return Ht(n,"POST","/v1/accounts:signUp",e)}async function EV(n,e){return Ht(n,"POST","/v1/accounts:update",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TV(n,e){return ri(n,"POST","/v1/accounts:signInWithPassword",zt(n,e))}async function ff(n,e){return Ht(n,"POST","/v1/accounts:sendOobCode",zt(n,e))}async function AV(n,e){return ff(n,e)}async function SV(n,e){return ff(n,e)}async function PV(n,e){return ff(n,e)}async function CV(n,e){return ff(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RV(n,e){return ri(n,"POST","/v1/accounts:signInWithEmailLink",zt(n,e))}async function kV(n,e){return ri(n,"POST","/v1/accounts:signInWithEmailLink",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fc extends $c{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new fc(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new fc(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return hc(e,t,"signInWithPassword",TV);case"emailLink":return RV(e,{email:this._email,oobCode:this._password});default:fr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return hc(e,r,"signUpPassword",IV);case"emailLink":return kV(e,{idToken:t,email:this._email,oobCode:this._password});default:fr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function js(n,e){return ri(n,"POST","/v1/accounts:signInWithIdp",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DV="http://localhost";class Ys extends $c{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ys(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):fr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=Zg(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new Ys(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return js(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,js(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,js(e,t)}buildRequest(){const e={requestUri:DV,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Il(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NV(n,e){return Ht(n,"POST","/v1/accounts:sendVerificationCode",zt(n,e))}async function VV(n,e){return ri(n,"POST","/v1/accounts:signInWithPhoneNumber",zt(n,e))}async function OV(n,e){const t=await ri(n,"POST","/v1/accounts:signInWithPhoneNumber",zt(n,e));if(t.temporaryProof)throw wu(n,"account-exists-with-different-credential",t);return t}const MV={USER_NOT_FOUND:"user-not-found"};async function LV(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return ri(n,"POST","/v1/accounts:signInWithPhoneNumber",zt(n,t),MV)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ko extends $c{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Ko({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Ko({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return VV(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return OV(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return LV(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Ko({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $V(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function FV(n){const e=mu(gu(n)).link,t=e?mu(gu(e)).deep_link_id:null,r=mu(gu(n)).deep_link_id;return(r?mu(gu(r)).link:null)||r||t||e||n}class Fc{constructor(e){var t,r,s,i,o,a;const l=mu(gu(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,h=(r=l.oobCode)!==null&&r!==void 0?r:null,f=$V((s=l.mode)!==null&&s!==void 0?s:null);Te(c&&h&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=h,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=FV(e);try{return new Fc(t)}catch{return null}}}function Zz(n){return Fc.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(){this.providerId=da.PROVIDER_ID}static credential(e,t){return fc._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Fc.parseLink(t);return Te(r,"argument-error"),fc._fromEmailAndCode(e,r.code,r.tenantId)}}da.PROVIDER_ID="password";da.EMAIL_PASSWORD_SIGN_IN_METHOD="password";da.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class si{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $l extends si{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Bd extends $l{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return Te("providerId"in t&&"signInMethod"in t,"argument-error"),Ys._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return Te(e.idToken||e.accessToken,"argument-error"),Ys._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Bd.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Bd.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new Bd(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di extends $l{constructor(){super("facebook.com")}static credential(e){return Ys._fromParams({providerId:Di.PROVIDER_ID,signInMethod:Di.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Di.credentialFromTaggedObject(e)}static credentialFromError(e){return Di.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Di.credential(e.oauthAccessToken)}catch{return null}}}Di.FACEBOOK_SIGN_IN_METHOD="facebook.com";Di.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ni extends $l{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ys._fromParams({providerId:Ni.PROVIDER_ID,signInMethod:Ni.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ni.credentialFromTaggedObject(e)}static credentialFromError(e){return Ni.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Ni.credential(t,r)}catch{return null}}}Ni.GOOGLE_SIGN_IN_METHOD="google.com";Ni.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi extends $l{constructor(){super("github.com")}static credential(e){return Ys._fromParams({providerId:Vi.PROVIDER_ID,signInMethod:Vi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Vi.credentialFromTaggedObject(e)}static credentialFromError(e){return Vi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Vi.credential(e.oauthAccessToken)}catch{return null}}}Vi.GITHUB_SIGN_IN_METHOD="github.com";Vi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UV="http://localhost";class pc extends $c{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return js(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,js(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,js(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new pc(r,i)}static _create(e,t){return new pc(e,t)}buildRequest(){return{requestUri:UV,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jV="saml.";class lm extends si{constructor(e){Te(e.startsWith(jV),"argument-error"),super(e)}static credentialFromResult(e){return lm.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return lm.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=pc.fromJSON(e);return Te(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return pc._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi extends $l{constructor(){super("twitter.com")}static credential(e,t){return Ys._fromParams({providerId:Oi.PROVIDER_ID,signInMethod:Oi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Oi.credentialFromTaggedObject(e)}static credentialFromError(e){return Oi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Oi.credential(t,r)}catch{return null}}}Oi.TWITTER_SIGN_IN_METHOD="twitter.com";Oi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WE(n,e){return ri(n,"POST","/v1/accounts:signUp",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Vs._fromIdTokenResponse(e,r,s),o=w_(r);return new Vr({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=w_(r);return new Vr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function w_(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BV(n){var e;if(fn(n.app))return Promise.reject(Dn(n));const t=ln(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Vr({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await WE(t,{returnSecureToken:!0}),s=await Vr._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yh extends fs{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,yh.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new yh(e,t,r,s)}}function QE(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?yh._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JE(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e8(n,e){const t=je(n);await pf(!0,t,e);const{providerUserInfo:r}=await QN(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=JE(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function ov(n,e,t=!1){const r=await Js(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Vr._forOperation(n,"link",r)}async function pf(n,e,t){await dc(e);const r=JE(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";Te(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YE(n,e,t=!1){const{auth:r}=n;if(fn(r.app))return Promise.reject(Dn(r));const s="reauthenticate";try{const i=await Js(n,QE(r,s,e,n),t);Te(i.idToken,r,"internal-error");const o=hf(i.idToken);Te(o,r,"internal-error");const{sub:a}=o;return Te(n.uid===a,r,"user-mismatch"),Vr._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&fr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XE(n,e,t=!1){if(fn(n.app))return Promise.reject(Dn(n));const r="signIn",s=await QE(n,r,e),i=await Vr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function av(n,e){return XE(ln(n),e)}async function qV(n,e){const t=je(n);return await pf(!1,t,e.providerId),ov(t,e)}async function zV(n,e){return YE(je(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HV(n,e){return ri(n,"POST","/v1/accounts:signInWithCustomToken",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t8(n,e){if(fn(n.app))return Promise.reject(Dn(n));const t=ln(n),r=await HV(t,{token:e,returnSecureToken:!0}),s=await Vr._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?lv._fromServerResponse(e,t):"totpInfo"in t?uv._fromServerResponse(e,t):fr(e,"internal-error")}}class lv extends Uc{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new lv(t)}}class uv extends Uc{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new uv(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mf(n,e,t){var r;Te(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),Te(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(Te(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(Te(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cv(n){const e=ln(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function KV(n,e,t){const r=ln(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&mf(r,s,t),await hc(r,s,"getOobCode",SV)}async function GV(n,e,t){await GE(je(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&cv(n),r})}async function n8(n,e){await EV(je(n),{oobCode:e})}async function WV(n,e){const t=je(n),r=await GE(t,{oobCode:e}),s=r.requestType;switch(Te(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Te(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Te(r.mfaInfo,t,"internal-error");default:Te(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Uc._fromServerResponse(ln(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function r8(n,e){const{data:t}=await WV(je(n),e);return t.email}async function QV(n,e,t){if(fn(n.app))return Promise.reject(Dn(n));const r=ln(n),o=await hc(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",WE).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&cv(n),l}),a=await Vr._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function JV(n,e,t){return fn(n.app)?Promise.reject(Dn(n)):av(je(n),da.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&cv(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s8(n,e,t){const r=ln(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){Te(a.handleCodeInApp,r,"argument-error"),a&&mf(r,o,a)}i(s,t),await hc(r,s,"getOobCode",PV)}function i8(n,e){const t=Fc.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function o8(n,e,t){if(fn(n.app))return Promise.reject(Dn(n));const r=je(n),s=da.credentialWithLink(e,t||cc());return Te(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),av(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YV(n,e){return Ht(n,"POST","/v1/accounts:createAuthUri",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function a8(n,e){const t=nv()?cc():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await YV(je(n),r);return s||[]}async function l8(n,e){const t=je(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&mf(t.auth,s,e);const{email:i}=await AV(t.auth,s);i!==n.email&&await n.reload()}async function u8(n,e,t){const r=je(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&mf(r.auth,i,t);const{email:o}=await CV(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XV(n,e){return Ht(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c8(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=je(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Js(r,XV(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function ZV(n,e){const t=je(n);return fn(t.auth.app)?Promise.reject(Dn(t.auth)):ZE(t,e,null)}function eO(n,e){return ZE(je(n),null,e)}async function ZE(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Js(n,xV(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tO(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=hf(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new Za(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new nO(i,s);case"github.com":return new rO(i,s);case"google.com":return new sO(i,s);case"twitter.com":return new iO(i,s,n.screenName||null);case"custom":case"anonymous":return new Za(i,null);default:return new Za(i,r,s)}}class Za{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class eT extends Za{constructor(e,t,r,s){super(e,t,r),this.username=s}}class nO extends Za{constructor(e,t){super(e,"facebook.com",t)}}class rO extends eT{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class sO extends Za{constructor(e,t){super(e,"google.com",t)}}class iO extends eT{constructor(e,t,r){super(e,"twitter.com",t,r)}}function d8(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:tO(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oO(n,e){return je(n).setPersistence(e)}function h8(n){return gV(n)}async function f8(n,e){return ln(n).validatePassword(e)}function aO(n,e,t,r){return je(n).onIdTokenChanged(e,t,r)}function lO(n,e,t){return je(n).beforeAuthStateChanged(e,t)}function uO(n,e,t,r){return je(n).onAuthStateChanged(e,t,r)}function p8(n){je(n).useDeviceLanguage()}function m8(n,e){return je(n).updateCurrentUser(e)}function cO(n){return je(n).signOut()}function g8(n,e){return ln(n).revokeAccessToken(e)}async function v8(n){return je(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bo{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new Bo("enroll",e,t)}static _fromMfaPendingCredential(e){return new Bo("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return Bo._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return Bo._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dv{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=ln(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Uc._fromServerResponse(r,a));Te(s.mfaPendingCredential,r,"internal-error");const o=Bo._fromMfaPendingCredential(s.mfaPendingCredential);return new dv(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const h=await Vr._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return Te(t.user,r,"internal-error"),Vr._forOperation(t.user,t.operationType,c);default:fr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function y8(n,e){var t;const r=je(n),s=e;return Te(e.customData.operationType,r,"argument-error"),Te((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),dv._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dO(n,e){return Ht(n,"POST","/v2/accounts/mfaEnrollment:start",zt(n,e))}function hO(n,e){return Ht(n,"POST","/v2/accounts/mfaEnrollment:finalize",zt(n,e))}function fO(n,e){return Ht(n,"POST","/v2/accounts/mfaEnrollment:start",zt(n,e))}function pO(n,e){return Ht(n,"POST","/v2/accounts/mfaEnrollment:finalize",zt(n,e))}function mO(n,e){return Ht(n,"POST","/v2/accounts/mfaEnrollment:withdraw",zt(n,e))}class hv{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Uc._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new hv(e)}async getSession(){return Bo._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Js(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Js(this.user,mO(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const mp=new WeakMap;function _8(n){const e=je(n);return mp.has(e)||mp.set(e,hv._fromUser(e)),mp.get(e)}const _h="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tT{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(_h,"1"),this.storage.removeItem(_h),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gO=1e3,vO=10;class nT extends tT{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=BE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);sV()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,vO):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},gO)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}nT.type="LOCAL";const rT=nT;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sT extends tT{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}sT.type="SESSION";const iT=sT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yO(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new gf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await yO(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}gf.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vf(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _O{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=vf("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===c)switch(g.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yn(){return window}function bO(n){yn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fv(){return typeof yn().WorkerGlobalScope<"u"&&typeof yn().importScripts=="function"}async function wO(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function xO(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function IO(){return fv()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oT="firebaseLocalStorageDb",EO=1,bh="firebaseLocalStorage",aT="fbase_key";class jc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function yf(n,e){return n.transaction([bh],e?"readwrite":"readonly").objectStore(bh)}function TO(){const n=indexedDB.deleteDatabase(oT);return new jc(n).toPromise()}function um(){const n=indexedDB.open(oT,EO);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(bh,{keyPath:aT})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(bh)?e(r):(r.close(),await TO(),e(await um()))})})}async function x_(n,e,t){const r=yf(n,!0).put({[aT]:e,value:t});return new jc(r).toPromise()}async function AO(n,e){const t=yf(n,!1).get(e),r=await new jc(t).toPromise();return r===void 0?null:r.value}function I_(n,e){const t=yf(n,!0).delete(e);return new jc(t).toPromise()}const SO=800,PO=3;class lT{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await um(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>PO)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return fv()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=gf._getInstance(IO()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await wO(),!this.activeServiceWorker)return;this.sender=new _O(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||xO()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await um();return await x_(e,_h,"1"),await I_(e,_h),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>x_(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>AO(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>I_(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=yf(s,!1).getAll();return new jc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),SO)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}lT.type="LOCAL";const CO=lT;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RO(n,e){return Ht(n,"POST","/v2/accounts/mfaSignIn:start",zt(n,e))}function kO(n,e){return Ht(n,"POST","/v2/accounts/mfaSignIn:finalize",zt(n,e))}function DO(n,e){return Ht(n,"POST","/v2/accounts/mfaSignIn:finalize",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NO=500,VO=6e4,wd=1e12;class OO{constructor(e){this.auth=e,this.counter=wd,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new MO(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||wd;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||wd;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||wd;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class MO{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;Te(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=LO(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},VO)},NO))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function LO(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gp=zE("rcb"),$O=new Mc(3e4,6e4);class FO{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=yn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return Te(UO(t),e,"argument-error"),this.shouldResolveImmediately(t)&&h_(yn().grecaptcha)?Promise.resolve(yn().grecaptcha):new Promise((r,s)=>{const i=yn().setTimeout(()=>{s(nr(e,"network-request-failed"))},$O.get());yn()[gp]=()=>{yn().clearTimeout(i),delete yn()[gp];const a=yn().grecaptcha;if(!a||!h_(a)){s(nr(e,"internal-error"));return}const l=a.render;a.render=(c,h)=>{const f=l(c,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${dV()}?${Il({onload:gp,render:"explicit",hl:t})}`;iv(o).catch(()=>{clearTimeout(i),s(nr(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=yn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function UO(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class jO{async load(e){return new OO(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uT="recaptcha",BO={theme:"light",type:"image"};class b8{constructor(e,t,r=Object.assign({},BO)){this.parameters=r,this.type=uT,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ln(e),this.isInvisible=this.parameters.size==="invisible",Te(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;Te(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new jO:new FO,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Te(!this.parameters.sitekey,this.auth,"argument-error"),Te(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Te(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=yn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){Te(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Te(nv()&&!fv(),this.auth,"internal-error"),await qO(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await GN(this.auth);Te(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Te(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function qO(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pv{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Ko._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function w8(n,e,t){if(fn(n.app))return Promise.reject(Dn(n));const r=ln(n),s=await _f(r,e,je(t));return new pv(s,i=>av(r,i))}async function x8(n,e,t){const r=je(n);await pf(!1,r,"phone");const s=await _f(r.auth,e,je(t));return new pv(s,i=>qV(r,i))}async function I8(n,e,t){const r=je(n);if(fn(r.auth.app))return Promise.reject(Dn(r.auth));const s=await _f(r.auth,e,je(t));return new pv(s,i=>zV(r,i))}async function _f(n,e,t){var r;const s=await t.verify();try{Te(typeof s=="string",n,"argument-error"),Te(t.type===uT,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return Te(o.type==="enroll",n,"internal-error"),(await dO(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{Te(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return Te(a,n,"missing-multi-factor-info"),(await RO(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await NV(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function E8(n,e){const t=je(n);if(fn(t.auth.app))return Promise.reject(Dn(t.auth));await ov(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class el{constructor(e){this.providerId=el.PROVIDER_ID,this.auth=ln(e)}verifyPhoneNumber(e,t){return _f(this.auth,e,je(t))}static credential(e,t){return Ko._fromVerification(e,t)}static credentialFromResult(e){const t=e;return el.credentialFromTaggedObject(t)}static credentialFromError(e){return el.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Ko._fromTokenResponse(t,r):null}}el.PROVIDER_ID="phone";el.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ha(n,e){return e?Os(e):(Te(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mv extends $c{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return js(e,this._buildIdpRequest())}_linkToIdToken(e,t){return js(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return js(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function zO(n){return XE(n.auth,new mv(n),n.bypassAuthState)}function HO(n){const{auth:e,user:t}=n;return Te(t,e,"internal-error"),YE(t,new mv(n),n.bypassAuthState)}async function KO(n){const{auth:e,user:t}=n;return Te(t,e,"internal-error"),ov(t,new mv(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cT{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return zO;case"linkViaPopup":case"linkViaRedirect":return KO;case"reauthViaPopup":case"reauthViaRedirect":return HO;default:fr(this.auth,"internal-error")}}resolve(e){Qs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Qs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GO=new Mc(2e3,1e4);async function T8(n,e,t){if(fn(n.app))return Promise.reject(nr(n,"operation-not-supported-in-this-environment"));const r=ln(n);Ll(n,e,si);const s=ha(r,t);return new Ms(r,"signInViaPopup",e,s).executeNotNull()}async function A8(n,e,t){const r=je(n);if(fn(r.auth.app))return Promise.reject(nr(r.auth,"operation-not-supported-in-this-environment"));Ll(r.auth,e,si);const s=ha(r.auth,t);return new Ms(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function S8(n,e,t){const r=je(n);Ll(r.auth,e,si);const s=ha(r.auth,t);return new Ms(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Ms extends cT{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Ms.currentPopupAction&&Ms.currentPopupAction.cancel(),Ms.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Te(e,this.auth,"internal-error"),e}async onExecution(){Qs(this.filter.length===1,"Popup operations only handle one event");const e=vf();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(nr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(nr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ms.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(nr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,GO.get())};e()}}Ms.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WO="pendingRedirect",qd=new Map;class QO extends cT{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=qd.get(this.auth._key());if(!e){try{const r=await JO(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}qd.set(this.auth._key(),e)}return this.bypassAuthState||qd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function JO(n,e){const t=hT(e),r=dT(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function gv(n,e){return dT(n)._set(hT(e),"true")}function YO(n,e){qd.set(n._key(),e)}function dT(n){return Os(n._redirectPersistence)}function hT(n){return jd(WO,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P8(n,e,t){return XO(n,e,t)}async function XO(n,e,t){if(fn(n.app))return Promise.reject(Dn(n));const r=ln(n);Ll(n,e,si),await r._initializationPromise;const s=ha(r,t);return await gv(s,r),s._openRedirect(r,e,"signInViaRedirect")}function C8(n,e,t){return ZO(n,e,t)}async function ZO(n,e,t){const r=je(n);if(Ll(r.auth,e,si),fn(r.auth.app))return Promise.reject(Dn(r.auth));await r.auth._initializationPromise;const s=ha(r.auth,t);await gv(s,r.auth);const i=await pT(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function R8(n,e,t){return eM(n,e,t)}async function eM(n,e,t){const r=je(n);Ll(r.auth,e,si),await r.auth._initializationPromise;const s=ha(r.auth,t);await pf(!1,r,e.providerId),await gv(s,r.auth);const i=await pT(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function k8(n,e){return await ln(n)._initializationPromise,fT(n,e,!1)}async function fT(n,e,t=!1){if(fn(n.app))return Promise.reject(Dn(n));const r=ln(n),s=ha(r,e),o=await new QO(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function pT(n){const e=vf(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tM=10*60*1e3;class nM{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!rM(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!mT(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(nr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=tM&&this.cachedEventUids.clear(),this.cachedEventUids.has(E_(e))}saveEventToCache(e){this.cachedEventUids.add(E_(e)),this.lastProcessedEventTime=Date.now()}}function E_(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function mT({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function rM(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return mT(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sM(n,e={}){return Ht(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iM=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,oM=/^https?/;async function aM(n){if(n.config.emulator)return;const{authorizedDomains:e}=await sM(n);for(const t of e)try{if(lM(t))return}catch{}fr(n,"unauthorized-domain")}function lM(n){const e=cc(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!oM.test(t))return!1;if(iM.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uM=new Mc(3e4,6e4);function T_(){const n=yn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function cM(n){return new Promise((e,t)=>{var r,s,i;function o(){T_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{T_(),t(nr(n,"network-request-failed"))},timeout:uM.get()})}if(!((s=(r=yn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=yn().gapi)===null||i===void 0)&&i.load)o();else{const a=zE("iframefcb");return yn()[a]=()=>{gapi.load?o():t(nr(n,"network-request-failed"))},iv(`${fV()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw zd=null,e})}let zd=null;function dM(n){return zd=zd||cM(n),zd}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hM=new Mc(5e3,15e3),fM="__/auth/iframe",pM="emulator/auth/iframe",mM={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},gM=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function vM(n){const e=n.config;Te(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?rv(e,pM):`https://${n.config.authDomain}/${fM}`,r={apiKey:e.apiKey,appName:n.name,v:El},s=gM.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Il(r).slice(1)}`}async function yM(n){const e=await dM(n),t=yn().gapi;return Te(t,n,"internal-error"),e.open({where:document.body,url:vM(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:mM,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=nr(n,"network-request-failed"),a=yn().setTimeout(()=>{i(o)},hM.get());function l(){yn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _M={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},bM=500,wM=600,xM="_blank",IM="http://localhost";class A_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function EM(n,e,t,r=bM,s=wM){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},_M),{width:r.toString(),height:s.toString(),top:i,left:o}),c=xn().toLowerCase();t&&(a=LE(c)?xM:t),OE(c)&&(e=e||IM,l.scrollbars="yes");const h=Object.entries(l).reduce((g,[v,I])=>`${g}${v}=${I},`,"");if(rV(c)&&a!=="_self")return TM(e||"",a),new A_(null);const f=window.open(e||"",a,h);Te(f,n,"popup-blocked");try{f.focus()}catch{}return new A_(f)}function TM(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AM="__/auth/handler",SM="emulator/auth/handler",PM=encodeURIComponent("fac");async function S_(n,e,t,r,s,i){Te(n.config.authDomain,n,"auth-domain-config-required"),Te(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:El,eventId:s};if(e instanceof si){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",wP(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof $l){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),c=l?`#${PM}=${encodeURIComponent(l)}`:"";return`${CM(n)}?${Il(a).slice(1)}${c}`}function CM({config:n}){return n.emulator?rv(n,SM):`https://${n.authDomain}/${AM}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vp="webStorageSupport";class RM{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=iT,this._completeRedirectFn=fT,this._overrideRedirectResult=YO}async _openPopup(e,t,r,s){var i;Qs((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await S_(e,t,r,cc(),s);return EM(e,o,vf())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await S_(e,t,r,cc(),s);return bO(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Qs(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await yM(e),r=new nM(e);return t.register("authEvent",s=>(Te(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(vp,{type:vp},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[vp];o!==void 0&&t(!!o),fr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=aM(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return BE()||ME()||sv()}}const kM=RM;class gT{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return as("unexpected MultiFactorSessionType")}}}class vv extends gT{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new vv(e)}_finalizeEnroll(e,t,r){return hO(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return kO(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class DM{constructor(){}static assertion(e){return vv._fromCredential(e)}}DM.FACTOR_ID="phone";class NM{static assertionForEnrollment(e,t){return mc._fromSecret(e,t)}static assertionForSignIn(e,t){return mc._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;Te(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await fO(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return yv._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}NM.FACTOR_ID="totp";class mc extends gT{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new mc(t,void 0,e)}static _fromEnrollmentId(e,t){return new mc(t,e)}async _finalizeEnroll(e,t,r){return Te(typeof this.secret<"u",e,"argument-error"),pO(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){Te(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return DO(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class yv{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new yv(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(xd(e)||xd(t))&&(s=!0),s&&(xd(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),xd(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function xd(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var P_="@firebase/auth",C_="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VM{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Te(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OM(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function MM(n){ds(new Kr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;Te(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:qE(n)},c=new uV(r,s,i,l);return yV(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),ds(new Kr("auth-internal",e=>{const t=ln(e.getProvider("auth").getImmediate());return(r=>new VM(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),kr(P_,C_,OM(n)),kr(P_,C_,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LM=5*60,$M=Ew("authIdTokenMaxAge")||LM;let R_=null;const FM=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>$M)return;const s=t==null?void 0:t.token;R_!==s&&(R_=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function UM(n=Hm()){const e=no(n,"auth");if(e.isInitialized())return e.getImmediate();const t=vV(n,{popupRedirectResolver:kM,persistence:[CO,rT,iT]}),r=Ew("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=FM(i.toString());lO(t,o,()=>o(t.currentUser)),aO(t,a=>o(a))}}const s=xw("auth");return s&&_V(t,`http://${s}`),t}function jM(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}cV({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=nr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",jM().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});MM("Browser");const BM={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},Bc=Cw(BM),le=fN(Bc),Ge=UM(Bc);try{pN(le)}catch{}try{oO(Ge,rT)}catch{}uO(Ge,n=>{n||BV(Ge)});async function qM(n,e){try{return(await QV(Ge,n,e)).user}catch(t){throw t}}async function vT(n,e){try{return(await JV(Ge,n,e)).user}catch(t){throw t}}async function _v(n){try{await KV(Ge,n)}catch(e){throw e}}async function zM(n){try{const e=Ge.currentUser;if(e)await eO(e,n);else throw new Error("Aucun utilisateur connect")}catch(e){throw e}}const ji=Object.freeze(Object.defineProperty({__proto__:null,app:Bc,auth:Ge,createPlayerAccount:qM,db:le,resetPlayerPassword:_v,signInPlayer:vT,updatePlayerPassword:zM},Symbol.toStringTag,{value:"Module"})),cm="BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8";async function yT(){try{return await nx()}catch{return!1}}async function _T(){if(typeof navigator>"u"||!navigator.serviceWorker)return null;const n=await navigator.serviceWorker.getRegistration();if(n&&n.active)return n;const e=await navigator.serviceWorker.register("/service-worker.js");return new Promise(t=>{if(e.active){t(e);return}const r=()=>{e.active&&(e.removeEventListener("statechange",r),t(e))};e.addEventListener("statechange",r)})}async function HM(n){var i;if(!await yT()||await Notification.requestPermission()!=="granted")return null;const t=rx(Bc);let r=n||await _T();const s=await sx(t,r?{vapidKey:cm,serviceWorkerRegistration:r}:{vapidKey:cm});try{const o=((i=Ge==null?void 0:Ge.currentUser)==null?void 0:i.email)||"anonymous";o&&s&&await sn(Pe(le,"userPushTokens",o),{tokens:MN(s),lastToken:s,email:o,updatedAt:Ws(),userAgent:navigator.userAgent,lastActivation:Ws()},{merge:!0})}catch{}return s}async function Ou(){try{const n=localStorage.getItem("fcmToken");if(n){const r=rx(Bc);try{const s=await sx(r,{vapidKey:cm});if(s===n)return{active:!0,token:s}}catch{}}const e=await _T(),t=await HM(e);return t?(localStorage.setItem("fcmToken",t),{active:!0,token:t}):{active:!1,error:"Failed to get token"}}catch(n){return{active:!1,error:n.message}}}function KM(){setInterval(async()=>{try{const n=await Ou();n.active||(console.log("Push notifications inactive, attempting to reactivate..."),window.dispatchEvent(new CustomEvent("push-status-changed",{detail:n})))}catch(n){console.warn("Push health check failed:",n)}},5*60*1e3)}const GM={class:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between"},WM={class:"flex items-center space-x-3"},QM={class:"bg-white rounded-2xl shadow-2xl border border-gray-100 p-6 mx-4 max-w-sm w-full transform hover:scale-105 transition-all duration-300 cursor-pointer"},JM={class:"flex justify-center"},YM={key:0,class:"fixed inset-0 z-[200] flex items-center justify-center bg-black/50 backdrop-blur-sm"},XM={__name:"App",setup(n){const e=C(null),t=C(!1),r=C(!1),s=C(!1),i=C(!1);function o(v){v.preventDefault(),e.value=v,t.value=!0;const I=localStorage.getItem("hatcast-pwa-banner-last-shown"),T=Date.now(),A=24*60*60*1e3;I&&T-parseInt(I)<A?t.value=!1:localStorage.setItem("hatcast-pwa-banner-last-shown",T.toString())}async function a(){if(e.value){try{e.value.prompt();const{outcome:v}=await e.value.userChoice;v==="accepted"?(console.log("PWA installe avec succs"),localStorage.setItem("hatcast-pwa-installed","true")):console.log("Installation PWA refuse par l'utilisateur")}catch(v){console.error("Erreur lors de l'installation PWA:",v)}t.value=!1,e.value=null,i.value=!0}}function l(){i.value=!0,localStorage.setItem("hatcast-pwa-banner-dismissed",Date.now().toString())}function c(){t.value=!1,e.value=null,i.value=!0,localStorage.setItem("hatcast-pwa-installed","true")}function h(){const v=localStorage.getItem("hatcast-pwa-installed"),I=localStorage.getItem("hatcast-pwa-banner-dismissed");if(v==="true"){t.value=!1;return}if(I){const T=Date.now(),A=60*60*1e3;T-parseInt(I)<A&&(i.value=!0)}}function f(){s.value=!0,console.log(" Dbut de la mise  jour PWA..."),setTimeout(async()=>{try{if(console.log(" Vrification du service worker..."),"serviceWorker"in navigator){const v=await navigator.serviceWorker.getRegistration();console.log(" Enregistrement SW trouv:",v),v&&v.active?(console.log(" Service worker actif trouv, envoi du message SKIP_WAITING..."),v.active.postMessage({type:"SKIP_WAITING"}),console.log(" Message SKIP_WAITING envoy"),await new Promise(I=>setTimeout(I,500)),console.log(" Attente de 500ms termine"),v.waiting?(console.log(" Service worker en attente dtect, attente de l'activation..."),await new Promise(I=>{const T=()=>{v.waiting?(console.log(" Service worker toujours en attente, nouvelle vrification dans 100ms..."),setTimeout(T,100)):(console.log(" Service worker activ avec succs"),I())};T()})):console.log(" Aucun service worker en attente")):console.warn(" Aucun service worker actif trouv")}else console.warn(" Service Worker non support sur cet appareil");console.log(" Rechargement de la page..."),window.location.reload()}catch(v){console.error(" Erreur lors de la mise  jour:",v),s.value=!1,alert(`Erreur lors de la mise  jour: ${v.message}

Veuillez rafrachir manuellement la page.`)}},1e3)}function g(){r.value=!0}return pn(()=>{h(),Ou().then(v=>{v.active?console.log("Notifications push actives au dmarrage"):console.log("Notifications push inactives au dmarrage:",v.error)}),window.addEventListener("beforeinstallprompt",o),window.addEventListener("appinstalled",c),window.addEventListener("pwa-update-test",g),"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{s.value||(r.value=!0)}),navigator.serviceWorker.addEventListener("message",v=>{v.data&&v.data.type==="SW_UPDATING"&&console.log("Service worker en cours de mise  jour...")}),setInterval(()=>{navigator.serviceWorker.getRegistration().then(v=>{v&&v.update()})},60*60*1e3))}),Om(()=>{window.removeEventListener("beforeinstallprompt",o),window.removeEventListener("appinstalled",c),window.removeEventListener("pwa-update-test",g)}),(v,I)=>{const T=P1("router-view");return D(),O(it,null,[Ke(T),Ke(Kf,{name:"install-banner",appear:""},{default:Td(()=>[t.value&&!i.value?(D(),O("div",{key:0,class:"fixed top-0 left-0 right-0 z-50 bg-black text-white shadow-lg border-b border-gray-800",onClick:a},[d("div",GM,[I[1]||(I[1]=d("div",{class:"flex items-center space-x-3 flex-1"},[d("img",{src:eP,alt:"HatCast",class:"w-8 h-8 rounded-lg"}),d("div",{class:"flex-1"},[d("div",{class:"flex items-center space-x-2"},[d("span",{class:"font-semibold text-lg text-white"},"HatCast")]),d("p",{class:"text-sm text-gray-300 leading-tight"}," Installez l'app pour une meilleure exprience ")])],-1)),d("div",WM,[d("button",{class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",onClick:lt(a,["stop"])}," Installer "),d("button",{class:"text-gray-400 hover:text-white p-2 rounded-full hover:bg-gray-800 transition-colors",onClick:lt(l,["stop"]),"aria-label":"Fermer la barre d'installation"},I[0]||(I[0]=[d("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])])):ce("",!0)]),_:1}),Ke(Kf,{name:"update-banner",appear:""},{default:Td(()=>[r.value&&!s.value?(D(),O("div",{key:0,class:"fixed inset-0 z-[200] flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:f},[d("div",QM,[I[3]||(I[3]=d("div",{class:"flex justify-center mb-4"},[d("div",{class:"w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center shadow-lg"},[d("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})])])],-1)),I[4]||(I[4]=d("div",{class:"text-center mb-6"},[d("h3",{class:"text-xl font-bold text-gray-900 mb-2"},"  Nouvelle version disponible ! "),d("p",{class:"text-gray-600 leading-relaxed"}," HatCast a t amlior avec de nouvelles fonctionnalits et corrections. Mettez  jour maintenant pour profiter des dernires amliorations. ")],-1)),d("div",JM,[d("button",{class:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 transition-all duration-200 flex items-center space-x-2",onClick:lt(f,["stop"])},I[2]||(I[2]=[d("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),d("span",null,"Mettre  jour maintenant",-1)]))]),I[5]||(I[5]=d("p",{class:"text-center text-xs text-gray-400 mt-4"}," Cliquez n'importe o pour fermer ",-1))])])):ce("",!0)]),_:1}),Ke(Kf,{name:"update-progress",appear:""},{default:Td(()=>[s.value?(D(),O("div",YM,I[6]||(I[6]=[d("div",{class:"bg-white rounded-2xl shadow-2xl border border-gray-100 p-8 mx-4 max-w-sm w-full text-center"},[d("div",{class:"flex justify-center mb-6"},[d("div",{class:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[d("svg",{class:"w-10 h-10 text-white animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})])])]),d("h3",{class:"text-xl font-bold text-gray-900 mb-3"}," Mise  jour en cours... "),d("p",{class:"text-gray-600"}," Veuillez patienter pendant qu'HatCast se met  jour "),d("div",{class:"mt-6 bg-gray-200 rounded-full h-2 overflow-hidden"},[d("div",{class:"bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full animate-pulse"})])],-1)]))):ce("",!0)]),_:1})],64)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const ja=typeof document<"u";function bT(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function ZM(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&bT(n.default)}const Tt=Object.assign;function yp(n,e){const t={};for(const r in e){const s=e[r];t[r]=Gr(s)?s.map(n):n(s)}return t}const Mu=()=>{},Gr=Array.isArray,wT=/#/g,eL=/&/g,tL=/\//g,nL=/=/g,rL=/\?/g,xT=/\+/g,sL=/%5B/g,iL=/%5D/g,IT=/%5E/g,oL=/%60/g,ET=/%7B/g,aL=/%7C/g,TT=/%7D/g,lL=/%20/g;function bv(n){return encodeURI(""+n).replace(aL,"|").replace(sL,"[").replace(iL,"]")}function uL(n){return bv(n).replace(ET,"{").replace(TT,"}").replace(IT,"^")}function dm(n){return bv(n).replace(xT,"%2B").replace(lL,"+").replace(wT,"%23").replace(eL,"%26").replace(oL,"`").replace(ET,"{").replace(TT,"}").replace(IT,"^")}function cL(n){return dm(n).replace(nL,"%3D")}function dL(n){return bv(n).replace(wT,"%23").replace(rL,"%3F")}function hL(n){return n==null?"":dL(n).replace(tL,"%2F")}function gc(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const fL=/\/$/,pL=n=>n.replace(fL,"");function _p(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=yL(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:gc(o)}}function mL(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function k_(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function gL(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&bl(e.matched[r],t.matched[s])&&AT(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function bl(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function AT(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!vL(n[t],e[t]))return!1;return!0}function vL(n,e){return Gr(n)?D_(n,e):Gr(e)?D_(e,n):n===e}function D_(n,e){return Gr(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function yL(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const Ii={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var vc;(function(n){n.pop="pop",n.push="push"})(vc||(vc={}));var Lu;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Lu||(Lu={}));function _L(n){if(!n)if(ja){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),pL(n)}const bL=/^[^#]+#/;function wL(n,e){return n.replace(bL,"#")+e}function xL(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const bf=()=>({left:window.scrollX,top:window.scrollY});function IL(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=xL(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function N_(n,e){return(history.state?history.state.position-e:-1)+n}const hm=new Map;function EL(n,e){hm.set(n,e)}function TL(n){const e=hm.get(n);return hm.delete(n),e}let AL=()=>location.protocol+"//"+location.host;function ST(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),k_(l,"")}return k_(t,n)+r+s}function SL(n,e,t,r){let s=[],i=[],o=null;const a=({state:g})=>{const v=ST(n,location),I=t.value,T=e.value;let A=0;if(g){if(t.value=v,e.value=g,o&&o===I){o=null;return}A=T?g.position-T.position:0}else r(v);s.forEach(F=>{F(t.value,I,{delta:A,type:vc.pop,direction:A?A>0?Lu.forward:Lu.back:Lu.unknown})})};function l(){o=t.value}function c(g){s.push(g);const v=()=>{const I=s.indexOf(g);I>-1&&s.splice(I,1)};return i.push(v),v}function h(){const{history:g}=window;g.state&&g.replaceState(Tt({},g.state,{scroll:bf()}),"")}function f(){for(const g of i)g();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",h)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",h,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function V_(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?bf():null}}function PL(n){const{history:e,location:t}=window,r={value:ST(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,h){const f=n.indexOf("#"),g=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:AL()+n+l;try{e[h?"replaceState":"pushState"](c,"",g),s.value=c}catch(v){console.error(v),t[h?"replace":"assign"](g)}}function o(l,c){const h=Tt({},e.state,V_(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,h,!0),r.value=l}function a(l,c){const h=Tt({},s.value,e.state,{forward:l,scroll:bf()});i(h.current,h,!0);const f=Tt({},V_(r.value,l,null),{position:h.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function CL(n){n=_L(n);const e=PL(n),t=SL(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=Tt({location:"",base:n,go:r,createHref:wL.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function RL(n){return typeof n=="string"||n&&typeof n=="object"}function PT(n){return typeof n=="string"||typeof n=="symbol"}const CT=Symbol("");var O_;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(O_||(O_={}));function wl(n,e){return Tt(new Error,{type:n,[CT]:!0},e)}function Ss(n,e){return n instanceof Error&&CT in n&&(e==null||!!(n.type&e))}const M_="[^/]+?",kL={sensitive:!1,strict:!1,start:!0,end:!0},DL=/[.+*?^${}()[\]/\\]/g;function NL(n,e){const t=Tt({},kL,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const h=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const g=c[f];let v=40+(t.sensitive?.25:0);if(g.type===0)f||(s+="/"),s+=g.value.replace(DL,"\\$&"),v+=40;else if(g.type===1){const{value:I,repeatable:T,optional:A,regexp:F}=g;i.push({name:I,repeatable:T,optional:A});const U=F||M_;if(U!==M_){v+=10;try{new RegExp(`(${U})`)}catch($){throw new Error(`Invalid custom RegExp for param "${I}" (${U}): `+$.message)}}let L=T?`((?:${U})(?:/(?:${U}))*)`:`(${U})`;f||(L=A&&c.length<2?`(?:/${L})`:"/"+L),A&&(L+="?"),s+=L,v+=20,A&&(v+=-8),T&&(v+=-20),U===".*"&&(v+=-50)}h.push(v)}r.push(h)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const h=c.match(o),f={};if(!h)return null;for(let g=1;g<h.length;g++){const v=h[g]||"",I=i[g-1];f[I.name]=v&&I.repeatable?v.split("/"):v}return f}function l(c){let h="",f=!1;for(const g of n){(!f||!h.endsWith("/"))&&(h+="/"),f=!1;for(const v of g)if(v.type===0)h+=v.value;else if(v.type===1){const{value:I,repeatable:T,optional:A}=v,F=I in c?c[I]:"";if(Gr(F)&&!T)throw new Error(`Provided param "${I}" is an array but it is not repeatable (* or + modifiers)`);const U=Gr(F)?F.join("/"):F;if(!U)if(A)g.length<2&&(h.endsWith("/")?h=h.slice(0,-1):f=!0);else throw new Error(`Missing required param "${I}"`);h+=U}}return h||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function VL(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function RT(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=VL(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(L_(r))return 1;if(L_(s))return-1}return s.length-r.length}function L_(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const OL={type:0,value:""},ML=/[a-zA-Z0-9_]/;function LL(n){if(!n)return[[]];if(n==="/")return[[OL]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(v){throw new Error(`ERR (${t})/"${c}": ${v}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",h="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:h,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function g(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):g();break;case 4:g(),t=r;break;case 1:l==="("?t=2:ML.test(l)?g():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?h[h.length-1]=="\\"?h=h.slice(0,-1)+l:t=3:h+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,h="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function $L(n,e,t){const r=NL(LL(n.path),t),s=Tt(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function FL(n,e){const t=[],r=new Map;e=j_({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,g,v){const I=!v,T=F_(f);T.aliasOf=v&&v.record;const A=j_(e,f),F=[T];if("alias"in f){const $=typeof f.alias=="string"?[f.alias]:f.alias;for(const ue of $)F.push(F_(Tt({},T,{components:v?v.record.components:T.components,path:ue,aliasOf:v?v.record:T})))}let U,L;for(const $ of F){const{path:ue}=$;if(g&&ue[0]!=="/"){const se=g.record.path,E=se[se.length-1]==="/"?"":"/";$.path=g.record.path+(ue&&E+ue)}if(U=$L($,g,A),v?v.alias.push(U):(L=L||U,L!==U&&L.alias.push(U),I&&f.name&&!U_(U)&&o(f.name)),kT(U)&&l(U),T.children){const se=T.children;for(let E=0;E<se.length;E++)i(se[E],U,v&&v.children[E])}v=v||U}return L?()=>{o(L)}:Mu}function o(f){if(PT(f)){const g=r.get(f);g&&(r.delete(f),t.splice(t.indexOf(g),1),g.children.forEach(o),g.alias.forEach(o))}else{const g=t.indexOf(f);g>-1&&(t.splice(g,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const g=BL(f,t);t.splice(g,0,f),f.record.name&&!U_(f)&&r.set(f.record.name,f)}function c(f,g){let v,I={},T,A;if("name"in f&&f.name){if(v=r.get(f.name),!v)throw wl(1,{location:f});A=v.record.name,I=Tt($_(g.params,v.keys.filter(L=>!L.optional).concat(v.parent?v.parent.keys.filter(L=>L.optional):[]).map(L=>L.name)),f.params&&$_(f.params,v.keys.map(L=>L.name))),T=v.stringify(I)}else if(f.path!=null)T=f.path,v=t.find(L=>L.re.test(T)),v&&(I=v.parse(T),A=v.record.name);else{if(v=g.name?r.get(g.name):t.find(L=>L.re.test(g.path)),!v)throw wl(1,{location:f,currentLocation:g});A=v.record.name,I=Tt({},g.params,f.params),T=v.stringify(I)}const F=[];let U=v;for(;U;)F.unshift(U.record),U=U.parent;return{name:A,path:T,params:I,matched:F,meta:jL(F)}}n.forEach(f=>i(f));function h(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:h,getRoutes:a,getRecordMatcher:s}}function $_(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function F_(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:UL(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function UL(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function U_(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function jL(n){return n.reduce((e,t)=>Tt(e,t.meta),{})}function j_(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function BL(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;RT(n,e[i])<0?r=i:t=i+1}const s=qL(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function qL(n){let e=n;for(;e=e.parent;)if(kT(e)&&RT(n,e)===0)return e}function kT({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function zL(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(xT," "),o=i.indexOf("="),a=gc(o<0?i:i.slice(0,o)),l=o<0?null:gc(i.slice(o+1));if(a in e){let c=e[a];Gr(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function B_(n){let e="";for(let t in n){const r=n[t];if(t=cL(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(Gr(r)?r.map(i=>i&&dm(i)):[r&&dm(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function HL(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=Gr(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const KL=Symbol(""),q_=Symbol(""),wf=Symbol(""),wv=Symbol(""),fm=Symbol("");function du(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function Si(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=g=>{g===!1?l(wl(4,{from:t,to:e})):g instanceof Error?l(g):RL(g)?l(wl(2,{from:e,to:g})):(o&&r.enterCallbacks[s]===o&&typeof g=="function"&&o.push(g),a())},h=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(h);n.length<3&&(f=f.then(c)),f.catch(g=>l(g))})}function bp(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(bT(l)){const h=(l.__vccOpts||l)[e];h&&i.push(Si(h,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(h=>{if(!h)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=ZM(h)?h.default:h;o.mods[a]=h,o.components[a]=f;const v=(f.__vccOpts||f)[e];return v&&Si(v,t,r,o,a,s)()}))}}return i}function z_(n){const e=qr(wf),t=qr(wv),r=Fe(()=>{const l=Br(n.to);return e.resolve(l)}),s=Fe(()=>{const{matched:l}=r.value,{length:c}=l,h=l[c-1],f=t.matched;if(!h||!f.length)return-1;const g=f.findIndex(bl.bind(null,h));if(g>-1)return g;const v=H_(l[c-2]);return c>1&&H_(h)===v&&f[f.length-1].path!==v?f.findIndex(bl.bind(null,l[c-2])):g}),i=Fe(()=>s.value>-1&&YL(t.params,r.value.params)),o=Fe(()=>s.value>-1&&s.value===t.matched.length-1&&AT(t.params,r.value.params));function a(l={}){if(JL(l)){const c=e[Br(n.replace)?"replace":"push"](Br(n.to)).catch(Mu);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:Fe(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function GL(n){return n.length===1?n[0]:n}const WL=Hb({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:z_,setup(n,{slots:e}){const t=Rh(z_(n)),{options:r}=qr(wf),s=Fe(()=>({[K_(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[K_(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&GL(e.default(t));return n.custom?i:jm("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),QL=WL;function JL(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function YL(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!Gr(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function H_(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const K_=(n,e,t)=>n??e??t,XL=Hb({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=qr(fm),s=Fe(()=>n.route||r.value),i=qr(q_,0),o=Fe(()=>{let c=Br(i);const{matched:h}=s.value;let f;for(;(f=h[c])&&!f.components;)c++;return c}),a=Fe(()=>s.value.matched[o.value]);Sd(q_,Fe(()=>o.value+1)),Sd(KL,a),Sd(fm,s);const l=C();return bt(()=>[l.value,a.value,n.name],([c,h,f],[g,v,I])=>{h&&(h.instances[f]=c,v&&v!==h&&c&&c===g&&(h.leaveGuards.size||(h.leaveGuards=v.leaveGuards),h.updateGuards.size||(h.updateGuards=v.updateGuards))),c&&h&&(!v||!bl(h,v)||!g)&&(h.enterCallbacks[f]||[]).forEach(T=>T(c))},{flush:"post"}),()=>{const c=s.value,h=n.name,f=a.value,g=f&&f.components[h];if(!g)return G_(t.default,{Component:g,route:c});const v=f.props[h],I=v?v===!0?c.params:typeof v=="function"?v(c):v:null,A=jm(g,Tt({},I,e,{onVnodeUnmounted:F=>{F.component.isUnmounted&&(f.instances[h]=null)},ref:l}));return G_(t.default,{Component:A,route:c})||A}}});function G_(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const ZL=XL;function e4(n){const e=FL(n.routes,n),t=n.parseQuery||zL,r=n.stringifyQuery||B_,s=n.history,i=du(),o=du(),a=du(),l=s1(Ii);let c=Ii;ja&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=yp.bind(null,X=>""+X),f=yp.bind(null,hL),g=yp.bind(null,gc);function v(X,Ae){let xe,Ve;return PT(X)?(xe=e.getRecordMatcher(X),Ve=Ae):Ve=X,e.addRoute(Ve,xe)}function I(X){const Ae=e.getRecordMatcher(X);Ae&&e.removeRoute(Ae)}function T(){return e.getRoutes().map(X=>X.record)}function A(X){return!!e.getRecordMatcher(X)}function F(X,Ae){if(Ae=Tt({},Ae||l.value),typeof X=="string"){const N=_p(t,X,Ae.path),K=e.resolve({path:N.path},Ae),G=s.createHref(N.fullPath);return Tt(N,K,{params:g(K.params),hash:gc(N.hash),redirectedFrom:void 0,href:G})}let xe;if(X.path!=null)xe=Tt({},X,{path:_p(t,X.path,Ae.path).path});else{const N=Tt({},X.params);for(const K in N)N[K]==null&&delete N[K];xe=Tt({},X,{params:f(N)}),Ae.params=f(Ae.params)}const Ve=e.resolve(xe,Ae),rt=X.hash||"";Ve.params=h(g(Ve.params));const dt=mL(r,Tt({},X,{hash:uL(rt),path:Ve.path})),S=s.createHref(dt);return Tt({fullPath:dt,hash:rt,query:r===B_?HL(X.query):X.query||{}},Ve,{redirectedFrom:void 0,href:S})}function U(X){return typeof X=="string"?_p(t,X,l.value.path):Tt({},X)}function L(X,Ae){if(c!==X)return wl(8,{from:Ae,to:X})}function $(X){return E(X)}function ue(X){return $(Tt(U(X),{replace:!0}))}function se(X){const Ae=X.matched[X.matched.length-1];if(Ae&&Ae.redirect){const{redirect:xe}=Ae;let Ve=typeof xe=="function"?xe(X):xe;return typeof Ve=="string"&&(Ve=Ve.includes("?")||Ve.includes("#")?Ve=U(Ve):{path:Ve},Ve.params={}),Tt({query:X.query,hash:X.hash,params:Ve.path!=null?{}:X.params},Ve)}}function E(X,Ae){const xe=c=F(X),Ve=l.value,rt=X.state,dt=X.force,S=X.replace===!0,N=se(xe);if(N)return E(Tt(U(N),{state:typeof N=="object"?Tt({},rt,N.state):rt,force:dt,replace:S}),Ae||xe);const K=xe;K.redirectedFrom=Ae;let G;return!dt&&gL(r,Ve,xe)&&(G=wl(16,{to:K,from:Ve}),Z(Ve,Ve,!0,!1)),(G?Promise.resolve(G):R(K,Ve)).catch(te=>Ss(te)?Ss(te,2)?te:ke(te):ae(te,K,Ve)).then(te=>{if(te){if(Ss(te,2))return E(Tt({replace:S},U(te.to),{state:typeof te.to=="object"?Tt({},rt,te.to.state):rt,force:dt}),Ae||K)}else te=k(K,Ve,!0,S,rt);return M(K,Ve,te),te})}function _(X,Ae){const xe=L(X,Ae);return xe?Promise.reject(xe):Promise.resolve()}function x(X){const Ae=Je.values().next().value;return Ae&&typeof Ae.runWithContext=="function"?Ae.runWithContext(X):X()}function R(X,Ae){let xe;const[Ve,rt,dt]=t4(X,Ae);xe=bp(Ve.reverse(),"beforeRouteLeave",X,Ae);for(const N of Ve)N.leaveGuards.forEach(K=>{xe.push(Si(K,X,Ae))});const S=_.bind(null,X,Ae);return xe.push(S),Ot(xe).then(()=>{xe=[];for(const N of i.list())xe.push(Si(N,X,Ae));return xe.push(S),Ot(xe)}).then(()=>{xe=bp(rt,"beforeRouteUpdate",X,Ae);for(const N of rt)N.updateGuards.forEach(K=>{xe.push(Si(K,X,Ae))});return xe.push(S),Ot(xe)}).then(()=>{xe=[];for(const N of dt)if(N.beforeEnter)if(Gr(N.beforeEnter))for(const K of N.beforeEnter)xe.push(Si(K,X,Ae));else xe.push(Si(N.beforeEnter,X,Ae));return xe.push(S),Ot(xe)}).then(()=>(X.matched.forEach(N=>N.enterCallbacks={}),xe=bp(dt,"beforeRouteEnter",X,Ae,x),xe.push(S),Ot(xe))).then(()=>{xe=[];for(const N of o.list())xe.push(Si(N,X,Ae));return xe.push(S),Ot(xe)}).catch(N=>Ss(N,8)?N:Promise.reject(N))}function M(X,Ae,xe){a.list().forEach(Ve=>x(()=>Ve(X,Ae,xe)))}function k(X,Ae,xe,Ve,rt){const dt=L(X,Ae);if(dt)return dt;const S=Ae===Ii,N=ja?history.state:{};xe&&(Ve||S?s.replace(X.fullPath,Tt({scroll:S&&N&&N.scroll},rt)):s.push(X.fullPath,rt)),l.value=X,Z(X,Ae,xe,S),ke()}let P;function Qe(){P||(P=s.listen((X,Ae,xe)=>{if(!ct.listening)return;const Ve=F(X),rt=se(Ve);if(rt){E(Tt(rt,{replace:!0,force:!0}),Ve).catch(Mu);return}c=Ve;const dt=l.value;ja&&EL(N_(dt.fullPath,xe.delta),bf()),R(Ve,dt).catch(S=>Ss(S,12)?S:Ss(S,2)?(E(Tt(U(S.to),{force:!0}),Ve).then(N=>{Ss(N,20)&&!xe.delta&&xe.type===vc.pop&&s.go(-1,!1)}).catch(Mu),Promise.reject()):(xe.delta&&s.go(-xe.delta,!1),ae(S,Ve,dt))).then(S=>{S=S||k(Ve,dt,!1),S&&(xe.delta&&!Ss(S,8)?s.go(-xe.delta,!1):xe.type===vc.pop&&Ss(S,20)&&s.go(-1,!1)),M(Ve,dt,S)}).catch(Mu)}))}let nt=du(),be=du(),ne;function ae(X,Ae,xe){ke(X);const Ve=be.list();return Ve.length?Ve.forEach(rt=>rt(X,Ae,xe)):console.error(X),Promise.reject(X)}function ie(){return ne&&l.value!==Ii?Promise.resolve():new Promise((X,Ae)=>{nt.add([X,Ae])})}function ke(X){return ne||(ne=!X,Qe(),nt.list().forEach(([Ae,xe])=>X?xe(X):Ae()),nt.reset()),X}function Z(X,Ae,xe,Ve){const{scrollBehavior:rt}=n;if(!ja||!rt)return Promise.resolve();const dt=!xe&&TL(N_(X.fullPath,0))||(Ve||!xe)&&history.state&&history.state.scroll||null;return Gt().then(()=>rt(X,Ae,dt)).then(S=>S&&IL(S)).catch(S=>ae(S,X,Ae))}const Q=X=>s.go(X);let Ee;const Je=new Set,ct={currentRoute:l,listening:!0,addRoute:v,removeRoute:I,clearRoutes:e.clearRoutes,hasRoute:A,getRoutes:T,resolve:F,options:n,push:$,replace:ue,go:Q,back:()=>Q(-1),forward:()=>Q(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:be.add,isReady:ie,install(X){const Ae=this;X.component("RouterLink",QL),X.component("RouterView",ZL),X.config.globalProperties.$router=Ae,Object.defineProperty(X.config.globalProperties,"$route",{enumerable:!0,get:()=>Br(l)}),ja&&!Ee&&l.value===Ii&&(Ee=!0,$(s.location).catch(rt=>{}));const xe={};for(const rt in Ii)Object.defineProperty(xe,rt,{get:()=>l.value[rt],enumerable:!0});X.provide(wf,Ae),X.provide(wv,Sb(xe)),X.provide(fm,l);const Ve=X.unmount;Je.add(X),X.unmount=function(){Je.delete(X),Je.size<1&&(c=Ii,P&&P(),P=null,l.value=Ii,Ee=!1,ne=!1),Ve()}}};function Ot(X){return X.reduce((Ae,xe)=>Ae.then(()=>x(xe)),Promise.resolve())}return ct}function t4(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>bl(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>bl(c,l))||s.push(l))}return[t,r,s]}function Fl(){return qr(wf)}function fa(n){return qr(wv)}const n4="modulepreload",r4=function(n){return"/"+n},W_={},en=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=r4(i),i in W_)return;W_[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":n4,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((h,f)=>{c.addEventListener("load",h),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function s4(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=n;let a,l;const c=async(f=!0)=>{await l};async function h(){if("serviceWorker"in navigator){const{Workbox:f}=await en(()=>import("./workbox-window.prod.es5-5ffdab76.js"),[]);a=new f("/service-worker.js",{scope:"/",type:"classic"}),a.addEventListener("activated",g=>{(g.isUpdate||g.isExternal)&&window.location.reload()}),a.addEventListener("installed",g=>{g.isUpdate||r==null||r()}),a.register({immediate:e}).then(g=>{i?i("/service-worker.js",g):s==null||s(g)}).catch(g=>{o==null||o(g)})}}return l=h(),c}const Ul="seasons";async function i4(n,e,t){return await Ml(tt(le,Ul),{name:n,slug:e,pinCode:t,createdAt:Ws()})}async function o4(n){return await _l(Pe(le,Ul,n))}async function Ba(){const n=uc(tt(le,Ul),wN("createdAt","desc"));return(await Pt(n)).docs.map(t=>({id:t.id,...t.data()}))}async function wh(n,e){const t=await jt(Pe(le,Ul,n));return t.exists()?t.data().pinCode===e:!1}async function pm(n){const e=await jt(Pe(le,Ul,n));return e.exists()?e.data().pinCode:null}async function hu(n,e){const t=Pe(le,Ul,n);await Ol(t,{sortOrder:e})}const a4=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function l4(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function DT(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function u4(n){return typeof n!="string"?n:n.length<=2?"":n.length>=8?`${n.slice(0,2)}${n.slice(-2)}`:""}function NT(n){if(!n)return!1;const e=String(n).toLowerCase();return a4.some(t=>e.includes(t.toLowerCase()))}function mm(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"":`${r.slice(0,2)}`,o=s.split("."),a=o[0].length<=2?"":`${o[0].slice(0,2)}`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?u4(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"":n}if(Array.isArray(n))return n.map(e=>mm(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=NT(t)?"":mm(r);return e}return n}function c4(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&NT(s)&&(typeof r=="string"||typeof r=="number")){e.push("");continue}e.push(mm(r))}return e}const d4=DT(l4());function Id(n,e){const t=DT(n);return(...r)=>{if(t<d4)return;const s=c4(r);console[e](...s)}}const H={debug:Id("debug","log"),info:Id("info","info"),warn:Id("warn","warn"),error:Id("error","error")},xv="lastVisitedSeason",VT="lastVisitedSeasonTimestamp";async function h4(n){if(n)try{const e=Ge.currentUser,t=e==null?void 0:e.email;try{localStorage.setItem(xv,n),localStorage.setItem(VT,Date.now().toString())}catch(r){H.warn("Erreur lors de la sauvegarde localStorage",r)}if(t)try{const r=Pe(le,"userPreferences",t);await sn(r,{lastVisitedSeason:n,lastVisitedSeasonTimestamp:Date.now()},{merge:!0}),H.debug("Prfrence de saison sauvegarde dans Firebase",{seasonSlug:n,userEmail:t})}catch(r){H.warn("Erreur lors de la sauvegarde Firebase",r)}}catch(e){H.error("Erreur lors de la mmorisation de la saison",e)}}async function OT(){try{const n=Ge.currentUser,e=n==null?void 0:n.email;if(e)try{const t=Pe(le,"userPreferences",e),r=await jt(t);if(r.exists()){const s=r.data();if(s.lastVisitedSeason)return H.debug("Prfrence de saison rcupre depuis Firebase",{seasonSlug:s.lastVisitedSeason}),s.lastVisitedSeason}}catch(t){H.warn("Erreur lors de la rcupration Firebase",t)}try{const t=localStorage.getItem(xv);if(t)return H.debug("Prfrence de saison rcupre depuis localStorage",{seasonSlug:t}),t}catch(t){H.warn("Erreur lors de la lecture localStorage",t)}return null}catch(n){return H.error("Erreur lors de la rcupration de la dernire saison",n),null}}async function f4(n=null){var e;try{const t=n||((e=Ge.currentUser)==null?void 0:e.email);try{localStorage.removeItem(xv),localStorage.removeItem(VT)}catch(r){H.warn("Erreur lors du nettoyage localStorage",r)}if(t)try{const r=Pe(le,"userPreferences",t);await sn(r,{lastVisitedSeason:null,lastVisitedSeasonTimestamp:null},{merge:!0}),H.debug("Prfrence de saison nettoye dans Firebase",{userEmail:t})}catch(r){H.warn("Erreur lors du nettoyage Firebase",r)}}catch(t){H.error("Erreur lors du nettoyage des prfrences",t)}}function p4(n,e){return!n||!e||!Array.isArray(e)?!1:e.some(t=>t.slug===n)}const Bs=C(null),$i=C(!1),Ds=C(!1),m4=Fe(()=>{var n;return!!Bs.value&&!((n=Bs.value)!=null&&n.isAnonymous)});Fe(()=>!!Bs.value);function tl(){var n;try{const e=Ge.currentUser;e!==Bs.value&&(Bs.value=e,H.debug("Synchronisation force de l'tat d'authentification",{user:((n=Bs.value)==null?void 0:n.email)||"non connect"}))}catch(e){H.error("Erreur lors de la synchronisation force",e)}}function g4(){var n;if(H.debug("Tentative d'initialisation du service d'authentification",{isInitialized:$i.value,isInitializing:Ds.value}),$i.value||Ds.value){H.debug("Service dj initialis ou en cours d'initialisation, sortie");return}Ds.value=!0,H.debug("Marquage du service comme en cours d'initialisation");try{Bs.value=Ge.currentUser,H.debug("tat initial de l'utilisateur:",((n=Bs.value)==null?void 0:n.email)||"non connect");const e=Ge.onAuthStateChanged(t=>{Bs.value=t,$i.value=!0,Ds.value=!1,H.debug("tat d'authentification chang",{isLoggedIn:!!t,email:(t==null?void 0:t.email)||"non connect"})});window._authStateUnsubscribe=e,H.info("Service d'tat d'authentification initialis avec succs")}catch(e){H.error("Erreur lors de l'initialisation du service d'authentification:",e),Ds.value=!1}}function MT(){return new Promise((n,e)=>{if(H.debug("waitForInitialization appel",{isInitialized:$i.value,isInitializing:Ds.value}),$i.value){H.debug("Service dj initialis, rsolution immdiate"),n();return}if(!Ds.value){H.warn("Service d'authentification non initialis et non en cours d'initialisation"),e(new Error("Service d'authentification non initialis"));return}const t=setInterval(()=>{H.debug("Vrification de l'initialisation...",{isInitialized:$i.value,isInitializing:Ds.value}),$i.value&&(clearInterval(t),H.debug("Service initialis, rsolution"),n())},100);setTimeout(()=>{clearInterval(t),H.warn("Timeout de waitForInitialization, rejet de la promesse"),e(new Error("Timeout d'initialisation du service d'authentification"))},5e3)})}function v4(){H.debug("Initialisation force demande"),!$i.value&&!Ds.value&&xh()}function xh(){if(H.debug("Tentative d'auto-initialisation du service d'authentification"),typeof Ge>"u"||!Ge){H.warn("Firebase auth non disponible, nouvelle tentative dans 500ms"),setTimeout(xh,500);return}try{g4()}catch(n){H.error("Erreur lors de l'auto-initialisation:",n),setTimeout(xh,1e3)}}setTimeout(xh,100);const y4={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center"},_4={class:"text-center"},b4={class:"text-white text-lg"},w4={__name:"SeasonResolver",setup(n){const e=Fl(),t=C("Chargement...");return pn(async()=>{try{t.value="Vrification de votre session...",tl(),await MT();const r=await new Promise((o,a)=>{const l=setTimeout(()=>{a(new Error("Timeout Firebase Auth"))},3e3),c=Ge.onAuthStateChanged(h=>{clearTimeout(l),c(),o(h)});Ge.currentUser&&(clearTimeout(l),c(),o(Ge.currentUser))}),s=r==null?void 0:r.email;if(!s){H.info("Utilisateur non connect, redirection vers /seasons"),e.replace("/seasons");return}t.value="Rcupration de vos prfrences...";const i=await OT();if(!i){H.info("Aucune saison mmorise, redirection vers /seasons"),e.replace("/seasons");return}t.value="Vrification de la saison...";try{const o=await Ba();if(!p4(i,o)){H.info("Saison mmorise n'existe plus, redirection vers /seasons"),await f4(s),e.replace("/seasons");return}}catch(o){H.error("Erreur lors de la vrification des saisons",o),e.replace("/seasons");return}H.info("Redirection vers la saison mmorise",{seasonSlug:i}),e.replace(`/season/${i}`)}catch(r){H.error("Erreur lors de la rsolution de la saison",r),e.replace("/seasons")}}),(r,s)=>(D(),O("div",y4,[d("div",_4,[s[0]||(s[0]=d("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"},null,-1)),d("p",b4,re(t.value),1)])]))}},x4="/logos/hatcast-mask.png",LT="/logos/hatcast-logo-mobile.png",wp=7*24*60*60*1e3,fu="hatcast_pin_session";class I4{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(fu);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<wp){try{t.timestamp=Date.now(),localStorage.setItem(fu,JSON.stringify(t))}catch{}return t}else this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(fu,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){if(!this.sessionData)return!1;const t=this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<wp;if(t)try{this.sessionData.timestamp=Date.now(),localStorage.setItem(fu,JSON.stringify(this.sessionData))}catch{}return t}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(fu),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=wp-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const On=new I4,E4={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},T4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},A4={class:"text-center mb-6"},S4={class:"text-gray-300"},P4={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},C4={class:"text-sm text-green-400"},R4={class:"mb-6"},k4={class:"mb-4"},D4={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},N4={class:"flex justify-end space-x-3"},V4=["disabled"],$T={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN  4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=C(""),i=C(""),o=C(null);bt(()=>t.show,h=>{h&&(s.value="",i.value="",Gt(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(h,f)=>n.show?(D(),O("div",E4,[d("div",T4,[d("div",A4,[f[1]||(f[1]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"")],-1)),f[2]||(f[2]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accs requis",-1)),d("p",S4,re(n.message),1),n.sessionInfo?(D(),O("div",P4,[d("p",C4," Session active : "+re(n.sessionInfo.timeRemaining)+" min restantes ",1)])):ce("",!0)]),d("div",R4,[d("div",k4,[f[3]||(f[3]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),ut(d("input",{"onUpdate:modelValue":f[0]||(f[0]=g=>s.value=g),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"",onInput:a,onKeydown:[zn(l,["enter"]),zn(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[Ft,s.value]])]),f[4]||(f[4]=d("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN  4 chiffres",-1))]),i.value||t.error?(D(),O("div",D4,re(i.value||t.error),1)):ce("",!0),d("div",N4,[d("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,V4)])])])):ce("",!0)}},Q_="hatcast_trusted_players",J_=180*24*60*60*1e3;class O4{constructor(){this.trustedMap=this.load()}load(){try{const e=localStorage.getItem(Q_);if(!e)return{};const t=JSON.parse(e);return typeof t=="object"&&t!==null?t:{}}catch{return{}}}persist(){try{localStorage.setItem(Q_,JSON.stringify(this.trustedMap))}catch{}}isPasswordCached(e){if(!e)return!1;const t=this.trustedMap[e];if(!t)return!1;const r=Date.now(),s=r-t<J_;return s?(this.trustedMap[e]=r,this.persist()):(delete this.trustedMap[e],this.persist()),s}getCachedPassword(e){return null}saveSession(e,t){e&&(this.trustedMap[e]=Date.now(),this.persist())}clearSession(e){e&&(delete this.trustedMap[e],this.persist())}clearExpiredSessions(){const e=Date.now();let t=!1;for(const[r,s]of Object.entries(this.trustedMap))e-s>J_&&(delete this.trustedMap[r],t=!0);t&&this.persist()}clearAllSessions(){this.trustedMap={},this.persist()}}const eo=new O4,M4={class:"mt-4"},L4={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-2"},FT={__name:"AccountBenefitsHint",setup(n){const e=C(!1);return(t,r)=>(D(),O("div",M4,[d("button",{onClick:r[0]||(r[0]=s=>e.value=!e.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[r[1]||(r[1]=d("h3",{class:"text-sm font-semibold text-blue-300"}," A quoi sert un compte ?",-1)),d("span",{class:Qt(["text-blue-300 transition-transform duration-200",{"rotate-180":e.value}])},"",2)]),e.value?(D(),O("div",L4,r[2]||(r[2]=[d("div",{class:"text-gray-300"},"a fonctionne trs bien sans compte. Mais si vous en crez un, vous aurez quelques trucs sympas en plus :",-1),d("div",null,[St(" "),d("span",{class:"text-blue-300"},"Protgez vos saisies :"),St(" vous tes sr que personne n'a chang vos dispos car vous tes le seul  pouvoir les modifier")],-1),d("div",null,[St(" "),d("span",{class:"text-blue-300"},"Notifications :"),St(" nouveaux spectacles, disponibilits et slections dans votre boite mail")],-1),d("div",null,[St(" "),d("span",{class:"text-blue-300"},"Saisie simplifie :"),St(" votre joueur reste toujours en haut de la liste")],-1)]))):ce("",!0)]))}},$4={class:"space-y-4"},F4={class:"flex items-center justify-between"},U4={class:"flex items-center gap-2 text-gray-300 text-sm"},j4={key:0,class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},B4={key:1,class:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm"},q4={class:"flex justify-center gap-3 mt-2"},z4=["disabled"],H4={key:0,class:"animate-spin"},K4={key:1},UT={__name:"AccountLoginModal",props:{show:{type:Boolean,default:!1}},emits:["close","success"],setup(n,{emit:e}){const t=e,r=C(""),s=C(""),i=C(!1),o=C(""),a=C(""),l=C(!0),c=Fe(()=>!!r.value&&r.value.includes("@")&&!!s.value);async function h(){if(c.value){i.value=!0,o.value="",a.value="";try{if(await vT(r.value.trim(),s.value),l.value)try{eo.saveSession(r.value.trim())}catch{}t("success")}catch{o.value="Email ou mot de passe incorrect"}finally{i.value=!1}}}async function f(){if(!r.value||!r.value.includes("@")){o.value="Saisissez votre email pour recevoir un lien de rinitialisation",setTimeout(()=>{o.value=""},2500);return}i.value=!0,o.value="",a.value="";try{await _v(r.value.trim()),a.value="Email de rinitialisation envoy"}catch{o.value="Impossible d'envoyer l'email de rinitialisation"}finally{i.value=!1}}return(g,v)=>n.show?(D(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:v[6]||(v[6]=I=>g.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:v[5]||(v[5]=lt(()=>{},["stop"]))},[d("button",{onClick:v[0]||(v[0]=I=>g.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},""),v[10]||(v[10]=Cn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl"></span></div><h2 class="text-2xl font-bold text-white mb-1">Se connecter</h2><p class="text-sm text-gray-300">Connectez-vous pour grer votre compte et vos prfrences</p></div>',1)),d("div",$4,[Ke(FT),d("div",null,[v[7]||(v[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Email",-1)),ut(d("input",{"onUpdate:modelValue":v[1]||(v[1]=I=>r.value=I),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Ft,r.value]])]),d("div",null,[v[8]||(v[8]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),ut(d("input",{"onUpdate:modelValue":v[2]||(v[2]=I=>s.value=I),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe"},null,512),[[Ft,s.value]])]),d("div",F4,[d("label",U4,[ut(d("input",{type:"checkbox","onUpdate:modelValue":v[3]||(v[3]=I=>l.value=I),class:"w-4 h-4"},null,512),[[Mi,l.value]]),v[9]||(v[9]=d("span",null,"Rester connect sur cet appareil",-1))]),d("button",{onClick:f,class:"text-sm text-blue-400 hover:text-blue-300 underline"},"Mot de passe oubli ?")]),o.value?(D(),O("div",j4,re(o.value),1)):ce("",!0),a.value?(D(),O("div",B4,re(a.value),1)):ce("",!0),d("div",q4,[d("button",{onClick:h,disabled:!c.value||i.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(D(),O("span",H4,"")):(D(),O("span",K4,"Se connecter"))],8,z4),d("button",{onClick:v[4]||(v[4]=I=>g.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])])):ce("",!0)}},xf="magicLinks";function If({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function Iv(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function gm({seasonId:n,playerId:e,eventId:t,action:r}){const s=If({seasonId:n,playerId:e,eventId:t,action:r}),i=Iv(40),o=Pe(le,xf,s),a=Date.now()+1e3*60*60*24*7;await sn(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const c=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:c}}async function jT({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=If({seasonId:n,playerId:e,eventId:r,action:s}),o=Iv(40),a=Pe(le,xf,i),l=Date.now()+1e3*60*60*24*7;await sn(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const h=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:h}}async function BT({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=If({seasonId:n,playerId:e,eventId:t,action:s}),o=Pe(le,xf,i),a=await jt(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function vm({seasonId:n,playerId:e,eventId:t,action:r}){const s=If({seasonId:n,playerId:e,eventId:t,action:r}),i=Pe(le,xf,s);await _l(i)}const Ev="accountMagicLinks";function Ef(n){return`account__${n}`}async function qT({currentEmail:n,newEmail:e}){const t=Iv(40),r=Ef(t),s=Pe(le,Ev,r),i=Date.now()+1e3*60*60*24*7;await sn(s,{token:t,currentEmail:n,newEmail:e,action:"account_email_update",expiresAt:i});const a=`${window.location.origin+"/"}magic?a=account_email_update&t=${encodeURIComponent(t)}`;return{id:r,token:t,url:a}}async function zT({token:n}){const e=Ef(n),t=Pe(le,Ev,e),r=await jt(t);if(!r.exists())return{valid:!1,reason:"not_found"};const s=r.data();return s.token!==n?{valid:!1,reason:"token_mismatch"}:typeof s.expiresAt=="number"&&Date.now()>s.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:s}}async function HT({token:n}){const e=Ef(n),t=Pe(le,Ev,e);await _l(t)}const G4=Object.freeze(Object.defineProperty({__proto__:null,buildAccountId:Ef,consumeAccountEmailUpdateLink:HT,consumeMagicLink:vm,createAccountEmailUpdateLink:qT,createEmailVerificationLink:jT,createMagicLink:gm,verifyAccountEmailUpdateLink:zT,verifyMagicLink:BT},Symbol.toStringTag,{value:"Module"}));async function qc({toEmail:n,title:e,body:t,data:r={},reason:s="generic"}){if(!n)return{success:!1,error:"missing_toEmail"};const i={to:n,title:e,body:t,data:r,reason:s,createdAt:Ws()};return await Ml(tt(le,"pushQueue"),i),{success:!0}}function KT({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,yesUrl:s,noUrl:i}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p><strong>Bonjour ${n}</strong>, un nouvel vnement est programm :</p>
      <p style="margin: 12px 0 2px 0;">
        <a href="${r}" style="color:#3b82f6;text-decoration:underline;font-weight:600;">${e}</a>
      </p>
      <p style="margin: 0 0 16px 0; color:#374151;">${t}</p>
      <p>Nous avons besoin de savoir si tu es disponible.</p>
      <p style="margin-top: 12px;">
        <a href="${s}" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;"> Dispo</a>
        <a href="${i}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;"> Pas dispo</a>
      </p>
      <p style="margin-top: 16px;">Merci!!</p>
    </div>
  `}function W4({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,noUrl:s}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>Bonjour <strong>${n}</strong>,</p>
      <p>Tu fais partie de l'quipe pour <a href="${r}" style="color:#8b5cf6;text-decoration:underline;font-weight:600;">${e}</a> (${t}).</p>
      <p>Un imprvu ?</p>
      <p style="margin-top: 8px;">
        <a href="${s}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;"> Plus dispo</a>
      </p>
    </div>
  `}function Q4({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p><strong>Bonjour ${n}</strong>, tu n'as pas configur d'email. Utilise la fonction  Copier le message  et envoie-lui ces informations par un autre canal.</p>
      <p style="margin-top: 8px; font-weight: 600;">${e}</p>
      <p style="color:#374151;">${t}</p>
      <p style="margin-top: 8px;">Lien direct : ${r}</p>
    </div>
  `}function J4({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`Bonjour ${n}, un nouvel vnement est programm :

${e}        
${t}

Nous avons besoin de savoir si tu es disponible.
           Dispo
           Pas dispo
        
Merci!!

Lien direct: ${r}`}function Y4({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`Bonjour ${n},

Tu fais partie de l'quipe pour ${e} (${t}).

Un imprvu ?

 Plus dispo

Lien direct: ${r}`}const X4="HatCast <impropick@gmail.com>",Z4="impropick@gmail.com";function Tf(n=null){return{from:n||X4,replyTo:n||Z4}}async function e3({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,eventUrl:o=void 0,reason:a="new_event",fromEmail:l=void 0}){try{const v=Pe(le,"userPreferences",n),I=await jt(v);if(I.exists()){const T=I.data();if((T==null?void 0:T.notifyAvailability)===!1)return{success:!0,skipped:!0}}}catch{}const c=KT({playerName:e,eventTitle:t,eventDate:r,eventUrl:o,yesUrl:s,noUrl:i}),h=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,f={to:n,message:{subject:h,html:c},createdAt:Ws(),meta:{reason:a,eventTitle:t,eventDate:r,playerName:e}},g=Tf(l);f.from=g.from,f.replyTo=g.replyTo,await Ml(tt(le,"mail"),f);try{const v=Pe(le,"userPreferences",n),I=await jt(v),T=I.exists()?I.data():{};if((T==null?void 0:T.notifyAvailabilityPush)!==!1){const A=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,F=`${e}, t'es dispo ?`;await qc({toEmail:n,title:A,body:F,data:{url:o||window.location.origin,yesUrl:s,noUrl:i,reason:a},reason:a==="reminder"?"availability_reminder":"availability_request"})}}catch{}return{success:!0}}async function GT({toEmail:n,verifyUrl:e,purpose:t="player_protection",displayName:r="utilisateur",fromEmail:s=void 0}){const i=t==="account_email_update",o=i?"Vrification de votre nouvelle adresse email":"Vrification de votre email",a=`Bonjour ${r},`,l=i?"Pour scuriser votre compte, merci de confirmer que vous avez accs  cette nouvelle adresse email.":"Pour scuriser votre joueur, merci de confirmer que vous avez accs  cette adresse email.",c=i?"Confirmer mon adresse email":"Vrifier mon email",h=i?"Confirmez votre nouvelle adresse email":"Confirmez votre email pour activer la protection",f=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>${o}</h2>
      <p>${a}</p>
      <p>${l}</p>
      <p>
        <a href="${e}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">${c}</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,g={to:n,message:{subject:h,html:f},createdAt:Ws(),meta:{reason:t,displayName:r}},v=Tf(s);g.from=v.from,g.replyTo=v.replyTo,await Ml(tt(le,"mail"),g)}async function t3({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){return GT({toEmail:n,verifyUrl:t,purpose:"player_protection",displayName:e,fromEmail:r})}async function n3({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0,noUrl:l=void 0}){try{const v=Pe(le,"userPreferences",n),I=await jt(v);if(I.exists()){const T=I.data();if((T==null?void 0:T.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}H.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const c=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>Bonjour ${e},</p>
      <p>Flicitations ! Tu as t slectionn(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Dtails</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientt plus d'informations sur l'organisation.</p>
    </div>
  `,h=o||` Slection confirme  ${t}`;H.debug("queueSelectionEmail html/subject ready");const f={to:n,message:{subject:h,html:c},createdAt:Ws(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}},g=Tf(a);f.from=g.from,f.replyTo=g.replyTo,H.debug("queueSelectionEmail firestore payload ready");try{await Ml(tt(le,"mail"),f);try{const v=Pe(le,"userPreferences",n),I=await jt(v),T=I.exists()?I.data():{};console.log("Prfrences utilisateur pour notifications push",{toEmail:n,prefs:T,notifySelectionPush:T==null?void 0:T.notifySelectionPush,shouldSendPush:(T==null?void 0:T.notifySelectionPush)!==!1}),(T==null?void 0:T.notifySelectionPush)!==!1?(console.log("Envoi notification push de slection",{toEmail:n,playerName:e,eventTitle:t}),await qc({toEmail:n,title:" Slection confirme",body:`${e}, tu as t slectionn(e) pour ${t} (${r}) `,data:{url:s||window.location.origin,noUrl:l},reason:"selection"}),console.log("Notification push de slection envoye avec succs")):console.log("Notification push de slection dsactive par prfrences utilisateur")}catch(v){console.error("Erreur lors de l'envoi de la notification push de slection",v)}return H.info("Email ajout  la queue Firestore",{playerName:e}),{success:!0}}catch(v){throw H.error("Erreur lors de l'ajout  Firestore",{playerName:e,error:v}),v}}async function r3({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,newSelectedPlayers:i=[],html:o=void 0,subject:a=void 0,fromEmail:l=void 0}){try{const I=Pe(le,"userPreferences",n),T=await jt(I);if(T.exists()){const A=T.data();if((A==null?void 0:A.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}const c=Array.isArray(i)?i.join(", "):"",h=o||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2> Slection mise  jour</h2>
      <p>Bonjour ${e},</p>
      <p>La slection pour <strong>${t}</strong> (${r}) a t mise  jour et tu n'en fais plus partie .</p>
      ${c?`<p>Nouvelle slection: <strong>${c}</strong>.</p>`:""}
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#6b7280;color:#fff;border-radius:8px;text-decoration:none;">Voir les dtails de l'vnement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: mise  jour de slection (relance auto ou ajustement manuel).</p>
    </div>
  `,f=a||` Tu n'es plus dans la slection  ${t}`,g={to:n,message:{subject:f,html:h},createdAt:Ws(),meta:{reason:"deselection",eventTitle:t,eventDate:r,playerName:e,newSelectedPlayers:i}},v=Tf(l);g.from=v.from,g.replyTo=v.replyTo,await Ml(tt(le,"mail"),g);try{const I=Pe(le,"userPreferences",n),T=await jt(I),A=T.exists()?T.data():{};(A==null?void 0:A.notifySelectionPush)!==!1&&await qc({toEmail:n,title:" Slection mise  jour",body:`${e}, tu n'es plus slectionn(e) pour ${t} (${r}) `,data:{url:s||window.location.origin,noUrl:s&&s.includes("/event/")?s.replace("/event/","/magic?auto=no&event="):void 0},reason:"deselection"})}catch{}return{success:!0}}async function s3({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(H.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Donnes manquantes pour l'envoi des emails de slection");const{getPlayerEmail:o}=await en(()=>Promise.resolve().then(()=>zc),void 0),{createMagicLink:a}=await en(()=>Promise.resolve().then(()=>G4),void 0),l=`${window.location.origin}/season/${s}/event/${n}`;t.join(", ");const c=` Slection confirme  ${e.title}`,h=[];for(const f of t){H.debug("Traitement du joueur",{playerName:f});try{const g=i==null?void 0:i.find(U=>U.name===f);if(!g){H.warn("Joueur non trouv",{playerName:f});continue}H.debug("Joueur trouv");const v=await o(g.id,r);if(!v){H.warn("Pas d'email pour le joueur",{playerName:f});continue}H.debug("Email trouv pour joueur");const T=`${(await a({seasonId:r,playerId:g.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,A=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu as t slectionn(e) pour <strong>${e.title}</strong> (${Ih(e.date)}).</p>
          <p>Un imprvu ?</p>
          <p>
            <a href="${T}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;margin-right:8px;"> Plus dispo</a>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Dtails</a>
          </p>
        </div>
      `;H.debug("HTML gnr pour joueur");const F=n3({toEmail:v,playerName:f,eventTitle:e.title,eventDate:Ih(e.date),eventUrl:l,html:A,subject:c,noUrl:T});h.push(F),H.info("Email ajout  la queue",{playerName:f})}catch(g){H.error("Erreur lors de l'envoi de l'email de slection",{playerName:f,error:g})}}return H.info("Nombre total d'emails  envoyer",{count:h.length}),await Promise.all(h),H.info("Tous les emails ont t envoys avec succs"),{success:!0,count:h.length}}async function i3({eventId:n,eventData:e,removedPlayers:t,newSelectedPlayers:r,seasonId:s,seasonSlug:i,players:o}){if(H.info("sendDeselectionEmailsForEvent",{eventId:n,seasonId:s,removedCount:t==null?void 0:t.length}),!e||!t||t.length===0)return{success:!0,count:0};const{getPlayerEmail:a}=await en(()=>Promise.resolve().then(()=>zc),void 0),l=`${window.location.origin}/season/${i}/event/${n}`,c=[],h=Array.isArray(r)?r.join(", "):"";for(const f of t)try{const g=o==null?void 0:o.find(T=>T.name===f);if(!g){H.warn("Joueur retir non trouv",{playerName:f});continue}const v=await a(g.id,s);if(!v){H.warn("Pas d'email pour le joueur retir",{playerName:f});continue}const I=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2> Slection mise  jour</h2>
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu n'es plus slectionn(e) pour <strong>${e.title}</strong> (${Ih(e.date)}) .</p>
          ${h?`<p>Nouvelle slection: <strong>${h}</strong>.</p>`:""}
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #6b7280;color:#6b7280;border-radius:8px;text-decoration:none;">Voir les dtails de l'vnement</a>
          </p>
        </div>
      `;c.push(r3({toEmail:v,playerName:f,eventTitle:e.title,eventDate:Ih(e.date),eventUrl:l,newSelectedPlayers:r,html:I}))}catch(g){H.error("Erreur lors de l'envoi de l'email de dslection",{playerName:f,error:g})}return await Promise.all(c),H.info("Emails de dslection envoys",{count:c.length}),{success:!0,count:c.length}}function Ih(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Tv(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function WT(n){return`seasonPreferredPlayer:${n||"global"}`}function ym(n,e){try{const t=WT(n),r=localStorage.getItem(t);if(!r){localStorage.setItem(t,JSON.stringify([e]));return}if(r.startsWith("[")){const s=JSON.parse(r);s.includes(e)||(s.push(e),localStorage.setItem(t,JSON.stringify(s)))}else r!==e&&localStorage.setItem(t,JSON.stringify([r,e]))}catch{}}function o3(n,e){try{const t=WT(n),r=localStorage.getItem(t);if(!r)return;if(r.startsWith("[")){const s=JSON.parse(r).filter(i=>i!==e);s.length===0?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(s))}else r===e&&localStorage.removeItem(t)}catch{}}async function QT(n,e,t,r=null){try{H.info("Dbut protectPlayer",{playerId:n,seasonId:r});const s=await jl(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est dj protg");const{collection:i,query:o,where:a,getDocs:l}=await en(()=>import("./index.esm-5f613cf2.js"),[]),{db:c}=await en(()=>Promise.resolve().then(()=>ji),void 0),h=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(h,a("email","==",e)),g=await l(f);if(!g.empty&&g.docs.find(L=>L.id!==n))throw new Error("Cette adresse email est dj utilise par un autre joueur");H.debug("Cration du compte Firebase Auth...");const{createUserWithEmailAndPassword:v}=await en(()=>import("./index.esm-10520933.js"),[]),{auth:I}=await en(()=>Promise.resolve().then(()=>ji),void 0),T=await v(I,e,t);H.info("Compte Firebase Auth cr",{uid:T.user.uid});const A=Tv(t),F=r?Pe(c,"seasons",r,"playerProtection",n):Pe(c,"playerProtection",n);return await sn(F,{playerId:n,email:e,passwordHash:A,firebaseUid:T.user.uid,isProtected:!0,createdAt:new Date}),H.info("Protection sauvegarde dans Firestore"),r&&ym(r,n),{success:!0}}catch(s){throw H.error("Erreur lors de la protection du joueur",s),s}}async function JT({playerId:n,email:e,seasonId:t=null}){const r=t?Pe(le,"seasons",t,"playerProtection",n):Pe(le,"playerProtection",n);(await jt(r)).exists()?await Ol(r,{email:e,updatedAt:new Date}):await sn(r,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:i}=await jT({seasonId:t,playerId:n,email:e});return{success:!0,url:i}}async function YT({playerId:n,seasonId:e=null}){const t=e?Pe(le,"seasons",e,"playerProtection",n):Pe(le,"playerProtection",n);if(!(await jt(t)).exists())throw new Error("Protection introuvable");return await Ol(t,{emailVerifiedAt:new Date}),{success:!0}}async function XT({playerId:n,seasonId:e=null}){const t=e?Pe(le,"seasons",e,"playerProtection",n):Pe(le,"playerProtection",n);return await Ol(t,{emailVerifiedAt:null}),{success:!0}}async function ZT(n,e=null){try{const t=e?Pe(le,"seasons",e,"playerProtection",n):Pe(le,"playerProtection",n);return await sn(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date}),e&&o3(e,n),{success:!0,email:""}}catch(t){throw H.error("Erreur lors de la suppression de la protection",t),t}}async function Bi(n,e=null){try{const t=e?Pe(le,"seasons",e,"playerProtection",n):Pe(le,"playerProtection",n),r=await jt(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return H.error("Erreur lors de la vrification de protection",t),!1}}async function jl(n,e=null){try{const t=e?Pe(le,"seasons",e,"playerProtection",n):Pe(le,"playerProtection",n),r=await jt(t);return r.exists()?r.data():null}catch(t){return H.error("Erreur lors de la rcupration des donnes de protection",t),null}}async function eA(n,e=null){try{const t=await jl(n,e);return(t==null?void 0:t.email)||""}catch(t){return H.error("Erreur lors de la rcupration de l'email",t),""}}async function _m(n=null){try{const e=n?tt(le,"seasons",n,"playerProtection"):tt(le,"playerProtection");return(await Pt(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return H.error("Erreur lors du chargement des protections",e),[]}}async function Af(n){try{const e=[],t=uc(tt(le,"playerProtection"),gh("email","==",n));(await Pt(t)).forEach(i=>{const o=i.data();o!=null&&o.isProtected&&e.push({seasonId:null,playerId:i.id,...o})});const s=await Pt(tt(le,"seasons"));for(const i of s.docs){const o=i.id,a=uc(tt(le,"seasons",o,"playerProtection"),gh("email","==",n));(await Pt(a)).forEach(c=>{var f;const h=c.data();h!=null&&h.isProtected&&e.push({seasonId:o,seasonName:(f=i.data())==null?void 0:f.name,playerId:c.id,...h})})}return e}catch(e){return H.error("Erreur listAssociationsForEmail",e),[]}}async function tA(n,e,t=null){try{const r=await jl(n,t);if(!r||!r.isProtected)return!1;if(r.email){H.debug("Vrification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await en(()=>import("./index.esm-10520933.js"),[]),{auth:i}=await en(()=>Promise.resolve().then(()=>ji),void 0);return await s(i,r.email,e),H.debug("Mot de passe Firebase Auth valide"),eo.saveSession(n),t&&ym(t,n),!0}catch(s){return H.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{H.debug("Vrification avec hash local");const s=Tv(e),i=r.passwordHash===s;return i&&(eo.saveSession(n),t&&ym(t,n)),i}}catch(r){return H.error("Erreur lors de la vrification du mot de passe",r),!1}}async function nA({playerId:n,seasonId:e=null}){const t=e?Pe(le,"seasons",e,"playerProtection",n):Pe(le,"playerProtection",n),r=await jt(t);if(!r.exists())throw new Error("Protection introuvable");const s=r.data();if(s!=null&&s.email)return await Ol(t,{isProtected:!0,updatedAt:new Date}),{success:!0};throw new Error("Email non dfini pour cette protection")}function Go(n){return eo.isPasswordCached(n)}function a3(n){return null}async function rA(n,e=null){try{H.info("Dbut sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await jl(n,e);if(H.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protg");if(H.debug("Email  utiliser (masqu)"),t.firebaseUid){H.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await en(()=>import("./index.esm-10520933.js"),[]),{auth:s}=await en(()=>Promise.resolve().then(()=>ji),void 0);H.debug("Tentative d'envoi d'email"),await r(s,t.email),H.info("Email envoy avec succs via Firebase Auth")}else{H.debug("Pas de compte Firebase Auth, cration temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await en(()=>import("./index.esm-10520933.js"),[]),{auth:i}=await en(()=>Promise.resolve().then(()=>ji),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);H.info("Compte temporaire cr",{uid:a.user.uid}),await s(i,t.email),H.info("Email envoy avec succs");const{updateDoc:l}=await en(()=>import("./index.esm-5f613cf2.js"),[]),{db:c}=await en(()=>Promise.resolve().then(()=>ji),void 0),h=e?Pe(c,"seasons",e,"playerProtection",n):Pe(c,"playerProtection",n);await l(h,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")H.debug("Email dj utilis, tentative d'envoi direct..."),await s(i,t.email),H.info("Email envoy avec succs");else throw a}}return{success:!0,message:"Email de rinitialisation envoy ! Vrifiez votre bote de rception."}}catch(t){throw H.error("Erreur lors de l'envoi de l'email de rinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouv avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez ressayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function l3(n,e,t=null){try{const r=Tv(e),s=t?Pe(le,"seasons",t,"playerProtection",n):Pe(le,"playerProtection",n);return await Ol(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw H.error("Erreur lors de la mise  jour du mot de passe",r),r}}async function u3(n){return new Promise((e,t)=>{H.debug("Demande de mot de passe pour disponibilit"),t(new Error("Gestion de mot de passe  implmenter ct composant"))})}const zc=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:XT,finalizeProtectionAfterVerification:nA,getCachedPlayerPassword:a3,getPlayerEmail:eA,getPlayerProtectionData:jl,isPlayerPasswordCached:Go,isPlayerProtected:Bi,listAssociationsForEmail:Af,listProtectedPlayers:_m,markEmailVerifiedForProtection:YT,protectPlayer:QT,requirePlayerPasswordForAvailability:u3,sendPasswordResetEmail:rA,startEmailVerificationForProtection:JT,unprotectPlayer:ZT,updatePlayerPasswordInFirestore:l3,verifyPlayerPassword:tA},Symbol.toStringTag,{value:"Module"})),c3={class:"mb-4 md:mb-6"},d3={class:"flex items-start gap-4"},h3={class:"flex items-center gap-3"},f3={class:"space-y-2"},p3={class:"flex items-center gap-2"},m3={class:"text-gray-400 text-xs md:text-sm"},g3={key:0,class:"flex items-center gap-2"},v3=["title"],y3={class:"text-blue-200"},_3={class:"space-y-4 md:space-y-6"},b3={class:"space-y-2 md:space-y-3"},w3={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},x3=["disabled"],I3={key:0,class:"mt-2 text-xs text-red-300"},E3={key:1,class:"mt-2 text-xs text-green-300"},T3={class:"space-y-2 md:space-y-3"},A3={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},S3={class:"flex items-center justify-between mb-4"},P3={class:"space-y-4"},C3=["disabled"],R3={key:0,class:"text-xs text-red-300 text-center"},k3={key:1,class:"text-xs text-green-300 text-center"},D3={class:"flex items-center justify-between mb-4"},N3={class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},V3={class:"space-y-3"},O3={key:0,class:"text-sm text-gray-400 text-center py-4"},M3={key:1,class:"space-y-2"},L3={class:"flex items-center gap-2 min-w-0 flex-1"},$3={class:"truncate"},F3={class:"text-white font-medium text-sm"},U3={class:"text-gray-400 text-xs"},j3=["onClick"],sA={__name:"AccountMenu",props:{show:{type:Boolean,default:!1},seasonId:{type:String,default:null}},emits:["close","delete-account","open-player"],setup(n,{emit:e}){const t=n,r=e,s=C(""),i=C(""),o=C(!1),a=C(""),l=C(""),c=C(!1),h=C(!1),f=C(""),g=C(""),v=C([]),I=C(!1),T=C(!1);bt(s,E=>{i.value=E||""}),bt(i,E=>{c.value=!!E&&E.includes("@")&&E!==s.value});async function A(){if(c.value){o.value=!0,a.value="",l.value="";try{const E=await qT({currentEmail:s.value,newEmail:i.value.trim()});await GT({toEmail:i.value.trim(),verifyUrl:E.url,purpose:"account_email_update",displayName:"utilisateur"}),l.value=`Un email de vrification a t envoy  ${i.value.trim()}. Cliquez sur le lien pour confirmer le changement.`}catch(E){a.value=(E==null?void 0:E.code)==="auth/requires-recent-login"?"Veuillez vous reconnecter pour modifier votre email":"Impossible de mettre  jour l'email"}finally{o.value=!1}}}async function F(){if(s.value){h.value=!0,f.value="",g.value="";try{await _v(s.value),g.value="Email de rinitialisation envoy. Vrifiez votre bote de rception."}catch{f.value="Impossible d'envoyer l'email de rinitialisation. Veuillez ressayer."}finally{h.value=!1}}}function U(E){return`${E.seasonId||"global"}__${E.playerId}`}async function L(){try{const E=s.value?await Af(s.value):[],_=[];for(const x of E){let R=x.playerId,M=x.seasonId||"";try{if(x.seasonId){const k=Pe(le,"seasons",x.seasonId,"players",x.playerId),P=await jt(k);P.exists()&&(R=P.data().name||R);const Qe=Pe(le,"seasons",x.seasonId),nt=await jt(Qe);nt.exists()&&(M=nt.data().name||M)}}catch{}_.push({...x,playerName:R,seasonName:M})}v.value=_}catch{v.value=[]}}async function $(E){if(confirm(`tes-vous sr de vouloir dissocier le joueur "${E.playerName}" de votre compte ?`))try{const{deleteDoc:_}=await en(()=>import("./index.esm-5f613cf2.js"),[]);if(E.seasonId){const R=Pe(le,"seasons",E.seasonId,"playerProtection",E.playerId);await _(R)}else{const R=Pe(le,"playerProtection",E.playerId);await _(R)}try{if(E.seasonId){const R=`seasonPreferredPlayer:${E.seasonId}`,M=localStorage.getItem(R);if(M)if(M.startsWith("[")){const P=(JSON.parse(M)||[]).filter(Qe=>Qe!==E.playerId);localStorage.setItem(R,JSON.stringify(P))}else M===E.playerId&&localStorage.removeItem(R)}}catch{}await L();const x=`Joueur "${E.playerName}" dissoci avec succs`}catch(_){console.error("Erreur lors de la dissociation:",_),alert(`Erreur lors de la dissociation: ${_.message||"Veuillez ressayer"}`)}}function ue(E){r("open-player",E),se()}function se(){r("close")}return bt(()=>t.show,E=>{var _;if(E)try{s.value=((_=Ge==null?void 0:Ge.currentUser)==null?void 0:_.email)||"",L()}catch{}}),pn(()=>{var E;if(t.show)try{s.value=((E=Ge==null?void 0:Ge.currentUser)==null?void 0:E.email)||"",L()}catch{}}),(E,_)=>n.show?(D(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-2 md:p-4",onClick:se},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg md:max-w-xl max-h-[90vh] overflow-y-auto",onClick:_[3]||(_[3]=lt(()=>{},["stop"]))},[d("button",{onClick:se,class:"absolute right-2 md:right-3 top-2 md:top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},""),d("div",c3,[d("div",d3,[d("div",h3,[_[13]||(_[13]=d("div",{class:"w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0"},[d("span",{class:"text-lg md:text-xl"},"")],-1)),d("div",f3,[_[12]||(_[12]=d("h3",{class:"text-white font-semibold text-base md:text-lg"},"Mon compte",-1)),d("div",p3,[d("span",m3,re(s.value||"Non dfini"),1),d("button",{onClick:_[0]||(_[0]=x=>I.value=!0),class:"text-indigo-400 hover:text-indigo-300 transition-colors p-1 hover:bg-indigo-400/10 rounded flex-shrink-0",title:"Modifier l'email","aria-label":"Modifier l'email"},"  ")]),v.value.length>0?(D(),O("div",g3,[d("button",{onClick:_[1]||(_[1]=x=>v.value.length===1?ue(v.value[0]):T.value=!0),class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-xs md:text-sm hover:bg-blue-500/30 transition-colors cursor-pointer",title:v.value.length===1?`Voir ${v.value[0].playerName}`:"Grer mes joueurs"},[_[11]||(_[11]=d("span",{class:"text-blue-300"},"",-1)),d("span",y3,re(v.value.length===1?v.value[0].playerName:`${v.value.length} joueurs`),1)],8,v3)])):ce("",!0)])])])]),_[18]||(_[18]=d("div",{class:"border-t border-white/10 mb-4 md:mb-6"},null,-1)),d("div",_3,[d("div",b3,[_[15]||(_[15]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-green-400"},""),St(" Mot de passe ")],-1)),d("div",w3,[_[14]||(_[14]=d("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Vous pouvez changer votre mot de passe pour scuriser vos oprations sensibles.",-1)),d("button",{onClick:F,disabled:h.value,class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},re(h.value?"":"Changer de mot de passe"),9,x3),f.value?(D(),O("div",I3,re(f.value),1)):ce("",!0),g.value?(D(),O("div",E3,re(g.value),1)):ce("",!0)])]),d("div",T3,[_[17]||(_[17]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-red-400"},""),St(" Suppression de compte ")],-1)),d("div",A3,[_[16]||(_[16]=d("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Cette action est irrversible et supprimera dfinitivement votre compte.",-1)),d("button",{onClick:_[2]||(_[2]=x=>E.$emit("delete-account")),class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-red-600 text-white hover:bg-red-500 text-sm"},"Supprimer mon compte")])])]),d("div",{class:"mt-4 md:mt-6 text-center"},[d("button",{onClick:se,class:"px-4 md:px-6 py-2 md:py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 text-sm"},"Fermer")])]),I.value?(D(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:_[7]||(_[7]=x=>I.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-md",onClick:_[6]||(_[6]=lt(()=>{},["stop"]))},[d("div",S3,[_[19]||(_[19]=d("h3",{class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},[d("span",{class:"text-blue-400"},""),St(" Modifier l'email ")],-1)),d("button",{onClick:_[4]||(_[4]=x=>I.value=!1),class:"text-white/80 hover:text-white"},"")]),d("div",P3,[d("div",null,[_[20]||(_[20]=d("label",{class:"block text-xs text-gray-400 mb-2"},"Nouvelle adresse email",-1)),ut(d("input",{"onUpdate:modelValue":_[5]||(_[5]=x=>i.value=x),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400 text-sm",placeholder:"nouvel@email.com"},null,512),[[Ft,i.value]])]),d("button",{onClick:A,disabled:!c.value||o.value,class:"w-full px-4 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},re(o.value?"":"Mettre  jour"),9,C3),a.value?(D(),O("div",R3,re(a.value),1)):ce("",!0),l.value?(D(),O("div",k3,re(l.value),1)):ce("",!0)])])])):ce("",!0),T.value?(D(),O("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:_[10]||(_[10]=x=>T.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg",onClick:_[9]||(_[9]=lt(()=>{},["stop"]))},[d("div",D3,[d("h3",N3,[_[21]||(_[21]=d("span",{class:"text-yellow-400"},"",-1)),St(" "+re(v.value.length<=1?"Mon joueur":"Mes joueurs"),1)]),d("button",{onClick:_[8]||(_[8]=x=>T.value=!1),class:"text-white/80 hover:text-white"},"")]),d("div",V3,[v.value.length===0?(D(),O("div",O3," Aucun joueur associ pour le moment. ")):(D(),O("div",M3,[(D(!0),O(it,null,wr(v.value,x=>(D(),O("div",{key:U(x),class:"flex items-center justify-between p-3 bg-gray-800/30 rounded-lg"},[d("div",L3,[_[22]||(_[22]=d("span",{class:"text-yellow-400 text-sm"},"",-1)),d("div",$3,[d("div",F3,re(x.playerName||""),1),d("div",U3,re(x.seasonName||x.seasonId||""),1)])]),d("button",{onClick:R=>$(x),class:"p-1.5 rounded bg-red-600/20 text-red-400 hover:bg-red-600/30 hover:text-red-300 transition-colors duration-200 flex-shrink-0",title:"Dissocier ce joueur","aria-label":"Dissocier ce joueur"},"  ",8,j3)]))),128))]))])])])):ce("",!0)])):ce("",!0)}},B3="/logos/hatcast-logo-desktop.png",q3={key:0,class:"w-10 h-10 bg-gray-600 animate-pulse rounded-full"},z3=["aria-expanded"],bm={__name:"AccountDropdown",props:{isConnected:{type:Boolean,default:!1},buttonClass:{type:String,default:"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700"}},emits:["open-account-menu","open-help","open-notifications","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=C(!1),i=C(!0),o=C(null),a=C({});bt(()=>t.isConnected,A=>{i.value=!1},{immediate:!0}),pn(()=>{i.value=!1});function l(){r("open-login")}function c(){s.value=!s.value,s.value&&Gt(()=>h())}function h(){if(o.value){const A=o.value.getBoundingClientRect();a.value={top:`${A.bottom+8}px`,right:`${window.innerWidth-A.right}px`}}}function f(){s.value=!1,r("open-account-menu")}function g(){s.value=!1,r("open-help")}function v(){s.value=!1,r("open-notifications")}async function I(){s.value=!1;try{await Ge.signOut(),r("logout")}catch(A){console.error("Erreur lors de la dconnexion:",A)}}function T(){s.value=!1}return pn(()=>{document.addEventListener("click",T),window.addEventListener("resize",h),window.addEventListener("scroll",h,{passive:!0})}),Ls(()=>{document.removeEventListener("click",T),window.removeEventListener("resize",h),window.removeEventListener("scroll",h)}),(A,F)=>(D(),O("div",{class:"relative",onClick:F[0]||(F[0]=lt(()=>{},["stop"]))},[i.value?(D(),O("div",q3)):n.isConnected?(D(),O("button",{key:2,onClick:c,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte","aria-expanded":s.value,"aria-haspopup":"true",ref_key:"dropdownButton",ref:o},F[1]||(F[1]=[d("span",{class:"text-2xl"},"",-1)]),8,z3)):(D(),O("button",{key:1,onClick:l,class:Qt(["px-4 py-2 rounded-lg transition-all duration-300 border transition-colors",n.buttonClass])}," Connexion ",2)),(D(),$s(Bu,{to:"body"},[s.value&&n.isConnected?(D(),O("div",{key:0,class:"fixed w-auto min-w-[180px] max-w-[200px] md:min-w-[200px] md:max-w-[240px] bg-gray-900 border border-white/20 rounded-lg shadow-xl py-1 z-[9999]",style:br(a.value),role:"menu"},[d("button",{onClick:f,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},F[2]||(F[2]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"",-1),d("span",{class:"truncate"},"Mon compte",-1)])),d("button",{onClick:v,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},F[3]||(F[3]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"",-1),d("span",{class:"truncate"},"Notifications",-1)])),d("button",{onClick:g,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},F[4]||(F[4]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"",-1),d("span",{class:"truncate"},"Aide",-1)])),F[6]||(F[6]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:I,class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},F[5]||(F[5]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"",-1),d("span",{class:"truncate"},"Se dconnecter",-1)]))],4)):ce("",!0)]))]))}},H3={class:"container mx-auto px-4 py-4"},K3={class:"flex items-center justify-between"},G3={class:"flex items-center gap-2"},W3={__name:"AppHeader",props:{isScrolled:{type:Boolean,default:!1}},emits:["open-account-menu","open-help","open-notifications","open-players","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=fa(),i=Fe(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");bt(()=>s.path,()=>{tl(),setTimeout(()=>{tl()},100)},{immediate:!0}),Ls(()=>{window._appHeaderUnsubscribe&&(window._appHeaderUnsubscribe(),delete window._appHeaderUnsubscribe)});function o(){r("open-account-menu")}function a(){r("open-help")}function l(){r("open-notifications")}function c(){r("open-players")}function h(){r("logout")}function f(){r("open-login")}return(g,v)=>(D(),O("header",{class:Qt(["fixed top-0 left-0 right-0 z-50 transition-all duration-300",n.isScrolled?"bg-white/95 backdrop-blur-md border-b border-gray-200/50 shadow-lg":"bg-gray-900/20 backdrop-blur-sm"])},[d("nav",H3,[d("div",K3,[v[0]||(v[0]=Cn('<div class="flex items-center"><a href="/" class="flex items-center"><div class="relative w-48 h-12 md:w-56 md:h-14"><img src="'+LT+'" alt="Logo HatCast - Retour  l&#39;accueil" class="w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 md:hidden"><img src="'+B3+'" alt="Logo HatCast - Retour  l&#39;accueil" class="w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 hidden md:block"></div></a></div>',1)),d("div",G3,[Ke(bm,{"is-connected":Br(m4),"button-class":i.value,onOpenAccountMenu:o,onOpenHelp:a,onOpenNotifications:l,onOpenPlayers:c,onLogout:h,onOpenLogin:f},null,8,["is-connected","button-class"]),k1(g.$slots,"actions")])])])],2))}},Q3={class:"space-y-4 md:space-y-6"},J3={class:"space-y-2 md:space-y-3"},Y3={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},X3={class:"flex items-center justify-between"},Z3={class:"flex items-center gap-2"},e$={class:"flex items-center justify-between"},t$={class:"flex items-center gap-2"},n$={class:"space-y-2 md:space-y-3"},r$={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},s$={class:"flex items-center justify-between"},i$={class:"flex items-center gap-2"},o$={class:"flex items-center justify-between"},a$={class:"flex items-center gap-2"},l$={class:"flex items-center justify-between pt-2 border-t border-white/10"},u$=["disabled"],c$={key:1,class:"inline-flex items-center text-xs text-gray-300"},d$={class:"flex items-center justify-between pt-2"},h$=["disabled"],f$={key:0,class:"text-xs text-green-300"},p$={key:1,class:"text-xs text-red-300"},m$={key:2,class:"text-[10px] text-gray-400 break-all"},g$={class:"text-[10px] text-gray-500"},v$={key:0,class:"text-xs text-red-300"},y$={key:1,class:"text-xs text-green-300"},_$={class:"mt-6 flex justify-between items-center"},b$=["disabled"],iA={__name:"NotificationsModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=n,r=e,s=C(""),i=C({notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),o=C(!1),a=C(""),l=C(""),c=C(!1),h=C(""),f=C(""),g=C(!1),v=C(localStorage.getItem("fcmToken")||""),I=C(!1),T=function(_){try{return _?_.length>20?_.slice(0,8)+""+_.slice(-6):_:""}catch{return""}}("BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8");function A(E){const{active:_,token:x}=E.detail;_&&x?(v.value=x,I.value=!0,localStorage.setItem("fcmToken",x),console.log("Notifications push ractives automatiquement")):(I.value=!1,v.value="",localStorage.removeItem("fcmToken"),console.log("Notifications push dsactives"))}async function F(){try{if(!s.value)return;const E=Pe(le,"userPreferences",s.value),_=await jt(E);if(_.exists()){const x=_.data()||{};i.value.notifyAvailability=x.notifyAvailability!==!1,i.value.notifySelection=x.notifySelection!==!1,i.value.notifySelectionPush=x.notifySelectionPush!==!1,i.value.notifyAvailabilityPush=x.notifyAvailabilityPush!==!1}else i.value={notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}}catch{}}async function U(){if(s.value){c.value=!0,f.value="",h.value="";try{if(!(await Ou()).active){f.value="Notifications push non actives sur cet appareil";return}await qc({toEmail:s.value,title:"Test HatCast",body:"Ceci est un test de notification",data:{url:"/"},reason:"manual_test"}),h.value="OK"}catch{f.value="chec de l'envoi du test"}finally{c.value=!1}}}function L(){const E=new CustomEvent("pwa-update-test",{detail:{type:"test-update",timestamp:Date.now()}});window.dispatchEvent(E),alert(` Test de mise  jour PWA dclench !

Vrifiez que la modal de mise  jour apparat dans l'interface principale.`)}async function $(){try{if(g.value=!0,!await yT()){f.value="Push non support sur cet appareil";return}const _=await Ou();_.active?(v.value=_.token,I.value=!0,localStorage.setItem("fcmToken",_.token),console.log("Notifications push actives avec succs")):f.value=`Activation impossible: ${_.error}`}catch(E){const _=typeof Notification<"u"?Notification.permission:"unknown",x=E&&(E.message||E.code)?` (${E.message||E.code})`:"";f.value=`Activation impossible  permission: ${_}${x}`}finally{g.value=!1}}async function ue(){if(s.value){o.value=!0,a.value="",l.value="";try{const E=Pe(le,"userPreferences",s.value);await sn(E,{...i.value},{merge:!0}),l.value="Prfrences sauvegardes"}catch{a.value="Impossible de sauvegarder vos prfrences"}finally{o.value=!1}}}function se(){r("close")}return bt(()=>t.show,E=>{E&&F()}),pn(()=>{var E;try{s.value=((E=Ge==null?void 0:Ge.currentUser)==null?void 0:E.email)||"",I.value=typeof Notification<"u"&&Notification.permission==="granted"&&!!localStorage.getItem("fcmToken"),KM(),window.addEventListener("push-status-changed",A),Ou().then(_=>{_.active&&(v.value=_.token,I.value=!0,localStorage.setItem("fcmToken",_.token))})}catch{}t.show&&F()}),Ls(()=>{window.removeEventListener("push-status-changed",A)}),(E,_)=>n.show?(D(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:se},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:_[4]||(_[4]=lt(()=>{},["stop"]))},[d("button",{onClick:se,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},""),_[16]||(_[16]=Cn('<div class="mb-4 md:mb-6"><div class="flex items-start gap-4"><div class="flex items-center gap-3"><div class="w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0"><span class="text-lg md:text-xl"></span></div><div class="space-y-2"><h3 class="text-white font-semibold text-base md:text-lg">Notifications</h3><p class="text-gray-400 text-xs md:text-sm">Ne ratez rien, soyez le premier prvenu !</p></div></div></div></div><div class="border-t border-white/10 mb-4 md:mb-6"></div>',2)),d("div",Q3,[d("div",J3,[_[7]||(_[7]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-blue-400"},""),St(" Emails ")],-1)),d("div",Y3,[d("div",X3,[d("label",Z3,[ut(d("input",{type:"checkbox","onUpdate:modelValue":_[0]||(_[0]=x=>i.value.notifyAvailability=x),class:"w-4 h-4"},null,512),[[Mi,i.value.notifyAvailability]]),_[5]||(_[5]=d("span",{class:"text-sm text-white"},"M'envoyer un email lorsqu'un vnement a besoin de joueurs",-1))])]),d("div",e$,[d("label",t$,[ut(d("input",{type:"checkbox","onUpdate:modelValue":_[1]||(_[1]=x=>i.value.notifySelection=x),class:"w-4 h-4"},null,512),[[Mi,i.value.notifySelection]]),_[6]||(_[6]=d("span",{class:"text-sm text-white"},"M'envoyer un email lorsque je suis concern par une slection",-1))])])])]),d("div",n$,[_[15]||(_[15]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-emerald-400"},""),St(" Mobile (exprimental) ")],-1)),d("div",r$,[_[14]||(_[14]=d("div",{class:"text-xs text-emerald-200 mb-1"},"Fonctionnalit en test: activable uniquement ici.",-1)),d("div",s$,[d("label",i$,[ut(d("input",{type:"checkbox","onUpdate:modelValue":_[2]||(_[2]=x=>i.value.notifySelectionPush=x),class:"w-4 h-4"},null,512),[[Mi,i.value.notifySelectionPush]]),_[8]||(_[8]=d("span",{class:"text-sm text-white"},"Me notifier lorsque je suis concern par une slection",-1))])]),d("div",o$,[d("label",a$,[ut(d("input",{type:"checkbox","onUpdate:modelValue":_[3]||(_[3]=x=>i.value.notifyAvailabilityPush=x),class:"w-4 h-4"},null,512),[[Mi,i.value.notifyAvailabilityPush]]),_[9]||(_[9]=d("span",{class:"text-sm text-white"},"Me notifier lorsqu'un vnement a besoin de joueurs",-1))])]),d("div",l$,[_[11]||(_[11]=d("div",{class:"text-xs text-gray-400"},"Notifications sur cet appareil",-1)),I.value?(D(),O("span",c$,_[10]||(_[10]=[d("span",{class:"mr-1 text-emerald-400"},"",-1),St(" Actif ")]))):(D(),O("button",{key:0,onClick:$,disabled:g.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},re(g.value?"...":"Activer"),9,u$))]),d("div",d$,[_[12]||(_[12]=d("div",{class:"text-xs text-gray-400"},"Test de notification push",-1)),d("button",{onClick:U,disabled:c.value||!s.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},re(c.value?"Envoi":"Envoyer un test"),9,h$)]),d("div",{class:"flex items-center justify-between pt-2"},[_[13]||(_[13]=d("div",{class:"text-xs text-gray-400"},"Test de mise  jour PWA",-1)),d("button",{onClick:L,class:"px-3 py-1 rounded bg-blue-600 text-white text-xs hover:bg-blue-500 transition-colors"},"  Simuler maj ")]),h.value?(D(),O("div",f$,"Notification test envoye (vrifiez votre appareil)")):ce("",!0),f.value?(D(),O("div",p$,re(f.value),1)):ce("",!0),v.value?(D(),O("div",m$,"FCM token: "+re(v.value),1)):ce("",!0),d("div",g$,"VAPID: "+re(Br(T)||"indisponible"),1)])]),a.value?(D(),O("div",v$,re(a.value),1)):ce("",!0),l.value?(D(),O("div",y$,re(l.value),1)):ce("",!0)]),d("div",_$,[d("button",{onClick:ue,disabled:o.value,class:"px-4 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-500 disabled:opacity-50"},re(o.value?"":"Sauvegarder"),9,b$),d("button",{onClick:se,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ce("",!0)}},w$={class:"space-y-3"},x$={key:0,class:"text-sm text-gray-400"},I$={key:1,class:"space-y-2"},E$={class:"flex items-center justify-between gap-3"},T$={class:"truncate"},A$={class:"text-white font-semibold"},S$={class:"text-gray-400 text-xs"},P$=["onClick"],oA={__name:"PlayersModal",props:{show:{type:Boolean,default:!1}},emits:["close","manage-player"],setup(n,{emit:e}){const t=n,r=e,s=C(""),i=C([]);function o(h){return`${h.seasonId||"global"}__${h.playerId}`}async function a(){var h;try{s.value=((h=Ge==null?void 0:Ge.currentUser)==null?void 0:h.email)||""}catch{}try{const f=s.value?await Af(s.value):[],g=[];for(const v of f){let I=v.playerId;try{if(v.seasonId){const T=Pe(le,"seasons",v.seasonId,"players",v.playerId),A=await jt(T);A.exists()&&(I=A.data().name||I)}}catch{}g.push({...v,playerName:I})}i.value=g}catch{i.value=[]}}function l(h){r("manage-player",h),c()}function c(){r("close")}return bt(()=>t.show,h=>{h&&a()}),pn(()=>{t.show&&a()}),(h,f)=>n.show?(D(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:c},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:f[0]||(f[0]=lt(()=>{},["stop"]))},[d("button",{onClick:c,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},""),f[2]||(f[2]=Cn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl"></span></div><h2 class="text-2xl font-bold text-white mb-1">Mes joueurs</h2><p class="text-sm text-gray-300">Grez vos associations de joueurs</p></div>',1)),d("div",w$,[f[1]||(f[1]=d("h3",{class:"text-white font-semibold mb-2"},"Mes joueurs associs",-1)),i.value.length===0?(D(),O("div",x$,"Aucun joueur associ pour le moment.")):(D(),O("ul",I$,[(D(!0),O(it,null,wr(i.value,g=>(D(),O("li",{key:o(g),class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},[d("div",E$,[d("div",T$,[d("div",A$,re(g.seasonName||g.seasonId||""),1),d("div",S$,"Joueur : "+re(g.playerName||""),1)]),d("button",{onClick:v=>l(g),class:"px-3 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-xs"},"Grer",8,P$)])]))),128))]))]),d("div",{class:"mt-6 text-center"},[d("button",{onClick:c,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ce("",!0)}};let Yn="mock",qi=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hlne"},{id:"p9",name:"Ismal"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"La"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],ia=[{id:"event1",title:"Aprock Septembre",date:"2025-09-08",description:"Soire apro-rock avec ambiance festive"},{id:"event2",title:"Match  Cambo",date:"2025-11-25",description:"Match d'improvisation comptitif  Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function Av(n){Yn=n}async function C$(){if(Yn!=="firebase"||!(await Pt(tt(le,"seasons"))).empty)return;const e=Pe(tt(le,"seasons"));await sn(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:Ws()});const t=await Pt(tt(le,"players"));for(const o of t.docs)await sn(Pe(e,"players",o.id),o.data());const r=await Pt(tt(le,"events"));for(const o of r.docs)await sn(Pe(e,"events",o.id),o.data());const s=await Pt(tt(le,"availability"));for(const o of s.docs)await sn(Pe(e,"availability",o.id),o.data());const i=await Pt(tt(le,"selections"));for(const o of i.docs)await sn(Pe(e,"selections",o.id),o.data())}async function aA(){Yn==="firebase"&&await C$()}async function Eh(n=null){let e;return Yn==="firebase"?n?e=(await Pt(tt(le,"seasons",n,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=(await Pt(tt(le,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=ia,e.sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const h=new Date(c);return isNaN(h.getTime())?null:h},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function $u(n=null){let e;return Yn==="firebase"?n?e=(await Pt(tt(le,"seasons",n,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=(await Pt(tt(le,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=qi,e.sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function lA(n,e=null){if(Yn==="firebase"){const t=Pe(e?tt(le,"seasons",e,"players"):tt(le,"players"));return await sn(t,{name:n}),t.id}else{const t=`p${qi.length+1}`;return qi.push({id:t,name:n}),t}}async function R$(n,e=null){if(Yn==="firebase"){const t=e?Pe(le,"seasons",e,"players",n):Pe(le,"players",n);await _l(t);const r=e?await Pt(tt(le,"seasons",e,"availability")):await Pt(tt(le,"availability")),s=Yg(le);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else qi=qi.filter(t=>t.id!==n)}async function k$(n,e,t=null){if(Yn==="firebase"){const r=t?Pe(le,"seasons",t,"players",n):Pe(le,"players",n),s=await jt(r),i=s.exists()&&s.data().name||null;if(await sn(r,{name:e},{merge:!0}),i&&i!==e){const o=Yg(le);try{const a=t?Pe(le,"seasons",t,"availability",i):Pe(le,"availability",i),l=await jt(a);if(l.exists()){const c=l.data()||{},h=t?Pe(le,"seasons",t,"availability",e):Pe(le,"availability",e);o.set(h,c,{merge:!0}),o.delete(a)}}catch{}try{const a=t?tt(le,"seasons",t,"selections"):tt(le,"selections");(await Pt(a)).forEach(c=>{var f;const h=Array.isArray((f=c.data())==null?void 0:f.players)?c.data().players:[];if(h.includes(i)){const g=h.map(v=>v===i?e:v);o.update(c.ref,{players:g})}})}catch{}await o.commit()}}else{const r=qi.findIndex(s=>s.id===n);r!==-1&&(qi[r]={...qi[r],name:e})}}async function No(n,e,t=null){if(Yn==="firebase"){const r=t?await Pt(tt(le,"seasons",t,"availability")):await Pt(tt(le,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function Vo(n=null){if(Yn==="firebase"){const e=n?await Pt(tt(le,"seasons",n,"selections")):await Pt(tt(le,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function Y_(n,e,t=null){if(Yn==="firebase"){const r=t?Pe(le,"seasons",t,"availability",n):Pe(le,"availability",n);await sn(r,e)}}async function D$({seasonId:n,playerName:e,eventId:t,value:r}){if(Yn!=="firebase")return;const s=n?Pe(le,"seasons",n,"availability",e):Pe(le,"availability",e),i=await jt(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await sn(s,a)}async function wm(n,e,t=null){if(Yn==="firebase"){const r=t?Pe(le,"seasons",t,"selections",n):Pe(le,"selections",n);await sn(r,{players:e})}}async function N$(n,e=null){if(H.info("Suppression de l'vnement",{eventId:n}),Yn==="firebase")try{H.debug("Suppression de l'vnement dans Firestore");const t=e?Pe(le,"seasons",e,"events",n):Pe(le,"events",n);await _l(t),H.debug("Suppression de la slection associe");const r=e?Pe(le,"seasons",e,"selections",n):Pe(le,"selections",n);await _l(r),H.debug("Suppression des disponibilits");const s=e?await Pt(tt(le,"seasons",e,"availability")):await Pt(tt(le,"availability")),i=Yg(le);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){H.debug("Mise  jour de la disponibilit pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),H.info("Oprations de suppression termines avec succs")}catch(t){throw H.error("Erreur lors de la suppression",t),t}else ia=ia.filter(t=>t.id!==n)}async function V$(n,e=null){if(Yn==="firebase"){const t=Pe(e?tt(le,"seasons",e,"events"):tt(le,"events"));return await sn(t,n),t.id}else{const t=`event${ia.length+1}`;return ia.push({id:t,...n}),t}}async function X_(n,e,t=null){if(Yn==="firebase"){const r=t?Pe(le,"seasons",t,"events",n):Pe(le,"events",n);await sn(r,e,{merge:!0})}else{const r=ia.findIndex(s=>s.id===n);r!==-1&&(ia[r]={id:n,...e})}}const O$={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},M$={class:"hero-section relative overflow-hidden pt-24"},L$={class:"hero-content py-16 md:py-24 px-4 relative z-10"},$$={class:"container mx-auto"},F$={class:"grid grid-cols-1 lg:grid-cols-2 gap-16 lg:gap-24 items-center"},U$={class:"text-center lg:text-left order-1 lg:order-2"},j$={class:"hero-cta mb-10"},B$={class:"flex flex-col sm:flex-row gap-4 items-center justify-center"},q$={class:"seasons-section py-16"},z$={class:"container mx-auto px-4"},H$=["aria-busy"],K$={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center animate-pulse"},G$={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center"},W$=["onClick"],Q$={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},J$={class:"flex justify-center gap-6 text-sm"},Y$={class:"text-center"},X$={class:"text-white font-semibold"},Z$={class:"text-center"},eF={class:"text-white font-semibold"},tF={class:"absolute top-4 right-4"},nF=["onClick","aria-expanded"],rF={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},sF=["onClick"],iF=["onClick"],oF=["onClick"],aF=["onClick"],lF={class:"text-center mt-12"},uF={key:2,class:"text-center py-16"},cF={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},dF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},hF={class:"mb-6"},fF={class:"mb-6"},pF={class:"mb-6"},mF={class:"flex justify-end space-x-3"},gF=["disabled"],vF={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},yF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},_F={class:"text-center mb-6"},bF={class:"text-gray-300"},wF={__name:"Seasons",setup(n){const e=C([]),t=C(!0),r=Fl(),s=C(null),i=C(!1),o=C(!1),a=C(""),l=C(""),c=C(""),h=C(null),f=C(!1),g=C(null),v=C(""),I=C(!1),T=C(!1),A=C(!1),F=C(!1),U=C(!1);pn(async()=>{var j,ge;try{H.info("Dbut du chargement des saisons"),Av("firebase"),H.info("Mode de stockage dfini sur Firebase"),await aA(),H.info("Stockage initialis"),H.info("Attente de l'initialisation du service d'authentification...");try{v4(),await MT(),H.info("Service d'authentification initialis")}catch(he){H.warn("Service d'authentification non initialis, continuation sans authentification:",he.message||"Erreur inconnue")}try{tl(),H.info("Synchronisation force effectue")}catch(he){H.warn("Erreur lors de la synchronisation force:",he)}H.info("Chargement des saisons...");try{e.value=await Ba(),H.info("Saisons charges",{count:((j=e.value)==null?void 0:j.length)||0})}catch(he){throw H.error("Erreur lors du chargement des saisons:",he),he}if(e.value.length>0){H.info("Chargement des donnes des saisons...");const he=await Promise.all(e.value.map(async De=>{try{H.debug(`Chargement des donnes pour la saison: ${De.name} (ID: ${De.id})`);let We,Ze;try{We=await Eh(De.id),H.debug(`vnements chargs pour ${De.name}:`,We)}catch(gt){H.warn(`Erreur lors du chargement des vnements pour ${De.name}:`,gt),We=[]}try{Ze=await $u(De.id),H.debug(`Joueurs chargs pour ${De.name}:`,Ze)}catch(gt){H.warn(`Erreur lors du chargement des joueurs pour ${De.name}:`,gt),Ze=[]}return H.debug(`Saison ${De.name}: ${(We==null?void 0:We.length)||0} vnements, ${(Ze==null?void 0:Ze.length)||0} joueurs`),{...De,events:We||[],players:Ze||[]}}catch(We){return H.warn(`Erreur lors du chargement des donnes pour la saison ${De.id}:`,We),{...De,events:[],players:[]}}}));e.value=he,H.info("Donnes des saisons charges",{count:e.value.length}),e.value.forEach(De=>{var We,Ze;H.info(`Saison finale ${De.name}: ${((We=De.events)==null?void 0:We.length)||0} vnements, ${((Ze=De.players)==null?void 0:Ze.length)||0} joueurs`)})}x().catch(he=>H.error("Migration sortOrder choue",he))}catch(he){H.error("Erreur lors du chargement initial des saisons:",he),H.error("Stack trace:",he.stack);try{H.info("Tentative de fallback pour charger les saisons..."),e.value=await Ba(),H.info("Saisons charges en fallback",{count:((ge=e.value)==null?void 0:ge.length)||0})}catch(De){H.error("chec du fallback pour charger les saisons:",De)}}finally{t.value=!1,H.info("Chargement termin, isLoading = false")}const q=()=>{U.value=window.scrollY>10};return window.addEventListener("scroll",q,{passive:!0}),()=>{window.removeEventListener("scroll",q)}});const L=Fe(()=>[...e.value].sort((q,j)=>{var Ze,gt;const ge=typeof q.sortOrder=="number"?q.sortOrder:Number.MAX_SAFE_INTEGER,he=typeof j.sortOrder=="number"?j.sortOrder:Number.MAX_SAFE_INTEGER;if(ge!==he)return ge-he;const De=(Ze=q.createdAt)!=null&&Ze.toMillis?q.createdAt.toMillis():0,We=(gt=j.createdAt)!=null&&gt.toMillis?j.createdAt.toMillis():0;return De!==We?We-De:(q.name||"").localeCompare(j.name||"")}));function $(q){r.push(`/season/${q}`)}function ue(q){s.value=s.value===q?null:q}function se(){s.value=null}function E(){const q=document.querySelector(".help-section");q&&q.scrollIntoView({behavior:"smooth"})}function _(){const q=document.querySelector(".seasons-section");q&&q.scrollIntoView({behavior:"smooth"})}async function x(){if(!e.value.length)return;const q=e.value.map(ge=>typeof ge.sortOrder=="number"?ge.sortOrder:null).filter(ge=>ge!==null);let j=q.length?Math.max(...q):0;for(const ge of e.value)if(typeof ge.sortOrder!="number"){j+=1;try{await hu(ge.id,j),ge.sortOrder=j}catch(he){H.error("Erreur migration sortOrder",{seasonName:ge==null?void 0:ge.name,error:he})}}}async function R(q){try{if(!(q!=null&&q.id)){alert("Saison introuvable");return}const[j,ge]=await Promise.all([Eh(q.id),$u(q.id)]),[he,De]=await Promise.all([No(ge,j,q.id),Vo(q.id)]),We=["Joueur",...j.map(jn=>k(jn))],Ze=[];for(const jn of ge){const Ar=(jn==null?void 0:jn.name)||"",Xt=(he==null?void 0:he[Ar])||{},pa=[Ar,...j.map(Bn=>ne(Xt[Bn.id],De==null?void 0:De[Bn.id],Ar))];Ze.push(pa)}const gt=Qe([We,...Ze]),Mt=new Blob(["\uFEFF"+gt],{type:"text/csv;charset=utf-8;"}),Er=(q==null?void 0:q.name)||(q==null?void 0:q.slug)||"saison",Tr=`${be(Er)}-disponibilites.csv`,Lt=URL.createObjectURL(Mt),Bt=document.createElement("a");Bt.href=Lt,Bt.download=Tr,document.body.appendChild(Bt),Bt.click(),document.body.removeChild(Bt),URL.revokeObjectURL(Lt),H.info("Export CSV saison",{seasonId:q.id,events:j.length,players:ge.length})}catch(j){H.error("Erreur export CSV",j),alert("Erreur lors de l'export CSV. Veuillez ressayer.")}}function M(q){if(!q)return null;if(q instanceof Date)return q;if(typeof(q==null?void 0:q.toDate)=="function")return q.toDate();if(typeof q=="string"||typeof q=="number"){const j=new Date(q);return isNaN(j.getTime())?null:j}return null}function k(q){const j=M(q==null?void 0:q.date),ge=j?`${j.getFullYear()}-${String(j.getMonth()+1).padStart(2,"0")}-${String(j.getDate()).padStart(2,"0")}`:"",he=(q==null?void 0:q.title)||"Sans titre";return`${ge}  ${he}`.trim()}function P(q){return q===!0||q==="oui"?"disponible":q===!1||q==="non"?"non disponible":""}function Qe(q){return q.map(j=>j.map(nt).join(",")).join(`
`)}function nt(q){const j=String(q??"");return/[",\n\r]/.test(j)?'"'+j.replace(/"/g,'""')+'"':j}function be(q){return String(q||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9\-_. ]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$|^\.+|\.+$/g,"")||"fichier"}function ne(q,j,ge){return Array.isArray(j)&&j.includes(ge)?q===!1||q==="non"?"non disponible":"slectionn":P(q)}async function ae(q){if(se(),q<=0)return;const j=[...L.value],ge=j[q],he=j[q-1],De=ge.sortOrder;ge.sortOrder=he.sortOrder,he.sortOrder=De;try{await Promise.all([hu(ge.id,ge.sortOrder),hu(he.id,he.sortOrder)])}catch(We){H.error("Erreur lors du dplacement vers le haut",We)}}async function ie(q){se();const j=[...L.value];if(q>=j.length-1)return;const ge=j[q],he=j[q+1],De=ge.sortOrder;ge.sortOrder=he.sortOrder,he.sortOrder=De;try{await Promise.all([hu(ge.id,ge.sortOrder),hu(he.id,he.sortOrder)])}catch(We){H.error("Erreur lors du dplacement vers le bas",We)}}function ke(){a.value&&(l.value=a.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function Z(){c.value=c.value.replace(/[^0-9]/g,""),c.value.length>4&&(c.value=c.value.slice(0,4))}async function Q(){if(!a.value.trim()||!l.value.trim()||!c.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN  4 chiffres");return}if(c.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await i4(a.value.trim(),l.value.trim(),c.value.trim()),e.value=await Ba(),await x(),Ee()}catch(q){H.error("Erreur lors de la cration de la saison",q),alert("Erreur lors de la cration de la saison. Veuillez ressayer.")}}function Ee(){i.value=!1,a.value="",l.value="",c.value=""}function Je(q){h.value=q,o.value=!0}async function ct(){o.value=!1,await Ae({type:"deleteSeason",data:{seasonId:h.value.id,seasonName:h.value.name}})}function Ot(){o.value=!1,h.value=null}function X(){return g.value?{deleteSeason:"Suppression de saison - Code PIN requis"}[g.value.type]||"Code PIN requis":"Veuillez saisir le code PIN  4 chiffres"}async function Ae(q){if(On.isPinCached(h.value.id)){const j=On.getCachedPin(h.value.id);if(H.debug("PIN en cache trouv, utilisation automatique"),await wh(h.value.id,j)){await dt(q);return}else On.clearSession()}g.value=q,f.value=!0}async function xe(q){var j,ge,he,De;H.debug("PIN soumis pour l'opration",{operationType:(j=g.value)==null?void 0:j.type});try{const We=((he=(ge=g.value)==null?void 0:ge.data)==null?void 0:he.seasonId)||((De=h.value)==null?void 0:De.id),Ze=await wh(We,q);if(H.debug("PIN valid",{valid:Ze}),Ze){On.saveSession(We,q),H.debug("PIN correct, fermeture de la modal et excution de l'opration"),f.value=!1;const gt=g.value;g.value=null,H.debug("Appel de executePendingOperation",{operationType:gt==null?void 0:gt.type}),await dt(gt)}else v.value="Code PIN incorrect",setTimeout(()=>{v.value=""},3e3)}catch(We){H.error("Erreur lors de la vrification du PIN",We),v.value="Erreur lors de la vrification du code PIN"}}function Ve(){f.value=!1,g.value=null,v.value=""}function rt(){return h.value&&On.isPinCached(h.value.id)?{timeRemaining:On.getTimeRemaining(),isExpiringSoon:On.isExpiringSoon()}:null}async function dt(q){var he;if(H.debug("executePendingOperation appel",{hasOperation:!!q}),!q){H.warn("Aucune opration  excuter");return}const{type:j,data:ge}=q;H.info("Excution de l'opration",{type:j});try{switch(j){case"deleteSeason":H.info("Suppression de la saison",{seasonId:ge.seasonId}),await o4(ge.seasonId),H.info("Saison supprime, rechargement de la liste"),e.value=await Ba(),H.info("Liste des saisons recharge",{count:((he=e.value)==null?void 0:he.length)||0});break;default:H.warn("Type d'opration non reconnu",{type:j})}}catch(De){H.error("Erreur lors de l'excution de l'opration",De),alert("Erreur lors de l'opration. Veuillez ressayer.")}}function S(){I.value=!0}function N(){I.value=!1}function K(){I.value=!1,Re()}function G(){T.value=!0}function te(){T.value=!1}function de(){A.value=!0}function we(){A.value=!1}function _e(){F.value=!0}function Ie(){F.value=!1}function ye(){H.debug("Gestion de joueur demande")}async function $e(){try{await Ge.signOut(),T.value=!1,H.info("Utilisateur dconnect avec succs")}catch(q){H.error("Erreur lors de la dconnexion",q),alert("Erreur lors de la dconnexion. Veuillez ressayer.")}}async function Re(){try{const q=await OT();if(q){r.push(`/season/${q}`);return}}catch(q){H.warn("Impossible de rcuprer la saison prfre",q)}_()}return pn(()=>(tl(),()=>{})),bt(()=>r.currentRoute.value.path,async q=>{var j;if(q==="/"&&(tl(),e.value.length===0&&!t.value)){t.value=!0;try{e.value=await Ba(),H.info("Saisons recharges lors du changement de route",{count:((j=e.value)==null?void 0:j.length)||0})}catch(ge){H.error("Erreur lors du rechargement des saisons",ge)}finally{t.value=!1}}},{immediate:!0}),(q,j)=>{var ge;return D(),O("div",O$,[Ke(W3,{"is-scrolled":U.value,onOpenAccountMenu:G,onOpenHelp:E,onOpenNotifications:de,onOpenPlayers:_e,onLogout:$e,onOpenLogin:S},null,8,["is-scrolled"]),d("section",M$,[d("div",L$,[d("div",$$,[d("div",F$,[j[10]||(j[10]=Cn('<div class="text-center order-2 lg:order-1"><div class="hero-content-wrapper"><div class="hero-illustration relative hidden lg:block"><div class="relative mx-auto lg:mx-0 w-full max-w-lg"><div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-4 shadow-2xl border border-white/10 relative overflow-hidden"><div class="absolute inset-0 bg-gradient-to-br from-pink-500/10 via-purple-500/10 to-cyan-500/10 rounded-3xl blur-xl"></div><div class="relative z-10"><div class="flex items-center gap-3 mb-4"><div class="flex gap-2"><div class="w-3 h-3 bg-red-500 rounded-full"></div><div class="w-3 h-3 bg-yellow-500 rounded-full"></div><div class="w-3 h-3 bg-green-500 rounded-full"></div></div><div class="text-gray-400 text-sm">HatCast - Grille des disponibilits</div></div></div><div class="bg-gray-700 rounded-2xl p-4 min-h-[300px]"><div class="grid grid-cols-4 gap-2 mb-4"><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">15 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">22 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">29 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">5 Fv</div></div><div class="space-y-2"><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Marie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-gray-500/20 border border-gray-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Pierre</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Sophie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div></div></div></div></div><div class="absolute -top-4 -right-4 w-20 h-20 bg-gradient-to-r from-pink-400 to-purple-500 rounded-2xl shadow-xl transform rotate-12 z-30"></div><div class="absolute -bottom-4 -left-4 w-16 h-16 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-2xl shadow-xl transform -rotate-12 z-30 flex items-center justify-center"><img src="'+x4+'" alt="Masque HatCast" class="w-10 h-10 object-contain transform rotate-12"></div></div></div></div>',1)),d("div",U$,[j[9]||(j[9]=Cn('<div class="hero-title mb-8"><h1 class="text-4xl md:text-6xl font-bold text-white mb-6 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent leading-tight"> Faites vos quipes d&#39;impro<br>en un clin d&#39;il </h1></div><div class="hero-subtitle mb-10"><p class="text-xl md:text-2xl text-gray-300 leading-relaxed max-w-2xl"> Plus de casse-tte pour savoir qui joue quand. Chacun indique ses dispos, <strong class="text-white">HatCast compose l&#39;quipe pour vous</strong>, quitablement et sans tension. </p></div>',2)),d("div",j$,[d("div",B$,[d("button",{onClick:j[0]||(j[0]=he=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-5 px-10 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105 text-lg md:text-xl"},"  Dmarrez "),d("button",{onClick:E,class:"inline-flex items-center gap-2 text-cyan-300 hover:text-cyan-200 font-medium py-3 px-6 rounded-lg hover:bg-cyan-500/10 transition-all duration-300 border border-cyan-500/30 hover:border-cyan-400/50"},j[7]||(j[7]=[d("span",null,"",-1),St(" En savoir plus ")]))])]),d("div",{class:"hero-hint text-center"},[d("button",{onClick:_,class:"inline-flex items-center gap-2 text-gray-400 hover:text-cyan-300 transition-all duration-300 text-sm cursor-pointer group"},j[8]||(j[8]=[d("span",{class:"group-hover:animate-bounce"},"",-1),d("span",null,"Vos saisons ci-dessous",-1),d("span",{class:"group-hover:animate-bounce"},"",-1)]))])])])])]),j[11]||(j[11]=d("div",{class:"hero-background absolute inset-0 z-0"},[d("div",{class:"absolute top-20 left-10 w-32 h-32 bg-pink-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute bottom-20 right-10 w-40 h-40 bg-purple-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-cyan-500/5 rounded-full blur-3xl"})],-1))]),d("section",q$,[d("div",z$,[j[24]||(j[24]=d("div",{class:"text-center mb-12"},[d("h2",{class:"text-3xl md:text-4xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"}," Saisons en cours "),d("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto"}," Slectionnez une saison pour grer les disponibilits et quipes. ")],-1)),d("div",{class:"pb-16","aria-busy":t.value},[t.value?(D(),O("div",K$,[(D(),O(it,null,wr(8,he=>d("div",{key:"skeleton-"+he,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8 w-full max-w-sm"},j[12]||(j[12]=[d("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),d("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),d("div",{class:"h-px bg-white/10 mb-4"},null,-1),d("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(D(),O("div",G$,[(D(!0),O(it,null,wr(L.value,(he,De)=>{var We,Ze;return D(),O("div",{key:he.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20 w-full max-w-sm"},[d("div",{onClick:gt=>$(he.slug),class:"text-center cursor-pointer"},[j[15]||(j[15]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg"},[d("span",{class:"text-2xl"},"")],-1)),d("h2",Q$,re(he.name),1),j[16]||(j[16]=d("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),d("div",J$,[d("div",Y$,[d("div",X$,re(((We=he.events)==null?void 0:We.length)||0),1),j[13]||(j[13]=d("div",{class:"text-gray-400 text-xs"},"vnements",-1))]),d("div",Z$,[d("div",eF,re(((Ze=he.players)==null?void 0:Ze.length)||0),1),j[14]||(j[14]=d("div",{class:"text-gray-400 text-xs"},"Joueurs",-1))])])],8,W$),d("div",tF,[d("div",{class:"relative",onClick:j[1]||(j[1]=lt(()=>{},["stop"]))},[d("button",{onClick:gt=>ue(De),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===De,"aria-haspopup":"true",title:"Options"},j[17]||(j[17]=[d("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,nF),s.value===De?(D(),O("div",rF,[d("button",{onClick:gt=>{R(he),se()},class:"w-full text-left px-4 py-2 text-sm text-emerald-300 hover:bg-white/10",role:"menuitem"}," Exporter CSV ",8,sF),j[18]||(j[18]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:gt=>ae(De),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Monter ",8,iF),d("button",{onClick:gt=>ie(De),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Descendre ",8,oF),j[19]||(j[19]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:gt=>Je(he),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10",role:"menuitem"}," Supprimer ",8,aF)])):ce("",!0)])])])}),128))])):ce("",!0),d("div",lF,[d("button",{onClick:j[2]||(j[2]=he=>i.value=!0),class:"inline-flex items-center gap-3 bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-semibold py-4 px-8 rounded-xl text-lg hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-pink-500/25"},j[20]||(j[20]=[d("span",null,"",-1),St(" Nouvelle saison ")]))]),!t.value&&e.value.length===0?(D(),O("div",uF,[j[21]||(j[21]=d("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-4xl"},"")],-1)),j[22]||(j[22]=d("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison cre",-1)),j[23]||(j[23]=d("p",{class:"text-gray-300 mb-8"},"Commencez par crer votre premire saison de spectacles !",-1)),d("button",{onClick:j[3]||(j[3]=he=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Crer ma premire saison ")])):ce("",!0)],8,H$)])]),i.value?(D(),O("div",cF,[d("div",dF,[j[29]||(j[29]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"}," Nouvelle saison",-1)),d("div",hF,[j[25]||(j[25]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),ut(d("input",{"onUpdate:modelValue":j[4]||(j[4]=he=>a.value=he),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:ke},null,544),[[Ft,a.value]])]),d("div",fF,[j[26]||(j[26]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),ut(d("input",{"onUpdate:modelValue":j[5]||(j[5]=he=>l.value=he),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[Ft,l.value]])]),d("div",pF,[j[27]||(j[27]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),ut(d("input",{"onUpdate:modelValue":j[6]||(j[6]=he=>c.value=he),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:Z},null,544),[[Ft,c.value]]),j[28]||(j[28]=d("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protgera les oprations sensibles (suppressions, slections)",-1))]),d("div",mF,[d("button",{onClick:Ee,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Q,disabled:!a.value.trim()||!l.value.trim()||!c.value.trim()||c.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Crer ",8,gF)])])])):ce("",!0),o.value?(D(),O("div",vF,[d("div",yF,[d("div",_F,[j[30]||(j[30]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"")],-1)),j[31]||(j[31]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",bF,'tes-vous sr de vouloir supprimer la saison "'+re((ge=h.value)==null?void 0:ge.name)+'" ?',1)]),j[32]||(j[32]=d("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"},"  Cette action est irrversible et supprimera toutes les donnes de cette saison. ",-1)),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:Ot,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:ct,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ce("",!0),Ke($T,{show:f.value,message:X(),error:v.value,"session-info":rt(),onSubmit:xe,onCancel:Ve},null,8,["show","message","error","session-info"]),j[33]||(j[33]=Cn('<section class="help-section py-20 bg-gradient-to-br from-gray-900/50 to-gray-800/50 border-t border-white/10"><div class="container mx-auto px-4"><div class="max-w-6xl mx-auto"><div class="text-center mb-16"><h2 class="text-4xl md:text-5xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"> Qu&#39;est-ce que HatCast ? </h2><p class="text-xl text-purple-300 max-w-3xl mx-auto"> L&#39;appli pour slectionner vos joueurs d&#39;impro simplement, quitablement et sans prise de tte </p></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16"><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-pink-500/20 to-purple-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-pink-500/30"><span class="text-4xl"></span></div><h3 class="text-xl font-bold text-white mb-3">Gestion des saisons</h3><p class="text-gray-300 text-sm leading-relaxed"> Dclarez tous vos spectacles et indiquez combien de joueurs vous aurez besoin. Organisez votre saison d&#39;impro de A  Z. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-purple-500/20 to-cyan-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-purple-500/30"><span class="text-4xl"></span></div><h3 class="text-xl font-bold text-white mb-3">Sondage de disponibilits</h3><p class="text-gray-300 text-sm leading-relaxed"> Crez des sondages pour vos vnements. Chaque joueur indique ses disponibilits et HatCast optimise la composition des quipes. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-cyan-500/20 to-pink-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-cyan-500/30"><span class="text-4xl"></span></div><h3 class="text-xl font-bold text-white mb-3">Slection auto ou manuelle</h3><p class="text-gray-300 text-sm leading-relaxed"> Laissez le hasard pondr dcider ou reprenez la main  tout moment. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-green-500/20 to-blue-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-green-500/30"><span class="text-4xl"></span></div><h3 class="text-xl font-bold text-white mb-3">Pens pour le mobile</h3><p class="text-gray-300 text-sm leading-relaxed"> Utilisez HatCast facilement sur smartphone ou tablette, o que vous soyez. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-blue-500/20 to-indigo-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-blue-500/30"><span class="text-4xl"></span></div><h3 class="text-xl font-bold text-white mb-3">Comptes facultatifs</h3><p class="text-gray-300 text-sm leading-relaxed"> Crez un compte pour recevoir des rappels et scuriser vos infos. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-emerald-500/20 to-teal-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-emerald-500/30"><span class="text-4xl"></span></div><h3 class="text-xl font-bold text-white mb-3">Notifications intelligentes</h3><p class="text-gray-300 text-sm leading-relaxed"> Recevez des alertes par email et push pour les vnements et slections. Restez inform sans tre submerg. </p></div></div></div></div></section><footer class="border-t border-white/10 bg-gradient-to-br from-gray-900/50 to-gray-800/50"><div class="container mx-auto px-4 py-12"><div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8"><div class="col-span-1 md:col-span-2"><div class="flex items-center gap-3 mb-4"><div class="relative w-32 h-8"><img src="'+LT+'" alt="Logo HatCast" class="w-full h-full opacity-80"></div></div><p class="text-gray-400 text-sm leading-relaxed max-w-md"> L&#39;appli pour slectionner vos joueurs d&#39;impro simplement, quitablement et sans prise de tte. </p></div><div><h4 class="text-white font-semibold mb-4 text-sm uppercase tracking-wider">Contact</h4><div class="space-y-2"><a href="mailto:impropick@gmail.com" class="block text-gray-400 hover:text-blue-300 transition-colors text-sm">  impropick@gmail.com </a><p class="text-gray-500 text-xs">Retours et suggestions bienvenus</p></div></div><div><h4 class="text-white font-semibold mb-4 text-sm uppercase tracking-wider">Ressources</h4><div class="space-y-2"><a href="#" class="block text-gray-400 hover:text-blue-300 transition-colors text-sm">  Guide utilisateur </a><a href="https://github.com/plamarque/hatcast" target="_blank" rel="noopener noreferrer" class="block text-gray-400 hover:text-blue-300 transition-colors text-sm">  Code source </a><p class="text-gray-500 text-xs">Documentation en cours</p></div></div></div><div class="border-t border-white/10 mb-6"></div><div class="flex flex-col sm:flex-row items-center justify-between text-xs text-gray-500"><div class="flex items-center gap-4 mb-4 sm:mb-0"><span> Patrice Lamarque 2025</span><span class="hidden sm:inline"></span><span>Licence MIT</span></div><div class="flex items-center gap-4"><span class="text-gray-600">En cours de dveloppement</span><a href="https://github.com/plamarque/hatcast" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-blue-300 transition-colors underline decoration-gray-600 hover:decoration-blue-300"> GitHub </a></div></div></div></footer>',2)),Ke(UT,{show:I.value,onClose:N,onSuccess:K},null,8,["show"]),Ke(sA,{show:T.value,onClose:te,onLogoutDevice:$e},null,8,["show"]),Ke(iA,{show:A.value,onClose:we},null,8,["show"]),Ke(oA,{show:F.value,onClose:Ie,onManagePlayer:ye},null,8,["show"])])}}};function xF({reason:n,recipientName:e,eventTitle:t,eventDate:r,urls:s={},prefs:i={},extra:o={}}){var l,c;const a={email:null,push:null};if(n==="availability_request"||n==="availability_reminder"){const h=(i==null?void 0:i.notifyAvailability)!==!1,f=(i==null?void 0:i.notifyAvailabilityPush)!==!1;a.email={enabled:h,subject:n==="availability_reminder"?`Rappel disponibilit  ${t} (${r})`:`Disponibilit demande  ${t} (${r})`},a.push={enabled:f,title:n==="availability_reminder"?" Rappel disponibilit":`${t} (${r})`,body:n==="availability_reminder"?`${e}, ${t} (${r})`:`${e}, t'es dispo ?`,data:{url:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,reason:n}},console.log("URLs pour notifications de disponibilit:",{eventUrl:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,urls:s})}if(n==="selection"){const h=(i==null?void 0:i.notifySelection)!==!1,f=(i==null?void 0:i.notifySelectionPush)!==!1;a.email={enabled:h,subject:` Equipe pour ${t}`},a.push={enabled:f,title:` Equipe pour ${t}`,body:`${e}, tu fais partie de l'quipe pour ${t} le ${r}!`,data:{url:s.eventUrl,noUrl:s.noUrl,reason:n}},console.log("URLs pour notifications de slection:",{eventUrl:s.eventUrl,noUrl:s.noUrl,urls:s})}return console.log("buildNotificationPayloads",{reason:n,recipientName:e,prefs:i,payloads:a,emailEnabled:(l=a.email)==null?void 0:l.enabled,pushEnabled:(c=a.push)==null?void 0:c.enabled}),a}function Z_({recipientName:n,eventTitle:e,eventDate:t}){return{title:`${e} (${t})`,body:`${n}, t'es dispo ?`}}function eb({recipientName:n,eventTitle:e,eventDate:t}){return{title:` Equipe pour ${e}`,body:`${n}, tu fais partie de l'quipe pour ${e} le ${t}!`}}function tb({recipientName:n,eventTitle:e,eventDate:t,eventUrl:r,yesUrl:s,noUrl:i}){return{subject:`Disponibilit demande  ${e} (${t})`,from:"HatCast",to:n,html:KT({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,yesUrl:s,noUrl:i})}}function nb({recipientName:n,eventTitle:e,eventDate:t,eventUrl:r,noUrl:s}){return{subject:` Equipe pour ${e}`,from:"HatCast",to:n,html:W4({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,noUrl:s})}}async function IF({reason:n,recipientEmail:e,recipientName:t,eventTitle:r,eventDate:s,urls:i={},extra:o={}}){var g;if(!e)return{success:!1,skipped:!0,reason:"missing_email"};const a=await jt(Pe(le,"userPreferences",e)).catch(()=>null),l=a!=null&&a.exists()?a.data():{},c=xF({reason:n,recipientName:t,eventTitle:r,eventDate:s,urls:i,prefs:l,extra:o}),h=[];return c.email&&c.email.enabled&&(n==="availability_request"||n==="availability_reminder"?await e3({toEmail:e,playerName:t,eventTitle:r,eventDate:s,yesUrl:i.yesUrl,noUrl:i.noUrl,eventUrl:i.eventUrl,reason:n==="availability_reminder"?"reminder":"new_event"}).then(()=>h.push({channel:"email",success:!0})).catch(v=>{H.error("notifyRecipientAcrossChannels email error",v),h.push({channel:"email",success:!1})}):n==="selection"&&h.push({channel:"email",success:!0,skipped:!0,note:"batch_handled_elsewhere"})),c.push&&c.push.enabled?(H.debug("Envoi notification push",{reason:n,recipientEmail:e,title:c.push.title,body:c.push.body}),await qc({toEmail:e,title:c.push.title,body:c.push.body,data:c.push.data||{},reason:n}).then(()=>{H.info("Notification push envoye avec succs",{reason:n,recipientEmail:e}),h.push({channel:"push",success:!0})}).catch(v=>{H.error("notifyRecipientAcrossChannels push error",v),h.push({channel:"push",success:!1})})):H.debug("Notification push dsactive ou non configure",{reason:n,recipientEmail:e,hasPayload:!!c.push,enabled:(g=c.push)==null?void 0:g.enabled,prefs:l}),{success:h.some(v=>v.success),results:h}}async function rb({eventId:n,eventData:e,players:t,seasonId:r,seasonSlug:s,createMagicLink:i,reminder:o=!1,getAvailabilityForEvent:a=null}){const l=[],c=`${window.location.origin}/season/${s}/event/${n}`;for(const h of t)try{if(o&&typeof a=="function"){const v=await Promise.resolve(a(h.name,n));if(v===!0||v===!1)continue}const f={};if(typeof i=="function"){const v=await i({seasonId:r,playerId:h.id,eventId:n,action:"yes"}),I=await i({seasonId:r,playerId:h.id,eventId:n,action:"no"});f.yesUrl=`${v.url}&slug=${encodeURIComponent(s)}`,f.noUrl=`${I.url}&slug=${encodeURIComponent(s)}`}f.eventUrl=c,(await IF({reason:o?"availability_reminder":"availability_request",recipientEmail:h.email,recipientName:h.name,eventTitle:e.title,eventDate:EF(e.date),urls:f})).success||l.push(h.id)}catch{l.push(h.id)}return{success:!0,failures:l}}async function sb(n){return s3(n)}function EF(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function TF(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//HatCast//Calendar Event//FR","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${n.id}@impropick.com`,`DTSTAMP:${new Date().toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTSTART:${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTEND:${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`SUMMARY:${n.title}`,`DESCRIPTION:${n.description||""}${e?`\\n\\nSaison : ${e}`:""}`,"STATUS:CONFIRMED","SEQUENCE:0","BEGIN:VALARM","TRIGGER:-PT1H","ACTION:DISPLAY",`DESCRIPTION:Rappel : ${n.title}`,"END:VALARM","END:VEVENT","END:VCALENDAR"].join(`\r
`)}function AF(n,e=""){const t=TF(n,e),r=new Blob([t],{type:"text/calendar;charset=utf-8"}),s=URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=`${n.title.replace(/[^a-z0-9]/gi,"_")}_${n.date}.ics`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}function SF(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://calendar.google.com/calendar/render?${new URLSearchParams({action:"TEMPLATE",text:n.title,dates:`${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z/${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,details:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"HatCast",sf:"true",output:"xml"}).toString()}`}function PF(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://outlook.live.com/calendar/0/deeplink/compose?${new URLSearchParams({subject:n.title,startdt:r.toISOString(),enddt:s.toISOString(),body:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"HatCast",allday:"false"}).toString()}`}function CF(n,e=""){const t=SF(n,e);window.open(t,"_blank")}function RF(n,e=""){const t=PF(n,e);window.open(t,"_blank")}function kF(n,e,t=""){switch(n){case"ics":AF(e,t);break;case"google":CF(e,t);break;case"outlook":RF(e,t);break;default:console.warn("Type de calendrier non support:",n)}}const DF="/icons/manifest-icon-192.maskable.png",NF={class:"relative p-5 pb-4 border-b border-white/10"},VF={class:"text-xl md:text-2xl font-bold text-white pr-10 flex items-center gap-2"},OF={class:"hidden sm:inline"},MF={key:0,class:"text-sm text-purple-300 mt-1"},LF={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},$F={class:"space-y-4"},FF={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},UF={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},jF={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},BF={key:0,class:"space-y-2"},qF={class:"flex flex-wrap gap-2"},zF=["onClick","title"],HF={key:1,class:"text-amber-400 text-sm"},KF={class:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4 mb-3"},GF={class:"inline-flex bg-gray-800 rounded-lg overflow-hidden border border-gray-700 self-start"},WF={class:"text-sm text-gray-400"},QF={key:0},JF={key:1},YF={key:2},XF={class:"text-sm text-gray-300"},ZF={class:"text-sm text-gray-300"},e6={class:"text-sm text-gray-300"},t6=["innerHTML"],n6=["value"],r6={class:"mt-3"},s6={class:"text-lg font-semibold leading-snug"},i6={class:"mt-2 text-base whitespace-pre-line text-white/90"},o6={class:"mt-4 flex items-center gap-4 text-base"},a6={key:1,class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-red-600/20 text-red-300 border border-red-600/40"},l6={class:"bg-yellow-500/10 border border-yellow-500/30 text-yellow-200 rounded-md p-3 text-sm mb-2"},u6=["value"],c6={key:2,class:"space-y-3"},d6=["value"],h6={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},f6={class:"flex items-center gap-2 w-full"},p6=["disabled"],m6={key:0},g6={class:"hidden sm:inline"},v6={key:1,class:"inline-flex items-center gap-2"},y6=["title"],_6={key:0},b6={key:1},uA={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]},sending:{type:Boolean,default:!1},availabilityByPlayer:{type:Object,default:()=>({})}},emits:["close","notifications-sent","send-notifications"],setup(n,{emit:e}){const t=n,r=e;C("notify");const s=C(!1),i=C("Copier le message"),o=C(!1),a=Fe(()=>t.sending||o.value),l=C(!1),c=C("email"),h=Fe(()=>!t.event||!t.seasonSlug?"":`${window.location.origin}/season/${t.seasonSlug}/event/${t.event.id}`),f=Fe(()=>{var ke,Z,Q,Ee;if(!t.event)return"";const be=((ke=$.value)==null?void 0:ke.id)==="ALL"?"<joueur>":((Z=$.value)==null?void 0:Z.name)||"[Nom du joueur]",ne=k((Q=t.event)==null?void 0:Q.date),ae=(Ee=t.event)==null?void 0:Ee.title,ie=h.value;return t.mode==="event"?J4({playerName:be,eventTitle:ae,eventDate:ne,eventUrl:ie}):Y4({playerName:be,eventTitle:ae,eventDate:ne,eventUrl:ie})}),g=Fe(()=>t.event?(c.value==="push"||c.value==="copy",f.value):""),v=Fe(()=>{var ae,ie,ke,Z,Q;if(!t.event)return"";const be=k((ae=t.event)==null?void 0:ae.date),ne=((ie=$.value)==null?void 0:ie.id)==="ALL"?"<joueur>":((ke=$.value)==null?void 0:ke.name)||"[Nom du joueur]";return t.mode==="event"?tb({recipientName:ne,eventTitle:(Z=t.event)==null?void 0:Z.title,eventDate:be,eventUrl:h.value,yesUrl:`${h.value}?action=available`,noUrl:`${h.value}?action=unavailable`}).subject:nb({recipientName:ne,eventTitle:(Q=t.event)==null?void 0:Q.title,eventDate:be,eventUrl:h.value,noUrl:x.value}).subject}),I=Fe(()=>"HatCast"),T=Fe(()=>{var ae,ie,ke,Z,Q,Ee,Je;if(!t.event)return"";const be=k((ae=t.event)==null?void 0:ae.date),ne=((ie=$.value)==null?void 0:ie.id)==="ALL"?"<joueur>":((ke=$.value)==null?void 0:ke.name)||"[Nom du joueur]";return $.value&&$.value.id&&$.value.id!=="ALL"&&!((Z=se.value.find(ct=>ct.id===$.value.id))!=null&&Z.hasContact)?Q4({playerName:ne,eventTitle:(Q=t.event)==null?void 0:Q.title,eventDate:be,eventUrl:h.value}):t.mode==="event"?tb({recipientName:ne,eventTitle:(Ee=t.event)==null?void 0:Ee.title,eventDate:be,eventUrl:h.value,yesUrl:`${h.value}?action=available`,noUrl:`${h.value}?action=unavailable`}).html:nb({recipientName:ne,eventTitle:(Je=t.event)==null?void 0:Je.title,eventDate:be,eventUrl:h.value,noUrl:x.value}).html});Fe(()=>T.value.replace(/<\/?div[^>]*>/g,`
`).replace(/<\/?p[^>]*>/g,`
`).replace(/<br\s*\/?>(\n)?/g,`
`).replace(/<[^>]+>/g,"").replace(/\n{3,}/g,`

`).trim());const A=Fe(()=>{var ae,ie,ke,Z,Q;if(!t.event)return"";const be=k((ae=t.event)==null?void 0:ae.date),ne=((ie=$.value)==null?void 0:ie.id)==="ALL"?"<joueur>":((ke=$.value)==null?void 0:ke.name)||"[Nom du joueur]";return t.mode==="event"?Z_({recipientName:ne,eventTitle:(Z=t.event)==null?void 0:Z.title,eventDate:be}).title:eb({recipientName:ne,eventTitle:(Q=t.event)==null?void 0:Q.title,eventDate:be}).title}),F=Fe(()=>{var ke,Z,Q,Ee,Je,ct;if(!t.event)return"";const be=k((ke=t.event)==null?void 0:ke.date),ne=((Z=$.value)==null?void 0:Z.id)==="ALL"?"<joueur>":((Q=$.value)==null?void 0:Q.name)||"[Nom du joueur]",ae=$.value&&$.value.id&&$.value.id!=="ALL",ie=ae?!!((Ee=se.value.find(Ot=>Ot.id===$.value.id))!=null&&Ee.hasContact):!0;return ae&&!ie?f.value:t.mode==="event"?Z_({recipientName:ne,eventTitle:(Je=t.event)==null?void 0:Je.title,eventDate:be}).body:eb({recipientName:ne,eventTitle:(ct=t.event)==null?void 0:ct.title,eventDate:be}).body}),U=C([]),L=C([]),$=C(null),ue=C([]),se=Fe(()=>{const be=L.value.map(ae=>({...ae,hasContact:ae.id!=="ALL",missingReason:""})),ne=ue.value.map(ae=>({...ae,hasContact:!1,missingReason:"Aucun canal actif"}));return[{id:"ALL",name:"Tous",hasContact:!0},...be.filter(ae=>ae.id!=="ALL"),...ne]}),E=Fe(()=>{if(!$.value||$.value.id==="ALL")return!0;const be=se.value.find(ae=>(ae.id||ae.name)===($.value.id||$.value.name)),ne=!!(be!=null&&be.hasContact);return console.log("hasSelectedRecipientContact debug:",{selectedRecipient:$.value,allDisplayRecipients:se.value,foundRecipient:be,hasContact:ne,recipients:L.value,nonContactRecipients:ue.value}),ne}),_=Fe(()=>f.value),x=Fe(()=>{var be,ne;try{const ae=(be=$.value)!=null&&be.id&&$.value.id!=="ALL"?t.players.find(ie=>ie.id===$.value.id):null;return!ae||!((ne=t.event)!=null&&ne.id)||!t.seasonId?"[lien dsistement]":`${window.location.origin}/magic?auto=no&season=${encodeURIComponent(t.seasonId)}&player=${encodeURIComponent(ae.id)}&event=${encodeURIComponent(t.event.id)}&slug=${encodeURIComponent(t.seasonSlug||"")}`}catch{return"[lien dsistement]"}});async function R(){if(!t.seasonId)return;let be=[];t.mode==="selection"?(be=t.players.filter(ke=>t.selectedPlayers.includes(ke.name)),console.log("Mode slection - targetPlayers:",be)):(be=t.players.filter(ke=>{var Q;return typeof((Q=t.availabilityByPlayer)==null?void 0:Q[ke.name])>"u"}),console.log("Mode vnement - targetPlayers:",be));const ne=[];for(const ke of be)try{const{getPlayerEmail:Z}=await en(()=>Promise.resolve().then(()=>zc),void 0),Q=await Z(ke.id,t.seasonId);console.log(`Email pour ${ke.name}:`,Q),Q&&ne.push({...ke,email:Q})}catch(Z){console.warn(`Impossible de charger l'email pour ${ke.name}:`,Z)}console.log("Players avec email:",ne),U.value=ne;const ae={id:"ALL",name:"Tous"};L.value=[ae,...ne];const ie=be.filter(ke=>!ne.find(Z=>Z.id===ke.id)).map(ke=>({id:ke.id,name:ke.name}));ue.value=ie,console.log("Recipients finaux:",{recipients:L.value,nonContactRecipients:ue.value,allDisplayRecipients:se.value}),$.value||($.value=ae)}function M(){r("close")}function k(be){var ae;return be?(typeof be=="string"?new Date(be):((ae=be.toDate)==null?void 0:ae.call(be))||be).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function P(){const be=g.value;navigator.clipboard.writeText(be).then(()=>{s.value=!0,i.value="Copi !",setTimeout(()=>{s.value=!1,i.value="Copier le message"},2e3)}).catch(ne=>{console.warn("Erreur lors de la copie du texte"),alert("Impossible de copier le message.")})}function Qe(be){$.value=be}async function nt(){if(!(!t.event||L.value.length===0)){o.value=!0;try{const be=$.value&&$.value.id!=="ALL"?"single":"all",ne=be==="single"?{id:$.value.id,name:$.value.name,email:$.value.email}:null;t.mode==="selection"?r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:"selection",selectedPlayers:t.selectedPlayers,scope:be,recipient:ne}):r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:"manual",scope:be,recipient:ne})}catch{console.error("Erreur lors de l'envoi des notifications"),alert("Erreur lors de l'envoi des notifications. Veuillez ressayer.")}finally{setTimeout(()=>{o.value=!1},1e3)}}}return pn(()=>{t.show&&R()}),bt(()=>t.show,be=>{be&&R()}),bt(()=>t.selectedPlayers,()=>{t.show&&t.mode==="selection"&&R()}),bt(()=>t.availabilityByPlayer,()=>{t.show&&t.mode==="event"&&R()},{deep:!0}),bt(()=>t.sending,be=>{be||(o.value=!1)}),(be,ne)=>{var ae,ie,ke,Z,Q;return n.show?(D(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:M},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:ne[4]||(ne[4]=lt(()=>{},["stop"]))},[d("div",NF,[d("button",{onClick:M,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},""),d("h2",VF,[d("span",OF,re(n.mode==="selection"?"":""),1),d("span",null,re(n.mode==="selection"?"Annoncer la slection":"Annoncer l'vnement"),1)]),n.event?(D(),O("p",MF,re(n.event.title)+"  "+re(k(n.event.date)),1)):ce("",!0)]),d("div",LF,[d("div",$F,[d("div",null,[d("label",FF,[ne[5]||(ne[5]=St(" Personnes  Prvenir ")),d("button",{onClick:ne[0]||(ne[0]=Ee=>l.value=!l.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),l.value?(D(),O("div",UF,ne[6]||(ne[6]=[d("p",{class:"text-blue-200 text-sm"},[St(" Cette liste montre tous les joueurs cibls: "),d("span",{class:"text-purple-300"}," Tous "),St(", "),d("span",{class:"text-gray-200"},"ceux notifiables (email/push actifs)"),St(" et "),d("span",{class:"text-yellow-300"},"ceux en jaune sans canal actif"),St(". Les joueurs en jaune ne peuvent pas tre notifis automatiquement. Utilise  Copier le message  pour leur crire via un autre moyen (l'URL de l'vnement est incluse). ")],-1)]))):ce("",!0),d("div",jF,[se.value.length>0?(D(),O("div",BF,[d("div",qF,[(D(!0),O(it,null,wr(se.value,Ee=>(D(),O("button",{key:Ee.id||Ee.name,type:"button",onClick:Je=>Qe(Ee),class:Qt(["px-3 py-1 rounded text-sm border transition-colors",$.value&&$.value.id===Ee.id?"bg-purple-600 border-purple-500 text-white":Ee.hasContact?"bg-gray-700 border-gray-600 text-white hover:bg-gray-600":"bg-yellow-900/20 border-yellow-600/40 text-yellow-200 hover:bg-yellow-900/30 opacity-75 cursor-not-allowed"]),title:Ee.hasContact?"Prvisualiser pour "+Ee.name:Ee.missingReason||"Aucun canal actif"},re(Ee.name),11,zF))),128))])])):(D(),O("div",HF,"  Aucun destinataire disponible. "))])]),d("div",null,[ne[14]||(ne[14]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Aperu du message :",-1)),d("div",KF,[d("div",GF,[d("button",{class:Qt(["px-3 py-1.5 text-sm transition-colors",c.value==="email"?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-700"]),onClick:ne[1]||(ne[1]=Ee=>c.value="email"),title:"Prvisualiser l'email"},"",2),d("button",{class:Qt(["px-3 py-1.5 text-sm transition-colors",c.value==="push"?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-700"]),onClick:ne[2]||(ne[2]=Ee=>c.value="push"),title:"Prvisualiser la notification push"},"",2),d("button",{class:Qt(["px-3 py-1.5 text-sm transition-colors",c.value==="copy"?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-700"]),onClick:ne[3]||(ne[3]=Ee=>c.value="copy"),title:"Texte  copier pour les joueurs sans canal actif"},"",2)]),d("div",WF,[c.value==="email"?(D(),O("span",QF,"Voici le message que ceux qui ont configur un email recevront")):c.value==="push"?(D(),O("span",JF,"Voici la notification que ceux qui ont install l'app mobile recevront")):(D(),O("span",YF,"Voici un texte simple que vous pouvez copier-coller pour annoncer cet vnement vous-mme o vous voulez (WhatsApp, Email, etc...)"))])]),c.value==="email"?(D(),O("div",{key:0,class:Qt(E.value||((ae=$.value)==null?void 0:ae.id)==="ALL"?"bg-gray-800 border border-gray-600 rounded-lg p-4 text-white space-y-3":"space-y-3")},[E.value||((ie=$.value)==null?void 0:ie.id)==="ALL"?(D(),O(it,{key:0},[d("div",XF,[ne[7]||(ne[7]=d("span",{class:"font-semibold"},"De:",-1)),St(" "+re(I.value),1)]),d("div",ZF,[ne[8]||(ne[8]=d("span",{class:"font-semibold"},":",-1)),St(" "+re(((ke=$.value)==null?void 0:ke.id)==="ALL"?"<joueur>":((Z=$.value)==null?void 0:Z.name)||"[Nom du joueur]"),1)]),d("div",e6,[ne[9]||(ne[9]=d("span",{class:"font-semibold"},"Objet:",-1)),St(" "+re(v.value),1)]),d("div",{class:"bg-gray-700 border border-gray-600 text-gray-100 rounded-md p-4 shadow-inner",innerHTML:T.value},null,8,t6)],64)):(D(),O(it,{key:1},[ne[10]||(ne[10]=d("div",{class:"bg-yellow-500/10 border border-yellow-500/30 text-yellow-200 rounded-md p-3 text-sm"}," Ce joueur n'a pas configur d'email. Utilise la fonction  Copier le message  et envoie-lui ces informations par un autre canal. ",-1)),d("textarea",{class:"w-full mt-2 p-3 bg-gray-900 border border-gray-700 rounded-md text-white text-sm",value:_.value,rows:"5",readonly:""},null,8,n6)],64))],2)):c.value==="push"?(D(),O("div",{key:1,class:Qt($.value&&$.value.id!=="ALL"&&!E.value?"text-white":"bg-gray-900 border border-gray-700 rounded-xl p-4 text-white")},[$.value&&$.value.id!=="ALL"&&!E.value?(D(),O(it,{key:1},[d("div",l6,re((Q=$.value)==null?void 0:Q.name)+" n'a pas install l'appli. Envoie-lui ce message manuellement. ",1),d("textarea",{class:"w-full p-3 bg-gray-800 border border-gray-700 rounded-md text-white text-sm",value:_.value,rows:"5",readonly:""},null,8,u6)],64)):(D(),O(it,{key:0},[ne[13]||(ne[13]=Cn('<div class="flex items-center justify-between text-xs text-white/70"><div class="flex items-center gap-2 min-w-0"><div class="w-6 h-6 rounded-full bg-white/10 flex items-center justify-center"></div><div class="truncate">HatCast</div><span class="opacity-60"></span><span>il y a 1 min</span></div><img src="'+DF+'" alt="App icon" class="w-10 h-10 rounded-full shadow"></div>',1)),d("div",r6,[d("div",s6,re(A.value),1),d("div",i6,re(F.value),1)]),d("div",o6,[t.mode==="event"?(D(),O(it,{key:0},[ne[11]||(ne[11]=d("span",{class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-green-600/20 text-green-300 border border-green-600/40"}," Dispo",-1)),ne[12]||(ne[12]=d("span",{class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-red-600/20 text-red-300 border border-red-600/40"}," Pas dispo",-1))],64)):(D(),O("span",a6," Plus dispo"))])],64))],2)):c.value==="copy"?(D(),O("div",c6,[d("textarea",{class:"w-full p-3 bg-gray-800 border border-gray-700 rounded-md text-white text-sm resize-none",value:g.value,rows:"6",readonly:""},null,8,d6)])):ce("",!0)])])]),d("div",h6,[d("div",f6,[d("button",{onClick:nt,disabled:L.value.length===0||a.value||$.value&&$.value.id!=="ALL"&&!E.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[a.value?(D(),O("span",v6,ne[18]||(ne[18]=[d("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[d("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),d("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),St(" Envoi en cours... ")]))):(D(),O("span",m6,[$.value&&$.value.id!=="ALL"?(D(),O("span",{key:0,class:Qt(E.value?"":"opacity-60")},[d("span",g6," Notifier "+re($.value.name),1),ne[15]||(ne[15]=d("span",{class:"sm:hidden"}," Notifier",-1))],2)):(D(),O(it,{key:1},[ne[16]||(ne[16]=d("span",{class:"hidden sm:inline"}," Envoyer les notifications",-1)),ne[17]||(ne[17]=d("span",{class:"sm:hidden"}," Envoyer",-1))],64))]))],8,p6),d("button",{onClick:P,class:"h-12 px-6 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:i.value},[s.value?(D(),O("span",b6," Copi")):(D(),O("span",_6,ne[19]||(ne[19]=[d("span",{class:"hidden sm:inline"}," Copier le message",-1),d("span",{class:"sm:hidden"}," Copier",-1)])))],8,y6)]),d("button",{onClick:M,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):ce("",!0)}}},w6={class:"relative p-6 pb-4 border-b border-white/10"},x6={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},I6={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(D(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=lt(()=>{},["stop"]))},[d("div",w6,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},""),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},""),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Kezako ?"),d("p",{class:"text-sm text-purple-300"},"L'appli pour organiser vos spectacles d'improvisation de manire simple et apaise")])],-1))]),s[5]||(s[5]=Cn('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">C&#39;est quoi ?</h3><p> HatCast est une appli conue pour faciliter <span class="text-white">la slection des joueurs d&#39;impro</span> pour les spectacles. L&#39;ide est ne au sein de <span class="text-purple-300">La Malice</span> pour <span class="text-white">dpersonnaliser une tche dlicate</span> qui crait des tensions depuis des annes. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">Comment a marche</h3><p> L&#39;asso dclare ses dates et le nombre de personnes ncessaires. Les joueurs indiquent leurs disponibilits. L&#39;appli propose des slections. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Slection auto ou manuelle</h3><p> Le <span class="text-white">mode slection auto</span> s&#39;appuie sur le hasard (pondr) pour simplifier la vie. Vous pouvez aussi repasser en mode <span class="text-white">manuel</span> si besoin. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Pense mobile  Libre d&#39;utilisation</h3><p> L&#39;appli est <span class="text-white">pense pour le mobile</span> et peut tre utilise librement par La Malice ou <span class="text-white">toute autre troupe</span>. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Comptes (facultatif)</h3><p> Les joueurs qui le souhaitent peuvent crer un compte via leur email pour <span class="text-white">recevoir des notifications</span>, <span class="text-white">protger leurs saisies</span> et bnficier d&#39;un meilleur confort d&#39;utilisation. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2 text-sm"><h3 class="text-white font-semibold">Statut &amp; licence</h3><p> Application <span class="text-white">en cours de dveloppement</span>, <span class="text-white">sans garanties</span>  ce stade. Licence libre <span class="text-white">MIT</span>. </p><p>Contact &amp; retours : <a href="mailto:impropick@gmail.com" class="text-blue-300 underline">impropick@gmail.com</a></p></div></div>',1)),d("div",x6,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ce("",!0)}},E6={class:"text-center mb-6"},T6={class:"text-lg text-gray-300"},A6={class:"mb-6"},S6={class:"space-y-4"},P6={class:"flex items-center gap-2 text-gray-300 text-sm"},C6=["disabled"],R6={key:0,class:"animate-spin"},k6={key:1},D6={class:"mb-6 text-center"},N6={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},V6={class:"text-red-300 text-sm"},O6={class:"text-center mb-6"},M6={class:"text-lg text-gray-300"},L6={class:"mb-6"},$6=["disabled"],F6={key:0,class:"animate-spin"},U6={key:1},j6={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},B6={class:"text-red-300 text-sm"},q6={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},z6={class:"text-green-300 text-sm"},H6={class:"flex justify-center"},Sv={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=C(""),i=C(!1),o=C(""),a=C(!1),l=C(""),c=C(""),h=C(null),f=C(!0);async function g(){if(s.value){i.value=!0,o.value="";try{const T=await pm(t.seasonId);if(s.value===T){if(f.value)try{eo.saveSession(t.player.id)}catch{}r("verified",{type:"season_pin"}),I();return}if(await tA(t.player.id,s.value,t.seasonId)){if(f.value)try{eo.saveSession(t.player.id)}catch{}r("verified",{type:"player_password"}),I()}else o.value="Mot de passe incorrect. Veuillez ressayer."}catch(T){H.error("Erreur lors de la vrification",T),o.value="Erreur lors de la vrification. Veuillez ressayer."}finally{i.value=!1}}}async function v(){i.value=!0,l.value="",c.value="";try{const T=await rA(t.player.id,t.seasonId);c.value=T.message||"Email de rinitialisation envoy ! Vrifiez votre bote de rception."}catch(T){H.error("Erreur lors de l'envoi de l'email",T),l.value="Erreur lors de l'envoi de l'email. Veuillez ressayer."}finally{i.value=!1}}function I(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return bt(()=>t.show,T=>{T&&Gt(()=>{h.value&&h.value.focus()})}),(T,A)=>{var F,U;return D(),O(it,null,[n.show?(D(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:I},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:A[3]||(A[3]=lt(()=>{},["stop"]))},[d("div",E6,[A[7]||(A[7]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"")],-1)),A[8]||(A[8]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Vrification requise",-1)),d("p",T6,re((F=n.player)==null?void 0:F.name),1),A[9]||(A[9]=d("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protg par mot de passe",-1))]),d("div",A6,[d("div",S6,[d("div",null,[A[10]||(A[10]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),ut(d("input",{"onUpdate:modelValue":A[0]||(A[0]=L=>s.value=L),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:zn(g,["enter"]),ref_key:"passwordInput",ref:h},null,544),[[Ft,s.value]])]),d("div",P6,[ut(d("input",{id:"staySignedIn",type:"checkbox","onUpdate:modelValue":A[1]||(A[1]=L=>f.value=L),class:"w-4 h-4"},null,512),[[Mi,f.value]]),A[11]||(A[11]=d("label",{for:"staySignedIn"},"Rester connect sur cet appareil",-1))])]),d("button",{onClick:g,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(D(),O("span",R6,"")):(D(),O("span",k6,"")),d("span",null,re(i.value?"Vrification...":"Vrifier"),1)],8,C6)]),d("div",D6,[d("button",{onClick:A[2]||(A[2]=L=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oubli ? ")]),o.value?(D(),O("div",N6,[d("div",V6,re(o.value),1)])):ce("",!0),d("div",{class:"flex justify-center"},[d("button",{onClick:I,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ce("",!0),a.value?(D(),O("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:A[6]||(A[6]=L=>a.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:A[5]||(A[5]=lt(()=>{},["stop"]))},[d("div",O6,[A[12]||(A[12]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"")],-1)),A[13]||(A[13]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oubli",-1)),d("p",M6,re((U=n.player)==null?void 0:U.name),1)]),d("div",L6,[A[14]||(A[14]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de rinitialisation sera envoy  l'adresse associe  ce joueur. ",-1)),d("button",{onClick:v,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(D(),O("span",F6,"")):(D(),O("span",U6,"")),d("span",null,re(i.value?"Envoi...":"Envoyer l'email"),1)],8,$6)]),l.value?(D(),O("div",j6,[d("div",B6,re(l.value),1)])):ce("",!0),c.value?(D(),O("div",q6,[d("div",z6,re(c.value),1)])):ce("",!0),d("div",H6,[d("button",{onClick:A[4]||(A[4]=L=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0)],64)}}},K6={class:"text-center mb-6"},G6={class:"text-sm text-gray-300"},W6={key:0,class:"space-y-4"},Q6={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},J6={key:1,class:"space-y-4"},Y6=["disabled"],X6={key:0,class:"animate-spin"},Z6={key:1},e5={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},t5={class:"mt-6 flex justify-center gap-3"},n5=["disabled"],r5={key:0,class:"animate-spin"},s5={key:1},cA={__name:"AccountClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=C(1),i=C(""),o=C(""),a=C(""),l=C(!1),c=C(""),h=C(!1),f=fa(),g=Fe(()=>i.value&&i.value.includes("@")),v=Fe(()=>o.value&&a.value&&o.value===a.value&&o.value.length>=6);async function I(){var U,L,$;if(!(!g.value||!((U=t.player)!=null&&U.id))){l.value=!0,c.value="";try{const ue=await JT({playerId:t.player.id,email:i.value.trim(),seasonId:t.seasonId}),se=(L=f.params)==null?void 0:L.slug,E=`${ue.url}${se?`&slug=${encodeURIComponent(se)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await t3({toEmail:i.value,playerName:(($=t.player)==null?void 0:$.name)||"joueur",verifyUrl:E}),h.value=!0}catch{c.value="Impossible d'envoyer l'email de vrification"}finally{l.value=!1}}}async function T(){try{await XT({playerId:t.player.id,seasonId:t.seasonId})}catch{}s.value=1,h.value=!1,i.value="",o.value="",a.value=""}async function A(){var U;try{const L=await jl((U=t.player)==null?void 0:U.id,t.seasonId);L!=null&&L.email&&(L!=null&&L.emailVerifiedAt)?s.value=2:s.value=1}catch{s.value=1}}pn(()=>{A()}),bt(()=>t.show,U=>{U&&A()});async function F(){if(v.value){l.value=!0,c.value="";try{await QT(t.player.id,i.value.trim(),o.value,t.seasonId),r("success")}catch(U){c.value=(U==null?void 0:U.message)||"Erreur lors de l'association"}finally{l.value=!1}}}return(U,L)=>{var $;return n.show?(D(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:L[6]||(L[6]=ue=>U.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:L[5]||(L[5]=lt(()=>{},["stop"]))},[d("button",{onClick:L[0]||(L[0]=ue=>U.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"  "),d("div",K6,[L[7]||(L[7]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"")],-1)),L[8]||(L[8]=d("h2",{class:"text-2xl font-bold text-white mb-1"},"Associer un compte",-1)),d("p",G6,"Pour scuriser les saisies de "+re(($=n.player)==null?void 0:$.name),1),Ke(FT)]),s.value===1?(D(),O("div",W6,[d("div",null,[L[9]||(L[9]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),ut(d("input",{"onUpdate:modelValue":L[1]||(L[1]=ue=>i.value=ue),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Ft,i.value]])]),h.value?(D(),O("div",Q6,[L[10]||(L[10]=d("span",null,"",-1)),d("span",null,"Un email a t envoy  "+re(i.value)+". Cliquez sur le lien contenu dans l'email pour continuer.",1)])):ce("",!0)])):s.value===2?(D(),O("div",J6,[d("div",{class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},[L[11]||(L[11]=d("span",null,"",-1)),L[12]||(L[12]=d("span",null,"Adresse email vrifie",-1)),d("button",{type:"button",onClick:T,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"")]),d("div",null,[L[13]||(L[13]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),ut(d("input",{"onUpdate:modelValue":L[2]||(L[2]=ue=>o.value=ue),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe scuris (min. 6 caractres)"},null,512),[[Ft,o.value]])]),d("div",null,[L[14]||(L[14]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),ut(d("input",{"onUpdate:modelValue":L[3]||(L[3]=ue=>a.value=ue),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[Ft,a.value]])]),d("button",{onClick:F,disabled:!v.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(D(),O("span",X6,"")):(D(),O("span",Z6,"")),d("span",null,re(l.value?"Association...":"Associer ce joueur"),1)],8,Y6)])):ce("",!0),c.value?(D(),O("div",e5,re(c.value),1)):ce("",!0),d("div",t5,[s.value===1?(D(),O("button",{key:0,onClick:I,disabled:!g.value||l.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(D(),O("span",r5,"")):(D(),O("span",s5,"")),d("span",null,re(l.value?"Envoi...":"Envoyer le lien de vrification"),1)],8,n5)):ce("",!0),d("button",{onClick:L[4]||(L[4]=ue=>U.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])):ce("",!0)}}},i5={class:"text-center mb-6"},o5={class:"text-2xl font-bold text-white mb-2"},a5={class:"text-lg text-gray-300"},l5={class:"mb-6"},u5={class:"flex items-center space-x-3"},c5={class:"text-2xl"},d5={class:"font-semibold text-white"},h5={class:"text-sm text-gray-300"},f5={key:0,class:"mb-6"},p5={key:1,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},m5={class:"text-red-300 text-sm"},g5={key:2,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},v5={class:"text-green-300 text-sm"},y5={class:"flex justify-center gap-3"},_5=["disabled"],b5={__name:"PlayerClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=C(!1),i=C(!1),o=C(!1),a=C(""),l=C(""),c=C(!1);fa();const h=C(!1);Fe(()=>!1),Fe(()=>!1);function f(){l.value="Compte cr et joueur associ !",s.value=!0,c.value=!1,r("update")}async function g(){var F;if((F=t.player)!=null&&F.id){s.value=await Bi(t.player.id,t.seasonId);try{const{isPlayerPasswordCached:U}=await en(()=>Promise.resolve().then(()=>zc),void 0);i.value=U(t.player.id)}catch{i.value=!1}}}function v(){var F;a.value="";try{if((F=t.player)!=null&&F.id&&Go(t.player.id)){I();return}}catch{}h.value=!0}async function I(){o.value=!0,a.value="",l.value="";try{const F=await ZT(t.player.id,t.seasonId);l.value="Joueur dverrouill!",s.value=!1,F.email&&(email.value=F.email),r("update")}catch(F){logger.error("Erreur lors de la dsactivation de la protection",F),a.value="Erreur lors de la dsactivation de la protection. Veuillez ressayer."}finally{o.value=!1}}function T(){h.value=!1,I()}function A(){r("close")}return bt(()=>t.player,()=>{t.show&&t.player&&g()},{immediate:!0}),bt(()=>t.show,F=>{F&&t.player&&(a.value="",l.value="",h.value=!1,g(),t.onboarding&&Gt(()=>{}))}),(F,U)=>{var L;return D(),O(it,null,[n.show?(D(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:A},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:U[1]||(U[1]=lt(()=>{},["stop"]))},[d("button",{onClick:A,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"  "),d("div",i5,[U[4]||(U[4]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"")],-1)),d("h2",o5,re(s.value?"Dverrouiller ce joueur":"Verrouiller ce joueur"),1),d("p",a5,re((L=n.player)==null?void 0:L.name),1)]),d("div",l5,[d("div",{class:Qt(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[d("div",u5,[d("span",c5,re(s.value?"":""),1),d("div",null,[d("div",d5,re(s.value?i.value?"Joueur associ  votre compte":"Ce joueur est associ  un compte utilisateur":"Joueur sans compte"),1),d("div",h5,re(s.value?i.value?"Seul vous pouvez modifier":"Seul le titulaire peut modifier les disponibilits":"Tout le monde peut modifier les disponibilits"),1)])])],2)]),s.value?ce("",!0):(D(),O("div",f5,U[5]||(U[5]=[d("div",{class:"text-sm text-gray-300"},"Vous pouvez protger vos saisies de disponibilits avec un compte utilisateur.",-1)]))),a.value?(D(),O("div",p5,[d("div",m5,re(a.value),1)])):ce("",!0),l.value?(D(),O("div",g5,[d("div",v5,re(l.value),1)])):ce("",!0),d("div",y5,[s.value?(D(),O("button",{key:1,onClick:v,disabled:o.value,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"  Dissocier ",8,_5)):(D(),O("button",{key:0,onClick:U[0]||(U[0]=$=>c.value=!0),class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300"}," Associer un compte ")),d("button",{onClick:A,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0),Ke(cA,{show:c.value,player:n.player,"season-id":n.seasonId,onClose:U[2]||(U[2]=$=>c.value=!1),onSuccess:f},null,8,["show","player","season-id"]),Ke(Sv,{show:h.value,player:n.player,seasonId:n.seasonId,onClose:U[3]||(U[3]=$=>h.value=!1),onVerified:T},null,8,["show","player","seasonId"])],64)}}};const w5=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},x5={class:"relative p-4 md:p-6 border-b border-white/10"},I5={class:"flex items-start gap-4 md:gap-6"},E5={class:"flex-1 min-w-0"},T5={class:"flex items-center gap-3 mb-2"},A5={class:"text-xl md:text-2xl font-bold text-white leading-tight"},S5={class:"flex items-center gap-2"},P5={key:0,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-full"},C5={key:1,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-full"},R5={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},k5={class:"grid grid-cols-3 gap-3 md:gap-4"},D5={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},N5={class:"text-xl md:text-2xl font-bold text-white"},V5={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},O5={class:"text-xl md:text-2xl font-bold text-white"},M5={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30 text-center"},L5={class:"text-xl md:text-2xl font-bold text-white"},$5={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},F5={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},U5={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},j5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},B5={class:"mb-6"},q5={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null},isProtected:{type:Boolean,default:!1},isPreferred:{type:Boolean,default:!1}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=C(!1),o=C(""),a=C(null),l=C(!1),c=C(!1),h=C(null);C(!1);const f=C(!1),g=C(!1),v=C(null),I=C(null),T=C({position:"fixed",top:"0px",left:"0px"}),A=C(null),F=C({position:"fixed",top:"0px",left:"0px"}),U=C(!1),L=C(!1);function $(){s("close"),f.value=!1,g.value=!1,T.value={position:"fixed",top:"0px",left:"0px"},F.value={position:"fixed",top:"0px",left:"0px"}}function ue(){var ae;o.value=((ae=r.player)==null?void 0:ae.name)||"",i.value=!0,Gt(()=>{a.value&&a.value.focus()})}function se(){i.value=!1,o.value=""}async function E(){var ie,ke;if(!o.value.trim())return;if(await Bi((ie=r.player)==null?void 0:ie.id,r.seasonId)){Go((ke=r.player)==null?void 0:ke.id)?_():(h.value="update",c.value=!0);return}_()}function _(){var ae;s("update",{playerId:(ae=r.player)==null?void 0:ae.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function x(){var ie,ke;if(await Bi((ie=r.player)==null?void 0:ie.id,r.seasonId)){Go((ke=r.player)==null?void 0:ke.id)?R():(h.value="delete",c.value=!0);return}R()}function R(){var ae;s("delete",(ae=r.player)==null?void 0:ae.id)}function M(){s("refresh")}function k(ae){h.value==="update"?_():h.value==="delete"&&R(),h.value=null}function P(){try{const ae=v.value;if(!ae)return;const ie=ae.getBoundingClientRect(),ke=8;if(window.innerWidth>768){const Z=Math.max(ke,Math.round(ie.top-ke)),Q=Math.max(ke,Math.round(ie.left));T.value={position:"fixed",top:`${Z}px`,left:`${Q}px`,zIndex:400}}else{const Z=Math.min(window.innerHeight-ke,Math.round(ie.bottom+ke)),Q=Math.max(ke,Math.round(ie.left));T.value={position:"fixed",top:`${Z}px`,left:`${Q}px`,zIndex:400}}}catch{}}function Qe(){try{const Z=Math.max(8,window.innerHeight-8-48-120),Q=Math.max(8,Math.round(window.innerWidth-200-8));F.value={position:"fixed",top:`${Z}px`,left:`${Q}px`,zIndex:400}}catch{}}function nt(){f.value=!f.value,f.value&&Gt(()=>P())}function be(){g.value=!g.value,g.value&&Gt(()=>Qe())}bt(()=>r.show,ae=>{var ie;ae||(i.value=!1,o.value="",h.value=null,l.value=!1,f.value=!1,g.value=!1),ae&&((ie=r.player)!=null&&ie.id)&&(Bi(r.player.id,r.seasonId).then(ke=>{U.value=!!ke}),en(()=>Promise.resolve().then(()=>zc),void 0).then(ke=>{try{L.value=!!ke.isPlayerPasswordCached(r.player.id)}catch{L.value=!1}}))}),pn(()=>{document.addEventListener("click",ae=>{if(f.value){const ie=v.value,ke=I.value,Z=ie&&ie.contains(ae.target),Q=ke&&ke.contains(ae.target);!Z&&!Q&&(f.value=!1)}if(g.value){const ie=A.value;ie&&ie.contains(ae.target)||(g.value=!1)}}),document.addEventListener("keydown",ae=>{ae.key==="Escape"&&(f.value&&(f.value=!1),g.value&&(g.value=!1))}),window.addEventListener("resize",()=>{f.value&&P(),g.value&&Qe()}),window.addEventListener("scroll",()=>{f.value&&P(),g.value&&Qe()},{passive:!0})}),e({openProtection(){l.value=!0}});const ne=C({position:null});return bt(()=>r.show,ae=>{ae&&r.onboardingStep===4?Gt(()=>{const ie=document.querySelectorAll("button");let ke=null;if(ie.forEach(Z=>{!ke&&Z.textContent&&Z.textContent.includes("Protection")&&(ke=Z)}),ke){const Z=ke.getBoundingClientRect();ne.value.position={x:Math.round(Z.right+8),y:Math.round(Z.top+window.scrollY-4)}}}):ae||(ne.value.position=null)}),(ae,ie)=>{var ke;return D(),O(it,null,[n.show?(D(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:$},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-xl max-h-[92vh] flex flex-col",onClick:ie[6]||(ie[6]=lt(()=>{},["stop"]))},[d("div",x5,[d("button",{onClick:$,class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},""),d("div",I5,[ie[15]||(ie[15]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"")],-1)),d("div",E5,[d("div",T5,[d("h2",A5,re((ke=n.player)==null?void 0:ke.name),1),d("div",S5,[n.isProtected?(D(),O("div",P5,ie[13]||(ie[13]=[d("span",{class:"text-yellow-400 text-sm"},"",-1),d("span",{class:"text-yellow-300 text-xs font-medium"},"Protg",-1)]))):ce("",!0),n.isPreferred?(D(),O("div",C5,ie[14]||(ie[14]=[d("span",{class:"text-purple-400 text-sm"},"",-1),d("span",{class:"text-purple-300 text-xs font-medium"},"Favori",-1)]))):ce("",!0)])])])])]),d("div",R5,[d("div",null,[d("div",k5,[d("div",D5,[d("div",N5,re(r.stats.availability),1),ie[16]||(ie[16]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibilits",-1))]),d("div",V5,[d("div",O5,re(r.stats.selection),1),ie[17]||(ie[17]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Slections",-1))]),d("div",M5,[d("div",L5,re(r.stats.ratio),1),ie[18]||(ie[18]=d("div",{class:"text-xs md:text-sm text-gray-300"},"% de slection",-1))])])]),d("div",$5,[d("button",{onClick:ie[0]||(ie[0]=Z=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},[d("span",null,re(U.value?"":""),1),d("span",null,re(U.value?"Dverrouiller":"Verrouiller"),1)]),d("div",{class:"relative",ref_key:"playerMoreActionsRef",ref:v},[d("button",{onClick:ie[1]||(ie[1]=Z=>nt()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},ie[19]||(ie[19]=[d("span",null,"",-1),d("span",null,"Plus",-1)]))],512),d("button",{onClick:$,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer "),(D(),$s(Bu,{to:"body"},[f.value?(D(),O("div",{key:0,ref_key:"playerMoreActionsDropdownRef",ref:I,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:br(T.value)},[d("button",{onClick:ie[2]||(ie[2]=Z=>{ue(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},ie[20]||(ie[20]=[d("span",null,"",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:ie[3]||(ie[3]=Z=>{x(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},ie[21]||(ie[21]=[d("span",null,"",-1),d("span",null,"Supprimer",-1)]))],4)):ce("",!0)]))])]),d("div",F5,[d("button",{onClick:ie[4]||(ie[4]=Z=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},re(U.value?" Dverrouiller":" Verrouiller"),1),d("button",{onClick:ie[5]||(ie[5]=Z=>be()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"  "),d("button",{onClick:$,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer ")])])])):ce("",!0),(D(),$s(Bu,{to:"body"},[g.value?(D(),O("div",{key:0,ref_key:"playerMoreActionsMobileDropdownRef",ref:A,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:br(F.value)},[d("button",{onClick:ie[7]||(ie[7]=Z=>{ue(),g.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},ie[22]||(ie[22]=[d("span",null,"",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:ie[8]||(ie[8]=Z=>{x(),g.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},ie[23]||(ie[23]=[d("span",null,"",-1),d("span",null,"Supprimer",-1)]))],4)):ce("",!0)])),i.value?(D(),O("div",U5,[d("div",j5,[ie[25]||(ie[25]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"}," Renommer le joueur",-1)),d("div",B5,[ie[24]||(ie[24]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),ut(d("input",{"onUpdate:modelValue":ie[9]||(ie[9]=Z=>o.value=Z),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[zn(se,["esc"]),zn(E,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[Ft,o.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:se,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:E,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ce("",!0),Ke(b5,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:ie[10]||(ie[10]=Z=>l.value=!1),onUpdate:M,onOnboardingFinished:ie[11]||(ie[11]=Z=>ae.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),Ke(Sv,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:ie[12]||(ie[12]=Z=>c.value=!1),onVerified:k},null,8,["show","player","seasonId"])],64)}}},z5=w5(q5,[["__scopeId","data-v-8237d7ee"]]),H5={class:"relative p-6 pb-4 border-b border-white/10"},K5={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},G5={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(D(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=lt(()=>{},["stop"]))},[d("div",H5,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},""),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},""),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la slection automatique ?"),d("p",{class:"text-sm text-blue-300"},"Tirage au sort pondr pour favoriser l'quit")])],-1))]),s[5]||(s[5]=Cn('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins jou</span> ont plus de chances d&#39;tre tirs.  long terme, tout le monde joue  peu prs autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Dtails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqus  Disponible pour lvnement.</li><li><span class="text-white">Un coup de pouce aux moins jous</span>: si vous avez moins jou rcemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de ct, puis on recommence jusqu avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span>: on garde les joueurs encore disponibles et on complte seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span>: ils ne sont jamais tirs au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>Lapplication peut afficher un pourcentage indicatif pour aider  comprendre: si Alice a moins jou que Bob, elle aura un pourcentage plus lev. Cest une indication, pas une promesse: deux tirages peuvent donner des rsultats diffrents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi cest juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins jou ont automatiquement plus de chances.</li><li>Aprs une slection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la dure, les slections s<span class="text-green-300">quilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p>  Alice na encore jamais t slectionne, Bob a t slectionn une fois, Charlie plusieurs fois. Pour 1 place, on aura environ: Alice 57%, Bob 29%, Charlie 14%.<br>  Sil y a 2 places, les chances de chacun augmentent, mais lordre reste alatoire: un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque: lalgorithme favorise lquit  long terme, mais <span class="text-gray-300">nassure pas</span> une rotation parfaite  chaque vnement. </div></div>',1)),d("div",K5,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ce("",!0)}},W5={class:"relative p-4 md:p-6 border-b border-white/10"},Q5={class:"flex items-start gap-4 md:gap-6"},J5={class:"flex-1 min-w-0"},Y5={class:"text-xl md:text-2xl font-bold text-white leading-tight mb-2"},X5={class:"flex items-center gap-3"},Z5={class:"text-base md:text-lg text-purple-300"},eU={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},tU={class:"text-blue-200"},nU={key:0,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm flex items-center gap-1",title:"Prt pour la slection"},rU={key:1,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded text-sm flex items-center gap-1",title:"Slection complte"},sU={key:2,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded text-sm flex items-center gap-1",title:"Slection incomplte"},iU={key:3,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded text-sm flex items-center gap-1",title:"Pas assez de joueurs disponibles"},oU={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},aU={class:"grid grid-cols-3 gap-3 md:gap-4 mb-4"},lU={class:"bg-gradient-to-r from-yellow-500/20 to-orange-500/20 p-3 md:p-4 rounded-lg border border-yellow-500/30 text-center"},uU={class:"text-xl md:text-2xl font-bold text-yellow-300"},cU={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},dU={class:"text-xl md:text-2xl font-bold text-white"},hU={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},fU={class:"text-xl md:text-2xl font-bold text-white"},pU={class:"mb-3"},mU={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},gU={key:0,class:"flex items-center justify-between gap-2"},vU=["title"],yU={key:0,class:"text-purple-400 mr-2"},_U={key:1,class:"text-green-400 mr-2"},bU={key:2,class:"text-red-400 mr-2"},wU={key:3,class:"text-gray-400 mr-2"},xU=["onClick"],IU={key:1,class:"flex items-center justify-center"},EU=["onChange"],TU=["value"],AU=["onClick"],SU={key:0,class:"mb-3"},PU={key:1,class:"mb-3"},CU={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},RU={class:"flex-1"},kU={class:"text-blue-300 text-sm font-medium"},DU={class:"sticky bottom-0 w-full p-3 bg-gray-900/80 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},NU=["disabled","title"],VU=["disabled"],OU={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-notifications","updateSelection"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=C(!1),o=C("Copier le message"),a=C(!1),l=C(!1),c=C(""),h=C(!1),f=C(!1),g=Fe(()=>{var Z;return((Z=r.event)==null?void 0:Z.playerCount)||6}),v=C([]),I=C(null),T=Fe(()=>(r.players||[]).map(Z=>Z.name).filter(Z=>{var Q;return((Q=r.playerAvailability)==null?void 0:Q[Z])===!0}).sort((Z,Q)=>Z.localeCompare(Q,"fr",{sensitivity:"base"})));function A(Z){const Q=new Set(v.value.filter(Boolean)),Ee=v.value[Z];return Ee&&Q.delete(Ee),T.value.filter(Je=>!Q.has(Je))}function F(Z){I.value=Z}function U(){I.value=null}async function L(Z,Q){var Je;const Ee=((Je=Z==null?void 0:Z.target)==null?void 0:Je.value)||"";Ee&&(v.value[Q]=Ee,await M()),I.value=null}async function $(Z){v.value[Z]=null,await M()}Fe(()=>(A(-1).length<g.value,""));const ue=Fe(()=>r.currentSelection&&r.currentSelection.length>0);function se(){var Je;const Z=r.currentSelection||[],Q=((Je=r.event)==null?void 0:Je.playerCount)||6,Ee=r.availableCount||0;if(Z.length>0){const ct=Z.some(X=>!nt(X)),Ot=Ee<Q;if(ct||Ot)return{type:"incomplete",hasUnavailablePlayers:ct,hasInsufficientPlayers:Ot,unavailablePlayers:Z.filter(X=>!nt(X)),availableCount:Ee,requiredCount:Q}}return Ee<Q?{type:"insufficient",availableCount:Ee,requiredCount:Q}:Z.length===0?{type:"ready",availableCount:Ee,requiredCount:Q}:{type:"complete",availableCount:Ee,requiredCount:Q}}const E=Fe(()=>{var Je;if(!ue.value)return!1;const Z=r.currentSelection.some(ct=>!nt(ct)),Q=((Je=r.event)==null?void 0:Je.playerCount)||6,Ee=r.availableCount<Q;return Z||Ee});Fe(()=>{var Ee;if(!E.value)return"";const Z=r.currentSelection.filter(Je=>!nt(Je)),Q=((Ee=r.event)==null?void 0:Ee.playerCount)||6;return Z.length>0?Z.length===1?`${Z[0]} n'est plus disponible. Veuillez relancer la slection.`:`${Z.length} joueurs ne sont plus disponibles. Veuillez relancer la slection.`:r.availableCount<Q?`Seulement ${r.availableCount} joueurs disponibles pour ${Q} requis. Veuillez attendre plus de disponibilits ou ajuster le nombre de joueurs  slectionner.`:"Slection incomplte"}),Fe(()=>{if(!r.event||!ue.value)return"";const Z=_(r.event.date),Q=r.currentSelection.join(", ");return`Slection pour ${r.event.title} du ${Z} : ${Q}`}),bt(()=>r.show,Z=>{if(Z){i.value=!1,o.value="Copier le message",l.value=!1,c.value="",h.value=!1,a.value=!1;const Q=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Ee=g.value;v.value=Array.from({length:Ee},(Je,ct)=>Q[ct]||null),I.value=null}}),bt([g,()=>r.currentSelection,()=>{var Z;return(Z=r.event)==null?void 0:Z.id}],()=>{if(!r.show)return;const Z=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Q=g.value,Ee=Array.from({length:Q},(Je,ct)=>Z[ct]||v.value[ct]||null);v.value=Ee.slice(0,Q)});function _(Z){var Ee;return Z?(typeof Z=="string"?new Date(Z):((Ee=Z.toDate)==null?void 0:Ee.call(Z))||Z).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function x(){s("selection")}function R(){s("perfect")}async function M(){var Z;if(!(!((Z=r.event)!=null&&Z.id)||!r.seasonId))try{const Q=v.value.filter(Boolean);await wm(r.event.id,Q,r.seasonId),console.debug("Slection sauvegarde automatiquement")}catch(Q){console.error("Erreur lors de la sauvegarde automatique:",Q)}}function k(){s("close")}function P(){a.value=!0}function Qe(){f.value=!0}function nt(Z){return r.playerAvailability[Z]===!0}function be(Z){return r.playerAvailability[Z]===!1}function ne(Z){return r.currentSelection.includes(Z)&&nt(Z)}function ae(Z=!1,Q=!1){if(h.value=Z,Z){const Ee=_(r.event.date),Je=r.currentSelection.join(", ");Q?c.value=`Slection mise  jour pour ${r.event.title} du ${Ee} : ${Je}. Pensez  prvenir les joueurs via le bouton "Annoncer" !`:c.value=`Nouvelle slection pour ${r.event.title} du ${Ee} : ${Je}. Pensez  prvenir les joueurs via le bouton "Annoncer" !`}else c.value="Slection effectue avec succs !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function ie(){l.value=!1}e({showSuccess:ae});function ke(Z){s("send-notifications",Z)}return(Z,Q)=>{var Ee,Je,ct,Ot;return D(),O(it,null,[n.show?(D(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:k},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:Q[1]||(Q[1]=lt(()=>{},["stop"]))},[d("div",W5,[d("button",{onClick:k,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},""),d("div",Q5,[Q[9]||(Q[9]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"")],-1)),d("div",J5,[d("h2",Y5,"Slection pour "+re((Ee=n.event)==null?void 0:Ee.title),1),d("div",X5,[d("p",Z5,re(_((Je=n.event)==null?void 0:Je.date)),1),d("div",eU,[Q[4]||(Q[4]=d("span",{class:"text-blue-300"},"",-1)),d("span",tU,re(((ct=n.event)==null?void 0:ct.playerCount)||6)+" joueurs",1)]),se().type==="ready"?(D(),O("div",nU,Q[5]||(Q[5]=[d("span",{class:"text-blue-300 text-xs"},"",-1),d("span",{class:"text-blue-200 text-xs"},"Nouveau",-1)]))):se().type==="complete"?(D(),O("div",rU,Q[6]||(Q[6]=[d("span",{class:"text-green-300 text-xs"},"",-1),d("span",{class:"text-green-200 text-xs"},"Complet",-1)]))):se().type==="incomplete"?(D(),O("div",sU,Q[7]||(Q[7]=[d("span",{class:"text-orange-300 text-xs"},"",-1),d("span",{class:"text-orange-200 text-xs"}," finaliser",-1)]))):se().type==="insufficient"?(D(),O("div",iU,Q[8]||(Q[8]=[d("span",{class:"text-red-300 text-xs"},"",-1),d("span",{class:"text-red-200 text-xs"},"Manque",-1)]))):ce("",!0)])])])]),d("div",oU,[d("div",aU,[d("div",lU,[d("div",uU,re(Math.max((((Ot=n.event)==null?void 0:Ot.playerCount)||6)-n.selectedCount,0)),1),Q[10]||(Q[10]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))]),d("div",cU,[d("div",dU,re(n.availableCount),1),Q[11]||(Q[11]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",hU,[d("div",fU,re(n.selectedCount),1),Q[12]||(Q[12]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Slectionns",-1))])]),d("div",pU,[d("div",{class:"flex items-center gap-2 mb-2"},[Q[14]||(Q[14]=d("h3",{class:"text-base md:text-lg font-semibold text-white"},"Joueurs slectionns",-1)),d("button",{onClick:Qe,class:"text-blue-300 hover:text-blue-200 p-1 rounded-full hover:bg-blue-500/10 transition-colors",title:"Comment fonctionne la slection automatique ?"},Q[13]||(Q[13]=[d("span",{class:"text-sm"},"",-1)]))]),d("div",mU,[(D(!0),O(it,null,wr(v.value,(X,Ae)=>(D(),O("div",{key:"sel-slot-"+Ae,class:Qt(["relative p-3 rounded-lg border text-center transition-colors",X?["bg-gradient-to-r",be(X)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":nt(X)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[X?(D(),O("div",gU,[d("div",{class:"flex-1 text-white font-medium truncate",title:X},[ne(X)?(D(),O("span",yU,"")):nt(X)?(D(),O("span",_U,"")):be(X)?(D(),O("span",bU,"")):(D(),O("span",wU,"")),St(" "+re(X),1)],8,vU),d("button",{onClick:xe=>$(Ae),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer ce joueur"},"  ",8,xU)])):(D(),O("div",IU,[I.value===Ae?(D(),O("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:xe=>L(xe,Ae),onBlur:Q[0]||(Q[0]=xe=>U())},[Q[15]||(Q[15]=d("option",{value:""}," Choisir ",-1)),(D(!0),O(it,null,wr(A(Ae),xe=>(D(),O("option",{key:xe,value:xe},re(xe),9,TU))),128))],40,EU)):(D(),O("button",{key:1,onClick:xe=>F(Ae),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter un joueur"},Q[16]||(Q[16]=[d("span",{class:"text-lg"},"",-1),d("span",{class:"text-sm"},"Ajouter",-1)]),8,AU))]))],2))),128))])]),ue.value?(D(),O("div",SU,Q[17]||(Q[17]=[d("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[d("div",{class:"text-yellow-400"},""),d("div",{class:"text-yellow-200 text-sm"},"Pensez  prvenir les gens de vos changements !")],-1)]))):ce("",!0),l.value?(D(),O("div",PU,[d("div",CU,[Q[19]||(Q[19]=d("div",{class:"text-blue-400 text-xl"},"",-1)),d("div",RU,[d("p",kU,re(c.value),1)]),d("button",{onClick:ie,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},Q[18]||(Q[18]=[d("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):ce("",!0)]),d("div",DU,[d("button",{onClick:x,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":ue.value?"Relancer la slection automatique":"Lancer la slection automatique"},Q[20]||(Q[20]=[St("  "),d("span",{class:"hidden sm:inline"},"Slection Auto",-1),d("span",{class:"sm:hidden"},"Auto",-1)]),8,NU),d("button",{onClick:P,disabled:!ue.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},Q[21]||(Q[21]=[St("  "),d("span",{class:"hidden sm:inline"},"Annoncer",-1),d("span",{class:"sm:hidden"},"Annoncer",-1)]),8,VU),d("button",{onClick:R,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 whitespace-nowrap"},Q[22]||(Q[22]=[d("span",{class:"hidden sm:inline"},"Fermer",-1),d("span",{class:"sm:hidden"},"Fermer",-1)]))])])])):ce("",!0),Ke(uA,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:Q[2]||(Q[2]=X=>a.value=!1),onSendNotifications:ke},null,8,["show","event","season-id","season-slug","players","selected-players"]),Ke(G5,{show:f.value,onClose:Q[3]||(Q[3]=X=>f.value=!1)},null,8,["show"])],64)}}},MU={class:"flex items-center justify-center"},LU=["title"],$U={key:0,class:"text-center"},FU={key:1,class:"text-center"},UU={key:2,class:"text-center"},jU={key:3,class:"text-center text-gray-400"},ib={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},compact:{type:Boolean,default:!1},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=C(!1),i=Fe(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=Fe(()=>t.disabled?"vnement archiv  dsarchivez pour modifier":t.isSelected&&t.isAvailable===!0?i.value?`${t.playerName} est slectionn pour cet vnement  avait ~${t.chancePercent}% de chances`:`${t.playerName} est slectionn pour cet vnement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible  ~${t.chancePercent}% de chances d'tre slectionn`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilit de ${t.playerName}`);function a(){t.disabled||r("toggle",t.playerName,t.eventId)}return(l,c)=>(D(),O("div",{class:Qt(["flex items-center justify-center transition-all duration-200 rounded font-medium text-white mx-0.5 my-0.25",[n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer hover:scale-105",n.compact?"min-h-0 p-1 md:p-2 text-xs":"min-h-20 p-2 md:p-3 text-sm",n.isSelected&&n.isAvailable===!0?"bg-gradient-to-br from-purple-500/60 to-pink-500/60":"",!n.isSelected&&n.isAvailable===!0?"bg-green-500/60":"",n.isAvailable===!1?"bg-red-500/60":"",n.isAvailable===null||n.isAvailable===void 0?"bg-gray-500/40":""]]),onClick:a,onMouseenter:c[0]||(c[0]=h=>s.value=!0),onMouseleave:c[1]||(c[1]=h=>s.value=!1)},[d("div",MU,[i.value&&s.value?(D(),O("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},re(n.chancePercent)+"% ",9,LU)):(D(),O(it,{key:1},[n.isSelected&&n.isAvailable===!0?(D(),O("span",$U," Joue ")):n.isAvailable===!0?(D(),O("span",FU," Disponible ")):n.isAvailable===!1?(D(),O("span",UU," Pas disponible ")):(D(),O("span",jU,"  "))],64))])],34))}},BU={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},qU={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},zU={class:"text-2xl md:text-3xl font-bold text-white mb-3"},HU={class:"text-gray-300 mb-6"},KU={class:"flex flex-col items-stretch justify-center gap-3"},GU=["value"],WU={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=Fe(()=>`${s}/season/${t.seasonSlug}`),o=C(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=Fe(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=Fe(()=>a.value>0),c=C(l.value);bt(a,A=>{c.value=A>0});const h=Fe(()=>{switch(a.value){case 1:return"Commenons par crer votre premier vnement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y tes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=Fe(()=>{switch(a.value){case 1:return"Un titre, une date... et cest parti.";case 2:return"Ajoutez au moins un joueur pour commencer  saisir des disponibilits.";case 3:return"Laissez vos membres sinscrire eux-mme et indiquer leurs disponibilits en leur envoyant le lien direct.";default:return""}});function g(){c.value=!1,r("create-event")}function v(){c.value=!1,r("add-player")}function I(){var A;try{(A=navigator.clipboard)==null||A.writeText(i.value)}catch{}r("copy-link")}async function T(){try{if(t.seasonId){const{db:A}=await en(()=>Promise.resolve().then(()=>ji),void 0),{doc:F,updateDoc:U}=await en(()=>import("./index.esm-5f613cf2.js"),[]);await U(F(A,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(A,F)=>l.value&&c.value?(D(),O("div",BU,[d("div",qU,[F[1]||(F[1]=d("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-3xl"},"")],-1)),d("h2",zU,re(h.value),1),d("p",HU,re(f.value),1),d("div",KU,[a.value===1?(D(),O("button",{key:0,onClick:g,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"},"  Crer un vnement ")):a.value===2?(D(),O("button",{key:1,onClick:v,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"},"  Ajouter un joueur ")):a.value===3?(D(),O(it,{key:2},[d("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:F[0]||(F[0]=U=>U.target.select())},null,40,GU),d("div",{class:"flex gap-3 justify-center"},[d("button",{onClick:I,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"},"  Copier le lien "),d("button",{onClick:T,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," Jai compris ")])],64)):ce("",!0)])])])):ce("",!0)}},QU={class:"sticky top-0 z-[60] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},JU={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},YU={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},XU={class:"hidden md:flex items-center gap-2"},ZU={class:"md:hidden"},ej={__name:"SeasonHeader",props:{seasonName:{type:String,default:""},isScrolled:{type:Boolean,default:!1}},emits:["go-back","open-account-menu","open-help","open-notifications","open-players","logout","open-login","open-account"],setup(n,{emit:e}){const t=n,r=e,s=C(null),i=Fe(()=>{var T;return!!s.value&&!((T=s.value)!=null&&T.isAnonymous)}),o=Fe(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");function a(T){s.value=T}pn(()=>{s.value=Ge.currentUser;const T=Ge.onAuthStateChanged(a);window._seasonHeaderUnsubscribe=T}),Ls(()=>{window._seasonHeaderUnsubscribe&&(window._seasonHeaderUnsubscribe(),delete window._seasonHeaderUnsubscribe)});function l(){r("go-back")}function c(){r("open-account-menu")}function h(){r("open-login")}function f(){r("open-help")}function g(){r("open-notifications")}function v(){r("open-players")}function I(){r("logout")}return(T,A)=>(D(),O("div",QU,[d("button",{onClick:l,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour aux saisons"},A[0]||(A[0]=[d("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),d("h1",JU,re(n.seasonName?n.seasonName:"Chargement..."),1),d("div",YU,[d("div",XU,[Ke(bm,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:c,onOpenHelp:f,onOpenNotifications:g,onOpenPlayers:v,onLogout:I,onOpenLogin:h},null,8,["is-connected","button-class"]),i.value?ce("",!0):(D(),O("button",{key:0,onClick:f,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},A[1]||(A[1]=[d("span",{class:"text-2xl"},"",-1)])))]),d("div",ZU,[Ke(bm,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:c,onOpenHelp:f,onOpenNotifications:g,onOpenPlayers:v,onLogout:I,onOpenLogin:h},null,8,["is-connected","button-class"])])])]))}};const tj={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},nj={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},rj={class:"flex items-stretch relative"},sj={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},ij={class:"flex-1 overflow-hidden"},oj=["data-event-id"],aj=["title","onClick"],lj={class:"flex flex-col items-center flex-1 justify-center"},uj={class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2 group-hover:text-purple-300 transition-colors duration-200"},cj={key:0,class:"mt-1 text-xs text-gray-400"},dj={class:"relative"},hj=["onClick","title"],fj={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},pj={class:"p-2"},mj=["onClick"],gj=["onClick"],vj=["onClick"],yj={class:"flex flex-col items-center mt-2"},_j={key:0,class:"px-2 py-1 bg-gray-500/20 border border-gray-400/30 rounded-md mx-auto flex items-center justify-center",title:"vnement archiv"},bj=["title","onClick"],wj=["title","onClick"],xj=["title","onClick"],Ij=["title","onClick"],Ej=["title","aria-label"],Tj={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Aj={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},Sj={key:0,class:"pointer-events-none"},Pj={class:"flex items-center justify-between"},Cj={key:1,class:"pointer-events-none"},Rj={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},kj={class:"flex items-center justify-between"},Dj={key:2,class:"pointer-events-none"},Nj={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},Vj={class:"flex items-center justify-between"},Oj={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},Mj=["data-player-id"],Lj={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},$j={class:"px-4 md:px-5 font-bold text-xl md:text-2xl flex items-center w-full min-w-0"},Fj={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Mon joueur"},Uj={key:1,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protg par mot de passe"},jj=["onClick","title"],Bj={class:"group-hover:text-purple-300 transition-colors duration-200"},qj=["data-event-id"],zj={class:"border-t border-white/10"},Hj={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},Kj={class:"px-4 md:px-5 flex items-center"},Gj=["data-event-id"],Wj={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},Qj={class:"text-center"},Jj={class:"text-white text-lg"},Yj={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},Xj={class:"text-white/60 text-xs mt-2"},Zj={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},eB={class:"flex items-center space-x-2"},tB={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},nB={class:"flex items-center space-x-2"},rB={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},sB={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},iB={class:"mb-6"},oB={class:"mb-6"},aB={class:"mb-6"},lB={class:"mb-6 flex items-center gap-3"},uB={class:"mb-6"},cB={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},dB={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},hB={class:"mb-6"},fB={class:"flex justify-end space-x-3"},pB={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},mB={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},gB={class:"flex justify-end space-x-3"},vB={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},yB={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},_B={class:"flex justify-end space-x-3"},bB={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},wB={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},xB={class:"text-center mb-6"},IB={class:"text-gray-300"},EB={key:0},TB={key:1},AB={class:"relative p-4 md:p-6 border-b border-white/10"},SB={class:"flex items-start gap-4 md:gap-6"},PB={class:"flex-1 min-w-0"},CB={class:"flex items-center gap-3 mb-2"},RB={class:"text-xl md:text-2xl font-bold text-white leading-tight"},kB={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},DB={class:"text-blue-200"},NB={class:"flex items-center gap-3 mb-3"},VB={class:"text-base md:text-lg text-purple-300"},OB={class:"relative"},MB={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},LB={class:"p-2"},$B={key:0,class:"text-sm text-gray-300 bg-gray-800/30 p-3 rounded-lg border border-gray-600/30"},FB={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},UB={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},jB={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},BB={class:"text-xl md:text-2xl font-bold text-white"},qB={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},zB={class:"text-xl md:text-2xl font-bold text-white"},HB={class:"p-3 md:p-4 rounded-lg border border-yellow-500/30 bg-yellow-500/10 text-center"},KB={class:"text-xl md:text-2xl font-bold text-yellow-300"},GB={key:0,class:"mb-4 md:mb-6"},WB={class:"mb-3 flex items-center"},QB=["title"],JB={class:"truncate"},YB={class:"space-y-0.5"},XB={class:"flex items-center min-w-0 gap-1.5"},ZB={key:0,class:"text-yellow-400 mr-1 text-xs",title:"Mon joueur"},eq={key:1,class:"text-yellow-400 mr-1 text-xs",title:"Joueur protg par mot de passe"},tq=["title"],nq={class:"flex-0 p-0"},rq={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},sq=["disabled","title"],iq=["title"],oq={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},aq=["disabled","title"],lq={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},uq={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},cq={class:"mb-6"},dq={class:"mb-6"},hq={class:"mb-6"},fq={class:"mb-6 flex items-center gap-3"},pq={class:"mb-6"},mq={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},gq={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},vq={class:"mb-6"},yq={class:"space-y-4"},_q=["disabled"],bq={key:0,class:"animate-spin"},wq={key:1},xq={class:"mb-6 text-center"},Iq={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Eq={class:"text-red-300 text-sm"},Tq={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},Aq={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},Sq={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},Pq={class:"space-y-4"},Cq={class:"mt-2 text-center"},Rq={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},kq={class:"text-red-300 text-sm"},Dq={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},Nq=["disabled"],Vq={key:0,class:"animate-spin"},Oq={key:1},Mq={class:"mb-6"},Lq=["disabled"],$q={key:0,class:"animate-spin"},Fq={key:1},Uq={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},jq={class:"text-red-300 text-sm"},Bq={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},qq={class:"text-green-300 text-sm"},zq={class:"flex justify-center"},Hq={class:"mb-6"},Kq=["disabled"],Gq={key:0,class:"animate-spin"},Wq={key:1},Qq={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Jq={class:"text-red-300 text-sm"},Yq={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},Xq={class:"text-green-300 text-sm"},Zq={class:"flex justify-center"},e9={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},t9={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},n9={class:"flex gap-3"},ob={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=Fl(),r=fa(),s=e.slug,i=C(""),o=C(""),a=C({}),l=C(!1),c=C(!1),h=C(null),f=C(null),g=C(""),v=C(""),I=C(6),T=C(!1),A=C(""),F=C(null),U=C(null),L=C(null),$=C({position:null,side:null}),ue=C({position:null}),se=C({position:null}),E=C(!1),_=C(null),x=C(!1),R=C(null),M=C(null),k=C(!1),P=C(null),Qe=C(""),nt=C(!1),be=C(null),ne=C(""),ae=C(""),ie=C(!1),ke=C(null),Z=C(!1),Q=C(null),Ee=C(""),Je=C(""),ct=C(!1),Ot=C(null),X=C(!1),Ae=C(!1),xe=C(""),Ve=C(""),rt=C(!1),dt=C(!1),S=C(""),N=C(""),K=C(!1),G=C(null),te=C(""),de=C(!1),we=C(!1),_e=C(!1),Ie=C(null),ye=C(null),$e=C({position:"fixed",top:"0px",left:"0px"}),Re=C(null),q=C({position:"fixed",top:"0px",left:"0px"}),j=C(null),ge=C(!1);function he(){try{const b=Ie.value;if(!b)return;const m=b.getBoundingClientRect(),V=8;if(window.innerWidth>768){const ee=Math.max(V,Math.round(m.top-V)),oe=Math.max(V,Math.round(m.left));$e.value={position:"fixed",top:`${ee}px`,left:`${oe}px`,zIndex:400}}else{const ee=Math.min(window.innerHeight-V,Math.round(m.bottom+V)),oe=Math.max(V,Math.round(m.left));$e.value={position:"fixed",top:`${ee}px`,left:`${oe}px`,zIndex:400}}}catch{}}function De(){try{const ee=Math.max(8,window.innerHeight-8-48-200),oe=Math.max(8,Math.round(window.innerWidth-200-8));q.value={position:"fixed",top:`${ee}px`,left:`${oe}px`,zIndex:400}}catch{}}function We(){_e.value=!_e.value,_e.value&&Gt(()=>he())}function Ze(){we.value=!we.value,we.value&&Gt(()=>De())}function gt(b){j.value===b?j.value=null:j.value=b}function Mt(){j.value=null}function Er(){ge.value=!ge.value}function Tr(){ge.value=!1}const Lt=C(!1),Bt=C(null),jn=C(null),Ar=C(null),Xt=C(0);function pa(){var b;try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||He.value.length===0)return;const m=localStorage.getItem(`playerTourCompleted:${o.value}`);try{const ee=((b=Ge==null?void 0:Ge.currentUser)==null?void 0:b.email)||"";ee&&Af(ee).then(async oe=>{const ve=oe.filter(fe=>fe.seasonId===o.value);if(ve.length>0){const fe=`seasonPreferredPlayer:${o.value}`,Me=localStorage.getItem(fe);let Xe=[];if(Me)if(Me.startsWith("["))try{Xe=JSON.parse(Me)||[]}catch{}else Xe=[Me];const at=new Set(Xe);ve.forEach(Zt=>at.add(Zt.playerId));const It=Array.from(at);localStorage.setItem(fe,JSON.stringify(It))}}).catch(()=>{})}catch{}const V=localStorage.getItem(`startPlayerTour:${o.value}`);!m&&V&&(Xt.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`),Gt(()=>{const ee=document.querySelector('button[data-onboarding="add-player"]');if(ee){ee.scrollIntoView({behavior:"smooth",block:"end"});const oe=ee.getBoundingClientRect(),ve=document.getElementById("coachmark-add"),fe=280,Me=100,Xe=(ve==null?void 0:ve.offsetWidth)||fe,at=(ve==null?void 0:ve.offsetHeight)||Me,It=Math.round(oe.right+12);if(It+Xe<=window.innerWidth-12){const cn=oe.top+oe.height/2-at/2,dn=-14,Et=12,_r=window.innerHeight-at-12,Fr=Math.max(Et,Math.min(Math.round(cn+dn),_r));$.value={position:{x:It,y:Fr},side:"right"}}else{const cn=Math.round(oe.left+oe.width/2-Xe/2),dn=Math.round(oe.top-at-8),Et=8,_r=window.innerWidth-Xe-8;$.value={position:{x:Math.max(Et,Math.min(cn,_r)),y:dn},side:null}}}}))}catch{}}const Bn=C(!1),Nn=C(null),ps=C(null),Or=C(!1),lo=C(null),ms=C(!1),uo=C(null),gs=C(!1),vs=C(!1),bn=C(!1),co=C(!1),ys=C(!1),_s=C(!1),Hc=C(null);function Sf(){vs.value=!0}function Wr(){vs.value=!1}function Pf(){ys.value=!0}function Cf(){ys.value=!1}function ma(){_s.value=!0}function Kc(){_s.value=!1}function ga(){try{const b=Ge==null?void 0:Ge.currentUser;if(!b||b.isAnonymous){let m=null;if(es.value&&es.value.size>0){const V=es.value.values().next().value;m=ot.value.find(ee=>ee.id===V)||null}m||(m=ot.value[0]||null),co.value=!0,m&&(Hc.value=m);return}}catch{}vs.value=!0}async function va(){var b;try{const m=(b=Ge==null?void 0:Ge.currentUser)==null?void 0:b.email;if(!m)return;const{resetPlayerPassword:V}=await en(()=>Promise.resolve().then(()=>ji),void 0);await V(m),Ue.value=!0,vt.value="Email de rinitialisation envoy.",setTimeout(()=>{Ue.value=!1},3e3)}catch{gr.value=!0,ci.value="Impossible d'envoyer l'email de rinitialisation.",setTimeout(()=>{gr.value=!1},3e3)}}async function Mr(){try{await cO(Ge),Wr(),Ue.value=!0,vt.value="Dconnect de cet appareil.",setTimeout(()=>{Ue.value=!1},2500)}catch{gr.value=!0,ci.value="Dconnexion impossible.",setTimeout(()=>{gr.value=!1},3e3)}}async function Gc(){alert("Suppression de compte: contactez l'organisateur pour dissocier vos joueurs. Fonction complte  venir.")}async function Bl(b){var m;Wr();try{if(b.seasonId&&b.seasonId!==o.value){const V=Pe(le,"seasons",b.seasonId),oe=(await Pt(tt(le,"seasons"))).docs.find(fe=>fe.id===b.seasonId),ve=(m=oe==null?void 0:oe.data())==null?void 0:m.slug;if(ve){t.push(`/season/${ve}?player=${encodeURIComponent(b.playerId)}&open=protection`);return}}else{const V=ot.value.find(ee=>ee.id===b.playerId);if(V){Nf(V);return}t.push(`?player=${encodeURIComponent(b.playerId)}&open=protection`)}}catch{}}pn(()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}const b=()=>{l.value=window.scrollY>10};return window.addEventListener("scroll",b,{passive:!0}),document.addEventListener("click",m=>{if(_e.value){const V=Ie.value,ee=ye.value,oe=V&&V.contains(m.target),ve=ee&&ee.contains(m.target);!oe&&!ve&&(_e.value=!1)}if(we.value){const V=Re.value;V&&V.contains(m.target)||(we.value=!1)}}),document.addEventListener("keydown",m=>{m.key==="Escape"&&(_e.value&&(_e.value=!1),we.value&&(we.value=!1))}),window.addEventListener("resize",()=>{_e.value&&he(),we.value&&De()}),window.addEventListener("scroll",()=>{_e.value&&he(),we.value&&De()},{passive:!0}),()=>{window.removeEventListener("scroll",b)}});function ql(){Gt(()=>{Kl()})}const Sr=C(new Set),Qr=C(!0),Lr=C(0),ii=C("Prparation de la grille"),pr=C(e.eventId||null),zl=C(!1),oi=C(null);bt(()=>e.eventId,b=>{if(b)if(pr.value=b,He.value.length>0)Mv(b);else{const m=bt(He,V=>{V.length>0&&(Mv(b),m())},{immediate:!0})}});const $r=Fe(()=>ot.value.map(b=>({...b,isProtected:Sr.value.has(b.id),email:null}))),bs=Fe(()=>pr.value?un.value.findIndex(b=>b.id===pr.value):-1);Fe(()=>{if(!pr.value||bs.value===-1)return!1;if(window.innerWidth<=768){const b=document.querySelector(`[data-event-id="${pr.value}"]`);if(b){const m=b.getBoundingClientRect();return m.left>=0&&m.right<=window.innerWidth}}return!0});const rr=C(null),Wc=C(!1),Hl=C(!1),ya=C(0),Qc=C(null),Vn=C(null),ai=C(null);function mr(){const b=rr.value;if(!b)return;const{scrollLeft:m,scrollWidth:V,clientWidth:ee}=b;Wc.value=m>2,Hl.value=m<V-ee-2}function Kl(){var b;try{mr(),ya.value=((b=rr.value)==null?void 0:b.scrollLeft)||0}catch{}}function Jc(b){const m=rr.value;if(!m)return;let V=0;const ee=m.querySelector("tbody tr td[data-event-id]");if(ee)V=ee.getBoundingClientRect().width;else if(Vn!=null&&Vn.value){const ve=Vn.value.querySelector(".col-event");ve&&(V=ve.getBoundingClientRect().width)}(!V||!isFinite(V))&&(V=m.clientWidth*.6);const oe=m.scrollLeft+b*V;m.scrollTo({left:oe,behavior:"smooth"})}const ho=C(null);C(0);const li=C(!1),fo=C(!1),ui=C(0);function Jr(b,m){m&&typeof m.preventDefault=="function"&&m.preventDefault(),ir(),Jc(b)}function sr(b,m){if(m&&typeof m.preventDefault=="function"&&m.preventDefault(),li.value)return;li.value=!0,ui.value=b,fo.value=!1;const V=rr.value;if(!V)return;let ee=0;const oe=V.querySelector("tbody tr td[data-event-id]");if(oe)ee=oe.getBoundingClientRect().width;else if(Vn!=null&&Vn.value){const Xe=Vn.value.querySelector(".col-event");Xe&&(ee=Xe.getBoundingClientRect().width)}(!ee||!isFinite(ee))&&(ee=V.clientWidth*.6);const ve=ee/6,fe=120,Me=()=>{if(!li.value||ui.value===0)return;fo.value||(fo.value=!0);const Xe=V.scrollLeft+ui.value*ve;V.scrollTo({left:Xe,behavior:"auto"}),ho.value=window.setTimeout(Me,fe)};ho.value=window.setTimeout(Me,250)}function ir(b){b&&typeof b.preventDefault=="function"&&b.preventDefault();const m=li.value,V=fo.value;if(li.value=!1,ho.value&&(clearTimeout(ho.value),ho.value=null),b&&typeof b.type=="string"&&b.type.startsWith("touch")&&!V){const ee=ui.value||0;ee!==0&&Jc(ee),ui.value=0;return}ui.value=0,m&&V&&_a()}function _a(){const b=rr.value;if(!b)return;let m=0;const V=b.querySelector("tbody tr td[data-event-id]");if(V)m=V.getBoundingClientRect().width;else if(Vn!=null&&Vn.value){const fe=Vn.value.querySelector(".col-event");fe&&(m=fe.getBoundingClientRect().width)}if(!m||!isFinite(m)||m<=0)return;const ee=b.scrollLeft,ve=Math.round(ee/m)*m;b.scrollTo({left:ve,behavior:"smooth"})}function Yc(b){F.value=b;const m=document.querySelector(`[data-player-id="${b}"]`);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),Ue.value=!0,vt.value="Nouveau joueur ajout !",setTimeout(()=>{Ue.value=!1},3e3)}function kt(){if(Xt.value!==1)return;const b=document.querySelector('button[data-onboarding="add-player"]');if(!b)return;const m=b.getBoundingClientRect(),V=document.getElementById("coachmark-add"),ee=280,oe=100,ve=V!=null&&V.offsetWidth&&V.offsetWidth>0?V.offsetWidth:ee,fe=V!=null&&V.offsetHeight&&V.offsetHeight>0?V.offsetHeight:oe,Me=Math.round(m.right+12);if(Me+ve<=window.innerWidth-12){const at=m.top+m.height/2-fe/2,Zt=po(at+-14,fe);$.value={position:{x:Me,y:Zt},side:"right"}}else{const at=Math.round(m.left+m.width/2-ve/2),It=po(m.top-fe-8,fe),Zt=8,cn=window.innerWidth-ve-8;$.value={position:{x:Math.max(Zt,Math.min(at,cn)),y:It},side:null}}}function po(b,m){const V=pageHeaderRef==null?void 0:pageHeaderRef.value,ee=V?Math.max(0,Math.round(V.getBoundingClientRect().height||0)):0,oe=Math.max(12,ee+8),ve=window.innerHeight-m-12;return Math.max(oe,Math.min(Math.round(b),ve))}function Yr(){var b;Xt.value===1&&((b=$.value)!=null&&b.position)&&kt()}pn(()=>{window.addEventListener("scroll",Yr,{passive:!0}),window.addEventListener("resize",Yr)}),Ls(()=>{window.removeEventListener("scroll",Yr),window.removeEventListener("resize",Yr)});function Xr(b){return Sr.value.has(b)}async function Gl(){if(o.value)try{const b=await _m(o.value),m=new Set;b.forEach(V=>{V.isProtected&&m.add(V.playerId||V.id)}),Sr.value=m}catch{const m=new Set;for(const V of ot.value)await Bi(V.id,o.value)&&m.add(V.id);Sr.value=m}}const Ue=C(!1),vt=C(""),gr=C(!1),ci=C("");function Rf(){try{const b=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(b),Ue.value=!0,vt.value="Lien copi dans le presse-papiers",setTimeout(()=>{Ue.value=!1},2500)}catch{gr.value=!0,ci.value="Impossible de copier le lien",setTimeout(()=>{gr.value=!1},2500)}}async function di(b){await w({type:"deleteEvent",data:{eventId:b}})}async function Zr(b=null){const m=b||h.value;if(console.debug("deleteEventConfirmed"),!m){console.error("Aucun vnement  supprimer");return}try{await N$(m,o.value),He.value=He.value.filter(V=>V.id!==m),await Promise.all([Eh(o.value),No(ot.value,He.value,o.value),Vo(o.value)]).then(([V,ee,oe])=>{He.value=V,Kt.value=ee,ze.value=oe}),c.value=!1,h.value=null,Ue.value=!0,vt.value="vnement supprim avec succs !",setTimeout(()=>{Ue.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'vnement"),alert("Erreur lors de la suppression de l'vnement. Veuillez ressayer.")}}function Xc(){c.value=!1,h.value=null}async function ba(){if(!f.value||!g.value.trim()||!v.value)return;const b=parseInt(I.value);if(isNaN(b)||b<1||b>20){alert("Le nombre de joueurs doit tre un nombre entier entre 1 et 20");return}try{const m={title:g.value.trim(),date:v.value,description:te.value.trim()||"",playerCount:b,archived:!!de.value};await X_(f.value,m,o.value),!m.archived&&ot.value.length>0&&Sr.value.size>0&&(uo.value={id:f.value,...m},ms.value=!0),await Promise.all([Eh(o.value),No(ot.value,He.value,o.value),Vo(o.value)]).then(([V,ee,oe])=>{He.value=V,Kt.value=ee,ze.value=oe}),f.value=null,g.value="",v.value="",te.value="",I.value=6,de.value=!1,Ue.value=!0,vt.value="vnement mis  jour avec succs !",setTimeout(()=>{Ue.value=!1},3e3)}catch{console.error("Erreur lors de l'dition de l'vnement"),alert("Erreur lors de l'dition de l'vnement. Veuillez ressayer.")}}async function Zc(){if(A.value.trim())try{const b=A.value.trim(),m=await lA(b,o.value);await Promise.all([$u(o.value),No(ot.value,He.value,o.value),Vo(o.value)]).then(([V,ee,oe])=>{ot.value=V,Kt.value=ee,ze.value=oe,Gl();const ve=ot.value.find(Me=>Me.id===m);Yc(m),U.value=m,L.value=un.value&&un.value[0]&&un.value[0].id?un.value[0].id:null;try{o.value&&localStorage.setItem(`lastAddedPlayerId:${o.value}`,m)}catch{}try{typeof Xt<"u"&&(Xt.value=2)}catch{}const fe=document.querySelector(`[data-player-id="${m}"]`);fe&&fe.scrollIntoView({behavior:"smooth",block:"center"}),Gt(()=>{const Me=`[data-player-id="${U.value}"] td[data-event-id="${L.value}"]`,Xe=document.querySelector(Me);if(Xe){const at=Xe.getBoundingClientRect();ue.value.position={x:Math.round(at.left),y:Math.round(at.top+window.scrollY-48)}}}),Ue.value=!0,vt.value="Joueur ajout avec succs ! Vous pouvez maintenant indiquer sa disponibilit.",setTimeout(()=>{Ue.value=!1},3e3),setTimeout(()=>{Ue.value=!1,vt.value=""},5e3)}),T.value=!1,A.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez ressayer.")}}function Pr(){f.value=null,g.value="",v.value="",te.value="",I.value=6}C(null);const wa=C(!1),hi=C(""),fi=C(""),or=C(""),mo=C(6),xa=C(!1);async function Ia(){if(!hi.value.trim()||!fi.value){alert("Veuillez remplir le titre et la date de l'vnement");return}const b=parseInt(mo.value);if(isNaN(b)||b<1||b>20){alert("Le nombre de joueurs doit tre un nombre entier entre 1 et 20");return}const m={title:hi.value.trim(),date:fi.value,description:or.value.trim()||"",playerCount:b,archived:!!xa.value};await Ea(m)}async function Ea(b){try{const m=await V$(b,o.value);He.value=[...He.value,{id:m,...b}];const V={};for(const ee of ot.value)V[ee.name]=Kt.value[ee.name]||{},V[ee.name][m]=null,await Y_(ee.name,V[ee.name],o.value);hi.value="",fi.value="",or.value="",mo.value=6,xa.value=!1,wa.value=!1,await Promise.resolve(),Ue.value=!0,vt.value="vnement cr avec succs !",!b.archived&&ot.value.length>0&&Sr.value.size>0&&(uo.value={id:m,...b},ms.value=!0),setTimeout(()=>{Ue.value=!1},3e3)}catch{console.error("Erreur lors de la cration de l'vnement"),alert("Erreur lors de la cration de l'vnement. Veuillez ressayer.")}}function ed(){hi.value="",fi.value="",or.value="",mo.value=6,wa.value=!1}async function pi(){await w({type:"addEvent",data:{}})}const He=C([]),ot=C([]),Kt=C({}),ze=C({}),kf=C({}),Wl=C({});bt([()=>He.value.length,()=>ot.value.length,Qr],()=>{Qr.value||Gt(()=>{Kl()})}),bt([()=>ot.value.length,()=>He.value.length,o],()=>{pa()}),pn(async()=>{try{Av("firebase"),await aA();const m=uc(tt(le,"seasons"),gh("slug","==",e.slug)),V=await Pt(m);if(V.empty){t.push("/seasons");return}else{const fe=V.docs[0];o.value=fe.id;const Me=fe.data();i.value=Me.name,a.value=Me,document.title=`Saison : ${i.value}`,h4(e.slug)}if(o.value){ii.value="Chargement des vnements de la saison",Lr.value=20;const fe=await Pt(tt(le,"seasons",o.value,"events"));He.value=fe.docs.map(Et=>({id:Et.id,...Et.data(),playerCount:Et.data().playerCount||6})),ii.value="Chargement des joueurs",Lr.value=45;const Me=await Pt(tt(le,"seasons",o.value,"players"));ot.value=Me.docs.map(Et=>({id:Et.id,...Et.data()})),ii.value="Chargement des disponibilits",Lr.value=70;const Xe=await Pt(tt(le,"seasons",o.value,"availability")),at={};Xe.docs.forEach(Et=>{const _r=Et.data(),Fr={};Object.keys(_r).forEach(Eo=>{const Ra=_r[Eo];Fr[Eo]=Ra==="oui"?!0:Ra==="non"?!1:Ra}),at[Et.id]=Fr}),Kt.value=at,ii.value="Chargement des slections",Lr.value=85;const It=await Pt(tt(le,"seasons",o.value,"selections")),Zt={};It.docs.forEach(Et=>{Zt[Et.id]=Et.data().players||[]}),ze.value=Zt;const cn=await _m(o.value),dn=new Set;Array.isArray(cn)&&cn.forEach(Et=>{Et.isProtected&&dn.add(Et.playerId||Et.id)}),Sr.value=dn}const ee=fe=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>fe()):setTimeout(fe,0)};ii.value="Prparation de l'interface",Lr.value=95,ee(()=>{eu(),Pa()}),console.debug("players (deduplicated)"),console.debug("availability loaded"),await Gt(),Lr.value=100,Qr.value=!1,Gt(()=>{mr(),requestAnimationFrame(()=>mr()),setTimeout(()=>mr(),250);const fe=rr.value;fe&&(fe.addEventListener("scroll",Me=>{mr(),ya.value=fe.scrollLeft||0},{passive:!0}),window.addEventListener("resize",mr),typeof ResizeObserver<"u"&&(ai.value=new ResizeObserver(()=>{mr()}),ai.value.observe(fe)))});const oe=r.query.event;if(oe&&He.value.length>0){const fe=He.value.find(Me=>Me.id===oe);fe?(console.debug("vnement trouv depuis l'URL"),await Mf(oe,fe)):(console.warn("vnement non trouv avec l'ID"),gr.value=!0,ci.value="vnement non trouv",setTimeout(()=>{gr.value=!1},3e3))}const ve=r.query.player;if(ve&&ot.value.length>0){const fe=ot.value.find(Me=>Me.id===ve);fe&&(Nf(fe),await Gt(),r.query.verified==="1"&&(Ue.value=!0,vt.value="Joueur associ  votre compte.",setTimeout(()=>{Ue.value=!1},2500)))}}catch(b){console.error("Erreur lors du chargement de la grille:",b),gr.value=!0,ci.value="Erreur lors du chargement des donnes",setTimeout(()=>{gr.value=!1},5e3),Qr.value=!1}}),bt(()=>r.params.eventId,b=>{if(b){const m=()=>{const V=He.value.find(ee=>ee.id===b);return V?(Pv(V),!0):!1};if(He.value.length>0)m();else{const V=bt(He,ee=>{ee.length>0&&m()&&V()},{immediate:!0})}}},{immediate:!0});function Ql(b){if(!b)return null;if(b instanceof Date)return b;if(typeof(b==null?void 0:b.toDate)=="function")return b.toDate();if(typeof b=="string"||typeof b=="number"){const m=new Date(b);return isNaN(m.getTime())?null:m}return null}const ws=Fe(()=>{let b=null;try{o.value&&(b=localStorage.getItem(`seasonPreferredPlayer:${o.value}`))}catch{}const m=[...ot.value].sort((fe,Me)=>(fe.name||"").localeCompare(Me.name||"","fr",{sensitivity:"base"}));if(!b)return m;let V=[];try{b.startsWith("[")?V=JSON.parse(b):b&&(V=[b])}catch{V=[]}const ee=new Set(V);if(ee.size===0)return m;const oe=m.filter(fe=>ee.has(fe.id)),ve=m.filter(fe=>!ee.has(fe.id));return[...oe,...ve]}),es=Fe(()=>{try{if(o.value){const b=localStorage.getItem(`seasonPreferredPlayer:${o.value}`);if(!b)return new Set;if(b.startsWith("[")){const m=JSON.parse(b);return new Set(Array.isArray(m)?m:[])}return new Set([b])}}catch{}return new Set}),Ta=Fe(()=>[...He.value].sort((b,m)=>{const V=Ql(b.date),ee=Ql(m.date),oe=V?V.getTime():Number.POSITIVE_INFINITY,ve=ee?ee.getTime():Number.POSITIVE_INFINITY;return oe!==ve?oe-ve:(b.title||"").localeCompare(m.title||"","fr",{sensitivity:"base"})})),xs=C(!1),un=Fe(()=>{const b=Ta.value;return xs.value?b:b.filter(m=>!m.archived)});function td(){xs.value=!xs.value}const Jl=C("selected"),go=Fe(()=>{var V;if(!G.value)return ws.value;const b=G.value.id,m=new Set(((V=ze.value)==null?void 0:V[b])||[]);return ws.value.filter(ee=>{var Me;const oe=ee.name,ve=(Me=Kt.value[oe])==null?void 0:Me[b],fe=m.has(oe);switch(Jl.value){case"selected":return fe;case"available":return ve===!0&&!fe;case"unavailable":return ve===!1;case"unknown":return ve!==!0&&ve!==!1;case"all":default:return!0}})}),nd=Fe(()=>G.value?xo(G.value.id):null),Yl=Fe(()=>{if(!G.value)return!1;const b=xo(G.value.id);return b.type==="incomplete"||b.type==="insufficient"}),vo=Fe(()=>G.value?nu(G.value.id):"");async function yo(b,m){const V=ot.value.find(ve=>ve.name===b);if(!V){console.error("Joueur non trouv");return}const ee=He.value.find(ve=>ve.id===m);if(!ee){console.error("vnement non trouv");return}if(ee.archived){Ue.value=!0,vt.value="vnement archiv  dsarchivez pour modifier",setTimeout(()=>{Ue.value=!1},3e3);return}if(Xr(V.id)){const ve=Go(V.id),fe=Ar.value===V.id;console.debug("Joueur protg:",{playerId:V.id,hasCachedPassword:ve,wasRecentlyVerified:fe,recentlyVerifiedPlayer:Ar.value}),ve||fe?(console.debug("Session active ou joueur rcemment vrifi, procder au toggle"),fe&&(console.debug("Nettoyage du flag recentlyVerifiedPlayer"),Ar.value=null),mi(V,m)):(console.debug("Pas de session, affichage de la modal de vrification"),jn.value={playerName:b,eventId:m},Bt.value=V,Lt.value=!0);return}mi(V,m)}function mi(b,m){var oe,ve,fe;const V=(oe=Kt.value[b.name])==null?void 0:oe[m];console.debug("toggleAvailability");let ee;V===!0?ee=!1:V===!1?ee=void 0:ee=!0,ee===void 0?Kt.value[b.name]&&delete Kt.value[b.name][m]:(Kt.value[b.name]||(Kt.value[b.name]={}),Kt.value[b.name][m]=ee);try{typeof Xt<"u"&&Xt.value===1&&b.id===(U.value||((ve=ws.value[0])==null?void 0:ve.id))&&m===(L.value||((fe=un.value[0])==null?void 0:fe.id))&&(Xt.value=3,Gt(()=>{const Xe=document.querySelector(`[data-player-id="${b.id}"]`);if(Xe){const at=Xe.querySelector(".player-name");if(at){const It=at.getBoundingClientRect();se.value.position={x:Math.round(It.right+8),y:Math.round(It.top+window.scrollY-4)}}}}),Ls(()=>{try{window.removeEventListener("resize",mr)}catch{}try{ai.value&&ai.value.disconnect()}catch{}}))}catch{}Y_(b.name,Kt.value[b.name],o.value).then(async()=>{await Gt(),Pa(),Ue.value=!0,vt.value="Disponibilit mise  jour avec succs !",setTimeout(()=>{Ue.value=!1},3e3)}).catch(Me=>{console.error("Erreur lors de la mise  jour de la disponibilit"),alert("Erreur lors de la mise  jour de la disponibilit. Veuillez ressayer.")})}function ar(b,m){var V;return(V=Kt.value[b])==null?void 0:V[m]}function rd(b,m){var oe;const V=ze.value[m]||[],ee=(oe=Kt.value[b])==null?void 0:oe[m];return V.includes(b)&&ee===!0}async function _o(b,m=6){const V=He.value.find(fe=>fe.id===b),ee=(V==null?void 0:V.playerCount)||6,oe=ze.value[b]||[];if(oe.length>0&&oe.every(fe=>ar(fe,b))){console.debug("Tous les joueurs slectionns sont disponibles, nouveau tirage complet");const Me=ot.value.filter(It=>ar(It.name,b)).map(It=>{const Zt=Is(It.name);return{name:It.name,weight:1/(1+Zt)}}),Xe=[],at=[...Me];for(;Xe.length<ee&&at.length>0;){const It=at.reduce((dn,Et)=>dn+Et.weight,0);let Zt=Math.random()*It;const cn=at.findIndex(dn=>(Zt-=dn.weight,Zt<=0));cn>=0&&(Xe.push(at[cn].name),at.splice(cn,1))}ze.value[b]=Xe}else{const fe=oe.filter(Xe=>ar(Xe,b)),Me=ee-fe.length;if(Me<=0)ze.value[b]=fe;else{const Xe=new Set(fe),It=ot.value.filter(dn=>ar(dn.name,b)&&!Xe.has(dn.name)).map(dn=>{const Et=Is(dn.name);return{name:dn.name,weight:1/(1+Et)}}),Zt=[],cn=[...It];for(;Zt.length<Me&&cn.length>0;){const dn=cn.reduce((Fr,Eo)=>Fr+Eo.weight,0);let Et=Math.random()*dn;const _r=cn.findIndex(Fr=>(Et-=Fr.weight,Et<=0));_r>=0&&(Zt.push(cn[_r].name),cn.splice(_r,1))}ze.value[b]=[...fe,...Zt]}}await wm(b,ze.value[b],o.value),eu(),Pa()}async function Xl(b,m=6){var fe,Me;console.debug("tirerProtected appel"),console.debug("etat modal selection avant");const V=Bn.value,ee=(fe=Nn.value)==null?void 0:fe.id,oe=ze.value[b]&&ze.value[b].length>0,ve=oe?[...ze.value[b]]:[];if(await _o(b,m),console.debug("etat modal selection apres"),V&&!Bn.value&&(console.debug("Restauration de la popin de slection..."),Bn.value=!0,Nn.value=He.value.find(Xe=>Xe.id===ee)),Bn.value&&((Me=Nn.value)==null?void 0:Me.id)===b)if(console.debug("Popin de slection ouverte, mise  jour..."),await Gt(),ps.value&&ps.value.showSuccess){console.debug("Appel de showSuccess sur la popin de slection");const Xe=ze.value[b]||[],at=ve.filter(Zt=>Xe.includes(Zt)),It=at.length>0&&at.length<ve.length;ps.value.showSuccess(oe,It)}else console.debug("showSuccess indisponible");else console.debug("Popin de slection ferme, affichage message global"),Ue.value=!0,He.value.find(Xe=>Xe.id===b),ze.value[b],oe?vt.value="Slection mise  jour avec succs !":vt.value="Slection effectue avec succs !",setTimeout(()=>{Ue.value=!1},3e3)}function Aa(b){b===0?$.value.position=null:b===1?ue.value.position=null:b===2&&(se.value.position=null)}function Zl(b){var V;return b?(typeof b=="string"?new Date(b):((V=b.toDate)==null?void 0:V.call(b))||b).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function Sa(b){var V;return b?(typeof b=="string"?new Date(b):((V=b.toDate)==null?void 0:V.call(b))||b).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Is(b){return Object.values(ze.value).filter(m=>m.includes(b)).length}function gi(b){const m=Kt.value[b]||{};return Object.values(m).filter(V=>V===!0).length}function bo(b){return b?Object.values(Kt.value).filter(m=>m[b]===!0).length:0}function wo(b){return b?(ze.value[b]||[]).length:0}function ts(b){const m=He.value.find(ee=>ee.id===b),V=(m==null?void 0:m.playerCount)||6;return wo(b)>=V}function sd(b){const m=gi(b),V=Is(b);return m===0?0:V/m}function id(b){kf.value[b]={availability:gi(b),selection:Is(b),ratio:sd(b)}}function eu(){ot.value.forEach(b=>id(b.name))}function Pa(){const b={};He.value.forEach(m=>{const V=m.playerCount||6,oe=ot.value.filter(fe=>ar(fe.name,m.id)===!0).map(fe=>{const Me=Is(fe.name);return{name:fe.name,weight:1/(1+Me)}}),ve=oe.reduce((fe,Me)=>fe+Me.weight,0);oe.forEach(fe=>{const Me=Math.min(1,fe.weight/ve*V);b[fe.name]||(b[fe.name]={}),b[fe.name][m.id]=Math.round(Me*100)})}),Wl.value=b}const Es=C(null),En=C(!1);async function od(b=null){const m=b||Es.value;if(!m){console.error("Aucun joueur  supprimer");return}try{await R$(m,o.value),ot.value=ot.value.filter(V=>V.id!==m),En.value=!1,Es.value=null,Ue.value=!0,vt.value="Joueur supprim avec succs !",setTimeout(()=>{Ue.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez ressayer.")}}function ad(){En.value=!1,Es.value=null}async function vi(b){Dv(),await Bi(b,o.value)?await B({type:"deletePlayer",data:{playerId:b}}):await w({type:"deletePlayer",data:{playerId:b}})}async function u(){if(_.value){const b=He.value.find(V=>V.id===_.value),m=(b==null?void 0:b.playerCount)||6;await Xl(_.value,m),E.value=!1,_.value=null}}function p(){E.value=!1,_.value=null}function y(){return P.value?{deleteEvent:"Suppression d'vnement - Code PIN requis",addEvent:"Ajout d'vnement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de slection - Code PIN requis",toggleArchive:"Archivage d'vnement - Code PIN requis",updateSelection:"Mise  jour de slection - Code PIN requis"}[P.value.type]||"Code PIN requis":"Veuillez saisir le code PIN  4 chiffres"}async function w(b){if(On.isPinCached(o.value)){const m=On.getCachedPin(o.value);if(console.debug("PIN en cache trouv, utilisation automatique"),await wh(o.value,m)){await yr(b);return}else On.clearSession()}P.value=b,k.value=!0}async function B(b){const m=b.data.playerId;try{if(On.isPinCached(o.value)){console.debug("PIN de saison en cache  saut de la demande de mot de passe joueur"),await yr(b);return}}catch{}if(Go(m)){console.debug("Mot de passe du joueur en cache trouv, utilisation automatique"),await yr(b);return}be.value=b,nt.value=!0}async function Y(b){try{if(await wh(o.value,b)){On.saveSession(o.value,b),k.value=!1;const V=P.value;P.value=null,await yr(V)}else Qe.value="Code PIN incorrect",setTimeout(()=>{Qe.value=""},3e3)}catch{console.error("Erreur lors de la vrification du PIN"),Qe.value="Erreur lors de la vrification du code PIN"}}function Se(){k.value=!1,P.value=null,Qe.value=""}async function xt(b){if(b){ie.value=!0,ne.value="";try{const m=be.value.data.playerId,V=await pm(o.value);if(b===V){try{On.saveSession(o.value,b)}catch{}try{eo.saveSession(be.value.data.playerId)}catch{}nt.value=!1;const oe=be.value;be.value=null,ae.value="",await yr(oe);return}if(await verifyPlayerPassword(m,b,o.value)){nt.value=!1;const oe=be.value;be.value=null,ae.value="",await yr(oe)}else ne.value="Mot de passe incorrect",setTimeout(()=>{ne.value=""},3e3)}catch{console.error("Erreur lors de la vrification du mot de passe"),ne.value="Erreur lors de la vrification du mot de passe"}finally{ie.value=!1}}}function wn(){nt.value=!1,be.value=null,ne.value="",ae.value="",ie.value=!1}async function yt(b){if(b){ct.value=!0,Ee.value="";try{const m=Q.value.data.player,V=await pm(o.value);if(b===V){try{On.saveSession(o.value,b)}catch{}try{eo.saveSession(Q.value.data.player.id)}catch{}Z.value=!1;const oe=Q.value;Q.value=null,Je.value="",await yr(oe);return}if(await verifyPlayerPassword(m.id,b,o.value)){Z.value=!1;const oe=Q.value;Q.value=null,Je.value="",await yr(oe)}else Ee.value="Mot de passe incorrect",setTimeout(()=>{Ee.value=""},3e3)}catch{console.error("Erreur lors de la vrification du mot de passe"),Ee.value="Erreur lors de la vrification du mot de passe"}finally{ct.value=!1}}}function Tn(){Z.value=!1,Q.value=null,Ee.value="",Je.value="",ct.value=!1}async function An(){Ae.value=!0,xe.value="",Ve.value="";try{const b=Q.value.data.player,m=await sendPasswordResetEmail(b.id,o.value);Ve.value=m.message||"Email de rinitialisation envoy ! Vrifiez votre bote de rception."}catch{console.error("Erreur lors de l'envoi de l'email"),xe.value="Erreur lors de l'envoi de l'email. Veuillez ressayer."}finally{Ae.value=!1}}async function yi(){dt.value=!0,S.value="",N.value="";try{const b=be.value.data.playerId,m=await sendPasswordResetEmail(b,o.value);N.value=m.message||"Email de rinitialisation envoy ! Vrifiez votre bote de rception."}catch{console.error("Erreur lors de l'envoi de l'email"),S.value="Erreur lors de l'envoi de l'email. Veuillez ressayer."}finally{dt.value=!1}}function vr(){return On.isPinCached(o.value)?{timeRemaining:On.getTimeRemaining(),isExpiringSoon:On.isExpiringSoon()}:null}async function yr(b){var ee;if(!b)return;const{type:m,data:V}=b;try{switch(m){case"deleteEvent":console.debug("executePendingOperation - data.eventId reu"),h.value=V.eventId,c.value=!0;break;case"addEvent":wa.value=!0;break;case"deletePlayer":Es.value=V.playerId,En.value=!0;break;case"launchSelection":ze.value[V.eventId]&&ze.value[V.eventId].length>0?(_.value=V.eventId,E.value=!0,K.value=!1):(await Xl(V.eventId,V.count),K.value=!1);break;case"toggleAvailability":mi(V.player,V.eventId);break;case"toggleArchive":await setEventArchived(V.eventId,V.archived,o.value);{const oe=He.value.findIndex(ve=>ve.id===V.eventId);oe!==-1&&(He.value[oe]={...He.value[oe],archived:!!V.archived}),de.value=!!V.archived}break;case"updateSelection":{const{eventId:oe,players:ve}=V,fe=[...ze.value[oe]||[]],Me=Array.isArray(ve)?ve:[];await wm(oe,Me,o.value),ze.value[oe]=Me;try{const Xe=fe.filter(at=>!Me.includes(at));if(Xe.length>0){const at=He.value.find(It=>It.id===oe);await i3({eventId:oe,eventData:at,removedPlayers:Xe,newSelectedPlayers:Me,seasonId:o.value,seasonSlug:s,players:$r.value})}}catch{}try{(ee=ps.value)==null||ee.showSuccess(!0,!0)}catch{}}break}}catch{console.error("Erreur lors de l'excution de l'opration"),Ue.value=!0,vt.value="Erreur lors de l'opration. Veuillez ressayer.",setTimeout(()=>{Ue.value=!1},3e3)}}function tu(){t.push("/seasons")}Ls(()=>{const b=rr.value;b&&b.removeEventListener("scroll",mr),window.removeEventListener("resize",mr)});async function Pv(b){G.value=b,te.value=b.description||"",de.value=!!b.archived;try{const[m,V]=await Promise.all([No(ot.value,He.value,o.value),Vo(o.value)]);Kt.value=m,ze.value=V}catch(m){console.warn("Impossible de rafrachir les donnes avant ouverture des dtails:",m)}K.value=!0}function Df(){K.value=!1,G.value=null,te.value="",we.value=!1,_e.value=!1,Mt(),Tr(),$e.value={position:"fixed",top:"0px",left:"0px"},q.value={position:"fixed",top:"0px",left:"0px"}}function Ca(b,m=null){const V=m||G.value;if(V)try{kF(b,V,i.value),Ue.value=!0,b==="ics"?vt.value="Fichier .ics tlcharg ! Importez-le dans votre agenda":b==="google"?vt.value="Google Calendar ouvert dans un nouvel onglet":b==="outlook"&&(vt.value="Outlook ouvert dans un nouvel onglet"),setTimeout(()=>{Ue.value=!1},3e3)}catch(ee){console.error("Erreur lors de l'ajout au calendrier:",ee),Ue.value=!0,vt.value="Erreur lors de l'ajout au calendrier",setTimeout(()=>{Ue.value=!1},3e3)}}function Cv(){Df(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function hA(b,m){console.debug("handleAvailabilityToggle appel");const V=ot.value.find(ve=>ve.name===b);if(!V){console.error("Joueur non trouv");return}const ee=He.value.find(ve=>ve.id===m);if(ee!=null&&ee.archived){Ue.value=!0,vt.value="vnement archiv  dsarchivez pour modifier",setTimeout(()=>{Ue.value=!1},3e3);return}console.debug("Joueur trouv");const oe=Xr(V.id);if(console.debug("Joueur protg"),oe){Go(V.id)?(console.debug("Session active, procder au toggle"),await yo(b,m)):(console.debug("Demande du mot de passe pour joueur protg"),jn.value={playerName:b,eventId:m},Bt.value=V,Lt.value=!0);return}console.debug("Joueur non protg, procder au toggle"),await yo(b,m)}function fA(b,m){return(ze.value[m]||[]).includes(b)}async function pA(b){if(console.debug("Mot de passe vrifi"),Bt.value&&(Ar.value=Bt.value.id,console.debug("Joueur marqu comme rcemment vrifi")),jn.value){const{playerName:m,eventId:V}=jn.value;console.debug("Excution de l'action en attente"),await yo(m,V),jn.value=null}else console.debug("Aucune action en attente trouve");Lt.value=!1,Bt.value=null}function Rv(){f.value=G.value.id,g.value=G.value.title,v.value=G.value.date,te.value=G.value.description||"",I.value=G.value.playerCount||6,K.value=!1}async function kv(){if(G.value)try{const b=!G.value.archived,m={...G.value,archived:b};await X_(G.value.id,m,o.value),G.value.archived=b;const V=He.value.findIndex(ee=>ee.id===G.value.id);V!==-1&&(He.value[V].archived=b),Ue.value=!0,vt.value=b?"vnement archiv avec succs !":"vnement dsarchiv avec succs !",setTimeout(()=>{Ue.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez ressayer.")}}function Nf(b){R.value=b,x.value=!0;try{typeof Xt<"u"&&Xt.value}catch{}}function Dv(){x.value=!1,R.value=null}async function mA({playerId:b,newName:m}){try{await k$(b,m,o.value),await Promise.all([$u(o.value),No(ot.value,He.value,o.value),Vo(o.value)]).then(([V,ee,oe])=>{if(ot.value=V,Kt.value=ee,ze.value=oe,Gl(),R.value&&R.value.id===b){const ve=V.find(fe=>fe.id===b);ve&&(R.value=ve)}}),Ue.value=!0,vt.value="Joueur mis  jour avec succs !",setTimeout(()=>{Ue.value=!1},3e3)}catch{console.error("Erreur lors de l'dition du joueur"),alert("Erreur lors de l'dition du joueur. Veuillez ressayer.")}}async function gA(){try{await Promise.all([$u(o.value),No(ot.value,He.value,o.value),Vo(o.value)]).then(([b,m,V])=>{if(ot.value=b,Kt.value=m,ze.value=V,Gl(),R.value){const ee=b.find(oe=>oe.id===R.value.id);ee&&(R.value=ee)}}),Ue.value=!0,vt.value="Donnes mises  jour !",setTimeout(()=>{Ue.value=!1},3e3)}catch{console.error("Erreur lors du rafrachissement")}}function vA(b){if(!b)return{availability:0,selection:0,ratio:0};const m=gi(b.name),V=Is(b.name),ee=m===0?0:Math.round(V/m*100);return{availability:m,selection:V,ratio:ee}}function xo(b){const m=ze.value[b]||[],V=He.value.find(ve=>ve.id===b),ee=(V==null?void 0:V.playerCount)||6,oe=bo(b);if(m.length>0){const ve=m.some(Me=>!ar(Me,b)),fe=oe<ee;if(ve||fe)return{type:"incomplete",hasUnavailablePlayers:ve,hasInsufficientPlayers:fe,unavailablePlayers:m.filter(Me=>!ar(Me,b)),availableCount:oe,requiredCount:ee}}return oe<ee?{type:"insufficient",availableCount:oe,requiredCount:ee}:m.length===0?{type:"ready",availableCount:oe,requiredCount:ee}:{type:"complete",availableCount:oe,requiredCount:ee}}function nu(b){const m=xo(b);switch(m.type){case"incomplete":return m.hasUnavailablePlayers?m.unavailablePlayers.length===1?`Slection incomplte : ${m.unavailablePlayers[0]} n'est plus disponible`:`Slection incomplte : ${m.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Slection incomplte : ${m.availableCount} joueurs disponibles pour ${m.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${m.availableCount} disponibles pour ${m.requiredCount} requis`;case"ready":return`Prt pour la slection : ${m.availableCount} joueurs disponibles`;case"complete":return`Slection complte : ${m.availableCount} joueurs disponibles`;default:return""}}async function yA(){const b=[];for(const m of ot.value){if(!await Bi(m.id,o.value))continue;const ee=await eA(m.id,o.value);ee&&b.push({...m,email:ee})}return b}function ld(b){if(b!=null&&b.archived){Ue.value=!0,vt.value="Impossible d'annoncer un vnement archiv",setTimeout(()=>{Ue.value=!1},3e3);return}Nv(),lo.value=b,Or.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","announce"),m.set("event",(b==null?void 0:b.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function _A(){Or.value=!1,lo.value=null;try{const b=new URLSearchParams(window.location.search);b.get("modal")==="announce"&&(b.delete("modal"),b.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${b.toString()}`))}catch{}}function Nv(){ms.value=!1,uo.value=null}const Vf=C(!1);async function Vv({eventId:b,eventData:m,reason:V,selectedPlayers:ee,scope:oe="all",recipient:ve=null}){Vf.value=!0;try{V==="selection"?(oe==="single"&&(ve!=null&&ve.email)?await sb({eventId:b,eventData:m,selectedPlayers:[ve.name],seasonId:o.value,seasonSlug:s,players:$r.value}):await sb({eventId:b,eventData:m,selectedPlayers:ee,seasonId:o.value,seasonSlug:s,players:$r.value}),Ue.value=!0,vt.value=oe==="single"?`Notification envoye  ${(ve==null?void 0:ve.name)||"1 joueur"}`:"Notifications de slection envoyes  tous les joueurs slectionns !",setTimeout(()=>{Ue.value=!1},3e3)):(oe==="single"&&(ve!=null&&ve.email)?await rb({eventId:b,eventData:m,players:[ve],seasonId:o.value,seasonSlug:s,createMagicLink:gm,reminder:!1,getAvailabilityForEvent:(fe,Me)=>ar(fe,Me)}):await rb({eventId:b,eventData:m,players:await yA(),seasonId:o.value,seasonSlug:s,createMagicLink:gm,reminder:!1,getAvailabilityForEvent:(fe,Me)=>ar(fe,Me)}),Ue.value=!0,vt.value=oe==="single"?`Notification envoye  ${(ve==null?void 0:ve.name)||"1 joueur"}`:"Notifications envoyes  tous les joueurs protgs !",setTimeout(()=>{Ue.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),Ue.value=!0,vt.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Ue.value=!1},3e3)}Vf.value=!1}function Of(b){if(!b)return{};const m={};return ot.value.forEach(V=>{m[V.name]=ar(V.name,b)}),m}function Io(b){if(b!=null&&b.archived){Ue.value=!0,vt.value="Impossible d'ouvrir la slection sur un vnement archiv",setTimeout(()=>{Ue.value=!1},3e3);return}Nn.value=b,Bn.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","selection"),m.set("event",(b==null?void 0:b.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function Ov(){Bn.value=!1,Nn.value=null;try{const b=new URLSearchParams(window.location.search);b.get("modal")==="selection"&&(b.delete("modal"),b.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${b.toString()}`))}catch{}}async function bA(){if(!Nn.value)return;const b=Nn.value.id,m=Nn.value.playerCount||6;if(bo(b)===0){Ue.value=!0,vt.value="Aucun joueur disponible pour cet vnement",setTimeout(()=>{Ue.value=!1},3e3);return}await w({type:"launchSelection",data:{eventId:b,count:m}})}function wA(){Ov(),Ue.value=!0,vt.value="Slection valide !",setTimeout(()=>{Ue.value=!1},3e3)}async function xA(b){if(!b||!b.eventId)return;const{eventId:m,players:V}=b;await w({type:"updateSelection",data:{eventId:m,players:V}})}async function Mf(b,m){if(!b||!m)return;Lv(),pr.value=b,zl.value=!0,await Gt();const V=document.querySelector(`[data-event-id="${b}"]`);if(!V){console.warn("lment vnement non trouv dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(fe=>{fe.classList.remove("focused-event-highlight")});const ee=document.querySelectorAll(`[data-event-id="${b}"]`);ee.forEach(fe=>{fe.classList.add("focused-event-highlight")});const oe=ee[0],ve=ee[ee.length-1];oe&&oe.classList.add("focused-event-column-start"),ve&&ve.classList.add("focused-event-column-end"),await IA(V),Ue.value=!0,vt.value=`vnement cibl : ${m.title}`,setTimeout(()=>{Ue.value=!1},4e3),oi.value=setTimeout(()=>{Lv()},8e3)}function Mv(b){if(!b)return;const m=He.value.find(V=>V.id===b);if(!m){console.warn("vnement non trouv dans la liste des vnements"),setTimeout(()=>{const V=He.value.find(ee=>ee.id===b);V?Mf(b,V):console.error("vnement toujours introuvable aprs retry")},500);return}Mf(b,m)}bt(He,b=>{try{const m=new URLSearchParams(window.location.search),V=m.get("modal"),ee=m.get("event");if(!V||!ee)return;const oe=b.find(ve=>ve.id===ee);if(!oe)return;V==="announce"&&ld(oe),V==="selection"&&Io(oe)}catch{}},{immediate:!0});async function IA(b){if(!b)return;if(await new Promise(V=>setTimeout(V,100)),window.innerWidth<=768){const V=rr.value;if(V){const ee=b.offsetLeft,oe=b.offsetWidth,ve=V.clientWidth,fe=ee-ve/2+oe/2,Me=V.scrollWidth-ve,Xe=Math.max(0,Math.min(fe,Me));V.scrollTo({left:Xe,behavior:"smooth"}),setTimeout(()=>{const at=b.getBoundingClientRect();if(at.left<0||at.right>window.innerWidth){const It=ee-20;V.scrollTo({left:Math.max(0,It),behavior:"smooth"})}},500)}}else b.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const m=rr.value;m&&setTimeout(()=>{const V=document.querySelector(`[data-event-id="${pr.value}"]`);if(V&&V.closest("tbody")){const ee=V.offsetLeft,oe=V.offsetWidth,ve=m.clientWidth,fe=ee-ve/2+oe/2,Me=m.scrollWidth-ve,Xe=Math.max(0,Math.min(fe,Me));m.scrollTo({left:Xe,behavior:"smooth"})}},300)}function Lv(){oi.value&&(clearTimeout(oi.value),oi.value=null),pr.value=null,zl.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(b=>{b.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(b=>{b.classList.remove("focused-event-column-start","focused-event-column-end")})}return(b,m)=>{var V,ee,oe,ve,fe,Me,Xe,at,It,Zt,cn,dn,Et,_r,Fr,Eo,Ra,$v,Fv,Uv,jv,Bv,qv,zv;return D(),O(it,null,[d("div",tj,[Ke(ej,{"season-name":i.value,"is-scrolled":l.value,onGoBack:tu,onOpenAccountMenu:Sf,onOpenHelp:m[0]||(m[0]=W=>gs.value=!0),onOpenNotifications:Pf,onOpenPlayers:ma,onLogout:Mr,onOpenLogin:ga,onOpenAccount:ga},null,8,["season-name","is-scrolled"]),d("div",nj,[d("div",{ref_key:"headerBarRef",ref:Qc,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[d("div",rj,[He.value.length===0&&ot.value.length===0?ce("",!0):(D(),O("div",sj,[d("div",{class:"flex items-center justify-center h-full gap-2"},[d("button",{onClick:pi,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel vnement"},m[74]||(m[74]=[d("span",{class:"text-lg"},"",-1),d("span",{class:"hidden sm:inline"},"Ajouter un vnement",-1),d("span",{class:"sm:hidden"},"vnement",-1)]))])])),d("div",ij,[d("div",{ref_key:"headerEventsRef",ref:Vn,class:"flex relative z-[60]",style:br({transform:`translateX(-${ya.value}px)`})},[(D(!0),O(it,null,wr(un.value,W=>(D(),O("div",{key:"h-"+W.id,"data-event-id":W.id,class:Qt(["col-event flex-shrink-0 p-3 text-center flex flex-col justify-between",{"archived-header":W.archived}])},[d("div",{class:"flex flex-col items-center justify-between p-2 rounded-lg hover:bg-white/10 transition-colors duration-200 cursor-pointer group h-24",title:W.title+" - Cliquez pour voir les dtails",onClick:lt(rn=>Pv(W),["stop"])},[d("div",lj,[d("div",uj,re(W.title||"Sans titre"),1),W.archived?(D(),O("div",cj,"(Archiv)")):ce("",!0)]),d("div",dj,[d("div",{onClick:lt(rn=>gt(W.id),["stop"]),class:"header-date text-[16px] md:text-base text-gray-300 group-hover:text-purple-200 transition-colors duration-200 cursor-pointer hover:bg-white/10 px-2 py-1 rounded",title:Sa(W.date)+" - Cliquez pour ajouter  votre agenda"},re(Zl(W.date)),9,hj),j.value===W.id?(D(),O("div",fj,[d("div",pj,[d("button",{onClick:lt(rn=>{Ca("google",W),Mt()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},m[75]||(m[75]=[d("span",null,"",-1),d("span",null,"Google Calendar",-1)]),8,mj),d("button",{onClick:lt(rn=>{Ca("outlook",W),Mt()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},m[76]||(m[76]=[d("span",null,"",-1),d("span",null,"Outlook",-1)]),8,gj),d("button",{onClick:lt(rn=>{Ca("ics",W),Mt()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Tlcharger un fichier .ics compatible avec tous les agendas"},m[77]||(m[77]=[d("span",null,"",-1),d("span",null,"Tlcharger (.ics)",-1)]),8,vj)])])):ce("",!0)])],8,aj),d("div",yj,[W.archived?(D(),O("div",_j,m[78]||(m[78]=[d("span",{class:"text-xs text-gray-300 font-medium"},"",-1),d("span",{class:"text-xs text-gray-200 font-medium ml-1"},"Archiv",-1)]))):xo(W.id).type==="ready"?(D(),O("div",{key:1,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-blue-500/30 transition-colors duration-200 cursor-pointer group",title:nu(W.id)+" - Cliquez pour ouvrir la slection",onClick:lt(rn=>Io(W),["stop"])},m[79]||(m[79]=[d("span",{class:"text-xs text-blue-300 font-medium group-hover:text-blue-200"},"",-1),d("span",{class:"text-xs text-blue-200 font-medium ml-1 group-hover:text-blue-100"},"Nouveau",-1)]),8,bj)):xo(W.id).type==="complete"?(D(),O("div",{key:2,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-green-500/30 transition-colors duration-200 cursor-pointer group",title:nu(W.id)+" - Cliquez pour ouvrir la slection",onClick:lt(rn=>Io(W),["stop"])},m[80]||(m[80]=[d("span",{class:"text-xs text-green-300 font-medium group-hover:text-green-200"},"",-1),d("span",{class:"text-xs text-green-200 font-medium ml-1 group-hover:text-green-100"},"Complet",-1)]),8,wj)):xo(W.id).type==="incomplete"?(D(),O("div",{key:3,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-orange-500/30 transition-colors duration-200 cursor-pointer group",title:nu(W.id)+" - Cliquez pour ouvrir la slection",onClick:lt(rn=>Io(W),["stop"])},m[81]||(m[81]=[d("span",{class:"text-xs text-orange-300 font-medium group-hover:text-orange-200"},"",-1),d("span",{class:"text-xs text-orange-200 font-medium ml-1 group-hover:text-orange-100"}," finaliser",-1)]),8,xj)):xo(W.id).type==="insufficient"?(D(),O("div",{key:4,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-red-500/30 transition-colors duration-200 cursor-pointer group",title:nu(W.id)+" - Cliquez pour ouvrir la slection",onClick:lt(rn=>Io(W),["stop"])},m[82]||(m[82]=[d("span",{class:"text-xs text-red-300 font-medium group-hover:text-red-200"},"",-1),d("span",{class:"text-xs text-red-200 font-medium ml-1 group-hover:text-red-100"},"Manque",-1)]),8,Ij)):ce("",!0)])],10,oj))),128))],4)]),m[85]||(m[85]=d("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),d("button",{onClick:td,class:"absolute right-2 top-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[86] backdrop-blur-sm",title:xs.value?"Masquer les vnements archivs":"Afficher les vnements archivs","aria-label":xs.value?"Masquer les vnements archivs":"Afficher les vnements archivs"},[(D(),O("svg",Tj,[m[83]||(m[83]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),m[84]||(m[84]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),xs.value?ce("",!0):(D(),O("path",Aj))]))],8,Ej),ut(d("button",{onClick:m[1]||(m[1]=lt(W=>Jr(-1,W),["prevent"])),onMousedown:m[2]||(m[2]=lt(W=>sr(-1,W),["prevent"])),onMouseup:m[3]||(m[3]=W=>ir(W)),onMouseleave:m[4]||(m[4]=W=>ir(W)),onTouchstart:m[5]||(m[5]=lt(W=>sr(-1,W),["prevent"])),onTouchend:m[6]||(m[6]=W=>ir(W)),onTouchcancel:m[7]||(m[7]=W=>ir(W)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"vnements prcdents  cliquez pour dfiler"},"  ",544),[[Wf,Wc.value]]),ut(d("button",{onClick:m[8]||(m[8]=lt(W=>Jr(1,W),["prevent"])),onMousedown:m[9]||(m[9]=lt(W=>sr(1,W),["prevent"])),onMouseup:m[10]||(m[10]=W=>ir(W)),onMouseleave:m[11]||(m[11]=W=>ir(W)),onTouchstart:m[12]||(m[12]=lt(W=>sr(1,W),["prevent"])),onTouchend:m[13]||(m[13]=W=>ir(W)),onTouchcancel:m[14]||(m[14]=W=>ir(W)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"vnements suivants  cliquez pour dfiler"},"  ",544),[[Wf,Hl.value]])])],512),ut(d("div",{ref_key:"gridboardRef",ref:rr,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[Xt.value===1?(D(),O("div",Sj,[$.value.position?(D(),O("div",{key:0,class:"fixed z-[400]",style:br({left:$.value.position.x+"px",top:$.value.position.y+"px"})},[d("div",{id:"coachmark-add",class:Qt(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":$.value.side==="right","coachmark-left":$.value.side==="left"}])},[m[87]||(m[87]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),m[88]||(m[88]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),d("div",Pj,[m[86]||(m[86]=d("span",{class:"text-purple-300 text-base md:text-sm"},"tape 1/4",-1)),d("button",{onClick:m[15]||(m[15]=W=>Aa(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):ce("",!0)])):ce("",!0),Xt.value===2&&U.value&&L.value?(D(),O("div",Cj,[ue.value.position?(D(),O("div",{key:0,class:"fixed z-[400]",style:br({position:"absolute",left:ue.value.position.x+"px",top:ue.value.position.y+"px"})},[d("div",Rj,[m[90]||(m[90]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilits",-1)),m[91]||(m[91]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),d("div",kj,[m[89]||(m[89]=d("span",{class:"text-pink-300 text-base md:text-sm"},"tape 2/4",-1)),d("button",{onClick:m[16]||(m[16]=W=>Aa(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ce("",!0)])):ce("",!0),Xt.value===3&&U.value?(D(),O("div",Dj,[se.value.position?(D(),O("div",{key:0,class:"fixed z-[400]",style:br({position:"absolute",left:se.value.position.x+"px",top:se.value.position.y+"px"})},[d("div",Nj,[m[93]||(m[93]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),m[94]||(m[94]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les dtails et la protection",-1)),d("div",Vj,[m[92]||(m[92]=d("span",{class:"text-yellow-300 text-base md:text-sm"},"tape 3/4",-1)),d("button",{onClick:m[17]||(m[17]=W=>Aa(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ce("",!0)])):ce("",!0),d("table",Oj,[d("colgroup",null,[m[95]||(m[95]=d("col",{class:"col-left"},null,-1)),(D(!0),O(it,null,wr(un.value,(W,rn)=>(D(),O("col",{key:"c"+rn,class:"col-event"}))),128)),m[96]||(m[96]=d("col",{class:"col-right"},null,-1))]),m[100]||(m[100]=d("thead",{class:"hidden"},null,-1)),d("tbody",null,[(D(!0),O(it,null,wr(ws.value,W=>{var rn;return D(),O("tr",{key:W.id,class:Qt(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":W.id===F.value,"preferred-player":es.value.has(W.id)}]),"data-player-id":W.id},[d("td",Lj,[d("div",$j,[es.value.has(W.id)?(D(),O("span",Fj,"  ")):Xr(W.id)?(D(),O("span",Uj,"  ")):ce("",!0),d("div",{onClick:lr=>Nf(W),class:Qt(["player-name hover:bg-white/10 rounded-lg p-2 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight block truncate max-w-full flex-1 min-w-0 group",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":Xt.value===3&&W.id===(U.value||((rn=ws.value[0])==null?void 0:rn.id))}]),title:"Cliquez pour voir les dtails : "+W.name},[d("span",Bj,re(W.name),1)],10,jj)])]),(D(!0),O(it,null,wr(un.value,lr=>{var Hv,Kv,Gv;return D(),O("td",{key:lr.id,"data-event-id":lr.id,class:Qt(["p-0",lr.archived?"archived-col":"",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":Xt.value===2&&W.id===(U.value||((Hv=ws.value[0])==null?void 0:Hv.id))&&lr.id===(L.value||((Kv=un.value[0])==null?void 0:Kv.id))}])},[Ke(ib,{"player-name":W.name,"event-id":lr.id,"is-available":ar(W.name,lr.id),"is-selected":rd(W.name,lr.id),"chance-percent":((Gv=Wl.value[W.name])==null?void 0:Gv[lr.id])??null,"show-selected-chance":ts(lr.id),disabled:lr.archived===!0,onToggle:yo},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])],10,qj)}),128)),m[97]||(m[97]=d("td",{class:"p-3 md:p-4"},null,-1))],10,Mj)}),128)),d("tr",zj,[d("td",Hj,[d("div",Kj,[d("button",{onClick:m[18]||(m[18]=W=>T.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},m[98]||(m[98]=[d("span",{class:"text-lg"},"",-1),d("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),d("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(D(!0),O(it,null,wr(un.value,W=>(D(),O("td",{key:"add-row-"+W.id,"data-event-id":W.id,class:Qt(["p-3 md:p-5",W.archived?"archived-col":""])},null,10,Gj))),128)),m[99]||(m[99]=d("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[Wf,!Qr.value]])])]),Qr.value?(D(),O("div",Wj,[d("div",Qj,[m[101]||(m[101]=d("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[d("span",{class:"text-3xl"},"")],-1)),d("p",Jj,re(ii.value)+"",1),d("div",Yj,[d("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:br({width:Lr.value+"%"})},null,4)]),d("p",Xj,re(Lr.value)+"%",1)])])):ce("",!0),Qr.value?ce("",!0):(D(),$s(WU,{key:1,"season-id":o.value,"season-slug":Br(s),"players-count":ot.value.length,"events-count":He.value.length,"onboarding-done":((V=a.value)==null?void 0:V.onboardingCreatorDone)===!0,onCreateEvent:pi,onAddPlayer:m[19]||(m[19]=()=>{T.value=!0}),onCopyLink:Rf,onDismissed:ql},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),ce("",!0),Ue.value?(D(),O("div",Zj,[d("div",eB,[m[102]||(m[102]=d("span",{class:"text-xl"},"",-1)),d("span",null,re(vt.value),1)])])):ce("",!0),gr.value?(D(),O("div",tB,[d("div",nB,[m[103]||(m[103]=d("span",{class:"text-xl"},"",-1)),d("span",null,re(ci.value),1)])])):ce("",!0),wa.value?(D(),O("div",rB,[d("div",sB,[m[109]||(m[109]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"}," Nouvel vnement",-1)),d("div",iB,[m[104]||(m[104]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),ut(d("input",{"onUpdate:modelValue":m[20]||(m[20]=W=>hi.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'vnement"},null,512),[[Ft,hi.value]])]),d("div",oB,[m[105]||(m[105]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),ut(d("input",{"onUpdate:modelValue":m[21]||(m[21]=W=>fi.value=W),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[Ft,fi.value]])]),d("div",aB,[m[106]||(m[106]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),ut(d("textarea",{"onUpdate:modelValue":m[22]||(m[22]=W=>or.value=W),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'vnement (optionnel)"},null,512),[[Ft,or.value]])]),d("div",lB,[ut(d("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":m[23]||(m[23]=W=>xa.value=W),class:"w-4 h-4"},null,512),[[Mi,xa.value]]),m[107]||(m[107]=d("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Crer comme archiv",-1))]),d("div",uB,[m[108]||(m[108]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs  slectionner",-1)),ut(d("input",{"onUpdate:modelValue":m[24]||(m[24]=W=>mo.value=W),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[Ft,mo.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:ed,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Ia,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Crer ")])])])):ce("",!0),T.value?(D(),O("div",cB,[d("div",dB,[m[111]||(m[111]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"}," Nouveau joueur",-1)),d("div",hB,[m[110]||(m[110]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),ut(d("input",{"onUpdate:modelValue":m[25]||(m[25]=W=>A.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[Ft,A.value]])]),d("div",fB,[d("button",{onClick:m[26]||(m[26]=W=>T.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Zc,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):ce("",!0),c.value?(D(),O("div",pB,[d("div",mB,[m[112]||(m[112]=Cn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl"></span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">tes-vous sr de vouloir supprimer cet vnement ?</p></div>',1)),d("div",gB,[d("button",{onClick:Xc,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:m[27]||(m[27]=()=>Zr()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ce("",!0),En.value?(D(),O("div",vB,[d("div",yB,[m[113]||(m[113]=Cn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl"></span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">tes-vous sr de vouloir supprimer ce joueur ?</p></div>',1)),d("div",_B,[d("button",{onClick:ad,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:m[28]||(m[28]=()=>od()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):ce("",!0),E.value?(D(),O("div",bB,[d("div",wB,[d("div",xB,[m[114]||(m[114]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"")],-1)),m[115]||(m[115]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",IB,[_.value&&ze.value[_.value]&&ze.value[_.value].every(W=>ar(W,_.value))?(D(),O("span",EB,"Attention, toute la slection sera refaite en fonction des disponibilits actuelles.")):(D(),O("span",TB,"La slection sera mise  jour : les joueurs disponibles seront conservs, les slots vides seront complts."))])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:p,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:u,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):ce("",!0),K.value?(D(),O("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:Df},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:m[42]||(m[42]=lt(()=>{},["stop"]))},[d("div",AB,[d("button",{onClick:Df,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},""),d("div",SB,[m[121]||(m[121]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"")],-1)),d("div",PB,[d("div",CB,[d("h2",RB,re((ee=G.value)==null?void 0:ee.title),1),d("div",kB,[m[116]||(m[116]=d("span",{class:"text-blue-300"},"",-1)),d("span",DB,re(((oe=G.value)==null?void 0:oe.playerCount)||6)+" joueurs",1)])]),d("div",NB,[d("p",VB,re(Sa((ve=G.value)==null?void 0:ve.date)),1),d("div",OB,[d("button",{onClick:m[29]||(m[29]=W=>Er()),class:"px-3 py-1.5 hover:bg-white/20 rounded text-purple-300 hover:text-green-400 transition-colors duration-200 text-sm flex items-center gap-2 border border-purple-500/30",title:"Ajouter  votre agenda"},m[117]||(m[117]=[d("span",null,"",-1),d("span",null,"Agenda",-1)])),ge.value?(D(),O("div",MB,[d("div",LB,[d("button",{onClick:m[30]||(m[30]=W=>{Ca("google"),Tr()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},m[118]||(m[118]=[d("span",null,"",-1),d("span",null,"Google Calendar",-1)])),d("button",{onClick:m[31]||(m[31]=W=>{Ca("outlook"),Tr()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},m[119]||(m[119]=[d("span",null,"",-1),d("span",null,"Outlook",-1)])),d("button",{onClick:m[32]||(m[32]=W=>{Ca("ics"),Tr()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Tlcharger un fichier .ics compatible avec tous les agendas"},m[120]||(m[120]=[d("span",null,"",-1),d("span",null,"Tlcharger (.ics)",-1)]))])])):ce("",!0)])]),(fe=G.value)!=null&&fe.description?(D(),O("div",$B,re(G.value.description),1)):ce("",!0)])])]),d("div",FB,[d("div",UB,[d("div",jB,[d("div",BB,re(bo((Me=G.value)==null?void 0:Me.id)),1),m[122]||(m[122]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",qB,[d("div",zB,re(wo((Xe=G.value)==null?void 0:Xe.id)),1),m[123]||(m[123]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Slectionns",-1))]),d("div",HB,[d("div",KB,re(Math.max((((at=G.value)==null?void 0:at.playerCount)||6)-wo((It=G.value)==null?void 0:It.id),0)),1),m[124]||(m[124]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))])]),G.value?(D(),O("div",GB,[d("div",WB,[Yl.value?(D(),O("div",{key:0,class:Qt(["flex items-center gap-2 px-2 py-1 rounded-md border text-[11px] md:text-xs max-w-[70%] truncate",((Zt=nd.value)==null?void 0:Zt.type)==="incomplete"?"bg-yellow-500/10 border-yellow-500/30 text-yellow-200":"bg-orange-500/10 border-orange-500/30 text-orange-200"]),title:vo.value},[m[125]||(m[125]=d("span",null,"",-1)),d("span",JB,re(vo.value),1)],10,QB)):ce("",!0),ut(d("select",{"onUpdate:modelValue":m[33]||(m[33]=W=>Jl.value=W),class:"ml-auto bg-gray-800 text-white rounded-md px-3 py-2 border border-white/10 focus:outline-none text-sm",title:"Filtrer les joueurs par statut"},m[126]||(m[126]=[Cn('<option value="selected">Slectionns</option><option value="available">Disponibles</option><option value="unavailable">Non Disponibles</option><option value="unknown">Pas de rponse</option><option value="all">Tous</option>',5)]),512),[[HS,Jl.value]])]),d("div",YB,[(D(!0),O(it,null,wr(go.value,W=>{var rn,lr;return D(),O("div",{key:W.id,class:"flex items-center justify-between px-2 py-1.5 rounded-md hover:bg-gray-800/40 transition-colors"},[d("div",XB,[es.value.has(W.id)?(D(),O("span",ZB,"  ")):Xr(W.id)?(D(),O("span",eq,"  ")):ce("",!0),d("span",{class:"text-white text-sm md:text-base block truncate max-w-full flex-1 min-w-0",title:W.name},re(W.name),9,tq)]),d("div",nq,[Ke(ib,{"player-name":W.name,"event-id":G.value.id,"is-available":Of(G.value.id)[W.name],"is-selected":fA(W.name,G.value.id),"chance-percent":((rn=Wl.value[W.name])==null?void 0:rn[G.value.id])??null,"show-selected-chance":ts(G.value.id),disabled:((lr=G.value)==null?void 0:lr.archived)===!0,compact:!0,onToggle:hA},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])])])}),128))])])):ce("",!0),d("div",rq,[d("button",{onClick:m[34]||(m[34]=W=>Io(G.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Grer la slection"},m[127]||(m[127]=[d("span",null,"",-1),d("span",null,"Slectionner",-1)])),d("button",{onClick:m[35]||(m[35]=W=>ld(G.value)),disabled:(cn=G.value)==null?void 0:cn.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(dn=G.value)!=null&&dn.archived?"Impossible d'annoncer un vnement archiv":"Annoncer l'vnement aux joueurs (email, copie, WhatsApp)"},m[128]||(m[128]=[d("span",null,"",-1),d("span",null,"Annoncer",-1)]),8,sq),d("div",{class:"relative",ref_key:"eventMoreActionsRef",ref:Ie},[d("button",{onClick:m[36]||(m[36]=W=>We()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},m[129]||(m[129]=[d("span",null,"",-1),d("span",null,"Plus",-1)]))],512),d("button",{onClick:Cv,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),(D(),$s(Bu,{to:"body"},[_e.value?(D(),O("div",{key:0,ref_key:"eventMoreActionsDropdownRef",ref:ye,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:br($e.value)},[d("button",{onClick:m[37]||(m[37]=W=>{Rv(),_e.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[130]||(m[130]=[d("span",null,"",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:m[38]||(m[38]=W=>{kv(),_e.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10",title:(Et=G.value)!=null&&Et.archived?"Dsarchiver cet vnement":"Archiver cet vnement"},[d("span",null,re((_r=G.value)!=null&&_r.archived?"":""),1),d("span",null,re((Fr=G.value)!=null&&Fr.archived?"Dsarchiver":"Archiver"),1)],8,iq),d("button",{onClick:m[39]||(m[39]=W=>{var rn;di((rn=G.value)==null?void 0:rn.id),_e.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[131]||(m[131]=[d("span",null,"",-1),d("span",null,"Supprimer",-1)]))],4)):ce("",!0)]))])]),d("div",oq,[d("button",{onClick:m[40]||(m[40]=W=>Io(G.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"}," Slectionner"),d("button",{onClick:Cv,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),d("button",{onClick:m[41]||(m[41]=W=>Ze()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"")])])])):ce("",!0),(D(),$s(Bu,{to:"body"},[we.value?(D(),O("div",{key:0,ref_key:"eventMoreActionsMobileDropdownRef",ref:Re,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:br(q.value)},[d("button",{onClick:m[43]||(m[43]=W=>{ld(G.value),we.value=!1}),disabled:(Eo=G.value)==null?void 0:Eo.archived,class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10 disabled:opacity-50 disabled:cursor-not-allowed",title:(Ra=G.value)!=null&&Ra.archived?"Impossible d'annoncer un vnement archiv":"Annoncer l'vnement aux joueurs (email, copie, WhatsApp)"},m[132]||(m[132]=[d("span",null,"",-1),d("span",null,"Annoncer",-1)]),8,aq),d("button",{onClick:m[44]||(m[44]=W=>{Rv(),we.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[133]||(m[133]=[d("span",null,"",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:m[45]||(m[45]=W=>{kv(),we.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},[d("span",null,re(($v=G.value)!=null&&$v.archived?"":""),1),d("span",null,re((Fv=G.value)!=null&&Fv.archived?"Dsarchiver":"Archiver"),1)]),d("button",{onClick:m[46]||(m[46]=W=>{var rn;di((rn=G.value)==null?void 0:rn.id),we.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[134]||(m[134]=[d("span",null,"",-1),d("span",null,"Supprimer",-1)]))],4)):ce("",!0)])),Ke(Sv,{show:Lt.value,player:Bt.value,seasonId:o.value,onClose:m[47]||(m[47]=W=>Lt.value=!1),onVerified:pA},null,8,["show","player","seasonId"]),f.value?(D(),O("div",lq,[d("div",uq,[m[140]||(m[140]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"}," Modifier l'vnement",-1)),d("div",cq,[m[135]||(m[135]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),ut(d("input",{"onUpdate:modelValue":m[48]||(m[48]=W=>g.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[zn(Pr,["esc"]),zn(ba,["enter"])],ref:"editTitleInput"},null,544),[[Ft,g.value]])]),d("div",dq,[m[136]||(m[136]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),ut(d("input",{"onUpdate:modelValue":m[49]||(m[49]=W=>v.value=W),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[zn(Pr,["esc"]),zn(ba,["enter"])]},null,544),[[Ft,v.value]])]),d("div",hq,[m[137]||(m[137]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),ut(d("textarea",{"onUpdate:modelValue":m[50]||(m[50]=W=>te.value=W),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'vnement (optionnel)",onKeydown:zn(Pr,["esc"])},null,544),[[Ft,te.value]])]),d("div",fq,[ut(d("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":m[51]||(m[51]=W=>de.value=W),class:"w-4 h-4"},null,512),[[Mi,de.value]]),m[138]||(m[138]=d("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet vnement",-1))]),d("div",pq,[m[139]||(m[139]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs  slectionner",-1)),ut(d("input",{"onUpdate:modelValue":m[52]||(m[52]=W=>I.value=W),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:zn(Pr,["esc"])},null,544),[[Ft,I.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:Pr,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:ba,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ce("",!0),Ke($T,{show:k.value,message:y(),error:Qe.value,"session-info":vr(),onSubmit:Y,onCancel:Se},null,8,["show","message","error","session-info"]),nt.value?(D(),O("div",mq,[d("div",gq,[m[142]||(m[142]=Cn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl"></span></div><h2 class="text-2xl font-bold text-white mb-2">Vrification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protg</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protg par mot de passe</p></div>',1)),d("div",vq,[d("div",yq,[d("div",null,[m[141]||(m[141]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),ut(d("input",{"onUpdate:modelValue":m[53]||(m[53]=W=>ae.value=W),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[54]||(m[54]=zn(W=>xt(ae.value),["enter"])),ref_key:"playerPasswordInputRef",ref:ke},null,544),[[Ft,ae.value]])])]),d("button",{onClick:m[55]||(m[55]=W=>xt(ae.value)),disabled:!ae.value||ie.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[ie.value?(D(),O("span",bq,"")):(D(),O("span",wq,"")),d("span",null,re(ie.value?"Vrification...":"Vrifier et supprimer"),1)],8,_q)]),d("div",xq,[d("button",{onClick:m[56]||(m[56]=W=>rt.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oubli ? ")]),ne.value?(D(),O("div",Iq,[d("div",Eq,re(ne.value),1)])):ce("",!0),d("div",{class:"flex justify-center"},[d("button",{onClick:wn,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ce("",!0),Z.value?(D(),O("div",Tq,[d("div",Aq,[m[145]||(m[145]=Cn('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl"></span></div><h2 class="text-2xl font-bold text-white mb-1">Vrification requise</h2><p class="text-base text-gray-300">Modification de disponibilit</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protg par mot de passe</p></div>',1)),d("div",Sq,[d("div",Pq,[d("div",null,[m[143]||(m[143]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),ut(d("input",{"onUpdate:modelValue":m[57]||(m[57]=W=>Je.value=W),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[58]||(m[58]=zn(W=>yt(Je.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:Ot},null,544),[[Ft,Je.value]])])]),d("div",Cq,[d("button",{onClick:m[59]||(m[59]=W=>X.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oubli ? ")]),Ee.value?(D(),O("div",Rq,[d("div",kq,re(Ee.value),1)])):ce("",!0)]),d("div",Dq,[d("button",{onClick:Tn,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),d("button",{onClick:m[60]||(m[60]=W=>yt(Je.value)),disabled:!Je.value||ct.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[ct.value?(D(),O("span",Vq,"")):(D(),O("span",Oq,"")),d("span",null,[St(re(ct.value?"Vrification...":"Vrifier"),1),m[144]||(m[144]=d("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,Nq)])])])):ce("",!0),X.value?(D(),O("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[63]||(m[63]=W=>X.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[62]||(m[62]=lt(()=>{},["stop"]))},[m[147]||(m[147]=Cn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl"></span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oubli</h2><p class="text-lg text-gray-300">Modification de disponibilit</p></div>',1)),d("div",Mq,[m[146]||(m[146]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de rinitialisation sera envoy  l'adresse associe  ce joueur. ",-1)),d("button",{onClick:An,disabled:Ae.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Ae.value?(D(),O("span",$q,"")):(D(),O("span",Fq,"")),d("span",null,re(Ae.value?"Envoi...":"Envoyer l'email"),1)],8,Lq)]),xe.value?(D(),O("div",Uq,[d("div",jq,re(xe.value),1)])):ce("",!0),Ve.value?(D(),O("div",Bq,[d("div",qq,re(Ve.value),1)])):ce("",!0),d("div",zq,[d("button",{onClick:m[61]||(m[61]=W=>X.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0),rt.value?(D(),O("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[66]||(m[66]=W=>rt.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[65]||(m[65]=lt(()=>{},["stop"]))},[m[149]||(m[149]=Cn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl"></span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oubli</h2><p class="text-lg text-gray-300">Suppression de joueur protg</p></div>',1)),d("div",Hq,[m[148]||(m[148]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de rinitialisation sera envoy  l'adresse associe  ce joueur. ",-1)),d("button",{onClick:yi,disabled:dt.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[dt.value?(D(),O("span",Gq,"")):(D(),O("span",Wq,"")),d("span",null,re(dt.value?"Envoi...":"Envoyer l'email"),1)],8,Kq)]),S.value?(D(),O("div",Qq,[d("div",Jq,re(S.value),1)])):ce("",!0),N.value?(D(),O("div",Yq,[d("div",Xq,re(N.value),1)])):ce("",!0),d("div",Zq,[d("button",{onClick:m[64]||(m[64]=W=>rt.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0),Ke(z5,{ref_key:"playerModalRef",ref:M,show:x.value,player:R.value,stats:vA(R.value),seasonId:o.value,"onboarding-step":Xt.value,"onboarding-player-id":U.value,"is-protected":R.value?Sr.value.has(R.value.id):!1,"is-preferred":R.value?es.value.has(R.value.id):!1,onClose:Dv,onUpdate:mA,onDelete:vi,onRefresh:gA,onAdvanceOnboarding:m[67]||(m[67]=W=>{try{typeof Xt.value<"u"&&(Xt.value.value=W)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id","is-protected","is-preferred"]),Ke(OU,{ref_key:"selectionModalRef",ref:ps,show:Bn.value,event:Nn.value,"current-selection":ze.value[(Uv=Nn.value)==null?void 0:Uv.id]||[],"available-count":bo((jv=Nn.value)==null?void 0:jv.id),"selected-count":wo((Bv=Nn.value)==null?void 0:Bv.id),"player-availability":Of((qv=Nn.value)==null?void 0:qv.id),"season-id":o.value,"season-slug":Br(s),players:$r.value,onClose:Ov,onSelection:bA,onPerfect:wA,onSendNotifications:Vv,onUpdateSelection:xA},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),Ke(uA,{show:Or.value,event:lo.value,"season-id":o.value,"season-slug":Br(s),players:$r.value,sending:Vf.value,"availability-by-player":Of((zv=lo.value)==null?void 0:zv.id),onClose:_A,onSendNotifications:Vv},null,8,["show","event","season-id","season-slug","players","sending","availability-by-player"]),Ke(I6,{show:gs.value,onClose:m[68]||(m[68]=W=>gs.value=!1)},null,8,["show"]),Ke(sA,{show:vs.value,"season-id":o.value,onClose:Wr,onManagePlayer:Bl,onChangePassword:va,onLogoutDevice:Mr,onDeleteAccount:Gc},null,8,["show","season-id"]),Ke(iA,{show:ys.value,onClose:Cf},null,8,["show"]),Ke(oA,{show:_s.value,onClose:Kc,onManagePlayer:Bl},null,8,["show"]),Ke(cA,{show:bn.value,player:Hc.value,"season-id":o.value,onClose:m[69]||(m[69]=W=>bn.value=!1),onSuccess:m[70]||(m[70]=()=>{bn.value=!1,vs.value=!0})},null,8,["show","player","season-id"]),Ke(UT,{show:co.value,onClose:m[71]||(m[71]=W=>co.value=!1),onSuccess:m[72]||(m[72]=()=>{co.value=!1,vs.value=!0})},null,8,["show"]),ms.value?(D(),O("div",e9,[d("div",t9,[m[150]||(m[150]=d("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet vnement ?",-1)),m[151]||(m[151]=d("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilit",-1)),d("div",n9,[d("button",{onClick:m[73]||(m[73]=W=>ld(uo.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"},"  Oui "),d("button",{onClick:Nv,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):ce("",!0)],64)}}},r9={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},s9={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},i9={key:0,class:"text-center py-8"},o9={key:1,class:"text-center py-8"},a9={class:"text-gray-300 mb-6"},l9={key:2,class:"space-y-6"},u9={class:"text-center"},c9={class:"text-gray-300"},d9={class:"font-semibold text-white"},h9={class:"space-y-4"},f9=["disabled"],p9={key:0,class:"animate-spin"},m9={key:1},g9={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},v9={class:"text-red-300 text-sm"},y9={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},_9={class:"text-green-300 text-sm"},b9={__name:"PasswordReset",setup(n){const e=fa(),t=Fl(),r=C(!0),s=C(""),i=C(""),o=C(""),a=C(""),l=C(""),c=C(!1),h=C(""),f=C(""),g=Fe(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);pn(async()=>{try{const{oobCode:T}=e.query;if(H.debug("Token reu (masqu)"),!T){s.value="Lien de rinitialisation incomplet",r.value=!1;return}o.value=T,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(T){H.error("Erreur lors de la vrification du lien",T),s.value="Erreur lors de la vrification du lien",r.value=!1}});async function v(){if(g.value){c.value=!0,h.value="",f.value="";try{H.debug("Dbut rinitialisation avec token (masqu)"),await GV(Ge,o.value,a.value),H.info("Mot de passe Firebase Auth mis  jour"),H.info("Rinitialisation termine avec Firebase Auth"),f.value="Mot de passe rinitialis avec succs ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{I()},3e3)}catch(T){H.error("Erreur lors de la rinitialisation",T),T.code==="auth/weak-password"?h.value="Le mot de passe doit contenir au moins 6 caractres":T.code==="auth/invalid-action-code"?h.value="Lien de rinitialisation invalide ou expir":h.value="Erreur lors de la rinitialisation. Veuillez ressayer."}finally{c.value=!1}}}function I(){t.push("/seasons")}return(T,A)=>(D(),O("div",r9,[d("div",s9,[A[8]||(A[8]=Cn('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl"></span></div><h1 class="text-3xl font-bold text-white mb-2">Rinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(D(),O("div",i9,A[2]||(A[2]=[d("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),d("p",{class:"text-gray-300"},"Vrification du lien...",-1)]))):s.value?(D(),O("div",o9,[A[3]||(A[3]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"")],-1)),A[4]||(A[4]=d("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),d("p",a9,re(s.value),1),d("button",{onClick:I,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour  l'accueil ")])):i.value?(D(),O("div",l9,[d("div",u9,[d("p",c9,[A[5]||(A[5]=St("Email : ")),d("span",d9,re(i.value),1)])]),d("div",h9,[d("div",null,[A[6]||(A[6]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),ut(d("input",{"onUpdate:modelValue":A[0]||(A[0]=F=>a.value=F),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:zn(v,["enter"])},null,544),[[Ft,a.value]])]),d("div",null,[A[7]||(A[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),ut(d("input",{"onUpdate:modelValue":A[1]||(A[1]=F=>l.value=F),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:zn(v,["enter"])},null,544),[[Ft,l.value]])])]),d("button",{onClick:v,disabled:!g.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(D(),O("span",p9,"")):(D(),O("span",m9,"")),d("span",null,re(c.value?"Rinitialisation...":"Rinitialiser le mot de passe"),1)],8,f9),h.value?(D(),O("div",g9,[d("div",v9,re(h.value),1)])):ce("",!0),f.value?(D(),O("div",y9,[d("div",_9,re(f.value),1)])):ce("",!0)])):ce("",!0)])]))}},w9={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},x9={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},I9={class:"text-3xl"},E9={class:"text-2xl font-bold text-white mb-2"},T9={class:"text-gray-300 mb-6"},A9={__name:"MagicLink",setup(n){const e=fa(),t=Fl(),r=C("loading"),s=C("Traitement en cours..."),i=C("Merci de patienter pendant la validation du lien."),o=Fe(()=>r.value==="loading"?"":r.value==="ok"?"":"");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/seasons")}return pn(async()=>{var l;try{Av("firebase");const c=String(e.query.sid||""),h=String(e.query.pid||"");let f=String(e.query.eid||"");const g=String(e.query.t||""),v=String(e.query.a||""),I=String(e.query.slug||"");if(!g||!v){r.value="error",s.value="Lien invalide",i.value="Paramtres manquants.";return}if(v==="account_email_update"){const $=await zT({token:g});if(!$.valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expir.";return}try{await ZV(Ge.currentUser,$.data.newEmail),await HT({token:g}),r.value="ok",s.value="Email mis  jour",i.value="Votre adresse email a t mise  jour avec succs."}catch{r.value="error",s.value="Action impossible",i.value="Veuillez vous reconnecter puis ressayer."}return}if(v==="verify_email"&&(f="protection"),!(await BT({seasonId:c,playerId:h,eventId:f,token:g,action:v})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expir.";return}if(v==="verify_email"){await YT({playerId:h,seasonId:c});try{await nA({playerId:h,seasonId:c})}catch{}await vm({seasonId:c,playerId:h,eventId:"protection",action:v}),r.value="ok",s.value="Email vrifi",i.value="Merci ! Vous pouvez maintenant dfinir votre mot de passe.",setTimeout(I?()=>t.push(`/season/${I}?player=${encodeURIComponent(h)}&verified=1`):()=>t.push("/seasons"),800);return}const A=Pe(le,"seasons",c,"players",h),F=await jt(A),U=F.exists()&&F.data().name||"";if(!U){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}if(await D$({seasonId:c,playerName:U,eventId:f,value:v==="yes"}),v==="no")try{const $=Pe(le,"seasons",c,"selections",f),ue=await jt($);if(ue.exists()){const se=Array.isArray((l=ue.data())==null?void 0:l.players)?ue.data().players:[],E=se.filter(_=>_!==U);E.length!==se.length&&await setDoc($,{players:E},{merge:!0})}}catch{}await vm({seasonId:c,playerId:h,eventId:f,action:v}),r.value="ok",s.value="Merci !",i.value=v==="yes"?"Votre disponibilit a t enregistre: Disponible.":"Votre disponibilit a t enregistre: Non disponible. (Si vous tiez slectionn(e), vous avez t retir(e) de la slection.)",setTimeout(I?()=>t.push(`/season/${I}/event/${f}`):()=>t.push("/seasons"),1200)}catch(c){H.error("Magic link error",c),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(D(),O("div",w9,[d("div",x9,[d("div",{class:Qt(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[d("span",I9,re(o.value),1)],2),d("h1",E9,re(s.value),1),d("p",T9,re(i.value),1),d("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},S9={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},P9={class:"text-center py-12 px-4"},C9={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},R9={class:"container mx-auto px-4 pb-16"},k9={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},D9={class:"space-y-5"},N9=["onKeydown"],V9={class:"flex items-center justify-end gap-3 pt-2"},O9=["disabled"],M9={key:0,class:"mt-6 text-sm text-gray-200"},L9={__name:"JoinSeason",setup(n){const e=fa(),t=Fl(),r=e.params.slug,s=C(""),i=C(""),o=C(""),a=C(!1),l=C("");pn(async()=>{const f=uc(tt(le,"seasons"),gh("slug","==",r)),g=await Pt(f);if(g.empty)l.value="Saison introuvable";else{const v=g.docs[0];s.value=v.id,i.value=v.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function h(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await lA(o.value.trim(),s.value),l.value="Inscription russie. Vous pouvez maintenant indiquer vos disponibilits.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){H.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez ressayer"}`}finally{a.value=!1}}}return(f,g)=>(D(),O("div",S9,[d("div",P9,[d("h1",C9,re(i.value||"Rejoindre la saison"),1),g[1]||(g[1]=d("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilits aux vnements",-1))]),d("div",R9,[d("div",k9,[g[3]||(g[3]=d("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),d("div",D9,[d("div",null,[g[2]||(g[2]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),ut(d("input",{"onUpdate:modelValue":g[0]||(g[0]=v=>o.value=v),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:zn(lt(h,["prevent"]),["enter"])},null,40,N9),[[Ft,o.value]])]),d("div",V9,[d("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{disabled:!o.value.trim()||a.value,onClick:h,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,O9)])]),l.value?(D(),O("div",M9,re(l.value),1)):ce("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const $9=[{path:"/",component:w4},{path:"/seasons",component:wF},{path:"/season/:slug",component:ob,props:!0},{path:"/season/:slug/event/:eventId",component:ob,props:!0},{path:"/season/:slug/join",component:L9,props:!0},{path:"/reset-password",component:b9},{path:"/magic",component:A9}],F9=e4({history:CL("/"),routes:$9}),dA=YS(XM);dA.use(F9);dA.mount("#app");s4({immediate:!0,onRegistered(n){window.__swReg=n}});export{tt as $,IE as A,sa as B,cs as C,gn as D,qz as E,aa as F,Ug as G,Bz as H,z9 as I,Nr as J,cN as K,hN as L,Ml as M,gz as N,vz as O,LN as P,Un as Q,az as R,Q9 as S,tn as T,Vz as U,nf as V,VN as W,MN as X,mz as Y,X9 as Z,fx as _,oc as a,Fc as a$,G9 as a0,dN as a1,IN as a2,jz as a3,_l as a4,Nz as a5,tz as a6,Uz as a7,Pe as a8,iz as a9,sz as aA,Iz as aB,Ez as aC,oz as aD,wN as aE,Cz as aF,Rz as aG,DN as aH,uc as aI,uE as aJ,W9 as aK,Dz as aL,Ws as aM,sn as aN,Lz as aO,U9 as aP,yz as aQ,dz as aR,cz as aS,pz as aT,nz as aU,Ol as aV,Mz as aW,Z9 as aX,gh as aY,Yg as aZ,Qz as a_,pN as aa,Y9 as ab,ez as ac,Fz as ad,fz as ae,hz as af,nn as ag,Oc as ah,TN as ai,Tz as aj,jt as ak,_z as al,bz as am,Pt as an,wz as ao,xz as ap,fN as aq,$z as ar,Oz as as,J9 as at,lz as au,uz as av,rz as aw,Az as ax,Pz as ay,Sz as az,mN as b,BV as b$,$c as b0,Yz as b1,fc as b2,da as b3,Di as b4,Hz as b5,Vi as b6,Ni as b7,Ys as b8,Bd as b9,JN as bA,y8 as bB,k8 as bC,g_ as bD,CO as bE,vV as bF,h8 as bG,i8 as bH,qV as bI,x8 as bJ,S8 as bK,R8 as bL,_8 as bM,uO as bN,aO as bO,Zz as bP,FN as bQ,zV as bR,I8 as bS,A8 as bT,C8 as bU,ZN as bV,g8 as bW,l8 as bX,KV as bY,s8 as bZ,oO as b_,Wz as ba,Ko as bb,el as bc,DM as bd,Kz as be,b8 as bf,lm as bg,Gz as bh,NM as bi,yv as bj,Oi as bk,n8 as bl,lO as bm,rT as bn,kM as bo,iT as bp,WV as bq,GV as br,_V as bs,QV as bt,Jz as bu,v8 as bv,a8 as bw,d8 as bx,UM as by,Xz as bz,vl as c,av as c0,t8 as c1,JV as c2,o8 as c3,w8 as c4,T8 as c5,P8 as c6,cO as c7,e8 as c8,m8 as c9,ZV as ca,eO as cb,E8 as cc,c8 as cd,p8 as ce,f8 as cf,u8 as cg,r8 as ch,la as d,Vt as e,me as f,Vl as g,Nc as h,Fd as i,cf as j,Vc as k,lf as l,Qg as m,yl as n,uf as o,jo as p,ON as q,an as r,Jo as s,Ne as t,B9 as u,rk as v,Jt as w,zz as x,ht as y,j9 as z};
