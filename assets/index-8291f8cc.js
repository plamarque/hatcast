(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Bf(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const mt={},Lo=[],hr=()=>{},kI=()=>!1,cd=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),qf=n=>n.startsWith("onUpdate:"),un=Object.assign,zf=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},DI=Object.prototype.hasOwnProperty,lt=(n,e)=>DI.call(n,e),De=Array.isArray,Fo=n=>eu(n)==="[object Map]",dd=n=>eu(n)==="[object Set]",Fm=n=>eu(n)==="[object Date]",je=n=>typeof n=="function",Yt=n=>typeof n=="string",Cr=n=>typeof n=="symbol",bt=n=>n!==null&&typeof n=="object",Sy=n=>(bt(n)||je(n))&&je(n.then)&&je(n.catch),Py=Object.prototype.toString,eu=n=>Py.call(n),VI=n=>eu(n).slice(8,-1),Ry=n=>eu(n)==="[object Object]",Gf=n=>Yt(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,pl=Bf(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),hd=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},NI=/-(\w)/g,rr=hd(n=>n.replace(NI,(e,t)=>t?t.toUpperCase():"")),OI=/\B([A-Z])/g,ni=hd(n=>n.replace(OI,"-$1").toLowerCase()),fd=hd(n=>n.charAt(0).toUpperCase()+n.slice(1)),ph=hd(n=>n?`on${fd(n)}`:""),$s=(n,e)=>!Object.is(n,e),fc=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},Hh=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},Wh=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let Um;const pd=()=>Um||(Um=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function ks(n){if(De(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=Yt(r)?UI(r):ks(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(Yt(n)||bt(n))return n}const MI=/;(?![^(]*\))/g,LI=/:([^]+)/,FI=/\/\*[^]*?\*\//g;function UI(n){const e={};return n.replace(FI,"").split(MI).forEach(t=>{if(t){const r=t.split(LI);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function Qn(n){let e="";if(Yt(n))e=n;else if(De(n))for(let t=0;t<n.length;t++){const r=Qn(n[t]);r&&(e+=r+" ")}else if(bt(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const $I="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",jI=Bf($I);function Cy(n){return!!n||n===""}function BI(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=md(n[r],e[r]);return t}function md(n,e){if(n===e)return!0;let t=Fm(n),r=Fm(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=Cr(n),r=Cr(e),t||r)return n===e;if(t=De(n),r=De(e),t||r)return t&&r?BI(n,e):!1;if(t=bt(n),r=bt(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!md(n[o],e[o]))return!1}}return String(n)===String(e)}function ky(n,e){return n.findIndex(t=>md(t,e))}const Dy=n=>!!(n&&n.__v_isRef===!0),ae=n=>Yt(n)?n:n==null?"":De(n)||bt(n)&&(n.toString===Py||!je(n.toString))?Dy(n)?ae(n.value):JSON.stringify(n,Vy,2):String(n),Vy=(n,e)=>Dy(e)?Vy(n,e.value):Fo(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[mh(r,i)+" =>"]=s,t),{})}:dd(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>mh(t))}:Cr(e)?mh(e):bt(e)&&!De(e)&&!Ry(e)?String(e):e,mh=(n,e="")=>{var t;return Cr(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ln;class qI{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Ln,!e&&Ln&&(this.index=(Ln.scopes||(Ln.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Ln;try{return Ln=this,e()}finally{Ln=t}}}on(){++this._on===1&&(this.prevScope=Ln,Ln=this)}off(){this._on>0&&--this._on===0&&(Ln=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function zI(){return Ln}let yt;const gh=new WeakSet;class Ny{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Ln&&Ln.active&&Ln.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,gh.has(this)&&(gh.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||My(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,$m(this),Ly(this);const e=yt,t=fr;yt=this,fr=!0;try{return this.fn()}finally{Fy(this),yt=e,fr=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Wf(e);this.deps=this.depsTail=void 0,$m(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?gh.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Qh(this)&&this.run()}get dirty(){return Qh(this)}}let Oy=0,ml,gl;function My(n,e=!1){if(n.flags|=8,e){n.next=gl,gl=n;return}n.next=ml,ml=n}function Kf(){Oy++}function Hf(){if(--Oy>0)return;if(gl){let e=gl;for(gl=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;ml;){let e=ml;for(ml=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function Ly(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Fy(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),Wf(r),GI(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function Qh(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Uy(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function Uy(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Rl)||(n.globalVersion=Rl,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!Qh(n))))return;n.flags|=2;const e=n.dep,t=yt,r=fr;yt=n,fr=!0;try{Ly(n);const s=n.fn(n._value);(e.version===0||$s(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{yt=t,fr=r,Fy(n),n.flags&=-3}}function Wf(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)Wf(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function GI(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let fr=!0;const $y=[];function Yr(){$y.push(fr),fr=!1}function Xr(){const n=$y.pop();fr=n===void 0?!0:n}function $m(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=yt;yt=void 0;try{e()}finally{yt=t}}}let Rl=0;class KI{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Qf{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!yt||!fr||yt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==yt)t=this.activeLink=new KI(yt,this),yt.deps?(t.prevDep=yt.depsTail,yt.depsTail.nextDep=t,yt.depsTail=t):yt.deps=yt.depsTail=t,jy(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=yt.depsTail,t.nextDep=void 0,yt.depsTail.nextDep=t,yt.depsTail=t,yt.deps===t&&(yt.deps=r)}return t}trigger(e){this.version++,Rl++,this.notify(e)}notify(e){Kf();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Hf()}}}function jy(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)jy(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const Jh=new WeakMap,Ni=Symbol(""),Yh=Symbol(""),Cl=Symbol("");function En(n,e,t){if(fr&&yt){let r=Jh.get(n);r||Jh.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new Qf),s.map=r,s.key=t),s.track()}}function qr(n,e,t,r,s,i){const o=Jh.get(n);if(!o){Rl++;return}const a=l=>{l&&l.trigger()};if(Kf(),e==="clear")o.forEach(a);else{const l=De(n),c=l&&Gf(t);if(l&&t==="length"){const f=Number(r);o.forEach((m,v)=>{(v==="length"||v===Cl||!Cr(v)&&v>=f)&&a(m)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(Cl)),e){case"add":l?c&&a(o.get("length")):(a(o.get(Ni)),Fo(n)&&a(o.get(Yh)));break;case"delete":l||(a(o.get(Ni)),Fo(n)&&a(o.get(Yh)));break;case"set":Fo(n)&&a(o.get(Ni));break}}Hf()}function To(n){const e=at(n);return e===n?e:(En(e,"iterate",Cl),nr(n)?e:e.map(fn))}function gd(n){return En(n=at(n),"iterate",Cl),n}const HI={__proto__:null,[Symbol.iterator](){return vh(this,Symbol.iterator,fn)},concat(...n){return To(this).concat(...n.map(e=>De(e)?To(e):e))},entries(){return vh(this,"entries",n=>(n[1]=fn(n[1]),n))},every(n,e){return $r(this,"every",n,e,void 0,arguments)},filter(n,e){return $r(this,"filter",n,e,t=>t.map(fn),arguments)},find(n,e){return $r(this,"find",n,e,fn,arguments)},findIndex(n,e){return $r(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return $r(this,"findLast",n,e,fn,arguments)},findLastIndex(n,e){return $r(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return $r(this,"forEach",n,e,void 0,arguments)},includes(...n){return yh(this,"includes",n)},indexOf(...n){return yh(this,"indexOf",n)},join(n){return To(this).join(n)},lastIndexOf(...n){return yh(this,"lastIndexOf",n)},map(n,e){return $r(this,"map",n,e,void 0,arguments)},pop(){return Ja(this,"pop")},push(...n){return Ja(this,"push",n)},reduce(n,...e){return jm(this,"reduce",n,e)},reduceRight(n,...e){return jm(this,"reduceRight",n,e)},shift(){return Ja(this,"shift")},some(n,e){return $r(this,"some",n,e,void 0,arguments)},splice(...n){return Ja(this,"splice",n)},toReversed(){return To(this).toReversed()},toSorted(n){return To(this).toSorted(n)},toSpliced(...n){return To(this).toSpliced(...n)},unshift(...n){return Ja(this,"unshift",n)},values(){return vh(this,"values",fn)}};function vh(n,e,t){const r=gd(n),s=r[e]();return r!==n&&!nr(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const WI=Array.prototype;function $r(n,e,t,r,s,i){const o=gd(n),a=o!==n&&!nr(n),l=o[e];if(l!==WI[e]){const m=l.apply(n,i);return a?fn(m):m}let c=t;o!==n&&(a?c=function(m,v){return t.call(this,fn(m),v,n)}:t.length>2&&(c=function(m,v){return t.call(this,m,v,n)}));const f=l.call(o,c,r);return a&&s?s(f):f}function jm(n,e,t,r){const s=gd(n);let i=t;return s!==n&&(nr(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,fn(a),l,n)}),s[e](i,...r)}function yh(n,e,t){const r=at(n);En(r,"iterate",Cl);const s=r[e](...t);return(s===-1||s===!1)&&Xf(t[0])?(t[0]=at(t[0]),r[e](...t)):s}function Ja(n,e,t=[]){Yr(),Kf();const r=at(n)[e].apply(n,t);return Hf(),Xr(),r}const QI=Bf("__proto__,__v_isRef,__isVue"),By=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Cr));function JI(n){Cr(n)||(n=String(n));const e=at(this);return En(e,"has",n),e.hasOwnProperty(n)}class qy{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?oE:Hy:i?Ky:Gy).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=De(e);if(!s){let l;if(o&&(l=HI[t]))return l;if(t==="hasOwnProperty")return JI}const a=Reflect.get(e,t,An(e)?e:r);return(Cr(t)?By.has(t):QI(t))||(s||En(e,"get",t),i)?a:An(a)?o&&Gf(t)?a:a.value:bt(a)?s?Qy(a):vd(a):a}}class zy extends qy{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=Gs(i);if(!nr(r)&&!Gs(r)&&(i=at(i),r=at(r)),!De(e)&&An(i)&&!An(r))return l?!1:(i.value=r,!0)}const o=De(e)&&Gf(t)?Number(t)<e.length:lt(e,t),a=Reflect.set(e,t,r,An(e)?e:s);return e===at(s)&&(o?$s(r,i)&&qr(e,"set",t,r):qr(e,"add",t,r)),a}deleteProperty(e,t){const r=lt(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&qr(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!Cr(t)||!By.has(t))&&En(e,"has",t),r}ownKeys(e){return En(e,"iterate",De(e)?"length":Ni),Reflect.ownKeys(e)}}class YI extends qy{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const XI=new zy,ZI=new YI,eE=new zy(!0);const Xh=n=>n,tc=n=>Reflect.getPrototypeOf(n);function tE(n,e,t){return function(...r){const s=this.__v_raw,i=at(s),o=Fo(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),f=t?Xh:e?Dc:fn;return!e&&En(i,"iterate",l?Yh:Ni),{next(){const{value:m,done:v}=c.next();return v?{value:m,done:v}:{value:a?[f(m[0]),f(m[1])]:f(m),done:v}},[Symbol.iterator](){return this}}}}function nc(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function nE(n,e){const t={get(s){const i=this.__v_raw,o=at(i),a=at(s);n||($s(s,a)&&En(o,"get",s),En(o,"get",a));const{has:l}=tc(o),c=e?Xh:n?Dc:fn;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&En(at(s),"iterate",Ni),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=at(i),a=at(s);return n||($s(s,a)&&En(o,"has",s),En(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=at(a),c=e?Xh:n?Dc:fn;return!n&&En(l,"iterate",Ni),a.forEach((f,m)=>s.call(i,c(f),c(m),o))}};return un(t,n?{add:nc("add"),set:nc("set"),delete:nc("delete"),clear:nc("clear")}:{add(s){!e&&!nr(s)&&!Gs(s)&&(s=at(s));const i=at(this);return tc(i).has.call(i,s)||(i.add(s),qr(i,"add",s,s)),this},set(s,i){!e&&!nr(i)&&!Gs(i)&&(i=at(i));const o=at(this),{has:a,get:l}=tc(o);let c=a.call(o,s);c||(s=at(s),c=a.call(o,s));const f=l.call(o,s);return o.set(s,i),c?$s(i,f)&&qr(o,"set",s,i):qr(o,"add",s,i),this},delete(s){const i=at(this),{has:o,get:a}=tc(i);let l=o.call(i,s);l||(s=at(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&qr(i,"delete",s,void 0),c},clear(){const s=at(this),i=s.size!==0,o=s.clear();return i&&qr(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=tE(s,n,e)}),t}function Jf(n,e){const t=nE(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(lt(t,s)&&s in r?t:r,s,i)}const rE={get:Jf(!1,!1)},sE={get:Jf(!1,!0)},iE={get:Jf(!0,!1)};const Gy=new WeakMap,Ky=new WeakMap,Hy=new WeakMap,oE=new WeakMap;function aE(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function lE(n){return n.__v_skip||!Object.isExtensible(n)?0:aE(VI(n))}function vd(n){return Gs(n)?n:Yf(n,!1,XI,rE,Gy)}function Wy(n){return Yf(n,!1,eE,sE,Ky)}function Qy(n){return Yf(n,!0,ZI,iE,Hy)}function Yf(n,e,t,r,s){if(!bt(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=lE(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function Uo(n){return Gs(n)?Uo(n.__v_raw):!!(n&&n.__v_isReactive)}function Gs(n){return!!(n&&n.__v_isReadonly)}function nr(n){return!!(n&&n.__v_isShallow)}function Xf(n){return n?!!n.__v_raw:!1}function at(n){const e=n&&n.__v_raw;return e?at(e):n}function uE(n){return!lt(n,"__v_skip")&&Object.isExtensible(n)&&Hh(n,"__v_skip",!0),n}const fn=n=>bt(n)?vd(n):n,Dc=n=>bt(n)?Qy(n):n;function An(n){return n?n.__v_isRef===!0:!1}function N(n){return Jy(n,!1)}function cE(n){return Jy(n,!0)}function Jy(n,e){return An(n)?n:new dE(n,e)}class dE{constructor(e,t){this.dep=new Qf,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:at(e),this._value=t?e:fn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||nr(e)||Gs(e);e=r?e:at(e),$s(e,t)&&(this._rawValue=e,this._value=r?e:fn(e),this.dep.trigger())}}function Qr(n){return An(n)?n.value:n}const hE={get:(n,e,t)=>e==="__v_raw"?n:Qr(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return An(s)&&!An(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function Yy(n){return Uo(n)?n:new Proxy(n,hE)}class fE{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Qf(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Rl-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&yt!==this)return My(this,!0),!0}get value(){const e=this.dep.track();return Uy(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function pE(n,e,t=!1){let r,s;return je(n)?r=n:(r=n.get,s=n.set),new fE(r,s,t)}const rc={},Vc=new WeakMap;let Ti;function mE(n,e=!1,t=Ti){if(t){let r=Vc.get(t);r||Vc.set(t,r=[]),r.push(n)}}function gE(n,e,t=mt){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=q=>s?q:nr(q)||s===!1||s===0?zr(q,1):zr(q);let f,m,v,y,C=!1,A=!1;if(An(n)?(m=()=>n.value,C=nr(n)):Uo(n)?(m=()=>c(n),C=!0):De(n)?(A=!0,C=n.some(q=>Uo(q)||nr(q)),m=()=>n.map(q=>{if(An(q))return q.value;if(Uo(q))return c(q);if(je(q))return l?l(q,2):q()})):je(n)?e?m=l?()=>l(n,2):n:m=()=>{if(v){Yr();try{v()}finally{Xr()}}const q=Ti;Ti=f;try{return l?l(n,3,[y]):n(y)}finally{Ti=q}}:m=hr,e&&s){const q=m,ee=s===!0?1/0:s;m=()=>zr(q(),ee)}const k=zI(),U=()=>{f.stop(),k&&k.active&&zf(k.effects,f)};if(i&&e){const q=e;e=(...ee)=>{q(...ee),U()}}let j=A?new Array(n.length).fill(rc):rc;const M=q=>{if(!(!(f.flags&1)||!f.dirty&&!q))if(e){const ee=f.run();if(s||C||(A?ee.some((Z,I)=>$s(Z,j[I])):$s(ee,j))){v&&v();const Z=Ti;Ti=f;try{const I=[ee,j===rc?void 0:A&&j[0]===rc?[]:j,y];j=ee,l?l(e,3,I):e(...I)}finally{Ti=Z}}}else f.run()};return a&&a(M),f=new Ny(m),f.scheduler=o?()=>o(M,!1):M,y=q=>mE(q,!1,f),v=f.onStop=()=>{const q=Vc.get(f);if(q){if(l)l(q,4);else for(const ee of q)ee();Vc.delete(f)}},e?r?M(!0):j=f.run():o?o(M.bind(null,!0),!0):f.run(),U.pause=f.pause.bind(f),U.resume=f.resume.bind(f),U.stop=U,U}function zr(n,e=1/0,t){if(e<=0||!bt(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,An(n))zr(n.value,e,t);else if(De(n))for(let r=0;r<n.length;r++)zr(n[r],e,t);else if(dd(n)||Fo(n))n.forEach(r=>{zr(r,e,t)});else if(Ry(n)){for(const r in n)zr(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&zr(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function tu(n,e,t,r){try{return r?n(...r):n()}catch(s){yd(s,e,t)}}function kr(n,e,t,r){if(je(n)){const s=tu(n,e,t,r);return s&&Sy(s)&&s.catch(i=>{yd(i,e,t)}),s}if(De(n)){const s=[];for(let i=0;i<n.length;i++)s.push(kr(n[i],e,t,r));return s}}function yd(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||mt;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const f=a.ec;if(f){for(let m=0;m<f.length;m++)if(f[m](n,l,c)===!1)return}a=a.parent}if(i){Yr(),tu(i,null,10,[n,l,c]),Xr();return}}vE(n,t,s,r,o)}function vE(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const Dn=[];let Ir=-1;const $o=[];let Ps=null,ko=0;const Xy=Promise.resolve();let Nc=null;function rn(n){const e=Nc||Xy;return n?e.then(this?n.bind(this):n):e}function yE(n){let e=Ir+1,t=Dn.length;for(;e<t;){const r=e+t>>>1,s=Dn[r],i=kl(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function Zf(n){if(!(n.flags&1)){const e=kl(n),t=Dn[Dn.length-1];!t||!(n.flags&2)&&e>=kl(t)?Dn.push(n):Dn.splice(yE(e),0,n),n.flags|=1,Zy()}}function Zy(){Nc||(Nc=Xy.then(t_))}function _E(n){De(n)?$o.push(...n):Ps&&n.id===-1?Ps.splice(ko+1,0,n):n.flags&1||($o.push(n),n.flags|=1),Zy()}function Bm(n,e,t=Ir+1){for(;t<Dn.length;t++){const r=Dn[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;Dn.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function e_(n){if($o.length){const e=[...new Set($o)].sort((t,r)=>kl(t)-kl(r));if($o.length=0,Ps){Ps.push(...e);return}for(Ps=e,ko=0;ko<Ps.length;ko++){const t=Ps[ko];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Ps=null,ko=0}}const kl=n=>n.id==null?n.flags&2?-1:1/0:n.id;function t_(n){const e=hr;try{for(Ir=0;Ir<Dn.length;Ir++){const t=Dn[Ir];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),tu(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;Ir<Dn.length;Ir++){const t=Dn[Ir];t&&(t.flags&=-2)}Ir=-1,Dn.length=0,e_(),Nc=null,(Dn.length||$o.length)&&t_()}}let Jn=null,n_=null;function Oc(n){const e=Jn;return Jn=n,n_=n&&n.type.__scopeId||null,e}function bE(n,e=Jn,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&Ym(-1);const i=Oc(e);let o;try{o=n(...s)}finally{Oc(i),r._d&&Ym(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function ut(n,e){if(Jn===null)return n;const t=Id(Jn),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=mt]=e[s];i&&(je(i)&&(i={mounted:i,updated:i}),i.deep&&zr(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function wi(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(Yr(),kr(l,t,8,[n.el,a,n,e]),Xr())}}const wE=Symbol("_vte"),IE=n=>n.__isTeleport;function ep(n,e){n.shapeFlag&6&&n.component?(n.transition=e,ep(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function r_(n,e){return je(n)?(()=>un({name:n.name},e,{setup:n}))():n}function s_(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function vl(n,e,t,r,s=!1){if(De(n)){n.forEach((C,A)=>vl(C,e&&(De(e)?e[A]:e),t,r,s));return}if(yl(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&vl(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?Id(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,f=a.refs===mt?a.refs={}:a.refs,m=a.setupState,v=at(m),y=m===mt?()=>!1:C=>lt(v,C);if(c!=null&&c!==l&&(Yt(c)?(f[c]=null,y(c)&&(m[c]=null)):An(c)&&(c.value=null)),je(l))tu(l,a,12,[o,f]);else{const C=Yt(l),A=An(l);if(C||A){const k=()=>{if(n.f){const U=C?y(l)?m[l]:f[l]:l.value;s?De(U)&&zf(U,i):De(U)?U.includes(i)||U.push(i):C?(f[l]=[i],y(l)&&(m[l]=f[l])):(l.value=[i],n.k&&(f[n.k]=l.value))}else C?(f[l]=o,y(l)&&(m[l]=o)):A&&(l.value=o,n.k&&(f[n.k]=o))};o?(k.id=-1,Wn(k,t)):k()}}}pd().requestIdleCallback;pd().cancelIdleCallback;const yl=n=>!!n.type.__asyncLoader,i_=n=>n.type.__isKeepAlive;function EE(n,e){o_(n,"a",e)}function TE(n,e){o_(n,"da",e)}function o_(n,e,t=Tn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(_d(e,r,t),t){let s=t.parent;for(;s&&s.parent;)i_(s.parent.vnode)&&xE(r,e,t,s),s=s.parent}}function xE(n,e,t,r){const s=_d(e,n,r,!0);tp(()=>{zf(r[e],s)},t)}function _d(n,e,t=Tn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Yr();const a=nu(t),l=kr(e,t,n,o);return a(),Xr(),l});return r?s.unshift(i):s.push(i),i}}const is=n=>(e,t=Tn)=>{(!Vl||n==="sp")&&_d(n,(...r)=>e(...r),t)},AE=is("bm"),Ks=is("m"),SE=is("bu"),PE=is("u"),RE=is("bum"),tp=is("um"),CE=is("sp"),kE=is("rtg"),DE=is("rtc");function VE(n,e=Tn){_d("ec",n,e)}const a_="components";function NE(n,e){return ME(a_,n,!0,e)||n}const OE=Symbol.for("v-ndc");function ME(n,e,t=!0,r=!1){const s=Jn||Tn;if(s){const i=s.type;if(n===a_){const a=IT(i,!1);if(a&&(a===e||a===rr(e)||a===fd(rr(e))))return i}const o=qm(s[n]||i[n],e)||qm(s.appContext[n],e);return!o&&r?i:o}}function qm(n,e){return n&&(n[e]||n[rr(e)]||n[fd(rr(e))])}function dr(n,e,t,r){let s;const i=t&&t[r],o=De(n);if(o||Yt(n)){const a=o&&Uo(n);let l=!1,c=!1;a&&(l=!nr(n),c=Gs(n),n=gd(n)),s=new Array(n.length);for(let f=0,m=n.length;f<m;f++)s[f]=e(l?c?Dc(fn(n[f])):fn(n[f]):n[f],f,void 0,i&&i[f])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(bt(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const f=a[l];s[l]=e(n[f],f,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}const Zh=n=>n?A_(n)?Id(n):Zh(n.parent):null,_l=un(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Zh(n.parent),$root:n=>Zh(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>np(n),$forceUpdate:n=>n.f||(n.f=()=>{Zf(n.update)}),$nextTick:n=>n.n||(n.n=rn.bind(n.proxy)),$watch:n=>rT.bind(n)}),_h=(n,e)=>n!==mt&&!n.__isScriptSetup&&lt(n,e),LE={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const y=o[e];if(y!==void 0)switch(y){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(_h(r,e))return o[e]=1,r[e];if(s!==mt&&lt(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&lt(c,e))return o[e]=3,i[e];if(t!==mt&&lt(t,e))return o[e]=4,t[e];ef&&(o[e]=0)}}const f=_l[e];let m,v;if(f)return e==="$attrs"&&En(n.attrs,"get",""),f(n);if((m=a.__cssModules)&&(m=m[e]))return m;if(t!==mt&&lt(t,e))return o[e]=4,t[e];if(v=l.config.globalProperties,lt(v,e))return v[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return _h(s,e)?(s[e]=t,!0):r!==mt&&lt(r,e)?(r[e]=t,!0):lt(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==mt&&lt(n,o)||_h(e,o)||(a=i[0])&&lt(a,o)||lt(r,o)||lt(_l,o)||lt(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:lt(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function zm(n){return De(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let ef=!0;function FE(n){const e=np(n),t=n.proxy,r=n.ctx;ef=!1,e.beforeCreate&&Gm(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:f,beforeMount:m,mounted:v,beforeUpdate:y,updated:C,activated:A,deactivated:k,beforeDestroy:U,beforeUnmount:j,destroyed:M,unmounted:q,render:ee,renderTracked:Z,renderTriggered:I,errorCaptured:w,serverPrefetch:T,expose:P,inheritAttrs:R,components:D,directives:b,filters:Ue}=e;if(c&&UE(c,r,null),o)for(const Fe in o){const Oe=o[Fe];je(Oe)&&(r[Fe]=Oe.bind(t))}if(s){const Fe=s.call(t,t);bt(Fe)&&(n.data=vd(Fe))}if(ef=!0,i)for(const Fe in i){const Oe=i[Fe],Ae=je(Oe)?Oe.bind(t,t):je(Oe.get)?Oe.get.bind(t,t):hr,Y=!je(Oe)&&je(Oe.set)?Oe.set.bind(t):hr,Se=We({get:Ae,set:Y});Object.defineProperty(r,Fe,{enumerable:!0,configurable:!0,get:()=>Se.value,set:_e=>Se.value=_e})}if(a)for(const Fe in a)l_(a[Fe],r,t,Fe);if(l){const Fe=je(l)?l.call(t):l;Reflect.ownKeys(Fe).forEach(Oe=>{pc(Oe,Fe[Oe])})}f&&Gm(f,n,"c");function Xe(Fe,Oe){De(Oe)?Oe.forEach(Ae=>Fe(Ae.bind(t))):Oe&&Fe(Oe.bind(t))}if(Xe(AE,m),Xe(Ks,v),Xe(SE,y),Xe(PE,C),Xe(EE,A),Xe(TE,k),Xe(VE,w),Xe(DE,Z),Xe(kE,I),Xe(RE,j),Xe(tp,q),Xe(CE,T),De(P))if(P.length){const Fe=n.exposed||(n.exposed={});P.forEach(Oe=>{Object.defineProperty(Fe,Oe,{get:()=>t[Oe],set:Ae=>t[Oe]=Ae})})}else n.exposed||(n.exposed={});ee&&n.render===hr&&(n.render=ee),R!=null&&(n.inheritAttrs=R),D&&(n.components=D),b&&(n.directives=b),T&&s_(n)}function UE(n,e,t=hr){De(n)&&(n=tf(n));for(const r in n){const s=n[r];let i;bt(s)?"default"in s?i=pr(s.from||r,s.default,!0):i=pr(s.from||r):i=pr(s),An(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function Gm(n,e,t){kr(De(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function l_(n,e,t,r){let s=r.includes(".")?w_(t,r):()=>t[r];if(Yt(n)){const i=e[n];je(i)&&Jt(s,i)}else if(je(n))Jt(s,n.bind(t));else if(bt(n))if(De(n))n.forEach(i=>l_(i,e,t,r));else{const i=je(n.handler)?n.handler.bind(t):e[n.handler];je(i)&&Jt(s,i,n)}}function np(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>Mc(l,c,o,!0)),Mc(l,e,o)),bt(e)&&i.set(e,l),l}function Mc(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&Mc(n,i,t,!0),s&&s.forEach(o=>Mc(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=$E[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const $E={data:Km,props:Hm,emits:Hm,methods:ol,computed:ol,beforeCreate:kn,created:kn,beforeMount:kn,mounted:kn,beforeUpdate:kn,updated:kn,beforeDestroy:kn,beforeUnmount:kn,destroyed:kn,unmounted:kn,activated:kn,deactivated:kn,errorCaptured:kn,serverPrefetch:kn,components:ol,directives:ol,watch:BE,provide:Km,inject:jE};function Km(n,e){return e?n?function(){return un(je(n)?n.call(this,this):n,je(e)?e.call(this,this):e)}:e:n}function jE(n,e){return ol(tf(n),tf(e))}function tf(n){if(De(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function kn(n,e){return n?[...new Set([].concat(n,e))]:e}function ol(n,e){return n?un(Object.create(null),n,e):e}function Hm(n,e){return n?De(n)&&De(e)?[...new Set([...n,...e])]:un(Object.create(null),zm(n),zm(e??{})):e}function BE(n,e){if(!n)return e;if(!e)return n;const t=un(Object.create(null),n);for(const r in e)t[r]=kn(n[r],e[r]);return t}function u_(){return{app:null,config:{isNativeTag:kI,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let qE=0;function zE(n,e){return function(r,s=null){je(r)||(r=un({},r)),s!=null&&!bt(s)&&(s=null);const i=u_(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:qE++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:TT,get config(){return i.config},set config(f){},use(f,...m){return o.has(f)||(f&&je(f.install)?(o.add(f),f.install(c,...m)):je(f)&&(o.add(f),f(c,...m))),c},mixin(f){return i.mixins.includes(f)||i.mixins.push(f),c},component(f,m){return m?(i.components[f]=m,c):i.components[f]},directive(f,m){return m?(i.directives[f]=m,c):i.directives[f]},mount(f,m,v){if(!l){const y=c._ceVNode||ht(r,s);return y.appContext=i,v===!0?v="svg":v===!1&&(v=void 0),m&&e?e(y,f):n(y,f,v),l=!0,c._container=f,f.__vue_app__=c,Id(y.component)}},onUnmount(f){a.push(f)},unmount(){l&&(kr(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(f,m){return i.provides[f]=m,c},runWithContext(f){const m=jo;jo=c;try{return f()}finally{jo=m}}};return c}}let jo=null;function pc(n,e){if(Tn){let t=Tn.provides;const r=Tn.parent&&Tn.parent.provides;r===t&&(t=Tn.provides=Object.create(r)),t[n]=e}}function pr(n,e,t=!1){const r=Tn||Jn;if(r||jo){let s=jo?jo._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&je(e)?e.call(r&&r.proxy):e}}const c_={},d_=()=>Object.create(c_),h_=n=>Object.getPrototypeOf(n)===c_;function GE(n,e,t,r=!1){const s={},i=d_();n.propsDefaults=Object.create(null),f_(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:Wy(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function KE(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=at(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const f=n.vnode.dynamicProps;for(let m=0;m<f.length;m++){let v=f[m];if(bd(n.emitsOptions,v))continue;const y=e[v];if(l)if(lt(i,v))y!==i[v]&&(i[v]=y,c=!0);else{const C=rr(v);s[C]=nf(l,a,C,y,n,!1)}else y!==i[v]&&(i[v]=y,c=!0)}}}else{f_(n,e,s,i)&&(c=!0);let f;for(const m in a)(!e||!lt(e,m)&&((f=ni(m))===m||!lt(e,f)))&&(l?t&&(t[m]!==void 0||t[f]!==void 0)&&(s[m]=nf(l,a,m,void 0,n,!0)):delete s[m]);if(i!==a)for(const m in i)(!e||!lt(e,m))&&(delete i[m],c=!0)}c&&qr(n.attrs,"set","")}function f_(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(pl(l))continue;const c=e[l];let f;s&&lt(s,f=rr(l))?!i||!i.includes(f)?t[f]=c:(a||(a={}))[f]=c:bd(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=at(t),c=a||mt;for(let f=0;f<i.length;f++){const m=i[f];t[m]=nf(s,l,m,c[m],n,!lt(c,m))}}return o}function nf(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=lt(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&je(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const f=nu(s);r=c[t]=l.call(null,e),f()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===ni(t))&&(r=!0))}return r}const HE=new WeakMap;function p_(n,e,t=!1){const r=t?HE:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!je(n)){const f=m=>{l=!0;const[v,y]=p_(m,e,!0);un(o,v),y&&a.push(...y)};!t&&e.mixins.length&&e.mixins.forEach(f),n.extends&&f(n.extends),n.mixins&&n.mixins.forEach(f)}if(!i&&!l)return bt(n)&&r.set(n,Lo),Lo;if(De(i))for(let f=0;f<i.length;f++){const m=rr(i[f]);Wm(m)&&(o[m]=mt)}else if(i)for(const f in i){const m=rr(f);if(Wm(m)){const v=i[f],y=o[m]=De(v)||je(v)?{type:v}:un({},v),C=y.type;let A=!1,k=!0;if(De(C))for(let U=0;U<C.length;++U){const j=C[U],M=je(j)&&j.name;if(M==="Boolean"){A=!0;break}else M==="String"&&(k=!1)}else A=je(C)&&C.name==="Boolean";y[0]=A,y[1]=k,(A||lt(y,"default"))&&a.push(m)}}const c=[o,a];return bt(n)&&r.set(n,c),c}function Wm(n){return n[0]!=="$"&&!pl(n)}const rp=n=>n[0]==="_"||n==="$stable",sp=n=>De(n)?n.map(Er):[Er(n)],WE=(n,e,t)=>{if(e._n)return e;const r=bE((...s)=>sp(e(...s)),t);return r._c=!1,r},m_=(n,e,t)=>{const r=n._ctx;for(const s in n){if(rp(s))continue;const i=n[s];if(je(i))e[s]=WE(s,i,r);else if(i!=null){const o=sp(i);e[s]=()=>o}}},g_=(n,e)=>{const t=sp(e);n.slots.default=()=>t},v_=(n,e,t)=>{for(const r in e)(t||!rp(r))&&(n[r]=e[r])},QE=(n,e,t)=>{const r=n.slots=d_();if(n.vnode.shapeFlag&32){const s=e.__;s&&Hh(r,"__",s,!0);const i=e._;i?(v_(r,e,t),t&&Hh(r,"_",i,!0)):m_(e,r)}else e&&g_(n,e)},JE=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=mt;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:v_(s,e,t):(i=!e.$stable,m_(e,s)),o=e}else e&&(g_(n,e),o={default:1});if(i)for(const a in s)!rp(a)&&o[a]==null&&delete s[a]},Wn=cT;function YE(n){return XE(n)}function XE(n,e){const t=pd();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:f,parentNode:m,nextSibling:v,setScopeId:y=hr,insertStaticContent:C}=n,A=(E,S,V,H=null,z=null,W=null,le=void 0,re=null,ne=!!S.dynamicChildren)=>{if(E===S)return;E&&!Ya(E,S)&&(H=K(E),_e(E,z,W,!0),E=null),S.patchFlag===-2&&(ne=!1,S.dynamicChildren=null);const{type:X,ref:ge,shapeFlag:he}=S;switch(X){case wd:k(E,S,V,H);break;case Hs:U(E,S,V,H);break;case mc:E==null&&j(S,V,H,le);break;case _t:D(E,S,V,H,z,W,le,re,ne);break;default:he&1?ee(E,S,V,H,z,W,le,re,ne):he&6?b(E,S,V,H,z,W,le,re,ne):(he&64||he&128)&&X.process(E,S,V,H,z,W,le,re,ne,be)}ge!=null&&z?vl(ge,E&&E.ref,W,S||E,!S):ge==null&&E&&E.ref!=null&&vl(E.ref,null,W,E,!0)},k=(E,S,V,H)=>{if(E==null)r(S.el=a(S.children),V,H);else{const z=S.el=E.el;S.children!==E.children&&c(z,S.children)}},U=(E,S,V,H)=>{E==null?r(S.el=l(S.children||""),V,H):S.el=E.el},j=(E,S,V,H)=>{[E.el,E.anchor]=C(E.children,S,V,H,E.el,E.anchor)},M=({el:E,anchor:S},V,H)=>{let z;for(;E&&E!==S;)z=v(E),r(E,V,H),E=z;r(S,V,H)},q=({el:E,anchor:S})=>{let V;for(;E&&E!==S;)V=v(E),s(E),E=V;s(S)},ee=(E,S,V,H,z,W,le,re,ne)=>{S.type==="svg"?le="svg":S.type==="math"&&(le="mathml"),E==null?Z(S,V,H,z,W,le,re,ne):T(E,S,z,W,le,re,ne)},Z=(E,S,V,H,z,W,le,re)=>{let ne,X;const{props:ge,shapeFlag:he,transition:ve,dirs:we}=E;if(ne=E.el=o(E.type,W,ge&&ge.is,ge),he&8?f(ne,E.children):he&16&&w(E.children,ne,null,H,z,bh(E,W),le,re),we&&wi(E,null,H,"created"),I(ne,E,E.scopeId,le,H),ge){for(const Me in ge)Me!=="value"&&!pl(Me)&&i(ne,Me,null,ge[Me],W,H);"value"in ge&&i(ne,"value",null,ge.value,W),(X=ge.onVnodeBeforeMount)&&wr(X,H,E)}we&&wi(E,null,H,"beforeMount");const xe=ZE(z,ve);xe&&ve.beforeEnter(ne),r(ne,S,V),((X=ge&&ge.onVnodeMounted)||xe||we)&&Wn(()=>{X&&wr(X,H,E),xe&&ve.enter(ne),we&&wi(E,null,H,"mounted")},z)},I=(E,S,V,H,z)=>{if(V&&y(E,V),H)for(let W=0;W<H.length;W++)y(E,H[W]);if(z){let W=z.subTree;if(S===W||E_(W.type)&&(W.ssContent===S||W.ssFallback===S)){const le=z.vnode;I(E,le,le.scopeId,le.slotScopeIds,z.parent)}}},w=(E,S,V,H,z,W,le,re,ne=0)=>{for(let X=ne;X<E.length;X++){const ge=E[X]=re?Rs(E[X]):Er(E[X]);A(null,ge,S,V,H,z,W,le,re)}},T=(E,S,V,H,z,W,le)=>{const re=S.el=E.el;let{patchFlag:ne,dynamicChildren:X,dirs:ge}=S;ne|=E.patchFlag&16;const he=E.props||mt,ve=S.props||mt;let we;if(V&&Ii(V,!1),(we=ve.onVnodeBeforeUpdate)&&wr(we,V,S,E),ge&&wi(S,E,V,"beforeUpdate"),V&&Ii(V,!0),(he.innerHTML&&ve.innerHTML==null||he.textContent&&ve.textContent==null)&&f(re,""),X?P(E.dynamicChildren,X,re,V,H,bh(S,z),W):le||Oe(E,S,re,null,V,H,bh(S,z),W,!1),ne>0){if(ne&16)R(re,he,ve,V,z);else if(ne&2&&he.class!==ve.class&&i(re,"class",null,ve.class,z),ne&4&&i(re,"style",he.style,ve.style,z),ne&8){const xe=S.dynamicProps;for(let Me=0;Me<xe.length;Me++){const Ge=xe[Me],Lt=he[Ge],xt=ve[Ge];(xt!==Lt||Ge==="value")&&i(re,Ge,Lt,xt,z,V)}}ne&1&&E.children!==S.children&&f(re,S.children)}else!le&&X==null&&R(re,he,ve,V,z);((we=ve.onVnodeUpdated)||ge)&&Wn(()=>{we&&wr(we,V,S,E),ge&&wi(S,E,V,"updated")},H)},P=(E,S,V,H,z,W,le)=>{for(let re=0;re<S.length;re++){const ne=E[re],X=S[re],ge=ne.el&&(ne.type===_t||!Ya(ne,X)||ne.shapeFlag&198)?m(ne.el):V;A(ne,X,ge,null,H,z,W,le,!0)}},R=(E,S,V,H,z)=>{if(S!==V){if(S!==mt)for(const W in S)!pl(W)&&!(W in V)&&i(E,W,S[W],null,z,H);for(const W in V){if(pl(W))continue;const le=V[W],re=S[W];le!==re&&W!=="value"&&i(E,W,re,le,z,H)}"value"in V&&i(E,"value",S.value,V.value,z)}},D=(E,S,V,H,z,W,le,re,ne)=>{const X=S.el=E?E.el:a(""),ge=S.anchor=E?E.anchor:a("");let{patchFlag:he,dynamicChildren:ve,slotScopeIds:we}=S;we&&(re=re?re.concat(we):we),E==null?(r(X,V,H),r(ge,V,H),w(S.children||[],V,ge,z,W,le,re,ne)):he>0&&he&64&&ve&&E.dynamicChildren?(P(E.dynamicChildren,ve,V,z,W,le,re),(S.key!=null||z&&S===z.subTree)&&y_(E,S,!0)):Oe(E,S,V,ge,z,W,le,re,ne)},b=(E,S,V,H,z,W,le,re,ne)=>{S.slotScopeIds=re,E==null?S.shapeFlag&512?z.ctx.activate(S,V,H,le,ne):Ue(S,V,H,z,W,le,ne):Ce(E,S,ne)},Ue=(E,S,V,H,z,W,le)=>{const re=E.component=vT(E,H,z);if(i_(E)&&(re.ctx.renderer=be),yT(re,!1,le),re.asyncDep){if(z&&z.registerDep(re,Xe,le),!E.el){const ne=re.subTree=ht(Hs);U(null,ne,S,V)}}else Xe(re,E,S,V,z,W,le)},Ce=(E,S,V)=>{const H=S.component=E.component;if(lT(E,S,V))if(H.asyncDep&&!H.asyncResolved){Fe(H,S,V);return}else H.next=S,H.update();else S.el=E.el,H.vnode=S},Xe=(E,S,V,H,z,W,le)=>{const re=()=>{if(E.isMounted){let{next:he,bu:ve,u:we,parent:xe,vnode:Me}=E;{const jt=__(E);if(jt){he&&(he.el=Me.el,Fe(E,he,le)),jt.asyncDep.then(()=>{E.isUnmounted||re()});return}}let Ge=he,Lt;Ii(E,!1),he?(he.el=Me.el,Fe(E,he,le)):he=Me,ve&&fc(ve),(Lt=he.props&&he.props.onVnodeBeforeUpdate)&&wr(Lt,xe,he,Me),Ii(E,!0);const xt=wh(E),cn=E.subTree;E.subTree=xt,A(cn,xt,m(cn.el),K(cn),E,z,W),he.el=xt.el,Ge===null&&uT(E,xt.el),we&&Wn(we,z),(Lt=he.props&&he.props.onVnodeUpdated)&&Wn(()=>wr(Lt,xe,he,Me),z)}else{let he;const{el:ve,props:we}=S,{bm:xe,m:Me,parent:Ge,root:Lt,type:xt}=E,cn=yl(S);if(Ii(E,!1),xe&&fc(xe),!cn&&(he=we&&we.onVnodeBeforeMount)&&wr(he,Ge,S),Ii(E,!0),ve&&nt){const jt=()=>{E.subTree=wh(E),nt(ve,E.subTree,E,z,null)};cn&&xt.__asyncHydrate?xt.__asyncHydrate(ve,E,jt):jt()}else{Lt.ce&&Lt.ce._def.shadowRoot!==!1&&Lt.ce._injectChildStyle(xt);const jt=E.subTree=wh(E);A(null,jt,V,H,E,z,W),S.el=jt.el}if(Me&&Wn(Me,z),!cn&&(he=we&&we.onVnodeMounted)){const jt=S;Wn(()=>wr(he,Ge,jt),z)}(S.shapeFlag&256||Ge&&yl(Ge.vnode)&&Ge.vnode.shapeFlag&256)&&E.a&&Wn(E.a,z),E.isMounted=!0,S=V=H=null}};E.scope.on();const ne=E.effect=new Ny(re);E.scope.off();const X=E.update=ne.run.bind(ne),ge=E.job=ne.runIfDirty.bind(ne);ge.i=E,ge.id=E.uid,ne.scheduler=()=>Zf(ge),Ii(E,!0),X()},Fe=(E,S,V)=>{S.component=E;const H=E.vnode.props;E.vnode=S,E.next=null,KE(E,S.props,H,V),JE(E,S.children,V),Yr(),Bm(E),Xr()},Oe=(E,S,V,H,z,W,le,re,ne=!1)=>{const X=E&&E.children,ge=E?E.shapeFlag:0,he=S.children,{patchFlag:ve,shapeFlag:we}=S;if(ve>0){if(ve&128){Y(X,he,V,H,z,W,le,re,ne);return}else if(ve&256){Ae(X,he,V,H,z,W,le,re,ne);return}}we&8?(ge&16&&Mt(X,z,W),he!==X&&f(V,he)):ge&16?we&16?Y(X,he,V,H,z,W,le,re,ne):Mt(X,z,W,!0):(ge&8&&f(V,""),we&16&&w(he,V,H,z,W,le,re,ne))},Ae=(E,S,V,H,z,W,le,re,ne)=>{E=E||Lo,S=S||Lo;const X=E.length,ge=S.length,he=Math.min(X,ge);let ve;for(ve=0;ve<he;ve++){const we=S[ve]=ne?Rs(S[ve]):Er(S[ve]);A(E[ve],we,V,null,z,W,le,re,ne)}X>ge?Mt(E,z,W,!0,!1,he):w(S,V,H,z,W,le,re,ne,he)},Y=(E,S,V,H,z,W,le,re,ne)=>{let X=0;const ge=S.length;let he=E.length-1,ve=ge-1;for(;X<=he&&X<=ve;){const we=E[X],xe=S[X]=ne?Rs(S[X]):Er(S[X]);if(Ya(we,xe))A(we,xe,V,null,z,W,le,re,ne);else break;X++}for(;X<=he&&X<=ve;){const we=E[he],xe=S[ve]=ne?Rs(S[ve]):Er(S[ve]);if(Ya(we,xe))A(we,xe,V,null,z,W,le,re,ne);else break;he--,ve--}if(X>he){if(X<=ve){const we=ve+1,xe=we<ge?S[we].el:H;for(;X<=ve;)A(null,S[X]=ne?Rs(S[X]):Er(S[X]),V,xe,z,W,le,re,ne),X++}}else if(X>ve)for(;X<=he;)_e(E[X],z,W,!0),X++;else{const we=X,xe=X,Me=new Map;for(X=xe;X<=ve;X++){const vt=S[X]=ne?Rs(S[X]):Er(S[X]);vt.key!=null&&Me.set(vt.key,X)}let Ge,Lt=0;const xt=ve-xe+1;let cn=!1,jt=0;const gn=new Array(xt);for(X=0;X<xt;X++)gn[X]=0;for(X=we;X<=he;X++){const vt=E[X];if(Lt>=xt){_e(vt,z,W,!0);continue}let Xt;if(vt.key!=null)Xt=Me.get(vt.key);else for(Ge=xe;Ge<=ve;Ge++)if(gn[Ge-xe]===0&&Ya(vt,S[Ge])){Xt=Ge;break}Xt===void 0?_e(vt,z,W,!0):(gn[Xt-xe]=X+1,Xt>=jt?jt=Xt:cn=!0,A(vt,S[Xt],V,null,z,W,le,re,ne),Lt++)}const Zn=cn?eT(gn):Lo;for(Ge=Zn.length-1,X=xt-1;X>=0;X--){const vt=xe+X,Xt=S[vt],zn=vt+1<ge?S[vt+1].el:H;gn[X]===0?A(null,Xt,V,zn,z,W,le,re,ne):cn&&(Ge<0||X!==Zn[Ge]?Se(Xt,V,zn,2):Ge--)}}},Se=(E,S,V,H,z=null)=>{const{el:W,type:le,transition:re,children:ne,shapeFlag:X}=E;if(X&6){Se(E.component.subTree,S,V,H);return}if(X&128){E.suspense.move(S,V,H);return}if(X&64){le.move(E,S,V,be);return}if(le===_t){r(W,S,V);for(let he=0;he<ne.length;he++)Se(ne[he],S,V,H);r(E.anchor,S,V);return}if(le===mc){M(E,S,V);return}if(H!==2&&X&1&&re)if(H===0)re.beforeEnter(W),r(W,S,V),Wn(()=>re.enter(W),z);else{const{leave:he,delayLeave:ve,afterLeave:we}=re,xe=()=>{E.ctx.isUnmounted?s(W):r(W,S,V)},Me=()=>{he(W,()=>{xe(),we&&we()})};ve?ve(W,xe,Me):Me()}else r(W,S,V)},_e=(E,S,V,H=!1,z=!1)=>{const{type:W,props:le,ref:re,children:ne,dynamicChildren:X,shapeFlag:ge,patchFlag:he,dirs:ve,cacheIndex:we}=E;if(he===-2&&(z=!1),re!=null&&(Yr(),vl(re,null,V,E,!0),Xr()),we!=null&&(S.renderCache[we]=void 0),ge&256){S.ctx.deactivate(E);return}const xe=ge&1&&ve,Me=!yl(E);let Ge;if(Me&&(Ge=le&&le.onVnodeBeforeUnmount)&&wr(Ge,S,E),ge&6)tn(E.component,V,H);else{if(ge&128){E.suspense.unmount(V,H);return}xe&&wi(E,null,S,"beforeUnmount"),ge&64?E.type.remove(E,S,V,be,H):X&&!X.hasOnce&&(W!==_t||he>0&&he&64)?Mt(X,S,V,!1,!0):(W===_t&&he&384||!z&&ge&16)&&Mt(ne,S,V),H&&ke(E)}(Me&&(Ge=le&&le.onVnodeUnmounted)||xe)&&Wn(()=>{Ge&&wr(Ge,S,E),xe&&wi(E,null,S,"unmounted")},V)},ke=E=>{const{type:S,el:V,anchor:H,transition:z}=E;if(S===_t){rt(V,H);return}if(S===mc){q(E);return}const W=()=>{s(V),z&&!z.persisted&&z.afterLeave&&z.afterLeave()};if(E.shapeFlag&1&&z&&!z.persisted){const{leave:le,delayLeave:re}=z,ne=()=>le(V,W);re?re(E.el,W,ne):ne()}else W()},rt=(E,S)=>{let V;for(;E!==S;)V=v(E),s(E),E=V;s(S)},tn=(E,S,V)=>{const{bum:H,scope:z,job:W,subTree:le,um:re,m:ne,a:X,parent:ge,slots:{__:he}}=E;Qm(ne),Qm(X),H&&fc(H),ge&&De(he)&&he.forEach(ve=>{ge.renderCache[ve]=void 0}),z.stop(),W&&(W.flags|=8,_e(le,E,S,V)),re&&Wn(re,S),Wn(()=>{E.isUnmounted=!0},S),S&&S.pendingBranch&&!S.isUnmounted&&E.asyncDep&&!E.asyncResolved&&E.suspenseId===S.pendingId&&(S.deps--,S.deps===0&&S.resolve())},Mt=(E,S,V,H=!1,z=!1,W=0)=>{for(let le=W;le<E.length;le++)_e(E[le],S,V,H,z)},K=E=>{if(E.shapeFlag&6)return K(E.component.subTree);if(E.shapeFlag&128)return E.suspense.next();const S=v(E.anchor||E.el),V=S&&S[wE];return V?v(V):S};let pe=!1;const de=(E,S,V)=>{E==null?S._vnode&&_e(S._vnode,null,null,!0):A(S._vnode||null,E,S,null,null,null,V),S._vnode=E,pe||(pe=!0,Bm(),e_(),pe=!1)},be={p:A,um:_e,m:Se,r:ke,mt:Ue,mc:w,pc:Oe,pbc:P,n:K,o:n};let qe,nt;return e&&([qe,nt]=e(be)),{render:de,hydrate:qe,createApp:zE(de,qe)}}function bh({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Ii({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function ZE(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function y_(n,e,t=!1){const r=n.children,s=e.children;if(De(r)&&De(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=Rs(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&y_(o,a)),a.type===wd&&(a.el=o.el),a.type===Hs&&!a.el&&(a.el=o.el)}}function eT(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function __(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:__(e)}function Qm(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const tT=Symbol.for("v-scx"),nT=()=>pr(tT);function Jt(n,e,t){return b_(n,e,t)}function b_(n,e,t=mt){const{immediate:r,deep:s,flush:i,once:o}=t,a=un({},t),l=e&&r||!e&&i!=="post";let c;if(Vl){if(i==="sync"){const y=nT();c=y.__watcherHandles||(y.__watcherHandles=[])}else if(!l){const y=()=>{};return y.stop=hr,y.resume=hr,y.pause=hr,y}}const f=Tn;a.call=(y,C,A)=>kr(y,f,C,A);let m=!1;i==="post"?a.scheduler=y=>{Wn(y,f&&f.suspense)}:i!=="sync"&&(m=!0,a.scheduler=(y,C)=>{C?y():Zf(y)}),a.augmentJob=y=>{e&&(y.flags|=4),m&&(y.flags|=2,f&&(y.id=f.uid,y.i=f))};const v=gE(n,e,a);return Vl&&(c?c.push(v):l&&v()),v}function rT(n,e,t){const r=this.proxy,s=Yt(n)?n.includes(".")?w_(r,n):()=>r[n]:n.bind(r,r);let i;je(e)?i=e:(i=e.handler,t=e);const o=nu(this),a=b_(s,i.bind(r),t);return o(),a}function w_(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const sT=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${rr(e)}Modifiers`]||n[`${ni(e)}Modifiers`];function iT(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||mt;let s=t;const i=e.startsWith("update:"),o=i&&sT(r,e.slice(7));o&&(o.trim&&(s=t.map(f=>Yt(f)?f.trim():f)),o.number&&(s=t.map(Wh)));let a,l=r[a=ph(e)]||r[a=ph(rr(e))];!l&&i&&(l=r[a=ph(ni(e))]),l&&kr(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,kr(c,n,6,s)}}function I_(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!je(n)){const l=c=>{const f=I_(c,e,!0);f&&(a=!0,un(o,f))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(bt(n)&&r.set(n,null),null):(De(i)?i.forEach(l=>o[l]=null):un(o,i),bt(n)&&r.set(n,o),o)}function bd(n,e){return!n||!cd(e)?!1:(e=e.slice(2).replace(/Once$/,""),lt(n,e[0].toLowerCase()+e.slice(1))||lt(n,ni(e))||lt(n,e))}function wh(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:f,props:m,data:v,setupState:y,ctx:C,inheritAttrs:A}=n,k=Oc(n);let U,j;try{if(t.shapeFlag&4){const q=s||r,ee=q;U=Er(c.call(ee,q,f,m,y,v,C)),j=a}else{const q=e;U=Er(q.length>1?q(m,{attrs:a,slots:o,emit:l}):q(m,null)),j=e.props?a:oT(a)}}catch(q){bl.length=0,yd(q,n,1),U=ht(Hs)}let M=U;if(j&&A!==!1){const q=Object.keys(j),{shapeFlag:ee}=M;q.length&&ee&7&&(i&&q.some(qf)&&(j=aT(j,i)),M=Jo(M,j,!1,!0))}return t.dirs&&(M=Jo(M,null,!1,!0),M.dirs=M.dirs?M.dirs.concat(t.dirs):t.dirs),t.transition&&ep(M,t.transition),U=M,Oc(k),U}const oT=n=>{let e;for(const t in n)(t==="class"||t==="style"||cd(t))&&((e||(e={}))[t]=n[t]);return e},aT=(n,e)=>{const t={};for(const r in n)(!qf(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function lT(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?Jm(r,o,c):!!o;if(l&8){const f=e.dynamicProps;for(let m=0;m<f.length;m++){const v=f[m];if(o[v]!==r[v]&&!bd(c,v))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Jm(r,o,c):!0:!!o;return!1}function Jm(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!bd(t,i))return!0}return!1}function uT({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const E_=n=>n.__isSuspense;function cT(n,e){e&&e.pendingBranch?De(n)?e.effects.push(...n):e.effects.push(n):_E(n)}const _t=Symbol.for("v-fgt"),wd=Symbol.for("v-txt"),Hs=Symbol.for("v-cmt"),mc=Symbol.for("v-stc"),bl=[];let Yn=null;function L(n=!1){bl.push(Yn=n?null:[])}function dT(){bl.pop(),Yn=bl[bl.length-1]||null}let Dl=1;function Ym(n,e=!1){Dl+=n,n<0&&Yn&&e&&(Yn.hasOnce=!0)}function T_(n){return n.dynamicChildren=Dl>0?Yn||Lo:null,dT(),Dl>0&&Yn&&Yn.push(n),n}function $(n,e,t,r,s,i){return T_(g(n,e,t,r,s,i,!0))}function ip(n,e,t,r,s){return T_(ht(n,e,t,r,s,!0))}function Lc(n){return n?n.__v_isVNode===!0:!1}function Ya(n,e){return n.type===e.type&&n.key===e.key}const x_=({key:n})=>n??null,gc=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?Yt(n)||An(n)||je(n)?{i:Jn,r:n,k:e,f:!!t}:n:null);function g(n,e=null,t=null,r=0,s=null,i=n===_t?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&x_(e),ref:e&&gc(e),scopeId:n_,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Jn};return a?(op(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=Yt(t)?8:16),Dl>0&&!o&&Yn&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&Yn.push(l),l}const ht=hT;function hT(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===OE)&&(n=Hs),Lc(n)){const a=Jo(n,e,!0);return t&&op(a,t),Dl>0&&!i&&Yn&&(a.shapeFlag&6?Yn[Yn.indexOf(n)]=a:Yn.push(a)),a.patchFlag=-2,a}if(ET(n)&&(n=n.__vccOpts),e){e=fT(e);let{class:a,style:l}=e;a&&!Yt(a)&&(e.class=Qn(a)),bt(l)&&(Xf(l)&&!De(l)&&(l=un({},l)),e.style=ks(l))}const o=Yt(n)?1:E_(n)?128:IE(n)?64:bt(n)?4:je(n)?2:0;return g(n,e,t,r,s,o,i,!0)}function fT(n){return n?Xf(n)||h_(n)?un({},n):n:null}function Jo(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?pT(s||{},e):s,f={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&x_(c),ref:e&&e.ref?t&&i?De(i)?i.concat(gc(e)):[i,gc(e)]:gc(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==_t?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Jo(n.ssContent),ssFallback:n.ssFallback&&Jo(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&ep(f,l.clone(f)),f}function Vn(n=" ",e=0){return ht(wd,null,n,e)}function cr(n,e){const t=ht(mc,null,n);return t.staticCount=e,t}function se(n="",e=!1){return e?(L(),ip(Hs,null,n)):ht(Hs,null,n)}function Er(n){return n==null||typeof n=="boolean"?ht(Hs):De(n)?ht(_t,null,n.slice()):Lc(n)?Rs(n):ht(wd,null,String(n))}function Rs(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Jo(n)}function op(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(De(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),op(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!h_(e)?e._ctx=Jn:s===3&&Jn&&(Jn.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else je(e)?(e={default:e,_ctx:Jn},t=32):(e=String(e),r&64?(t=16,e=[Vn(e)]):t=8);n.children=e,n.shapeFlag|=t}function pT(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=Qn([e.class,r.class]));else if(s==="style")e.style=ks([e.style,r.style]);else if(cd(s)){const i=e[s],o=r[s];o&&i!==o&&!(De(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function wr(n,e,t,r=null){kr(n,e,7,[t,r])}const mT=u_();let gT=0;function vT(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||mT,i={uid:gT++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new qI(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:p_(r,s),emitsOptions:I_(r,s),emit:null,emitted:null,propsDefaults:mt,inheritAttrs:r.inheritAttrs,ctx:mt,data:mt,props:mt,attrs:mt,slots:mt,refs:mt,setupState:mt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=iT.bind(null,i),n.ce&&n.ce(i),i}let Tn=null,Fc,rf;{const n=pd(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};Fc=e("__VUE_INSTANCE_SETTERS__",t=>Tn=t),rf=e("__VUE_SSR_SETTERS__",t=>Vl=t)}const nu=n=>{const e=Tn;return Fc(n),n.scope.on(),()=>{n.scope.off(),Fc(e)}},Xm=()=>{Tn&&Tn.scope.off(),Fc(null)};function A_(n){return n.vnode.shapeFlag&4}let Vl=!1;function yT(n,e=!1,t=!1){e&&rf(e);const{props:r,children:s}=n.vnode,i=A_(n);GE(n,r,i,e),QE(n,s,t||e);const o=i?_T(n,e):void 0;return e&&rf(!1),o}function _T(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,LE);const{setup:r}=t;if(r){Yr();const s=n.setupContext=r.length>1?wT(n):null,i=nu(n),o=tu(r,n,0,[n.props,s]),a=Sy(o);if(Xr(),i(),(a||n.sp)&&!yl(n)&&s_(n),a){if(o.then(Xm,Xm),e)return o.then(l=>{Zm(n,l,e)}).catch(l=>{yd(l,n,0)});n.asyncDep=o}else Zm(n,o,e)}else S_(n,e)}function Zm(n,e,t){je(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:bt(e)&&(n.setupState=Yy(e)),S_(n,t)}let eg;function S_(n,e,t){const r=n.type;if(!n.render){if(!e&&eg&&!r.render){const s=r.template||np(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=un(un({isCustomElement:i,delimiters:a},o),l);r.render=eg(s,c)}}n.render=r.render||hr}{const s=nu(n);Yr();try{FE(n)}finally{Xr(),s()}}}const bT={get(n,e){return En(n,"get",""),n[e]}};function wT(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,bT),slots:n.slots,emit:n.emit,expose:e}}function Id(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(Yy(uE(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in _l)return _l[t](n)},has(e,t){return t in e||t in _l}})):n.proxy}function IT(n,e=!0){return je(n)?n.displayName||n.name:n.name||e&&n.__name}function ET(n){return je(n)&&"__vccOpts"in n}const We=(n,e)=>pE(n,e,Vl);function P_(n,e,t){const r=arguments.length;return r===2?bt(e)&&!De(e)?Lc(e)?ht(n,null,[e]):ht(n,e):ht(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&Lc(t)&&(t=[t]),ht(n,e,t))}const TT="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let sf;const tg=typeof window<"u"&&window.trustedTypes;if(tg)try{sf=tg.createPolicy("vue",{createHTML:n=>n})}catch{}const R_=sf?n=>sf.createHTML(n):n=>n,xT="http://www.w3.org/2000/svg",AT="http://www.w3.org/1998/Math/MathML",Br=typeof document<"u"?document:null,ng=Br&&Br.createElement("template"),ST={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?Br.createElementNS(xT,n):e==="mathml"?Br.createElementNS(AT,n):t?Br.createElement(n,{is:t}):Br.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>Br.createTextNode(n),createComment:n=>Br.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Br.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{ng.innerHTML=R_(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=ng.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},PT=Symbol("_vtc");function RT(n,e,t){const r=n[PT];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const Uc=Symbol("_vod"),C_=Symbol("_vsh"),Ih={beforeMount(n,{value:e},{transition:t}){n[Uc]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):Xa(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),Xa(n,!0),r.enter(n)):r.leave(n,()=>{Xa(n,!1)}):Xa(n,e))},beforeUnmount(n,{value:e}){Xa(n,e)}};function Xa(n,e){n.style.display=e?n[Uc]:"none",n[C_]=!e}const CT=Symbol(""),kT=/(^|;)\s*display\s*:/;function DT(n,e,t){const r=n.style,s=Yt(t);let i=!1;if(t&&!s){if(e)if(Yt(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&vc(r,a,"")}else for(const o in e)t[o]==null&&vc(r,o,"");for(const o in t)o==="display"&&(i=!0),vc(r,o,t[o])}else if(s){if(e!==t){const o=r[CT];o&&(t+=";"+o),r.cssText=t,i=kT.test(t)}}else e&&n.removeAttribute("style");Uc in n&&(n[Uc]=i?r.display:"",n[C_]&&(r.display="none"))}const rg=/\s*!important$/;function vc(n,e,t){if(De(t))t.forEach(r=>vc(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=VT(n,e);rg.test(t)?n.setProperty(ni(r),t.replace(rg,""),"important"):n[r]=t}}const sg=["Webkit","Moz","ms"],Eh={};function VT(n,e){const t=Eh[e];if(t)return t;let r=rr(e);if(r!=="filter"&&r in n)return Eh[e]=r;r=fd(r);for(let s=0;s<sg.length;s++){const i=sg[s]+r;if(i in n)return Eh[e]=i}return e}const ig="http://www.w3.org/1999/xlink";function og(n,e,t,r,s,i=jI(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(ig,e.slice(6,e.length)):n.setAttributeNS(ig,e,t):t==null||i&&!Cy(t)?n.removeAttribute(e):n.setAttribute(e,i?"":Cr(t)?String(t):t)}function ag(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?R_(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=Cy(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function Si(n,e,t,r){n.addEventListener(e,t,r)}function NT(n,e,t,r){n.removeEventListener(e,t,r)}const lg=Symbol("_vei");function OT(n,e,t,r,s=null){const i=n[lg]||(n[lg]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=MT(e);if(r){const c=i[e]=UT(r,s);Si(n,a,c,l)}else o&&(NT(n,a,o,l),i[e]=void 0)}}const ug=/(?:Once|Passive|Capture)$/;function MT(n){let e;if(ug.test(n)){e={};let r;for(;r=n.match(ug);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):ni(n.slice(2)),e]}let Th=0;const LT=Promise.resolve(),FT=()=>Th||(LT.then(()=>Th=0),Th=Date.now());function UT(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;kr($T(r,t.value),e,5,[r])};return t.value=n,t.attached=FT(),t}function $T(n,e){if(De(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const cg=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,jT=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?RT(n,r,o):e==="style"?DT(n,t,r):cd(e)?qf(e)||OT(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):BT(n,e,r,o))?(ag(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&og(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!Yt(r))?ag(n,rr(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),og(n,e,r,o))};function BT(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&cg(e)&&je(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return cg(e)&&Yt(t)?!1:e in n}const $c=n=>{const e=n.props["onUpdate:modelValue"]||!1;return De(e)?t=>fc(e,t):e};function qT(n){n.target.composing=!0}function dg(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Bo=Symbol("_assign"),St={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[Bo]=$c(s);const i=r||s.props&&s.props.type==="number";Si(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=Wh(a)),n[Bo](a)}),t&&Si(n,"change",()=>{n.value=n.value.trim()}),e||(Si(n,"compositionstart",qT),Si(n,"compositionend",dg),Si(n,"change",dg))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[Bo]=$c(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?Wh(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},hg={deep:!0,created(n,e,t){n[Bo]=$c(t),Si(n,"change",()=>{const r=n._modelValue,s=zT(n),i=n.checked,o=n[Bo];if(De(r)){const a=ky(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(dd(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(k_(n,i))})},mounted:fg,beforeUpdate(n,e,t){n[Bo]=$c(t),fg(n,e,t)}};function fg(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(De(e))s=ky(e,r.props.value)>-1;else if(dd(e))s=e.has(r.props.value);else{if(e===t)return;s=md(e,k_(n,!0))}n.checked!==s&&(n.checked=s)}function zT(n){return"_value"in n?n._value:n.value}function k_(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const GT=["ctrl","shift","alt","meta"],KT={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>GT.some(t=>n[`${t}Key`]&&!e.includes(t))},Bt=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=KT[e[o]];if(a&&a(s,e))return}return n(s,...i)})},HT={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},wn=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=ni(s.key);if(e.some(o=>o===i||HT[o]===i))return n(s)})},WT=un({patchProp:jT},ST);let pg;function QT(){return pg||(pg=YE(WT))}const JT=(...n)=>{const e=QT().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=XT(r);if(!s)return;const i=e._component;!je(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,YT(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function YT(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function XT(n){return Yt(n)?document.querySelector(n):n}const ZT={__name:"App",setup(n){return(e,t)=>{const r=NE("router-view");return L(),ip(r)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const Do=typeof document<"u";function D_(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function ex(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&D_(n.default)}const ot=Object.assign;function xh(n,e){const t={};for(const r in e){const s=e[r];t[r]=mr(s)?s.map(n):n(s)}return t}const wl=()=>{},mr=Array.isArray,V_=/#/g,tx=/&/g,nx=/\//g,rx=/=/g,sx=/\?/g,N_=/\+/g,ix=/%5B/g,ox=/%5D/g,O_=/%5E/g,ax=/%60/g,M_=/%7B/g,lx=/%7C/g,L_=/%7D/g,ux=/%20/g;function ap(n){return encodeURI(""+n).replace(lx,"|").replace(ix,"[").replace(ox,"]")}function cx(n){return ap(n).replace(M_,"{").replace(L_,"}").replace(O_,"^")}function of(n){return ap(n).replace(N_,"%2B").replace(ux,"+").replace(V_,"%23").replace(tx,"%26").replace(ax,"`").replace(M_,"{").replace(L_,"}").replace(O_,"^")}function dx(n){return of(n).replace(rx,"%3D")}function hx(n){return ap(n).replace(V_,"%23").replace(sx,"%3F")}function fx(n){return n==null?"":hx(n).replace(nx,"%2F")}function Nl(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const px=/\/$/,mx=n=>n.replace(px,"");function Ah(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=_x(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:Nl(o)}}function gx(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function mg(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function vx(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&Yo(e.matched[r],t.matched[s])&&F_(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Yo(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function F_(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!yx(n[t],e[t]))return!1;return!0}function yx(n,e){return mr(n)?gg(n,e):mr(e)?gg(e,n):n===e}function gg(n,e){return mr(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function _x(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const Ts={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Ol;(function(n){n.pop="pop",n.push="push"})(Ol||(Ol={}));var Il;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Il||(Il={}));function bx(n){if(!n)if(Do){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),mx(n)}const wx=/^[^#]+#/;function Ix(n,e){return n.replace(wx,"#")+e}function Ex(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const Ed=()=>({left:window.scrollX,top:window.scrollY});function Tx(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=Ex(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function vg(n,e){return(history.state?history.state.position-e:-1)+n}const af=new Map;function xx(n,e){af.set(n,e)}function Ax(n){const e=af.get(n);return af.delete(n),e}let Sx=()=>location.protocol+"//"+location.host;function U_(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),mg(l,"")}return mg(t,n)+r+s}function Px(n,e,t,r){let s=[],i=[],o=null;const a=({state:v})=>{const y=U_(n,location),C=t.value,A=e.value;let k=0;if(v){if(t.value=y,e.value=v,o&&o===C){o=null;return}k=A?v.position-A.position:0}else r(y);s.forEach(U=>{U(t.value,C,{delta:k,type:Ol.pop,direction:k?k>0?Il.forward:Il.back:Il.unknown})})};function l(){o=t.value}function c(v){s.push(v);const y=()=>{const C=s.indexOf(v);C>-1&&s.splice(C,1)};return i.push(y),y}function f(){const{history:v}=window;v.state&&v.replaceState(ot({},v.state,{scroll:Ed()}),"")}function m(){for(const v of i)v();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",f)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",f,{passive:!0}),{pauseListeners:l,listen:c,destroy:m}}function yg(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?Ed():null}}function Rx(n){const{history:e,location:t}=window,r={value:U_(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,f){const m=n.indexOf("#"),v=m>-1?(t.host&&document.querySelector("base")?n:n.slice(m))+l:Sx()+n+l;try{e[f?"replaceState":"pushState"](c,"",v),s.value=c}catch(y){console.error(y),t[f?"replace":"assign"](v)}}function o(l,c){const f=ot({},e.state,yg(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,f,!0),r.value=l}function a(l,c){const f=ot({},s.value,e.state,{forward:l,scroll:Ed()});i(f.current,f,!0);const m=ot({},yg(r.value,l,null),{position:f.position+1},c);i(l,m,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function Cx(n){n=bx(n);const e=Rx(n),t=Px(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=ot({location:"",base:n,go:r,createHref:Ix.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function kx(n){return typeof n=="string"||n&&typeof n=="object"}function $_(n){return typeof n=="string"||typeof n=="symbol"}const j_=Symbol("");var _g;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(_g||(_g={}));function Xo(n,e){return ot(new Error,{type:n,[j_]:!0},e)}function jr(n,e){return n instanceof Error&&j_ in n&&(e==null||!!(n.type&e))}const bg="[^/]+?",Dx={sensitive:!1,strict:!1,start:!0,end:!0},Vx=/[.+*?^${}()[\]/\\]/g;function Nx(n,e){const t=ot({},Dx,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const f=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let m=0;m<c.length;m++){const v=c[m];let y=40+(t.sensitive?.25:0);if(v.type===0)m||(s+="/"),s+=v.value.replace(Vx,"\\$&"),y+=40;else if(v.type===1){const{value:C,repeatable:A,optional:k,regexp:U}=v;i.push({name:C,repeatable:A,optional:k});const j=U||bg;if(j!==bg){y+=10;try{new RegExp(`(${j})`)}catch(q){throw new Error(`Invalid custom RegExp for param "${C}" (${j}): `+q.message)}}let M=A?`((?:${j})(?:/(?:${j}))*)`:`(${j})`;m||(M=k&&c.length<2?`(?:/${M})`:"/"+M),k&&(M+="?"),s+=M,y+=20,k&&(y+=-8),A&&(y+=-20),j===".*"&&(y+=-50)}f.push(y)}r.push(f)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const f=c.match(o),m={};if(!f)return null;for(let v=1;v<f.length;v++){const y=f[v]||"",C=i[v-1];m[C.name]=y&&C.repeatable?y.split("/"):y}return m}function l(c){let f="",m=!1;for(const v of n){(!m||!f.endsWith("/"))&&(f+="/"),m=!1;for(const y of v)if(y.type===0)f+=y.value;else if(y.type===1){const{value:C,repeatable:A,optional:k}=y,U=C in c?c[C]:"";if(mr(U)&&!A)throw new Error(`Provided param "${C}" is an array but it is not repeatable (* or + modifiers)`);const j=mr(U)?U.join("/"):U;if(!j)if(k)v.length<2&&(f.endsWith("/")?f=f.slice(0,-1):m=!0);else throw new Error(`Missing required param "${C}"`);f+=j}}return f||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function Ox(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function B_(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=Ox(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(wg(r))return 1;if(wg(s))return-1}return s.length-r.length}function wg(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const Mx={type:0,value:""},Lx=/[a-zA-Z0-9_]/;function Fx(n){if(!n)return[[]];if(n==="/")return[[Mx]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(y){throw new Error(`ERR (${t})/"${c}": ${y}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",f="";function m(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:f,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function v(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&m(),o()):l===":"?(m(),t=1):v();break;case 4:v(),t=r;break;case 1:l==="("?t=2:Lx.test(l)?v():(m(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?f[f.length-1]=="\\"?f=f.slice(0,-1)+l:t=3:f+=l;break;case 3:m(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,f="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),m(),o(),s}function Ux(n,e,t){const r=Nx(Fx(n.path),t),s=ot(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function $x(n,e){const t=[],r=new Map;e=xg({strict:!1,end:!0,sensitive:!1},e);function s(m){return r.get(m)}function i(m,v,y){const C=!y,A=Eg(m);A.aliasOf=y&&y.record;const k=xg(e,m),U=[A];if("alias"in m){const q=typeof m.alias=="string"?[m.alias]:m.alias;for(const ee of q)U.push(Eg(ot({},A,{components:y?y.record.components:A.components,path:ee,aliasOf:y?y.record:A})))}let j,M;for(const q of U){const{path:ee}=q;if(v&&ee[0]!=="/"){const Z=v.record.path,I=Z[Z.length-1]==="/"?"":"/";q.path=v.record.path+(ee&&I+ee)}if(j=Ux(q,v,k),y?y.alias.push(j):(M=M||j,M!==j&&M.alias.push(j),C&&m.name&&!Tg(j)&&o(m.name)),q_(j)&&l(j),A.children){const Z=A.children;for(let I=0;I<Z.length;I++)i(Z[I],j,y&&y.children[I])}y=y||j}return M?()=>{o(M)}:wl}function o(m){if($_(m)){const v=r.get(m);v&&(r.delete(m),t.splice(t.indexOf(v),1),v.children.forEach(o),v.alias.forEach(o))}else{const v=t.indexOf(m);v>-1&&(t.splice(v,1),m.record.name&&r.delete(m.record.name),m.children.forEach(o),m.alias.forEach(o))}}function a(){return t}function l(m){const v=qx(m,t);t.splice(v,0,m),m.record.name&&!Tg(m)&&r.set(m.record.name,m)}function c(m,v){let y,C={},A,k;if("name"in m&&m.name){if(y=r.get(m.name),!y)throw Xo(1,{location:m});k=y.record.name,C=ot(Ig(v.params,y.keys.filter(M=>!M.optional).concat(y.parent?y.parent.keys.filter(M=>M.optional):[]).map(M=>M.name)),m.params&&Ig(m.params,y.keys.map(M=>M.name))),A=y.stringify(C)}else if(m.path!=null)A=m.path,y=t.find(M=>M.re.test(A)),y&&(C=y.parse(A),k=y.record.name);else{if(y=v.name?r.get(v.name):t.find(M=>M.re.test(v.path)),!y)throw Xo(1,{location:m,currentLocation:v});k=y.record.name,C=ot({},v.params,m.params),A=y.stringify(C)}const U=[];let j=y;for(;j;)U.unshift(j.record),j=j.parent;return{name:k,path:A,params:C,matched:U,meta:Bx(U)}}n.forEach(m=>i(m));function f(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:f,getRoutes:a,getRecordMatcher:s}}function Ig(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function Eg(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:jx(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function jx(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function Tg(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function Bx(n){return n.reduce((e,t)=>ot(e,t.meta),{})}function xg(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function qx(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;B_(n,e[i])<0?r=i:t=i+1}const s=zx(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function zx(n){let e=n;for(;e=e.parent;)if(q_(e)&&B_(n,e)===0)return e}function q_({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function Gx(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(N_," "),o=i.indexOf("="),a=Nl(o<0?i:i.slice(0,o)),l=o<0?null:Nl(i.slice(o+1));if(a in e){let c=e[a];mr(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function Ag(n){let e="";for(let t in n){const r=n[t];if(t=dx(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(mr(r)?r.map(i=>i&&of(i)):[r&&of(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function Kx(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=mr(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const Hx=Symbol(""),Sg=Symbol(""),Td=Symbol(""),lp=Symbol(""),lf=Symbol("");function Za(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function Cs(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=v=>{v===!1?l(Xo(4,{from:t,to:e})):v instanceof Error?l(v):kx(v)?l(Xo(2,{from:e,to:v})):(o&&r.enterCallbacks[s]===o&&typeof v=="function"&&o.push(v),a())},f=i(()=>n.call(r&&r.instances[s],e,t,c));let m=Promise.resolve(f);n.length<3&&(m=m.then(c)),m.catch(v=>l(v))})}function Sh(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(D_(l)){const f=(l.__vccOpts||l)[e];f&&i.push(Cs(f,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(f=>{if(!f)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const m=ex(f)?f.default:f;o.mods[a]=f,o.components[a]=m;const y=(m.__vccOpts||m)[e];return y&&Cs(y,t,r,o,a,s)()}))}}return i}function Pg(n){const e=pr(Td),t=pr(lp),r=We(()=>{const l=Qr(n.to);return e.resolve(l)}),s=We(()=>{const{matched:l}=r.value,{length:c}=l,f=l[c-1],m=t.matched;if(!f||!m.length)return-1;const v=m.findIndex(Yo.bind(null,f));if(v>-1)return v;const y=Rg(l[c-2]);return c>1&&Rg(f)===y&&m[m.length-1].path!==y?m.findIndex(Yo.bind(null,l[c-2])):v}),i=We(()=>s.value>-1&&Xx(t.params,r.value.params)),o=We(()=>s.value>-1&&s.value===t.matched.length-1&&F_(t.params,r.value.params));function a(l={}){if(Yx(l)){const c=e[Qr(n.replace)?"replace":"push"](Qr(n.to)).catch(wl);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:We(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function Wx(n){return n.length===1?n[0]:n}const Qx=r_({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:Pg,setup(n,{slots:e}){const t=vd(Pg(n)),{options:r}=pr(Td),s=We(()=>({[Cg(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[Cg(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&Wx(e.default(t));return n.custom?i:P_("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),Jx=Qx;function Yx(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function Xx(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!mr(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function Rg(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const Cg=(n,e,t)=>n??e??t,Zx=r_({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=pr(lf),s=We(()=>n.route||r.value),i=pr(Sg,0),o=We(()=>{let c=Qr(i);const{matched:f}=s.value;let m;for(;(m=f[c])&&!m.components;)c++;return c}),a=We(()=>s.value.matched[o.value]);pc(Sg,We(()=>o.value+1)),pc(Hx,a),pc(lf,s);const l=N();return Jt(()=>[l.value,a.value,n.name],([c,f,m],[v,y,C])=>{f&&(f.instances[m]=c,y&&y!==f&&c&&c===v&&(f.leaveGuards.size||(f.leaveGuards=y.leaveGuards),f.updateGuards.size||(f.updateGuards=y.updateGuards))),c&&f&&(!y||!Yo(f,y)||!v)&&(f.enterCallbacks[m]||[]).forEach(A=>A(c))},{flush:"post"}),()=>{const c=s.value,f=n.name,m=a.value,v=m&&m.components[f];if(!v)return kg(t.default,{Component:v,route:c});const y=m.props[f],C=y?y===!0?c.params:typeof y=="function"?y(c):y:null,k=P_(v,ot({},C,e,{onVnodeUnmounted:U=>{U.component.isUnmounted&&(m.instances[f]=null)},ref:l}));return kg(t.default,{Component:k,route:c})||k}}});function kg(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const eA=Zx;function tA(n){const e=$x(n.routes,n),t=n.parseQuery||Gx,r=n.stringifyQuery||Ag,s=n.history,i=Za(),o=Za(),a=Za(),l=cE(Ts);let c=Ts;Do&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const f=xh.bind(null,K=>""+K),m=xh.bind(null,fx),v=xh.bind(null,Nl);function y(K,pe){let de,be;return $_(K)?(de=e.getRecordMatcher(K),be=pe):be=K,e.addRoute(be,de)}function C(K){const pe=e.getRecordMatcher(K);pe&&e.removeRoute(pe)}function A(){return e.getRoutes().map(K=>K.record)}function k(K){return!!e.getRecordMatcher(K)}function U(K,pe){if(pe=ot({},pe||l.value),typeof K=="string"){const S=Ah(t,K,pe.path),V=e.resolve({path:S.path},pe),H=s.createHref(S.fullPath);return ot(S,V,{params:v(V.params),hash:Nl(S.hash),redirectedFrom:void 0,href:H})}let de;if(K.path!=null)de=ot({},K,{path:Ah(t,K.path,pe.path).path});else{const S=ot({},K.params);for(const V in S)S[V]==null&&delete S[V];de=ot({},K,{params:m(S)}),pe.params=m(pe.params)}const be=e.resolve(de,pe),qe=K.hash||"";be.params=f(v(be.params));const nt=gx(r,ot({},K,{hash:cx(qe),path:be.path})),E=s.createHref(nt);return ot({fullPath:nt,hash:qe,query:r===Ag?Kx(K.query):K.query||{}},be,{redirectedFrom:void 0,href:E})}function j(K){return typeof K=="string"?Ah(t,K,l.value.path):ot({},K)}function M(K,pe){if(c!==K)return Xo(8,{from:pe,to:K})}function q(K){return I(K)}function ee(K){return q(ot(j(K),{replace:!0}))}function Z(K){const pe=K.matched[K.matched.length-1];if(pe&&pe.redirect){const{redirect:de}=pe;let be=typeof de=="function"?de(K):de;return typeof be=="string"&&(be=be.includes("?")||be.includes("#")?be=j(be):{path:be},be.params={}),ot({query:K.query,hash:K.hash,params:be.path!=null?{}:K.params},be)}}function I(K,pe){const de=c=U(K),be=l.value,qe=K.state,nt=K.force,E=K.replace===!0,S=Z(de);if(S)return I(ot(j(S),{state:typeof S=="object"?ot({},qe,S.state):qe,force:nt,replace:E}),pe||de);const V=de;V.redirectedFrom=pe;let H;return!nt&&vx(r,be,de)&&(H=Xo(16,{to:V,from:be}),Se(be,be,!0,!1)),(H?Promise.resolve(H):P(V,be)).catch(z=>jr(z)?jr(z,2)?z:Y(z):Oe(z,V,be)).then(z=>{if(z){if(jr(z,2))return I(ot({replace:E},j(z.to),{state:typeof z.to=="object"?ot({},qe,z.to.state):qe,force:nt}),pe||V)}else z=D(V,be,!0,E,qe);return R(V,be,z),z})}function w(K,pe){const de=M(K,pe);return de?Promise.reject(de):Promise.resolve()}function T(K){const pe=rt.values().next().value;return pe&&typeof pe.runWithContext=="function"?pe.runWithContext(K):K()}function P(K,pe){let de;const[be,qe,nt]=nA(K,pe);de=Sh(be.reverse(),"beforeRouteLeave",K,pe);for(const S of be)S.leaveGuards.forEach(V=>{de.push(Cs(V,K,pe))});const E=w.bind(null,K,pe);return de.push(E),Mt(de).then(()=>{de=[];for(const S of i.list())de.push(Cs(S,K,pe));return de.push(E),Mt(de)}).then(()=>{de=Sh(qe,"beforeRouteUpdate",K,pe);for(const S of qe)S.updateGuards.forEach(V=>{de.push(Cs(V,K,pe))});return de.push(E),Mt(de)}).then(()=>{de=[];for(const S of nt)if(S.beforeEnter)if(mr(S.beforeEnter))for(const V of S.beforeEnter)de.push(Cs(V,K,pe));else de.push(Cs(S.beforeEnter,K,pe));return de.push(E),Mt(de)}).then(()=>(K.matched.forEach(S=>S.enterCallbacks={}),de=Sh(nt,"beforeRouteEnter",K,pe,T),de.push(E),Mt(de))).then(()=>{de=[];for(const S of o.list())de.push(Cs(S,K,pe));return de.push(E),Mt(de)}).catch(S=>jr(S,8)?S:Promise.reject(S))}function R(K,pe,de){a.list().forEach(be=>T(()=>be(K,pe,de)))}function D(K,pe,de,be,qe){const nt=M(K,pe);if(nt)return nt;const E=pe===Ts,S=Do?history.state:{};de&&(be||E?s.replace(K.fullPath,ot({scroll:E&&S&&S.scroll},qe)):s.push(K.fullPath,qe)),l.value=K,Se(K,pe,de,E),Y()}let b;function Ue(){b||(b=s.listen((K,pe,de)=>{if(!tn.listening)return;const be=U(K),qe=Z(be);if(qe){I(ot(qe,{replace:!0,force:!0}),be).catch(wl);return}c=be;const nt=l.value;Do&&xx(vg(nt.fullPath,de.delta),Ed()),P(be,nt).catch(E=>jr(E,12)?E:jr(E,2)?(I(ot(j(E.to),{force:!0}),be).then(S=>{jr(S,20)&&!de.delta&&de.type===Ol.pop&&s.go(-1,!1)}).catch(wl),Promise.reject()):(de.delta&&s.go(-de.delta,!1),Oe(E,be,nt))).then(E=>{E=E||D(be,nt,!1),E&&(de.delta&&!jr(E,8)?s.go(-de.delta,!1):de.type===Ol.pop&&jr(E,20)&&s.go(-1,!1)),R(be,nt,E)}).catch(wl)}))}let Ce=Za(),Xe=Za(),Fe;function Oe(K,pe,de){Y(K);const be=Xe.list();return be.length?be.forEach(qe=>qe(K,pe,de)):console.error(K),Promise.reject(K)}function Ae(){return Fe&&l.value!==Ts?Promise.resolve():new Promise((K,pe)=>{Ce.add([K,pe])})}function Y(K){return Fe||(Fe=!K,Ue(),Ce.list().forEach(([pe,de])=>K?de(K):pe()),Ce.reset()),K}function Se(K,pe,de,be){const{scrollBehavior:qe}=n;if(!Do||!qe)return Promise.resolve();const nt=!de&&Ax(vg(K.fullPath,0))||(be||!de)&&history.state&&history.state.scroll||null;return rn().then(()=>qe(K,pe,nt)).then(E=>E&&Tx(E)).catch(E=>Oe(E,K,pe))}const _e=K=>s.go(K);let ke;const rt=new Set,tn={currentRoute:l,listening:!0,addRoute:y,removeRoute:C,clearRoutes:e.clearRoutes,hasRoute:k,getRoutes:A,resolve:U,options:n,push:q,replace:ee,go:_e,back:()=>_e(-1),forward:()=>_e(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:Xe.add,isReady:Ae,install(K){const pe=this;K.component("RouterLink",Jx),K.component("RouterView",eA),K.config.globalProperties.$router=pe,Object.defineProperty(K.config.globalProperties,"$route",{enumerable:!0,get:()=>Qr(l)}),Do&&!ke&&l.value===Ts&&(ke=!0,q(s.location).catch(qe=>{}));const de={};for(const qe in Ts)Object.defineProperty(de,qe,{get:()=>l.value[qe],enumerable:!0});K.provide(Td,pe),K.provide(lp,Wy(de)),K.provide(lf,l);const be=K.unmount;rt.add(K),K.unmount=function(){rt.delete(K),rt.size<1&&(c=Ts,b&&b(),b=null,l.value=Ts,ke=!1,Fe=!1),be()}}};function Mt(K){return K.reduce((pe,de)=>pe.then(()=>T(de)),Promise.resolve())}return tn}function nA(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>Yo(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>Yo(c,l))||s.push(l))}return[t,r,s]}function ru(){return pr(Td)}function su(n){return pr(lp)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z_=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},rA=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},G_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,f=i>>2,m=(i&3)<<4|a>>4;let v=(a&15)<<2|c>>6,y=c&63;l||(y=64,o||(v=64)),r.push(t[f],t[m],t[v],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(z_(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):rA(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const m=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||m==null)throw new sA;const v=i<<2|a>>4;if(r.push(v),c!==64){const y=a<<4&240|c>>2;if(r.push(y),m!==64){const C=c<<6&192|m;r.push(C)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class sA extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const iA=function(n){const e=z_(n);return G_.encodeByteArray(e,!0)},jc=function(n){return iA(n).replace(/\./g,"")},K_=function(n){try{return G_.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aA=()=>oA().__FIREBASE_DEFAULTS__,lA=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},uA=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&K_(n[1]);return e&&JSON.parse(e)},xd=()=>{try{return aA()||lA()||uA()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},H_=n=>{var e,t;return(t=(e=xd())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},cA=n=>{const e=H_(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},W_=()=>{var n;return(n=xd())===null||n===void 0?void 0:n.config},Q_=n=>{var e;return(e=xd())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dA{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hA(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[jc(JSON.stringify(t)),jc(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function fA(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Zt())}function pA(){var n;const e=(n=xd())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function mA(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function gA(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function vA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function yA(){const n=Zt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function J_(){return!pA()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Y_(){try{return typeof indexedDB=="object"}catch{return!1}}function _A(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bA="FirebaseError";class os extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=bA,Object.setPrototypeOf(this,os.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,iu.prototype.create)}}class iu{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?wA(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new os(s,a,r)}}function wA(n,e){return n.replace(IA,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const IA=/\{\$([^}]+)}/g;function EA(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ws(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(Dg(i)&&Dg(o)){if(!Ws(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Dg(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function va(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function al(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function ll(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function TA(n,e){const t=new xA(n,e);return t.subscribe.bind(t)}class xA{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");AA(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Ph),s.error===void 0&&(s.error=Ph),s.complete===void 0&&(s.complete=Ph);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function AA(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Ph(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Te(n){return n&&n._delegate?n._delegate:n}class Ui{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SA{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new dA;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(RA(e))try{this.getOrInitializeService({instanceIdentifier:xi})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=xi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=xi){return this.instances.has(e)}getOptions(e=xi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:PA(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=xi){return this.component?this.component.multipleInstances?e:xi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function PA(n){return n===xi?void 0:n}function RA(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CA{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new SA(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var He;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(He||(He={}));const kA={debug:He.DEBUG,verbose:He.VERBOSE,info:He.INFO,warn:He.WARN,error:He.ERROR,silent:He.SILENT},DA=He.INFO,VA={[He.DEBUG]:"log",[He.VERBOSE]:"log",[He.INFO]:"info",[He.WARN]:"warn",[He.ERROR]:"error"},NA=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=VA[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class up{constructor(e){this.name=e,this._logLevel=DA,this._logHandler=NA,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in He))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?kA[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,He.DEBUG,...e),this._logHandler(this,He.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,He.VERBOSE,...e),this._logHandler(this,He.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,He.INFO,...e),this._logHandler(this,He.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,He.WARN,...e),this._logHandler(this,He.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,He.ERROR,...e),this._logHandler(this,He.ERROR,...e)}}const OA=(n,e)=>e.some(t=>n instanceof t);let Vg,Ng;function MA(){return Vg||(Vg=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function LA(){return Ng||(Ng=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const X_=new WeakMap,uf=new WeakMap,Z_=new WeakMap,Rh=new WeakMap,cp=new WeakMap;function FA(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(js(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&X_.set(t,n)}).catch(()=>{}),cp.set(e,n),e}function UA(n){if(uf.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});uf.set(n,e)}let cf={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return uf.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Z_.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return js(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function $A(n){cf=n(cf)}function jA(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Ch(this),e,...t);return Z_.set(r,e.sort?e.sort():[e]),js(r)}:LA().includes(n)?function(...e){return n.apply(Ch(this),e),js(X_.get(this))}:function(...e){return js(n.apply(Ch(this),e))}}function BA(n){return typeof n=="function"?jA(n):(n instanceof IDBTransaction&&UA(n),OA(n,MA())?new Proxy(n,cf):n)}function js(n){if(n instanceof IDBRequest)return FA(n);if(Rh.has(n))return Rh.get(n);const e=BA(n);return e!==n&&(Rh.set(n,e),cp.set(e,n)),e}const Ch=n=>cp.get(n);function qA(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=js(o);return r&&o.addEventListener("upgradeneeded",l=>{r(js(o.result),l.oldVersion,l.newVersion,js(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const zA=["get","getKey","getAll","getAllKeys","count"],GA=["put","add","delete","clear"],kh=new Map;function Og(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(kh.get(e))return kh.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=GA.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||zA.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return kh.set(e,i),i}$A(n=>({...n,get:(e,t,r)=>Og(e,t)||n.get(e,t,r),has:(e,t)=>!!Og(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KA{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(HA(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function HA(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const df="@firebase/app",Mg="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zr=new up("@firebase/app"),WA="@firebase/app-compat",QA="@firebase/analytics-compat",JA="@firebase/analytics",YA="@firebase/app-check-compat",XA="@firebase/app-check",ZA="@firebase/auth",eS="@firebase/auth-compat",tS="@firebase/database",nS="@firebase/data-connect",rS="@firebase/database-compat",sS="@firebase/functions",iS="@firebase/functions-compat",oS="@firebase/installations",aS="@firebase/installations-compat",lS="@firebase/messaging",uS="@firebase/messaging-compat",cS="@firebase/performance",dS="@firebase/performance-compat",hS="@firebase/remote-config",fS="@firebase/remote-config-compat",pS="@firebase/storage",mS="@firebase/storage-compat",gS="@firebase/firestore",vS="@firebase/vertexai-preview",yS="@firebase/firestore-compat",_S="firebase",bS="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bc="[DEFAULT]",wS={[df]:"fire-core",[WA]:"fire-core-compat",[JA]:"fire-analytics",[QA]:"fire-analytics-compat",[XA]:"fire-app-check",[YA]:"fire-app-check-compat",[ZA]:"fire-auth",[eS]:"fire-auth-compat",[tS]:"fire-rtdb",[nS]:"fire-data-connect",[rS]:"fire-rtdb-compat",[sS]:"fire-fn",[iS]:"fire-fn-compat",[oS]:"fire-iid",[aS]:"fire-iid-compat",[lS]:"fire-fcm",[uS]:"fire-fcm-compat",[cS]:"fire-perf",[dS]:"fire-perf-compat",[hS]:"fire-rc",[fS]:"fire-rc-compat",[pS]:"fire-gcs",[mS]:"fire-gcs-compat",[gS]:"fire-fst",[yS]:"fire-fst-compat",[vS]:"fire-vertex","fire-js":"fire-js",[_S]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qc=new Map,IS=new Map,hf=new Map;function Lg(n,e){try{n.container.addComponent(e)}catch(t){Zr.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Zo(n){const e=n.name;if(hf.has(e))return Zr.debug(`There were multiple attempts to register component ${e}.`),!1;hf.set(e,n);for(const t of qc.values())Lg(t,n);for(const t of IS.values())Lg(t,n);return!0}function ou(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function ES(n,e,t=Bc){ou(n,e).clearInstance(t)}function Gt(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TS={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Bs=new iu("app","Firebase",TS);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xS{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ui("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Bs.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ya=bS;function e0(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Bc,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Bs.create("bad-app-name",{appName:String(s)});if(t||(t=W_()),!t)throw Bs.create("no-options");const i=qc.get(s);if(i){if(Ws(t,i.options)&&Ws(r,i.config))return i;throw Bs.create("duplicate-app",{appName:s})}const o=new CA(s);for(const l of hf.values())o.addComponent(l);const a=new xS(t,r,o);return qc.set(s,a),a}function t0(n=Bc){const e=qc.get(n);if(!e&&n===Bc&&W_())return e0();if(!e)throw Bs.create("no-app",{appName:n});return e}function qs(n,e,t){var r;let s=(r=wS[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Zr.warn(a.join(" "));return}Zo(new Ui(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AS="firebase-heartbeat-database",SS=1,Ml="firebase-heartbeat-store";let Dh=null;function n0(){return Dh||(Dh=qA(AS,SS,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ml)}catch(t){console.warn(t)}}}}).catch(n=>{throw Bs.create("idb-open",{originalErrorMessage:n.message})})),Dh}async function PS(n){try{const t=(await n0()).transaction(Ml),r=await t.objectStore(Ml).get(r0(n));return await t.done,r}catch(e){if(e instanceof os)Zr.warn(e.message);else{const t=Bs.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Zr.warn(t.message)}}}async function Fg(n,e){try{const r=(await n0()).transaction(Ml,"readwrite");await r.objectStore(Ml).put(e,r0(n)),await r.done}catch(t){if(t instanceof os)Zr.warn(t.message);else{const r=Bs.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Zr.warn(r.message)}}}function r0(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RS=1024,CS=30*24*60*60*1e3;class kS{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new VS(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Ug();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=CS}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Zr.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Ug(),{heartbeatsToSend:r,unsentEntries:s}=DS(this._heartbeatsCache.heartbeats),i=jc(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Zr.warn(t),""}}}function Ug(){return new Date().toISOString().substring(0,10)}function DS(n,e=RS){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),$g(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),$g(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class VS{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Y_()?_A().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await PS(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Fg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Fg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function $g(n){return jc(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NS(n){Zo(new Ui("platform-logger",e=>new KA(e),"PRIVATE")),Zo(new Ui("heartbeat",e=>new kS(e),"PRIVATE")),qs(df,Mg,n),qs(df,Mg,"esm2017"),qs("fire-js","")}NS("");var OS="firebase",MS="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */qs(OS,MS,"app");var jg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Oi,s0;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(I,w){function T(){}T.prototype=w.prototype,I.D=w.prototype,I.prototype=new T,I.prototype.constructor=I,I.C=function(P,R,D){for(var b=Array(arguments.length-2),Ue=2;Ue<arguments.length;Ue++)b[Ue-2]=arguments[Ue];return w.prototype[R].apply(P,b)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,w,T){T||(T=0);var P=Array(16);if(typeof w=="string")for(var R=0;16>R;++R)P[R]=w.charCodeAt(T++)|w.charCodeAt(T++)<<8|w.charCodeAt(T++)<<16|w.charCodeAt(T++)<<24;else for(R=0;16>R;++R)P[R]=w[T++]|w[T++]<<8|w[T++]<<16|w[T++]<<24;w=I.g[0],T=I.g[1],R=I.g[2];var D=I.g[3],b=w+(D^T&(R^D))+P[0]+3614090360&4294967295;w=T+(b<<7&4294967295|b>>>25),b=D+(R^w&(T^R))+P[1]+3905402710&4294967295,D=w+(b<<12&4294967295|b>>>20),b=R+(T^D&(w^T))+P[2]+606105819&4294967295,R=D+(b<<17&4294967295|b>>>15),b=T+(w^R&(D^w))+P[3]+3250441966&4294967295,T=R+(b<<22&4294967295|b>>>10),b=w+(D^T&(R^D))+P[4]+4118548399&4294967295,w=T+(b<<7&4294967295|b>>>25),b=D+(R^w&(T^R))+P[5]+1200080426&4294967295,D=w+(b<<12&4294967295|b>>>20),b=R+(T^D&(w^T))+P[6]+2821735955&4294967295,R=D+(b<<17&4294967295|b>>>15),b=T+(w^R&(D^w))+P[7]+4249261313&4294967295,T=R+(b<<22&4294967295|b>>>10),b=w+(D^T&(R^D))+P[8]+1770035416&4294967295,w=T+(b<<7&4294967295|b>>>25),b=D+(R^w&(T^R))+P[9]+2336552879&4294967295,D=w+(b<<12&4294967295|b>>>20),b=R+(T^D&(w^T))+P[10]+4294925233&4294967295,R=D+(b<<17&4294967295|b>>>15),b=T+(w^R&(D^w))+P[11]+2304563134&4294967295,T=R+(b<<22&4294967295|b>>>10),b=w+(D^T&(R^D))+P[12]+1804603682&4294967295,w=T+(b<<7&4294967295|b>>>25),b=D+(R^w&(T^R))+P[13]+4254626195&4294967295,D=w+(b<<12&4294967295|b>>>20),b=R+(T^D&(w^T))+P[14]+2792965006&4294967295,R=D+(b<<17&4294967295|b>>>15),b=T+(w^R&(D^w))+P[15]+1236535329&4294967295,T=R+(b<<22&4294967295|b>>>10),b=w+(R^D&(T^R))+P[1]+4129170786&4294967295,w=T+(b<<5&4294967295|b>>>27),b=D+(T^R&(w^T))+P[6]+3225465664&4294967295,D=w+(b<<9&4294967295|b>>>23),b=R+(w^T&(D^w))+P[11]+643717713&4294967295,R=D+(b<<14&4294967295|b>>>18),b=T+(D^w&(R^D))+P[0]+3921069994&4294967295,T=R+(b<<20&4294967295|b>>>12),b=w+(R^D&(T^R))+P[5]+3593408605&4294967295,w=T+(b<<5&4294967295|b>>>27),b=D+(T^R&(w^T))+P[10]+38016083&4294967295,D=w+(b<<9&4294967295|b>>>23),b=R+(w^T&(D^w))+P[15]+3634488961&4294967295,R=D+(b<<14&4294967295|b>>>18),b=T+(D^w&(R^D))+P[4]+3889429448&4294967295,T=R+(b<<20&4294967295|b>>>12),b=w+(R^D&(T^R))+P[9]+568446438&4294967295,w=T+(b<<5&4294967295|b>>>27),b=D+(T^R&(w^T))+P[14]+3275163606&4294967295,D=w+(b<<9&4294967295|b>>>23),b=R+(w^T&(D^w))+P[3]+4107603335&4294967295,R=D+(b<<14&4294967295|b>>>18),b=T+(D^w&(R^D))+P[8]+1163531501&4294967295,T=R+(b<<20&4294967295|b>>>12),b=w+(R^D&(T^R))+P[13]+2850285829&4294967295,w=T+(b<<5&4294967295|b>>>27),b=D+(T^R&(w^T))+P[2]+4243563512&4294967295,D=w+(b<<9&4294967295|b>>>23),b=R+(w^T&(D^w))+P[7]+1735328473&4294967295,R=D+(b<<14&4294967295|b>>>18),b=T+(D^w&(R^D))+P[12]+2368359562&4294967295,T=R+(b<<20&4294967295|b>>>12),b=w+(T^R^D)+P[5]+4294588738&4294967295,w=T+(b<<4&4294967295|b>>>28),b=D+(w^T^R)+P[8]+2272392833&4294967295,D=w+(b<<11&4294967295|b>>>21),b=R+(D^w^T)+P[11]+1839030562&4294967295,R=D+(b<<16&4294967295|b>>>16),b=T+(R^D^w)+P[14]+4259657740&4294967295,T=R+(b<<23&4294967295|b>>>9),b=w+(T^R^D)+P[1]+2763975236&4294967295,w=T+(b<<4&4294967295|b>>>28),b=D+(w^T^R)+P[4]+1272893353&4294967295,D=w+(b<<11&4294967295|b>>>21),b=R+(D^w^T)+P[7]+4139469664&4294967295,R=D+(b<<16&4294967295|b>>>16),b=T+(R^D^w)+P[10]+3200236656&4294967295,T=R+(b<<23&4294967295|b>>>9),b=w+(T^R^D)+P[13]+681279174&4294967295,w=T+(b<<4&4294967295|b>>>28),b=D+(w^T^R)+P[0]+3936430074&4294967295,D=w+(b<<11&4294967295|b>>>21),b=R+(D^w^T)+P[3]+3572445317&4294967295,R=D+(b<<16&4294967295|b>>>16),b=T+(R^D^w)+P[6]+76029189&4294967295,T=R+(b<<23&4294967295|b>>>9),b=w+(T^R^D)+P[9]+3654602809&4294967295,w=T+(b<<4&4294967295|b>>>28),b=D+(w^T^R)+P[12]+3873151461&4294967295,D=w+(b<<11&4294967295|b>>>21),b=R+(D^w^T)+P[15]+530742520&4294967295,R=D+(b<<16&4294967295|b>>>16),b=T+(R^D^w)+P[2]+3299628645&4294967295,T=R+(b<<23&4294967295|b>>>9),b=w+(R^(T|~D))+P[0]+4096336452&4294967295,w=T+(b<<6&4294967295|b>>>26),b=D+(T^(w|~R))+P[7]+1126891415&4294967295,D=w+(b<<10&4294967295|b>>>22),b=R+(w^(D|~T))+P[14]+2878612391&4294967295,R=D+(b<<15&4294967295|b>>>17),b=T+(D^(R|~w))+P[5]+4237533241&4294967295,T=R+(b<<21&4294967295|b>>>11),b=w+(R^(T|~D))+P[12]+1700485571&4294967295,w=T+(b<<6&4294967295|b>>>26),b=D+(T^(w|~R))+P[3]+2399980690&4294967295,D=w+(b<<10&4294967295|b>>>22),b=R+(w^(D|~T))+P[10]+4293915773&4294967295,R=D+(b<<15&4294967295|b>>>17),b=T+(D^(R|~w))+P[1]+2240044497&4294967295,T=R+(b<<21&4294967295|b>>>11),b=w+(R^(T|~D))+P[8]+1873313359&4294967295,w=T+(b<<6&4294967295|b>>>26),b=D+(T^(w|~R))+P[15]+4264355552&4294967295,D=w+(b<<10&4294967295|b>>>22),b=R+(w^(D|~T))+P[6]+2734768916&4294967295,R=D+(b<<15&4294967295|b>>>17),b=T+(D^(R|~w))+P[13]+1309151649&4294967295,T=R+(b<<21&4294967295|b>>>11),b=w+(R^(T|~D))+P[4]+4149444226&4294967295,w=T+(b<<6&4294967295|b>>>26),b=D+(T^(w|~R))+P[11]+3174756917&4294967295,D=w+(b<<10&4294967295|b>>>22),b=R+(w^(D|~T))+P[2]+718787259&4294967295,R=D+(b<<15&4294967295|b>>>17),b=T+(D^(R|~w))+P[9]+3951481745&4294967295,I.g[0]=I.g[0]+w&4294967295,I.g[1]=I.g[1]+(R+(b<<21&4294967295|b>>>11))&4294967295,I.g[2]=I.g[2]+R&4294967295,I.g[3]=I.g[3]+D&4294967295}r.prototype.u=function(I,w){w===void 0&&(w=I.length);for(var T=w-this.blockSize,P=this.B,R=this.h,D=0;D<w;){if(R==0)for(;D<=T;)s(this,I,D),D+=this.blockSize;if(typeof I=="string"){for(;D<w;)if(P[R++]=I.charCodeAt(D++),R==this.blockSize){s(this,P),R=0;break}}else for(;D<w;)if(P[R++]=I[D++],R==this.blockSize){s(this,P),R=0;break}}this.h=R,this.o+=w},r.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var w=1;w<I.length-8;++w)I[w]=0;var T=8*this.o;for(w=I.length-8;w<I.length;++w)I[w]=T&255,T/=256;for(this.u(I),I=Array(16),w=T=0;4>w;++w)for(var P=0;32>P;P+=8)I[T++]=this.g[w]>>>P&255;return I};function i(I,w){var T=a;return Object.prototype.hasOwnProperty.call(T,I)?T[I]:T[I]=w(I)}function o(I,w){this.h=w;for(var T=[],P=!0,R=I.length-1;0<=R;R--){var D=I[R]|0;P&&D==w||(T[R]=D,P=!1)}this.g=T}var a={};function l(I){return-128<=I&&128>I?i(I,function(w){return new o([w|0],0>w?-1:0)}):new o([I|0],0>I?-1:0)}function c(I){if(isNaN(I)||!isFinite(I))return m;if(0>I)return k(c(-I));for(var w=[],T=1,P=0;I>=T;P++)w[P]=I/T|0,T*=4294967296;return new o(w,0)}function f(I,w){if(I.length==0)throw Error("number format error: empty string");if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(I.charAt(0)=="-")return k(f(I.substring(1),w));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var T=c(Math.pow(w,8)),P=m,R=0;R<I.length;R+=8){var D=Math.min(8,I.length-R),b=parseInt(I.substring(R,R+D),w);8>D?(D=c(Math.pow(w,D)),P=P.j(D).add(c(b))):(P=P.j(T),P=P.add(c(b)))}return P}var m=l(0),v=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(A(this))return-k(this).m();for(var I=0,w=1,T=0;T<this.g.length;T++){var P=this.i(T);I+=(0<=P?P:4294967296+P)*w,w*=4294967296}return I},n.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(C(this))return"0";if(A(this))return"-"+k(this).toString(I);for(var w=c(Math.pow(I,6)),T=this,P="";;){var R=q(T,w).g;T=U(T,R.j(w));var D=((0<T.g.length?T.g[0]:T.h)>>>0).toString(I);if(T=R,C(T))return D+P;for(;6>D.length;)D="0"+D;P=D+P}},n.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function C(I){if(I.h!=0)return!1;for(var w=0;w<I.g.length;w++)if(I.g[w]!=0)return!1;return!0}function A(I){return I.h==-1}n.l=function(I){return I=U(this,I),A(I)?-1:C(I)?0:1};function k(I){for(var w=I.g.length,T=[],P=0;P<w;P++)T[P]=~I.g[P];return new o(T,~I.h).add(v)}n.abs=function(){return A(this)?k(this):this},n.add=function(I){for(var w=Math.max(this.g.length,I.g.length),T=[],P=0,R=0;R<=w;R++){var D=P+(this.i(R)&65535)+(I.i(R)&65535),b=(D>>>16)+(this.i(R)>>>16)+(I.i(R)>>>16);P=b>>>16,D&=65535,b&=65535,T[R]=b<<16|D}return new o(T,T[T.length-1]&-2147483648?-1:0)};function U(I,w){return I.add(k(w))}n.j=function(I){if(C(this)||C(I))return m;if(A(this))return A(I)?k(this).j(k(I)):k(k(this).j(I));if(A(I))return k(this.j(k(I)));if(0>this.l(y)&&0>I.l(y))return c(this.m()*I.m());for(var w=this.g.length+I.g.length,T=[],P=0;P<2*w;P++)T[P]=0;for(P=0;P<this.g.length;P++)for(var R=0;R<I.g.length;R++){var D=this.i(P)>>>16,b=this.i(P)&65535,Ue=I.i(R)>>>16,Ce=I.i(R)&65535;T[2*P+2*R]+=b*Ce,j(T,2*P+2*R),T[2*P+2*R+1]+=D*Ce,j(T,2*P+2*R+1),T[2*P+2*R+1]+=b*Ue,j(T,2*P+2*R+1),T[2*P+2*R+2]+=D*Ue,j(T,2*P+2*R+2)}for(P=0;P<w;P++)T[P]=T[2*P+1]<<16|T[2*P];for(P=w;P<2*w;P++)T[P]=0;return new o(T,0)};function j(I,w){for(;(I[w]&65535)!=I[w];)I[w+1]+=I[w]>>>16,I[w]&=65535,w++}function M(I,w){this.g=I,this.h=w}function q(I,w){if(C(w))throw Error("division by zero");if(C(I))return new M(m,m);if(A(I))return w=q(k(I),w),new M(k(w.g),k(w.h));if(A(w))return w=q(I,k(w)),new M(k(w.g),w.h);if(30<I.g.length){if(A(I)||A(w))throw Error("slowDivide_ only works with positive integers.");for(var T=v,P=w;0>=P.l(I);)T=ee(T),P=ee(P);var R=Z(T,1),D=Z(P,1);for(P=Z(P,2),T=Z(T,2);!C(P);){var b=D.add(P);0>=b.l(I)&&(R=R.add(T),D=b),P=Z(P,1),T=Z(T,1)}return w=U(I,R.j(w)),new M(R,w)}for(R=m;0<=I.l(w);){for(T=Math.max(1,Math.floor(I.m()/w.m())),P=Math.ceil(Math.log(T)/Math.LN2),P=48>=P?1:Math.pow(2,P-48),D=c(T),b=D.j(w);A(b)||0<b.l(I);)T-=P,D=c(T),b=D.j(w);C(D)&&(D=v),R=R.add(D),I=U(I,b)}return new M(R,I)}n.A=function(I){return q(this,I).h},n.and=function(I){for(var w=Math.max(this.g.length,I.g.length),T=[],P=0;P<w;P++)T[P]=this.i(P)&I.i(P);return new o(T,this.h&I.h)},n.or=function(I){for(var w=Math.max(this.g.length,I.g.length),T=[],P=0;P<w;P++)T[P]=this.i(P)|I.i(P);return new o(T,this.h|I.h)},n.xor=function(I){for(var w=Math.max(this.g.length,I.g.length),T=[],P=0;P<w;P++)T[P]=this.i(P)^I.i(P);return new o(T,this.h^I.h)};function ee(I){for(var w=I.g.length+1,T=[],P=0;P<w;P++)T[P]=I.i(P)<<1|I.i(P-1)>>>31;return new o(T,I.h)}function Z(I,w){var T=w>>5;w%=32;for(var P=I.g.length-T,R=[],D=0;D<P;D++)R[D]=0<w?I.i(D+T)>>>w|I.i(D+T+1)<<32-w:I.i(D+T);return new o(R,I.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,s0=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=f,Oi=o}).apply(typeof jg<"u"?jg:typeof self<"u"?self:typeof window<"u"?window:{});var sc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var i0,ul,o0,yc,ff,a0,l0,u0;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,d){return u==Array.prototype||u==Object.prototype||(u[p]=d.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof sc=="object"&&sc];for(var p=0;p<u.length;++p){var d=u[p];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var d=r;u=u.split(".");for(var h=0;h<u.length-1;h++){var _=u[h];if(!(_ in d))break e;d=d[_]}u=u[u.length-1],h=d[u],p=p(h),p!=h&&p!=null&&e(d,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var d=0,h=!1,_={next:function(){if(!h&&d<u.length){var x=d++;return{value:p(x,u[x]),done:!1}}return h=!0,{done:!0,value:void 0}}};return _[Symbol.iterator]=function(){return _},_}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,d){return d})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function c(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function f(u,p,d){return u.call.apply(u.bind,arguments)}function m(u,p,d){if(!u)throw Error();if(2<arguments.length){var h=Array.prototype.slice.call(arguments,2);return function(){var _=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(_,h),u.apply(p,_)}}return function(){return u.apply(p,arguments)}}function v(u,p,d){return v=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:m,v.apply(null,arguments)}function y(u,p){var d=Array.prototype.slice.call(arguments,1);return function(){var h=d.slice();return h.push.apply(h,arguments),u.apply(this,h)}}function C(u,p){function d(){}d.prototype=p.prototype,u.aa=p.prototype,u.prototype=new d,u.prototype.constructor=u,u.Qb=function(h,_,x){for(var F=Array(arguments.length-2),oe=2;oe<arguments.length;oe++)F[oe-2]=arguments[oe];return p.prototype[_].apply(h,F)}}function A(u){const p=u.length;if(0<p){const d=Array(p);for(let h=0;h<p;h++)d[h]=u[h];return d}return[]}function k(u,p){for(let d=1;d<arguments.length;d++){const h=arguments[d];if(l(h)){const _=u.length||0,x=h.length||0;u.length=_+x;for(let F=0;F<x;F++)u[_+F]=h[F]}else u.push(h)}}class U{constructor(p,d){this.i=p,this.j=d,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function j(u){return/^[\s\xa0]*$/.test(u)}function M(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function q(u){return q[" "](u),u}q[" "]=function(){};var ee=M().indexOf("Gecko")!=-1&&!(M().toLowerCase().indexOf("webkit")!=-1&&M().indexOf("Edge")==-1)&&!(M().indexOf("Trident")!=-1||M().indexOf("MSIE")!=-1)&&M().indexOf("Edge")==-1;function Z(u,p,d){for(const h in u)p.call(d,u[h],h,u)}function I(u,p){for(const d in u)p.call(void 0,u[d],d,u)}function w(u){const p={};for(const d in u)p[d]=u[d];return p}const T="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function P(u,p){let d,h;for(let _=1;_<arguments.length;_++){h=arguments[_];for(d in h)u[d]=h[d];for(let x=0;x<T.length;x++)d=T[x],Object.prototype.hasOwnProperty.call(h,d)&&(u[d]=h[d])}}function R(u){var p=1;u=u.split(":");const d=[];for(;0<p&&u.length;)d.push(u.shift()),p--;return u.length&&d.push(u.join(":")),d}function D(u){a.setTimeout(()=>{throw u},0)}function b(){var u=Ae;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class Ue{constructor(){this.h=this.g=null}add(p,d){const h=Ce.get();h.set(p,d),this.h?this.h.next=h:this.g=h,this.h=h}}var Ce=new U(()=>new Xe,u=>u.reset());class Xe{constructor(){this.next=this.g=this.h=null}set(p,d){this.h=p,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Fe,Oe=!1,Ae=new Ue,Y=()=>{const u=a.Promise.resolve(void 0);Fe=()=>{u.then(Se)}};var Se=()=>{for(var u;u=b();){try{u.h.call(u.g)}catch(d){D(d)}var p=Ce;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}Oe=!1};function _e(){this.s=this.s,this.C=this.C}_e.prototype.s=!1,_e.prototype.ma=function(){this.s||(this.s=!0,this.N())},_e.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ke(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}ke.prototype.h=function(){this.defaultPrevented=!0};var rt=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const d=()=>{};a.addEventListener("test",d,p),a.removeEventListener("test",d,p)}catch{}return u}();function tn(u,p){if(ke.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var d=this.type=u.type,h=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(ee){e:{try{q(p.nodeName);var _=!0;break e}catch{}_=!1}_||(p=null)}}else d=="mouseover"?p=u.fromElement:d=="mouseout"&&(p=u.toElement);this.relatedTarget=p,h?(this.clientX=h.clientX!==void 0?h.clientX:h.pageX,this.clientY=h.clientY!==void 0?h.clientY:h.pageY,this.screenX=h.screenX||0,this.screenY=h.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:Mt[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&tn.aa.h.call(this)}}C(tn,ke);var Mt={2:"touch",3:"pen",4:"mouse"};tn.prototype.h=function(){tn.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var K="closure_listenable_"+(1e6*Math.random()|0),pe=0;function de(u,p,d,h,_){this.listener=u,this.proxy=null,this.src=p,this.type=d,this.capture=!!h,this.ha=_,this.key=++pe,this.da=this.fa=!1}function be(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function qe(u){this.src=u,this.g={},this.h=0}qe.prototype.add=function(u,p,d,h,_){var x=u.toString();u=this.g[x],u||(u=this.g[x]=[],this.h++);var F=E(u,p,h,_);return-1<F?(p=u[F],d||(p.fa=!1)):(p=new de(p,this.src,x,!!h,_),p.fa=d,u.push(p)),p};function nt(u,p){var d=p.type;if(d in u.g){var h=u.g[d],_=Array.prototype.indexOf.call(h,p,void 0),x;(x=0<=_)&&Array.prototype.splice.call(h,_,1),x&&(be(p),u.g[d].length==0&&(delete u.g[d],u.h--))}}function E(u,p,d,h){for(var _=0;_<u.length;++_){var x=u[_];if(!x.da&&x.listener==p&&x.capture==!!d&&x.ha==h)return _}return-1}var S="closure_lm_"+(1e6*Math.random()|0),V={};function H(u,p,d,h,_){if(h&&h.once)return le(u,p,d,h,_);if(Array.isArray(p)){for(var x=0;x<p.length;x++)H(u,p[x],d,h,_);return null}return d=we(d),u&&u[K]?u.K(p,d,c(h)?!!h.capture:!!h,_):z(u,p,d,!1,h,_)}function z(u,p,d,h,_,x){if(!p)throw Error("Invalid event type");var F=c(_)?!!_.capture:!!_,oe=he(u);if(oe||(u[S]=oe=new qe(u)),d=oe.add(p,d,h,F,x),d.proxy)return d;if(h=W(),d.proxy=h,h.src=u,h.listener=d,u.addEventListener)rt||(_=F),_===void 0&&(_=!1),u.addEventListener(p.toString(),h,_);else if(u.attachEvent)u.attachEvent(X(p.toString()),h);else if(u.addListener&&u.removeListener)u.addListener(h);else throw Error("addEventListener and attachEvent are unavailable.");return d}function W(){function u(d){return p.call(u.src,u.listener,d)}const p=ge;return u}function le(u,p,d,h,_){if(Array.isArray(p)){for(var x=0;x<p.length;x++)le(u,p[x],d,h,_);return null}return d=we(d),u&&u[K]?u.L(p,d,c(h)?!!h.capture:!!h,_):z(u,p,d,!0,h,_)}function re(u,p,d,h,_){if(Array.isArray(p))for(var x=0;x<p.length;x++)re(u,p[x],d,h,_);else h=c(h)?!!h.capture:!!h,d=we(d),u&&u[K]?(u=u.i,p=String(p).toString(),p in u.g&&(x=u.g[p],d=E(x,d,h,_),-1<d&&(be(x[d]),Array.prototype.splice.call(x,d,1),x.length==0&&(delete u.g[p],u.h--)))):u&&(u=he(u))&&(p=u.g[p.toString()],u=-1,p&&(u=E(p,d,h,_)),(d=-1<u?p[u]:null)&&ne(d))}function ne(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[K])nt(p.i,u);else{var d=u.type,h=u.proxy;p.removeEventListener?p.removeEventListener(d,h,u.capture):p.detachEvent?p.detachEvent(X(d),h):p.addListener&&p.removeListener&&p.removeListener(h),(d=he(p))?(nt(d,u),d.h==0&&(d.src=null,p[S]=null)):be(u)}}}function X(u){return u in V?V[u]:V[u]="on"+u}function ge(u,p){if(u.da)u=!0;else{p=new tn(p,this);var d=u.listener,h=u.ha||u.src;u.fa&&ne(u),u=d.call(h,p)}return u}function he(u){return u=u[S],u instanceof qe?u:null}var ve="__closure_events_fn_"+(1e9*Math.random()>>>0);function we(u){return typeof u=="function"?u:(u[ve]||(u[ve]=function(p){return u.handleEvent(p)}),u[ve])}function xe(){_e.call(this),this.i=new qe(this),this.M=this,this.F=null}C(xe,_e),xe.prototype[K]=!0,xe.prototype.removeEventListener=function(u,p,d,h){re(this,u,p,d,h)};function Me(u,p){var d,h=u.F;if(h)for(d=[];h;h=h.F)d.push(h);if(u=u.M,h=p.type||p,typeof p=="string")p=new ke(p,u);else if(p instanceof ke)p.target=p.target||u;else{var _=p;p=new ke(h,u),P(p,_)}if(_=!0,d)for(var x=d.length-1;0<=x;x--){var F=p.g=d[x];_=Ge(F,h,!0,p)&&_}if(F=p.g=u,_=Ge(F,h,!0,p)&&_,_=Ge(F,h,!1,p)&&_,d)for(x=0;x<d.length;x++)F=p.g=d[x],_=Ge(F,h,!1,p)&&_}xe.prototype.N=function(){if(xe.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var d=u.g[p],h=0;h<d.length;h++)be(d[h]);delete u.g[p],u.h--}}this.F=null},xe.prototype.K=function(u,p,d,h){return this.i.add(String(u),p,!1,d,h)},xe.prototype.L=function(u,p,d,h){return this.i.add(String(u),p,!0,d,h)};function Ge(u,p,d,h){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var _=!0,x=0;x<p.length;++x){var F=p[x];if(F&&!F.da&&F.capture==d){var oe=F.listener,te=F.ha||F.src;F.fa&&nt(u.i,F),_=oe.call(te,h)!==!1&&_}}return _&&!h.defaultPrevented}function Lt(u,p,d){if(typeof u=="function")d&&(u=v(u,d));else if(u&&typeof u.handleEvent=="function")u=v(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(u,p||0)}function xt(u){u.g=Lt(()=>{u.g=null,u.i&&(u.i=!1,xt(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class cn extends _e{constructor(p,d){super(),this.m=p,this.l=d,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:xt(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function jt(u){_e.call(this),this.h=u,this.g={}}C(jt,_e);var gn=[];function Zn(u){Z(u.g,function(p,d){this.g.hasOwnProperty(d)&&ne(p)},u),u.g={}}jt.prototype.N=function(){jt.aa.N.call(this),Zn(this)},jt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var vt=a.JSON.stringify,Xt=a.JSON.parse,zn=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function ro(){}ro.prototype.h=null;function li(u){return u.h||(u.h=u.i())}function so(){}var ui={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function On(){ke.call(this,"d")}C(On,ke);function io(){ke.call(this,"c")}C(io,ke);var gr={},oo=null;function ao(){return oo=oo||new xe}gr.La="serverreachability";function vn(u){ke.call(this,gr.La,u)}C(vn,ke);function er(u){const p=ao();Me(p,new vn(p))}gr.STAT_EVENT="statevent";function Da(u,p){ke.call(this,gr.STAT_EVENT,u),this.stat=p}C(Da,ke);function nn(u){const p=ao();Me(p,new Da(p,u))}gr.Ma="timingevent";function ps(u,p){ke.call(this,gr.Ma,u),this.size=p}C(ps,ke);function or(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function vr(){this.g=!0}vr.prototype.xa=function(){this.g=!1};function ms(u,p,d,h,_,x){u.info(function(){if(u.g)if(x)for(var F="",oe=x.split("&"),te=0;te<oe.length;te++){var ce=oe[te].split("=");if(1<ce.length){var Pe=ce[0];ce=ce[1];var $e=Pe.split("_");F=2<=$e.length&&$e[1]=="type"?F+(Pe+"="+ce+"&"):F+(Pe+"=redacted&")}}else F=null;else F=x;return"XMLHTTP REQ ("+h+") [attempt "+_+"]: "+p+`
`+d+`
`+F})}function Cu(u,p,d,h,_,x,F){u.info(function(){return"XMLHTTP RESP ("+h+") [ attempt "+_+"]: "+p+`
`+d+`
`+x+" "+F})}function ar(u,p,d,h){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+lh(u,d)+(h?" "+h:"")})}function lr(u,p){u.info(function(){return"TIMEOUT: "+p})}vr.prototype.info=function(){};function lh(u,p){if(!u.g)return p;if(!p)return null;try{var d=JSON.parse(p);if(d){for(u=0;u<d.length;u++)if(Array.isArray(d[u])){var h=d[u];if(!(2>h.length)){var _=h[1];if(Array.isArray(_)&&!(1>_.length)){var x=_[0];if(x!="noop"&&x!="stop"&&x!="close")for(var F=1;F<_.length;F++)_[F]=""}}}}return vt(d)}catch{return p}}var lo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ci={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},di;function Re(){}C(Re,ro),Re.prototype.g=function(){return new XMLHttpRequest},Re.prototype.i=function(){return{}},di=new Re;function Ze(u,p,d,h){this.j=u,this.i=p,this.l=d,this.R=h||1,this.U=new jt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new gs}function gs(){this.i=null,this.g="",this.h=!1}var uo={},Va={};function co(u,p,d){u.L=1,u.v=_s(ur(p)),u.m=d,u.P=!0,ku(u,null)}function ku(u,p){u.F=Date.now(),ho(u),u.A=ur(u.v);var d=u.A,h=u.R;Array.isArray(h)||(h=[String(h)]),Fu(d.i,"t",h),u.C=0,d=u.j.J,u.h=new gs,u.g=Qa(u.j,d?p:null,!u.m),0<u.O&&(u.M=new cn(v(u.Y,u,u.g),u.O)),p=u.U,d=u.g,h=u.ca;var _="readystatechange";Array.isArray(_)||(_&&(gn[0]=_.toString()),_=gn);for(var x=0;x<_.length;x++){var F=H(d,_[x],h||p.handleEvent,!1,p.h||p);if(!F)break;p.g[F.key]=F}p=u.H?w(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),er(),ms(u.i,u.u,u.A,u.l,u.R,u.m)}Ze.prototype.ca=function(u){u=u.target;const p=this.M;p&&dn(u)==3?p.j():this.Y(u)},Ze.prototype.Y=function(u){try{if(u==this.g)e:{const $e=dn(this.g);var p=this.g.Ba();const it=this.g.Z();if(!(3>$e)&&($e!=3||this.g&&(this.h.h||this.g.oa()||Ku(this.g)))){this.J||$e!=4||p==7||(p==8||0>=it?er(3):er(2)),ys(this);var d=this.g.Z();this.X=d;t:if(Du(this)){var h=Ku(this.g);u="";var _=h.length,x=dn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Mn(this),tr(this);var F="";break t}this.h.i=new a.TextDecoder}for(p=0;p<_;p++)this.h.h=!0,u+=this.h.i.decode(h[p],{stream:!(x&&p==_-1)});h.length=0,this.h.g+=u,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=d==200,Cu(this.i,this.u,this.A,this.l,this.R,$e,d),this.o){if(this.T&&!this.K){t:{if(this.g){var oe,te=this.g;if((oe=te.g?te.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(oe)){var ce=oe;break t}}ce=null}if(d=ce)ar(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Vr(this,d);else{this.o=!1,this.s=3,nn(12),Mn(this),tr(this);break e}}if(this.P){d=!0;let et;for(;!this.J&&this.C<F.length;)if(et=Na(this,F),et==Va){$e==4&&(this.s=4,nn(14),d=!1),ar(this.i,this.l,null,"[Incomplete Response]");break}else if(et==uo){this.s=4,nn(15),ar(this.i,this.l,F,"[Invalid Chunk]"),d=!1;break}else ar(this.i,this.l,et,null),Vr(this,et);if(Du(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),$e!=4||F.length!=0||this.h.h||(this.s=1,nn(16),d=!1),this.o=this.o&&d,!d)ar(this.i,this.l,F,"[Invalid Chunked Response]"),Mn(this),tr(this);else if(0<F.length&&!this.W){this.W=!0;var Pe=this.j;Pe.g==this&&Pe.ba&&!Pe.M&&(Pe.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),vi(Pe),Pe.M=!0,nn(11))}}else ar(this.i,this.l,F,null),Vr(this,F);$e==4&&Mn(this),this.o&&!this.J&&($e==4?Zu(this.j,this):(this.o=!1,ho(this)))}else Hu(this.g),d==400&&0<F.indexOf("Unknown SID")?(this.s=3,nn(12)):(this.s=0,nn(13)),Mn(this),tr(this)}}}catch{}finally{}};function Du(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function Na(u,p){var d=u.C,h=p.indexOf(`
`,d);return h==-1?Va:(d=Number(p.substring(d,h)),isNaN(d)?uo:(h+=1,h+d>p.length?Va:(p=p.slice(h,h+d),u.C=h+d,p)))}Ze.prototype.cancel=function(){this.J=!0,Mn(this)};function ho(u){u.S=Date.now()+u.I,vs(u,u.I)}function vs(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=or(v(u.ba,u),p)}function ys(u){u.B&&(a.clearTimeout(u.B),u.B=null)}Ze.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(lr(this.i,this.A),this.L!=2&&(er(),nn(17)),Mn(this),this.s=2,tr(this)):vs(this,this.S-u)};function tr(u){u.j.G==0||u.J||Zu(u.j,u)}function Mn(u){ys(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,Zn(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function Vr(u,p){try{var d=u.j;if(d.G!=0&&(d.g==u||Oa(d.h,u))){if(!u.K&&Oa(d.h,u)&&d.G==3){try{var h=d.Da.g.parse(p)}catch{h=null}if(Array.isArray(h)&&h.length==3){var _=h;if(_[0]==0){e:if(!d.u){if(d.g)if(d.g.F+3e3<u.F)yi(d),bo(d);else break e;Ka(d),nn(18)}}else d.za=_[1],0<d.za-d.T&&37500>_[2]&&d.F&&d.v==0&&!d.C&&(d.C=or(v(d.Za,d),6e3));if(1>=Nu(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else br(d,11)}else if((u.K||d.g==u)&&yi(d),!j(p))for(_=d.Da.g.parse(p),p=0;p<_.length;p++){let ce=_[p];if(d.T=ce[0],ce=ce[1],d.G==2)if(ce[0]=="c"){d.K=ce[1],d.ia=ce[2];const Pe=ce[3];Pe!=null&&(d.la=Pe,d.j.info("VER="+d.la));const $e=ce[4];$e!=null&&(d.Aa=$e,d.j.info("SVER="+d.Aa));const it=ce[5];it!=null&&typeof it=="number"&&0<it&&(h=1.5*it,d.L=h,d.j.info("backChannelRequestTimeoutMs_="+h)),h=d;const et=u.g;if(et){const Dt=et.g?et.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Dt){var x=h.h;x.g||Dt.indexOf("spdy")==-1&&Dt.indexOf("quic")==-1&&Dt.indexOf("h2")==-1||(x.j=x.l,x.g=new Set,x.h&&(fo(x,x.h),x.h=null))}if(h.D){const Vt=et.g?et.g.getResponseHeader("X-HTTP-Session-Id"):null;Vt&&(h.ya=Vt,st(h.I,h.D,Vt))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-u.F,d.j.info("Handshake RTT: "+d.R+"ms")),h=d;var F=u;if(h.qa=Wa(h,h.J?h.ia:null,h.W),F.K){Le(h.h,F);var oe=F,te=h.L;te&&(oe.I=te),oe.B&&(ys(oe),ho(oe)),h.g=F}else Yu(h);0<d.i.length&&gi(d)}else ce[0]!="stop"&&ce[0]!="close"||br(d,7);else d.G==3&&(ce[0]=="stop"||ce[0]=="close"?ce[0]=="stop"?br(d,7):za(d):ce[0]!="noop"&&d.l&&d.l.ta(ce),d.v=0)}}er(4)}catch{}}var hi=class{constructor(u,p){this.g=u,this.map=p}};function fi(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Vu(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function Nu(u){return u.h?1:u.g?u.g.size:0}function Oa(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function fo(u,p){u.g?u.g.add(p):u.h=p}function Le(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}fi.prototype.cancel=function(){if(this.i=ze(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function ze(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const d of u.g.values())p=p.concat(d.D);return p}return A(u.i)}function Ft(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],d=u.length,h=0;h<d;h++)p.push(u[h]);return p}p=[],d=0;for(h in u)p[d++]=u[h];return p}function pt(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var d=0;d<u;d++)p.push(d);return p}p=[],d=0;for(const h in u)p[d++]=h;return p}}}function Ou(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var d=pt(u),h=Ft(u),_=h.length,x=0;x<_;x++)p.call(void 0,h[x],d&&d[x],u)}var po=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Mu(u,p){if(u){u=u.split("&");for(var d=0;d<u.length;d++){var h=u[d].indexOf("="),_=null;if(0<=h){var x=u[d].substring(0,h);_=u[d].substring(h+1)}else x=u[d];p(x,_?decodeURIComponent(_.replace(/\+/g," ")):"")}}}function Gn(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof Gn){this.h=u.h,yr(this,u.j),this.o=u.o,this.g=u.g,yn(this,u.s),this.l=u.l;var p=u.i,d=new Nr;d.i=p.i,p.g&&(d.g=new Map(p.g),d.h=p.h),Lu(this,d),this.m=u.m}else u&&(p=String(u).match(po))?(this.h=!1,yr(this,p[1]||"",!0),this.o=Rn(p[2]||""),this.g=Rn(p[3]||"",!0),yn(this,p[4]),this.l=Rn(p[5]||"",!0),Lu(this,p[6]||"",!0),this.m=Rn(p[7]||"")):(this.h=!1,this.i=new Nr(null,this.h))}Gn.prototype.toString=function(){var u=[],p=this.j;p&&u.push(pi(p,Ma,!0),":");var d=this.g;return(d||p=="file")&&(u.push("//"),(p=this.o)&&u.push(pi(p,Ma,!0),"@"),u.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&u.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&u.push("/"),u.push(pi(d,d.charAt(0)=="/"?ch:La,!0))),(d=this.i.toString())&&u.push("?",d),(d=this.m)&&u.push("#",pi(d,bs)),u.join("")};function ur(u){return new Gn(u)}function yr(u,p,d){u.j=d?Rn(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function yn(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function Lu(u,p,d){p instanceof Nr?(u.i=p,Uu(u.i,u.h)):(d||(p=pi(p,Fa)),u.i=new Nr(p,u.h))}function st(u,p,d){u.i.set(p,d)}function _s(u){return st(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Rn(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function pi(u,p,d){return typeof u=="string"?(u=encodeURI(u).replace(p,uh),d&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function uh(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var Ma=/[#\/\?@]/g,La=/[#\?:]/g,ch=/[#\?]/g,Fa=/[#\?@]/g,bs=/#/g;function Nr(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Kn(u){u.g||(u.g=new Map,u.h=0,u.i&&Mu(u.i,function(p,d){u.add(decodeURIComponent(p.replace(/\+/g," ")),d)}))}n=Nr.prototype,n.add=function(u,p){Kn(this),this.i=null,u=ws(this,u);var d=this.g.get(u);return d||this.g.set(u,d=[]),d.push(p),this.h+=1,this};function mo(u,p){Kn(u),p=ws(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function Ua(u,p){return Kn(u),p=ws(u,p),u.g.has(p)}n.forEach=function(u,p){Kn(this),this.g.forEach(function(d,h){d.forEach(function(_){u.call(p,_,h,this)},this)},this)},n.na=function(){Kn(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),d=[];for(let h=0;h<p.length;h++){const _=u[h];for(let x=0;x<_.length;x++)d.push(p[h])}return d},n.V=function(u){Kn(this);let p=[];if(typeof u=="string")Ua(this,u)&&(p=p.concat(this.g.get(ws(this,u))));else{u=Array.from(this.g.values());for(let d=0;d<u.length;d++)p=p.concat(u[d])}return p},n.set=function(u,p){return Kn(this),this.i=null,u=ws(this,u),Ua(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function Fu(u,p,d){mo(u,p),0<d.length&&(u.i=null,u.g.set(ws(u,p),A(d)),u.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var d=0;d<p.length;d++){var h=p[d];const x=encodeURIComponent(String(h)),F=this.V(h);for(h=0;h<F.length;h++){var _=x;F[h]!==""&&(_+="="+encodeURIComponent(String(F[h]))),u.push(_)}}return this.i=u.join("&")};function ws(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function Uu(u,p){p&&!u.j&&(Kn(u),u.i=null,u.g.forEach(function(d,h){var _=h.toLowerCase();h!=_&&(mo(this,h),Fu(this,_,d))},u)),u.j=p}function $a(u,p){const d=new vr;if(a.Image){const h=new Image;h.onload=y(Hn,d,"TestLoadImage: loaded",!0,p,h),h.onerror=y(Hn,d,"TestLoadImage: error",!1,p,h),h.onabort=y(Hn,d,"TestLoadImage: abort",!1,p,h),h.ontimeout=y(Hn,d,"TestLoadImage: timeout",!1,p,h),a.setTimeout(function(){h.ontimeout&&h.ontimeout()},1e4),h.src=u}else p(!1)}function go(u,p){const d=new vr,h=new AbortController,_=setTimeout(()=>{h.abort(),Hn(d,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:h.signal}).then(x=>{clearTimeout(_),x.ok?Hn(d,"TestPingServer: ok",!0,p):Hn(d,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(_),Hn(d,"TestPingServer: error",!1,p)})}function Hn(u,p,d,h,_){try{_&&(_.onload=null,_.onerror=null,_.onabort=null,_.ontimeout=null),h(d)}catch{}}function dh(){this.g=new zn}function hh(u,p,d){const h=d||"";try{Ou(u,function(_,x){let F=_;c(_)&&(F=vt(_)),p.push(h+x+"="+encodeURIComponent(F))})}catch(_){throw p.push(h+"type="+encodeURIComponent("_badmap")),_}}function vo(u){this.l=u.Ub||null,this.j=u.eb||!1}C(vo,ro),vo.prototype.g=function(){return new yo(this.l,this.j)},vo.prototype.i=function(u){return function(){return u}}({});function yo(u,p){xe.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(yo,xe),n=yo.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,_r(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,mi(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,_r(this)),this.g&&(this.readyState=3,_r(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;$u(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function $u(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?mi(this):_r(this),this.readyState==3&&$u(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,mi(this))},n.Qa=function(u){this.g&&(this.response=u,mi(this))},n.ga=function(){this.g&&mi(this)};function mi(u){u.readyState=4,u.l=null,u.j=null,u.v=null,_r(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var d=p.next();!d.done;)d=d.value,u.push(d[0]+": "+d[1]),d=p.next();return u.join(`\r
`)};function _r(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(yo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function ju(u){let p="";return Z(u,function(d,h){p+=h,p+=":",p+=d,p+=`\r
`}),p}function ja(u,p,d){e:{for(h in d){var h=!1;break e}h=!0}h||(d=ju(d),typeof u=="string"?d!=null&&encodeURIComponent(String(d)):st(u,p,d))}function At(u){xe.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(At,xe);var Bu=/^https?$/i,fh=["POST","PUT"];n=At.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,d,h){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():di.g(),this.v=this.o?li(this.o):li(di),this.g.onreadystatechange=v(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(x){Ba(this,x);return}if(u=d||"",d=new Map(this.headers),h)if(Object.getPrototypeOf(h)===Object.prototype)for(var _ in h)d.set(_,h[_]);else if(typeof h.keys=="function"&&typeof h.get=="function")for(const x of h.keys())d.set(x,h.get(x));else throw Error("Unknown input type for opt_headers: "+String(h));h=Array.from(d.keys()).find(x=>x.toLowerCase()=="content-type"),_=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(fh,p,void 0))||h||_||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[x,F]of d)this.g.setRequestHeader(x,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Gu(this),this.u=!0,this.g.send(u),this.u=!1}catch(x){Ba(this,x)}};function Ba(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,qu(u),_o(u)}function qu(u){u.A||(u.A=!0,Me(u,"complete"),Me(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,Me(this,"complete"),Me(this,"abort"),_o(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),_o(this,!0)),At.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?zu(this):this.bb())},n.bb=function(){zu(this)};function zu(u){if(u.h&&typeof o<"u"&&(!u.v[1]||dn(u)!=4||u.Z()!=2)){if(u.u&&dn(u)==4)Lt(u.Ea,0,u);else if(Me(u,"readystatechange"),dn(u)==4){u.h=!1;try{const F=u.Z();e:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var d;if(!(d=p)){var h;if(h=F===0){var _=String(u.D).match(po)[1]||null;!_&&a.self&&a.self.location&&(_=a.self.location.protocol.slice(0,-1)),h=!Bu.test(_?_.toLowerCase():"")}d=h}if(d)Me(u,"complete"),Me(u,"success");else{u.m=6;try{var x=2<dn(u)?u.g.statusText:""}catch{x=""}u.l=x+" ["+u.Z()+"]",qu(u)}}finally{_o(u)}}}}function _o(u,p){if(u.g){Gu(u);const d=u.g,h=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||Me(u,"ready");try{d.onreadystatechange=h}catch{}}}function Gu(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function dn(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<dn(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),Xt(p)}};function Ku(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Hu(u){const p={};u=(u.g&&2<=dn(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let h=0;h<u.length;h++){if(j(u[h]))continue;var d=R(u[h]);const _=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();const x=p[_]||[];p[_]=x,x.push(d)}I(p,function(h){return h.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Or(u,p,d){return d&&d.internalChannelParams&&d.internalChannelParams[u]||p}function qa(u){this.Aa=0,this.i=[],this.j=new vr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Or("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Or("baseRetryDelayMs",5e3,u),this.cb=Or("retryDelaySeedMs",1e4,u),this.Wa=Or("forwardChannelMaxRetries",2,u),this.wa=Or("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new fi(u&&u.concurrentRequestLimit),this.Da=new dh,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=qa.prototype,n.la=8,n.G=1,n.connect=function(u,p,d,h){nn(0),this.W=u,this.H=p||{},d&&h!==void 0&&(this.H.OSID=d,this.H.OAID=h),this.F=this.X,this.I=Wa(this,null,this.W),gi(this)};function za(u){if(Wu(u),u.G==3){var p=u.U++,d=ur(u.I);if(st(d,"SID",u.K),st(d,"RID",p),st(d,"TYPE","terminate"),Is(u,d),p=new Ze(u,u.j,p),p.L=2,p.v=_s(ur(d)),d=!1,a.navigator&&a.navigator.sendBeacon)try{d=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!d&&a.Image&&(new Image().src=p.v,d=!0),d||(p.g=Qa(p.j,null),p.g.ea(p.v)),p.F=Date.now(),ho(p)}Ha(u)}function bo(u){u.g&&(vi(u),u.g.cancel(),u.g=null)}function Wu(u){bo(u),u.u&&(a.clearTimeout(u.u),u.u=null),yi(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function gi(u){if(!Vu(u.h)&&!u.s){u.s=!0;var p=u.Ga;Fe||Y(),Oe||(Fe(),Oe=!0),Ae.add(p,u),u.B=0}}function Qu(u,p){return Nu(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=or(v(u.Ga,u,p),wo(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const _=new Ze(this,this.j,u);let x=this.o;if(this.S&&(x?(x=w(x),P(x,this.S)):x=this.S),this.m!==null||this.O||(_.H=x,x=null),this.P)e:{for(var p=0,d=0;d<this.i.length;d++){t:{var h=this.i[d];if("__data__"in h.map&&(h=h.map.__data__,typeof h=="string")){h=h.length;break t}h=void 0}if(h===void 0)break;if(p+=h,4096<p){p=d;break e}if(p===4096||d===this.i.length-1){p=d+1;break e}}p=1e3}else p=1e3;p=Ju(this,_,p),d=ur(this.I),st(d,"RID",u),st(d,"CVER",22),this.D&&st(d,"X-HTTP-Session-Id",this.D),Is(this,d),x&&(this.O?p="headers="+encodeURIComponent(String(ju(x)))+"&"+p:this.m&&ja(d,this.m,x)),fo(this.h,_),this.Ua&&st(d,"TYPE","init"),this.P?(st(d,"$req",p),st(d,"SID","null"),_.T=!0,co(_,d,null)):co(_,d,p),this.G=2}}else this.G==3&&(u?Ga(this,u):this.i.length==0||Vu(this.h)||Ga(this))};function Ga(u,p){var d;p?d=p.l:d=u.U++;const h=ur(u.I);st(h,"SID",u.K),st(h,"RID",d),st(h,"AID",u.T),Is(u,h),u.m&&u.o&&ja(h,u.m,u.o),d=new Ze(u,u.j,d,u.B+1),u.m===null&&(d.H=u.o),p&&(u.i=p.D.concat(u.i)),p=Ju(u,d,1e3),d.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),fo(u.h,d),co(d,h,p)}function Is(u,p){u.H&&Z(u.H,function(d,h){st(p,h,d)}),u.l&&Ou({},function(d,h){st(p,h,d)})}function Ju(u,p,d){d=Math.min(u.i.length,d);var h=u.l?v(u.l.Na,u.l,u):null;e:{var _=u.i;let x=-1;for(;;){const F=["count="+d];x==-1?0<d?(x=_[0].g,F.push("ofs="+x)):x=0:F.push("ofs="+x);let oe=!0;for(let te=0;te<d;te++){let ce=_[te].g;const Pe=_[te].map;if(ce-=x,0>ce)x=Math.max(0,_[te].g-100),oe=!1;else try{hh(Pe,F,"req"+ce+"_")}catch{h&&h(Pe)}}if(oe){h=F.join("&");break e}}}return u=u.i.splice(0,d),p.D=u,h}function Yu(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;Fe||Y(),Oe||(Fe(),Oe=!0),Ae.add(p,u),u.v=0}}function Ka(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=or(v(u.Fa,u),wo(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,Xu(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=or(v(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,nn(10),bo(this),Xu(this))};function vi(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function Xu(u){u.g=new Ze(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=ur(u.qa);st(p,"RID","rpc"),st(p,"SID",u.K),st(p,"AID",u.T),st(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&st(p,"TO",u.ja),st(p,"TYPE","xmlhttp"),Is(u,p),u.m&&u.o&&ja(p,u.m,u.o),u.L&&(u.g.I=u.L);var d=u.g;u=u.ia,d.L=1,d.v=_s(ur(p)),d.m=null,d.P=!0,ku(d,u)}n.Za=function(){this.C!=null&&(this.C=null,bo(this),Ka(this),nn(19))};function yi(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function Zu(u,p){var d=null;if(u.g==p){yi(u),vi(u),u.g=null;var h=2}else if(Oa(u.h,p))d=p.D,Le(u.h,p),h=1;else return;if(u.G!=0){if(p.o)if(h==1){d=p.m?p.m.length:0,p=Date.now()-p.F;var _=u.B;h=ao(),Me(h,new ps(h,d)),gi(u)}else Yu(u);else if(_=p.s,_==3||_==0&&0<p.X||!(h==1&&Qu(u,p)||h==2&&Ka(u)))switch(d&&0<d.length&&(p=u.h,p.i=p.i.concat(d)),_){case 1:br(u,5);break;case 4:br(u,10);break;case 3:br(u,6);break;default:br(u,2)}}}function wo(u,p){let d=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(d*=2),d*p}function br(u,p){if(u.j.info("Error code "+p),p==2){var d=v(u.fb,u),h=u.Xa;const _=!h;h=new Gn(h||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||yr(h,"https"),_s(h),_?$a(h.toString(),d):go(h.toString(),d)}else nn(2);u.G=0,u.l&&u.l.sa(p),Ha(u),Wu(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),nn(2)):(this.j.info("Failed to ping google.com"),nn(1))};function Ha(u){if(u.G=0,u.ka=[],u.l){const p=ze(u.h);(p.length!=0||u.i.length!=0)&&(k(u.ka,p),k(u.ka,u.i),u.h.i.length=0,A(u.i),u.i.length=0),u.l.ra()}}function Wa(u,p,d){var h=d instanceof Gn?ur(d):new Gn(d);if(h.g!="")p&&(h.g=p+"."+h.g),yn(h,h.s);else{var _=a.location;h=_.protocol,p=p?p+"."+_.hostname:_.hostname,_=+_.port;var x=new Gn(null);h&&yr(x,h),p&&(x.g=p),_&&yn(x,_),d&&(x.l=d),h=x}return d=u.D,p=u.ya,d&&p&&st(h,d,p),st(h,"VER",u.la),Is(u,h),h}function Qa(u,p,d){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new At(new vo({eb:d})):new At(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function _i(){}n=_i.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Es(){}Es.prototype.g=function(u,p){return new Cn(u,p)};function Cn(u,p){xe.call(this),this.g=new qa(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!j(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!j(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new Mr(this)}C(Cn,xe),Cn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Cn.prototype.close=function(){za(this.g)},Cn.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var d={};d.__data__=u,u=d}else this.u&&(d={},d.__data__=vt(u),u=d);p.i.push(new hi(p.Ya++,u)),p.G==3&&gi(p)},Cn.prototype.N=function(){this.g.l=null,delete this.j,za(this.g),delete this.g,Cn.aa.N.call(this)};function ec(u){On.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const d in p){u=d;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}C(ec,On);function Io(){io.call(this),this.status=1}C(Io,io);function Mr(u){this.g=u}C(Mr,_i),Mr.prototype.ua=function(){Me(this.g,"a")},Mr.prototype.ta=function(u){Me(this.g,new ec(u))},Mr.prototype.sa=function(u){Me(this.g,new Io)},Mr.prototype.ra=function(){Me(this.g,"b")},Es.prototype.createWebChannel=Es.prototype.g,Cn.prototype.send=Cn.prototype.o,Cn.prototype.open=Cn.prototype.m,Cn.prototype.close=Cn.prototype.close,u0=function(){return new Es},l0=function(){return ao()},a0=gr,ff={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},lo.NO_ERROR=0,lo.TIMEOUT=8,lo.HTTP_ERROR=6,yc=lo,ci.COMPLETE="complete",o0=ci,so.EventType=ui,ui.OPEN="a",ui.CLOSE="b",ui.ERROR="c",ui.MESSAGE="d",xe.prototype.listen=xe.prototype.K,ul=so,At.prototype.listenOnce=At.prototype.L,At.prototype.getLastError=At.prototype.Ka,At.prototype.getLastErrorCode=At.prototype.Ba,At.prototype.getStatus=At.prototype.Z,At.prototype.getResponseJson=At.prototype.Oa,At.prototype.getResponseText=At.prototype.oa,At.prototype.send=At.prototype.ea,At.prototype.setWithCredentials=At.prototype.Ha,i0=At}).apply(typeof sc<"u"?sc:typeof self<"u"?self:typeof window<"u"?window:{});const Bg="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}on.UNAUTHENTICATED=new on(null),on.GOOGLE_CREDENTIALS=new on("google-credentials-uid"),on.FIRST_PARTY=new on("first-party-uid"),on.MOCK_USER=new on("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _a="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qs=new up("@firebase/firestore");function Vo(){return Qs.logLevel}function E4(n){Qs.setLogLevel(n)}function Q(n,...e){if(Qs.logLevel<=He.DEBUG){const t=e.map(dp);Qs.debug(`Firestore (${_a}): ${n}`,...t)}}function zt(n,...e){if(Qs.logLevel<=He.ERROR){const t=e.map(dp);Qs.error(`Firestore (${_a}): ${n}`,...t)}}function sr(n,...e){if(Qs.logLevel<=He.WARN){const t=e.map(dp);Qs.warn(`Firestore (${_a}): ${n}`,...t)}}function dp(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ye(n="Unexpected state"){const e=`FIRESTORE (${_a}) INTERNAL ASSERTION FAILED: `+n;throw zt(e),new Error(e)}function Ie(n,e){n||ye()}function T4(n,e){n||ye()}function ue(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class J extends os{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c0{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class LS{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(on.UNAUTHENTICATED))}shutdown(){}}class FS{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class US{constructor(e){this.t=e,this.currentUser=on.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Ie(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new an;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new an,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{Q("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(Q("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new an)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(Q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ie(typeof r.accessToken=="string"),new c0(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ie(e===null||typeof e=="string"),new on(e)}}class $S{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=on.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class jS{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new $S(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(on.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class d0{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class BS{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Ie(this.o===void 0);const r=i=>{i.error!=null&&Q("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,Q("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{Q("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):Q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Ie(typeof t.token=="string"),this.R=t.token,new d0(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class x4{getToken(){return Promise.resolve(new d0(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qS(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=qS(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Ne(n,e){return n<e?-1:n>e?1:0}function ea(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function f0(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new J(B.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new J(B.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new J(B.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new J(B.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Nt.fromMillis(Date.now())}static fromDate(e){return Nt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Nt(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ne(this.nanoseconds,e.nanoseconds):Ne(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ee{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ee(e)}static min(){return new Ee(new Nt(0,0))}static max(){return new Ee(new Nt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ll{constructor(e,t,r){t===void 0?t=0:t>e.length&&ye(),r===void 0?r=e.length-t:r>e.length-t&&ye(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Ll.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ll?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Qe extends Ll{construct(e,t,r){return new Qe(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new J(B.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new Qe(t)}static emptyPath(){return new Qe([])}}const zS=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Rt extends Ll{construct(e,t,r){return new Rt(e,t,r)}static isValidIdentifier(e){return zS.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Rt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Rt(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new J(B.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new J(B.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new J(B.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new J(B.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Rt(t)}static emptyPath(){return new Rt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fe{constructor(e){this.path=e}static fromPath(e){return new fe(Qe.fromString(e))}static fromName(e){return new fe(Qe.fromString(e).popFirst(5))}static empty(){return new fe(Qe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Qe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Qe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new fe(new Qe(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ta{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function pf(n){return n.fields.find(e=>e.kind===2)}function Ai(n){return n.fields.filter(e=>e.kind!==2)}function GS(n,e){let t=Ne(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=KS(n.fields[r],e.fields[r]),t!==0)return t;return Ne(n.fields.length,e.fields.length)}ta.UNKNOWN_ID=-1;class Mi{constructor(e,t){this.fieldPath=e,this.kind=t}}function KS(n,e){const t=Rt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Ne(n.kind,e.kind)}class na{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new na(0,Xn.min())}}function p0(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Ee.fromTimestamp(r===1e9?new Nt(t+1,0):new Nt(t,r));return new Xn(s,fe.empty(),e)}function m0(n){return new Xn(n.readTime,n.key,-1)}class Xn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Xn(Ee.min(),fe.empty(),-1)}static max(){return new Xn(Ee.max(),fe.empty(),-1)}}function hp(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=fe.comparator(n.documentKey,e.documentKey),t!==0?t:Ne(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g0="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class v0{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ri(n){if(n.code!==B.FAILED_PRECONDITION||n.message!==g0)throw n;Q("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ye(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new O((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof O?t:O.resolve(t)}catch(t){return O.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):O.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):O.reject(t)}static resolve(e){return new O((t,r)=>{t(e)})}static reject(e){return new O((t,r)=>{r(e)})}static waitFor(e){return new O((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=O.resolve(!1);for(const r of e)t=t.next(s=>s?O.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new O((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(f=>{o[c]=f,++a,a===i&&r(o)},f=>s(f))}})}static doWhile(e,t){return new O((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ad{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new an,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new El(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=fp(r.target.error);this.V.reject(new El(e,s))}}static open(e,t,r,s){try{return new Ad(t,e.transaction(s,r))}catch(i){throw new El(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(Q("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new WS(t)}}class Sr{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Sr.S(Zt())===12.2&&zt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Q("SimpleDb","Removing database:",e),Pi(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Y_())return!1;if(Sr.v())return!0;const e=Zt(),t=Sr.S(e),r=0<t&&t<10,s=y0(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(Q("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new El(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new J(B.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new J(B.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new El(e,o))},s.onupgradeneeded=i=>{Q("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{Q("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=Ad.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),O.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(Q("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function y0(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class HS{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Pi(this.B.delete())}}class El extends J{constructor(e,t){super(B.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function si(n){return n.name==="IndexedDbTransactionError"}class WS{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(Q("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(Q("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Pi(r)}add(e){return Q("SimpleDb","ADD",this.store.name,e,e),Pi(this.store.add(e))}get(e){return Pi(this.store.get(e)).next(t=>(t===void 0&&(t=null),Q("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return Q("SimpleDb","DELETE",this.store.name,e),Pi(this.store.delete(e))}count(){return Q("SimpleDb","COUNT",this.store.name),Pi(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new O((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new O((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){Q("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new O((r,s)=>{t.onerror=i=>{const o=fp(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new O((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new HS(a),c=t(a.primaryKey,a.value,l);if(c instanceof O){const f=c.catch(m=>(l.done(),O.reject(m)));r.push(f)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>O.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Pi(n){return new O((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=fp(r.target.error);t(s)}})}let qg=!1;function fp(n){const e=Sr.S(Zt());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new J("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return qg||(qg=!0,setTimeout(()=>{throw r},0)),r}}return n}class QS{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){Q("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{Q("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){si(t)?Q("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await ri(t)}await this.X(6e4)})}}class JS{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return O.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return Q("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(Q("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=m0(i);hp(o,r)>0&&(r=o)}),new Xn(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Un{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Un.oe=-1;function au(n){return n==null}function Fl(n){return n===0&&1/n==-1/0}function _0(n){return typeof n=="number"&&Number.isInteger(n)&&!Fl(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=zg(e)),e=YS(n.get(t),e);return zg(e)}function YS(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function zg(n){return n+""}function Tr(n){const e=n.length;if(Ie(e>=2),e===2)return Ie(n.charAt(0)===""&&n.charAt(1)===""),Qe.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&ye(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:ye()}i=o+2}return new Qe(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gg=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _c(n,e){return[n,Sn(e)]}function b0(n,e,t){return[n,Sn(e),t]}const XS={},ZS=["prefixPath","collectionGroup","readTime","documentId"],eP=["prefixPath","collectionGroup","documentId"],tP=["collectionGroup","readTime","prefixPath","documentId"],nP=["canonicalId","targetId"],rP=["targetId","path"],sP=["path","targetId"],iP=["collectionId","parent"],oP=["indexId","uid"],aP=["uid","sequenceNumber"],lP=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],uP=["indexId","uid","orderedDocumentKey"],cP=["userId","collectionPath","documentId"],dP=["userId","collectionPath","largestBatchId"],hP=["userId","collectionGroup","largestBatchId"],w0=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],fP=[...w0,"documentOverlays"],I0=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],E0=I0,pp=[...E0,"indexConfiguration","indexState","indexEntries"],pP=pp,mP=[...pp,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mf extends v0{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function en(n,e){const t=ue(n);return Sr.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kg(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ii(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function T0(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function x0(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e,t){this.comparator=e,this.root=t||hn.EMPTY}insert(e,t){return new wt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,hn.BLACK,null,null))}remove(e){return new wt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,hn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ic(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ic(this.root,e,this.comparator,!1)}getReverseIterator(){return new ic(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ic(this.root,e,this.comparator,!0)}}class ic{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class hn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??hn.RED,this.left=s??hn.EMPTY,this.right=i??hn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new hn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return hn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return hn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,hn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,hn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ye();const e=this.left.check();if(e!==this.right.check())throw ye();return e+(this.isRed()?0:1)}}hn.EMPTY=null,hn.RED=!0,hn.BLACK=!1;hn.EMPTY=new class{constructor(){this.size=0}get key(){throw ye()}get value(){throw ye()}get color(){throw ye()}get left(){throw ye()}get right(){throw ye()}copy(e,t,r,s,i){return this}insert(e,t,r){return new hn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ft{constructor(e){this.comparator=e,this.data=new wt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Hg(this.data.getIterator())}getIteratorFrom(e){return new Hg(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof ft)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ft(this.comparator);return t.data=e,t}}class Hg{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function xo(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $n{constructor(e){this.fields=e,e.sort(Rt.comparator)}static empty(){return new $n([])}unionWith(e){let t=new ft(Rt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new $n(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ea(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A0 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S4(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new A0("Invalid base64 string: "+i):i}}(e);return new Ut(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Ut(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ne(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ut.EMPTY_BYTE_STRING=new Ut("");const gP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function es(n){if(Ie(!!n),typeof n=="string"){let e=0;const t=gP.exec(n);if(Ie(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Pt(n.seconds),nanos:Pt(n.nanos)}}function Pt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ts(n){return typeof n=="string"?Ut.fromBase64String(n):Ut.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sd(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Pd(n){const e=n.mapValue.fields.__previous_value__;return Sd(e)?Pd(e):e}function Ul(n){const e=es(n.mapValue.fields.__local_write_time__.timestampValue);return new Nt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vP{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class $i{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new $i("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof $i&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Us={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},bc={nullValue:"NULL_VALUE"};function Js(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Sd(n)?4:S0(n)?9007199254740991:Rd(n)?10:11:ye()}function Dr(n,e){if(n===e)return!0;const t=Js(n);if(t!==Js(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ul(n).isEqual(Ul(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=es(s.timestampValue),a=es(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return ts(s.bytesValue).isEqual(ts(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Pt(s.geoPointValue.latitude)===Pt(i.geoPointValue.latitude)&&Pt(s.geoPointValue.longitude)===Pt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Pt(s.integerValue)===Pt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Pt(s.doubleValue),a=Pt(i.doubleValue);return o===a?Fl(o)===Fl(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return ea(n.arrayValue.values||[],e.arrayValue.values||[],Dr);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(Kg(o)!==Kg(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Dr(o[l],a[l])))return!1;return!0}(n,e);default:return ye()}}function $l(n,e){return(n.values||[]).find(t=>Dr(t,e))!==void 0}function Ys(n,e){if(n===e)return 0;const t=Js(n),r=Js(e);if(t!==r)return Ne(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ne(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Pt(i.integerValue||i.doubleValue),l=Pt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return Wg(n.timestampValue,e.timestampValue);case 4:return Wg(Ul(n),Ul(e));case 5:return Ne(n.stringValue,e.stringValue);case 6:return function(i,o){const a=ts(i),l=ts(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const f=Ne(a[c],l[c]);if(f!==0)return f}return Ne(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Ne(Pt(i.latitude),Pt(o.latitude));return a!==0?a:Ne(Pt(i.longitude),Pt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Qg(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,f;const m=i.fields||{},v=o.fields||{},y=(a=m.value)===null||a===void 0?void 0:a.arrayValue,C=(l=v.value)===null||l===void 0?void 0:l.arrayValue,A=Ne(((c=y==null?void 0:y.values)===null||c===void 0?void 0:c.length)||0,((f=C==null?void 0:C.values)===null||f===void 0?void 0:f.length)||0);return A!==0?A:Qg(y,C)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Us.mapValue&&o===Us.mapValue)return 0;if(i===Us.mapValue)return 1;if(o===Us.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},f=Object.keys(c);l.sort(),f.sort();for(let m=0;m<l.length&&m<f.length;++m){const v=Ne(l[m],f[m]);if(v!==0)return v;const y=Ys(a[l[m]],c[f[m]]);if(y!==0)return y}return Ne(l.length,f.length)}(n.mapValue,e.mapValue);default:throw ye()}}function Wg(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ne(n,e);const t=es(n),r=es(e),s=Ne(t.seconds,r.seconds);return s!==0?s:Ne(t.nanos,r.nanos)}function Qg(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Ys(t[s],r[s]);if(i)return i}return Ne(t.length,r.length)}function ra(n){return gf(n)}function gf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=es(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ts(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return fe.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=gf(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${gf(t.fields[o])}`;return s+"}"}(n.mapValue):ye()}function wc(n){switch(Js(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Pd(n);return e?16+wc(e):16;case 5:return 2*n.stringValue.length;case 6:return ts(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+wc(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return ii(r.fields,(i,o)=>{s+=i.length+wc(o)}),s}(n.mapValue);default:throw ye()}}function ji(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function vf(n){return!!n&&"integerValue"in n}function jl(n){return!!n&&"arrayValue"in n}function Jg(n){return!!n&&"nullValue"in n}function Yg(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ic(n){return!!n&&"mapValue"in n}function Rd(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Tl(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return ii(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Tl(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Tl(n.arrayValue.values[t]);return e}return Object.assign({},n)}function S0(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const P0={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function yP(n){return"nullValue"in n?bc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?ji($i.empty(),fe.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Rd(n)?P0:{mapValue:{}}:ye()}function _P(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?ji($i.empty(),fe.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?P0:"mapValue"in n?Rd(n)?{mapValue:{}}:Us:ye()}function Xg(n,e){const t=Ys(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Zg(n,e){const t=Ys(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(e){this.value=e}static empty(){return new pn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ic(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Tl(t)}setAll(e){let t=Rt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Tl(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Ic(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Dr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Ic(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){ii(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new pn(Tl(this.value))}}function R0(n){const e=[];return ii(n.fields,(t,r)=>{const s=new Rt([t]);if(Ic(r)){const i=R0(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new $n(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class It{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new It(e,0,Ee.min(),Ee.min(),Ee.min(),pn.empty(),0)}static newFoundDocument(e,t,r,s){return new It(e,1,t,Ee.min(),r,s,0)}static newNoDocument(e,t){return new It(e,2,t,Ee.min(),Ee.min(),pn.empty(),0)}static newUnknownDocument(e,t){return new It(e,3,t,Ee.min(),Ee.min(),pn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ee.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=pn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=pn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ee.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof It&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new It(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xs{constructor(e,t){this.position=e,this.inclusive=t}}function ev(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=fe.comparator(fe.fromName(o.referenceValue),t.key):r=Ys(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function tv(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Dr(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bl{constructor(e,t="asc"){this.field=e,this.dir=t}}function bP(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C0{}class Je extends C0{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new wP(e,t,r):t==="array-contains"?new TP(e,r):t==="in"?new M0(e,r):t==="not-in"?new xP(e,r):t==="array-contains-any"?new AP(e,r):new Je(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new IP(e,r):new EP(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ys(t,this.value)):t!==null&&Js(this.value)===Js(t)&&this.matchesComparison(Ys(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ye()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ct extends C0{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new ct(e,t)}matches(e){return sa(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function sa(n){return n.op==="and"}function yf(n){return n.op==="or"}function mp(n){return k0(n)&&sa(n)}function k0(n){for(const e of n.filters)if(e instanceof ct)return!1;return!0}function _f(n){if(n instanceof Je)return n.field.canonicalString()+n.op.toString()+ra(n.value);if(mp(n))return n.filters.map(e=>_f(e)).join(",");{const e=n.filters.map(t=>_f(t)).join(",");return`${n.op}(${e})`}}function D0(n,e){return n instanceof Je?function(r,s){return s instanceof Je&&r.op===s.op&&r.field.isEqual(s.field)&&Dr(r.value,s.value)}(n,e):n instanceof ct?function(r,s){return s instanceof ct&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&D0(o,s.filters[a]),!0):!1}(n,e):void ye()}function V0(n,e){const t=n.filters.concat(e);return ct.create(t,n.op)}function N0(n){return n instanceof Je?function(t){return`${t.field.canonicalString()} ${t.op} ${ra(t.value)}`}(n):n instanceof ct?function(t){return t.op.toString()+" {"+t.getFilters().map(N0).join(" ,")+"}"}(n):"Filter"}class wP extends Je{constructor(e,t,r){super(e,t,r),this.key=fe.fromName(r.referenceValue)}matches(e){const t=fe.comparator(e.key,this.key);return this.matchesComparison(t)}}class IP extends Je{constructor(e,t){super(e,"in",t),this.keys=O0("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class EP extends Je{constructor(e,t){super(e,"not-in",t),this.keys=O0("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function O0(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>fe.fromName(r.referenceValue))}class TP extends Je{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return jl(t)&&$l(t.arrayValue,this.value)}}class M0 extends Je{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&$l(this.value.arrayValue,t)}}class xP extends Je{constructor(e,t){super(e,"not-in",t)}matches(e){if($l(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!$l(this.value.arrayValue,t)}}class AP extends Je{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!jl(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>$l(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SP{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function bf(n,e=null,t=[],r=[],s=null,i=null,o=null){return new SP(n,e,t,r,s,i,o)}function Bi(n){const e=ue(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>_f(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),au(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>ra(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>ra(r)).join(",")),e.ue=t}return e.ue}function lu(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!bP(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!D0(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!tv(n.startAt,e.startAt)&&tv(n.endAt,e.endAt)}function zc(n){return fe.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Gc(n,e){return n.filters.filter(t=>t instanceof Je&&t.field.isEqual(e))}function nv(n,e,t){let r=bc,s=!0;for(const i of Gc(n,e)){let o=bc,a=!0;switch(i.op){case"<":case"<=":o=yP(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=bc}Xg({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Xg({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function rv(n,e,t){let r=Us,s=!0;for(const i of Gc(n,e)){let o=Us,a=!0;switch(i.op){case">=":case">":o=_P(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Us}Zg({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Zg({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function L0(n,e,t,r,s,i,o,a){return new as(n,e,t,r,s,i,o,a)}function ba(n){return new as(n)}function sv(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function gp(n){return n.collectionGroup!==null}function qo(n){const e=ue(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ft(Rt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new Bl(i,r))}),t.has(Rt.keyField().canonicalString())||e.ce.push(new Bl(Rt.keyField(),r))}return e.ce}function Pn(n){const e=ue(n);return e.le||(e.le=U0(e,qo(n))),e.le}function F0(n){const e=ue(n);return e.he||(e.he=U0(e,n.explicitOrderBy)),e.he}function U0(n,e){if(n.limitType==="F")return bf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Bl(s.field,i)});const t=n.endAt?new Xs(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Xs(n.startAt.position,n.startAt.inclusive):null;return bf(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function wf(n,e){const t=n.filters.concat([e]);return new as(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Kc(n,e,t){return new as(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function uu(n,e){return lu(Pn(n),Pn(e))&&n.limitType===e.limitType}function $0(n){return`${Bi(Pn(n))}|lt:${n.limitType}`}function No(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>N0(s)).join(", ")}]`),au(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>ra(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>ra(s)).join(",")),`Target(${r})`}(Pn(n))}; limitType=${n.limitType})`}function cu(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):fe.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of qo(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=ev(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,qo(r),s)||r.endAt&&!function(o,a,l){const c=ev(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,qo(r),s))}(n,e)}function j0(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function B0(n){return(e,t)=>{let r=!1;for(const s of qo(n)){const i=PP(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function PP(n,e,t){const r=n.field.isKeyField()?fe.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?Ys(l,c):ye()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ye()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ls{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){ii(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return x0(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RP=new wt(fe.comparator);function jn(){return RP}const q0=new wt(fe.comparator);function cl(...n){let e=q0;for(const t of n)e=e.insert(t.key,t);return e}function z0(n){let e=q0;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function xr(){return xl()}function G0(){return xl()}function xl(){return new ls(n=>n.toString(),(n,e)=>n.isEqual(e))}const CP=new wt(fe.comparator),kP=new ft(fe.comparator);function Be(...n){let e=kP;for(const t of n)e=e.add(t);return e}const DP=new ft(Ne);function vp(){return DP}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yp(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Fl(e)?"-0":e}}function K0(n){return{integerValue:""+n}}function H0(n,e){return _0(e)?K0(e):yp(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cd{constructor(){this._=void 0}}function VP(n,e,t){return n instanceof ia?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Sd(i)&&(i=Pd(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof qi?Q0(n,e):n instanceof zi?J0(n,e):function(s,i){const o=W0(s,i),a=iv(o)+iv(s.Pe);return vf(o)&&vf(s.Pe)?K0(a):yp(s.serializer,a)}(n,e)}function NP(n,e,t){return n instanceof qi?Q0(n,e):n instanceof zi?J0(n,e):t}function W0(n,e){return n instanceof oa?function(r){return vf(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class ia extends Cd{}class qi extends Cd{constructor(e){super(),this.elements=e}}function Q0(n,e){const t=Y0(e);for(const r of n.elements)t.some(s=>Dr(s,r))||t.push(r);return{arrayValue:{values:t}}}class zi extends Cd{constructor(e){super(),this.elements=e}}function J0(n,e){let t=Y0(e);for(const r of n.elements)t=t.filter(s=>!Dr(s,r));return{arrayValue:{values:t}}}class oa extends Cd{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function iv(n){return Pt(n.integerValue||n.doubleValue)}function Y0(n){return jl(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class du{constructor(e,t){this.field=e,this.transform=t}}function OP(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof qi&&s instanceof qi||r instanceof zi&&s instanceof zi?ea(r.elements,s.elements,Dr):r instanceof oa&&s instanceof oa?Dr(r.Pe,s.Pe):r instanceof ia&&s instanceof ia}(n.transform,e.transform)}class MP{constructor(e,t){this.version=e,this.transformResults=t}}class Ct{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ct}static exists(e){return new Ct(void 0,e)}static updateTime(e){return new Ct(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ec(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class kd{}function X0(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ia(n.key,Ct.none()):new wa(n.key,n.data,Ct.none());{const t=n.data,r=pn.empty();let s=new ft(Rt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new us(n.key,r,new $n(s.toArray()),Ct.none())}}function LP(n,e,t){n instanceof wa?function(s,i,o){const a=s.value.clone(),l=av(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof us?function(s,i,o){if(!Ec(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=av(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(Z0(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Al(n,e,t,r){return n instanceof wa?function(i,o,a,l){if(!Ec(i.precondition,o))return a;const c=i.value.clone(),f=lv(i.fieldTransforms,l,o);return c.setAll(f),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof us?function(i,o,a,l){if(!Ec(i.precondition,o))return a;const c=lv(i.fieldTransforms,l,o),f=o.data;return f.setAll(Z0(i)),f.setAll(c),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(m=>m.field))}(n,e,t,r):function(i,o,a){return Ec(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function FP(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=W0(r.transform,s||null);i!=null&&(t===null&&(t=pn.empty()),t.set(r.field,i))}return t||null}function ov(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&ea(r,s,(i,o)=>OP(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class wa extends kd{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class us extends kd{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Z0(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function av(n,e,t){const r=new Map;Ie(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,NP(o,a,t[s]))}return r}function lv(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,VP(i,o,e))}return r}class Ia extends kd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class _p extends kd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bp{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&LP(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Al(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Al(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=G0();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=X0(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Ee.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Be())}isEqual(e){return this.batchId===e.batchId&&ea(this.mutations,e.mutations,(t,r)=>ov(t,r))&&ea(this.baseMutations,e.baseMutations,(t,r)=>ov(t,r))}}class wp{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Ie(e.mutations.length===r.length);let s=function(){return CP}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new wp(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ip{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eb{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UP{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wt,tt;function tb(n){switch(n){default:return ye();case B.CANCELLED:case B.UNKNOWN:case B.DEADLINE_EXCEEDED:case B.RESOURCE_EXHAUSTED:case B.INTERNAL:case B.UNAVAILABLE:case B.UNAUTHENTICATED:return!1;case B.INVALID_ARGUMENT:case B.NOT_FOUND:case B.ALREADY_EXISTS:case B.PERMISSION_DENIED:case B.FAILED_PRECONDITION:case B.ABORTED:case B.OUT_OF_RANGE:case B.UNIMPLEMENTED:case B.DATA_LOSS:return!0}}function nb(n){if(n===void 0)return zt("GRPC error has no .code"),B.UNKNOWN;switch(n){case Wt.OK:return B.OK;case Wt.CANCELLED:return B.CANCELLED;case Wt.UNKNOWN:return B.UNKNOWN;case Wt.DEADLINE_EXCEEDED:return B.DEADLINE_EXCEEDED;case Wt.RESOURCE_EXHAUSTED:return B.RESOURCE_EXHAUSTED;case Wt.INTERNAL:return B.INTERNAL;case Wt.UNAVAILABLE:return B.UNAVAILABLE;case Wt.UNAUTHENTICATED:return B.UNAUTHENTICATED;case Wt.INVALID_ARGUMENT:return B.INVALID_ARGUMENT;case Wt.NOT_FOUND:return B.NOT_FOUND;case Wt.ALREADY_EXISTS:return B.ALREADY_EXISTS;case Wt.PERMISSION_DENIED:return B.PERMISSION_DENIED;case Wt.FAILED_PRECONDITION:return B.FAILED_PRECONDITION;case Wt.ABORTED:return B.ABORTED;case Wt.OUT_OF_RANGE:return B.OUT_OF_RANGE;case Wt.UNIMPLEMENTED:return B.UNIMPLEMENTED;case Wt.DATA_LOSS:return B.DATA_LOSS;default:return ye()}}(tt=Wt||(Wt={}))[tt.OK=0]="OK",tt[tt.CANCELLED=1]="CANCELLED",tt[tt.UNKNOWN=2]="UNKNOWN",tt[tt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",tt[tt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",tt[tt.NOT_FOUND=5]="NOT_FOUND",tt[tt.ALREADY_EXISTS=6]="ALREADY_EXISTS",tt[tt.PERMISSION_DENIED=7]="PERMISSION_DENIED",tt[tt.UNAUTHENTICATED=16]="UNAUTHENTICATED",tt[tt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",tt[tt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",tt[tt.ABORTED=10]="ABORTED",tt[tt.OUT_OF_RANGE=11]="OUT_OF_RANGE",tt[tt.UNIMPLEMENTED=12]="UNIMPLEMENTED",tt[tt.INTERNAL=13]="INTERNAL",tt[tt.UNAVAILABLE=14]="UNAVAILABLE",tt[tt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Hc=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rb(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $P=new Oi([4294967295,4294967295],0);function uv(n){const e=rb().encode(n),t=new s0;return t.update(e),new Uint8Array(t.digest())}function cv(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Oi([t,r],0),new Oi([s,i],0)]}class Ep{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new dl(`Invalid padding: ${t}`);if(r<0)throw new dl(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new dl(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new dl(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Oi.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Oi.fromNumber(r)));return s.compare($P)===1&&(s=new Oi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=uv(e),[r,s]=cv(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Ep(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=uv(e),[r,s]=cv(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class dl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,fu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new hu(Ee.min(),s,new wt(Ne),jn(),Be())}}class fu{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new fu(r,t,Be(),Be(),Be())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tc{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class sb{constructor(e,t){this.targetId=e,this.me=t}}class ib{constructor(e,t,r=Ut.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class dv{constructor(){this.fe=0,this.ge=fv(),this.pe=Ut.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Be(),t=Be(),r=Be();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:ye()}}),new fu(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=fv()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Ie(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class jP{constructor(e){this.Le=e,this.Be=new Map,this.ke=jn(),this.qe=hv(),this.Qe=new wt(Ne)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:ye()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(zc(i))if(r===0){const o=new fe(i.path);this.Ue(t,o,It.newNoDocument(o,Ee.min()))}else Ie(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}Hc==null||Hc.et(function(f,m,v,y,C){var A,k,U,j,M,q;const ee={localCacheCount:f,existenceFilterCount:m.count,databaseId:v.database,projectId:v.projectId},Z=m.unchangedNames;return Z&&(ee.bloomFilter={applied:C===0,hashCount:(A=Z==null?void 0:Z.hashCount)!==null&&A!==void 0?A:0,bitmapLength:(j=(U=(k=Z==null?void 0:Z.bits)===null||k===void 0?void 0:k.bitmap)===null||U===void 0?void 0:U.length)!==null&&j!==void 0?j:0,padding:(q=(M=Z==null?void 0:Z.bits)===null||M===void 0?void 0:M.padding)!==null&&q!==void 0?q:0,mightContain:I=>{var w;return(w=y==null?void 0:y.mightContain(I))!==null&&w!==void 0&&w}}),ee}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=ts(r).toUint8Array()}catch(l){if(l instanceof A0)return sr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Ep(o,s,i)}catch(l){return sr(l instanceof dl?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&zc(a.target)){const l=new fe(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,It.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=Be();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new hu(e,t,this.Qe,this.ke,r);return this.ke=jn(),this.qe=hv(),this.Qe=new wt(Ne),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new dv,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ft(Ne),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||Q("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new dv),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function hv(){return new wt(fe.comparator)}function fv(){return new wt(fe.comparator)}const BP=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),qP=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),zP=(()=>({and:"AND",or:"OR"}))();class GP{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function If(n,e){return n.useProto3Json||au(e)?e:{value:e}}function aa(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ob(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function KP(n,e){return aa(n,e.toTimestamp())}function Kt(n){return Ie(!!n),Ee.fromTimestamp(function(t){const r=es(t);return new Nt(r.seconds,r.nanos)}(n))}function Tp(n,e){return Ef(n,e).canonicalString()}function Ef(n,e){const t=function(s){return new Qe(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function ab(n){const e=Qe.fromString(n);return Ie(vb(e)),e}function ql(n,e){return Tp(n.databaseId,e.path)}function Pr(n,e){const t=ab(e);if(t.get(1)!==n.databaseId.projectId)throw new J(B.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new J(B.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new fe(cb(t))}function lb(n,e){return Tp(n.databaseId,e)}function ub(n){const e=ab(n);return e.length===4?Qe.emptyPath():cb(e)}function Tf(n){return new Qe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function cb(n){return Ie(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function pv(n,e,t){return{name:ql(n,e),fields:t.value.mapValue.fields}}function db(n,e,t){const r=Pr(n,e.name),s=Kt(e.updateTime),i=e.createTime?Kt(e.createTime):Ee.min(),o=new pn({mapValue:{fields:e.fields}}),a=It.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function HP(n,e){return"found"in e?function(r,s){Ie(!!s.found),s.found.name,s.found.updateTime;const i=Pr(r,s.found.name),o=Kt(s.found.updateTime),a=s.found.createTime?Kt(s.found.createTime):Ee.min(),l=new pn({mapValue:{fields:s.found.fields}});return It.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Ie(!!s.missing),Ie(!!s.readTime);const i=Pr(r,s.missing),o=Kt(s.readTime);return It.newNoDocument(i,o)}(n,e):ye()}function WP(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:ye()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,f){return c.useProto3Json?(Ie(f===void 0||typeof f=="string"),Ut.fromBase64String(f||"")):(Ie(f===void 0||f instanceof Buffer||f instanceof Uint8Array),Ut.fromUint8Array(f||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const f=c.code===void 0?B.UNKNOWN:nb(c.code);return new J(f,c.message||"")}(o);t=new ib(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Pr(n,r.document.name),i=Kt(r.document.updateTime),o=r.document.createTime?Kt(r.document.createTime):Ee.min(),a=new pn({mapValue:{fields:r.document.fields}}),l=It.newFoundDocument(s,i,o,a),c=r.targetIds||[],f=r.removedTargetIds||[];t=new Tc(c,f,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Pr(n,r.document),i=r.readTime?Kt(r.readTime):Ee.min(),o=It.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Tc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Pr(n,r.document),i=r.removedTargetIds||[];t=new Tc([],i,s,null)}else{if(!("filter"in e))return ye();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new UP(s,i),a=r.targetId;t=new sb(a,o)}}return t}function zl(n,e){let t;if(e instanceof wa)t={update:pv(n,e.key,e.value)};else if(e instanceof Ia)t={delete:ql(n,e.key)};else if(e instanceof us)t={update:pv(n,e.key,e.data),updateMask:eR(e.fieldMask)};else{if(!(e instanceof _p))return ye();t={verify:ql(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof ia)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof qi)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof zi)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof oa)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw ye()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:KP(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ye()}(n,e.precondition)),t}function xf(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Ct.updateTime(Kt(i.updateTime)):i.exists!==void 0?Ct.exists(i.exists):Ct.none()}(e.currentDocument):Ct.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Ie(a.setToServerValue==="REQUEST_TIME"),l=new ia;else if("appendMissingElements"in a){const f=a.appendMissingElements.values||[];l=new qi(f)}else if("removeAllFromArray"in a){const f=a.removeAllFromArray.values||[];l=new zi(f)}else"increment"in a?l=new oa(o,a.increment):ye();const c=Rt.fromServerFormat(a.fieldPath);return new du(c,l)}(n,s)):[];if(e.update){e.update.name;const s=Pr(n,e.update.name),i=new pn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new $n(c.map(f=>Rt.fromServerFormat(f)))}(e.updateMask);return new us(s,i,o,t,r)}return new wa(s,i,t,r)}if(e.delete){const s=Pr(n,e.delete);return new Ia(s,t)}if(e.verify){const s=Pr(n,e.verify);return new _p(s,t)}return ye()}function QP(n,e){return n&&n.length>0?(Ie(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?Kt(s.updateTime):Kt(i);return o.isEqual(Ee.min())&&(o=Kt(i)),new MP(o,s.transformResults||[])}(t,e))):[]}function hb(n,e){return{documents:[lb(n,e.path)]}}function Dd(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=lb(n,s);const i=function(c){if(c.length!==0)return gb(ct.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(f=>function(v){return{field:Ds(v.field),direction:YP(v.dir)}}(f))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=If(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function fb(n,e,t,r){const{_t:s,parent:i}=Dd(n,e),o={},a=[];let l=0;return t.forEach(c=>{const f=r?c.alias:"aggregate_"+l++;o[f]=c.alias,c.aggregateType==="count"?a.push({alias:f,count:{}}):c.aggregateType==="avg"?a.push({alias:f,avg:{field:Ds(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:f,sum:{field:Ds(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function pb(n){let e=ub(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Ie(r===1);const f=t.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];t.where&&(i=function(m){const v=mb(m);return v instanceof ct&&mp(v)?v.getFilters():[v]}(t.where));let o=[];t.orderBy&&(o=function(m){return m.map(v=>function(C){return new Bl(Oo(C.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(v))}(t.orderBy));let a=null;t.limit&&(a=function(m){let v;return v=typeof m=="object"?m.value:m,au(v)?null:v}(t.limit));let l=null;t.startAt&&(l=function(m){const v=!!m.before,y=m.values||[];return new Xs(y,v)}(t.startAt));let c=null;return t.endAt&&(c=function(m){const v=!m.before,y=m.values||[];return new Xs(y,v)}(t.endAt)),L0(e,s,o,i,a,"F",l,c)}function JP(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ye()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function mb(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Oo(t.unaryFilter.field);return Je.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Oo(t.unaryFilter.field);return Je.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Oo(t.unaryFilter.field);return Je.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Oo(t.unaryFilter.field);return Je.create(o,"!=",{nullValue:"NULL_VALUE"});default:return ye()}}(n):n.fieldFilter!==void 0?function(t){return Je.create(Oo(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ye()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ct.create(t.compositeFilter.filters.map(r=>mb(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ye()}}(t.compositeFilter.op))}(n):ye()}function YP(n){return BP[n]}function XP(n){return qP[n]}function ZP(n){return zP[n]}function Ds(n){return{fieldPath:n.canonicalString()}}function Oo(n){return Rt.fromServerFormat(n.fieldPath)}function gb(n){return n instanceof Je?function(t){if(t.op==="=="){if(Yg(t.value))return{unaryFilter:{field:Ds(t.field),op:"IS_NAN"}};if(Jg(t.value))return{unaryFilter:{field:Ds(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Yg(t.value))return{unaryFilter:{field:Ds(t.field),op:"IS_NOT_NAN"}};if(Jg(t.value))return{unaryFilter:{field:Ds(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ds(t.field),op:XP(t.op),value:t.value}}}(n):n instanceof ct?function(t){const r=t.getFilters().map(s=>gb(s));return r.length===1?r[0]:{compositeFilter:{op:ZP(t.op),filters:r}}}(n):ye()}function eR(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function vb(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gr{constructor(e,t,r,s,i=Ee.min(),o=Ee.min(),a=Ut.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Gr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Gr(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Gr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Gr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yb{constructor(e){this.ct=e}}function tR(n,e){let t;if(e.document)t=db(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=fe.fromSegments(e.noDocument.path),s=Ki(e.noDocument.readTime);t=It.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ye();{const r=fe.fromSegments(e.unknownDocument.path),s=Ki(e.unknownDocument.version);t=It.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Nt(s[0],s[1]);return Ee.fromTimestamp(i)}(e.readTime)),t}function mv(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Wc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:ql(i,o.key),fields:o.data.value.mapValue.fields,updateTime:aa(i,o.version.toTimestamp()),createTime:aa(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Gi(e.version)};else{if(!e.isUnknownDocument())return ye();r.unknownDocument={path:t.path.toArray(),version:Gi(e.version)}}return r}function Wc(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Gi(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ki(n){const e=new Nt(n.seconds,n.nanoseconds);return Ee.fromTimestamp(e)}function Ri(n,e){const t=(e.baseMutations||[]).map(i=>xf(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>xf(n.ct,i)),s=Nt.fromMillis(e.localWriteTimeMs);return new bp(e.batchId,s,t,r)}function hl(n){const e=Ki(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Ki(n.lastLimboFreeSnapshotVersion):Ee.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Ie(i.documents.length===1),Pn(ba(ub(i.documents[0])))}(n.query):function(i){return Pn(pb(i))}(n.query),new Gr(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ut.fromBase64String(n.resumeToken))}function _b(n,e){const t=Gi(e.snapshotVersion),r=Gi(e.lastLimboFreeSnapshotVersion);let s;s=zc(e.target)?hb(n.ct,e.target):Dd(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Bi(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function xp(n){const e=pb({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Kc(e,e.limit,"L"):e}function Vh(n,e){return new Ip(e.largestBatchId,xf(n.ct,e.overlayMutation))}function gv(n,e){const t=e.path.lastSegment();return[n,Sn(e.path.popLast()),t]}function vv(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Gi(r.readTime),documentKey:Sn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nR{getBundleMetadata(e,t){return yv(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Ki(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return yv(e).put(function(s){return{bundleId:s.id,createTime:Gi(Kt(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return _v(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:xp(i.bundledQuery),readTime:Ki(i.readTime)}}(r)})}saveNamedQuery(e,t){return _v(e).put(function(s){return{name:s.name,readTime:Gi(Kt(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function yv(n){return en(n,"bundles")}function _v(n){return en(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vd{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new Vd(e,r)}getOverlay(e,t){return el(e).get(gv(this.userId,t)).next(r=>r?Vh(this.serializer,r):null)}getOverlays(e,t){const r=xr();return O.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Ip(t,o);s.push(this.ht(e,a))}),O.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(Sn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(el(e).j("collectionPathOverlayIndex",a))}),O.waitFor(i)}getOverlaysForCollection(e,t,r){const s=xr(),i=Sn(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return el(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=Vh(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=xr();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return el(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,f)=>{const m=Vh(this.serializer,c);i.size()<s||m.largestBatchId===o?(i.set(m.getKey(),m),o=m.largestBatchId):f.done()}).next(()=>i)}ht(e,t){return el(e).put(function(s,i,o){const[a,l,c]=gv(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:zl(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function el(n){return en(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rR{Pt(e){return en(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?Ut.fromUint8Array(r):Ut.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ci{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Pt(e.integerValue));else if("doubleValue"in e){const r=Pt(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Fl(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=es(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(ts(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?S0(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Rd(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):ye()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(Pt(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),fe.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Ci.vt=new Ci;function sR(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function bv(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=sR(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class iR{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=bv(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=bv(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class oR{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class aR{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class tl{constructor(){this.jt=new iR,this.Ht=new oR(this.jt),this.Jt=new aR(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new ki(this.indexId,this.documentKey,this.arrayValue,r)}}function xs(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=wv(n.arrayValue,e.arrayValue),t!==0?t:(t=wv(n.directionalValue,e.directionalValue),t!==0?t:fe.comparator(n.documentKey,e.documentKey)))}function wv(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iv{constructor(e){this.Xt=new ft((t,r)=>Rt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Ie(e.collectionGroup===this.collectionId),this.nn)return!1;const t=pf(e);if(t!==void 0&&!this.sn(t))return!1;const r=Ai(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new ft(Rt.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Mi(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Mi(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Mi(r.field,r.dir==="asc"?0:1)));return new ta(ta.UNKNOWN_ID,this.collectionId,t,na.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bb(n){var e,t;if(Ie(n instanceof Je||n instanceof ct),n instanceof Je){if(n instanceof M0){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>Je.create(n.field,"==",i)))||[];return ct.create(s,"or")}return n}const r=n.filters.map(s=>bb(s));return ct.create(r,n.op)}function lR(n){if(n.getFilters().length===0)return[];const e=Pf(bb(n));return Ie(wb(e)),Af(e)||Sf(e)?[e]:e.getFilters()}function Af(n){return n instanceof Je}function Sf(n){return n instanceof ct&&mp(n)}function wb(n){return Af(n)||Sf(n)||function(t){if(t instanceof ct&&yf(t)){for(const r of t.getFilters())if(!Af(r)&&!Sf(r))return!1;return!0}return!1}(n)}function Pf(n){if(Ie(n instanceof Je||n instanceof ct),n instanceof Je)return n;if(n.filters.length===1)return Pf(n.filters[0]);const e=n.filters.map(r=>Pf(r));let t=ct.create(e,n.op);return t=Qc(t),wb(t)?t:(Ie(t instanceof ct),Ie(sa(t)),Ie(t.filters.length>1),t.filters.reduce((r,s)=>Ap(r,s)))}function Ap(n,e){let t;return Ie(n instanceof Je||n instanceof ct),Ie(e instanceof Je||e instanceof ct),t=n instanceof Je?e instanceof Je?function(s,i){return ct.create([s,i],"and")}(n,e):Ev(n,e):e instanceof Je?Ev(e,n):function(s,i){if(Ie(s.filters.length>0&&i.filters.length>0),sa(s)&&sa(i))return V0(s,i.getFilters());const o=yf(s)?s:i,a=yf(s)?i:s,l=o.filters.map(c=>Ap(c,a));return ct.create(l,"or")}(n,e),Qc(t)}function Ev(n,e){if(sa(e))return V0(e,n.getFilters());{const t=e.filters.map(r=>Ap(n,r));return ct.create(t,"or")}}function Qc(n){if(Ie(n instanceof Je||n instanceof ct),n instanceof Je)return n;const e=n.getFilters();if(e.length===1)return Qc(e[0]);if(k0(n))return n;const t=e.map(s=>Qc(s)),r=[];return t.forEach(s=>{s instanceof Je?r.push(s):s instanceof ct&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:ct.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uR{constructor(){this.un=new Sp}addToCollectionParentIndex(e,t){return this.un.add(t),O.resolve()}getCollectionParents(e,t){return O.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return O.resolve()}deleteFieldIndex(e,t){return O.resolve()}deleteAllFieldIndexes(e){return O.resolve()}createTargetIndexes(e,t){return O.resolve()}getDocumentsMatchingTarget(e,t){return O.resolve(null)}getIndexType(e,t){return O.resolve(0)}getFieldIndexes(e,t){return O.resolve([])}getNextCollectionGroupToUpdate(e){return O.resolve(null)}getMinOffset(e,t){return O.resolve(Xn.min())}getMinOffsetFromCollectionGroup(e,t){return O.resolve(Xn.min())}updateCollectionGroup(e,t,r){return O.resolve()}updateIndexEntries(e,t){return O.resolve()}}class Sp{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new ft(Qe.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new ft(Qe.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oc=new Uint8Array(0);class cR{constructor(e,t){this.databaseId=t,this.cn=new Sp,this.ln=new ls(r=>Bi(r),(r,s)=>lu(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:Sn(s)};return Tv(e).put(i)}return O.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[f0(t),""],!1,!0);return Tv(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Tr(o.parent))}return r})}addFieldIndex(e,t){const r=nl(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=So(e);return i.next(a=>{o.put(vv(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=nl(e),s=So(e),i=Ao(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=nl(e),r=Ao(e),s=So(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return O.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new Iv(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Ao(e);let s=!0;const i=new Map;return O.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Be();const a=[];return O.forEach(i,(l,c)=>{Q("IndexedDbIndexManager",`Using index ${function(M){return`id=${M.indexId}|cg=${M.collectionGroup}|f=${M.fields.map(q=>`${q.fieldPath}:${q.kind}`).join(",")}`}(l)} to execute ${Bi(t)}`);const f=function(M,q){const ee=pf(q);if(ee===void 0)return null;for(const Z of Gc(M,ee.fieldPath))switch(Z.op){case"array-contains-any":return Z.value.arrayValue.values||[];case"array-contains":return[Z.value]}return null}(c,l),m=function(M,q){const ee=new Map;for(const Z of Ai(q))for(const I of Gc(M,Z.fieldPath))switch(I.op){case"==":case"in":ee.set(Z.fieldPath.canonicalString(),I.value);break;case"not-in":case"!=":return ee.set(Z.fieldPath.canonicalString(),I.value),Array.from(ee.values())}return null}(c,l),v=function(M,q){const ee=[];let Z=!0;for(const I of Ai(q)){const w=I.kind===0?nv(M,I.fieldPath,M.startAt):rv(M,I.fieldPath,M.startAt);ee.push(w.value),Z&&(Z=w.inclusive)}return new Xs(ee,Z)}(c,l),y=function(M,q){const ee=[];let Z=!0;for(const I of Ai(q)){const w=I.kind===0?rv(M,I.fieldPath,M.endAt):nv(M,I.fieldPath,M.endAt);ee.push(w.value),Z&&(Z=w.inclusive)}return new Xs(ee,Z)}(c,l),C=this.In(l,c,v),A=this.In(l,c,y),k=this.Tn(l,c,m),U=this.En(l.indexId,f,C,v.inclusive,A,y.inclusive,k);return O.forEach(U,j=>r.G(j,t.limit).next(M=>{M.forEach(q=>{const ee=fe.fromSegments(q.documentKey);o.has(ee)||(o=o.add(ee),a.push(ee))})}))}).next(()=>a)}return O.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=lR(ct.create(e.filters,"and")).map(r=>bf(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),f=[];for(let m=0;m<l;++m){const v=t?this.dn(t[m/c]):oc,y=this.An(e,v,r[m%c],s),C=this.Rn(e,v,i[m%c],o),A=a.map(k=>this.An(e,v,k,!0));f.push(...this.createRange(y,C,A))}return f}An(e,t,r,s){const i=new ki(e,fe.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new ki(e,fe.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new Iv(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return O.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new ft(Rt.comparator),f=!1;for(const m of l.filters)for(const v of m.getFlattenedFilters())v.field.isKeyField()||(v.op==="array-contains"||v.op==="array-contains-any"?f=!0:c=c.add(v.field));for(const m of l.orderBy)m.field.isKeyField()||(c=c.add(m.field));return c.size+(f?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new tl;for(const s of Ai(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);Ci.vt.It(i,o)}return r.zt()}dn(e){const t=new tl;return Ci.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new tl;return Ci.vt.It(ji(this.databaseId,t),r.Yt(function(i){const o=Ai(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new tl);let i=0;for(const o of Ai(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&jl(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);Ci.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new tl;l.seed(a.zt()),Ci.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof Je&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=nl(e),s=So(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return O.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(f,m){const v=m?new na(m.sequenceNumber,new Xn(Ki(m.readTime),new fe(Tr(m.documentKey)),m.largestBatchId)):na.empty(),y=f.fields.map(([C,A])=>new Mi(Rt.fromServerFormat(C),A));return new ta(f.indexId,f.collectionGroup,y,v)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Ne(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=nl(e),i=So(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>O.forEach(a,l=>i.put(vv(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return O.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?O.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),O.forEach(a,l=>this.wn(e,s,l).next(c=>{const f=this.Sn(i,l);return c.isEqual(f)?O.resolve():this.bn(e,i,l,c,f)}))))})}Dn(e,t,r,s){return Ao(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return Ao(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=Ao(e);let i=new ft(xs);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new ki(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new ft(xs);const s=this.Vn(t,e);if(s==null)return r;const i=pf(t);if(i!=null){const o=e.data.field(i.fieldPath);if(jl(o))for(const a of o.arrayValue.values||[])r=r.add(new ki(t.indexId,e.key,this.dn(a),s))}else r=r.add(new ki(t.indexId,e.key,oc,s));return r}bn(e,t,r,s,i){Q("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,f,m,v){const y=l.getIterator(),C=c.getIterator();let A=xo(y),k=xo(C);for(;A||k;){let U=!1,j=!1;if(A&&k){const M=f(A,k);M<0?j=!0:M>0&&(U=!0)}else A!=null?j=!0:U=!0;U?(m(k),k=xo(C)):j?(v(A),A=xo(y)):(A=xo(y),k=xo(C))}}(s,i,xs,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),O.waitFor(o)}yn(e){let t=1;return So(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>xs(o,a)).filter((o,a,l)=>!a||xs(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=xs(o,e),l=xs(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,oc,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,oc,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return xs(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(xv)}getMinOffset(e,t){return O.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||ye())).next(xv)}}function Tv(n){return en(n,"collectionParents")}function Ao(n){return en(n,"indexEntries")}function nl(n){return en(n,"indexConfiguration")}function So(n){return en(n,"indexState")}function xv(n){Ie(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;hp(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Xn(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Av={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class In{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new In(e,In.DEFAULT_COLLECTION_PERCENTILE,In.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ib(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(f,m,v)=>(a++,v.delete()));i.push(l.next(()=>{Ie(a===1)}));const c=[];for(const f of t.mutations){const m=b0(e,f.key.path,t.batchId);i.push(s.delete(m)),c.push(f.key)}return O.waitFor(i).next(()=>c)}function Jc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw ye();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */In.DEFAULT_COLLECTION_PERCENTILE=10,In.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,In.DEFAULT=new In(41943040,In.DEFAULT_COLLECTION_PERCENTILE,In.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),In.DISABLED=new In(-1,0,0);class Nd{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Ie(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new Nd(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return As(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Mo(e),o=As(e);return o.add({}).next(a=>{Ie(typeof a=="number");const l=new bp(a,t,r,s),c=function(y,C,A){const k=A.baseMutations.map(j=>zl(y.ct,j)),U=A.mutations.map(j=>zl(y.ct,j));return{userId:C,batchId:A.batchId,localWriteTimeMs:A.localWriteTime.toMillis(),baseMutations:k,mutations:U}}(this.serializer,this.userId,l),f=[];let m=new ft((v,y)=>Ne(v.canonicalString(),y.canonicalString()));for(const v of s){const y=b0(this.userId,v.key.path,a);m=m.add(v.key.path.popLast()),f.push(o.put(c)),f.push(i.put(y,XS))}return m.forEach(v=>{f.push(this.indexManager.addToCollectionParentIndex(e,v))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),O.waitFor(f).next(()=>l)})}lookupMutationBatch(e,t){return As(e).get(t).next(r=>r?(Ie(r.userId===this.userId),Ri(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?O.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return As(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Ie(a.batchId>=r),i=Ri(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return As(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return As(e).U("userMutationsIndex",t).next(r=>r.map(s=>Ri(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=_c(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Mo(e).J({range:s},(o,a,l)=>{const[c,f,m]=o,v=Tr(f);if(c===this.userId&&t.path.isEqual(v))return As(e).get(m).next(y=>{if(!y)throw ye();Ie(y.userId===this.userId),i.push(Ri(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ft(Ne);const s=[];return t.forEach(i=>{const o=_c(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Mo(e).J({range:a},(c,f,m)=>{const[v,y,C]=c,A=Tr(y);v===this.userId&&i.path.isEqual(A)?r=r.add(C):m.done()});s.push(l)}),O.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=_c(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new ft(Ne);return Mo(e).J({range:o},(l,c,f)=>{const[m,v,y]=l,C=Tr(v);m===this.userId&&r.isPrefixOf(C)?C.length===s&&(a=a.add(y)):f.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(As(e).get(i).next(o=>{if(o===null)throw ye();Ie(o.userId===this.userId),r.push(Ri(this.serializer,o))}))}),O.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return Ib(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),O.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return O.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Mo(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=Tr(i[1]);s.push(l)}else a.done()}).next(()=>{Ie(s.length===0)})})}containsKey(e,t){return Eb(e,this.userId,t)}Nn(e){return Tb(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Eb(n,e,t){const r=_c(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Mo(n).J({range:i,H:!0},(a,l,c)=>{const[f,m,v]=a;f===e&&m===s&&(o=!0),c.done()}).next(()=>o)}function As(n){return en(n,"mutations")}function Mo(n){return en(n,"documentMutations")}function Tb(n){return en(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hi{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Hi(0)}static kn(){return new Hi(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dR{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new Hi(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Ee.fromTimestamp(new Nt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Po(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Ie(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Po(e).J((o,a)=>{const l=hl(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>O.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Po(e).J((r,s)=>{const i=hl(s);t(i)})}qn(e){return Sv(e).get("targetGlobalKey").next(t=>(Ie(t!==null),t))}Qn(e,t){return Sv(e).put("targetGlobalKey",t)}Kn(e,t){return Po(e).put(_b(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Bi(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Po(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=hl(a);lu(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Vs(e);return t.forEach(o=>{const a=Sn(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),O.waitFor(s)}removeMatchingKeys(e,t,r){const s=Vs(e);return O.forEach(t,i=>{const o=Sn(i.path);return O.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Vs(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Vs(e);let i=Be();return s.J({range:r,H:!0},(o,a,l)=>{const c=Tr(o[1]),f=new fe(c);i=i.add(f)}).next(()=>i)}containsKey(e,t){const r=Sn(t.path),s=IDBKeyRange.bound([r],[f0(r)],!1,!0);let i=0;return Vs(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return Po(e).get(t).next(r=>r?hl(r):null)}}function Po(n){return en(n,"targets")}function Sv(n){return en(n,"targetGlobal")}function Vs(n){return en(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pv([n,e],[t,r]){const s=Ne(n,t);return s===0?Ne(e,r):s}class hR{constructor(e){this.Un=e,this.buffer=new ft(Pv),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Pv(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class xb{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){Q("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){si(t)?Q("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await ri(t)}await this.Hn(3e5)})}}class fR{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return O.resolve(Un.oe);const r=new hR(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Q("LruGarbageCollector","Garbage collection skipped; disabled"),O.resolve(Av)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(Q("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Av):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(Q("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),s=this.params.maximumSequenceNumbersToCollect):s=m,o=Date.now(),this.nthSequenceNumber(e,s))).next(m=>(r=m,a=Date.now(),this.removeTargets(e,r,t))).next(m=>(i=m,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(m=>(c=Date.now(),Vo()<=He.DEBUG&&Q("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${m} documents in `+(c-l)+`ms
Total Duration: ${c-f}ms`),O.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:m})))}}function Ab(n,e){return new fR(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pR{constructor(e,t){this.db=e,this.garbageCollector=Ab(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return ac(e,r)}removeReference(e,t,r){return ac(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return ac(e,t)}nr(e,t){return function(s,i){let o=!1;return Tb(s).Y(a=>Eb(s,a,i).next(l=>(l&&(o=!0),O.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Ee.min()),Vs(e).delete(function(m){return[0,Sn(m.path)]}(o))))});s.push(l)}}).next(()=>O.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return ac(e,t)}tr(e,t){const r=Vs(e);let s,i=Un.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==Un.oe&&t(new fe(Tr(s)),i),i=c,s=l):i=Un.oe}).next(()=>{i!==Un.oe&&t(new fe(Tr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ac(n,e){return Vs(n).put(function(r,s){return{targetId:0,path:Sn(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sb{constructor(){this.changes=new ls(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,It.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?O.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mR{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Ei(e).put(r)}removeEntry(e,t,r){return Ei(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Wc(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=It.newInvalidDocument(t);return Ei(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(rl(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:It.newInvalidDocument(t)};return Ei(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(rl(t))},(s,i)=>{r={document:this.ir(t,i),size:Jc(i)}}).next(()=>r)}getEntries(e,t){let r=jn();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=jn(),s=new wt(fe.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,Jc(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return O.resolve();let s=new ft(kv);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(rl(s.first()),rl(s.last())),o=s.getIterator();let a=o.getNext();return Ei(e).J({index:"documentKeyIndex",range:i},(l,c,f)=>{const m=fe.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&kv(a,m)<0;)r(a,null),a=o.getNext();a&&a.isEqual(m)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?f.$(rl(a)):f.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Wc(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ei(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let f=jn();for(const m of c){const v=this.ir(fe.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);v.isFoundDocument()&&(cu(t,v)||s.has(v.key))&&(f=f.insert(v.key,v))}return f})}getAllFromCollectionGroup(e,t,r,s){let i=jn();const o=Cv(t,r),a=Cv(t,Xn.max());return Ei(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,f)=>{const m=this.ir(fe.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(m.key,m),i.size===s&&f.done()}).next(()=>i)}newChangeBuffer(e){return new gR(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Rv(e).get("remoteDocumentGlobalKey").next(t=>(Ie(!!t),t))}rr(e,t){return Rv(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=tR(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Ee.min())))return r}return It.newInvalidDocument(e)}}function Pb(n){return new mR(n)}class gR extends Sb{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new ls(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new ft((i,o)=>Ne(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=mv(this.cr.serializer,o);s=s.add(i.path.popLast());const c=Jc(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=mv(this.cr.serializer,o.convertToNoDocument(Ee.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),O.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function Rv(n){return en(n,"remoteDocumentGlobal")}function Ei(n){return en(n,"remoteDocumentsV14")}function rl(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Cv(n,e){const t=e.documentKey.path.toArray();return[n,Wc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function kv(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Ne(t[i],r[i]),s)return s;return s=Ne(t.length,r.length),s||(s=Ne(t[t.length-2],r[r.length-2]),s||Ne(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rb{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Al(r.mutation,s,$n.empty(),Nt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Be()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Be()){const s=xr();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=cl();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=xr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Be()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=jn();const o=xl(),a=function(){return xl()}();return t.forEach((l,c)=>{const f=r.get(c.key);s.has(c.key)&&(f===void 0||f.mutation instanceof us)?i=i.insert(c.key,c):f!==void 0?(o.set(c.key,f.mutation.getFieldMask()),Al(f.mutation,c,f.mutation.getFieldMask(),Nt.now())):o.set(c.key,$n.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,f)=>o.set(c,f)),t.forEach((c,f)=>{var m;return a.set(c,new vR(f,(m=o.get(c))!==null&&m!==void 0?m:null))}),a))}recalculateAndSaveOverlays(e,t){const r=xl();let s=new wt((o,a)=>o-a),i=Be();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let f=r.get(l)||$n.empty();f=a.applyToLocalView(c,f),r.set(l,f);const m=(s.get(a.batchId)||Be()).add(l);s=s.insert(a.batchId,m)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,f=l.value,m=G0();f.forEach(v=>{if(!i.has(v)){const y=X0(t.get(v),r.get(v));y!==null&&m.set(v,y),i=i.add(v)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,m))}return O.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return fe.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):gp(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):O.resolve(xr());let a=-1,l=i;return o.next(c=>O.forEach(c,(f,m)=>(a<m.largestBatchId&&(a=m.largestBatchId),i.get(f)?O.resolve():this.remoteDocumentCache.getEntry(e,f).next(v=>{l=l.insert(f,v)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,Be())).next(f=>({batchId:a,changes:z0(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new fe(t)).next(r=>{let s=cl();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=cl();return this.indexManager.getCollectionParents(e,i).next(a=>O.forEach(a,l=>{const c=function(m,v){return new as(v,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(f=>{f.forEach((m,v)=>{o=o.insert(m,v)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const f=c.getKey();o.get(f)===null&&(o=o.insert(f,It.newInvalidDocument(f)))});let a=cl();return o.forEach((l,c)=>{const f=i.get(l);f!==void 0&&Al(f.mutation,c,$n.empty(),Nt.now()),cu(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yR{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return O.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Kt(s.createTime)}}(t)),O.resolve()}getNamedQuery(e,t){return O.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:xp(s.bundledQuery),readTime:Kt(s.readTime)}}(t)),O.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _R{constructor(){this.overlays=new wt(fe.comparator),this.Ir=new Map}getOverlay(e,t){return O.resolve(this.overlays.get(t))}getOverlays(e,t){const r=xr();return O.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),O.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),O.resolve()}getOverlaysForCollection(e,t,r){const s=xr(),i=t.length+1,o=new fe(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return O.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new wt((c,f)=>c-f);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let f=i.get(c.largestBatchId);f===null&&(f=xr(),i=i.insert(c.largestBatchId,f)),f.set(c.getKey(),c)}}const a=xr(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,f)=>a.set(c,f)),!(a.size()>=s)););return O.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Ip(t,r));let i=this.Ir.get(t);i===void 0&&(i=Be(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bR{constructor(){this.sessionToken=Ut.EMPTY_BYTE_STRING}getSessionToken(e){return O.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,O.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pp{constructor(){this.Tr=new ft(sn.Er),this.dr=new ft(sn.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new sn(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new sn(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new fe(new Qe([])),r=new sn(t,e),s=new sn(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new fe(new Qe([])),r=new sn(t,e),s=new sn(t,e+1);let i=Be();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new sn(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class sn{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return fe.comparator(e.key,t.key)||Ne(e.wr,t.wr)}static Ar(e,t){return Ne(e.wr,t.wr)||fe.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new ft(sn.Er)}checkEmpty(e){return O.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new bp(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new sn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return O.resolve(o)}lookupMutationBatch(e,t){return O.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return O.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return O.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return O.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new sn(t,0),s=new sn(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),O.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ft(Ne);return t.forEach(s=>{const i=new sn(s,0),o=new sn(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),O.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;fe.isDocumentKey(i)||(i=i.child(""));const o=new sn(new fe(i),0);let a=new ft(Ne);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),O.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Ie(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return O.forEach(t.mutations,s=>{const i=new sn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new sn(t,0),s=this.br.firstAfterOrEqual(r);return O.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,O.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IR{constructor(e){this.Mr=e,this.docs=function(){return new wt(fe.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return O.resolve(r?r.document.mutableCopy():It.newInvalidDocument(t))}getEntries(e,t){let r=jn();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():It.newInvalidDocument(s))}),O.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=jn();const o=t.path,a=new fe(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:f}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||hp(m0(f),r)<=0||(s.has(f.key)||cu(t,f))&&(i=i.insert(f.key,f.mutableCopy()))}return O.resolve(i)}getAllFromCollectionGroup(e,t,r,s){ye()}Or(e,t){return O.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new ER(this)}getSize(e){return O.resolve(this.size)}}class ER extends Sb{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),O.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TR{constructor(e){this.persistence=e,this.Nr=new ls(t=>Bi(t),lu),this.lastRemoteSnapshotVersion=Ee.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Pp,this.targetCount=0,this.kr=Hi.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),O.resolve()}getLastRemoteSnapshotVersion(e){return O.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return O.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),O.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),O.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Hi(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,O.resolve()}updateTargetData(e,t){return this.Kn(t),O.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,O.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),O.waitFor(i).next(()=>s)}getTargetCount(e){return O.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return O.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),O.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),O.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),O.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return O.resolve(r)}containsKey(e,t){return O.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rp{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Un(0),this.Kr=!1,this.Kr=!0,this.$r=new bR,this.referenceDelegate=e(this),this.Ur=new TR(this),this.indexManager=new uR,this.remoteDocumentCache=function(s){return new IR(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new yb(t),this.Gr=new yR(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new _R,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new wR(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){Q("MemoryPersistence","Starting transaction:",e);const s=new xR(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return O.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class xR extends v0{constructor(e){super(),this.currentSequenceNumber=e}}class Od{constructor(e){this.persistence=e,this.Jr=new Pp,this.Yr=null}static Zr(e){return new Od(e)}get Xr(){if(this.Yr)return this.Yr;throw ye()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),O.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),O.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),O.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return O.forEach(this.Xr,r=>{const s=fe.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Ee.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return O.or([()=>O.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Yc{constructor(e,t){this.persistence=e,this.ti=new ls(r=>Sn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=Ab(this,t)}static Zr(e,t){return new Yc(e,t)}zr(){}jr(e){return O.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return O.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?O.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Ee.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),O.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),O.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),O.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),O.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=wc(e.data.value)),t}nr(e,t,r){return O.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return O.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AR{constructor(e){this.serializer=e}O(e,t,r,s){const i=new Ad("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Gg,{unique:!0}),l.createObjectStore("documentMutations")}(e),Dv(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=O.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),Dv(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Ee.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",f)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(f=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Gg,{unique:!0});const m=c.store("mutations"),v=f.map(y=>m.put(y));return O.waitFor(v)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:cP});c.createIndex("collectionPathOverlayIndex",dP,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",hP,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:ZS});c.createIndex("documentKeyIndex",eP),c.createIndex("collectionGroupIndex",tP)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:oP}).createIndex("sequenceNumberIndex",aP,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:lP}).createIndex("documentKeyIndex",uP,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Jc(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>O.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>O.forEach(a,l=>{Ie(l.userId===i.userId);const c=Ri(this.serializer,l);return Ib(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new Qe(o),c=function(m){return[0,Sn(m)]}(l);i.push(t.get(c).next(f=>f?O.resolve():(m=>t.put({targetId:0,path:Sn(m),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>O.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:iP});const r=t.store("collectionParents"),s=new Sp,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Sn(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new Qe(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const f=Tr(a);return i(f.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=hl(s),o=_b(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(m){return m.document?new fe(Qe.fromString(m.document.name).popFirst(5)):m.noDocument?fe.fromSegments(m.noDocument.path):m.unknownDocument?fe.fromSegments(m.unknownDocument.path):ye()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>O.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=Pb(this.serializer),i=new Rp(Od.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let f=(c=a.get(l.userId))!==null&&c!==void 0?c:Be();Ri(this.serializer,l).keys().forEach(m=>f=f.add(m)),a.set(l.userId,f)}),O.forEach(a,(l,c)=>{const f=new on(c),m=Vd.lt(this.serializer,f),v=i.getIndexManager(f),y=Nd.lt(f,this.serializer,v,i.referenceDelegate);return new Rb(s,y,m,v).recalculateAndSaveOverlaysForDocumentKeys(new mf(t,Un.oe),l).next()})})}}function Dv(n){n.createObjectStore("targetDocuments",{keyPath:rP}).createIndex("documentTargetsIndex",sP,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",nP,{unique:!0}),n.createObjectStore("targetGlobal")}const Nh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Cp{constructor(e,t,r,s,i,o,a,l,c,f,m=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=f,this.hi=m,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=v=>Promise.resolve(),!Cp.D())throw new J(B.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new pR(this,s),this.Ai=t+"main",this.serializer=new yb(l),this.Ri=new Sr(this.Ai,this.hi,new AR(this.serializer)),this.$r=new rR,this.Ur=new dR(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Pb(this.serializer),this.Gr=new nR,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,f===!1&&zt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new J(B.FAILED_PRECONDITION,Nh);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Un(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>lc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(si(e))return Q("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Q("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return sl(e).get("owner").next(t=>O.resolve(this.vi(t)))}Ci(e){return lc(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=en(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return O.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?O.resolve(!0):sl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new J(B.FAILED_PRECONDITION,Nh);return!1}}return!(!this.networkEnabled||!this.inForeground)||lc(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&Q("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new mf(e,Un.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>lc(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Nd.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new cR(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Vd.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){Q("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?mP:l===16?pP:l===15?pp:l===14?E0:l===13?I0:l===12?fP:l===11?w0:void ye()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new mf(a,this.Qr?this.Qr.next():Un.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw zt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new J(B.FAILED_PRECONDITION,g0);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return sl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new J(B.FAILED_PRECONDITION,Nh)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return sl(e).put("owner",t)}static D(){return Sr.D()}bi(e){const t=sl(e);return t.get("owner").next(r=>this.vi(r)?(Q("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):O.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(zt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;J_()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return Q("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return zt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){zt("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function sl(n){return en(n,"owner")}function lc(n){return en(n,"clientMetadata")}function kp(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=Be(),s=Be();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Dp(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cb{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return J_()?8:y0(Zt())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new SR;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(Vo()<=He.DEBUG&&Q("QueryEngine","SDK will not create cache indexes for query:",No(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),O.resolve()):(Vo()<=He.DEBUG&&Q("QueryEngine","Query:",No(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Vo()<=He.DEBUG&&Q("QueryEngine","The SDK decides to create cache indexes for query:",No(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Pn(t))):O.resolve())}Yi(e,t){if(sv(t))return O.resolve(null);let r=Pn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Kc(t,null,"F"),r=Pn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Be(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,Kc(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return sv(t)||s.isEqual(Ee.min())?O.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?O.resolve(null):(Vo()<=He.DEBUG&&Q("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),No(t)),this.rs(e,o,t,p0(s,-1)).next(a=>a))})}ts(e,t){let r=new ft(B0(e));return t.forEach((s,i)=>{cu(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return Vo()<=He.DEBUG&&Q("QueryEngine","Using full collection scan to execute query:",No(t)),this.Ji.getDocumentsMatchingQuery(e,t,Xn.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PR{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new wt(Ne),this._s=new ls(i=>Bi(i),lu),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Rb(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function kb(n,e,t,r){return new PR(n,e,t,r)}async function Db(n,e){const t=ue(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=Be();for(const c of s){o.push(c.batchId);for(const f of c.mutations)l=l.add(f.key)}for(const c of i){a.push(c.batchId);for(const f of c.mutations)l=l.add(f.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function RR(n,e){const t=ue(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,f){const m=c.batch,v=m.keys();let y=O.resolve();return v.forEach(C=>{y=y.next(()=>f.getEntry(l,C)).next(A=>{const k=c.docVersions.get(C);Ie(k!==null),A.version.compareTo(k)<0&&(m.applyToRemoteDocument(A,c),A.isValidDocument()&&(A.setReadTime(c.commitVersion),f.addEntry(A)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,m))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=Be();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function Vb(n){const e=ue(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function CR(n,e){const t=ue(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((f,m)=>{const v=s.get(m);if(!v)return;a.push(t.Ur.removeMatchingKeys(i,f.removedDocuments,m).next(()=>t.Ur.addMatchingKeys(i,f.addedDocuments,m)));let y=v.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?y=y.withResumeToken(Ut.EMPTY_BYTE_STRING,Ee.min()).withLastLimboFreeSnapshotVersion(Ee.min()):f.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(f.resumeToken,r)),s=s.insert(m,y),function(A,k,U){return A.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-A.snapshotVersion.toMicroseconds()>=3e8?!0:U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0}(v,y,f)&&a.push(t.Ur.updateTargetData(i,y))});let l=jn(),c=Be();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,f))}),a.push(Nb(i,o,e.documentUpdates).next(f=>{l=f.Ps,c=f.Is})),!r.isEqual(Ee.min())){const f=t.Ur.getLastRemoteSnapshotVersion(i).next(m=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(f)}return O.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function Nb(n,e,t){let r=Be(),s=Be();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=jn();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(Ee.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):Q("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function kR(n,e){const t=ue(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function la(n,e){const t=ue(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,O.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new Gr(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function ua(n,e,t){const r=ue(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!si(o))throw o;Q("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Xc(n,e,t){const r=ue(n);let s=Ee.min(),i=Be();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,f){const m=ue(l),v=m._s.get(f);return v!==void 0?O.resolve(m.os.get(v)):m.Ur.getTargetData(c,f)}(r,o,Pn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:Ee.min(),t?i:Be())).next(a=>(Lb(r,j0(e),a),{documents:a,Ts:i})))}function Ob(n,e){const t=ue(n),r=ue(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function Mb(n,e){const t=ue(n),r=t.us.get(e)||Ee.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,p0(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(Lb(t,e,s),s))}function Lb(n,e,t){let r=n.us.get(e)||Ee.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function DR(n,e,t,r){const s=ue(n);let i=Be(),o=jn();for(const c of t){const f=e.Es(c.metadata.name);c.document&&(i=i.add(f));const m=e.ds(c);m.setReadTime(e.As(c.metadata.readTime)),o=o.insert(f,m)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await la(s,function(f){return Pn(ba(Qe.fromString(`__bundle__/docs/${f}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>Nb(c,a,o).next(f=>(a.apply(c),f)).next(f=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,f.Ps,f.Is)).next(()=>f.Ps)))}async function VR(n,e,t=Be()){const r=await la(n,Pn(xp(e.bundledQuery))),s=ue(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=Kt(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(Ut.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function Vv(n,e){return`firestore_clients_${n}_${e}`}function Nv(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Oh(n,e){return`firestore_targets_${n}_${e}`}class Zc{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new J(s.error.code,s.error.message))),o?new Zc(e,t,s.state,i):(zt("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Sl{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new J(r.error.code,r.error.message))),i?new Sl(e,r.state,s):(zt("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ed{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=vp();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=_0(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new ed(e,i):(zt("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Vp{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Vp(t.clientId,t.onlineState):(zt("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Rf{constructor(){this.activeTargetIds=vp()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Mh{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new wt(Ne),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=Vv(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Rf),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(Vv(this.persistenceKey,r));if(s){const i=ed.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Oh(this.persistenceKey,e));if(s){const i=Sl.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Oh(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return Q("SharedClientState","READ",e,t),t}setItem(e,t){Q("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){Q("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(Q("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void zt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=Un.oe;if(i!=null)try{const a=JSON.parse(i);Ie(typeof a=="number"),o=a}catch(a){zt("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Un.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new Zc(this.currentUser,e,t,r),i=Nv(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=Nv(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Oh(this.persistenceKey,e),i=new Sl(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return ed.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Zc.Rs(new on(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return Sl.Rs(s,t)}Ls(e){return Vp.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);Q("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=vp();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class Fb{constructor(){this.so=new Rf,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Rf,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NR{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ov{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Q("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){Q("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uc=null;function Lh(){return uc===null?uc=function(){return 268435456+Math.round(2147483648*Math.random())}():uc++,"0x"+uc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MR{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bn="WebChannelConnection";class LR extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=Lh(),l=this.xo(t,r.toUriEncodedString());Q("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(f=>(Q("RestConnection",`Received RPC '${t}' ${a}: `,f),f),f=>{throw sr("RestConnection",`RPC '${t}' ${a} failed with error: `,f,"url: ",l,"request:",s),f})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+_a}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=OR[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Lh();return new Promise((o,a)=>{const l=new i0;l.setWithCredentials(!0),l.listenOnce(o0.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case yc.NO_ERROR:const f=l.getResponseJson();Q(bn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(f)),o(f);break;case yc.TIMEOUT:Q(bn,`RPC '${e}' ${i} timed out`),a(new J(B.DEADLINE_EXCEEDED,"Request time out"));break;case yc.HTTP_ERROR:const m=l.getStatus();if(Q(bn,`RPC '${e}' ${i} failed with status:`,m,"response text:",l.getResponseText()),m>0){let v=l.getResponseJson();Array.isArray(v)&&(v=v[0]);const y=v==null?void 0:v.error;if(y&&y.status&&y.message){const C=function(k){const U=k.toLowerCase().replace(/_/g,"-");return Object.values(B).indexOf(U)>=0?U:B.UNKNOWN}(y.status);a(new J(C,y.message))}else a(new J(B.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new J(B.UNAVAILABLE,"Connection failed."));break;default:ye()}}finally{Q(bn,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);Q(bn,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=Lh(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=u0(),a=l0(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const f=i.join("");Q(bn,`Creating RPC '${e}' stream ${s}: ${f}`,l);const m=o.createWebChannel(f,l);let v=!1,y=!1;const C=new MR({Io:k=>{y?Q(bn,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(v||(Q(bn,`Opening RPC '${e}' stream ${s} transport.`),m.open(),v=!0),Q(bn,`RPC '${e}' stream ${s} sending:`,k),m.send(k))},To:()=>m.close()}),A=(k,U,j)=>{k.listen(U,M=>{try{j(M)}catch(q){setTimeout(()=>{throw q},0)}})};return A(m,ul.EventType.OPEN,()=>{y||(Q(bn,`RPC '${e}' stream ${s} transport opened.`),C.yo())}),A(m,ul.EventType.CLOSE,()=>{y||(y=!0,Q(bn,`RPC '${e}' stream ${s} transport closed`),C.So())}),A(m,ul.EventType.ERROR,k=>{y||(y=!0,sr(bn,`RPC '${e}' stream ${s} transport errored:`,k),C.So(new J(B.UNAVAILABLE,"The operation could not be completed")))}),A(m,ul.EventType.MESSAGE,k=>{var U;if(!y){const j=k.data[0];Ie(!!j);const M=j,q=M.error||((U=M[0])===null||U===void 0?void 0:U.error);if(q){Q(bn,`RPC '${e}' stream ${s} received error:`,q);const ee=q.status;let Z=function(T){const P=Wt[T];if(P!==void 0)return nb(P)}(ee),I=q.message;Z===void 0&&(Z=B.INTERNAL,I="Unknown error status: "+ee+" with message "+q.message),y=!0,C.So(new J(Z,I)),m.close()}else Q(bn,`RPC '${e}' stream ${s} received:`,j),C.bo(j)}}),A(a,a0.STAT_EVENT,k=>{k.stat===ff.PROXY?Q(bn,`RPC '${e}' stream ${s} detected buffering proxy`):k.stat===ff.NOPROXY&&Q(bn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{C.wo()},0),C}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ub(){return typeof window<"u"?window:null}function xc(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pu(n){return new GP(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Np{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&Q("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $b{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Np(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===B.RESOURCE_EXHAUSTED?(zt(t.toString()),zt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===B.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new J(B.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return Q("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(Q("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class FR extends $b{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=WP(this.serializer,e),r=function(i){if(!("targetChange"in i))return Ee.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Ee.min():o.readTime?Kt(o.readTime):Ee.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=Tf(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=zc(l)?{documents:hb(i,l)}:{query:Dd(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=ob(i,o.resumeToken);const c=If(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(Ee.min())>0){a.readTime=aa(i,o.snapshotVersion.toTimestamp());const c=If(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=JP(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=Tf(this.serializer),t.removeTarget=e,this.a_(t)}}class UR extends $b{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Ie(!!e.streamToken),this.lastStreamToken=e.streamToken,Ie(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Ie(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=QP(e.writeResults,e.commitTime),r=Kt(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=Tf(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>zl(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $R extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new J(B.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Ef(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new J(B.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Ef(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new J(B.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class jR{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(zt(t),this.D_=!1):Q("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BR{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{oi(this)&&(Q("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=ue(l);c.L_.add(4),await Ea(c),c.q_.set("Unknown"),c.L_.delete(4),await mu(c)}(this))})}),this.q_=new jR(r,s)}}async function mu(n){if(oi(n))for(const e of n.B_)await e(!0)}async function Ea(n){for(const e of n.B_)await e(!1)}function Md(n,e){const t=ue(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Lp(t)?Mp(t):xa(t).r_()&&Op(t,e))}function ca(n,e){const t=ue(n),r=xa(t);t.N_.delete(e),r.r_()&&jb(t,e),t.N_.size===0&&(r.r_()?r.o_():oi(t)&&t.q_.set("Unknown"))}function Op(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ee.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}xa(n).A_(e)}function jb(n,e){n.Q_.xe(e),xa(n).R_(e)}function Mp(n){n.Q_=new jP({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),xa(n).start(),n.q_.v_()}function Lp(n){return oi(n)&&!xa(n).n_()&&n.N_.size>0}function oi(n){return ue(n).L_.size===0}function Bb(n){n.Q_=void 0}async function qR(n){n.q_.set("Online")}async function zR(n){n.N_.forEach((e,t)=>{Op(n,e)})}async function GR(n,e){Bb(n),Lp(n)?(n.q_.M_(e),Mp(n)):n.q_.set("Unknown")}async function KR(n,e,t){if(n.q_.set("Online"),e instanceof ib&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){Q("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await td(n,r)}else if(e instanceof Tc?n.Q_.Ke(e):e instanceof sb?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Ee.min()))try{const r=await Vb(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const f=i.N_.get(c);f&&i.N_.set(c,f.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const f=i.N_.get(l);if(!f)return;i.N_.set(l,f.withResumeToken(Ut.EMPTY_BYTE_STRING,f.snapshotVersion)),jb(i,l);const m=new Gr(f.target,l,c,f.sequenceNumber);Op(i,m)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){Q("RemoteStore","Failed to raise snapshot:",r),await td(n,r)}}async function td(n,e,t){if(!si(e))throw e;n.L_.add(1),await Ea(n),n.q_.set("Offline"),t||(t=()=>Vb(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Q("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await mu(n)})}function qb(n,e){return e().catch(t=>td(n,t,e))}async function Ta(n){const e=ue(n),t=Zs(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;HR(e);)try{const s=await kR(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,WR(e,s)}catch(s){await td(e,s)}zb(e)&&Gb(e)}function HR(n){return oi(n)&&n.O_.length<10}function WR(n,e){n.O_.push(e);const t=Zs(n);t.r_()&&t.V_&&t.m_(e.mutations)}function zb(n){return oi(n)&&!Zs(n).n_()&&n.O_.length>0}function Gb(n){Zs(n).start()}async function QR(n){Zs(n).p_()}async function JR(n){const e=Zs(n);for(const t of n.O_)e.m_(t.mutations)}async function YR(n,e,t){const r=n.O_.shift(),s=wp.from(r,e,t);await qb(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Ta(n)}async function XR(n,e){e&&Zs(n).V_&&await async function(r,s){if(function(o){return tb(o)&&o!==B.ABORTED}(s.code)){const i=r.O_.shift();Zs(r).s_(),await qb(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Ta(r)}}(n,e),zb(n)&&Gb(n)}async function Mv(n,e){const t=ue(n);t.asyncQueue.verifyOperationInProgress(),Q("RemoteStore","RemoteStore received new credentials");const r=oi(t);t.L_.add(3),await Ea(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await mu(t)}async function Cf(n,e){const t=ue(n);e?(t.L_.delete(2),await mu(t)):e||(t.L_.add(2),await Ea(t),t.q_.set("Unknown"))}function xa(n){return n.K_||(n.K_=function(t,r,s){const i=ue(t);return i.w_(),new FR(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:qR.bind(null,n),Ro:zR.bind(null,n),mo:GR.bind(null,n),d_:KR.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Lp(n)?Mp(n):n.q_.set("Unknown")):(await n.K_.stop(),Bb(n))})),n.K_}function Zs(n){return n.U_||(n.U_=function(t,r,s){const i=ue(t);return i.w_(),new UR(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:QR.bind(null,n),mo:XR.bind(null,n),f_:JR.bind(null,n),g_:YR.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await Ta(n)):(await n.U_.stop(),n.O_.length>0&&(Q("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fp{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new an,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Fp(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new J(B.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Aa(n,e){if(zt("AsyncQueue",`${e}: ${n}`),si(n))return new J(B.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zo{constructor(e){this.comparator=e?(t,r)=>e(t,r)||fe.comparator(t.key,r.key):(t,r)=>fe.comparator(t.key,r.key),this.keyedMap=cl(),this.sortedSet=new wt(this.comparator)}static emptySet(e){return new zo(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof zo)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new zo;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lv{constructor(){this.W_=new wt(fe.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):ye():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class da{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new da(e,t,zo.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&uu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZR{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class e1{constructor(){this.queries=Fv(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=ue(t),i=s.queries;s.queries=Fv(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new J(B.ABORTED,"Firestore shutting down"))}}function Fv(){return new ls(n=>$0(n),uu)}async function Up(n,e){const t=ue(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new ZR,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Aa(o,`Initialization of query '${No(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&jp(t)}async function $p(n,e){const t=ue(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function t1(n,e){const t=ue(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&jp(t)}function n1(n,e,t){const r=ue(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function jp(n){n.Y_.forEach(e=>{e.next()})}var kf,Uv;(Uv=kf||(kf={})).ea="default",Uv.Cache="cache";class Bp{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new da(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=da.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==kf.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r1{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $v{constructor(e){this.serializer=e}Es(e){return Pr(this.serializer,e)}ds(e){return e.metadata.exists?db(this.serializer,e.document,!1):It.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Kt(e)}}class s1{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Kb(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=Qe.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new $v(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Be()).add(i);t.set(o,a)}}return t}async complete(){const e=await DR(this.localStore,new $v(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await VR(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function Kb(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hb{constructor(e){this.key=e}}class Wb{constructor(e){this.key=e}}class Qb{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Be(),this.mutatedKeys=Be(),this.Aa=B0(e),this.Ra=new zo(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new Lv,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((f,m)=>{const v=s.get(f),y=cu(this.query,m)?m:null,C=!!v&&this.mutatedKeys.has(v.key),A=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let k=!1;v&&y?v.data.isEqual(y.data)?C!==A&&(r.track({type:3,doc:y}),k=!0):this.ga(v,y)||(r.track({type:2,doc:y}),k=!0,(l&&this.Aa(y,l)>0||c&&this.Aa(y,c)<0)&&(a=!0)):!v&&y?(r.track({type:0,doc:y}),k=!0):v&&!y&&(r.track({type:1,doc:v}),k=!0,(l||c)&&(a=!0)),k&&(y?(o=o.add(y),i=A?i.add(f):i.delete(f)):(o=o.delete(f),i=i.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((f,m)=>function(y,C){const A=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ye()}};return A(y)-A(C)}(f.type,m.type)||this.Aa(f.doc,m.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new da(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Lv,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Be(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new Wb(r))}),this.da.forEach(r=>{e.has(r)||t.push(new Hb(r))}),t}ba(e){this.Ta=e.Ts,this.da=Be();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return da.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class i1{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class o1{constructor(e){this.key=e,this.va=!1}}class a1{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new ls(a=>$0(a),uu),this.Ma=new Map,this.xa=new Set,this.Oa=new wt(fe.comparator),this.Na=new Map,this.La=new Pp,this.Ba={},this.ka=new Map,this.qa=Hi.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function l1(n,e,t=!0){const r=Ld(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await Jb(r,e,t,!0),s}async function u1(n,e){const t=Ld(n);await Jb(t,e,!0,!1)}async function Jb(n,e,t,r){const s=await la(n.localStore,Pn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await qp(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&Md(n.remoteStore,s),a}async function qp(n,e,t,r,s){n.Ka=(m,v,y)=>async function(A,k,U,j){let M=k.view.ma(U);M.ns&&(M=await Xc(A.localStore,k.query,!1).then(({documents:I})=>k.view.ma(I,M)));const q=j&&j.targetChanges.get(k.targetId),ee=j&&j.targetMismatches.get(k.targetId)!=null,Z=k.view.applyChanges(M,A.isPrimaryClient,q,ee);return Df(A,k.targetId,Z.wa),Z.snapshot}(n,m,v,y);const i=await Xc(n.localStore,e,!0),o=new Qb(e,i.Ts),a=o.ma(i.documents),l=fu.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);Df(n,t,c.wa);const f=new i1(e,t,o);return n.Fa.set(e,f),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function c1(n,e,t){const r=ue(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!uu(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await ua(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&ca(r.remoteStore,s.targetId),ha(r,s.targetId)}).catch(ri)):(ha(r,s.targetId),await ua(r.localStore,s.targetId,!0))}async function d1(n,e){const t=ue(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ca(t.remoteStore,r.targetId))}async function h1(n,e,t){const r=Hp(n);try{const s=await function(o,a){const l=ue(o),c=Nt.now(),f=a.reduce((y,C)=>y.add(C.key),Be());let m,v;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let C=jn(),A=Be();return l.cs.getEntries(y,f).next(k=>{C=k,C.forEach((U,j)=>{j.isValidDocument()||(A=A.add(U))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,C)).next(k=>{m=k;const U=[];for(const j of a){const M=FP(j,m.get(j.key).overlayedDocument);M!=null&&U.push(new us(j.key,M,R0(M.value.mapValue),Ct.exists(!0)))}return l.mutationQueue.addMutationBatch(y,c,U,a)}).next(k=>{v=k;const U=k.applyToLocalDocumentSet(m,A);return l.documentOverlayCache.saveOverlays(y,k.batchId,U)})}).then(()=>({batchId:v.batchId,changes:z0(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new wt(Ne)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await cs(r,s.changes),await Ta(r.remoteStore)}catch(s){const i=Aa(s,"Failed to persist write");t.reject(i)}}async function Yb(n,e){const t=ue(n);try{const r=await CR(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Ie(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Ie(o.va):s.removedDocuments.size>0&&(Ie(o.va),o.va=!1))}),await cs(t,r,e)}catch(r){await ri(r)}}function jv(n,e,t){const r=ue(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=ue(o);l.onlineState=a;let c=!1;l.queries.forEach((f,m)=>{for(const v of m.j_)v.Z_(a)&&(c=!0)}),c&&jp(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function f1(n,e,t){const r=ue(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new wt(fe.comparator);o=o.insert(i,It.newNoDocument(i,Ee.min()));const a=Be().add(i),l=new hu(Ee.min(),new Map,new wt(Ne),o,a);await Yb(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),Kp(r)}else await ua(r.localStore,e,!1).then(()=>ha(r,e,t)).catch(ri)}async function p1(n,e){const t=ue(n),r=e.batch.batchId;try{const s=await RR(t.localStore,e);Gp(t,r,null),zp(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await cs(t,s)}catch(s){await ri(s)}}async function m1(n,e,t){const r=ue(n);try{const s=await function(o,a){const l=ue(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let f;return l.mutationQueue.lookupMutationBatch(c,a).next(m=>(Ie(m!==null),f=m.keys(),l.mutationQueue.removeMutationBatch(c,m))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,f,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,f)).next(()=>l.localDocuments.getDocuments(c,f))})}(r.localStore,e);Gp(r,e,t),zp(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await cs(r,s)}catch(s){await ri(s)}}async function g1(n,e){const t=ue(n);oi(t.remoteStore)||Q("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=ue(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Aa(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function zp(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function Gp(n,e,t){const r=ue(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function ha(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||Xb(n,r)})}function Xb(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(ca(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Kp(n))}function Df(n,e,t){for(const r of t)r instanceof Hb?(n.La.addReference(r.key,e),v1(n,r)):r instanceof Wb?(Q("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||Xb(n,r.key)):ye()}function v1(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(Q("SyncEngine","New document in limbo: "+t),n.xa.add(r),Kp(n))}function Kp(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new fe(Qe.fromString(e)),r=n.qa.next();n.Na.set(r,new o1(t)),n.Oa=n.Oa.insert(t,r),Md(n.remoteStore,new Gr(Pn(ba(t.path)),r,"TargetPurposeLimboResolution",Un.oe))}}async function cs(n,e,t){const r=ue(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var f;if((c||t)&&r.isPrimaryClient){const m=c?!c.fromCache:(f=t==null?void 0:t.targetChanges.get(l.targetId))===null||f===void 0?void 0:f.current;r.sharedClientState.updateQueryState(l.targetId,m?"current":"not-current")}if(c){s.push(c);const m=Dp.Wi(l.targetId,c);i.push(m)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const f=ue(l);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>O.forEach(c,v=>O.forEach(v.$i,y=>f.persistence.referenceDelegate.addReference(m,v.targetId,y)).next(()=>O.forEach(v.Ui,y=>f.persistence.referenceDelegate.removeReference(m,v.targetId,y)))))}catch(m){if(!si(m))throw m;Q("LocalStore","Failed to update sequence numbers: "+m)}for(const m of c){const v=m.targetId;if(!m.fromCache){const y=f.os.get(v),C=y.snapshotVersion,A=y.withLastLimboFreeSnapshotVersion(C);f.os=f.os.insert(v,A)}}}(r.localStore,i))}async function y1(n,e){const t=ue(n);if(!t.currentUser.isEqual(e)){Q("SyncEngine","User change. New user:",e.toKey());const r=await Db(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new J(B.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await cs(t,r.hs)}}function _1(n,e){const t=ue(n),r=t.Na.get(e);if(r&&r.va)return Be().add(r.key);{let s=Be();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function b1(n,e){const t=ue(n),r=await Xc(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&Df(t,e.targetId,s.wa),s}async function w1(n,e){const t=ue(n);return Mb(t.localStore,e).then(r=>cs(t,r))}async function I1(n,e,t,r){const s=ue(n),i=await function(a,l){const c=ue(a),f=ue(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",m=>f.Mn(m,l).next(v=>v?c.localDocuments.getDocuments(m,v):O.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Ta(s.remoteStore):t==="acknowledged"||t==="rejected"?(Gp(s,e,r||null),zp(s,e),function(a,l){ue(ue(a).mutationQueue).On(l)}(s.localStore,e)):ye(),await cs(s,i)):Q("SyncEngine","Cannot apply mutation batch with id: "+e)}async function E1(n,e){const t=ue(n);if(Ld(t),Hp(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await Bv(t,r.toArray());t.Qa=!0,await Cf(t.remoteStore,!0);for(const i of s)Md(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(ha(t,o),ua(t.localStore,o,!0))),ca(t.remoteStore,o)}),await s,await Bv(t,r),function(o){const a=ue(o);a.Na.forEach((l,c)=>{ca(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new wt(fe.comparator)}(t),t.Qa=!1,await Cf(t.remoteStore,!1)}}async function Bv(n,e,t){const r=ue(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await la(r.localStore,Pn(l[0]));for(const c of l){const f=r.Fa.get(c),m=await b1(r,f);m.snapshot&&i.push(m.snapshot)}}else{const c=await Ob(r.localStore,o);a=await la(r.localStore,c),await qp(r,Zb(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function Zb(n){return L0(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function T1(n){return function(t){return ue(ue(t).persistence).Qi()}(ue(n).localStore)}async function x1(n,e,t,r){const s=ue(n);if(s.Qa)return void Q("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await Mb(s.localStore,j0(i[0])),a=hu.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ut.EMPTY_BYTE_STRING);await cs(s,o,a);break}case"rejected":await ua(s.localStore,e,!0),ha(s,e,r);break;default:ye()}}async function A1(n,e,t){const r=Ld(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){Q("SyncEngine","Adding an already active target "+s);continue}const i=await Ob(r.localStore,s),o=await la(r.localStore,i);await qp(r,Zb(i),o.targetId,!1,o.resumeToken),Md(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await ua(r.localStore,s,!1).then(()=>{ca(r.remoteStore,s),ha(r,s)}).catch(ri)}}function Ld(n){const e=ue(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Yb.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=_1.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=f1.bind(null,e),e.Ca.d_=t1.bind(null,e.eventManager),e.Ca.$a=n1.bind(null,e.eventManager),e}function Hp(n){const e=ue(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=p1.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=m1.bind(null,e),e}function S1(n,e,t){const r=ue(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,C){const A=ue(y),k=Kt(C.createTime);return A.persistence.runTransaction("hasNewerBundle","readonly",U=>A.Gr.getBundleMetadata(U,C.id)).then(U=>!!U&&U.createTime.compareTo(k)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(Kb(l));const c=new s1(l,i.localStore,o.serializer);let f=await o.Ua();for(;f;){const v=await c.la(f);v&&a._updateProgress(v),f=await o.Ua()}const m=await c.complete();return await cs(i,m.Ia,void 0),await function(y,C){const A=ue(y);return A.persistence.runTransaction("Save bundle","readwrite",k=>A.Gr.saveBundleMetadata(k,C))}(i.localStore,l),a._completeWith(m.progress),Promise.resolve(m.Pa)}catch(l){return sr("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class ei{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=pu(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return kb(this.persistence,new Cb,e.initialUser,this.serializer)}Ga(e){return new Rp(Od.Zr,this.serializer)}Wa(e){return new Fb}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ei.provider={build:()=>new ei};class P1 extends ei{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Ie(this.persistence.referenceDelegate instanceof Yc);const r=this.persistence.referenceDelegate.garbageCollector;return new xb(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?In.withCacheSize(this.cacheSizeBytes):In.DEFAULT;return new Rp(r=>Yc.Zr(r,t),this.serializer)}}class Wp extends ei{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await Hp(this.Ja.syncEngine),await Ta(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return kb(this.persistence,new Cb,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new xb(r,e.asyncQueue,t)}Ha(e,t){const r=new JS(t,this.persistence);return new QS(e.asyncQueue,r)}Ga(e){const t=kp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?In.withCacheSize(this.cacheSizeBytes):In.DEFAULT;return new Cp(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Ub(),xc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new Fb}}class ew extends Wp{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Mh&&(this.sharedClientState.syncEngine={no:I1.bind(null,t),ro:x1.bind(null,t),io:A1.bind(null,t),Qi:T1.bind(null,t),eo:w1.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await E1(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=Ub();if(!Mh.D(t))throw new J(B.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=kp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Mh(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class ti{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>jv(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=y1.bind(null,this.syncEngine),await Cf(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new e1}()}createDatastore(e){const t=pu(e.databaseInfo.databaseId),r=function(i){return new LR(i)}(e.databaseInfo);return function(i,o,a,l){return new $R(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new BR(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>jv(this.syncEngine,t,0),function(){return Ov.D()?new Ov:new NR}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,f){const m=new a1(s,i,o,a,l,c);return f&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=ue(s);Q("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Ea(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}ti.provider={build:()=>new ti};function qv(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):zt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R1{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new an,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new r1(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C1{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new J(B.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=ue(s),a={documents:i.map(m=>ql(o.serializer,m))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,Qe.emptyPath(),a,i.length),c=new Map;l.forEach(m=>{const v=HP(o.serializer,m);c.set(v.key.toString(),v)});const f=[];return i.forEach(m=>{const v=c.get(m.toString());Ie(!!v),f.push(v)}),f}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ia(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=fe.fromPath(r);this.mutations.push(new _p(s,this.precondition(s)))}),await async function(r,s){const i=ue(r),o={writes:s.map(a=>zl(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,Qe.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ye();t=Ee.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new J(B.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Ee.min())?Ct.exists(!1):Ct.updateTime(t):Ct.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Ee.min()))throw new J(B.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ct.updateTime(t)}return Ct.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k1{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Np(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new C1(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!au(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!tb(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=on.UNAUTHENTICATED,this.clientId=h0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{Q("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(Q("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new an;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Aa(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Fh(n,e){n.asyncQueue.verifyOperationInProgress(),Q("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await Db(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function zv(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Qp(n);Q("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Mv(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Mv(e.remoteStore,s)),n._onlineComponents=e}async function Qp(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Q("FirestoreClient","Using user provided OfflineComponentProvider");try{await Fh(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===B.FAILED_PRECONDITION||s.code===B.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;sr("Error using user provided cache. Falling back to memory cache: "+t),await Fh(n,new ei)}}else Q("FirestoreClient","Using default OfflineComponentProvider"),await Fh(n,new ei);return n._offlineComponents}async function Ud(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Q("FirestoreClient","Using user provided OnlineComponentProvider"),await zv(n,n._uninitializedComponentsProvider._online)):(Q("FirestoreClient","Using default OnlineComponentProvider"),await zv(n,new ti))),n._onlineComponents}function tw(n){return Qp(n).then(e=>e.persistence)}function Sa(n){return Qp(n).then(e=>e.localStore)}function nw(n){return Ud(n).then(e=>e.remoteStore)}function Jp(n){return Ud(n).then(e=>e.syncEngine)}function rw(n){return Ud(n).then(e=>e.datastore)}async function fa(n){const e=await Ud(n),t=e.eventManager;return t.onListen=l1.bind(null,e.syncEngine),t.onUnlisten=c1.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=u1.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=d1.bind(null,e.syncEngine),t}function V1(n){return n.asyncQueue.enqueue(async()=>{const e=await tw(n),t=await nw(n);return e.setNetworkEnabled(!0),function(s){const i=ue(s);return i.L_.delete(0),mu(i)}(t)})}function N1(n){return n.asyncQueue.enqueue(async()=>{const e=await tw(n),t=await nw(n);return e.setNetworkEnabled(!1),async function(s){const i=ue(s);i.L_.add(0),await Ea(i),i.q_.set("Offline")}(t)})}function O1(n,e){const t=new an;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,f){const m=ue(c);return m.persistence.runTransaction("read document","readonly",v=>m.localDocuments.getDocument(v,f))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new J(B.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Aa(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Sa(n),e,t)),t.promise}function sw(n,e,t={}){const r=new an;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const f=new Fd({next:v=>{f.Za(),o.enqueueAndForget(()=>$p(i,m));const y=v.docs.has(a);!y&&v.fromCache?c.reject(new J(B.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&v.fromCache&&l&&l.source==="server"?c.reject(new J(B.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(v)},error:v=>c.reject(v)}),m=new Bp(ba(a.path),f,{includeMetadataChanges:!0,_a:!0});return Up(i,m)}(await fa(n),n.asyncQueue,e,t,r)),r.promise}function M1(n,e){const t=new an;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await Xc(s,i,!0),l=new Qb(i,a.Ts),c=l.ma(a.documents),f=l.applyChanges(c,!1);o.resolve(f.snapshot)}catch(a){const l=Aa(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Sa(n),e,t)),t.promise}function iw(n,e,t={}){const r=new an;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const f=new Fd({next:v=>{f.Za(),o.enqueueAndForget(()=>$p(i,m)),v.fromCache&&l.source==="server"?c.reject(new J(B.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(v)},error:v=>c.reject(v)}),m=new Bp(a,f,{includeMetadataChanges:!0,_a:!0});return Up(i,m)}(await fa(n),n.asyncQueue,e,t,r)),r.promise}function L1(n,e,t){const r=new an;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await rw(n);r.resolve(async function(o,a,l){var c;const f=ue(o),{request:m,ut:v,parent:y}=fb(f.serializer,F0(a),l);f.connection.Fo||delete m.parent;const C=(await f.Lo("RunAggregationQuery",f.serializer.databaseId,y,m,1)).filter(k=>!!k.result);Ie(C.length===1);const A=(c=C[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(A).reduce((k,U)=>(k[v[U]]=A[U],k),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function F1(n,e){const t=new Fd(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){ue(s).Y_.add(i),i.next()}(await fa(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){ue(s).Y_.delete(i)}(await fa(n),t))}}function U1(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?rb().encode(o):o,function(f,m){return new R1(f,m)}(function(f,m){if(f instanceof Uint8Array)return qv(f,m);if(f instanceof ArrayBuffer)return qv(new Uint8Array(f),m);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,pu(e));n.asyncQueue.enqueueAndForget(async()=>{S1(await Jp(n),s,r)})}function $1(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=ue(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await Sa(n),e))}function j1(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=ue(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(m,v,y,C,A){m=[...m],v=[...v],m.sort(y),v.sort(y);const k=m.length,U=v.length;let j=0,M=0;for(;j<U&&M<k;){const q=y(m[M],v[j]);q<0?A(m[M++]):q>0?C(v[j++]):(j++,M++)}for(;j<U;)C(v[j++]);for(;M<k;)A(m[M++])}(c,s,GS,f=>{a.push(o.addFieldIndex(l,f))},f=>{a.push(o.deleteFieldIndex(l,f))})).next(()=>O.waitFor(a)))}(await Sa(n),e))}function B1(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){ue(r).ss.zi=s}(await Sa(n),e))}function q1(n){return n.asyncQueue.enqueue(async()=>function(t){const r=ue(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Sa(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ow(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gv=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yp(n,e,t){if(!t)throw new J(B.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function z1(n,e,t,r){if(e===!0&&r===!0)throw new J(B.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Kv(n){if(!fe.isDocumentKey(n))throw new J(B.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Hv(n){if(fe.isDocumentKey(n))throw new J(B.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function $d(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ye()}function Ke(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new J(B.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=$d(n);throw new J(B.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function aw(n,e){if(e<=0)throw new J(B.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wv{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new J(B.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new J(B.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}z1("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ow((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new J(B.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new J(B.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new J(B.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class gu{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Wv({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new J(B.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new J(B.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Wv(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new LS;switch(r.type){case"firstParty":return new jS(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new J(B.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=Gv.get(t);r&&(Q("ComponentProvider","Removing Datastore"),Gv.delete(t),r.terminate())}(this),Promise.resolve()}}function G1(n,e,t,r={}){var s;const i=(n=Ke(n,gu))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&sr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=on.MOCK_USER;else{a=hA(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new J(B.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new on(c)}n._authCredentials=new FS(new c0(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new mn(this.firestore,e,this._query)}}class Ht{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Rr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ht(this.firestore,e,this._key)}}class Rr extends mn{constructor(e,t,r){super(e,t,ba(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ht(this.firestore,null,new fe(e))}withConverter(e){return new Rr(this.firestore,e,this._path)}}function Ye(n,e,...t){if(n=Te(n),Yp("collection","path",e),n instanceof gu){const r=Qe.fromString(e,...t);return Hv(r),new Rr(n,null,r)}{if(!(n instanceof Ht||n instanceof Rr))throw new J(B.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Qe.fromString(e,...t));return Hv(r),new Rr(n.firestore,null,r)}}function C4(n,e){if(n=Ke(n,gu),Yp("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new J(B.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new mn(n,null,function(r){return new as(Qe.emptyPath(),r)}(e))}function Ve(n,e,...t){if(n=Te(n),arguments.length===1&&(e=h0.newId()),Yp("doc","path",e),n instanceof gu){const r=Qe.fromString(e,...t);return Kv(r),new Ht(n,null,new fe(r))}{if(!(n instanceof Ht||n instanceof Rr))throw new J(B.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Qe.fromString(e,...t));return Kv(r),new Ht(n.firestore,n instanceof Rr?n.converter:null,new fe(r))}}function k4(n,e){return n=Te(n),e=Te(e),(n instanceof Ht||n instanceof Rr)&&(e instanceof Ht||e instanceof Rr)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function lw(n,e){return n=Te(n),e=Te(e),n instanceof mn&&e instanceof mn&&n.firestore===e.firestore&&uu(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qv{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Np(this,"async_queue_retry"),this.Vu=()=>{const r=xc();r&&Q("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=xc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=xc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new an;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!si(e))throw e;Q("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw zt("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Fp.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&ye()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function Vf(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class K1{constructor(){this._progressObserver={},this._taskCompletionResolver=new an,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D4=-1;class gt extends gu{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Qv,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Qv(e),this._firestoreClient=void 0,await e}}}function V4(n,e,t){t||(t="(default)");const r=ou(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(Ws(i,e))return s;throw new J(B.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new J(B.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new J(B.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function H1(n,e){const t=typeof n=="object"?n:t0(),r=typeof n=="string"?n:e||"(default)",s=ou(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=cA("firestore");i&&G1(s,...i)}return s}function Ot(n){if(n._terminated)throw new J(B.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||uw(n),n._firestoreClient}function uw(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,f){return new vP(a,l,c,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,ow(f.experimentalLongPollingOptions),f.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new D1(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function W1(n,e){sr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return cw(n,ti.provider,{build:r=>new Wp(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function N4(n){sr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();cw(n,ti.provider,{build:t=>new ew(t,e.cacheSizeBytes)})}function cw(n,e,t){if((n=Ke(n,gt))._firestoreClient||n._terminated)throw new J(B.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new J(B.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},uw(n)}function O4(n){if(n._initialized&&!n._terminated)throw new J(B.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new an;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Sr.D())return Promise.resolve();const s=r+"main";await Sr.delete(s)}(kp(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function M4(n){return function(t){const r=new an;return t.asyncQueue.enqueueAndForget(async()=>g1(await Jp(t),r)),r.promise}(Ot(n=Ke(n,gt)))}function L4(n){return V1(Ot(n=Ke(n,gt)))}function F4(n){return N1(Ot(n=Ke(n,gt)))}function U4(n){return ES(n.app,"firestore",n._databaseId.database),n._delete()}function $4(n,e){const t=Ot(n=Ke(n,gt)),r=new K1;return U1(t,n._databaseId,e,r),r}function j4(n,e){return $1(Ot(n=Ke(n,gt)),e).then(t=>t?new mn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gl{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class Q1{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Wi(Ut.fromBase64String(e))}catch(t){throw new J(B.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Wi(Ut.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new J(B.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Rt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function B4(){return new Ji("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xp{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new J(B.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new J(B.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ne(this._lat,e._lat)||Ne(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jd{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J1=/^__.*__$/;class Y1{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new us(e,this.data,this.fieldMask,t,this.fieldTransforms):new wa(e,this.data,t,this.fieldTransforms)}}class dw{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new us(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function hw(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ye()}}class Bd{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Bd(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return nd(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(hw(this.Cu)&&J1.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class X1{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||pu(e)}Qu(e,t,r,s=!1){return new Bd({Cu:e,methodName:t,qu:r,path:Rt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Xi(n){const e=n._freezeSettings(),t=pu(n._databaseId);return new X1(n._databaseId,!!e.ignoreUndefinedProperties,t)}function qd(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);im("Data must be an object, but it was:",o,r);const a=mw(r,o);let l,c;if(i.merge)l=new $n(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const f=[];for(const m of i.mergeFields){const v=Kl(e,m,t);if(!o.contains(v))throw new J(B.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);vw(f,v)||f.push(v)}l=new $n(f),c=o.fieldTransforms.filter(m=>l.covers(m.field))}else l=null,c=o.fieldTransforms;return new Y1(new pn(a),l,c)}class vu extends Yi{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof vu}}function fw(n,e,t){return new Bd({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Zp extends Yi{_toFieldTransform(e){return new du(e.path,new ia)}isEqual(e){return e instanceof Zp}}class em extends Yi{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=fw(this,e,!0),r=this.Ku.map(i=>Zi(i,t)),s=new qi(r);return new du(e.path,s)}isEqual(e){return e instanceof em&&Ws(this.Ku,e.Ku)}}class tm extends Yi{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=fw(this,e,!0),r=this.Ku.map(i=>Zi(i,t)),s=new zi(r);return new du(e.path,s)}isEqual(e){return e instanceof tm&&Ws(this.Ku,e.Ku)}}class nm extends Yi{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new oa(e.serializer,H0(e.serializer,this.$u));return new du(e.path,t)}isEqual(e){return e instanceof nm&&this.$u===e.$u}}function rm(n,e,t,r){const s=n.Qu(1,e,t);im("Data must be an object, but it was:",s,r);const i=[],o=pn.empty();ii(r,(l,c)=>{const f=zd(e,l,t);c=Te(c);const m=s.Nu(f);if(c instanceof vu)i.push(f);else{const v=Zi(c,m);v!=null&&(i.push(f),o.set(f,v))}});const a=new $n(i);return new dw(o,a,s.fieldTransforms)}function sm(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[Kl(e,r,t)],l=[s];if(i.length%2!=0)throw new J(B.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<i.length;v+=2)a.push(Kl(e,i[v])),l.push(i[v+1]);const c=[],f=pn.empty();for(let v=a.length-1;v>=0;--v)if(!vw(c,a[v])){const y=a[v];let C=l[v];C=Te(C);const A=o.Nu(y);if(C instanceof vu)c.push(y);else{const k=Zi(C,A);k!=null&&(c.push(y),f.set(y,k))}}const m=new $n(c);return new dw(f,m,o.fieldTransforms)}function pw(n,e,t,r=!1){return Zi(t,n.Qu(r?4:3,e))}function Zi(n,e){if(gw(n=Te(n)))return im("Unsupported field value:",e,n),mw(n,e);if(n instanceof Yi)return function(r,s){if(!hw(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=Zi(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Te(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return H0(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Nt.fromDate(r);return{timestampValue:aa(s.serializer,i)}}if(r instanceof Nt){const i=new Nt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:aa(s.serializer,i)}}if(r instanceof Xp)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Wi)return{bytesValue:ob(s.serializer,r._byteString)};if(r instanceof Ht){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Tp(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof jd)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return yp(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${$d(r)}`)}(n,e)}function mw(n,e){const t={};return x0(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ii(n,(r,s)=>{const i=Zi(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function gw(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Nt||n instanceof Xp||n instanceof Wi||n instanceof Ht||n instanceof Yi||n instanceof jd)}function im(n,e,t){if(!gw(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=$d(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function Kl(n,e,t){if((e=Te(e))instanceof Ji)return e._internalPath;if(typeof e=="string")return zd(n,e);throw nd("Field path arguments must be of type string or ",n,!1,void 0,t)}const Z1=new RegExp("[~\\*/\\[\\]]");function zd(n,e,t){if(e.search(Z1)>=0)throw nd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ji(...e.split("."))._internalPath}catch{throw nd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function nd(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new J(B.INVALID_ARGUMENT,a+n+l)}function vw(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hl{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ht(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new eC(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Gd("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class eC extends Hl{data(){return super.data()}}function Gd(n,e){return typeof e=="string"?zd(n,e):e instanceof Ji?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new J(B.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class om{}class yu extends om{}function Kd(n,e,...t){let r=[];e instanceof om&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Pa).length,a=i.filter(l=>l instanceof _u).length;if(o>1||o>0&&a>0)throw new J(B.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class _u extends yu{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new _u(e,t,r)}_apply(e){const t=this._parse(e);return bw(e._query,t),new mn(e.firestore,e.converter,wf(e._query,t))}_parse(e){const t=Xi(e.firestore);return function(i,o,a,l,c,f,m){let v;if(c.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new J(B.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){Yv(m,f);const y=[];for(const C of m)y.push(Jv(l,i,C));v={arrayValue:{values:y}}}else v=Jv(l,i,m)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||Yv(m,f),v=pw(a,o,m,f==="in"||f==="not-in");return Je.create(c,f,v)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function am(n,e,t){const r=e,s=Gd("where",n);return _u._create(s,r,t)}class Pa extends om{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Pa(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ct.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)bw(o,l),o=wf(o,l)}(e._query,t),new mn(e.firestore,e.converter,wf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function q4(...n){return n.forEach(e=>ww("or",e)),Pa._create("or",n)}function z4(...n){return n.forEach(e=>ww("and",e)),Pa._create("and",n)}class lm extends yu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new lm(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new J(B.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new J(B.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Bl(i,o)}(e._query,this._field,this._direction);return new mn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new as(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function tC(n,e="asc"){const t=e,r=Gd("orderBy",n);return lm._create(r,t)}class Hd extends yu{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Hd(e,t,r)}_apply(e){return new mn(e.firestore,e.converter,Kc(e._query,this._limit,this._limitType))}}function G4(n){return aw("limit",n),Hd._create("limit",n,"F")}function K4(n){return aw("limitToLast",n),Hd._create("limitToLast",n,"L")}class Wd extends yu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Wd(e,t,r)}_apply(e){const t=_w(e,this.type,this._docOrFields,this._inclusive);return new mn(e.firestore,e.converter,function(s,i){return new as(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function H4(...n){return Wd._create("startAt",n,!0)}function W4(...n){return Wd._create("startAfter",n,!1)}class Qd extends yu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Qd(e,t,r)}_apply(e){const t=_w(e,this.type,this._docOrFields,this._inclusive);return new mn(e.firestore,e.converter,function(s,i){return new as(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function Q4(...n){return Qd._create("endBefore",n,!1)}function J4(...n){return Qd._create("endAt",n,!0)}function _w(n,e,t,r){if(t[0]=Te(t[0]),t[0]instanceof Hl)return function(i,o,a,l,c){if(!l)throw new J(B.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const f=[];for(const m of qo(i))if(m.field.isKeyField())f.push(ji(o,l.key));else{const v=l.data.field(m.field);if(Sd(v))throw new J(B.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(v===null){const y=m.field.canonicalString();throw new J(B.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}f.push(v)}return new Xs(f,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Xi(n.firestore);return function(o,a,l,c,f,m){const v=o.explicitOrderBy;if(f.length>v.length)throw new J(B.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let C=0;C<f.length;C++){const A=f[C];if(v[C].field.isKeyField()){if(typeof A!="string")throw new J(B.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof A}`);if(!gp(o)&&A.indexOf("/")!==-1)throw new J(B.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${A}' contains a slash.`);const k=o.path.child(Qe.fromString(A));if(!fe.isDocumentKey(k))throw new J(B.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);const U=new fe(k);y.push(ji(a,U))}else{const k=pw(l,c,A);y.push(k)}}return new Xs(y,m)}(n._query,n.firestore._databaseId,s,e,t,r)}}function Jv(n,e,t){if(typeof(t=Te(t))=="string"){if(t==="")throw new J(B.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!gp(e)&&t.indexOf("/")!==-1)throw new J(B.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Qe.fromString(t));if(!fe.isDocumentKey(r))throw new J(B.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ji(n,new fe(r))}if(t instanceof Ht)return ji(n,t._key);throw new J(B.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${$d(t)}.`)}function Yv(n,e){if(!Array.isArray(n)||n.length===0)throw new J(B.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function bw(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new J(B.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new J(B.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function ww(n,e){if(!(e instanceof _u||e instanceof Pa))throw new J(B.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class Iw{convertValue(e,t="none"){switch(Js(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Pt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ts(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ye()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return ii(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>Pt(o.doubleValue));return new jd(i)}convertGeoPoint(e){return new Xp(Pt(e.latitude),Pt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Pd(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Ul(e));default:return null}}convertTimestamp(e){const t=es(e);return new Nt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Qe.fromString(e);Ie(vb(r));const s=new $i(r.get(1),r.get(3)),i=new fe(r.popFirst(5));return s.isEqual(t)||zt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jd(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class nC extends Iw{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wi(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ht(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y4(n){return new Gl("sum",Kl("sum",n))}function X4(n){return new Gl("avg",Kl("average",n))}function rC(){return new Gl("count")}function Z4(n,e){var t,r;return n instanceof Gl&&e instanceof Gl&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function eU(n,e){return lw(n.query,e.query)&&Ws(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class pa extends Hl{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ac(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Gd("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Ac extends pa{data(e={}){return super.data(e)}}class ma{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Di(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Ac(this._firestore,this._userDataWriter,r.key,r,new Di(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new J(B.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Ac(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Di(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Ac(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Di(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,f=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),f=o.indexOf(a.doc.key)),{type:sC(a.type),doc:l,oldIndex:c,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function sC(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ye()}}function tU(n,e){return n instanceof pa&&e instanceof pa?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof ma&&e instanceof ma&&n._firestore===e._firestore&&lw(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ds(n){n=Ke(n,Ht);const e=Ke(n.firestore,gt);return sw(Ot(e),n._key).then(t=>um(e,n,t))}class ai extends Iw{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wi(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ht(this.firestore,null,t)}}function nU(n){n=Ke(n,Ht);const e=Ke(n.firestore,gt),t=Ot(e),r=new ai(e);return O1(t,n._key).then(s=>new pa(e,r,n._key,s,new Di(s!==null&&s.hasLocalMutations,!0),n.converter))}function rU(n){n=Ke(n,Ht);const e=Ke(n.firestore,gt);return sw(Ot(e),n._key,{source:"server"}).then(t=>um(e,n,t))}function kt(n){n=Ke(n,mn);const e=Ke(n.firestore,gt),t=Ot(e),r=new ai(e);return yw(n._query),iw(t,n._query).then(s=>new ma(e,r,n,s))}function sU(n){n=Ke(n,mn);const e=Ke(n.firestore,gt),t=Ot(e),r=new ai(e);return M1(t,n._query).then(s=>new ma(e,r,n,s))}function iU(n){n=Ke(n,mn);const e=Ke(n.firestore,gt),t=Ot(e),r=new ai(e);return iw(t,n._query,{source:"server"}).then(s=>new ma(e,r,n,s))}function xn(n,e,t){n=Ke(n,Ht);const r=Ke(n.firestore,gt),s=Jd(n.converter,e,t);return wu(r,[qd(Xi(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Ct.none())])}function bu(n,e,t,...r){n=Ke(n,Ht);const s=Ke(n.firestore,gt),i=Xi(s);let o;return o=typeof(e=Te(e))=="string"||e instanceof Ji?sm(i,"updateDoc",n._key,e,t,r):rm(i,"updateDoc",n._key,e),wu(s,[o.toMutation(n._key,Ct.exists(!0))])}function rd(n){return wu(Ke(n.firestore,gt),[new Ia(n._key,Ct.none())])}function Yd(n,e){const t=Ke(n.firestore,gt),r=Ve(n),s=Jd(n.converter,e);return wu(t,[qd(Xi(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Ct.exists(!1))]).then(()=>r)}function oU(n,...e){var t,r,s;n=Te(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Vf(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Vf(e[o])){const m=e[o];e[o]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[o+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[o+2]=(s=m.complete)===null||s===void 0?void 0:s.bind(m)}let l,c,f;if(n instanceof Ht)c=Ke(n.firestore,gt),f=ba(n._key.path),l={next:m=>{e[o]&&e[o](um(c,n,m))},error:e[o+1],complete:e[o+2]};else{const m=Ke(n,mn);c=Ke(m.firestore,gt),f=m._query;const v=new ai(c);l={next:y=>{e[o]&&e[o](new ma(c,v,m,y))},error:e[o+1],complete:e[o+2]},yw(n._query)}return function(v,y,C,A){const k=new Fd(A),U=new Bp(y,k,C);return v.asyncQueue.enqueueAndForget(async()=>Up(await fa(v),U)),()=>{k.Za(),v.asyncQueue.enqueueAndForget(async()=>$p(await fa(v),U))}}(Ot(c),f,a,l)}function aU(n,e){return F1(Ot(n=Ke(n,gt)),Vf(e)?e:{next:e})}function wu(n,e){return function(r,s){const i=new an;return r.asyncQueue.enqueueAndForget(async()=>h1(await Jp(r),s,i)),i.promise}(Ot(n),e)}function um(n,e,t){const r=t.docs.get(e._key),s=new ai(n);return new pa(n,s,e._key,r,new Di(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lU(n){return iC(n,{count:rC()})}function iC(n,e){const t=Ke(n.firestore,gt),r=Ot(t),s=T0(e,(i,o)=>new eb(o,i.aggregateType,i._internalFieldPath));return L1(r,n._query,s).then(i=>function(a,l,c){const f=new ai(a);return new Q1(l,f,c)}(t,n,i))}class oC{constructor(e){this.kind="memory",this._onlineComponentProvider=ti.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=ei.provider}toJSON(){return{kind:this.kind}}}class aC{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=hC(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class lC{constructor(){this.kind="memoryEager",this._offlineComponentProvider=ei.provider}toJSON(){return{kind:this.kind}}}class uC{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new P1(e)}}toJSON(){return{kind:this.kind}}}function uU(){return new lC}function cU(n){return new uC(n==null?void 0:n.cacheSizeBytes)}function dU(n){return new oC(n)}function hU(n){return new aC(n)}class cC{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ti.provider,this._offlineComponentProvider={build:t=>new Wp(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class dC{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ti.provider,this._offlineComponentProvider={build:t=>new ew(t,e==null?void 0:e.cacheSizeBytes)}}}function hC(n){return new cC(n==null?void 0:n.forceOwnership)}function fU(){return new dC}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fC={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pC{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Xi(e)}set(e,t,r){this._verifyNotCommitted();const s=Ns(e,this._firestore),i=Jd(s.converter,t,r),o=qd(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Ct.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Ns(e,this._firestore);let o;return o=typeof(t=Te(t))=="string"||t instanceof Ji?sm(this._dataReader,"WriteBatch.update",i._key,t,r,s):rm(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Ct.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Ns(e,this._firestore);return this._mutations=this._mutations.concat(new Ia(t._key,Ct.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new J(B.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ns(n,e){if((n=Te(n)).firestore!==e)throw new J(B.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mC extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Xi(t)}get(t){const r=Ns(t,this._firestore),s=new nC(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return ye();const o=i[0];if(o.isFoundDocument())return new Hl(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new Hl(this._firestore,s,r._key,null,r.converter);throw ye()})}set(t,r,s){const i=Ns(t,this._firestore),o=Jd(i.converter,r,s),a=qd(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=Ns(t,this._firestore);let a;return a=typeof(r=Te(r))=="string"||r instanceof Ji?sm(this._dataReader,"Transaction.update",o._key,r,s,i):rm(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=Ns(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Ns(e,this._firestore),r=new ai(this._firestore);return super.get(e).then(s=>new pa(this._firestore,r,t._key,s._document,new Di(!1,!1),t.converter))}}function mU(n,e,t){n=Ke(n,gt);const r=Object.assign(Object.assign({},fC),t);return function(i){if(i.maxAttempts<1)throw new J(B.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new an;return i.asyncQueue.enqueueAndForget(async()=>{const c=await rw(i);new k1(i.asyncQueue,c,a,o,l).au()}),l.promise}(Ot(n),s=>e(new mC(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gU(){return new vu("deleteField")}function Iu(){return new Zp("serverTimestamp")}function vU(...n){return new em("arrayUnion",n)}function yU(...n){return new tm("arrayRemove",n)}function _U(n){return new nm("increment",n)}function bU(n){return new jd(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gC(n){return Ot(n=Ke(n,gt)),new pC(n,e=>wu(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wU(n,e){const t=Ot(n=Ke(n,gt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return sr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(f){throw new J(B.INVALID_ARGUMENT,"Failed to parse JSON: "+(f==null?void 0:f.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=Xv(l,"collectionGroup"),f=[];if(Array.isArray(l.fields))for(const m of l.fields){const v=zd("setIndexConfiguration",Xv(m,"fieldPath"));m.arrayConfig==="CONTAINS"?f.push(new Mi(v,2)):m.order==="ASCENDING"?f.push(new Mi(v,0)):m.order==="DESCENDING"&&f.push(new Mi(v,1))}a.push(new ta(ta.UNKNOWN_ID,c,f,na.empty()))}return a}(e);return j1(t,r)}function Xv(n,e){if(typeof n[e]!="string")throw new J(B.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vC{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function IU(n){var e;n=Ke(n,gt);const t=Zv.get(n);if(t)return t;if(((e=Ot(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new vC(n);return Zv.set(n,r),r}function EU(n){Ew(n,!0)}function TU(n){Ew(n,!1)}function xU(n){q1(Ot(n._firestore)).then(e=>Q("deleting all persistent cache indexes succeeded")).catch(e=>sr("deleting all persistent cache indexes failed",e))}function Ew(n,e){B1(Ot(n._firestore),e).then(t=>Q(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>sr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const Zv=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AU(n){var e;const t=(e=Ot(Ke(n.firestore,gt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Dd(t,Pn(n._query))._t}function SU(n,e){var t;const r=T0(e,(i,o)=>new eb(o,i.aggregateType,i._internalFieldPath)),s=(t=Ot(Ke(n.firestore,gt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:fb(s,F0(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PU{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return cm.instance.onExistenceFilterMismatch(e)}}class cm{constructor(){this.Uu=new Map}static get instance(){return cc||(cc=new cm,function(t){if(Hc)throw new Error("a TestingHooksSpi instance is already set");Hc=t}(cc)),cc}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let cc=null;(function(e,t=!0){(function(s){_a=s})(ya),Zo(new Ui("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new gt(new US(r.getProvider("auth-internal")),new BS(r.getProvider("app-check-internal")),function(c,f){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new J(B.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $i(c.options.projectId,f)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),qs(Bg,"4.7.3",e),qs(Bg,"4.7.3","esm2017")})();function dm(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RU={PHONE:"phone",TOTP:"totp"},CU={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},kU={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},DU={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},VU={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yC(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function Tw(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const NU=yC,_C=Tw,xw=new iu("auth","Firebase",Tw()),OU={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sd=new up("@firebase/auth");function bC(n,...e){sd.logLevel<=He.WARN&&sd.warn(`Auth (${ya}): ${n}`,...e)}function Sc(n,...e){sd.logLevel<=He.ERROR&&sd.error(`Auth (${ya}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bn(n,...e){throw fm(n,...e)}function Nn(n,...e){return fm(n,...e)}function hm(n,e,t){const r=Object.assign(Object.assign({},_C()),{[e]:t});return new iu("auth","Firebase",r).create(e,{appName:n.name})}function ln(n){return hm(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ra(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Bn(n,"argument-error"),hm(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function fm(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return xw.create(n,...e)}function ie(n,e,...t){if(!n)throw fm(e,...t)}function Ar(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Sc(e),new Error(e)}function ns(n,e){n||Ar(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wl(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function pm(){return ey()==="http:"||ey()==="https:"}function ey(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wC(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(pm()||gA()||"connection"in navigator)?navigator.onLine:!0}function IC(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu{constructor(e,t){this.shortDelay=e,this.longDelay=t,ns(t>e,"Short delay should be less than long delay!"),this.isMobile=fA()||vA()}get(){return wC()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mm(n,e){ns(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aw{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ar("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ar("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ar("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EC={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TC=new Eu(3e4,6e4);function Et(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Tt(n,e,t,r,s={}){return Sw(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=va(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return mA()||(c.referrerPolicy="no-referrer"),Aw.fetch()(Pw(n,n.config.apiHost,t,a),c)})}async function Sw(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},EC),e);try{const s=new AC(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw fl(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw fl(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw fl(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw fl(n,"user-disabled",o);const f=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw hm(n,f,c);Bn(n,f)}}catch(s){if(s instanceof os)throw s;Bn(n,"network-request-failed",{message:String(s)})}}async function hs(n,e,t,r,s={}){const i=await Tt(n,e,t,r,s);return"mfaPendingCredential"in i&&Bn(n,"multi-factor-auth-required",{_serverResponse:i}),i}function Pw(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?mm(n.config,s):`${n.config.apiScheme}://${s}`}function xC(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class AC{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Nn(this.auth,"network-request-failed")),TC.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function fl(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Nn(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ty(n){return n!==void 0&&n.getResponse!==void 0}function ny(n){return n!==void 0&&n.enterprise!==void 0}class Rw{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return xC(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SC(n){return(await Tt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function Cw(n,e){return Tt(n,"GET","/v2/recaptchaConfig",Et(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PC(n,e){return Tt(n,"POST","/v1/accounts:delete",e)}async function RC(n,e){return Tt(n,"POST","/v1/accounts:update",e)}async function kw(n,e){return Tt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pl(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MU(n,e=!1){return Te(n).getIdToken(e)}async function CC(n,e=!1){const t=Te(n),r=await t.getIdToken(e),s=Xd(r);ie(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Pl(Uh(s.auth_time)),issuedAtTime:Pl(Uh(s.iat)),expirationTime:Pl(Uh(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Uh(n){return Number(n)*1e3}function Xd(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Sc("JWT malformed, contained fewer than 3 sections"),null;try{const s=K_(t);return s?JSON.parse(s):(Sc("Failed to decode base64 JWT payload"),null)}catch(s){return Sc("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function ry(n){const e=Xd(n);return ie(e,"internal-error"),ie(typeof e.exp<"u","internal-error"),ie(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rs(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof os&&kC(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function kC({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DC{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nf{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Pl(this.lastLoginAt),this.creationTime=Pl(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ql(n){var e;const t=n.auth,r=await n.getIdToken(),s=await rs(n,kw(t,{idToken:r}));ie(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?Dw(i.providerUserInfo):[],a=NC(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),f=l?c:!1,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Nf(i.createdAt,i.lastLoginAt),isAnonymous:f};Object.assign(n,m)}async function VC(n){const e=Te(n);await Ql(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function NC(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Dw(n){return n.map(e=>{var{providerId:t}=e,r=dm(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OC(n,e){const t=await Sw(n,{},async()=>{const r=va({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=Pw(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Aw.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function MC(n,e){return Tt(n,"POST","/v2/accounts:revokeToken",Et(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Go{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ie(e.idToken,"internal-error"),ie(typeof e.idToken<"u","internal-error"),ie(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ry(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ie(e.length!==0,"internal-error");const t=ry(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ie(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await OC(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new Go;return r&&(ie(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(ie(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(ie(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Go,this.toJSON())}_performRefresh(){return Ar("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ss(n,e){ie(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Kr{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=dm(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new DC(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Nf(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await rs(this,this.stsTokenManager.getToken(this.auth,e));return ie(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return CC(this,e)}reload(){return VC(this)}_assign(e){this!==e&&(ie(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Kr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){ie(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Ql(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Gt(this.auth.app))return Promise.reject(ln(this.auth));const e=await this.getIdToken();return await rs(this,PC(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,f;const m=(r=t.displayName)!==null&&r!==void 0?r:void 0,v=(s=t.email)!==null&&s!==void 0?s:void 0,y=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,C=(o=t.photoURL)!==null&&o!==void 0?o:void 0,A=(a=t.tenantId)!==null&&a!==void 0?a:void 0,k=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,U=(c=t.createdAt)!==null&&c!==void 0?c:void 0,j=(f=t.lastLoginAt)!==null&&f!==void 0?f:void 0,{uid:M,emailVerified:q,isAnonymous:ee,providerData:Z,stsTokenManager:I}=t;ie(M&&I,e,"internal-error");const w=Go.fromJSON(this.name,I);ie(typeof M=="string",e,"internal-error"),Ss(m,e.name),Ss(v,e.name),ie(typeof q=="boolean",e,"internal-error"),ie(typeof ee=="boolean",e,"internal-error"),Ss(y,e.name),Ss(C,e.name),Ss(A,e.name),Ss(k,e.name),Ss(U,e.name),Ss(j,e.name);const T=new Kr({uid:M,auth:e,email:v,emailVerified:q,displayName:m,isAnonymous:ee,photoURL:C,phoneNumber:y,tenantId:A,stsTokenManager:w,createdAt:U,lastLoginAt:j});return Z&&Array.isArray(Z)&&(T.providerData=Z.map(P=>Object.assign({},P))),k&&(T._redirectEventId=k),T}static async _fromIdTokenResponse(e,t,r=!1){const s=new Go;s.updateFromServerResponse(t);const i=new Kr({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Ql(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];ie(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?Dw(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new Go;a.updateFromIdToken(r);const l=new Kr({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Nf(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sy=new Map;function Hr(n){ns(n instanceof Function,"Expected a class definition");let e=sy.get(n);return e?(ns(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,sy.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vw{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Vw.type="NONE";const iy=Vw;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pc(n,e,t){return`firebase:${n}:${e}:${t}`}class Ko{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Pc(this.userKey,s.apiKey,i),this.fullPersistenceKey=Pc("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Kr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Ko(Hr(iy),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||Hr(iy);const o=Pc(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const f=await c._get(o);if(f){const m=Kr._fromJSON(e,f);c!==i&&(a=m),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Ko(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new Ko(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oy(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Lw(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Nw(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Uw(e))return"Blackberry";if($w(e))return"Webos";if(Ow(e))return"Safari";if((e.includes("chrome/")||Mw(e))&&!e.includes("edge/"))return"Chrome";if(Fw(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function Nw(n=Zt()){return/firefox\//i.test(n)}function Ow(n=Zt()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Mw(n=Zt()){return/crios\//i.test(n)}function Lw(n=Zt()){return/iemobile/i.test(n)}function Fw(n=Zt()){return/android/i.test(n)}function Uw(n=Zt()){return/blackberry/i.test(n)}function $w(n=Zt()){return/webos/i.test(n)}function gm(n=Zt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function LC(n=Zt()){var e;return gm(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function FC(){return yA()&&document.documentMode===10}function jw(n=Zt()){return gm(n)||Fw(n)||$w(n)||Uw(n)||/windows phone/i.test(n)||Lw(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bw(n,e=[]){let t;switch(n){case"Browser":t=oy(Zt());break;case"Worker":t=`${oy(Zt())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ya}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UC{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $C(n,e={}){return Tt(n,"GET","/v2/passwordPolicy",Et(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jC=6;class BC{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:jC,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qC{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ay(this),this.idTokenSubscription=new ay(this),this.beforeStateQueue=new UC(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=xw,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Hr(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Ko.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await kw(this,{idToken:e}),r=await Kr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Gt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return ie(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ql(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=IC()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Gt(this.app))return Promise.reject(ln(this));const t=e?Te(e):null;return t&&ie(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ie(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Gt(this.app)?Promise.reject(ln(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Gt(this.app)?Promise.reject(ln(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Hr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await $C(this),t=new BC(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new iu("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await MC(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Hr(e)||this._popupRedirectResolver;ie(t,this,"argument-error"),this.redirectPersistenceManager=await Ko.create(this,[Hr(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ie(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ie(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Bw(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&bC(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function $t(n){return Te(n)}class ay{constructor(e){this.auth=e,this.observer=null,this.addObserver=TA(t=>this.observer=t)}get next(){return ie(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function zC(n){Tu=n}function vm(n){return Tu.loadJS(n)}function GC(){return Tu.recaptchaV2Script}function KC(){return Tu.recaptchaEnterpriseScript}function HC(){return Tu.gapiScript}function qw(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const WC="recaptcha-enterprise",QC="NO_RECAPTCHA";class zw{constructor(e){this.type=WC,this.auth=$t(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{Cw(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new Rw(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;ny(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(QC)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&ny(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=KC();l.length!==0&&(l+=a),vm(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function ly(n,e,t,r=!1){const s=new zw(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Jl(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await ly(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await ly(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function JC(n){const e=$t(n),t=await Cw(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new Rw(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new zw(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YC(n,e){const t=ou(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Ws(i,e??{}))return s;Bn(s,"already-initialized")}return t.initialize({options:e})}function XC(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Hr);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function ZC(n,e,t){const r=$t(n);ie(r._canInitEmulator,r,"emulator-config-failed"),ie(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=Gw(e),{host:o,port:a}=ek(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||tk()}function Gw(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function ek(n){const e=Gw(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:uy(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:uy(o)}}}function uy(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function tk(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xu{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ar("not implemented")}_getIdTokenResponse(e){return Ar("not implemented")}_linkToIdToken(e,t){return Ar("not implemented")}_getReauthenticationResolver(e){return Ar("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kw(n,e){return Tt(n,"POST","/v1/accounts:resetPassword",Et(n,e))}async function nk(n,e){return Tt(n,"POST","/v1/accounts:update",e)}async function rk(n,e){return Tt(n,"POST","/v1/accounts:signUp",e)}async function sk(n,e){return Tt(n,"POST","/v1/accounts:update",Et(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ik(n,e){return hs(n,"POST","/v1/accounts:signInWithPassword",Et(n,e))}async function Zd(n,e){return Tt(n,"POST","/v1/accounts:sendOobCode",Et(n,e))}async function ok(n,e){return Zd(n,e)}async function ak(n,e){return Zd(n,e)}async function lk(n,e){return Zd(n,e)}async function uk(n,e){return Zd(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ck(n,e){return hs(n,"POST","/v1/accounts:signInWithEmailLink",Et(n,e))}async function dk(n,e){return hs(n,"POST","/v1/accounts:signInWithEmailLink",Et(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yl extends xu{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Yl(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Yl(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Jl(e,t,"signInWithPassword",ik);case"emailLink":return ck(e,{email:this._email,oobCode:this._password});default:Bn(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Jl(e,r,"signUpPassword",rk);case"emailLink":return dk(e,{idToken:t,email:this._email,oobCode:this._password});default:Bn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jr(n,e){return hs(n,"POST","/v1/accounts:signInWithIdp",Et(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hk="http://localhost";class ss extends xu{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ss(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Bn("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=dm(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new ss(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Jr(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Jr(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Jr(e,t)}buildRequest(){const e={requestUri:hk,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=va(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fk(n,e){return Tt(n,"POST","/v1/accounts:sendVerificationCode",Et(n,e))}async function pk(n,e){return hs(n,"POST","/v1/accounts:signInWithPhoneNumber",Et(n,e))}async function mk(n,e){const t=await hs(n,"POST","/v1/accounts:signInWithPhoneNumber",Et(n,e));if(t.temporaryProof)throw fl(n,"account-exists-with-different-credential",t);return t}const gk={USER_NOT_FOUND:"user-not-found"};async function vk(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return hs(n,"POST","/v1/accounts:signInWithPhoneNumber",Et(n,t),gk)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Li extends xu{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Li({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Li({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return pk(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return mk(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return vk(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Li({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yk(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function _k(n){const e=al(ll(n)).link,t=e?al(ll(e)).deep_link_id:null,r=al(ll(n)).deep_link_id;return(r?al(ll(r)).link:null)||r||t||e||n}class Au{constructor(e){var t,r,s,i,o,a;const l=al(ll(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,f=(r=l.oobCode)!==null&&r!==void 0?r:null,m=yk((s=l.mode)!==null&&s!==void 0?s:null);ie(c&&f&&m,"argument-error"),this.apiKey=c,this.operation=m,this.code=f,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=_k(e);try{return new Au(t)}catch{return null}}}function LU(n){return Au.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo{constructor(){this.providerId=eo.PROVIDER_ID}static credential(e,t){return Yl._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Au.parseLink(t);return ie(r,"argument-error"),Yl._fromEmailAndCode(e,r.code,r.tenantId)}}eo.PROVIDER_ID="password";eo.EMAIL_PASSWORD_SIGN_IN_METHOD="password";eo.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fs{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ca extends fs{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Rc extends Ca{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return ie("providerId"in t&&"signInMethod"in t,"argument-error"),ss._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return ie(e.idToken||e.accessToken,"argument-error"),ss._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Rc.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Rc.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new Rc(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Os extends Ca{constructor(){super("facebook.com")}static credential(e){return ss._fromParams({providerId:Os.PROVIDER_ID,signInMethod:Os.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Os.credentialFromTaggedObject(e)}static credentialFromError(e){return Os.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Os.credential(e.oauthAccessToken)}catch{return null}}}Os.FACEBOOK_SIGN_IN_METHOD="facebook.com";Os.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ms extends Ca{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ss._fromParams({providerId:Ms.PROVIDER_ID,signInMethod:Ms.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ms.credentialFromTaggedObject(e)}static credentialFromError(e){return Ms.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Ms.credential(t,r)}catch{return null}}}Ms.GOOGLE_SIGN_IN_METHOD="google.com";Ms.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ls extends Ca{constructor(){super("github.com")}static credential(e){return ss._fromParams({providerId:Ls.PROVIDER_ID,signInMethod:Ls.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ls.credentialFromTaggedObject(e)}static credentialFromError(e){return Ls.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ls.credential(e.oauthAccessToken)}catch{return null}}}Ls.GITHUB_SIGN_IN_METHOD="github.com";Ls.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bk="http://localhost";class Xl extends xu{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Jr(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Jr(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Jr(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Xl(r,i)}static _create(e,t){return new Xl(e,t)}buildRequest(){return{requestUri:bk,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wk="saml.";class Of extends fs{constructor(e){ie(e.startsWith(wk),"argument-error"),super(e)}static credentialFromResult(e){return Of.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Of.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Xl.fromJSON(e);return ie(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Xl._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fs extends Ca{constructor(){super("twitter.com")}static credential(e,t){return ss._fromParams({providerId:Fs.PROVIDER_ID,signInMethod:Fs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Fs.credentialFromTaggedObject(e)}static credentialFromError(e){return Fs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Fs.credential(t,r)}catch{return null}}}Fs.TWITTER_SIGN_IN_METHOD="twitter.com";Fs.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hw(n,e){return hs(n,"POST","/v1/accounts:signUp",Et(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ir{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Kr._fromIdTokenResponse(e,r,s),o=cy(r);return new ir({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=cy(r);return new ir({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function cy(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ik(n){var e;if(Gt(n.app))return Promise.reject(ln(n));const t=$t(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new ir({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await Hw(t,{returnSecureToken:!0}),s=await ir._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class id extends os{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,id.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new id(e,t,r,s)}}function Ww(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?id._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qw(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FU(n,e){const t=Te(n);await eh(!0,t,e);const{providerUserInfo:r}=await RC(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=Qw(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function ym(n,e,t=!1){const r=await rs(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ir._forOperation(n,"link",r)}async function eh(n,e,t){await Ql(e);const r=Qw(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";ie(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jw(n,e,t=!1){const{auth:r}=n;if(Gt(r.app))return Promise.reject(ln(r));const s="reauthenticate";try{const i=await rs(n,Ww(r,s,e,n),t);ie(i.idToken,r,"internal-error");const o=Xd(i.idToken);ie(o,r,"internal-error");const{sub:a}=o;return ie(n.uid===a,r,"user-mismatch"),ir._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Bn(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yw(n,e,t=!1){if(Gt(n.app))return Promise.reject(ln(n));const r="signIn",s=await Ww(n,r,e),i=await ir._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function _m(n,e){return Yw($t(n),e)}async function Ek(n,e){const t=Te(n);return await eh(!1,t,e.providerId),ym(t,e)}async function Tk(n,e){return Jw(Te(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xk(n,e){return hs(n,"POST","/v1/accounts:signInWithCustomToken",Et(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UU(n,e){if(Gt(n.app))return Promise.reject(ln(n));const t=$t(n),r=await xk(t,{token:e,returnSecureToken:!0}),s=await ir._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Su{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?bm._fromServerResponse(e,t):"totpInfo"in t?wm._fromServerResponse(e,t):Bn(e,"internal-error")}}class bm extends Su{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new bm(t)}}class wm extends Su{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new wm(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function th(n,e,t){var r;ie(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),ie(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(ie(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(ie(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Im(n){const e=$t(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Ak(n,e,t){const r=$t(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&th(r,s,t),await Jl(r,s,"getOobCode",ak)}async function Sk(n,e,t){await Kw(Te(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Im(n),r})}async function $U(n,e){await sk(Te(n),{oobCode:e})}async function Pk(n,e){const t=Te(n),r=await Kw(t,{oobCode:e}),s=r.requestType;switch(ie(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":ie(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":ie(r.mfaInfo,t,"internal-error");default:ie(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Su._fromServerResponse($t(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function jU(n,e){const{data:t}=await Pk(Te(n),e);return t.email}async function Rk(n,e,t){if(Gt(n.app))return Promise.reject(ln(n));const r=$t(n),o=await Jl(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Hw).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Im(n),l}),a=await ir._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function Ck(n,e,t){return Gt(n.app)?Promise.reject(ln(n)):_m(Te(n),eo.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Im(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BU(n,e,t){const r=$t(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){ie(a.handleCodeInApp,r,"argument-error"),a&&th(r,o,a)}i(s,t),await Jl(r,s,"getOobCode",lk)}function qU(n,e){const t=Au.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function zU(n,e,t){if(Gt(n.app))return Promise.reject(ln(n));const r=Te(n),s=eo.credentialWithLink(e,t||Wl());return ie(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),_m(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kk(n,e){return Tt(n,"POST","/v1/accounts:createAuthUri",Et(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GU(n,e){const t=pm()?Wl():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await kk(Te(n),r);return s||[]}async function KU(n,e){const t=Te(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&th(t.auth,s,e);const{email:i}=await ok(t.auth,s);i!==n.email&&await n.reload()}async function HU(n,e,t){const r=Te(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&th(r.auth,i,t);const{email:o}=await uk(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dk(n,e){return Tt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WU(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Te(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await rs(r,Dk(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function QU(n,e){const t=Te(n);return Gt(t.auth.app)?Promise.reject(ln(t.auth)):Xw(t,e,null)}function Vk(n,e){return Xw(Te(n),null,e)}async function Xw(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await rs(n,nk(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nk(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=Xd(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new Ho(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new Ok(i,s);case"github.com":return new Mk(i,s);case"google.com":return new Lk(i,s);case"twitter.com":return new Fk(i,s,n.screenName||null);case"custom":case"anonymous":return new Ho(i,null);default:return new Ho(i,r,s)}}class Ho{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class Zw extends Ho{constructor(e,t,r,s){super(e,t,r),this.username=s}}class Ok extends Ho{constructor(e,t){super(e,"facebook.com",t)}}class Mk extends Zw{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class Lk extends Ho{constructor(e,t){super(e,"google.com",t)}}class Fk extends Zw{constructor(e,t,r){super(e,"twitter.com",t,r)}}function JU(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:Nk(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YU(n,e){return Te(n).setPersistence(e)}function XU(n){return JC(n)}async function ZU(n,e){return $t(n).validatePassword(e)}function Uk(n,e,t,r){return Te(n).onIdTokenChanged(e,t,r)}function $k(n,e,t){return Te(n).beforeAuthStateChanged(e,t)}function e3(n,e,t,r){return Te(n).onAuthStateChanged(e,t,r)}function t3(n){Te(n).useDeviceLanguage()}function n3(n,e){return Te(n).updateCurrentUser(e)}function r3(n){return Te(n).signOut()}function s3(n,e){return $t(n).revokeAccessToken(e)}async function i3(n){return Te(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new Vi("enroll",e,t)}static _fromMfaPendingCredential(e){return new Vi("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return Vi._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return Vi._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Em{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=$t(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Su._fromServerResponse(r,a));ie(s.mfaPendingCredential,r,"internal-error");const o=Vi._fromMfaPendingCredential(s.mfaPendingCredential);return new Em(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const f=await ir._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(f.user),f;case"reauthenticate":return ie(t.user,r,"internal-error"),ir._forOperation(t.user,t.operationType,c);default:Bn(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function o3(n,e){var t;const r=Te(n),s=e;return ie(e.customData.operationType,r,"argument-error"),ie((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Em._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jk(n,e){return Tt(n,"POST","/v2/accounts/mfaEnrollment:start",Et(n,e))}function Bk(n,e){return Tt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Et(n,e))}function qk(n,e){return Tt(n,"POST","/v2/accounts/mfaEnrollment:start",Et(n,e))}function zk(n,e){return Tt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Et(n,e))}function Gk(n,e){return Tt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Et(n,e))}class Tm{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Su._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Tm(e)}async getSession(){return Vi._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await rs(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await rs(this.user,Gk(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const $h=new WeakMap;function a3(n){const e=Te(n);return $h.has(e)||$h.set(e,Tm._fromUser(e)),$h.get(e)}const od="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(od,"1"),this.storage.removeItem(od),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kk=1e3,Hk=10;class tI extends eI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=jw(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);FC()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Hk):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},Kk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}tI.type="LOCAL";const Wk=tI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nI extends eI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}nI.type="SESSION";const rI=nI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qk(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new nh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await Qk(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}nh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rh(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jk{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=rh("",20);s.port1.start();const f=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(m){const v=m;if(v.data.eventId===c)switch(v.data.status){case"ack":clearTimeout(f),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(v.data.response);break;default:clearTimeout(f),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qt(){return window}function Yk(n){Qt().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xm(){return typeof Qt().WorkerGlobalScope<"u"&&typeof Qt().importScripts=="function"}async function Xk(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Zk(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function eD(){return xm()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sI="firebaseLocalStorageDb",tD=1,ad="firebaseLocalStorage",iI="fbase_key";class Pu{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function sh(n,e){return n.transaction([ad],e?"readwrite":"readonly").objectStore(ad)}function nD(){const n=indexedDB.deleteDatabase(sI);return new Pu(n).toPromise()}function Mf(){const n=indexedDB.open(sI,tD);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(ad,{keyPath:iI})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(ad)?e(r):(r.close(),await nD(),e(await Mf()))})})}async function dy(n,e,t){const r=sh(n,!0).put({[iI]:e,value:t});return new Pu(r).toPromise()}async function rD(n,e){const t=sh(n,!1).get(e),r=await new Pu(t).toPromise();return r===void 0?null:r.value}function hy(n,e){const t=sh(n,!0).delete(e);return new Pu(t).toPromise()}const sD=800,iD=3;class oI{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Mf(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>iD)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return xm()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=nh._getInstance(eD()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await Xk(),!this.activeServiceWorker)return;this.sender=new Jk(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Zk()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Mf();return await dy(e,od,"1"),await hy(e,od),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>dy(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>rD(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>hy(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=sh(s,!1).getAll();return new Pu(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),sD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}oI.type="LOCAL";const oD=oI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aD(n,e){return Tt(n,"POST","/v2/accounts/mfaSignIn:start",Et(n,e))}function lD(n,e){return Tt(n,"POST","/v2/accounts/mfaSignIn:finalize",Et(n,e))}function uD(n,e){return Tt(n,"POST","/v2/accounts/mfaSignIn:finalize",Et(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cD=500,dD=6e4,dc=1e12;class hD{constructor(e){this.auth=e,this.counter=dc,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new fD(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||dc;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||dc;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||dc;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class fD{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;ie(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=pD(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},dD)},cD))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function pD(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jh=qw("rcb"),mD=new Eu(3e4,6e4);class gD{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Qt().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return ie(vD(t),e,"argument-error"),this.shouldResolveImmediately(t)&&ty(Qt().grecaptcha)?Promise.resolve(Qt().grecaptcha):new Promise((r,s)=>{const i=Qt().setTimeout(()=>{s(Nn(e,"network-request-failed"))},mD.get());Qt()[jh]=()=>{Qt().clearTimeout(i),delete Qt()[jh];const a=Qt().grecaptcha;if(!a||!ty(a)){s(Nn(e,"internal-error"));return}const l=a.render;a.render=(c,f)=>{const m=l(c,f);return this.counter++,m},this.hostLanguage=t,r(a)};const o=`${GC()}?${va({onload:jh,render:"explicit",hl:t})}`;vm(o).catch(()=>{clearTimeout(i),s(Nn(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Qt().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function vD(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class yD{async load(e){return new hD(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aI="recaptcha",_D={theme:"light",type:"image"};class l3{constructor(e,t,r=Object.assign({},_D)){this.parameters=r,this.type=aI,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=$t(e),this.isInvisible=this.parameters.size==="invisible",ie(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;ie(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new yD:new gD,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){ie(!this.parameters.sitekey,this.auth,"argument-error"),ie(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),ie(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Qt()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){ie(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){ie(pm()&&!xm(),this.auth,"internal-error"),await bD(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await SC(this.auth);ie(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return ie(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function bD(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Am{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Li._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function u3(n,e,t){if(Gt(n.app))return Promise.reject(ln(n));const r=$t(n),s=await ih(r,e,Te(t));return new Am(s,i=>_m(r,i))}async function c3(n,e,t){const r=Te(n);await eh(!1,r,"phone");const s=await ih(r.auth,e,Te(t));return new Am(s,i=>Ek(r,i))}async function d3(n,e,t){const r=Te(n);if(Gt(r.auth.app))return Promise.reject(ln(r.auth));const s=await ih(r.auth,e,Te(t));return new Am(s,i=>Tk(r,i))}async function ih(n,e,t){var r;const s=await t.verify();try{ie(typeof s=="string",n,"argument-error"),ie(t.type===aI,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return ie(o.type==="enroll",n,"internal-error"),(await jk(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{ie(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return ie(a,n,"missing-multi-factor-info"),(await aD(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await fk(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function h3(n,e){const t=Te(n);if(Gt(t.auth.app))return Promise.reject(ln(t.auth));await ym(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo{constructor(e){this.providerId=Wo.PROVIDER_ID,this.auth=$t(e)}verifyPhoneNumber(e,t){return ih(this.auth,e,Te(t))}static credential(e,t){return Li._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Wo.credentialFromTaggedObject(t)}static credentialFromError(e){return Wo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Li._fromTokenResponse(t,r):null}}Wo.PROVIDER_ID="phone";Wo.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function to(n,e){return e?Hr(e):(ie(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm extends xu{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Jr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Jr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Jr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function wD(n){return Yw(n.auth,new Sm(n),n.bypassAuthState)}function ID(n){const{auth:e,user:t}=n;return ie(t,e,"internal-error"),Jw(t,new Sm(n),n.bypassAuthState)}async function ED(n){const{auth:e,user:t}=n;return ie(t,e,"internal-error"),ym(t,new Sm(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lI{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return wD;case"linkViaPopup":case"linkViaRedirect":return ED;case"reauthViaPopup":case"reauthViaRedirect":return ID;default:Bn(this.auth,"internal-error")}}resolve(e){ns(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ns(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TD=new Eu(2e3,1e4);async function f3(n,e,t){if(Gt(n.app))return Promise.reject(Nn(n,"operation-not-supported-in-this-environment"));const r=$t(n);Ra(n,e,fs);const s=to(r,t);return new Wr(r,"signInViaPopup",e,s).executeNotNull()}async function p3(n,e,t){const r=Te(n);if(Gt(r.auth.app))return Promise.reject(Nn(r.auth,"operation-not-supported-in-this-environment"));Ra(r.auth,e,fs);const s=to(r.auth,t);return new Wr(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function m3(n,e,t){const r=Te(n);Ra(r.auth,e,fs);const s=to(r.auth,t);return new Wr(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Wr extends lI{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Wr.currentPopupAction&&Wr.currentPopupAction.cancel(),Wr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ie(e,this.auth,"internal-error"),e}async onExecution(){ns(this.filter.length===1,"Popup operations only handle one event");const e=rh();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Nn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Nn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Wr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Nn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,TD.get())};e()}}Wr.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xD="pendingRedirect",Cc=new Map;class AD extends lI{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Cc.get(this.auth._key());if(!e){try{const r=await SD(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Cc.set(this.auth._key(),e)}return this.bypassAuthState||Cc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function SD(n,e){const t=cI(e),r=uI(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function Pm(n,e){return uI(n)._set(cI(e),"true")}function PD(n,e){Cc.set(n._key(),e)}function uI(n){return Hr(n._redirectPersistence)}function cI(n){return Pc(xD,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g3(n,e,t){return RD(n,e,t)}async function RD(n,e,t){if(Gt(n.app))return Promise.reject(ln(n));const r=$t(n);Ra(n,e,fs),await r._initializationPromise;const s=to(r,t);return await Pm(s,r),s._openRedirect(r,e,"signInViaRedirect")}function v3(n,e,t){return CD(n,e,t)}async function CD(n,e,t){const r=Te(n);if(Ra(r.auth,e,fs),Gt(r.auth.app))return Promise.reject(ln(r.auth));await r.auth._initializationPromise;const s=to(r.auth,t);await Pm(s,r.auth);const i=await hI(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function y3(n,e,t){return kD(n,e,t)}async function kD(n,e,t){const r=Te(n);Ra(r.auth,e,fs),await r.auth._initializationPromise;const s=to(r.auth,t);await eh(!1,r,e.providerId),await Pm(s,r.auth);const i=await hI(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function _3(n,e){return await $t(n)._initializationPromise,dI(n,e,!1)}async function dI(n,e,t=!1){if(Gt(n.app))return Promise.reject(ln(n));const r=$t(n),s=to(r,e),o=await new AD(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function hI(n){const e=rh(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DD=10*60*1e3;class VD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!ND(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!fI(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Nn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=DD&&this.cachedEventUids.clear(),this.cachedEventUids.has(fy(e))}saveEventToCache(e){this.cachedEventUids.add(fy(e)),this.lastProcessedEventTime=Date.now()}}function fy(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function fI({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function ND(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return fI(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OD(n,e={}){return Tt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MD=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,LD=/^https?/;async function FD(n){if(n.config.emulator)return;const{authorizedDomains:e}=await OD(n);for(const t of e)try{if(UD(t))return}catch{}Bn(n,"unauthorized-domain")}function UD(n){const e=Wl(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!LD.test(t))return!1;if(MD.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $D=new Eu(3e4,6e4);function py(){const n=Qt().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function jD(n){return new Promise((e,t)=>{var r,s,i;function o(){py(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{py(),t(Nn(n,"network-request-failed"))},timeout:$D.get()})}if(!((s=(r=Qt().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Qt().gapi)===null||i===void 0)&&i.load)o();else{const a=qw("iframefcb");return Qt()[a]=()=>{gapi.load?o():t(Nn(n,"network-request-failed"))},vm(`${HC()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw kc=null,e})}let kc=null;function BD(n){return kc=kc||jD(n),kc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qD=new Eu(5e3,15e3),zD="__/auth/iframe",GD="emulator/auth/iframe",KD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},HD=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function WD(n){const e=n.config;ie(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?mm(e,GD):`https://${n.config.authDomain}/${zD}`,r={apiKey:e.apiKey,appName:n.name,v:ya},s=HD.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${va(r).slice(1)}`}async function QD(n){const e=await BD(n),t=Qt().gapi;return ie(t,n,"internal-error"),e.open({where:document.body,url:WD(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:KD,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Nn(n,"network-request-failed"),a=Qt().setTimeout(()=>{i(o)},qD.get());function l(){Qt().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JD={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},YD=500,XD=600,ZD="_blank",eV="http://localhost";class my{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function tV(n,e,t,r=YD,s=XD){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},JD),{width:r.toString(),height:s.toString(),top:i,left:o}),c=Zt().toLowerCase();t&&(a=Mw(c)?ZD:t),Nw(c)&&(e=e||eV,l.scrollbars="yes");const f=Object.entries(l).reduce((v,[y,C])=>`${v}${y}=${C},`,"");if(LC(c)&&a!=="_self")return nV(e||"",a),new my(null);const m=window.open(e||"",a,f);ie(m,n,"popup-blocked");try{m.focus()}catch{}return new my(m)}function nV(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rV="__/auth/handler",sV="emulator/auth/handler",iV=encodeURIComponent("fac");async function gy(n,e,t,r,s,i){ie(n.config.authDomain,n,"auth-domain-config-required"),ie(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:ya,eventId:s};if(e instanceof fs){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",EA(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,m]of Object.entries(i||{}))o[f]=m}if(e instanceof Ca){const f=e.getScopes().filter(m=>m!=="");f.length>0&&(o.scopes=f.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const f of Object.keys(a))a[f]===void 0&&delete a[f];const l=await n._getAppCheckToken(),c=l?`#${iV}=${encodeURIComponent(l)}`:"";return`${oV(n)}?${va(a).slice(1)}${c}`}function oV({config:n}){return n.emulator?mm(n,sV):`https://${n.authDomain}/${rV}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bh="webStorageSupport";class aV{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rI,this._completeRedirectFn=dI,this._overrideRedirectResult=PD}async _openPopup(e,t,r,s){var i;ns((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await gy(e,t,r,Wl(),s);return tV(e,o,rh())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await gy(e,t,r,Wl(),s);return Yk(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(ns(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await QD(e),r=new VD(e);return t.register("authEvent",s=>(ie(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Bh,{type:Bh},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Bh];o!==void 0&&t(!!o),Bn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=FD(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return jw()||Ow()||gm()}}const lV=aV;class pI{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Ar("unexpected MultiFactorSessionType")}}}class Rm extends pI{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Rm(e)}_finalizeEnroll(e,t,r){return Bk(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return lD(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class uV{constructor(){}static assertion(e){return Rm._fromCredential(e)}}uV.FACTOR_ID="phone";class cV{static assertionForEnrollment(e,t){return Zl._fromSecret(e,t)}static assertionForSignIn(e,t){return Zl._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;ie(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await qk(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return Cm._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}cV.FACTOR_ID="totp";class Zl extends pI{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Zl(t,void 0,e)}static _fromEnrollmentId(e,t){return new Zl(t,e)}async _finalizeEnroll(e,t,r){return ie(typeof this.secret<"u",e,"argument-error"),zk(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){ie(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return uD(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class Cm{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new Cm(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(hc(e)||hc(t))&&(s=!0),s&&(hc(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),hc(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function hc(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var vy="@firebase/auth",yy="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dV{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ie(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hV(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function fV(n){Zo(new Ui("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;ie(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Bw(n)},c=new qC(r,s,i,l);return XC(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Zo(new Ui("auth-internal",e=>{const t=$t(e.getProvider("auth").getImmediate());return(r=>new dV(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),qs(vy,yy,hV(n)),qs(vy,yy,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pV=5*60,mV=Q_("authIdTokenMaxAge")||pV;let _y=null;const gV=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>mV)return;const s=t==null?void 0:t.token;_y!==s&&(_y=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function vV(n=t0()){const e=ou(n,"auth");if(e.isInitialized())return e.getImmediate();const t=YC(n,{popupRedirectResolver:lV,persistence:[oD,Wk,rI]}),r=Q_("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=gV(i.toString());$k(t,o,()=>o(t.currentUser)),Uk(t,a=>o(a))}}const s=H_("auth");return s&&ZC(t,`http://${s}`),t}function yV(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}zC({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Nn("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",yV().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});fV("Browser");const _V={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},mI=e0(_V),me=H1(mI),no=vV(mI);try{W1(me)}catch{}Ik(no);async function bV(n,e){try{return(await Rk(no,n,e)).user}catch(t){throw t}}async function wV(n,e){try{return(await Ck(no,n,e)).user}catch(t){throw t}}async function IV(n){try{await Ak(no,n)}catch(e){throw e}}async function EV(n){try{const e=no.currentUser;if(e)await Vk(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const zs=Object.freeze(Object.defineProperty({__proto__:null,auth:no,createPlayerAccount:bV,db:me,resetPlayerPassword:IV,signInPlayer:wV,updatePlayerPassword:EV},Symbol.toStringTag,{value:"Module"})),ka="seasons";async function TV(n,e,t){return await Yd(Ye(me,ka),{name:n,slug:e,pinCode:t,createdAt:Iu()})}async function xV(n){return await rd(Ve(me,ka,n))}async function qh(){const n=Kd(Ye(me,ka),tC("createdAt","desc"));return(await kt(n)).docs.map(t=>({id:t.id,...t.data()}))}async function ld(n,e){const t=await ds(Ve(me,ka,n));return t.exists()?t.data().pinCode===e:!1}async function Lf(n){const e=await ds(Ve(me,ka,n));return e.exists()?e.data().pinCode:null}async function il(n,e){const t=Ve(me,ka,n);await bu(t,{sortOrder:e})}const zh=10*60*1e3,Gh="impro_selector_pin_session";class AV{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(Gh);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<zh)return t;this.clearSession()}}catch(e){console.error("Erreur lors du chargement de la session PIN:",e)}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(Gh,JSON.stringify(r)),this.sessionData=r}catch(r){console.error("Erreur lors de la sauvegarde de la session PIN:",r)}}isPinCached(e){return this.sessionData?this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<zh:!1}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(Gh),this.sessionData=null}catch(e){console.error("Erreur lors de la suppression de la session PIN:",e)}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=zh-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const Fn=new AV,SV={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},PV={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},RV={class:"text-center mb-6"},CV={class:"text-gray-300"},kV={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},DV={class:"text-sm text-green-400"},VV={class:"mb-6"},NV={class:"mb-4"},OV={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},MV={class:"flex justify-end space-x-3"},LV=["disabled"],gI={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=N(""),i=N(""),o=N(null);Jt(()=>t.show,f=>{f&&(s.value="",i.value="",rn(()=>{var m;(m=o.value)==null||m.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(f,m)=>n.show?(L(),$("div",SV,[g("div",PV,[g("div",RV,[m[1]||(m[1]=g("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[g("span",{class:"text-2xl"},"🔒")],-1)),m[2]||(m[2]=g("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),g("p",CV,ae(n.message),1),n.sessionInfo?(L(),$("div",kV,[g("p",DV," Session active : "+ae(n.sessionInfo.timeRemaining)+" min restantes ",1)])):se("",!0)]),g("div",VV,[g("div",NV,[m[3]||(m[3]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),ut(g("input",{"onUpdate:modelValue":m[0]||(m[0]=v=>s.value=v),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[wn(l,["enter"]),wn(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[St,s.value]])]),m[4]||(m[4]=g("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(L(),$("div",OV,ae(i.value||t.error),1)):se("",!0),g("div",MV,[g("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),g("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,LV)])])])):se("",!0)}},FV={class:"relative p-6 pb-4 border-b border-white/10"},UV={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},vI={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(L(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[g("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=Bt(()=>{},["stop"]))},[g("div",FV,[g("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=g("div",{class:"flex items-center gap-3"},[g("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"🎭"),g("div",null,[g("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Bienvenue dans Impro Pick"),g("p",{class:"text-sm text-purple-300"},"L'appli impro pour organiser saisons, événements et sélections")])],-1))]),s[5]||(s[5]=cr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">À quoi ça sert ?</h3><p> Impro Pick vous aide à gérer vos spectacles d&#39;impro : saisons, événements, joueurs, disponibilités, tirage au sort équitable et annonces. Fini les prises de tête : indiquez qui est dispo, et laissez le hasard pondéré faire le reste. </p></div><div class="space-y-3"><h3 class="text-white font-semibold">Fonctionnalités principales</h3><ul class="list-disc list-inside space-y-2 text-gray-300"><li><span class="text-white">Saisons</span> : regroupez vos événements par saison pour garder un historique clair.</li><li><span class="text-white">Événements</span> : créez des dates avec un titre et un nombre de joueurs à sélectionner; archivez-les quand ils sont passés.</li><li><span class="text-white">Joueurs</span> : gérez la liste des joueurs et leurs informations.</li><li><span class="text-white">Indication de disponibilité</span> : Oui/Non/Peut‑être via liens magiques ou directement dans la grille.</li><li><span class="text-white">Sélection automatique</span> : tirage au sort pondéré qui favorise l&#39;équité sur la durée.</li><li><span class="text-white">Protection des saisies</span> : PIN de saison pour sécuriser les actions sensibles, mot de passe possible pour certains joueurs.</li><li><span class="text-white">Notifications</span> : annoncez un événement (email/lien) pour collecter facilement les disponibilités.</li></ul></div><div class="space-y-2 text-sm text-gray-300"><h3 class="text-white font-semibold">Astuces</h3><ul class="list-disc list-inside space-y-1"><li>Sur mobile, faites glisser horizontalement pour parcourir les événements.</li><li>Le bouton ⚠️ dans les en-têtes signale qu&#39;un événement est prêt pour une sélection ou nécessite votre attention.</li></ul></div></div>',1)),g("div",UV,[g("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):se("",!0)}},$V={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},jV={class:"text-center py-16 px-4 relative"},BV=["aria-busy"],qV={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto animate-pulse"},zV={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto"},GV=["onClick"],KV={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},HV={class:"absolute top-4 right-4"},WV=["onClick","aria-expanded"],QV={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},JV=["onClick"],YV=["onClick"],XV=["onClick"],ZV={key:2,class:"flex justify-center mt-12"},eN={key:3,class:"text-center py-16"},tN={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},nN={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},rN={class:"mb-6"},sN={class:"mb-6"},iN={class:"mb-6"},oN={class:"flex justify-end space-x-3"},aN=["disabled"],lN={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},uN={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},cN={class:"text-center mb-6"},dN={class:"text-gray-300"},hN={__name:"Home",setup(n){const e=N([]),t=N(!0),r=ru(),s=N(null),i=N(!1),o=N(!1),a=N(""),l=N(""),c=N(""),f=N(null),m=N(!1),v=N(null),y=N(""),C=N(!1);Ks(async()=>{try{e.value=await qh(),console.log("Saisons chargées:",e.value),M().catch(Ae=>console.error("Migration sortOrder échouée",Ae))}finally{t.value=!1}});const A=We(()=>[...e.value].sort((Ae,Y)=>{var tn,Mt;const Se=typeof Ae.sortOrder=="number"?Ae.sortOrder:Number.MAX_SAFE_INTEGER,_e=typeof Y.sortOrder=="number"?Y.sortOrder:Number.MAX_SAFE_INTEGER;if(Se!==_e)return Se-_e;const ke=(tn=Ae.createdAt)!=null&&tn.toMillis?Ae.createdAt.toMillis():0,rt=(Mt=Y.createdAt)!=null&&Mt.toMillis?Y.createdAt.toMillis():0;return ke!==rt?rt-ke:(Ae.name||"").localeCompare(Y.name||"")}));function k(Ae){r.push(`/season/${Ae}`)}function U(Ae){s.value=s.value===Ae?null:Ae}function j(){s.value=null}async function M(){if(!e.value.length)return;const Ae=e.value.map(Se=>typeof Se.sortOrder=="number"?Se.sortOrder:null).filter(Se=>Se!==null);let Y=Ae.length?Math.max(...Ae):0;for(const Se of e.value)if(typeof Se.sortOrder!="number"){Y+=1;try{await il(Se.id,Y),Se.sortOrder=Y}catch(_e){console.error("Erreur migration sortOrder pour",Se.name,_e)}}}async function q(Ae){if(j(),Ae<=0)return;const Y=[...A.value],Se=Y[Ae],_e=Y[Ae-1],ke=Se.sortOrder;Se.sortOrder=_e.sortOrder,_e.sortOrder=ke;try{await Promise.all([il(Se.id,Se.sortOrder),il(_e.id,_e.sortOrder)])}catch(rt){console.error("Erreur lors du déplacement vers le haut",rt)}}async function ee(Ae){j();const Y=[...A.value];if(Ae>=Y.length-1)return;const Se=Y[Ae],_e=Y[Ae+1],ke=Se.sortOrder;Se.sortOrder=_e.sortOrder,_e.sortOrder=ke;try{await Promise.all([il(Se.id,Se.sortOrder),il(_e.id,_e.sortOrder)])}catch(rt){console.error("Erreur lors du déplacement vers le bas",rt)}}function Z(){a.value&&(l.value=a.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function I(){c.value=c.value.replace(/[^0-9]/g,""),c.value.length>4&&(c.value=c.value.slice(0,4))}async function w(){if(!a.value.trim()||!l.value.trim()||!c.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(c.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await TV(a.value.trim(),l.value.trim(),c.value.trim()),e.value=await qh(),await M(),T()}catch(Ae){console.error("Erreur lors de la création de la saison:",Ae),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function T(){i.value=!1,a.value="",l.value="",c.value=""}function P(Ae){f.value=Ae,o.value=!0}async function R(){o.value=!1,await Ue({type:"deleteSeason",data:{seasonId:f.value.id,seasonName:f.value.name}})}function D(){o.value=!1,f.value=null}function b(){return v.value?{deleteSeason:"Suppression de saison - Code PIN requis"}[v.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function Ue(Ae){if(Fn.isPinCached(f.value.id)){const Y=Fn.getCachedPin(f.value.id);if(console.log("PIN en cache trouvé, utilisation automatique"),await ld(f.value.id,Y)){await Oe(Ae);return}else Fn.clearSession()}v.value=Ae,m.value=!0}async function Ce(Ae){var Y,Se,_e;console.log("PIN soumis:",Ae,"pour l'opération:",v.value);try{const ke=((Se=(Y=v.value)==null?void 0:Y.data)==null?void 0:Se.seasonId)||((_e=f.value)==null?void 0:_e.id),rt=await ld(ke,Ae);if(console.log("PIN valide:",rt),rt){Fn.saveSession(ke,Ae),console.log("PIN correct, fermeture de la modal et exécution de l'opération"),m.value=!1;const tn=v.value;v.value=null,console.log("Appel de executePendingOperation avec:",tn),await Oe(tn)}else y.value="Code PIN incorrect",setTimeout(()=>{y.value=""},3e3)}catch(ke){console.error("Erreur lors de la vérification du PIN:",ke),y.value="Erreur lors de la vérification du code PIN"}}function Xe(){m.value=!1,v.value=null,y.value=""}function Fe(){return f.value&&Fn.isPinCached(f.value.id)?{timeRemaining:Fn.getTimeRemaining(),isExpiringSoon:Fn.isExpiringSoon()}:null}async function Oe(Ae){if(console.log("executePendingOperation appelé avec:",Ae),!Ae){console.log("Aucune opération à exécuter");return}const{type:Y,data:Se}=Ae;console.log("Exécution de l'opération:",Y,"avec données:",Se);try{switch(Y){case"deleteSeason":console.log("Suppression de la saison ID:",Se.seasonId),await xV(Se.seasonId),console.log("Saison supprimée, rechargement de la liste..."),e.value=await qh(),console.log("Nouvelle liste des saisons:",e.value);break;default:console.log("Type d'opération non reconnu:",Y)}}catch(_e){console.error("Erreur lors de l'exécution de l'opération:",_e),alert("Erreur lors de l'opération. Veuillez réessayer.")}}return(Ae,Y)=>{var Se;return L(),$("div",$V,[g("div",jV,[g("button",{onClick:Y[0]||(Y[0]=_e=>C.value=!0),class:"absolute right-4 top-4 text-white/90 hover:text-white p-2 rounded-full hover:bg-white/10",title:"Comment ça marche ?","aria-label":"Comment ça marche ?"},Y[8]||(Y[8]=[g("span",{class:"text-2xl"},"❓",-1)])),Y[9]||(Y[9]=g("h1",{class:"text-6xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent animate-pulse"}," Impro Pick ",-1)),Y[10]||(Y[10]=g("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto leading-relaxed"},"Arrêtez de vous prendre la tête pour savoir qui doit jouer, laissez le hasard choisir pour vous !",-1))]),g("div",{class:"container mx-auto px-4 pb-16","aria-busy":t.value},[t.value?(L(),$("div",qV,[(L(),$(_t,null,dr(8,_e=>g("div",{key:"skeleton-"+_e,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8"},Y[11]||(Y[11]=[g("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),g("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),g("div",{class:"h-px bg-white/10 mb-4"},null,-1),g("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(L(),$("div",zV,[(L(!0),$(_t,null,dr(A.value,(_e,ke)=>(L(),$("div",{key:_e.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20"},[g("div",{onClick:rt=>k(_e.slug),class:"text-center cursor-pointer"},[Y[12]||(Y[12]=g("div",{class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg"},[g("span",{class:"text-2xl"},"🎭")],-1)),g("h2",KV,ae(_e.name),1),Y[13]||(Y[13]=g("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),Y[14]||(Y[14]=g("p",{class:"text-gray-300 text-sm"}," Cliquez pour accéder ",-1))],8,GV),g("div",HV,[g("div",{class:"relative",onClick:Y[1]||(Y[1]=Bt(()=>{},["stop"]))},[g("button",{onClick:rt=>U(ke),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===ke,"aria-haspopup":"true",title:"Options"},Y[15]||(Y[15]=[g("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[g("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,WV),s.value===ke?(L(),$("div",QV,[g("button",{onClick:rt=>q(ke),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Monter ",8,JV),g("button",{onClick:rt=>ee(ke),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Descendre ",8,YV),Y[16]||(Y[16]=g("div",{class:"border-t border-white/10 my-1"},null,-1)),g("button",{onClick:rt=>P(_e),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10",role:"menuitem"}," Supprimer ",8,XV)])):se("",!0)])])]))),128))])):se("",!0),!t.value&&e.value.length>0?(L(),$("div",ZV,[g("button",{onClick:Y[2]||(Y[2]=_e=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105"}," ✨ Nouvelle saison ")])):se("",!0),!t.value&&e.value.length===0?(L(),$("div",eN,[Y[17]||(Y[17]=g("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[g("span",{class:"text-4xl"},"🎪")],-1)),Y[18]||(Y[18]=g("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),Y[19]||(Y[19]=g("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),g("button",{onClick:Y[3]||(Y[3]=_e=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):se("",!0)],8,BV),i.value?(L(),$("div",tN,[g("div",nN,[Y[24]||(Y[24]=g("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),g("div",rN,[Y[20]||(Y[20]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),ut(g("input",{"onUpdate:modelValue":Y[4]||(Y[4]=_e=>a.value=_e),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:Z},null,544),[[St,a.value]])]),g("div",sN,[Y[21]||(Y[21]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),ut(g("input",{"onUpdate:modelValue":Y[5]||(Y[5]=_e=>l.value=_e),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[St,l.value]])]),g("div",iN,[Y[22]||(Y[22]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),ut(g("input",{"onUpdate:modelValue":Y[6]||(Y[6]=_e=>c.value=_e),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:I},null,544),[[St,c.value]]),Y[23]||(Y[23]=g("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),g("div",oN,[g("button",{onClick:T,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),g("button",{onClick:w,disabled:!a.value.trim()||!l.value.trim()||!c.value.trim()||c.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,aN)])])])):se("",!0),o.value?(L(),$("div",lN,[g("div",uN,[g("div",cN,[Y[25]||(Y[25]=g("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[g("span",{class:"text-2xl"},"⚠️")],-1)),Y[26]||(Y[26]=g("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),g("p",dN,'Êtes-vous sûr de vouloir supprimer la saison "'+ae((Se=f.value)==null?void 0:Se.name)+'" ?',1)]),Y[27]||(Y[27]=g("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),g("div",{class:"flex justify-end space-x-3"},[g("button",{onClick:D,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),g("button",{onClick:R,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):se("",!0),ht(gI,{show:m.value,message:b(),error:y.value,"session-info":Fe(),onSubmit:Ce,onCancel:Xe},null,8,["show","message","error","session-info"]),ht(vI,{show:C.value,onClose:Y[7]||(Y[7]=_e=>C.value=!1)},null,8,["show"]),Y[28]||(Y[28]=cr('<footer class="mt-16 border-t border-white/10"><div class="container mx-auto px-4 py-6 text-center text-xs text-gray-400"><span>© Patrice Lamarque 2025</span><span class="mx-2">•</span><span>Licence MIT</span><span class="mx-2">•</span><a href="https://github.com/plamarque/impro-selector" target="_blank" rel="noopener noreferrer" class="underline decoration-white/20 hover:decoration-white/40 hover:text-gray-200">GitHub</a></div></footer>',1))])}}},fN="modulepreload",pN=function(n){return"/"+n},by={},qt=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=pN(i),i in by)return;by[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let f=s.length-1;f>=0;f--){const m=s[f];if(m.href===i&&(!o||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":fN,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((f,m)=>{c.addEventListener("load",f),c.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},oh="magicLinks";function ah({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function yI(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function Ff({seasonId:n,playerId:e,eventId:t,action:r}){const s=ah({seasonId:n,playerId:e,eventId:t,action:r}),i=yI(40),o=Ve(me,oh,s),a=Date.now()+1e3*60*60*24*7;await xn(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const c=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:c}}async function _I({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=ah({seasonId:n,playerId:e,eventId:r,action:s}),o=yI(40),a=Ve(me,oh,i),l=Date.now()+1e3*60*60*24*7;await xn(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const f=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:f}}async function bI({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=ah({seasonId:n,playerId:e,eventId:t,action:s}),o=Ve(me,oh,i),a=await ds(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function Uf({seasonId:n,playerId:e,eventId:t,action:r}){const s=ah({seasonId:n,playerId:e,eventId:t,action:r}),i=Ve(me,oh,s);await rd(i)}const mN=Object.freeze(Object.defineProperty({__proto__:null,consumeMagicLink:Uf,createEmailVerificationLink:_I,createMagicLink:Ff,verifyMagicLink:bI},Symbol.toStringTag,{value:"Module"}));class gN{constructor(){this.sessions=new Map,this.sessionDuration=10*60*1e3}isPasswordCached(e){const t=this.sessions.get(e);return t?Date.now()-t.timestamp>this.sessionDuration?(this.sessions.delete(e),!1):!0:!1}getCachedPassword(e){const t=this.sessions.get(e);return t?Date.now()-t.timestamp>this.sessionDuration?(this.sessions.delete(e),null):t.password:null}saveSession(e,t){this.sessions.set(e,{password:t,timestamp:Date.now()})}clearSession(e){this.sessions.delete(e)}clearExpiredSessions(){const e=Date.now();for(const[t,r]of this.sessions.entries())e-r.timestamp>this.sessionDuration&&this.sessions.delete(t)}clearAllSessions(){this.sessions.clear()}}const ga=new gN;function km(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}async function wI(n,e,t,r=null){try{console.log("🔍 [DEBUG] Début protectPlayer:",{playerId:n,email:e,seasonId:r});const s=await Ru(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await qt(()=>import("./index.esm-bf144b57.js"),[]),{db:c}=await qt(()=>Promise.resolve().then(()=>zs),void 0),f=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),m=o(f,a("email","==",e)),v=await l(m);if(!v.empty&&v.docs.find(M=>M.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");console.log("🔍 [DEBUG] Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:y}=await qt(()=>import("./index.esm-f0a261c1.js"),[]),{auth:C}=await qt(()=>Promise.resolve().then(()=>zs),void 0),A=await y(C,e,t);console.log("🔍 [DEBUG] Compte Firebase Auth créé:",A.user.uid);const k=km(t),U=r?Ve(c,"seasons",r,"playerProtection",n):Ve(c,"playerProtection",n);return await xn(U,{playerId:n,email:e,passwordHash:k,firebaseUid:A.user.uid,isProtected:!0,createdAt:new Date}),console.log("🔍 [DEBUG] Protection sauvegardée dans Firestore"),{success:!0}}catch(s){throw console.error("❌ [ERROR] Erreur lors de la protection du joueur:",s),s}}async function II({playerId:n,email:e,seasonId:t=null}){const r=t?Ye(me,"seasons",t,"playerProtection"):Ye(me,"playerProtection"),s=Kd(r,am("email","==",e)),i=await kt(s);if(!i.empty&&i.docs.find(f=>f.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");try{const{fetchSignInMethodsForEmail:c}=await qt(()=>import("./index.esm-f0a261c1.js"),[]),{auth:f}=await qt(()=>Promise.resolve().then(()=>zs),void 0),m=await c(f,e);if(Array.isArray(m)&&m.length>0)throw new Error("Cette adresse email est déjà utilisée par un autre joueur")}catch(c){if(c!=null&&c.code&&c.code!=="auth/invalid-email")throw c}const o=t?Ve(me,"seasons",t,"playerProtection",n):Ve(me,"playerProtection",n);(await ds(o)).exists()?await bu(o,{email:e,updatedAt:new Date}):await xn(o,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:l}=await _I({seasonId:t,playerId:n,email:e});return{success:!0,url:l}}async function EI({playerId:n,seasonId:e=null}){const t=e?Ve(me,"seasons",e,"playerProtection",n):Ve(me,"playerProtection",n);if(!(await ds(t)).exists())throw new Error("Protection introuvable");return await bu(t,{emailVerifiedAt:new Date}),{success:!0}}async function vN({playerId:n,seasonId:e=null}){const t=e?Ve(me,"seasons",e,"playerProtection",n):Ve(me,"playerProtection",n);return await bu(t,{emailVerifiedAt:null}),{success:!0}}async function TI(n,e=null){try{const t=e?Ve(me,"seasons",e,"playerProtection",n):Ve(me,"playerProtection",n);return await xn(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date}),{success:!0,email:""}}catch(t){throw console.error("Erreur lors de la suppression de la protection:",t),t}}async function Fi(n,e=null){try{const t=e?Ve(me,"seasons",e,"playerProtection",n):Ve(me,"playerProtection",n),r=await ds(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return console.error("Erreur lors de la vérification de protection:",t),!1}}async function Ru(n,e=null){try{const t=e?Ve(me,"seasons",e,"playerProtection",n):Ve(me,"playerProtection",n),r=await ds(t);return r.exists()?r.data():null}catch(t){return console.error("Erreur lors de la récupération des données de protection:",t),null}}async function xI(n,e=null){try{const t=await Ru(n,e);return(t==null?void 0:t.email)||""}catch(t){return console.error("Erreur lors de la récupération de l'email:",t),""}}async function $f(n=null){try{const e=n?Ye(me,"seasons",n,"playerProtection"):Ye(me,"playerProtection");return(await kt(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return console.error("Erreur lors du chargement des protections:",e),[]}}async function Dm(n,e,t=null){try{const r=await Ru(n,t);if(!r||!r.isProtected)return!1;if(r.firebaseUid){console.log("🔍 [DEBUG] Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await qt(()=>import("./index.esm-f0a261c1.js"),[]),{auth:i}=await qt(()=>Promise.resolve().then(()=>zs),void 0);return await s(i,r.email,e),console.log("🔍 [DEBUG] Mot de passe Firebase Auth valide"),ga.saveSession(n,e),!0}catch(s){return console.log("🔍 [DEBUG] Mot de passe Firebase Auth invalide:",s.code),!1}}else{console.log("🔍 [DEBUG] Vérification avec hash local");const s=km(e),i=r.passwordHash===s;return i&&ga.saveSession(n,e),i}}catch(r){return console.error("Erreur lors de la vérification du mot de passe:",r),!1}}function Qo(n){return ga.isPasswordCached(n)}function yN(n){return ga.getCachedPassword(n)}async function AI(n,e=null){try{console.log("🔍 [DEBUG] Début sendPasswordResetEmail:",{playerId:n,seasonId:e});const t=await Ru(n,e);if(console.log("🔍 [DEBUG] Protection data:",t),!t||!t.isProtected)throw new Error("Joueur non protégé");if(console.log("🔍 [DEBUG] Email à utiliser:",t.email),t.firebaseUid){console.log("🔍 [DEBUG] Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await qt(()=>import("./index.esm-f0a261c1.js"),[]),{auth:s}=await qt(()=>Promise.resolve().then(()=>zs),void 0);console.log("🔍 [DEBUG] Tentative d'envoi d'email à:",t.email),await r(s,t.email),console.log("🔍 [DEBUG] Email envoyé avec succès via Firebase Auth!"),console.log("🔍 [DEBUG] Vérifiez votre boîte mail:",t.email)}else{console.log("🔍 [DEBUG] Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await qt(()=>import("./index.esm-f0a261c1.js"),[]),{auth:i}=await qt(()=>Promise.resolve().then(()=>zs),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);console.log("🔍 [DEBUG] Compte temporaire créé:",a.user.uid),await s(i,t.email),console.log("🔍 [DEBUG] Email envoyé avec succès!");const{updateDoc:l}=await qt(()=>import("./index.esm-bf144b57.js"),[]),{db:c}=await qt(()=>Promise.resolve().then(()=>zs),void 0),f=e?Ve(c,"seasons",e,"playerProtection",n):Ve(c,"playerProtection",n);await l(f,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")console.log("🔍 [DEBUG] Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),console.log("🔍 [DEBUG] Email envoyé avec succès!");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw console.error("❌ [ERROR] Erreur lors de l'envoi de l'email de réinitialisation:",t),console.error("❌ [ERROR] Code d'erreur:",t.code),console.error("❌ [ERROR] Message d'erreur:",t.message),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function _N(n,e,t=null){try{const r=km(e),s=t?Ve(me,"seasons",t,"playerProtection",n):Ve(me,"playerProtection",n);return await bu(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw console.error("Erreur lors de la mise à jour du mot de passe:",r),r}}async function bN(n){return new Promise((e,t)=>{console.log("Demande de mot de passe pour disponibilité:",n),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const ud=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:vN,getCachedPlayerPassword:yN,getPlayerEmail:xI,getPlayerProtectionData:Ru,isPlayerPasswordCached:Qo,isPlayerProtected:Fi,listProtectedPlayers:$f,markEmailVerifiedForProtection:EI,protectPlayer:wI,requirePlayerPasswordForAvailability:bN,sendPasswordResetEmail:AI,startEmailVerificationForProtection:II,unprotectPlayer:TI,updatePlayerPasswordInFirestore:_N,verifyPlayerPassword:Dm},Symbol.toStringTag,{value:"Module"}));let qn="mock",jf=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],Qi=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function SI(n){qn=n}async function wN(){if(qn!=="firebase"||!(await kt(Ye(me,"seasons"))).empty)return;const e=Ve(Ye(me,"seasons"));await xn(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:Iu()});const t=await kt(Ye(me,"players"));for(const o of t.docs)await xn(Ve(e,"players",o.id),o.data());const r=await kt(Ye(me,"events"));for(const o of r.docs)await xn(Ve(e,"events",o.id),o.data());const s=await kt(Ye(me,"availability"));for(const o of s.docs)await xn(Ve(e,"availability",o.id),o.data());const i=await kt(Ye(me,"selections"));for(const o of i.docs)await xn(Ve(e,"selections",o.id),o.data())}async function IN(){qn==="firebase"&&await wN()}async function wy(n=null){return(qn==="firebase"?n?(await kt(Ye(me,"seasons",n,"events"))).docs.map(t=>({id:t.id,...t.data()})):(await kt(Ye(me,"events"))).docs.map(t=>({id:t.id,...t.data()})):Qi).sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const f=new Date(c);return isNaN(f.getTime())?null:f},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function Kh(n=null){return(qn==="firebase"?n?(await kt(Ye(me,"seasons",n,"players"))).docs.map(t=>({id:t.id,...t.data()})):(await kt(Ye(me,"players"))).docs.map(t=>({id:t.id,...t.data()})):jf).sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function PI(n,e=null){if(qn==="firebase"){const t=Ve(e?Ye(me,"seasons",e,"players"):Ye(me,"players"));return await xn(t,{name:n}),t.id}else{const t=`p${jf.length+1}`;return jf.push({id:t,name:n}),t}}async function Ro(n,e,t=null){if(qn==="firebase"){const r=t?await kt(Ye(me,"seasons",t,"availability")):await kt(Ye(me,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function Co(n=null){if(qn==="firebase"){const e=n?await kt(Ye(me,"seasons",n,"selections")):await kt(Ye(me,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function Iy(n,e,t=null){if(qn==="firebase"){const r=t?Ve(me,"seasons",t,"availability",n):Ve(me,"availability",n);await xn(r,e)}}async function EN({seasonId:n,playerName:e,eventId:t,value:r}){if(qn!=="firebase")return;const s=n?Ve(me,"seasons",n,"availability",e):Ve(me,"availability",e),i=await ds(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await xn(s,a)}async function TN(n,e,t=null){if(qn==="firebase"){const r=t?Ve(me,"seasons",t,"selections",n):Ve(me,"selections",n);await xn(r,{players:e})}}async function xN(n,e=null){if(console.log("Suppression de l'événement:",n),qn==="firebase")try{console.log("Suppression de l'événement dans Firestore");const t=e?Ve(me,"seasons",e,"events",n):Ve(me,"events",n);await rd(t),console.log("Suppression de la sélection associée");const r=e?Ve(me,"seasons",e,"selections",n):Ve(me,"selections",n);await rd(r),console.log("Suppression des disponibilités");const s=e?await kt(Ye(me,"seasons",e,"availability")):await kt(Ye(me,"availability")),i=gC(me);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){console.log("Mise à jour de la disponibilité pour:",o.id);const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),console.log("Opérations de suppression terminées avec succès")}catch(t){throw console.error("Erreur lors de la suppression:",t),t}else Qi=Qi.filter(t=>t.id!==n)}async function AN(n,e=null){if(qn==="firebase"){const t=Ve(e?Ye(me,"seasons",e,"events"):Ye(me,"events"));return await xn(t,n),t.id}else{const t=`event${Qi.length+1}`;return Qi.push({id:t,...n}),t}}async function Ey(n,e,t=null){if(qn==="firebase"){const r=t?Ve(me,"seasons",t,"events",n):Ve(me,"events",n);await xn(r,e,{merge:!0})}else{const r=Qi.findIndex(s=>s.id===n);r!==-1&&(Qi[r]={id:n,...e})}}async function SN({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,reason:o="new_event",fromEmail:a=void 0}){const l=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>Disponibilité demandée</h2>
      <p>Bonjour ${e},</p>
      <p>Peux-tu indiquer ta disponibilité pour <strong>${t}</strong> (${r}) ?</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;margin-right:8px;background:#16a34a;color:#fff;border-radius:8px;text-decoration:none;">Je suis dispo ✅</a>
        <a href="${i}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Pas dispo ❌</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: ${o}</p>
    </div>
  `,c=`Disponibilité demandée · ${t}`,f={to:n,message:{subject:c,html:l},createdAt:Iu(),meta:{reason:o,eventTitle:t,eventDate:r,playerName:e}};return a&&(f.from=a,f.replyTo=a),await Yd(Ye(me,"mail"),f),{success:!0}}async function PN({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){const s=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>Vérification de votre email</h2>
      <p>Bonjour ${e},</p>
      <p>Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.</p>
      <p>
        <a href="${t}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">Vérifier mon email</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,o={to:n,message:{subject:"Confirmez votre email pour activer la protection",html:s},createdAt:Iu(),meta:{reason:"protection_email_verification",playerName:e}};r&&(o.from=r,o.replyTo=r),await Yd(Ye(me,"mail"),o)}async function RN({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0}){console.log(`🔍 DEBUG queueSelectionEmail appelée pour ${e} avec:`,{toEmail:n,eventTitle:t,eventDate:r,eventUrl:s,hasCustomHtml:!!i,hasCustomSubject:!!o});const l=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Tu as été sélectionné(e) !</h2>
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#8b5cf6;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,c=o||`🎭 Sélection confirmée · ${t}`;console.log("🔍 DEBUG HTML final utilisé:",l.substring(0,200)+"..."),console.log("🔍 DEBUG Sujet final utilisé:",c);const f={to:n,message:{subject:c,html:l},createdAt:Iu(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}};a&&(f.from=a,f.replyTo=a),console.log("🔍 DEBUG Données à envoyer à Firestore:",f);try{return await Yd(Ye(me,"mail"),f),console.log(`✅ Email ajouté à la queue Firestore pour ${e}`),{success:!0}}catch(m){throw console.error(`❌ Erreur lors de l'ajout à Firestore pour ${e}:`,m),m}}async function CN({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(console.log("🔍 DEBUG sendSelectionEmailsForEvent appelée avec:",{eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await qt(()=>Promise.resolve().then(()=>ud),void 0),{createMagicLink:a}=await qt(()=>Promise.resolve().then(()=>mN),void 0),l=`${window.location.origin}/season/${s}/event/${n}`;console.log("🔍 DEBUG eventUrl:",l);const c=t.join(", ");console.log("🔍 DEBUG playersList:",c);const f=`🎭 Sélection confirmée · ${e.title}`;console.log("🔍 DEBUG subject:",f);const m=[];for(const v of t){console.log(`🔍 DEBUG Traitement du joueur: ${v}`);try{const y=i==null?void 0:i.find(M=>M.name===v);if(!y){console.warn(`⚠️ Joueur non trouvé: ${v}`);continue}console.log("🔍 DEBUG Joueur trouvé:",y);const C=await o(y.id,r);if(!C){console.warn(`⚠️ Pas d'email pour le joueur: ${v}`);continue}console.log(`🔍 DEBUG Email trouvé pour ${v}:`,C);const k=`${(await a({seasonId:r,playerId:y.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,U=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection confirmée</h2>
          <p>Bonjour <strong>${v}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${Ty(e.date)}).</p>
          <p>Sélection complète : <strong>${c}</strong>.</p>
          <p>Tu n'es plus disponible ? Signale le rapidement ici :</p>
          <p>
            <a href="${k}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Signaler que je ne suis plus disponible</a>
          </p>
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 16px;background:#8b5cf6;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;console.log(`🔍 DEBUG HTML généré pour ${v}:`,U.substring(0,200)+"...");const j=RN({toEmail:C,playerName:v,eventTitle:e.title,eventDate:Ty(e.date),eventUrl:l,html:U,subject:f});m.push(j),console.log(`✅ Email ajouté à la queue pour ${v}`)}catch(y){console.error(`❌ Erreur lors de l'envoi de l'email de sélection pour ${v}:`,y)}}return console.log(`🔍 DEBUG Nombre total d'emails à envoyer: ${m.length}`),await Promise.all(m),console.log("✅ Tous les emails ont été envoyés avec succès"),{success:!0,count:m.length}}function Ty(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}const kN={class:"relative p-5 pb-4 border-b border-white/10"},DN={class:"text-xl md:text-2xl font-bold text-white pr-10"},VN={key:0,class:"text-sm text-purple-300 mt-1"},NN={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},ON={class:"bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20 p-3"},MN={class:"text-blue-200 text-sm"},LN={class:"flex space-x-1 bg-gray-800 rounded-lg p-1"},FN=["onClick"],UN={key:0,class:"space-y-4"},$N={class:"bg-gray-800 border border-gray-600 rounded-lg p-4 text-white whitespace-pre-line"},jN={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},BN={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},qN={class:"text-blue-200 text-sm"},zN={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},GN={key:0,class:"space-y-2"},KN={class:"flex flex-wrap gap-2"},HN={key:1,class:"text-amber-400 text-sm"},WN={key:1,class:"space-y-4"},QN={class:"relative"},JN=["value"],YN=["title"],XN={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ZN={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e2={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},t2=["disabled"],n2={key:0},r2={key:1},RI={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]}},emits:["close","notifications-sent","send-email-notifications"],setup(n,{emit:e}){const t=n,r=e,s=N("email"),i=N(!1),o=N("Copier le message"),a=N(!1),l=N(!1),c=[{id:"email",label:"📧 Email"},{id:"copy",label:"📋 Copie"}],f=We(()=>!t.event||!t.seasonSlug?"":`${window.location.origin}/season/${t.seasonSlug}/event/${t.event.id}`),m=We(()=>{if(!t.event)return"";const M=k(t.event.date);if(t.mode==="selection"){const q=t.selectedPlayers.join(", ");return`Sélection pour ${t.event.title} du ${M} : ${q}`}else return`Bonjour !

Nouvel événement : ${t.event.title}
Date : ${M}

Lien direct vers l'événement : ${f.value}

Merci de confirmer votre disponibilité.`}),v=We(()=>{if(!t.event||!t.selectedPlayers)return"";if(t.mode==="selection"){const M=t.selectedPlayers.join(", ");return`Sélection confirmée

Bonjour [Nom du joueur],

Tu as été sélectionné(e) pour ${t.event.title} (${k(t.event.date)}).

Sélection complète : ${M}.

Tu n'es plus disponible ? Signale le rapidement ici : [Lien de désistement]`}else return`Disponibilité demandée

Bonjour [Nom du joueur],

Peux-tu indiquer ta disponibilité pour ${t.event.title} (${k(t.event.date)}) ?`}),y=N([]);async function C(){if(!t.seasonId)return;let M=[];t.mode==="selection"?M=t.players.filter(ee=>t.selectedPlayers.includes(ee.name)):M=t.players.filter(ee=>ee.isProtected);const q=[];for(const ee of M)try{const{getPlayerEmail:Z}=await qt(()=>Promise.resolve().then(()=>ud),void 0),I=await Z(ee.id,t.seasonId);I&&q.push({...ee,email:I})}catch(Z){console.warn(`Impossible de charger l'email pour ${ee.name}:`,Z)}y.value=q}function A(){r("close")}function k(M){var ee;return M?(typeof M=="string"?new Date(M):((ee=M.toDate)==null?void 0:ee.call(M))||M).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function U(){const M=m.value;navigator.clipboard.writeText(M).then(()=>{i.value=!0,o.value="Copié !",setTimeout(()=>{i.value=!1,o.value="Copier le message"},2e3)}).catch(q=>{console.error("Erreur lors de la copie du texte:",q),alert("Impossible de copier le message.")})}async function j(){if(!(!t.event||y.value.length===0)){a.value=!0;try{t.mode==="selection"?r("send-email-notifications",{eventId:t.event.id,eventData:t.event,reason:"selection",selectedPlayers:t.selectedPlayers}):r("send-email-notifications",{eventId:t.event.id,eventData:t.event,reason:"manual"})}catch(M){console.error("Erreur lors de l'envoi des notifications:",M),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer.")}finally{a.value=!1}}}return Ks(()=>{t.show&&(s.value="email",C())}),Jt(()=>t.show,M=>{M&&(s.value="email",C())}),Jt(()=>t.selectedPlayers,()=>{t.show&&t.mode==="selection"&&C()}),(M,q)=>n.show?(L(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:A},[g("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:q[1]||(q[1]=Bt(()=>{},["stop"]))},[g("div",kN,[g("button",{onClick:A,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),g("h2",DN,ae(n.mode==="selection"?"Annoncer la sélection":"Annoncer l'événement"),1),n.event?(L(),$("p",VN,ae(n.event.title)+" — "+ae(k(n.event.date)),1)):se("",!0)]),g("div",NN,[g("div",ON,[g("p",MN,ae(n.mode==="selection"?"Choisis comment annoncer cette sélection aux joueurs :":"Choisis comment annoncer cet événement aux joueurs :"),1)]),g("div",LN,[(L(),$(_t,null,dr(c,ee=>g("button",{key:ee.id,onClick:Z=>s.value=ee.id,class:Qn(["flex-1 px-4 py-2 rounded-md text-sm font-medium transition-all duration-200",s.value===ee.id?"bg-purple-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-700"])},ae(ee.label),11,FN)),64))]),s.value==="email"?(L(),$("div",UN,[g("div",null,[q[2]||(q[2]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Prévisualisation du message :",-1)),g("div",$N,ae(v.value),1)]),g("div",null,[g("label",jN,[q[3]||(q[3]=Vn(" Destinataires ")),g("button",{onClick:q[0]||(q[0]=ee=>l.value=!l.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),l.value?(L(),$("div",BN,[g("p",qN,ae(n.mode==="selection"?"Les destinataires sont les joueurs sélectionnés qui ont renseigné une adresse email en utilisant la fonction Protéger.":"Les destinataires sont les joueurs qui ont renseigné une adresse email en utilisant la fonction Protéger."),1)])):se("",!0),g("div",zN,[y.value.length>0?(L(),$("div",GN,[g("div",KN,[(L(!0),$(_t,null,dr(y.value,ee=>(L(),$("span",{key:ee.id,class:"px-3 py-1 bg-gray-700 text-white rounded text-sm"},ae(ee.name),1))),128))])])):(L(),$("div",HN," ⚠️ "+ae(n.mode==="selection"?"Aucun joueur sélectionné avec email renseigné. Les notifications ne pourront pas être envoyées.":"Aucun joueur protégé avec email renseigné. Les notifications ne pourront pas être envoyées."),1))])])])):se("",!0),s.value==="copy"?(L(),$("div",WN,[q[6]||(q[6]=g("div",{class:"bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-500/20 p-3"},[g("p",{class:"text-purple-200 text-sm"},"📋 Copie du message pour partage manuel")],-1)),g("div",QN,[g("textarea",{value:m.value,class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",rows:"6",readonly:""},null,8,JN),g("button",{onClick:U,class:"absolute top-2 right-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg p-2 hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:o.value},[i.value?(L(),$("svg",ZN,q[5]||(q[5]=[g("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(L(),$("svg",XN,q[4]||(q[4]=[g("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2z"},null,-1)])))],8,YN)])])):se("",!0)]),g("div",e2,[s.value==="email"?(L(),$("button",{key:0,onClick:j,disabled:y.value.length===0||a.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[a.value?(L(),$("span",r2,"📧 Envoi en cours...")):(L(),$("span",n2,"📧 Envoyer les notifications email"))],8,t2)):se("",!0),s.value==="copy"?(L(),$("button",{key:1,onClick:U,class:"h-12 px-6 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 flex-1"}," 📋 Copier le message ")):se("",!0),g("button",{onClick:A,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):se("",!0)}},s2={class:"text-center mb-6"},i2={class:"text-lg text-gray-300"},o2={class:"mb-6"},a2={class:"space-y-4"},l2=["disabled"],u2={key:0,class:"animate-spin"},c2={key:1},d2={class:"mb-6 text-center"},h2={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},f2={class:"text-red-300 text-sm"},p2={class:"text-center mb-6"},m2={class:"text-lg text-gray-300"},g2={class:"mb-6"},v2=["disabled"],y2={key:0,class:"animate-spin"},_2={key:1},b2={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},w2={class:"text-red-300 text-sm"},I2={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},E2={class:"text-green-300 text-sm"},T2={class:"flex justify-center"},CI={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=N(""),i=N(!1),o=N(""),a=N(!1),l=N(""),c=N(""),f=N(null);async function m(){if(s.value){i.value=!0,o.value="";try{const C=await Lf(t.seasonId);if(s.value===C){r("verified",{type:"season_pin"}),y();return}await Dm(t.player.id,s.value,t.seasonId)?(r("verified",{type:"player_password"}),y()):o.value="Mot de passe incorrect. Veuillez réessayer."}catch(C){console.error("Erreur lors de la vérification:",C),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function v(){i.value=!0,l.value="",c.value="";try{const C=await AI(t.player.id,t.seasonId);c.value=C.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(C){console.error("Erreur lors de l'envoi de l'email:",C),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function y(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return Jt(()=>t.show,C=>{C&&rn(()=>{f.value&&f.value.focus()})}),(C,A)=>{var k,U;return L(),$(_t,null,[n.show?(L(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:y},[g("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:A[2]||(A[2]=Bt(()=>{},["stop"]))},[g("div",s2,[A[6]||(A[6]=g("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[g("span",{class:"text-2xl"},"🔐")],-1)),A[7]||(A[7]=g("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),g("p",i2,ae((k=n.player)==null?void 0:k.name),1),A[8]||(A[8]=g("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),g("div",o2,[g("div",a2,[g("div",null,[A[9]||(A[9]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),ut(g("input",{"onUpdate:modelValue":A[0]||(A[0]=j=>s.value=j),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:wn(m,["enter"]),ref_key:"passwordInput",ref:f},null,544),[[St,s.value]])])]),g("button",{onClick:m,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(L(),$("span",u2,"⏳")):(L(),$("span",c2,"🔓")),g("span",null,ae(i.value?"Vérification...":"Vérifier"),1)],8,l2)]),g("div",d2,[g("button",{onClick:A[1]||(A[1]=j=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(L(),$("div",h2,[g("div",f2,ae(o.value),1)])):se("",!0),g("div",{class:"flex justify-center"},[g("button",{onClick:y,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):se("",!0),a.value?(L(),$("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:A[5]||(A[5]=j=>a.value=!1)},[g("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:A[4]||(A[4]=Bt(()=>{},["stop"]))},[g("div",p2,[A[10]||(A[10]=g("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[g("span",{class:"text-2xl"},"📧")],-1)),A[11]||(A[11]=g("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),g("p",m2,ae((U=n.player)==null?void 0:U.name),1)]),g("div",g2,[A[12]||(A[12]=g("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),g("button",{onClick:v,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(L(),$("span",y2,"⏳")):(L(),$("span",_2,"📧")),g("span",null,ae(i.value?"Envoi...":"Envoyer l'email"),1)],8,v2)]),l.value?(L(),$("div",b2,[g("div",w2,ae(l.value),1)])):se("",!0),c.value?(L(),$("div",I2,[g("div",E2,ae(c.value),1)])):se("",!0),g("div",T2,[g("button",{onClick:A[3]||(A[3]=j=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):se("",!0)],64)}}},x2={class:"text-center mb-6"},A2={class:"text-lg text-gray-300"},S2={class:"mb-6"},P2={class:"flex items-center space-x-3"},R2={class:"text-2xl"},C2={class:"font-semibold text-white"},k2={class:"text-sm text-gray-300"},D2={class:"mb-6"},V2={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-1"},N2={key:0,class:"mb-6"},O2={class:"flex items-center justify-center gap-3 mb-4 text-sm"},M2={key:0,class:"space-y-4"},L2=["disabled"],F2={key:0,class:"animate-spin"},U2={key:1},$2={key:0,class:"text-sm text-gray-300"},j2={key:1,class:"space-y-4"},B2={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},q2=["disabled"],z2={key:0,class:"animate-spin"},G2={key:1},K2={key:1,class:"mb-6"},H2={key:0,class:"space-y-4 mb-4"},W2=["disabled"],Q2={key:0,class:"animate-spin"},J2={key:1},Y2=["disabled"],X2={key:2,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Z2={class:"text-red-300 text-sm"},eO={key:3,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},tO={class:"text-green-300 text-sm"},nO={__name:"PlayerProtectionModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=N(!1),i=N(1),o=N(""),a=N(""),l=N(""),c=N(""),f=N(!1),m=N(""),v=N(""),y=N(!1),C=N(!1),A=N(""),k=N(!1),U=N(!1),j=su(),M=We(()=>o.value&&o.value.includes("@")),q=We(()=>l.value&&c.value&&l.value===c.value&&l.value.length>=6);async function ee(){var D,b;if((D=t.player)!=null&&D.id&&(s.value=await Fi(t.player.id,t.seasonId),!s.value)){o.value="";try{const Ue=await(await qt(()=>Promise.resolve().then(()=>ud),void 0)).getPlayerProtectionData(t.player.id,t.seasonId);a.value=(Ue==null?void 0:Ue.email)||"";const Ce=!!(Ue!=null&&Ue.emailVerifiedAt);i.value=Ce?2:1;const Xe=((b=j.query)==null?void 0:b.verified)==="1";U.value=Xe&&Ce}catch{a.value="",i.value=1,U.value=!1}}}async function Z(){var D,b;if(M.value){f.value=!0,m.value="",v.value="";try{const Ue=await II({playerId:t.player.id,email:o.value.trim(),seasonId:t.seasonId}),Ce=(D=j.params)==null?void 0:D.slug,Xe=`${Ue.url}${Ce?`&slug=${encodeURIComponent(Ce)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await PN({toEmail:o.value,playerName:((b=t.player)==null?void 0:b.name)||"joueur",verifyUrl:Xe}),k.value=!0}catch(Ue){m.value=(Ue==null?void 0:Ue.message)||"Impossible d'envoyer l'email de vérification"}finally{f.value=!1}}}async function I(){try{const{clearEmailVerificationForProtection:D}=await qt(()=>Promise.resolve().then(()=>ud),void 0);await D({playerId:t.player.id,seasonId:t.seasonId})}catch{}i.value=1,k.value=!1,U.value=!1,o.value="",l.value="",c.value=""}async function w(){if(q.value){f.value=!0,m.value="",v.value="";try{const D=a.value||o.value;if(!D)throw new Error("Adresse email manquante");await wI(t.player.id,D,l.value,t.seasonId),v.value="Protection activée avec succès !",s.value=!0,o.value="",a.value="",l.value="",c.value="",r("update");try{t.onboarding&&r("onboarding-finished")}catch{}}catch(D){console.error("Erreur lors de l'activation de la protection:",D),D.message&&D.message.includes("email")?m.value="Cette adresse email est déjà utilisée par un autre joueur.":m.value="Erreur lors de l'activation de la protection. Veuillez réessayer."}finally{f.value=!1}}}function T(){C.value=!0,A.value="",m.value=""}async function P(){if(A.value){f.value=!0,m.value="",v.value="";try{if(!await Dm(t.player.id,A.value,t.seasonId)){m.value="Mot de passe incorrect. Veuillez réessayer.";return}const b=await TI(t.player.id,t.seasonId);v.value="Protection désactivée avec succès !",s.value=!1,C.value=!1,A.value="",b.email&&(o.value=b.email),r("update")}catch(D){console.error("Erreur lors de la désactivation de la protection:",D),m.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{f.value=!1}}}function R(){r("close")}return Jt(()=>t.player,()=>{t.show&&t.player&&ee()},{immediate:!0}),Jt(()=>t.show,D=>{D&&t.player&&(o.value="",l.value="",c.value="",m.value="",v.value="",y.value=!1,C.value=!1,A.value="",i.value=1,k.value=!1,ee(),t.onboarding&&rn(()=>{}))}),(D,b)=>{var Ue;return n.show?(L(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:R},[g("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:b[6]||(b[6]=Bt(()=>{},["stop"]))},[g("div",x2,[b[7]||(b[7]=g("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[g("span",{class:"text-2xl"},"🔒")],-1)),b[8]||(b[8]=g("h2",{class:"text-2xl font-bold text-white mb-2"},"Protection du joueur",-1)),g("p",A2,ae((Ue=n.player)==null?void 0:Ue.name),1)]),g("div",S2,[g("div",{class:Qn(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[g("div",P2,[g("span",R2,ae(s.value?"🔒":"🔓"),1),g("div",null,[g("div",C2,ae(s.value?"Protégé":"Non protégé"),1),g("div",k2,ae(s.value?"Modifications sécurisées":"Modifications libres"),1)])])],2)]),g("div",D2,[g("button",{onClick:b[0]||(b[0]=Ce=>y.value=!y.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[b[9]||(b[9]=g("h3",{class:"text-sm font-semibold text-blue-300"},"💡 Pourquoi protéger son joueur ?",-1)),g("span",{class:Qn(["text-blue-300 transition-transform duration-200",{"rotate-180":y.value}])},"▼",2)]),y.value?(L(),$("div",V2,b[10]||(b[10]=[g("div",null,[Vn("• "),g("span",{class:"text-blue-300"},"Protection des disponibilités :"),Vn(" Seul vous pouvez modifier vos disponibilités")],-1),g("div",null,[Vn("• "),g("span",{class:"text-blue-300"},"Protection du nom :"),Vn(" Seul vous pouvez changer votre nom de joueur")],-1),g("div",null,[Vn("• "),g("span",{class:"text-blue-300"},"Email requis :"),Vn(" Permet de réinitialiser le mot de passe en cas d'oubli et de recevoir des notifications quand des changements surviennent")],-1)]))):se("",!0)]),s.value?se("",!0):(L(),$("div",N2,[b[18]||(b[18]=g("h3",{class:"text-lg font-semibold text-white mb-4"},"🔐 Activer la protection",-1)),g("div",O2,[g("div",{class:Qn(["px-3 py-1 rounded-full border",i.value===1?"bg-blue-500/20 border-blue-400 text-blue-200":"bg-green-500/20 border-green-400 text-green-200"])},"1. Email",2),b[11]||(b[11]=g("div",{class:"text-gray-400"},"→",-1)),g("div",{class:Qn(["px-3 py-1 rounded-full border",i.value===2?"bg-yellow-500/20 border-yellow-400 text-yellow-200":i.value>2?"bg-green-500/20 border-green-400 text-green-200":"bg-gray-500/20 border-gray-400 text-gray-200"])},"2. Mot de passe",2)]),i.value===1?(L(),$("div",M2,[g("div",null,[b[12]||(b[12]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),ut(g("input",{"onUpdate:modelValue":b[1]||(b[1]=Ce=>o.value=Ce),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[St,o.value]])]),g("button",{onClick:Z,disabled:!M.value||f.value,class:"w-full px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[f.value?(L(),$("span",F2,"⏳")):(L(),$("span",U2,"✉️")),g("span",null,ae(f.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,L2),k.value?(L(),$("div",$2," Un email de vérification a été envoyé. Cliquez sur le lien reçu, puis revenez ici. ")):se("",!0)])):i.value===2?(L(),$("div",j2,[U.value?(L(),$("div",B2,[b[13]||(b[13]=g("span",null,"✅",-1)),b[14]||(b[14]=g("span",null,"Adresse email vérifiée",-1)),g("button",{type:"button",onClick:I,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")])):se("",!0),b[17]||(b[17]=g("div",{class:"text-sm text-gray-300"},"Définissez maintenant votre mot de passe.",-1)),g("div",null,[b[15]||(b[15]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),ut(g("input",{"onUpdate:modelValue":b[2]||(b[2]=Ce=>l.value=Ce),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[St,l.value]])]),g("div",null,[b[16]||(b[16]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),ut(g("input",{"onUpdate:modelValue":b[3]||(b[3]=Ce=>c.value=Ce),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[St,c.value]])]),g("button",{onClick:w,disabled:!q.value||f.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[f.value?(L(),$("span",z2,"⏳")):(L(),$("span",G2,"🔒")),g("span",null,ae(f.value?"Activation...":"Activer la protection"),1)],8,q2)])):se("",!0)])),s.value?(L(),$("div",K2,[b[21]||(b[21]=g("h3",{class:"text-lg font-semibold text-white mb-4"},"🔓 Désactiver la protection",-1)),b[22]||(b[22]=g("p",{class:"text-sm text-gray-300 mb-4"}," Attention : désactiver la protection supprimera définitivement le mot de passe et l'email associés. ",-1)),C.value?(L(),$("div",H2,[g("div",null,[b[19]||(b[19]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe de confirmation",-1)),ut(g("input",{"onUpdate:modelValue":b[4]||(b[4]=Ce=>A.value=Ce),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe pour confirmer"},null,512),[[St,A.value]])]),g("button",{onClick:P,disabled:!A.value||f.value,class:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[f.value?(L(),$("span",Q2,"⏳")):(L(),$("span",J2,"🔓")),g("span",null,ae(f.value?"Désactivation...":"Confirmer la désactivation"),1)],8,W2),g("button",{onClick:b[5]||(b[5]=Ce=>C.value=!1),class:"w-full px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])):se("",!0),C.value?se("",!0):(L(),$("button",{key:1,onClick:T,disabled:f.value,class:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},b[20]||(b[20]=[g("span",null,"🔓",-1),g("span",null,"Désactiver la protection",-1)]),8,Y2))])):se("",!0),m.value?(L(),$("div",X2,[g("div",Z2,ae(m.value),1)])):se("",!0),v.value?(L(),$("div",eO,[g("div",tO,ae(v.value),1)])):se("",!0),g("div",{class:"flex justify-center"},[g("button",{onClick:R,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):se("",!0)}}};const rO=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},sO={class:"relative text-center p-6 pb-4 border-b border-white/10"},iO={class:"text-2xl md:text-3xl font-bold text-white mb-1"},oO={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},aO={class:"grid grid-cols-3 gap-3 md:gap-4"},lO={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},uO={class:"text-xl md:text-2xl font-bold text-white"},cO={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},dO={class:"text-xl md:text-2xl font-bold text-white"},hO={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},fO={class:"text-xl md:text-2xl font-bold text-white"},pO={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},mO={key:0,class:"md:hidden mt-3 space-y-2"},gO={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},vO={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},yO={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},_O={class:"mb-6"},bO={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=N(!1),o=N(""),a=N(null),l=N(!1),c=N(!1),f=N(null),m=N(!1);function v(){s("close")}function y(){var Z;o.value=((Z=r.player)==null?void 0:Z.name)||"",i.value=!0,rn(()=>{a.value&&a.value.focus()})}function C(){i.value=!1,o.value=""}async function A(){var I,w;if(!o.value.trim())return;if(await Fi((I=r.player)==null?void 0:I.id,r.seasonId)){Qo((w=r.player)==null?void 0:w.id)?k():(f.value="update",c.value=!0);return}k()}function k(){var Z;s("update",{playerId:(Z=r.player)==null?void 0:Z.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function U(){var I,w;if(await Fi((I=r.player)==null?void 0:I.id,r.seasonId)){Qo((w=r.player)==null?void 0:w.id)?j():(f.value="delete",c.value=!0);return}j()}function j(){var Z;s("delete",(Z=r.player)==null?void 0:Z.id)}function M(){s("refresh")}function q(Z){f.value==="update"?k():f.value==="delete"&&j(),f.value=null}Jt(()=>r.show,Z=>{Z||(i.value=!1,o.value="",f.value=null,l.value=!1)}),e({openProtection(){l.value=!0}});const ee=N({position:null});return Jt(()=>r.show,Z=>{Z&&r.onboardingStep===4?rn(()=>{const I=document.querySelectorAll("button");let w=null;if(I.forEach(T=>{!w&&T.textContent&&T.textContent.includes("Protection")&&(w=T)}),w){const T=w.getBoundingClientRect();ee.value.position={x:Math.round(T.right+8),y:Math.round(T.top+window.scrollY-4)}}}):Z||(ee.value.position=null)}),(Z,I)=>{var w;return L(),$(_t,null,[n.show?(L(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:v},[g("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:I[5]||(I[5]=Bt(()=>{},["stop"]))},[g("div",sO,[g("button",{onClick:v,class:"absolute right-3 top-3 text-white/80 hover:text-white"},"✖️"),I[10]||(I[10]=g("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[g("span",{class:"text-2xl md:text-3xl"},"👤")],-1)),g("h2",iO,ae((w=n.player)==null?void 0:w.name),1)]),g("div",oO,[g("div",null,[g("div",aO,[g("div",lO,[g("div",uO,ae(r.stats.availability),1),I[11]||(I[11]=g("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),g("div",cO,[g("div",dO,ae(r.stats.selection),1),I[12]||(I[12]=g("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),g("div",hO,[g("div",fO,ae(r.stats.ratio)+"%",1),I[13]||(I[13]=g("div",{class:"text-xs md:text-sm text-gray-300"},"Taux",-1))])])]),g("div",pO,[g("button",{onClick:y,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},I[14]||(I[14]=[g("span",null,"✏️",-1),g("span",null,"Modifier",-1)])),g("button",{onClick:I[0]||(I[0]=T=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},I[15]||(I[15]=[g("span",null,"🔒",-1),g("span",null,"Protection",-1)])),g("button",{onClick:U,class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},I[16]||(I[16]=[g("span",null,"🗑️",-1),g("span",null,"Supprimer",-1)])),g("button",{onClick:v,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")]),m.value?(L(),$("div",mO,[g("button",{onClick:I[1]||(I[1]=T=>{y(),m.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"}," ✏️ Modifier "),g("button",{onClick:I[2]||(I[2]=T=>{U(),m.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"}," 🗑️ Supprimer ")])):se("",!0)]),g("div",gO,[g("button",{onClick:I[3]||(I[3]=T=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"}," 🔒 Protection "),g("button",{onClick:v,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer "),g("button",{onClick:I[4]||(I[4]=T=>m.value=!m.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ ")])])])):se("",!0),i.value?(L(),$("div",vO,[g("div",yO,[I[18]||(I[18]=g("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier le joueur",-1)),g("div",_O,[I[17]||(I[17]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),ut(g("input",{"onUpdate:modelValue":I[6]||(I[6]=T=>o.value=T),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[wn(C,["esc"]),wn(A,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[St,o.value]])]),g("div",{class:"flex justify-end space-x-3"},[g("button",{onClick:C,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),g("button",{onClick:A,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):se("",!0),ht(nO,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:I[7]||(I[7]=T=>l.value=!1),onUpdate:M,onOnboardingFinished:I[8]||(I[8]=T=>Z.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),ht(CI,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:I[9]||(I[9]=T=>c.value=!1),onVerified:q},null,8,["show","player","seasonId"])],64)}}},wO=rO(bO,[["__scopeId","data-v-a6671485"]]),IO={class:"relative p-6 pb-4 border-b border-white/10"},EO={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},TO={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(L(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[g("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=Bt(()=>{},["stop"]))},[g("div",IO,[g("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=g("div",{class:"flex items-center gap-3"},[g("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),g("div",null,[g("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),g("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=cr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),g("div",EO,[g("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):se("",!0)}},xO={class:"relative text-center p-6 pb-4 border-b border-white/10"},AO={class:"text-2xl md:text-3xl font-bold text-white mb-1"},SO={class:"text-sm md:text-base text-purple-300"},PO={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},RO={key:0,class:"mb-3"},CO={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},kO={class:"text-white font-medium"},DO={key:0,class:"text-purple-400 mr-2"},VO={key:1,class:"text-green-400 mr-2"},NO={key:2,class:"text-red-400 mr-2"},OO={key:3,class:"text-gray-400 mr-2"},MO={key:1,class:"mb-3"},LO={class:"grid grid-cols-3 gap-2 md:gap-3 mb-3"},FO={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},UO={class:"text-cyan-300 text-lg md:text-xl font-semibold"},$O={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},jO={class:"text-green-400 text-lg md:text-xl font-semibold"},BO={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},qO={class:"text-purple-400 text-lg md:text-xl font-semibold"},zO={key:2,class:"mb-3"},GO={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},KO={class:"flex-1"},HO={class:"text-blue-300 text-sm font-medium"},WO={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},QO=["disabled","title"],JO=["disabled"],YO={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-email-notifications"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=N(!1),o=N("Copier le message"),a=N(!1),l=N(!1),c=N(""),f=N(!1),m=N(!1),v=We(()=>r.currentSelection&&r.currentSelection.length>0),y=We(()=>{var b;if(!v.value)return!1;const P=r.currentSelection.some(Ue=>!q(Ue)),R=((b=r.event)==null?void 0:b.playerCount)||6,D=r.availableCount<R;return P||D});We(()=>{var D;if(!y.value)return"";const P=r.currentSelection.filter(b=>!q(b)),R=((D=r.event)==null?void 0:D.playerCount)||6;return P.length>0?P.length===1?`${P[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${P.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<R?`Seulement ${r.availableCount} joueurs disponibles pour ${R} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),We(()=>{if(!r.event||!v.value)return"";const P=C(r.event.date),R=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${P} : ${R}`}),Jt(()=>r.show,P=>{P&&(i.value=!1,o.value="Copier le message",l.value=!1,c.value="",f.value=!1,a.value=!1)});function C(P){var D;return P?(typeof P=="string"?new Date(P):((D=P.toDate)==null?void 0:D.call(P))||P).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function A(){s("selection")}function k(){s("perfect")}function U(){s("close")}function j(){a.value=!0}function M(){m.value=!0}function q(P){return r.playerAvailability[P]===!0}function ee(P){return r.playerAvailability[P]===!1}function Z(P){return r.currentSelection.includes(P)&&q(P)}function I(P=!1,R=!1){if(f.value=P,P){const D=C(r.event.date),b=r.currentSelection.join(", ");R?c.value=`Sélection mise à jour pour ${r.event.title} du ${D} : ${b}`:c.value=`Nouvelle sélection pour ${r.event.title} du ${D} : ${b}`}else c.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function w(){l.value=!1}e({showSuccess:I});function T(P){s("send-email-notifications",P),a.value=!1}return(P,R)=>{var D,b,Ue;return L(),$(_t,null,[n.show?(L(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:U},[g("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:R[0]||(R[0]=Bt(()=>{},["stop"]))},[g("div",xO,[g("button",{onClick:U,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),R[4]||(R[4]=g("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[g("span",{class:"text-3xl"},"🎭")],-1)),g("h2",AO,"Sélection pour "+ae((D=n.event)==null?void 0:D.title),1),g("p",SO,ae(C((b=n.event)==null?void 0:b.date)),1),g("div",{class:"mt-3"},[g("button",{onClick:M,class:"inline-flex items-center gap-2 text-sm text-blue-300 hover:text-blue-200"},R[3]||(R[3]=[g("span",null,"❓",-1),Vn(),g("span",null,"Comment ça marche ?",-1)]))])]),g("div",PO,[v.value?(L(),$("div",RO,[R[5]||(R[5]=g("h3",{class:"text-base md:text-lg font-semibold text-white mb-2"},"Joueurs sélectionnés",-1)),g("div",CO,[(L(!0),$(_t,null,dr(n.currentSelection,Ce=>(L(),$("div",{key:Ce,class:Qn(["bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 rounded-lg border border-green-500/30 text-center",{"from-red-500/20 to-red-600/20 border-red-500/30":!q(Ce),"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":ee(Ce)}])},[g("span",kO,[Z(Ce)?(L(),$("span",DO,"🎭")):q(Ce)?(L(),$("span",VO,"✅")):ee(Ce)?(L(),$("span",NO,"❌")):(L(),$("span",OO,"–")),Vn(" "+ae(Ce),1)])],2))),128))])])):se("",!0),y.value?(L(),$("div",MO,R[6]||(R[6]=[g("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[g("div",{class:"text-yellow-400"},"⚠️"),g("div",{class:"text-yellow-200 text-sm"},"Sélection incomplète. Vérifie ci-dessous.")],-1)]))):se("",!0),g("div",LO,[g("div",FO,[g("div",UO,ae(((Ue=n.event)==null?void 0:Ue.playerCount)||6),1),R[7]||(R[7]=g("div",{class:"text-xs md:text-sm text-gray-400"},"À sélectionner",-1))]),g("div",$O,[g("div",jO,ae(n.availableCount),1),R[8]||(R[8]=g("div",{class:"text-xs md:text-sm text-gray-400"},"Disponibles",-1))]),g("div",BO,[g("div",qO,ae(n.selectedCount),1),R[9]||(R[9]=g("div",{class:"text-xs md:text-sm text-gray-400"},"Sélectionnés",-1))])]),l.value?(L(),$("div",zO,[g("div",GO,[R[11]||(R[11]=g("div",{class:"text-blue-400 text-xl"},"✨",-1)),g("div",KO,[g("p",HO,ae(c.value),1)]),g("button",{onClick:w,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},R[10]||(R[10]=[g("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[g("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):se("",!0)]),g("div",WO,[g("button",{onClick:A,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":v.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},R[12]||(R[12]=[Vn(" ✨ "),g("span",{class:"hidden sm:inline"},"Sélection Auto",-1),g("span",{class:"sm:hidden"},"Auto",-1)]),8,QO),v.value?(L(),$("button",{key:0,onClick:k,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap"},R[13]||(R[13]=[Vn(" 👍 "),g("span",{class:"hidden sm:inline"},"Parfait",-1)]))):se("",!0),g("button",{onClick:j,disabled:!v.value,class:"h-12 px-3 md:px-4 bg-gray-700 text-white rounded-lg flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},R[14]||(R[14]=[Vn(" 📣 "),g("span",{class:"hidden sm:inline"},"Annoncer",-1)]),8,JO)])])])):se("",!0),ht(RI,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:R[1]||(R[1]=Ce=>a.value=!1),onSendEmailNotifications:T},null,8,["show","event","season-id","season-slug","players","selected-players"]),ht(TO,{show:m.value,onClose:R[2]||(R[2]=Ce=>m.value=!1)},null,8,["show"])],64)}}},XO={class:"flex items-center justify-center gap-2"},ZO=["title"],eM=["title"],tM=["title"],nM=["title"],rM=["title"],xy={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=N(!1),i=We(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=We(()=>t.isSelected?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){r("toggle",t.playerName,t.eventId)}return(l,c)=>(L(),$("div",{class:"flex items-center justify-center cursor-pointer hover:bg-white/10 transition-all duration-200 min-h-20 p-3 md:p-5",onClick:a,onMouseenter:c[0]||(c[0]=f=>s.value=!0),onMouseleave:c[1]||(c[1]=f=>s.value=!1)},[g("div",XO,[i.value&&s.value?(L(),$("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},ae(n.chancePercent)+"% ",9,ZO)):(L(),$(_t,{key:1},[n.isSelected?(L(),$("span",{key:0,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," 🎭 ",8,eM)):n.isAvailable===!0?(L(),$("span",{key:1,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," ✅ ",8,tM)):n.isAvailable===!1?(L(),$("span",{key:2,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," ❌ ",8,nM)):(L(),$("span",{key:3,class:"text-gray-500 hover:text-white transition-colors duration-200 text-xl",title:o.value}," – ",8,rM))],64))])],32))}},sM={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},iM={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},oM={class:"text-2xl md:text-3xl font-bold text-white mb-3"},aM={class:"text-gray-300 mb-6"},lM={class:"flex flex-col items-stretch justify-center gap-3"},uM=["value"],cM={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=We(()=>`${s}/season/${t.seasonSlug}`),o=N(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=We(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=We(()=>a.value>0),c=N(l.value);Jt(a,k=>{c.value=k>0});const f=We(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),m=We(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function v(){c.value=!1,r("create-event")}function y(){c.value=!1,r("add-player")}function C(){var k;try{(k=navigator.clipboard)==null||k.writeText(i.value)}catch{}r("copy-link")}async function A(){try{if(t.seasonId){const{db:k}=await qt(()=>Promise.resolve().then(()=>zs),void 0),{doc:U,updateDoc:j}=await qt(()=>import("./index.esm-bf144b57.js"),[]);await j(U(k,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(k,U)=>l.value&&c.value?(L(),$("div",sM,[g("div",iM,[U[1]||(U[1]=g("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[g("span",{class:"text-3xl"},"🎬")],-1)),g("h2",oM,ae(f.value),1),g("p",aM,ae(m.value),1),g("div",lM,[a.value===1?(L(),$("button",{key:0,onClick:v,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(L(),$("button",{key:1,onClick:y,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(L(),$(_t,{key:2},[g("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:U[0]||(U[0]=j=>j.target.select())},null,40,uM),g("div",{class:"flex gap-3 justify-center"},[g("button",{onClick:C,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),g("button",{onClick:A,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):se("",!0)])])])):se("",!0)}};const dM={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},hM={ref:"pageHeaderRef",class:"sticky top-0 z-[70] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},fM={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},pM={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},mM=["title"],gM={class:"text-2xl"},vM={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},yM={class:"flex items-stretch relative"},_M={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},bM={class:"flex-1 overflow-hidden"},wM=["data-event-id","onClick"],IM=["title"],EM=["title"],TM={key:0,class:"mt-1 text-xs text-gray-400"},xM=["title","onClick"],AM=["title","onClick"],SM={key:0,class:"pointer-events-none"},PM={class:"coachmark pointer-events-auto max-w-xs bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative"},RM={class:"flex items-center justify-between"},CM={key:1,class:"pointer-events-none"},kM={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-xs bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},DM={class:"flex items-center justify-between"},VM={key:2,class:"pointer-events-none"},NM={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-xs bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},OM={class:"flex items-center justify-between"},MM={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},LM=["data-player-id"],FM={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},UM={class:"px-4 md:px-5 font-bold text-xl md:text-2xl whitespace-pre-wrap flex items-center"},$M={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},jM=["onClick","title"],BM=["data-event-id"],qM={key:0,class:"border-t border-white/10"},zM={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},GM={class:"px-4 md:px-5 flex items-center"},KM=["data-event-id"],HM={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},WM={class:"text-center"},QM={class:"text-white text-lg"},JM={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},YM={class:"text-white/60 text-xs mt-2"},XM={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},ZM={class:"flex items-center space-x-2"},eL={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},tL={class:"flex items-center space-x-2"},nL={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},rL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},sL={class:"mb-6"},iL={class:"mb-6"},oL={class:"mb-6"},aL={class:"mb-6 flex items-center gap-3"},lL={class:"mb-6"},uL={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},cL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},dL={class:"mb-6"},hL={class:"flex justify-end space-x-3"},fL={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},pL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},mL={class:"flex justify-end space-x-3"},gL={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},vL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},yL={class:"flex justify-end space-x-3"},_L={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},bL={class:"relative text-center p-6 pb-4 border-b border-white/10"},wL={class:"text-2xl md:text-3xl font-bold text-white mb-1"},IL={class:"text-sm md:text-base text-purple-300"},EL={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},TL={key:0,class:"mb-4 md:mb-6"},xL={class:"text-gray-300 bg-gray-800/50 p-4 rounded-lg border border-gray-600/50"},AL={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},SL={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},PL={class:"text-xl md:text-2xl font-bold text-white"},RL={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},CL={class:"text-xl md:text-2xl font-bold text-white"},kL={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},DL={class:"text-xl md:text-2xl font-bold text-white"},VL={key:1,class:"mb-4 md:mb-6"},NL={class:"bg-gray-800 border border-gray-600 rounded-lg overflow-hidden"},OL={class:"col-span-4 p-3 flex items-center"},ML={class:"font-medium text-white"},LL={key:0,class:"text-yellow-400 ml-2 text-lg",title:"Joueur protégé"},FL={class:"col-span-8 p-0"},UL={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},$L=["disabled","title"],jL=["title"],BL={key:2,class:"md:hidden mt-3 space-y-2"},qL=["disabled","title"],zL={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},GL={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},KL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},HL={class:"mb-6"},WL={class:"mb-6"},QL={class:"mb-6"},JL={class:"mb-6 flex items-center gap-3"},YL={class:"mb-6"},XL={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},ZL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},eF={class:"mb-6"},tF={class:"space-y-4"},nF=["disabled"],rF={key:0,class:"animate-spin"},sF={key:1},iF={class:"mb-6 text-center"},oF={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},aF={class:"text-red-300 text-sm"},lF={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},uF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},cF={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},dF={class:"space-y-4"},hF={class:"mt-2 text-center"},fF={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},pF={class:"text-red-300 text-sm"},mF={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},gF=["disabled"],vF={key:0,class:"animate-spin"},yF={key:1},_F={class:"mb-6"},bF=["disabled"],wF={key:0,class:"animate-spin"},IF={key:1},EF={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},TF={class:"text-red-300 text-sm"},xF={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},AF={class:"text-green-300 text-sm"},SF={class:"flex justify-center"},PF={class:"mb-6"},RF=["disabled"],CF={key:0,class:"animate-spin"},kF={key:1},DF={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},VF={class:"text-red-300 text-sm"},NF={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},OF={class:"text-green-300 text-sm"},MF={class:"flex justify-center"},LF={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},FF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},UF={class:"flex gap-3"},Ay={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=ru(),r=su(),s=e.slug,i=N(""),o=N(""),a=N({}),l=N(!1),c=N(null),f=N(null),m=N(""),v=N(""),y=N(6),C=N(!1),A=N(""),k=N(null),U=N(null),j=N(null),M=N({position:null}),q=N({position:null}),ee=N({position:null}),Z=N(!1),I=N(null),w=N(!1),T=N(null),P=N(null),R=N(!1),D=N(null),b=N(""),Ue=N(!1),Ce=N(null),Xe=N(""),Fe=N(""),Oe=N(!1),Ae=N(null),Y=N(!1),Se=N(null),_e=N(""),ke=N(""),rt=N(!1),tn=N(null),Mt=N(!1),K=N(!1),pe=N(""),de=N(""),be=N(!1),qe=N(!1),nt=N(""),E=N(""),S=N(!1),V=N(null),H=N(""),z=N(!1),W=N(!1),le=N(!1),re=N(null),ne=N(null),X=N(null),ge=N(0);function he(){try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||Le.value.length===0)return;const d=localStorage.getItem(`playerTourCompleted:${o.value}`),h=localStorage.getItem(`startPlayerTour:${o.value}`);!d&&h&&(ge.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`),rn(()=>{const _=document.querySelector('button[data-onboarding="add-player"]');if(_){_.scrollIntoView({behavior:"smooth",block:"center"});const x=_.getBoundingClientRect();M.value.position={x:Math.round(x.left),y:Math.round(x.bottom+window.scrollY+8)}}}))}catch{}}const ve=N(!1),we=N(null),xe=N(null),Me=N(!1),Ge=N(null),Lt=N(!1),xt=N(null),cn=N(!1);Ks(()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}});function jt(){rn(()=>{Da()})}const gn=N(new Set),Zn=N(!0),vt=N(0),Xt=N("Préparation de la grille"),zn=N(e.eventId||null),ro=N(!1),li=N(null);Jt(()=>e.eventId,d=>{if(d)if(zn.value=d,Le.value.length>0)Mr(d);else{const h=Jt(Le,_=>{_.length>0&&(Mr(d),h())},{immediate:!0})}});const so=We(()=>ze.value.map(d=>({...d,isProtected:gn.value.has(d.id),email:null}))),ui=We(()=>zn.value?yn.value.findIndex(d=>d.id===zn.value):-1);We(()=>{if(!zn.value||ui.value===-1)return!1;if(window.innerWidth<=768){const d=document.querySelector(`[data-event-id="${zn.value}"]`);if(d){const h=d.getBoundingClientRect();return h.left>=0&&h.right<=window.innerWidth}}return!0});const On=N(null),io=N(!1),gr=N(!1),oo=N(0),ao=N(null),vn=N(null);function er(){const d=On.value;if(!d)return;const{scrollLeft:h,scrollWidth:_,clientWidth:x}=d;io.value=h>2,gr.value=h<_-x-2}function Da(){var d;try{er(),oo.value=((d=On.value)==null?void 0:d.scrollLeft)||0}catch{}}function nn(d){const h=On.value;if(!h)return;let _=0;const x=h.querySelector("tbody tr td[data-event-id]");if(x)_=x.getBoundingClientRect().width;else if(vn!=null&&vn.value){const oe=vn.value.querySelector(".col-event");oe&&(_=oe.getBoundingClientRect().width)}(!_||!isFinite(_))&&(_=h.clientWidth*.6);const F=h.scrollLeft+d*_;h.scrollTo({left:F,behavior:"smooth"})}const ps=N(null);N(0);const or=N(!1),vr=N(!1),ms=N(0);function Cu(d,h){h&&typeof h.preventDefault=="function"&&h.preventDefault(),lr(),nn(d)}function ar(d,h){if(h&&typeof h.preventDefault=="function"&&h.preventDefault(),or.value)return;or.value=!0,ms.value=d,vr.value=!1;const _=On.value;if(!_)return;let x=0;const F=_.querySelector("tbody tr td[data-event-id]");if(F)x=F.getBoundingClientRect().width;else if(vn!=null&&vn.value){const Pe=vn.value.querySelector(".col-event");Pe&&(x=Pe.getBoundingClientRect().width)}(!x||!isFinite(x))&&(x=_.clientWidth*.6);const oe=x/6,te=120,ce=()=>{if(!or.value||ms.value===0)return;vr.value||(vr.value=!0);const Pe=_.scrollLeft+ms.value*oe;_.scrollTo({left:Pe,behavior:"auto"}),ps.value=window.setTimeout(ce,te)};ps.value=window.setTimeout(ce,250)}function lr(d){d&&typeof d.preventDefault=="function"&&d.preventDefault();const h=or.value,_=vr.value;if(or.value=!1,ps.value&&(clearTimeout(ps.value),ps.value=null),d&&typeof d.type=="string"&&d.type.startsWith("touch")&&!_){const x=ms.value||0;x!==0&&nn(x),ms.value=0;return}ms.value=0,h&&_&&lh()}function lh(){const d=On.value;if(!d)return;let h=0;const _=d.querySelector("tbody tr td[data-event-id]");if(_)h=_.getBoundingClientRect().width;else if(vn!=null&&vn.value){const te=vn.value.querySelector(".col-event");te&&(h=te.getBoundingClientRect().width)}if(!h||!isFinite(h)||h<=0)return;const x=d.scrollLeft,oe=Math.round(x/h)*h;d.scrollTo({left:oe,behavior:"smooth"})}function lo(d){k.value=d;const h=document.querySelector(`[data-player-id="${d}"]`);h&&h.scrollIntoView({behavior:"smooth",block:"center"}),Re.value=!0,Ze.value="Nouveau joueur ajouté !",setTimeout(()=>{Re.value=!1},3e3)}function ci(d){return gn.value.has(d)}async function di(){if(o.value)try{const d=await $f(o.value),h=new Set;d.forEach(_=>{_.isProtected&&h.add(_.playerId||_.id)}),gn.value=h}catch{const h=new Set;for(const _ of ze.value)await Fi(_.id,o.value)&&h.add(_.id);gn.value=h}}const Re=N(!1),Ze=N(""),gs=N(!1),uo=N("");function Va(){try{const d=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(d),Re.value=!0,Ze.value="Lien copié dans le presse-papiers",setTimeout(()=>{Re.value=!1},2500)}catch{gs.value=!0,uo.value="Impossible de copier le lien",setTimeout(()=>{gs.value=!1},2500)}}async function co(d){await _r({type:"deleteEvent",data:{eventId:d}})}async function ku(d=null){const h=d||c.value;if(console.log("deleteEventConfirmed - eventId param:",d),console.log("deleteEventConfirmed - eventToDelete.value:",c.value),console.log("deleteEventConfirmed - eventIdToDelete:",h),console.log("deleteEventConfirmed - type de eventIdToDelete:",typeof h),!h){console.error("Aucun événement à supprimer");return}try{await xN(h,o.value),Le.value=Le.value.filter(_=>_.id!==h),await Promise.all([wy(o.value),Ro(ze.value,Le.value,o.value),Co(o.value)]).then(([_,x,F])=>{Le.value=_,Ft.value=x,pt.value=F}),l.value=!1,c.value=null,Re.value=!0,Ze.value="Événement supprimé avec succès !",setTimeout(()=>{Re.value=!1},3e3)}catch(_){console.error("Erreur lors de la suppression de l'événement:",_),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function Du(){l.value=!1,c.value=null}async function Na(){if(!f.value||!m.value.trim()||!v.value)return;const d=parseInt(y.value);if(isNaN(d)||d<1||d>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const h={title:m.value.trim(),date:v.value,description:H.value.trim()||"",playerCount:d,archived:!!z.value};await Ey(f.value,h,o.value),!h.archived&&ze.value.length>0&&gn.value.size>0&&(xt.value={id:f.value,...h},Lt.value=!0),await Promise.all([wy(o.value),Ro(ze.value,Le.value,o.value),Co(o.value)]).then(([_,x,F])=>{Le.value=_,Ft.value=x,pt.value=F}),f.value=null,m.value="",v.value="",H.value="",y.value=6,z.value=!1,Re.value=!0,Ze.value="Événement mis à jour avec succès !",setTimeout(()=>{Re.value=!1},3e3)}catch(h){console.error("Erreur lors de l'édition de l'événement:",h),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function ho(){if(A.value.trim())try{const d=A.value.trim(),h=await PI(d,o.value);await Promise.all([Kh(o.value),Ro(ze.value,Le.value,o.value),Co(o.value)]).then(([_,x,F])=>{ze.value=_,Ft.value=x,pt.value=F,di();const oe=ze.value.find(ce=>ce.id===h);lo(h),U.value=h,j.value=yn.value&&yn.value[0]&&yn.value[0].id?yn.value[0].id:null;try{o.value&&localStorage.setItem(`lastAddedPlayerId:${o.value}`,h)}catch{}try{typeof ge<"u"&&(ge.value=2)}catch{}const te=document.querySelector(`[data-player-id="${h}"]`);te&&te.scrollIntoView({behavior:"smooth",block:"center"}),rn(()=>{const ce=`[data-player-id="${U.value}"] td[data-event-id="${j.value}"]`,Pe=document.querySelector(ce);if(Pe){const $e=Pe.getBoundingClientRect();q.value.position={x:Math.round($e.left),y:Math.round($e.top+window.scrollY-48)}}}),Re.value=!0,Ze.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Re.value=!1},3e3),setTimeout(()=>{Re.value=!1,Ze.value=""},5e3)}),C.value=!1,A.value=""}catch(d){console.error("Erreur lors de l'ajout du joueur:",d),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function vs(){f.value=null,m.value="",v.value="",H.value="",y.value=6}N(null);const ys=N(!1),tr=N(""),Mn=N(""),Vr=N(""),hi=N(6),fi=N(!1);async function Vu(){if(!tr.value.trim()||!Mn.value){alert("Veuillez remplir le titre et la date de l'événement");return}const d=parseInt(hi.value);if(isNaN(d)||d<1||d>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const h={title:tr.value.trim(),date:Mn.value,description:Vr.value.trim()||"",playerCount:d,archived:!!fi.value};await Nu(h)}async function Nu(d){try{const h=await AN(d,o.value);Le.value=[...Le.value,{id:h,...d}];const _={};for(const x of ze.value)_[x.name]=Ft.value[x.name]||{},_[x.name][h]=null,await Iy(x.name,_[x.name],o.value);tr.value="",Mn.value="",Vr.value="",hi.value=6,fi.value=!1,ys.value=!1,await Promise.resolve(),Re.value=!0,Ze.value="Événement créé avec succès !",!d.archived&&ze.value.length>0&&gn.value.size>0&&(xt.value={id:h,...d},Lt.value=!0),setTimeout(()=>{Re.value=!1},3e3)}catch(h){console.error("Erreur lors de la création de l'événement:",(h==null?void 0:h.message)||h),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function Oa(){tr.value="",Mn.value="",Vr.value="",hi.value=6,ys.value=!1}async function fo(){await _r({type:"addEvent",data:{}})}const Le=N([]),ze=N([]),Ft=N({}),pt=N({}),Ou=N({}),po=N({});Jt([()=>Le.value.length,()=>ze.value.length,Zn],()=>{Zn.value||rn(()=>{Da()})}),Jt([()=>ze.value.length,()=>Le.value.length,o],()=>{he()}),Ks(async()=>{var oe;SI("firebase"),await IN();const d=Kd(Ye(me,"seasons"),am("slug","==",e.slug)),h=await kt(d);if(h.empty){t.push("/");return}else{const te=h.docs[0];o.value=te.id;const ce=te.data();i.value=ce.name,a.value=ce,document.title=`Saison : ${i.value}`}if(o.value){Xt.value="Chargement des événements de la saison",vt.value=20;const te=await kt(Ye(me,"seasons",o.value,"events"));Le.value=te.docs.map(dt=>({id:dt.id,...dt.data(),playerCount:dt.data().playerCount||6})),Xt.value="Chargement des joueurs",vt.value=45;const ce=await kt(Ye(me,"seasons",o.value,"players"));ze.value=ce.docs.map(dt=>({id:dt.id,...dt.data()})),Xt.value="Chargement des disponibilités",vt.value=70;const Pe=await kt(Ye(me,"seasons",o.value,"availability")),$e={};Pe.docs.forEach(dt=>{const Lr=dt.data(),Fr={};Object.keys(Lr).forEach(bi=>{const Eo=Lr[bi];Fr[bi]=Eo==="oui"?!0:Eo==="non"?!1:Eo}),$e[dt.id]=Fr}),Ft.value=$e,Xt.value="Chargement des sélections",vt.value=85;const it=await kt(Ye(me,"seasons",o.value,"selections")),et={};it.docs.forEach(dt=>{et[dt.id]=dt.data().players||[]}),pt.value=et;const Dt=await $f(o.value),Vt=new Set;Array.isArray(Dt)&&Dt.forEach(dt=>{dt.isProtected&&Vt.add(dt.playerId||dt.id)}),gn.value=Vt}const _=te=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>te()):setTimeout(te,0)};Xt.value="Préparation de l'interface",vt.value=95,_(()=>{Uu(),$a()}),console.log("players (deduplicated):",ze.value.map(te=>({id:te.id,name:te.name}))),console.log("availability loaded:",Ft.value),await rn(),vt.value=100,Zn.value=!1,rn(()=>{er();const te=On.value;te&&(te.addEventListener("scroll",ce=>{er(),oo.value=te.scrollLeft||0},{passive:!0}),window.addEventListener("resize",er))});const x=r.query.event;if(x&&Le.value.length>0){const te=Le.value.find(ce=>ce.id===x);te?(console.log("Événement trouvé depuis l'URL:",te.title),await Io(x,te)):(console.warn("Événement non trouvé avec l'ID:",x),gs.value=!0,uo.value="Événement non trouvé",setTimeout(()=>{gs.value=!1},3e3))}const F=r.query.player;if(F&&ze.value.length>0){const te=ze.value.find(ce=>ce.id===F);te&&(Ga(te),await rn(),r.query.open==="protection"&&((oe=P==null?void 0:P.value)!=null&&oe.openProtection)&&P.value.openProtection())}}),Jt(()=>r.params.eventId,d=>{if(d){const h=()=>{const _=Le.value.find(x=>x.id===d);return _?(Hu(_),!0):!1};if(Le.value.length>0)h();else{const _=Jt(Le,x=>{x.length>0&&h()&&_()},{immediate:!0})}}},{immediate:!0});function Mu(d){if(!d)return null;if(d instanceof Date)return d;if(typeof(d==null?void 0:d.toDate)=="function")return d.toDate();if(typeof d=="string"||typeof d=="number"){const h=new Date(d);return isNaN(h.getTime())?null:h}return null}const Gn=We(()=>[...ze.value].sort((d,h)=>(d.name||"").localeCompare(h.name||"","fr",{sensitivity:"base"}))),ur=We(()=>[...Le.value].sort((d,h)=>{const _=Mu(d.date),x=Mu(h.date),F=_?_.getTime():Number.POSITIVE_INFINITY,oe=x?x.getTime():Number.POSITIVE_INFINITY;return F!==oe?F-oe:(d.title||"").localeCompare(h.title||"","fr",{sensitivity:"base"})})),yr=N(!1),yn=We(()=>{const d=ur.value;return yr.value?d:d.filter(h=>!h.archived)});function Lu(){yr.value=!yr.value}async function st(d,h){const _=ze.value.find(oe=>oe.name===d);if(!_){console.error("Joueur non trouvé:",d);return}if(!Le.value.find(oe=>oe.id===h)){console.error("Événement non trouvé:",h);return}if(ci(_.id)){const oe=Qo(_.id),te=X.value===_.id;console.log("Joueur protégé:",{playerId:_.id,hasCachedPassword:oe,wasRecentlyVerified:te,recentlyVerifiedPlayer:X.value}),oe||te?(console.log("Session active ou joueur récemment vérifié, procéder au toggle"),te&&(console.log("Nettoyage du flag recentlyVerifiedPlayer"),X.value=null),_s(_,h)):(console.log("Pas de session, affichage de la modal de vérification"),ne.value={playerName:d,eventId:h},re.value=_,le.value=!0);return}_s(_,h)}function _s(d,h){var F,oe,te;const _=(F=Ft.value[d.name])==null?void 0:F[h];console.log(`toggleAvailability - ${d.name} pour ${h}:`,_);let x;_===!0?x=!1:_===!1?x=void 0:x=!0,x===void 0?Ft.value[d.name]&&delete Ft.value[d.name][h]:(Ft.value[d.name]||(Ft.value[d.name]={}),Ft.value[d.name][h]=x);try{typeof ge<"u"&&ge.value===1&&d.id===(U.value||((oe=Gn.value[0])==null?void 0:oe.id))&&h===(j.value||((te=yn.value[0])==null?void 0:te.id))&&(ge.value=3,rn(()=>{const Pe=document.querySelector(`[data-player-id="${d.id}"]`);if(Pe){const $e=Pe.querySelector(".player-name");if($e){const it=$e.getBoundingClientRect();ee.value.position={x:Math.round(it.right+8),y:Math.round(it.top+window.scrollY-4)}}}}))}catch{}Iy(d.name,Ft.value[d.name],o.value).then(async()=>{await rn(),$a(),Re.value=!0,Ze.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Re.value=!1},3e3)}).catch(ce=>{console.error("Erreur lors de la mise à jour de la disponibilité:",ce),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function Rn(d,h){var _;return(_=Ft.value[d])==null?void 0:_[h]}function pi(d,h){var F;const _=pt.value[h]||[],x=(F=Ft.value[d])==null?void 0:F[h];return _.includes(d)&&x===!0}async function uh(d,h=6){const _=Le.value.find(te=>te.id===d),x=(_==null?void 0:_.playerCount)||6,F=pt.value[d]||[];if(F.length>0&&F.every(te=>Rn(te,d))){console.log("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const ce=ze.value.filter(it=>Rn(it.name,d)).map(it=>{const et=bs(it.name);return{name:it.name,weight:1/(1+et)}}),Pe=[],$e=[...ce];for(;Pe.length<x&&$e.length>0;){const it=$e.reduce((Vt,dt)=>Vt+dt.weight,0);let et=Math.random()*it;const Dt=$e.findIndex(Vt=>(et-=Vt.weight,et<=0));Dt>=0&&(Pe.push($e[Dt].name),$e.splice(Dt,1))}pt.value[d]=Pe}else{const te=F.filter(Pe=>Rn(Pe,d)),ce=x-te.length;if(ce<=0)pt.value[d]=te;else{const Pe=new Set(te),it=ze.value.filter(Vt=>Rn(Vt.name,d)&&!Pe.has(Vt.name)).map(Vt=>{const dt=bs(Vt.name);return{name:Vt.name,weight:1/(1+dt)}}),et=[],Dt=[...it];for(;et.length<ce&&Dt.length>0;){const Vt=Dt.reduce((Fr,bi)=>Fr+bi.weight,0);let dt=Math.random()*Vt;const Lr=Dt.findIndex(Fr=>(dt-=Fr.weight,dt<=0));Lr>=0&&(et.push(Dt[Lr].name),Dt.splice(Lr,1))}pt.value[d]=[...te,...et]}}await TN(d,pt.value[d],o.value),Uu(),$a()}async function Ma(d,h=6){var te,ce,Pe,$e,it;console.log("tirerProtected appelé avec eventId:",d),console.log("showSelectionModal.value AVANT:",ve.value),console.log("selectionModalEvent.value?.id AVANT:",(te=we.value)==null?void 0:te.id);const _=ve.value,x=(ce=we.value)==null?void 0:ce.id,F=pt.value[d]&&pt.value[d].length>0,oe=F?[...pt.value[d]]:[];if(await uh(d,h),console.log("showSelectionModal.value APRÈS tirage:",ve.value),console.log("selectionModalEvent.value?.id APRÈS tirage:",(Pe=we.value)==null?void 0:Pe.id),_&&!ve.value&&(console.log("Restauration de la popin de sélection..."),ve.value=!0,we.value=Le.value.find(et=>et.id===x)),ve.value&&(($e=we.value)==null?void 0:$e.id)===d)if(console.log("Popin de sélection ouverte, mise à jour..."),await rn(),xe.value&&xe.value.showSuccess){console.log("Appel de showSuccess sur la popin de sélection");const et=pt.value[d]||[],Dt=oe.filter(dt=>et.includes(dt)),Vt=Dt.length>0&&Dt.length<oe.length;xe.value.showSuccess(F,Vt)}else console.log("selectionModalRef.value:",xe.value),console.log("showSuccess disponible:",(it=xe.value)==null?void 0:it.showSuccess);else console.log("Popin de sélection fermée, affichage message global"),Re.value=!0,Le.value.find(et=>et.id===d),pt.value[d],F?Ze.value="Sélection mise à jour avec succès !":Ze.value="Sélection effectuée avec succès !",setTimeout(()=>{Re.value=!1},3e3)}function La(d){d===0?M.value.position=null:d===1?q.value.position=null:d===2&&(ee.value.position=null)}function ch(d){var _;return d?(typeof d=="string"?new Date(d):((_=d.toDate)==null?void 0:_.call(d))||d).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function Fa(d){var _;return d?(typeof d=="string"?new Date(d):((_=d.toDate)==null?void 0:_.call(d))||d).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function bs(d){return Object.values(pt.value).filter(h=>h.includes(d)).length}function Nr(d){const h=Ft.value[d]||{};return Object.values(h).filter(_=>_===!0).length}function Kn(d){return d?Object.values(Ft.value).filter(h=>h[d]===!0).length:0}function mo(d){return d?(pt.value[d]||[]).length:0}function Ua(d){const h=Le.value.find(x=>x.id===d),_=(h==null?void 0:h.playerCount)||6;return mo(d)>=_}function Fu(d){const h=Nr(d),_=bs(d);return h===0?0:_/h}function ws(d){Ou.value[d]={availability:Nr(d),selection:bs(d),ratio:Fu(d)}}function Uu(){ze.value.forEach(d=>ws(d.name))}function $a(){const d={};Le.value.forEach(h=>{const _=h.playerCount||6,F=ze.value.filter(te=>Rn(te.name,h.id)===!0).map(te=>{const ce=bs(te.name);return{name:te.name,weight:1/(1+ce)}}),oe=F.reduce((te,ce)=>te+ce.weight,0);F.forEach(te=>{const ce=Math.min(1,te.weight/oe*_);d[te.name]||(d[te.name]={}),d[te.name][h.id]=Math.round(ce*100)})}),po.value=d}const go=N(null),Hn=N(!1);async function dh(d=null){const h=d||go.value;if(!h){console.error("Aucun joueur à supprimer");return}try{await deletePlayer(h,o.value),ze.value=ze.value.filter(_=>_.id!==h),Hn.value=!1,go.value=null,Re.value=!0,Ze.value="Joueur supprimé avec succès !",setTimeout(()=>{Re.value=!1},3e3)}catch(_){console.error("Erreur lors de la suppression du joueur :",_),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function hh(){Hn.value=!1,go.value=null}async function vo(d){Is(),await Fi(d,o.value)?await ju({type:"deletePlayer",data:{playerId:d}}):await _r({type:"deletePlayer",data:{playerId:d}})}async function yo(){if(I.value){const d=Le.value.find(_=>_.id===I.value),h=(d==null?void 0:d.playerCount)||6;await Ma(I.value,h),Z.value=!1,I.value=null}}function $u(){Z.value=!1,I.value=null}function mi(){return D.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis"}[D.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function _r(d){if(Fn.isPinCached(o.value)){const h=Fn.getCachedPin(o.value);if(console.log("PIN en cache trouvé, utilisation automatique"),await ld(o.value,h)){await dn(d);return}else Fn.clearSession()}D.value=d,R.value=!0}async function ju(d){const h=d.data.playerId;if(Qo(h)){console.log("Mot de passe du joueur en cache trouvé, utilisation automatique"),await dn(d);return}Ce.value=d,Ue.value=!0}async function ja(d){try{if(await ld(o.value,d)){Fn.saveSession(o.value,d),R.value=!1;const _=D.value;D.value=null,await dn(_)}else b.value="Code PIN incorrect",setTimeout(()=>{b.value=""},3e3)}catch(h){console.error("Erreur lors de la vérification du PIN:",h),b.value="Erreur lors de la vérification du code PIN"}}function At(){R.value=!1,D.value=null,b.value=""}async function Bu(d){if(d){Oe.value=!0,Xe.value="";try{const h=Ce.value.data.playerId,_=await Lf(o.value);if(d===_){try{ga.saveSession(Ce.value.data.playerId,d)}catch{}Ue.value=!1;const F=Ce.value;Ce.value=null,Fe.value="",await dn(F);return}if(await verifyPlayerPassword(h,d,o.value)){Ue.value=!1;const F=Ce.value;Ce.value=null,Fe.value="",await dn(F)}else Xe.value="Mot de passe incorrect",setTimeout(()=>{Xe.value=""},3e3)}catch(h){console.error("Erreur lors de la vérification du mot de passe:",h),Xe.value="Erreur lors de la vérification du mot de passe"}finally{Oe.value=!1}}}function fh(){Ue.value=!1,Ce.value=null,Xe.value="",Fe.value="",Oe.value=!1}async function Ba(d){if(d){rt.value=!0,_e.value="";try{const h=Se.value.data.player,_=await Lf(o.value);if(d===_){try{ga.saveSession(Se.value.data.player.id,d)}catch{}Y.value=!1;const F=Se.value;Se.value=null,ke.value="",await dn(F);return}if(await verifyPlayerPassword(h.id,d,o.value)){Y.value=!1;const F=Se.value;Se.value=null,ke.value="",await dn(F)}else _e.value="Mot de passe incorrect",setTimeout(()=>{_e.value=""},3e3)}catch(h){console.error("Erreur lors de la vérification du mot de passe:",h),_e.value="Erreur lors de la vérification du mot de passe"}finally{rt.value=!1}}}function qu(){Y.value=!1,Se.value=null,_e.value="",ke.value="",rt.value=!1}async function zu(){K.value=!0,pe.value="",de.value="";try{const d=Se.value.data.player,h=await sendPasswordResetEmail(d.id,o.value);de.value=h.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(d){console.error("Erreur lors de l'envoi de l'email:",d),pe.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{K.value=!1}}async function _o(){qe.value=!0,nt.value="",E.value="";try{const d=Ce.value.data.playerId,h=await sendPasswordResetEmail(d,o.value);E.value=h.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(d){console.error("Erreur lors de l'envoi de l'email:",d),nt.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{qe.value=!1}}function Gu(){return Fn.isPinCached(o.value)?{timeRemaining:Fn.getTimeRemaining(),isExpiringSoon:Fn.isExpiringSoon()}:null}async function dn(d){if(!d)return;const{type:h,data:_}=d;try{switch(h){case"deleteEvent":console.log("executePendingOperation - data.eventId:",_.eventId),console.log("executePendingOperation - type de data.eventId:",typeof _.eventId),c.value=_.eventId,l.value=!0;break;case"addEvent":ys.value=!0;break;case"deletePlayer":go.value=_.playerId,Hn.value=!0;break;case"launchSelection":pt.value[_.eventId]&&pt.value[_.eventId].length>0?(I.value=_.eventId,Z.value=!0,S.value=!1):(await Ma(_.eventId,_.count),S.value=!1);break;case"toggleAvailability":_s(_.player,_.eventId);break;case"toggleArchive":await setEventArchived(_.eventId,_.archived,o.value);{const x=Le.value.findIndex(F=>F.id===_.eventId);x!==-1&&(Le.value[x]={...Le.value[x],archived:!!_.archived}),z.value=!!_.archived}break}}catch(x){console.error("Erreur lors de l'exécution de l'opération:",x),Re.value=!0,Ze.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Re.value=!1},3e3)}}function Ku(){t.push("/")}tp(()=>{const d=On.value;d&&d.removeEventListener("scroll",er),window.removeEventListener("resize",er)});async function Hu(d){V.value=d,H.value=d.description||"",z.value=!!d.archived;try{const[h,_]=await Promise.all([Ro(ze.value,Le.value,o.value),Co(o.value)]);Ft.value=h,pt.value=_}catch(h){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",h)}S.value=!0}function Or(){S.value=!1,V.value=null,H.value="",W.value=!1}function qa(){Or(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function za(d,h){console.log("handleAvailabilityToggle appelé avec:",{playerName:d,eventId:h});const _=ze.value.find(F=>F.name===d);if(!_){console.error("Joueur non trouvé:",d);return}console.log("Joueur trouvé:",_);const x=ci(_.id);if(console.log("Joueur protégé:",x),x){Qo(_.id)?(console.log("Session active, procéder au toggle"),await st(d,h)):(console.log("Demande du mot de passe pour joueur protégé"),ne.value={playerName:d,eventId:h},re.value=_,le.value=!0);return}console.log("Joueur non protégé, procéder au toggle"),await st(d,h)}function bo(d,h){return(pt.value[h]||[]).includes(d)}async function Wu(d){if(console.log("Mot de passe vérifié:",d),re.value&&(X.value=re.value.id,console.log("Joueur marqué comme récemment vérifié:",re.value.id)),ne.value){const{playerName:h,eventId:_}=ne.value;console.log("Exécution de l'action en attente:",{playerName:h,eventId:_}),await st(h,_),ne.value=null}else console.log("Aucune action en attente trouvée");le.value=!1,re.value=null}function gi(){f.value=V.value.id,m.value=V.value.title,v.value=V.value.date,H.value=V.value.description||"",y.value=V.value.playerCount||6,S.value=!1}async function Qu(){if(V.value)try{const d=!V.value.archived,h={...V.value,archived:d};await Ey(V.value.id,h,o.value),V.value.archived=d;const _=Le.value.findIndex(x=>x.id===V.value.id);_!==-1&&(Le.value[_].archived=d),Re.value=!0,Ze.value=d?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{Re.value=!1},3e3)}catch(d){console.error("Erreur lors de la modification de l'archivage:",d),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function Ga(d){T.value=d,w.value=!0;try{typeof ge<"u"&&ge.value}catch{}}function Is(){w.value=!1,T.value=null}async function Ju({playerId:d,newName:h}){try{await updatePlayer(d,h,o.value),await Promise.all([Kh(o.value),Ro(ze.value,Le.value,o.value),Co(o.value)]).then(([_,x,F])=>{if(ze.value=_,Ft.value=x,pt.value=F,di(),T.value&&T.value.id===d){const oe=_.find(te=>te.id===d);oe&&(T.value=oe)}}),Re.value=!0,Ze.value="Joueur mis à jour avec succès !",setTimeout(()=>{Re.value=!1},3e3)}catch(_){console.error("Erreur lors de l'édition du joueur:",_),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function Yu(){try{await Promise.all([Kh(o.value),Ro(ze.value,Le.value,o.value),Co(o.value)]).then(([d,h,_])=>{if(ze.value=d,Ft.value=h,pt.value=_,di(),T.value){const x=d.find(F=>F.id===T.value.id);x&&(T.value=x)}}),Re.value=!0,Ze.value="Données mises à jour !",setTimeout(()=>{Re.value=!1},3e3)}catch(d){console.error("Erreur lors du rafraîchissement:",d)}}function Ka(d){if(!d)return{availability:0,selection:0,ratio:0};const h=Nr(d.name),_=bs(d.name),x=h===0?0:Math.round(_/h*100);return{availability:h,selection:_,ratio:x}}function vi(d){const h=pt.value[d]||[],_=Le.value.find(oe=>oe.id===d),x=(_==null?void 0:_.playerCount)||6,F=Kn(d);if(h.length>0){const oe=h.some(ce=>!Rn(ce,d)),te=F<x;if(oe||te)return{type:"incomplete",hasUnavailablePlayers:oe,hasInsufficientPlayers:te,unavailablePlayers:h.filter(ce=>!Rn(ce,d)),availableCount:F,requiredCount:x}}return F<x?{type:"insufficient",availableCount:F,requiredCount:x}:h.length===0?{type:"ready",availableCount:F,requiredCount:x}:{type:"complete",availableCount:F,requiredCount:x}}function Xu(d){const h=vi(d);return h.type==="incomplete"||h.type==="insufficient"}function yi(d){const h=vi(d);switch(h.type){case"incomplete":return h.hasUnavailablePlayers?h.unavailablePlayers.length===1?`Sélection incomplète : ${h.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${h.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${h.availableCount} joueurs disponibles pour ${h.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${h.availableCount} disponibles pour ${h.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${h.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${h.availableCount} joueurs disponibles`;default:return""}}async function Zu({eventId:d,eventData:h,reason:_}){if(!o.value)return;const x={id:d,...h};if(x.archived){console.log("Événement archivé, aucune notification envoyée:",x.title),Re.value=!0,Ze.value="Aucune notification envoyée : événement archivé",setTimeout(()=>{Re.value=!1},3e3);return}const F=[];for(const oe of ze.value){if(!await Fi(oe.id,o.value))continue;const ce=await xI(oe.id,o.value);if(ce)try{const Pe=await Ff({seasonId:o.value,playerId:oe.id,eventId:x.id,action:"yes"}),$e=await Ff({seasonId:o.value,playerId:oe.id,eventId:x.id,action:"no"}),it=`${Pe.url}&slug=${encodeURIComponent(s)}`,et=`${$e.url}&slug=${encodeURIComponent(s)}`;await SN({toEmail:ce,playerName:oe.name,eventTitle:x.title,eventDate:Fa(x.date),yesUrl:it,noUrl:et,reason:_})}catch(Pe){console.error("Email non envoyé pour",oe.name,(Pe==null?void 0:Pe.message)||Pe),F.push(oe.id)}}Re.value=!0,Ze.value=F.length>0?`Emails envoyés (avec ${F.length} échec(s))`:"Emails envoyés aux joueurs protégés.",setTimeout(()=>{Re.value=!1},3e3)}function wo(d){if(d!=null&&d.archived){Re.value=!0,Ze.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{Re.value=!1},3e3);return}Ha(),Ge.value=d,Me.value=!0}function br(){Me.value=!1,Ge.value=null}function Ha(){Lt.value=!1,xt.value=null}async function Wa({eventId:d,eventData:h,reason:_,selectedPlayers:x}){try{_==="selection"?(await CN({eventId:d,eventData:h,selectedPlayers:x,seasonId:o.value,seasonSlug:s,players:so.value}),Es(),Re.value=!0,Ze.value="Notifications de sélection envoyées avec succès !",setTimeout(()=>{Re.value=!1},3e3)):(await Zu({eventId:d,eventData:h,reason:_}),br(),Re.value=!0,Ze.value="Notifications envoyées avec succès !",setTimeout(()=>{Re.value=!1},3e3))}catch(F){console.error("Erreur lors de l'envoi des notifications:",F),Re.value=!0,Ze.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Re.value=!1},3e3)}}function Qa(d){if(!d)return{};const h={};return ze.value.forEach(_=>{h[_.name]=Rn(_.name,d)}),h}function _i(d){we.value=d,ve.value=!0}function Es(){ve.value=!1,we.value=null}async function Cn(){if(!we.value)return;const d=we.value.id,h=we.value.playerCount||6;if(Kn(d)===0){Re.value=!0,Ze.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Re.value=!1},3e3);return}await _r({type:"launchSelection",data:{eventId:d,count:h}})}function ec(){Es(),Re.value=!0,Ze.value="Sélection validée !",setTimeout(()=>{Re.value=!1},3e3)}async function Io(d,h){if(!d||!h)return;p(),zn.value=d,ro.value=!0,await rn();const _=document.querySelector(`[data-event-id="${d}"]`);if(!_){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(te=>{te.classList.remove("focused-event-highlight")});const x=document.querySelectorAll(`[data-event-id="${d}"]`);x.forEach(te=>{te.classList.add("focused-event-highlight")});const F=x[0],oe=x[x.length-1];F&&F.classList.add("focused-event-column-start"),oe&&oe.classList.add("focused-event-column-end"),await u(_),Re.value=!0,Ze.value=`Événement ciblé : ${h.title}`,setTimeout(()=>{Re.value=!1},4e3),li.value=setTimeout(()=>{p()},8e3)}function Mr(d){if(!d)return;const h=Le.value.find(_=>_.id===d);if(!h){console.warn(`Événement ${d} non trouvé dans la liste des événements`),setTimeout(()=>{const _=Le.value.find(x=>x.id===d);_?Io(d,_):console.error(`Événement ${d} toujours introuvable après retry`)},500);return}Io(d,h)}async function u(d){if(!d)return;if(await new Promise(_=>setTimeout(_,100)),window.innerWidth<=768){const _=On.value;if(_){const x=d.offsetLeft,F=d.offsetWidth,oe=_.clientWidth,te=x-oe/2+F/2,ce=_.scrollWidth-oe,Pe=Math.max(0,Math.min(te,ce));_.scrollTo({left:Pe,behavior:"smooth"}),setTimeout(()=>{const $e=d.getBoundingClientRect();if($e.left<0||$e.right>window.innerWidth){const it=x-20;_.scrollTo({left:Math.max(0,it),behavior:"smooth"})}},500)}}else d.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const h=On.value;h&&setTimeout(()=>{const _=document.querySelector(`[data-event-id="${zn.value}"]`);if(_&&_.closest("tbody")){const x=_.offsetLeft,F=_.offsetWidth,oe=h.clientWidth,te=x-oe/2+F/2,ce=h.scrollWidth-oe,Pe=Math.max(0,Math.min(te,ce));h.scrollTo({left:Pe,behavior:"smooth"})}},300)}function p(){li.value&&(clearTimeout(li.value),li.value=null),zn.value=null,ro.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(d=>{d.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(d=>{d.classList.remove("focused-event-column-start","focused-event-column-end")})}return(d,h)=>{var _,x,F,oe,te,ce,Pe,$e,it,et,Dt,Vt,dt,Lr,Fr,bi,Eo,Vm,Nm;return L(),$(_t,null,[g("div",dM,[g("div",hM,[g("button",{onClick:Ku,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour à l'accueil"},h[62]||(h[62]=[g("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[g("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),g("h1",fM,ae(i.value?i.value:"Chargement..."),1),g("div",pM,[g("button",{onClick:Lu,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:yr.value?"Masquer les événements archivés":"Afficher les événements archivés"},[g("span",gM,ae(yr.value?"📂":"📁"),1)],8,mM),g("button",{onClick:h[0]||(h[0]=G=>cn.value=!0),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Comment ça marche ?","aria-label":"Comment ça marche ?"},h[63]||(h[63]=[g("span",{class:"text-2xl"},"❓",-1)]))])],512),g("div",vM,[g("div",{ref_key:"headerBarRef",ref:ao,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[g("div",yM,[Le.value.length===0&&ze.value.length===0?se("",!0):(L(),$("div",_M,[g("div",{class:"flex items-center justify-center h-full gap-2"},[g("button",{onClick:fo,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},h[64]||(h[64]=[g("span",{class:"text-lg"},"➕",-1),g("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),g("span",{class:"sm:hidden"},"Événement",-1)]))])])),g("div",bM,[g("div",{ref_key:"headerEventsRef",ref:vn,class:"flex relative z-[60]",style:ks({transform:`translateX(-${oo.value}px)`})},[(L(!0),$(_t,null,dr(yn.value,G=>(L(),$("div",{key:"h-"+G.id,"data-event-id":G.id,class:"col-event flex-shrink-0 p-3 text-center cursor-pointer",onClick:_n=>Hu(G)},[g("div",{class:"header-date text-[16px] md:text-base text-gray-300",title:Fa(G.date)},ae(ch(G.date)),9,IM),g("div",{class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2",title:G.title},ae(G.title||"Sans titre"),9,EM),G.archived?(L(),$("div",TM,"(Archivé)")):se("",!0),Xu(G.id)?(L(),$("div",{key:1,class:"mt-1 w-4 h-4 bg-yellow-500 rounded-full mx-auto flex items-center justify-center hover:bg-yellow-400 transition-colors duration-200",title:yi(G.id)+" - Cliquez pour ouvrir la sélection",onClick:Bt(_n=>_i(G),["stop"])},h[65]||(h[65]=[g("span",{class:"text-xs text-white font-bold"},"⚠️",-1)]),8,xM)):vi(G.id).type==="ready"?(L(),$("div",{key:2,class:"mt-1 w-4 h-4 bg-green-500 rounded-full mx-auto flex items-center justify-center hover:bg-green-400 transition-colors duration-200",title:yi(G.id)+" - Cliquez pour ouvrir la sélection",onClick:Bt(_n=>_i(G),["stop"])},h[66]||(h[66]=[g("span",{class:"text-xs text-white font-bold"},"🎲",-1)]),8,AM)):se("",!0)],8,wM))),128))],4)]),h[67]||(h[67]=g("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),ut(g("button",{onClick:h[1]||(h[1]=Bt(G=>Cu(-1,G),["prevent"])),onMousedown:h[2]||(h[2]=Bt(G=>ar(-1,G),["prevent"])),onMouseup:h[3]||(h[3]=G=>lr(G)),onMouseleave:h[4]||(h[4]=G=>lr(G)),onTouchstart:h[5]||(h[5]=Bt(G=>ar(-1,G),["prevent"])),onTouchend:h[6]||(h[6]=G=>lr(G)),onTouchcancel:h[7]||(h[7]=G=>lr(G)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[Ih,io.value]]),ut(g("button",{onClick:h[8]||(h[8]=Bt(G=>Cu(1,G),["prevent"])),onMousedown:h[9]||(h[9]=Bt(G=>ar(1,G),["prevent"])),onMouseup:h[10]||(h[10]=G=>lr(G)),onMouseleave:h[11]||(h[11]=G=>lr(G)),onTouchstart:h[12]||(h[12]=Bt(G=>ar(1,G),["prevent"])),onTouchend:h[13]||(h[13]=G=>lr(G)),onTouchcancel:h[14]||(h[14]=G=>lr(G)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[Ih,gr.value]])])],512),ut(g("div",{ref_key:"gridboardRef",ref:On,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[ge.value===1?(L(),$("div",SM,[M.value.position?(L(),$("div",{key:0,class:"fixed z-[400]",style:ks({left:M.value.position.x+"px",top:M.value.position.y+"px"})},[g("div",PM,[h[69]||(h[69]=g("div",{class:"text-sm font-semibold mb-1"},"Ajoutez votre nom",-1)),h[70]||(h[70]=g("div",{class:"text-xs text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),g("div",RM,[h[68]||(h[68]=g("span",{class:"text-purple-300 text-xs"},"Étape 1/4",-1)),g("button",{onClick:h[15]||(h[15]=G=>La(0)),class:"text-xs text-white/80 hover:text-white"},"Suivant")])])],4)):se("",!0)])):se("",!0),ge.value===2&&U.value&&j.value?(L(),$("div",CM,[q.value.position?(L(),$("div",{key:0,class:"fixed z-[400]",style:ks({position:"absolute",left:q.value.position.x+"px",top:q.value.position.y+"px"})},[g("div",kM,[h[72]||(h[72]=g("div",{class:"text-sm font-semibold mb-1"},"Indiquez vos disponibilités",-1)),h[73]||(h[73]=g("div",{class:"text-xs text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),g("div",DM,[h[71]||(h[71]=g("span",{class:"text-pink-300 text-xs"},"Étape 2/4",-1)),g("button",{onClick:h[16]||(h[16]=G=>La(1)),class:"text-xs text-white/80 hover:text-white"},"Suivant")])])],4)):se("",!0)])):se("",!0),ge.value===3&&U.value?(L(),$("div",VM,[ee.value.position?(L(),$("div",{key:0,class:"fixed z-[400]",style:ks({position:"absolute",left:ee.value.position.x+"px",top:ee.value.position.y+"px"})},[g("div",NM,[h[75]||(h[75]=g("div",{class:"text-sm font-semibold mb-1"},"Ouvrez votre fiche",-1)),h[76]||(h[76]=g("div",{class:"text-xs text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),g("div",OM,[h[74]||(h[74]=g("span",{class:"text-yellow-300 text-xs"},"Étape 3/4",-1)),g("button",{onClick:h[17]||(h[17]=G=>La(2)),class:"text-xs text-white/80 hover:text-white"},"Suivant")])])],4)):se("",!0)])):se("",!0),g("table",MM,[g("colgroup",null,[h[77]||(h[77]=g("col",{class:"col-left"},null,-1)),(L(!0),$(_t,null,dr(yn.value,(G,_n)=>(L(),$("col",{key:"c"+_n,class:"col-event"}))),128)),h[78]||(h[78]=g("col",{class:"col-right"},null,-1))]),h[82]||(h[82]=g("thead",{class:"hidden"},null,-1)),g("tbody",null,[(L(!0),$(_t,null,dr(Gn.value,G=>{var _n;return L(),$("tr",{key:G.id,class:Qn(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":G.id===k.value}]),"data-player-id":G.id},[g("td",FM,[g("div",UM,[ci(G.id)?(L(),$("span",$M," 🔒 ")):se("",!0),g("span",{onClick:Ur=>Ga(G),class:Qn(["player-name hover:border-b-2 hover:border-dashed hover:border-purple-400 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":ge.value===3&&G.id===(U.value||((_n=Gn.value[0])==null?void 0:_n.id))}]),title:"Cliquez pour voir les détails : "+G.name},ae(G.name),11,jM)])]),(L(!0),$(_t,null,dr(yn.value,Ur=>{var Om,Mm,Lm;return L(),$("td",{key:Ur.id,"data-event-id":Ur.id,class:Qn(["p-0",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":ge.value===2&&G.id===(U.value||((Om=Gn.value[0])==null?void 0:Om.id))&&Ur.id===(j.value||((Mm=yn.value[0])==null?void 0:Mm.id))}])},[ht(xy,{"player-name":G.name,"event-id":Ur.id,"is-available":Rn(G.name,Ur.id),"is-selected":pi(G.name,Ur.id),"chance-percent":((Lm=po.value[G.name])==null?void 0:Lm[Ur.id])??null,"show-selected-chance":Ua(Ur.id),onToggle:st},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance"])],10,BM)}),128)),h[79]||(h[79]=g("td",{class:"p-3 md:p-4"},null,-1))],10,LM)}),128)),!(Le.value.length===0&&ze.value.length===0)&&!(Le.value.length>0&&ze.value.length===0)?(L(),$("tr",qM,[g("td",zM,[g("div",GM,[g("button",{onClick:h[18]||(h[18]=G=>C.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},h[80]||(h[80]=[g("span",{class:"text-lg"},"➕",-1),g("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),g("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(L(!0),$(_t,null,dr(yn.value,G=>(L(),$("td",{key:"add-row-"+G.id,"data-event-id":G.id,class:"p-3 md:p-5"},null,8,KM))),128)),h[81]||(h[81]=g("td",{class:"p-3 md:p-4"},null,-1))])):se("",!0)])])],512),[[Ih,!Zn.value]])])]),Zn.value?(L(),$("div",HM,[g("div",WM,[h[83]||(h[83]=g("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[g("span",{class:"text-3xl"},"🎭")],-1)),g("p",QM,ae(Xt.value)+"…",1),g("div",JM,[g("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:ks({width:vt.value+"%"})},null,4)]),g("p",YM,ae(vt.value)+"%",1)])])):se("",!0),Zn.value?se("",!0):(L(),ip(cM,{key:1,"season-id":o.value,"season-slug":Qr(s),"players-count":ze.value.length,"events-count":Le.value.length,"onboarding-done":((_=a.value)==null?void 0:_.onboardingCreatorDone)===!0,onCreateEvent:fo,onAddPlayer:h[19]||(h[19]=()=>{C.value=!0}),onCopyLink:Va,onDismissed:jt},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),se("",!0),Re.value?(L(),$("div",XM,[g("div",ZM,[h[84]||(h[84]=g("span",{class:"text-xl"},"✨",-1)),g("span",null,ae(Ze.value),1)])])):se("",!0),gs.value?(L(),$("div",eL,[g("div",tL,[h[85]||(h[85]=g("span",{class:"text-xl"},"⚠️",-1)),g("span",null,ae(uo.value),1)])])):se("",!0),ys.value?(L(),$("div",nL,[g("div",rL,[h[91]||(h[91]=g("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),g("div",sL,[h[86]||(h[86]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),ut(g("input",{"onUpdate:modelValue":h[20]||(h[20]=G=>tr.value=G),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[St,tr.value]])]),g("div",iL,[h[87]||(h[87]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),ut(g("input",{"onUpdate:modelValue":h[21]||(h[21]=G=>Mn.value=G),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[St,Mn.value]])]),g("div",oL,[h[88]||(h[88]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),ut(g("textarea",{"onUpdate:modelValue":h[22]||(h[22]=G=>Vr.value=G),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[St,Vr.value]])]),g("div",aL,[ut(g("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":h[23]||(h[23]=G=>fi.value=G),class:"w-4 h-4"},null,512),[[hg,fi.value]]),h[89]||(h[89]=g("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),g("div",lL,[h[90]||(h[90]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),ut(g("input",{"onUpdate:modelValue":h[24]||(h[24]=G=>hi.value=G),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[St,hi.value]])]),g("div",{class:"flex justify-end space-x-3"},[g("button",{onClick:Oa,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),g("button",{onClick:Vu,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):se("",!0),C.value?(L(),$("div",uL,[g("div",cL,[h[93]||(h[93]=g("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),g("div",dL,[h[92]||(h[92]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),ut(g("input",{"onUpdate:modelValue":h[25]||(h[25]=G=>A.value=G),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[St,A.value]])]),g("div",hL,[g("button",{onClick:h[26]||(h[26]=G=>C.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),g("button",{onClick:ho,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):se("",!0),l.value?(L(),$("div",fL,[g("div",pL,[h[94]||(h[94]=cr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),g("div",mL,[g("button",{onClick:Du,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),g("button",{onClick:h[27]||(h[27]=()=>ku()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):se("",!0),Hn.value?(L(),$("div",gL,[g("div",vL,[h[95]||(h[95]=cr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),g("div",yL,[g("button",{onClick:hh,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),g("button",{onClick:h[28]||(h[28]=()=>dh()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):se("",!0),Z.value?(L(),$("div",_L,[g("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},[h[96]||(h[96]=cr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🎭</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.</p></div><p class="mb-6 text-sm text-yellow-400 bg-yellow-900/20 p-3 rounded-lg border border-yellow-500/20"> ⚠️ Pensez à prévenir les gens du changement ! </p>',2)),g("div",{class:"flex justify-end space-x-3"},[g("button",{onClick:$u,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),g("button",{onClick:yo,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):se("",!0),S.value?(L(),$("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:Or},[g("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:h[38]||(h[38]=Bt(()=>{},["stop"]))},[g("div",bL,[g("button",{onClick:Or,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),h[97]||(h[97]=g("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[g("span",{class:"text-2xl md:text-3xl"},"🎭")],-1)),g("h2",wL,ae((x=V.value)==null?void 0:x.title),1),g("p",IL,ae(Fa((F=V.value)==null?void 0:F.date)),1)]),g("div",EL,[(oe=V.value)!=null&&oe.description?(L(),$("div",TL,[g("p",xL,ae(V.value.description),1)])):se("",!0),g("div",AL,[g("div",SL,[g("div",PL,ae(Kn((te=V.value)==null?void 0:te.id)),1),h[98]||(h[98]=g("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),g("div",RL,[g("div",CL,ae(mo((ce=V.value)==null?void 0:ce.id)),1),h[99]||(h[99]=g("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),g("div",kL,[g("div",DL,ae(((Pe=V.value)==null?void 0:Pe.playerCount)||6),1),h[100]||(h[100]=g("div",{class:"text-xs md:text-sm text-gray-300"},"À sélectionner",-1))])]),V.value?(L(),$("div",VL,[h[102]||(h[102]=g("h3",{class:"text-lg font-semibold text-white mb-3"},"Disponibilités des joueurs",-1)),g("div",NL,[h[101]||(h[101]=g("div",{class:"grid grid-cols-12 gap-0 bg-gray-700 border-b border-gray-600"},[g("div",{class:"col-span-4 p-3 font-medium text-gray-300"},"Joueur"),g("div",{class:"col-span-8 p-3 font-medium text-gray-300 text-center"},"Disponibilité")],-1)),(L(!0),$(_t,null,dr(Gn.value,G=>{var _n;return L(),$("div",{key:G.id,class:"grid grid-cols-12 gap-0 border-b border-gray-600 last:border-b-0 hover:bg-gray-700/50 transition-colors"},[g("div",OL,[g("span",ML,ae(G.name),1),ci(G.id)?(L(),$("span",LL,"🔒")):se("",!0)]),g("div",FL,[ht(xy,{"player-name":G.name,"event-id":V.value.id,"is-available":Qa(V.value.id)[G.name],"is-selected":bo(G.name,V.value.id),"chance-percent":((_n=po.value[G.name])==null?void 0:_n[V.value.id])??null,"show-selected-chance":Ua(V.value.id),onToggle:za},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance"])])])}),128))])])):se("",!0),g("div",UL,[g("button",{onClick:gi,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},h[103]||(h[103]=[g("span",null,"✏️",-1),g("span",null,"Modifier",-1)])),g("button",{onClick:h[29]||(h[29]=G=>wo(V.value)),disabled:($e=V.value)==null?void 0:$e.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(it=V.value)!=null&&it.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},h[104]||(h[104]=[g("span",null,"📢",-1),g("span",null,"Annoncer",-1)]),8,$L),g("button",{onClick:Qu,class:"px-5 py-3 bg-gradient-to-r from-indigo-500 to-blue-600 text-white rounded-lg hover:from-indigo-600 hover:to-blue-700 transition-all duration-300 flex items-center gap-2",title:(et=V.value)!=null&&et.archived?"Désarchiver cet événement":"Archiver cet événement"},[g("span",null,ae((Dt=V.value)!=null&&Dt.archived?"📂":"📁"),1),g("span",null,ae((Vt=V.value)!=null&&Vt.archived?"Désarchiver":"Archiver"),1)],8,jL),g("button",{onClick:h[30]||(h[30]=G=>_i(V.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},h[105]||(h[105]=[g("span",null,"🎭",-1),g("span",null,"Sélectionner",-1)])),g("button",{onClick:h[31]||(h[31]=G=>{var _n;return co((_n=V.value)==null?void 0:_n.id)}),class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},h[106]||(h[106]=[g("span",null,"🗑️",-1),g("span",null,"Supprimer",-1)])),g("button",{onClick:qa,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")]),W.value?(L(),$("div",BL,[g("button",{onClick:h[32]||(h[32]=G=>{gi(),W.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"},"✏️ Modifier"),g("button",{onClick:h[33]||(h[33]=G=>{wo(V.value),W.value=!1}),disabled:(dt=V.value)==null?void 0:dt.archived,class:"w-full px-4 py-3 rounded-lg bg-amber-600/20 text-amber-200 border border-amber-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(Lr=V.value)!=null&&Lr.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},h[107]||(h[107]=[g("span",null,"📢",-1),g("span",null,"Annoncer",-1)]),8,qL),g("button",{onClick:h[34]||(h[34]=G=>{Qu(),W.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-indigo-600/20 text-indigo-200 border border-indigo-500/30"},ae((Fr=V.value)!=null&&Fr.archived?"📂 Désarchiver":"📁 Archiver"),1),g("button",{onClick:h[35]||(h[35]=G=>{var _n;co((_n=V.value)==null?void 0:_n.id),W.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"},"🗑️ Supprimer")])):se("",!0)]),g("div",zL,[g("button",{onClick:h[36]||(h[36]=G=>_i(V.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),g("button",{onClick:qa,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),g("button",{onClick:h[37]||(h[37]=G=>W.value=!W.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):se("",!0),ht(CI,{show:le.value,player:re.value,seasonId:o.value,onClose:h[39]||(h[39]=G=>le.value=!1),onVerified:Wu},null,8,["show","player","seasonId"]),f.value?(L(),$("div",GL,[g("div",KL,[h[113]||(h[113]=g("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),g("div",HL,[h[108]||(h[108]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),ut(g("input",{"onUpdate:modelValue":h[40]||(h[40]=G=>m.value=G),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[wn(vs,["esc"]),wn(Na,["enter"])],ref:"editTitleInput"},null,544),[[St,m.value]])]),g("div",WL,[h[109]||(h[109]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),ut(g("input",{"onUpdate:modelValue":h[41]||(h[41]=G=>v.value=G),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[wn(vs,["esc"]),wn(Na,["enter"])]},null,544),[[St,v.value]])]),g("div",QL,[h[110]||(h[110]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),ut(g("textarea",{"onUpdate:modelValue":h[42]||(h[42]=G=>H.value=G),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:wn(vs,["esc"])},null,544),[[St,H.value]])]),g("div",JL,[ut(g("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":h[43]||(h[43]=G=>z.value=G),class:"w-4 h-4"},null,512),[[hg,z.value]]),h[111]||(h[111]=g("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),g("div",YL,[h[112]||(h[112]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),ut(g("input",{"onUpdate:modelValue":h[44]||(h[44]=G=>y.value=G),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:wn(vs,["esc"])},null,544),[[St,y.value]])]),g("div",{class:"flex justify-end space-x-3"},[g("button",{onClick:vs,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),g("button",{onClick:Na,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):se("",!0),ht(gI,{show:R.value,message:mi(),error:b.value,"session-info":Gu(),onSubmit:ja,onCancel:At},null,8,["show","message","error","session-info"]),Ue.value?(L(),$("div",XL,[g("div",ZL,[h[115]||(h[115]=cr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),g("div",eF,[g("div",tF,[g("div",null,[h[114]||(h[114]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),ut(g("input",{"onUpdate:modelValue":h[45]||(h[45]=G=>Fe.value=G),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:h[46]||(h[46]=wn(G=>Bu(Fe.value),["enter"])),ref_key:"playerPasswordInputRef",ref:Ae},null,544),[[St,Fe.value]])])]),g("button",{onClick:h[47]||(h[47]=G=>Bu(Fe.value)),disabled:!Fe.value||Oe.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Oe.value?(L(),$("span",rF,"⏳")):(L(),$("span",sF,"🔓")),g("span",null,ae(Oe.value?"Vérification...":"Vérifier et supprimer"),1)],8,nF)]),g("div",iF,[g("button",{onClick:h[48]||(h[48]=G=>be.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),Xe.value?(L(),$("div",oF,[g("div",aF,ae(Xe.value),1)])):se("",!0),g("div",{class:"flex justify-center"},[g("button",{onClick:fh,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):se("",!0),Y.value?(L(),$("div",lF,[g("div",uF,[h[118]||(h[118]=cr('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),g("div",cF,[g("div",dF,[g("div",null,[h[116]||(h[116]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),ut(g("input",{"onUpdate:modelValue":h[49]||(h[49]=G=>ke.value=G),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:h[50]||(h[50]=wn(G=>Ba(ke.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:tn},null,544),[[St,ke.value]])])]),g("div",hF,[g("button",{onClick:h[51]||(h[51]=G=>Mt.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),_e.value?(L(),$("div",fF,[g("div",pF,ae(_e.value),1)])):se("",!0)]),g("div",mF,[g("button",{onClick:qu,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),g("button",{onClick:h[52]||(h[52]=G=>Ba(ke.value)),disabled:!ke.value||rt.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[rt.value?(L(),$("span",vF,"⏳")):(L(),$("span",yF,"🔓")),g("span",null,[Vn(ae(rt.value?"Vérification...":"Vérifier"),1),h[117]||(h[117]=g("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,gF)])])])):se("",!0),Mt.value?(L(),$("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:h[55]||(h[55]=G=>Mt.value=!1)},[g("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:h[54]||(h[54]=Bt(()=>{},["stop"]))},[h[120]||(h[120]=cr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),g("div",_F,[h[119]||(h[119]=g("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),g("button",{onClick:zu,disabled:K.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[K.value?(L(),$("span",wF,"⏳")):(L(),$("span",IF,"📧")),g("span",null,ae(K.value?"Envoi...":"Envoyer l'email"),1)],8,bF)]),pe.value?(L(),$("div",EF,[g("div",TF,ae(pe.value),1)])):se("",!0),de.value?(L(),$("div",xF,[g("div",AF,ae(de.value),1)])):se("",!0),g("div",SF,[g("button",{onClick:h[53]||(h[53]=G=>Mt.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):se("",!0),be.value?(L(),$("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:h[58]||(h[58]=G=>be.value=!1)},[g("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:h[57]||(h[57]=Bt(()=>{},["stop"]))},[h[122]||(h[122]=cr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),g("div",PF,[h[121]||(h[121]=g("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),g("button",{onClick:_o,disabled:qe.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[qe.value?(L(),$("span",CF,"⏳")):(L(),$("span",kF,"📧")),g("span",null,ae(qe.value?"Envoi...":"Envoyer l'email"),1)],8,RF)]),nt.value?(L(),$("div",DF,[g("div",VF,ae(nt.value),1)])):se("",!0),E.value?(L(),$("div",NF,[g("div",OF,ae(E.value),1)])):se("",!0),g("div",MF,[g("button",{onClick:h[56]||(h[56]=G=>be.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):se("",!0),ht(wO,{ref_key:"playerModalRef",ref:P,show:w.value,player:T.value,stats:Ka(T.value),seasonId:o.value,"onboarding-step":ge.value,"onboarding-player-id":U.value,onClose:Is,onUpdate:Ju,onDelete:vo,onRefresh:Yu,onAdvanceOnboarding:h[59]||(h[59]=G=>{try{typeof ge.value<"u"&&(ge.value.value=G)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id"]),ht(YO,{ref_key:"selectionModalRef",ref:xe,show:ve.value,event:we.value,"current-selection":pt.value[(bi=we.value)==null?void 0:bi.id]||[],"available-count":Kn((Eo=we.value)==null?void 0:Eo.id),"selected-count":mo((Vm=we.value)==null?void 0:Vm.id),"player-availability":Qa((Nm=we.value)==null?void 0:Nm.id),"season-id":o.value,"season-slug":Qr(s),players:so.value,onClose:Es,onSelection:Cn,onPerfect:ec,onSendEmailNotifications:Wa},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),ht(RI,{show:Me.value,event:Ge.value,"season-id":o.value,"season-slug":Qr(s),players:so.value,onClose:br,onSendEmailNotifications:Wa},null,8,["show","event","season-id","season-slug","players"]),ht(vI,{show:cn.value,onClose:h[60]||(h[60]=G=>cn.value=!1)},null,8,["show"]),Lt.value?(L(),$("div",LF,[g("div",FF,[h[123]||(h[123]=g("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),h[124]||(h[124]=g("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),g("div",UF,[g("button",{onClick:h[61]||(h[61]=G=>wo(xt.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),g("button",{onClick:Ha,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):se("",!0)],64)}}},$F={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},jF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},BF={key:0,class:"text-center py-8"},qF={key:1,class:"text-center py-8"},zF={class:"text-gray-300 mb-6"},GF={key:2,class:"space-y-6"},KF={class:"text-center"},HF={class:"text-gray-300"},WF={class:"font-semibold text-white"},QF={class:"space-y-4"},JF=["disabled"],YF={key:0,class:"animate-spin"},XF={key:1},ZF={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},e4={class:"text-red-300 text-sm"},t4={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},n4={class:"text-green-300 text-sm"},r4={__name:"PasswordReset",setup(n){const e=su(),t=ru(),r=N(!0),s=N(""),i=N(""),o=N(""),a=N(""),l=N(""),c=N(!1),f=N(""),m=N(""),v=We(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);Ks(async()=>{try{const{oobCode:A}=e.query;if(console.log("🔍 [DEBUG] Token reçu:",A),!A){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=A,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(A){console.error("Erreur lors de la vérification du lien:",A),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function y(){if(v.value){c.value=!0,f.value="",m.value="";try{console.log("🔍 [DEBUG] Début réinitialisation avec token:",o.value),await Sk(no,o.value,a.value),console.log("🔍 [DEBUG] Mot de passe Firebase Auth mis à jour"),console.log("🔍 [DEBUG] Réinitialisation terminée avec Firebase Auth"),m.value="Mot de passe réinitialisé avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{C()},3e3)}catch(A){console.error("❌ [ERROR] Erreur lors de la réinitialisation:",A),A.code==="auth/weak-password"?f.value="Le mot de passe doit contenir au moins 6 caractères":A.code==="auth/invalid-action-code"?f.value="Lien de réinitialisation invalide ou expiré":f.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}function C(){t.push("/")}return(A,k)=>(L(),$("div",$F,[g("div",jF,[k[8]||(k[8]=cr('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(L(),$("div",BF,k[2]||(k[2]=[g("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),g("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(L(),$("div",qF,[k[3]||(k[3]=g("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[g("span",{class:"text-2xl"},"❌")],-1)),k[4]||(k[4]=g("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),g("p",zF,ae(s.value),1),g("button",{onClick:C,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):i.value?(L(),$("div",GF,[g("div",KF,[g("p",HF,[k[5]||(k[5]=Vn("Email : ")),g("span",WF,ae(i.value),1)])]),g("div",QF,[g("div",null,[k[6]||(k[6]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),ut(g("input",{"onUpdate:modelValue":k[0]||(k[0]=U=>a.value=U),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:wn(y,["enter"])},null,544),[[St,a.value]])]),g("div",null,[k[7]||(k[7]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),ut(g("input",{"onUpdate:modelValue":k[1]||(k[1]=U=>l.value=U),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:wn(y,["enter"])},null,544),[[St,l.value]])])]),g("button",{onClick:y,disabled:!v.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(L(),$("span",YF,"⏳")):(L(),$("span",XF,"🔑")),g("span",null,ae(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,JF),f.value?(L(),$("div",ZF,[g("div",e4,ae(f.value),1)])):se("",!0),m.value?(L(),$("div",t4,[g("div",n4,ae(m.value),1)])):se("",!0)])):se("",!0)])]))}},s4={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},i4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},o4={class:"text-3xl"},a4={class:"text-2xl font-bold text-white mb-2"},l4={class:"text-gray-300 mb-6"},u4={__name:"MagicLink",setup(n){const e=su(),t=ru(),r=N("loading"),s=N("Traitement en cours..."),i=N("Merci de patienter pendant la validation du lien."),o=We(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/")}return Ks(async()=>{try{SI("firebase");const l=String(e.query.sid||""),c=String(e.query.pid||"");let f=String(e.query.eid||"");const m=String(e.query.t||""),v=String(e.query.a||""),y=String(e.query.slug||"");if(!l||!c||!m||!v){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(v==="verify_email"&&(f="protection"),!(await bI({seasonId:l,playerId:c,eventId:f,token:m,action:v})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(v==="verify_email"){await EI({playerId:c,seasonId:l}),await Uf({seasonId:l,playerId:c,eventId:"protection",action:v}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(y?()=>t.push(`/season/${y}?player=${encodeURIComponent(c)}&open=protection&verified=1`):()=>t.push("/"),800);return}const A=Ve(me,"seasons",l,"players",c),k=await ds(A),U=k.exists()&&k.data().name||"";if(!U){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}await EN({seasonId:l,playerName:U,eventId:f,value:v==="yes"}),await Uf({seasonId:l,playerId:c,eventId:f,action:v}),r.value="ok",s.value="Merci !",i.value=v==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible.",setTimeout(y?()=>t.push(`/season/${y}/event/${f}`):()=>t.push("/"),1200)}catch(l){console.error("Magic link error:",l),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(L(),$("div",s4,[g("div",i4,[g("div",{class:Qn(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[g("span",o4,ae(o.value),1)],2),g("h1",a4,ae(s.value),1),g("p",l4,ae(i.value),1),g("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},c4={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},d4={class:"text-center py-12 px-4"},h4={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},f4={class:"container mx-auto px-4 pb-16"},p4={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},m4={class:"space-y-5"},g4=["onKeydown"],v4={class:"flex items-center justify-end gap-3 pt-2"},y4=["disabled"],_4={key:0,class:"mt-6 text-sm text-gray-200"},b4={__name:"JoinSeason",setup(n){const e=su(),t=ru(),r=e.params.slug,s=N(""),i=N(""),o=N(""),a=N(!1),l=N("");Ks(async()=>{const m=Kd(Ye(me,"seasons"),am("slug","==",r)),v=await kt(m);if(v.empty)l.value="Saison introuvable";else{const y=v.docs[0];s.value=y.id,i.value=y.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function f(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await PI(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(m){console.error("Erreur inscription:",m),l.value=`Erreur lors de l'inscription: ${(m==null?void 0:m.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(m,v)=>(L(),$("div",c4,[g("div",d4,[g("h1",h4,ae(i.value||"Rejoindre la saison"),1),v[1]||(v[1]=g("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),g("div",f4,[g("div",p4,[v[3]||(v[3]=g("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),g("div",m4,[g("div",null,[v[2]||(v[2]=g("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),ut(g("input",{"onUpdate:modelValue":v[0]||(v[0]=y=>o.value=y),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:wn(Bt(f,["prevent"]),["enter"])},null,40,g4),[[St,o.value]])]),g("div",v4,[g("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),g("button",{disabled:!o.value.trim()||a.value,onClick:f,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,y4)])]),l.value?(L(),$("div",_4,ae(l.value),1)):se("",!0)])])]))}},w4=[{path:"/",component:hN},{path:"/season/:slug",component:Ay,props:!0},{path:"/season/:slug/event/:eventId",component:Ay,props:!0},{path:"/season/:slug/join",component:b4,props:!0},{path:"/reset-password",component:r4},{path:"/magic",component:u4}],I4=tA({history:Cx("/"),routes:w4});JT(ZT).use(I4).mount("#app");export{Ye as $,Iw as A,Wi as B,Rr as C,Ht as D,SU as E,Ji as F,Xp as G,AU as H,S4 as I,sr as J,z1 as K,K1 as L,Yd as M,Z4 as N,eU as O,vC as P,mn as Q,z4 as R,D4 as S,Nt as T,yU as U,jd as V,pC as W,vU as X,X4 as Y,O4 as Z,h0 as _,Gl as a,Au as a$,C4 as a0,G1 as a1,rC as a2,xU as a3,rd as a4,gU as a5,F4 as a6,TU as a7,Ve as a8,B4 as a9,j4 as aA,oU as aB,aU as aC,q4 as aD,tC as aE,hU as aF,fU as aG,hC as aH,Kd as aI,lw as aJ,k4 as aK,mU as aL,Iu as aM,xn as aN,wU as aO,E4 as aP,tU as aQ,W4 as aR,H4 as aS,Y4 as aT,U4 as aU,bu as aV,bU as aW,M4 as aX,am as aY,gC as aZ,VU as a_,W1 as aa,N4 as ab,L4 as ac,EU as ad,J4 as ae,Q4 as af,Ot as ag,wu as ah,iC as ai,lU as aj,ds as ak,nU as al,rU as am,kt as an,sU as ao,iU as ap,H1 as aq,IU as ar,_U as as,V4 as at,G4 as au,K4 as av,$4 as aw,uU as ax,dU as ay,cU as az,Q1 as b,Ik as b$,xu as b0,OU as b1,Yl as b2,eo as b3,Os as b4,RU as b5,Ls as b6,Ms as b7,ss as b8,Rc as b9,CC as bA,o3 as bB,_3 as bC,iy as bD,oD as bE,YC as bF,XU as bG,qU as bH,Ek as bI,c3 as bJ,m3 as bK,y3 as bL,a3 as bM,e3 as bN,Uk as bO,LU as bP,_C as bQ,Tk as bR,d3 as bS,p3 as bT,v3 as bU,VC as bV,s3 as bW,KU as bX,Ak as bY,BU as bZ,YU as b_,DU as ba,Li as bb,Wo as bc,uV as bd,CU as be,l3 as bf,Of as bg,kU as bh,cV as bi,Cm as bj,Fs as bk,$U as bl,$k as bm,Wk as bn,lV as bo,rI as bp,Pk as bq,Sk as br,ZC as bs,Rk as bt,NU as bu,i3 as bv,GU as bw,JU as bx,vV as by,MU as bz,pa as c,_m as c0,UU as c1,Ck as c2,zU as c3,u3 as c4,f3 as c5,g3 as c6,r3 as c7,FU as c8,n3 as c9,QU as ca,Vk as cb,h3 as cc,WU as cd,t3 as ce,ZU as cf,HU as cg,jU as ch,Yi as d,gt as e,J as f,Pa as g,yu as h,Ac as i,Qd as j,_u as k,Hd as l,lm as m,ma as n,Wd as o,Di as p,mC as q,Ut as r,$i as s,fe as t,x4 as u,LS as v,Rt as w,PU as x,Ke as y,T4 as z};
