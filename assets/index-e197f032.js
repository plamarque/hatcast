(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function sp(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const xt={},ta=[],wr=()=>{},JI=()=>!1,Ed=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),ip=n=>n.startsWith("onUpdate:"),bn=Object.assign,op=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},YI=Object.prototype.hasOwnProperty,gt=(n,e)=>YI.call(n,e),Ue=Array.isArray,na=n=>mu(n)==="[object Map]",Td=n=>mu(n)==="[object Set]",Zm=n=>mu(n)==="[object Date]",Ke=n=>typeof n=="function",on=n=>typeof n=="string",Br=n=>typeof n=="symbol",kt=n=>n!==null&&typeof n=="object",qy=n=>(kt(n)||Ke(n))&&Ke(n.then)&&Ke(n.catch),zy=Object.prototype.toString,mu=n=>zy.call(n),XI=n=>mu(n).slice(8,-1),Gy=n=>mu(n)==="[object Object]",ap=n=>on(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Al=sp(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),xd=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},ZI=/-(\w)/g,hr=xd(n=>n.replace(ZI,(e,t)=>t?t.toUpperCase():"")),eE=/\B([A-Z])/g,bi=xd(n=>n.replace(eE,"-$1").toLowerCase()),Ad=xd(n=>n.charAt(0).toUpperCase()+n.slice(1)),Ch=xd(n=>n?`on${Ad(n)}`:""),ii=(n,e)=>!Object.is(n,e),Ac=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},cf=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},df=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let eg;const Sd=()=>eg||(eg=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Js(n){if(Ue(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=on(r)?sE(r):Js(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(on(n)||kt(n))return n}const tE=/;(?![^(]*\))/g,nE=/:([^]+)/,rE=/\/\*[^]*?\*\//g;function sE(n){const e={};return n.replace(rE,"").split(tE).forEach(t=>{if(t){const r=t.split(nE);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function Hn(n){let e="";if(on(n))e=n;else if(Ue(n))for(let t=0;t<n.length;t++){const r=Hn(n[t]);r&&(e+=r+" ")}else if(kt(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const iE="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",oE=sp(iE);function Ky(n){return!!n||n===""}function aE(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=Pd(n[r],e[r]);return t}function Pd(n,e){if(n===e)return!0;let t=Zm(n),r=Zm(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=Br(n),r=Br(e),t||r)return n===e;if(t=Ue(n),r=Ue(e),t||r)return t&&r?aE(n,e):!1;if(t=kt(n),r=kt(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!Pd(n[o],e[o]))return!1}}return String(n)===String(e)}function Hy(n,e){return n.findIndex(t=>Pd(t,e))}const Wy=n=>!!(n&&n.__v_isRef===!0),ce=n=>on(n)?n:n==null?"":Ue(n)||kt(n)&&(n.toString===zy||!Ke(n.toString))?Wy(n)?ce(n.value):JSON.stringify(n,Qy,2):String(n),Qy=(n,e)=>Wy(e)?Qy(n,e.value):na(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[kh(r,i)+" =>"]=s,t),{})}:Td(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>kh(t))}:Br(e)?kh(e):kt(e)&&!Ue(e)&&!Gy(e)?String(e):e,kh=(n,e="")=>{var t;return Br(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Gn;class lE{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Gn,!e&&Gn&&(this.index=(Gn.scopes||(Gn.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Gn;try{return Gn=this,e()}finally{Gn=t}}}on(){++this._on===1&&(this.prevScope=Gn,Gn=this)}off(){this._on>0&&--this._on===0&&(Gn=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function uE(){return Gn}let Rt;const Dh=new WeakSet;class Jy{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Gn&&Gn.active&&Gn.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Dh.has(this)&&(Dh.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Xy(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,tg(this),Zy(this);const e=Rt,t=Ir;Rt=this,Ir=!0;try{return this.fn()}finally{e_(this),Rt=e,Ir=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)cp(e);this.deps=this.depsTail=void 0,tg(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Dh.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){hf(this)&&this.run()}get dirty(){return hf(this)}}let Yy=0,Sl,Pl;function Xy(n,e=!1){if(n.flags|=8,e){n.next=Pl,Pl=n;return}n.next=Sl,Sl=n}function lp(){Yy++}function up(){if(--Yy>0)return;if(Pl){let e=Pl;for(Pl=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Sl;){let e=Sl;for(Sl=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function Zy(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function e_(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),cp(r),cE(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function hf(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(t_(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function t_(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Bl)||(n.globalVersion=Bl,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!hf(n))))return;n.flags|=2;const e=n.dep,t=Rt,r=Ir;Rt=n,Ir=!0;try{Zy(n);const s=n.fn(n._value);(e.version===0||ii(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{Rt=t,Ir=r,e_(n),n.flags&=-3}}function cp(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)cp(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function cE(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let Ir=!0;const n_=[];function ms(){n_.push(Ir),Ir=!1}function gs(){const n=n_.pop();Ir=n===void 0?!0:n}function tg(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Rt;Rt=void 0;try{e()}finally{Rt=t}}}let Bl=0;class dE{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class dp{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Rt||!Ir||Rt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Rt)t=this.activeLink=new dE(Rt,this),Rt.deps?(t.prevDep=Rt.depsTail,Rt.depsTail.nextDep=t,Rt.depsTail=t):Rt.deps=Rt.depsTail=t,r_(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=Rt.depsTail,t.nextDep=void 0,Rt.depsTail.nextDep=t,Rt.depsTail=t,Rt.deps===t&&(Rt.deps=r)}return t}trigger(e){this.version++,Bl++,this.notify(e)}notify(e){lp();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{up()}}}function r_(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)r_(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const ff=new WeakMap,Ji=Symbol(""),pf=Symbol(""),ql=Symbol("");function kn(n,e,t){if(Ir&&Rt){let r=ff.get(n);r||ff.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new dp),s.map=r,s.key=t),s.track()}}function as(n,e,t,r,s,i){const o=ff.get(n);if(!o){Bl++;return}const a=l=>{l&&l.trigger()};if(lp(),e==="clear")o.forEach(a);else{const l=Ue(n),c=l&&ap(t);if(l&&t==="length"){const d=Number(r);o.forEach((f,v)=>{(v==="length"||v===ql||!Br(v)&&v>=d)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(ql)),e){case"add":l?c&&a(o.get("length")):(a(o.get(Ji)),na(n)&&a(o.get(pf)));break;case"delete":l||(a(o.get(Ji)),na(n)&&a(o.get(pf)));break;case"set":na(n)&&a(o.get(Ji));break}}up()}function Bo(n){const e=mt(n);return e===n?e:(kn(e,"iterate",ql),dr(n)?e:e.map(In))}function Rd(n){return kn(n=mt(n),"iterate",ql),n}const hE={__proto__:null,[Symbol.iterator](){return Vh(this,Symbol.iterator,In)},concat(...n){return Bo(this).concat(...n.map(e=>Ue(e)?Bo(e):e))},entries(){return Vh(this,"entries",n=>(n[1]=In(n[1]),n))},every(n,e){return ss(this,"every",n,e,void 0,arguments)},filter(n,e){return ss(this,"filter",n,e,t=>t.map(In),arguments)},find(n,e){return ss(this,"find",n,e,In,arguments)},findIndex(n,e){return ss(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return ss(this,"findLast",n,e,In,arguments)},findLastIndex(n,e){return ss(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return ss(this,"forEach",n,e,void 0,arguments)},includes(...n){return Nh(this,"includes",n)},indexOf(...n){return Nh(this,"indexOf",n)},join(n){return Bo(this).join(n)},lastIndexOf(...n){return Nh(this,"lastIndexOf",n)},map(n,e){return ss(this,"map",n,e,void 0,arguments)},pop(){return ll(this,"pop")},push(...n){return ll(this,"push",n)},reduce(n,...e){return ng(this,"reduce",n,e)},reduceRight(n,...e){return ng(this,"reduceRight",n,e)},shift(){return ll(this,"shift")},some(n,e){return ss(this,"some",n,e,void 0,arguments)},splice(...n){return ll(this,"splice",n)},toReversed(){return Bo(this).toReversed()},toSorted(n){return Bo(this).toSorted(n)},toSpliced(...n){return Bo(this).toSpliced(...n)},unshift(...n){return ll(this,"unshift",n)},values(){return Vh(this,"values",In)}};function Vh(n,e,t){const r=Rd(n),s=r[e]();return r!==n&&!dr(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const fE=Array.prototype;function ss(n,e,t,r,s,i){const o=Rd(n),a=o!==n&&!dr(n),l=o[e];if(l!==fE[e]){const f=l.apply(n,i);return a?In(f):f}let c=t;o!==n&&(a?c=function(f,v){return t.call(this,In(f),v,n)}:t.length>2&&(c=function(f,v){return t.call(this,f,v,n)}));const d=l.call(o,c,r);return a&&s?s(d):d}function ng(n,e,t,r){const s=Rd(n);let i=t;return s!==n&&(dr(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,In(a),l,n)}),s[e](i,...r)}function Nh(n,e,t){const r=mt(n);kn(r,"iterate",ql);const s=r[e](...t);return(s===-1||s===!1)&&pp(t[0])?(t[0]=mt(t[0]),r[e](...t)):s}function ll(n,e,t=[]){ms(),lp();const r=mt(n)[e].apply(n,t);return up(),gs(),r}const pE=sp("__proto__,__v_isRef,__isVue"),s_=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Br));function mE(n){Br(n)||(n=String(n));const e=mt(this);return kn(e,"has",n),e.hasOwnProperty(n)}class i_{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?xE:u_:i?l_:a_).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=Ue(e);if(!s){let l;if(o&&(l=hE[t]))return l;if(t==="hasOwnProperty")return mE}const a=Reflect.get(e,t,Nn(e)?e:r);return(Br(t)?s_.has(t):pE(t))||(s||kn(e,"get",t),i)?a:Nn(a)?o&&ap(t)?a:a.value:kt(a)?s?d_(a):Cd(a):a}}class o_ extends i_{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=ci(i);if(!dr(r)&&!ci(r)&&(i=mt(i),r=mt(r)),!Ue(e)&&Nn(i)&&!Nn(r))return l?!1:(i.value=r,!0)}const o=Ue(e)&&ap(t)?Number(t)<e.length:gt(e,t),a=Reflect.set(e,t,r,Nn(e)?e:s);return e===mt(s)&&(o?ii(r,i)&&as(e,"set",t,r):as(e,"add",t,r)),a}deleteProperty(e,t){const r=gt(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&as(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!Br(t)||!s_.has(t))&&kn(e,"has",t),r}ownKeys(e){return kn(e,"iterate",Ue(e)?"length":Ji),Reflect.ownKeys(e)}}class gE extends i_{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const vE=new o_,yE=new gE,_E=new o_(!0);const mf=n=>n,fc=n=>Reflect.getPrototypeOf(n);function bE(n,e,t){return function(...r){const s=this.__v_raw,i=mt(s),o=na(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),d=t?mf:e?Gc:In;return!e&&kn(i,"iterate",l?pf:Ji),{next(){const{value:f,done:v}=c.next();return v?{value:f,done:v}:{value:a?[d(f[0]),d(f[1])]:d(f),done:v}},[Symbol.iterator](){return this}}}}function pc(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function wE(n,e){const t={get(s){const i=this.__v_raw,o=mt(i),a=mt(s);n||(ii(s,a)&&kn(o,"get",s),kn(o,"get",a));const{has:l}=fc(o),c=e?mf:n?Gc:In;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&kn(mt(s),"iterate",Ji),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=mt(i),a=mt(s);return n||(ii(s,a)&&kn(o,"has",s),kn(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=mt(a),c=e?mf:n?Gc:In;return!n&&kn(l,"iterate",Ji),a.forEach((d,f)=>s.call(i,c(d),c(f),o))}};return bn(t,n?{add:pc("add"),set:pc("set"),delete:pc("delete"),clear:pc("clear")}:{add(s){!e&&!dr(s)&&!ci(s)&&(s=mt(s));const i=mt(this);return fc(i).has.call(i,s)||(i.add(s),as(i,"add",s,s)),this},set(s,i){!e&&!dr(i)&&!ci(i)&&(i=mt(i));const o=mt(this),{has:a,get:l}=fc(o);let c=a.call(o,s);c||(s=mt(s),c=a.call(o,s));const d=l.call(o,s);return o.set(s,i),c?ii(i,d)&&as(o,"set",s,i):as(o,"add",s,i),this},delete(s){const i=mt(this),{has:o,get:a}=fc(i);let l=o.call(i,s);l||(s=mt(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&as(i,"delete",s,void 0),c},clear(){const s=mt(this),i=s.size!==0,o=s.clear();return i&&as(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=bE(s,n,e)}),t}function hp(n,e){const t=wE(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(gt(t,s)&&s in r?t:r,s,i)}const IE={get:hp(!1,!1)},EE={get:hp(!1,!0)},TE={get:hp(!0,!1)};const a_=new WeakMap,l_=new WeakMap,u_=new WeakMap,xE=new WeakMap;function AE(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function SE(n){return n.__v_skip||!Object.isExtensible(n)?0:AE(XI(n))}function Cd(n){return ci(n)?n:fp(n,!1,vE,IE,a_)}function c_(n){return fp(n,!1,_E,EE,l_)}function d_(n){return fp(n,!0,yE,TE,u_)}function fp(n,e,t,r,s){if(!kt(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=SE(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function ra(n){return ci(n)?ra(n.__v_raw):!!(n&&n.__v_isReactive)}function ci(n){return!!(n&&n.__v_isReadonly)}function dr(n){return!!(n&&n.__v_isShallow)}function pp(n){return n?!!n.__v_raw:!1}function mt(n){const e=n&&n.__v_raw;return e?mt(e):n}function PE(n){return!gt(n,"__v_skip")&&Object.isExtensible(n)&&cf(n,"__v_skip",!0),n}const In=n=>kt(n)?Cd(n):n,Gc=n=>kt(n)?d_(n):n;function Nn(n){return n?n.__v_isRef===!0:!1}function O(n){return h_(n,!1)}function RE(n){return h_(n,!0)}function h_(n,e){return Nn(n)?n:new CE(n,e)}class CE{constructor(e,t){this.dep=new dp,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:mt(e),this._value=t?e:In(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||dr(e)||ci(e);e=r?e:mt(e),ii(e,t)&&(this._rawValue=e,this._value=r?e:In(e),this.dep.trigger())}}function fs(n){return Nn(n)?n.value:n}const kE={get:(n,e,t)=>e==="__v_raw"?n:fs(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return Nn(s)&&!Nn(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function f_(n){return ra(n)?n:new Proxy(n,kE)}class DE{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new dp(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Bl-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Rt!==this)return Xy(this,!0),!0}get value(){const e=this.dep.track();return t_(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function VE(n,e,t=!1){let r,s;return Ke(n)?r=n:(r=n.get,s=n.set),new DE(r,s,t)}const mc={},Kc=new WeakMap;let $i;function NE(n,e=!1,t=$i){if(t){let r=Kc.get(t);r||Kc.set(t,r=[]),r.push(n)}}function OE(n,e,t=xt){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=G=>s?G:dr(G)||s===!1||s===0?ls(G,1):ls(G);let d,f,v,y,P=!1,A=!1;if(Nn(n)?(f=()=>n.value,P=dr(n)):ra(n)?(f=()=>c(n),P=!0):Ue(n)?(A=!0,P=n.some(G=>ra(G)||dr(G)),f=()=>n.map(G=>{if(Nn(G))return G.value;if(ra(G))return c(G);if(Ke(G))return l?l(G,2):G()})):Ke(n)?e?f=l?()=>l(n,2):n:f=()=>{if(v){ms();try{v()}finally{gs()}}const G=$i;$i=d;try{return l?l(n,3,[y]):n(y)}finally{$i=G}}:f=wr,e&&s){const G=f,oe=s===!0?1/0:s;f=()=>ls(G(),oe)}const R=uE(),j=()=>{d.stop(),R&&R.active&&op(R.effects,d)};if(i&&e){const G=e;e=(...oe)=>{G(...oe),j()}}let B=A?new Array(n.length).fill(mc):mc;const F=G=>{if(!(!(d.flags&1)||!d.dirty&&!G))if(e){const oe=d.run();if(s||P||(A?oe.some((ie,I)=>ii(ie,B[I])):ii(oe,B))){v&&v();const ie=$i;$i=d;try{const I=[oe,B===mc?void 0:A&&B[0]===mc?[]:B,y];B=oe,l?l(e,3,I):e(...I)}finally{$i=ie}}}else d.run()};return a&&a(F),d=new Jy(f),d.scheduler=o?()=>o(F,!1):F,y=G=>NE(G,!1,d),v=d.onStop=()=>{const G=Kc.get(d);if(G){if(l)l(G,4);else for(const oe of G)oe();Kc.delete(d)}},e?r?F(!0):B=d.run():o?o(F.bind(null,!0),!0):d.run(),j.pause=d.pause.bind(d),j.resume=d.resume.bind(d),j.stop=j,j}function ls(n,e=1/0,t){if(e<=0||!kt(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,Nn(n))ls(n.value,e,t);else if(Ue(n))for(let r=0;r<n.length;r++)ls(n[r],e,t);else if(Td(n)||na(n))n.forEach(r=>{ls(r,e,t)});else if(Gy(n)){for(const r in n)ls(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&ls(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function gu(n,e,t,r){try{return r?n(...r):n()}catch(s){kd(s,e,t)}}function qr(n,e,t,r){if(Ke(n)){const s=gu(n,e,t,r);return s&&qy(s)&&s.catch(i=>{kd(i,e,t)}),s}if(Ue(n)){const s=[];for(let i=0;i<n.length;i++)s.push(qr(n[i],e,t,r));return s}}function kd(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||xt;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const d=a.ec;if(d){for(let f=0;f<d.length;f++)if(d[f](n,l,c)===!1)return}a=a.parent}if(i){ms(),gu(i,null,10,[n,l,c]),gs();return}}ME(n,t,s,r,o)}function ME(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const $n=[];let Dr=-1;const sa=[];let Hs=null,Qo=0;const p_=Promise.resolve();let Hc=null;function cn(n){const e=Hc||p_;return n?e.then(this?n.bind(this):n):e}function LE(n){let e=Dr+1,t=$n.length;for(;e<t;){const r=e+t>>>1,s=$n[r],i=zl(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function mp(n){if(!(n.flags&1)){const e=zl(n),t=$n[$n.length-1];!t||!(n.flags&2)&&e>=zl(t)?$n.push(n):$n.splice(LE(e),0,n),n.flags|=1,m_()}}function m_(){Hc||(Hc=p_.then(v_))}function FE(n){Ue(n)?sa.push(...n):Hs&&n.id===-1?Hs.splice(Qo+1,0,n):n.flags&1||(sa.push(n),n.flags|=1),m_()}function rg(n,e,t=Dr+1){for(;t<$n.length;t++){const r=$n[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;$n.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function g_(n){if(sa.length){const e=[...new Set(sa)].sort((t,r)=>zl(t)-zl(r));if(sa.length=0,Hs){Hs.push(...e);return}for(Hs=e,Qo=0;Qo<Hs.length;Qo++){const t=Hs[Qo];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Hs=null,Qo=0}}const zl=n=>n.id==null?n.flags&2?-1:1/0:n.id;function v_(n){const e=wr;try{for(Dr=0;Dr<$n.length;Dr++){const t=$n[Dr];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),gu(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;Dr<$n.length;Dr++){const t=$n[Dr];t&&(t.flags&=-2)}Dr=-1,$n.length=0,g_(),Hc=null,($n.length||sa.length)&&v_()}}let tr=null,y_=null;function Wc(n){const e=tr;return tr=n,y_=n&&n.type.__scopeId||null,e}function UE(n,e=tr,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&hg(-1);const i=Wc(e);let o;try{o=n(...s)}finally{Wc(i),r._d&&hg(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function yt(n,e){if(tr===null)return n;const t=Od(tr),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=xt]=e[s];i&&(Ke(i)&&(i={mounted:i,updated:i}),i.deep&&ls(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function Li(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(ms(),qr(l,t,8,[n.el,a,n,e]),gs())}}const $E=Symbol("_vte"),jE=n=>n.__isTeleport;function gp(n,e){n.shapeFlag&6&&n.component?(n.transition=e,gp(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function __(n,e){return Ke(n)?(()=>bn({name:n.name},e,{setup:n}))():n}function b_(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function Rl(n,e,t,r,s=!1){if(Ue(n)){n.forEach((P,A)=>Rl(P,e&&(Ue(e)?e[A]:e),t,r,s));return}if(Cl(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&Rl(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?Od(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,d=a.refs===xt?a.refs={}:a.refs,f=a.setupState,v=mt(f),y=f===xt?()=>!1:P=>gt(v,P);if(c!=null&&c!==l&&(on(c)?(d[c]=null,y(c)&&(f[c]=null)):Nn(c)&&(c.value=null)),Ke(l))gu(l,a,12,[o,d]);else{const P=on(l),A=Nn(l);if(P||A){const R=()=>{if(n.f){const j=P?y(l)?f[l]:d[l]:l.value;s?Ue(j)&&op(j,i):Ue(j)?j.includes(i)||j.push(i):P?(d[l]=[i],y(l)&&(f[l]=d[l])):(l.value=[i],n.k&&(d[n.k]=l.value))}else P?(d[l]=o,y(l)&&(f[l]=o)):A&&(l.value=o,n.k&&(d[n.k]=o))};o?(R.id=-1,er(R,t)):R()}}}Sd().requestIdleCallback;Sd().cancelIdleCallback;const Cl=n=>!!n.type.__asyncLoader,w_=n=>n.type.__isKeepAlive;function BE(n,e){I_(n,"a",e)}function qE(n,e){I_(n,"da",e)}function I_(n,e,t=Dn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(Dd(e,r,t),t){let s=t.parent;for(;s&&s.parent;)w_(s.parent.vnode)&&zE(r,e,t,s),s=s.parent}}function zE(n,e,t,r){const s=Dd(e,n,r,!0);kl(()=>{op(r[e],s)},t)}function Dd(n,e,t=Dn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{ms();const a=vu(t),l=qr(e,t,n,o);return a(),gs(),l});return r?s.unshift(i):s.push(i),i}}const Es=n=>(e,t=Dn)=>{(!Kl||n==="sp")&&Dd(n,(...r)=>e(...r),t)},GE=Es("bm"),Or=Es("m"),KE=Es("bu"),HE=Es("u"),WE=Es("bum"),kl=Es("um"),QE=Es("sp"),JE=Es("rtg"),YE=Es("rtc");function XE(n,e=Dn){Dd("ec",n,e)}const E_="components";function ZE(n,e){return tT(E_,n,!0,e)||n}const eT=Symbol.for("v-ndc");function tT(n,e,t=!0,r=!1){const s=tr||Dn;if(s){const i=s.type;if(n===E_){const a=jT(i,!1);if(a&&(a===e||a===hr(e)||a===Ad(hr(e))))return i}const o=sg(s[n]||i[n],e)||sg(s.appContext[n],e);return!o&&r?i:o}}function sg(n,e){return n&&(n[e]||n[hr(e)]||n[Ad(hr(e))])}function cr(n,e,t,r){let s;const i=t&&t[r],o=Ue(n);if(o||on(n)){const a=o&&ra(n);let l=!1,c=!1;a&&(l=!dr(n),c=ci(n),n=Rd(n)),s=new Array(n.length);for(let d=0,f=n.length;d<f;d++)s[d]=e(l?c?Gc(In(n[d])):In(n[d]):n[d],d,void 0,i&&i[d])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(kt(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const d=a[l];s[l]=e(n[d],d,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}const gf=n=>n?B_(n)?Od(n):gf(n.parent):null,Dl=bn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>gf(n.parent),$root:n=>gf(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>vp(n),$forceUpdate:n=>n.f||(n.f=()=>{mp(n.update)}),$nextTick:n=>n.n||(n.n=cn.bind(n.proxy)),$watch:n=>IT.bind(n)}),Oh=(n,e)=>n!==xt&&!n.__isScriptSetup&&gt(n,e),nT={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const y=o[e];if(y!==void 0)switch(y){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(Oh(r,e))return o[e]=1,r[e];if(s!==xt&&gt(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&gt(c,e))return o[e]=3,i[e];if(t!==xt&&gt(t,e))return o[e]=4,t[e];vf&&(o[e]=0)}}const d=Dl[e];let f,v;if(d)return e==="$attrs"&&kn(n.attrs,"get",""),d(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==xt&&gt(t,e))return o[e]=4,t[e];if(v=l.config.globalProperties,gt(v,e))return v[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return Oh(s,e)?(s[e]=t,!0):r!==xt&&gt(r,e)?(r[e]=t,!0):gt(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==xt&&gt(n,o)||Oh(e,o)||(a=i[0])&&gt(a,o)||gt(r,o)||gt(Dl,o)||gt(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:gt(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function ig(n){return Ue(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let vf=!0;function rT(n){const e=vp(n),t=n.proxy,r=n.ctx;vf=!1,e.beforeCreate&&og(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:d,beforeMount:f,mounted:v,beforeUpdate:y,updated:P,activated:A,deactivated:R,beforeDestroy:j,beforeUnmount:B,destroyed:F,unmounted:G,render:oe,renderTracked:ie,renderTriggered:I,errorCaptured:E,serverPrefetch:x,expose:k,inheritAttrs:V,components:D,directives:w,filters:He}=e;if(c&&sT(c,r,null),o)for(const $e in o){const je=o[$e];Ke(je)&&(r[$e]=je.bind(t))}if(s){const $e=s.call(t,t);kt($e)&&(n.data=Cd($e))}if(vf=!0,i)for(const $e in i){const je=i[$e],ke=Ke(je)?je.bind(t,t):Ke(je.get)?je.get.bind(t,t):wr,ee=!Ke(je)&&Ke(je.set)?je.set.bind(t):wr,De=Qe({get:ke,set:ee});Object.defineProperty(r,$e,{enumerable:!0,configurable:!0,get:()=>De.value,set:H=>De.value=H})}if(a)for(const $e in a)T_(a[$e],r,t,$e);if(l){const $e=Ke(l)?l.call(t):l;Reflect.ownKeys($e).forEach(je=>{Sc(je,$e[je])})}d&&og(d,n,"c");function Xe($e,je){Ue(je)?je.forEach(ke=>$e(ke.bind(t))):je&&$e(je.bind(t))}if(Xe(GE,f),Xe(Or,v),Xe(KE,y),Xe(HE,P),Xe(BE,A),Xe(qE,R),Xe(XE,E),Xe(YE,ie),Xe(JE,I),Xe(WE,B),Xe(kl,G),Xe(QE,x),Ue(k))if(k.length){const $e=n.exposed||(n.exposed={});k.forEach(je=>{Object.defineProperty($e,je,{get:()=>t[je],set:ke=>t[je]=ke})})}else n.exposed||(n.exposed={});oe&&n.render===wr&&(n.render=oe),V!=null&&(n.inheritAttrs=V),D&&(n.components=D),w&&(n.directives=w),x&&b_(n)}function sT(n,e,t=wr){Ue(n)&&(n=yf(n));for(const r in n){const s=n[r];let i;kt(s)?"default"in s?i=Er(s.from||r,s.default,!0):i=Er(s.from||r):i=Er(s),Nn(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function og(n,e,t){qr(Ue(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function T_(n,e,t,r){let s=r.includes(".")?L_(t,r):()=>t[r];if(on(n)){const i=e[n];Ke(i)&&Yt(s,i)}else if(Ke(n))Yt(s,n.bind(t));else if(kt(n))if(Ue(n))n.forEach(i=>T_(i,e,t,r));else{const i=Ke(n.handler)?n.handler.bind(t):e[n.handler];Ke(i)&&Yt(s,i,n)}}function vp(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>Qc(l,c,o,!0)),Qc(l,e,o)),kt(e)&&i.set(e,l),l}function Qc(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&Qc(n,i,t,!0),s&&s.forEach(o=>Qc(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=iT[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const iT={data:ag,props:lg,emits:lg,methods:yl,computed:yl,beforeCreate:Un,created:Un,beforeMount:Un,mounted:Un,beforeUpdate:Un,updated:Un,beforeDestroy:Un,beforeUnmount:Un,destroyed:Un,unmounted:Un,activated:Un,deactivated:Un,errorCaptured:Un,serverPrefetch:Un,components:yl,directives:yl,watch:aT,provide:ag,inject:oT};function ag(n,e){return e?n?function(){return bn(Ke(n)?n.call(this,this):n,Ke(e)?e.call(this,this):e)}:e:n}function oT(n,e){return yl(yf(n),yf(e))}function yf(n){if(Ue(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Un(n,e){return n?[...new Set([].concat(n,e))]:e}function yl(n,e){return n?bn(Object.create(null),n,e):e}function lg(n,e){return n?Ue(n)&&Ue(e)?[...new Set([...n,...e])]:bn(Object.create(null),ig(n),ig(e??{})):e}function aT(n,e){if(!n)return e;if(!e)return n;const t=bn(Object.create(null),n);for(const r in e)t[r]=Un(n[r],e[r]);return t}function x_(){return{app:null,config:{isNativeTag:JI,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let lT=0;function uT(n,e){return function(r,s=null){Ke(r)||(r=bn({},r)),s!=null&&!kt(s)&&(s=null);const i=x_(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:lT++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:qT,get config(){return i.config},set config(d){},use(d,...f){return o.has(d)||(d&&Ke(d.install)?(o.add(d),d.install(c,...f)):Ke(d)&&(o.add(d),d(c,...f))),c},mixin(d){return i.mixins.includes(d)||i.mixins.push(d),c},component(d,f){return f?(i.components[d]=f,c):i.components[d]},directive(d,f){return f?(i.directives[d]=f,c):i.directives[d]},mount(d,f,v){if(!l){const y=c._ceVNode||wt(r,s);return y.appContext=i,v===!0?v="svg":v===!1&&(v=void 0),f&&e?e(y,d):n(y,d,v),l=!0,c._container=d,d.__vue_app__=c,Od(y.component)}},onUnmount(d){a.push(d)},unmount(){l&&(qr(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(d,f){return i.provides[d]=f,c},runWithContext(d){const f=ia;ia=c;try{return d()}finally{ia=f}}};return c}}let ia=null;function Sc(n,e){if(Dn){let t=Dn.provides;const r=Dn.parent&&Dn.parent.provides;r===t&&(t=Dn.provides=Object.create(r)),t[n]=e}}function Er(n,e,t=!1){const r=Dn||tr;if(r||ia){let s=ia?ia._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&Ke(e)?e.call(r&&r.proxy):e}}const A_={},S_=()=>Object.create(A_),P_=n=>Object.getPrototypeOf(n)===A_;function cT(n,e,t,r=!1){const s={},i=S_();n.propsDefaults=Object.create(null),R_(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:c_(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function dT(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=mt(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const d=n.vnode.dynamicProps;for(let f=0;f<d.length;f++){let v=d[f];if(Vd(n.emitsOptions,v))continue;const y=e[v];if(l)if(gt(i,v))y!==i[v]&&(i[v]=y,c=!0);else{const P=hr(v);s[P]=_f(l,a,P,y,n,!1)}else y!==i[v]&&(i[v]=y,c=!0)}}}else{R_(n,e,s,i)&&(c=!0);let d;for(const f in a)(!e||!gt(e,f)&&((d=bi(f))===f||!gt(e,d)))&&(l?t&&(t[f]!==void 0||t[d]!==void 0)&&(s[f]=_f(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!gt(e,f))&&(delete i[f],c=!0)}c&&as(n.attrs,"set","")}function R_(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(Al(l))continue;const c=e[l];let d;s&&gt(s,d=hr(l))?!i||!i.includes(d)?t[d]=c:(a||(a={}))[d]=c:Vd(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=mt(t),c=a||xt;for(let d=0;d<i.length;d++){const f=i[d];t[f]=_f(s,l,f,c[f],n,!gt(c,f))}}return o}function _f(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=gt(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&Ke(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const d=vu(s);r=c[t]=l.call(null,e),d()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===bi(t))&&(r=!0))}return r}const hT=new WeakMap;function C_(n,e,t=!1){const r=t?hT:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!Ke(n)){const d=f=>{l=!0;const[v,y]=C_(f,e,!0);bn(o,v),y&&a.push(...y)};!t&&e.mixins.length&&e.mixins.forEach(d),n.extends&&d(n.extends),n.mixins&&n.mixins.forEach(d)}if(!i&&!l)return kt(n)&&r.set(n,ta),ta;if(Ue(i))for(let d=0;d<i.length;d++){const f=hr(i[d]);ug(f)&&(o[f]=xt)}else if(i)for(const d in i){const f=hr(d);if(ug(f)){const v=i[d],y=o[f]=Ue(v)||Ke(v)?{type:v}:bn({},v),P=y.type;let A=!1,R=!0;if(Ue(P))for(let j=0;j<P.length;++j){const B=P[j],F=Ke(B)&&B.name;if(F==="Boolean"){A=!0;break}else F==="String"&&(R=!1)}else A=Ke(P)&&P.name==="Boolean";y[0]=A,y[1]=R,(A||gt(y,"default"))&&a.push(f)}}const c=[o,a];return kt(n)&&r.set(n,c),c}function ug(n){return n[0]!=="$"&&!Al(n)}const yp=n=>n[0]==="_"||n==="$stable",_p=n=>Ue(n)?n.map(Nr):[Nr(n)],fT=(n,e,t)=>{if(e._n)return e;const r=UE((...s)=>_p(e(...s)),t);return r._c=!1,r},k_=(n,e,t)=>{const r=n._ctx;for(const s in n){if(yp(s))continue;const i=n[s];if(Ke(i))e[s]=fT(s,i,r);else if(i!=null){const o=_p(i);e[s]=()=>o}}},D_=(n,e)=>{const t=_p(e);n.slots.default=()=>t},V_=(n,e,t)=>{for(const r in e)(t||!yp(r))&&(n[r]=e[r])},pT=(n,e,t)=>{const r=n.slots=S_();if(n.vnode.shapeFlag&32){const s=e.__;s&&cf(r,"__",s,!0);const i=e._;i?(V_(r,e,t),t&&cf(r,"_",i,!0)):k_(e,r)}else e&&D_(n,e)},mT=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=xt;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:V_(s,e,t):(i=!e.$stable,k_(e,s)),o=e}else e&&(D_(n,e),o={default:1});if(i)for(const a in s)!yp(a)&&o[a]==null&&delete s[a]},er=RT;function gT(n){return vT(n)}function vT(n,e){const t=Sd();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:d,parentNode:f,nextSibling:v,setScopeId:y=wr,insertStaticContent:P}=n,A=(T,S,N,X=null,Q=null,Z=null,ge=void 0,ue=null,ae=!!S.dynamicChildren)=>{if(T===S)return;T&&!ul(T,S)&&(X=K(T),H(T,Q,Z,!0),T=null),S.patchFlag===-2&&(ae=!1,S.dynamicChildren=null);const{type:se,ref:Ee,shapeFlag:_e}=S;switch(se){case Nd:R(T,S,N,X);break;case di:j(T,S,N,X);break;case Pc:T==null&&B(S,N,X,ge);break;case At:D(T,S,N,X,Q,Z,ge,ue,ae);break;default:_e&1?oe(T,S,N,X,Q,Z,ge,ue,ae):_e&6?w(T,S,N,X,Q,Z,ge,ue,ae):(_e&64||_e&128)&&se.process(T,S,N,X,Q,Z,ge,ue,ae,Ae)}Ee!=null&&Q?Rl(Ee,T&&T.ref,Z,S||T,!S):Ee==null&&T&&T.ref!=null&&Rl(T.ref,null,Z,T,!0)},R=(T,S,N,X)=>{if(T==null)r(S.el=a(S.children),N,X);else{const Q=S.el=T.el;S.children!==T.children&&c(Q,S.children)}},j=(T,S,N,X)=>{T==null?r(S.el=l(S.children||""),N,X):S.el=T.el},B=(T,S,N,X)=>{[T.el,T.anchor]=P(T.children,S,N,X,T.el,T.anchor)},F=({el:T,anchor:S},N,X)=>{let Q;for(;T&&T!==S;)Q=v(T),r(T,N,X),T=Q;r(S,N,X)},G=({el:T,anchor:S})=>{let N;for(;T&&T!==S;)N=v(T),s(T),T=N;s(S)},oe=(T,S,N,X,Q,Z,ge,ue,ae)=>{S.type==="svg"?ge="svg":S.type==="math"&&(ge="mathml"),T==null?ie(S,N,X,Q,Z,ge,ue,ae):x(T,S,Q,Z,ge,ue,ae)},ie=(T,S,N,X,Q,Z,ge,ue)=>{let ae,se;const{props:Ee,shapeFlag:_e,transition:Te,dirs:Pe}=T;if(ae=T.el=o(T.type,Z,Ee&&Ee.is,Ee),_e&8?d(ae,T.children):_e&16&&E(T.children,ae,null,X,Q,Mh(T,Z),ge,ue),Pe&&Li(T,null,X,"created"),I(ae,T,T.scopeId,ge,X),Ee){for(const qe in Ee)qe!=="value"&&!Al(qe)&&i(ae,qe,null,Ee[qe],Z,X);"value"in Ee&&i(ae,"value",null,Ee.value,Z),(se=Ee.onVnodeBeforeMount)&&kr(se,X,T)}Pe&&Li(T,null,X,"beforeMount");const Ne=yT(Q,Te);Ne&&Te.beforeEnter(ae),r(ae,S,N),((se=Ee&&Ee.onVnodeMounted)||Ne||Pe)&&er(()=>{se&&kr(se,X,T),Ne&&Te.enter(ae),Pe&&Li(T,null,X,"mounted")},Q)},I=(T,S,N,X,Q)=>{if(N&&y(T,N),X)for(let Z=0;Z<X.length;Z++)y(T,X[Z]);if(Q){let Z=Q.subTree;if(S===Z||U_(Z.type)&&(Z.ssContent===S||Z.ssFallback===S)){const ge=Q.vnode;I(T,ge,ge.scopeId,ge.slotScopeIds,Q.parent)}}},E=(T,S,N,X,Q,Z,ge,ue,ae=0)=>{for(let se=ae;se<T.length;se++){const Ee=T[se]=ue?Ws(T[se]):Nr(T[se]);A(null,Ee,S,N,X,Q,Z,ge,ue)}},x=(T,S,N,X,Q,Z,ge)=>{const ue=S.el=T.el;let{patchFlag:ae,dynamicChildren:se,dirs:Ee}=S;ae|=T.patchFlag&16;const _e=T.props||xt,Te=S.props||xt;let Pe;if(N&&Fi(N,!1),(Pe=Te.onVnodeBeforeUpdate)&&kr(Pe,N,S,T),Ee&&Li(S,T,N,"beforeUpdate"),N&&Fi(N,!0),(_e.innerHTML&&Te.innerHTML==null||_e.textContent&&Te.textContent==null)&&d(ue,""),se?k(T.dynamicChildren,se,ue,N,X,Mh(S,Q),Z):ge||je(T,S,ue,null,N,X,Mh(S,Q),Z,!1),ae>0){if(ae&16)V(ue,_e,Te,N,Q);else if(ae&2&&_e.class!==Te.class&&i(ue,"class",null,Te.class,Q),ae&4&&i(ue,"style",_e.style,Te.style,Q),ae&8){const Ne=S.dynamicProps;for(let qe=0;qe<Ne.length;qe++){const tt=Ne[qe],Gt=_e[tt],Ft=Te[tt];(Ft!==Gt||tt==="value")&&i(ue,tt,Gt,Ft,Q,N)}}ae&1&&T.children!==S.children&&d(ue,S.children)}else!ge&&se==null&&V(ue,_e,Te,N,Q);((Pe=Te.onVnodeUpdated)||Ee)&&er(()=>{Pe&&kr(Pe,N,S,T),Ee&&Li(S,T,N,"updated")},X)},k=(T,S,N,X,Q,Z,ge)=>{for(let ue=0;ue<S.length;ue++){const ae=T[ue],se=S[ue],Ee=ae.el&&(ae.type===At||!ul(ae,se)||ae.shapeFlag&198)?f(ae.el):N;A(ae,se,Ee,null,X,Q,Z,ge,!0)}},V=(T,S,N,X,Q)=>{if(S!==N){if(S!==xt)for(const Z in S)!Al(Z)&&!(Z in N)&&i(T,Z,S[Z],null,Q,X);for(const Z in N){if(Al(Z))continue;const ge=N[Z],ue=S[Z];ge!==ue&&Z!=="value"&&i(T,Z,ue,ge,Q,X)}"value"in N&&i(T,"value",S.value,N.value,Q)}},D=(T,S,N,X,Q,Z,ge,ue,ae)=>{const se=S.el=T?T.el:a(""),Ee=S.anchor=T?T.anchor:a("");let{patchFlag:_e,dynamicChildren:Te,slotScopeIds:Pe}=S;Pe&&(ue=ue?ue.concat(Pe):Pe),T==null?(r(se,N,X),r(Ee,N,X),E(S.children||[],N,Ee,Q,Z,ge,ue,ae)):_e>0&&_e&64&&Te&&T.dynamicChildren?(k(T.dynamicChildren,Te,N,Q,Z,ge,ue),(S.key!=null||Q&&S===Q.subTree)&&N_(T,S,!0)):je(T,S,N,Ee,Q,Z,ge,ue,ae)},w=(T,S,N,X,Q,Z,ge,ue,ae)=>{S.slotScopeIds=ue,T==null?S.shapeFlag&512?Q.ctx.activate(S,N,X,ge,ae):He(S,N,X,Q,Z,ge,ae):We(T,S,ae)},He=(T,S,N,X,Q,Z,ge)=>{const ue=T.component=MT(T,X,Q);if(w_(T)&&(ue.ctx.renderer=Ae),LT(ue,!1,ge),ue.asyncDep){if(Q&&Q.registerDep(ue,Xe,ge),!T.el){const ae=ue.subTree=wt(di);j(null,ae,S,N)}}else Xe(ue,T,S,N,Q,Z,ge)},We=(T,S,N)=>{const X=S.component=T.component;if(ST(T,S,N))if(X.asyncDep&&!X.asyncResolved){$e(X,S,N);return}else X.next=S,X.update();else S.el=T.el,X.vnode=S},Xe=(T,S,N,X,Q,Z,ge)=>{const ue=()=>{if(T.isMounted){let{next:_e,bu:Te,u:Pe,parent:Ne,vnode:qe}=T;{const Jt=O_(T);if(Jt){_e&&(_e.el=qe.el,$e(T,_e,ge)),Jt.asyncDep.then(()=>{T.isUnmounted||ue()});return}}let tt=_e,Gt;Fi(T,!1),_e?(_e.el=qe.el,$e(T,_e,ge)):_e=qe,Te&&Ac(Te),(Gt=_e.props&&_e.props.onVnodeBeforeUpdate)&&kr(Gt,Ne,_e,qe),Fi(T,!0);const Ft=Lh(T),fn=T.subTree;T.subTree=Ft,A(fn,Ft,f(fn.el),K(fn),T,Q,Z),_e.el=Ft.el,tt===null&&PT(T,Ft.el),Pe&&er(Pe,Q),(Gt=_e.props&&_e.props.onVnodeUpdated)&&er(()=>kr(Gt,Ne,_e,qe),Q)}else{let _e;const{el:Te,props:Pe}=S,{bm:Ne,m:qe,parent:tt,root:Gt,type:Ft}=T,fn=Cl(S);if(Fi(T,!1),Ne&&Ac(Ne),!fn&&(_e=Pe&&Pe.onVnodeBeforeMount)&&kr(_e,tt,S),Fi(T,!0),Te&&ht){const Jt=()=>{T.subTree=Lh(T),ht(Te,T.subTree,T,Q,null)};fn&&Ft.__asyncHydrate?Ft.__asyncHydrate(Te,T,Jt):Jt()}else{Gt.ce&&Gt.ce._def.shadowRoot!==!1&&Gt.ce._injectChildStyle(Ft);const Jt=T.subTree=Lh(T);A(null,Jt,N,X,T,Q,Z),S.el=Jt.el}if(qe&&er(qe,Q),!fn&&(_e=Pe&&Pe.onVnodeMounted)){const Jt=S;er(()=>kr(_e,tt,Jt),Q)}(S.shapeFlag&256||tt&&Cl(tt.vnode)&&tt.vnode.shapeFlag&256)&&T.a&&er(T.a,Q),T.isMounted=!0,S=N=X=null}};T.scope.on();const ae=T.effect=new Jy(ue);T.scope.off();const se=T.update=ae.run.bind(ae),Ee=T.job=ae.runIfDirty.bind(ae);Ee.i=T,Ee.id=T.uid,ae.scheduler=()=>mp(Ee),Fi(T,!0),se()},$e=(T,S,N)=>{S.component=T;const X=T.vnode.props;T.vnode=S,T.next=null,dT(T,S.props,X,N),mT(T,S.children,N),ms(),rg(T),gs()},je=(T,S,N,X,Q,Z,ge,ue,ae=!1)=>{const se=T&&T.children,Ee=T?T.shapeFlag:0,_e=S.children,{patchFlag:Te,shapeFlag:Pe}=S;if(Te>0){if(Te&128){ee(se,_e,N,X,Q,Z,ge,ue,ae);return}else if(Te&256){ke(se,_e,N,X,Q,Z,ge,ue,ae);return}}Pe&8?(Ee&16&&nt(se,Q,Z),_e!==se&&d(N,_e)):Ee&16?Pe&16?ee(se,_e,N,X,Q,Z,ge,ue,ae):nt(se,Q,Z,!0):(Ee&8&&d(N,""),Pe&16&&E(_e,N,X,Q,Z,ge,ue,ae))},ke=(T,S,N,X,Q,Z,ge,ue,ae)=>{T=T||ta,S=S||ta;const se=T.length,Ee=S.length,_e=Math.min(se,Ee);let Te;for(Te=0;Te<_e;Te++){const Pe=S[Te]=ae?Ws(S[Te]):Nr(S[Te]);A(T[Te],Pe,N,null,Q,Z,ge,ue,ae)}se>Ee?nt(T,Q,Z,!0,!1,_e):E(S,N,X,Q,Z,ge,ue,ae,_e)},ee=(T,S,N,X,Q,Z,ge,ue,ae)=>{let se=0;const Ee=S.length;let _e=T.length-1,Te=Ee-1;for(;se<=_e&&se<=Te;){const Pe=T[se],Ne=S[se]=ae?Ws(S[se]):Nr(S[se]);if(ul(Pe,Ne))A(Pe,Ne,N,null,Q,Z,ge,ue,ae);else break;se++}for(;se<=_e&&se<=Te;){const Pe=T[_e],Ne=S[Te]=ae?Ws(S[Te]):Nr(S[Te]);if(ul(Pe,Ne))A(Pe,Ne,N,null,Q,Z,ge,ue,ae);else break;_e--,Te--}if(se>_e){if(se<=Te){const Pe=Te+1,Ne=Pe<Ee?S[Pe].el:X;for(;se<=Te;)A(null,S[se]=ae?Ws(S[se]):Nr(S[se]),N,Ne,Q,Z,ge,ue,ae),se++}}else if(se>Te)for(;se<=_e;)H(T[se],Q,Z,!0),se++;else{const Pe=se,Ne=se,qe=new Map;for(se=Ne;se<=Te;se++){const Pt=S[se]=ae?Ws(S[se]):Nr(S[se]);Pt.key!=null&&qe.set(Pt.key,se)}let tt,Gt=0;const Ft=Te-Ne+1;let fn=!1,Jt=0;const xn=new Array(Ft);for(se=0;se<Ft;se++)xn[se]=0;for(se=Pe;se<=_e;se++){const Pt=T[se];if(Gt>=Ft){H(Pt,Q,Z,!0);continue}let an;if(Pt.key!=null)an=qe.get(Pt.key);else for(tt=Ne;tt<=Te;tt++)if(xn[tt-Ne]===0&&ul(Pt,S[tt])){an=tt;break}an===void 0?H(Pt,Q,Z,!0):(xn[an-Ne]=se+1,an>=Jt?Jt=an:fn=!0,A(Pt,S[an],N,null,Q,Z,ge,ue,ae),Gt++)}const sr=fn?_T(xn):ta;for(tt=sr.length-1,se=Ft-1;se>=0;se--){const Pt=Ne+se,an=S[Pt],Xn=Pt+1<Ee?S[Pt+1].el:X;xn[se]===0?A(null,an,N,Xn,Q,Z,ge,ue,ae):fn&&(tt<0||se!==sr[tt]?De(an,N,Xn,2):tt--)}}},De=(T,S,N,X,Q=null)=>{const{el:Z,type:ge,transition:ue,children:ae,shapeFlag:se}=T;if(se&6){De(T.component.subTree,S,N,X);return}if(se&128){T.suspense.move(S,N,X);return}if(se&64){ge.move(T,S,N,Ae);return}if(ge===At){r(Z,S,N);for(let _e=0;_e<ae.length;_e++)De(ae[_e],S,N,X);r(T.anchor,S,N);return}if(ge===Pc){F(T,S,N);return}if(X!==2&&se&1&&ue)if(X===0)ue.beforeEnter(Z),r(Z,S,N),er(()=>ue.enter(Z),Q);else{const{leave:_e,delayLeave:Te,afterLeave:Pe}=ue,Ne=()=>{T.ctx.isUnmounted?s(Z):r(Z,S,N)},qe=()=>{_e(Z,()=>{Ne(),Pe&&Pe()})};Te?Te(Z,Ne,qe):qe()}else r(Z,S,N)},H=(T,S,N,X=!1,Q=!1)=>{const{type:Z,props:ge,ref:ue,children:ae,dynamicChildren:se,shapeFlag:Ee,patchFlag:_e,dirs:Te,cacheIndex:Pe}=T;if(_e===-2&&(Q=!1),ue!=null&&(ms(),Rl(ue,null,N,T,!0),gs()),Pe!=null&&(S.renderCache[Pe]=void 0),Ee&256){S.ctx.deactivate(T);return}const Ne=Ee&1&&Te,qe=!Cl(T);let tt;if(qe&&(tt=ge&&ge.onVnodeBeforeUnmount)&&kr(tt,S,T),Ee&6)Ze(T.component,N,X);else{if(Ee&128){T.suspense.unmount(N,X);return}Ne&&Li(T,null,S,"beforeUnmount"),Ee&64?T.type.remove(T,S,N,Ae,X):se&&!se.hasOnce&&(Z!==At||_e>0&&_e&64)?nt(se,S,N,!1,!0):(Z===At&&_e&384||!Q&&Ee&16)&&nt(ae,S,N),X&&Y(T)}(qe&&(tt=ge&&ge.onVnodeUnmounted)||Ne)&&er(()=>{tt&&kr(tt,S,T),Ne&&Li(T,null,S,"unmounted")},N)},Y=T=>{const{type:S,el:N,anchor:X,transition:Q}=T;if(S===At){Ve(N,X);return}if(S===Pc){G(T);return}const Z=()=>{s(N),Q&&!Q.persisted&&Q.afterLeave&&Q.afterLeave()};if(T.shapeFlag&1&&Q&&!Q.persisted){const{leave:ge,delayLeave:ue}=Q,ae=()=>ge(N,Z);ue?ue(T.el,Z,ae):ae()}else Z()},Ve=(T,S)=>{let N;for(;T!==S;)N=v(T),s(T),T=N;s(S)},Ze=(T,S,N)=>{const{bum:X,scope:Q,job:Z,subTree:ge,um:ue,m:ae,a:se,parent:Ee,slots:{__:_e}}=T;cg(ae),cg(se),X&&Ac(X),Ee&&Ue(_e)&&_e.forEach(Te=>{Ee.renderCache[Te]=void 0}),Q.stop(),Z&&(Z.flags|=8,H(ge,T,S,N)),ue&&er(ue,S),er(()=>{T.isUnmounted=!0},S),S&&S.pendingBranch&&!S.isUnmounted&&T.asyncDep&&!T.asyncResolved&&T.suspenseId===S.pendingId&&(S.deps--,S.deps===0&&S.resolve())},nt=(T,S,N,X=!1,Q=!1,Z=0)=>{for(let ge=Z;ge<T.length;ge++)H(T[ge],S,N,X,Q)},K=T=>{if(T.shapeFlag&6)return K(T.component.subTree);if(T.shapeFlag&128)return T.suspense.next();const S=v(T.anchor||T.el),N=S&&S[$E];return N?v(N):S};let ye=!1;const le=(T,S,N)=>{T==null?S._vnode&&H(S._vnode,null,null,!0):A(S._vnode||null,T,S,null,null,null,N),S._vnode=T,ye||(ye=!0,rg(),g_(),ye=!1)},Ae={p:A,um:H,m:De,r:Y,mt:He,mc:E,pc:je,pbc:k,n:K,o:n};let Ye,ht;return e&&([Ye,ht]=e(Ae)),{render:le,hydrate:Ye,createApp:uT(le,Ye)}}function Mh({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Fi({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function yT(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function N_(n,e,t=!1){const r=n.children,s=e.children;if(Ue(r)&&Ue(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=Ws(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&N_(o,a)),a.type===Nd&&(a.el=o.el),a.type===di&&!a.el&&(a.el=o.el)}}function _T(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function O_(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:O_(e)}function cg(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const bT=Symbol.for("v-scx"),wT=()=>Er(bT);function Yt(n,e,t){return M_(n,e,t)}function M_(n,e,t=xt){const{immediate:r,deep:s,flush:i,once:o}=t,a=bn({},t),l=e&&r||!e&&i!=="post";let c;if(Kl){if(i==="sync"){const y=wT();c=y.__watcherHandles||(y.__watcherHandles=[])}else if(!l){const y=()=>{};return y.stop=wr,y.resume=wr,y.pause=wr,y}}const d=Dn;a.call=(y,P,A)=>qr(y,d,P,A);let f=!1;i==="post"?a.scheduler=y=>{er(y,d&&d.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(y,P)=>{P?y():mp(y)}),a.augmentJob=y=>{e&&(y.flags|=4),f&&(y.flags|=2,d&&(y.id=d.uid,y.i=d))};const v=OE(n,e,a);return Kl&&(c?c.push(v):l&&v()),v}function IT(n,e,t){const r=this.proxy,s=on(n)?n.includes(".")?L_(r,n):()=>r[n]:n.bind(r,r);let i;Ke(e)?i=e:(i=e.handler,t=e);const o=vu(this),a=M_(s,i.bind(r),t);return o(),a}function L_(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const ET=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${hr(e)}Modifiers`]||n[`${bi(e)}Modifiers`];function TT(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||xt;let s=t;const i=e.startsWith("update:"),o=i&&ET(r,e.slice(7));o&&(o.trim&&(s=t.map(d=>on(d)?d.trim():d)),o.number&&(s=t.map(df)));let a,l=r[a=Ch(e)]||r[a=Ch(hr(e))];!l&&i&&(l=r[a=Ch(bi(e))]),l&&qr(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,qr(c,n,6,s)}}function F_(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!Ke(n)){const l=c=>{const d=F_(c,e,!0);d&&(a=!0,bn(o,d))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(kt(n)&&r.set(n,null),null):(Ue(i)?i.forEach(l=>o[l]=null):bn(o,i),kt(n)&&r.set(n,o),o)}function Vd(n,e){return!n||!Ed(e)?!1:(e=e.slice(2).replace(/Once$/,""),gt(n,e[0].toLowerCase()+e.slice(1))||gt(n,bi(e))||gt(n,e))}function Lh(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:d,props:f,data:v,setupState:y,ctx:P,inheritAttrs:A}=n,R=Wc(n);let j,B;try{if(t.shapeFlag&4){const G=s||r,oe=G;j=Nr(c.call(oe,G,d,f,y,v,P)),B=a}else{const G=e;j=Nr(G.length>1?G(f,{attrs:a,slots:o,emit:l}):G(f,null)),B=e.props?a:xT(a)}}catch(G){Vl.length=0,kd(G,n,1),j=wt(di)}let F=j;if(B&&A!==!1){const G=Object.keys(B),{shapeFlag:oe}=F;G.length&&oe&7&&(i&&G.some(ip)&&(B=AT(B,i)),F=pa(F,B,!1,!0))}return t.dirs&&(F=pa(F,null,!1,!0),F.dirs=F.dirs?F.dirs.concat(t.dirs):t.dirs),t.transition&&gp(F,t.transition),j=F,Wc(R),j}const xT=n=>{let e;for(const t in n)(t==="class"||t==="style"||Ed(t))&&((e||(e={}))[t]=n[t]);return e},AT=(n,e)=>{const t={};for(const r in n)(!ip(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function ST(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?dg(r,o,c):!!o;if(l&8){const d=e.dynamicProps;for(let f=0;f<d.length;f++){const v=d[f];if(o[v]!==r[v]&&!Vd(c,v))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?dg(r,o,c):!0:!!o;return!1}function dg(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!Vd(t,i))return!0}return!1}function PT({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const U_=n=>n.__isSuspense;function RT(n,e){e&&e.pendingBranch?Ue(n)?e.effects.push(...n):e.effects.push(n):FE(n)}const At=Symbol.for("v-fgt"),Nd=Symbol.for("v-txt"),di=Symbol.for("v-cmt"),Pc=Symbol.for("v-stc"),Vl=[];let nr=null;function U(n=!1){Vl.push(nr=n?null:[])}function CT(){Vl.pop(),nr=Vl[Vl.length-1]||null}let Gl=1;function hg(n,e=!1){Gl+=n,n<0&&nr&&e&&(nr.hasOnce=!0)}function $_(n){return n.dynamicChildren=Gl>0?nr||ta:null,CT(),Gl>0&&nr&&nr.push(n),n}function $(n,e,t,r,s,i){return $_(p(n,e,t,r,s,i,!0))}function bp(n,e,t,r,s){return $_(wt(n,e,t,r,s,!0))}function Jc(n){return n?n.__v_isVNode===!0:!1}function ul(n,e){return n.type===e.type&&n.key===e.key}const j_=({key:n})=>n??null,Rc=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?on(n)||Nn(n)||Ke(n)?{i:tr,r:n,k:e,f:!!t}:n:null);function p(n,e=null,t=null,r=0,s=null,i=n===At?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&j_(e),ref:e&&Rc(e),scopeId:y_,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:tr};return a?(wp(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=on(t)?8:16),Gl>0&&!o&&nr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&nr.push(l),l}const wt=kT;function kT(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===eT)&&(n=di),Jc(n)){const a=pa(n,e,!0);return t&&wp(a,t),Gl>0&&!i&&nr&&(a.shapeFlag&6?nr[nr.indexOf(n)]=a:nr.push(a)),a.patchFlag=-2,a}if(BT(n)&&(n=n.__vccOpts),e){e=DT(e);let{class:a,style:l}=e;a&&!on(a)&&(e.class=Hn(a)),kt(l)&&(pp(l)&&!Ue(l)&&(l=bn({},l)),e.style=Js(l))}const o=on(n)?1:U_(n)?128:jE(n)?64:kt(n)?4:Ke(n)?2:0;return p(n,e,t,r,s,o,i,!0)}function DT(n){return n?pp(n)||P_(n)?bn({},n):n:null}function pa(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?VT(s||{},e):s,d={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&j_(c),ref:e&&e.ref?t&&i?Ue(i)?i.concat(Rc(e)):[i,Rc(e)]:Rc(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==At?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&pa(n.ssContent),ssFallback:n.ssFallback&&pa(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&gp(d,l.clone(d)),d}function Vr(n=" ",e=0){return wt(Nd,null,n,e)}function ur(n,e){const t=wt(Pc,null,n);return t.staticCount=e,t}function fe(n="",e=!1){return e?(U(),bp(di,null,n)):wt(di,null,n)}function Nr(n){return n==null||typeof n=="boolean"?wt(di):Ue(n)?wt(At,null,n.slice()):Jc(n)?Ws(n):wt(Nd,null,String(n))}function Ws(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:pa(n)}function wp(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(Ue(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),wp(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!P_(e)?e._ctx=tr:s===3&&tr&&(tr.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Ke(e)?(e={default:e,_ctx:tr},t=32):(e=String(e),r&64?(t=16,e=[Vr(e)]):t=8);n.children=e,n.shapeFlag|=t}function VT(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=Hn([e.class,r.class]));else if(s==="style")e.style=Js([e.style,r.style]);else if(Ed(s)){const i=e[s],o=r[s];o&&i!==o&&!(Ue(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function kr(n,e,t,r=null){qr(n,e,7,[t,r])}const NT=x_();let OT=0;function MT(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||NT,i={uid:OT++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new lE(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:C_(r,s),emitsOptions:F_(r,s),emit:null,emitted:null,propsDefaults:xt,inheritAttrs:r.inheritAttrs,ctx:xt,data:xt,props:xt,attrs:xt,slots:xt,refs:xt,setupState:xt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=TT.bind(null,i),n.ce&&n.ce(i),i}let Dn=null,Yc,bf;{const n=Sd(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};Yc=e("__VUE_INSTANCE_SETTERS__",t=>Dn=t),bf=e("__VUE_SSR_SETTERS__",t=>Kl=t)}const vu=n=>{const e=Dn;return Yc(n),n.scope.on(),()=>{n.scope.off(),Yc(e)}},fg=()=>{Dn&&Dn.scope.off(),Yc(null)};function B_(n){return n.vnode.shapeFlag&4}let Kl=!1;function LT(n,e=!1,t=!1){e&&bf(e);const{props:r,children:s}=n.vnode,i=B_(n);cT(n,r,i,e),pT(n,s,t||e);const o=i?FT(n,e):void 0;return e&&bf(!1),o}function FT(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,nT);const{setup:r}=t;if(r){ms();const s=n.setupContext=r.length>1?$T(n):null,i=vu(n),o=gu(r,n,0,[n.props,s]),a=qy(o);if(gs(),i(),(a||n.sp)&&!Cl(n)&&b_(n),a){if(o.then(fg,fg),e)return o.then(l=>{pg(n,l,e)}).catch(l=>{kd(l,n,0)});n.asyncDep=o}else pg(n,o,e)}else q_(n,e)}function pg(n,e,t){Ke(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:kt(e)&&(n.setupState=f_(e)),q_(n,t)}let mg;function q_(n,e,t){const r=n.type;if(!n.render){if(!e&&mg&&!r.render){const s=r.template||vp(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=bn(bn({isCustomElement:i,delimiters:a},o),l);r.render=mg(s,c)}}n.render=r.render||wr}{const s=vu(n);ms();try{rT(n)}finally{gs(),s()}}}const UT={get(n,e){return kn(n,"get",""),n[e]}};function $T(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,UT),slots:n.slots,emit:n.emit,expose:e}}function Od(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(f_(PE(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in Dl)return Dl[t](n)},has(e,t){return t in e||t in Dl}})):n.proxy}function jT(n,e=!0){return Ke(n)?n.displayName||n.name:n.name||e&&n.__name}function BT(n){return Ke(n)&&"__vccOpts"in n}const Qe=(n,e)=>VE(n,e,Kl);function z_(n,e,t){const r=arguments.length;return r===2?kt(e)&&!Ue(e)?Jc(e)?wt(n,null,[e]):wt(n,e):wt(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&Jc(t)&&(t=[t]),wt(n,e,t))}const qT="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let wf;const gg=typeof window<"u"&&window.trustedTypes;if(gg)try{wf=gg.createPolicy("vue",{createHTML:n=>n})}catch{}const G_=wf?n=>wf.createHTML(n):n=>n,zT="http://www.w3.org/2000/svg",GT="http://www.w3.org/1998/Math/MathML",os=typeof document<"u"?document:null,vg=os&&os.createElement("template"),KT={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?os.createElementNS(zT,n):e==="mathml"?os.createElementNS(GT,n):t?os.createElement(n,{is:t}):os.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>os.createTextNode(n),createComment:n=>os.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>os.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{vg.innerHTML=G_(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=vg.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},HT=Symbol("_vtc");function WT(n,e,t){const r=n[HT];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const Xc=Symbol("_vod"),K_=Symbol("_vsh"),Fh={beforeMount(n,{value:e},{transition:t}){n[Xc]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):cl(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),cl(n,!0),r.enter(n)):r.leave(n,()=>{cl(n,!1)}):cl(n,e))},beforeUnmount(n,{value:e}){cl(n,e)}};function cl(n,e){n.style.display=e?n[Xc]:"none",n[K_]=!e}const QT=Symbol(""),JT=/(^|;)\s*display\s*:/;function YT(n,e,t){const r=n.style,s=on(t);let i=!1;if(t&&!s){if(e)if(on(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&Cc(r,a,"")}else for(const o in e)t[o]==null&&Cc(r,o,"");for(const o in t)o==="display"&&(i=!0),Cc(r,o,t[o])}else if(s){if(e!==t){const o=r[QT];o&&(t+=";"+o),r.cssText=t,i=JT.test(t)}}else e&&n.removeAttribute("style");Xc in n&&(n[Xc]=i?r.display:"",n[K_]&&(r.display="none"))}const yg=/\s*!important$/;function Cc(n,e,t){if(Ue(t))t.forEach(r=>Cc(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=XT(n,e);yg.test(t)?n.setProperty(bi(r),t.replace(yg,""),"important"):n[r]=t}}const _g=["Webkit","Moz","ms"],Uh={};function XT(n,e){const t=Uh[e];if(t)return t;let r=hr(e);if(r!=="filter"&&r in n)return Uh[e]=r;r=Ad(r);for(let s=0;s<_g.length;s++){const i=_g[s]+r;if(i in n)return Uh[e]=i}return e}const bg="http://www.w3.org/1999/xlink";function wg(n,e,t,r,s,i=oE(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(bg,e.slice(6,e.length)):n.setAttributeNS(bg,e,t):t==null||i&&!Ky(t)?n.removeAttribute(e):n.setAttribute(e,i?"":Br(t)?String(t):t)}function Ig(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?G_(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=Ky(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function qi(n,e,t,r){n.addEventListener(e,t,r)}function ZT(n,e,t,r){n.removeEventListener(e,t,r)}const Eg=Symbol("_vei");function ex(n,e,t,r,s=null){const i=n[Eg]||(n[Eg]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=tx(e);if(r){const c=i[e]=sx(r,s);qi(n,a,c,l)}else o&&(ZT(n,a,o,l),i[e]=void 0)}}const Tg=/(?:Once|Passive|Capture)$/;function tx(n){let e;if(Tg.test(n)){e={};let r;for(;r=n.match(Tg);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):bi(n.slice(2)),e]}let $h=0;const nx=Promise.resolve(),rx=()=>$h||(nx.then(()=>$h=0),$h=Date.now());function sx(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;qr(ix(r,t.value),e,5,[r])};return t.value=n,t.attached=rx(),t}function ix(n,e){if(Ue(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const xg=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,ox=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?WT(n,r,o):e==="style"?YT(n,t,r):Ed(e)?ip(e)||ex(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):ax(n,e,r,o))?(Ig(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&wg(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!on(r))?Ig(n,hr(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),wg(n,e,r,o))};function ax(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&xg(e)&&Ke(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return xg(e)&&on(t)?!1:e in n}const Zc=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Ue(e)?t=>Ac(e,t):e};function lx(n){n.target.composing=!0}function Ag(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const oa=Symbol("_assign"),Ut={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[oa]=Zc(s);const i=r||s.props&&s.props.type==="number";qi(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=df(a)),n[oa](a)}),t&&qi(n,"change",()=>{n.value=n.value.trim()}),e||(qi(n,"compositionstart",lx),qi(n,"compositionend",Ag),qi(n,"change",Ag))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[oa]=Zc(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?df(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},Sg={deep:!0,created(n,e,t){n[oa]=Zc(t),qi(n,"change",()=>{const r=n._modelValue,s=ux(n),i=n.checked,o=n[oa];if(Ue(r)){const a=Hy(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(Td(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(H_(n,i))})},mounted:Pg,beforeUpdate(n,e,t){n[oa]=Zc(t),Pg(n,e,t)}};function Pg(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(Ue(e))s=Hy(e,r.props.value)>-1;else if(Td(e))s=e.has(r.props.value);else{if(e===t)return;s=Pd(e,H_(n,!0))}n.checked!==s&&(n.checked=s)}function ux(n){return"_value"in n?n._value:n.value}function H_(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const cx=["ctrl","shift","alt","meta"],dx={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>cx.some(t=>n[`${t}Key`]&&!e.includes(t))},Ht=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=dx[e[o]];if(a&&a(s,e))return}return n(s,...i)})},hx={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Rn=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=bi(s.key);if(e.some(o=>o===i||hx[o]===i))return n(s)})},fx=bn({patchProp:ox},KT);let Rg;function px(){return Rg||(Rg=gT(fx))}const mx=(...n)=>{const e=px().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=vx(r);if(!s)return;const i=e._component;!Ke(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,gx(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function gx(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function vx(n){return on(n)?document.querySelector(n):n}const yx={__name:"App",setup(n){return(e,t)=>{const r=ZE("router-view");return U(),bp(r)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const Jo=typeof document<"u";function W_(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function _x(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&W_(n.default)}const pt=Object.assign;function jh(n,e){const t={};for(const r in e){const s=e[r];t[r]=Tr(s)?s.map(n):n(s)}return t}const Nl=()=>{},Tr=Array.isArray,Q_=/#/g,bx=/&/g,wx=/\//g,Ix=/=/g,Ex=/\?/g,J_=/\+/g,Tx=/%5B/g,xx=/%5D/g,Y_=/%5E/g,Ax=/%60/g,X_=/%7B/g,Sx=/%7C/g,Z_=/%7D/g,Px=/%20/g;function Ip(n){return encodeURI(""+n).replace(Sx,"|").replace(Tx,"[").replace(xx,"]")}function Rx(n){return Ip(n).replace(X_,"{").replace(Z_,"}").replace(Y_,"^")}function If(n){return Ip(n).replace(J_,"%2B").replace(Px,"+").replace(Q_,"%23").replace(bx,"%26").replace(Ax,"`").replace(X_,"{").replace(Z_,"}").replace(Y_,"^")}function Cx(n){return If(n).replace(Ix,"%3D")}function kx(n){return Ip(n).replace(Q_,"%23").replace(Ex,"%3F")}function Dx(n){return n==null?"":kx(n).replace(wx,"%2F")}function Hl(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const Vx=/\/$/,Nx=n=>n.replace(Vx,"");function Bh(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=Fx(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:Hl(o)}}function Ox(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function Cg(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function Mx(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&ma(e.matched[r],t.matched[s])&&e0(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function ma(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function e0(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!Lx(n[t],e[t]))return!1;return!0}function Lx(n,e){return Tr(n)?kg(n,e):Tr(e)?kg(e,n):n===e}function kg(n,e){return Tr(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function Fx(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const qs={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Wl;(function(n){n.pop="pop",n.push="push"})(Wl||(Wl={}));var Ol;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Ol||(Ol={}));function Ux(n){if(!n)if(Jo){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),Nx(n)}const $x=/^[^#]+#/;function jx(n,e){return n.replace($x,"#")+e}function Bx(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const Md=()=>({left:window.scrollX,top:window.scrollY});function qx(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=Bx(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function Dg(n,e){return(history.state?history.state.position-e:-1)+n}const Ef=new Map;function zx(n,e){Ef.set(n,e)}function Gx(n){const e=Ef.get(n);return Ef.delete(n),e}let Kx=()=>location.protocol+"//"+location.host;function t0(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),Cg(l,"")}return Cg(t,n)+r+s}function Hx(n,e,t,r){let s=[],i=[],o=null;const a=({state:v})=>{const y=t0(n,location),P=t.value,A=e.value;let R=0;if(v){if(t.value=y,e.value=v,o&&o===P){o=null;return}R=A?v.position-A.position:0}else r(y);s.forEach(j=>{j(t.value,P,{delta:R,type:Wl.pop,direction:R?R>0?Ol.forward:Ol.back:Ol.unknown})})};function l(){o=t.value}function c(v){s.push(v);const y=()=>{const P=s.indexOf(v);P>-1&&s.splice(P,1)};return i.push(y),y}function d(){const{history:v}=window;v.state&&v.replaceState(pt({},v.state,{scroll:Md()}),"")}function f(){for(const v of i)v();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",d)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",d,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function Vg(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?Md():null}}function Wx(n){const{history:e,location:t}=window,r={value:t0(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,d){const f=n.indexOf("#"),v=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:Kx()+n+l;try{e[d?"replaceState":"pushState"](c,"",v),s.value=c}catch(y){console.error(y),t[d?"replace":"assign"](v)}}function o(l,c){const d=pt({},e.state,Vg(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,d,!0),r.value=l}function a(l,c){const d=pt({},s.value,e.state,{forward:l,scroll:Md()});i(d.current,d,!0);const f=pt({},Vg(r.value,l,null),{position:d.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function Qx(n){n=Ux(n);const e=Wx(n),t=Hx(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=pt({location:"",base:n,go:r,createHref:jx.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function Jx(n){return typeof n=="string"||n&&typeof n=="object"}function n0(n){return typeof n=="string"||typeof n=="symbol"}const r0=Symbol("");var Ng;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(Ng||(Ng={}));function ga(n,e){return pt(new Error,{type:n,[r0]:!0},e)}function is(n,e){return n instanceof Error&&r0 in n&&(e==null||!!(n.type&e))}const Og="[^/]+?",Yx={sensitive:!1,strict:!1,start:!0,end:!0},Xx=/[.+*?^${}()[\]/\\]/g;function Zx(n,e){const t=pt({},Yx,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const d=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const v=c[f];let y=40+(t.sensitive?.25:0);if(v.type===0)f||(s+="/"),s+=v.value.replace(Xx,"\\$&"),y+=40;else if(v.type===1){const{value:P,repeatable:A,optional:R,regexp:j}=v;i.push({name:P,repeatable:A,optional:R});const B=j||Og;if(B!==Og){y+=10;try{new RegExp(`(${B})`)}catch(G){throw new Error(`Invalid custom RegExp for param "${P}" (${B}): `+G.message)}}let F=A?`((?:${B})(?:/(?:${B}))*)`:`(${B})`;f||(F=R&&c.length<2?`(?:/${F})`:"/"+F),R&&(F+="?"),s+=F,y+=20,R&&(y+=-8),A&&(y+=-20),B===".*"&&(y+=-50)}d.push(y)}r.push(d)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const d=c.match(o),f={};if(!d)return null;for(let v=1;v<d.length;v++){const y=d[v]||"",P=i[v-1];f[P.name]=y&&P.repeatable?y.split("/"):y}return f}function l(c){let d="",f=!1;for(const v of n){(!f||!d.endsWith("/"))&&(d+="/"),f=!1;for(const y of v)if(y.type===0)d+=y.value;else if(y.type===1){const{value:P,repeatable:A,optional:R}=y,j=P in c?c[P]:"";if(Tr(j)&&!A)throw new Error(`Provided param "${P}" is an array but it is not repeatable (* or + modifiers)`);const B=Tr(j)?j.join("/"):j;if(!B)if(R)v.length<2&&(d.endsWith("/")?d=d.slice(0,-1):f=!0);else throw new Error(`Missing required param "${P}"`);d+=B}}return d||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function eA(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function s0(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=eA(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(Mg(r))return 1;if(Mg(s))return-1}return s.length-r.length}function Mg(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const tA={type:0,value:""},nA=/[a-zA-Z0-9_]/;function rA(n){if(!n)return[[]];if(n==="/")return[[tA]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(y){throw new Error(`ERR (${t})/"${c}": ${y}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",d="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:d,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function v(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):v();break;case 4:v(),t=r;break;case 1:l==="("?t=2:nA.test(l)?v():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?d[d.length-1]=="\\"?d=d.slice(0,-1)+l:t=3:d+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,d="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function sA(n,e,t){const r=Zx(rA(n.path),t),s=pt(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function iA(n,e){const t=[],r=new Map;e=$g({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,v,y){const P=!y,A=Fg(f);A.aliasOf=y&&y.record;const R=$g(e,f),j=[A];if("alias"in f){const G=typeof f.alias=="string"?[f.alias]:f.alias;for(const oe of G)j.push(Fg(pt({},A,{components:y?y.record.components:A.components,path:oe,aliasOf:y?y.record:A})))}let B,F;for(const G of j){const{path:oe}=G;if(v&&oe[0]!=="/"){const ie=v.record.path,I=ie[ie.length-1]==="/"?"":"/";G.path=v.record.path+(oe&&I+oe)}if(B=sA(G,v,R),y?y.alias.push(B):(F=F||B,F!==B&&F.alias.push(B),P&&f.name&&!Ug(B)&&o(f.name)),i0(B)&&l(B),A.children){const ie=A.children;for(let I=0;I<ie.length;I++)i(ie[I],B,y&&y.children[I])}y=y||B}return F?()=>{o(F)}:Nl}function o(f){if(n0(f)){const v=r.get(f);v&&(r.delete(f),t.splice(t.indexOf(v),1),v.children.forEach(o),v.alias.forEach(o))}else{const v=t.indexOf(f);v>-1&&(t.splice(v,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const v=lA(f,t);t.splice(v,0,f),f.record.name&&!Ug(f)&&r.set(f.record.name,f)}function c(f,v){let y,P={},A,R;if("name"in f&&f.name){if(y=r.get(f.name),!y)throw ga(1,{location:f});R=y.record.name,P=pt(Lg(v.params,y.keys.filter(F=>!F.optional).concat(y.parent?y.parent.keys.filter(F=>F.optional):[]).map(F=>F.name)),f.params&&Lg(f.params,y.keys.map(F=>F.name))),A=y.stringify(P)}else if(f.path!=null)A=f.path,y=t.find(F=>F.re.test(A)),y&&(P=y.parse(A),R=y.record.name);else{if(y=v.name?r.get(v.name):t.find(F=>F.re.test(v.path)),!y)throw ga(1,{location:f,currentLocation:v});R=y.record.name,P=pt({},v.params,f.params),A=y.stringify(P)}const j=[];let B=y;for(;B;)j.unshift(B.record),B=B.parent;return{name:R,path:A,params:P,matched:j,meta:aA(j)}}n.forEach(f=>i(f));function d(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:d,getRoutes:a,getRecordMatcher:s}}function Lg(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function Fg(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:oA(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function oA(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function Ug(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function aA(n){return n.reduce((e,t)=>pt(e,t.meta),{})}function $g(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function lA(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;s0(n,e[i])<0?r=i:t=i+1}const s=uA(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function uA(n){let e=n;for(;e=e.parent;)if(i0(e)&&s0(n,e)===0)return e}function i0({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function cA(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(J_," "),o=i.indexOf("="),a=Hl(o<0?i:i.slice(0,o)),l=o<0?null:Hl(i.slice(o+1));if(a in e){let c=e[a];Tr(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function jg(n){let e="";for(let t in n){const r=n[t];if(t=Cx(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(Tr(r)?r.map(i=>i&&If(i)):[r&&If(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function dA(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=Tr(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const hA=Symbol(""),Bg=Symbol(""),Ld=Symbol(""),Ep=Symbol(""),Tf=Symbol("");function dl(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function Qs(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=v=>{v===!1?l(ga(4,{from:t,to:e})):v instanceof Error?l(v):Jx(v)?l(ga(2,{from:e,to:v})):(o&&r.enterCallbacks[s]===o&&typeof v=="function"&&o.push(v),a())},d=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(d);n.length<3&&(f=f.then(c)),f.catch(v=>l(v))})}function qh(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(W_(l)){const d=(l.__vccOpts||l)[e];d&&i.push(Qs(d,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(d=>{if(!d)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=_x(d)?d.default:d;o.mods[a]=d,o.components[a]=f;const y=(f.__vccOpts||f)[e];return y&&Qs(y,t,r,o,a,s)()}))}}return i}function qg(n){const e=Er(Ld),t=Er(Ep),r=Qe(()=>{const l=fs(n.to);return e.resolve(l)}),s=Qe(()=>{const{matched:l}=r.value,{length:c}=l,d=l[c-1],f=t.matched;if(!d||!f.length)return-1;const v=f.findIndex(ma.bind(null,d));if(v>-1)return v;const y=zg(l[c-2]);return c>1&&zg(d)===y&&f[f.length-1].path!==y?f.findIndex(ma.bind(null,l[c-2])):v}),i=Qe(()=>s.value>-1&&vA(t.params,r.value.params)),o=Qe(()=>s.value>-1&&s.value===t.matched.length-1&&e0(t.params,r.value.params));function a(l={}){if(gA(l)){const c=e[fs(n.replace)?"replace":"push"](fs(n.to)).catch(Nl);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:Qe(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function fA(n){return n.length===1?n[0]:n}const pA=__({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:qg,setup(n,{slots:e}){const t=Cd(qg(n)),{options:r}=Er(Ld),s=Qe(()=>({[Gg(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[Gg(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&fA(e.default(t));return n.custom?i:z_("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),mA=pA;function gA(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function vA(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!Tr(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function zg(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const Gg=(n,e,t)=>n??e??t,yA=__({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=Er(Tf),s=Qe(()=>n.route||r.value),i=Er(Bg,0),o=Qe(()=>{let c=fs(i);const{matched:d}=s.value;let f;for(;(f=d[c])&&!f.components;)c++;return c}),a=Qe(()=>s.value.matched[o.value]);Sc(Bg,Qe(()=>o.value+1)),Sc(hA,a),Sc(Tf,s);const l=O();return Yt(()=>[l.value,a.value,n.name],([c,d,f],[v,y,P])=>{d&&(d.instances[f]=c,y&&y!==d&&c&&c===v&&(d.leaveGuards.size||(d.leaveGuards=y.leaveGuards),d.updateGuards.size||(d.updateGuards=y.updateGuards))),c&&d&&(!y||!ma(d,y)||!v)&&(d.enterCallbacks[f]||[]).forEach(A=>A(c))},{flush:"post"}),()=>{const c=s.value,d=n.name,f=a.value,v=f&&f.components[d];if(!v)return Kg(t.default,{Component:v,route:c});const y=f.props[d],P=y?y===!0?c.params:typeof y=="function"?y(c):y:null,R=z_(v,pt({},P,e,{onVnodeUnmounted:j=>{j.component.isUnmounted&&(f.instances[d]=null)},ref:l}));return Kg(t.default,{Component:R,route:c})||R}}});function Kg(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const _A=yA;function bA(n){const e=iA(n.routes,n),t=n.parseQuery||cA,r=n.stringifyQuery||jg,s=n.history,i=dl(),o=dl(),a=dl(),l=RE(qs);let c=qs;Jo&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=jh.bind(null,K=>""+K),f=jh.bind(null,Dx),v=jh.bind(null,Hl);function y(K,ye){let le,Ae;return n0(K)?(le=e.getRecordMatcher(K),Ae=ye):Ae=K,e.addRoute(Ae,le)}function P(K){const ye=e.getRecordMatcher(K);ye&&e.removeRoute(ye)}function A(){return e.getRoutes().map(K=>K.record)}function R(K){return!!e.getRecordMatcher(K)}function j(K,ye){if(ye=pt({},ye||l.value),typeof K=="string"){const S=Bh(t,K,ye.path),N=e.resolve({path:S.path},ye),X=s.createHref(S.fullPath);return pt(S,N,{params:v(N.params),hash:Hl(S.hash),redirectedFrom:void 0,href:X})}let le;if(K.path!=null)le=pt({},K,{path:Bh(t,K.path,ye.path).path});else{const S=pt({},K.params);for(const N in S)S[N]==null&&delete S[N];le=pt({},K,{params:f(S)}),ye.params=f(ye.params)}const Ae=e.resolve(le,ye),Ye=K.hash||"";Ae.params=d(v(Ae.params));const ht=Ox(r,pt({},K,{hash:Rx(Ye),path:Ae.path})),T=s.createHref(ht);return pt({fullPath:ht,hash:Ye,query:r===jg?dA(K.query):K.query||{}},Ae,{redirectedFrom:void 0,href:T})}function B(K){return typeof K=="string"?Bh(t,K,l.value.path):pt({},K)}function F(K,ye){if(c!==K)return ga(8,{from:ye,to:K})}function G(K){return I(K)}function oe(K){return G(pt(B(K),{replace:!0}))}function ie(K){const ye=K.matched[K.matched.length-1];if(ye&&ye.redirect){const{redirect:le}=ye;let Ae=typeof le=="function"?le(K):le;return typeof Ae=="string"&&(Ae=Ae.includes("?")||Ae.includes("#")?Ae=B(Ae):{path:Ae},Ae.params={}),pt({query:K.query,hash:K.hash,params:Ae.path!=null?{}:K.params},Ae)}}function I(K,ye){const le=c=j(K),Ae=l.value,Ye=K.state,ht=K.force,T=K.replace===!0,S=ie(le);if(S)return I(pt(B(S),{state:typeof S=="object"?pt({},Ye,S.state):Ye,force:ht,replace:T}),ye||le);const N=le;N.redirectedFrom=ye;let X;return!ht&&Mx(r,Ae,le)&&(X=ga(16,{to:N,from:Ae}),De(Ae,Ae,!0,!1)),(X?Promise.resolve(X):k(N,Ae)).catch(Q=>is(Q)?is(Q,2)?Q:ee(Q):je(Q,N,Ae)).then(Q=>{if(Q){if(is(Q,2))return I(pt({replace:T},B(Q.to),{state:typeof Q.to=="object"?pt({},Ye,Q.to.state):Ye,force:ht}),ye||N)}else Q=D(N,Ae,!0,T,Ye);return V(N,Ae,Q),Q})}function E(K,ye){const le=F(K,ye);return le?Promise.reject(le):Promise.resolve()}function x(K){const ye=Ve.values().next().value;return ye&&typeof ye.runWithContext=="function"?ye.runWithContext(K):K()}function k(K,ye){let le;const[Ae,Ye,ht]=wA(K,ye);le=qh(Ae.reverse(),"beforeRouteLeave",K,ye);for(const S of Ae)S.leaveGuards.forEach(N=>{le.push(Qs(N,K,ye))});const T=E.bind(null,K,ye);return le.push(T),nt(le).then(()=>{le=[];for(const S of i.list())le.push(Qs(S,K,ye));return le.push(T),nt(le)}).then(()=>{le=qh(Ye,"beforeRouteUpdate",K,ye);for(const S of Ye)S.updateGuards.forEach(N=>{le.push(Qs(N,K,ye))});return le.push(T),nt(le)}).then(()=>{le=[];for(const S of ht)if(S.beforeEnter)if(Tr(S.beforeEnter))for(const N of S.beforeEnter)le.push(Qs(N,K,ye));else le.push(Qs(S.beforeEnter,K,ye));return le.push(T),nt(le)}).then(()=>(K.matched.forEach(S=>S.enterCallbacks={}),le=qh(ht,"beforeRouteEnter",K,ye,x),le.push(T),nt(le))).then(()=>{le=[];for(const S of o.list())le.push(Qs(S,K,ye));return le.push(T),nt(le)}).catch(S=>is(S,8)?S:Promise.reject(S))}function V(K,ye,le){a.list().forEach(Ae=>x(()=>Ae(K,ye,le)))}function D(K,ye,le,Ae,Ye){const ht=F(K,ye);if(ht)return ht;const T=ye===qs,S=Jo?history.state:{};le&&(Ae||T?s.replace(K.fullPath,pt({scroll:T&&S&&S.scroll},Ye)):s.push(K.fullPath,Ye)),l.value=K,De(K,ye,le,T),ee()}let w;function He(){w||(w=s.listen((K,ye,le)=>{if(!Ze.listening)return;const Ae=j(K),Ye=ie(Ae);if(Ye){I(pt(Ye,{replace:!0,force:!0}),Ae).catch(Nl);return}c=Ae;const ht=l.value;Jo&&zx(Dg(ht.fullPath,le.delta),Md()),k(Ae,ht).catch(T=>is(T,12)?T:is(T,2)?(I(pt(B(T.to),{force:!0}),Ae).then(S=>{is(S,20)&&!le.delta&&le.type===Wl.pop&&s.go(-1,!1)}).catch(Nl),Promise.reject()):(le.delta&&s.go(-le.delta,!1),je(T,Ae,ht))).then(T=>{T=T||D(Ae,ht,!1),T&&(le.delta&&!is(T,8)?s.go(-le.delta,!1):le.type===Wl.pop&&is(T,20)&&s.go(-1,!1)),V(Ae,ht,T)}).catch(Nl)}))}let We=dl(),Xe=dl(),$e;function je(K,ye,le){ee(K);const Ae=Xe.list();return Ae.length?Ae.forEach(Ye=>Ye(K,ye,le)):console.error(K),Promise.reject(K)}function ke(){return $e&&l.value!==qs?Promise.resolve():new Promise((K,ye)=>{We.add([K,ye])})}function ee(K){return $e||($e=!K,He(),We.list().forEach(([ye,le])=>K?le(K):ye()),We.reset()),K}function De(K,ye,le,Ae){const{scrollBehavior:Ye}=n;if(!Jo||!Ye)return Promise.resolve();const ht=!le&&Gx(Dg(K.fullPath,0))||(Ae||!le)&&history.state&&history.state.scroll||null;return cn().then(()=>Ye(K,ye,ht)).then(T=>T&&qx(T)).catch(T=>je(T,K,ye))}const H=K=>s.go(K);let Y;const Ve=new Set,Ze={currentRoute:l,listening:!0,addRoute:y,removeRoute:P,clearRoutes:e.clearRoutes,hasRoute:R,getRoutes:A,resolve:j,options:n,push:G,replace:oe,go:H,back:()=>H(-1),forward:()=>H(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:Xe.add,isReady:ke,install(K){const ye=this;K.component("RouterLink",mA),K.component("RouterView",_A),K.config.globalProperties.$router=ye,Object.defineProperty(K.config.globalProperties,"$route",{enumerable:!0,get:()=>fs(l)}),Jo&&!Y&&l.value===qs&&(Y=!0,G(s.location).catch(Ye=>{}));const le={};for(const Ye in qs)Object.defineProperty(le,Ye,{get:()=>l.value[Ye],enumerable:!0});K.provide(Ld,ye),K.provide(Ep,c_(le)),K.provide(Tf,l);const Ae=K.unmount;Ve.add(K),K.unmount=function(){Ve.delete(K),Ve.size<1&&(c=qs,w&&w(),w=null,l.value=qs,Y=!1,$e=!1),Ae()}}};function nt(K){return K.reduce((ye,le)=>ye.then(()=>x(le)),Promise.resolve())}return Ze}function wA(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>ma(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>ma(c,l))||s.push(l))}return[t,r,s]}function yu(){return Er(Ld)}function _u(n){return Er(Ep)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o0=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},IA=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},a0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,d=i>>2,f=(i&3)<<4|a>>4;let v=(a&15)<<2|c>>6,y=c&63;l||(y=64,o||(v=64)),r.push(t[d],t[f],t[v],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(o0(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):IA(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new EA;const v=i<<2|a>>4;if(r.push(v),c!==64){const y=a<<4&240|c>>2;if(r.push(y),f!==64){const P=c<<6&192|f;r.push(P)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class EA extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const TA=function(n){const e=o0(n);return a0.encodeByteArray(e,!0)},ed=function(n){return TA(n).replace(/\./g,"")},l0=function(n){try{return a0.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AA=()=>xA().__FIREBASE_DEFAULTS__,SA=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},PA=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&l0(n[1]);return e&&JSON.parse(e)},Fd=()=>{try{return AA()||SA()||PA()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},u0=n=>{var e,t;return(t=(e=Fd())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},RA=n=>{const e=u0(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},c0=()=>{var n;return(n=Fd())===null||n===void 0?void 0:n.config},d0=n=>{var e;return(e=Fd())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CA{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kA(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[ed(JSON.stringify(t)),ed(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function DA(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(dn())}function VA(){var n;const e=(n=Fd())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function NA(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function OA(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function MA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function LA(){const n=dn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function h0(){return!VA()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function f0(){try{return typeof indexedDB=="object"}catch{return!1}}function FA(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UA="FirebaseError";class Ts extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=UA,Object.setPrototypeOf(this,Ts.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,bu.prototype.create)}}class bu{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?$A(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Ts(s,a,r)}}function $A(n,e){return n.replace(jA,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const jA=/\{\$([^}]+)}/g;function BA(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function hi(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(Hg(i)&&Hg(o)){if(!hi(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Hg(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oa(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function _l(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function bl(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function qA(n,e){const t=new zA(n,e);return t.subscribe.bind(t)}class zA{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");GA(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=zh),s.error===void 0&&(s.error=zh),s.complete===void 0&&(s.complete=zh);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function GA(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function zh(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ce(n){return n&&n._delegate?n._delegate:n}class to{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ji="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KA{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new CA;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(WA(e))try{this.getOrInitializeService({instanceIdentifier:ji})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ji){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ji){return this.instances.has(e)}getOptions(e=ji){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:HA(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ji){return this.component?this.component.multipleInstances?e:ji:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function HA(n){return n===ji?void 0:n}function WA(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QA{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new KA(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var at;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(at||(at={}));const JA={debug:at.DEBUG,verbose:at.VERBOSE,info:at.INFO,warn:at.WARN,error:at.ERROR,silent:at.SILENT},YA=at.INFO,XA={[at.DEBUG]:"log",[at.VERBOSE]:"log",[at.INFO]:"info",[at.WARN]:"warn",[at.ERROR]:"error"},ZA=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=XA[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Tp{constructor(e){this.name=e,this._logLevel=YA,this._logHandler=ZA,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in at))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?JA[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,at.DEBUG,...e),this._logHandler(this,at.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,at.VERBOSE,...e),this._logHandler(this,at.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,at.INFO,...e),this._logHandler(this,at.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,at.WARN,...e),this._logHandler(this,at.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,at.ERROR,...e),this._logHandler(this,at.ERROR,...e)}}const eS=(n,e)=>e.some(t=>n instanceof t);let Wg,Qg;function tS(){return Wg||(Wg=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function nS(){return Qg||(Qg=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const p0=new WeakMap,xf=new WeakMap,m0=new WeakMap,Gh=new WeakMap,xp=new WeakMap;function rS(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(oi(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&p0.set(t,n)}).catch(()=>{}),xp.set(e,n),e}function sS(n){if(xf.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});xf.set(n,e)}let Af={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return xf.get(n);if(e==="objectStoreNames")return n.objectStoreNames||m0.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return oi(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function iS(n){Af=n(Af)}function oS(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Kh(this),e,...t);return m0.set(r,e.sort?e.sort():[e]),oi(r)}:nS().includes(n)?function(...e){return n.apply(Kh(this),e),oi(p0.get(this))}:function(...e){return oi(n.apply(Kh(this),e))}}function aS(n){return typeof n=="function"?oS(n):(n instanceof IDBTransaction&&sS(n),eS(n,tS())?new Proxy(n,Af):n)}function oi(n){if(n instanceof IDBRequest)return rS(n);if(Gh.has(n))return Gh.get(n);const e=aS(n);return e!==n&&(Gh.set(n,e),xp.set(e,n)),e}const Kh=n=>xp.get(n);function lS(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=oi(o);return r&&o.addEventListener("upgradeneeded",l=>{r(oi(o.result),l.oldVersion,l.newVersion,oi(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const uS=["get","getKey","getAll","getAllKeys","count"],cS=["put","add","delete","clear"],Hh=new Map;function Jg(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Hh.get(e))return Hh.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=cS.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||uS.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return Hh.set(e,i),i}iS(n=>({...n,get:(e,t,r)=>Jg(e,t)||n.get(e,t,r),has:(e,t)=>!!Jg(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dS{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(hS(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function hS(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Sf="@firebase/app",Yg="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vs=new Tp("@firebase/app"),fS="@firebase/app-compat",pS="@firebase/analytics-compat",mS="@firebase/analytics",gS="@firebase/app-check-compat",vS="@firebase/app-check",yS="@firebase/auth",_S="@firebase/auth-compat",bS="@firebase/database",wS="@firebase/data-connect",IS="@firebase/database-compat",ES="@firebase/functions",TS="@firebase/functions-compat",xS="@firebase/installations",AS="@firebase/installations-compat",SS="@firebase/messaging",PS="@firebase/messaging-compat",RS="@firebase/performance",CS="@firebase/performance-compat",kS="@firebase/remote-config",DS="@firebase/remote-config-compat",VS="@firebase/storage",NS="@firebase/storage-compat",OS="@firebase/firestore",MS="@firebase/vertexai-preview",LS="@firebase/firestore-compat",FS="firebase",US="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const td="[DEFAULT]",$S={[Sf]:"fire-core",[fS]:"fire-core-compat",[mS]:"fire-analytics",[pS]:"fire-analytics-compat",[vS]:"fire-app-check",[gS]:"fire-app-check-compat",[yS]:"fire-auth",[_S]:"fire-auth-compat",[bS]:"fire-rtdb",[wS]:"fire-data-connect",[IS]:"fire-rtdb-compat",[ES]:"fire-fn",[TS]:"fire-fn-compat",[xS]:"fire-iid",[AS]:"fire-iid-compat",[SS]:"fire-fcm",[PS]:"fire-fcm-compat",[RS]:"fire-perf",[CS]:"fire-perf-compat",[kS]:"fire-rc",[DS]:"fire-rc-compat",[VS]:"fire-gcs",[NS]:"fire-gcs-compat",[OS]:"fire-fst",[LS]:"fire-fst-compat",[MS]:"fire-vertex","fire-js":"fire-js",[FS]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nd=new Map,jS=new Map,Pf=new Map;function Xg(n,e){try{n.container.addComponent(e)}catch(t){vs.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function va(n){const e=n.name;if(Pf.has(e))return vs.debug(`There were multiple attempts to register component ${e}.`),!1;Pf.set(e,n);for(const t of nd.values())Xg(t,n);for(const t of jS.values())Xg(t,n);return!0}function wu(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function BS(n,e,t=td){wu(n,e).clearInstance(t)}function en(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qS={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ai=new bu("app","Firebase",qS);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zS{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new to("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ai.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ma=US;function g0(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:td,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw ai.create("bad-app-name",{appName:String(s)});if(t||(t=c0()),!t)throw ai.create("no-options");const i=nd.get(s);if(i){if(hi(t,i.options)&&hi(r,i.config))return i;throw ai.create("duplicate-app",{appName:s})}const o=new QA(s);for(const l of Pf.values())o.addComponent(l);const a=new zS(t,r,o);return nd.set(s,a),a}function v0(n=td){const e=nd.get(n);if(!e&&n===td&&c0())return g0();if(!e)throw ai.create("no-app",{appName:n});return e}function li(n,e,t){var r;let s=(r=$S[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),vs.warn(a.join(" "));return}va(new to(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GS="firebase-heartbeat-database",KS=1,Ql="firebase-heartbeat-store";let Wh=null;function y0(){return Wh||(Wh=lS(GS,KS,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ql)}catch(t){console.warn(t)}}}}).catch(n=>{throw ai.create("idb-open",{originalErrorMessage:n.message})})),Wh}async function HS(n){try{const t=(await y0()).transaction(Ql),r=await t.objectStore(Ql).get(_0(n));return await t.done,r}catch(e){if(e instanceof Ts)vs.warn(e.message);else{const t=ai.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});vs.warn(t.message)}}}async function Zg(n,e){try{const r=(await y0()).transaction(Ql,"readwrite");await r.objectStore(Ql).put(e,_0(n)),await r.done}catch(t){if(t instanceof Ts)vs.warn(t.message);else{const r=ai.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});vs.warn(r.message)}}}function _0(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WS=1024,QS=30*24*60*60*1e3;class JS{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new XS(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=ev();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=QS}),this._storage.overwrite(this._heartbeatsCache))}catch(r){vs.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=ev(),{heartbeatsToSend:r,unsentEntries:s}=YS(this._heartbeatsCache.heartbeats),i=ed(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return vs.warn(t),""}}}function ev(){return new Date().toISOString().substring(0,10)}function YS(n,e=WS){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),tv(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),tv(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class XS{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return f0()?FA().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await HS(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Zg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Zg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function tv(n){return ed(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZS(n){va(new to("platform-logger",e=>new dS(e),"PRIVATE")),va(new to("heartbeat",e=>new JS(e),"PRIVATE")),li(Sf,Yg,n),li(Sf,Yg,"esm2017"),li("fire-js","")}ZS("");var eP="firebase",tP="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */li(eP,tP,"app");var nv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Yi,b0;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(I,E){function x(){}x.prototype=E.prototype,I.D=E.prototype,I.prototype=new x,I.prototype.constructor=I,I.C=function(k,V,D){for(var w=Array(arguments.length-2),He=2;He<arguments.length;He++)w[He-2]=arguments[He];return E.prototype[V].apply(k,w)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,E,x){x||(x=0);var k=Array(16);if(typeof E=="string")for(var V=0;16>V;++V)k[V]=E.charCodeAt(x++)|E.charCodeAt(x++)<<8|E.charCodeAt(x++)<<16|E.charCodeAt(x++)<<24;else for(V=0;16>V;++V)k[V]=E[x++]|E[x++]<<8|E[x++]<<16|E[x++]<<24;E=I.g[0],x=I.g[1],V=I.g[2];var D=I.g[3],w=E+(D^x&(V^D))+k[0]+3614090360&4294967295;E=x+(w<<7&4294967295|w>>>25),w=D+(V^E&(x^V))+k[1]+3905402710&4294967295,D=E+(w<<12&4294967295|w>>>20),w=V+(x^D&(E^x))+k[2]+606105819&4294967295,V=D+(w<<17&4294967295|w>>>15),w=x+(E^V&(D^E))+k[3]+3250441966&4294967295,x=V+(w<<22&4294967295|w>>>10),w=E+(D^x&(V^D))+k[4]+4118548399&4294967295,E=x+(w<<7&4294967295|w>>>25),w=D+(V^E&(x^V))+k[5]+1200080426&4294967295,D=E+(w<<12&4294967295|w>>>20),w=V+(x^D&(E^x))+k[6]+2821735955&4294967295,V=D+(w<<17&4294967295|w>>>15),w=x+(E^V&(D^E))+k[7]+4249261313&4294967295,x=V+(w<<22&4294967295|w>>>10),w=E+(D^x&(V^D))+k[8]+1770035416&4294967295,E=x+(w<<7&4294967295|w>>>25),w=D+(V^E&(x^V))+k[9]+2336552879&4294967295,D=E+(w<<12&4294967295|w>>>20),w=V+(x^D&(E^x))+k[10]+4294925233&4294967295,V=D+(w<<17&4294967295|w>>>15),w=x+(E^V&(D^E))+k[11]+2304563134&4294967295,x=V+(w<<22&4294967295|w>>>10),w=E+(D^x&(V^D))+k[12]+1804603682&4294967295,E=x+(w<<7&4294967295|w>>>25),w=D+(V^E&(x^V))+k[13]+4254626195&4294967295,D=E+(w<<12&4294967295|w>>>20),w=V+(x^D&(E^x))+k[14]+2792965006&4294967295,V=D+(w<<17&4294967295|w>>>15),w=x+(E^V&(D^E))+k[15]+1236535329&4294967295,x=V+(w<<22&4294967295|w>>>10),w=E+(V^D&(x^V))+k[1]+4129170786&4294967295,E=x+(w<<5&4294967295|w>>>27),w=D+(x^V&(E^x))+k[6]+3225465664&4294967295,D=E+(w<<9&4294967295|w>>>23),w=V+(E^x&(D^E))+k[11]+643717713&4294967295,V=D+(w<<14&4294967295|w>>>18),w=x+(D^E&(V^D))+k[0]+3921069994&4294967295,x=V+(w<<20&4294967295|w>>>12),w=E+(V^D&(x^V))+k[5]+3593408605&4294967295,E=x+(w<<5&4294967295|w>>>27),w=D+(x^V&(E^x))+k[10]+38016083&4294967295,D=E+(w<<9&4294967295|w>>>23),w=V+(E^x&(D^E))+k[15]+3634488961&4294967295,V=D+(w<<14&4294967295|w>>>18),w=x+(D^E&(V^D))+k[4]+3889429448&4294967295,x=V+(w<<20&4294967295|w>>>12),w=E+(V^D&(x^V))+k[9]+568446438&4294967295,E=x+(w<<5&4294967295|w>>>27),w=D+(x^V&(E^x))+k[14]+3275163606&4294967295,D=E+(w<<9&4294967295|w>>>23),w=V+(E^x&(D^E))+k[3]+4107603335&4294967295,V=D+(w<<14&4294967295|w>>>18),w=x+(D^E&(V^D))+k[8]+1163531501&4294967295,x=V+(w<<20&4294967295|w>>>12),w=E+(V^D&(x^V))+k[13]+2850285829&4294967295,E=x+(w<<5&4294967295|w>>>27),w=D+(x^V&(E^x))+k[2]+4243563512&4294967295,D=E+(w<<9&4294967295|w>>>23),w=V+(E^x&(D^E))+k[7]+1735328473&4294967295,V=D+(w<<14&4294967295|w>>>18),w=x+(D^E&(V^D))+k[12]+2368359562&4294967295,x=V+(w<<20&4294967295|w>>>12),w=E+(x^V^D)+k[5]+4294588738&4294967295,E=x+(w<<4&4294967295|w>>>28),w=D+(E^x^V)+k[8]+2272392833&4294967295,D=E+(w<<11&4294967295|w>>>21),w=V+(D^E^x)+k[11]+1839030562&4294967295,V=D+(w<<16&4294967295|w>>>16),w=x+(V^D^E)+k[14]+4259657740&4294967295,x=V+(w<<23&4294967295|w>>>9),w=E+(x^V^D)+k[1]+2763975236&4294967295,E=x+(w<<4&4294967295|w>>>28),w=D+(E^x^V)+k[4]+1272893353&4294967295,D=E+(w<<11&4294967295|w>>>21),w=V+(D^E^x)+k[7]+4139469664&4294967295,V=D+(w<<16&4294967295|w>>>16),w=x+(V^D^E)+k[10]+3200236656&4294967295,x=V+(w<<23&4294967295|w>>>9),w=E+(x^V^D)+k[13]+681279174&4294967295,E=x+(w<<4&4294967295|w>>>28),w=D+(E^x^V)+k[0]+3936430074&4294967295,D=E+(w<<11&4294967295|w>>>21),w=V+(D^E^x)+k[3]+3572445317&4294967295,V=D+(w<<16&4294967295|w>>>16),w=x+(V^D^E)+k[6]+76029189&4294967295,x=V+(w<<23&4294967295|w>>>9),w=E+(x^V^D)+k[9]+3654602809&4294967295,E=x+(w<<4&4294967295|w>>>28),w=D+(E^x^V)+k[12]+3873151461&4294967295,D=E+(w<<11&4294967295|w>>>21),w=V+(D^E^x)+k[15]+530742520&4294967295,V=D+(w<<16&4294967295|w>>>16),w=x+(V^D^E)+k[2]+3299628645&4294967295,x=V+(w<<23&4294967295|w>>>9),w=E+(V^(x|~D))+k[0]+4096336452&4294967295,E=x+(w<<6&4294967295|w>>>26),w=D+(x^(E|~V))+k[7]+1126891415&4294967295,D=E+(w<<10&4294967295|w>>>22),w=V+(E^(D|~x))+k[14]+2878612391&4294967295,V=D+(w<<15&4294967295|w>>>17),w=x+(D^(V|~E))+k[5]+4237533241&4294967295,x=V+(w<<21&4294967295|w>>>11),w=E+(V^(x|~D))+k[12]+1700485571&4294967295,E=x+(w<<6&4294967295|w>>>26),w=D+(x^(E|~V))+k[3]+2399980690&4294967295,D=E+(w<<10&4294967295|w>>>22),w=V+(E^(D|~x))+k[10]+4293915773&4294967295,V=D+(w<<15&4294967295|w>>>17),w=x+(D^(V|~E))+k[1]+2240044497&4294967295,x=V+(w<<21&4294967295|w>>>11),w=E+(V^(x|~D))+k[8]+1873313359&4294967295,E=x+(w<<6&4294967295|w>>>26),w=D+(x^(E|~V))+k[15]+4264355552&4294967295,D=E+(w<<10&4294967295|w>>>22),w=V+(E^(D|~x))+k[6]+2734768916&4294967295,V=D+(w<<15&4294967295|w>>>17),w=x+(D^(V|~E))+k[13]+1309151649&4294967295,x=V+(w<<21&4294967295|w>>>11),w=E+(V^(x|~D))+k[4]+4149444226&4294967295,E=x+(w<<6&4294967295|w>>>26),w=D+(x^(E|~V))+k[11]+3174756917&4294967295,D=E+(w<<10&4294967295|w>>>22),w=V+(E^(D|~x))+k[2]+718787259&4294967295,V=D+(w<<15&4294967295|w>>>17),w=x+(D^(V|~E))+k[9]+3951481745&4294967295,I.g[0]=I.g[0]+E&4294967295,I.g[1]=I.g[1]+(V+(w<<21&4294967295|w>>>11))&4294967295,I.g[2]=I.g[2]+V&4294967295,I.g[3]=I.g[3]+D&4294967295}r.prototype.u=function(I,E){E===void 0&&(E=I.length);for(var x=E-this.blockSize,k=this.B,V=this.h,D=0;D<E;){if(V==0)for(;D<=x;)s(this,I,D),D+=this.blockSize;if(typeof I=="string"){for(;D<E;)if(k[V++]=I.charCodeAt(D++),V==this.blockSize){s(this,k),V=0;break}}else for(;D<E;)if(k[V++]=I[D++],V==this.blockSize){s(this,k),V=0;break}}this.h=V,this.o+=E},r.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var E=1;E<I.length-8;++E)I[E]=0;var x=8*this.o;for(E=I.length-8;E<I.length;++E)I[E]=x&255,x/=256;for(this.u(I),I=Array(16),E=x=0;4>E;++E)for(var k=0;32>k;k+=8)I[x++]=this.g[E]>>>k&255;return I};function i(I,E){var x=a;return Object.prototype.hasOwnProperty.call(x,I)?x[I]:x[I]=E(I)}function o(I,E){this.h=E;for(var x=[],k=!0,V=I.length-1;0<=V;V--){var D=I[V]|0;k&&D==E||(x[V]=D,k=!1)}this.g=x}var a={};function l(I){return-128<=I&&128>I?i(I,function(E){return new o([E|0],0>E?-1:0)}):new o([I|0],0>I?-1:0)}function c(I){if(isNaN(I)||!isFinite(I))return f;if(0>I)return R(c(-I));for(var E=[],x=1,k=0;I>=x;k++)E[k]=I/x|0,x*=4294967296;return new o(E,0)}function d(I,E){if(I.length==0)throw Error("number format error: empty string");if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(I.charAt(0)=="-")return R(d(I.substring(1),E));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var x=c(Math.pow(E,8)),k=f,V=0;V<I.length;V+=8){var D=Math.min(8,I.length-V),w=parseInt(I.substring(V,V+D),E);8>D?(D=c(Math.pow(E,D)),k=k.j(D).add(c(w))):(k=k.j(x),k=k.add(c(w)))}return k}var f=l(0),v=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(A(this))return-R(this).m();for(var I=0,E=1,x=0;x<this.g.length;x++){var k=this.i(x);I+=(0<=k?k:4294967296+k)*E,E*=4294967296}return I},n.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(P(this))return"0";if(A(this))return"-"+R(this).toString(I);for(var E=c(Math.pow(I,6)),x=this,k="";;){var V=G(x,E).g;x=j(x,V.j(E));var D=((0<x.g.length?x.g[0]:x.h)>>>0).toString(I);if(x=V,P(x))return D+k;for(;6>D.length;)D="0"+D;k=D+k}},n.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function P(I){if(I.h!=0)return!1;for(var E=0;E<I.g.length;E++)if(I.g[E]!=0)return!1;return!0}function A(I){return I.h==-1}n.l=function(I){return I=j(this,I),A(I)?-1:P(I)?0:1};function R(I){for(var E=I.g.length,x=[],k=0;k<E;k++)x[k]=~I.g[k];return new o(x,~I.h).add(v)}n.abs=function(){return A(this)?R(this):this},n.add=function(I){for(var E=Math.max(this.g.length,I.g.length),x=[],k=0,V=0;V<=E;V++){var D=k+(this.i(V)&65535)+(I.i(V)&65535),w=(D>>>16)+(this.i(V)>>>16)+(I.i(V)>>>16);k=w>>>16,D&=65535,w&=65535,x[V]=w<<16|D}return new o(x,x[x.length-1]&-2147483648?-1:0)};function j(I,E){return I.add(R(E))}n.j=function(I){if(P(this)||P(I))return f;if(A(this))return A(I)?R(this).j(R(I)):R(R(this).j(I));if(A(I))return R(this.j(R(I)));if(0>this.l(y)&&0>I.l(y))return c(this.m()*I.m());for(var E=this.g.length+I.g.length,x=[],k=0;k<2*E;k++)x[k]=0;for(k=0;k<this.g.length;k++)for(var V=0;V<I.g.length;V++){var D=this.i(k)>>>16,w=this.i(k)&65535,He=I.i(V)>>>16,We=I.i(V)&65535;x[2*k+2*V]+=w*We,B(x,2*k+2*V),x[2*k+2*V+1]+=D*We,B(x,2*k+2*V+1),x[2*k+2*V+1]+=w*He,B(x,2*k+2*V+1),x[2*k+2*V+2]+=D*He,B(x,2*k+2*V+2)}for(k=0;k<E;k++)x[k]=x[2*k+1]<<16|x[2*k];for(k=E;k<2*E;k++)x[k]=0;return new o(x,0)};function B(I,E){for(;(I[E]&65535)!=I[E];)I[E+1]+=I[E]>>>16,I[E]&=65535,E++}function F(I,E){this.g=I,this.h=E}function G(I,E){if(P(E))throw Error("division by zero");if(P(I))return new F(f,f);if(A(I))return E=G(R(I),E),new F(R(E.g),R(E.h));if(A(E))return E=G(I,R(E)),new F(R(E.g),E.h);if(30<I.g.length){if(A(I)||A(E))throw Error("slowDivide_ only works with positive integers.");for(var x=v,k=E;0>=k.l(I);)x=oe(x),k=oe(k);var V=ie(x,1),D=ie(k,1);for(k=ie(k,2),x=ie(x,2);!P(k);){var w=D.add(k);0>=w.l(I)&&(V=V.add(x),D=w),k=ie(k,1),x=ie(x,1)}return E=j(I,V.j(E)),new F(V,E)}for(V=f;0<=I.l(E);){for(x=Math.max(1,Math.floor(I.m()/E.m())),k=Math.ceil(Math.log(x)/Math.LN2),k=48>=k?1:Math.pow(2,k-48),D=c(x),w=D.j(E);A(w)||0<w.l(I);)x-=k,D=c(x),w=D.j(E);P(D)&&(D=v),V=V.add(D),I=j(I,w)}return new F(V,I)}n.A=function(I){return G(this,I).h},n.and=function(I){for(var E=Math.max(this.g.length,I.g.length),x=[],k=0;k<E;k++)x[k]=this.i(k)&I.i(k);return new o(x,this.h&I.h)},n.or=function(I){for(var E=Math.max(this.g.length,I.g.length),x=[],k=0;k<E;k++)x[k]=this.i(k)|I.i(k);return new o(x,this.h|I.h)},n.xor=function(I){for(var E=Math.max(this.g.length,I.g.length),x=[],k=0;k<E;k++)x[k]=this.i(k)^I.i(k);return new o(x,this.h^I.h)};function oe(I){for(var E=I.g.length+1,x=[],k=0;k<E;k++)x[k]=I.i(k)<<1|I.i(k-1)>>>31;return new o(x,I.h)}function ie(I,E){var x=E>>5;E%=32;for(var k=I.g.length-x,V=[],D=0;D<k;D++)V[D]=0<E?I.i(D+x)>>>E|I.i(D+x+1)<<32-E:I.i(D+x);return new o(V,I.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,b0=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,Yi=o}).apply(typeof nv<"u"?nv:typeof self<"u"?self:typeof window<"u"?window:{});var gc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var w0,wl,I0,kc,Rf,E0,T0,x0;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,h,g){return u==Array.prototype||u==Object.prototype||(u[h]=g.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof gc=="object"&&gc];for(var h=0;h<u.length;++h){var g=u[h];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var r=t(this);function s(u,h){if(h)e:{var g=r;u=u.split(".");for(var b=0;b<u.length-1;b++){var M=u[b];if(!(M in g))break e;g=g[M]}u=u[u.length-1],b=g[u],h=h(b),h!=b&&h!=null&&e(g,u,{configurable:!0,writable:!0,value:h})}}function i(u,h){u instanceof String&&(u+="");var g=0,b=!1,M={next:function(){if(!b&&g<u.length){var z=g++;return{value:h(z,u[z]),done:!1}}return b=!0,{done:!0,value:void 0}}};return M[Symbol.iterator]=function(){return M},M}s("Array.prototype.values",function(u){return u||function(){return i(this,function(h,g){return g})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var h=typeof u;return h=h!="object"?h:u?Array.isArray(u)?"array":h:"null",h=="array"||h=="object"&&typeof u.length=="number"}function c(u){var h=typeof u;return h=="object"&&u!=null||h=="function"}function d(u,h,g){return u.call.apply(u.bind,arguments)}function f(u,h,g){if(!u)throw Error();if(2<arguments.length){var b=Array.prototype.slice.call(arguments,2);return function(){var M=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(M,b),u.apply(h,M)}}return function(){return u.apply(h,arguments)}}function v(u,h,g){return v=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,v.apply(null,arguments)}function y(u,h){var g=Array.prototype.slice.call(arguments,1);return function(){var b=g.slice();return b.push.apply(b,arguments),u.apply(this,b)}}function P(u,h){function g(){}g.prototype=h.prototype,u.aa=h.prototype,u.prototype=new g,u.prototype.constructor=u,u.Qb=function(b,M,z){for(var me=Array(arguments.length-2),vt=2;vt<arguments.length;vt++)me[vt-2]=arguments[vt];return h.prototype[M].apply(b,me)}}function A(u){const h=u.length;if(0<h){const g=Array(h);for(let b=0;b<h;b++)g[b]=u[b];return g}return[]}function R(u,h){for(let g=1;g<arguments.length;g++){const b=arguments[g];if(l(b)){const M=u.length||0,z=b.length||0;u.length=M+z;for(let me=0;me<z;me++)u[M+me]=b[me]}else u.push(b)}}class j{constructor(h,g){this.i=h,this.j=g,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function B(u){return/^[\s\xa0]*$/.test(u)}function F(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function G(u){return G[" "](u),u}G[" "]=function(){};var oe=F().indexOf("Gecko")!=-1&&!(F().toLowerCase().indexOf("webkit")!=-1&&F().indexOf("Edge")==-1)&&!(F().indexOf("Trident")!=-1||F().indexOf("MSIE")!=-1)&&F().indexOf("Edge")==-1;function ie(u,h,g){for(const b in u)h.call(g,u[b],b,u)}function I(u,h){for(const g in u)h.call(void 0,u[g],g,u)}function E(u){const h={};for(const g in u)h[g]=u[g];return h}const x="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function k(u,h){let g,b;for(let M=1;M<arguments.length;M++){b=arguments[M];for(g in b)u[g]=b[g];for(let z=0;z<x.length;z++)g=x[z],Object.prototype.hasOwnProperty.call(b,g)&&(u[g]=b[g])}}function V(u){var h=1;u=u.split(":");const g=[];for(;0<h&&u.length;)g.push(u.shift()),h--;return u.length&&g.push(u.join(":")),g}function D(u){a.setTimeout(()=>{throw u},0)}function w(){var u=ke;let h=null;return u.g&&(h=u.g,u.g=u.g.next,u.g||(u.h=null),h.next=null),h}class He{constructor(){this.h=this.g=null}add(h,g){const b=We.get();b.set(h,g),this.h?this.h.next=b:this.g=b,this.h=b}}var We=new j(()=>new Xe,u=>u.reset());class Xe{constructor(){this.next=this.g=this.h=null}set(h,g){this.h=h,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let $e,je=!1,ke=new He,ee=()=>{const u=a.Promise.resolve(void 0);$e=()=>{u.then(De)}};var De=()=>{for(var u;u=w();){try{u.h.call(u.g)}catch(g){D(g)}var h=We;h.j(u),100>h.h&&(h.h++,u.next=h.g,h.g=u)}je=!1};function H(){this.s=this.s,this.C=this.C}H.prototype.s=!1,H.prototype.ma=function(){this.s||(this.s=!0,this.N())},H.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Y(u,h){this.type=u,this.g=this.target=h,this.defaultPrevented=!1}Y.prototype.h=function(){this.defaultPrevented=!0};var Ve=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,h=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const g=()=>{};a.addEventListener("test",g,h),a.removeEventListener("test",g,h)}catch{}return u}();function Ze(u,h){if(Y.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var g=this.type=u.type,b=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=h,h=u.relatedTarget){if(oe){e:{try{G(h.nodeName);var M=!0;break e}catch{}M=!1}M||(h=null)}}else g=="mouseover"?h=u.fromElement:g=="mouseout"&&(h=u.toElement);this.relatedTarget=h,b?(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:nt[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&Ze.aa.h.call(this)}}P(Ze,Y);var nt={2:"touch",3:"pen",4:"mouse"};Ze.prototype.h=function(){Ze.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var K="closure_listenable_"+(1e6*Math.random()|0),ye=0;function le(u,h,g,b,M){this.listener=u,this.proxy=null,this.src=h,this.type=g,this.capture=!!b,this.ha=M,this.key=++ye,this.da=this.fa=!1}function Ae(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function Ye(u){this.src=u,this.g={},this.h=0}Ye.prototype.add=function(u,h,g,b,M){var z=u.toString();u=this.g[z],u||(u=this.g[z]=[],this.h++);var me=T(u,h,b,M);return-1<me?(h=u[me],g||(h.fa=!1)):(h=new le(h,this.src,z,!!b,M),h.fa=g,u.push(h)),h};function ht(u,h){var g=h.type;if(g in u.g){var b=u.g[g],M=Array.prototype.indexOf.call(b,h,void 0),z;(z=0<=M)&&Array.prototype.splice.call(b,M,1),z&&(Ae(h),u.g[g].length==0&&(delete u.g[g],u.h--))}}function T(u,h,g,b){for(var M=0;M<u.length;++M){var z=u[M];if(!z.da&&z.listener==h&&z.capture==!!g&&z.ha==b)return M}return-1}var S="closure_lm_"+(1e6*Math.random()|0),N={};function X(u,h,g,b,M){if(b&&b.once)return ge(u,h,g,b,M);if(Array.isArray(h)){for(var z=0;z<h.length;z++)X(u,h[z],g,b,M);return null}return g=Pe(g),u&&u[K]?u.K(h,g,c(b)?!!b.capture:!!b,M):Q(u,h,g,!1,b,M)}function Q(u,h,g,b,M,z){if(!h)throw Error("Invalid event type");var me=c(M)?!!M.capture:!!M,vt=_e(u);if(vt||(u[S]=vt=new Ye(u)),g=vt.add(h,g,b,me,z),g.proxy)return g;if(b=Z(),g.proxy=b,b.src=u,b.listener=g,u.addEventListener)Ve||(M=me),M===void 0&&(M=!1),u.addEventListener(h.toString(),b,M);else if(u.attachEvent)u.attachEvent(se(h.toString()),b);else if(u.addListener&&u.removeListener)u.addListener(b);else throw Error("addEventListener and attachEvent are unavailable.");return g}function Z(){function u(g){return h.call(u.src,u.listener,g)}const h=Ee;return u}function ge(u,h,g,b,M){if(Array.isArray(h)){for(var z=0;z<h.length;z++)ge(u,h[z],g,b,M);return null}return g=Pe(g),u&&u[K]?u.L(h,g,c(b)?!!b.capture:!!b,M):Q(u,h,g,!0,b,M)}function ue(u,h,g,b,M){if(Array.isArray(h))for(var z=0;z<h.length;z++)ue(u,h[z],g,b,M);else b=c(b)?!!b.capture:!!b,g=Pe(g),u&&u[K]?(u=u.i,h=String(h).toString(),h in u.g&&(z=u.g[h],g=T(z,g,b,M),-1<g&&(Ae(z[g]),Array.prototype.splice.call(z,g,1),z.length==0&&(delete u.g[h],u.h--)))):u&&(u=_e(u))&&(h=u.g[h.toString()],u=-1,h&&(u=T(h,g,b,M)),(g=-1<u?h[u]:null)&&ae(g))}function ae(u){if(typeof u!="number"&&u&&!u.da){var h=u.src;if(h&&h[K])ht(h.i,u);else{var g=u.type,b=u.proxy;h.removeEventListener?h.removeEventListener(g,b,u.capture):h.detachEvent?h.detachEvent(se(g),b):h.addListener&&h.removeListener&&h.removeListener(b),(g=_e(h))?(ht(g,u),g.h==0&&(g.src=null,h[S]=null)):Ae(u)}}}function se(u){return u in N?N[u]:N[u]="on"+u}function Ee(u,h){if(u.da)u=!0;else{h=new Ze(h,this);var g=u.listener,b=u.ha||u.src;u.fa&&ae(u),u=g.call(b,h)}return u}function _e(u){return u=u[S],u instanceof Ye?u:null}var Te="__closure_events_fn_"+(1e9*Math.random()>>>0);function Pe(u){return typeof u=="function"?u:(u[Te]||(u[Te]=function(h){return u.handleEvent(h)}),u[Te])}function Ne(){H.call(this),this.i=new Ye(this),this.M=this,this.F=null}P(Ne,H),Ne.prototype[K]=!0,Ne.prototype.removeEventListener=function(u,h,g,b){ue(this,u,h,g,b)};function qe(u,h){var g,b=u.F;if(b)for(g=[];b;b=b.F)g.push(b);if(u=u.M,b=h.type||h,typeof h=="string")h=new Y(h,u);else if(h instanceof Y)h.target=h.target||u;else{var M=h;h=new Y(b,u),k(h,M)}if(M=!0,g)for(var z=g.length-1;0<=z;z--){var me=h.g=g[z];M=tt(me,b,!0,h)&&M}if(me=h.g=u,M=tt(me,b,!0,h)&&M,M=tt(me,b,!1,h)&&M,g)for(z=0;z<g.length;z++)me=h.g=g[z],M=tt(me,b,!1,h)&&M}Ne.prototype.N=function(){if(Ne.aa.N.call(this),this.i){var u=this.i,h;for(h in u.g){for(var g=u.g[h],b=0;b<g.length;b++)Ae(g[b]);delete u.g[h],u.h--}}this.F=null},Ne.prototype.K=function(u,h,g,b){return this.i.add(String(u),h,!1,g,b)},Ne.prototype.L=function(u,h,g,b){return this.i.add(String(u),h,!0,g,b)};function tt(u,h,g,b){if(h=u.i.g[String(h)],!h)return!0;h=h.concat();for(var M=!0,z=0;z<h.length;++z){var me=h[z];if(me&&!me.da&&me.capture==g){var vt=me.listener,ln=me.ha||me.src;me.fa&&ht(u.i,me),M=vt.call(ln,b)!==!1&&M}}return M&&!b.defaultPrevented}function Gt(u,h,g){if(typeof u=="function")g&&(u=v(u,g));else if(u&&typeof u.handleEvent=="function")u=v(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(u,h||0)}function Ft(u){u.g=Gt(()=>{u.g=null,u.i&&(u.i=!1,Ft(u))},u.l);const h=u.h;u.h=null,u.m.apply(null,h)}class fn extends H{constructor(h,g){super(),this.m=h,this.l=g,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:Ft(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Jt(u){H.call(this),this.h=u,this.g={}}P(Jt,H);var xn=[];function sr(u){ie(u.g,function(h,g){this.g.hasOwnProperty(g)&&ae(h)},u),u.g={}}Jt.prototype.N=function(){Jt.aa.N.call(this),sr(this)},Jt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Pt=a.JSON.stringify,an=a.JSON.parse,Xn=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function bo(){}bo.prototype.h=null;function Ai(u){return u.h||(u.h=u.i())}function wo(){}var Si={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function qn(){Y.call(this,"d")}P(qn,Y);function Io(){Y.call(this,"c")}P(Io,Y);var xr={},Eo=null;function To(){return Eo=Eo||new Ne}xr.La="serverreachability";function An(u){Y.call(this,xr.La,u)}P(An,Y);function ir(u){const h=To();qe(h,new An(h))}xr.STAT_EVENT="statevent";function Ja(u,h){Y.call(this,xr.STAT_EVENT,u),this.stat=h}P(Ja,Y);function pn(u){const h=To();qe(h,new Ja(h,u))}xr.Ma="timingevent";function Ds(u,h){Y.call(this,xr.Ma,u),this.size=h}P(Ds,Y);function mr(u,h){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},h)}function Ar(){this.g=!0}Ar.prototype.xa=function(){this.g=!1};function Vs(u,h,g,b,M,z){u.info(function(){if(u.g)if(z)for(var me="",vt=z.split("&"),ln=0;ln<vt.length;ln++){var it=vt[ln].split("=");if(1<it.length){var un=it[0];it=it[1];var mn=un.split("_");me=2<=mn.length&&mn[1]=="type"?me+(un+"="+it+"&"):me+(un+"=redacted&")}}else me=null;else me=z;return"XMLHTTP REQ ("+b+") [attempt "+M+"]: "+h+`
`+g+`
`+me})}function Gu(u,h,g,b,M,z,me){u.info(function(){return"XMLHTTP RESP ("+b+") [ attempt "+M+"]: "+h+`
`+g+`
`+z+" "+me})}function gr(u,h,g,b){u.info(function(){return"XMLHTTP TEXT ("+h+"): "+wh(u,g)+(b?" "+b:"")})}function vr(u,h){u.info(function(){return"TIMEOUT: "+h})}Ar.prototype.info=function(){};function wh(u,h){if(!u.g)return h;if(!h)return null;try{var g=JSON.parse(h);if(g){for(u=0;u<g.length;u++)if(Array.isArray(g[u])){var b=g[u];if(!(2>b.length)){var M=b[1];if(Array.isArray(M)&&!(1>M.length)){var z=M[0];if(z!="noop"&&z!="stop"&&z!="close")for(var me=1;me<M.length;me++)M[me]=""}}}}return Pt(g)}catch{return h}}var xo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ku={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ao;function yr(){}P(yr,bo),yr.prototype.g=function(){return new XMLHttpRequest},yr.prototype.i=function(){return{}},Ao=new yr;function _r(u,h,g,b){this.j=u,this.i=h,this.l=g,this.R=b||1,this.U=new Jt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Hu}function Hu(){this.i=null,this.g="",this.h=!1}var So={},Po={};function Ns(u,h,g){u.L=1,u.v=ko(or(h)),u.m=g,u.P=!0,Ya(u,null)}function Ya(u,h){u.F=Date.now(),Le(u),u.A=or(u.v);var g=u.A,b=u.R;Array.isArray(b)||(b=[String(b)]),ec(g.i,"t",b),u.C=0,g=u.j.J,u.h=new Hu,u.g=cc(u.j,g?h:null,!u.m),0<u.O&&(u.M=new fn(v(u.Y,u,u.g),u.O)),h=u.U,g=u.g,b=u.ca;var M="readystatechange";Array.isArray(M)||(M&&(xn[0]=M.toString()),M=xn);for(var z=0;z<M.length;z++){var me=X(g,M[z],b||h.handleEvent,!1,h.h||h);if(!me)break;h.g[me.key]=me}h=u.H?E(u.H):{},u.m?(u.u||(u.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,h)):(u.u="GET",u.g.ea(u.A,u.u,null,h)),ir(),Vs(u.i,u.u,u.A,u.l,u.R,u.m)}_r.prototype.ca=function(u){u=u.target;const h=this.M;h&&br(u)==3?h.j():this.Y(u)},_r.prototype.Y=function(u){try{if(u==this.g)e:{const mn=br(this.g);var h=this.g.Ba();const ts=this.g.Z();if(!(3>mn)&&(mn!=3||this.g&&(this.h.h||this.g.oa()||ic(this.g)))){this.J||mn!=4||h==7||(h==8||0>=ts?ir(3):ir(2)),Gr(this);var g=this.g.Z();this.X=g;t:if(Pi(this)){var b=ic(this.g);u="";var M=b.length,z=br(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Hr(this),Kr(this);var me="";break t}this.h.i=new a.TextDecoder}for(h=0;h<M;h++)this.h.h=!0,u+=this.h.i.decode(b[h],{stream:!(z&&h==M-1)});b.length=0,this.h.g+=u,this.C=0,me=this.h.g}else me=this.g.oa();if(this.o=g==200,Gu(this.i,this.u,this.A,this.l,this.R,mn,g),this.o){if(this.T&&!this.K){t:{if(this.g){var vt,ln=this.g;if((vt=ln.g?ln.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(vt)){var it=vt;break t}}it=null}if(g=it)gr(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ro(this,g);else{this.o=!1,this.s=3,pn(12),Hr(this),Kr(this);break e}}if(this.P){g=!0;let _;for(;!this.J&&this.C<me.length;)if(_=Xa(this,me),_==Po){mn==4&&(this.s=4,pn(14),g=!1),gr(this.i,this.l,null,"[Incomplete Response]");break}else if(_==So){this.s=4,pn(15),gr(this.i,this.l,me,"[Invalid Chunk]"),g=!1;break}else gr(this.i,this.l,_,null),Ro(this,_);if(Pi(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),mn!=4||me.length!=0||this.h.h||(this.s=1,pn(16),g=!1),this.o=this.o&&g,!g)gr(this.i,this.l,me,"[Invalid Chunked Response]"),Hr(this),Kr(this);else if(0<me.length&&!this.W){this.W=!0;var un=this.j;un.g==this&&un.ba&&!un.M&&(un.j.info("Great, no buffering proxy detected. Bytes received: "+me.length),rl(un),un.M=!0,pn(11))}}else gr(this.i,this.l,me,null),Ro(this,me);mn==4&&Hr(this),this.o&&!this.J&&(mn==4?sl(this.j,this):(this.o=!1,Le(this)))}else Ph(this.g),g==400&&0<me.indexOf("Unknown SID")?(this.s=3,pn(12)):(this.s=0,pn(13)),Hr(this),Kr(this)}}}catch{}finally{}};function Pi(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function Xa(u,h){var g=u.C,b=h.indexOf(`
`,g);return b==-1?Po:(g=Number(h.substring(g,b)),isNaN(g)?So:(b+=1,b+g>h.length?Po:(h=h.slice(b,b+g),u.C=b+g,h)))}_r.prototype.cancel=function(){this.J=!0,Hr(this)};function Le(u){u.S=Date.now()+u.I,bt(u,u.I)}function bt(u,h){if(u.B!=null)throw Error("WatchDog timer not null");u.B=mr(v(u.ba,u),h)}function Gr(u){u.B&&(a.clearTimeout(u.B),u.B=null)}_r.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(vr(this.i,this.A),this.L!=2&&(ir(),pn(17)),Hr(this),this.s=2,Kr(this)):bt(this,this.S-u)};function Kr(u){u.j.G==0||u.J||sl(u.j,u)}function Hr(u){Gr(u);var h=u.M;h&&typeof h.ma=="function"&&h.ma(),u.M=null,sr(u.U),u.g&&(h=u.g,u.g=null,h.abort(),h.ma())}function Ro(u,h){try{var g=u.j;if(g.G!=0&&(g.g==u||Wr(g.h,u))){if(!u.K&&Wr(g.h,u)&&g.G==3){try{var b=g.Da.g.parse(h)}catch{b=null}if(Array.isArray(b)&&b.length==3){var M=b;if(M[0]==0){e:if(!g.u){if(g.g)if(g.g.F+3e3<u.F)$o(g),Mo(g);else break e;Uo(g),pn(18)}}else g.za=M[1],0<g.za-g.T&&37500>M[2]&&g.F&&g.v==0&&!g.C&&(g.C=mr(v(g.Za,g),6e3));if(1>=Qu(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else Rr(g,11)}else if((u.K||g.g==u)&&$o(g),!B(h))for(M=g.Da.g.parse(h),h=0;h<M.length;h++){let it=M[h];if(g.T=it[0],it=it[1],g.G==2)if(it[0]=="c"){g.K=it[1],g.ia=it[2];const un=it[3];un!=null&&(g.la=un,g.j.info("VER="+g.la));const mn=it[4];mn!=null&&(g.Aa=mn,g.j.info("SVER="+g.Aa));const ts=it[5];ts!=null&&typeof ts=="number"&&0<ts&&(b=1.5*ts,g.L=b,g.j.info("backChannelRequestTimeoutMs_="+b)),b=g;const _=u.g;if(_){const m=_.g?_.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(m){var z=b.h;z.g||m.indexOf("spdy")==-1&&m.indexOf("quic")==-1&&m.indexOf("h2")==-1||(z.j=z.l,z.g=new Set,z.h&&(Os(z,z.h),z.h=null))}if(b.D){const C=_.g?_.g.getResponseHeader("X-HTTP-Session-Id"):null;C&&(b.ya=C,Me(b.I,b.D,C))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-u.F,g.j.info("Handshake RTT: "+g.R+"ms")),b=g;var me=u;if(b.qa=uc(b,b.J?b.ia:null,b.W),me.K){Qr(b.h,me);var vt=me,ln=b.L;ln&&(vt.I=ln),vt.B&&(Gr(vt),Le(vt)),b.g=me}else Fo(b);0<g.i.length&&Lo(g)}else it[0]!="stop"&&it[0]!="close"||Rr(g,7);else g.G==3&&(it[0]=="stop"||it[0]=="close"?it[0]=="stop"?Rr(g,7):Oo(g):it[0]!="noop"&&g.l&&g.l.ta(it),g.v=0)}}ir(4)}catch{}}var Ih=class{constructor(u,h){this.g=u,this.map=h}};function Wu(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Co(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function Qu(u){return u.h?1:u.g?u.g.size:0}function Wr(u,h){return u.h?u.h==h:u.g?u.g.has(h):!1}function Os(u,h){u.g?u.g.add(h):u.h=h}function Qr(u,h){u.h&&u.h==h?u.h=null:u.g&&u.g.has(h)&&u.g.delete(h)}Wu.prototype.cancel=function(){if(this.i=Jr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function Jr(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let h=u.i;for(const g of u.g.values())h=h.concat(g.D);return h}return A(u.i)}function Ri(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var h=[],g=u.length,b=0;b<g;b++)h.push(u[b]);return h}h=[],g=0;for(b in u)h[g++]=u[b];return h}function Ci(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var h=[];u=u.length;for(var g=0;g<u;g++)h.push(g);return h}h=[],g=0;for(const b in u)h[g++]=b;return h}}}function ki(u,h){if(u.forEach&&typeof u.forEach=="function")u.forEach(h,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,h,void 0);else for(var g=Ci(u),b=Ri(u),M=b.length,z=0;z<M;z++)h.call(void 0,b[z],g&&g[z],u)}var Ju=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Eh(u,h){if(u){u=u.split("&");for(var g=0;g<u.length;g++){var b=u[g].indexOf("="),M=null;if(0<=b){var z=u[g].substring(0,b);M=u[g].substring(b+1)}else z=u[g];h(z,M?decodeURIComponent(M.replace(/\+/g," ")):"")}}}function Yr(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof Yr){this.h=u.h,ze(this,u.j),this.o=u.o,this.g=u.g,et(this,u.s),this.l=u.l;var h=u.i,g=new Sr;g.i=h.i,h.g&&(g.g=new Map(h.g),g.h=h.h),Kt(this,g),this.m=u.m}else u&&(h=String(u).match(Ju))?(this.h=!1,ze(this,h[1]||"",!0),this.o=Xr(h[2]||""),this.g=Xr(h[3]||"",!0),et(this,h[4]),this.l=Xr(h[5]||"",!0),Kt(this,h[6]||"",!0),this.m=Xr(h[7]||"")):(this.h=!1,this.i=new Sr(null,this.h))}Yr.prototype.toString=function(){var u=[],h=this.j;h&&u.push(Ms(h,Yu,!0),":");var g=this.g;return(g||h=="file")&&(u.push("//"),(h=this.o)&&u.push(Ms(h,Yu,!0),"@"),u.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.s,g!=null&&u.push(":",String(g))),(g=this.l)&&(this.g&&g.charAt(0)!="/"&&u.push("/"),u.push(Ms(g,g.charAt(0)=="/"?Zr:Th,!0))),(g=this.i.toString())&&u.push("?",g),(g=this.m)&&u.push("#",Ms(g,Xu)),u.join("")};function or(u){return new Yr(u)}function ze(u,h,g){u.j=g?Xr(h,!0):h,u.j&&(u.j=u.j.replace(/:$/,""))}function et(u,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);u.s=h}else u.s=null}function Kt(u,h,g){h instanceof Sr?(u.i=h,Za(u.i,u.h)):(g||(h=Ms(h,zn)),u.i=new Sr(h,u.h))}function Me(u,h,g){u.i.set(h,g)}function ko(u){return Me(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Xr(u,h){return u?h?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Ms(u,h,g){return typeof u=="string"?(u=encodeURI(u).replace(h,Di),g&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Di(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var Yu=/[#\/\?@]/g,Th=/[#\?:]/g,Zr=/[#\?]/g,zn=/[#\?@]/g,Xu=/#/g;function Sr(u,h){this.h=this.g=null,this.i=u||null,this.j=!!h}function ar(u){u.g||(u.g=new Map,u.h=0,u.i&&Eh(u.i,function(h,g){u.add(decodeURIComponent(h.replace(/\+/g," ")),g)}))}n=Sr.prototype,n.add=function(u,h){ar(this),this.i=null,u=es(this,u);var g=this.g.get(u);return g||this.g.set(u,g=[]),g.push(h),this.h+=1,this};function lr(u,h){ar(u),h=es(u,h),u.g.has(h)&&(u.i=null,u.h-=u.g.get(h).length,u.g.delete(h))}function Zu(u,h){return ar(u),h=es(u,h),u.g.has(h)}n.forEach=function(u,h){ar(this),this.g.forEach(function(g,b){g.forEach(function(M){u.call(h,M,b,this)},this)},this)},n.na=function(){ar(this);const u=Array.from(this.g.values()),h=Array.from(this.g.keys()),g=[];for(let b=0;b<h.length;b++){const M=u[b];for(let z=0;z<M.length;z++)g.push(h[b])}return g},n.V=function(u){ar(this);let h=[];if(typeof u=="string")Zu(this,u)&&(h=h.concat(this.g.get(es(this,u))));else{u=Array.from(this.g.values());for(let g=0;g<u.length;g++)h=h.concat(u[g])}return h},n.set=function(u,h){return ar(this),this.i=null,u=es(this,u),Zu(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[h]),this.h+=1,this},n.get=function(u,h){return u?(u=this.V(u),0<u.length?String(u[0]):h):h};function ec(u,h,g){lr(u,h),0<g.length&&(u.i=null,u.g.set(es(u,h),A(g)),u.h+=g.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],h=Array.from(this.g.keys());for(var g=0;g<h.length;g++){var b=h[g];const z=encodeURIComponent(String(b)),me=this.V(b);for(b=0;b<me.length;b++){var M=z;me[b]!==""&&(M+="="+encodeURIComponent(String(me[b]))),u.push(M)}}return this.i=u.join("&")};function es(u,h){return h=String(h),u.j&&(h=h.toLowerCase()),h}function Za(u,h){h&&!u.j&&(ar(u),u.i=null,u.g.forEach(function(g,b){var M=b.toLowerCase();b!=M&&(lr(this,b),ec(this,M,g))},u)),u.j=h}function xh(u,h){const g=new Ar;if(a.Image){const b=new Image;b.onload=y(Ln,g,"TestLoadImage: loaded",!0,h,b),b.onerror=y(Ln,g,"TestLoadImage: error",!1,h,b),b.onabort=y(Ln,g,"TestLoadImage: abort",!1,h,b),b.ontimeout=y(Ln,g,"TestLoadImage: timeout",!1,h,b),a.setTimeout(function(){b.ontimeout&&b.ontimeout()},1e4),b.src=u}else h(!1)}function el(u,h){const g=new Ar,b=new AbortController,M=setTimeout(()=>{b.abort(),Ln(g,"TestPingServer: timeout",!1,h)},1e4);fetch(u,{signal:b.signal}).then(z=>{clearTimeout(M),z.ok?Ln(g,"TestPingServer: ok",!0,h):Ln(g,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(M),Ln(g,"TestPingServer: error",!1,h)})}function Ln(u,h,g,b,M){try{M&&(M.onload=null,M.onerror=null,M.onabort=null,M.ontimeout=null),b(g)}catch{}}function tl(){this.g=new Xn}function Do(u,h,g){const b=g||"";try{ki(u,function(M,z){let me=M;c(M)&&(me=Pt(M)),h.push(b+z+"="+encodeURIComponent(me))})}catch(M){throw h.push(b+"type="+encodeURIComponent("_badmap")),M}}function Ls(u){this.l=u.Ub||null,this.j=u.eb||!1}P(Ls,bo),Ls.prototype.g=function(){return new Vi(this.l,this.j)},Ls.prototype.i=function(u){return function(){return u}}({});function Vi(u,h){Ne.call(this),this.D=u,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}P(Vi,Ne),n=Vi.prototype,n.open=function(u,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=h,this.readyState=1,Fs(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(h.body=u),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ni(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Fs(this)),this.g&&(this.readyState=3,Fs(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;tc(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function tc(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var h=u.value?u.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!u.done}))&&(this.response=this.responseText+=h)}u.done?Ni(this):Fs(this),this.readyState==3&&tc(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,Ni(this))},n.Qa=function(u){this.g&&(this.response=u,Ni(this))},n.ga=function(){this.g&&Ni(this)};function Ni(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Fs(u)}n.setRequestHeader=function(u,h){this.u.append(u,h)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],h=this.h.entries();for(var g=h.next();!g.done;)g=g.value,u.push(g[0]+": "+g[1]),g=h.next();return u.join(`\r
`)};function Fs(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(Vi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function Vo(u){let h="";return ie(u,function(g,b){h+=b,h+=":",h+=g,h+=`\r
`}),h}function Us(u,h,g){e:{for(b in g){var b=!1;break e}b=!0}b||(g=Vo(g),typeof u=="string"?g!=null&&encodeURIComponent(String(g)):Me(u,h,g))}function Et(u){Ne.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}P(Et,Ne);var Ah=/^https?$/i,Sh=["POST","PUT"];n=Et.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,h,g,b){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);h=h?h.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ao.g(),this.v=this.o?Ai(this.o):Ai(Ao),this.g.onreadystatechange=v(this.Ea,this);try{this.B=!0,this.g.open(h,String(u),!0),this.B=!1}catch(z){nc(this,z);return}if(u=g||"",g=new Map(this.headers),b)if(Object.getPrototypeOf(b)===Object.prototype)for(var M in b)g.set(M,b[M]);else if(typeof b.keys=="function"&&typeof b.get=="function")for(const z of b.keys())g.set(z,b.get(z));else throw Error("Unknown input type for opt_headers: "+String(b));b=Array.from(g.keys()).find(z=>z.toLowerCase()=="content-type"),M=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(Sh,h,void 0))||b||M||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[z,me]of g)this.g.setRequestHeader(z,me);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{$s(this),this.u=!0,this.g.send(u),this.u=!1}catch(z){nc(this,z)}};function nc(u,h){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=h,u.m=5,rc(u),No(u)}function rc(u){u.A||(u.A=!0,qe(u,"complete"),qe(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,qe(this,"complete"),qe(this,"abort"),No(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),No(this,!0)),Et.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?sc(this):this.bb())},n.bb=function(){sc(this)};function sc(u){if(u.h&&typeof o<"u"&&(!u.v[1]||br(u)!=4||u.Z()!=2)){if(u.u&&br(u)==4)Gt(u.Ea,0,u);else if(qe(u,"readystatechange"),br(u)==4){u.h=!1;try{const me=u.Z();e:switch(me){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var g;if(!(g=h)){var b;if(b=me===0){var M=String(u.D).match(Ju)[1]||null;!M&&a.self&&a.self.location&&(M=a.self.location.protocol.slice(0,-1)),b=!Ah.test(M?M.toLowerCase():"")}g=b}if(g)qe(u,"complete"),qe(u,"success");else{u.m=6;try{var z=2<br(u)?u.g.statusText:""}catch{z=""}u.l=z+" ["+u.Z()+"]",rc(u)}}finally{No(u)}}}}function No(u,h){if(u.g){$s(u);const g=u.g,b=u.v[0]?()=>{}:null;u.g=null,u.v=null,h||qe(u,"ready");try{g.onreadystatechange=b}catch{}}}function $s(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function br(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<br(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var h=this.g.responseText;return u&&h.indexOf(u)==0&&(h=h.substring(u.length)),an(h)}};function ic(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Ph(u){const h={};u=(u.g&&2<=br(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let b=0;b<u.length;b++){if(B(u[b]))continue;var g=V(u[b]);const M=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const z=h[M]||[];h[M]=z,z.push(g)}I(h,function(b){return b.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function js(u,h,g){return g&&g.internalChannelParams&&g.internalChannelParams[u]||h}function oc(u){this.Aa=0,this.i=[],this.j=new Ar,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=js("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=js("baseRetryDelayMs",5e3,u),this.cb=js("retryDelaySeedMs",1e4,u),this.Wa=js("forwardChannelMaxRetries",2,u),this.wa=js("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new Wu(u&&u.concurrentRequestLimit),this.Da=new tl,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=oc.prototype,n.la=8,n.G=1,n.connect=function(u,h,g,b){pn(0),this.W=u,this.H=h||{},g&&b!==void 0&&(this.H.OSID=g,this.H.OAID=b),this.F=this.X,this.I=uc(this,null,this.W),Lo(this)};function Oo(u){if(ac(u),u.G==3){var h=u.U++,g=or(u.I);if(Me(g,"SID",u.K),Me(g,"RID",h),Me(g,"TYPE","terminate"),Oi(u,g),h=new _r(u,u.j,h),h.L=2,h.v=ko(or(g)),g=!1,a.navigator&&a.navigator.sendBeacon)try{g=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!g&&a.Image&&(new Image().src=h.v,g=!0),g||(h.g=cc(h.j,null),h.g.ea(h.v)),h.F=Date.now(),Le(h)}ol(u)}function Mo(u){u.g&&(rl(u),u.g.cancel(),u.g=null)}function ac(u){Mo(u),u.u&&(a.clearTimeout(u.u),u.u=null),$o(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function Lo(u){if(!Co(u.h)&&!u.s){u.s=!0;var h=u.Ga;$e||ee(),je||($e(),je=!0),ke.add(h,u),u.B=0}}function Rh(u,h){return Qu(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=h.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=mr(v(u.Ga,u,h),il(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const M=new _r(this,this.j,u);let z=this.o;if(this.S&&(z?(z=E(z),k(z,this.S)):z=this.S),this.m!==null||this.O||(M.H=z,z=null),this.P)e:{for(var h=0,g=0;g<this.i.length;g++){t:{var b=this.i[g];if("__data__"in b.map&&(b=b.map.__data__,typeof b=="string")){b=b.length;break t}b=void 0}if(b===void 0)break;if(h+=b,4096<h){h=g;break e}if(h===4096||g===this.i.length-1){h=g+1;break e}}h=1e3}else h=1e3;h=nl(this,M,h),g=or(this.I),Me(g,"RID",u),Me(g,"CVER",22),this.D&&Me(g,"X-HTTP-Session-Id",this.D),Oi(this,g),z&&(this.O?h="headers="+encodeURIComponent(String(Vo(z)))+"&"+h:this.m&&Us(g,this.m,z)),Os(this.h,M),this.Ua&&Me(g,"TYPE","init"),this.P?(Me(g,"$req",h),Me(g,"SID","null"),M.T=!0,Ns(M,g,null)):Ns(M,g,h),this.G=2}}else this.G==3&&(u?Pr(this,u):this.i.length==0||Co(this.h)||Pr(this))};function Pr(u,h){var g;h?g=h.l:g=u.U++;const b=or(u.I);Me(b,"SID",u.K),Me(b,"RID",g),Me(b,"AID",u.T),Oi(u,b),u.m&&u.o&&Us(b,u.m,u.o),g=new _r(u,u.j,g,u.B+1),u.m===null&&(g.H=u.o),h&&(u.i=h.D.concat(u.i)),h=nl(u,g,1e3),g.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),Os(u.h,g),Ns(g,b,h)}function Oi(u,h){u.H&&ie(u.H,function(g,b){Me(h,b,g)}),u.l&&ki({},function(g,b){Me(h,b,g)})}function nl(u,h,g){g=Math.min(u.i.length,g);var b=u.l?v(u.l.Na,u.l,u):null;e:{var M=u.i;let z=-1;for(;;){const me=["count="+g];z==-1?0<g?(z=M[0].g,me.push("ofs="+z)):z=0:me.push("ofs="+z);let vt=!0;for(let ln=0;ln<g;ln++){let it=M[ln].g;const un=M[ln].map;if(it-=z,0>it)z=Math.max(0,M[ln].g-100),vt=!1;else try{Do(un,me,"req"+it+"_")}catch{b&&b(un)}}if(vt){b=me.join("&");break e}}}return u=u.i.splice(0,g),h.D=u,b}function Fo(u){if(!u.g&&!u.u){u.Y=1;var h=u.Fa;$e||ee(),je||($e(),je=!0),ke.add(h,u),u.v=0}}function Uo(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=mr(v(u.Fa,u),il(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,lc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=mr(v(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,pn(10),Mo(this),lc(this))};function rl(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function lc(u){u.g=new _r(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var h=or(u.qa);Me(h,"RID","rpc"),Me(h,"SID",u.K),Me(h,"AID",u.T),Me(h,"CI",u.F?"0":"1"),!u.F&&u.ja&&Me(h,"TO",u.ja),Me(h,"TYPE","xmlhttp"),Oi(u,h),u.m&&u.o&&Us(h,u.m,u.o),u.L&&(u.g.I=u.L);var g=u.g;u=u.ia,g.L=1,g.v=ko(or(h)),g.m=null,g.P=!0,Ya(g,u)}n.Za=function(){this.C!=null&&(this.C=null,Mo(this),Uo(this),pn(19))};function $o(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function sl(u,h){var g=null;if(u.g==h){$o(u),rl(u),u.g=null;var b=2}else if(Wr(u.h,h))g=h.D,Qr(u.h,h),b=1;else return;if(u.G!=0){if(h.o)if(b==1){g=h.m?h.m.length:0,h=Date.now()-h.F;var M=u.B;b=To(),qe(b,new Ds(b,g)),Lo(u)}else Fo(u);else if(M=h.s,M==3||M==0&&0<h.X||!(b==1&&Rh(u,h)||b==2&&Uo(u)))switch(g&&0<g.length&&(h=u.h,h.i=h.i.concat(g)),M){case 1:Rr(u,5);break;case 4:Rr(u,10);break;case 3:Rr(u,6);break;default:Rr(u,2)}}}function il(u,h){let g=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(g*=2),g*h}function Rr(u,h){if(u.j.info("Error code "+h),h==2){var g=v(u.fb,u),b=u.Xa;const M=!b;b=new Yr(b||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||ze(b,"https"),ko(b),M?xh(b.toString(),g):el(b.toString(),g)}else pn(2);u.G=0,u.l&&u.l.sa(h),ol(u),ac(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),pn(2)):(this.j.info("Failed to ping google.com"),pn(1))};function ol(u){if(u.G=0,u.ka=[],u.l){const h=Jr(u.h);(h.length!=0||u.i.length!=0)&&(R(u.ka,h),R(u.ka,u.i),u.h.i.length=0,A(u.i),u.i.length=0),u.l.ra()}}function uc(u,h,g){var b=g instanceof Yr?or(g):new Yr(g);if(b.g!="")h&&(b.g=h+"."+b.g),et(b,b.s);else{var M=a.location;b=M.protocol,h=h?h+"."+M.hostname:M.hostname,M=+M.port;var z=new Yr(null);b&&ze(z,b),h&&(z.g=h),M&&et(z,M),g&&(z.l=g),b=z}return g=u.D,h=u.ya,g&&h&&Me(b,g,h),Me(b,"VER",u.la),Oi(u,b),b}function cc(u,h,g){if(h&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=u.Ca&&!u.pa?new Et(new Ls({eb:g})):new Et(u.pa),h.Ha(u.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function dc(){}n=dc.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Bs(){}Bs.prototype.g=function(u,h){return new Fn(u,h)};function Fn(u,h){Ne.call(this),this.g=new oc(h),this.l=u,this.h=h&&h.messageUrlParams||null,u=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(u?u["X-WebChannel-Content-Type"]=h.messageContentType:u={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(u?u["X-WebChannel-Client-Profile"]=h.va:u={"X-WebChannel-Client-Profile":h.va}),this.g.S=u,(u=h&&h.Sb)&&!B(u)&&(this.g.m=u),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!B(h)&&(this.g.D=h,u=this.h,u!==null&&h in u&&(u=this.h,h in u&&delete u[h])),this.j=new Cr(this)}P(Fn,Ne),Fn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Fn.prototype.close=function(){Oo(this.g)},Fn.prototype.o=function(u){var h=this.g;if(typeof u=="string"){var g={};g.__data__=u,u=g}else this.u&&(g={},g.__data__=Pt(u),u=g);h.i.push(new Ih(h.Ya++,u)),h.G==3&&Lo(h)},Fn.prototype.N=function(){this.g.l=null,delete this.j,Oo(this.g),delete this.g,Fn.aa.N.call(this)};function al(u){qn.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var h=u.__sm__;if(h){e:{for(const g in h){u=g;break e}u=void 0}(this.i=u)&&(u=this.i,h=h!==null&&u in h?h[u]:void 0),this.data=h}else this.data=u}P(al,qn);function hc(){Io.call(this),this.status=1}P(hc,Io);function Cr(u){this.g=u}P(Cr,dc),Cr.prototype.ua=function(){qe(this.g,"a")},Cr.prototype.ta=function(u){qe(this.g,new al(u))},Cr.prototype.sa=function(u){qe(this.g,new hc)},Cr.prototype.ra=function(){qe(this.g,"b")},Bs.prototype.createWebChannel=Bs.prototype.g,Fn.prototype.send=Fn.prototype.o,Fn.prototype.open=Fn.prototype.m,Fn.prototype.close=Fn.prototype.close,x0=function(){return new Bs},T0=function(){return To()},E0=xr,Rf={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},xo.NO_ERROR=0,xo.TIMEOUT=8,xo.HTTP_ERROR=6,kc=xo,Ku.COMPLETE="complete",I0=Ku,wo.EventType=Si,Si.OPEN="a",Si.CLOSE="b",Si.ERROR="c",Si.MESSAGE="d",Ne.prototype.listen=Ne.prototype.K,wl=wo,Et.prototype.listenOnce=Et.prototype.L,Et.prototype.getLastError=Et.prototype.Ka,Et.prototype.getLastErrorCode=Et.prototype.Ba,Et.prototype.getStatus=Et.prototype.Z,Et.prototype.getResponseJson=Et.prototype.Oa,Et.prototype.getResponseText=Et.prototype.oa,Et.prototype.send=Et.prototype.ea,Et.prototype.setWithCredentials=Et.prototype.Ha,w0=Et}).apply(typeof gc<"u"?gc:typeof self<"u"?self:typeof window<"u"?window:{});const rv="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}vn.UNAUTHENTICATED=new vn(null),vn.GOOGLE_CREDENTIALS=new vn("google-credentials-uid"),vn.FIRST_PARTY=new vn("first-party-uid"),vn.MOCK_USER=new vn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let La="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fi=new Tp("@firebase/firestore");function Yo(){return fi.logLevel}function t3(n){fi.setLogLevel(n)}function te(n,...e){if(fi.logLevel<=at.DEBUG){const t=e.map(Ap);fi.debug(`Firestore (${La}): ${n}`,...t)}}function Zt(n,...e){if(fi.logLevel<=at.ERROR){const t=e.map(Ap);fi.error(`Firestore (${La}): ${n}`,...t)}}function fr(n,...e){if(fi.logLevel<=at.WARN){const t=e.map(Ap);fi.warn(`Firestore (${La}): ${n}`,...t)}}function Ap(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xe(n="Unexpected state"){const e=`FIRESTORE (${La}) INTERNAL ASSERTION FAILED: `+n;throw Zt(e),new Error(e)}function Se(n,e){n||xe()}function n3(n,e){n||xe()}function ve(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ne extends Ts{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A0{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class nP{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(vn.UNAUTHENTICATED))}shutdown(){}}class rP{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class sP{constructor(e){this.t=e,this.currentUser=vn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Se(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new yn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new yn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{te("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(te("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new yn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(te("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Se(typeof r.accessToken=="string"),new A0(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Se(e===null||typeof e=="string"),new vn(e)}}class iP{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=vn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class oP{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new iP(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(vn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class S0{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class aP{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Se(this.o===void 0);const r=i=>{i.error!=null&&te("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,te("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{te("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):te("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Se(typeof t.token=="string"),this.R=t.token,new S0(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class r3{getToken(){return Promise.resolve(new S0(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lP(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=lP(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Be(n,e){return n<e?-1:n>e?1:0}function ya(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function R0(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ne(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ne(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new ne(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ne(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return qt.fromMillis(Date.now())}static fromDate(e){return qt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new qt(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Be(this.nanoseconds,e.nanoseconds):Be(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Re(e)}static min(){return new Re(new qt(0,0))}static max(){return new Re(new qt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jl{constructor(e,t,r){t===void 0?t=0:t>e.length&&xe(),r===void 0?r=e.length-t:r>e.length-t&&xe(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Jl.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Jl?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class lt extends Jl{construct(e,t,r){return new lt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new ne(q.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new lt(t)}static emptyPath(){return new lt([])}}const uP=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class jt extends Jl{construct(e,t,r){return new jt(e,t,r)}static isValidIdentifier(e){return uP.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),jt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new jt(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new ne(q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new ne(q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new ne(q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new ne(q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new jt(t)}static emptyPath(){return new jt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ie{constructor(e){this.path=e}static fromPath(e){return new Ie(lt.fromString(e))}static fromName(e){return new Ie(lt.fromString(e).popFirst(5))}static empty(){return new Ie(lt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&lt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return lt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ie(new lt(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _a{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function Cf(n){return n.fields.find(e=>e.kind===2)}function Bi(n){return n.fields.filter(e=>e.kind!==2)}function cP(n,e){let t=Be(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=dP(n.fields[r],e.fields[r]),t!==0)return t;return Be(n.fields.length,e.fields.length)}_a.UNKNOWN_ID=-1;class Xi{constructor(e,t){this.fieldPath=e,this.kind=t}}function dP(n,e){const t=jt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Be(n.kind,e.kind)}class ba{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ba(0,rr.min())}}function C0(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Re.fromTimestamp(r===1e9?new qt(t+1,0):new qt(t,r));return new rr(s,Ie.empty(),e)}function k0(n){return new rr(n.readTime,n.key,-1)}class rr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new rr(Re.min(),Ie.empty(),-1)}static max(){return new rr(Re.max(),Ie.empty(),-1)}}function Sp(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Ie.comparator(n.documentKey,e.documentKey),t!==0?t:Be(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D0="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class V0{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wi(n){if(n.code!==q.FAILED_PRECONDITION||n.message!==D0)throw n;te("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&xe(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new L((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof L?t:L.resolve(t)}catch(t){return L.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):L.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):L.reject(t)}static resolve(e){return new L((t,r)=>{t(e)})}static reject(e){return new L((t,r)=>{r(e)})}static waitFor(e){return new L((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=L.resolve(!1);for(const r of e)t=t.next(s=>s?L.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new L((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(d=>{o[c]=d,++a,a===i&&r(o)},d=>s(d))}})}static doWhile(e,t){return new L((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ud{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new yn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Ml(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=Pp(r.target.error);this.V.reject(new Ml(e,s))}}static open(e,t,r,s){try{return new Ud(t,e.transaction(s,r))}catch(i){throw new Ml(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(te("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new fP(t)}}class Ur{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Ur.S(dn())===12.2&&Zt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return te("SimpleDb","Removing database:",e),zi(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!f0())return!1;if(Ur.v())return!0;const e=dn(),t=Ur.S(e),r=0<t&&t<10,s=N0(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(te("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Ml(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new ne(q.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new ne(q.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Ml(e,o))},s.onupgradeneeded=i=>{te("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{te("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=Ud.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),L.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(te("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function N0(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class hP{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return zi(this.B.delete())}}class Ml extends ne{constructor(e,t){super(q.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ii(n){return n.name==="IndexedDbTransactionError"}class fP{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(te("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(te("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),zi(r)}add(e){return te("SimpleDb","ADD",this.store.name,e,e),zi(this.store.add(e))}get(e){return zi(this.store.get(e)).next(t=>(t===void 0&&(t=null),te("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return te("SimpleDb","DELETE",this.store.name,e),zi(this.store.delete(e))}count(){return te("SimpleDb","COUNT",this.store.name),zi(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new L((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new L((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){te("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new L((r,s)=>{t.onerror=i=>{const o=Pp(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new L((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new hP(a),c=t(a.primaryKey,a.value,l);if(c instanceof L){const d=c.catch(f=>(l.done(),L.reject(f)));r.push(d)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>L.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function zi(n){return new L((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Pp(r.target.error);t(s)}})}let sv=!1;function Pp(n){const e=Ur.S(dn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new ne("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return sv||(sv=!0,setTimeout(()=>{throw r},0)),r}}return n}class pP{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){te("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{te("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){Ii(t)?te("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await wi(t)}await this.X(6e4)})}}class mP{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return L.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return te("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(te("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=k0(i);Sp(o,r)>0&&(r=o)}),new rr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Wn.oe=-1;function Iu(n){return n==null}function Yl(n){return n===0&&1/n==-1/0}function O0(n){return typeof n=="number"&&Number.isInteger(n)&&!Yl(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function On(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=iv(e)),e=gP(n.get(t),e);return iv(e)}function gP(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function iv(n){return n+""}function Mr(n){const e=n.length;if(Se(e>=2),e===2)return Se(n.charAt(0)===""&&n.charAt(1)===""),lt.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&xe(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:xe()}i=o+2}return new lt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ov=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dc(n,e){return[n,On(e)]}function M0(n,e,t){return[n,On(e),t]}const vP={},yP=["prefixPath","collectionGroup","readTime","documentId"],_P=["prefixPath","collectionGroup","documentId"],bP=["collectionGroup","readTime","prefixPath","documentId"],wP=["canonicalId","targetId"],IP=["targetId","path"],EP=["path","targetId"],TP=["collectionId","parent"],xP=["indexId","uid"],AP=["uid","sequenceNumber"],SP=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],PP=["indexId","uid","orderedDocumentKey"],RP=["userId","collectionPath","documentId"],CP=["userId","collectionPath","largestBatchId"],kP=["userId","collectionGroup","largestBatchId"],L0=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],DP=[...L0,"documentOverlays"],F0=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],U0=F0,Rp=[...U0,"indexConfiguration","indexState","indexEntries"],VP=Rp,NP=[...Rp,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kf extends V0{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function hn(n,e){const t=ve(n);return Ur.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function av(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ei(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function $0(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function j0(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dt{constructor(e,t){this.comparator=e,this.root=t||wn.EMPTY}insert(e,t){return new Dt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,wn.BLACK,null,null))}remove(e){return new Dt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,wn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new vc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new vc(this.root,e,this.comparator,!1)}getReverseIterator(){return new vc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new vc(this.root,e,this.comparator,!0)}}class vc{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class wn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??wn.RED,this.left=s??wn.EMPTY,this.right=i??wn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new wn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return wn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return wn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,wn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,wn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw xe();const e=this.left.check();if(e!==this.right.check())throw xe();return e+(this.isRed()?0:1)}}wn.EMPTY=null,wn.RED=!0,wn.BLACK=!1;wn.EMPTY=new class{constructor(){this.size=0}get key(){throw xe()}get value(){throw xe()}get color(){throw xe()}get left(){throw xe()}get right(){throw xe()}copy(e,t,r,s,i){return this}insert(e,t,r){return new wn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class It{constructor(e){this.comparator=e,this.data=new Dt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new lv(this.data.getIterator())}getIteratorFrom(e){return new lv(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof It)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new It(this.comparator);return t.data=e,t}}class lv{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function qo(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{constructor(e){this.fields=e,e.sort(jt.comparator)}static empty(){return new Qn([])}unionWith(e){let t=new It(jt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Qn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ya(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B0 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i3(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new B0("Invalid base64 string: "+i):i}}(e);return new Wt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Wt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Be(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Wt.EMPTY_BYTE_STRING=new Wt("");const OP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ys(n){if(Se(!!n),typeof n=="string"){let e=0;const t=OP.exec(n);if(Se(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:$t(n.seconds),nanos:$t(n.nanos)}}function $t(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function _s(n){return typeof n=="string"?Wt.fromBase64String(n):Wt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $d(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function jd(n){const e=n.mapValue.fields.__previous_value__;return $d(e)?jd(e):e}function Xl(n){const e=ys(n.mapValue.fields.__local_write_time__.timestampValue);return new qt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MP{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class no{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new no("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof no&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const si={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Vc={nullValue:"NULL_VALUE"};function pi(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?$d(n)?4:q0(n)?9007199254740991:Bd(n)?10:11:xe()}function zr(n,e){if(n===e)return!0;const t=pi(n);if(t!==pi(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Xl(n).isEqual(Xl(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=ys(s.timestampValue),a=ys(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return _s(s.bytesValue).isEqual(_s(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return $t(s.geoPointValue.latitude)===$t(i.geoPointValue.latitude)&&$t(s.geoPointValue.longitude)===$t(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return $t(s.integerValue)===$t(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=$t(s.doubleValue),a=$t(i.doubleValue);return o===a?Yl(o)===Yl(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return ya(n.arrayValue.values||[],e.arrayValue.values||[],zr);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(av(o)!==av(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!zr(o[l],a[l])))return!1;return!0}(n,e);default:return xe()}}function Zl(n,e){return(n.values||[]).find(t=>zr(t,e))!==void 0}function mi(n,e){if(n===e)return 0;const t=pi(n),r=pi(e);if(t!==r)return Be(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Be(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=$t(i.integerValue||i.doubleValue),l=$t(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return uv(n.timestampValue,e.timestampValue);case 4:return uv(Xl(n),Xl(e));case 5:return Be(n.stringValue,e.stringValue);case 6:return function(i,o){const a=_s(i),l=_s(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const d=Be(a[c],l[c]);if(d!==0)return d}return Be(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Be($t(i.latitude),$t(o.latitude));return a!==0?a:Be($t(i.longitude),$t(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return cv(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,d;const f=i.fields||{},v=o.fields||{},y=(a=f.value)===null||a===void 0?void 0:a.arrayValue,P=(l=v.value)===null||l===void 0?void 0:l.arrayValue,A=Be(((c=y==null?void 0:y.values)===null||c===void 0?void 0:c.length)||0,((d=P==null?void 0:P.values)===null||d===void 0?void 0:d.length)||0);return A!==0?A:cv(y,P)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===si.mapValue&&o===si.mapValue)return 0;if(i===si.mapValue)return 1;if(o===si.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},d=Object.keys(c);l.sort(),d.sort();for(let f=0;f<l.length&&f<d.length;++f){const v=Be(l[f],d[f]);if(v!==0)return v;const y=mi(a[l[f]],c[d[f]]);if(y!==0)return y}return Be(l.length,d.length)}(n.mapValue,e.mapValue);default:throw xe()}}function uv(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Be(n,e);const t=ys(n),r=ys(e),s=Be(t.seconds,r.seconds);return s!==0?s:Be(t.nanos,r.nanos)}function cv(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=mi(t[s],r[s]);if(i)return i}return Be(t.length,r.length)}function wa(n){return Df(n)}function Df(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=ys(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return _s(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Ie.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=Df(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${Df(t.fields[o])}`;return s+"}"}(n.mapValue):xe()}function Nc(n){switch(pi(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=jd(n);return e?16+Nc(e):16;case 5:return 2*n.stringValue.length;case 6:return _s(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Nc(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Ei(r.fields,(i,o)=>{s+=i.length+Nc(o)}),s}(n.mapValue);default:throw xe()}}function ro(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Vf(n){return!!n&&"integerValue"in n}function eu(n){return!!n&&"arrayValue"in n}function dv(n){return!!n&&"nullValue"in n}function hv(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Oc(n){return!!n&&"mapValue"in n}function Bd(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Ll(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Ei(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ll(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ll(n.arrayValue.values[t]);return e}return Object.assign({},n)}function q0(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const z0={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function LP(n){return"nullValue"in n?Vc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?ro(no.empty(),Ie.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Bd(n)?z0:{mapValue:{}}:xe()}function FP(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?ro(no.empty(),Ie.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?z0:"mapValue"in n?Bd(n)?{mapValue:{}}:si:xe()}function fv(n,e){const t=mi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function pv(n,e){const t=mi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(e){this.value=e}static empty(){return new En({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Oc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ll(t)}setAll(e){let t=jt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Ll(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Oc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return zr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Oc(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Ei(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new En(Ll(this.value))}}function G0(n){const e=[];return Ei(n.fields,(t,r)=>{const s=new jt([t]);if(Oc(r)){const i=G0(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Qn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Ot(e,0,Re.min(),Re.min(),Re.min(),En.empty(),0)}static newFoundDocument(e,t,r,s){return new Ot(e,1,t,Re.min(),r,s,0)}static newNoDocument(e,t){return new Ot(e,2,t,Re.min(),Re.min(),En.empty(),0)}static newUnknownDocument(e,t){return new Ot(e,3,t,Re.min(),Re.min(),En.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Re.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=En.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=En.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Re.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ot&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ot(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(e,t){this.position=e,this.inclusive=t}}function mv(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=Ie.comparator(Ie.fromName(o.referenceValue),t.key):r=mi(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function gv(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!zr(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tu{constructor(e,t="asc"){this.field=e,this.dir=t}}function UP(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K0{}class ut extends K0{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new $P(e,t,r):t==="array-contains"?new qP(e,r):t==="in"?new X0(e,r):t==="not-in"?new zP(e,r):t==="array-contains-any"?new GP(e,r):new ut(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new jP(e,r):new BP(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(mi(t,this.value)):t!==null&&pi(this.value)===pi(t)&&this.matchesComparison(mi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return xe()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class _t extends K0{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new _t(e,t)}matches(e){return Ia(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Ia(n){return n.op==="and"}function Nf(n){return n.op==="or"}function Cp(n){return H0(n)&&Ia(n)}function H0(n){for(const e of n.filters)if(e instanceof _t)return!1;return!0}function Of(n){if(n instanceof ut)return n.field.canonicalString()+n.op.toString()+wa(n.value);if(Cp(n))return n.filters.map(e=>Of(e)).join(",");{const e=n.filters.map(t=>Of(t)).join(",");return`${n.op}(${e})`}}function W0(n,e){return n instanceof ut?function(r,s){return s instanceof ut&&r.op===s.op&&r.field.isEqual(s.field)&&zr(r.value,s.value)}(n,e):n instanceof _t?function(r,s){return s instanceof _t&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&W0(o,s.filters[a]),!0):!1}(n,e):void xe()}function Q0(n,e){const t=n.filters.concat(e);return _t.create(t,n.op)}function J0(n){return n instanceof ut?function(t){return`${t.field.canonicalString()} ${t.op} ${wa(t.value)}`}(n):n instanceof _t?function(t){return t.op.toString()+" {"+t.getFilters().map(J0).join(" ,")+"}"}(n):"Filter"}class $P extends ut{constructor(e,t,r){super(e,t,r),this.key=Ie.fromName(r.referenceValue)}matches(e){const t=Ie.comparator(e.key,this.key);return this.matchesComparison(t)}}class jP extends ut{constructor(e,t){super(e,"in",t),this.keys=Y0("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class BP extends ut{constructor(e,t){super(e,"not-in",t),this.keys=Y0("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Y0(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Ie.fromName(r.referenceValue))}class qP extends ut{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return eu(t)&&Zl(t.arrayValue,this.value)}}class X0 extends ut{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Zl(this.value.arrayValue,t)}}class zP extends ut{constructor(e,t){super(e,"not-in",t)}matches(e){if(Zl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Zl(this.value.arrayValue,t)}}class GP extends ut{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!eu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Zl(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KP{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function Mf(n,e=null,t=[],r=[],s=null,i=null,o=null){return new KP(n,e,t,r,s,i,o)}function so(n){const e=ve(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Of(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Iu(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>wa(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>wa(r)).join(",")),e.ue=t}return e.ue}function Eu(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!UP(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!W0(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!gv(n.startAt,e.startAt)&&gv(n.endAt,e.endAt)}function rd(n){return Ie.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function sd(n,e){return n.filters.filter(t=>t instanceof ut&&t.field.isEqual(e))}function vv(n,e,t){let r=Vc,s=!0;for(const i of sd(n,e)){let o=Vc,a=!0;switch(i.op){case"<":case"<=":o=LP(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Vc}fv({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];fv({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function yv(n,e,t){let r=si,s=!0;for(const i of sd(n,e)){let o=si,a=!0;switch(i.op){case">=":case">":o=FP(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=si}pv({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];pv({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Z0(n,e,t,r,s,i,o,a){return new xs(n,e,t,r,s,i,o,a)}function Fa(n){return new xs(n)}function _v(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function kp(n){return n.collectionGroup!==null}function aa(n){const e=ve(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new It(jt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new tu(i,r))}),t.has(jt.keyField().canonicalString())||e.ce.push(new tu(jt.keyField(),r))}return e.ce}function Mn(n){const e=ve(n);return e.le||(e.le=tb(e,aa(n))),e.le}function eb(n){const e=ve(n);return e.he||(e.he=tb(e,n.explicitOrderBy)),e.he}function tb(n,e){if(n.limitType==="F")return Mf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new tu(s.field,i)});const t=n.endAt?new gi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new gi(n.startAt.position,n.startAt.inclusive):null;return Mf(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Lf(n,e){const t=n.filters.concat([e]);return new xs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function id(n,e,t){return new xs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Tu(n,e){return Eu(Mn(n),Mn(e))&&n.limitType===e.limitType}function nb(n){return`${so(Mn(n))}|lt:${n.limitType}`}function Xo(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>J0(s)).join(", ")}]`),Iu(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>wa(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>wa(s)).join(",")),`Target(${r})`}(Mn(n))}; limitType=${n.limitType})`}function xu(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Ie.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of aa(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=mv(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,aa(r),s)||r.endAt&&!function(o,a,l){const c=mv(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,aa(r),s))}(n,e)}function rb(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function sb(n){return(e,t)=>{let r=!1;for(const s of aa(n)){const i=HP(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function HP(n,e,t){const r=n.field.isKeyField()?Ie.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?mi(l,c):xe()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return xe()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class As{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ei(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return j0(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WP=new Dt(Ie.comparator);function Jn(){return WP}const ib=new Dt(Ie.comparator);function Il(...n){let e=ib;for(const t of n)e=e.insert(t.key,t);return e}function ob(n){let e=ib;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Lr(){return Fl()}function ab(){return Fl()}function Fl(){return new As(n=>n.toString(),(n,e)=>n.isEqual(e))}const QP=new Dt(Ie.comparator),JP=new It(Ie.comparator);function Je(...n){let e=JP;for(const t of n)e=e.add(t);return e}const YP=new It(Be);function Dp(){return YP}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vp(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Yl(e)?"-0":e}}function lb(n){return{integerValue:""+n}}function ub(n,e){return O0(e)?lb(e):Vp(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qd{constructor(){this._=void 0}}function XP(n,e,t){return n instanceof Ea?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&$d(i)&&(i=jd(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof io?db(n,e):n instanceof oo?hb(n,e):function(s,i){const o=cb(s,i),a=bv(o)+bv(s.Pe);return Vf(o)&&Vf(s.Pe)?lb(a):Vp(s.serializer,a)}(n,e)}function ZP(n,e,t){return n instanceof io?db(n,e):n instanceof oo?hb(n,e):t}function cb(n,e){return n instanceof Ta?function(r){return Vf(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Ea extends qd{}class io extends qd{constructor(e){super(),this.elements=e}}function db(n,e){const t=fb(e);for(const r of n.elements)t.some(s=>zr(s,r))||t.push(r);return{arrayValue:{values:t}}}class oo extends qd{constructor(e){super(),this.elements=e}}function hb(n,e){let t=fb(e);for(const r of n.elements)t=t.filter(s=>!zr(s,r));return{arrayValue:{values:t}}}class Ta extends qd{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function bv(n){return $t(n.integerValue||n.doubleValue)}function fb(n){return eu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Au{constructor(e,t){this.field=e,this.transform=t}}function eR(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof io&&s instanceof io||r instanceof oo&&s instanceof oo?ya(r.elements,s.elements,zr):r instanceof Ta&&s instanceof Ta?zr(r.Pe,s.Pe):r instanceof Ea&&s instanceof Ea}(n.transform,e.transform)}class tR{constructor(e,t){this.version=e,this.transformResults=t}}class Bt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Bt}static exists(e){return new Bt(void 0,e)}static updateTime(e){return new Bt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Mc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class zd{}function pb(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new $a(n.key,Bt.none()):new Ua(n.key,n.data,Bt.none());{const t=n.data,r=En.empty();let s=new It(jt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Ss(n.key,r,new Qn(s.toArray()),Bt.none())}}function nR(n,e,t){n instanceof Ua?function(s,i,o){const a=s.value.clone(),l=Iv(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Ss?function(s,i,o){if(!Mc(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=Iv(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(mb(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Ul(n,e,t,r){return n instanceof Ua?function(i,o,a,l){if(!Mc(i.precondition,o))return a;const c=i.value.clone(),d=Ev(i.fieldTransforms,l,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof Ss?function(i,o,a,l){if(!Mc(i.precondition,o))return a;const c=Ev(i.fieldTransforms,l,o),d=o.data;return d.setAll(mb(i)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Mc(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function rR(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=cb(r.transform,s||null);i!=null&&(t===null&&(t=En.empty()),t.set(r.field,i))}return t||null}function wv(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&ya(r,s,(i,o)=>eR(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Ua extends zd{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ss extends zd{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function mb(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Iv(n,e,t){const r=new Map;Se(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,ZP(o,a,t[s]))}return r}function Ev(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,XP(i,o,e))}return r}class $a extends zd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Np extends zd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Op{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&nR(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ul(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Ul(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=ab();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=pb(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Re.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Je())}isEqual(e){return this.batchId===e.batchId&&ya(this.mutations,e.mutations,(t,r)=>wv(t,r))&&ya(this.baseMutations,e.baseMutations,(t,r)=>wv(t,r))}}class Mp{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Se(e.mutations.length===r.length);let s=function(){return QP}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Mp(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lp{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gb{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sR{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rn,dt;function vb(n){switch(n){default:return xe();case q.CANCELLED:case q.UNKNOWN:case q.DEADLINE_EXCEEDED:case q.RESOURCE_EXHAUSTED:case q.INTERNAL:case q.UNAVAILABLE:case q.UNAUTHENTICATED:return!1;case q.INVALID_ARGUMENT:case q.NOT_FOUND:case q.ALREADY_EXISTS:case q.PERMISSION_DENIED:case q.FAILED_PRECONDITION:case q.ABORTED:case q.OUT_OF_RANGE:case q.UNIMPLEMENTED:case q.DATA_LOSS:return!0}}function yb(n){if(n===void 0)return Zt("GRPC error has no .code"),q.UNKNOWN;switch(n){case rn.OK:return q.OK;case rn.CANCELLED:return q.CANCELLED;case rn.UNKNOWN:return q.UNKNOWN;case rn.DEADLINE_EXCEEDED:return q.DEADLINE_EXCEEDED;case rn.RESOURCE_EXHAUSTED:return q.RESOURCE_EXHAUSTED;case rn.INTERNAL:return q.INTERNAL;case rn.UNAVAILABLE:return q.UNAVAILABLE;case rn.UNAUTHENTICATED:return q.UNAUTHENTICATED;case rn.INVALID_ARGUMENT:return q.INVALID_ARGUMENT;case rn.NOT_FOUND:return q.NOT_FOUND;case rn.ALREADY_EXISTS:return q.ALREADY_EXISTS;case rn.PERMISSION_DENIED:return q.PERMISSION_DENIED;case rn.FAILED_PRECONDITION:return q.FAILED_PRECONDITION;case rn.ABORTED:return q.ABORTED;case rn.OUT_OF_RANGE:return q.OUT_OF_RANGE;case rn.UNIMPLEMENTED:return q.UNIMPLEMENTED;case rn.DATA_LOSS:return q.DATA_LOSS;default:return xe()}}(dt=rn||(rn={}))[dt.OK=0]="OK",dt[dt.CANCELLED=1]="CANCELLED",dt[dt.UNKNOWN=2]="UNKNOWN",dt[dt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",dt[dt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",dt[dt.NOT_FOUND=5]="NOT_FOUND",dt[dt.ALREADY_EXISTS=6]="ALREADY_EXISTS",dt[dt.PERMISSION_DENIED=7]="PERMISSION_DENIED",dt[dt.UNAUTHENTICATED=16]="UNAUTHENTICATED",dt[dt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",dt[dt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",dt[dt.ABORTED=10]="ABORTED",dt[dt.OUT_OF_RANGE=11]="OUT_OF_RANGE",dt[dt.UNIMPLEMENTED=12]="UNIMPLEMENTED",dt[dt.INTERNAL=13]="INTERNAL",dt[dt.UNAVAILABLE=14]="UNAVAILABLE",dt[dt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let od=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _b(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iR=new Yi([4294967295,4294967295],0);function Tv(n){const e=_b().encode(n),t=new b0;return t.update(e),new Uint8Array(t.digest())}function xv(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Yi([t,r],0),new Yi([s,i],0)]}class Fp{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new El(`Invalid padding: ${t}`);if(r<0)throw new El(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new El(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new El(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Yi.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Yi.fromNumber(r)));return s.compare(iR)===1&&(s=new Yi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Tv(e),[r,s]=xv(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Fp(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=Tv(e),[r,s]=xv(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class El extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Su{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Pu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Su(Re.min(),s,new Dt(Be),Jn(),Je())}}class Pu{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Pu(r,t,Je(),Je(),Je())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class bb{constructor(e,t){this.targetId=e,this.me=t}}class wb{constructor(e,t,r=Wt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Av{constructor(){this.fe=0,this.ge=Pv(),this.pe=Wt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Je(),t=Je(),r=Je();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:xe()}}),new Pu(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=Pv()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Se(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class oR{constructor(e){this.Le=e,this.Be=new Map,this.ke=Jn(),this.qe=Sv(),this.Qe=new Dt(Be)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:xe()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(rd(i))if(r===0){const o=new Ie(i.path);this.Ue(t,o,Ot.newNoDocument(o,Re.min()))}else Se(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}od==null||od.et(function(d,f,v,y,P){var A,R,j,B,F,G;const oe={localCacheCount:d,existenceFilterCount:f.count,databaseId:v.database,projectId:v.projectId},ie=f.unchangedNames;return ie&&(oe.bloomFilter={applied:P===0,hashCount:(A=ie==null?void 0:ie.hashCount)!==null&&A!==void 0?A:0,bitmapLength:(B=(j=(R=ie==null?void 0:ie.bits)===null||R===void 0?void 0:R.bitmap)===null||j===void 0?void 0:j.length)!==null&&B!==void 0?B:0,padding:(G=(F=ie==null?void 0:ie.bits)===null||F===void 0?void 0:F.padding)!==null&&G!==void 0?G:0,mightContain:I=>{var E;return(E=y==null?void 0:y.mightContain(I))!==null&&E!==void 0&&E}}),oe}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=_s(r).toUint8Array()}catch(l){if(l instanceof B0)return fr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Fp(o,s,i)}catch(l){return fr(l instanceof El?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&rd(a.target)){const l=new Ie(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,Ot.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=Je();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new Su(e,t,this.Qe,this.ke,r);return this.ke=Jn(),this.qe=Sv(),this.Qe=new Dt(Be),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Av,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new It(Be),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||te("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Av),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Sv(){return new Dt(Ie.comparator)}function Pv(){return new Dt(Ie.comparator)}const aR=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),lR=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),uR=(()=>({and:"AND",or:"OR"}))();class cR{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ff(n,e){return n.useProto3Json||Iu(e)?e:{value:e}}function xa(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ib(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function dR(n,e){return xa(n,e.toTimestamp())}function tn(n){return Se(!!n),Re.fromTimestamp(function(t){const r=ys(t);return new qt(r.seconds,r.nanos)}(n))}function Up(n,e){return Uf(n,e).canonicalString()}function Uf(n,e){const t=function(s){return new lt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Eb(n){const e=lt.fromString(n);return Se(Vb(e)),e}function nu(n,e){return Up(n.databaseId,e.path)}function $r(n,e){const t=Eb(e);if(t.get(1)!==n.databaseId.projectId)throw new ne(q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new ne(q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Ie(Ab(t))}function Tb(n,e){return Up(n.databaseId,e)}function xb(n){const e=Eb(n);return e.length===4?lt.emptyPath():Ab(e)}function $f(n){return new lt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Ab(n){return Se(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Rv(n,e,t){return{name:nu(n,e),fields:t.value.mapValue.fields}}function Sb(n,e,t){const r=$r(n,e.name),s=tn(e.updateTime),i=e.createTime?tn(e.createTime):Re.min(),o=new En({mapValue:{fields:e.fields}}),a=Ot.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function hR(n,e){return"found"in e?function(r,s){Se(!!s.found),s.found.name,s.found.updateTime;const i=$r(r,s.found.name),o=tn(s.found.updateTime),a=s.found.createTime?tn(s.found.createTime):Re.min(),l=new En({mapValue:{fields:s.found.fields}});return Ot.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Se(!!s.missing),Se(!!s.readTime);const i=$r(r,s.missing),o=tn(s.readTime);return Ot.newNoDocument(i,o)}(n,e):xe()}function fR(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:xe()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,d){return c.useProto3Json?(Se(d===void 0||typeof d=="string"),Wt.fromBase64String(d||"")):(Se(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Wt.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const d=c.code===void 0?q.UNKNOWN:yb(c.code);return new ne(d,c.message||"")}(o);t=new wb(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=$r(n,r.document.name),i=tn(r.document.updateTime),o=r.document.createTime?tn(r.document.createTime):Re.min(),a=new En({mapValue:{fields:r.document.fields}}),l=Ot.newFoundDocument(s,i,o,a),c=r.targetIds||[],d=r.removedTargetIds||[];t=new Lc(c,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=$r(n,r.document),i=r.readTime?tn(r.readTime):Re.min(),o=Ot.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Lc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=$r(n,r.document),i=r.removedTargetIds||[];t=new Lc([],i,s,null)}else{if(!("filter"in e))return xe();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new sR(s,i),a=r.targetId;t=new bb(a,o)}}return t}function ru(n,e){let t;if(e instanceof Ua)t={update:Rv(n,e.key,e.value)};else if(e instanceof $a)t={delete:nu(n,e.key)};else if(e instanceof Ss)t={update:Rv(n,e.key,e.data),updateMask:_R(e.fieldMask)};else{if(!(e instanceof Np))return xe();t={verify:nu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Ea)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof io)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof oo)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Ta)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw xe()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:dR(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:xe()}(n,e.precondition)),t}function jf(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Bt.updateTime(tn(i.updateTime)):i.exists!==void 0?Bt.exists(i.exists):Bt.none()}(e.currentDocument):Bt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Se(a.setToServerValue==="REQUEST_TIME"),l=new Ea;else if("appendMissingElements"in a){const d=a.appendMissingElements.values||[];l=new io(d)}else if("removeAllFromArray"in a){const d=a.removeAllFromArray.values||[];l=new oo(d)}else"increment"in a?l=new Ta(o,a.increment):xe();const c=jt.fromServerFormat(a.fieldPath);return new Au(c,l)}(n,s)):[];if(e.update){e.update.name;const s=$r(n,e.update.name),i=new En({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new Qn(c.map(d=>jt.fromServerFormat(d)))}(e.updateMask);return new Ss(s,i,o,t,r)}return new Ua(s,i,t,r)}if(e.delete){const s=$r(n,e.delete);return new $a(s,t)}if(e.verify){const s=$r(n,e.verify);return new Np(s,t)}return xe()}function pR(n,e){return n&&n.length>0?(Se(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?tn(s.updateTime):tn(i);return o.isEqual(Re.min())&&(o=tn(i)),new tR(o,s.transformResults||[])}(t,e))):[]}function Pb(n,e){return{documents:[Tb(n,e.path)]}}function Gd(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Tb(n,s);const i=function(c){if(c.length!==0)return Db(_t.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(d=>function(v){return{field:Ys(v.field),direction:gR(v.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Ff(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function Rb(n,e,t,r){const{_t:s,parent:i}=Gd(n,e),o={},a=[];let l=0;return t.forEach(c=>{const d=r?c.alias:"aggregate_"+l++;o[d]=c.alias,c.aggregateType==="count"?a.push({alias:d,count:{}}):c.aggregateType==="avg"?a.push({alias:d,avg:{field:Ys(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:d,sum:{field:Ys(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function Cb(n){let e=xb(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Se(r===1);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(f){const v=kb(f);return v instanceof _t&&Cp(v)?v.getFilters():[v]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(v=>function(P){return new tu(Zo(P.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(P.direction))}(v))}(t.orderBy));let a=null;t.limit&&(a=function(f){let v;return v=typeof f=="object"?f.value:f,Iu(v)?null:v}(t.limit));let l=null;t.startAt&&(l=function(f){const v=!!f.before,y=f.values||[];return new gi(y,v)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const v=!f.before,y=f.values||[];return new gi(y,v)}(t.endAt)),Z0(e,s,o,i,a,"F",l,c)}function mR(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return xe()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function kb(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Zo(t.unaryFilter.field);return ut.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Zo(t.unaryFilter.field);return ut.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Zo(t.unaryFilter.field);return ut.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Zo(t.unaryFilter.field);return ut.create(o,"!=",{nullValue:"NULL_VALUE"});default:return xe()}}(n):n.fieldFilter!==void 0?function(t){return ut.create(Zo(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return xe()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return _t.create(t.compositeFilter.filters.map(r=>kb(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return xe()}}(t.compositeFilter.op))}(n):xe()}function gR(n){return aR[n]}function vR(n){return lR[n]}function yR(n){return uR[n]}function Ys(n){return{fieldPath:n.canonicalString()}}function Zo(n){return jt.fromServerFormat(n.fieldPath)}function Db(n){return n instanceof ut?function(t){if(t.op==="=="){if(hv(t.value))return{unaryFilter:{field:Ys(t.field),op:"IS_NAN"}};if(dv(t.value))return{unaryFilter:{field:Ys(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(hv(t.value))return{unaryFilter:{field:Ys(t.field),op:"IS_NOT_NAN"}};if(dv(t.value))return{unaryFilter:{field:Ys(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ys(t.field),op:vR(t.op),value:t.value}}}(n):n instanceof _t?function(t){const r=t.getFilters().map(s=>Db(s));return r.length===1?r[0]:{compositeFilter:{op:yR(t.op),filters:r}}}(n):xe()}function _R(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Vb(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class us{constructor(e,t,r,s,i=Re.min(),o=Re.min(),a=Wt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new us(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new us(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new us(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new us(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nb{constructor(e){this.ct=e}}function bR(n,e){let t;if(e.document)t=Sb(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Ie.fromSegments(e.noDocument.path),s=lo(e.noDocument.readTime);t=Ot.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return xe();{const r=Ie.fromSegments(e.unknownDocument.path),s=lo(e.unknownDocument.version);t=Ot.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new qt(s[0],s[1]);return Re.fromTimestamp(i)}(e.readTime)),t}function Cv(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:ad(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:nu(i,o.key),fields:o.data.value.mapValue.fields,updateTime:xa(i,o.version.toTimestamp()),createTime:xa(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:ao(e.version)};else{if(!e.isUnknownDocument())return xe();r.unknownDocument={path:t.path.toArray(),version:ao(e.version)}}return r}function ad(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function ao(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function lo(n){const e=new qt(n.seconds,n.nanoseconds);return Re.fromTimestamp(e)}function Gi(n,e){const t=(e.baseMutations||[]).map(i=>jf(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>jf(n.ct,i)),s=qt.fromMillis(e.localWriteTimeMs);return new Op(e.batchId,s,t,r)}function Tl(n){const e=lo(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?lo(n.lastLimboFreeSnapshotVersion):Re.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Se(i.documents.length===1),Mn(Fa(xb(i.documents[0])))}(n.query):function(i){return Mn(Cb(i))}(n.query),new us(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Wt.fromBase64String(n.resumeToken))}function Ob(n,e){const t=ao(e.snapshotVersion),r=ao(e.lastLimboFreeSnapshotVersion);let s;s=rd(e.target)?Pb(n.ct,e.target):Gd(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:so(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function $p(n){const e=Cb({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?id(e,e.limit,"L"):e}function Qh(n,e){return new Lp(e.largestBatchId,jf(n.ct,e.overlayMutation))}function kv(n,e){const t=e.path.lastSegment();return[n,On(e.path.popLast()),t]}function Dv(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:ao(r.readTime),documentKey:On(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{getBundleMetadata(e,t){return Vv(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:lo(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return Vv(e).put(function(s){return{bundleId:s.id,createTime:ao(tn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return Nv(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:$p(i.bundledQuery),readTime:lo(i.readTime)}}(r)})}saveNamedQuery(e,t){return Nv(e).put(function(s){return{name:s.name,readTime:ao(tn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function Vv(n){return hn(n,"bundles")}function Nv(n){return hn(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new Kd(e,r)}getOverlay(e,t){return hl(e).get(kv(this.userId,t)).next(r=>r?Qh(this.serializer,r):null)}getOverlays(e,t){const r=Lr();return L.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Lp(t,o);s.push(this.ht(e,a))}),L.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(On(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(hl(e).j("collectionPathOverlayIndex",a))}),L.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Lr(),i=On(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return hl(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=Qh(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Lr();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return hl(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,d)=>{const f=Qh(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>i)}ht(e,t){return hl(e).put(function(s,i,o){const[a,l,c]=kv(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:ru(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function hl(n){return hn(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IR{Pt(e){return hn(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?Wt.fromUint8Array(r):Wt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ki{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At($t(e.integerValue));else if("doubleValue"in e){const r=$t(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Yl(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=ys(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(_s(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?q0(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Bd(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):xe()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At($t(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),Ie.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Ki.vt=new Ki;function ER(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Ov(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=ER(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class TR{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=Ov(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=Ov(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class xR{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class AR{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class fl{constructor(){this.jt=new TR,this.Ht=new xR(this.jt),this.Jt=new AR(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hi{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Hi(this.indexId,this.documentKey,this.arrayValue,r)}}function zs(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=Mv(n.arrayValue,e.arrayValue),t!==0?t:(t=Mv(n.directionalValue,e.directionalValue),t!==0?t:Ie.comparator(n.documentKey,e.documentKey)))}function Mv(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lv{constructor(e){this.Xt=new It((t,r)=>jt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Se(e.collectionGroup===this.collectionId),this.nn)return!1;const t=Cf(e);if(t!==void 0&&!this.sn(t))return!1;const r=Bi(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new It(jt.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Xi(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Xi(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Xi(r.field,r.dir==="asc"?0:1)));return new _a(_a.UNKNOWN_ID,this.collectionId,t,ba.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mb(n){var e,t;if(Se(n instanceof ut||n instanceof _t),n instanceof ut){if(n instanceof X0){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>ut.create(n.field,"==",i)))||[];return _t.create(s,"or")}return n}const r=n.filters.map(s=>Mb(s));return _t.create(r,n.op)}function SR(n){if(n.getFilters().length===0)return[];const e=zf(Mb(n));return Se(Lb(e)),Bf(e)||qf(e)?[e]:e.getFilters()}function Bf(n){return n instanceof ut}function qf(n){return n instanceof _t&&Cp(n)}function Lb(n){return Bf(n)||qf(n)||function(t){if(t instanceof _t&&Nf(t)){for(const r of t.getFilters())if(!Bf(r)&&!qf(r))return!1;return!0}return!1}(n)}function zf(n){if(Se(n instanceof ut||n instanceof _t),n instanceof ut)return n;if(n.filters.length===1)return zf(n.filters[0]);const e=n.filters.map(r=>zf(r));let t=_t.create(e,n.op);return t=ld(t),Lb(t)?t:(Se(t instanceof _t),Se(Ia(t)),Se(t.filters.length>1),t.filters.reduce((r,s)=>jp(r,s)))}function jp(n,e){let t;return Se(n instanceof ut||n instanceof _t),Se(e instanceof ut||e instanceof _t),t=n instanceof ut?e instanceof ut?function(s,i){return _t.create([s,i],"and")}(n,e):Fv(n,e):e instanceof ut?Fv(e,n):function(s,i){if(Se(s.filters.length>0&&i.filters.length>0),Ia(s)&&Ia(i))return Q0(s,i.getFilters());const o=Nf(s)?s:i,a=Nf(s)?i:s,l=o.filters.map(c=>jp(c,a));return _t.create(l,"or")}(n,e),ld(t)}function Fv(n,e){if(Ia(e))return Q0(e,n.getFilters());{const t=e.filters.map(r=>jp(n,r));return _t.create(t,"or")}}function ld(n){if(Se(n instanceof ut||n instanceof _t),n instanceof ut)return n;const e=n.getFilters();if(e.length===1)return ld(e[0]);if(H0(n))return n;const t=e.map(s=>ld(s)),r=[];return t.forEach(s=>{s instanceof ut?r.push(s):s instanceof _t&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:_t.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PR{constructor(){this.un=new Bp}addToCollectionParentIndex(e,t){return this.un.add(t),L.resolve()}getCollectionParents(e,t){return L.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return L.resolve()}deleteFieldIndex(e,t){return L.resolve()}deleteAllFieldIndexes(e){return L.resolve()}createTargetIndexes(e,t){return L.resolve()}getDocumentsMatchingTarget(e,t){return L.resolve(null)}getIndexType(e,t){return L.resolve(0)}getFieldIndexes(e,t){return L.resolve([])}getNextCollectionGroupToUpdate(e){return L.resolve(null)}getMinOffset(e,t){return L.resolve(rr.min())}getMinOffsetFromCollectionGroup(e,t){return L.resolve(rr.min())}updateCollectionGroup(e,t,r){return L.resolve()}updateIndexEntries(e,t){return L.resolve()}}class Bp{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new It(lt.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new It(lt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yc=new Uint8Array(0);class RR{constructor(e,t){this.databaseId=t,this.cn=new Bp,this.ln=new As(r=>so(r),(r,s)=>Eu(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:On(s)};return Uv(e).put(i)}return L.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[R0(t),""],!1,!0);return Uv(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Mr(o.parent))}return r})}addFieldIndex(e,t){const r=pl(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Go(e);return i.next(a=>{o.put(Dv(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=pl(e),s=Go(e),i=zo(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=pl(e),r=zo(e),s=Go(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return L.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new Lv(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=zo(e);let s=!0;const i=new Map;return L.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Je();const a=[];return L.forEach(i,(l,c)=>{te("IndexedDbIndexManager",`Using index ${function(F){return`id=${F.indexId}|cg=${F.collectionGroup}|f=${F.fields.map(G=>`${G.fieldPath}:${G.kind}`).join(",")}`}(l)} to execute ${so(t)}`);const d=function(F,G){const oe=Cf(G);if(oe===void 0)return null;for(const ie of sd(F,oe.fieldPath))switch(ie.op){case"array-contains-any":return ie.value.arrayValue.values||[];case"array-contains":return[ie.value]}return null}(c,l),f=function(F,G){const oe=new Map;for(const ie of Bi(G))for(const I of sd(F,ie.fieldPath))switch(I.op){case"==":case"in":oe.set(ie.fieldPath.canonicalString(),I.value);break;case"not-in":case"!=":return oe.set(ie.fieldPath.canonicalString(),I.value),Array.from(oe.values())}return null}(c,l),v=function(F,G){const oe=[];let ie=!0;for(const I of Bi(G)){const E=I.kind===0?vv(F,I.fieldPath,F.startAt):yv(F,I.fieldPath,F.startAt);oe.push(E.value),ie&&(ie=E.inclusive)}return new gi(oe,ie)}(c,l),y=function(F,G){const oe=[];let ie=!0;for(const I of Bi(G)){const E=I.kind===0?yv(F,I.fieldPath,F.endAt):vv(F,I.fieldPath,F.endAt);oe.push(E.value),ie&&(ie=E.inclusive)}return new gi(oe,ie)}(c,l),P=this.In(l,c,v),A=this.In(l,c,y),R=this.Tn(l,c,f),j=this.En(l.indexId,d,P,v.inclusive,A,y.inclusive,R);return L.forEach(j,B=>r.G(B,t.limit).next(F=>{F.forEach(G=>{const oe=Ie.fromSegments(G.documentKey);o.has(oe)||(o=o.add(oe),a.push(oe))})}))}).next(()=>a)}return L.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=SR(_t.create(e.filters,"and")).map(r=>Mf(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),d=[];for(let f=0;f<l;++f){const v=t?this.dn(t[f/c]):yc,y=this.An(e,v,r[f%c],s),P=this.Rn(e,v,i[f%c],o),A=a.map(R=>this.An(e,v,R,!0));d.push(...this.createRange(y,P,A))}return d}An(e,t,r,s){const i=new Hi(e,Ie.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new Hi(e,Ie.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new Lv(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return L.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new It(jt.comparator),d=!1;for(const f of l.filters)for(const v of f.getFlattenedFilters())v.field.isKeyField()||(v.op==="array-contains"||v.op==="array-contains-any"?d=!0:c=c.add(v.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(d?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new fl;for(const s of Bi(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);Ki.vt.It(i,o)}return r.zt()}dn(e){const t=new fl;return Ki.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new fl;return Ki.vt.It(ro(this.databaseId,t),r.Yt(function(i){const o=Bi(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new fl);let i=0;for(const o of Bi(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&eu(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);Ki.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new fl;l.seed(a.zt()),Ki.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof ut&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=pl(e),s=Go(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return L.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(d,f){const v=f?new ba(f.sequenceNumber,new rr(lo(f.readTime),new Ie(Mr(f.documentKey)),f.largestBatchId)):ba.empty(),y=d.fields.map(([P,A])=>new Xi(jt.fromServerFormat(P),A));return new _a(d.indexId,d.collectionGroup,y,v)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Be(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=pl(e),i=Go(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>L.forEach(a,l=>i.put(Dv(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return L.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?L.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),L.forEach(a,l=>this.wn(e,s,l).next(c=>{const d=this.Sn(i,l);return c.isEqual(d)?L.resolve():this.bn(e,i,l,c,d)}))))})}Dn(e,t,r,s){return zo(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return zo(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=zo(e);let i=new It(zs);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new Hi(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new It(zs);const s=this.Vn(t,e);if(s==null)return r;const i=Cf(t);if(i!=null){const o=e.data.field(i.fieldPath);if(eu(o))for(const a of o.arrayValue.values||[])r=r.add(new Hi(t.indexId,e.key,this.dn(a),s))}else r=r.add(new Hi(t.indexId,e.key,yc,s));return r}bn(e,t,r,s,i){te("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,d,f,v){const y=l.getIterator(),P=c.getIterator();let A=qo(y),R=qo(P);for(;A||R;){let j=!1,B=!1;if(A&&R){const F=d(A,R);F<0?B=!0:F>0&&(j=!0)}else A!=null?B=!0:j=!0;j?(f(R),R=qo(P)):B?(v(A),A=qo(y)):(A=qo(y),R=qo(P))}}(s,i,zs,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),L.waitFor(o)}yn(e){let t=1;return Go(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>zs(o,a)).filter((o,a,l)=>!a||zs(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=zs(o,e),l=zs(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,yc,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,yc,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return zs(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next($v)}getMinOffset(e,t){return L.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||xe())).next($v)}}function Uv(n){return hn(n,"collectionParents")}function zo(n){return hn(n,"indexEntries")}function pl(n){return hn(n,"indexConfiguration")}function Go(n){return hn(n,"indexState")}function $v(n){Se(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Sp(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new rr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jv={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Cn{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Cn(e,Cn.DEFAULT_COLLECTION_PERCENTILE,Cn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fb(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(d,f,v)=>(a++,v.delete()));i.push(l.next(()=>{Se(a===1)}));const c=[];for(const d of t.mutations){const f=M0(e,d.key.path,t.batchId);i.push(s.delete(f)),c.push(d.key)}return L.waitFor(i).next(()=>c)}function ud(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw xe();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Cn.DEFAULT_COLLECTION_PERCENTILE=10,Cn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Cn.DEFAULT=new Cn(41943040,Cn.DEFAULT_COLLECTION_PERCENTILE,Cn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Cn.DISABLED=new Cn(-1,0,0);class Hd{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Se(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new Hd(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Gs(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=ea(e),o=Gs(e);return o.add({}).next(a=>{Se(typeof a=="number");const l=new Op(a,t,r,s),c=function(y,P,A){const R=A.baseMutations.map(B=>ru(y.ct,B)),j=A.mutations.map(B=>ru(y.ct,B));return{userId:P,batchId:A.batchId,localWriteTimeMs:A.localWriteTime.toMillis(),baseMutations:R,mutations:j}}(this.serializer,this.userId,l),d=[];let f=new It((v,y)=>Be(v.canonicalString(),y.canonicalString()));for(const v of s){const y=M0(this.userId,v.key.path,a);f=f.add(v.key.path.popLast()),d.push(o.put(c)),d.push(i.put(y,vP))}return f.forEach(v=>{d.push(this.indexManager.addToCollectionParentIndex(e,v))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),L.waitFor(d).next(()=>l)})}lookupMutationBatch(e,t){return Gs(e).get(t).next(r=>r?(Se(r.userId===this.userId),Gi(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?L.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Gs(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Se(a.batchId>=r),i=Gi(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Gs(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Gs(e).U("userMutationsIndex",t).next(r=>r.map(s=>Gi(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Dc(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return ea(e).J({range:s},(o,a,l)=>{const[c,d,f]=o,v=Mr(d);if(c===this.userId&&t.path.isEqual(v))return Gs(e).get(f).next(y=>{if(!y)throw xe();Se(y.userId===this.userId),i.push(Gi(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new It(Be);const s=[];return t.forEach(i=>{const o=Dc(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=ea(e).J({range:a},(c,d,f)=>{const[v,y,P]=c,A=Mr(y);v===this.userId&&i.path.isEqual(A)?r=r.add(P):f.done()});s.push(l)}),L.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Dc(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new It(Be);return ea(e).J({range:o},(l,c,d)=>{const[f,v,y]=l,P=Mr(v);f===this.userId&&r.isPrefixOf(P)?P.length===s&&(a=a.add(y)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(Gs(e).get(i).next(o=>{if(o===null)throw xe();Se(o.userId===this.userId),r.push(Gi(this.serializer,o))}))}),L.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return Fb(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),L.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return L.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return ea(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=Mr(i[1]);s.push(l)}else a.done()}).next(()=>{Se(s.length===0)})})}containsKey(e,t){return Ub(e,this.userId,t)}Nn(e){return $b(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Ub(n,e,t){const r=Dc(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return ea(n).J({range:i,H:!0},(a,l,c)=>{const[d,f,v]=a;d===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function Gs(n){return hn(n,"mutations")}function ea(n){return hn(n,"documentMutations")}function $b(n){return hn(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uo{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new uo(0)}static kn(){return new uo(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CR{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new uo(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Re.fromTimestamp(new qt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ko(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Se(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Ko(e).J((o,a)=>{const l=Tl(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>L.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Ko(e).J((r,s)=>{const i=Tl(s);t(i)})}qn(e){return Bv(e).get("targetGlobalKey").next(t=>(Se(t!==null),t))}Qn(e,t){return Bv(e).put("targetGlobalKey",t)}Kn(e,t){return Ko(e).put(Ob(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=so(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Ko(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=Tl(a);Eu(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Xs(e);return t.forEach(o=>{const a=On(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),L.waitFor(s)}removeMatchingKeys(e,t,r){const s=Xs(e);return L.forEach(t,i=>{const o=On(i.path);return L.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Xs(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Xs(e);let i=Je();return s.J({range:r,H:!0},(o,a,l)=>{const c=Mr(o[1]),d=new Ie(c);i=i.add(d)}).next(()=>i)}containsKey(e,t){const r=On(t.path),s=IDBKeyRange.bound([r],[R0(r)],!1,!0);let i=0;return Xs(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return Ko(e).get(t).next(r=>r?Tl(r):null)}}function Ko(n){return hn(n,"targets")}function Bv(n){return hn(n,"targetGlobal")}function Xs(n){return hn(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qv([n,e],[t,r]){const s=Be(n,t);return s===0?Be(e,r):s}class kR{constructor(e){this.Un=e,this.buffer=new It(qv),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();qv(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class jb{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){te("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ii(t)?te("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await wi(t)}await this.Hn(3e5)})}}class DR{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return L.resolve(Wn.oe);const r=new kR(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(te("LruGarbageCollector","Garbage collection skipped; disabled"),L.resolve(jv)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(te("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),jv):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(te("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),Yo()<=at.DEBUG&&te("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-d}ms`),L.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function Bb(n,e){return new DR(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VR{constructor(e,t){this.db=e,this.garbageCollector=Bb(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return _c(e,r)}removeReference(e,t,r){return _c(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return _c(e,t)}nr(e,t){return function(s,i){let o=!1;return $b(s).Y(a=>Ub(s,a,i).next(l=>(l&&(o=!0),L.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Re.min()),Xs(e).delete(function(f){return[0,On(f.path)]}(o))))});s.push(l)}}).next(()=>L.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return _c(e,t)}tr(e,t){const r=Xs(e);let s,i=Wn.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==Wn.oe&&t(new Ie(Mr(s)),i),i=c,s=l):i=Wn.oe}).next(()=>{i!==Wn.oe&&t(new Ie(Mr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function _c(n,e){return Xs(n).put(function(r,s){return{targetId:0,path:On(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qb{constructor(){this.changes=new As(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ot.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?L.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NR{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Ui(e).put(r)}removeEntry(e,t,r){return Ui(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],ad(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Ot.newInvalidDocument(t);return Ui(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ml(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:Ot.newInvalidDocument(t)};return Ui(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ml(t))},(s,i)=>{r={document:this.ir(t,i),size:ud(i)}}).next(()=>r)}getEntries(e,t){let r=Jn();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=Jn(),s=new Dt(Ie.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,ud(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return L.resolve();let s=new It(Kv);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(ml(s.first()),ml(s.last())),o=s.getIterator();let a=o.getNext();return Ui(e).J({index:"documentKeyIndex",range:i},(l,c,d)=>{const f=Ie.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&Kv(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?d.$(ml(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),ad(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ui(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let d=Jn();for(const f of c){const v=this.ir(Ie.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);v.isFoundDocument()&&(xu(t,v)||s.has(v.key))&&(d=d.insert(v.key,v))}return d})}getAllFromCollectionGroup(e,t,r,s){let i=Jn();const o=Gv(t,r),a=Gv(t,rr.max());return Ui(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,d)=>{const f=this.ir(Ie.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&d.done()}).next(()=>i)}newChangeBuffer(e){return new OR(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return zv(e).get("remoteDocumentGlobalKey").next(t=>(Se(!!t),t))}rr(e,t){return zv(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=bR(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Re.min())))return r}return Ot.newInvalidDocument(e)}}function zb(n){return new NR(n)}class OR extends qb{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new As(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new It((i,o)=>Be(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=Cv(this.cr.serializer,o);s=s.add(i.path.popLast());const c=ud(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=Cv(this.cr.serializer,o.convertToNoDocument(Re.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),L.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function zv(n){return hn(n,"remoteDocumentGlobal")}function Ui(n){return hn(n,"remoteDocumentsV14")}function ml(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Gv(n,e){const t=e.documentKey.path.toArray();return[n,ad(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Kv(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Be(t[i],r[i]),s)return s;return s=Be(t.length,r.length),s||(s=Be(t[t.length-2],r[r.length-2]),s||Be(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MR{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gb{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Ul(r.mutation,s,Qn.empty(),qt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Je()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Je()){const s=Lr();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Il();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Lr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Je()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Jn();const o=Fl(),a=function(){return Fl()}();return t.forEach((l,c)=>{const d=r.get(c.key);s.has(c.key)&&(d===void 0||d.mutation instanceof Ss)?i=i.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),Ul(d.mutation,c,d.mutation.getFieldMask(),qt.now())):o.set(c.key,Qn.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var f;return a.set(c,new MR(d,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Fl();let s=new Dt((o,a)=>o-a),i=Je();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let d=r.get(l)||Qn.empty();d=a.applyToLocalView(c,d),r.set(l,d);const f=(s.get(a.batchId)||Je()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,d=l.value,f=ab();d.forEach(v=>{if(!i.has(v)){const y=pb(t.get(v),r.get(v));y!==null&&f.set(v,y),i=i.add(v)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return L.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return Ie.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):kp(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):L.resolve(Lr());let a=-1,l=i;return o.next(c=>L.forEach(c,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(d)?L.resolve():this.remoteDocumentCache.getEntry(e,d).next(v=>{l=l.insert(d,v)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,Je())).next(d=>({batchId:a,changes:ob(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ie(t)).next(r=>{let s=Il();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Il();return this.indexManager.getCollectionParents(e,i).next(a=>L.forEach(a,l=>{const c=function(f,v){return new xs(v,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(d=>{d.forEach((f,v)=>{o=o.insert(f,v)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const d=c.getKey();o.get(d)===null&&(o=o.insert(d,Ot.newInvalidDocument(d)))});let a=Il();return o.forEach((l,c)=>{const d=i.get(l);d!==void 0&&Ul(d.mutation,c,Qn.empty(),qt.now()),xu(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LR{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return L.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:tn(s.createTime)}}(t)),L.resolve()}getNamedQuery(e,t){return L.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:$p(s.bundledQuery),readTime:tn(s.readTime)}}(t)),L.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FR{constructor(){this.overlays=new Dt(Ie.comparator),this.Ir=new Map}getOverlay(e,t){return L.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Lr();return L.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),L.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),L.resolve()}getOverlaysForCollection(e,t,r){const s=Lr(),i=t.length+1,o=new Ie(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return L.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Dt((c,d)=>c-d);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let d=i.get(c.largestBatchId);d===null&&(d=Lr(),i=i.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}const a=Lr(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=s)););return L.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Lp(t,r));let i=this.Ir.get(t);i===void 0&&(i=Je(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UR{constructor(){this.sessionToken=Wt.EMPTY_BYTE_STRING}getSessionToken(e){return L.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,L.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qp{constructor(){this.Tr=new It(gn.Er),this.dr=new It(gn.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new gn(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new gn(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new Ie(new lt([])),r=new gn(t,e),s=new gn(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Ie(new lt([])),r=new gn(t,e),s=new gn(t,e+1);let i=Je();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new gn(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class gn{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Ie.comparator(e.key,t.key)||Be(e.wr,t.wr)}static Ar(e,t){return Be(e.wr,t.wr)||Ie.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $R{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new It(gn.Er)}checkEmpty(e){return L.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Op(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new gn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return L.resolve(o)}lookupMutationBatch(e,t){return L.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return L.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return L.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return L.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new gn(t,0),s=new gn(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),L.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new It(Be);return t.forEach(s=>{const i=new gn(s,0),o=new gn(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),L.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Ie.isDocumentKey(i)||(i=i.child(""));const o=new gn(new Ie(i),0);let a=new It(Be);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),L.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Se(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return L.forEach(t.mutations,s=>{const i=new gn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new gn(t,0),s=this.br.firstAfterOrEqual(r);return L.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,L.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jR{constructor(e){this.Mr=e,this.docs=function(){return new Dt(Ie.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return L.resolve(r?r.document.mutableCopy():Ot.newInvalidDocument(t))}getEntries(e,t){let r=Jn();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Ot.newInvalidDocument(s))}),L.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Jn();const o=t.path,a=new Ie(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:d}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Sp(k0(d),r)<=0||(s.has(d.key)||xu(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return L.resolve(i)}getAllFromCollectionGroup(e,t,r,s){xe()}Or(e,t){return L.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new BR(this)}getSize(e){return L.resolve(this.size)}}class BR extends qb{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),L.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qR{constructor(e){this.persistence=e,this.Nr=new As(t=>so(t),Eu),this.lastRemoteSnapshotVersion=Re.min(),this.highestTargetId=0,this.Lr=0,this.Br=new qp,this.targetCount=0,this.kr=uo.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),L.resolve()}getLastRemoteSnapshotVersion(e){return L.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return L.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),L.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),L.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new uo(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,L.resolve()}updateTargetData(e,t){return this.Kn(t),L.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,L.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),L.waitFor(i).next(()=>s)}getTargetCount(e){return L.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return L.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),L.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),L.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),L.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return L.resolve(r)}containsKey(e,t){return L.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zp{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Wn(0),this.Kr=!1,this.Kr=!0,this.$r=new UR,this.referenceDelegate=e(this),this.Ur=new qR(this),this.indexManager=new PR,this.remoteDocumentCache=function(s){return new jR(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new Nb(t),this.Gr=new LR(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new FR,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new $R(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){te("MemoryPersistence","Starting transaction:",e);const s=new zR(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return L.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class zR extends V0{constructor(e){super(),this.currentSequenceNumber=e}}class Wd{constructor(e){this.persistence=e,this.Jr=new qp,this.Yr=null}static Zr(e){return new Wd(e)}get Xr(){if(this.Yr)return this.Yr;throw xe()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),L.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),L.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),L.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return L.forEach(this.Xr,r=>{const s=Ie.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Re.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return L.or([()=>L.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class cd{constructor(e,t){this.persistence=e,this.ti=new As(r=>On(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=Bb(this,t)}static Zr(e,t){return new cd(e,t)}zr(){}jr(e){return L.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return L.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?L.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Re.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),L.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),L.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),L.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),L.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Nc(e.data.value)),t}nr(e,t,r){return L.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return L.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GR{constructor(e){this.serializer=e}O(e,t,r,s){const i=new Ud("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ov,{unique:!0}),l.createObjectStore("documentMutations")}(e),Hv(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=L.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),Hv(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Re.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(d=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ov,{unique:!0});const f=c.store("mutations"),v=d.map(y=>f.put(y));return L.waitFor(v)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:RP});c.createIndex("collectionPathOverlayIndex",CP,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",kP,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:yP});c.createIndex("documentKeyIndex",_P),c.createIndex("collectionGroupIndex",bP)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:xP}).createIndex("sequenceNumberIndex",AP,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:SP}).createIndex("documentKeyIndex",PP,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=ud(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>L.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>L.forEach(a,l=>{Se(l.userId===i.userId);const c=Gi(this.serializer,l);return Fb(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new lt(o),c=function(f){return[0,On(f)]}(l);i.push(t.get(c).next(d=>d?L.resolve():(f=>t.put({targetId:0,path:On(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>L.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:TP});const r=t.store("collectionParents"),s=new Bp,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:On(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new lt(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const d=Mr(a);return i(d.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=Tl(s),o=Ob(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new Ie(lt.fromString(f.document.name).popFirst(5)):f.noDocument?Ie.fromSegments(f.noDocument.path):f.unknownDocument?Ie.fromSegments(f.unknownDocument.path):xe()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>L.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=zb(this.serializer),i=new zp(Wd.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let d=(c=a.get(l.userId))!==null&&c!==void 0?c:Je();Gi(this.serializer,l).keys().forEach(f=>d=d.add(f)),a.set(l.userId,d)}),L.forEach(a,(l,c)=>{const d=new vn(c),f=Kd.lt(this.serializer,d),v=i.getIndexManager(d),y=Hd.lt(d,this.serializer,v,i.referenceDelegate);return new Gb(s,y,f,v).recalculateAndSaveOverlaysForDocumentKeys(new kf(t,Wn.oe),l).next()})})}}function Hv(n){n.createObjectStore("targetDocuments",{keyPath:IP}).createIndex("documentTargetsIndex",EP,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",wP,{unique:!0}),n.createObjectStore("targetGlobal")}const Jh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Gp{constructor(e,t,r,s,i,o,a,l,c,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=v=>Promise.resolve(),!Gp.D())throw new ne(q.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new VR(this,s),this.Ai=t+"main",this.serializer=new Nb(l),this.Ri=new Ur(this.Ai,this.hi,new GR(this.serializer)),this.$r=new IR,this.Ur=new CR(this.referenceDelegate,this.serializer),this.remoteDocumentCache=zb(this.serializer),this.Gr=new wR,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&Zt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ne(q.FAILED_PRECONDITION,Jh);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Wn(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>bc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Ii(e))return te("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return te("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return gl(e).get("owner").next(t=>L.resolve(this.vi(t)))}Ci(e){return bc(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=hn(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return L.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?L.resolve(!0):gl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new ne(q.FAILED_PRECONDITION,Jh);return!1}}return!(!this.networkEnabled||!this.inForeground)||bc(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&te("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new kf(e,Wn.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>bc(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Hd.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new RR(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Kd.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){te("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?NP:l===16?VP:l===15?Rp:l===14?U0:l===13?F0:l===12?DP:l===11?L0:void xe()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new kf(a,this.Qr?this.Qr.next():Wn.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw Zt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new ne(q.FAILED_PRECONDITION,D0);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return gl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new ne(q.FAILED_PRECONDITION,Jh)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return gl(e).put("owner",t)}static D(){return Ur.D()}bi(e){const t=gl(e);return t.get("owner").next(r=>this.vi(r)?(te("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):L.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Zt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;h0()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return te("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Zt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Zt("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function gl(n){return hn(n,"owner")}function bc(n){return hn(n,"clientMetadata")}function Kp(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hp{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=Je(),s=Je();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Hp(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KR{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kb{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return h0()?8:N0(dn())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new KR;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(Yo()<=at.DEBUG&&te("QueryEngine","SDK will not create cache indexes for query:",Xo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),L.resolve()):(Yo()<=at.DEBUG&&te("QueryEngine","Query:",Xo(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Yo()<=at.DEBUG&&te("QueryEngine","The SDK decides to create cache indexes for query:",Xo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Mn(t))):L.resolve())}Yi(e,t){if(_v(t))return L.resolve(null);let r=Mn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=id(t,null,"F"),r=Mn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Je(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,id(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return _v(t)||s.isEqual(Re.min())?L.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?L.resolve(null):(Yo()<=at.DEBUG&&te("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Xo(t)),this.rs(e,o,t,C0(s,-1)).next(a=>a))})}ts(e,t){let r=new It(sb(e));return t.forEach((s,i)=>{xu(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return Yo()<=at.DEBUG&&te("QueryEngine","Using full collection scan to execute query:",Xo(t)),this.Ji.getDocumentsMatchingQuery(e,t,rr.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HR{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Dt(Be),this._s=new As(i=>so(i),Eu),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Gb(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function Hb(n,e,t,r){return new HR(n,e,t,r)}async function Wb(n,e){const t=ve(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=Je();for(const c of s){o.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}for(const c of i){a.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function WR(n,e){const t=ve(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,d){const f=c.batch,v=f.keys();let y=L.resolve();return v.forEach(P=>{y=y.next(()=>d.getEntry(l,P)).next(A=>{const R=c.docVersions.get(P);Se(R!==null),A.version.compareTo(R)<0&&(f.applyToRemoteDocument(A,c),A.isValidDocument()&&(A.setReadTime(c.commitVersion),d.addEntry(A)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=Je();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function Qb(n){const e=ve(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function QR(n,e){const t=ve(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((d,f)=>{const v=s.get(f);if(!v)return;a.push(t.Ur.removeMatchingKeys(i,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,d.addedDocuments,f)));let y=v.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(Wt.EMPTY_BYTE_STRING,Re.min()).withLastLimboFreeSnapshotVersion(Re.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,r)),s=s.insert(f,y),function(A,R,j){return A.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-A.snapshotVersion.toMicroseconds()>=3e8?!0:j.addedDocuments.size+j.modifiedDocuments.size+j.removedDocuments.size>0}(v,y,d)&&a.push(t.Ur.updateTargetData(i,y))});let l=Jn(),c=Je();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),a.push(Jb(i,o,e.documentUpdates).next(d=>{l=d.Ps,c=d.Is})),!r.isEqual(Re.min())){const d=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(d)}return L.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function Jb(n,e,t){let r=Je(),s=Je();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Jn();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(Re.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):te("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function JR(n,e){const t=ve(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Aa(n,e){const t=ve(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,L.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new us(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function Sa(n,e,t){const r=ve(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Ii(o))throw o;te("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function dd(n,e,t){const r=ve(n);let s=Re.min(),i=Je();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,d){const f=ve(l),v=f._s.get(d);return v!==void 0?L.resolve(f.os.get(v)):f.Ur.getTargetData(c,d)}(r,o,Mn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:Re.min(),t?i:Je())).next(a=>(Zb(r,rb(e),a),{documents:a,Ts:i})))}function Yb(n,e){const t=ve(n),r=ve(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function Xb(n,e){const t=ve(n),r=t.us.get(e)||Re.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,C0(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(Zb(t,e,s),s))}function Zb(n,e,t){let r=n.us.get(e)||Re.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function YR(n,e,t,r){const s=ve(n);let i=Je(),o=Jn();for(const c of t){const d=e.Es(c.metadata.name);c.document&&(i=i.add(d));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(d,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await Aa(s,function(d){return Mn(Fa(lt.fromString(`__bundle__/docs/${d}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>Jb(c,a,o).next(d=>(a.apply(c),d)).next(d=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,d.Ps,d.Is)).next(()=>d.Ps)))}async function XR(n,e,t=Je()){const r=await Aa(n,Mn($p(e.bundledQuery))),s=ve(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=tn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(Wt.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function Wv(n,e){return`firestore_clients_${n}_${e}`}function Qv(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Yh(n,e){return`firestore_targets_${n}_${e}`}class hd{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new ne(s.error.code,s.error.message))),o?new hd(e,t,s.state,i):(Zt("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class $l{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new ne(r.error.code,r.error.message))),i?new $l(e,r.state,s):(Zt("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class fd{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Dp();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=O0(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new fd(e,i):(Zt("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Wp{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Wp(t.clientId,t.onlineState):(Zt("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Gf{constructor(){this.activeTargetIds=Dp()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Xh{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Dt(Be),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=Wv(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Gf),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(Wv(this.persistenceKey,r));if(s){const i=fd.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Yh(this.persistenceKey,e));if(s){const i=$l.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Yh(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return te("SharedClientState","READ",e,t),t}setItem(e,t){te("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){te("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(te("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Zt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=Wn.oe;if(i!=null)try{const a=JSON.parse(i);Se(typeof a=="number"),o=a}catch(a){Zt("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Wn.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new hd(this.currentUser,e,t,r),i=Qv(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=Qv(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Yh(this.persistenceKey,e),i=new $l(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return fd.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return hd.Rs(new vn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return $l.Rs(s,t)}Ls(e){return Wp.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);te("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Dp();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class ew{constructor(){this.so=new Gf,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Gf,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZR{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jv{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){te("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){te("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wc=null;function Zh(){return wc===null?wc=function(){return 268435456+Math.round(2147483648*Math.random())}():wc++,"0x"+wc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e1={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t1{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pn="WebChannelConnection";class n1 extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=Zh(),l=this.xo(t,r.toUriEncodedString());te("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(d=>(te("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw fr("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",l,"request:",s),d})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+La}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=e1[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Zh();return new Promise((o,a)=>{const l=new w0;l.setWithCredentials(!0),l.listenOnce(I0.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case kc.NO_ERROR:const d=l.getResponseJson();te(Pn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(d)),o(d);break;case kc.TIMEOUT:te(Pn,`RPC '${e}' ${i} timed out`),a(new ne(q.DEADLINE_EXCEEDED,"Request time out"));break;case kc.HTTP_ERROR:const f=l.getStatus();if(te(Pn,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let v=l.getResponseJson();Array.isArray(v)&&(v=v[0]);const y=v==null?void 0:v.error;if(y&&y.status&&y.message){const P=function(R){const j=R.toLowerCase().replace(/_/g,"-");return Object.values(q).indexOf(j)>=0?j:q.UNKNOWN}(y.status);a(new ne(P,y.message))}else a(new ne(q.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new ne(q.UNAVAILABLE,"Connection failed."));break;default:xe()}}finally{te(Pn,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);te(Pn,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=Zh(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=x0(),a=T0(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=i.join("");te(Pn,`Creating RPC '${e}' stream ${s}: ${d}`,l);const f=o.createWebChannel(d,l);let v=!1,y=!1;const P=new t1({Io:R=>{y?te(Pn,`Not sending because RPC '${e}' stream ${s} is closed:`,R):(v||(te(Pn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),v=!0),te(Pn,`RPC '${e}' stream ${s} sending:`,R),f.send(R))},To:()=>f.close()}),A=(R,j,B)=>{R.listen(j,F=>{try{B(F)}catch(G){setTimeout(()=>{throw G},0)}})};return A(f,wl.EventType.OPEN,()=>{y||(te(Pn,`RPC '${e}' stream ${s} transport opened.`),P.yo())}),A(f,wl.EventType.CLOSE,()=>{y||(y=!0,te(Pn,`RPC '${e}' stream ${s} transport closed`),P.So())}),A(f,wl.EventType.ERROR,R=>{y||(y=!0,fr(Pn,`RPC '${e}' stream ${s} transport errored:`,R),P.So(new ne(q.UNAVAILABLE,"The operation could not be completed")))}),A(f,wl.EventType.MESSAGE,R=>{var j;if(!y){const B=R.data[0];Se(!!B);const F=B,G=F.error||((j=F[0])===null||j===void 0?void 0:j.error);if(G){te(Pn,`RPC '${e}' stream ${s} received error:`,G);const oe=G.status;let ie=function(x){const k=rn[x];if(k!==void 0)return yb(k)}(oe),I=G.message;ie===void 0&&(ie=q.INTERNAL,I="Unknown error status: "+oe+" with message "+G.message),y=!0,P.So(new ne(ie,I)),f.close()}else te(Pn,`RPC '${e}' stream ${s} received:`,B),P.bo(B)}}),A(a,E0.STAT_EVENT,R=>{R.stat===Rf.PROXY?te(Pn,`RPC '${e}' stream ${s} detected buffering proxy`):R.stat===Rf.NOPROXY&&te(Pn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{P.wo()},0),P}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tw(){return typeof window<"u"?window:null}function Fc(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ru(n){return new cR(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qp{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&te("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nw{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Qp(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===q.RESOURCE_EXHAUSTED?(Zt(t.toString()),Zt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===q.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new ne(q.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return te("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(te("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class r1 extends nw{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=fR(this.serializer,e),r=function(i){if(!("targetChange"in i))return Re.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Re.min():o.readTime?tn(o.readTime):Re.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=$f(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=rd(l)?{documents:Pb(i,l)}:{query:Gd(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Ib(i,o.resumeToken);const c=Ff(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(Re.min())>0){a.readTime=xa(i,o.snapshotVersion.toTimestamp());const c=Ff(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=mR(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=$f(this.serializer),t.removeTarget=e,this.a_(t)}}class s1 extends nw{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Se(!!e.streamToken),this.lastStreamToken=e.streamToken,Se(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Se(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=pR(e.writeResults,e.commitTime),r=tn(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=$f(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>ru(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i1 extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new ne(q.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Uf(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new ne(q.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Uf(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ne(q.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class o1{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Zt(t),this.D_=!1):te("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a1{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Ti(this)&&(te("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=ve(l);c.L_.add(4),await ja(c),c.q_.set("Unknown"),c.L_.delete(4),await Cu(c)}(this))})}),this.q_=new o1(r,s)}}async function Cu(n){if(Ti(n))for(const e of n.B_)await e(!0)}async function ja(n){for(const e of n.B_)await e(!1)}function Qd(n,e){const t=ve(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Xp(t)?Yp(t):qa(t).r_()&&Jp(t,e))}function Pa(n,e){const t=ve(n),r=qa(t);t.N_.delete(e),r.r_()&&rw(t,e),t.N_.size===0&&(r.r_()?r.o_():Ti(t)&&t.q_.set("Unknown"))}function Jp(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Re.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}qa(n).A_(e)}function rw(n,e){n.Q_.xe(e),qa(n).R_(e)}function Yp(n){n.Q_=new oR({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),qa(n).start(),n.q_.v_()}function Xp(n){return Ti(n)&&!qa(n).n_()&&n.N_.size>0}function Ti(n){return ve(n).L_.size===0}function sw(n){n.Q_=void 0}async function l1(n){n.q_.set("Online")}async function u1(n){n.N_.forEach((e,t)=>{Jp(n,e)})}async function c1(n,e){sw(n),Xp(n)?(n.q_.M_(e),Yp(n)):n.q_.set("Unknown")}async function d1(n,e,t){if(n.q_.set("Online"),e instanceof wb&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){te("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await pd(n,r)}else if(e instanceof Lc?n.Q_.Ke(e):e instanceof bb?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Re.min()))try{const r=await Qb(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.N_.get(c);d&&i.N_.set(c,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const d=i.N_.get(l);if(!d)return;i.N_.set(l,d.withResumeToken(Wt.EMPTY_BYTE_STRING,d.snapshotVersion)),rw(i,l);const f=new us(d.target,l,c,d.sequenceNumber);Jp(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){te("RemoteStore","Failed to raise snapshot:",r),await pd(n,r)}}async function pd(n,e,t){if(!Ii(e))throw e;n.L_.add(1),await ja(n),n.q_.set("Offline"),t||(t=()=>Qb(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{te("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Cu(n)})}function iw(n,e){return e().catch(t=>pd(n,t,e))}async function Ba(n){const e=ve(n),t=vi(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;h1(e);)try{const s=await JR(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,f1(e,s)}catch(s){await pd(e,s)}ow(e)&&aw(e)}function h1(n){return Ti(n)&&n.O_.length<10}function f1(n,e){n.O_.push(e);const t=vi(n);t.r_()&&t.V_&&t.m_(e.mutations)}function ow(n){return Ti(n)&&!vi(n).n_()&&n.O_.length>0}function aw(n){vi(n).start()}async function p1(n){vi(n).p_()}async function m1(n){const e=vi(n);for(const t of n.O_)e.m_(t.mutations)}async function g1(n,e,t){const r=n.O_.shift(),s=Mp.from(r,e,t);await iw(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Ba(n)}async function v1(n,e){e&&vi(n).V_&&await async function(r,s){if(function(o){return vb(o)&&o!==q.ABORTED}(s.code)){const i=r.O_.shift();vi(r).s_(),await iw(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Ba(r)}}(n,e),ow(n)&&aw(n)}async function Yv(n,e){const t=ve(n);t.asyncQueue.verifyOperationInProgress(),te("RemoteStore","RemoteStore received new credentials");const r=Ti(t);t.L_.add(3),await ja(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Cu(t)}async function Kf(n,e){const t=ve(n);e?(t.L_.delete(2),await Cu(t)):e||(t.L_.add(2),await ja(t),t.q_.set("Unknown"))}function qa(n){return n.K_||(n.K_=function(t,r,s){const i=ve(t);return i.w_(),new r1(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:l1.bind(null,n),Ro:u1.bind(null,n),mo:c1.bind(null,n),d_:d1.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Xp(n)?Yp(n):n.q_.set("Unknown")):(await n.K_.stop(),sw(n))})),n.K_}function vi(n){return n.U_||(n.U_=function(t,r,s){const i=ve(t);return i.w_(),new s1(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:p1.bind(null,n),mo:v1.bind(null,n),f_:m1.bind(null,n),g_:g1.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await Ba(n)):(await n.U_.stop(),n.O_.length>0&&(te("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zp{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new yn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Zp(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ne(q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function za(n,e){if(Zt("AsyncQueue",`${e}: ${n}`),Ii(n))return new ne(q.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Ie.comparator(t.key,r.key):(t,r)=>Ie.comparator(t.key,r.key),this.keyedMap=Il(),this.sortedSet=new Dt(this.comparator)}static emptySet(e){return new la(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof la)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new la;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xv{constructor(){this.W_=new Dt(Ie.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):xe():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Ra{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Ra(e,t,la.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Tu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y1{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class _1{constructor(){this.queries=Zv(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=ve(t),i=s.queries;s.queries=Zv(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new ne(q.ABORTED,"Firestore shutting down"))}}function Zv(){return new As(n=>nb(n),Tu)}async function em(n,e){const t=ve(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new y1,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=za(o,`Initialization of query '${Xo(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&nm(t)}async function tm(n,e){const t=ve(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function b1(n,e){const t=ve(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&nm(t)}function w1(n,e,t){const r=ve(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function nm(n){n.Y_.forEach(e=>{e.next()})}var Hf,ey;(ey=Hf||(Hf={})).ea="default",ey.Cache="cache";class rm{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Ra(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Ra.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Hf.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I1{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ty{constructor(e){this.serializer=e}Es(e){return $r(this.serializer,e)}ds(e){return e.metadata.exists?Sb(this.serializer,e.document,!1):Ot.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return tn(e)}}class E1{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=lw(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=lt.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new ty(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Je()).add(i);t.set(o,a)}}return t}async complete(){const e=await YR(this.localStore,new ty(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await XR(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function lw(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uw{constructor(e){this.key=e}}class cw{constructor(e){this.key=e}}class dw{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Je(),this.mutatedKeys=Je(),this.Aa=sb(e),this.Ra=new la(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new Xv,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,f)=>{const v=s.get(d),y=xu(this.query,f)?f:null,P=!!v&&this.mutatedKeys.has(v.key),A=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let R=!1;v&&y?v.data.isEqual(y.data)?P!==A&&(r.track({type:3,doc:y}),R=!0):this.ga(v,y)||(r.track({type:2,doc:y}),R=!0,(l&&this.Aa(y,l)>0||c&&this.Aa(y,c)<0)&&(a=!0)):!v&&y?(r.track({type:0,doc:y}),R=!0):v&&!y&&(r.track({type:1,doc:v}),R=!0,(l||c)&&(a=!0)),R&&(y?(o=o.add(y),i=A?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((d,f)=>function(y,P){const A=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return xe()}};return A(y)-A(P)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new Ra(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Xv,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Je(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new cw(r))}),this.da.forEach(r=>{e.has(r)||t.push(new uw(r))}),t}ba(e){this.Ta=e.Ts,this.da=Je();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Ra.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class T1{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class x1{constructor(e){this.key=e,this.va=!1}}class A1{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new As(a=>nb(a),Tu),this.Ma=new Map,this.xa=new Set,this.Oa=new Dt(Ie.comparator),this.Na=new Map,this.La=new qp,this.Ba={},this.ka=new Map,this.qa=uo.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function S1(n,e,t=!0){const r=Jd(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await hw(r,e,t,!0),s}async function P1(n,e){const t=Jd(n);await hw(t,e,!0,!1)}async function hw(n,e,t,r){const s=await Aa(n.localStore,Mn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await sm(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&Qd(n.remoteStore,s),a}async function sm(n,e,t,r,s){n.Ka=(f,v,y)=>async function(A,R,j,B){let F=R.view.ma(j);F.ns&&(F=await dd(A.localStore,R.query,!1).then(({documents:I})=>R.view.ma(I,F)));const G=B&&B.targetChanges.get(R.targetId),oe=B&&B.targetMismatches.get(R.targetId)!=null,ie=R.view.applyChanges(F,A.isPrimaryClient,G,oe);return Wf(A,R.targetId,ie.wa),ie.snapshot}(n,f,v,y);const i=await dd(n.localStore,e,!0),o=new dw(e,i.Ts),a=o.ma(i.documents),l=Pu.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);Wf(n,t,c.wa);const d=new T1(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function R1(n,e,t){const r=ve(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Tu(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Sa(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Pa(r.remoteStore,s.targetId),Ca(r,s.targetId)}).catch(wi)):(Ca(r,s.targetId),await Sa(r.localStore,s.targetId,!0))}async function C1(n,e){const t=ve(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Pa(t.remoteStore,r.targetId))}async function k1(n,e,t){const r=lm(n);try{const s=await function(o,a){const l=ve(o),c=qt.now(),d=a.reduce((y,P)=>y.add(P.key),Je());let f,v;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let P=Jn(),A=Je();return l.cs.getEntries(y,d).next(R=>{P=R,P.forEach((j,B)=>{B.isValidDocument()||(A=A.add(j))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,P)).next(R=>{f=R;const j=[];for(const B of a){const F=rR(B,f.get(B.key).overlayedDocument);F!=null&&j.push(new Ss(B.key,F,G0(F.value.mapValue),Bt.exists(!0)))}return l.mutationQueue.addMutationBatch(y,c,j,a)}).next(R=>{v=R;const j=R.applyToLocalDocumentSet(f,A);return l.documentOverlayCache.saveOverlays(y,R.batchId,j)})}).then(()=>({batchId:v.batchId,changes:ob(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new Dt(Be)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await Ps(r,s.changes),await Ba(r.remoteStore)}catch(s){const i=za(s,"Failed to persist write");t.reject(i)}}async function fw(n,e){const t=ve(n);try{const r=await QR(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Se(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Se(o.va):s.removedDocuments.size>0&&(Se(o.va),o.va=!1))}),await Ps(t,r,e)}catch(r){await wi(r)}}function ny(n,e,t){const r=ve(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=ve(o);l.onlineState=a;let c=!1;l.queries.forEach((d,f)=>{for(const v of f.j_)v.Z_(a)&&(c=!0)}),c&&nm(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function D1(n,e,t){const r=ve(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Dt(Ie.comparator);o=o.insert(i,Ot.newNoDocument(i,Re.min()));const a=Je().add(i),l=new Su(Re.min(),new Map,new Dt(Be),o,a);await fw(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),am(r)}else await Sa(r.localStore,e,!1).then(()=>Ca(r,e,t)).catch(wi)}async function V1(n,e){const t=ve(n),r=e.batch.batchId;try{const s=await WR(t.localStore,e);om(t,r,null),im(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Ps(t,s)}catch(s){await wi(s)}}async function N1(n,e,t){const r=ve(n);try{const s=await function(o,a){const l=ve(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(Se(f!==null),d=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>l.localDocuments.getDocuments(c,d))})}(r.localStore,e);om(r,e,t),im(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Ps(r,s)}catch(s){await wi(s)}}async function O1(n,e){const t=ve(n);Ti(t.remoteStore)||te("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=ve(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=za(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function im(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function om(n,e,t){const r=ve(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Ca(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||pw(n,r)})}function pw(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Pa(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),am(n))}function Wf(n,e,t){for(const r of t)r instanceof uw?(n.La.addReference(r.key,e),M1(n,r)):r instanceof cw?(te("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||pw(n,r.key)):xe()}function M1(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(te("SyncEngine","New document in limbo: "+t),n.xa.add(r),am(n))}function am(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Ie(lt.fromString(e)),r=n.qa.next();n.Na.set(r,new x1(t)),n.Oa=n.Oa.insert(t,r),Qd(n.remoteStore,new us(Mn(Fa(t.path)),r,"TargetPurposeLimboResolution",Wn.oe))}}async function Ps(n,e,t){const r=ve(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var d;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(d=t==null?void 0:t.targetChanges.get(l.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=Hp.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const d=ve(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>L.forEach(c,v=>L.forEach(v.$i,y=>d.persistence.referenceDelegate.addReference(f,v.targetId,y)).next(()=>L.forEach(v.Ui,y=>d.persistence.referenceDelegate.removeReference(f,v.targetId,y)))))}catch(f){if(!Ii(f))throw f;te("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const v=f.targetId;if(!f.fromCache){const y=d.os.get(v),P=y.snapshotVersion,A=y.withLastLimboFreeSnapshotVersion(P);d.os=d.os.insert(v,A)}}}(r.localStore,i))}async function L1(n,e){const t=ve(n);if(!t.currentUser.isEqual(e)){te("SyncEngine","User change. New user:",e.toKey());const r=await Wb(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new ne(q.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Ps(t,r.hs)}}function F1(n,e){const t=ve(n),r=t.Na.get(e);if(r&&r.va)return Je().add(r.key);{let s=Je();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function U1(n,e){const t=ve(n),r=await dd(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&Wf(t,e.targetId,s.wa),s}async function $1(n,e){const t=ve(n);return Xb(t.localStore,e).then(r=>Ps(t,r))}async function j1(n,e,t,r){const s=ve(n),i=await function(a,l){const c=ve(a),d=ve(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,l).next(v=>v?c.localDocuments.getDocuments(f,v):L.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Ba(s.remoteStore):t==="acknowledged"||t==="rejected"?(om(s,e,r||null),im(s,e),function(a,l){ve(ve(a).mutationQueue).On(l)}(s.localStore,e)):xe(),await Ps(s,i)):te("SyncEngine","Cannot apply mutation batch with id: "+e)}async function B1(n,e){const t=ve(n);if(Jd(t),lm(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await ry(t,r.toArray());t.Qa=!0,await Kf(t.remoteStore,!0);for(const i of s)Qd(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Ca(t,o),Sa(t.localStore,o,!0))),Pa(t.remoteStore,o)}),await s,await ry(t,r),function(o){const a=ve(o);a.Na.forEach((l,c)=>{Pa(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Dt(Ie.comparator)}(t),t.Qa=!1,await Kf(t.remoteStore,!1)}}async function ry(n,e,t){const r=ve(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await Aa(r.localStore,Mn(l[0]));for(const c of l){const d=r.Fa.get(c),f=await U1(r,d);f.snapshot&&i.push(f.snapshot)}}else{const c=await Yb(r.localStore,o);a=await Aa(r.localStore,c),await sm(r,mw(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function mw(n){return Z0(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function q1(n){return function(t){return ve(ve(t).persistence).Qi()}(ve(n).localStore)}async function z1(n,e,t,r){const s=ve(n);if(s.Qa)return void te("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await Xb(s.localStore,rb(i[0])),a=Su.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Wt.EMPTY_BYTE_STRING);await Ps(s,o,a);break}case"rejected":await Sa(s.localStore,e,!0),Ca(s,e,r);break;default:xe()}}async function G1(n,e,t){const r=Jd(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){te("SyncEngine","Adding an already active target "+s);continue}const i=await Yb(r.localStore,s),o=await Aa(r.localStore,i);await sm(r,mw(i),o.targetId,!1,o.resumeToken),Qd(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await Sa(r.localStore,s,!1).then(()=>{Pa(r.remoteStore,s),Ca(r,s)}).catch(wi)}}function Jd(n){const e=ve(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=fw.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=F1.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=D1.bind(null,e),e.Ca.d_=b1.bind(null,e.eventManager),e.Ca.$a=w1.bind(null,e.eventManager),e}function lm(n){const e=ve(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=V1.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=N1.bind(null,e),e}function K1(n,e,t){const r=ve(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,P){const A=ve(y),R=tn(P.createTime);return A.persistence.runTransaction("hasNewerBundle","readonly",j=>A.Gr.getBundleMetadata(j,P.id)).then(j=>!!j&&j.createTime.compareTo(R)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(lw(l));const c=new E1(l,i.localStore,o.serializer);let d=await o.Ua();for(;d;){const v=await c.la(d);v&&a._updateProgress(v),d=await o.Ua()}const f=await c.complete();return await Ps(i,f.Ia,void 0),await function(y,P){const A=ve(y);return A.persistence.runTransaction("Save bundle","readwrite",R=>A.Gr.saveBundleMetadata(R,P))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return fr("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class yi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ru(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return Hb(this.persistence,new Kb,e.initialUser,this.serializer)}Ga(e){return new zp(Wd.Zr,this.serializer)}Wa(e){return new ew}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}yi.provider={build:()=>new yi};class H1 extends yi{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Se(this.persistence.referenceDelegate instanceof cd);const r=this.persistence.referenceDelegate.garbageCollector;return new jb(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?Cn.withCacheSize(this.cacheSizeBytes):Cn.DEFAULT;return new zp(r=>cd.Zr(r,t),this.serializer)}}class um extends yi{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await lm(this.Ja.syncEngine),await Ba(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return Hb(this.persistence,new Kb,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new jb(r,e.asyncQueue,t)}Ha(e,t){const r=new mP(t,this.persistence);return new pP(e.asyncQueue,r)}Ga(e){const t=Kp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Cn.withCacheSize(this.cacheSizeBytes):Cn.DEFAULT;return new Gp(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,tw(),Fc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new ew}}class gw extends um{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Xh&&(this.sharedClientState.syncEngine={no:j1.bind(null,t),ro:z1.bind(null,t),io:G1.bind(null,t),Qi:q1.bind(null,t),eo:$1.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await B1(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=tw();if(!Xh.D(t))throw new ne(q.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Kp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Xh(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class _i{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>ny(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=L1.bind(null,this.syncEngine),await Kf(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new _1}()}createDatastore(e){const t=Ru(e.databaseInfo.databaseId),r=function(i){return new n1(i)}(e.databaseInfo);return function(i,o,a,l){return new i1(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new a1(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>ny(this.syncEngine,t,0),function(){return Jv.D()?new Jv:new ZR}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,d){const f=new A1(s,i,o,a,l,c);return d&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=ve(s);te("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await ja(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}_i.provider={build:()=>new _i};function sy(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Zt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W1{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new yn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new I1(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q1{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new ne(q.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=ve(s),a={documents:i.map(f=>nu(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,lt.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const v=hR(o.serializer,f);c.set(v.key.toString(),v)});const d=[];return i.forEach(f=>{const v=c.get(f.toString());Se(!!v),d.push(v)}),d}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new $a(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=Ie.fromPath(r);this.mutations.push(new Np(s,this.precondition(s)))}),await async function(r,s){const i=ve(r),o={writes:s.map(a=>ru(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,lt.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw xe();t=Re.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new ne(q.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Re.min())?Bt.exists(!1):Bt.updateTime(t):Bt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Re.min()))throw new ne(q.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Bt.updateTime(t)}return Bt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J1{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Qp(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new Q1(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!Iu(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!vb(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y1{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=vn.UNAUTHENTICATED,this.clientId=P0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{te("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(te("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new yn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=za(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function ef(n,e){n.asyncQueue.verifyOperationInProgress(),te("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await Wb(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function iy(n,e){n.asyncQueue.verifyOperationInProgress();const t=await cm(n);te("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Yv(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Yv(e.remoteStore,s)),n._onlineComponents=e}async function cm(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){te("FirestoreClient","Using user provided OfflineComponentProvider");try{await ef(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===q.FAILED_PRECONDITION||s.code===q.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;fr("Error using user provided cache. Falling back to memory cache: "+t),await ef(n,new yi)}}else te("FirestoreClient","Using default OfflineComponentProvider"),await ef(n,new yi);return n._offlineComponents}async function Xd(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(te("FirestoreClient","Using user provided OnlineComponentProvider"),await iy(n,n._uninitializedComponentsProvider._online)):(te("FirestoreClient","Using default OnlineComponentProvider"),await iy(n,new _i))),n._onlineComponents}function vw(n){return cm(n).then(e=>e.persistence)}function Ga(n){return cm(n).then(e=>e.localStore)}function yw(n){return Xd(n).then(e=>e.remoteStore)}function dm(n){return Xd(n).then(e=>e.syncEngine)}function _w(n){return Xd(n).then(e=>e.datastore)}async function ka(n){const e=await Xd(n),t=e.eventManager;return t.onListen=S1.bind(null,e.syncEngine),t.onUnlisten=R1.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=P1.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=C1.bind(null,e.syncEngine),t}function X1(n){return n.asyncQueue.enqueue(async()=>{const e=await vw(n),t=await yw(n);return e.setNetworkEnabled(!0),function(s){const i=ve(s);return i.L_.delete(0),Cu(i)}(t)})}function Z1(n){return n.asyncQueue.enqueue(async()=>{const e=await vw(n),t=await yw(n);return e.setNetworkEnabled(!1),async function(s){const i=ve(s);i.L_.add(0),await ja(i),i.q_.set("Offline")}(t)})}function eC(n,e){const t=new yn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,d){const f=ve(c);return f.persistence.runTransaction("read document","readonly",v=>f.localDocuments.getDocument(v,d))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new ne(q.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=za(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Ga(n),e,t)),t.promise}function bw(n,e,t={}){const r=new yn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new Yd({next:v=>{d.Za(),o.enqueueAndForget(()=>tm(i,f));const y=v.docs.has(a);!y&&v.fromCache?c.reject(new ne(q.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&v.fromCache&&l&&l.source==="server"?c.reject(new ne(q.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(v)},error:v=>c.reject(v)}),f=new rm(Fa(a.path),d,{includeMetadataChanges:!0,_a:!0});return em(i,f)}(await ka(n),n.asyncQueue,e,t,r)),r.promise}function tC(n,e){const t=new yn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await dd(s,i,!0),l=new dw(i,a.Ts),c=l.ma(a.documents),d=l.applyChanges(c,!1);o.resolve(d.snapshot)}catch(a){const l=za(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Ga(n),e,t)),t.promise}function ww(n,e,t={}){const r=new yn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new Yd({next:v=>{d.Za(),o.enqueueAndForget(()=>tm(i,f)),v.fromCache&&l.source==="server"?c.reject(new ne(q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(v)},error:v=>c.reject(v)}),f=new rm(a,d,{includeMetadataChanges:!0,_a:!0});return em(i,f)}(await ka(n),n.asyncQueue,e,t,r)),r.promise}function nC(n,e,t){const r=new yn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await _w(n);r.resolve(async function(o,a,l){var c;const d=ve(o),{request:f,ut:v,parent:y}=Rb(d.serializer,eb(a),l);d.connection.Fo||delete f.parent;const P=(await d.Lo("RunAggregationQuery",d.serializer.databaseId,y,f,1)).filter(R=>!!R.result);Se(P.length===1);const A=(c=P[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(A).reduce((R,j)=>(R[v[j]]=A[j],R),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function rC(n,e){const t=new Yd(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){ve(s).Y_.add(i),i.next()}(await ka(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){ve(s).Y_.delete(i)}(await ka(n),t))}}function sC(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?_b().encode(o):o,function(d,f){return new W1(d,f)}(function(d,f){if(d instanceof Uint8Array)return sy(d,f);if(d instanceof ArrayBuffer)return sy(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,Ru(e));n.asyncQueue.enqueueAndForget(async()=>{K1(await dm(n),s,r)})}function iC(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=ve(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await Ga(n),e))}function oC(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=ve(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,v,y,P,A){f=[...f],v=[...v],f.sort(y),v.sort(y);const R=f.length,j=v.length;let B=0,F=0;for(;B<j&&F<R;){const G=y(f[F],v[B]);G<0?A(f[F++]):G>0?P(v[B++]):(B++,F++)}for(;B<j;)P(v[B++]);for(;F<R;)A(f[F++])}(c,s,cP,d=>{a.push(o.addFieldIndex(l,d))},d=>{a.push(o.deleteFieldIndex(l,d))})).next(()=>L.waitFor(a)))}(await Ga(n),e))}function aC(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){ve(r).ss.zi=s}(await Ga(n),e))}function lC(n){return n.asyncQueue.enqueue(async()=>function(t){const r=ve(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Ga(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iw(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oy=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hm(n,e,t){if(!t)throw new ne(q.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function uC(n,e,t,r){if(e===!0&&r===!0)throw new ne(q.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ay(n){if(!Ie.isDocumentKey(n))throw new ne(q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ly(n){if(Ie.isDocumentKey(n))throw new ne(q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Zd(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":xe()}function st(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new ne(q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Zd(n);throw new ne(q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Ew(n,e){if(e<=0)throw new ne(q.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uy{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new ne(q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ne(q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}uC("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Iw((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new ne(q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new ne(q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new ne(q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ku{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new uy({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ne(q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ne(q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new uy(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new nP;switch(r.type){case"firstParty":return new oP(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ne(q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=oy.get(t);r&&(te("ComponentProvider","Removing Datastore"),oy.delete(t),r.terminate())}(this),Promise.resolve()}}function cC(n,e,t,r={}){var s;const i=(n=st(n,ku))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&fr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=vn.MOCK_USER;else{a=kA(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new ne(q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new vn(c)}n._authCredentials=new rP(new A0(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Tn(this.firestore,e,this._query)}}class nn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new jr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new nn(this.firestore,e,this._key)}}class jr extends Tn{constructor(e,t,r){super(e,t,Fa(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new nn(this.firestore,null,new Ie(e))}withConverter(e){return new jr(this.firestore,e,this._path)}}function rt(n,e,...t){if(n=Ce(n),hm("collection","path",e),n instanceof ku){const r=lt.fromString(e,...t);return ly(r),new jr(n,null,r)}{if(!(n instanceof nn||n instanceof jr))throw new ne(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(lt.fromString(e,...t));return ly(r),new jr(n.firestore,null,r)}}function l3(n,e){if(n=st(n,ku),hm("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new ne(q.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Tn(n,null,function(r){return new xs(lt.emptyPath(),r)}(e))}function Fe(n,e,...t){if(n=Ce(n),arguments.length===1&&(e=P0.newId()),hm("doc","path",e),n instanceof ku){const r=lt.fromString(e,...t);return ay(r),new nn(n,null,new Ie(r))}{if(!(n instanceof nn||n instanceof jr))throw new ne(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(lt.fromString(e,...t));return ay(r),new nn(n.firestore,n instanceof jr?n.converter:null,new Ie(r))}}function u3(n,e){return n=Ce(n),e=Ce(e),(n instanceof nn||n instanceof jr)&&(e instanceof nn||e instanceof jr)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Tw(n,e){return n=Ce(n),e=Ce(e),n instanceof Tn&&e instanceof Tn&&n.firestore===e.firestore&&Tu(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cy{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Qp(this,"async_queue_retry"),this.Vu=()=>{const r=Fc();r&&te("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Fc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Fc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new yn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Ii(e))throw e;te("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Zt("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Zp.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&xe()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function Qf(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class dC{constructor(){this._progressObserver={},this._taskCompletionResolver=new yn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c3=-1;class St extends ku{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new cy,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new cy(e),this._firestoreClient=void 0,await e}}}function d3(n,e,t){t||(t="(default)");const r=wu(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(hi(i,e))return s;throw new ne(q.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new ne(q.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ne(q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function hC(n,e){const t=typeof n=="object"?n:v0(),r=typeof n=="string"?n:e||"(default)",s=wu(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=RA("firestore");i&&cC(s,...i)}return s}function zt(n){if(n._terminated)throw new ne(q.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||xw(n),n._firestoreClient}function xw(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,d){return new MP(a,l,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,Iw(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new Y1(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function fC(n,e){fr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return Aw(n,_i.provider,{build:r=>new um(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function h3(n){fr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();Aw(n,_i.provider,{build:t=>new gw(t,e.cacheSizeBytes)})}function Aw(n,e,t){if((n=st(n,St))._firestoreClient||n._terminated)throw new ne(q.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new ne(q.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},xw(n)}function f3(n){if(n._initialized&&!n._terminated)throw new ne(q.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new yn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Ur.D())return Promise.resolve();const s=r+"main";await Ur.delete(s)}(Kp(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function p3(n){return function(t){const r=new yn;return t.asyncQueue.enqueueAndForget(async()=>O1(await dm(t),r)),r.promise}(zt(n=st(n,St)))}function m3(n){return X1(zt(n=st(n,St)))}function g3(n){return Z1(zt(n=st(n,St)))}function v3(n){return BS(n.app,"firestore",n._databaseId.database),n._delete()}function y3(n,e){const t=zt(n=st(n,St)),r=new dC;return sC(t,n._databaseId,e,r),r}function _3(n,e){return iC(zt(n=st(n,St)),e).then(t=>t?new Tn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class su{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class pC{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(e){this._byteString=e}static fromBase64String(e){try{return new co(Wt.fromBase64String(e))}catch(t){throw new ne(q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new co(Wt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new ne(q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new jt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function b3(){return new fo("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class po{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fm{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ne(q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ne(q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Be(this._lat,e._lat)||Be(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mC=/^__.*__$/;class gC{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ss(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ua(e,this.data,t,this.fieldTransforms)}}class Sw{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ss(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Pw(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw xe()}}class th{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new th(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return md(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Pw(this.Cu)&&mC.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class vC{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Ru(e)}Qu(e,t,r,s=!1){return new th({Cu:e,methodName:t,qu:r,path:jt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function mo(n){const e=n._freezeSettings(),t=Ru(n._databaseId);return new vC(n._databaseId,!!e.ignoreUndefinedProperties,t)}function nh(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);bm("Data must be an object, but it was:",o,r);const a=kw(r,o);let l,c;if(i.merge)l=new Qn(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const f of i.mergeFields){const v=iu(e,f,t);if(!o.contains(v))throw new ne(q.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);Vw(d,v)||d.push(v)}l=new Qn(d),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new gC(new En(a),l,c)}class Du extends po{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Du}}function Rw(n,e,t){return new th({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class pm extends po{_toFieldTransform(e){return new Au(e.path,new Ea)}isEqual(e){return e instanceof pm}}class mm extends po{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=Rw(this,e,!0),r=this.Ku.map(i=>go(i,t)),s=new io(r);return new Au(e.path,s)}isEqual(e){return e instanceof mm&&hi(this.Ku,e.Ku)}}class gm extends po{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=Rw(this,e,!0),r=this.Ku.map(i=>go(i,t)),s=new oo(r);return new Au(e.path,s)}isEqual(e){return e instanceof gm&&hi(this.Ku,e.Ku)}}class vm extends po{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new Ta(e.serializer,ub(e.serializer,this.$u));return new Au(e.path,t)}isEqual(e){return e instanceof vm&&this.$u===e.$u}}function ym(n,e,t,r){const s=n.Qu(1,e,t);bm("Data must be an object, but it was:",s,r);const i=[],o=En.empty();Ei(r,(l,c)=>{const d=rh(e,l,t);c=Ce(c);const f=s.Nu(d);if(c instanceof Du)i.push(d);else{const v=go(c,f);v!=null&&(i.push(d),o.set(d,v))}});const a=new Qn(i);return new Sw(o,a,s.fieldTransforms)}function _m(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[iu(e,r,t)],l=[s];if(i.length%2!=0)throw new ne(q.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<i.length;v+=2)a.push(iu(e,i[v])),l.push(i[v+1]);const c=[],d=En.empty();for(let v=a.length-1;v>=0;--v)if(!Vw(c,a[v])){const y=a[v];let P=l[v];P=Ce(P);const A=o.Nu(y);if(P instanceof Du)c.push(y);else{const R=go(P,A);R!=null&&(c.push(y),d.set(y,R))}}const f=new Qn(c);return new Sw(d,f,o.fieldTransforms)}function Cw(n,e,t,r=!1){return go(t,n.Qu(r?4:3,e))}function go(n,e){if(Dw(n=Ce(n)))return bm("Unsupported field value:",e,n),kw(n,e);if(n instanceof po)return function(r,s){if(!Pw(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=go(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Ce(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return ub(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=qt.fromDate(r);return{timestampValue:xa(s.serializer,i)}}if(r instanceof qt){const i=new qt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:xa(s.serializer,i)}}if(r instanceof fm)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof co)return{bytesValue:Ib(s.serializer,r._byteString)};if(r instanceof nn){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Up(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof eh)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Vp(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Zd(r)}`)}(n,e)}function kw(n,e){const t={};return j0(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ei(n,(r,s)=>{const i=go(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function Dw(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof qt||n instanceof fm||n instanceof co||n instanceof nn||n instanceof po||n instanceof eh)}function bm(n,e,t){if(!Dw(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=Zd(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function iu(n,e,t){if((e=Ce(e))instanceof fo)return e._internalPath;if(typeof e=="string")return rh(n,e);throw md("Field path arguments must be of type string or ",n,!1,void 0,t)}const yC=new RegExp("[~\\*/\\[\\]]");function rh(n,e,t){if(e.search(yC)>=0)throw md(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new fo(...e.split("."))._internalPath}catch{throw md(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function md(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new ne(q.INVALID_ARGUMENT,a+n+l)}function Vw(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ou{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new nn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new _C(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(sh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class _C extends ou{data(){return super.data()}}function sh(n,e){return typeof e=="string"?rh(n,e):e instanceof fo?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new ne(q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class wm{}class Vu extends wm{}function ih(n,e,...t){let r=[];e instanceof wm&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Ka).length,a=i.filter(l=>l instanceof Nu).length;if(o>1||o>0&&a>0)throw new ne(q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Nu extends Vu{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Nu(e,t,r)}_apply(e){const t=this._parse(e);return Mw(e._query,t),new Tn(e.firestore,e.converter,Lf(e._query,t))}_parse(e){const t=mo(e.firestore);return function(i,o,a,l,c,d,f){let v;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new ne(q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){hy(f,d);const y=[];for(const P of f)y.push(dy(l,i,P));v={arrayValue:{values:y}}}else v=dy(l,i,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||hy(f,d),v=Cw(a,o,f,d==="in"||d==="not-in");return ut.create(c,d,v)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Im(n,e,t){const r=e,s=sh("where",n);return Nu._create(s,r,t)}class Ka extends wm{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Ka(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:_t.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)Mw(o,l),o=Lf(o,l)}(e._query,t),new Tn(e.firestore,e.converter,Lf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function w3(...n){return n.forEach(e=>Lw("or",e)),Ka._create("or",n)}function I3(...n){return n.forEach(e=>Lw("and",e)),Ka._create("and",n)}class Em extends Vu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Em(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new ne(q.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new ne(q.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new tu(i,o)}(e._query,this._field,this._direction);return new Tn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new xs(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function bC(n,e="asc"){const t=e,r=sh("orderBy",n);return Em._create(r,t)}class oh extends Vu{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new oh(e,t,r)}_apply(e){return new Tn(e.firestore,e.converter,id(e._query,this._limit,this._limitType))}}function E3(n){return Ew("limit",n),oh._create("limit",n,"F")}function T3(n){return Ew("limitToLast",n),oh._create("limitToLast",n,"L")}class ah extends Vu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ah(e,t,r)}_apply(e){const t=Ow(e,this.type,this._docOrFields,this._inclusive);return new Tn(e.firestore,e.converter,function(s,i){return new xs(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function x3(...n){return ah._create("startAt",n,!0)}function A3(...n){return ah._create("startAfter",n,!1)}class lh extends Vu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new lh(e,t,r)}_apply(e){const t=Ow(e,this.type,this._docOrFields,this._inclusive);return new Tn(e.firestore,e.converter,function(s,i){return new xs(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function S3(...n){return lh._create("endBefore",n,!1)}function P3(...n){return lh._create("endAt",n,!0)}function Ow(n,e,t,r){if(t[0]=Ce(t[0]),t[0]instanceof ou)return function(i,o,a,l,c){if(!l)throw new ne(q.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const d=[];for(const f of aa(i))if(f.field.isKeyField())d.push(ro(o,l.key));else{const v=l.data.field(f.field);if($d(v))throw new ne(q.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(v===null){const y=f.field.canonicalString();throw new ne(q.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(v)}return new gi(d,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=mo(n.firestore);return function(o,a,l,c,d,f){const v=o.explicitOrderBy;if(d.length>v.length)throw new ne(q.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let P=0;P<d.length;P++){const A=d[P];if(v[P].field.isKeyField()){if(typeof A!="string")throw new ne(q.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof A}`);if(!kp(o)&&A.indexOf("/")!==-1)throw new ne(q.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${A}' contains a slash.`);const R=o.path.child(lt.fromString(A));if(!Ie.isDocumentKey(R))throw new ne(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);const j=new Ie(R);y.push(ro(a,j))}else{const R=Cw(l,c,A);y.push(R)}}return new gi(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function dy(n,e,t){if(typeof(t=Ce(t))=="string"){if(t==="")throw new ne(q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!kp(e)&&t.indexOf("/")!==-1)throw new ne(q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(lt.fromString(t));if(!Ie.isDocumentKey(r))throw new ne(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ro(n,new Ie(r))}if(t instanceof nn)return ro(n,t._key);throw new ne(q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zd(t)}.`)}function hy(n,e){if(!Array.isArray(n)||n.length===0)throw new ne(q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Mw(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new ne(q.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ne(q.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Lw(n,e){if(!(e instanceof Nu||e instanceof Ka))throw new ne(q.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class Fw{convertValue(e,t="none"){switch(pi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return $t(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(_s(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw xe()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Ei(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>$t(o.doubleValue));return new eh(i)}convertGeoPoint(e){return new fm($t(e.latitude),$t(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=jd(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Xl(e));default:return null}}convertTimestamp(e){const t=ys(e);return new qt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=lt.fromString(e);Se(Vb(r));const s=new no(r.get(1),r.get(3)),i=new Ie(r.popFirst(5));return s.isEqual(t)||Zt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class wC extends Fw{constructor(e){super(),this.firestore=e}convertBytes(e){return new co(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new nn(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R3(n){return new su("sum",iu("sum",n))}function C3(n){return new su("avg",iu("average",n))}function IC(){return new su("count")}function k3(n,e){var t,r;return n instanceof su&&e instanceof su&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function D3(n,e){return Tw(n.query,e.query)&&hi(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Da extends ou{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Uc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(sh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Uc extends Da{data(e={}){return super.data(e)}}class Va{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Wi(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Uc(this._firestore,this._userDataWriter,r.key,r,new Wi(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ne(q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Uc(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Wi(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Uc(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Wi(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,d=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:EC(a.type),doc:l,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function EC(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return xe()}}function V3(n,e){return n instanceof Da&&e instanceof Da?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Va&&e instanceof Va&&n._firestore===e._firestore&&Tw(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rs(n){n=st(n,nn);const e=st(n.firestore,St);return bw(zt(e),n._key).then(t=>Tm(e,n,t))}class xi extends Fw{constructor(e){super(),this.firestore=e}convertBytes(e){return new co(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new nn(this.firestore,null,t)}}function N3(n){n=st(n,nn);const e=st(n.firestore,St),t=zt(e),r=new xi(e);return eC(t,n._key).then(s=>new Da(e,r,n._key,s,new Wi(s!==null&&s.hasLocalMutations,!0),n.converter))}function O3(n){n=st(n,nn);const e=st(n.firestore,St);return bw(zt(e),n._key,{source:"server"}).then(t=>Tm(e,n,t))}function Ct(n){n=st(n,Tn);const e=st(n.firestore,St),t=zt(e),r=new xi(e);return Nw(n._query),ww(t,n._query).then(s=>new Va(e,r,n,s))}function M3(n){n=st(n,Tn);const e=st(n.firestore,St),t=zt(e),r=new xi(e);return tC(t,n._query).then(s=>new Va(e,r,n,s))}function L3(n){n=st(n,Tn);const e=st(n.firestore,St),t=zt(e),r=new xi(e);return ww(t,n._query,{source:"server"}).then(s=>new Va(e,r,n,s))}function Vn(n,e,t){n=st(n,nn);const r=st(n.firestore,St),s=uh(n.converter,e,t);return Mu(r,[nh(mo(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Bt.none())])}function Ou(n,e,t,...r){n=st(n,nn);const s=st(n.firestore,St),i=mo(s);let o;return o=typeof(e=Ce(e))=="string"||e instanceof fo?_m(i,"updateDoc",n._key,e,t,r):ym(i,"updateDoc",n._key,e),Mu(s,[o.toMutation(n._key,Bt.exists(!0))])}function au(n){return Mu(st(n.firestore,St),[new $a(n._key,Bt.none())])}function ch(n,e){const t=st(n.firestore,St),r=Fe(n),s=uh(n.converter,e);return Mu(t,[nh(mo(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Bt.exists(!1))]).then(()=>r)}function F3(n,...e){var t,r,s;n=Ce(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Qf(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Qf(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,d;if(n instanceof nn)c=st(n.firestore,St),d=Fa(n._key.path),l={next:f=>{e[o]&&e[o](Tm(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=st(n,Tn);c=st(f.firestore,St),d=f._query;const v=new xi(c);l={next:y=>{e[o]&&e[o](new Va(c,v,f,y))},error:e[o+1],complete:e[o+2]},Nw(n._query)}return function(v,y,P,A){const R=new Yd(A),j=new rm(y,R,P);return v.asyncQueue.enqueueAndForget(async()=>em(await ka(v),j)),()=>{R.Za(),v.asyncQueue.enqueueAndForget(async()=>tm(await ka(v),j))}}(zt(c),d,a,l)}function U3(n,e){return rC(zt(n=st(n,St)),Qf(e)?e:{next:e})}function Mu(n,e){return function(r,s){const i=new yn;return r.asyncQueue.enqueueAndForget(async()=>k1(await dm(r),s,i)),i.promise}(zt(n),e)}function Tm(n,e,t){const r=t.docs.get(e._key),s=new xi(n);return new Da(n,s,e._key,r,new Wi(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $3(n){return TC(n,{count:IC()})}function TC(n,e){const t=st(n.firestore,St),r=zt(t),s=$0(e,(i,o)=>new gb(o,i.aggregateType,i._internalFieldPath));return nC(r,n._query,s).then(i=>function(a,l,c){const d=new xi(a);return new pC(l,d,c)}(t,n,i))}class xC{constructor(e){this.kind="memory",this._onlineComponentProvider=_i.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=yi.provider}toJSON(){return{kind:this.kind}}}class AC{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=kC(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class SC{constructor(){this.kind="memoryEager",this._offlineComponentProvider=yi.provider}toJSON(){return{kind:this.kind}}}class PC{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new H1(e)}}toJSON(){return{kind:this.kind}}}function j3(){return new SC}function B3(n){return new PC(n==null?void 0:n.cacheSizeBytes)}function q3(n){return new xC(n)}function z3(n){return new AC(n)}class RC{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=_i.provider,this._offlineComponentProvider={build:t=>new um(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class CC{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=_i.provider,this._offlineComponentProvider={build:t=>new gw(t,e==null?void 0:e.cacheSizeBytes)}}}function kC(n){return new RC(n==null?void 0:n.forceOwnership)}function G3(){return new CC}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DC={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VC{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=mo(e)}set(e,t,r){this._verifyNotCommitted();const s=Zs(e,this._firestore),i=uh(s.converter,t,r),o=nh(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Bt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Zs(e,this._firestore);let o;return o=typeof(t=Ce(t))=="string"||t instanceof fo?_m(this._dataReader,"WriteBatch.update",i._key,t,r,s):ym(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Bt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Zs(e,this._firestore);return this._mutations=this._mutations.concat(new $a(t._key,Bt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new ne(q.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Zs(n,e){if((n=Ce(n)).firestore!==e)throw new ne(q.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NC extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=mo(t)}get(t){const r=Zs(t,this._firestore),s=new wC(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return xe();const o=i[0];if(o.isFoundDocument())return new ou(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new ou(this._firestore,s,r._key,null,r.converter);throw xe()})}set(t,r,s){const i=Zs(t,this._firestore),o=uh(i.converter,r,s),a=nh(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=Zs(t,this._firestore);let a;return a=typeof(r=Ce(r))=="string"||r instanceof fo?_m(this._dataReader,"Transaction.update",o._key,r,s,i):ym(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=Zs(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Zs(e,this._firestore),r=new xi(this._firestore);return super.get(e).then(s=>new Da(this._firestore,r,t._key,s._document,new Wi(!1,!1),t.converter))}}function H3(n,e,t){n=st(n,St);const r=Object.assign(Object.assign({},DC),t);return function(i){if(i.maxAttempts<1)throw new ne(q.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new yn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await _w(i);new J1(i.asyncQueue,c,a,o,l).au()}),l.promise}(zt(n),s=>e(new NC(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W3(){return new Du("deleteField")}function Lu(){return new pm("serverTimestamp")}function Q3(...n){return new mm("arrayUnion",n)}function J3(...n){return new gm("arrayRemove",n)}function Y3(n){return new vm("increment",n)}function X3(n){return new eh(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uw(n){return zt(n=st(n,St)),new VC(n,e=>Mu(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z3(n,e){const t=zt(n=st(n,St));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return fr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(d){throw new ne(q.INVALID_ARGUMENT,"Failed to parse JSON: "+(d==null?void 0:d.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=fy(l,"collectionGroup"),d=[];if(Array.isArray(l.fields))for(const f of l.fields){const v=rh("setIndexConfiguration",fy(f,"fieldPath"));f.arrayConfig==="CONTAINS"?d.push(new Xi(v,2)):f.order==="ASCENDING"?d.push(new Xi(v,0)):f.order==="DESCENDING"&&d.push(new Xi(v,1))}a.push(new _a(_a.UNKNOWN_ID,c,d,ba.empty()))}return a}(e);return oC(t,r)}function fy(n,e){if(typeof n[e]!="string")throw new ne(q.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OC{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function eU(n){var e;n=st(n,St);const t=py.get(n);if(t)return t;if(((e=zt(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new OC(n);return py.set(n,r),r}function tU(n){$w(n,!0)}function nU(n){$w(n,!1)}function rU(n){lC(zt(n._firestore)).then(e=>te("deleting all persistent cache indexes succeeded")).catch(e=>fr("deleting all persistent cache indexes failed",e))}function $w(n,e){aC(zt(n._firestore),e).then(t=>te(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>fr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const py=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sU(n){var e;const t=(e=zt(st(n.firestore,St))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Gd(t,Mn(n._query))._t}function iU(n,e){var t;const r=$0(e,(i,o)=>new gb(o,i.aggregateType,i._internalFieldPath)),s=(t=zt(st(n.firestore,St))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:Rb(s,eb(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oU{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return xm.instance.onExistenceFilterMismatch(e)}}class xm{constructor(){this.Uu=new Map}static get instance(){return Ic||(Ic=new xm,function(t){if(od)throw new Error("a TestingHooksSpi instance is already set");od=t}(Ic)),Ic}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let Ic=null;(function(e,t=!0){(function(s){La=s})(Ma),va(new to("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new St(new sP(r.getProvider("auth-internal")),new aP(r.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new ne(q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new no(c.options.projectId,d)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),li(rv,"4.7.3",e),li(rv,"4.7.3","esm2017")})();function Am(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aU={PHONE:"phone",TOTP:"totp"},lU={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},uU={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},cU={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},dU={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MC(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function jw(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const hU=MC,LC=jw,Bw=new bu("auth","Firebase",jw()),fU={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gd=new Tp("@firebase/auth");function FC(n,...e){gd.logLevel<=at.WARN&&gd.warn(`Auth (${Ma}): ${n}`,...e)}function $c(n,...e){gd.logLevel<=at.ERROR&&gd.error(`Auth (${Ma}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yn(n,...e){throw Pm(n,...e)}function jn(n,...e){return Pm(n,...e)}function Sm(n,e,t){const r=Object.assign(Object.assign({},LC()),{[e]:t});return new bu("auth","Firebase",r).create(e,{appName:n.name})}function _n(n){return Sm(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ha(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Yn(n,"argument-error"),Sm(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Pm(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Bw.create(n,...e)}function de(n,e,...t){if(!n)throw Pm(e,...t)}function Fr(n){const e="INTERNAL ASSERTION FAILED: "+n;throw $c(e),new Error(e)}function bs(n,e){n||Fr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lu(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Rm(){return my()==="http:"||my()==="https:"}function my(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UC(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Rm()||OA()||"connection"in navigator)?navigator.onLine:!0}function $C(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fu{constructor(e,t){this.shortDelay=e,this.longDelay=t,bs(t>e,"Short delay should be less than long delay!"),this.isMobile=DA()||MA()}get(){return UC()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cm(n,e){bs(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qw{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Fr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Fr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Fr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jC={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BC=new Fu(3e4,6e4);function Mt(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Lt(n,e,t,r,s={}){return zw(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Oa(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return NA()||(c.referrerPolicy="no-referrer"),qw.fetch()(Gw(n,n.config.apiHost,t,a),c)})}async function zw(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},jC),e);try{const s=new zC(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw xl(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw xl(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw xl(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw xl(n,"user-disabled",o);const d=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw Sm(n,d,c);Yn(n,d)}}catch(s){if(s instanceof Ts)throw s;Yn(n,"network-request-failed",{message:String(s)})}}async function Cs(n,e,t,r,s={}){const i=await Lt(n,e,t,r,s);return"mfaPendingCredential"in i&&Yn(n,"multi-factor-auth-required",{_serverResponse:i}),i}function Gw(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Cm(n.config,s):`${n.config.apiScheme}://${s}`}function qC(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class zC{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(jn(this.auth,"network-request-failed")),BC.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function xl(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=jn(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gy(n){return n!==void 0&&n.getResponse!==void 0}function vy(n){return n!==void 0&&n.enterprise!==void 0}class Kw{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return qC(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GC(n){return(await Lt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function Hw(n,e){return Lt(n,"GET","/v2/recaptchaConfig",Mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KC(n,e){return Lt(n,"POST","/v1/accounts:delete",e)}async function HC(n,e){return Lt(n,"POST","/v1/accounts:update",e)}async function Ww(n,e){return Lt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jl(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pU(n,e=!1){return Ce(n).getIdToken(e)}async function WC(n,e=!1){const t=Ce(n),r=await t.getIdToken(e),s=dh(r);de(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:jl(tf(s.auth_time)),issuedAtTime:jl(tf(s.iat)),expirationTime:jl(tf(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function tf(n){return Number(n)*1e3}function dh(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return $c("JWT malformed, contained fewer than 3 sections"),null;try{const s=l0(t);return s?JSON.parse(s):($c("Failed to decode base64 JWT payload"),null)}catch(s){return $c("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function yy(n){const e=dh(n);return de(e,"internal-error"),de(typeof e.exp<"u","internal-error"),de(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ws(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Ts&&QC(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function QC({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jf{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=jl(this.lastLoginAt),this.creationTime=jl(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uu(n){var e;const t=n.auth,r=await n.getIdToken(),s=await ws(n,Ww(t,{idToken:r}));de(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?Qw(i.providerUserInfo):[],a=XC(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Jf(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function YC(n){const e=Ce(n);await uu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function XC(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Qw(n){return n.map(e=>{var{providerId:t}=e,r=Am(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZC(n,e){const t=await zw(n,{},async()=>{const r=Oa({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=Gw(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",qw.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function ek(n,e){return Lt(n,"POST","/v2/accounts:revokeToken",Mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){de(e.idToken,"internal-error"),de(typeof e.idToken<"u","internal-error"),de(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):yy(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){de(e.length!==0,"internal-error");const t=yy(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(de(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await ZC(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new ua;return r&&(de(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(de(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(de(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ua,this.toJSON())}_performRefresh(){return Fr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ks(n,e){de(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class cs{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=Am(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new JC(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Jf(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await ws(this,this.stsTokenManager.getToken(this.auth,e));return de(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return WC(this,e)}reload(){return YC(this)}_assign(e){this!==e&&(de(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new cs(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){de(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await uu(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(en(this.auth.app))return Promise.reject(_n(this.auth));const e=await this.getIdToken();return await ws(this,KC(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,d;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,v=(s=t.email)!==null&&s!==void 0?s:void 0,y=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,P=(o=t.photoURL)!==null&&o!==void 0?o:void 0,A=(a=t.tenantId)!==null&&a!==void 0?a:void 0,R=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,j=(c=t.createdAt)!==null&&c!==void 0?c:void 0,B=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:F,emailVerified:G,isAnonymous:oe,providerData:ie,stsTokenManager:I}=t;de(F&&I,e,"internal-error");const E=ua.fromJSON(this.name,I);de(typeof F=="string",e,"internal-error"),Ks(f,e.name),Ks(v,e.name),de(typeof G=="boolean",e,"internal-error"),de(typeof oe=="boolean",e,"internal-error"),Ks(y,e.name),Ks(P,e.name),Ks(A,e.name),Ks(R,e.name),Ks(j,e.name),Ks(B,e.name);const x=new cs({uid:F,auth:e,email:v,emailVerified:G,displayName:f,isAnonymous:oe,photoURL:P,phoneNumber:y,tenantId:A,stsTokenManager:E,createdAt:j,lastLoginAt:B});return ie&&Array.isArray(ie)&&(x.providerData=ie.map(k=>Object.assign({},k))),R&&(x._redirectEventId=R),x}static async _fromIdTokenResponse(e,t,r=!1){const s=new ua;s.updateFromServerResponse(t);const i=new cs({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await uu(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];de(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?Qw(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new ua;a.updateFromIdToken(r);const l=new cs({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Jf(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _y=new Map;function ds(n){bs(n instanceof Function,"Expected a class definition");let e=_y.get(n);return e?(bs(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,_y.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jw{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Jw.type="NONE";const by=Jw;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jc(n,e,t){return`firebase:${n}:${e}:${t}`}class ca{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=jc(this.userKey,s.apiKey,i),this.fullPersistenceKey=jc("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?cs._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new ca(ds(by),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||ds(by);const o=jc(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const d=await c._get(o);if(d){const f=cs._fromJSON(e,d);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new ca(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new ca(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wy(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(eI(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Yw(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(nI(e))return"Blackberry";if(rI(e))return"Webos";if(Xw(e))return"Safari";if((e.includes("chrome/")||Zw(e))&&!e.includes("edge/"))return"Chrome";if(tI(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function Yw(n=dn()){return/firefox\//i.test(n)}function Xw(n=dn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Zw(n=dn()){return/crios\//i.test(n)}function eI(n=dn()){return/iemobile/i.test(n)}function tI(n=dn()){return/android/i.test(n)}function nI(n=dn()){return/blackberry/i.test(n)}function rI(n=dn()){return/webos/i.test(n)}function km(n=dn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function tk(n=dn()){var e;return km(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function nk(){return LA()&&document.documentMode===10}function sI(n=dn()){return km(n)||tI(n)||rI(n)||nI(n)||/windows phone/i.test(n)||eI(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iI(n,e=[]){let t;switch(n){case"Browser":t=wy(dn());break;case"Worker":t=`${wy(dn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Ma}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rk{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sk(n,e={}){return Lt(n,"GET","/v2/passwordPolicy",Mt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ik=6;class ok{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:ik,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ak{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Iy(this),this.idTokenSubscription=new Iy(this),this.beforeStateQueue=new rk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Bw,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ds(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await ca.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Ww(this,{idToken:e}),r=await cs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(en(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return de(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await uu(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=$C()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(en(this.app))return Promise.reject(_n(this));const t=e?Ce(e):null;return t&&de(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&de(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return en(this.app)?Promise.reject(_n(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return en(this.app)?Promise.reject(_n(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ds(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await sk(this),t=new ok(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new bu("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await ek(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ds(e)||this._popupRedirectResolver;de(t,this,"argument-error"),this.redirectPersistenceManager=await ca.create(this,[ds(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(de(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return de(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=iI(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&FC(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Qt(n){return Ce(n)}class Iy{constructor(e){this.auth=e,this.observer=null,this.addObserver=qA(t=>this.observer=t)}get next(){return de(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Uu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function lk(n){Uu=n}function Dm(n){return Uu.loadJS(n)}function uk(){return Uu.recaptchaV2Script}function ck(){return Uu.recaptchaEnterpriseScript}function dk(){return Uu.gapiScript}function oI(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const hk="recaptcha-enterprise",fk="NO_RECAPTCHA";class aI{constructor(e){this.type=hk,this.auth=Qt(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{Hw(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new Kw(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;vy(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(fk)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&vy(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=ck();l.length!==0&&(l+=a),Dm(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function Ey(n,e,t,r=!1){const s=new aI(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function cu(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Ey(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Ey(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function pk(n){const e=Qt(n),t=await Hw(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new Kw(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new aI(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mk(n,e){const t=wu(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(hi(i,e??{}))return s;Yn(s,"already-initialized")}return t.initialize({options:e})}function gk(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(ds);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function vk(n,e,t){const r=Qt(n);de(r._canInitEmulator,r,"emulator-config-failed"),de(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=lI(e),{host:o,port:a}=yk(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||_k()}function lI(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function yk(n){const e=lI(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Ty(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:Ty(o)}}}function Ty(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function _k(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $u{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Fr("not implemented")}_getIdTokenResponse(e){return Fr("not implemented")}_linkToIdToken(e,t){return Fr("not implemented")}_getReauthenticationResolver(e){return Fr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uI(n,e){return Lt(n,"POST","/v1/accounts:resetPassword",Mt(n,e))}async function bk(n,e){return Lt(n,"POST","/v1/accounts:update",e)}async function wk(n,e){return Lt(n,"POST","/v1/accounts:signUp",e)}async function Ik(n,e){return Lt(n,"POST","/v1/accounts:update",Mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ek(n,e){return Cs(n,"POST","/v1/accounts:signInWithPassword",Mt(n,e))}async function hh(n,e){return Lt(n,"POST","/v1/accounts:sendOobCode",Mt(n,e))}async function Tk(n,e){return hh(n,e)}async function xk(n,e){return hh(n,e)}async function Ak(n,e){return hh(n,e)}async function Sk(n,e){return hh(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pk(n,e){return Cs(n,"POST","/v1/accounts:signInWithEmailLink",Mt(n,e))}async function Rk(n,e){return Cs(n,"POST","/v1/accounts:signInWithEmailLink",Mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class du extends $u{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new du(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new du(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return cu(e,t,"signInWithPassword",Ek);case"emailLink":return Pk(e,{email:this._email,oobCode:this._password});default:Yn(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return cu(e,r,"signUpPassword",wk);case"emailLink":return Rk(e,{idToken:t,email:this._email,oobCode:this._password});default:Yn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ps(n,e){return Cs(n,"POST","/v1/accounts:signInWithIdp",Mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ck="http://localhost";class Is extends $u{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Is(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Yn("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=Am(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new Is(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return ps(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ps(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ps(e,t)}buildRequest(){const e={requestUri:Ck,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Oa(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kk(n,e){return Lt(n,"POST","/v1/accounts:sendVerificationCode",Mt(n,e))}async function Dk(n,e){return Cs(n,"POST","/v1/accounts:signInWithPhoneNumber",Mt(n,e))}async function Vk(n,e){const t=await Cs(n,"POST","/v1/accounts:signInWithPhoneNumber",Mt(n,e));if(t.temporaryProof)throw xl(n,"account-exists-with-different-credential",t);return t}const Nk={USER_NOT_FOUND:"user-not-found"};async function Ok(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Cs(n,"POST","/v1/accounts:signInWithPhoneNumber",Mt(n,t),Nk)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zi extends $u{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Zi({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Zi({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return Dk(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return Vk(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return Ok(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Zi({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mk(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Lk(n){const e=_l(bl(n)).link,t=e?_l(bl(e)).deep_link_id:null,r=_l(bl(n)).deep_link_id;return(r?_l(bl(r)).link:null)||r||t||e||n}class ju{constructor(e){var t,r,s,i,o,a;const l=_l(bl(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,d=(r=l.oobCode)!==null&&r!==void 0?r:null,f=Mk((s=l.mode)!==null&&s!==void 0?s:null);de(c&&d&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=d,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=Lk(e);try{return new ju(t)}catch{return null}}}function mU(n){return ju.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo{constructor(){this.providerId=vo.PROVIDER_ID}static credential(e,t){return du._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=ju.parseLink(t);return de(r,"argument-error"),du._fromEmailAndCode(e,r.code,r.tenantId)}}vo.PROVIDER_ID="password";vo.EMAIL_PASSWORD_SIGN_IN_METHOD="password";vo.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ks{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wa extends ks{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Bc extends Wa{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return de("providerId"in t&&"signInMethod"in t,"argument-error"),Is._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return de(e.idToken||e.accessToken,"argument-error"),Is._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Bc.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Bc.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new Bc(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei extends Wa{constructor(){super("facebook.com")}static credential(e){return Is._fromParams({providerId:ei.PROVIDER_ID,signInMethod:ei.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ei.credentialFromTaggedObject(e)}static credentialFromError(e){return ei.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ei.credential(e.oauthAccessToken)}catch{return null}}}ei.FACEBOOK_SIGN_IN_METHOD="facebook.com";ei.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ti extends Wa{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Is._fromParams({providerId:ti.PROVIDER_ID,signInMethod:ti.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ti.credentialFromTaggedObject(e)}static credentialFromError(e){return ti.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return ti.credential(t,r)}catch{return null}}}ti.GOOGLE_SIGN_IN_METHOD="google.com";ti.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni extends Wa{constructor(){super("github.com")}static credential(e){return Is._fromParams({providerId:ni.PROVIDER_ID,signInMethod:ni.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ni.credentialFromTaggedObject(e)}static credentialFromError(e){return ni.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ni.credential(e.oauthAccessToken)}catch{return null}}}ni.GITHUB_SIGN_IN_METHOD="github.com";ni.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fk="http://localhost";class hu extends $u{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return ps(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ps(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ps(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new hu(r,i)}static _create(e,t){return new hu(e,t)}buildRequest(){return{requestUri:Fk,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uk="saml.";class Yf extends ks{constructor(e){de(e.startsWith(Uk),"argument-error"),super(e)}static credentialFromResult(e){return Yf.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Yf.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=hu.fromJSON(e);return de(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return hu._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ri extends Wa{constructor(){super("twitter.com")}static credential(e,t){return Is._fromParams({providerId:ri.PROVIDER_ID,signInMethod:ri.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ri.credentialFromTaggedObject(e)}static credentialFromError(e){return ri.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return ri.credential(t,r)}catch{return null}}}ri.TWITTER_SIGN_IN_METHOD="twitter.com";ri.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cI(n,e){return Cs(n,"POST","/v1/accounts:signUp",Mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await cs._fromIdTokenResponse(e,r,s),o=xy(r);return new pr({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=xy(r);return new pr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function xy(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $k(n){var e;if(en(n.app))return Promise.reject(_n(n));const t=Qt(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new pr({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await cI(t,{returnSecureToken:!0}),s=await pr._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vd extends Ts{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,vd.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new vd(e,t,r,s)}}function dI(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?vd._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hI(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gU(n,e){const t=Ce(n);await fh(!0,t,e);const{providerUserInfo:r}=await HC(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=hI(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Vm(n,e,t=!1){const r=await ws(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return pr._forOperation(n,"link",r)}async function fh(n,e,t){await uu(e);const r=hI(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";de(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fI(n,e,t=!1){const{auth:r}=n;if(en(r.app))return Promise.reject(_n(r));const s="reauthenticate";try{const i=await ws(n,dI(r,s,e,n),t);de(i.idToken,r,"internal-error");const o=dh(i.idToken);de(o,r,"internal-error");const{sub:a}=o;return de(n.uid===a,r,"user-mismatch"),pr._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Yn(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pI(n,e,t=!1){if(en(n.app))return Promise.reject(_n(n));const r="signIn",s=await dI(n,r,e),i=await pr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Nm(n,e){return pI(Qt(n),e)}async function jk(n,e){const t=Ce(n);return await fh(!1,t,e.providerId),Vm(t,e)}async function Bk(n,e){return fI(Ce(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qk(n,e){return Cs(n,"POST","/v1/accounts:signInWithCustomToken",Mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vU(n,e){if(en(n.app))return Promise.reject(_n(n));const t=Qt(n),r=await qk(t,{token:e,returnSecureToken:!0}),s=await pr._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bu{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Om._fromServerResponse(e,t):"totpInfo"in t?Mm._fromServerResponse(e,t):Yn(e,"internal-error")}}class Om extends Bu{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Om(t)}}class Mm extends Bu{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Mm(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ph(n,e,t){var r;de(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),de(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(de(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(de(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lm(n){const e=Qt(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function zk(n,e,t){const r=Qt(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&ph(r,s,t),await cu(r,s,"getOobCode",xk)}async function Gk(n,e,t){await uI(Ce(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Lm(n),r})}async function yU(n,e){await Ik(Ce(n),{oobCode:e})}async function Kk(n,e){const t=Ce(n),r=await uI(t,{oobCode:e}),s=r.requestType;switch(de(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":de(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":de(r.mfaInfo,t,"internal-error");default:de(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Bu._fromServerResponse(Qt(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function _U(n,e){const{data:t}=await Kk(Ce(n),e);return t.email}async function Hk(n,e,t){if(en(n.app))return Promise.reject(_n(n));const r=Qt(n),o=await cu(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",cI).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Lm(n),l}),a=await pr._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function Wk(n,e,t){return en(n.app)?Promise.reject(_n(n)):Nm(Ce(n),vo.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Lm(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bU(n,e,t){const r=Qt(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){de(a.handleCodeInApp,r,"argument-error"),a&&ph(r,o,a)}i(s,t),await cu(r,s,"getOobCode",Ak)}function wU(n,e){const t=ju.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function IU(n,e,t){if(en(n.app))return Promise.reject(_n(n));const r=Ce(n),s=vo.credentialWithLink(e,t||lu());return de(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Nm(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qk(n,e){return Lt(n,"POST","/v1/accounts:createAuthUri",Mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EU(n,e){const t=Rm()?lu():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await Qk(Ce(n),r);return s||[]}async function TU(n,e){const t=Ce(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&ph(t.auth,s,e);const{email:i}=await Tk(t.auth,s);i!==n.email&&await n.reload()}async function xU(n,e,t){const r=Ce(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&ph(r.auth,i,t);const{email:o}=await Sk(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jk(n,e){return Lt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AU(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Ce(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await ws(r,Jk(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function SU(n,e){const t=Ce(n);return en(t.auth.app)?Promise.reject(_n(t.auth)):mI(t,e,null)}function Yk(n,e){return mI(Ce(n),null,e)}async function mI(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await ws(n,bk(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xk(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=dh(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new da(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new Zk(i,s);case"github.com":return new eD(i,s);case"google.com":return new tD(i,s);case"twitter.com":return new nD(i,s,n.screenName||null);case"custom":case"anonymous":return new da(i,null);default:return new da(i,r,s)}}class da{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class gI extends da{constructor(e,t,r,s){super(e,t,r),this.username=s}}class Zk extends da{constructor(e,t){super(e,"facebook.com",t)}}class eD extends gI{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class tD extends da{constructor(e,t){super(e,"google.com",t)}}class nD extends gI{constructor(e,t,r){super(e,"twitter.com",t,r)}}function PU(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:Xk(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RU(n,e){return Ce(n).setPersistence(e)}function CU(n){return pk(n)}async function kU(n,e){return Qt(n).validatePassword(e)}function rD(n,e,t,r){return Ce(n).onIdTokenChanged(e,t,r)}function sD(n,e,t){return Ce(n).beforeAuthStateChanged(e,t)}function DU(n,e,t,r){return Ce(n).onAuthStateChanged(e,t,r)}function VU(n){Ce(n).useDeviceLanguage()}function NU(n,e){return Ce(n).updateCurrentUser(e)}function OU(n){return Ce(n).signOut()}function MU(n,e){return Qt(n).revokeAccessToken(e)}async function LU(n){return Ce(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qi{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new Qi("enroll",e,t)}static _fromMfaPendingCredential(e){return new Qi("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return Qi._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return Qi._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fm{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=Qt(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Bu._fromServerResponse(r,a));de(s.mfaPendingCredential,r,"internal-error");const o=Qi._fromMfaPendingCredential(s.mfaPendingCredential);return new Fm(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const d=await pr._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(d.user),d;case"reauthenticate":return de(t.user,r,"internal-error"),pr._forOperation(t.user,t.operationType,c);default:Yn(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function FU(n,e){var t;const r=Ce(n),s=e;return de(e.customData.operationType,r,"argument-error"),de((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Fm._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iD(n,e){return Lt(n,"POST","/v2/accounts/mfaEnrollment:start",Mt(n,e))}function oD(n,e){return Lt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Mt(n,e))}function aD(n,e){return Lt(n,"POST","/v2/accounts/mfaEnrollment:start",Mt(n,e))}function lD(n,e){return Lt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Mt(n,e))}function uD(n,e){return Lt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Mt(n,e))}class Um{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Bu._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Um(e)}async getSession(){return Qi._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await ws(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await ws(this.user,uD(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const nf=new WeakMap;function UU(n){const e=Ce(n);return nf.has(e)||nf.set(e,Um._fromUser(e)),nf.get(e)}const yd="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(yd,"1"),this.storage.removeItem(yd),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cD=1e3,dD=10;class yI extends vI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=sI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);nk()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,dD):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},cD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}yI.type="LOCAL";const hD=yI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _I extends vI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}_I.type="SESSION";const bI=_I;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fD(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new mh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await fD(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}mh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gh(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pD{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=gh("",20);s.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const v=f;if(v.data.eventId===c)switch(v.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(v.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sn(){return window}function mD(n){sn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $m(){return typeof sn().WorkerGlobalScope<"u"&&typeof sn().importScripts=="function"}async function gD(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function vD(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function yD(){return $m()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wI="firebaseLocalStorageDb",_D=1,_d="firebaseLocalStorage",II="fbase_key";class qu{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function vh(n,e){return n.transaction([_d],e?"readwrite":"readonly").objectStore(_d)}function bD(){const n=indexedDB.deleteDatabase(wI);return new qu(n).toPromise()}function Xf(){const n=indexedDB.open(wI,_D);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(_d,{keyPath:II})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(_d)?e(r):(r.close(),await bD(),e(await Xf()))})})}async function Ay(n,e,t){const r=vh(n,!0).put({[II]:e,value:t});return new qu(r).toPromise()}async function wD(n,e){const t=vh(n,!1).get(e),r=await new qu(t).toPromise();return r===void 0?null:r.value}function Sy(n,e){const t=vh(n,!0).delete(e);return new qu(t).toPromise()}const ID=800,ED=3;class EI{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Xf(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>ED)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return $m()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=mh._getInstance(yD()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await gD(),!this.activeServiceWorker)return;this.sender=new pD(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||vD()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Xf();return await Ay(e,yd,"1"),await Sy(e,yd),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Ay(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>wD(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Sy(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=vh(s,!1).getAll();return new qu(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),ID)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}EI.type="LOCAL";const TD=EI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xD(n,e){return Lt(n,"POST","/v2/accounts/mfaSignIn:start",Mt(n,e))}function AD(n,e){return Lt(n,"POST","/v2/accounts/mfaSignIn:finalize",Mt(n,e))}function SD(n,e){return Lt(n,"POST","/v2/accounts/mfaSignIn:finalize",Mt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PD=500,RD=6e4,Ec=1e12;class CD{constructor(e){this.auth=e,this.counter=Ec,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new kD(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Ec;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Ec;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Ec;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class kD{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;de(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=DD(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},RD)},PD))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function DD(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rf=oI("rcb"),VD=new Fu(3e4,6e4);class ND{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=sn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return de(OD(t),e,"argument-error"),this.shouldResolveImmediately(t)&&gy(sn().grecaptcha)?Promise.resolve(sn().grecaptcha):new Promise((r,s)=>{const i=sn().setTimeout(()=>{s(jn(e,"network-request-failed"))},VD.get());sn()[rf]=()=>{sn().clearTimeout(i),delete sn()[rf];const a=sn().grecaptcha;if(!a||!gy(a)){s(jn(e,"internal-error"));return}const l=a.render;a.render=(c,d)=>{const f=l(c,d);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${uk()}?${Oa({onload:rf,render:"explicit",hl:t})}`;Dm(o).catch(()=>{clearTimeout(i),s(jn(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=sn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function OD(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class MD{async load(e){return new CD(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TI="recaptcha",LD={theme:"light",type:"image"};class $U{constructor(e,t,r=Object.assign({},LD)){this.parameters=r,this.type=TI,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Qt(e),this.isInvisible=this.parameters.size==="invisible",de(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;de(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new MD:new ND,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){de(!this.parameters.sitekey,this.auth,"argument-error"),de(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),de(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=sn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){de(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){de(Rm()&&!$m(),this.auth,"internal-error"),await FD(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await GC(this.auth);de(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return de(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function FD(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jm{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Zi._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function jU(n,e,t){if(en(n.app))return Promise.reject(_n(n));const r=Qt(n),s=await yh(r,e,Ce(t));return new jm(s,i=>Nm(r,i))}async function BU(n,e,t){const r=Ce(n);await fh(!1,r,"phone");const s=await yh(r.auth,e,Ce(t));return new jm(s,i=>jk(r,i))}async function qU(n,e,t){const r=Ce(n);if(en(r.auth.app))return Promise.reject(_n(r.auth));const s=await yh(r.auth,e,Ce(t));return new jm(s,i=>Bk(r,i))}async function yh(n,e,t){var r;const s=await t.verify();try{de(typeof s=="string",n,"argument-error"),de(t.type===TI,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return de(o.type==="enroll",n,"internal-error"),(await iD(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{de(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return de(a,n,"missing-multi-factor-info"),(await xD(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await kk(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function zU(n,e){const t=Ce(n);if(en(t.auth.app))return Promise.reject(_n(t.auth));await Vm(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(e){this.providerId=ha.PROVIDER_ID,this.auth=Qt(e)}verifyPhoneNumber(e,t){return yh(this.auth,e,Ce(t))}static credential(e,t){return Zi._fromVerification(e,t)}static credentialFromResult(e){const t=e;return ha.credentialFromTaggedObject(t)}static credentialFromError(e){return ha.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Zi._fromTokenResponse(t,r):null}}ha.PROVIDER_ID="phone";ha.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yo(n,e){return e?ds(e):(de(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bm extends $u{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ps(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ps(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ps(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function UD(n){return pI(n.auth,new Bm(n),n.bypassAuthState)}function $D(n){const{auth:e,user:t}=n;return de(t,e,"internal-error"),fI(t,new Bm(n),n.bypassAuthState)}async function jD(n){const{auth:e,user:t}=n;return de(t,e,"internal-error"),Vm(t,new Bm(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xI{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return UD;case"linkViaPopup":case"linkViaRedirect":return jD;case"reauthViaPopup":case"reauthViaRedirect":return $D;default:Yn(this.auth,"internal-error")}}resolve(e){bs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){bs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BD=new Fu(2e3,1e4);async function GU(n,e,t){if(en(n.app))return Promise.reject(jn(n,"operation-not-supported-in-this-environment"));const r=Qt(n);Ha(n,e,ks);const s=yo(r,t);return new hs(r,"signInViaPopup",e,s).executeNotNull()}async function KU(n,e,t){const r=Ce(n);if(en(r.auth.app))return Promise.reject(jn(r.auth,"operation-not-supported-in-this-environment"));Ha(r.auth,e,ks);const s=yo(r.auth,t);return new hs(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function HU(n,e,t){const r=Ce(n);Ha(r.auth,e,ks);const s=yo(r.auth,t);return new hs(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class hs extends xI{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,hs.currentPopupAction&&hs.currentPopupAction.cancel(),hs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return de(e,this.auth,"internal-error"),e}async onExecution(){bs(this.filter.length===1,"Popup operations only handle one event");const e=gh();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(jn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(jn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,hs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(jn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,BD.get())};e()}}hs.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qD="pendingRedirect",qc=new Map;class zD extends xI{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=qc.get(this.auth._key());if(!e){try{const r=await GD(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}qc.set(this.auth._key(),e)}return this.bypassAuthState||qc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function GD(n,e){const t=SI(e),r=AI(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function qm(n,e){return AI(n)._set(SI(e),"true")}function KD(n,e){qc.set(n._key(),e)}function AI(n){return ds(n._redirectPersistence)}function SI(n){return jc(qD,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WU(n,e,t){return HD(n,e,t)}async function HD(n,e,t){if(en(n.app))return Promise.reject(_n(n));const r=Qt(n);Ha(n,e,ks),await r._initializationPromise;const s=yo(r,t);return await qm(s,r),s._openRedirect(r,e,"signInViaRedirect")}function QU(n,e,t){return WD(n,e,t)}async function WD(n,e,t){const r=Ce(n);if(Ha(r.auth,e,ks),en(r.auth.app))return Promise.reject(_n(r.auth));await r.auth._initializationPromise;const s=yo(r.auth,t);await qm(s,r.auth);const i=await RI(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function JU(n,e,t){return QD(n,e,t)}async function QD(n,e,t){const r=Ce(n);Ha(r.auth,e,ks),await r.auth._initializationPromise;const s=yo(r.auth,t);await fh(!1,r,e.providerId),await qm(s,r.auth);const i=await RI(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function YU(n,e){return await Qt(n)._initializationPromise,PI(n,e,!1)}async function PI(n,e,t=!1){if(en(n.app))return Promise.reject(_n(n));const r=Qt(n),s=yo(r,e),o=await new zD(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function RI(n){const e=gh(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JD=10*60*1e3;class YD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!XD(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!CI(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(jn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=JD&&this.cachedEventUids.clear(),this.cachedEventUids.has(Py(e))}saveEventToCache(e){this.cachedEventUids.add(Py(e)),this.lastProcessedEventTime=Date.now()}}function Py(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function CI({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function XD(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return CI(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZD(n,e={}){return Lt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eV=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,tV=/^https?/;async function nV(n){if(n.config.emulator)return;const{authorizedDomains:e}=await ZD(n);for(const t of e)try{if(rV(t))return}catch{}Yn(n,"unauthorized-domain")}function rV(n){const e=lu(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!tV.test(t))return!1;if(eV.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sV=new Fu(3e4,6e4);function Ry(){const n=sn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function iV(n){return new Promise((e,t)=>{var r,s,i;function o(){Ry(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ry(),t(jn(n,"network-request-failed"))},timeout:sV.get()})}if(!((s=(r=sn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=sn().gapi)===null||i===void 0)&&i.load)o();else{const a=oI("iframefcb");return sn()[a]=()=>{gapi.load?o():t(jn(n,"network-request-failed"))},Dm(`${dk()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw zc=null,e})}let zc=null;function oV(n){return zc=zc||iV(n),zc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aV=new Fu(5e3,15e3),lV="__/auth/iframe",uV="emulator/auth/iframe",cV={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},dV=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function hV(n){const e=n.config;de(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Cm(e,uV):`https://${n.config.authDomain}/${lV}`,r={apiKey:e.apiKey,appName:n.name,v:Ma},s=dV.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Oa(r).slice(1)}`}async function fV(n){const e=await oV(n),t=sn().gapi;return de(t,n,"internal-error"),e.open({where:document.body,url:hV(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:cV,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=jn(n,"network-request-failed"),a=sn().setTimeout(()=>{i(o)},aV.get());function l(){sn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pV={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},mV=500,gV=600,vV="_blank",yV="http://localhost";class Cy{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function _V(n,e,t,r=mV,s=gV){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},pV),{width:r.toString(),height:s.toString(),top:i,left:o}),c=dn().toLowerCase();t&&(a=Zw(c)?vV:t),Yw(c)&&(e=e||yV,l.scrollbars="yes");const d=Object.entries(l).reduce((v,[y,P])=>`${v}${y}=${P},`,"");if(tk(c)&&a!=="_self")return bV(e||"",a),new Cy(null);const f=window.open(e||"",a,d);de(f,n,"popup-blocked");try{f.focus()}catch{}return new Cy(f)}function bV(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wV="__/auth/handler",IV="emulator/auth/handler",EV=encodeURIComponent("fac");async function ky(n,e,t,r,s,i){de(n.config.authDomain,n,"auth-domain-config-required"),de(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Ma,eventId:s};if(e instanceof ks){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",BA(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,f]of Object.entries(i||{}))o[d]=f}if(e instanceof Wa){const d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const l=await n._getAppCheckToken(),c=l?`#${EV}=${encodeURIComponent(l)}`:"";return`${TV(n)}?${Oa(a).slice(1)}${c}`}function TV({config:n}){return n.emulator?Cm(n,IV):`https://${n.authDomain}/${wV}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sf="webStorageSupport";class xV{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=bI,this._completeRedirectFn=PI,this._overrideRedirectResult=KD}async _openPopup(e,t,r,s){var i;bs((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await ky(e,t,r,lu(),s);return _V(e,o,gh())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await ky(e,t,r,lu(),s);return mD(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(bs(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await fV(e),r=new YD(e);return t.register("authEvent",s=>(de(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(sf,{type:sf},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[sf];o!==void 0&&t(!!o),Yn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=nV(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return sI()||Xw()||km()}}const AV=xV;class kI{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Fr("unexpected MultiFactorSessionType")}}}class zm extends kI{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new zm(e)}_finalizeEnroll(e,t,r){return oD(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return AD(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class SV{constructor(){}static assertion(e){return zm._fromCredential(e)}}SV.FACTOR_ID="phone";class PV{static assertionForEnrollment(e,t){return fu._fromSecret(e,t)}static assertionForSignIn(e,t){return fu._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;de(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await aD(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return Gm._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}PV.FACTOR_ID="totp";class fu extends kI{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new fu(t,void 0,e)}static _fromEnrollmentId(e,t){return new fu(t,e)}async _finalizeEnroll(e,t,r){return de(typeof this.secret<"u",e,"argument-error"),lD(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){de(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return SD(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class Gm{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new Gm(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(Tc(e)||Tc(t))&&(s=!0),s&&(Tc(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),Tc(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Tc(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var Dy="@firebase/auth",Vy="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RV{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){de(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CV(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function kV(n){va(new to("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;de(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:iI(n)},c=new ak(r,s,i,l);return gk(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),va(new to("auth-internal",e=>{const t=Qt(e.getProvider("auth").getImmediate());return(r=>new RV(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),li(Dy,Vy,CV(n)),li(Dy,Vy,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DV=5*60,VV=d0("authIdTokenMaxAge")||DV;let Ny=null;const NV=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>VV)return;const s=t==null?void 0:t.token;Ny!==s&&(Ny=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function OV(n=v0()){const e=wu(n,"auth");if(e.isInitialized())return e.getImmediate();const t=mk(n,{popupRedirectResolver:AV,persistence:[TD,hD,bI]}),r=d0("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=NV(i.toString());sD(t,o,()=>o(t.currentUser)),rD(t,a=>o(a))}}const s=u0("auth");return s&&vk(t,`http://${s}`),t}function MV(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}lk({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=jn("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",MV().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});kV("Browser");const LV={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},DI=g0(LV),we=hC(DI),_o=OV(DI);try{fC(we)}catch{}$k(_o);async function FV(n,e){try{return(await Hk(_o,n,e)).user}catch(t){throw t}}async function UV(n,e){try{return(await Wk(_o,n,e)).user}catch(t){throw t}}async function $V(n){try{await zk(_o,n)}catch(e){throw e}}async function jV(n){try{const e=_o.currentUser;if(e)await Yk(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const ui=Object.freeze(Object.defineProperty({__proto__:null,auth:_o,createPlayerAccount:FV,db:we,resetPlayerPassword:$V,signInPlayer:UV,updatePlayerPassword:jV},Symbol.toStringTag,{value:"Module"})),Qa="seasons";async function BV(n,e,t){return await ch(rt(we,Qa),{name:n,slug:e,pinCode:t,createdAt:Lu()})}async function qV(n){return await au(Fe(we,Qa,n))}async function of(){const n=ih(rt(we,Qa),bC("createdAt","desc"));return(await Ct(n)).docs.map(t=>({id:t.id,...t.data()}))}async function bd(n,e){const t=await Rs(Fe(we,Qa,n));return t.exists()?t.data().pinCode===e:!1}async function Zf(n){const e=await Rs(Fe(we,Qa,n));return e.exists()?e.data().pinCode:null}async function vl(n,e){const t=Fe(we,Qa,n);await Ou(t,{sortOrder:e})}const af=10*60*1e3,lf="impro_selector_pin_session";class zV{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(lf);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<af)return t;this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(lf,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){return this.sessionData?this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<af:!1}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(lf),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=af-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const Kn=new zV,GV={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},KV={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},HV={class:"text-center mb-6"},WV={class:"text-gray-300"},QV={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},JV={class:"text-sm text-green-400"},YV={class:"mb-6"},XV={class:"mb-4"},ZV={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},e2={class:"flex justify-end space-x-3"},t2=["disabled"],VI={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=O(""),i=O(""),o=O(null);Yt(()=>t.show,d=>{d&&(s.value="",i.value="",cn(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(d,f)=>n.show?(U(),$("div",GV,[p("div",KV,[p("div",HV,[f[1]||(f[1]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),p("p",WV,ce(n.message),1),n.sessionInfo?(U(),$("div",QV,[p("p",JV," Session active : "+ce(n.sessionInfo.timeRemaining)+" min restantes ",1)])):fe("",!0)]),p("div",YV,[p("div",XV,[f[3]||(f[3]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),yt(p("input",{"onUpdate:modelValue":f[0]||(f[0]=v=>s.value=v),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[Rn(l,["enter"]),Rn(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[Ut,s.value]])]),f[4]||(f[4]=p("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(U(),$("div",ZV,ce(i.value||t.error),1)):fe("",!0),p("div",e2,[p("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,t2)])])])):fe("",!0)}},n2={class:"relative p-6 pb-4 border-b border-white/10"},r2={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},NI={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(U(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=Ht(()=>{},["stop"]))},[p("div",n2,[p("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=p("div",{class:"flex items-center gap-3"},[p("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"🎭"),p("div",null,[p("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Bienvenue dans Tu joues quand ?"),p("p",{class:"text-sm text-purple-300"},"L'appli impro pour organiser saisons, événements et sélections")])],-1))]),s[5]||(s[5]=ur('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">À quoi ça sert ?</h3><p> Tu joues quand ? vous aide à gérer vos spectacles d&#39;impro : saisons, événements, joueurs, disponibilités, tirage au sort équitable et annonces. Fini les prises de tête : indiquez qui est dispo, et laissez le hasard pondéré faire le reste. </p></div><div class="space-y-3"><h3 class="text-white font-semibold">Fonctionnalités principales</h3><ul class="list-disc list-inside space-y-2 text-gray-300"><li><span class="text-white">Saisons</span> : regroupez vos événements par saison pour garder un historique clair.</li><li><span class="text-white">Événements</span> : créez des dates avec un titre et un nombre de joueurs à sélectionner; archivez-les quand ils sont passés.</li><li><span class="text-white">Joueurs</span> : gérez la liste des joueurs et leurs informations.</li><li><span class="text-white">Indication de disponibilité</span> : Oui/Non/Peut‑être via liens magiques ou directement dans la grille.</li><li><span class="text-white">Sélection automatique</span> : tirage au sort pondéré qui favorise l&#39;équité sur la durée.</li><li><span class="text-white">Protection des saisies</span> : PIN de saison pour sécuriser les actions sensibles, mot de passe possible pour certains joueurs.</li><li><span class="text-white">Notifications</span> : annoncez un événement (email/lien) pour collecter facilement les disponibilités.</li></ul></div><div class="space-y-2 text-sm text-gray-300"><h3 class="text-white font-semibold">Astuces</h3><ul class="list-disc list-inside space-y-1"><li>Sur mobile, faites glisser horizontalement pour parcourir les événements.</li><li>Le bouton ⚠️ dans les en-têtes signale qu&#39;un événement est prêt pour une sélection ou nécessite votre attention.</li></ul></div></div>',1)),p("div",r2,[p("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):fe("",!0)}},s2=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function i2(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function OI(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function o2(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function MI(n){if(!n)return!1;const e=String(n).toLowerCase();return s2.some(t=>e.includes(t.toLowerCase()))}function ep(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?o2(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>ep(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=MI(t)?"••••":ep(r);return e}return n}function a2(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&MI(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(ep(r))}return e}const l2=OI(i2());function xc(n,e){const t=OI(n);return(...r)=>{if(t<l2)return;const s=a2(r);console[e](...s)}}const pe={debug:xc("debug","log"),info:xc("info","info"),warn:xc("warn","warn"),error:xc("error","error")},u2={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},c2={class:"text-center py-16 px-4 relative"},d2=["aria-busy"],h2={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto animate-pulse"},f2={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto"},p2=["onClick"],m2={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},g2={class:"absolute top-4 right-4"},v2=["onClick","aria-expanded"],y2={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},_2=["onClick"],b2=["onClick"],w2=["onClick"],I2={key:2,class:"flex justify-center mt-12"},E2={key:3,class:"text-center py-16"},T2={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},x2={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},A2={class:"mb-6"},S2={class:"mb-6"},P2={class:"mb-6"},R2={class:"flex justify-end space-x-3"},C2=["disabled"],k2={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},D2={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},V2={class:"text-center mb-6"},N2={class:"text-gray-300"},O2={__name:"Home",setup(n){const e=O([]),t=O(!0),r=yu(),s=O(null),i=O(!1),o=O(!1),a=O(""),l=O(""),c=O(""),d=O(null),f=O(!1),v=O(null),y=O(""),P=O(!1);Or(async()=>{var ke;try{e.value=await of(),pe.info("Saisons chargées",{count:((ke=e.value)==null?void 0:ke.length)||0}),F().catch(ee=>pe.error("Migration sortOrder échouée",ee))}finally{t.value=!1}});const A=Qe(()=>[...e.value].sort((ke,ee)=>{var Ze,nt;const De=typeof ke.sortOrder=="number"?ke.sortOrder:Number.MAX_SAFE_INTEGER,H=typeof ee.sortOrder=="number"?ee.sortOrder:Number.MAX_SAFE_INTEGER;if(De!==H)return De-H;const Y=(Ze=ke.createdAt)!=null&&Ze.toMillis?ke.createdAt.toMillis():0,Ve=(nt=ee.createdAt)!=null&&nt.toMillis?ee.createdAt.toMillis():0;return Y!==Ve?Ve-Y:(ke.name||"").localeCompare(ee.name||"")}));function R(ke){r.push(`/season/${ke}`)}function j(ke){s.value=s.value===ke?null:ke}function B(){s.value=null}async function F(){if(!e.value.length)return;const ke=e.value.map(De=>typeof De.sortOrder=="number"?De.sortOrder:null).filter(De=>De!==null);let ee=ke.length?Math.max(...ke):0;for(const De of e.value)if(typeof De.sortOrder!="number"){ee+=1;try{await vl(De.id,ee),De.sortOrder=ee}catch(H){pe.error("Erreur migration sortOrder",{seasonName:De==null?void 0:De.name,error:H})}}}async function G(ke){if(B(),ke<=0)return;const ee=[...A.value],De=ee[ke],H=ee[ke-1],Y=De.sortOrder;De.sortOrder=H.sortOrder,H.sortOrder=Y;try{await Promise.all([vl(De.id,De.sortOrder),vl(H.id,H.sortOrder)])}catch(Ve){pe.error("Erreur lors du déplacement vers le haut",Ve)}}async function oe(ke){B();const ee=[...A.value];if(ke>=ee.length-1)return;const De=ee[ke],H=ee[ke+1],Y=De.sortOrder;De.sortOrder=H.sortOrder,H.sortOrder=Y;try{await Promise.all([vl(De.id,De.sortOrder),vl(H.id,H.sortOrder)])}catch(Ve){pe.error("Erreur lors du déplacement vers le bas",Ve)}}function ie(){a.value&&(l.value=a.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function I(){c.value=c.value.replace(/[^0-9]/g,""),c.value.length>4&&(c.value=c.value.slice(0,4))}async function E(){if(!a.value.trim()||!l.value.trim()||!c.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(c.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await BV(a.value.trim(),l.value.trim(),c.value.trim()),e.value=await of(),await F(),x()}catch(ke){pe.error("Erreur lors de la création de la saison",ke),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function x(){i.value=!1,a.value="",l.value="",c.value=""}function k(ke){d.value=ke,o.value=!0}async function V(){o.value=!1,await He({type:"deleteSeason",data:{seasonId:d.value.id,seasonName:d.value.name}})}function D(){o.value=!1,d.value=null}function w(){return v.value?{deleteSeason:"Suppression de saison - Code PIN requis"}[v.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function He(ke){if(Kn.isPinCached(d.value.id)){const ee=Kn.getCachedPin(d.value.id);if(pe.debug("PIN en cache trouvé, utilisation automatique"),await bd(d.value.id,ee)){await je(ke);return}else Kn.clearSession()}v.value=ke,f.value=!0}async function We(ke){var ee,De,H,Y;pe.debug("PIN soumis pour l'opération",{operationType:(ee=v.value)==null?void 0:ee.type});try{const Ve=((H=(De=v.value)==null?void 0:De.data)==null?void 0:H.seasonId)||((Y=d.value)==null?void 0:Y.id),Ze=await bd(Ve,ke);if(pe.debug("PIN validé",{valid:Ze}),Ze){Kn.saveSession(Ve,ke),pe.debug("PIN correct, fermeture de la modal et exécution de l'opération"),f.value=!1;const nt=v.value;v.value=null,pe.debug("Appel de executePendingOperation",{operationType:nt==null?void 0:nt.type}),await je(nt)}else y.value="Code PIN incorrect",setTimeout(()=>{y.value=""},3e3)}catch(Ve){pe.error("Erreur lors de la vérification du PIN",Ve),y.value="Erreur lors de la vérification du code PIN"}}function Xe(){f.value=!1,v.value=null,y.value=""}function $e(){return d.value&&Kn.isPinCached(d.value.id)?{timeRemaining:Kn.getTimeRemaining(),isExpiringSoon:Kn.isExpiringSoon()}:null}async function je(ke){var H;if(pe.debug("executePendingOperation appelé",{hasOperation:!!ke}),!ke){pe.warn("Aucune opération à exécuter");return}const{type:ee,data:De}=ke;pe.info("Exécution de l'opération",{type:ee});try{switch(ee){case"deleteSeason":pe.info("Suppression de la saison",{seasonId:De.seasonId}),await qV(De.seasonId),pe.info("Saison supprimée, rechargement de la liste"),e.value=await of(),pe.info("Liste des saisons rechargée",{count:((H=e.value)==null?void 0:H.length)||0});break;default:pe.warn("Type d'opération non reconnu",{type:ee})}}catch(Y){pe.error("Erreur lors de l'exécution de l'opération",Y),alert("Erreur lors de l'opération. Veuillez réessayer.")}}return(ke,ee)=>{var De;return U(),$("div",u2,[p("div",c2,[p("button",{onClick:ee[0]||(ee[0]=H=>P.value=!0),class:"absolute right-4 top-4 text-white/90 hover:text-white p-2 rounded-full hover:bg-white/10",title:"Comment ça marche ?","aria-label":"Comment ça marche ?"},ee[8]||(ee[8]=[p("span",{class:"text-2xl"},"❓",-1)])),ee[9]||(ee[9]=p("h1",{class:"text-6xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent animate-pulse"}," Tu joues quand ? ",-1)),ee[10]||(ee[10]=p("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto leading-relaxed"},"Arrêtez de vous prendre la tête pour savoir qui sera sur scène quand. Laissez chacun indiquer ses dispos et le hasard choisir pour vous !",-1))]),p("div",{class:"container mx-auto px-4 pb-16","aria-busy":t.value},[t.value?(U(),$("div",h2,[(U(),$(At,null,cr(8,H=>p("div",{key:"skeleton-"+H,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8"},ee[11]||(ee[11]=[p("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),p("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),p("div",{class:"h-px bg-white/10 mb-4"},null,-1),p("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(U(),$("div",f2,[(U(!0),$(At,null,cr(A.value,(H,Y)=>(U(),$("div",{key:H.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20"},[p("div",{onClick:Ve=>R(H.slug),class:"text-center cursor-pointer"},[ee[12]||(ee[12]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg"},[p("span",{class:"text-2xl"},"🎭")],-1)),p("h2",m2,ce(H.name),1),ee[13]||(ee[13]=p("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),ee[14]||(ee[14]=p("p",{class:"text-gray-300 text-sm"}," Cliquez pour accéder ",-1))],8,p2),p("div",g2,[p("div",{class:"relative",onClick:ee[1]||(ee[1]=Ht(()=>{},["stop"]))},[p("button",{onClick:Ve=>j(Y),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===Y,"aria-haspopup":"true",title:"Options"},ee[15]||(ee[15]=[p("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,v2),s.value===Y?(U(),$("div",y2,[p("button",{onClick:Ve=>G(Y),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Monter ",8,_2),p("button",{onClick:Ve=>oe(Y),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Descendre ",8,b2),ee[16]||(ee[16]=p("div",{class:"border-t border-white/10 my-1"},null,-1)),p("button",{onClick:Ve=>k(H),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10",role:"menuitem"}," Supprimer ",8,w2)])):fe("",!0)])])]))),128))])):fe("",!0),!t.value&&e.value.length>0?(U(),$("div",I2,[p("button",{onClick:ee[2]||(ee[2]=H=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105"}," ✨ Nouvelle saison ")])):fe("",!0),!t.value&&e.value.length===0?(U(),$("div",E2,[ee[17]||(ee[17]=p("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[p("span",{class:"text-4xl"},"🎪")],-1)),ee[18]||(ee[18]=p("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),ee[19]||(ee[19]=p("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),p("button",{onClick:ee[3]||(ee[3]=H=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):fe("",!0)],8,d2),i.value?(U(),$("div",T2,[p("div",x2,[ee[24]||(ee[24]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),p("div",A2,[ee[20]||(ee[20]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),yt(p("input",{"onUpdate:modelValue":ee[4]||(ee[4]=H=>a.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:ie},null,544),[[Ut,a.value]])]),p("div",S2,[ee[21]||(ee[21]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),yt(p("input",{"onUpdate:modelValue":ee[5]||(ee[5]=H=>l.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[Ut,l.value]])]),p("div",P2,[ee[22]||(ee[22]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),yt(p("input",{"onUpdate:modelValue":ee[6]||(ee[6]=H=>c.value=H),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:I},null,544),[[Ut,c.value]]),ee[23]||(ee[23]=p("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),p("div",R2,[p("button",{onClick:x,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:E,disabled:!a.value.trim()||!l.value.trim()||!c.value.trim()||c.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,C2)])])])):fe("",!0),o.value?(U(),$("div",k2,[p("div",D2,[p("div",V2,[ee[25]||(ee[25]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"⚠️")],-1)),ee[26]||(ee[26]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),p("p",N2,'Êtes-vous sûr de vouloir supprimer la saison "'+ce((De=d.value)==null?void 0:De.name)+'" ?',1)]),ee[27]||(ee[27]=p("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:D,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:V,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):fe("",!0),wt(VI,{show:f.value,message:w(),error:y.value,"session-info":$e(),onSubmit:We,onCancel:Xe},null,8,["show","message","error","session-info"]),wt(NI,{show:P.value,onClose:ee[7]||(ee[7]=H=>P.value=!1)},null,8,["show"]),ee[28]||(ee[28]=ur('<footer class="mt-16 border-t border-white/10"><div class="container mx-auto px-4 py-6 text-center text-xs text-gray-400"><span>© Patrice Lamarque 2025</span><span class="mx-2">•</span><span>Licence MIT</span><span class="mx-2">•</span><a href="https://github.com/plamarque/impro-selector" target="_blank" rel="noopener noreferrer" class="underline decoration-white/20 hover:decoration-white/40 hover:text-gray-200">GitHub</a></div></footer>',1))])}}},M2="modulepreload",L2=function(n){return"/"+n},Oy={},Xt=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=L2(i),i in Oy)return;Oy[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":M2,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((d,f)=>{c.addEventListener("load",d),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},_h="magicLinks";function bh({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function LI(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function tp({seasonId:n,playerId:e,eventId:t,action:r}){const s=bh({seasonId:n,playerId:e,eventId:t,action:r}),i=LI(40),o=Fe(we,_h,s),a=Date.now()+1e3*60*60*24*7;await Vn(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const c=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:c}}async function FI({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=bh({seasonId:n,playerId:e,eventId:r,action:s}),o=LI(40),a=Fe(we,_h,i),l=Date.now()+1e3*60*60*24*7;await Vn(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const d=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:d}}async function UI({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=bh({seasonId:n,playerId:e,eventId:t,action:s}),o=Fe(we,_h,i),a=await Rs(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function np({seasonId:n,playerId:e,eventId:t,action:r}){const s=bh({seasonId:n,playerId:e,eventId:t,action:r}),i=Fe(we,_h,s);await au(i)}const F2=Object.freeze(Object.defineProperty({__proto__:null,consumeMagicLink:np,createEmailVerificationLink:FI,createMagicLink:tp,verifyMagicLink:UI},Symbol.toStringTag,{value:"Module"}));class U2{constructor(){this.sessions=new Map,this.sessionDuration=10*60*1e3}isPasswordCached(e){const t=this.sessions.get(e);return t?Date.now()-t.timestamp>this.sessionDuration?(this.sessions.delete(e),!1):!0:!1}getCachedPassword(e){const t=this.sessions.get(e);return t?Date.now()-t.timestamp>this.sessionDuration?(this.sessions.delete(e),null):t.password:null}saveSession(e,t){this.sessions.set(e,{password:t,timestamp:Date.now()})}clearSession(e){this.sessions.delete(e)}clearExpiredSessions(){const e=Date.now();for(const[t,r]of this.sessions.entries())e-r.timestamp>this.sessionDuration&&this.sessions.delete(t)}clearAllSessions(){this.sessions.clear()}}const Na=new U2;function Km(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function wd(n){return`seasonPreferredPlayer:${n||"global"}`}async function $I(n,e,t,r=null){try{pe.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await zu(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await Xt(()=>import("./index.esm-778f7358.js"),[]),{db:c}=await Xt(()=>Promise.resolve().then(()=>ui),void 0),d=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(d,a("email","==",e)),v=await l(f);if(!v.empty&&v.docs.find(F=>F.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");pe.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:y}=await Xt(()=>import("./index.esm-23e7298f.js"),[]),{auth:P}=await Xt(()=>Promise.resolve().then(()=>ui),void 0),A=await y(P,e,t);pe.info("Compte Firebase Auth créé",{uid:A.user.uid});const R=Km(t),j=r?Fe(c,"seasons",r,"playerProtection",n):Fe(c,"playerProtection",n);await Vn(j,{playerId:n,email:e,passwordHash:R,firebaseUid:A.user.uid,isProtected:!0,createdAt:new Date}),pe.info("Protection sauvegardée dans Firestore");try{r&&localStorage.setItem(wd(r),n)}catch{}return{success:!0}}catch(s){throw pe.error("Erreur lors de la protection du joueur",s),s}}async function jI({playerId:n,email:e,seasonId:t=null}){const r=t?rt(we,"seasons",t,"playerProtection"):rt(we,"playerProtection"),s=ih(r,Im("email","==",e)),i=await Ct(s);if(!i.empty&&i.docs.find(d=>d.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");try{const{fetchSignInMethodsForEmail:c}=await Xt(()=>import("./index.esm-23e7298f.js"),[]),{auth:d}=await Xt(()=>Promise.resolve().then(()=>ui),void 0),f=await c(d,e);if(Array.isArray(f)&&f.length>0)throw new Error("Cette adresse email est déjà utilisée par un autre joueur")}catch(c){if(c!=null&&c.code&&c.code!=="auth/invalid-email")throw c}const o=t?Fe(we,"seasons",t,"playerProtection",n):Fe(we,"playerProtection",n);(await Rs(o)).exists()?await Ou(o,{email:e,updatedAt:new Date}):await Vn(o,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:l}=await FI({seasonId:t,playerId:n,email:e});return{success:!0,url:l}}async function BI({playerId:n,seasonId:e=null}){const t=e?Fe(we,"seasons",e,"playerProtection",n):Fe(we,"playerProtection",n);if(!(await Rs(t)).exists())throw new Error("Protection introuvable");return await Ou(t,{emailVerifiedAt:new Date}),{success:!0}}async function $2({playerId:n,seasonId:e=null}){const t=e?Fe(we,"seasons",e,"playerProtection",n):Fe(we,"playerProtection",n);return await Ou(t,{emailVerifiedAt:null}),{success:!0}}async function qI(n,e=null){try{const t=e?Fe(we,"seasons",e,"playerProtection",n):Fe(we,"playerProtection",n);await Vn(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date});try{if(e){const r=wd(e);localStorage.getItem(r)===n&&localStorage.removeItem(r)}}catch{}return{success:!0,email:""}}catch(t){throw pe.error("Erreur lors de la suppression de la protection",t),t}}async function eo(n,e=null){try{const t=e?Fe(we,"seasons",e,"playerProtection",n):Fe(we,"playerProtection",n),r=await Rs(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return pe.error("Erreur lors de la vérification de protection",t),!1}}async function zu(n,e=null){try{const t=e?Fe(we,"seasons",e,"playerProtection",n):Fe(we,"playerProtection",n),r=await Rs(t);return r.exists()?r.data():null}catch(t){return pe.error("Erreur lors de la récupération des données de protection",t),null}}async function zI(n,e=null){try{const t=await zu(n,e);return(t==null?void 0:t.email)||""}catch(t){return pe.error("Erreur lors de la récupération de l'email",t),""}}async function rp(n=null){try{const e=n?rt(we,"seasons",n,"playerProtection"):rt(we,"playerProtection");return(await Ct(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return pe.error("Erreur lors du chargement des protections",e),[]}}async function Hm(n,e,t=null){try{const r=await zu(n,t);if(!r||!r.isProtected)return!1;if(r.firebaseUid){pe.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await Xt(()=>import("./index.esm-23e7298f.js"),[]),{auth:i}=await Xt(()=>Promise.resolve().then(()=>ui),void 0);await s(i,r.email,e),pe.debug("Mot de passe Firebase Auth valide"),Na.saveSession(n,e);try{t&&localStorage.setItem(wd(t),n)}catch{}return!0}catch(s){return pe.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{pe.debug("Vérification avec hash local");const s=Km(e),i=r.passwordHash===s;if(i){Na.saveSession(n,e);try{t&&localStorage.setItem(wd(t),n)}catch{}}return i}}catch(r){return pe.error("Erreur lors de la vérification du mot de passe",r),!1}}function fa(n){return Na.isPasswordCached(n)}function j2(n){return Na.getCachedPassword(n)}async function GI(n,e=null){try{pe.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await zu(n,e);if(pe.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(pe.debug("Email à utiliser (masqué)"),t.firebaseUid){pe.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await Xt(()=>import("./index.esm-23e7298f.js"),[]),{auth:s}=await Xt(()=>Promise.resolve().then(()=>ui),void 0);pe.debug("Tentative d'envoi d'email"),await r(s,t.email),pe.info("Email envoyé avec succès via Firebase Auth")}else{pe.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await Xt(()=>import("./index.esm-23e7298f.js"),[]),{auth:i}=await Xt(()=>Promise.resolve().then(()=>ui),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);pe.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),pe.info("Email envoyé avec succès");const{updateDoc:l}=await Xt(()=>import("./index.esm-778f7358.js"),[]),{db:c}=await Xt(()=>Promise.resolve().then(()=>ui),void 0),d=e?Fe(c,"seasons",e,"playerProtection",n):Fe(c,"playerProtection",n);await l(d,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")pe.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),pe.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw pe.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function B2(n,e,t=null){try{const r=Km(e),s=t?Fe(we,"seasons",t,"playerProtection",n):Fe(we,"playerProtection",n);return await Ou(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw pe.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function q2(n){return new Promise((e,t)=>{pe.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const Id=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:$2,getCachedPlayerPassword:j2,getPlayerEmail:zI,getPlayerProtectionData:zu,isPlayerPasswordCached:fa,isPlayerProtected:eo,listProtectedPlayers:rp,markEmailVerifiedForProtection:BI,protectPlayer:$I,requirePlayerPasswordForAvailability:q2,sendPasswordResetEmail:GI,startEmailVerificationForProtection:jI,unprotectPlayer:qI,updatePlayerPasswordInFirestore:B2,verifyPlayerPassword:Hm},Symbol.toStringTag,{value:"Module"}));let Bn="mock",pu=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],ho=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function KI(n){Bn=n}async function z2(){if(Bn!=="firebase"||!(await Ct(rt(we,"seasons"))).empty)return;const e=Fe(rt(we,"seasons"));await Vn(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:Lu()});const t=await Ct(rt(we,"players"));for(const o of t.docs)await Vn(Fe(e,"players",o.id),o.data());const r=await Ct(rt(we,"events"));for(const o of r.docs)await Vn(Fe(e,"events",o.id),o.data());const s=await Ct(rt(we,"availability"));for(const o of s.docs)await Vn(Fe(e,"availability",o.id),o.data());const i=await Ct(rt(we,"selections"));for(const o of i.docs)await Vn(Fe(e,"selections",o.id),o.data())}async function G2(){Bn==="firebase"&&await z2()}async function My(n=null){return(Bn==="firebase"?n?(await Ct(rt(we,"seasons",n,"events"))).docs.map(t=>({id:t.id,...t.data()})):(await Ct(rt(we,"events"))).docs.map(t=>({id:t.id,...t.data()})):ho).sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const d=new Date(c);return isNaN(d.getTime())?null:d},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function uf(n=null){return(Bn==="firebase"?n?(await Ct(rt(we,"seasons",n,"players"))).docs.map(t=>({id:t.id,...t.data()})):(await Ct(rt(we,"players"))).docs.map(t=>({id:t.id,...t.data()})):pu).sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function HI(n,e=null){if(Bn==="firebase"){const t=Fe(e?rt(we,"seasons",e,"players"):rt(we,"players"));return await Vn(t,{name:n}),t.id}else{const t=`p${pu.length+1}`;return pu.push({id:t,name:n}),t}}async function K2(n,e=null){if(Bn==="firebase"){const t=e?Fe(we,"seasons",e,"players",n):Fe(we,"players",n);await au(t);const r=e?await Ct(rt(we,"seasons",e,"availability")):await Ct(rt(we,"availability")),s=Uw(we);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else pu=pu.filter(t=>t.id!==n)}async function Ho(n,e,t=null){if(Bn==="firebase"){const r=t?await Ct(rt(we,"seasons",t,"availability")):await Ct(rt(we,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function Wo(n=null){if(Bn==="firebase"){const e=n?await Ct(rt(we,"seasons",n,"selections")):await Ct(rt(we,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function Ly(n,e,t=null){if(Bn==="firebase"){const r=t?Fe(we,"seasons",t,"availability",n):Fe(we,"availability",n);await Vn(r,e)}}async function H2({seasonId:n,playerName:e,eventId:t,value:r}){if(Bn!=="firebase")return;const s=n?Fe(we,"seasons",n,"availability",e):Fe(we,"availability",e),i=await Rs(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await Vn(s,a)}async function Fy(n,e,t=null){if(Bn==="firebase"){const r=t?Fe(we,"seasons",t,"selections",n):Fe(we,"selections",n);await Vn(r,{players:e})}}async function W2(n,e=null){if(pe.info("Suppression de l'événement",{eventId:n}),Bn==="firebase")try{pe.debug("Suppression de l'événement dans Firestore");const t=e?Fe(we,"seasons",e,"events",n):Fe(we,"events",n);await au(t),pe.debug("Suppression de la sélection associée");const r=e?Fe(we,"seasons",e,"selections",n):Fe(we,"selections",n);await au(r),pe.debug("Suppression des disponibilités");const s=e?await Ct(rt(we,"seasons",e,"availability")):await Ct(rt(we,"availability")),i=Uw(we);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){pe.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),pe.info("Opérations de suppression terminées avec succès")}catch(t){throw pe.error("Erreur lors de la suppression",t),t}else ho=ho.filter(t=>t.id!==n)}async function Q2(n,e=null){if(Bn==="firebase"){const t=Fe(e?rt(we,"seasons",e,"events"):rt(we,"events"));return await Vn(t,n),t.id}else{const t=`event${ho.length+1}`;return ho.push({id:t,...n}),t}}async function Uy(n,e,t=null){if(Bn==="firebase"){const r=t?Fe(we,"seasons",t,"events",n):Fe(we,"events",n);await Vn(r,e,{merge:!0})}else{const r=ho.findIndex(s=>s.id===n);r!==-1&&(ho[r]={id:n,...e})}}async function J2({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,reason:o="new_event",fromEmail:a=void 0}){const l=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>Disponibilité demandée</h2>
      <p>Bonjour ${e},</p>
      <p>Peux-tu indiquer ta disponibilité pour <strong>${t}</strong> (${r}) ?</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;margin-right:8px;background:#16a34a;color:#fff;border-radius:8px;text-decoration:none;">Je suis dispo ✅</a>
        <a href="${i}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Pas dispo ❌</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: ${o}</p>
    </div>
  `,c=`Disponibilité demandée · ${t}`,d={to:n,message:{subject:c,html:l},createdAt:Lu(),meta:{reason:o,eventTitle:t,eventDate:r,playerName:e}};return a&&(d.from=a,d.replyTo=a),await ch(rt(we,"mail"),d),{success:!0}}async function Y2({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){const s=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>Vérification de votre email</h2>
      <p>Bonjour ${e},</p>
      <p>Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.</p>
      <p>
        <a href="${t}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">Vérifier mon email</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,o={to:n,message:{subject:"Confirmez votre email pour activer la protection",html:s},createdAt:Lu(),meta:{reason:"protection_email_verification",playerName:e}};r&&(o.from=r,o.replyTo=r),await ch(rt(we,"mail"),o)}async function X2({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0}){pe.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const l=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Tu as été sélectionné(e) !</h2>
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#8b5cf6;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,c=o||`🎭 Sélection confirmée · ${t}`;pe.debug("queueSelectionEmail html/subject ready");const d={to:n,message:{subject:c,html:l},createdAt:Lu(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}};a&&(d.from=a,d.replyTo=a),pe.debug("queueSelectionEmail firestore payload ready");try{return await ch(rt(we,"mail"),d),pe.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(f){throw pe.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:f}),f}}async function Z2({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(pe.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await Xt(()=>Promise.resolve().then(()=>Id),void 0),{createMagicLink:a}=await Xt(()=>Promise.resolve().then(()=>F2),void 0),l=`${window.location.origin}/season/${s}/event/${n}`,c=t.join(", "),d=`🎭 Sélection confirmée · ${e.title}`,f=[];for(const v of t){pe.debug("Traitement du joueur",{playerName:v});try{const y=i==null?void 0:i.find(F=>F.name===v);if(!y){pe.warn("Joueur non trouvé",{playerName:v});continue}pe.debug("Joueur trouvé");const P=await o(y.id,r);if(!P){pe.warn("Pas d'email pour le joueur",{playerName:v});continue}pe.debug("Email trouvé pour joueur");const R=`${(await a({seasonId:r,playerId:y.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,j=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection confirmée</h2>
          <p>Bonjour <strong>${v}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${$y(e.date)}).</p>
          <p>Sélection complète : <strong>${c}</strong>.</p>
          <p>Tu n'es plus disponible ? Signale le rapidement ici :</p>
          <p>
            <a href="${R}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Signaler que je ne suis plus disponible</a>
          </p>
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 16px;background:#8b5cf6;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;pe.debug("HTML généré pour joueur");const B=X2({toEmail:P,playerName:v,eventTitle:e.title,eventDate:$y(e.date),eventUrl:l,html:j,subject:d});f.push(B),pe.info("Email ajouté à la queue",{playerName:v})}catch(y){pe.error("Erreur lors de l'envoi de l'email de sélection",{playerName:v,error:y})}}return pe.info("Nombre total d'emails à envoyer",{count:f.length}),await Promise.all(f),pe.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:f.length}}function $y(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}const eN={class:"relative p-5 pb-4 border-b border-white/10"},tN={class:"text-xl md:text-2xl font-bold text-white pr-10"},nN={key:0,class:"text-sm text-purple-300 mt-1"},rN={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},sN={class:"bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20 p-3"},iN={class:"text-blue-200 text-sm"},oN={class:"flex space-x-1 bg-gray-800 rounded-lg p-1"},aN=["onClick"],lN={key:0,class:"space-y-4"},uN={class:"bg-gray-800 border border-gray-600 rounded-lg p-4 text-white whitespace-pre-line"},cN={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},dN={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},hN={class:"text-blue-200 text-sm"},fN={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},pN={key:0,class:"space-y-2"},mN={class:"flex flex-wrap gap-2"},gN={key:1,class:"text-amber-400 text-sm"},vN={key:1,class:"space-y-4"},yN={class:"relative"},_N=["value"],bN=["title"],wN={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},IN={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},EN={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},TN=["disabled"],xN={key:0},AN={key:1},WI={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]}},emits:["close","notifications-sent","send-email-notifications"],setup(n,{emit:e}){const t=n,r=e,s=O("email"),i=O(!1),o=O("Copier le message"),a=O(!1),l=O(!1),c=[{id:"email",label:"📧 Email"},{id:"copy",label:"📋 Copie"}],d=Qe(()=>!t.event||!t.seasonSlug?"":`${window.location.origin}/season/${t.seasonSlug}/event/${t.event.id}`),f=Qe(()=>{if(!t.event)return"";const F=R(t.event.date);if(t.mode==="selection"){const G=t.selectedPlayers.join(", ");return`Sélection pour ${t.event.title} du ${F} : ${G}`}else return`Bonjour !

Nouvel événement : ${t.event.title}
Date : ${F}

Lien direct vers l'événement : ${d.value}

Merci de confirmer votre disponibilité.`}),v=Qe(()=>{if(!t.event||!t.selectedPlayers)return"";if(t.mode==="selection"){const F=t.selectedPlayers.join(", ");return`Sélection confirmée

Bonjour [Nom du joueur],

Tu as été sélectionné(e) pour ${t.event.title} (${R(t.event.date)}).

Sélection complète : ${F}.

Tu n'es plus disponible ? Signale le rapidement ici : [Lien de désistement]`}else return`Disponibilité demandée

Bonjour [Nom du joueur],

Peux-tu indiquer ta disponibilité pour ${t.event.title} (${R(t.event.date)}) ?`}),y=O([]);async function P(){if(!t.seasonId)return;let F=[];t.mode==="selection"?F=t.players.filter(oe=>t.selectedPlayers.includes(oe.name)):F=t.players.filter(oe=>oe.isProtected);const G=[];for(const oe of F)try{const{getPlayerEmail:ie}=await Xt(()=>Promise.resolve().then(()=>Id),void 0),I=await ie(oe.id,t.seasonId);I&&G.push({...oe,email:I})}catch(ie){console.warn(`Impossible de charger l'email pour ${oe.name}:`,ie)}y.value=G}function A(){r("close")}function R(F){var oe;return F?(typeof F=="string"?new Date(F):((oe=F.toDate)==null?void 0:oe.call(F))||F).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function j(){const F=f.value;navigator.clipboard.writeText(F).then(()=>{i.value=!0,o.value="Copié !",setTimeout(()=>{i.value=!1,o.value="Copier le message"},2e3)}).catch(G=>{console.warn("Erreur lors de la copie du texte"),alert("Impossible de copier le message.")})}async function B(){if(!(!t.event||y.value.length===0)){a.value=!0;try{t.mode==="selection"?r("send-email-notifications",{eventId:t.event.id,eventData:t.event,reason:"selection",selectedPlayers:t.selectedPlayers}):r("send-email-notifications",{eventId:t.event.id,eventData:t.event,reason:"manual"})}catch{console.error("Erreur lors de l'envoi des notifications"),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer.")}finally{a.value=!1}}}return Or(()=>{t.show&&(s.value="email",P())}),Yt(()=>t.show,F=>{F&&(s.value="email",P())}),Yt(()=>t.selectedPlayers,()=>{t.show&&t.mode==="selection"&&P()}),(F,G)=>n.show?(U(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:A},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:G[1]||(G[1]=Ht(()=>{},["stop"]))},[p("div",eN,[p("button",{onClick:A,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),p("h2",tN,ce(n.mode==="selection"?"Annoncer la sélection":"Annoncer l'événement"),1),n.event?(U(),$("p",nN,ce(n.event.title)+" — "+ce(R(n.event.date)),1)):fe("",!0)]),p("div",rN,[p("div",sN,[p("p",iN,ce(n.mode==="selection"?"Choisis comment annoncer cette sélection aux joueurs :":"Choisis comment annoncer cet événement aux joueurs :"),1)]),p("div",oN,[(U(),$(At,null,cr(c,oe=>p("button",{key:oe.id,onClick:ie=>s.value=oe.id,class:Hn(["flex-1 px-4 py-2 rounded-md text-sm font-medium transition-all duration-200",s.value===oe.id?"bg-purple-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-700"])},ce(oe.label),11,aN)),64))]),s.value==="email"?(U(),$("div",lN,[p("div",null,[G[2]||(G[2]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Prévisualisation du message :",-1)),p("div",uN,ce(v.value),1)]),p("div",null,[p("label",cN,[G[3]||(G[3]=Vr(" Destinataires ")),p("button",{onClick:G[0]||(G[0]=oe=>l.value=!l.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),l.value?(U(),$("div",dN,[p("p",hN,ce(n.mode==="selection"?"Les destinataires sont les joueurs sélectionnés qui ont renseigné une adresse email en utilisant la fonction Protéger.":"Les destinataires sont les joueurs qui ont renseigné une adresse email en utilisant la fonction Protéger."),1)])):fe("",!0),p("div",fN,[y.value.length>0?(U(),$("div",pN,[p("div",mN,[(U(!0),$(At,null,cr(y.value,oe=>(U(),$("span",{key:oe.id,class:"px-3 py-1 bg-gray-700 text-white rounded text-sm"},ce(oe.name),1))),128))])])):(U(),$("div",gN," ⚠️ "+ce(n.mode==="selection"?"Aucun joueur sélectionné avec email renseigné. Les notifications ne pourront pas être envoyées.":"Aucun joueur protégé avec email renseigné. Les notifications ne pourront pas être envoyées."),1))])])])):fe("",!0),s.value==="copy"?(U(),$("div",vN,[G[6]||(G[6]=p("div",{class:"bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-500/20 p-3"},[p("p",{class:"text-purple-200 text-sm"},"📋 Copie du message pour partage manuel")],-1)),p("div",yN,[p("textarea",{value:f.value,class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",rows:"6",readonly:""},null,8,_N),p("button",{onClick:j,class:"absolute top-2 right-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg p-2 hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:o.value},[i.value?(U(),$("svg",IN,G[5]||(G[5]=[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(U(),$("svg",wN,G[4]||(G[4]=[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2z"},null,-1)])))],8,bN)])])):fe("",!0)]),p("div",EN,[s.value==="email"?(U(),$("button",{key:0,onClick:B,disabled:y.value.length===0||a.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[a.value?(U(),$("span",AN,"📧 Envoi en cours...")):(U(),$("span",xN,"📧 Envoyer les notifications email"))],8,TN)):fe("",!0),s.value==="copy"?(U(),$("button",{key:1,onClick:j,class:"h-12 px-6 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 flex-1"}," 📋 Copier le message ")):fe("",!0),p("button",{onClick:A,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):fe("",!0)}},SN={class:"text-center mb-6"},PN={class:"text-lg text-gray-300"},RN={class:"mb-6"},CN={class:"space-y-4"},kN=["disabled"],DN={key:0,class:"animate-spin"},VN={key:1},NN={class:"mb-6 text-center"},ON={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},MN={class:"text-red-300 text-sm"},LN={class:"text-center mb-6"},FN={class:"text-lg text-gray-300"},UN={class:"mb-6"},$N=["disabled"],jN={key:0,class:"animate-spin"},BN={key:1},qN={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},zN={class:"text-red-300 text-sm"},GN={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},KN={class:"text-green-300 text-sm"},HN={class:"flex justify-center"},QI={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=O(""),i=O(!1),o=O(""),a=O(!1),l=O(""),c=O(""),d=O(null);async function f(){if(s.value){i.value=!0,o.value="";try{const P=await Zf(t.seasonId);if(s.value===P){r("verified",{type:"season_pin"}),y();return}await Hm(t.player.id,s.value,t.seasonId)?(r("verified",{type:"player_password"}),y()):o.value="Mot de passe incorrect. Veuillez réessayer."}catch(P){pe.error("Erreur lors de la vérification",P),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function v(){i.value=!0,l.value="",c.value="";try{const P=await GI(t.player.id,t.seasonId);c.value=P.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(P){pe.error("Erreur lors de l'envoi de l'email",P),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function y(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return Yt(()=>t.show,P=>{P&&cn(()=>{d.value&&d.value.focus()})}),(P,A)=>{var R,j;return U(),$(At,null,[n.show?(U(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:y},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:A[2]||(A[2]=Ht(()=>{},["stop"]))},[p("div",SN,[A[6]||(A[6]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"🔐")],-1)),A[7]||(A[7]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),p("p",PN,ce((R=n.player)==null?void 0:R.name),1),A[8]||(A[8]=p("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),p("div",RN,[p("div",CN,[p("div",null,[A[9]||(A[9]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),yt(p("input",{"onUpdate:modelValue":A[0]||(A[0]=B=>s.value=B),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:Rn(f,["enter"]),ref_key:"passwordInput",ref:d},null,544),[[Ut,s.value]])])]),p("button",{onClick:f,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(U(),$("span",DN,"⏳")):(U(),$("span",VN,"🔓")),p("span",null,ce(i.value?"Vérification...":"Vérifier"),1)],8,kN)]),p("div",NN,[p("button",{onClick:A[1]||(A[1]=B=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(U(),$("div",ON,[p("div",MN,ce(o.value),1)])):fe("",!0),p("div",{class:"flex justify-center"},[p("button",{onClick:y,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):fe("",!0),a.value?(U(),$("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:A[5]||(A[5]=B=>a.value=!1)},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:A[4]||(A[4]=Ht(()=>{},["stop"]))},[p("div",LN,[A[10]||(A[10]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"📧")],-1)),A[11]||(A[11]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),p("p",FN,ce((j=n.player)==null?void 0:j.name),1)]),p("div",UN,[A[12]||(A[12]=p("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),p("button",{onClick:v,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(U(),$("span",jN,"⏳")):(U(),$("span",BN,"📧")),p("span",null,ce(i.value?"Envoi...":"Envoyer l'email"),1)],8,$N)]),l.value?(U(),$("div",qN,[p("div",zN,ce(l.value),1)])):fe("",!0),c.value?(U(),$("div",GN,[p("div",KN,ce(c.value),1)])):fe("",!0),p("div",HN,[p("button",{onClick:A[3]||(A[3]=B=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):fe("",!0)],64)}}},WN={class:"text-center mb-6"},QN={class:"text-lg text-gray-300"},JN={class:"mb-6"},YN={class:"flex items-center space-x-3"},XN={class:"text-2xl"},ZN={class:"font-semibold text-white"},eO={class:"text-sm text-gray-300"},tO={class:"mb-6"},nO={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-1"},rO={key:0,class:"mb-6"},sO={class:"flex items-center justify-center gap-3 mb-4 text-sm"},iO={key:0,class:"space-y-4"},oO=["disabled"],aO={key:0,class:"animate-spin"},lO={key:1},uO={key:0,class:"text-sm text-gray-300"},cO={key:1,class:"space-y-4"},dO={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},hO=["disabled"],fO={key:0,class:"animate-spin"},pO={key:1},mO={key:1,class:"mb-6"},gO={key:0,class:"space-y-4 mb-4"},vO=["disabled"],yO={key:0,class:"animate-spin"},_O={key:1},bO=["disabled"],wO={key:2,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},IO={class:"text-red-300 text-sm"},EO={key:3,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},TO={class:"text-green-300 text-sm"},xO={__name:"PlayerProtectionModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=O(!1),i=O(1),o=O(""),a=O(""),l=O(""),c=O(""),d=O(!1),f=O(""),v=O(""),y=O(!1),P=O(!1),A=O(""),R=O(!1),j=O(!1),B=_u(),F=Qe(()=>o.value&&o.value.includes("@")),G=Qe(()=>l.value&&c.value&&l.value===c.value&&l.value.length>=6);async function oe(){var D,w;if((D=t.player)!=null&&D.id&&(s.value=await eo(t.player.id,t.seasonId),!s.value)){o.value="";try{const He=await(await Xt(()=>Promise.resolve().then(()=>Id),void 0)).getPlayerProtectionData(t.player.id,t.seasonId);a.value=(He==null?void 0:He.email)||"";const We=!!(He!=null&&He.emailVerifiedAt);i.value=We?2:1;const Xe=((w=B.query)==null?void 0:w.verified)==="1";j.value=Xe&&We}catch{a.value="",i.value=1,j.value=!1}}}async function ie(){var D,w;if(F.value){d.value=!0,f.value="",v.value="";try{const He=await jI({playerId:t.player.id,email:o.value.trim(),seasonId:t.seasonId}),We=(D=B.params)==null?void 0:D.slug,Xe=`${He.url}${We?`&slug=${encodeURIComponent(We)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await Y2({toEmail:o.value,playerName:((w=t.player)==null?void 0:w.name)||"joueur",verifyUrl:Xe}),R.value=!0}catch(He){pe.error("Erreur envoi email de vérification protection",He),f.value=(He==null?void 0:He.message)||"Impossible d'envoyer l'email de vérification"}finally{d.value=!1}}}async function I(){try{const{clearEmailVerificationForProtection:D}=await Xt(()=>Promise.resolve().then(()=>Id),void 0);await D({playerId:t.player.id,seasonId:t.seasonId})}catch{}i.value=1,R.value=!1,j.value=!1,o.value="",l.value="",c.value=""}async function E(){if(G.value){d.value=!0,f.value="",v.value="";try{const D=a.value||o.value;if(!D)throw new Error("Adresse email manquante");await $I(t.player.id,D,l.value,t.seasonId),v.value="Protection activée avec succès !",s.value=!0,o.value="",a.value="",l.value="",c.value="",r("update");try{t.onboarding&&r("onboarding-finished")}catch{}}catch(D){pe.error("Erreur lors de l'activation de la protection",D),D.message&&D.message.includes("email")?f.value="Cette adresse email est déjà utilisée par un autre joueur.":f.value="Erreur lors de l'activation de la protection. Veuillez réessayer."}finally{d.value=!1}}}function x(){P.value=!0,A.value="",f.value=""}async function k(){if(A.value){d.value=!0,f.value="",v.value="";try{if(!await Hm(t.player.id,A.value,t.seasonId)){f.value="Mot de passe incorrect. Veuillez réessayer.";return}const w=await qI(t.player.id,t.seasonId);v.value="Protection désactivée avec succès !",s.value=!1,P.value=!1,A.value="",w.email&&(o.value=w.email),r("update")}catch(D){pe.error("Erreur lors de la désactivation de la protection",D),f.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{d.value=!1}}}function V(){r("close")}return Yt(()=>t.player,()=>{t.show&&t.player&&oe()},{immediate:!0}),Yt(()=>t.show,D=>{D&&t.player&&(o.value="",l.value="",c.value="",f.value="",v.value="",y.value=!1,P.value=!1,A.value="",i.value=1,R.value=!1,oe(),t.onboarding&&cn(()=>{}))}),(D,w)=>{var He;return n.show?(U(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:V},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:w[6]||(w[6]=Ht(()=>{},["stop"]))},[p("div",WN,[w[7]||(w[7]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"🔒")],-1)),w[8]||(w[8]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Protection du joueur",-1)),p("p",QN,ce((He=n.player)==null?void 0:He.name),1)]),p("div",JN,[p("div",{class:Hn(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[p("div",YN,[p("span",XN,ce(s.value?"🔒":"🔓"),1),p("div",null,[p("div",ZN,ce(s.value?"Protégé":"Non protégé"),1),p("div",eO,ce(s.value?"Modifications sécurisées":"Modifications libres"),1)])])],2)]),p("div",tO,[p("button",{onClick:w[0]||(w[0]=We=>y.value=!y.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[w[9]||(w[9]=p("h3",{class:"text-sm font-semibold text-blue-300"},"💡 Pourquoi protéger son joueur ?",-1)),p("span",{class:Hn(["text-blue-300 transition-transform duration-200",{"rotate-180":y.value}])},"▼",2)]),y.value?(U(),$("div",nO,w[10]||(w[10]=[ur('<div>• <span class="text-blue-300">Protection des disponibilités :</span> Seul vous pouvez modifier vos disponibilités</div><div>• <span class="text-blue-300">Protection du nom :</span> Seul vous pouvez changer votre nom de joueur</div><div>• <span class="text-blue-300">Email requis :</span> Permet de réinitialiser le mot de passe en cas d&#39;oubli et de recevoir des notifications quand des changements surviennent</div><div>• <span class="text-blue-300">Confort de saisie :</span> après authentification par mot de passe, votre ligne est automatiquement remontée en haut de la grille sur cet appareil, pour un accès plus rapide</div>',4)]))):fe("",!0)]),s.value?fe("",!0):(U(),$("div",rO,[w[18]||(w[18]=p("h3",{class:"text-lg font-semibold text-white mb-4"},"🔐 Activer la protection",-1)),p("div",sO,[p("div",{class:Hn(["px-3 py-1 rounded-full border",i.value===1?"bg-blue-500/20 border-blue-400 text-blue-200":"bg-green-500/20 border-green-400 text-green-200"])},"1. Email",2),w[11]||(w[11]=p("div",{class:"text-gray-400"},"→",-1)),p("div",{class:Hn(["px-3 py-1 rounded-full border",i.value===2?"bg-yellow-500/20 border-yellow-400 text-yellow-200":i.value>2?"bg-green-500/20 border-green-400 text-green-200":"bg-gray-500/20 border-gray-400 text-gray-200"])},"2. Mot de passe",2)]),i.value===1?(U(),$("div",iO,[p("div",null,[w[12]||(w[12]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),yt(p("input",{"onUpdate:modelValue":w[1]||(w[1]=We=>o.value=We),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Ut,o.value]])]),p("button",{onClick:ie,disabled:!F.value||d.value,class:"w-full px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[d.value?(U(),$("span",aO,"⏳")):(U(),$("span",lO,"✉️")),p("span",null,ce(d.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,oO),R.value?(U(),$("div",uO," Un email de vérification a été envoyé. Cliquez sur le lien reçu, puis revenez ici. ")):fe("",!0)])):i.value===2?(U(),$("div",cO,[j.value?(U(),$("div",dO,[w[13]||(w[13]=p("span",null,"✅",-1)),w[14]||(w[14]=p("span",null,"Adresse email vérifiée",-1)),p("button",{type:"button",onClick:I,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")])):fe("",!0),w[17]||(w[17]=p("div",{class:"text-sm text-gray-300"},"Définissez maintenant votre mot de passe.",-1)),p("div",null,[w[15]||(w[15]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),yt(p("input",{"onUpdate:modelValue":w[2]||(w[2]=We=>l.value=We),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[Ut,l.value]])]),p("div",null,[w[16]||(w[16]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),yt(p("input",{"onUpdate:modelValue":w[3]||(w[3]=We=>c.value=We),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[Ut,c.value]])]),p("button",{onClick:E,disabled:!G.value||d.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[d.value?(U(),$("span",fO,"⏳")):(U(),$("span",pO,"🔒")),p("span",null,ce(d.value?"Activation...":"Activer la protection"),1)],8,hO)])):fe("",!0)])),s.value?(U(),$("div",mO,[w[21]||(w[21]=p("h3",{class:"text-lg font-semibold text-white mb-4"},"🔓 Désactiver la protection",-1)),w[22]||(w[22]=p("p",{class:"text-sm text-gray-300 mb-4"}," Attention : désactiver la protection supprimera définitivement le mot de passe et l'email associés. ",-1)),P.value?(U(),$("div",gO,[p("div",null,[w[19]||(w[19]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe de confirmation",-1)),yt(p("input",{"onUpdate:modelValue":w[4]||(w[4]=We=>A.value=We),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe pour confirmer"},null,512),[[Ut,A.value]])]),p("button",{onClick:k,disabled:!A.value||d.value,class:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[d.value?(U(),$("span",yO,"⏳")):(U(),$("span",_O,"🔓")),p("span",null,ce(d.value?"Désactivation...":"Confirmer la désactivation"),1)],8,vO),p("button",{onClick:w[5]||(w[5]=We=>P.value=!1),class:"w-full px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])):fe("",!0),P.value?fe("",!0):(U(),$("button",{key:1,onClick:x,disabled:d.value,class:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},w[20]||(w[20]=[p("span",null,"🔓",-1),p("span",null,"Désactiver la protection",-1)]),8,bO))])):fe("",!0),f.value?(U(),$("div",wO,[p("div",IO,ce(f.value),1)])):fe("",!0),v.value?(U(),$("div",EO,[p("div",TO,ce(v.value),1)])):fe("",!0),p("div",{class:"flex justify-center"},[p("button",{onClick:V,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):fe("",!0)}}};const AO=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},SO={class:"relative text-center p-6 pb-4 border-b border-white/10"},PO={class:"text-2xl md:text-3xl font-bold text-white mb-1"},RO={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},CO={class:"grid grid-cols-3 gap-3 md:gap-4"},kO={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},DO={class:"text-xl md:text-2xl font-bold text-white"},VO={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},NO={class:"text-xl md:text-2xl font-bold text-white"},OO={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},MO={class:"text-xl md:text-2xl font-bold text-white"},LO={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},FO={key:0,class:"md:hidden mt-3 space-y-2"},UO={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},$O={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},jO={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},BO={class:"mb-6"},qO={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=O(!1),o=O(""),a=O(null),l=O(!1),c=O(!1),d=O(null),f=O(!1);function v(){s("close")}function y(){var ie;o.value=((ie=r.player)==null?void 0:ie.name)||"",i.value=!0,cn(()=>{a.value&&a.value.focus()})}function P(){i.value=!1,o.value=""}async function A(){var I,E;if(!o.value.trim())return;if(await eo((I=r.player)==null?void 0:I.id,r.seasonId)){fa((E=r.player)==null?void 0:E.id)?R():(d.value="update",c.value=!0);return}R()}function R(){var ie;s("update",{playerId:(ie=r.player)==null?void 0:ie.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function j(){var I,E;if(await eo((I=r.player)==null?void 0:I.id,r.seasonId)){fa((E=r.player)==null?void 0:E.id)?B():(d.value="delete",c.value=!0);return}B()}function B(){var ie;s("delete",(ie=r.player)==null?void 0:ie.id)}function F(){s("refresh")}function G(ie){d.value==="update"?R():d.value==="delete"&&B(),d.value=null}Yt(()=>r.show,ie=>{ie||(i.value=!1,o.value="",d.value=null,l.value=!1)}),e({openProtection(){l.value=!0}});const oe=O({position:null});return Yt(()=>r.show,ie=>{ie&&r.onboardingStep===4?cn(()=>{const I=document.querySelectorAll("button");let E=null;if(I.forEach(x=>{!E&&x.textContent&&x.textContent.includes("Protection")&&(E=x)}),E){const x=E.getBoundingClientRect();oe.value.position={x:Math.round(x.right+8),y:Math.round(x.top+window.scrollY-4)}}}):ie||(oe.value.position=null)}),(ie,I)=>{var E;return U(),$(At,null,[n.show?(U(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:v},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:I[5]||(I[5]=Ht(()=>{},["stop"]))},[p("div",SO,[p("button",{onClick:v,class:"absolute right-3 top-3 text-white/80 hover:text-white"},"✖️"),I[10]||(I[10]=p("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[p("span",{class:"text-2xl md:text-3xl"},"👤")],-1)),p("h2",PO,ce((E=n.player)==null?void 0:E.name),1)]),p("div",RO,[p("div",null,[p("div",CO,[p("div",kO,[p("div",DO,ce(r.stats.availability),1),I[11]||(I[11]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),p("div",VO,[p("div",NO,ce(r.stats.selection),1),I[12]||(I[12]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),p("div",OO,[p("div",MO,ce(r.stats.ratio)+"%",1),I[13]||(I[13]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Taux",-1))])])]),p("div",LO,[p("button",{onClick:y,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},I[14]||(I[14]=[p("span",null,"✏️",-1),p("span",null,"Modifier",-1)])),p("button",{onClick:I[0]||(I[0]=x=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},I[15]||(I[15]=[p("span",null,"🔒",-1),p("span",null,"Protection",-1)])),p("button",{onClick:j,class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},I[16]||(I[16]=[p("span",null,"🗑️",-1),p("span",null,"Supprimer",-1)])),p("button",{onClick:v,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")]),f.value?(U(),$("div",FO,[p("button",{onClick:I[1]||(I[1]=x=>{y(),f.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"}," ✏️ Modifier "),p("button",{onClick:I[2]||(I[2]=x=>{j(),f.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"}," 🗑️ Supprimer ")])):fe("",!0)]),p("div",UO,[p("button",{onClick:I[3]||(I[3]=x=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"}," 🔒 Protection "),p("button",{onClick:v,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer "),p("button",{onClick:I[4]||(I[4]=x=>f.value=!f.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ ")])])])):fe("",!0),i.value?(U(),$("div",$O,[p("div",jO,[I[18]||(I[18]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier le joueur",-1)),p("div",BO,[I[17]||(I[17]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),yt(p("input",{"onUpdate:modelValue":I[6]||(I[6]=x=>o.value=x),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Rn(P,["esc"]),Rn(A,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[Ut,o.value]])]),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:P,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:A,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):fe("",!0),wt(xO,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:I[7]||(I[7]=x=>l.value=!1),onUpdate:F,onOnboardingFinished:I[8]||(I[8]=x=>ie.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),wt(QI,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:I[9]||(I[9]=x=>c.value=!1),onVerified:G},null,8,["show","player","seasonId"])],64)}}},zO=AO(qO,[["__scopeId","data-v-a6671485"]]),GO={class:"relative p-6 pb-4 border-b border-white/10"},KO={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},HO={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(U(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=Ht(()=>{},["stop"]))},[p("div",GO,[p("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=p("div",{class:"flex items-center gap-3"},[p("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),p("div",null,[p("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),p("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=ur('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),p("div",KO,[p("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):fe("",!0)}},WO={class:"relative text-center p-6 pb-4 border-b border-white/10"},QO={class:"text-2xl md:text-3xl font-bold text-white mb-1"},JO={class:"text-sm md:text-base text-purple-300"},YO={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},XO={class:"mb-3"},ZO={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},eM={key:0,class:"flex items-center justify-between gap-2"},tM=["title"],nM={key:0,class:"text-purple-400 mr-2"},rM={key:1,class:"text-green-400 mr-2"},sM={key:2,class:"text-red-400 mr-2"},iM={key:3,class:"text-gray-400 mr-2"},oM=["onClick"],aM={key:1,class:"flex items-center justify-center"},lM=["onChange"],uM=["value"],cM=["onClick"],dM={key:0,class:"mb-3"},hM={class:"grid grid-cols-3 gap-2 md:gap-3 mb-3"},fM={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},pM={class:"text-cyan-300 text-lg md:text-xl font-semibold"},mM={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},gM={class:"text-green-400 text-lg md:text-xl font-semibold"},vM={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},yM={class:"text-purple-400 text-lg md:text-xl font-semibold"},_M={key:1,class:"mb-3"},bM={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},wM={class:"flex-1"},IM={class:"text-blue-300 text-sm font-medium"},EM={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},TM=["disabled","title"],xM=["disabled"],AM=["disabled"],SM={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-email-notifications","update-selection"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=O(!1),o=O("Copier le message"),a=O(!1),l=O(!1),c=O(""),d=O(!1),f=O(!1),v=Qe(()=>{var H;return((H=r.event)==null?void 0:H.playerCount)||6}),y=O([]),P=O(null),A=Qe(()=>Array.from({length:v.value},(Y,Ve)=>{var Ze;return((Ze=r.currentSelection)==null?void 0:Ze[Ve])||null})),R=Qe(()=>JSON.stringify(y.value)!==JSON.stringify(A.value)),j=Qe(()=>(r.players||[]).map(H=>H.name).filter(H=>{var Y;return((Y=r.playerAvailability)==null?void 0:Y[H])===!0}).sort((H,Y)=>H.localeCompare(Y,"fr",{sensitivity:"base"})));function B(H){const Y=new Set(y.value.filter(Boolean)),Ve=y.value[H];return Ve&&Y.delete(Ve),j.value.filter(Ze=>!Y.has(Ze))}function F(H){P.value=H}function G(){P.value=null}function oe(H,Y){var Ze;const Ve=((Ze=H==null?void 0:H.target)==null?void 0:Ze.value)||"";Ve&&(y.value[Y]=Ve),P.value=null}function ie(H){y.value[H]=null}Qe(()=>(B(-1).length<v.value,""));const I=Qe(()=>r.currentSelection&&r.currentSelection.length>0),E=Qe(()=>{var Ze;if(!I.value)return!1;const H=r.currentSelection.some(nt=>!Xe(nt)),Y=((Ze=r.event)==null?void 0:Ze.playerCount)||6,Ve=r.availableCount<Y;return H||Ve});Qe(()=>{var Ve;if(!E.value)return"";const H=r.currentSelection.filter(Ze=>!Xe(Ze)),Y=((Ve=r.event)==null?void 0:Ve.playerCount)||6;return H.length>0?H.length===1?`${H[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${H.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<Y?`Seulement ${r.availableCount} joueurs disponibles pour ${Y} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),Qe(()=>{if(!r.event||!I.value)return"";const H=x(r.event.date),Y=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${H} : ${Y}`}),Yt(()=>r.show,H=>{if(H){i.value=!1,o.value="Copier le message",l.value=!1,c.value="",d.value=!1,a.value=!1;const Y=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Ve=v.value;y.value=Array.from({length:Ve},(Ze,nt)=>Y[nt]||null),P.value=null}}),Yt([v,()=>r.currentSelection,()=>{var H;return(H=r.event)==null?void 0:H.id}],()=>{if(!r.show)return;const H=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Y=v.value,Ve=Array.from({length:Y},(Ze,nt)=>H[nt]||y.value[nt]||null);y.value=Ve.slice(0,Y)});function x(H){var Ve;return H?(typeof H=="string"?new Date(H):((Ve=H.toDate)==null?void 0:Ve.call(H))||H).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function k(){s("selection")}function V(){s("perfect")}function D(){var Y;if(!((Y=r.event)!=null&&Y.id))return;const H=y.value.filter(Boolean);s("update-selection",{eventId:r.event.id,players:H})}function w(){s("close")}function He(){a.value=!0}function We(){f.value=!0}function Xe(H){return r.playerAvailability[H]===!0}function $e(H){return r.playerAvailability[H]===!1}function je(H){return r.currentSelection.includes(H)&&Xe(H)}function ke(H=!1,Y=!1){if(d.value=H,H){const Ve=x(r.event.date),Ze=r.currentSelection.join(", ");Y?c.value=`Sélection mise à jour pour ${r.event.title} du ${Ve} : ${Ze}`:c.value=`Nouvelle sélection pour ${r.event.title} du ${Ve} : ${Ze}`}else c.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function ee(){l.value=!1}e({showSuccess:ke});function De(H){s("send-email-notifications",H),a.value=!1}return(H,Y)=>{var Ve,Ze,nt;return U(),$(At,null,[n.show?(U(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:w},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:Y[1]||(Y[1]=Ht(()=>{},["stop"]))},[p("div",WO,[p("button",{onClick:w,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),Y[5]||(Y[5]=p("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-3xl"},"🎭")],-1)),p("h2",QO,"Sélection pour "+ce((Ve=n.event)==null?void 0:Ve.title),1),p("p",JO,ce(x((Ze=n.event)==null?void 0:Ze.date)),1),p("div",{class:"mt-3"},[p("button",{onClick:We,class:"inline-flex items-center gap-2 text-sm text-blue-300 hover:text-blue-200"},Y[4]||(Y[4]=[p("span",null,"❓",-1),Vr(),p("span",null,"Comment ça marche ?",-1)]))])]),p("div",YO,[p("div",XO,[Y[8]||(Y[8]=p("h3",{class:"text-base md:text-lg font-semibold text-white mb-2"},"Joueurs sélectionnés",-1)),p("div",ZO,[(U(!0),$(At,null,cr(y.value,(K,ye)=>(U(),$("div",{key:"sel-slot-"+ye,class:Hn(["relative p-3 rounded-lg border text-center transition-colors",K?["bg-gradient-to-r",$e(K)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":Xe(K)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[K?(U(),$("div",eM,[p("div",{class:"flex-1 text-white font-medium truncate",title:K},[je(K)?(U(),$("span",nM,"🎭")):Xe(K)?(U(),$("span",rM,"✅")):$e(K)?(U(),$("span",sM,"❌")):(U(),$("span",iM,"–")),Vr(" "+ce(K),1)],8,tM),p("button",{onClick:le=>ie(ye),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer ce joueur"}," × ",8,oM)])):(U(),$("div",aM,[P.value===ye?(U(),$("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:le=>oe(le,ye),onBlur:Y[0]||(Y[0]=le=>G())},[Y[6]||(Y[6]=p("option",{value:""},"— Choisir —",-1)),(U(!0),$(At,null,cr(B(ye),le=>(U(),$("option",{key:le,value:le},ce(le),9,uM))),128))],40,lM)):(U(),$("button",{key:1,onClick:le=>F(ye),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter un joueur"},Y[7]||(Y[7]=[p("span",{class:"text-lg"},"＋",-1),p("span",{class:"text-sm"},"Ajouter",-1)]),8,cM))]))],2))),128))])]),E.value?(U(),$("div",dM,Y[9]||(Y[9]=[p("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[p("div",{class:"text-yellow-400"},"⚠️"),p("div",{class:"text-yellow-200 text-sm"},"Sélection incomplète. Vérifie ci-dessous.")],-1)]))):fe("",!0),p("div",hM,[p("div",fM,[p("div",pM,ce(((nt=n.event)==null?void 0:nt.playerCount)||6),1),Y[10]||(Y[10]=p("div",{class:"text-xs md:text-sm text-gray-400"},"À sélectionner",-1))]),p("div",mM,[p("div",gM,ce(n.availableCount),1),Y[11]||(Y[11]=p("div",{class:"text-xs md:text-sm text-gray-400"},"Disponibles",-1))]),p("div",vM,[p("div",yM,ce(n.selectedCount),1),Y[12]||(Y[12]=p("div",{class:"text-xs md:text-sm text-gray-400"},"Sélectionnés",-1))])]),l.value?(U(),$("div",_M,[p("div",bM,[Y[14]||(Y[14]=p("div",{class:"text-blue-400 text-xl"},"✨",-1)),p("div",wM,[p("p",IM,ce(c.value),1)]),p("button",{onClick:ee,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},Y[13]||(Y[13]=[p("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):fe("",!0)]),p("div",EM,[p("button",{onClick:k,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":I.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},Y[15]||(Y[15]=[Vr(" ✨ "),p("span",{class:"hidden sm:inline"},"Sélection Auto",-1),p("span",{class:"sm:hidden"},"Auto",-1)]),8,TM),p("button",{onClick:D,disabled:!R.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",title:"Enregistrer cette composition manuelle"},Y[16]||(Y[16]=[Vr(" 💾 "),p("span",{class:"hidden sm:inline"},"Enregistrer",-1),p("span",{class:"sm:hidden"},"Save",-1)]),8,xM),I.value?(U(),$("button",{key:0,onClick:V,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap"},Y[17]||(Y[17]=[Vr(" 👍 "),p("span",{class:"hidden sm:inline"},"Parfait",-1)]))):fe("",!0),p("button",{onClick:He,disabled:!I.value,class:"h-12 px-3 md:px-4 bg-gray-700 text-white rounded-lg flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},Y[18]||(Y[18]=[Vr(" 📣 "),p("span",{class:"hidden sm:inline"},"Annoncer",-1)]),8,AM)])])])):fe("",!0),wt(WI,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:Y[2]||(Y[2]=K=>a.value=!1),onSendEmailNotifications:De},null,8,["show","event","season-id","season-slug","players","selected-players"]),wt(HO,{show:f.value,onClose:Y[3]||(Y[3]=K=>f.value=!1)},null,8,["show"])],64)}}},PM={class:"flex items-center justify-center gap-2"},RM=["title"],CM=["title"],kM=["title"],DM=["title"],VM=["title"],jy={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=O(!1),i=Qe(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=Qe(()=>t.isSelected?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){r("toggle",t.playerName,t.eventId)}return(l,c)=>(U(),$("div",{class:"flex items-center justify-center cursor-pointer hover:bg-white/10 transition-all duration-200 min-h-20 p-3 md:p-5",onClick:a,onMouseenter:c[0]||(c[0]=d=>s.value=!0),onMouseleave:c[1]||(c[1]=d=>s.value=!1)},[p("div",PM,[i.value&&s.value?(U(),$("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},ce(n.chancePercent)+"% ",9,RM)):(U(),$(At,{key:1},[n.isSelected?(U(),$("span",{key:0,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," 🎭 ",8,CM)):n.isAvailable===!0?(U(),$("span",{key:1,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," ✅ ",8,kM)):n.isAvailable===!1?(U(),$("span",{key:2,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," ❌ ",8,DM)):(U(),$("span",{key:3,class:"text-gray-500 hover:text-white transition-colors duration-200 text-xl",title:o.value}," – ",8,VM))],64))])],32))}},NM={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},OM={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},MM={class:"text-2xl md:text-3xl font-bold text-white mb-3"},LM={class:"text-gray-300 mb-6"},FM={class:"flex flex-col items-stretch justify-center gap-3"},UM=["value"],$M={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=Qe(()=>`${s}/season/${t.seasonSlug}`),o=O(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=Qe(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=Qe(()=>a.value>0),c=O(l.value);Yt(a,R=>{c.value=R>0});const d=Qe(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=Qe(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function v(){c.value=!1,r("create-event")}function y(){c.value=!1,r("add-player")}function P(){var R;try{(R=navigator.clipboard)==null||R.writeText(i.value)}catch{}r("copy-link")}async function A(){try{if(t.seasonId){const{db:R}=await Xt(()=>Promise.resolve().then(()=>ui),void 0),{doc:j,updateDoc:B}=await Xt(()=>import("./index.esm-778f7358.js"),[]);await B(j(R,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(R,j)=>l.value&&c.value?(U(),$("div",NM,[p("div",OM,[j[1]||(j[1]=p("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[p("span",{class:"text-3xl"},"🎬")],-1)),p("h2",MM,ce(d.value),1),p("p",LM,ce(f.value),1),p("div",FM,[a.value===1?(U(),$("button",{key:0,onClick:v,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(U(),$("button",{key:1,onClick:y,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(U(),$(At,{key:2},[p("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:j[0]||(j[0]=B=>B.target.select())},null,40,UM),p("div",{class:"flex gap-3 justify-center"},[p("button",{onClick:P,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),p("button",{onClick:A,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):fe("",!0)])])])):fe("",!0)}};const jM={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},BM={ref:"pageHeaderRef",class:"sticky top-0 z-[140] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},qM={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},zM={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},GM={class:"hidden md:flex items-center gap-2"},KM=["title"],HM={class:"text-2xl"},WM={key:0,class:"absolute right-0 mt-2 w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[200] overflow-hidden"},QM={class:"text-sm"},JM={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},YM={class:"flex items-stretch relative"},XM={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},ZM={class:"flex-1 overflow-hidden"},eL=["data-event-id","onClick"],tL=["title"],nL=["title"],rL={key:0,class:"mt-1 text-xs text-gray-400"},sL=["title","onClick"],iL=["title","onClick"],oL={key:0,class:"pointer-events-none"},aL={class:"flex items-center justify-between"},lL={key:1,class:"pointer-events-none"},uL={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},cL={class:"flex items-center justify-between"},dL={key:2,class:"pointer-events-none"},hL={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},fL={class:"flex items-center justify-between"},pL={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},mL=["data-player-id"],gL={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},vL={class:"px-4 md:px-5 font-bold text-xl md:text-2xl whitespace-pre-wrap flex items-center"},yL={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},_L=["onClick","title"],bL=["data-event-id"],wL={class:"border-t border-white/10"},IL={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},EL={class:"px-4 md:px-5 flex items-center"},TL=["data-event-id"],xL={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},AL={class:"text-center"},SL={class:"text-white text-lg"},PL={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},RL={class:"text-white/60 text-xs mt-2"},CL={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},kL={class:"flex items-center space-x-2"},DL={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},VL={class:"flex items-center space-x-2"},NL={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},OL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},ML={class:"mb-6"},LL={class:"mb-6"},FL={class:"mb-6"},UL={class:"mb-6 flex items-center gap-3"},$L={class:"mb-6"},jL={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},BL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},qL={class:"mb-6"},zL={class:"flex justify-end space-x-3"},GL={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},KL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},HL={class:"flex justify-end space-x-3"},WL={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},QL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},JL={class:"flex justify-end space-x-3"},YL={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},XL={class:"relative text-center p-6 pb-4 border-b border-white/10"},ZL={class:"text-2xl md:text-3xl font-bold text-white mb-1"},eF={class:"text-sm md:text-base text-purple-300"},tF={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},nF={key:0,class:"mb-4 md:mb-6"},rF={class:"text-gray-300 bg-gray-800/50 p-4 rounded-lg border border-gray-600/50"},sF={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},iF={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},oF={class:"text-xl md:text-2xl font-bold text-white"},aF={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},lF={class:"text-xl md:text-2xl font-bold text-white"},uF={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},cF={class:"text-xl md:text-2xl font-bold text-white"},dF={key:1,class:"mb-4 md:mb-6"},hF={class:"bg-gray-800 border border-gray-600 rounded-lg overflow-hidden"},fF={class:"col-span-4 p-3 flex items-center"},pF={class:"font-medium text-white"},mF={key:0,class:"text-yellow-400 ml-2 text-lg",title:"Joueur protégé"},gF={class:"col-span-8 p-0"},vF={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},yF=["disabled","title"],_F=["title"],bF={key:2,class:"md:hidden mt-3 space-y-2"},wF=["disabled","title"],IF={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},EF={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},TF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},xF={class:"mb-6"},AF={class:"mb-6"},SF={class:"mb-6"},PF={class:"mb-6 flex items-center gap-3"},RF={class:"mb-6"},CF={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},kF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},DF={class:"mb-6"},VF={class:"space-y-4"},NF=["disabled"],OF={key:0,class:"animate-spin"},MF={key:1},LF={class:"mb-6 text-center"},FF={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},UF={class:"text-red-300 text-sm"},$F={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},jF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},BF={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},qF={class:"space-y-4"},zF={class:"mt-2 text-center"},GF={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},KF={class:"text-red-300 text-sm"},HF={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},WF=["disabled"],QF={key:0,class:"animate-spin"},JF={key:1},YF={class:"mb-6"},XF=["disabled"],ZF={key:0,class:"animate-spin"},e4={key:1},t4={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},n4={class:"text-red-300 text-sm"},r4={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},s4={class:"text-green-300 text-sm"},i4={class:"flex justify-center"},o4={class:"mb-6"},a4=["disabled"],l4={key:0,class:"animate-spin"},u4={key:1},c4={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},d4={class:"text-red-300 text-sm"},h4={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},f4={class:"text-green-300 text-sm"},p4={class:"flex justify-center"},m4={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},g4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},v4={class:"flex gap-3"},By={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=yu(),r=_u(),s=e.slug,i=O(""),o=O(""),a=O({}),l=O(!1),c=O(null),d=O(null),f=O(""),v=O(""),y=O(6),P=O(!1),A=O(""),R=O(null),j=O(null),B=O(null),F=O({position:null,side:null}),G=O({position:null}),oe=O({position:null}),ie=O(!1),I=O(null),E=O(!1),x=O(null),k=O(null),V=O(!1),D=O(null),w=O(""),He=O(!1),We=O(null),Xe=O(""),$e=O(""),je=O(!1),ke=O(null),ee=O(!1),De=O(null),H=O(""),Y=O(""),Ve=O(!1),Ze=O(null),nt=O(!1),K=O(!1),ye=O(""),le=O(""),Ae=O(!1),Ye=O(!1),ht=O(""),T=O(""),S=O(!1),N=O(null),X=O(""),Q=O(!1),Z=O(!1),ge=O(!1),ue=O(null),ae=O(null),se=O(null),Ee=O(0);function _e(){try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||ze.value.length===0)return;const _=localStorage.getItem(`playerTourCompleted:${o.value}`),m=localStorage.getItem(`startPlayerTour:${o.value}`);!_&&m&&(Ee.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`),cn(()=>{const C=document.querySelector('button[data-onboarding="add-player"]');if(C){C.scrollIntoView({behavior:"smooth",block:"end"});const J=C.getBoundingClientRect(),re=document.getElementById("coachmark-add"),be=280,he=100,Oe=(re==null?void 0:re.offsetWidth)||be,Ge=(re==null?void 0:re.offsetHeight)||he,ot=Math.round(J.right+12);if(ot+Oe<=window.innerWidth-12){const ft=J.top+J.height/2-Ge/2,Vt=-14,Nt=12,ct=window.innerHeight-Ge-12,Zn=Math.max(Nt,Math.min(Math.round(ft+Vt),ct));F.value={position:{x:ot,y:Zn},side:"right"}}else{const ft=Math.round(J.left+J.width/2-Oe/2),Vt=Math.round(J.top-Ge-8),Nt=8,ct=window.innerWidth-Oe-8;F.value={position:{x:Math.max(Nt,Math.min(ft,ct)),y:Vt},side:null}}}}))}catch{}}const Te=O(!1),Pe=O(null),Ne=O(null),qe=O(!1),tt=O(null),Gt=O(!1),Ft=O(null),fn=O(!1);Or(()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}});function Jt(){cn(()=>{Ja()})}const xn=O(new Set),sr=O(!0),Pt=O(0),an=O("Préparation de la grille"),Xn=O(e.eventId||null),bo=O(!1),Ai=O(null);Yt(()=>e.eventId,_=>{if(_)if(Xn.value=_,ze.value.length>0)un(_);else{const m=Yt(ze,C=>{C.length>0&&(un(_),m())},{immediate:!0})}});const wo=Qe(()=>et.value.map(_=>({..._,isProtected:xn.value.has(_.id),email:null}))),Si=Qe(()=>Xn.value?zn.value.findIndex(_=>_.id===Xn.value):-1);Qe(()=>{if(!Xn.value||Si.value===-1)return!1;if(window.innerWidth<=768){const _=document.querySelector(`[data-event-id="${Xn.value}"]`);if(_){const m=_.getBoundingClientRect();return m.left>=0&&m.right<=window.innerWidth}}return!0});const qn=O(null),Io=O(!1),xr=O(!1),Eo=O(0),To=O(null),An=O(null);function ir(){const _=qn.value;if(!_)return;const{scrollLeft:m,scrollWidth:C,clientWidth:J}=_;Io.value=m>2,xr.value=m<C-J-2}function Ja(){var _;try{ir(),Eo.value=((_=qn.value)==null?void 0:_.scrollLeft)||0}catch{}}function pn(_){const m=qn.value;if(!m)return;let C=0;const J=m.querySelector("tbody tr td[data-event-id]");if(J)C=J.getBoundingClientRect().width;else if(An!=null&&An.value){const be=An.value.querySelector(".col-event");be&&(C=be.getBoundingClientRect().width)}(!C||!isFinite(C))&&(C=m.clientWidth*.6);const re=m.scrollLeft+_*C;m.scrollTo({left:re,behavior:"smooth"})}const Ds=O(null);O(0);const mr=O(!1),Ar=O(!1),Vs=O(0);function Gu(_,m){m&&typeof m.preventDefault=="function"&&m.preventDefault(),vr(),pn(_)}function gr(_,m){if(m&&typeof m.preventDefault=="function"&&m.preventDefault(),mr.value)return;mr.value=!0,Vs.value=_,Ar.value=!1;const C=qn.value;if(!C)return;let J=0;const re=C.querySelector("tbody tr td[data-event-id]");if(re)J=re.getBoundingClientRect().width;else if(An!=null&&An.value){const Ge=An.value.querySelector(".col-event");Ge&&(J=Ge.getBoundingClientRect().width)}(!J||!isFinite(J))&&(J=C.clientWidth*.6);const be=J/6,he=120,Oe=()=>{if(!mr.value||Vs.value===0)return;Ar.value||(Ar.value=!0);const Ge=C.scrollLeft+Vs.value*be;C.scrollTo({left:Ge,behavior:"auto"}),Ds.value=window.setTimeout(Oe,he)};Ds.value=window.setTimeout(Oe,250)}function vr(_){_&&typeof _.preventDefault=="function"&&_.preventDefault();const m=mr.value,C=Ar.value;if(mr.value=!1,Ds.value&&(clearTimeout(Ds.value),Ds.value=null),_&&typeof _.type=="string"&&_.type.startsWith("touch")&&!C){const J=Vs.value||0;J!==0&&pn(J),Vs.value=0;return}Vs.value=0,m&&C&&wh()}function wh(){const _=qn.value;if(!_)return;let m=0;const C=_.querySelector("tbody tr td[data-event-id]");if(C)m=C.getBoundingClientRect().width;else if(An!=null&&An.value){const he=An.value.querySelector(".col-event");he&&(m=he.getBoundingClientRect().width)}if(!m||!isFinite(m)||m<=0)return;const J=_.scrollLeft,be=Math.round(J/m)*m;_.scrollTo({left:be,behavior:"smooth"})}function xo(_){R.value=_;const m=document.querySelector(`[data-player-id="${_}"]`);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),Le.value=!0,bt.value="Nouveau joueur ajouté !",setTimeout(()=>{Le.value=!1},3e3)}function Ku(){if(Ee.value!==1)return;const _=document.querySelector('button[data-onboarding="add-player"]');if(!_)return;const m=_.getBoundingClientRect(),C=document.getElementById("coachmark-add"),J=280,re=100,be=C!=null&&C.offsetWidth&&C.offsetWidth>0?C.offsetWidth:J,he=C!=null&&C.offsetHeight&&C.offsetHeight>0?C.offsetHeight:re,Oe=Math.round(m.right+12);if(Oe+be<=window.innerWidth-12){const ot=m.top+m.height/2-he/2,ft=Ao(ot+-14,he);F.value={position:{x:Oe,y:ft},side:"right"}}else{const ot=Math.round(m.left+m.width/2-be/2),Tt=Ao(m.top-he-8,he),ft=8,Vt=window.innerWidth-be-8;F.value={position:{x:Math.max(ft,Math.min(ot,Vt)),y:Tt},side:null}}}function Ao(_,m){const C=pageHeaderRef==null?void 0:pageHeaderRef.value,J=C?Math.max(0,Math.round(C.getBoundingClientRect().height||0)):0,re=Math.max(12,J+8),be=window.innerHeight-m-12;return Math.max(re,Math.min(Math.round(_),be))}const yr=O(!1),_r=O(null);function Hu(){yr.value=!yr.value}function So(){yr.value=!1}function Po(_){if(!yr.value)return;const m=_r.value;m&&!m.contains(_.target)&&(yr.value=!1)}Or(()=>{document.addEventListener("click",Po)}),kl(()=>{document.removeEventListener("click",Po)});function Ns(){var _;Ee.value===1&&((_=F.value)!=null&&_.position)&&Ku()}Or(()=>{window.addEventListener("scroll",Ns,{passive:!0}),window.addEventListener("resize",Ns)}),kl(()=>{window.removeEventListener("scroll",Ns),window.removeEventListener("resize",Ns)});function Ya(){var _,m;try{o.value&&(localStorage.removeItem(`playerTourCompleted:${o.value}`),localStorage.setItem(`startPlayerTour:${o.value}`,"1"))}catch{}j.value=j.value||((_=et.value[0])==null?void 0:_.id)||null,B.value=((m=zn.value[0])==null?void 0:m.id)||null,F.value.position=null,G.value.position=null,oe.value.position=null,Ee.value=1,cn(()=>{const C=document.querySelector('button[data-onboarding="add-player"]');C&&(C.scrollIntoView({behavior:"smooth",block:"end"}),requestAnimationFrame(()=>{const J=C.getBoundingClientRect(),re=document.getElementById("coachmark-add"),be=280,he=100,Oe=(re==null?void 0:re.offsetWidth)||be,Ge=(re==null?void 0:re.offsetHeight)||he,ot=Math.round(J.right+12);if(ot+Oe<=window.innerWidth-12){const ft=J.top+J.height/2-Ge/2,Vt=-14,Nt=12,ct=window.innerHeight-Ge-12,Zn=Math.max(Nt,Math.min(Math.round(ft+Vt),ct));F.value={position:{x:ot,y:Zn},side:"right"}}else{const ft=Math.round(J.left+J.width/2-Oe/2),Vt=Math.round(J.top-Ge-8),Nt=8,ct=window.innerWidth-Oe-8;F.value={position:{x:Math.max(Nt,Math.min(ft,ct)),y:Vt},side:null}}}))})}function Pi(_){return xn.value.has(_)}async function Xa(){if(o.value)try{const _=await rp(o.value),m=new Set;_.forEach(C=>{C.isProtected&&m.add(C.playerId||C.id)}),xn.value=m}catch{const m=new Set;for(const C of et.value)await eo(C.id,o.value)&&m.add(C.id);xn.value=m}}const Le=O(!1),bt=O(""),Gr=O(!1),Kr=O("");function Hr(){try{const _=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(_),Le.value=!0,bt.value="Lien copié dans le presse-papiers",setTimeout(()=>{Le.value=!1},2500)}catch{Gr.value=!0,Kr.value="Impossible de copier le lien",setTimeout(()=>{Gr.value=!1},2500)}}async function Ro(_){await $s({type:"deleteEvent",data:{eventId:_}})}async function Ih(_=null){const m=_||c.value;if(console.debug("deleteEventConfirmed"),!m){console.error("Aucun événement à supprimer");return}try{await W2(m,o.value),ze.value=ze.value.filter(C=>C.id!==m),await Promise.all([My(o.value),Ho(et.value,ze.value,o.value),Wo(o.value)]).then(([C,J,re])=>{ze.value=C,Kt.value=J,Me.value=re}),l.value=!1,c.value=null,Le.value=!0,bt.value="Événement supprimé avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function Wu(){l.value=!1,c.value=null}async function Co(){if(!d.value||!f.value.trim()||!v.value)return;const _=parseInt(y.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const m={title:f.value.trim(),date:v.value,description:X.value.trim()||"",playerCount:_,archived:!!Q.value};await Uy(d.value,m,o.value),!m.archived&&et.value.length>0&&xn.value.size>0&&(Ft.value={id:d.value,...m},Gt.value=!0),await Promise.all([My(o.value),Ho(et.value,ze.value,o.value),Wo(o.value)]).then(([C,J,re])=>{ze.value=C,Kt.value=J,Me.value=re}),d.value=null,f.value="",v.value="",X.value="",y.value=6,Q.value=!1,Le.value=!0,bt.value="Événement mis à jour avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function Qu(){if(A.value.trim())try{const _=A.value.trim(),m=await HI(_,o.value);await Promise.all([uf(o.value),Ho(et.value,ze.value,o.value),Wo(o.value)]).then(([C,J,re])=>{et.value=C,Kt.value=J,Me.value=re,Xa();const be=et.value.find(Oe=>Oe.id===m);xo(m),j.value=m,B.value=zn.value&&zn.value[0]&&zn.value[0].id?zn.value[0].id:null;try{o.value&&localStorage.setItem(`lastAddedPlayerId:${o.value}`,m)}catch{}try{typeof Ee<"u"&&(Ee.value=2)}catch{}const he=document.querySelector(`[data-player-id="${m}"]`);he&&he.scrollIntoView({behavior:"smooth",block:"center"}),cn(()=>{const Oe=`[data-player-id="${j.value}"] td[data-event-id="${B.value}"]`,Ge=document.querySelector(Oe);if(Ge){const ot=Ge.getBoundingClientRect();G.value.position={x:Math.round(ot.left),y:Math.round(ot.top+window.scrollY-48)}}}),Le.value=!0,bt.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Le.value=!1},3e3),setTimeout(()=>{Le.value=!1,bt.value=""},5e3)}),P.value=!1,A.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function Wr(){d.value=null,f.value="",v.value="",X.value="",y.value=6}O(null);const Os=O(!1),Qr=O(""),Jr=O(""),Ri=O(""),Ci=O(6),ki=O(!1);async function Ju(){if(!Qr.value.trim()||!Jr.value){alert("Veuillez remplir le titre et la date de l'événement");return}const _=parseInt(Ci.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const m={title:Qr.value.trim(),date:Jr.value,description:Ri.value.trim()||"",playerCount:_,archived:!!ki.value};await Eh(m)}async function Eh(_){try{const m=await Q2(_,o.value);ze.value=[...ze.value,{id:m,..._}];const C={};for(const J of et.value)C[J.name]=Kt.value[J.name]||{},C[J.name][m]=null,await Ly(J.name,C[J.name],o.value);Qr.value="",Jr.value="",Ri.value="",Ci.value=6,ki.value=!1,Os.value=!1,await Promise.resolve(),Le.value=!0,bt.value="Événement créé avec succès !",!_.archived&&et.value.length>0&&xn.value.size>0&&(Ft.value={id:m,..._},Gt.value=!0),setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function Yr(){Qr.value="",Jr.value="",Ri.value="",Ci.value=6,Os.value=!1}async function or(){await $s({type:"addEvent",data:{}})}const ze=O([]),et=O([]),Kt=O({}),Me=O({}),ko=O({}),Xr=O({});Yt([()=>ze.value.length,()=>et.value.length,sr],()=>{sr.value||cn(()=>{Ja()})}),Yt([()=>et.value.length,()=>ze.value.length,o],()=>{_e()}),Or(async()=>{var be;KI("firebase"),await G2();const _=ih(rt(we,"seasons"),Im("slug","==",e.slug)),m=await Ct(_);if(m.empty){t.push("/");return}else{const he=m.docs[0];o.value=he.id;const Oe=he.data();i.value=Oe.name,a.value=Oe,document.title=`Saison : ${i.value}`}if(o.value){an.value="Chargement des événements de la saison",Pt.value=20;const he=await Ct(rt(we,"seasons",o.value,"events"));ze.value=he.docs.map(ct=>({id:ct.id,...ct.data(),playerCount:ct.data().playerCount||6})),an.value="Chargement des joueurs",Pt.value=45;const Oe=await Ct(rt(we,"seasons",o.value,"players"));et.value=Oe.docs.map(ct=>({id:ct.id,...ct.data()})),an.value="Chargement des disponibilités",Pt.value=70;const Ge=await Ct(rt(we,"seasons",o.value,"availability")),ot={};Ge.docs.forEach(ct=>{const Zn=ct.data(),ns={};Object.keys(Zn).forEach(Mi=>{const jo=Zn[Mi];ns[Mi]=jo==="oui"?!0:jo==="non"?!1:jo}),ot[ct.id]=ns}),Kt.value=ot,an.value="Chargement des sélections",Pt.value=85;const Tt=await Ct(rt(we,"seasons",o.value,"selections")),ft={};Tt.docs.forEach(ct=>{ft[ct.id]=ct.data().players||[]}),Me.value=ft;const Vt=await rp(o.value),Nt=new Set;Array.isArray(Vt)&&Vt.forEach(ct=>{ct.isProtected&&Nt.add(ct.playerId||ct.id)}),xn.value=Nt}const C=he=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>he()):setTimeout(he,0)};an.value="Préparation de l'interface",Pt.value=95,C(()=>{Fs(),Vo()}),console.debug("players (deduplicated)"),console.debug("availability loaded"),await cn(),Pt.value=100,sr.value=!1,cn(()=>{ir();const he=qn.value;he&&(he.addEventListener("scroll",Oe=>{ir(),Eo.value=he.scrollLeft||0},{passive:!0}),window.addEventListener("resize",ir))});const J=r.query.event;if(J&&ze.value.length>0){const he=ze.value.find(Oe=>Oe.id===J);he?(console.debug("Événement trouvé depuis l'URL"),await it(J,he)):(console.warn("Événement non trouvé avec l'ID"),Gr.value=!0,Kr.value="Événement non trouvé",setTimeout(()=>{Gr.value=!1},3e3))}const re=r.query.player;if(re&&et.value.length>0){const he=et.value.find(Oe=>Oe.id===re);he&&(Rr(he),await cn(),r.query.open==="protection"&&((be=k==null?void 0:k.value)!=null&&be.openProtection)&&k.value.openProtection())}}),Yt(()=>r.params.eventId,_=>{if(_){const m=()=>{const C=ze.value.find(J=>J.id===_);return C?(nl(C),!0):!1};if(ze.value.length>0)m();else{const C=Yt(ze,J=>{J.length>0&&m()&&C()},{immediate:!0})}}},{immediate:!0});function Ms(_){if(!_)return null;if(_ instanceof Date)return _;if(typeof(_==null?void 0:_.toDate)=="function")return _.toDate();if(typeof _=="string"||typeof _=="number"){const m=new Date(_);return isNaN(m.getTime())?null:m}return null}const Di=Qe(()=>{let _=null;try{o.value&&(_=localStorage.getItem(`seasonPreferredPlayer:${o.value}`))}catch{}const m=[...et.value].sort((be,he)=>(be.name||"").localeCompare(he.name||"","fr",{sensitivity:"base"}));if(!_)return m;const C=m.findIndex(be=>be.id===_);if(C<=0)return m;const J=m[C],re=m.slice(0,C).concat(m.slice(C+1));return[J,...re]}),Yu=Qe(()=>{try{if(o.value)return localStorage.getItem(`seasonPreferredPlayer:${o.value}`)}catch{}return null}),Th=Qe(()=>[...ze.value].sort((_,m)=>{const C=Ms(_.date),J=Ms(m.date),re=C?C.getTime():Number.POSITIVE_INFINITY,be=J?J.getTime():Number.POSITIVE_INFINITY;return re!==be?re-be:(_.title||"").localeCompare(m.title||"","fr",{sensitivity:"base"})})),Zr=O(!1),zn=Qe(()=>{const _=Th.value;return Zr.value?_:_.filter(m=>!m.archived)});function Xu(){Zr.value=!Zr.value}async function Sr(_,m){const C=et.value.find(be=>be.name===_);if(!C){console.error("Joueur non trouvé");return}if(!ze.value.find(be=>be.id===m)){console.error("Événement non trouvé");return}if(Pi(C.id)){const be=fa(C.id),he=se.value===C.id;console.debug("Joueur protégé:",{playerId:C.id,hasCachedPassword:be,wasRecentlyVerified:he,recentlyVerifiedPlayer:se.value}),be||he?(console.debug("Session active ou joueur récemment vérifié, procéder au toggle"),he&&(console.debug("Nettoyage du flag recentlyVerifiedPlayer"),se.value=null),ar(C,m)):(console.debug("Pas de session, affichage de la modal de vérification"),ae.value={playerName:_,eventId:m},ue.value=C,ge.value=!0);return}ar(C,m)}function ar(_,m){var re,be,he;const C=(re=Kt.value[_.name])==null?void 0:re[m];console.debug("toggleAvailability");let J;C===!0?J=!1:C===!1?J=void 0:J=!0,J===void 0?Kt.value[_.name]&&delete Kt.value[_.name][m]:(Kt.value[_.name]||(Kt.value[_.name]={}),Kt.value[_.name][m]=J);try{typeof Ee<"u"&&Ee.value===1&&_.id===(j.value||((be=Di.value[0])==null?void 0:be.id))&&m===(B.value||((he=zn.value[0])==null?void 0:he.id))&&(Ee.value=3,cn(()=>{const Ge=document.querySelector(`[data-player-id="${_.id}"]`);if(Ge){const ot=Ge.querySelector(".player-name");if(ot){const Tt=ot.getBoundingClientRect();oe.value.position={x:Math.round(Tt.right+8),y:Math.round(Tt.top+window.scrollY-4)}}}}))}catch{}Ly(_.name,Kt.value[_.name],o.value).then(async()=>{await cn(),Vo(),Le.value=!0,bt.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Le.value=!1},3e3)}).catch(Oe=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function lr(_,m){var C;return(C=Kt.value[_])==null?void 0:C[m]}function Zu(_,m){var re;const C=Me.value[m]||[],J=(re=Kt.value[_])==null?void 0:re[m];return C.includes(_)&&J===!0}async function ec(_,m=6){const C=ze.value.find(he=>he.id===_),J=(C==null?void 0:C.playerCount)||6,re=Me.value[_]||[];if(re.length>0&&re.every(he=>lr(he,_))){console.debug("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const Oe=et.value.filter(Tt=>lr(Tt.name,_)).map(Tt=>{const ft=Ln(Tt.name);return{name:Tt.name,weight:1/(1+ft)}}),Ge=[],ot=[...Oe];for(;Ge.length<J&&ot.length>0;){const Tt=ot.reduce((Nt,ct)=>Nt+ct.weight,0);let ft=Math.random()*Tt;const Vt=ot.findIndex(Nt=>(ft-=Nt.weight,ft<=0));Vt>=0&&(Ge.push(ot[Vt].name),ot.splice(Vt,1))}Me.value[_]=Ge}else{const he=re.filter(Ge=>lr(Ge,_)),Oe=J-he.length;if(Oe<=0)Me.value[_]=he;else{const Ge=new Set(he),Tt=et.value.filter(Nt=>lr(Nt.name,_)&&!Ge.has(Nt.name)).map(Nt=>{const ct=Ln(Nt.name);return{name:Nt.name,weight:1/(1+ct)}}),ft=[],Vt=[...Tt];for(;ft.length<Oe&&Vt.length>0;){const Nt=Vt.reduce((ns,Mi)=>ns+Mi.weight,0);let ct=Math.random()*Nt;const Zn=Vt.findIndex(ns=>(ct-=ns.weight,ct<=0));Zn>=0&&(ft.push(Vt[Zn].name),Vt.splice(Zn,1))}Me.value[_]=[...he,...ft]}}await Fy(_,Me.value[_],o.value),Fs(),Vo()}async function es(_,m=6){var he,Oe;console.debug("tirerProtected appelé"),console.debug("etat modal selection avant");const C=Te.value,J=(he=Pe.value)==null?void 0:he.id,re=Me.value[_]&&Me.value[_].length>0,be=re?[...Me.value[_]]:[];if(await ec(_,m),console.debug("etat modal selection apres"),C&&!Te.value&&(console.debug("Restauration de la popin de sélection..."),Te.value=!0,Pe.value=ze.value.find(Ge=>Ge.id===J)),Te.value&&((Oe=Pe.value)==null?void 0:Oe.id)===_)if(console.debug("Popin de sélection ouverte, mise à jour..."),await cn(),Ne.value&&Ne.value.showSuccess){console.debug("Appel de showSuccess sur la popin de sélection");const Ge=Me.value[_]||[],ot=be.filter(ft=>Ge.includes(ft)),Tt=ot.length>0&&ot.length<be.length;Ne.value.showSuccess(re,Tt)}else console.debug("showSuccess indisponible");else console.debug("Popin de sélection fermée, affichage message global"),Le.value=!0,ze.value.find(Ge=>Ge.id===_),Me.value[_],re?bt.value="Sélection mise à jour avec succès !":bt.value="Sélection effectuée avec succès !",setTimeout(()=>{Le.value=!1},3e3)}function Za(_){_===0?F.value.position=null:_===1?G.value.position=null:_===2&&(oe.value.position=null)}function xh(_){var C;return _?(typeof _=="string"?new Date(_):((C=_.toDate)==null?void 0:C.call(_))||_).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function el(_){var C;return _?(typeof _=="string"?new Date(_):((C=_.toDate)==null?void 0:C.call(_))||_).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Ln(_){return Object.values(Me.value).filter(m=>m.includes(_)).length}function tl(_){const m=Kt.value[_]||{};return Object.values(m).filter(C=>C===!0).length}function Do(_){return _?Object.values(Kt.value).filter(m=>m[_]===!0).length:0}function Ls(_){return _?(Me.value[_]||[]).length:0}function Vi(_){const m=ze.value.find(J=>J.id===_),C=(m==null?void 0:m.playerCount)||6;return Ls(_)>=C}function tc(_){const m=tl(_),C=Ln(_);return m===0?0:C/m}function Ni(_){ko.value[_]={availability:tl(_),selection:Ln(_),ratio:tc(_)}}function Fs(){et.value.forEach(_=>Ni(_.name))}function Vo(){const _={};ze.value.forEach(m=>{const C=m.playerCount||6,re=et.value.filter(he=>lr(he.name,m.id)===!0).map(he=>{const Oe=Ln(he.name);return{name:he.name,weight:1/(1+Oe)}}),be=re.reduce((he,Oe)=>he+Oe.weight,0);re.forEach(he=>{const Oe=Math.min(1,he.weight/be*C);_[he.name]||(_[he.name]={}),_[he.name][m.id]=Math.round(Oe*100)})}),Xr.value=_}const Us=O(null),Et=O(!1);async function Ah(_=null){const m=_||Us.value;if(!m){console.error("Aucun joueur à supprimer");return}try{await K2(m,o.value),et.value=et.value.filter(C=>C.id!==m),Et.value=!1,Us.value=null,Le.value=!0,bt.value="Joueur supprimé avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function Sh(){Et.value=!1,Us.value=null}async function nc(_){ol(),await eo(_,o.value)?await br({type:"deletePlayer",data:{playerId:_}}):await $s({type:"deletePlayer",data:{playerId:_}})}async function rc(){if(I.value){const _=ze.value.find(C=>C.id===I.value),m=(_==null?void 0:_.playerCount)||6;await es(I.value,m),ie.value=!1,I.value=null}}function sc(){ie.value=!1,I.value=null}function No(){return D.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis",updateSelection:"Mise à jour de sélection - Code PIN requis"}[D.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function $s(_){if(Kn.isPinCached(o.value)){const m=Kn.getCachedPin(o.value);if(console.debug("PIN en cache trouvé, utilisation automatique"),await bd(o.value,m)){await Pr(_);return}else Kn.clearSession()}D.value=_,V.value=!0}async function br(_){const m=_.data.playerId;if(fa(m)){console.debug("Mot de passe du joueur en cache trouvé, utilisation automatique"),await Pr(_);return}We.value=_,He.value=!0}async function ic(_){try{if(await bd(o.value,_)){Kn.saveSession(o.value,_),V.value=!1;const C=D.value;D.value=null,await Pr(C)}else w.value="Code PIN incorrect",setTimeout(()=>{w.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),w.value="Erreur lors de la vérification du code PIN"}}function Ph(){V.value=!1,D.value=null,w.value=""}async function js(_){if(_){je.value=!0,Xe.value="";try{const m=We.value.data.playerId,C=await Zf(o.value);if(_===C){try{Na.saveSession(We.value.data.playerId,_)}catch{}He.value=!1;const re=We.value;We.value=null,$e.value="",await Pr(re);return}if(await verifyPlayerPassword(m,_,o.value)){He.value=!1;const re=We.value;We.value=null,$e.value="",await Pr(re)}else Xe.value="Mot de passe incorrect",setTimeout(()=>{Xe.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),Xe.value="Erreur lors de la vérification du mot de passe"}finally{je.value=!1}}}function oc(){He.value=!1,We.value=null,Xe.value="",$e.value="",je.value=!1}async function Oo(_){if(_){Ve.value=!0,H.value="";try{const m=De.value.data.player,C=await Zf(o.value);if(_===C){try{Na.saveSession(De.value.data.player.id,_)}catch{}ee.value=!1;const re=De.value;De.value=null,Y.value="",await Pr(re);return}if(await verifyPlayerPassword(m.id,_,o.value)){ee.value=!1;const re=De.value;De.value=null,Y.value="",await Pr(re)}else H.value="Mot de passe incorrect",setTimeout(()=>{H.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),H.value="Erreur lors de la vérification du mot de passe"}finally{Ve.value=!1}}}function Mo(){ee.value=!1,De.value=null,H.value="",Y.value="",Ve.value=!1}async function ac(){K.value=!0,ye.value="",le.value="";try{const _=De.value.data.player,m=await sendPasswordResetEmail(_.id,o.value);le.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),ye.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{K.value=!1}}async function Lo(){Ye.value=!0,ht.value="",T.value="";try{const _=We.value.data.playerId,m=await sendPasswordResetEmail(_,o.value);T.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),ht.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{Ye.value=!1}}function Rh(){return Kn.isPinCached(o.value)?{timeRemaining:Kn.getTimeRemaining(),isExpiringSoon:Kn.isExpiringSoon()}:null}async function Pr(_){var J;if(!_)return;const{type:m,data:C}=_;try{switch(m){case"deleteEvent":console.debug("executePendingOperation - data.eventId reçu"),c.value=C.eventId,l.value=!0;break;case"addEvent":Os.value=!0;break;case"deletePlayer":Us.value=C.playerId,Et.value=!0;break;case"launchSelection":Me.value[C.eventId]&&Me.value[C.eventId].length>0?(I.value=C.eventId,ie.value=!0,S.value=!1):(await es(C.eventId,C.count),S.value=!1);break;case"toggleAvailability":ar(C.player,C.eventId);break;case"toggleArchive":await setEventArchived(C.eventId,C.archived,o.value);{const re=ze.value.findIndex(be=>be.id===C.eventId);re!==-1&&(ze.value[re]={...ze.value[re],archived:!!C.archived}),Q.value=!!C.archived}break;case"updateSelection":{const{eventId:re,players:be}=C;await Fy(re,Array.isArray(be)?be:[],o.value),Me.value[re]=Array.isArray(be)?be:[];try{(J=Ne.value)==null||J.showSuccess(!0,!0)}catch{}}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),Le.value=!0,bt.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Le.value=!1},3e3)}}function Oi(){t.push("/")}kl(()=>{const _=qn.value;_&&_.removeEventListener("scroll",ir),window.removeEventListener("resize",ir)});async function nl(_){N.value=_,X.value=_.description||"",Q.value=!!_.archived;try{const[m,C]=await Promise.all([Ho(et.value,ze.value,o.value),Wo(o.value)]);Kt.value=m,Me.value=C}catch(m){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",m)}S.value=!0}function Fo(){S.value=!1,N.value=null,X.value="",Z.value=!1}function Uo(){Fo(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function rl(_,m){console.debug("handleAvailabilityToggle appelé");const C=et.value.find(re=>re.name===_);if(!C){console.error("Joueur non trouvé");return}console.debug("Joueur trouvé");const J=Pi(C.id);if(console.debug("Joueur protégé"),J){fa(C.id)?(console.debug("Session active, procéder au toggle"),await Sr(_,m)):(console.debug("Demande du mot de passe pour joueur protégé"),ae.value={playerName:_,eventId:m},ue.value=C,ge.value=!0);return}console.debug("Joueur non protégé, procéder au toggle"),await Sr(_,m)}function lc(_,m){return(Me.value[m]||[]).includes(_)}async function $o(_){if(console.debug("Mot de passe vérifié"),ue.value&&(se.value=ue.value.id,console.debug("Joueur marqué comme récemment vérifié")),ae.value){const{playerName:m,eventId:C}=ae.value;console.debug("Exécution de l'action en attente"),await Sr(m,C),ae.value=null}else console.debug("Aucune action en attente trouvée");ge.value=!1,ue.value=null}function sl(){d.value=N.value.id,f.value=N.value.title,v.value=N.value.date,X.value=N.value.description||"",y.value=N.value.playerCount||6,S.value=!1}async function il(){if(N.value)try{const _=!N.value.archived,m={...N.value,archived:_};await Uy(N.value.id,m,o.value),N.value.archived=_;const C=ze.value.findIndex(J=>J.id===N.value.id);C!==-1&&(ze.value[C].archived=_),Le.value=!0,bt.value=_?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function Rr(_){x.value=_,E.value=!0;try{typeof Ee<"u"&&Ee.value}catch{}}function ol(){E.value=!1,x.value=null}async function uc({playerId:_,newName:m}){try{await updatePlayer(_,m,o.value),await Promise.all([uf(o.value),Ho(et.value,ze.value,o.value),Wo(o.value)]).then(([C,J,re])=>{if(et.value=C,Kt.value=J,Me.value=re,Xa(),x.value&&x.value.id===_){const be=C.find(he=>he.id===_);be&&(x.value=be)}}),Le.value=!0,bt.value="Joueur mis à jour avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function cc(){try{await Promise.all([uf(o.value),Ho(et.value,ze.value,o.value),Wo(o.value)]).then(([_,m,C])=>{if(et.value=_,Kt.value=m,Me.value=C,Xa(),x.value){const J=_.find(re=>re.id===x.value.id);J&&(x.value=J)}}),Le.value=!0,bt.value="Données mises à jour !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function dc(_){if(!_)return{availability:0,selection:0,ratio:0};const m=tl(_.name),C=Ln(_.name),J=m===0?0:Math.round(C/m*100);return{availability:m,selection:C,ratio:J}}function Bs(_){const m=Me.value[_]||[],C=ze.value.find(be=>be.id===_),J=(C==null?void 0:C.playerCount)||6,re=Do(_);if(m.length>0){const be=m.some(Oe=>!lr(Oe,_)),he=re<J;if(be||he)return{type:"incomplete",hasUnavailablePlayers:be,hasInsufficientPlayers:he,unavailablePlayers:m.filter(Oe=>!lr(Oe,_)),availableCount:re,requiredCount:J}}return re<J?{type:"insufficient",availableCount:re,requiredCount:J}:m.length===0?{type:"ready",availableCount:re,requiredCount:J}:{type:"complete",availableCount:re,requiredCount:J}}function Fn(_){const m=Bs(_);return m.type==="incomplete"||m.type==="insufficient"}function al(_){const m=Bs(_);switch(m.type){case"incomplete":return m.hasUnavailablePlayers?m.unavailablePlayers.length===1?`Sélection incomplète : ${m.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${m.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${m.availableCount} joueurs disponibles pour ${m.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${m.availableCount} disponibles pour ${m.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${m.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${m.availableCount} joueurs disponibles`;default:return""}}async function hc({eventId:_,eventData:m,reason:C}){if(!o.value)return;const J={id:_,...m};if(J.archived){console.debug("Événement archivé, aucune notification envoyée"),Le.value=!0,bt.value="Aucune notification envoyée : événement archivé",setTimeout(()=>{Le.value=!1},3e3);return}const re=[];for(const be of et.value){if(!await eo(be.id,o.value))continue;const Oe=await zI(be.id,o.value);if(Oe)try{const Ge=await tp({seasonId:o.value,playerId:be.id,eventId:J.id,action:"yes"}),ot=await tp({seasonId:o.value,playerId:be.id,eventId:J.id,action:"no"}),Tt=`${Ge.url}&slug=${encodeURIComponent(s)}`,ft=`${ot.url}&slug=${encodeURIComponent(s)}`;await J2({toEmail:Oe,playerName:be.name,eventTitle:J.title,eventDate:el(J.date),yesUrl:Tt,noUrl:ft,reason:C})}catch{console.error("Email non envoyé pour un joueur"),re.push(be.id)}}Le.value=!0,bt.value=re.length>0?`Emails envoyés (avec ${re.length} échec(s))`:"Emails envoyés aux joueurs protégés.",setTimeout(()=>{Le.value=!1},3e3)}function Cr(_){if(_!=null&&_.archived){Le.value=!0,bt.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{Le.value=!1},3e3);return}h(),tt.value=_,qe.value=!0}function u(){qe.value=!1,tt.value=null}function h(){Gt.value=!1,Ft.value=null}async function g({eventId:_,eventData:m,reason:C,selectedPlayers:J}){try{C==="selection"?(await Z2({eventId:_,eventData:m,selectedPlayers:J,seasonId:o.value,seasonSlug:s,players:wo.value}),z(),Le.value=!0,bt.value="Notifications de sélection envoyées avec succès !",setTimeout(()=>{Le.value=!1},3e3)):(await hc({eventId:_,eventData:m,reason:C}),u(),Le.value=!0,bt.value="Notifications envoyées avec succès !",setTimeout(()=>{Le.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),Le.value=!0,bt.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Le.value=!1},3e3)}}function b(_){if(!_)return{};const m={};return et.value.forEach(C=>{m[C.name]=lr(C.name,_)}),m}function M(_){Pe.value=_,Te.value=!0}function z(){Te.value=!1,Pe.value=null}async function me(){if(!Pe.value)return;const _=Pe.value.id,m=Pe.value.playerCount||6;if(Do(_)===0){Le.value=!0,bt.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Le.value=!1},3e3);return}await $s({type:"launchSelection",data:{eventId:_,count:m}})}function vt(){z(),Le.value=!0,bt.value="Sélection validée !",setTimeout(()=>{Le.value=!1},3e3)}async function ln(_){if(!_||!_.eventId)return;const{eventId:m,players:C}=_;await $s({type:"updateSelection",data:{eventId:m,players:C}})}async function it(_,m){if(!_||!m)return;ts(),Xn.value=_,bo.value=!0,await cn();const C=document.querySelector(`[data-event-id="${_}"]`);if(!C){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(he=>{he.classList.remove("focused-event-highlight")});const J=document.querySelectorAll(`[data-event-id="${_}"]`);J.forEach(he=>{he.classList.add("focused-event-highlight")});const re=J[0],be=J[J.length-1];re&&re.classList.add("focused-event-column-start"),be&&be.classList.add("focused-event-column-end"),await mn(C),Le.value=!0,bt.value=`Événement ciblé : ${m.title}`,setTimeout(()=>{Le.value=!1},4e3),Ai.value=setTimeout(()=>{ts()},8e3)}function un(_){if(!_)return;const m=ze.value.find(C=>C.id===_);if(!m){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const C=ze.value.find(J=>J.id===_);C?it(_,C):console.error("Événement toujours introuvable après retry")},500);return}it(_,m)}async function mn(_){if(!_)return;if(await new Promise(C=>setTimeout(C,100)),window.innerWidth<=768){const C=qn.value;if(C){const J=_.offsetLeft,re=_.offsetWidth,be=C.clientWidth,he=J-be/2+re/2,Oe=C.scrollWidth-be,Ge=Math.max(0,Math.min(he,Oe));C.scrollTo({left:Ge,behavior:"smooth"}),setTimeout(()=>{const ot=_.getBoundingClientRect();if(ot.left<0||ot.right>window.innerWidth){const Tt=J-20;C.scrollTo({left:Math.max(0,Tt),behavior:"smooth"})}},500)}}else _.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const m=qn.value;m&&setTimeout(()=>{const C=document.querySelector(`[data-event-id="${Xn.value}"]`);if(C&&C.closest("tbody")){const J=C.offsetLeft,re=C.offsetWidth,be=m.clientWidth,he=J-be/2+re/2,Oe=m.scrollWidth-be,Ge=Math.max(0,Math.min(he,Oe));m.scrollTo({left:Ge,behavior:"smooth"})}},300)}function ts(){Ai.value&&(clearTimeout(Ai.value),Ai.value=null),Xn.value=null,bo.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(_=>{_.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(_=>{_.classList.remove("focused-event-column-start","focused-event-column-end")})}return(_,m)=>{var C,J,re,be,he,Oe,Ge,ot,Tt,ft,Vt,Nt,ct,Zn,ns,Mi,jo,Wm,Qm;return U(),$(At,null,[p("div",jM,[p("div",BM,[p("button",{onClick:Oi,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour à l'accueil"},m[65]||(m[65]=[p("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),p("h1",qM,ce(i.value?i.value:"Chargement..."),1),p("div",zM,[p("div",GM,[p("button",{onClick:Xu,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:Zr.value?"Masquer les événements archivés":"Afficher les événements archivés"},[p("span",HM,ce(Zr.value?"📂":"📁"),1)],8,KM),p("button",{onClick:Ya,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Lancer le tutoriel interactif","aria-label":"Lancer le tutoriel interactif"},m[66]||(m[66]=[p("span",{class:"text-2xl"},"✨",-1)])),p("button",{onClick:m[0]||(m[0]=W=>fn.value=!0),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Comment ça marche ?","aria-label":"Comment ça marche ?"},m[67]||(m[67]=[p("span",{class:"text-2xl"},"❓",-1)]))]),p("div",{class:"relative md:hidden",ref_key:"headerMenuRef",ref:_r},[p("button",{onClick:Ht(Hu,["stop"]),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Menu","aria-label":"Menu"},m[68]||(m[68]=[p("span",{class:"text-2xl"},"⋯",-1)])),yr.value?(U(),$("div",WM,[p("button",{onClick:m[1]||(m[1]=W=>{Xu(),So()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},[p("span",null,ce(Zr.value?"📂":"📁"),1),p("span",QM,ce(Zr.value?"Masquer archivés":"Afficher archivés"),1)]),p("button",{onClick:m[2]||(m[2]=W=>{Ya(),So()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[69]||(m[69]=[p("span",null,"✨",-1),p("span",{class:"text-sm"},"Lancer le tutoriel",-1)])),p("button",{onClick:m[3]||(m[3]=W=>{fn.value=!0,So()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[70]||(m[70]=[p("span",null,"❓",-1),p("span",{class:"text-sm"},"Comment ça marche ?",-1)]))])):fe("",!0)],512)])],512),p("div",JM,[p("div",{ref_key:"headerBarRef",ref:To,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[p("div",YM,[ze.value.length===0&&et.value.length===0?fe("",!0):(U(),$("div",XM,[p("div",{class:"flex items-center justify-center h-full gap-2"},[p("button",{onClick:or,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},m[71]||(m[71]=[p("span",{class:"text-lg"},"➕",-1),p("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),p("span",{class:"sm:hidden"},"Événement",-1)]))])])),p("div",ZM,[p("div",{ref_key:"headerEventsRef",ref:An,class:"flex relative z-[60]",style:Js({transform:`translateX(-${Eo.value}px)`})},[(U(!0),$(At,null,cr(zn.value,W=>(U(),$("div",{key:"h-"+W.id,"data-event-id":W.id,class:"col-event flex-shrink-0 p-3 text-center cursor-pointer",onClick:Sn=>nl(W)},[p("div",{class:"header-date text-[16px] md:text-base text-gray-300",title:el(W.date)},ce(xh(W.date)),9,tL),p("div",{class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2",title:W.title},ce(W.title||"Sans titre"),9,nL),W.archived?(U(),$("div",rL,"(Archivé)")):fe("",!0),Fn(W.id)?(U(),$("div",{key:1,class:"mt-1 w-4 h-4 bg-yellow-500 rounded-full mx-auto flex items-center justify-center hover:bg-yellow-400 transition-colors duration-200",title:al(W.id)+" - Cliquez pour ouvrir la sélection",onClick:Ht(Sn=>M(W),["stop"])},m[72]||(m[72]=[p("span",{class:"text-xs text-white font-bold"},"⚠️",-1)]),8,sL)):Bs(W.id).type==="ready"?(U(),$("div",{key:2,class:"mt-1 w-4 h-4 bg-green-500 rounded-full mx-auto flex items-center justify-center hover:bg-green-400 transition-colors duration-200",title:al(W.id)+" - Cliquez pour ouvrir la sélection",onClick:Ht(Sn=>M(W),["stop"])},m[73]||(m[73]=[p("span",{class:"text-xs text-white font-bold"},"🎲",-1)]),8,iL)):fe("",!0)],8,eL))),128))],4)]),m[74]||(m[74]=p("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),yt(p("button",{onClick:m[4]||(m[4]=Ht(W=>Gu(-1,W),["prevent"])),onMousedown:m[5]||(m[5]=Ht(W=>gr(-1,W),["prevent"])),onMouseup:m[6]||(m[6]=W=>vr(W)),onMouseleave:m[7]||(m[7]=W=>vr(W)),onTouchstart:m[8]||(m[8]=Ht(W=>gr(-1,W),["prevent"])),onTouchend:m[9]||(m[9]=W=>vr(W)),onTouchcancel:m[10]||(m[10]=W=>vr(W)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[Fh,Io.value]]),yt(p("button",{onClick:m[11]||(m[11]=Ht(W=>Gu(1,W),["prevent"])),onMousedown:m[12]||(m[12]=Ht(W=>gr(1,W),["prevent"])),onMouseup:m[13]||(m[13]=W=>vr(W)),onMouseleave:m[14]||(m[14]=W=>vr(W)),onTouchstart:m[15]||(m[15]=Ht(W=>gr(1,W),["prevent"])),onTouchend:m[16]||(m[16]=W=>vr(W)),onTouchcancel:m[17]||(m[17]=W=>vr(W)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[Fh,xr.value]])])],512),yt(p("div",{ref_key:"gridboardRef",ref:qn,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[Ee.value===1?(U(),$("div",oL,[F.value.position?(U(),$("div",{key:0,class:"fixed z-[400]",style:Js({left:F.value.position.x+"px",top:F.value.position.y+"px"})},[p("div",{id:"coachmark-add",class:Hn(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":F.value.side==="right","coachmark-left":F.value.side==="left"}])},[m[76]||(m[76]=p("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),m[77]||(m[77]=p("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),p("div",aL,[m[75]||(m[75]=p("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),p("button",{onClick:m[18]||(m[18]=W=>Za(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):fe("",!0)])):fe("",!0),Ee.value===2&&j.value&&B.value?(U(),$("div",lL,[G.value.position?(U(),$("div",{key:0,class:"fixed z-[400]",style:Js({position:"absolute",left:G.value.position.x+"px",top:G.value.position.y+"px"})},[p("div",uL,[m[79]||(m[79]=p("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),m[80]||(m[80]=p("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),p("div",cL,[m[78]||(m[78]=p("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),p("button",{onClick:m[19]||(m[19]=W=>Za(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):fe("",!0)])):fe("",!0),Ee.value===3&&j.value?(U(),$("div",dL,[oe.value.position?(U(),$("div",{key:0,class:"fixed z-[400]",style:Js({position:"absolute",left:oe.value.position.x+"px",top:oe.value.position.y+"px"})},[p("div",hL,[m[82]||(m[82]=p("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),m[83]||(m[83]=p("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),p("div",fL,[m[81]||(m[81]=p("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),p("button",{onClick:m[20]||(m[20]=W=>Za(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):fe("",!0)])):fe("",!0),p("table",pL,[p("colgroup",null,[m[84]||(m[84]=p("col",{class:"col-left"},null,-1)),(U(!0),$(At,null,cr(zn.value,(W,Sn)=>(U(),$("col",{key:"c"+Sn,class:"col-event"}))),128)),m[85]||(m[85]=p("col",{class:"col-right"},null,-1))]),m[89]||(m[89]=p("thead",{class:"hidden"},null,-1)),p("tbody",null,[(U(!0),$(At,null,cr(Di.value,W=>{var Sn;return U(),$("tr",{key:W.id,class:Hn(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":W.id===R.value,"preferred-player":W.id===Yu.value}]),"data-player-id":W.id},[p("td",gL,[p("div",vL,[Pi(W.id)?(U(),$("span",yL," 🔒 ")):fe("",!0),p("span",{onClick:rs=>Rr(W),class:Hn(["player-name hover:border-b-2 hover:border-dashed hover:border-purple-400 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":Ee.value===3&&W.id===(j.value||((Sn=Di.value[0])==null?void 0:Sn.id))}]),title:"Cliquez pour voir les détails : "+W.name},ce(W.name),11,_L)])]),(U(!0),$(At,null,cr(zn.value,rs=>{var Jm,Ym,Xm;return U(),$("td",{key:rs.id,"data-event-id":rs.id,class:Hn(["p-0",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":Ee.value===2&&W.id===(j.value||((Jm=Di.value[0])==null?void 0:Jm.id))&&rs.id===(B.value||((Ym=zn.value[0])==null?void 0:Ym.id))}])},[wt(jy,{"player-name":W.name,"event-id":rs.id,"is-available":lr(W.name,rs.id),"is-selected":Zu(W.name,rs.id),"chance-percent":((Xm=Xr.value[W.name])==null?void 0:Xm[rs.id])??null,"show-selected-chance":Vi(rs.id),onToggle:Sr},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance"])],10,bL)}),128)),m[86]||(m[86]=p("td",{class:"p-3 md:p-4"},null,-1))],10,mL)}),128)),p("tr",wL,[p("td",IL,[p("div",EL,[p("button",{onClick:m[21]||(m[21]=W=>P.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},m[87]||(m[87]=[p("span",{class:"text-lg"},"➕",-1),p("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),p("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(U(!0),$(At,null,cr(zn.value,W=>(U(),$("td",{key:"add-row-"+W.id,"data-event-id":W.id,class:"p-3 md:p-5"},null,8,TL))),128)),m[88]||(m[88]=p("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[Fh,!sr.value]])])]),sr.value?(U(),$("div",xL,[p("div",AL,[m[90]||(m[90]=p("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[p("span",{class:"text-3xl"},"🎭")],-1)),p("p",SL,ce(an.value)+"…",1),p("div",PL,[p("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:Js({width:Pt.value+"%"})},null,4)]),p("p",RL,ce(Pt.value)+"%",1)])])):fe("",!0),sr.value?fe("",!0):(U(),bp($M,{key:1,"season-id":o.value,"season-slug":fs(s),"players-count":et.value.length,"events-count":ze.value.length,"onboarding-done":((C=a.value)==null?void 0:C.onboardingCreatorDone)===!0,onCreateEvent:or,onAddPlayer:m[22]||(m[22]=()=>{P.value=!0}),onCopyLink:Hr,onDismissed:Jt},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),fe("",!0),Le.value?(U(),$("div",CL,[p("div",kL,[m[91]||(m[91]=p("span",{class:"text-xl"},"✨",-1)),p("span",null,ce(bt.value),1)])])):fe("",!0),Gr.value?(U(),$("div",DL,[p("div",VL,[m[92]||(m[92]=p("span",{class:"text-xl"},"⚠️",-1)),p("span",null,ce(Kr.value),1)])])):fe("",!0),Os.value?(U(),$("div",NL,[p("div",OL,[m[98]||(m[98]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),p("div",ML,[m[93]||(m[93]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),yt(p("input",{"onUpdate:modelValue":m[23]||(m[23]=W=>Qr.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[Ut,Qr.value]])]),p("div",LL,[m[94]||(m[94]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),yt(p("input",{"onUpdate:modelValue":m[24]||(m[24]=W=>Jr.value=W),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[Ut,Jr.value]])]),p("div",FL,[m[95]||(m[95]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),yt(p("textarea",{"onUpdate:modelValue":m[25]||(m[25]=W=>Ri.value=W),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[Ut,Ri.value]])]),p("div",UL,[yt(p("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":m[26]||(m[26]=W=>ki.value=W),class:"w-4 h-4"},null,512),[[Sg,ki.value]]),m[96]||(m[96]=p("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),p("div",$L,[m[97]||(m[97]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),yt(p("input",{"onUpdate:modelValue":m[27]||(m[27]=W=>Ci.value=W),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[Ut,Ci.value]])]),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:Yr,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:Ju,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):fe("",!0),P.value?(U(),$("div",jL,[p("div",BL,[m[100]||(m[100]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),p("div",qL,[m[99]||(m[99]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),yt(p("input",{"onUpdate:modelValue":m[28]||(m[28]=W=>A.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[Ut,A.value]])]),p("div",zL,[p("button",{onClick:m[29]||(m[29]=W=>P.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:Qu,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):fe("",!0),l.value?(U(),$("div",GL,[p("div",KL,[m[101]||(m[101]=ur('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),p("div",HL,[p("button",{onClick:Wu,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:m[30]||(m[30]=()=>Ih()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):fe("",!0),Et.value?(U(),$("div",WL,[p("div",QL,[m[102]||(m[102]=ur('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),p("div",JL,[p("button",{onClick:Sh,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),p("button",{onClick:m[31]||(m[31]=()=>Ah()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):fe("",!0),ie.value?(U(),$("div",YL,[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},[m[103]||(m[103]=ur('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🎭</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.</p></div><p class="mb-6 text-sm text-yellow-400 bg-yellow-900/20 p-3 rounded-lg border border-yellow-500/20"> ⚠️ Pensez à prévenir les gens du changement ! </p>',2)),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:sc,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),p("button",{onClick:rc,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):fe("",!0),S.value?(U(),$("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:Fo},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:m[41]||(m[41]=Ht(()=>{},["stop"]))},[p("div",XL,[p("button",{onClick:Fo,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),m[104]||(m[104]=p("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[p("span",{class:"text-2xl md:text-3xl"},"🎭")],-1)),p("h2",ZL,ce((J=N.value)==null?void 0:J.title),1),p("p",eF,ce(el((re=N.value)==null?void 0:re.date)),1)]),p("div",tF,[(be=N.value)!=null&&be.description?(U(),$("div",nF,[p("p",rF,ce(N.value.description),1)])):fe("",!0),p("div",sF,[p("div",iF,[p("div",oF,ce(Do((he=N.value)==null?void 0:he.id)),1),m[105]||(m[105]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),p("div",aF,[p("div",lF,ce(Ls((Oe=N.value)==null?void 0:Oe.id)),1),m[106]||(m[106]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),p("div",uF,[p("div",cF,ce(((Ge=N.value)==null?void 0:Ge.playerCount)||6),1),m[107]||(m[107]=p("div",{class:"text-xs md:text-sm text-gray-300"},"À sélectionner",-1))])]),N.value?(U(),$("div",dF,[m[109]||(m[109]=p("h3",{class:"text-lg font-semibold text-white mb-3"},"Disponibilités des joueurs",-1)),p("div",hF,[m[108]||(m[108]=p("div",{class:"grid grid-cols-12 gap-0 bg-gray-700 border-b border-gray-600"},[p("div",{class:"col-span-4 p-3 font-medium text-gray-300"},"Joueur"),p("div",{class:"col-span-8 p-3 font-medium text-gray-300 text-center"},"Disponibilité")],-1)),(U(!0),$(At,null,cr(Di.value,W=>{var Sn;return U(),$("div",{key:W.id,class:"grid grid-cols-12 gap-0 border-b border-gray-600 last:border-b-0 hover:bg-gray-700/50 transition-colors"},[p("div",fF,[p("span",pF,ce(W.name),1),Pi(W.id)?(U(),$("span",mF,"🔒")):fe("",!0)]),p("div",gF,[wt(jy,{"player-name":W.name,"event-id":N.value.id,"is-available":b(N.value.id)[W.name],"is-selected":lc(W.name,N.value.id),"chance-percent":((Sn=Xr.value[W.name])==null?void 0:Sn[N.value.id])??null,"show-selected-chance":Vi(N.value.id),onToggle:rl},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance"])])])}),128))])])):fe("",!0),p("div",vF,[p("button",{onClick:sl,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},m[110]||(m[110]=[p("span",null,"✏️",-1),p("span",null,"Modifier",-1)])),p("button",{onClick:m[32]||(m[32]=W=>Cr(N.value)),disabled:(ot=N.value)==null?void 0:ot.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(Tt=N.value)!=null&&Tt.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[111]||(m[111]=[p("span",null,"📢",-1),p("span",null,"Annoncer",-1)]),8,yF),p("button",{onClick:il,class:"px-5 py-3 bg-gradient-to-r from-indigo-500 to-blue-600 text-white rounded-lg hover:from-indigo-600 hover:to-blue-700 transition-all duration-300 flex items-center gap-2",title:(ft=N.value)!=null&&ft.archived?"Désarchiver cet événement":"Archiver cet événement"},[p("span",null,ce((Vt=N.value)!=null&&Vt.archived?"📂":"📁"),1),p("span",null,ce((Nt=N.value)!=null&&Nt.archived?"Désarchiver":"Archiver"),1)],8,_F),p("button",{onClick:m[33]||(m[33]=W=>M(N.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},m[112]||(m[112]=[p("span",null,"🎭",-1),p("span",null,"Sélectionner",-1)])),p("button",{onClick:m[34]||(m[34]=W=>{var Sn;return Ro((Sn=N.value)==null?void 0:Sn.id)}),class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},m[113]||(m[113]=[p("span",null,"🗑️",-1),p("span",null,"Supprimer",-1)])),p("button",{onClick:Uo,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")]),Z.value?(U(),$("div",bF,[p("button",{onClick:m[35]||(m[35]=W=>{sl(),Z.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"},"✏️ Modifier"),p("button",{onClick:m[36]||(m[36]=W=>{Cr(N.value),Z.value=!1}),disabled:(ct=N.value)==null?void 0:ct.archived,class:"w-full px-4 py-3 rounded-lg bg-amber-600/20 text-amber-200 border border-amber-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(Zn=N.value)!=null&&Zn.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[114]||(m[114]=[p("span",null,"📢",-1),p("span",null,"Annoncer",-1)]),8,wF),p("button",{onClick:m[37]||(m[37]=W=>{il(),Z.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-indigo-600/20 text-indigo-200 border border-indigo-500/30"},ce((ns=N.value)!=null&&ns.archived?"📂 Désarchiver":"📁 Archiver"),1),p("button",{onClick:m[38]||(m[38]=W=>{var Sn;Ro((Sn=N.value)==null?void 0:Sn.id),Z.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"},"🗑️ Supprimer")])):fe("",!0)]),p("div",IF,[p("button",{onClick:m[39]||(m[39]=W=>M(N.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),p("button",{onClick:Uo,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),p("button",{onClick:m[40]||(m[40]=W=>Z.value=!Z.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):fe("",!0),wt(QI,{show:ge.value,player:ue.value,seasonId:o.value,onClose:m[42]||(m[42]=W=>ge.value=!1),onVerified:$o},null,8,["show","player","seasonId"]),d.value?(U(),$("div",EF,[p("div",TF,[m[120]||(m[120]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),p("div",xF,[m[115]||(m[115]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),yt(p("input",{"onUpdate:modelValue":m[43]||(m[43]=W=>f.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Rn(Wr,["esc"]),Rn(Co,["enter"])],ref:"editTitleInput"},null,544),[[Ut,f.value]])]),p("div",AF,[m[116]||(m[116]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),yt(p("input",{"onUpdate:modelValue":m[44]||(m[44]=W=>v.value=W),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[Rn(Wr,["esc"]),Rn(Co,["enter"])]},null,544),[[Ut,v.value]])]),p("div",SF,[m[117]||(m[117]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),yt(p("textarea",{"onUpdate:modelValue":m[45]||(m[45]=W=>X.value=W),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:Rn(Wr,["esc"])},null,544),[[Ut,X.value]])]),p("div",PF,[yt(p("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":m[46]||(m[46]=W=>Q.value=W),class:"w-4 h-4"},null,512),[[Sg,Q.value]]),m[118]||(m[118]=p("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),p("div",RF,[m[119]||(m[119]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),yt(p("input",{"onUpdate:modelValue":m[47]||(m[47]=W=>y.value=W),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:Rn(Wr,["esc"])},null,544),[[Ut,y.value]])]),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:Wr,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:Co,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):fe("",!0),wt(VI,{show:V.value,message:No(),error:w.value,"session-info":Rh(),onSubmit:ic,onCancel:Ph},null,8,["show","message","error","session-info"]),He.value?(U(),$("div",CF,[p("div",kF,[m[122]||(m[122]=ur('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),p("div",DF,[p("div",VF,[p("div",null,[m[121]||(m[121]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),yt(p("input",{"onUpdate:modelValue":m[48]||(m[48]=W=>$e.value=W),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[49]||(m[49]=Rn(W=>js($e.value),["enter"])),ref_key:"playerPasswordInputRef",ref:ke},null,544),[[Ut,$e.value]])])]),p("button",{onClick:m[50]||(m[50]=W=>js($e.value)),disabled:!$e.value||je.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[je.value?(U(),$("span",OF,"⏳")):(U(),$("span",MF,"🔓")),p("span",null,ce(je.value?"Vérification...":"Vérifier et supprimer"),1)],8,NF)]),p("div",LF,[p("button",{onClick:m[51]||(m[51]=W=>Ae.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),Xe.value?(U(),$("div",FF,[p("div",UF,ce(Xe.value),1)])):fe("",!0),p("div",{class:"flex justify-center"},[p("button",{onClick:oc,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):fe("",!0),ee.value?(U(),$("div",$F,[p("div",jF,[m[125]||(m[125]=ur('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),p("div",BF,[p("div",qF,[p("div",null,[m[123]||(m[123]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),yt(p("input",{"onUpdate:modelValue":m[52]||(m[52]=W=>Y.value=W),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[53]||(m[53]=Rn(W=>Oo(Y.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:Ze},null,544),[[Ut,Y.value]])])]),p("div",zF,[p("button",{onClick:m[54]||(m[54]=W=>nt.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),H.value?(U(),$("div",GF,[p("div",KF,ce(H.value),1)])):fe("",!0)]),p("div",HF,[p("button",{onClick:Mo,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),p("button",{onClick:m[55]||(m[55]=W=>Oo(Y.value)),disabled:!Y.value||Ve.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[Ve.value?(U(),$("span",QF,"⏳")):(U(),$("span",JF,"🔓")),p("span",null,[Vr(ce(Ve.value?"Vérification...":"Vérifier"),1),m[124]||(m[124]=p("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,WF)])])])):fe("",!0),nt.value?(U(),$("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[58]||(m[58]=W=>nt.value=!1)},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[57]||(m[57]=Ht(()=>{},["stop"]))},[m[127]||(m[127]=ur('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),p("div",YF,[m[126]||(m[126]=p("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),p("button",{onClick:ac,disabled:K.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[K.value?(U(),$("span",ZF,"⏳")):(U(),$("span",e4,"📧")),p("span",null,ce(K.value?"Envoi...":"Envoyer l'email"),1)],8,XF)]),ye.value?(U(),$("div",t4,[p("div",n4,ce(ye.value),1)])):fe("",!0),le.value?(U(),$("div",r4,[p("div",s4,ce(le.value),1)])):fe("",!0),p("div",i4,[p("button",{onClick:m[56]||(m[56]=W=>nt.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):fe("",!0),Ae.value?(U(),$("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[61]||(m[61]=W=>Ae.value=!1)},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[60]||(m[60]=Ht(()=>{},["stop"]))},[m[129]||(m[129]=ur('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),p("div",o4,[m[128]||(m[128]=p("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),p("button",{onClick:Lo,disabled:Ye.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Ye.value?(U(),$("span",l4,"⏳")):(U(),$("span",u4,"📧")),p("span",null,ce(Ye.value?"Envoi...":"Envoyer l'email"),1)],8,a4)]),ht.value?(U(),$("div",c4,[p("div",d4,ce(ht.value),1)])):fe("",!0),T.value?(U(),$("div",h4,[p("div",f4,ce(T.value),1)])):fe("",!0),p("div",p4,[p("button",{onClick:m[59]||(m[59]=W=>Ae.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):fe("",!0),wt(zO,{ref_key:"playerModalRef",ref:k,show:E.value,player:x.value,stats:dc(x.value),seasonId:o.value,"onboarding-step":Ee.value,"onboarding-player-id":j.value,onClose:ol,onUpdate:uc,onDelete:nc,onRefresh:cc,onAdvanceOnboarding:m[62]||(m[62]=W=>{try{typeof Ee.value<"u"&&(Ee.value.value=W)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id"]),wt(SM,{ref_key:"selectionModalRef",ref:Ne,show:Te.value,event:Pe.value,"current-selection":Me.value[(Mi=Pe.value)==null?void 0:Mi.id]||[],"available-count":Do((jo=Pe.value)==null?void 0:jo.id),"selected-count":Ls((Wm=Pe.value)==null?void 0:Wm.id),"player-availability":b((Qm=Pe.value)==null?void 0:Qm.id),"season-id":o.value,"season-slug":fs(s),players:wo.value,onClose:z,onSelection:me,onPerfect:vt,onSendEmailNotifications:g,onUpdateSelection:ln},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),wt(WI,{show:qe.value,event:tt.value,"season-id":o.value,"season-slug":fs(s),players:wo.value,onClose:u,onSendEmailNotifications:g},null,8,["show","event","season-id","season-slug","players"]),wt(NI,{show:fn.value,onClose:m[63]||(m[63]=W=>fn.value=!1)},null,8,["show"]),Gt.value?(U(),$("div",m4,[p("div",g4,[m[130]||(m[130]=p("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),m[131]||(m[131]=p("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),p("div",v4,[p("button",{onClick:m[64]||(m[64]=W=>Cr(Ft.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),p("button",{onClick:h,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):fe("",!0)],64)}}},y4={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},_4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},b4={key:0,class:"text-center py-8"},w4={key:1,class:"text-center py-8"},I4={class:"text-gray-300 mb-6"},E4={key:2,class:"space-y-6"},T4={class:"text-center"},x4={class:"text-gray-300"},A4={class:"font-semibold text-white"},S4={class:"space-y-4"},P4=["disabled"],R4={key:0,class:"animate-spin"},C4={key:1},k4={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},D4={class:"text-red-300 text-sm"},V4={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},N4={class:"text-green-300 text-sm"},O4={__name:"PasswordReset",setup(n){const e=_u(),t=yu(),r=O(!0),s=O(""),i=O(""),o=O(""),a=O(""),l=O(""),c=O(!1),d=O(""),f=O(""),v=Qe(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);Or(async()=>{try{const{oobCode:A}=e.query;if(pe.debug("Token reçu (masqué)"),!A){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=A,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(A){pe.error("Erreur lors de la vérification du lien",A),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function y(){if(v.value){c.value=!0,d.value="",f.value="";try{pe.debug("Début réinitialisation avec token (masqué)"),await Gk(_o,o.value,a.value),pe.info("Mot de passe Firebase Auth mis à jour"),pe.info("Réinitialisation terminée avec Firebase Auth"),f.value="Mot de passe réinitialisé avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{P()},3e3)}catch(A){pe.error("Erreur lors de la réinitialisation",A),A.code==="auth/weak-password"?d.value="Le mot de passe doit contenir au moins 6 caractères":A.code==="auth/invalid-action-code"?d.value="Lien de réinitialisation invalide ou expiré":d.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}function P(){t.push("/")}return(A,R)=>(U(),$("div",y4,[p("div",_4,[R[8]||(R[8]=ur('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(U(),$("div",b4,R[2]||(R[2]=[p("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),p("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(U(),$("div",w4,[R[3]||(R[3]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"❌")],-1)),R[4]||(R[4]=p("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),p("p",I4,ce(s.value),1),p("button",{onClick:P,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):i.value?(U(),$("div",E4,[p("div",T4,[p("p",x4,[R[5]||(R[5]=Vr("Email : ")),p("span",A4,ce(i.value),1)])]),p("div",S4,[p("div",null,[R[6]||(R[6]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),yt(p("input",{"onUpdate:modelValue":R[0]||(R[0]=j=>a.value=j),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:Rn(y,["enter"])},null,544),[[Ut,a.value]])]),p("div",null,[R[7]||(R[7]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),yt(p("input",{"onUpdate:modelValue":R[1]||(R[1]=j=>l.value=j),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:Rn(y,["enter"])},null,544),[[Ut,l.value]])])]),p("button",{onClick:y,disabled:!v.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(U(),$("span",R4,"⏳")):(U(),$("span",C4,"🔑")),p("span",null,ce(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,P4),d.value?(U(),$("div",k4,[p("div",D4,ce(d.value),1)])):fe("",!0),f.value?(U(),$("div",V4,[p("div",N4,ce(f.value),1)])):fe("",!0)])):fe("",!0)])]))}},M4={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},L4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},F4={class:"text-3xl"},U4={class:"text-2xl font-bold text-white mb-2"},$4={class:"text-gray-300 mb-6"},j4={__name:"MagicLink",setup(n){const e=_u(),t=yu(),r=O("loading"),s=O("Traitement en cours..."),i=O("Merci de patienter pendant la validation du lien."),o=Qe(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/")}return Or(async()=>{try{KI("firebase");const l=String(e.query.sid||""),c=String(e.query.pid||"");let d=String(e.query.eid||"");const f=String(e.query.t||""),v=String(e.query.a||""),y=String(e.query.slug||"");if(!l||!c||!f||!v){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(v==="verify_email"&&(d="protection"),!(await UI({seasonId:l,playerId:c,eventId:d,token:f,action:v})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(v==="verify_email"){await BI({playerId:c,seasonId:l}),await np({seasonId:l,playerId:c,eventId:"protection",action:v}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(y?()=>t.push(`/season/${y}?player=${encodeURIComponent(c)}&open=protection&verified=1`):()=>t.push("/"),800);return}const A=Fe(we,"seasons",l,"players",c),R=await Rs(A),j=R.exists()&&R.data().name||"";if(!j){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}await H2({seasonId:l,playerName:j,eventId:d,value:v==="yes"}),await np({seasonId:l,playerId:c,eventId:d,action:v}),r.value="ok",s.value="Merci !",i.value=v==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible.",setTimeout(y?()=>t.push(`/season/${y}/event/${d}`):()=>t.push("/"),1200)}catch(l){pe.error("Magic link error",l),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(U(),$("div",M4,[p("div",L4,[p("div",{class:Hn(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[p("span",F4,ce(o.value),1)],2),p("h1",U4,ce(s.value),1),p("p",$4,ce(i.value),1),p("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},B4={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},q4={class:"text-center py-12 px-4"},z4={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},G4={class:"container mx-auto px-4 pb-16"},K4={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},H4={class:"space-y-5"},W4=["onKeydown"],Q4={class:"flex items-center justify-end gap-3 pt-2"},J4=["disabled"],Y4={key:0,class:"mt-6 text-sm text-gray-200"},X4={__name:"JoinSeason",setup(n){const e=_u(),t=yu(),r=e.params.slug,s=O(""),i=O(""),o=O(""),a=O(!1),l=O("");Or(async()=>{const f=ih(rt(we,"seasons"),Im("slug","==",r)),v=await Ct(f);if(v.empty)l.value="Saison introuvable";else{const y=v.docs[0];s.value=y.id,i.value=y.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function d(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await HI(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){pe.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,v)=>(U(),$("div",B4,[p("div",q4,[p("h1",z4,ce(i.value||"Rejoindre la saison"),1),v[1]||(v[1]=p("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),p("div",G4,[p("div",K4,[v[3]||(v[3]=p("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),p("div",H4,[p("div",null,[v[2]||(v[2]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),yt(p("input",{"onUpdate:modelValue":v[0]||(v[0]=y=>o.value=y),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:Rn(Ht(d,["prevent"]),["enter"])},null,40,W4),[[Ut,o.value]])]),p("div",Q4,[p("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),p("button",{disabled:!o.value.trim()||a.value,onClick:d,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,J4)])]),l.value?(U(),$("div",Y4,ce(l.value),1)):fe("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const Z4=[{path:"/",component:O2},{path:"/season/:slug",component:By,props:!0},{path:"/season/:slug/event/:eventId",component:By,props:!0},{path:"/season/:slug/join",component:X4,props:!0},{path:"/reset-password",component:O4},{path:"/magic",component:j4}],e3=bA({history:Qx("/"),routes:Z4});mx(yx).use(e3).mount("#app");export{rt as $,Fw as A,co as B,jr as C,nn as D,iU as E,fo as F,fm as G,sU as H,i3 as I,fr as J,uC as K,dC as L,ch as M,k3 as N,D3 as O,OC as P,Tn as Q,I3 as R,c3 as S,qt as T,J3 as U,eh as V,VC as W,Q3 as X,C3 as Y,f3 as Z,P0 as _,su as a,ju as a$,l3 as a0,cC as a1,IC as a2,rU as a3,au as a4,W3 as a5,g3 as a6,nU as a7,Fe as a8,b3 as a9,_3 as aA,F3 as aB,U3 as aC,w3 as aD,bC as aE,z3 as aF,G3 as aG,kC as aH,ih as aI,Tw as aJ,u3 as aK,H3 as aL,Lu as aM,Vn as aN,Z3 as aO,t3 as aP,V3 as aQ,A3 as aR,x3 as aS,R3 as aT,v3 as aU,Ou as aV,X3 as aW,p3 as aX,Im as aY,Uw as aZ,dU as a_,fC as aa,h3 as ab,m3 as ac,tU as ad,P3 as ae,S3 as af,zt as ag,Mu as ah,TC as ai,$3 as aj,Rs as ak,N3 as al,O3 as am,Ct as an,M3 as ao,L3 as ap,hC as aq,eU as ar,Y3 as as,d3 as at,E3 as au,T3 as av,y3 as aw,j3 as ax,q3 as ay,B3 as az,pC as b,$k as b$,$u as b0,fU as b1,du as b2,vo as b3,ei as b4,aU as b5,ni as b6,ti as b7,Is as b8,Bc as b9,WC as bA,FU as bB,YU as bC,by as bD,TD as bE,mk as bF,CU as bG,wU as bH,jk as bI,BU as bJ,HU as bK,JU as bL,UU as bM,DU as bN,rD as bO,mU as bP,LC as bQ,Bk as bR,qU as bS,KU as bT,QU as bU,YC as bV,MU as bW,TU as bX,zk as bY,bU as bZ,RU as b_,cU as ba,Zi as bb,ha as bc,SV as bd,lU as be,$U as bf,Yf as bg,uU as bh,PV as bi,Gm as bj,ri as bk,yU as bl,sD as bm,hD as bn,AV as bo,bI as bp,Kk as bq,Gk as br,vk as bs,Hk as bt,hU as bu,LU as bv,EU as bw,PU as bx,OV as by,pU as bz,Da as c,Nm as c0,vU as c1,Wk as c2,IU as c3,jU as c4,GU as c5,WU as c6,OU as c7,gU as c8,NU as c9,SU as ca,Yk as cb,zU as cc,AU as cd,VU as ce,kU as cf,xU as cg,_U as ch,po as d,St as e,ne as f,Ka as g,Vu as h,Uc as i,lh as j,Nu as k,oh as l,Em as m,Va as n,ah as o,Wi as p,NC as q,Wt as r,no as s,Ie as t,r3 as u,nP as v,jt as w,oU as x,st as y,n3 as z};
