(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function zm(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const Gt={},ol=[],ss=()=>{},G1=()=>!1,Uh=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Hm=n=>n.startsWith("onUpdate:"),Dn=Object.assign,Km=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},W1=Object.prototype.hasOwnProperty,Lt=(n,e)=>W1.call(n,e),Ke=Array.isArray,al=n=>Rc(n)==="[object Map]",Fl=n=>Rc(n)==="[object Set]",Ny=n=>Rc(n)==="[object Date]",et=n=>typeof n=="function",gn=n=>typeof n=="string",as=n=>typeof n=="symbol",Wt=n=>n!==null&&typeof n=="object",Jb=n=>(Wt(n)||et(n))&&et(n.then)&&et(n.catch),Yb=Object.prototype.toString,Rc=n=>Yb.call(n),Q1=n=>Rc(n).slice(8,-1),Xb=n=>Rc(n)==="[object Object]",Gm=n=>gn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Du=zm(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),jh=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},J1=/-(\w)/g,Jr=jh(n=>n.replace(J1,(e,t)=>t?t.toUpperCase():"")),Y1=/\B([A-Z])/g,go=jh(n=>n.replace(Y1,"-$1").toLowerCase()),Bh=jh(n=>n.charAt(0).toUpperCase()+n.slice(1)),np=jh(n=>n?`on${Bh(n)}`:""),eo=(n,e)=>!Object.is(n,e),$d=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},qp=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},ih=n=>{const e=parseFloat(n);return isNaN(e)?n:e},X1=n=>{const e=gn(n)?Number(n):NaN;return isNaN(e)?n:e};let Oy;const qh=()=>Oy||(Oy=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Mr(n){if(Ke(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=gn(r)?nS(r):Mr(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(gn(n)||Wt(n))return n}const Z1=/;(?![^(]*\))/g,eS=/:([^]+)/,tS=/\/\*[^]*?\*\//g;function nS(n){const e={};return n.replace(tS,"").split(Z1).forEach(t=>{if(t){const r=t.split(eS);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function dn(n){let e="";if(gn(n))e=n;else if(Ke(n))for(let t=0;t<n.length;t++){const r=dn(n[t]);r&&(e+=r+" ")}else if(Wt(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const rS="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",sS=zm(rS);function Zb(n){return!!n||n===""}function iS(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=Cc(n[r],e[r]);return t}function Cc(n,e){if(n===e)return!0;let t=Ny(n),r=Ny(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=as(n),r=as(e),t||r)return n===e;if(t=Ke(n),r=Ke(e),t||r)return t&&r?iS(n,e):!1;if(t=Wt(n),r=Wt(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!Cc(n[o],e[o]))return!1}}return String(n)===String(e)}function Wm(n,e){return n.findIndex(t=>Cc(t,e))}const ew=n=>!!(n&&n.__v_isRef===!0),ee=n=>gn(n)?n:n==null?"":Ke(n)||Wt(n)&&(n.toString===Yb||!et(n.toString))?ew(n)?ee(n.value):JSON.stringify(n,tw,2):String(n),tw=(n,e)=>ew(e)?tw(n,e.value):al(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[rp(r,i)+" =>"]=s,t),{})}:Fl(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>rp(t))}:as(e)?rp(e):Wt(e)&&!Ke(e)&&!Xb(e)?String(e):e,rp=(n,e="")=>{var t;return as(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Tr;class oS{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Tr,!e&&Tr&&(this.index=(Tr.scopes||(Tr.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Tr;try{return Tr=this,e()}finally{Tr=t}}}on(){++this._on===1&&(this.prevScope=Tr,Tr=this)}off(){this._on>0&&--this._on===0&&(Tr=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function aS(){return Tr}let Yt;const sp=new WeakSet;class nw{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Tr&&Tr.active&&Tr.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,sp.has(this)&&(sp.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||sw(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Vy(this),iw(this);const e=Yt,t=is;Yt=this,is=!0;try{return this.fn()}finally{ow(this),Yt=e,is=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Ym(e);this.deps=this.depsTail=void 0,Vy(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?sp.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){zp(this)&&this.run()}get dirty(){return zp(this)}}let rw=0,Nu,Ou;function sw(n,e=!1){if(n.flags|=8,e){n.next=Ou,Ou=n;return}n.next=Nu,Nu=n}function Qm(){rw++}function Jm(){if(--rw>0)return;if(Ou){let e=Ou;for(Ou=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Nu;){let e=Nu;for(Nu=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function iw(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function ow(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),Ym(r),lS(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function zp(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(aw(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function aw(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Ju)||(n.globalVersion=Ju,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!zp(n))))return;n.flags|=2;const e=n.dep,t=Yt,r=is;Yt=n,is=!0;try{iw(n);const s=n.fn(n._value);(e.version===0||eo(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{Yt=t,is=r,ow(n),n.flags&=-3}}function Ym(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)Ym(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function lS(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let is=!0;const lw=[];function si(){lw.push(is),is=!1}function ii(){const n=lw.pop();is=n===void 0?!0:n}function Vy(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Yt;Yt=void 0;try{e()}finally{Yt=t}}}let Ju=0;class uS{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Xm{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Yt||!is||Yt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Yt)t=this.activeLink=new uS(Yt,this),Yt.deps?(t.prevDep=Yt.depsTail,Yt.depsTail.nextDep=t,Yt.depsTail=t):Yt.deps=Yt.depsTail=t,uw(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=Yt.depsTail,t.nextDep=void 0,Yt.depsTail.nextDep=t,Yt.depsTail=t,Yt.deps===t&&(Yt.deps=r)}return t}trigger(e){this.version++,Ju++,this.notify(e)}notify(e){Qm();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Jm()}}}function uw(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)uw(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const Hp=new WeakMap,ta=Symbol(""),Kp=Symbol(""),Yu=Symbol("");function ur(n,e,t){if(is&&Yt){let r=Hp.get(n);r||Hp.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new Xm),s.map=r,s.key=t),s.track()}}function Ks(n,e,t,r,s,i){const o=Hp.get(n);if(!o){Ju++;return}const a=l=>{l&&l.trigger()};if(Qm(),e==="clear")o.forEach(a);else{const l=Ke(n),c=l&&Gm(t);if(l&&t==="length"){const d=Number(r);o.forEach((f,g)=>{(g==="length"||g===Yu||!as(g)&&g>=d)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(Yu)),e){case"add":l?c&&a(o.get("length")):(a(o.get(ta)),al(n)&&a(o.get(Kp)));break;case"delete":l||(a(o.get(ta)),al(n)&&a(o.get(Kp)));break;case"set":al(n)&&a(o.get(ta));break}}Jm()}function Ga(n){const e=Nt(n);return e===n?e:(ur(e,"iterate",Yu),Wr(n)?e:e.map(Yn))}function zh(n){return ur(n=Nt(n),"iterate",Yu),n}const cS={__proto__:null,[Symbol.iterator](){return ip(this,Symbol.iterator,Yn)},concat(...n){return Ga(this).concat(...n.map(e=>Ke(e)?Ga(e):e))},entries(){return ip(this,"entries",n=>(n[1]=Yn(n[1]),n))},every(n,e){return js(this,"every",n,e,void 0,arguments)},filter(n,e){return js(this,"filter",n,e,t=>t.map(Yn),arguments)},find(n,e){return js(this,"find",n,e,Yn,arguments)},findIndex(n,e){return js(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return js(this,"findLast",n,e,Yn,arguments)},findLastIndex(n,e){return js(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return js(this,"forEach",n,e,void 0,arguments)},includes(...n){return op(this,"includes",n)},indexOf(...n){return op(this,"indexOf",n)},join(n){return Ga(this).join(n)},lastIndexOf(...n){return op(this,"lastIndexOf",n)},map(n,e){return js(this,"map",n,e,void 0,arguments)},pop(){return hu(this,"pop")},push(...n){return hu(this,"push",n)},reduce(n,...e){return My(this,"reduce",n,e)},reduceRight(n,...e){return My(this,"reduceRight",n,e)},shift(){return hu(this,"shift")},some(n,e){return js(this,"some",n,e,void 0,arguments)},splice(...n){return hu(this,"splice",n)},toReversed(){return Ga(this).toReversed()},toSorted(n){return Ga(this).toSorted(n)},toSpliced(...n){return Ga(this).toSpliced(...n)},unshift(...n){return hu(this,"unshift",n)},values(){return ip(this,"values",Yn)}};function ip(n,e,t){const r=zh(n),s=r[e]();return r!==n&&!Wr(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const dS=Array.prototype;function js(n,e,t,r,s,i){const o=zh(n),a=o!==n&&!Wr(n),l=o[e];if(l!==dS[e]){const f=l.apply(n,i);return a?Yn(f):f}let c=t;o!==n&&(a?c=function(f,g){return t.call(this,Yn(f),g,n)}:t.length>2&&(c=function(f,g){return t.call(this,f,g,n)}));const d=l.call(o,c,r);return a&&s?s(d):d}function My(n,e,t,r){const s=zh(n);let i=t;return s!==n&&(Wr(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,Yn(a),l,n)}),s[e](i,...r)}function op(n,e,t){const r=Nt(n);ur(r,"iterate",Yu);const s=r[e](...t);return(s===-1||s===!1)&&tg(t[0])?(t[0]=Nt(t[0]),r[e](...t)):s}function hu(n,e,t=[]){si(),Qm();const r=Nt(n)[e].apply(n,t);return Jm(),ii(),r}const hS=zm("__proto__,__v_isRef,__isVue"),cw=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(as));function fS(n){as(n)||(n=String(n));const e=Nt(this);return ur(e,"has",n),e.hasOwnProperty(n)}class dw{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?IS:mw:i?pw:fw).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=Ke(e);if(!s){let l;if(o&&(l=cS[t]))return l;if(t==="hasOwnProperty")return fS}const a=Reflect.get(e,t,dr(e)?e:r);return(as(t)?cw.has(t):hS(t))||(s||ur(e,"get",t),i)?a:dr(a)?o&&Gm(t)?a:a.value:Wt(a)?s?vw(a):Hh(a):a}}class hw extends dw{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=so(i);if(!Wr(r)&&!so(r)&&(i=Nt(i),r=Nt(r)),!Ke(e)&&dr(i)&&!dr(r))return l?!1:(i.value=r,!0)}const o=Ke(e)&&Gm(t)?Number(t)<e.length:Lt(e,t),a=Reflect.set(e,t,r,dr(e)?e:s);return e===Nt(s)&&(o?eo(r,i)&&Ks(e,"set",t,r):Ks(e,"add",t,r)),a}deleteProperty(e,t){const r=Lt(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&Ks(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!as(t)||!cw.has(t))&&ur(e,"has",t),r}ownKeys(e){return ur(e,"iterate",Ke(e)?"length":ta),Reflect.ownKeys(e)}}class pS extends dw{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const mS=new hw,gS=new pS,vS=new hw(!0);const Gp=n=>n,wd=n=>Reflect.getPrototypeOf(n);function yS(n,e,t){return function(...r){const s=this.__v_raw,i=Nt(s),o=al(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),d=t?Gp:e?oh:Yn;return!e&&ur(i,"iterate",l?Kp:ta),{next(){const{value:f,done:g}=c.next();return g?{value:f,done:g}:{value:a?[d(f[0]),d(f[1])]:d(f),done:g}},[Symbol.iterator](){return this}}}}function xd(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function _S(n,e){const t={get(s){const i=this.__v_raw,o=Nt(i),a=Nt(s);n||(eo(s,a)&&ur(o,"get",s),ur(o,"get",a));const{has:l}=wd(o),c=e?Gp:n?oh:Yn;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&ur(Nt(s),"iterate",ta),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=Nt(i),a=Nt(s);return n||(eo(s,a)&&ur(o,"has",s),ur(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=Nt(a),c=e?Gp:n?oh:Yn;return!n&&ur(l,"iterate",ta),a.forEach((d,f)=>s.call(i,c(d),c(f),o))}};return Dn(t,n?{add:xd("add"),set:xd("set"),delete:xd("delete"),clear:xd("clear")}:{add(s){!e&&!Wr(s)&&!so(s)&&(s=Nt(s));const i=Nt(this);return wd(i).has.call(i,s)||(i.add(s),Ks(i,"add",s,s)),this},set(s,i){!e&&!Wr(i)&&!so(i)&&(i=Nt(i));const o=Nt(this),{has:a,get:l}=wd(o);let c=a.call(o,s);c||(s=Nt(s),c=a.call(o,s));const d=l.call(o,s);return o.set(s,i),c?eo(i,d)&&Ks(o,"set",s,i):Ks(o,"add",s,i),this},delete(s){const i=Nt(this),{has:o,get:a}=wd(i);let l=o.call(i,s);l||(s=Nt(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&Ks(i,"delete",s,void 0),c},clear(){const s=Nt(this),i=s.size!==0,o=s.clear();return i&&Ks(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=yS(s,n,e)}),t}function Zm(n,e){const t=_S(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(Lt(t,s)&&s in r?t:r,s,i)}const bS={get:Zm(!1,!1)},wS={get:Zm(!1,!0)},xS={get:Zm(!0,!1)};const fw=new WeakMap,pw=new WeakMap,mw=new WeakMap,IS=new WeakMap;function ES(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function TS(n){return n.__v_skip||!Object.isExtensible(n)?0:ES(Q1(n))}function Hh(n){return so(n)?n:eg(n,!1,mS,bS,fw)}function gw(n){return eg(n,!1,vS,wS,pw)}function vw(n){return eg(n,!0,gS,xS,mw)}function eg(n,e,t,r,s){if(!Wt(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=TS(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function ll(n){return so(n)?ll(n.__v_raw):!!(n&&n.__v_isReactive)}function so(n){return!!(n&&n.__v_isReadonly)}function Wr(n){return!!(n&&n.__v_isShallow)}function tg(n){return n?!!n.__v_raw:!1}function Nt(n){const e=n&&n.__v_raw;return e?Nt(e):n}function AS(n){return!Lt(n,"__v_skip")&&Object.isExtensible(n)&&qp(n,"__v_skip",!0),n}const Yn=n=>Wt(n)?Hh(n):n,oh=n=>Wt(n)?vw(n):n;function dr(n){return n?n.__v_isRef===!0:!1}function S(n){return yw(n,!1)}function SS(n){return yw(n,!0)}function yw(n,e){return dr(n)?n:new PS(n,e)}class PS{constructor(e,t){this.dep=new Xm,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Nt(e),this._value=t?e:Yn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Wr(e)||so(e);e=r?e:Nt(e),eo(e,t)&&(this._rawValue=e,this._value=r?e:Yn(e),this.dep.trigger())}}function $r(n){return dr(n)?n.value:n}const RS={get:(n,e,t)=>e==="__v_raw"?n:$r(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return dr(s)&&!dr(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function _w(n){return ll(n)?n:new Proxy(n,RS)}class CS{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Xm(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Ju-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Yt!==this)return sw(this,!0),!0}get value(){const e=this.dep.track();return aw(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function kS(n,e,t=!1){let r,s;return et(n)?r=n:(r=n.get,s=n.set),new CS(r,s,t)}const Id={},ah=new WeakMap;let jo;function DS(n,e=!1,t=jo){if(t){let r=ah.get(t);r||ah.set(t,r=[]),r.push(n)}}function NS(n,e,t=Gt){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=z=>s?z:Wr(z)||s===!1||s===0?Gs(z,1):Gs(z);let d,f,g,v,x=!1,w=!1;if(dr(n)?(f=()=>n.value,x=Wr(n)):ll(n)?(f=()=>c(n),x=!0):Ke(n)?(w=!0,x=n.some(z=>ll(z)||Wr(z)),f=()=>n.map(z=>{if(dr(z))return z.value;if(ll(z))return c(z);if(et(z))return l?l(z,2):z()})):et(n)?e?f=l?()=>l(n,2):n:f=()=>{if(g){si();try{g()}finally{ii()}}const z=jo;jo=d;try{return l?l(n,3,[v]):n(v)}finally{jo=z}}:f=ss,e&&s){const z=f,le=s===!0?1/0:s;f=()=>Gs(z(),le)}const I=aS(),L=()=>{d.stop(),I&&I.active&&Km(I.effects,d)};if(i&&e){const z=e;e=(...le)=>{z(...le),L()}}let $=w?new Array(n.length).fill(Id):Id;const U=z=>{if(!(!(d.flags&1)||!d.dirty&&!z))if(e){const le=d.run();if(s||x||(w?le.some((Z,A)=>eo(Z,$[A])):eo(le,$))){g&&g();const Z=jo;jo=d;try{const A=[le,$===Id?void 0:w&&$[0]===Id?[]:$,v];$=le,l?l(e,3,A):e(...A)}finally{jo=Z}}}else d.run()};return a&&a(U),d=new nw(f),d.scheduler=o?()=>o(U,!1):U,v=z=>DS(z,!1,d),g=d.onStop=()=>{const z=ah.get(d);if(z){if(l)l(z,4);else for(const le of z)le();ah.delete(d)}},e?r?U(!0):$=d.run():o?o(U.bind(null,!0),!0):d.run(),L.pause=d.pause.bind(d),L.resume=d.resume.bind(d),L.stop=L,L}function Gs(n,e=1/0,t){if(e<=0||!Wt(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,dr(n))Gs(n.value,e,t);else if(Ke(n))for(let r=0;r<n.length;r++)Gs(n[r],e,t);else if(Fl(n)||al(n))n.forEach(r=>{Gs(r,e,t)});else if(Xb(n)){for(const r in n)Gs(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&Gs(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function kc(n,e,t,r){try{return r?n(...r):n()}catch(s){Kh(s,e,t)}}function ls(n,e,t,r){if(et(n)){const s=kc(n,e,t,r);return s&&Jb(s)&&s.catch(i=>{Kh(i,e,t)}),s}if(Ke(n)){const s=[];for(let i=0;i<n.length;i++)s.push(ls(n[i],e,t,r));return s}}function Kh(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||Gt;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const d=a.ec;if(d){for(let f=0;f<d.length;f++)if(d[f](n,l,c)===!1)return}a=a.parent}if(i){si(),kc(i,null,10,[n,l,c]),ii();return}}OS(n,t,s,r,o)}function OS(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const br=[];let ws=-1;const ul=[];let $i=null,Xa=0;const bw=Promise.resolve();let lh=null;function jt(n){const e=lh||bw;return n?e.then(this?n.bind(this):n):e}function VS(n){let e=ws+1,t=br.length;for(;e<t;){const r=e+t>>>1,s=br[r],i=Xu(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function ng(n){if(!(n.flags&1)){const e=Xu(n),t=br[br.length-1];!t||!(n.flags&2)&&e>=Xu(t)?br.push(n):br.splice(VS(e),0,n),n.flags|=1,ww()}}function ww(){lh||(lh=bw.then(Iw))}function MS(n){Ke(n)?ul.push(...n):$i&&n.id===-1?$i.splice(Xa+1,0,n):n.flags&1||(ul.push(n),n.flags|=1),ww()}function Ly(n,e,t=ws+1){for(;t<br.length;t++){const r=br[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;br.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function xw(n){if(ul.length){const e=[...new Set(ul)].sort((t,r)=>Xu(t)-Xu(r));if(ul.length=0,$i){$i.push(...e);return}for($i=e,Xa=0;Xa<$i.length;Xa++){const t=$i[Xa];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}$i=null,Xa=0}}const Xu=n=>n.id==null?n.flags&2?-1:1/0:n.id;function Iw(n){const e=ss;try{for(ws=0;ws<br.length;ws++){const t=br[ws];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),kc(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;ws<br.length;ws++){const t=br[ws];t&&(t.flags&=-2)}ws=-1,br.length=0,xw(),lh=null,(br.length||ul.length)&&Iw()}}let zn=null,Ew=null;function uh(n){const e=zn;return zn=n,Ew=n&&n.type.__scopeId||null,e}function Fd(n,e=zn,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&Jy(-1);const i=uh(e);let o;try{o=n(...s)}finally{uh(i),r._d&&Jy(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function it(n,e){if(zn===null)return n;const t=Yh(zn),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=Gt]=e[s];i&&(et(i)&&(i={mounted:i,updated:i}),i.deep&&Gs(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function Mo(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(si(),ls(l,t,8,[n.el,a,n,e]),ii())}}const Tw=Symbol("_vte"),Aw=n=>n.__isTeleport,Vu=n=>n&&(n.disabled||n.disabled===""),$y=n=>n&&(n.defer||n.defer===""),Fy=n=>typeof SVGElement<"u"&&n instanceof SVGElement,Uy=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,Wp=(n,e)=>{const t=n&&n.to;return gn(t)?e?e(t):null:t},Sw={name:"Teleport",__isTeleport:!0,process(n,e,t,r,s,i,o,a,l,c){const{mc:d,pc:f,pbc:g,o:{insert:v,querySelector:x,createText:w,createComment:I}}=c,L=Vu(e.props);let{shapeFlag:$,children:U,dynamicChildren:z}=e;if(n==null){const le=e.el=w(""),Z=e.anchor=w("");v(le,t,r),v(Z,t,r);const A=(E,D)=>{$&16&&(s&&s.isCE&&(s.ce._teleportTarget=E),d(U,E,D,s,i,o,a,l))},b=()=>{const E=e.target=Wp(e.props,x),D=Pw(E,e,w,v);E&&(o!=="svg"&&Fy(E)?o="svg":o!=="mathml"&&Uy(E)&&(o="mathml"),L||(A(E,D),Ud(e,!1)))};L&&(A(t,Z),Ud(e,!0)),$y(e.props)?(e.el.__isMounted=!1,_r(()=>{b(),delete e.el.__isMounted},i)):b()}else{if($y(e.props)&&n.el.__isMounted===!1){_r(()=>{Sw.process(n,e,t,r,s,i,o,a,l,c)},i);return}e.el=n.el,e.targetStart=n.targetStart;const le=e.anchor=n.anchor,Z=e.target=n.target,A=e.targetAnchor=n.targetAnchor,b=Vu(n.props),E=b?t:Z,D=b?le:A;if(o==="svg"||Fy(Z)?o="svg":(o==="mathml"||Uy(Z))&&(o="mathml"),z?(g(n.dynamicChildren,z,E,s,i,o,a),ag(n,e,!0)):l||f(n,e,E,D,s,i,o,a,!1),L)b?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):Ed(e,t,le,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const F=e.target=Wp(e.props,x);F&&Ed(e,F,null,c,0)}else b&&Ed(e,Z,A,c,1);Ud(e,L)}},remove(n,e,t,{um:r,o:{remove:s}},i){const{shapeFlag:o,children:a,anchor:l,targetStart:c,targetAnchor:d,target:f,props:g}=n;if(f&&(s(c),s(d)),i&&s(l),o&16){const v=i||!Vu(g);for(let x=0;x<a.length;x++){const w=a[x];r(w,e,t,v,!!w.dynamicChildren)}}},move:Ed,hydrate:LS};function Ed(n,e,t,{o:{insert:r},m:s},i=2){i===0&&r(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:d}=n,f=i===2;if(f&&r(o,e,t),(!f||Vu(d))&&l&16)for(let g=0;g<c.length;g++)s(c[g],e,t,2);f&&r(a,e,t)}function LS(n,e,t,r,s,i,{o:{nextSibling:o,parentNode:a,querySelector:l,insert:c,createText:d}},f){const g=e.target=Wp(e.props,l);if(g){const v=Vu(e.props),x=g._lpa||g.firstChild;if(e.shapeFlag&16)if(v)e.anchor=f(o(n),e,a(n),t,r,s,i),e.targetStart=x,e.targetAnchor=x&&o(x);else{e.anchor=o(n);let w=x;for(;w;){if(w&&w.nodeType===8){if(w.data==="teleport start anchor")e.targetStart=w;else if(w.data==="teleport anchor"){e.targetAnchor=w,g._lpa=e.targetAnchor&&o(e.targetAnchor);break}}w=o(w)}e.targetAnchor||Pw(g,e,d,c),f(x&&o(x),e,g,t,r,s,i)}Ud(e,v)}return e.anchor&&o(e.anchor)}const Zu=Sw;function Ud(n,e){const t=n.ctx;if(t&&t.ut){let r,s;for(e?(r=n.el,s=n.anchor):(r=n.targetStart,s=n.targetAnchor);r&&r!==s;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function Pw(n,e,t,r){const s=e.targetStart=t(""),i=e.targetAnchor=t("");return s[Tw]=i,n&&(r(s,n),r(i,n)),i}const Fi=Symbol("_leaveCb"),Td=Symbol("_enterCb");function $S(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return An(()=>{n.isMounted=!0}),rg(()=>{n.isUnmounting=!0}),n}const Gr=[Function,Array],Rw={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Gr,onEnter:Gr,onAfterEnter:Gr,onEnterCancelled:Gr,onBeforeLeave:Gr,onLeave:Gr,onAfterLeave:Gr,onLeaveCancelled:Gr,onBeforeAppear:Gr,onAppear:Gr,onAfterAppear:Gr,onAppearCancelled:Gr},Cw=n=>{const e=n.subTree;return e.component?Cw(e.component):e},FS={name:"BaseTransition",props:Rw,setup(n,{slots:e}){const t=MP(),r=$S();return()=>{const s=e.default&&Nw(e.default(),!0);if(!s||!s.length)return;const i=kw(s),o=Nt(n),{mode:a}=o;if(r.isLeaving)return ap(i);const l=jy(i);if(!l)return ap(i);let c=Qp(l,o,r,t,f=>c=f);l.type!==cr&&ec(l,c);let d=t.subTree&&jy(t.subTree);if(d&&d.type!==cr&&!Ko(l,d)&&Cw(t).type!==cr){let f=Qp(d,o,r,t);if(ec(d,f),a==="out-in"&&l.type!==cr)return r.isLeaving=!0,f.afterLeave=()=>{r.isLeaving=!1,t.job.flags&8||t.update(),delete f.afterLeave,d=void 0},ap(i);a==="in-out"&&l.type!==cr?f.delayLeave=(g,v,x)=>{const w=Dw(r,d);w[String(d.key)]=d,g[Fi]=()=>{v(),g[Fi]=void 0,delete c.delayedLeave,d=void 0},c.delayedLeave=()=>{x(),delete c.delayedLeave,d=void 0}}:d=void 0}else d&&(d=void 0);return i}}};function kw(n){let e=n[0];if(n.length>1){for(const t of n)if(t.type!==cr){e=t;break}}return e}const US=FS;function Dw(n,e){const{leavingVNodes:t}=n;let r=t.get(e.type);return r||(r=Object.create(null),t.set(e.type,r)),r}function Qp(n,e,t,r,s){const{appear:i,mode:o,persisted:a=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:d,onEnterCancelled:f,onBeforeLeave:g,onLeave:v,onAfterLeave:x,onLeaveCancelled:w,onBeforeAppear:I,onAppear:L,onAfterAppear:$,onAppearCancelled:U}=e,z=String(n.key),le=Dw(t,n),Z=(E,D)=>{E&&ls(E,r,9,D)},A=(E,D)=>{const F=D[1];Z(E,D),Ke(E)?E.every(V=>V.length<=1)&&F():E.length<=1&&F()},b={mode:o,persisted:a,beforeEnter(E){let D=l;if(!t.isMounted)if(i)D=I||l;else return;E[Fi]&&E[Fi](!0);const F=le[z];F&&Ko(n,F)&&F.el[Fi]&&F.el[Fi](),Z(D,[E])},enter(E){let D=c,F=d,V=f;if(!t.isMounted)if(i)D=L||c,F=$||d,V=U||f;else return;let C=!1;const Fe=E[Td]=vt=>{C||(C=!0,vt?Z(V,[E]):Z(F,[E]),b.delayedLeave&&b.delayedLeave(),E[Td]=void 0)};D?A(D,[E,Fe]):Fe()},leave(E,D){const F=String(n.key);if(E[Td]&&E[Td](!0),t.isUnmounting)return D();Z(g,[E]);let V=!1;const C=E[Fi]=Fe=>{V||(V=!0,D(),Fe?Z(w,[E]):Z(x,[E]),E[Fi]=void 0,le[F]===n&&delete le[F])};le[F]=n,v?A(v,[E,C]):C()},clone(E){const D=Qp(E,e,t,r,s);return s&&s(D),D}};return b}function ap(n){if(Gh(n))return n=io(n),n.children=null,n}function jy(n){if(!Gh(n))return Aw(n.type)&&n.children?kw(n.children):n;if(n.component)return n.component.subTree;const{shapeFlag:e,children:t}=n;if(t){if(e&16)return t[0];if(e&32&&et(t.default))return t.default()}}function ec(n,e){n.shapeFlag&6&&n.component?(n.transition=e,ec(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function Nw(n,e=!1,t){let r=[],s=0;for(let i=0;i<n.length;i++){let o=n[i];const a=t==null?o.key:String(t)+String(o.key!=null?o.key:i);o.type===bt?(o.patchFlag&128&&s++,r=r.concat(Nw(o.children,e,a))):(e||o.type!==cr)&&r.push(a!=null?io(o,{key:a}):o)}if(s>1)for(let i=0;i<r.length;i++)r[i].patchFlag=-2;return r}/*! #__NO_SIDE_EFFECTS__ */function Ow(n,e){return et(n)?(()=>Dn({name:n.name},e,{setup:n}))():n}function Vw(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function Mu(n,e,t,r,s=!1){if(Ke(n)){n.forEach((x,w)=>Mu(x,e&&(Ke(e)?e[w]:e),t,r,s));return}if(cl(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&Mu(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?Yh(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,d=a.refs===Gt?a.refs={}:a.refs,f=a.setupState,g=Nt(f),v=f===Gt?()=>!1:x=>Lt(g,x);if(c!=null&&c!==l&&(gn(c)?(d[c]=null,v(c)&&(f[c]=null)):dr(c)&&(c.value=null)),et(l))kc(l,a,12,[o,d]);else{const x=gn(l),w=dr(l);if(x||w){const I=()=>{if(n.f){const L=x?v(l)?f[l]:d[l]:l.value;s?Ke(L)&&Km(L,i):Ke(L)?L.includes(i)||L.push(i):x?(d[l]=[i],v(l)&&(f[l]=d[l])):(l.value=[i],n.k&&(d[n.k]=l.value))}else x?(d[l]=o,v(l)&&(f[l]=o)):w&&(l.value=o,n.k&&(d[n.k]=o))};o?(I.id=-1,_r(I,t)):I()}}}qh().requestIdleCallback;qh().cancelIdleCallback;const cl=n=>!!n.type.__asyncLoader,Gh=n=>n.type.__isKeepAlive;function jS(n,e){Mw(n,"a",e)}function BS(n,e){Mw(n,"da",e)}function Mw(n,e,t=Xn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(Wh(e,r,t),t){let s=t.parent;for(;s&&s.parent;)Gh(s.parent.vnode)&&qS(r,e,t,s),s=s.parent}}function qS(n,e,t,r){const s=Wh(e,n,r,!0);Zs(()=>{Km(r[e],s)},t)}function Wh(n,e,t=Xn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{si();const a=Dc(t),l=ls(e,t,n,o);return a(),ii(),l});return r?s.unshift(i):s.push(i),i}}const hi=n=>(e,t=Xn)=>{(!rc||n==="sp")&&Wh(n,(...r)=>e(...r),t)},zS=hi("bm"),An=hi("m"),HS=hi("bu"),KS=hi("u"),rg=hi("bum"),Zs=hi("um"),GS=hi("sp"),WS=hi("rtg"),QS=hi("rtc");function JS(n,e=Xn){Wh("ec",n,e)}const Lw="components";function YS(n,e){return ZS(Lw,n,!0,e)||n}const XS=Symbol.for("v-ndc");function ZS(n,e,t=!0,r=!1){const s=zn||Xn;if(s){const i=s.type;if(n===Lw){const a=jP(i,!1);if(a&&(a===e||a===Jr(e)||a===Bh(Jr(e))))return i}const o=By(s[n]||i[n],e)||By(s.appContext[n],e);return!o&&r?i:o}}function By(n,e){return n&&(n[e]||n[Jr(e)]||n[Bh(Jr(e))])}function Lr(n,e,t,r){let s;const i=t&&t[r],o=Ke(n);if(o||gn(n)){const a=o&&ll(n);let l=!1,c=!1;a&&(l=!Wr(n),c=so(n),n=zh(n)),s=new Array(n.length);for(let d=0,f=n.length;d<f;d++)s[d]=e(l?c?oh(Yn(n[d])):Yn(n[d]):n[d],d,void 0,i&&i[d])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(Wt(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const d=a[l];s[l]=e(n[d],d,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}function eP(n,e,t={},r,s){if(zn.ce||zn.parent&&cl(zn.parent)&&zn.parent.ce)return e!=="default"&&(t.name=e),k(),ei(bt,null,[je("slot",t,r&&r())],64);let i=n[e];i&&i._c&&(i._d=!1),k();const o=i&&$w(i(t)),a=t.key||o&&o.key,l=ei(bt,{key:(a&&!as(a)?a:`_${e}`)+(!o&&r?"_fb":"")},o||(r?r():[]),o&&n._===1?64:-2);return!s&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),i&&i._c&&(i._d=!0),l}function $w(n){return n.some(e=>nc(e)?!(e.type===cr||e.type===bt&&!$w(e.children)):!0)?n:null}const Jp=n=>n?nx(n)?Yh(n):Jp(n.parent):null,Lu=Dn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Jp(n.parent),$root:n=>Jp(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>sg(n),$forceUpdate:n=>n.f||(n.f=()=>{ng(n.update)}),$nextTick:n=>n.n||(n.n=jt.bind(n.proxy)),$watch:n=>wP.bind(n)}),lp=(n,e)=>n!==Gt&&!n.__isScriptSetup&&Lt(n,e),tP={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const v=o[e];if(v!==void 0)switch(v){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(lp(r,e))return o[e]=1,r[e];if(s!==Gt&&Lt(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&Lt(c,e))return o[e]=3,i[e];if(t!==Gt&&Lt(t,e))return o[e]=4,t[e];Yp&&(o[e]=0)}}const d=Lu[e];let f,g;if(d)return e==="$attrs"&&ur(n.attrs,"get",""),d(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==Gt&&Lt(t,e))return o[e]=4,t[e];if(g=l.config.globalProperties,Lt(g,e))return g[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return lp(s,e)?(s[e]=t,!0):r!==Gt&&Lt(r,e)?(r[e]=t,!0):Lt(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==Gt&&Lt(n,o)||lp(e,o)||(a=i[0])&&Lt(a,o)||Lt(r,o)||Lt(Lu,o)||Lt(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:Lt(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function qy(n){return Ke(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let Yp=!0;function nP(n){const e=sg(n),t=n.proxy,r=n.ctx;Yp=!1,e.beforeCreate&&zy(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:d,beforeMount:f,mounted:g,beforeUpdate:v,updated:x,activated:w,deactivated:I,beforeDestroy:L,beforeUnmount:$,destroyed:U,unmounted:z,render:le,renderTracked:Z,renderTriggered:A,errorCaptured:b,serverPrefetch:E,expose:D,inheritAttrs:F,components:V,directives:C,filters:Fe}=e;if(c&&rP(c,r,null),o)for(const We in o){const Se=o[We];et(Se)&&(r[We]=Se.bind(t))}if(s){const We=s.call(t,t);Wt(We)&&(n.data=Hh(We))}if(Yp=!0,i)for(const We in i){const Se=i[We],me=et(Se)?Se.bind(t,t):et(Se.get)?Se.get.bind(t,t):ss,Be=!et(Se)&&et(Se.set)?Se.set.bind(t):ss,ae=He({get:me,set:Be});Object.defineProperty(r,We,{enumerable:!0,configurable:!0,get:()=>ae.value,set:re=>ae.value=re})}if(a)for(const We in a)Fw(a[We],r,t,We);if(l){const We=et(l)?l.call(t):l;Reflect.ownKeys(We).forEach(Se=>{jd(Se,We[Se])})}d&&zy(d,n,"c");function It(We,Se){Ke(Se)?Se.forEach(me=>We(me.bind(t))):Se&&We(Se.bind(t))}if(It(zS,f),It(An,g),It(HS,v),It(KS,x),It(jS,w),It(BS,I),It(JS,b),It(QS,Z),It(WS,A),It(rg,$),It(Zs,z),It(GS,E),Ke(D))if(D.length){const We=n.exposed||(n.exposed={});D.forEach(Se=>{Object.defineProperty(We,Se,{get:()=>t[Se],set:me=>t[Se]=me})})}else n.exposed||(n.exposed={});le&&n.render===ss&&(n.render=le),F!=null&&(n.inheritAttrs=F),V&&(n.components=V),C&&(n.directives=C),E&&Vw(n)}function rP(n,e,t=ss){Ke(n)&&(n=Xp(n));for(const r in n){const s=n[r];let i;Wt(s)?"default"in s?i=os(s.from||r,s.default,!0):i=os(s.from||r):i=os(s),dr(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function zy(n,e,t){ls(Ke(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function Fw(n,e,t,r){let s=r.includes(".")?Yw(t,r):()=>t[r];if(gn(n)){const i=e[n];et(i)&&Ct(s,i)}else if(et(n))Ct(s,n.bind(t));else if(Wt(n))if(Ke(n))n.forEach(i=>Fw(i,e,t,r));else{const i=et(n.handler)?n.handler.bind(t):e[n.handler];et(i)&&Ct(s,i,n)}}function sg(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>ch(l,c,o,!0)),ch(l,e,o)),Wt(e)&&i.set(e,l),l}function ch(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&ch(n,i,t,!0),s&&s.forEach(o=>ch(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=sP[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const sP={data:Hy,props:Ky,emits:Ky,methods:Eu,computed:Eu,beforeCreate:yr,created:yr,beforeMount:yr,mounted:yr,beforeUpdate:yr,updated:yr,beforeDestroy:yr,beforeUnmount:yr,destroyed:yr,unmounted:yr,activated:yr,deactivated:yr,errorCaptured:yr,serverPrefetch:yr,components:Eu,directives:Eu,watch:oP,provide:Hy,inject:iP};function Hy(n,e){return e?n?function(){return Dn(et(n)?n.call(this,this):n,et(e)?e.call(this,this):e)}:e:n}function iP(n,e){return Eu(Xp(n),Xp(e))}function Xp(n){if(Ke(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function yr(n,e){return n?[...new Set([].concat(n,e))]:e}function Eu(n,e){return n?Dn(Object.create(null),n,e):e}function Ky(n,e){return n?Ke(n)&&Ke(e)?[...new Set([...n,...e])]:Dn(Object.create(null),qy(n),qy(e??{})):e}function oP(n,e){if(!n)return e;if(!e)return n;const t=Dn(Object.create(null),n);for(const r in e)t[r]=yr(n[r],e[r]);return t}function Uw(){return{app:null,config:{isNativeTag:G1,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let aP=0;function lP(n,e){return function(r,s=null){et(r)||(r=Dn({},r)),s!=null&&!Wt(s)&&(s=null);const i=Uw(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:aP++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:qP,get config(){return i.config},set config(d){},use(d,...f){return o.has(d)||(d&&et(d.install)?(o.add(d),d.install(c,...f)):et(d)&&(o.add(d),d(c,...f))),c},mixin(d){return i.mixins.includes(d)||i.mixins.push(d),c},component(d,f){return f?(i.components[d]=f,c):i.components[d]},directive(d,f){return f?(i.directives[d]=f,c):i.directives[d]},mount(d,f,g){if(!l){const v=c._ceVNode||je(r,s);return v.appContext=i,g===!0?g="svg":g===!1&&(g=void 0),f&&e?e(v,d):n(v,d,g),l=!0,c._container=d,d.__vue_app__=c,Yh(v.component)}},onUnmount(d){a.push(d)},unmount(){l&&(ls(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(d,f){return i.provides[d]=f,c},runWithContext(d){const f=dl;dl=c;try{return d()}finally{dl=f}}};return c}}let dl=null;function jd(n,e){if(Xn){let t=Xn.provides;const r=Xn.parent&&Xn.parent.provides;r===t&&(t=Xn.provides=Object.create(r)),t[n]=e}}function os(n,e,t=!1){const r=Xn||zn;if(r||dl){let s=dl?dl._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&et(e)?e.call(r&&r.proxy):e}}const jw={},Bw=()=>Object.create(jw),qw=n=>Object.getPrototypeOf(n)===jw;function uP(n,e,t,r=!1){const s={},i=Bw();n.propsDefaults=Object.create(null),zw(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:gw(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function cP(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=Nt(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const d=n.vnode.dynamicProps;for(let f=0;f<d.length;f++){let g=d[f];if(Qh(n.emitsOptions,g))continue;const v=e[g];if(l)if(Lt(i,g))v!==i[g]&&(i[g]=v,c=!0);else{const x=Jr(g);s[x]=Zp(l,a,x,v,n,!1)}else v!==i[g]&&(i[g]=v,c=!0)}}}else{zw(n,e,s,i)&&(c=!0);let d;for(const f in a)(!e||!Lt(e,f)&&((d=go(f))===f||!Lt(e,d)))&&(l?t&&(t[f]!==void 0||t[d]!==void 0)&&(s[f]=Zp(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!Lt(e,f))&&(delete i[f],c=!0)}c&&Ks(n.attrs,"set","")}function zw(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(Du(l))continue;const c=e[l];let d;s&&Lt(s,d=Jr(l))?!i||!i.includes(d)?t[d]=c:(a||(a={}))[d]=c:Qh(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=Nt(t),c=a||Gt;for(let d=0;d<i.length;d++){const f=i[d];t[f]=Zp(s,l,f,c[f],n,!Lt(c,f))}}return o}function Zp(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=Lt(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&et(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const d=Dc(s);r=c[t]=l.call(null,e),d()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===go(t))&&(r=!0))}return r}const dP=new WeakMap;function Hw(n,e,t=!1){const r=t?dP:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!et(n)){const d=f=>{l=!0;const[g,v]=Hw(f,e,!0);Dn(o,g),v&&a.push(...v)};!t&&e.mixins.length&&e.mixins.forEach(d),n.extends&&d(n.extends),n.mixins&&n.mixins.forEach(d)}if(!i&&!l)return Wt(n)&&r.set(n,ol),ol;if(Ke(i))for(let d=0;d<i.length;d++){const f=Jr(i[d]);Gy(f)&&(o[f]=Gt)}else if(i)for(const d in i){const f=Jr(d);if(Gy(f)){const g=i[d],v=o[f]=Ke(g)||et(g)?{type:g}:Dn({},g),x=v.type;let w=!1,I=!0;if(Ke(x))for(let L=0;L<x.length;++L){const $=x[L],U=et($)&&$.name;if(U==="Boolean"){w=!0;break}else U==="String"&&(I=!1)}else w=et(x)&&x.name==="Boolean";v[0]=w,v[1]=I,(w||Lt(v,"default"))&&a.push(f)}}const c=[o,a];return Wt(n)&&r.set(n,c),c}function Gy(n){return n[0]!=="$"&&!Du(n)}const ig=n=>n[0]==="_"||n==="$stable",og=n=>Ke(n)?n.map(xs):[xs(n)],hP=(n,e,t)=>{if(e._n)return e;const r=Fd((...s)=>og(e(...s)),t);return r._c=!1,r},Kw=(n,e,t)=>{const r=n._ctx;for(const s in n){if(ig(s))continue;const i=n[s];if(et(i))e[s]=hP(s,i,r);else if(i!=null){const o=og(i);e[s]=()=>o}}},Gw=(n,e)=>{const t=og(e);n.slots.default=()=>t},Ww=(n,e,t)=>{for(const r in e)(t||!ig(r))&&(n[r]=e[r])},fP=(n,e,t)=>{const r=n.slots=Bw();if(n.vnode.shapeFlag&32){const s=e.__;s&&qp(r,"__",s,!0);const i=e._;i?(Ww(r,e,t),t&&qp(r,"_",i,!0)):Kw(e,r)}else e&&Gw(n,e)},pP=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=Gt;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:Ww(s,e,t):(i=!e.$stable,Kw(e,s)),o=e}else e&&(Gw(n,e),o={default:1});if(i)for(const a in s)!ig(a)&&o[a]==null&&delete s[a]},_r=PP;function mP(n){return gP(n)}function gP(n,e){const t=qh();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:d,parentNode:f,nextSibling:g,setScopeId:v=ss,insertStaticContent:x}=n,w=(P,M,G,ue=null,ne=null,de=null,Ie=void 0,Y=null,ge=!!M.dynamicChildren)=>{if(P===M)return;P&&!Ko(P,M)&&(ue=Q(P),re(P,ne,de,!0),P=null),M.patchFlag===-2&&(ge=!1,M.dynamicChildren=null);const{type:he,ref:Re,shapeFlag:ve}=M;switch(he){case Jh:I(P,M,G,ue);break;case cr:L(P,M,G,ue);break;case Bd:P==null&&$(M,G,ue,Ie);break;case bt:V(P,M,G,ue,ne,de,Ie,Y,ge);break;default:ve&1?le(P,M,G,ue,ne,de,Ie,Y,ge):ve&6?C(P,M,G,ue,ne,de,Ie,Y,ge):(ve&64||ve&128)&&he.process(P,M,G,ue,ne,de,Ie,Y,ge,ke)}Re!=null&&ne?Mu(Re,P&&P.ref,de,M||P,!M):Re==null&&P&&P.ref!=null&&Mu(P.ref,null,de,P,!0)},I=(P,M,G,ue)=>{if(P==null)r(M.el=a(M.children),G,ue);else{const ne=M.el=P.el;M.children!==P.children&&c(ne,M.children)}},L=(P,M,G,ue)=>{P==null?r(M.el=l(M.children||""),G,ue):M.el=P.el},$=(P,M,G,ue)=>{[P.el,P.anchor]=x(P.children,M,G,ue,P.el,P.anchor)},U=({el:P,anchor:M},G,ue)=>{let ne;for(;P&&P!==M;)ne=g(P),r(P,G,ue),P=ne;r(M,G,ue)},z=({el:P,anchor:M})=>{let G;for(;P&&P!==M;)G=g(P),s(P),P=G;s(M)},le=(P,M,G,ue,ne,de,Ie,Y,ge)=>{M.type==="svg"?Ie="svg":M.type==="math"&&(Ie="mathml"),P==null?Z(M,G,ue,ne,de,Ie,Y,ge):E(P,M,ne,de,Ie,Y,ge)},Z=(P,M,G,ue,ne,de,Ie,Y)=>{let ge,he;const{props:Re,shapeFlag:ve,transition:De,dirs:qe}=P;if(ge=P.el=o(P.type,de,Re&&Re.is,Re),ve&8?d(ge,P.children):ve&16&&b(P.children,ge,null,ue,ne,up(P,de),Ie,Y),qe&&Mo(P,null,ue,"created"),A(ge,P,P.scopeId,Ie,ue),Re){for(const Ye in Re)Ye!=="value"&&!Du(Ye)&&i(ge,Ye,null,Re[Ye],de,ue);"value"in Re&&i(ge,"value",null,Re.value,de),(he=Re.onVnodeBeforeMount)&&bs(he,ue,P)}qe&&Mo(P,null,ue,"beforeMount");const Ue=vP(ne,De);Ue&&De.beforeEnter(ge),r(ge,M,G),((he=Re&&Re.onVnodeMounted)||Ue||qe)&&_r(()=>{he&&bs(he,ue,P),Ue&&De.enter(ge),qe&&Mo(P,null,ue,"mounted")},ne)},A=(P,M,G,ue,ne)=>{if(G&&v(P,G),ue)for(let de=0;de<ue.length;de++)v(P,ue[de]);if(ne){let de=ne.subTree;if(M===de||Zw(de.type)&&(de.ssContent===M||de.ssFallback===M)){const Ie=ne.vnode;A(P,Ie,Ie.scopeId,Ie.slotScopeIds,ne.parent)}}},b=(P,M,G,ue,ne,de,Ie,Y,ge=0)=>{for(let he=ge;he<P.length;he++){const Re=P[he]=Y?Ui(P[he]):xs(P[he]);w(null,Re,M,G,ue,ne,de,Ie,Y)}},E=(P,M,G,ue,ne,de,Ie)=>{const Y=M.el=P.el;let{patchFlag:ge,dynamicChildren:he,dirs:Re}=M;ge|=P.patchFlag&16;const ve=P.props||Gt,De=M.props||Gt;let qe;if(G&&Lo(G,!1),(qe=De.onVnodeBeforeUpdate)&&bs(qe,G,M,P),Re&&Mo(M,P,G,"beforeUpdate"),G&&Lo(G,!0),(ve.innerHTML&&De.innerHTML==null||ve.textContent&&De.textContent==null)&&d(Y,""),he?D(P.dynamicChildren,he,Y,G,ue,up(M,ne),de):Ie||Se(P,M,Y,null,G,ue,up(M,ne),de,!1),ge>0){if(ge&16)F(Y,ve,De,G,ne);else if(ge&2&&ve.class!==De.class&&i(Y,"class",null,De.class,ne),ge&4&&i(Y,"style",ve.style,De.style,ne),ge&8){const Ue=M.dynamicProps;for(let Ye=0;Ye<Ue.length;Ye++){const ct=Ue[Ye],en=ve[ct],Jt=De[ct];(Jt!==en||ct==="value")&&i(Y,ct,en,Jt,ne,G)}}ge&1&&P.children!==M.children&&d(Y,M.children)}else!Ie&&he==null&&F(Y,ve,De,G,ne);((qe=De.onVnodeUpdated)||Re)&&_r(()=>{qe&&bs(qe,G,M,P),Re&&Mo(M,P,G,"updated")},ue)},D=(P,M,G,ue,ne,de,Ie)=>{for(let Y=0;Y<M.length;Y++){const ge=P[Y],he=M[Y],Re=ge.el&&(ge.type===bt||!Ko(ge,he)||ge.shapeFlag&198)?f(ge.el):G;w(ge,he,Re,null,ue,ne,de,Ie,!0)}},F=(P,M,G,ue,ne)=>{if(M!==G){if(M!==Gt)for(const de in M)!Du(de)&&!(de in G)&&i(P,de,M[de],null,ne,ue);for(const de in G){if(Du(de))continue;const Ie=G[de],Y=M[de];Ie!==Y&&de!=="value"&&i(P,de,Y,Ie,ne,ue)}"value"in G&&i(P,"value",M.value,G.value,ne)}},V=(P,M,G,ue,ne,de,Ie,Y,ge)=>{const he=M.el=P?P.el:a(""),Re=M.anchor=P?P.anchor:a("");let{patchFlag:ve,dynamicChildren:De,slotScopeIds:qe}=M;qe&&(Y=Y?Y.concat(qe):qe),P==null?(r(he,G,ue),r(Re,G,ue),b(M.children||[],G,Re,ne,de,Ie,Y,ge)):ve>0&&ve&64&&De&&P.dynamicChildren?(D(P.dynamicChildren,De,G,ne,de,Ie,Y),(M.key!=null||ne&&M===ne.subTree)&&ag(P,M,!0)):Se(P,M,G,Re,ne,de,Ie,Y,ge)},C=(P,M,G,ue,ne,de,Ie,Y,ge)=>{M.slotScopeIds=Y,P==null?M.shapeFlag&512?ne.ctx.activate(M,G,ue,Ie,ge):Fe(M,G,ue,ne,de,Ie,ge):vt(P,M,ge)},Fe=(P,M,G,ue,ne,de,Ie)=>{const Y=P.component=VP(P,ue,ne);if(Gh(P)&&(Y.ctx.renderer=ke),LP(Y,!1,Ie),Y.asyncDep){if(ne&&ne.registerDep(Y,It,Ie),!P.el){const ge=Y.subTree=je(cr);L(null,ge,M,G)}}else It(Y,P,M,G,ne,de,Ie)},vt=(P,M,G)=>{const ue=M.component=P.component;if(AP(P,M,G))if(ue.asyncDep&&!ue.asyncResolved){We(ue,M,G);return}else ue.next=M,ue.update();else M.el=P.el,ue.vnode=M},It=(P,M,G,ue,ne,de,Ie)=>{const Y=()=>{if(P.isMounted){let{next:ve,bu:De,u:qe,parent:Ue,vnode:Ye}=P;{const qt=Qw(P);if(qt){ve&&(ve.el=Ye.el,We(P,ve,Ie)),qt.asyncDep.then(()=>{P.isUnmounted||Y()});return}}let ct=ve,en;Lo(P,!1),ve?(ve.el=Ye.el,We(P,ve,Ie)):ve=Ye,De&&$d(De),(en=ve.props&&ve.props.onVnodeBeforeUpdate)&&bs(en,Ue,ve,Ye),Lo(P,!0);const Jt=cp(P),wn=P.subTree;P.subTree=Jt,w(wn,Jt,f(wn.el),Q(wn),P,ne,de),ve.el=Jt.el,ct===null&&SP(P,Jt.el),qe&&_r(qe,ne),(en=ve.props&&ve.props.onVnodeUpdated)&&_r(()=>bs(en,Ue,ve,Ye),ne)}else{let ve;const{el:De,props:qe}=M,{bm:Ue,m:Ye,parent:ct,root:en,type:Jt}=P,wn=cl(M);if(Lo(P,!1),Ue&&$d(Ue),!wn&&(ve=qe&&qe.onVnodeBeforeMount)&&bs(ve,ct,M),Lo(P,!0),De&&yt){const qt=()=>{P.subTree=cp(P),yt(De,P.subTree,P,ne,null)};wn&&Jt.__asyncHydrate?Jt.__asyncHydrate(De,P,qt):qt()}else{en.ce&&en.ce._def.shadowRoot!==!1&&en.ce._injectChildStyle(Jt);const qt=P.subTree=cp(P);w(null,qt,G,ue,P,ne,de),M.el=qt.el}if(Ye&&_r(Ye,ne),!wn&&(ve=qe&&qe.onVnodeMounted)){const qt=M;_r(()=>bs(ve,ct,qt),ne)}(M.shapeFlag&256||ct&&cl(ct.vnode)&&ct.vnode.shapeFlag&256)&&P.a&&_r(P.a,ne),P.isMounted=!0,M=G=ue=null}};P.scope.on();const ge=P.effect=new nw(Y);P.scope.off();const he=P.update=ge.run.bind(ge),Re=P.job=ge.runIfDirty.bind(ge);Re.i=P,Re.id=P.uid,ge.scheduler=()=>ng(Re),Lo(P,!0),he()},We=(P,M,G)=>{M.component=P;const ue=P.vnode.props;P.vnode=M,P.next=null,cP(P,M.props,ue,G),pP(P,M.children,G),si(),Ly(P),ii()},Se=(P,M,G,ue,ne,de,Ie,Y,ge=!1)=>{const he=P&&P.children,Re=P?P.shapeFlag:0,ve=M.children,{patchFlag:De,shapeFlag:qe}=M;if(De>0){if(De&128){Be(he,ve,G,ue,ne,de,Ie,Y,ge);return}else if(De&256){me(he,ve,G,ue,ne,de,Ie,Y,ge);return}}qe&8?(Re&16&&kt(he,ne,de),ve!==he&&d(G,ve)):Re&16?qe&16?Be(he,ve,G,ue,ne,de,Ie,Y,ge):kt(he,ne,de,!0):(Re&8&&d(G,""),qe&16&&b(ve,G,ue,ne,de,Ie,Y,ge))},me=(P,M,G,ue,ne,de,Ie,Y,ge)=>{P=P||ol,M=M||ol;const he=P.length,Re=M.length,ve=Math.min(he,Re);let De;for(De=0;De<ve;De++){const qe=M[De]=ge?Ui(M[De]):xs(M[De]);w(P[De],qe,G,null,ne,de,Ie,Y,ge)}he>Re?kt(P,ne,de,!0,!1,ve):b(M,G,ue,ne,de,Ie,Y,ge,ve)},Be=(P,M,G,ue,ne,de,Ie,Y,ge)=>{let he=0;const Re=M.length;let ve=P.length-1,De=Re-1;for(;he<=ve&&he<=De;){const qe=P[he],Ue=M[he]=ge?Ui(M[he]):xs(M[he]);if(Ko(qe,Ue))w(qe,Ue,G,null,ne,de,Ie,Y,ge);else break;he++}for(;he<=ve&&he<=De;){const qe=P[ve],Ue=M[De]=ge?Ui(M[De]):xs(M[De]);if(Ko(qe,Ue))w(qe,Ue,G,null,ne,de,Ie,Y,ge);else break;ve--,De--}if(he>ve){if(he<=De){const qe=De+1,Ue=qe<Re?M[qe].el:ue;for(;he<=De;)w(null,M[he]=ge?Ui(M[he]):xs(M[he]),G,Ue,ne,de,Ie,Y,ge),he++}}else if(he>De)for(;he<=ve;)re(P[he],ne,de,!0),he++;else{const qe=he,Ue=he,Ye=new Map;for(he=Ue;he<=De;he++){const ln=M[he]=ge?Ui(M[he]):xs(M[he]);ln.key!=null&&Ye.set(ln.key,he)}let ct,en=0;const Jt=De-Ue+1;let wn=!1,qt=0;const mr=new Array(Jt);for(he=0;he<Jt;he++)mr[he]=0;for(he=qe;he<=ve;he++){const ln=P[he];if(en>=Jt){re(ln,ne,de,!0);continue}let Nn;if(ln.key!=null)Nn=Ye.get(ln.key);else for(ct=Ue;ct<=De;ct++)if(mr[ct-Ue]===0&&Ko(ln,M[ct])){Nn=ct;break}Nn===void 0?re(ln,ne,de,!0):(mr[Nn-Ue]=he+1,Nn>=qt?qt=Nn:wn=!0,w(ln,M[Nn],G,null,ne,de,Ie,Y,ge),en++)}const kr=wn?yP(mr):ol;for(ct=kr.length-1,he=Jt-1;he>=0;he--){const ln=Ue+he,Nn=M[ln],bi=ln+1<Re?M[ln+1].el:ue;mr[he]===0?w(null,Nn,G,bi,ne,de,Ie,Y,ge):wn&&(ct<0||he!==kr[ct]?ae(Nn,G,bi,2):ct--)}}},ae=(P,M,G,ue,ne=null)=>{const{el:de,type:Ie,transition:Y,children:ge,shapeFlag:he}=P;if(he&6){ae(P.component.subTree,M,G,ue);return}if(he&128){P.suspense.move(M,G,ue);return}if(he&64){Ie.move(P,M,G,ke);return}if(Ie===bt){r(de,M,G);for(let ve=0;ve<ge.length;ve++)ae(ge[ve],M,G,ue);r(P.anchor,M,G);return}if(Ie===Bd){U(P,M,G);return}if(ue!==2&&he&1&&Y)if(ue===0)Y.beforeEnter(de),r(de,M,G),_r(()=>Y.enter(de),ne);else{const{leave:ve,delayLeave:De,afterLeave:qe}=Y,Ue=()=>{P.ctx.isUnmounted?s(de):r(de,M,G)},Ye=()=>{ve(de,()=>{Ue(),qe&&qe()})};De?De(de,Ue,Ye):Ye()}else r(de,M,G)},re=(P,M,G,ue=!1,ne=!1)=>{const{type:de,props:Ie,ref:Y,children:ge,dynamicChildren:he,shapeFlag:Re,patchFlag:ve,dirs:De,cacheIndex:qe}=P;if(ve===-2&&(ne=!1),Y!=null&&(si(),Mu(Y,null,G,P,!0),ii()),qe!=null&&(M.renderCache[qe]=void 0),Re&256){M.ctx.deactivate(P);return}const Ue=Re&1&&De,Ye=!cl(P);let ct;if(Ye&&(ct=Ie&&Ie.onVnodeBeforeUnmount)&&bs(ct,M,P),Re&6)Ot(P.component,G,ue);else{if(Re&128){P.suspense.unmount(G,ue);return}Ue&&Mo(P,null,M,"beforeUnmount"),Re&64?P.type.remove(P,M,G,ke,ue):he&&!he.hasOnce&&(de!==bt||ve>0&&ve&64)?kt(he,M,G,!1,!0):(de===bt&&ve&384||!ne&&Re&16)&&kt(ge,M,G),ue&&Oe(P)}(Ye&&(ct=Ie&&Ie.onVnodeUnmounted)||Ue)&&_r(()=>{ct&&bs(ct,M,P),Ue&&Mo(P,null,M,"unmounted")},G)},Oe=P=>{const{type:M,el:G,anchor:ue,transition:ne}=P;if(M===bt){St(G,ue);return}if(M===Bd){z(P);return}const de=()=>{s(G),ne&&!ne.persisted&&ne.afterLeave&&ne.afterLeave()};if(P.shapeFlag&1&&ne&&!ne.persisted){const{leave:Ie,delayLeave:Y}=ne,ge=()=>Ie(G,de);Y?Y(P.el,de,ge):ge()}else de()},St=(P,M)=>{let G;for(;P!==M;)G=g(P),s(P),P=G;s(M)},Ot=(P,M,G)=>{const{bum:ue,scope:ne,job:de,subTree:Ie,um:Y,m:ge,a:he,parent:Re,slots:{__:ve}}=P;Wy(ge),Wy(he),ue&&$d(ue),Re&&Ke(ve)&&ve.forEach(De=>{Re.renderCache[De]=void 0}),ne.stop(),de&&(de.flags|=8,re(Ie,P,M,G)),Y&&_r(Y,M),_r(()=>{P.isUnmounted=!0},M),M&&M.pendingBranch&&!M.isUnmounted&&P.asyncDep&&!P.asyncResolved&&P.suspenseId===M.pendingId&&(M.deps--,M.deps===0&&M.resolve())},kt=(P,M,G,ue=!1,ne=!1,de=0)=>{for(let Ie=de;Ie<P.length;Ie++)re(P[Ie],M,G,ue,ne)},Q=P=>{if(P.shapeFlag&6)return Q(P.component.subTree);if(P.shapeFlag&128)return P.suspense.next();const M=g(P.anchor||P.el),G=M&&M[Tw];return G?g(G):M};let we=!1;const ye=(P,M,G)=>{P==null?M._vnode&&re(M._vnode,null,null,!0):w(M._vnode||null,P,M,null,null,null,G),M._vnode=P,we||(we=!0,Ly(),xw(),we=!1)},ke={p:w,um:re,m:ae,r:Oe,mt:Fe,mc:b,pc:Se,pbc:D,n:Q,o:n};let rt,yt;return e&&([rt,yt]=e(ke)),{render:ye,hydrate:rt,createApp:lP(ye,rt)}}function up({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Lo({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function vP(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function ag(n,e,t=!1){const r=n.children,s=e.children;if(Ke(r)&&Ke(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=Ui(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&ag(o,a)),a.type===Jh&&(a.el=o.el),a.type===cr&&!a.el&&(a.el=o.el)}}function yP(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function Qw(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Qw(e)}function Wy(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const _P=Symbol.for("v-scx"),bP=()=>os(_P);function Ct(n,e,t){return Jw(n,e,t)}function Jw(n,e,t=Gt){const{immediate:r,deep:s,flush:i,once:o}=t,a=Dn({},t),l=e&&r||!e&&i!=="post";let c;if(rc){if(i==="sync"){const v=bP();c=v.__watcherHandles||(v.__watcherHandles=[])}else if(!l){const v=()=>{};return v.stop=ss,v.resume=ss,v.pause=ss,v}}const d=Xn;a.call=(v,x,w)=>ls(v,d,x,w);let f=!1;i==="post"?a.scheduler=v=>{_r(v,d&&d.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(v,x)=>{x?v():ng(v)}),a.augmentJob=v=>{e&&(v.flags|=4),f&&(v.flags|=2,d&&(v.id=d.uid,v.i=d))};const g=NS(n,e,a);return rc&&(c?c.push(g):l&&g()),g}function wP(n,e,t){const r=this.proxy,s=gn(n)?n.includes(".")?Yw(r,n):()=>r[n]:n.bind(r,r);let i;et(e)?i=e:(i=e.handler,t=e);const o=Dc(this),a=Jw(s,i.bind(r),t);return o(),a}function Yw(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const xP=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Jr(e)}Modifiers`]||n[`${go(e)}Modifiers`];function IP(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||Gt;let s=t;const i=e.startsWith("update:"),o=i&&xP(r,e.slice(7));o&&(o.trim&&(s=t.map(d=>gn(d)?d.trim():d)),o.number&&(s=t.map(ih)));let a,l=r[a=np(e)]||r[a=np(Jr(e))];!l&&i&&(l=r[a=np(go(e))]),l&&ls(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,ls(c,n,6,s)}}function Xw(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!et(n)){const l=c=>{const d=Xw(c,e,!0);d&&(a=!0,Dn(o,d))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(Wt(n)&&r.set(n,null),null):(Ke(i)?i.forEach(l=>o[l]=null):Dn(o,i),Wt(n)&&r.set(n,o),o)}function Qh(n,e){return!n||!Uh(e)?!1:(e=e.slice(2).replace(/Once$/,""),Lt(n,e[0].toLowerCase()+e.slice(1))||Lt(n,go(e))||Lt(n,e))}function cp(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:d,props:f,data:g,setupState:v,ctx:x,inheritAttrs:w}=n,I=uh(n);let L,$;try{if(t.shapeFlag&4){const z=s||r,le=z;L=xs(c.call(le,z,d,f,v,g,x)),$=a}else{const z=e;L=xs(z.length>1?z(f,{attrs:a,slots:o,emit:l}):z(f,null)),$=e.props?a:EP(a)}}catch(z){$u.length=0,Kh(z,n,1),L=je(cr)}let U=L;if($&&w!==!1){const z=Object.keys($),{shapeFlag:le}=U;z.length&&le&7&&(i&&z.some(Hm)&&($=TP($,i)),U=io(U,$,!1,!0))}return t.dirs&&(U=io(U,null,!1,!0),U.dirs=U.dirs?U.dirs.concat(t.dirs):t.dirs),t.transition&&ec(U,t.transition),L=U,uh(I),L}const EP=n=>{let e;for(const t in n)(t==="class"||t==="style"||Uh(t))&&((e||(e={}))[t]=n[t]);return e},TP=(n,e)=>{const t={};for(const r in n)(!Hm(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function AP(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?Qy(r,o,c):!!o;if(l&8){const d=e.dynamicProps;for(let f=0;f<d.length;f++){const g=d[f];if(o[g]!==r[g]&&!Qh(c,g))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Qy(r,o,c):!0:!!o;return!1}function Qy(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!Qh(t,i))return!0}return!1}function SP({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const Zw=n=>n.__isSuspense;function PP(n,e){e&&e.pendingBranch?Ke(n)?e.effects.push(...n):e.effects.push(n):MS(n)}const bt=Symbol.for("v-fgt"),Jh=Symbol.for("v-txt"),cr=Symbol.for("v-cmt"),Bd=Symbol.for("v-stc"),$u=[];let Fr=null;function k(n=!1){$u.push(Fr=n?null:[])}function RP(){$u.pop(),Fr=$u[$u.length-1]||null}let tc=1;function Jy(n,e=!1){tc+=n,n<0&&Fr&&e&&(Fr.hasOnce=!0)}function ex(n){return n.dynamicChildren=tc>0?Fr||ol:null,RP(),tc>0&&Fr&&Fr.push(n),n}function O(n,e,t,r,s,i){return ex(h(n,e,t,r,s,i,!0))}function ei(n,e,t,r,s){return ex(je(n,e,t,r,s,!0))}function nc(n){return n?n.__v_isVNode===!0:!1}function Ko(n,e){return n.type===e.type&&n.key===e.key}const tx=({key:n})=>n??null,qd=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?gn(n)||dr(n)||et(n)?{i:zn,r:n,k:e,f:!!t}:n:null);function h(n,e=null,t=null,r=0,s=null,i=n===bt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&tx(e),ref:e&&qd(e),scopeId:Ew,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:zn};return a?(lg(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=gn(t)?8:16),tc>0&&!o&&Fr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&Fr.push(l),l}const je=CP;function CP(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===XS)&&(n=cr),nc(n)){const a=io(n,e,!0);return t&&lg(a,t),tc>0&&!i&&Fr&&(a.shapeFlag&6?Fr[Fr.indexOf(n)]=a:Fr.push(a)),a.patchFlag=-2,a}if(BP(n)&&(n=n.__vccOpts),e){e=kP(e);let{class:a,style:l}=e;a&&!gn(a)&&(e.class=dn(a)),Wt(l)&&(tg(l)&&!Ke(l)&&(l=Dn({},l)),e.style=Mr(l))}const o=gn(n)?1:Zw(n)?128:Aw(n)?64:Wt(n)?4:et(n)?2:0;return h(n,e,t,r,s,o,i,!0)}function kP(n){return n?tg(n)||qw(n)?Dn({},n):n:null}function io(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?DP(s||{},e):s,d={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&tx(c),ref:e&&e.ref?t&&i?Ke(i)?i.concat(qd(e)):[i,qd(e)]:qd(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==bt?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&io(n.ssContent),ssFallback:n.ssFallback&&io(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&ec(d,l.clone(d)),d}function ut(n=" ",e=0){return je(Jh,null,n,e)}function lr(n,e){const t=je(Bd,null,n);return t.staticCount=e,t}function ie(n="",e=!1){return e?(k(),ei(cr,null,n)):je(cr,null,n)}function xs(n){return n==null||typeof n=="boolean"?je(cr):Ke(n)?je(bt,null,n.slice()):nc(n)?Ui(n):je(Jh,null,String(n))}function Ui(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:io(n)}function lg(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(Ke(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),lg(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!qw(e)?e._ctx=zn:s===3&&zn&&(zn.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else et(e)?(e={default:e,_ctx:zn},t=32):(e=String(e),r&64?(t=16,e=[ut(e)]):t=8);n.children=e,n.shapeFlag|=t}function DP(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=dn([e.class,r.class]));else if(s==="style")e.style=Mr([e.style,r.style]);else if(Uh(s)){const i=e[s],o=r[s];o&&i!==o&&!(Ke(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function bs(n,e,t,r=null){ls(n,e,7,[t,r])}const NP=Uw();let OP=0;function VP(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||NP,i={uid:OP++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new oS(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Hw(r,s),emitsOptions:Xw(r,s),emit:null,emitted:null,propsDefaults:Gt,inheritAttrs:r.inheritAttrs,ctx:Gt,data:Gt,props:Gt,attrs:Gt,slots:Gt,refs:Gt,setupState:Gt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=IP.bind(null,i),n.ce&&n.ce(i),i}let Xn=null;const MP=()=>Xn||zn;let dh,em;{const n=qh(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};dh=e("__VUE_INSTANCE_SETTERS__",t=>Xn=t),em=e("__VUE_SSR_SETTERS__",t=>rc=t)}const Dc=n=>{const e=Xn;return dh(n),n.scope.on(),()=>{n.scope.off(),dh(e)}},Yy=()=>{Xn&&Xn.scope.off(),dh(null)};function nx(n){return n.vnode.shapeFlag&4}let rc=!1;function LP(n,e=!1,t=!1){e&&em(e);const{props:r,children:s}=n.vnode,i=nx(n);uP(n,r,i,e),fP(n,s,t||e);const o=i?$P(n,e):void 0;return e&&em(!1),o}function $P(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,tP);const{setup:r}=t;if(r){si();const s=n.setupContext=r.length>1?UP(n):null,i=Dc(n),o=kc(r,n,0,[n.props,s]),a=Jb(o);if(ii(),i(),(a||n.sp)&&!cl(n)&&Vw(n),a){if(o.then(Yy,Yy),e)return o.then(l=>{Xy(n,l,e)}).catch(l=>{Kh(l,n,0)});n.asyncDep=o}else Xy(n,o,e)}else rx(n,e)}function Xy(n,e,t){et(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Wt(e)&&(n.setupState=_w(e)),rx(n,t)}let Zy;function rx(n,e,t){const r=n.type;if(!n.render){if(!e&&Zy&&!r.render){const s=r.template||sg(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=Dn(Dn({isCustomElement:i,delimiters:a},o),l);r.render=Zy(s,c)}}n.render=r.render||ss}{const s=Dc(n);si();try{nP(n)}finally{ii(),s()}}}const FP={get(n,e){return ur(n,"get",""),n[e]}};function UP(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,FP),slots:n.slots,emit:n.emit,expose:e}}function Yh(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(_w(AS(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in Lu)return Lu[t](n)},has(e,t){return t in e||t in Lu}})):n.proxy}function jP(n,e=!0){return et(n)?n.displayName||n.name:n.name||e&&n.__name}function BP(n){return et(n)&&"__vccOpts"in n}const He=(n,e)=>kS(n,e,rc);function ug(n,e,t){const r=arguments.length;return r===2?Wt(e)&&!Ke(e)?nc(e)?je(n,null,[e]):je(n,e):je(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&nc(t)&&(t=[t]),je(n,e,t))}const qP="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let tm;const e0=typeof window<"u"&&window.trustedTypes;if(e0)try{tm=e0.createPolicy("vue",{createHTML:n=>n})}catch{}const sx=tm?n=>tm.createHTML(n):n=>n,zP="http://www.w3.org/2000/svg",HP="http://www.w3.org/1998/Math/MathML",zs=typeof document<"u"?document:null,t0=zs&&zs.createElement("template"),KP={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?zs.createElementNS(zP,n):e==="mathml"?zs.createElementNS(HP,n):t?zs.createElement(n,{is:t}):zs.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>zs.createTextNode(n),createComment:n=>zs.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>zs.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{t0.innerHTML=sx(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=t0.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Ni="transition",fu="animation",sc=Symbol("_vtc"),ix={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},GP=Dn({},Rw,ix),WP=n=>(n.displayName="Transition",n.props=GP,n),dp=WP((n,{slots:e})=>ug(US,QP(n),e)),$o=(n,e=[])=>{Ke(n)?n.forEach(t=>t(...e)):n&&n(...e)},n0=n=>n?Ke(n)?n.some(e=>e.length>1):n.length>1:!1;function QP(n){const e={};for(const V in n)V in ix||(e[V]=n[V]);if(n.css===!1)return e;const{name:t="v",type:r,duration:s,enterFromClass:i=`${t}-enter-from`,enterActiveClass:o=`${t}-enter-active`,enterToClass:a=`${t}-enter-to`,appearFromClass:l=i,appearActiveClass:c=o,appearToClass:d=a,leaveFromClass:f=`${t}-leave-from`,leaveActiveClass:g=`${t}-leave-active`,leaveToClass:v=`${t}-leave-to`}=n,x=JP(s),w=x&&x[0],I=x&&x[1],{onBeforeEnter:L,onEnter:$,onEnterCancelled:U,onLeave:z,onLeaveCancelled:le,onBeforeAppear:Z=L,onAppear:A=$,onAppearCancelled:b=U}=e,E=(V,C,Fe,vt)=>{V._enterCancelled=vt,Fo(V,C?d:a),Fo(V,C?c:o),Fe&&Fe()},D=(V,C)=>{V._isLeaving=!1,Fo(V,f),Fo(V,v),Fo(V,g),C&&C()},F=V=>(C,Fe)=>{const vt=V?A:$,It=()=>E(C,V,Fe);$o(vt,[C,It]),r0(()=>{Fo(C,V?l:i),Bs(C,V?d:a),n0(vt)||s0(C,r,w,It)})};return Dn(e,{onBeforeEnter(V){$o(L,[V]),Bs(V,i),Bs(V,o)},onBeforeAppear(V){$o(Z,[V]),Bs(V,l),Bs(V,c)},onEnter:F(!1),onAppear:F(!0),onLeave(V,C){V._isLeaving=!0;const Fe=()=>D(V,C);Bs(V,f),V._enterCancelled?(Bs(V,g),a0()):(a0(),Bs(V,g)),r0(()=>{V._isLeaving&&(Fo(V,f),Bs(V,v),n0(z)||s0(V,r,I,Fe))}),$o(z,[V,Fe])},onEnterCancelled(V){E(V,!1,void 0,!0),$o(U,[V])},onAppearCancelled(V){E(V,!0,void 0,!0),$o(b,[V])},onLeaveCancelled(V){D(V),$o(le,[V])}})}function JP(n){if(n==null)return null;if(Wt(n))return[hp(n.enter),hp(n.leave)];{const e=hp(n);return[e,e]}}function hp(n){return X1(n)}function Bs(n,e){e.split(/\s+/).forEach(t=>t&&n.classList.add(t)),(n[sc]||(n[sc]=new Set)).add(e)}function Fo(n,e){e.split(/\s+/).forEach(r=>r&&n.classList.remove(r));const t=n[sc];t&&(t.delete(e),t.size||(n[sc]=void 0))}function r0(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let YP=0;function s0(n,e,t,r){const s=n._endId=++YP,i=()=>{s===n._endId&&r()};if(t!=null)return setTimeout(i,t);const{type:o,timeout:a,propCount:l}=XP(n,e);if(!o)return r();const c=o+"end";let d=0;const f=()=>{n.removeEventListener(c,g),i()},g=v=>{v.target===n&&++d>=l&&f()};setTimeout(()=>{d<l&&f()},a+1),n.addEventListener(c,g)}function XP(n,e){const t=window.getComputedStyle(n),r=x=>(t[x]||"").split(", "),s=r(`${Ni}Delay`),i=r(`${Ni}Duration`),o=i0(s,i),a=r(`${fu}Delay`),l=r(`${fu}Duration`),c=i0(a,l);let d=null,f=0,g=0;e===Ni?o>0&&(d=Ni,f=o,g=i.length):e===fu?c>0&&(d=fu,f=c,g=l.length):(f=Math.max(o,c),d=f>0?o>c?Ni:fu:null,g=d?d===Ni?i.length:l.length:0);const v=d===Ni&&/\b(transform|all)(,|$)/.test(r(`${Ni}Property`).toString());return{type:d,timeout:f,propCount:g,hasTransform:v}}function i0(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max(...e.map((t,r)=>o0(t)+o0(n[r])))}function o0(n){return n==="auto"?0:Number(n.slice(0,-1).replace(",","."))*1e3}function a0(){return document.body.offsetHeight}function ZP(n,e,t){const r=n[sc];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const hh=Symbol("_vod"),ox=Symbol("_vsh"),fp={beforeMount(n,{value:e},{transition:t}){n[hh]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):pu(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),pu(n,!0),r.enter(n)):r.leave(n,()=>{pu(n,!1)}):pu(n,e))},beforeUnmount(n,{value:e}){pu(n,e)}};function pu(n,e){n.style.display=e?n[hh]:"none",n[ox]=!e}const eR=Symbol(""),tR=/(^|;)\s*display\s*:/;function nR(n,e,t){const r=n.style,s=gn(t);let i=!1;if(t&&!s){if(e)if(gn(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&zd(r,a,"")}else for(const o in e)t[o]==null&&zd(r,o,"");for(const o in t)o==="display"&&(i=!0),zd(r,o,t[o])}else if(s){if(e!==t){const o=r[eR];o&&(t+=";"+o),r.cssText=t,i=tR.test(t)}}else e&&n.removeAttribute("style");hh in n&&(n[hh]=i?r.display:"",n[ox]&&(r.display="none"))}const l0=/\s*!important$/;function zd(n,e,t){if(Ke(t))t.forEach(r=>zd(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=rR(n,e);l0.test(t)?n.setProperty(go(r),t.replace(l0,""),"important"):n[r]=t}}const u0=["Webkit","Moz","ms"],pp={};function rR(n,e){const t=pp[e];if(t)return t;let r=Jr(e);if(r!=="filter"&&r in n)return pp[e]=r;r=Bh(r);for(let s=0;s<u0.length;s++){const i=u0[s]+r;if(i in n)return pp[e]=i}return e}const c0="http://www.w3.org/1999/xlink";function d0(n,e,t,r,s,i=sS(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(c0,e.slice(6,e.length)):n.setAttributeNS(c0,e,t):t==null||i&&!Zb(t)?n.removeAttribute(e):n.setAttribute(e,i?"":as(t)?String(t):t)}function h0(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?sx(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=Zb(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function Bi(n,e,t,r){n.addEventListener(e,t,r)}function sR(n,e,t,r){n.removeEventListener(e,t,r)}const f0=Symbol("_vei");function iR(n,e,t,r,s=null){const i=n[f0]||(n[f0]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=oR(e);if(r){const c=i[e]=uR(r,s);Bi(n,a,c,l)}else o&&(sR(n,a,o,l),i[e]=void 0)}}const p0=/(?:Once|Passive|Capture)$/;function oR(n){let e;if(p0.test(n)){e={};let r;for(;r=n.match(p0);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):go(n.slice(2)),e]}let mp=0;const aR=Promise.resolve(),lR=()=>mp||(aR.then(()=>mp=0),mp=Date.now());function uR(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;ls(cR(r,t.value),e,5,[r])};return t.value=n,t.attached=lR(),t}function cR(n,e){if(Ke(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const m0=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,dR=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?ZP(n,r,o):e==="style"?nR(n,t,r):Uh(e)?Hm(e)||iR(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):hR(n,e,r,o))?(h0(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&d0(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!gn(r))?h0(n,Jr(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),d0(n,e,r,o))};function hR(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&m0(e)&&et(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return m0(e)&&gn(t)?!1:e in n}const _l=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Ke(e)?t=>$d(e,t):e};function fR(n){n.target.composing=!0}function g0(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const ti=Symbol("_assign"),$t={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[ti]=_l(s);const i=r||s.props&&s.props.type==="number";Bi(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=ih(a)),n[ti](a)}),t&&Bi(n,"change",()=>{n.value=n.value.trim()}),e||(Bi(n,"compositionstart",fR),Bi(n,"compositionend",g0),Bi(n,"change",g0))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[ti]=_l(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?ih(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},Yi={deep:!0,created(n,e,t){n[ti]=_l(t),Bi(n,"change",()=>{const r=n._modelValue,s=ic(n),i=n.checked,o=n[ti];if(Ke(r)){const a=Wm(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(Fl(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(ax(n,i))})},mounted:v0,beforeUpdate(n,e,t){n[ti]=_l(t),v0(n,e,t)}};function v0(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(Ke(e))s=Wm(e,r.props.value)>-1;else if(Fl(e))s=e.has(r.props.value);else{if(e===t)return;s=Cc(e,ax(n,!0))}n.checked!==s&&(n.checked=s)}const pR={deep:!0,created(n,{value:e,modifiers:{number:t}},r){const s=Fl(e);Bi(n,"change",()=>{const i=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>t?ih(ic(o)):ic(o));n[ti](n.multiple?s?new Set(i):i:i[0]),n._assigning=!0,jt(()=>{n._assigning=!1})}),n[ti]=_l(r)},mounted(n,{value:e}){y0(n,e)},beforeUpdate(n,e,t){n[ti]=_l(t)},updated(n,{value:e}){n._assigning||y0(n,e)}};function y0(n,e){const t=n.multiple,r=Ke(e);if(!(t&&!r&&!Fl(e))){for(let s=0,i=n.options.length;s<i;s++){const o=n.options[s],a=ic(o);if(t)if(r){const l=typeof a;l==="string"||l==="number"?o.selected=e.some(c=>String(c)===String(a)):o.selected=Wm(e,a)>-1}else o.selected=e.has(a);else if(Cc(ic(o),e)){n.selectedIndex!==s&&(n.selectedIndex=s);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function ic(n){return"_value"in n?n._value:n.value}function ax(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const mR=["ctrl","shift","alt","meta"],gR={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>mR.some(t=>n[`${t}Key`]&&!e.includes(t))},ft=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=gR[e[o]];if(a&&a(s,e))return}return n(s,...i)})},vR={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},or=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=go(s.key);if(e.some(o=>o===i||vR[o]===i))return n(s)})},yR=Dn({patchProp:dR},KP);let _0;function _R(){return _0||(_0=mP(yR))}const bR=(...n)=>{const e=_R().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=xR(r);if(!s)return;const i=e._component;!et(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,wR(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function wR(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function xR(n){return gn(n)?document.querySelector(n):n}const IR="/icons/icon-48x48.png";/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const Za=typeof document<"u";function lx(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function ER(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&lx(n.default)}const Mt=Object.assign;function gp(n,e){const t={};for(const r in e){const s=e[r];t[r]=us(s)?s.map(n):n(s)}return t}const Fu=()=>{},us=Array.isArray,ux=/#/g,TR=/&/g,AR=/\//g,SR=/=/g,PR=/\?/g,cx=/\+/g,RR=/%5B/g,CR=/%5D/g,dx=/%5E/g,kR=/%60/g,hx=/%7B/g,DR=/%7C/g,fx=/%7D/g,NR=/%20/g;function cg(n){return encodeURI(""+n).replace(DR,"|").replace(RR,"[").replace(CR,"]")}function OR(n){return cg(n).replace(hx,"{").replace(fx,"}").replace(dx,"^")}function nm(n){return cg(n).replace(cx,"%2B").replace(NR,"+").replace(ux,"%23").replace(TR,"%26").replace(kR,"`").replace(hx,"{").replace(fx,"}").replace(dx,"^")}function VR(n){return nm(n).replace(SR,"%3D")}function MR(n){return cg(n).replace(ux,"%23").replace(PR,"%3F")}function LR(n){return n==null?"":MR(n).replace(AR,"%2F")}function oc(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const $R=/\/$/,FR=n=>n.replace($R,"");function vp(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=qR(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:oc(o)}}function UR(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function b0(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function jR(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&bl(e.matched[r],t.matched[s])&&px(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function bl(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function px(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!BR(n[t],e[t]))return!1;return!0}function BR(n,e){return us(n)?w0(n,e):us(e)?w0(e,n):n===e}function w0(n,e){return us(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function qR(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const Oi={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var ac;(function(n){n.pop="pop",n.push="push"})(ac||(ac={}));var Uu;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Uu||(Uu={}));function zR(n){if(!n)if(Za){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),FR(n)}const HR=/^[^#]+#/;function KR(n,e){return n.replace(HR,"#")+e}function GR(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const Xh=()=>({left:window.scrollX,top:window.scrollY});function WR(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=GR(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function x0(n,e){return(history.state?history.state.position-e:-1)+n}const rm=new Map;function QR(n,e){rm.set(n,e)}function JR(n){const e=rm.get(n);return rm.delete(n),e}let YR=()=>location.protocol+"//"+location.host;function mx(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),b0(l,"")}return b0(t,n)+r+s}function XR(n,e,t,r){let s=[],i=[],o=null;const a=({state:g})=>{const v=mx(n,location),x=t.value,w=e.value;let I=0;if(g){if(t.value=v,e.value=g,o&&o===x){o=null;return}I=w?g.position-w.position:0}else r(v);s.forEach(L=>{L(t.value,x,{delta:I,type:ac.pop,direction:I?I>0?Uu.forward:Uu.back:Uu.unknown})})};function l(){o=t.value}function c(g){s.push(g);const v=()=>{const x=s.indexOf(g);x>-1&&s.splice(x,1)};return i.push(v),v}function d(){const{history:g}=window;g.state&&g.replaceState(Mt({},g.state,{scroll:Xh()}),"")}function f(){for(const g of i)g();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",d)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",d,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function I0(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?Xh():null}}function ZR(n){const{history:e,location:t}=window,r={value:mx(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,d){const f=n.indexOf("#"),g=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:YR()+n+l;try{e[d?"replaceState":"pushState"](c,"",g),s.value=c}catch(v){console.error(v),t[d?"replace":"assign"](g)}}function o(l,c){const d=Mt({},e.state,I0(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,d,!0),r.value=l}function a(l,c){const d=Mt({},s.value,e.state,{forward:l,scroll:Xh()});i(d.current,d,!0);const f=Mt({},I0(r.value,l,null),{position:d.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function eC(n){n=zR(n);const e=ZR(n),t=XR(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=Mt({location:"",base:n,go:r,createHref:KR.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function tC(n){return typeof n=="string"||n&&typeof n=="object"}function gx(n){return typeof n=="string"||typeof n=="symbol"}const vx=Symbol("");var E0;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(E0||(E0={}));function wl(n,e){return Mt(new Error,{type:n,[vx]:!0},e)}function qs(n,e){return n instanceof Error&&vx in n&&(e==null||!!(n.type&e))}const T0="[^/]+?",nC={sensitive:!1,strict:!1,start:!0,end:!0},rC=/[.+*?^${}()[\]/\\]/g;function sC(n,e){const t=Mt({},nC,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const d=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const g=c[f];let v=40+(t.sensitive?.25:0);if(g.type===0)f||(s+="/"),s+=g.value.replace(rC,"\\$&"),v+=40;else if(g.type===1){const{value:x,repeatable:w,optional:I,regexp:L}=g;i.push({name:x,repeatable:w,optional:I});const $=L||T0;if($!==T0){v+=10;try{new RegExp(`(${$})`)}catch(z){throw new Error(`Invalid custom RegExp for param "${x}" (${$}): `+z.message)}}let U=w?`((?:${$})(?:/(?:${$}))*)`:`(${$})`;f||(U=I&&c.length<2?`(?:/${U})`:"/"+U),I&&(U+="?"),s+=U,v+=20,I&&(v+=-8),w&&(v+=-20),$===".*"&&(v+=-50)}d.push(v)}r.push(d)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const d=c.match(o),f={};if(!d)return null;for(let g=1;g<d.length;g++){const v=d[g]||"",x=i[g-1];f[x.name]=v&&x.repeatable?v.split("/"):v}return f}function l(c){let d="",f=!1;for(const g of n){(!f||!d.endsWith("/"))&&(d+="/"),f=!1;for(const v of g)if(v.type===0)d+=v.value;else if(v.type===1){const{value:x,repeatable:w,optional:I}=v,L=x in c?c[x]:"";if(us(L)&&!w)throw new Error(`Provided param "${x}" is an array but it is not repeatable (* or + modifiers)`);const $=us(L)?L.join("/"):L;if(!$)if(I)g.length<2&&(d.endsWith("/")?d=d.slice(0,-1):f=!0);else throw new Error(`Missing required param "${x}"`);d+=$}}return d||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function iC(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function yx(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=iC(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(A0(r))return 1;if(A0(s))return-1}return s.length-r.length}function A0(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const oC={type:0,value:""},aC=/[a-zA-Z0-9_]/;function lC(n){if(!n)return[[]];if(n==="/")return[[oC]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(v){throw new Error(`ERR (${t})/"${c}": ${v}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",d="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:d,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function g(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):g();break;case 4:g(),t=r;break;case 1:l==="("?t=2:aC.test(l)?g():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?d[d.length-1]=="\\"?d=d.slice(0,-1)+l:t=3:d+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,d="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function uC(n,e,t){const r=sC(lC(n.path),t),s=Mt(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function cC(n,e){const t=[],r=new Map;e=C0({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,g,v){const x=!v,w=P0(f);w.aliasOf=v&&v.record;const I=C0(e,f),L=[w];if("alias"in f){const z=typeof f.alias=="string"?[f.alias]:f.alias;for(const le of z)L.push(P0(Mt({},w,{components:v?v.record.components:w.components,path:le,aliasOf:v?v.record:w})))}let $,U;for(const z of L){const{path:le}=z;if(g&&le[0]!=="/"){const Z=g.record.path,A=Z[Z.length-1]==="/"?"":"/";z.path=g.record.path+(le&&A+le)}if($=uC(z,g,I),v?v.alias.push($):(U=U||$,U!==$&&U.alias.push($),x&&f.name&&!R0($)&&o(f.name)),_x($)&&l($),w.children){const Z=w.children;for(let A=0;A<Z.length;A++)i(Z[A],$,v&&v.children[A])}v=v||$}return U?()=>{o(U)}:Fu}function o(f){if(gx(f)){const g=r.get(f);g&&(r.delete(f),t.splice(t.indexOf(g),1),g.children.forEach(o),g.alias.forEach(o))}else{const g=t.indexOf(f);g>-1&&(t.splice(g,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const g=fC(f,t);t.splice(g,0,f),f.record.name&&!R0(f)&&r.set(f.record.name,f)}function c(f,g){let v,x={},w,I;if("name"in f&&f.name){if(v=r.get(f.name),!v)throw wl(1,{location:f});I=v.record.name,x=Mt(S0(g.params,v.keys.filter(U=>!U.optional).concat(v.parent?v.parent.keys.filter(U=>U.optional):[]).map(U=>U.name)),f.params&&S0(f.params,v.keys.map(U=>U.name))),w=v.stringify(x)}else if(f.path!=null)w=f.path,v=t.find(U=>U.re.test(w)),v&&(x=v.parse(w),I=v.record.name);else{if(v=g.name?r.get(g.name):t.find(U=>U.re.test(g.path)),!v)throw wl(1,{location:f,currentLocation:g});I=v.record.name,x=Mt({},g.params,f.params),w=v.stringify(x)}const L=[];let $=v;for(;$;)L.unshift($.record),$=$.parent;return{name:I,path:w,params:x,matched:L,meta:hC(L)}}n.forEach(f=>i(f));function d(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:d,getRoutes:a,getRecordMatcher:s}}function S0(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function P0(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:dC(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function dC(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function R0(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function hC(n){return n.reduce((e,t)=>Mt(e,t.meta),{})}function C0(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function fC(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;yx(n,e[i])<0?r=i:t=i+1}const s=pC(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function pC(n){let e=n;for(;e=e.parent;)if(_x(e)&&yx(n,e)===0)return e}function _x({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function mC(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(cx," "),o=i.indexOf("="),a=oc(o<0?i:i.slice(0,o)),l=o<0?null:oc(i.slice(o+1));if(a in e){let c=e[a];us(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function k0(n){let e="";for(let t in n){const r=n[t];if(t=VR(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(us(r)?r.map(i=>i&&nm(i)):[r&&nm(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function gC(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=us(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const vC=Symbol(""),D0=Symbol(""),Zh=Symbol(""),dg=Symbol(""),sm=Symbol("");function mu(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function ji(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=g=>{g===!1?l(wl(4,{from:t,to:e})):g instanceof Error?l(g):tC(g)?l(wl(2,{from:e,to:g})):(o&&r.enterCallbacks[s]===o&&typeof g=="function"&&o.push(g),a())},d=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(d);n.length<3&&(f=f.then(c)),f.catch(g=>l(g))})}function yp(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(lx(l)){const d=(l.__vccOpts||l)[e];d&&i.push(ji(d,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(d=>{if(!d)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=ER(d)?d.default:d;o.mods[a]=d,o.components[a]=f;const v=(f.__vccOpts||f)[e];return v&&ji(v,t,r,o,a,s)()}))}}return i}function N0(n){const e=os(Zh),t=os(dg),r=He(()=>{const l=$r(n.to);return e.resolve(l)}),s=He(()=>{const{matched:l}=r.value,{length:c}=l,d=l[c-1],f=t.matched;if(!d||!f.length)return-1;const g=f.findIndex(bl.bind(null,d));if(g>-1)return g;const v=O0(l[c-2]);return c>1&&O0(d)===v&&f[f.length-1].path!==v?f.findIndex(bl.bind(null,l[c-2])):g}),i=He(()=>s.value>-1&&xC(t.params,r.value.params)),o=He(()=>s.value>-1&&s.value===t.matched.length-1&&px(t.params,r.value.params));function a(l={}){if(wC(l)){const c=e[$r(n.replace)?"replace":"push"]($r(n.to)).catch(Fu);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:He(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function yC(n){return n.length===1?n[0]:n}const _C=Ow({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:N0,setup(n,{slots:e}){const t=Hh(N0(n)),{options:r}=os(Zh),s=He(()=>({[V0(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[V0(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&yC(e.default(t));return n.custom?i:ug("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),bC=_C;function wC(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function xC(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!us(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function O0(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const V0=(n,e,t)=>n??e??t,IC=Ow({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=os(sm),s=He(()=>n.route||r.value),i=os(D0,0),o=He(()=>{let c=$r(i);const{matched:d}=s.value;let f;for(;(f=d[c])&&!f.components;)c++;return c}),a=He(()=>s.value.matched[o.value]);jd(D0,He(()=>o.value+1)),jd(vC,a),jd(sm,s);const l=S();return Ct(()=>[l.value,a.value,n.name],([c,d,f],[g,v,x])=>{d&&(d.instances[f]=c,v&&v!==d&&c&&c===g&&(d.leaveGuards.size||(d.leaveGuards=v.leaveGuards),d.updateGuards.size||(d.updateGuards=v.updateGuards))),c&&d&&(!v||!bl(d,v)||!g)&&(d.enterCallbacks[f]||[]).forEach(w=>w(c))},{flush:"post"}),()=>{const c=s.value,d=n.name,f=a.value,g=f&&f.components[d];if(!g)return M0(t.default,{Component:g,route:c});const v=f.props[d],x=v?v===!0?c.params:typeof v=="function"?v(c):v:null,I=ug(g,Mt({},x,e,{onVnodeUnmounted:L=>{L.component.isUnmounted&&(f.instances[d]=null)},ref:l}));return M0(t.default,{Component:I,route:c})||I}}});function M0(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const EC=IC;function TC(n){const e=cC(n.routes,n),t=n.parseQuery||mC,r=n.stringifyQuery||k0,s=n.history,i=mu(),o=mu(),a=mu(),l=SS(Oi);let c=Oi;Za&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=gp.bind(null,Q=>""+Q),f=gp.bind(null,LR),g=gp.bind(null,oc);function v(Q,we){let ye,ke;return gx(Q)?(ye=e.getRecordMatcher(Q),ke=we):ke=Q,e.addRoute(ke,ye)}function x(Q){const we=e.getRecordMatcher(Q);we&&e.removeRoute(we)}function w(){return e.getRoutes().map(Q=>Q.record)}function I(Q){return!!e.getRecordMatcher(Q)}function L(Q,we){if(we=Mt({},we||l.value),typeof Q=="string"){const M=vp(t,Q,we.path),G=e.resolve({path:M.path},we),ue=s.createHref(M.fullPath);return Mt(M,G,{params:g(G.params),hash:oc(M.hash),redirectedFrom:void 0,href:ue})}let ye;if(Q.path!=null)ye=Mt({},Q,{path:vp(t,Q.path,we.path).path});else{const M=Mt({},Q.params);for(const G in M)M[G]==null&&delete M[G];ye=Mt({},Q,{params:f(M)}),we.params=f(we.params)}const ke=e.resolve(ye,we),rt=Q.hash||"";ke.params=d(g(ke.params));const yt=UR(r,Mt({},Q,{hash:OR(rt),path:ke.path})),P=s.createHref(yt);return Mt({fullPath:yt,hash:rt,query:r===k0?gC(Q.query):Q.query||{}},ke,{redirectedFrom:void 0,href:P})}function $(Q){return typeof Q=="string"?vp(t,Q,l.value.path):Mt({},Q)}function U(Q,we){if(c!==Q)return wl(8,{from:we,to:Q})}function z(Q){return A(Q)}function le(Q){return z(Mt($(Q),{replace:!0}))}function Z(Q){const we=Q.matched[Q.matched.length-1];if(we&&we.redirect){const{redirect:ye}=we;let ke=typeof ye=="function"?ye(Q):ye;return typeof ke=="string"&&(ke=ke.includes("?")||ke.includes("#")?ke=$(ke):{path:ke},ke.params={}),Mt({query:Q.query,hash:Q.hash,params:ke.path!=null?{}:Q.params},ke)}}function A(Q,we){const ye=c=L(Q),ke=l.value,rt=Q.state,yt=Q.force,P=Q.replace===!0,M=Z(ye);if(M)return A(Mt($(M),{state:typeof M=="object"?Mt({},rt,M.state):rt,force:yt,replace:P}),we||ye);const G=ye;G.redirectedFrom=we;let ue;return!yt&&jR(r,ke,ye)&&(ue=wl(16,{to:G,from:ke}),ae(ke,ke,!0,!1)),(ue?Promise.resolve(ue):D(G,ke)).catch(ne=>qs(ne)?qs(ne,2)?ne:Be(ne):Se(ne,G,ke)).then(ne=>{if(ne){if(qs(ne,2))return A(Mt({replace:P},$(ne.to),{state:typeof ne.to=="object"?Mt({},rt,ne.to.state):rt,force:yt}),we||G)}else ne=V(G,ke,!0,P,rt);return F(G,ke,ne),ne})}function b(Q,we){const ye=U(Q,we);return ye?Promise.reject(ye):Promise.resolve()}function E(Q){const we=St.values().next().value;return we&&typeof we.runWithContext=="function"?we.runWithContext(Q):Q()}function D(Q,we){let ye;const[ke,rt,yt]=AC(Q,we);ye=yp(ke.reverse(),"beforeRouteLeave",Q,we);for(const M of ke)M.leaveGuards.forEach(G=>{ye.push(ji(G,Q,we))});const P=b.bind(null,Q,we);return ye.push(P),kt(ye).then(()=>{ye=[];for(const M of i.list())ye.push(ji(M,Q,we));return ye.push(P),kt(ye)}).then(()=>{ye=yp(rt,"beforeRouteUpdate",Q,we);for(const M of rt)M.updateGuards.forEach(G=>{ye.push(ji(G,Q,we))});return ye.push(P),kt(ye)}).then(()=>{ye=[];for(const M of yt)if(M.beforeEnter)if(us(M.beforeEnter))for(const G of M.beforeEnter)ye.push(ji(G,Q,we));else ye.push(ji(M.beforeEnter,Q,we));return ye.push(P),kt(ye)}).then(()=>(Q.matched.forEach(M=>M.enterCallbacks={}),ye=yp(yt,"beforeRouteEnter",Q,we,E),ye.push(P),kt(ye))).then(()=>{ye=[];for(const M of o.list())ye.push(ji(M,Q,we));return ye.push(P),kt(ye)}).catch(M=>qs(M,8)?M:Promise.reject(M))}function F(Q,we,ye){a.list().forEach(ke=>E(()=>ke(Q,we,ye)))}function V(Q,we,ye,ke,rt){const yt=U(Q,we);if(yt)return yt;const P=we===Oi,M=Za?history.state:{};ye&&(ke||P?s.replace(Q.fullPath,Mt({scroll:P&&M&&M.scroll},rt)):s.push(Q.fullPath,rt)),l.value=Q,ae(Q,we,ye,P),Be()}let C;function Fe(){C||(C=s.listen((Q,we,ye)=>{if(!Ot.listening)return;const ke=L(Q),rt=Z(ke);if(rt){A(Mt(rt,{replace:!0,force:!0}),ke).catch(Fu);return}c=ke;const yt=l.value;Za&&QR(x0(yt.fullPath,ye.delta),Xh()),D(ke,yt).catch(P=>qs(P,12)?P:qs(P,2)?(A(Mt($(P.to),{force:!0}),ke).then(M=>{qs(M,20)&&!ye.delta&&ye.type===ac.pop&&s.go(-1,!1)}).catch(Fu),Promise.reject()):(ye.delta&&s.go(-ye.delta,!1),Se(P,ke,yt))).then(P=>{P=P||V(ke,yt,!1),P&&(ye.delta&&!qs(P,8)?s.go(-ye.delta,!1):ye.type===ac.pop&&qs(P,20)&&s.go(-1,!1)),F(ke,yt,P)}).catch(Fu)}))}let vt=mu(),It=mu(),We;function Se(Q,we,ye){Be(Q);const ke=It.list();return ke.length?ke.forEach(rt=>rt(Q,we,ye)):console.error(Q),Promise.reject(Q)}function me(){return We&&l.value!==Oi?Promise.resolve():new Promise((Q,we)=>{vt.add([Q,we])})}function Be(Q){return We||(We=!Q,Fe(),vt.list().forEach(([we,ye])=>Q?ye(Q):we()),vt.reset()),Q}function ae(Q,we,ye,ke){const{scrollBehavior:rt}=n;if(!Za||!rt)return Promise.resolve();const yt=!ye&&JR(x0(Q.fullPath,0))||(ke||!ye)&&history.state&&history.state.scroll||null;return jt().then(()=>rt(Q,we,yt)).then(P=>P&&WR(P)).catch(P=>Se(P,Q,we))}const re=Q=>s.go(Q);let Oe;const St=new Set,Ot={currentRoute:l,listening:!0,addRoute:v,removeRoute:x,clearRoutes:e.clearRoutes,hasRoute:I,getRoutes:w,resolve:L,options:n,push:z,replace:le,go:re,back:()=>re(-1),forward:()=>re(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:It.add,isReady:me,install(Q){const we=this;Q.component("RouterLink",bC),Q.component("RouterView",EC),Q.config.globalProperties.$router=we,Object.defineProperty(Q.config.globalProperties,"$route",{enumerable:!0,get:()=>$r(l)}),Za&&!Oe&&l.value===Oi&&(Oe=!0,z(s.location).catch(rt=>{}));const ye={};for(const rt in Oi)Object.defineProperty(ye,rt,{get:()=>l.value[rt],enumerable:!0});Q.provide(Zh,we),Q.provide(dg,gw(ye)),Q.provide(sm,l);const ke=Q.unmount;St.add(Q),Q.unmount=function(){St.delete(Q),St.size<1&&(c=Oi,C&&C(),C=null,l.value=Oi,Oe=!1,We=!1),ke()}}};function kt(Q){return Q.reduce((we,ye)=>we.then(()=>E(ye)),Promise.resolve())}return Ot}function AC(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>bl(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>bl(c,l))||s.push(l))}return[t,r,s]}function ba(){return os(Zh)}function vo(n){return os(dg)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bx=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},SC=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},wx={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,d=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|c>>6,v=c&63;l||(v=64,o||(g=64)),r.push(t[d],t[f],t[g],t[v])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(bx(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):SC(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new PC;const g=i<<2|a>>4;if(r.push(g),c!==64){const v=a<<4&240|c>>2;if(r.push(v),f!==64){const x=c<<6&192|f;r.push(x)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class PC extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const RC=function(n){const e=bx(n);return wx.encodeByteArray(e,!0)},fh=function(n){return RC(n).replace(/\./g,"")},xx=function(n){try{return wx.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kC=()=>CC().__FIREBASE_DEFAULTS__,DC=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},NC=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&xx(n[1]);return e&&JSON.parse(e)},ef=()=>{try{return kC()||DC()||NC()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Ix=n=>{var e,t;return(t=(e=ef())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Ex=n=>{const e=Ix(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Tx=()=>{var n;return(n=ef())===null||n===void 0?void 0:n.config},Ax=n=>{var e;return(e=ef())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OC{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sx(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[fh(JSON.stringify(t)),fh(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function VC(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Mn())}function MC(){var n;const e=(n=ef())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function LC(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function $C(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function FC(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function UC(){const n=Mn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Px(){return!MC()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function hg(){try{return typeof indexedDB=="object"}catch{return!1}}function Rx(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}function jC(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BC="FirebaseError";class ds extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=BC,Object.setPrototypeOf(this,ds.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,wa.prototype.create)}}class wa{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?qC(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new ds(s,a,r)}}function qC(n,e){return n.replace(zC,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const zC=/\{\$([^}]+)}/g;function HC(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function oo(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(L0(i)&&L0(o)){if(!oo(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function L0(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ul(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Tu(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Au(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function KC(n,e){const t=new GC(n,e);return t.subscribe.bind(t)}class GC{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");WC(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=_p),s.error===void 0&&(s.error=_p),s.complete===void 0&&(s.complete=_p);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function WC(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function _p(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ne(n){return n&&n._delegate?n._delegate:n}class Yr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bo="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QC{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new OC;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(YC(e))try{this.getOrInitializeService({instanceIdentifier:Bo})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Bo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Bo){return this.instances.has(e)}getOptions(e=Bo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:JC(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Bo){return this.component?this.component.multipleInstances?e:Bo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function JC(n){return n===Bo?void 0:n}function YC(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XC{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new QC(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _t;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(_t||(_t={}));const ZC={debug:_t.DEBUG,verbose:_t.VERBOSE,info:_t.INFO,warn:_t.WARN,error:_t.ERROR,silent:_t.SILENT},ek=_t.INFO,tk={[_t.DEBUG]:"log",[_t.VERBOSE]:"log",[_t.INFO]:"info",[_t.WARN]:"warn",[_t.ERROR]:"error"},nk=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=tk[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class fg{constructor(e){this.name=e,this._logLevel=ek,this._logHandler=nk,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in _t))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?ZC[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,_t.DEBUG,...e),this._logHandler(this,_t.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,_t.VERBOSE,...e),this._logHandler(this,_t.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,_t.INFO,...e),this._logHandler(this,_t.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,_t.WARN,...e),this._logHandler(this,_t.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,_t.ERROR,...e),this._logHandler(this,_t.ERROR,...e)}}const rk=(n,e)=>e.some(t=>n instanceof t);let $0,F0;function sk(){return $0||($0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ik(){return F0||(F0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Cx=new WeakMap,im=new WeakMap,kx=new WeakMap,bp=new WeakMap,pg=new WeakMap;function ok(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(ni(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Cx.set(t,n)}).catch(()=>{}),pg.set(e,n),e}function ak(n){if(im.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});im.set(n,e)}let om={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return im.get(n);if(e==="objectStoreNames")return n.objectStoreNames||kx.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ni(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function lk(n){om=n(om)}function uk(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(wp(this),e,...t);return kx.set(r,e.sort?e.sort():[e]),ni(r)}:ik().includes(n)?function(...e){return n.apply(wp(this),e),ni(Cx.get(this))}:function(...e){return ni(n.apply(wp(this),e))}}function ck(n){return typeof n=="function"?uk(n):(n instanceof IDBTransaction&&ak(n),rk(n,sk())?new Proxy(n,om):n)}function ni(n){if(n instanceof IDBRequest)return ok(n);if(bp.has(n))return bp.get(n);const e=ck(n);return e!==n&&(bp.set(n,e),pg.set(e,n)),e}const wp=n=>pg.get(n);function tf(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=ni(o);return r&&o.addEventListener("upgradeneeded",l=>{r(ni(o.result),l.oldVersion,l.newVersion,ni(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function xp(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),ni(t).then(()=>{})}const dk=["get","getKey","getAll","getAllKeys","count"],hk=["put","add","delete","clear"],Ip=new Map;function U0(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Ip.get(e))return Ip.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=hk.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||dk.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return Ip.set(e,i),i}lk(n=>({...n,get:(e,t,r)=>U0(e,t)||n.get(e,t,r),has:(e,t)=>!!U0(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fk{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(pk(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function pk(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const am="@firebase/app",j0="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oi=new fg("@firebase/app"),mk="@firebase/app-compat",gk="@firebase/analytics-compat",vk="@firebase/analytics",yk="@firebase/app-check-compat",_k="@firebase/app-check",bk="@firebase/auth",wk="@firebase/auth-compat",xk="@firebase/database",Ik="@firebase/data-connect",Ek="@firebase/database-compat",Tk="@firebase/functions",Ak="@firebase/functions-compat",Sk="@firebase/installations",Pk="@firebase/installations-compat",Rk="@firebase/messaging",Ck="@firebase/messaging-compat",kk="@firebase/performance",Dk="@firebase/performance-compat",Nk="@firebase/remote-config",Ok="@firebase/remote-config-compat",Vk="@firebase/storage",Mk="@firebase/storage-compat",Lk="@firebase/firestore",$k="@firebase/vertexai-preview",Fk="@firebase/firestore-compat",Uk="firebase",jk="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ph="[DEFAULT]",Bk={[am]:"fire-core",[mk]:"fire-core-compat",[vk]:"fire-analytics",[gk]:"fire-analytics-compat",[_k]:"fire-app-check",[yk]:"fire-app-check-compat",[bk]:"fire-auth",[wk]:"fire-auth-compat",[xk]:"fire-rtdb",[Ik]:"fire-data-connect",[Ek]:"fire-rtdb-compat",[Tk]:"fire-fn",[Ak]:"fire-fn-compat",[Sk]:"fire-iid",[Pk]:"fire-iid-compat",[Rk]:"fire-fcm",[Ck]:"fire-fcm-compat",[kk]:"fire-perf",[Dk]:"fire-perf-compat",[Nk]:"fire-rc",[Ok]:"fire-rc-compat",[Vk]:"fire-gcs",[Mk]:"fire-gcs-compat",[Lk]:"fire-fst",[Fk]:"fire-fst-compat",[$k]:"fire-vertex","fire-js":"fire-js",[Uk]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh=new Map,qk=new Map,lm=new Map;function B0(n,e){try{n.container.addComponent(e)}catch(t){oi.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function cs(n){const e=n.name;if(lm.has(e))return oi.debug(`There were multiple attempts to register component ${e}.`),!1;lm.set(e,n);for(const t of mh.values())B0(t,n);for(const t of qk.values())B0(t,n);return!0}function fi(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function zk(n,e,t=ph){fi(n,e).clearInstance(t)}function Tn(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hk={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},to=new wa("app","Firebase",Hk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kk{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Yr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw to.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xa=jk;function Dx(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:ph,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw to.create("bad-app-name",{appName:String(s)});if(t||(t=Tx()),!t)throw to.create("no-options");const i=mh.get(s);if(i){if(oo(t,i.options)&&oo(r,i.config))return i;throw to.create("duplicate-app",{appName:s})}const o=new XC(s);for(const l of lm.values())o.addComponent(l);const a=new Kk(t,r,o);return mh.set(s,a),a}function jl(n=ph){const e=mh.get(n);if(!e&&n===ph&&Tx())return Dx();if(!e)throw to.create("no-app",{appName:n});return e}function Rr(n,e,t){var r;let s=(r=Bk[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),oi.warn(a.join(" "));return}cs(new Yr(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gk="firebase-heartbeat-database",Wk=1,lc="firebase-heartbeat-store";let Ep=null;function Nx(){return Ep||(Ep=tf(Gk,Wk,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(lc)}catch(t){console.warn(t)}}}}).catch(n=>{throw to.create("idb-open",{originalErrorMessage:n.message})})),Ep}async function Qk(n){try{const t=(await Nx()).transaction(lc),r=await t.objectStore(lc).get(Ox(n));return await t.done,r}catch(e){if(e instanceof ds)oi.warn(e.message);else{const t=to.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});oi.warn(t.message)}}}async function q0(n,e){try{const r=(await Nx()).transaction(lc,"readwrite");await r.objectStore(lc).put(e,Ox(n)),await r.done}catch(t){if(t instanceof ds)oi.warn(t.message);else{const r=to.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});oi.warn(r.message)}}}function Ox(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jk=1024,Yk=30*24*60*60*1e3;class Xk{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new e2(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=z0();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=Yk}),this._storage.overwrite(this._heartbeatsCache))}catch(r){oi.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=z0(),{heartbeatsToSend:r,unsentEntries:s}=Zk(this._heartbeatsCache.heartbeats),i=fh(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return oi.warn(t),""}}}function z0(){return new Date().toISOString().substring(0,10)}function Zk(n,e=Jk){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),H0(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),H0(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class e2{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return hg()?Rx().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Qk(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return q0(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return q0(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function H0(n){return fh(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t2(n){cs(new Yr("platform-logger",e=>new fk(e),"PRIVATE")),cs(new Yr("heartbeat",e=>new Xk(e),"PRIVATE")),Rr(am,j0,n),Rr(am,j0,"esm2017"),Rr("fire-js","")}t2("");const Vx="@firebase/installations",mg="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mx=1e4,Lx=`w:${mg}`,$x="FIS_v2",n2="https://firebaseinstallations.googleapis.com/v1",r2=60*60*1e3,s2="installations",i2="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o2={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},aa=new wa(s2,i2,o2);function Fx(n){return n instanceof ds&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ux({projectId:n}){return`${n2}/projects/${n}/installations`}function jx(n){return{token:n.token,requestStatus:2,expiresIn:l2(n.expiresIn),creationTime:Date.now()}}async function Bx(n,e){const r=(await e.json()).error;return aa.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function qx({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function a2(n,{refreshToken:e}){const t=qx(n);return t.append("Authorization",u2(e)),t}async function zx(n){const e=await n();return e.status>=500&&e.status<600?n():e}function l2(n){return Number(n.replace("s","000"))}function u2(n){return`${$x} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c2({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=Ux(n),s=qx(n),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={fid:t,authVersion:$x,appId:n.appId,sdkVersion:Lx},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await zx(()=>fetch(r,a));if(l.ok){const c=await l.json();return{fid:c.fid||t,registrationStatus:2,refreshToken:c.refreshToken,authToken:jx(c.authToken)}}else throw await Bx("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hx(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d2(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h2=/^[cdef][\w-]{21}$/,um="";function f2(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=p2(n);return h2.test(t)?t:um}catch{return um}}function p2(n){return d2(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nf(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kx=new Map;function Gx(n,e){const t=nf(n);Wx(t,e),m2(t,e)}function Wx(n,e){const t=Kx.get(n);if(t)for(const r of t)r(e)}function m2(n,e){const t=g2();t&&t.postMessage({key:n,fid:e}),v2()}let Xo=null;function g2(){return!Xo&&"BroadcastChannel"in self&&(Xo=new BroadcastChannel("[Firebase] FID Change"),Xo.onmessage=n=>{Wx(n.data.key,n.data.fid)}),Xo}function v2(){Kx.size===0&&Xo&&(Xo.close(),Xo=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y2="firebase-installations-database",_2=1,la="firebase-installations-store";let Tp=null;function gg(){return Tp||(Tp=tf(y2,_2,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(la)}}})),Tp}async function gh(n,e){const t=nf(n),s=(await gg()).transaction(la,"readwrite"),i=s.objectStore(la),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&Gx(n,e.fid),e}async function Qx(n){const e=nf(n),r=(await gg()).transaction(la,"readwrite");await r.objectStore(la).delete(e),await r.done}async function rf(n,e){const t=nf(n),s=(await gg()).transaction(la,"readwrite"),i=s.objectStore(la),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&Gx(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vg(n){let e;const t=await rf(n.appConfig,r=>{const s=b2(r),i=w2(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===um?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function b2(n){const e=n||{fid:f2(),registrationStatus:0};return Jx(e)}function w2(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(aa.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=x2(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:I2(n)}:{installationEntry:e}}async function x2(n,e){try{const t=await c2(n,e);return gh(n.appConfig,t)}catch(t){throw Fx(t)&&t.customData.serverCode===409?await Qx(n.appConfig):await gh(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function I2(n){let e=await K0(n.appConfig);for(;e.registrationStatus===1;)await Hx(100),e=await K0(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await vg(n);return r||t}return e}function K0(n){return rf(n,e=>{if(!e)throw aa.create("installation-not-found");return Jx(e)})}function Jx(n){return E2(n)?{fid:n.fid,registrationStatus:0}:n}function E2(n){return n.registrationStatus===1&&n.registrationTime+Mx<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T2({appConfig:n,heartbeatServiceProvider:e},t){const r=A2(n,t),s=a2(n,t),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={installation:{sdkVersion:Lx,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await zx(()=>fetch(r,a));if(l.ok){const c=await l.json();return jx(c)}else throw await Bx("Generate Auth Token",l)}function A2(n,{fid:e}){return`${Ux(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yg(n,e=!1){let t;const r=await rf(n.appConfig,i=>{if(!Yx(i))throw aa.create("not-registered");const o=i.authToken;if(!e&&R2(o))return i;if(o.requestStatus===1)return t=S2(n,e),i;{if(!navigator.onLine)throw aa.create("app-offline");const a=k2(i);return t=P2(n,a),a}});return t?await t:r.authToken}async function S2(n,e){let t=await G0(n.appConfig);for(;t.authToken.requestStatus===1;)await Hx(100),t=await G0(n.appConfig);const r=t.authToken;return r.requestStatus===0?yg(n,e):r}function G0(n){return rf(n,e=>{if(!Yx(e))throw aa.create("not-registered");const t=e.authToken;return D2(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function P2(n,e){try{const t=await T2(n,e),r=Object.assign(Object.assign({},e),{authToken:t});return await gh(n.appConfig,r),t}catch(t){if(Fx(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await Qx(n.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await gh(n.appConfig,r)}throw t}}function Yx(n){return n!==void 0&&n.registrationStatus===2}function R2(n){return n.requestStatus===2&&!C2(n)}function C2(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+r2}function k2(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function D2(n){return n.requestStatus===1&&n.requestTime+Mx<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N2(n){const e=n,{installationEntry:t,registrationPromise:r}=await vg(e);return r?r.catch(console.error):yg(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function O2(n,e=!1){const t=n;return await V2(t),(await yg(t,e)).token}async function V2(n){const{registrationPromise:e}=await vg(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M2(n){if(!n||!n.options)throw Ap("App Configuration");if(!n.name)throw Ap("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Ap(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Ap(n){return aa.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xx="installations",L2="installations-internal",$2=n=>{const e=n.getProvider("app").getImmediate(),t=M2(e),r=fi(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},F2=n=>{const e=n.getProvider("app").getImmediate(),t=fi(e,Xx).getImmediate();return{getId:()=>N2(t),getToken:s=>O2(t,s)}};function U2(){cs(new Yr(Xx,$2,"PUBLIC")),cs(new Yr(L2,F2,"PRIVATE"))}U2();Rr(Vx,mg);Rr(Vx,mg,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j2="/firebase-messaging-sw.js",B2="/firebase-cloud-messaging-push-scope",Zx="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",q2="https://fcmregistrations.googleapis.com/v1",eI="google.c.a.c_id",z2="google.c.a.c_l",H2="google.c.a.ts",K2="google.c.a.e";var W0;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(W0||(W0={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var uc;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(uc||(uc={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hs(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function G2(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),s=new Uint8Array(r.length);for(let i=0;i<r.length;++i)s[i]=r.charCodeAt(i);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sp="fcm_token_details_db",W2=5,Q0="fcm_token_object_Store";async function Q2(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(i=>i.name).includes(Sp))return null;let e=null;return(await tf(Sp,W2,{upgrade:async(r,s,i,o)=>{var a;if(s<2||!r.objectStoreNames.contains(Q0))return;const l=o.objectStore(Q0),c=await l.index("fcmSenderId").get(n);if(await l.clear(),!!c){if(s===2){const d=c;if(!d.auth||!d.p256dh||!d.endpoint)return;e={token:d.fcmToken,createTime:(a=d.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:d.auth,p256dh:d.p256dh,endpoint:d.endpoint,swScope:d.swScope,vapidKey:typeof d.vapidKey=="string"?d.vapidKey:Hs(d.vapidKey)}}}else if(s===3){const d=c;e={token:d.fcmToken,createTime:d.createTime,subscriptionOptions:{auth:Hs(d.auth),p256dh:Hs(d.p256dh),endpoint:d.endpoint,swScope:d.swScope,vapidKey:Hs(d.vapidKey)}}}else if(s===4){const d=c;e={token:d.fcmToken,createTime:d.createTime,subscriptionOptions:{auth:Hs(d.auth),p256dh:Hs(d.p256dh),endpoint:d.endpoint,swScope:d.swScope,vapidKey:Hs(d.vapidKey)}}}}}})).close(),await xp(Sp),await xp("fcm_vapid_details_db"),await xp("undefined"),J2(e)?e:null}function J2(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y2="firebase-messaging-database",X2=1,cc="firebase-messaging-store";let Pp=null;function tI(){return Pp||(Pp=tf(Y2,X2,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(cc)}}})),Pp}async function Z2(n){const e=nI(n),r=await(await tI()).transaction(cc).objectStore(cc).get(e);if(r)return r;{const s=await Q2(n.appConfig.senderId);if(s)return await _g(n,s),s}}async function _g(n,e){const t=nI(n),s=(await tI()).transaction(cc,"readwrite");return await s.objectStore(cc).put(e,t),await s.done,e}function nI({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eD={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},wr=new wa("messaging","Messaging",eD);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tD(n,e){const t=await wg(n),r=rI(e),s={method:"POST",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(bg(n.appConfig),s)).json()}catch(o){throw wr.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw wr.create("token-subscribe-failed",{errorInfo:o})}if(!i.token)throw wr.create("token-subscribe-no-token");return i.token}async function nD(n,e){const t=await wg(n),r=rI(e.subscriptionOptions),s={method:"PATCH",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(`${bg(n.appConfig)}/${e.token}`,s)).json()}catch(o){throw wr.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw wr.create("token-update-failed",{errorInfo:o})}if(!i.token)throw wr.create("token-update-no-token");return i.token}async function rD(n,e){const r={method:"DELETE",headers:await wg(n)};try{const i=await(await fetch(`${bg(n.appConfig)}/${e}`,r)).json();if(i.error){const o=i.error.message;throw wr.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw wr.create("token-unsubscribe-failed",{errorInfo:s==null?void 0:s.toString()})}}function bg({projectId:n}){return`${q2}/projects/${n}/registrations`}async function wg({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function rI({p256dh:n,auth:e,endpoint:t,vapidKey:r}){const s={web:{endpoint:t,auth:e,p256dh:n}};return r!==Zx&&(s.web.applicationPubKey=r),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sD=7*24*60*60*1e3;async function iD(n){const e=await aD(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:Hs(e.getKey("auth")),p256dh:Hs(e.getKey("p256dh"))},r=await Z2(n.firebaseDependencies);if(r){if(lD(r.subscriptionOptions,t))return Date.now()>=r.createTime+sD?oD(n,{token:r.token,createTime:Date.now(),subscriptionOptions:t}):r.token;try{await rD(n.firebaseDependencies,r.token)}catch(s){console.warn(s)}return J0(n.firebaseDependencies,t)}else return J0(n.firebaseDependencies,t)}async function oD(n,e){try{const t=await nD(n.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await _g(n.firebaseDependencies,r),t}catch(t){throw t}}async function J0(n,e){const r={token:await tD(n,e),createTime:Date.now(),subscriptionOptions:e};return await _g(n,r),r.token}async function aD(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:G2(e)})}function lD(n,e){const t=e.vapidKey===n.vapidKey,r=e.endpoint===n.endpoint,s=e.auth===n.auth,i=e.p256dh===n.p256dh;return t&&r&&s&&i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y0(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return uD(e,n),cD(e,n),dD(e,n),e}function uD(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const r=e.notification.body;r&&(n.notification.body=r);const s=e.notification.image;s&&(n.notification.image=s);const i=e.notification.icon;i&&(n.notification.icon=i)}function cD(n,e){e.data&&(n.data=e.data)}function dD(n,e){var t,r,s,i,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(s=(r=e.fcmOptions)===null||r===void 0?void 0:r.link)!==null&&s!==void 0?s:(i=e.notification)===null||i===void 0?void 0:i.click_action;a&&(n.fcmOptions.link=a);const l=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;l&&(n.fcmOptions.analyticsLabel=l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hD(n){return typeof n=="object"&&!!n&&eI in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */fD("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function fD(n,e){const t=[];for(let r=0;r<n.length;r++)t.push(n.charAt(r)),r<e.length&&t.push(e.charAt(r));return t.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pD(n){if(!n||!n.options)throw Rp("App Configuration Object");if(!n.name)throw Rp("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const r of e)if(!t[r])throw Rp(r);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function Rp(n){return wr.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mD{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=pD(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gD(n){try{n.swRegistration=await navigator.serviceWorker.register(j2,{scope:B2}),n.swRegistration.update().catch(()=>{})}catch(e){throw wr.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vD(n,e){if(!e&&!n.swRegistration&&await gD(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw wr.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yD(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=Zx)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sI(n,e){if(!navigator)throw wr.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw wr.create("permission-blocked");return await yD(n,e==null?void 0:e.vapidKey),await vD(n,e==null?void 0:e.serviceWorkerRegistration),iD(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _D(n,e,t){const r=bD(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:t[eI],message_name:t[z2],message_time:t[H2],message_device_time:Math.floor(Date.now()/1e3)})}function bD(n){switch(n){case uc.NOTIFICATION_CLICKED:return"notification_open";case uc.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wD(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===uc.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(Y0(t)):n.onMessageHandler.next(Y0(t)));const r=t.data;hD(r)&&r[K2]==="1"&&await _D(n,t.messageType,r)}const X0="@firebase/messaging",Z0="0.12.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xD=n=>{const e=new mD(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>wD(e,t)),e},ID=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:r=>sI(e,r)}};function ED(){cs(new Yr("messaging",xD,"PUBLIC")),cs(new Yr("messaging-internal",ID,"PRIVATE")),Rr(X0,Z0),Rr(X0,Z0,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iI(){try{await Rx()}catch{return!1}return typeof window<"u"&&hg()&&jC()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xg(n=jl()){return iI().then(e=>{if(!e)throw wr.create("unsupported-browser")},e=>{throw wr.create("indexed-db-unsupported")}),fi(Ne(n),"messaging").getImmediate()}async function oI(n,e){return n=Ne(n),sI(n,e)}ED();var TD="firebase",AD="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Rr(TD,AD,"app");var e_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var na,aI;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(A,b){function E(){}E.prototype=b.prototype,A.D=b.prototype,A.prototype=new E,A.prototype.constructor=A,A.C=function(D,F,V){for(var C=Array(arguments.length-2),Fe=2;Fe<arguments.length;Fe++)C[Fe-2]=arguments[Fe];return b.prototype[F].apply(D,C)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(A,b,E){E||(E=0);var D=Array(16);if(typeof b=="string")for(var F=0;16>F;++F)D[F]=b.charCodeAt(E++)|b.charCodeAt(E++)<<8|b.charCodeAt(E++)<<16|b.charCodeAt(E++)<<24;else for(F=0;16>F;++F)D[F]=b[E++]|b[E++]<<8|b[E++]<<16|b[E++]<<24;b=A.g[0],E=A.g[1],F=A.g[2];var V=A.g[3],C=b+(V^E&(F^V))+D[0]+3614090360&4294967295;b=E+(C<<7&4294967295|C>>>25),C=V+(F^b&(E^F))+D[1]+3905402710&4294967295,V=b+(C<<12&4294967295|C>>>20),C=F+(E^V&(b^E))+D[2]+606105819&4294967295,F=V+(C<<17&4294967295|C>>>15),C=E+(b^F&(V^b))+D[3]+3250441966&4294967295,E=F+(C<<22&4294967295|C>>>10),C=b+(V^E&(F^V))+D[4]+4118548399&4294967295,b=E+(C<<7&4294967295|C>>>25),C=V+(F^b&(E^F))+D[5]+1200080426&4294967295,V=b+(C<<12&4294967295|C>>>20),C=F+(E^V&(b^E))+D[6]+2821735955&4294967295,F=V+(C<<17&4294967295|C>>>15),C=E+(b^F&(V^b))+D[7]+4249261313&4294967295,E=F+(C<<22&4294967295|C>>>10),C=b+(V^E&(F^V))+D[8]+1770035416&4294967295,b=E+(C<<7&4294967295|C>>>25),C=V+(F^b&(E^F))+D[9]+2336552879&4294967295,V=b+(C<<12&4294967295|C>>>20),C=F+(E^V&(b^E))+D[10]+4294925233&4294967295,F=V+(C<<17&4294967295|C>>>15),C=E+(b^F&(V^b))+D[11]+2304563134&4294967295,E=F+(C<<22&4294967295|C>>>10),C=b+(V^E&(F^V))+D[12]+1804603682&4294967295,b=E+(C<<7&4294967295|C>>>25),C=V+(F^b&(E^F))+D[13]+4254626195&4294967295,V=b+(C<<12&4294967295|C>>>20),C=F+(E^V&(b^E))+D[14]+2792965006&4294967295,F=V+(C<<17&4294967295|C>>>15),C=E+(b^F&(V^b))+D[15]+1236535329&4294967295,E=F+(C<<22&4294967295|C>>>10),C=b+(F^V&(E^F))+D[1]+4129170786&4294967295,b=E+(C<<5&4294967295|C>>>27),C=V+(E^F&(b^E))+D[6]+3225465664&4294967295,V=b+(C<<9&4294967295|C>>>23),C=F+(b^E&(V^b))+D[11]+643717713&4294967295,F=V+(C<<14&4294967295|C>>>18),C=E+(V^b&(F^V))+D[0]+3921069994&4294967295,E=F+(C<<20&4294967295|C>>>12),C=b+(F^V&(E^F))+D[5]+3593408605&4294967295,b=E+(C<<5&4294967295|C>>>27),C=V+(E^F&(b^E))+D[10]+38016083&4294967295,V=b+(C<<9&4294967295|C>>>23),C=F+(b^E&(V^b))+D[15]+3634488961&4294967295,F=V+(C<<14&4294967295|C>>>18),C=E+(V^b&(F^V))+D[4]+3889429448&4294967295,E=F+(C<<20&4294967295|C>>>12),C=b+(F^V&(E^F))+D[9]+568446438&4294967295,b=E+(C<<5&4294967295|C>>>27),C=V+(E^F&(b^E))+D[14]+3275163606&4294967295,V=b+(C<<9&4294967295|C>>>23),C=F+(b^E&(V^b))+D[3]+4107603335&4294967295,F=V+(C<<14&4294967295|C>>>18),C=E+(V^b&(F^V))+D[8]+1163531501&4294967295,E=F+(C<<20&4294967295|C>>>12),C=b+(F^V&(E^F))+D[13]+2850285829&4294967295,b=E+(C<<5&4294967295|C>>>27),C=V+(E^F&(b^E))+D[2]+4243563512&4294967295,V=b+(C<<9&4294967295|C>>>23),C=F+(b^E&(V^b))+D[7]+1735328473&4294967295,F=V+(C<<14&4294967295|C>>>18),C=E+(V^b&(F^V))+D[12]+2368359562&4294967295,E=F+(C<<20&4294967295|C>>>12),C=b+(E^F^V)+D[5]+4294588738&4294967295,b=E+(C<<4&4294967295|C>>>28),C=V+(b^E^F)+D[8]+2272392833&4294967295,V=b+(C<<11&4294967295|C>>>21),C=F+(V^b^E)+D[11]+1839030562&4294967295,F=V+(C<<16&4294967295|C>>>16),C=E+(F^V^b)+D[14]+4259657740&4294967295,E=F+(C<<23&4294967295|C>>>9),C=b+(E^F^V)+D[1]+2763975236&4294967295,b=E+(C<<4&4294967295|C>>>28),C=V+(b^E^F)+D[4]+1272893353&4294967295,V=b+(C<<11&4294967295|C>>>21),C=F+(V^b^E)+D[7]+4139469664&4294967295,F=V+(C<<16&4294967295|C>>>16),C=E+(F^V^b)+D[10]+3200236656&4294967295,E=F+(C<<23&4294967295|C>>>9),C=b+(E^F^V)+D[13]+681279174&4294967295,b=E+(C<<4&4294967295|C>>>28),C=V+(b^E^F)+D[0]+3936430074&4294967295,V=b+(C<<11&4294967295|C>>>21),C=F+(V^b^E)+D[3]+3572445317&4294967295,F=V+(C<<16&4294967295|C>>>16),C=E+(F^V^b)+D[6]+76029189&4294967295,E=F+(C<<23&4294967295|C>>>9),C=b+(E^F^V)+D[9]+3654602809&4294967295,b=E+(C<<4&4294967295|C>>>28),C=V+(b^E^F)+D[12]+3873151461&4294967295,V=b+(C<<11&4294967295|C>>>21),C=F+(V^b^E)+D[15]+530742520&4294967295,F=V+(C<<16&4294967295|C>>>16),C=E+(F^V^b)+D[2]+3299628645&4294967295,E=F+(C<<23&4294967295|C>>>9),C=b+(F^(E|~V))+D[0]+4096336452&4294967295,b=E+(C<<6&4294967295|C>>>26),C=V+(E^(b|~F))+D[7]+1126891415&4294967295,V=b+(C<<10&4294967295|C>>>22),C=F+(b^(V|~E))+D[14]+2878612391&4294967295,F=V+(C<<15&4294967295|C>>>17),C=E+(V^(F|~b))+D[5]+4237533241&4294967295,E=F+(C<<21&4294967295|C>>>11),C=b+(F^(E|~V))+D[12]+1700485571&4294967295,b=E+(C<<6&4294967295|C>>>26),C=V+(E^(b|~F))+D[3]+2399980690&4294967295,V=b+(C<<10&4294967295|C>>>22),C=F+(b^(V|~E))+D[10]+4293915773&4294967295,F=V+(C<<15&4294967295|C>>>17),C=E+(V^(F|~b))+D[1]+2240044497&4294967295,E=F+(C<<21&4294967295|C>>>11),C=b+(F^(E|~V))+D[8]+1873313359&4294967295,b=E+(C<<6&4294967295|C>>>26),C=V+(E^(b|~F))+D[15]+4264355552&4294967295,V=b+(C<<10&4294967295|C>>>22),C=F+(b^(V|~E))+D[6]+2734768916&4294967295,F=V+(C<<15&4294967295|C>>>17),C=E+(V^(F|~b))+D[13]+1309151649&4294967295,E=F+(C<<21&4294967295|C>>>11),C=b+(F^(E|~V))+D[4]+4149444226&4294967295,b=E+(C<<6&4294967295|C>>>26),C=V+(E^(b|~F))+D[11]+3174756917&4294967295,V=b+(C<<10&4294967295|C>>>22),C=F+(b^(V|~E))+D[2]+718787259&4294967295,F=V+(C<<15&4294967295|C>>>17),C=E+(V^(F|~b))+D[9]+3951481745&4294967295,A.g[0]=A.g[0]+b&4294967295,A.g[1]=A.g[1]+(F+(C<<21&4294967295|C>>>11))&4294967295,A.g[2]=A.g[2]+F&4294967295,A.g[3]=A.g[3]+V&4294967295}r.prototype.u=function(A,b){b===void 0&&(b=A.length);for(var E=b-this.blockSize,D=this.B,F=this.h,V=0;V<b;){if(F==0)for(;V<=E;)s(this,A,V),V+=this.blockSize;if(typeof A=="string"){for(;V<b;)if(D[F++]=A.charCodeAt(V++),F==this.blockSize){s(this,D),F=0;break}}else for(;V<b;)if(D[F++]=A[V++],F==this.blockSize){s(this,D),F=0;break}}this.h=F,this.o+=b},r.prototype.v=function(){var A=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);A[0]=128;for(var b=1;b<A.length-8;++b)A[b]=0;var E=8*this.o;for(b=A.length-8;b<A.length;++b)A[b]=E&255,E/=256;for(this.u(A),A=Array(16),b=E=0;4>b;++b)for(var D=0;32>D;D+=8)A[E++]=this.g[b]>>>D&255;return A};function i(A,b){var E=a;return Object.prototype.hasOwnProperty.call(E,A)?E[A]:E[A]=b(A)}function o(A,b){this.h=b;for(var E=[],D=!0,F=A.length-1;0<=F;F--){var V=A[F]|0;D&&V==b||(E[F]=V,D=!1)}this.g=E}var a={};function l(A){return-128<=A&&128>A?i(A,function(b){return new o([b|0],0>b?-1:0)}):new o([A|0],0>A?-1:0)}function c(A){if(isNaN(A)||!isFinite(A))return f;if(0>A)return I(c(-A));for(var b=[],E=1,D=0;A>=E;D++)b[D]=A/E|0,E*=4294967296;return new o(b,0)}function d(A,b){if(A.length==0)throw Error("number format error: empty string");if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(A.charAt(0)=="-")return I(d(A.substring(1),b));if(0<=A.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=c(Math.pow(b,8)),D=f,F=0;F<A.length;F+=8){var V=Math.min(8,A.length-F),C=parseInt(A.substring(F,F+V),b);8>V?(V=c(Math.pow(b,V)),D=D.j(V).add(c(C))):(D=D.j(E),D=D.add(c(C)))}return D}var f=l(0),g=l(1),v=l(16777216);n=o.prototype,n.m=function(){if(w(this))return-I(this).m();for(var A=0,b=1,E=0;E<this.g.length;E++){var D=this.i(E);A+=(0<=D?D:4294967296+D)*b,b*=4294967296}return A},n.toString=function(A){if(A=A||10,2>A||36<A)throw Error("radix out of range: "+A);if(x(this))return"0";if(w(this))return"-"+I(this).toString(A);for(var b=c(Math.pow(A,6)),E=this,D="";;){var F=z(E,b).g;E=L(E,F.j(b));var V=((0<E.g.length?E.g[0]:E.h)>>>0).toString(A);if(E=F,x(E))return V+D;for(;6>V.length;)V="0"+V;D=V+D}},n.i=function(A){return 0>A?0:A<this.g.length?this.g[A]:this.h};function x(A){if(A.h!=0)return!1;for(var b=0;b<A.g.length;b++)if(A.g[b]!=0)return!1;return!0}function w(A){return A.h==-1}n.l=function(A){return A=L(this,A),w(A)?-1:x(A)?0:1};function I(A){for(var b=A.g.length,E=[],D=0;D<b;D++)E[D]=~A.g[D];return new o(E,~A.h).add(g)}n.abs=function(){return w(this)?I(this):this},n.add=function(A){for(var b=Math.max(this.g.length,A.g.length),E=[],D=0,F=0;F<=b;F++){var V=D+(this.i(F)&65535)+(A.i(F)&65535),C=(V>>>16)+(this.i(F)>>>16)+(A.i(F)>>>16);D=C>>>16,V&=65535,C&=65535,E[F]=C<<16|V}return new o(E,E[E.length-1]&-2147483648?-1:0)};function L(A,b){return A.add(I(b))}n.j=function(A){if(x(this)||x(A))return f;if(w(this))return w(A)?I(this).j(I(A)):I(I(this).j(A));if(w(A))return I(this.j(I(A)));if(0>this.l(v)&&0>A.l(v))return c(this.m()*A.m());for(var b=this.g.length+A.g.length,E=[],D=0;D<2*b;D++)E[D]=0;for(D=0;D<this.g.length;D++)for(var F=0;F<A.g.length;F++){var V=this.i(D)>>>16,C=this.i(D)&65535,Fe=A.i(F)>>>16,vt=A.i(F)&65535;E[2*D+2*F]+=C*vt,$(E,2*D+2*F),E[2*D+2*F+1]+=V*vt,$(E,2*D+2*F+1),E[2*D+2*F+1]+=C*Fe,$(E,2*D+2*F+1),E[2*D+2*F+2]+=V*Fe,$(E,2*D+2*F+2)}for(D=0;D<b;D++)E[D]=E[2*D+1]<<16|E[2*D];for(D=b;D<2*b;D++)E[D]=0;return new o(E,0)};function $(A,b){for(;(A[b]&65535)!=A[b];)A[b+1]+=A[b]>>>16,A[b]&=65535,b++}function U(A,b){this.g=A,this.h=b}function z(A,b){if(x(b))throw Error("division by zero");if(x(A))return new U(f,f);if(w(A))return b=z(I(A),b),new U(I(b.g),I(b.h));if(w(b))return b=z(A,I(b)),new U(I(b.g),b.h);if(30<A.g.length){if(w(A)||w(b))throw Error("slowDivide_ only works with positive integers.");for(var E=g,D=b;0>=D.l(A);)E=le(E),D=le(D);var F=Z(E,1),V=Z(D,1);for(D=Z(D,2),E=Z(E,2);!x(D);){var C=V.add(D);0>=C.l(A)&&(F=F.add(E),V=C),D=Z(D,1),E=Z(E,1)}return b=L(A,F.j(b)),new U(F,b)}for(F=f;0<=A.l(b);){for(E=Math.max(1,Math.floor(A.m()/b.m())),D=Math.ceil(Math.log(E)/Math.LN2),D=48>=D?1:Math.pow(2,D-48),V=c(E),C=V.j(b);w(C)||0<C.l(A);)E-=D,V=c(E),C=V.j(b);x(V)&&(V=g),F=F.add(V),A=L(A,C)}return new U(F,A)}n.A=function(A){return z(this,A).h},n.and=function(A){for(var b=Math.max(this.g.length,A.g.length),E=[],D=0;D<b;D++)E[D]=this.i(D)&A.i(D);return new o(E,this.h&A.h)},n.or=function(A){for(var b=Math.max(this.g.length,A.g.length),E=[],D=0;D<b;D++)E[D]=this.i(D)|A.i(D);return new o(E,this.h|A.h)},n.xor=function(A){for(var b=Math.max(this.g.length,A.g.length),E=[],D=0;D<b;D++)E[D]=this.i(D)^A.i(D);return new o(E,this.h^A.h)};function le(A){for(var b=A.g.length+1,E=[],D=0;D<b;D++)E[D]=A.i(D)<<1|A.i(D-1)>>>31;return new o(E,A.h)}function Z(A,b){var E=b>>5;b%=32;for(var D=A.g.length-E,F=[],V=0;V<D;V++)F[V]=0<b?A.i(V+E)>>>b|A.i(V+E+1)<<32-b:A.i(V+E);return new o(F,A.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,aI=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,na=o}).apply(typeof e_<"u"?e_:typeof self<"u"?self:typeof window<"u"?window:{});var Ad=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var lI,Su,uI,Hd,cm,cI,dI,hI;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,y){return u==Array.prototype||u==Object.prototype||(u[p]=y.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ad=="object"&&Ad];for(var p=0;p<u.length;++p){var y=u[p];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var y=r;u=u.split(".");for(var T=0;T<u.length-1;T++){var j=u[T];if(!(j in y))break e;y=y[j]}u=u[u.length-1],T=y[u],p=p(T),p!=T&&p!=null&&e(y,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var y=0,T=!1,j={next:function(){if(!T&&y<u.length){var J=y++;return{value:p(J,u[J]),done:!1}}return T=!0,{done:!0,value:void 0}}};return j[Symbol.iterator]=function(){return j},j}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,y){return y})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function c(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function d(u,p,y){return u.call.apply(u.bind,arguments)}function f(u,p,y){if(!u)throw Error();if(2<arguments.length){var T=Array.prototype.slice.call(arguments,2);return function(){var j=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(j,T),u.apply(p,j)}}return function(){return u.apply(p,arguments)}}function g(u,p,y){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,g.apply(null,arguments)}function v(u,p){var y=Array.prototype.slice.call(arguments,1);return function(){var T=y.slice();return T.push.apply(T,arguments),u.apply(this,T)}}function x(u,p){function y(){}y.prototype=p.prototype,u.aa=p.prototype,u.prototype=new y,u.prototype.constructor=u,u.Qb=function(T,j,J){for(var Ee=Array(arguments.length-2),Ut=2;Ut<arguments.length;Ut++)Ee[Ut-2]=arguments[Ut];return p.prototype[j].apply(T,Ee)}}function w(u){const p=u.length;if(0<p){const y=Array(p);for(let T=0;T<p;T++)y[T]=u[T];return y}return[]}function I(u,p){for(let y=1;y<arguments.length;y++){const T=arguments[y];if(l(T)){const j=u.length||0,J=T.length||0;u.length=j+J;for(let Ee=0;Ee<J;Ee++)u[j+Ee]=T[Ee]}else u.push(T)}}class L{constructor(p,y){this.i=p,this.j=y,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function $(u){return/^[\s\xa0]*$/.test(u)}function U(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function z(u){return z[" "](u),u}z[" "]=function(){};var le=U().indexOf("Gecko")!=-1&&!(U().toLowerCase().indexOf("webkit")!=-1&&U().indexOf("Edge")==-1)&&!(U().indexOf("Trident")!=-1||U().indexOf("MSIE")!=-1)&&U().indexOf("Edge")==-1;function Z(u,p,y){for(const T in u)p.call(y,u[T],T,u)}function A(u,p){for(const y in u)p.call(void 0,u[y],y,u)}function b(u){const p={};for(const y in u)p[y]=u[y];return p}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function D(u,p){let y,T;for(let j=1;j<arguments.length;j++){T=arguments[j];for(y in T)u[y]=T[y];for(let J=0;J<E.length;J++)y=E[J],Object.prototype.hasOwnProperty.call(T,y)&&(u[y]=T[y])}}function F(u){var p=1;u=u.split(":");const y=[];for(;0<p&&u.length;)y.push(u.shift()),p--;return u.length&&y.push(u.join(":")),y}function V(u){a.setTimeout(()=>{throw u},0)}function C(){var u=me;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class Fe{constructor(){this.h=this.g=null}add(p,y){const T=vt.get();T.set(p,y),this.h?this.h.next=T:this.g=T,this.h=T}}var vt=new L(()=>new It,u=>u.reset());class It{constructor(){this.next=this.g=this.h=null}set(p,y){this.h=p,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let We,Se=!1,me=new Fe,Be=()=>{const u=a.Promise.resolve(void 0);We=()=>{u.then(ae)}};var ae=()=>{for(var u;u=C();){try{u.h.call(u.g)}catch(y){V(y)}var p=vt;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}Se=!1};function re(){this.s=this.s,this.C=this.C}re.prototype.s=!1,re.prototype.ma=function(){this.s||(this.s=!0,this.N())},re.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Oe(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}Oe.prototype.h=function(){this.defaultPrevented=!0};var St=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const y=()=>{};a.addEventListener("test",y,p),a.removeEventListener("test",y,p)}catch{}return u}();function Ot(u,p){if(Oe.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var y=this.type=u.type,T=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(le){e:{try{z(p.nodeName);var j=!0;break e}catch{}j=!1}j||(p=null)}}else y=="mouseover"?p=u.fromElement:y=="mouseout"&&(p=u.toElement);this.relatedTarget=p,T?(this.clientX=T.clientX!==void 0?T.clientX:T.pageX,this.clientY=T.clientY!==void 0?T.clientY:T.pageY,this.screenX=T.screenX||0,this.screenY=T.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:kt[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&Ot.aa.h.call(this)}}x(Ot,Oe);var kt={2:"touch",3:"pen",4:"mouse"};Ot.prototype.h=function(){Ot.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var Q="closure_listenable_"+(1e6*Math.random()|0),we=0;function ye(u,p,y,T,j){this.listener=u,this.proxy=null,this.src=p,this.type=y,this.capture=!!T,this.ha=j,this.key=++we,this.da=this.fa=!1}function ke(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function rt(u){this.src=u,this.g={},this.h=0}rt.prototype.add=function(u,p,y,T,j){var J=u.toString();u=this.g[J],u||(u=this.g[J]=[],this.h++);var Ee=P(u,p,T,j);return-1<Ee?(p=u[Ee],y||(p.fa=!1)):(p=new ye(p,this.src,J,!!T,j),p.fa=y,u.push(p)),p};function yt(u,p){var y=p.type;if(y in u.g){var T=u.g[y],j=Array.prototype.indexOf.call(T,p,void 0),J;(J=0<=j)&&Array.prototype.splice.call(T,j,1),J&&(ke(p),u.g[y].length==0&&(delete u.g[y],u.h--))}}function P(u,p,y,T){for(var j=0;j<u.length;++j){var J=u[j];if(!J.da&&J.listener==p&&J.capture==!!y&&J.ha==T)return j}return-1}var M="closure_lm_"+(1e6*Math.random()|0),G={};function ue(u,p,y,T,j){if(T&&T.once)return Ie(u,p,y,T,j);if(Array.isArray(p)){for(var J=0;J<p.length;J++)ue(u,p[J],y,T,j);return null}return y=qe(y),u&&u[Q]?u.K(p,y,c(T)?!!T.capture:!!T,j):ne(u,p,y,!1,T,j)}function ne(u,p,y,T,j,J){if(!p)throw Error("Invalid event type");var Ee=c(j)?!!j.capture:!!j,Ut=ve(u);if(Ut||(u[M]=Ut=new rt(u)),y=Ut.add(p,y,T,Ee,J),y.proxy)return y;if(T=de(),y.proxy=T,T.src=u,T.listener=y,u.addEventListener)St||(j=Ee),j===void 0&&(j=!1),u.addEventListener(p.toString(),T,j);else if(u.attachEvent)u.attachEvent(he(p.toString()),T);else if(u.addListener&&u.removeListener)u.addListener(T);else throw Error("addEventListener and attachEvent are unavailable.");return y}function de(){function u(y){return p.call(u.src,u.listener,y)}const p=Re;return u}function Ie(u,p,y,T,j){if(Array.isArray(p)){for(var J=0;J<p.length;J++)Ie(u,p[J],y,T,j);return null}return y=qe(y),u&&u[Q]?u.L(p,y,c(T)?!!T.capture:!!T,j):ne(u,p,y,!0,T,j)}function Y(u,p,y,T,j){if(Array.isArray(p))for(var J=0;J<p.length;J++)Y(u,p[J],y,T,j);else T=c(T)?!!T.capture:!!T,y=qe(y),u&&u[Q]?(u=u.i,p=String(p).toString(),p in u.g&&(J=u.g[p],y=P(J,y,T,j),-1<y&&(ke(J[y]),Array.prototype.splice.call(J,y,1),J.length==0&&(delete u.g[p],u.h--)))):u&&(u=ve(u))&&(p=u.g[p.toString()],u=-1,p&&(u=P(p,y,T,j)),(y=-1<u?p[u]:null)&&ge(y))}function ge(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[Q])yt(p.i,u);else{var y=u.type,T=u.proxy;p.removeEventListener?p.removeEventListener(y,T,u.capture):p.detachEvent?p.detachEvent(he(y),T):p.addListener&&p.removeListener&&p.removeListener(T),(y=ve(p))?(yt(y,u),y.h==0&&(y.src=null,p[M]=null)):ke(u)}}}function he(u){return u in G?G[u]:G[u]="on"+u}function Re(u,p){if(u.da)u=!0;else{p=new Ot(p,this);var y=u.listener,T=u.ha||u.src;u.fa&&ge(u),u=y.call(T,p)}return u}function ve(u){return u=u[M],u instanceof rt?u:null}var De="__closure_events_fn_"+(1e9*Math.random()>>>0);function qe(u){return typeof u=="function"?u:(u[De]||(u[De]=function(p){return u.handleEvent(p)}),u[De])}function Ue(){re.call(this),this.i=new rt(this),this.M=this,this.F=null}x(Ue,re),Ue.prototype[Q]=!0,Ue.prototype.removeEventListener=function(u,p,y,T){Y(this,u,p,y,T)};function Ye(u,p){var y,T=u.F;if(T)for(y=[];T;T=T.F)y.push(T);if(u=u.M,T=p.type||p,typeof p=="string")p=new Oe(p,u);else if(p instanceof Oe)p.target=p.target||u;else{var j=p;p=new Oe(T,u),D(p,j)}if(j=!0,y)for(var J=y.length-1;0<=J;J--){var Ee=p.g=y[J];j=ct(Ee,T,!0,p)&&j}if(Ee=p.g=u,j=ct(Ee,T,!0,p)&&j,j=ct(Ee,T,!1,p)&&j,y)for(J=0;J<y.length;J++)Ee=p.g=y[J],j=ct(Ee,T,!1,p)&&j}Ue.prototype.N=function(){if(Ue.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var y=u.g[p],T=0;T<y.length;T++)ke(y[T]);delete u.g[p],u.h--}}this.F=null},Ue.prototype.K=function(u,p,y,T){return this.i.add(String(u),p,!1,y,T)},Ue.prototype.L=function(u,p,y,T){return this.i.add(String(u),p,!0,y,T)};function ct(u,p,y,T){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var j=!0,J=0;J<p.length;++J){var Ee=p[J];if(Ee&&!Ee.da&&Ee.capture==y){var Ut=Ee.listener,Vn=Ee.ha||Ee.src;Ee.fa&&yt(u.i,Ee),j=Ut.call(Vn,T)!==!1&&j}}return j&&!T.defaultPrevented}function en(u,p,y){if(typeof u=="function")y&&(u=g(u,y));else if(u&&typeof u.handleEvent=="function")u=g(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(u,p||0)}function Jt(u){u.g=en(()=>{u.g=null,u.i&&(u.i=!1,Jt(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class wn extends re{constructor(p,y){super(),this.m=p,this.l=y,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Jt(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function qt(u){re.call(this),this.h=u,this.g={}}x(qt,re);var mr=[];function kr(u){Z(u.g,function(p,y){this.g.hasOwnProperty(y)&&ge(p)},u),u.g={}}qt.prototype.N=function(){qt.aa.N.call(this),kr(this)},qt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ln=a.JSON.stringify,Nn=a.JSON.parse,bi=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function oe(){}oe.prototype.h=null;function B(u){return u.h||(u.h=u.i())}function be(){}var ze={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Qe(){Oe.call(this,"d")}x(Qe,Oe);function at(){Oe.call(this,"c")}x(at,Oe);var ht={},Et=null;function $n(){return Et=Et||new Ue}ht.La="serverreachability";function Pt(u){Oe.call(this,ht.La,u)}x(Pt,Oe);function Ir(u){const p=$n();Ye(p,new Pt(p))}ht.STAT_EVENT="statevent";function Ze(u,p){Oe.call(this,ht.STAT_EVENT,u),this.stat=p}x(Ze,Oe);function lt(u){const p=$n();Ye(p,new Ze(p,u))}ht.Ma="timingevent";function Gn(u,p){Oe.call(this,ht.Ma,u),this.size=p}x(Gn,Oe);function nr(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function On(){this.g=!0}On.prototype.xa=function(){this.g=!1};function wi(u,p,y,T,j,J){u.info(function(){if(u.g)if(J)for(var Ee="",Ut=J.split("&"),Vn=0;Vn<Ut.length;Vn++){var Tt=Ut[Vn].split("=");if(1<Tt.length){var jn=Tt[0];Tt=Tt[1];var pn=jn.split("_");Ee=2<=pn.length&&pn[1]=="type"?Ee+(jn+"="+Tt+"&"):Ee+(jn+"=redacted&")}}else Ee=null;else Ee=J;return"XMLHTTP REQ ("+T+") [attempt "+j+"]: "+p+`
`+y+`
`+Ee})}function Ds(u,p,y,T,j,J,Ee){u.info(function(){return"XMLHTTP RESP ("+T+") [ attempt "+j+"]: "+p+`
`+y+`
`+J+" "+Ee})}function hs(u,p,y,T){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+tu(u,y)+(T?" "+T:"")})}function Ns(u,p){u.info(function(){return"TIMEOUT: "+p})}On.prototype.info=function(){};function tu(u,p){if(!u.g)return p;if(!p)return null;try{var y=JSON.parse(p);if(y){for(u=0;u<y.length;u++)if(Array.isArray(y[u])){var T=y[u];if(!(2>T.length)){var j=T[1];if(Array.isArray(j)&&!(1>j.length)){var J=j[0];if(J!="noop"&&J!="stop"&&J!="close")for(var Ee=1;Ee<j.length;Ee++)j[Ee]=""}}}}return ln(y)}catch{return p}}var fs={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ka={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Eo;function To(){}x(To,oe),To.prototype.g=function(){return new XMLHttpRequest},To.prototype.i=function(){return{}},Eo=new To;function ps(u,p,y,T){this.j=u,this.i=p,this.l=y,this.R=T||1,this.U=new qt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Da}function Da(){this.i=null,this.g="",this.h=!1}var nd={},nu={};function ru(u,p,y){u.L=1,u.v=Ms(Rn(p)),u.m=y,u.P=!0,rd(u,null)}function rd(u,p){u.F=Date.now(),Ao(u),u.A=Rn(u.v);var y=u.A,T=u.R;Array.isArray(T)||(T=[String(T)]),pt(y.i,"t",T),u.C=0,y=u.j.J,u.h=new Da,u.g=uu(u.j,y?p:null,!u.m),0<u.O&&(u.M=new wn(g(u.Y,u,u.g),u.O)),p=u.U,y=u.g,T=u.ca;var j="readystatechange";Array.isArray(j)||(j&&(mr[0]=j.toString()),j=mr);for(var J=0;J<j.length;J++){var Ee=ue(y,j[J],T||p.handleEvent,!1,p.h||p);if(!Ee)break;p.g[Ee.key]=Ee}p=u.H?b(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),Ir(),wi(u.i,u.u,u.A,u.l,u.R,u.m)}ps.prototype.ca=function(u){u=u.target;const p=this.M;p&&dt(u)==3?p.j():this.Y(u)},ps.prototype.Y=function(u){try{if(u==this.g)e:{const pn=dt(this.g);var p=this.g.Ba();const ki=this.g.Z();if(!(3>pn)&&(pn!=3||this.g&&(this.h.h||this.g.oa()||hd(this.g)))){this.J||pn!=4||p==7||(p==8||0>=ki?Ir(3):Ir(2)),Na(this);var y=this.g.Z();this.X=y;t:if(su(this)){var T=hd(this.g);u="";var j=T.length,J=dt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){rr(this),So(this);var Ee="";break t}this.h.i=new a.TextDecoder}for(p=0;p<j;p++)this.h.h=!0,u+=this.h.i.decode(T[p],{stream:!(J&&p==j-1)});T.length=0,this.h.g+=u,this.C=0,Ee=this.h.g}else Ee=this.g.oa();if(this.o=y==200,Ds(this.i,this.u,this.A,this.l,this.R,pn,y),this.o){if(this.T&&!this.K){t:{if(this.g){var Ut,Vn=this.g;if((Ut=Vn.g?Vn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(Ut)){var Tt=Ut;break t}}Tt=null}if(y=Tt)hs(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,es(this,y);else{this.o=!1,this.s=3,lt(12),rr(this),So(this);break e}}if(this.P){y=!0;let Or;for(;!this.J&&this.C<Ee.length;)if(Or=qf(this,Ee),Or==nu){pn==4&&(this.s=4,lt(14),y=!1),hs(this.i,this.l,null,"[Incomplete Response]");break}else if(Or==nd){this.s=4,lt(15),hs(this.i,this.l,Ee,"[Invalid Chunk]"),y=!1;break}else hs(this.i,this.l,Or,null),es(this,Or);if(su(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),pn!=4||Ee.length!=0||this.h.h||(this.s=1,lt(16),y=!1),this.o=this.o&&y,!y)hs(this.i,this.l,Ee,"[Invalid Chunked Response]"),rr(this),So(this);else if(0<Ee.length&&!this.W){this.W=!0;var jn=this.j;jn.g==this&&jn.ba&&!jn.M&&(jn.j.info("Great, no buffering proxy detected. Bytes received: "+Ee.length),Pi(jn),jn.M=!0,lt(11))}}else hs(this.i,this.l,Ee,null),es(this,Ee);pn==4&&rr(this),this.o&&!this.J&&(pn==4?md(this.j,this):(this.o=!1,Ao(this)))}else lu(this.g),y==400&&0<Ee.indexOf("Unknown SID")?(this.s=3,lt(12)):(this.s=0,lt(13)),rr(this),So(this)}}}catch{}finally{}};function su(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function qf(u,p){var y=u.C,T=p.indexOf(`
`,y);return T==-1?nu:(y=Number(p.substring(y,T)),isNaN(y)?nd:(T+=1,T+y>p.length?nu:(p=p.slice(T,T+y),u.C=T+y,p)))}ps.prototype.cancel=function(){this.J=!0,rr(this)};function Ao(u){u.S=Date.now()+u.I,sd(u,u.I)}function sd(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=nr(g(u.ba,u),p)}function Na(u){u.B&&(a.clearTimeout(u.B),u.B=null)}ps.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(Ns(this.i,this.A),this.L!=2&&(Ir(),lt(17)),rr(this),this.s=2,So(this)):sd(this,this.S-u)};function So(u){u.j.G==0||u.J||md(u.j,u)}function rr(u){Na(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,kr(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function es(u,p){try{var y=u.j;if(y.G!=0&&(y.g==u||xi(y.h,u))){if(!u.K&&xi(y.h,u)&&y.G==3){try{var T=y.Da.g.parse(p)}catch{T=null}if(Array.isArray(T)&&T.length==3){var j=T;if(j[0]==0){e:if(!y.u){if(y.g)if(y.g.F+3e3<u.F)Wn(y),$a(y);else break e;Ua(y),lt(18)}}else y.za=j[1],0<y.za-y.T&&37500>j[2]&&y.F&&y.v==0&&!y.C&&(y.C=nr(g(y.Za,y),6e3));if(1>=iu(y.h)&&y.ca){try{y.ca()}catch{}y.ca=void 0}}else _s(y,11)}else if((u.K||y.g==u)&&Wn(y),!$(p))for(j=y.Da.g.parse(p),p=0;p<j.length;p++){let Tt=j[p];if(y.T=Tt[0],Tt=Tt[1],y.G==2)if(Tt[0]=="c"){y.K=Tt[1],y.ia=Tt[2];const jn=Tt[3];jn!=null&&(y.la=jn,y.j.info("VER="+y.la));const pn=Tt[4];pn!=null&&(y.Aa=pn,y.j.info("SVER="+y.Aa));const ki=Tt[5];ki!=null&&typeof ki=="number"&&0<ki&&(T=1.5*ki,y.L=T,y.j.info("backChannelRequestTimeoutMs_="+T)),T=y;const Or=u.g;if(Or){const qa=Or.g?Or.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(qa){var J=T.h;J.g||qa.indexOf("spdy")==-1&&qa.indexOf("quic")==-1&&qa.indexOf("h2")==-1||(J.j=J.l,J.g=new Set,J.h&&(Vs(J,J.h),J.h=null))}if(T.D){const za=Or.g?Or.g.getResponseHeader("X-HTTP-Session-Id"):null;za&&(T.ya=za,Dt(T.I,T.D,za))}}y.G=3,y.l&&y.l.ua(),y.ba&&(y.R=Date.now()-u.F,y.j.info("Handshake RTT: "+y.R+"ms")),T=y;var Ee=u;if(T.qa=vd(T,T.J?T.ia:null,T.W),Ee.K){id(T.h,Ee);var Ut=Ee,Vn=T.L;Vn&&(Ut.I=Vn),Ut.B&&(Na(Ut),Ao(Ut)),T.g=Ee}else pd(T);0<y.i.length&&sr(y)}else Tt[0]!="stop"&&Tt[0]!="close"||_s(y,7);else y.G==3&&(Tt[0]=="stop"||Tt[0]=="close"?Tt[0]=="stop"?_s(y,7):ns(y):Tt[0]!="noop"&&y.l&&y.l.ta(Tt),y.v=0)}}Ir(4)}catch{}}var ms=class{constructor(u,p){this.g=u,this.map=p}};function Os(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ts(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function iu(u){return u.h?1:u.g?u.g.size:0}function xi(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function Vs(u,p){u.g?u.g.add(p):u.h=p}function id(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}Os.prototype.cancel=function(){if(this.i=Dr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function Dr(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const y of u.g.values())p=p.concat(y.D);return p}return w(u.i)}function od(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],y=u.length,T=0;T<y;T++)p.push(u[T]);return p}p=[],y=0;for(T in u)p[y++]=u[T];return p}function ad(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var y=0;y<u;y++)p.push(y);return p}p=[],y=0;for(const T in u)p[y++]=T;return p}}}function Oa(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var y=ad(u),T=od(u),j=T.length,J=0;J<j;J++)p.call(void 0,T[J],y&&y[J],u)}var ld=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function gr(u,p){if(u){u=u.split("&");for(var y=0;y<u.length;y++){var T=u[y].indexOf("="),j=null;if(0<=T){var J=u[y].substring(0,T);j=u[y].substring(T+1)}else J=u[y];p(J,j?decodeURIComponent(j.replace(/\+/g," ")):"")}}}function Br(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof Br){this.h=u.h,Po(this,u.j),this.o=u.o,this.g=u.g,Ro(this,u.s),this.l=u.l;var p=u.i,y=new gs;y.i=p.i,p.g&&(y.g=new Map(p.g),y.h=p.h),Ii(this,y),this.m=u.m}else u&&(p=String(u).match(ld))?(this.h=!1,Po(this,p[1]||"",!0),this.o=qr(p[2]||""),this.g=qr(p[3]||"",!0),Ro(this,p[4]),this.l=qr(p[5]||"",!0),Ii(this,p[6]||"",!0),this.m=qr(p[7]||"")):(this.h=!1,this.i=new gs(null,this.h))}Br.prototype.toString=function(){var u=[],p=this.j;p&&u.push(Ei(p,zr,!0),":");var y=this.g;return(y||p=="file")&&(u.push("//"),(p=this.o)&&u.push(Ei(p,zr,!0),"@"),u.push(encodeURIComponent(String(y)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.s,y!=null&&u.push(":",String(y))),(y=this.l)&&(this.g&&y.charAt(0)!="/"&&u.push("/"),u.push(Ei(y,y.charAt(0)=="/"?Hf:zf,!0))),(y=this.i.toString())&&u.push("?",y),(y=this.m)&&u.push("#",Ei(y,ud)),u.join("")};function Rn(u){return new Br(u)}function Po(u,p,y){u.j=y?qr(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function Ro(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function Ii(u,p,y){p instanceof gs?(u.i=p,Ti(u.i,u.h)):(y||(p=Ei(p,Kf)),u.i=new gs(p,u.h))}function Dt(u,p,y){u.i.set(p,y)}function Ms(u){return Dt(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function qr(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Ei(u,p,y){return typeof u=="string"?(u=encodeURI(u).replace(p,Va),y&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Va(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var zr=/[#\/\?@]/g,zf=/[#\?:]/g,Hf=/[#\?]/g,Kf=/[#\?@]/g,ud=/#/g;function gs(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Nr(u){u.g||(u.g=new Map,u.h=0,u.i&&gr(u.i,function(p,y){u.add(decodeURIComponent(p.replace(/\+/g," ")),y)}))}n=gs.prototype,n.add=function(u,p){Nr(this),this.i=null,u=Fn(this,u);var y=this.g.get(u);return y||this.g.set(u,y=[]),y.push(p),this.h+=1,this};function Ma(u,p){Nr(u),p=Fn(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function Me(u,p){return Nr(u),p=Fn(u,p),u.g.has(p)}n.forEach=function(u,p){Nr(this),this.g.forEach(function(y,T){y.forEach(function(j){u.call(p,j,T,this)},this)},this)},n.na=function(){Nr(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),y=[];for(let T=0;T<p.length;T++){const j=u[T];for(let J=0;J<j.length;J++)y.push(p[T])}return y},n.V=function(u){Nr(this);let p=[];if(typeof u=="string")Me(this,u)&&(p=p.concat(this.g.get(Fn(this,u))));else{u=Array.from(this.g.values());for(let y=0;y<u.length;y++)p=p.concat(u[y])}return p},n.set=function(u,p){return Nr(this),this.i=null,u=Fn(this,u),Me(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function pt(u,p,y){Ma(u,p),0<y.length&&(u.i=null,u.g.set(Fn(u,p),w(y)),u.h+=y.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var y=0;y<p.length;y++){var T=p[y];const J=encodeURIComponent(String(T)),Ee=this.V(T);for(T=0;T<Ee.length;T++){var j=J;Ee[T]!==""&&(j+="="+encodeURIComponent(String(Ee[T]))),u.push(j)}}return this.i=u.join("&")};function Fn(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function Ti(u,p){p&&!u.j&&(Nr(u),u.i=null,u.g.forEach(function(y,T){var j=T.toLowerCase();T!=j&&(Ma(this,T),pt(this,j,y))},u)),u.j=p}function Gf(u,p){const y=new On;if(a.Image){const T=new Image;T.onload=v(vs,y,"TestLoadImage: loaded",!0,p,T),T.onerror=v(vs,y,"TestLoadImage: error",!1,p,T),T.onabort=v(vs,y,"TestLoadImage: abort",!1,p,T),T.ontimeout=v(vs,y,"TestLoadImage: timeout",!1,p,T),a.setTimeout(function(){T.ontimeout&&T.ontimeout()},1e4),T.src=u}else p(!1)}function cd(u,p){const y=new On,T=new AbortController,j=setTimeout(()=>{T.abort(),vs(y,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:T.signal}).then(J=>{clearTimeout(j),J.ok?vs(y,"TestPingServer: ok",!0,p):vs(y,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(j),vs(y,"TestPingServer: error",!1,p)})}function vs(u,p,y,T,j){try{j&&(j.onload=null,j.onerror=null,j.onabort=null,j.ontimeout=null),T(y)}catch{}}function Wf(){this.g=new bi}function ou(u,p,y){const T=y||"";try{Oa(u,function(j,J){let Ee=j;c(j)&&(Ee=ln(j)),p.push(T+J+"="+encodeURIComponent(Ee))})}catch(j){throw p.push(T+"type="+encodeURIComponent("_badmap")),j}}function La(u){this.l=u.Ub||null,this.j=u.eb||!1}x(La,oe),La.prototype.g=function(){return new ys(this.l,this.j)},La.prototype.i=function(u){return function(){return u}}({});function ys(u,p){Ue.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(ys,Ue),n=ys.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,Kr(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Hr(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Kr(this)),this.g&&(this.readyState=3,Kr(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Co(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function Co(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?Hr(this):Kr(this),this.readyState==3&&Co(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,Hr(this))},n.Qa=function(u){this.g&&(this.response=u,Hr(this))},n.ga=function(){this.g&&Hr(this)};function Hr(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Kr(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var y=p.next();!y.done;)y=y.value,u.push(y[0]+": "+y[1]),y=p.next();return u.join(`\r
`)};function Kr(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(ys.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function Ai(u){let p="";return Z(u,function(y,T){p+=T,p+=":",p+=y,p+=`\r
`}),p}function Ls(u,p,y){e:{for(T in y){var T=!1;break e}T=!0}T||(y=Ai(y),typeof u=="string"?y!=null&&encodeURIComponent(String(y)):Dt(u,p,y))}function Kt(u){Ue.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(Kt,Ue);var Qf=/^https?$/i,Jf=["POST","PUT"];n=Kt.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,y,T){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Eo.g(),this.v=this.o?B(this.o):B(Eo),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(J){dd(this,J);return}if(u=y||"",y=new Map(this.headers),T)if(Object.getPrototypeOf(T)===Object.prototype)for(var j in T)y.set(j,T[j]);else if(typeof T.keys=="function"&&typeof T.get=="function")for(const J of T.keys())y.set(J,T.get(J));else throw Error("Unknown input type for opt_headers: "+String(T));T=Array.from(y.keys()).find(J=>J.toLowerCase()=="content-type"),j=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(Jf,p,void 0))||T||j||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[J,Ee]of y)this.g.setRequestHeader(J,Ee);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{un(this),this.u=!0,this.g.send(u),this.u=!1}catch(J){dd(this,J)}};function dd(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,au(u),st(u)}function au(u){u.A||(u.A=!0,Ye(u,"complete"),Ye(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,Ye(this,"complete"),Ye(this,"abort"),st(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),st(this,!0)),Kt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Je(this):this.bb())},n.bb=function(){Je(this)};function Je(u){if(u.h&&typeof o<"u"&&(!u.v[1]||dt(u)!=4||u.Z()!=2)){if(u.u&&dt(u)==4)en(u.Ea,0,u);else if(Ye(u,"readystatechange"),dt(u)==4){u.h=!1;try{const Ee=u.Z();e:switch(Ee){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var y;if(!(y=p)){var T;if(T=Ee===0){var j=String(u.D).match(ld)[1]||null;!j&&a.self&&a.self.location&&(j=a.self.location.protocol.slice(0,-1)),T=!Qf.test(j?j.toLowerCase():"")}y=T}if(y)Ye(u,"complete"),Ye(u,"success");else{u.m=6;try{var J=2<dt(u)?u.g.statusText:""}catch{J=""}u.l=J+" ["+u.Z()+"]",au(u)}}finally{st(u)}}}}function st(u,p){if(u.g){un(u);const y=u.g,T=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||Ye(u,"ready");try{y.onreadystatechange=T}catch{}}}function un(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function dt(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<dt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),Nn(p)}};function hd(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function lu(u){const p={};u=(u.g&&2<=dt(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let T=0;T<u.length;T++){if($(u[T]))continue;var y=F(u[T]);const j=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const J=p[j]||[];p[j]=J,J.push(y)}A(p,function(T){return T.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Si(u,p,y){return y&&y.internalChannelParams&&y.internalChannelParams[u]||p}function $s(u){this.Aa=0,this.i=[],this.j=new On,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Si("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Si("baseRetryDelayMs",5e3,u),this.cb=Si("retryDelaySeedMs",1e4,u),this.Wa=Si("forwardChannelMaxRetries",2,u),this.wa=Si("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new Os(u&&u.concurrentRequestLimit),this.Da=new Wf,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=$s.prototype,n.la=8,n.G=1,n.connect=function(u,p,y,T){lt(0),this.W=u,this.H=p||{},y&&T!==void 0&&(this.H.OSID=y,this.H.OAID=T),this.F=this.X,this.I=vd(this,null,this.W),sr(this)};function ns(u){if(Fs(u),u.G==3){var p=u.U++,y=Rn(u.I);if(Dt(y,"SID",u.K),Dt(y,"RID",p),Dt(y,"TYPE","terminate"),ko(u,y),p=new ps(u,u.j,p),p.L=2,p.v=Ms(Rn(y)),y=!1,a.navigator&&a.navigator.sendBeacon)try{y=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!y&&a.Image&&(new Image().src=p.v,y=!0),y||(p.g=uu(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Ao(p)}Ba(u)}function $a(u){u.g&&(Pi(u),u.g.cancel(),u.g=null)}function Fs(u){$a(u),u.u&&(a.clearTimeout(u.u),u.u=null),Wn(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function sr(u){if(!ts(u.h)&&!u.s){u.s=!0;var p=u.Ga;We||Be(),Se||(We(),Se=!0),me.add(p,u),u.B=0}}function Yf(u,p){return iu(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=nr(g(u.Ga,u,p),gd(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const j=new ps(this,this.j,u);let J=this.o;if(this.S&&(J?(J=b(J),D(J,this.S)):J=this.S),this.m!==null||this.O||(j.H=J,J=null),this.P)e:{for(var p=0,y=0;y<this.i.length;y++){t:{var T=this.i[y];if("__data__"in T.map&&(T=T.map.__data__,typeof T=="string")){T=T.length;break t}T=void 0}if(T===void 0)break;if(p+=T,4096<p){p=y;break e}if(p===4096||y===this.i.length-1){p=y+1;break e}}p=1e3}else p=1e3;p=fd(this,j,p),y=Rn(this.I),Dt(y,"RID",u),Dt(y,"CVER",22),this.D&&Dt(y,"X-HTTP-Session-Id",this.D),ko(this,y),J&&(this.O?p="headers="+encodeURIComponent(String(Ai(J)))+"&"+p:this.m&&Ls(y,this.m,J)),Vs(this.h,j),this.Ua&&Dt(y,"TYPE","init"),this.P?(Dt(y,"$req",p),Dt(y,"SID","null"),j.T=!0,ru(j,y,null)):ru(j,y,p),this.G=2}}else this.G==3&&(u?Fa(this,u):this.i.length==0||ts(this.h)||Fa(this))};function Fa(u,p){var y;p?y=p.l:y=u.U++;const T=Rn(u.I);Dt(T,"SID",u.K),Dt(T,"RID",y),Dt(T,"AID",u.T),ko(u,T),u.m&&u.o&&Ls(T,u.m,u.o),y=new ps(u,u.j,y,u.B+1),u.m===null&&(y.H=u.o),p&&(u.i=p.D.concat(u.i)),p=fd(u,y,1e3),y.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),Vs(u.h,y),ru(y,T,p)}function ko(u,p){u.H&&Z(u.H,function(y,T){Dt(p,T,y)}),u.l&&Oa({},function(y,T){Dt(p,T,y)})}function fd(u,p,y){y=Math.min(u.i.length,y);var T=u.l?g(u.l.Na,u.l,u):null;e:{var j=u.i;let J=-1;for(;;){const Ee=["count="+y];J==-1?0<y?(J=j[0].g,Ee.push("ofs="+J)):J=0:Ee.push("ofs="+J);let Ut=!0;for(let Vn=0;Vn<y;Vn++){let Tt=j[Vn].g;const jn=j[Vn].map;if(Tt-=J,0>Tt)J=Math.max(0,j[Vn].g-100),Ut=!1;else try{ou(jn,Ee,"req"+Tt+"_")}catch{T&&T(jn)}}if(Ut){T=Ee.join("&");break e}}}return u=u.i.splice(0,y),p.D=u,T}function pd(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;We||Be(),Se||(We(),Se=!0),me.add(p,u),u.v=0}}function Ua(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=nr(g(u.Fa,u),gd(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,ja(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=nr(g(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,lt(10),$a(this),ja(this))};function Pi(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function ja(u){u.g=new ps(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=Rn(u.qa);Dt(p,"RID","rpc"),Dt(p,"SID",u.K),Dt(p,"AID",u.T),Dt(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&Dt(p,"TO",u.ja),Dt(p,"TYPE","xmlhttp"),ko(u,p),u.m&&u.o&&Ls(p,u.m,u.o),u.L&&(u.g.I=u.L);var y=u.g;u=u.ia,y.L=1,y.v=Ms(Rn(p)),y.m=null,y.P=!0,rd(y,u)}n.Za=function(){this.C!=null&&(this.C=null,$a(this),Ua(this),lt(19))};function Wn(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function md(u,p){var y=null;if(u.g==p){Wn(u),Pi(u),u.g=null;var T=2}else if(xi(u.h,p))y=p.D,id(u.h,p),T=1;else return;if(u.G!=0){if(p.o)if(T==1){y=p.m?p.m.length:0,p=Date.now()-p.F;var j=u.B;T=$n(),Ye(T,new Gn(T,y)),sr(u)}else pd(u);else if(j=p.s,j==3||j==0&&0<p.X||!(T==1&&Yf(u,p)||T==2&&Ua(u)))switch(y&&0<y.length&&(p=u.h,p.i=p.i.concat(y)),j){case 1:_s(u,5);break;case 4:_s(u,10);break;case 3:_s(u,6);break;default:_s(u,2)}}}function gd(u,p){let y=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(y*=2),y*p}function _s(u,p){if(u.j.info("Error code "+p),p==2){var y=g(u.fb,u),T=u.Xa;const j=!T;T=new Br(T||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Po(T,"https"),Ms(T),j?Gf(T.toString(),y):cd(T.toString(),y)}else lt(2);u.G=0,u.l&&u.l.sa(p),Ba(u),Fs(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),lt(2)):(this.j.info("Failed to ping google.com"),lt(1))};function Ba(u){if(u.G=0,u.ka=[],u.l){const p=Dr(u.h);(p.length!=0||u.i.length!=0)&&(I(u.ka,p),I(u.ka,u.i),u.h.i.length=0,w(u.i),u.i.length=0),u.l.ra()}}function vd(u,p,y){var T=y instanceof Br?Rn(y):new Br(y);if(T.g!="")p&&(T.g=p+"."+T.g),Ro(T,T.s);else{var j=a.location;T=j.protocol,p=p?p+"."+j.hostname:j.hostname,j=+j.port;var J=new Br(null);T&&Po(J,T),p&&(J.g=p),j&&Ro(J,j),y&&(J.l=y),T=J}return y=u.D,p=u.ya,y&&p&&Dt(T,y,p),Dt(T,"VER",u.la),ko(u,T),T}function uu(u,p,y){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new Kt(new La({eb:y})):new Kt(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Us(){}n=Us.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Ri(){}Ri.prototype.g=function(u,p){return new Un(u,p)};function Un(u,p){Ue.call(this),this.g=new $s(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!$(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!$(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new Ci(this)}x(Un,Ue),Un.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Un.prototype.close=function(){ns(this.g)},Un.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var y={};y.__data__=u,u=y}else this.u&&(y={},y.__data__=ln(u),u=y);p.i.push(new ms(p.Ya++,u)),p.G==3&&sr(p)},Un.prototype.N=function(){this.g.l=null,delete this.j,ns(this.g),delete this.g,Un.aa.N.call(this)};function Do(u){Qe.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const y in p){u=y;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}x(Do,Qe);function cu(){at.call(this),this.status=1}x(cu,at);function Ci(u){this.g=u}x(Ci,Us),Ci.prototype.ua=function(){Ye(this.g,"a")},Ci.prototype.ta=function(u){Ye(this.g,new Do(u))},Ci.prototype.sa=function(u){Ye(this.g,new cu)},Ci.prototype.ra=function(){Ye(this.g,"b")},Ri.prototype.createWebChannel=Ri.prototype.g,Un.prototype.send=Un.prototype.o,Un.prototype.open=Un.prototype.m,Un.prototype.close=Un.prototype.close,hI=function(){return new Ri},dI=function(){return $n()},cI=ht,cm={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},fs.NO_ERROR=0,fs.TIMEOUT=8,fs.HTTP_ERROR=6,Hd=fs,ka.COMPLETE="complete",uI=ka,be.EventType=ze,ze.OPEN="a",ze.CLOSE="b",ze.ERROR="c",ze.MESSAGE="d",Ue.prototype.listen=Ue.prototype.K,Su=be,Kt.prototype.listenOnce=Kt.prototype.L,Kt.prototype.getLastError=Kt.prototype.Ka,Kt.prototype.getLastErrorCode=Kt.prototype.Ba,Kt.prototype.getStatus=Kt.prototype.Z,Kt.prototype.getResponseJson=Kt.prototype.Oa,Kt.prototype.getResponseText=Kt.prototype.oa,Kt.prototype.send=Kt.prototype.ea,Kt.prototype.setWithCredentials=Kt.prototype.Ha,lI=Kt}).apply(typeof Ad<"u"?Ad:typeof self<"u"?self:typeof window<"u"?window:{});const t_="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}qn.UNAUTHENTICATED=new qn(null),qn.GOOGLE_CREDENTIALS=new qn("google-credentials-uid"),qn.FIRST_PARTY=new qn("first-party-uid"),qn.MOCK_USER=new qn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bl="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ao=new fg("@firebase/firestore");function el(){return ao.logLevel}function UK(n){ao.setLogLevel(n)}function fe(n,...e){if(ao.logLevel<=_t.DEBUG){const t=e.map(Ig);ao.debug(`Firestore (${Bl}): ${n}`,...t)}}function En(n,...e){if(ao.logLevel<=_t.ERROR){const t=e.map(Ig);ao.error(`Firestore (${Bl}): ${n}`,...t)}}function Xr(n,...e){if(ao.logLevel<=_t.WARN){const t=e.map(Ig);ao.warn(`Firestore (${Bl}): ${n}`,...t)}}function Ig(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ce(n="Unexpected state"){const e=`FIRESTORE (${Bl}) INTERNAL ASSERTION FAILED: `+n;throw En(e),new Error(e)}function Ve(n,e){n||Ce()}function jK(n,e){n||Ce()}function Te(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class pe extends ds{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fI{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class SD{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(qn.UNAUTHENTICATED))}shutdown(){}}class PD{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class RD{constructor(e){this.t=e,this.currentUser=qn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Ve(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new Hn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Hn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{fe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(fe("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Hn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(fe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ve(typeof r.accessToken=="string"),new fI(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ve(e===null||typeof e=="string"),new qn(e)}}class CD{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=qn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class kD{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new CD(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(qn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class pI{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class DD{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Ve(this.o===void 0);const r=i=>{i.error!=null&&fe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,fe("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{fe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):fe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Ve(typeof t.token=="string"),this.R=t.token,new pI(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class BK{getToken(){return Promise.resolve(new pI(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ND(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mI{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=ND(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Xe(n,e){return n<e?-1:n>e?1:0}function xl(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function gI(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new pe(W.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new pe(W.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new pe(W.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new pe(W.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return hn.fromMillis(Date.now())}static fromDate(e){return hn.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new hn(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Xe(this.nanoseconds,e.nanoseconds):Xe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $e{constructor(e){this.timestamp=e}static fromTimestamp(e){return new $e(e)}static min(){return new $e(new hn(0,0))}static max(){return new $e(new hn(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dc{constructor(e,t,r){t===void 0?t=0:t>e.length&&Ce(),r===void 0?r=e.length-t:r>e.length-t&&Ce(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return dc.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof dc?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class wt extends dc{construct(e,t,r){return new wt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new pe(W.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new wt(t)}static emptyPath(){return new wt([])}}const OD=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class on extends dc{construct(e,t,r){return new on(e,t,r)}static isValidIdentifier(e){return OD.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),on.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new on(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new pe(W.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new pe(W.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new pe(W.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new pe(W.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new on(t)}static emptyPath(){return new on([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ae{constructor(e){this.path=e}static fromPath(e){return new Ae(wt.fromString(e))}static fromName(e){return new Ae(wt.fromString(e).popFirst(5))}static empty(){return new Ae(wt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&wt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return wt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ae(new wt(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Il{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function dm(n){return n.fields.find(e=>e.kind===2)}function qo(n){return n.fields.filter(e=>e.kind!==2)}function VD(n,e){let t=Xe(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=MD(n.fields[r],e.fields[r]),t!==0)return t;return Xe(n.fields.length,e.fields.length)}Il.UNKNOWN_ID=-1;class ra{constructor(e,t){this.fieldPath=e,this.kind=t}}function MD(n,e){const t=on.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Xe(n.kind,e.kind)}class El{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new El(0,jr.min())}}function vI(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=$e.fromTimestamp(r===1e9?new hn(t+1,0):new hn(t,r));return new jr(s,Ae.empty(),e)}function yI(n){return new jr(n.readTime,n.key,-1)}class jr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new jr($e.min(),Ae.empty(),-1)}static max(){return new jr($e.max(),Ae.empty(),-1)}}function Eg(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Ae.comparator(n.documentKey,e.documentKey),t!==0?t:Xe(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _I="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class bI{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yo(n){if(n.code!==W.FAILED_PRECONDITION||n.message!==_I)throw n;fe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ce(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new q((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof q?t:q.resolve(t)}catch(t){return q.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):q.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):q.reject(t)}static resolve(e){return new q((t,r)=>{t(e)})}static reject(e){return new q((t,r)=>{r(e)})}static waitFor(e){return new q((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=q.resolve(!1);for(const r of e)t=t.next(s=>s?q.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new q((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(d=>{o[c]=d,++a,a===i&&r(o)},d=>s(d))}})}static doWhile(e,t){return new q((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sf{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Hn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new ju(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=Tg(r.target.error);this.V.reject(new ju(e,s))}}static open(e,t,r,s){try{return new sf(t,e.transaction(s,r))}catch(i){throw new ju(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(fe("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new $D(t)}}class Ps{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Ps.S(Mn())===12.2&&En("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return fe("SimpleDb","Removing database:",e),Go(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!hg())return!1;if(Ps.v())return!0;const e=Mn(),t=Ps.S(e),r=0<t&&t<10,s=wI(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(fe("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new ju(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new pe(W.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new pe(W.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new ju(e,o))},s.onupgradeneeded=i=>{fe("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{fe("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=sf.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),q.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(fe("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function wI(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class LD{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Go(this.B.delete())}}class ju extends pe{constructor(e,t){super(W.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function _o(n){return n.name==="IndexedDbTransactionError"}class $D{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(fe("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(fe("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Go(r)}add(e){return fe("SimpleDb","ADD",this.store.name,e,e),Go(this.store.add(e))}get(e){return Go(this.store.get(e)).next(t=>(t===void 0&&(t=null),fe("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return fe("SimpleDb","DELETE",this.store.name,e),Go(this.store.delete(e))}count(){return fe("SimpleDb","COUNT",this.store.name),Go(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new q((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new q((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){fe("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new q((r,s)=>{t.onerror=i=>{const o=Tg(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new q((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new LD(a),c=t(a.primaryKey,a.value,l);if(c instanceof q){const d=c.catch(f=>(l.done(),q.reject(f)));r.push(d)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>q.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Go(n){return new q((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Tg(r.target.error);t(s)}})}let n_=!1;function Tg(n){const e=Ps.S(Mn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new pe("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return n_||(n_=!0,setTimeout(()=>{throw r},0)),r}}return n}class FD{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){fe("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{fe("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){_o(t)?fe("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await yo(t)}await this.X(6e4)})}}class UD{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return q.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return fe("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(fe("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=yI(i);Eg(o,r)>0&&(r=o)}),new jr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Ar.oe=-1;function Nc(n){return n==null}function hc(n){return n===0&&1/n==-1/0}function xI(n){return typeof n=="number"&&Number.isInteger(n)&&!hc(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hr(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=r_(e)),e=jD(n.get(t),e);return r_(e)}function jD(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function r_(n){return n+""}function Is(n){const e=n.length;if(Ve(e>=2),e===2)return Ve(n.charAt(0)===""&&n.charAt(1)===""),wt.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&Ce(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:Ce()}i=o+2}return new wt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s_=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kd(n,e){return[n,hr(e)]}function II(n,e,t){return[n,hr(e),t]}const BD={},qD=["prefixPath","collectionGroup","readTime","documentId"],zD=["prefixPath","collectionGroup","documentId"],HD=["collectionGroup","readTime","prefixPath","documentId"],KD=["canonicalId","targetId"],GD=["targetId","path"],WD=["path","targetId"],QD=["collectionId","parent"],JD=["indexId","uid"],YD=["uid","sequenceNumber"],XD=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ZD=["indexId","uid","orderedDocumentKey"],eN=["userId","collectionPath","documentId"],tN=["userId","collectionPath","largestBatchId"],nN=["userId","collectionGroup","largestBatchId"],EI=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],rN=[...EI,"documentOverlays"],TI=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],AI=TI,Ag=[...AI,"indexConfiguration","indexState","indexEntries"],sN=Ag,iN=[...Ag,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hm extends bI{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function Ln(n,e){const t=Te(n);return Ps.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i_(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function bo(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function SI(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function PI(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zt{constructor(e,t){this.comparator=e,this.root=t||Jn.EMPTY}insert(e,t){return new Zt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Jn.BLACK,null,null))}remove(e){return new Zt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Jn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Sd(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Sd(this.root,e,this.comparator,!1)}getReverseIterator(){return new Sd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Sd(this.root,e,this.comparator,!0)}}class Sd{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Jn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Jn.RED,this.left=s??Jn.EMPTY,this.right=i??Jn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Jn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Jn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Jn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Jn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Jn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ce();const e=this.left.check();if(e!==this.right.check())throw Ce();return e+(this.isRed()?0:1)}}Jn.EMPTY=null,Jn.RED=!0,Jn.BLACK=!1;Jn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ce()}get value(){throw Ce()}get color(){throw Ce()}get left(){throw Ce()}get right(){throw Ce()}copy(e,t,r,s,i){return this}insert(e,t,r){return new Jn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zt{constructor(e){this.comparator=e,this.data=new Zt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new o_(this.data.getIterator())}getIteratorFrom(e){return new o_(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof zt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new zt(this.comparator);return t.data=e,t}}class o_{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Wa(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sr{constructor(e){this.fields=e,e.sort(on.comparator)}static empty(){return new Sr([])}unionWith(e){let t=new zt(on.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Sr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return xl(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RI extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zK(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new RI("Invalid base64 string: "+i):i}}(e);return new vn(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new vn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Xe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}vn.EMPTY_BYTE_STRING=new vn("");const oN=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ai(n){if(Ve(!!n),typeof n=="string"){let e=0;const t=oN.exec(n);if(Ve(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:sn(n.seconds),nanos:sn(n.nanos)}}function sn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function li(n){return typeof n=="string"?vn.fromBase64String(n):vn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function of(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function af(n){const e=n.mapValue.fields.__previous_value__;return of(e)?af(e):e}function fc(n){const e=ai(n.mapValue.fields.__local_write_time__.timestampValue);return new hn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aN{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class ua{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ua("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ua&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xi={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Gd={nullValue:"NULL_VALUE"};function lo(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?of(n)?4:CI(n)?9007199254740991:lf(n)?10:11:Ce()}function ks(n,e){if(n===e)return!0;const t=lo(n);if(t!==lo(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return fc(n).isEqual(fc(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=ai(s.timestampValue),a=ai(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return li(s.bytesValue).isEqual(li(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return sn(s.geoPointValue.latitude)===sn(i.geoPointValue.latitude)&&sn(s.geoPointValue.longitude)===sn(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return sn(s.integerValue)===sn(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=sn(s.doubleValue),a=sn(i.doubleValue);return o===a?hc(o)===hc(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return xl(n.arrayValue.values||[],e.arrayValue.values||[],ks);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(i_(o)!==i_(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!ks(o[l],a[l])))return!1;return!0}(n,e);default:return Ce()}}function pc(n,e){return(n.values||[]).find(t=>ks(t,e))!==void 0}function uo(n,e){if(n===e)return 0;const t=lo(n),r=lo(e);if(t!==r)return Xe(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Xe(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=sn(i.integerValue||i.doubleValue),l=sn(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return a_(n.timestampValue,e.timestampValue);case 4:return a_(fc(n),fc(e));case 5:return Xe(n.stringValue,e.stringValue);case 6:return function(i,o){const a=li(i),l=li(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const d=Xe(a[c],l[c]);if(d!==0)return d}return Xe(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Xe(sn(i.latitude),sn(o.latitude));return a!==0?a:Xe(sn(i.longitude),sn(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return l_(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,d;const f=i.fields||{},g=o.fields||{},v=(a=f.value)===null||a===void 0?void 0:a.arrayValue,x=(l=g.value)===null||l===void 0?void 0:l.arrayValue,w=Xe(((c=v==null?void 0:v.values)===null||c===void 0?void 0:c.length)||0,((d=x==null?void 0:x.values)===null||d===void 0?void 0:d.length)||0);return w!==0?w:l_(v,x)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Xi.mapValue&&o===Xi.mapValue)return 0;if(i===Xi.mapValue)return 1;if(o===Xi.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},d=Object.keys(c);l.sort(),d.sort();for(let f=0;f<l.length&&f<d.length;++f){const g=Xe(l[f],d[f]);if(g!==0)return g;const v=uo(a[l[f]],c[d[f]]);if(v!==0)return v}return Xe(l.length,d.length)}(n.mapValue,e.mapValue);default:throw Ce()}}function a_(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Xe(n,e);const t=ai(n),r=ai(e),s=Xe(t.seconds,r.seconds);return s!==0?s:Xe(t.nanos,r.nanos)}function l_(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=uo(t[s],r[s]);if(i)return i}return Xe(t.length,r.length)}function Tl(n){return fm(n)}function fm(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=ai(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return li(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Ae.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=fm(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${fm(t.fields[o])}`;return s+"}"}(n.mapValue):Ce()}function Wd(n){switch(lo(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=af(n);return e?16+Wd(e):16;case 5:return 2*n.stringValue.length;case 6:return li(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Wd(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return bo(r.fields,(i,o)=>{s+=i.length+Wd(o)}),s}(n.mapValue);default:throw Ce()}}function ca(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function pm(n){return!!n&&"integerValue"in n}function mc(n){return!!n&&"arrayValue"in n}function u_(n){return!!n&&"nullValue"in n}function c_(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Qd(n){return!!n&&"mapValue"in n}function lf(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Bu(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return bo(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Bu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Bu(n.arrayValue.values[t]);return e}return Object.assign({},n)}function CI(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const kI={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function lN(n){return"nullValue"in n?Gd:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?ca(ua.empty(),Ae.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?lf(n)?kI:{mapValue:{}}:Ce()}function uN(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?ca(ua.empty(),Ae.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?kI:"mapValue"in n?lf(n)?{mapValue:{}}:Xi:Ce()}function d_(n,e){const t=uo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function h_(n,e){const t=uo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zn{constructor(e){this.value=e}static empty(){return new Zn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Qd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Bu(t)}setAll(e){let t=on.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Bu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Qd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ks(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Qd(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){bo(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Zn(Bu(this.value))}}function DI(n){const e=[];return bo(n.fields,(t,r)=>{const s=new on([t]);if(Qd(r)){const i=DI(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Sr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new tn(e,0,$e.min(),$e.min(),$e.min(),Zn.empty(),0)}static newFoundDocument(e,t,r,s){return new tn(e,1,t,$e.min(),r,s,0)}static newNoDocument(e,t){return new tn(e,2,t,$e.min(),$e.min(),Zn.empty(),0)}static newUnknownDocument(e,t){return new tn(e,3,t,$e.min(),$e.min(),Zn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($e.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Zn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Zn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$e.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof tn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new tn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(e,t){this.position=e,this.inclusive=t}}function f_(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=Ae.comparator(Ae.fromName(o.referenceValue),t.key):r=uo(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function p_(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ks(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gc{constructor(e,t="asc"){this.field=e,this.dir=t}}function cN(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NI{}class xt extends NI{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new dN(e,t,r):t==="array-contains"?new pN(e,r):t==="in"?new FI(e,r):t==="not-in"?new mN(e,r):t==="array-contains-any"?new gN(e,r):new xt(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new hN(e,r):new fN(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(uo(t,this.value)):t!==null&&lo(this.value)===lo(t)&&this.matchesComparison(uo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ce()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Bt extends NI{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Bt(e,t)}matches(e){return Al(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Al(n){return n.op==="and"}function mm(n){return n.op==="or"}function Sg(n){return OI(n)&&Al(n)}function OI(n){for(const e of n.filters)if(e instanceof Bt)return!1;return!0}function gm(n){if(n instanceof xt)return n.field.canonicalString()+n.op.toString()+Tl(n.value);if(Sg(n))return n.filters.map(e=>gm(e)).join(",");{const e=n.filters.map(t=>gm(t)).join(",");return`${n.op}(${e})`}}function VI(n,e){return n instanceof xt?function(r,s){return s instanceof xt&&r.op===s.op&&r.field.isEqual(s.field)&&ks(r.value,s.value)}(n,e):n instanceof Bt?function(r,s){return s instanceof Bt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&VI(o,s.filters[a]),!0):!1}(n,e):void Ce()}function MI(n,e){const t=n.filters.concat(e);return Bt.create(t,n.op)}function LI(n){return n instanceof xt?function(t){return`${t.field.canonicalString()} ${t.op} ${Tl(t.value)}`}(n):n instanceof Bt?function(t){return t.op.toString()+" {"+t.getFilters().map(LI).join(" ,")+"}"}(n):"Filter"}class dN extends xt{constructor(e,t,r){super(e,t,r),this.key=Ae.fromName(r.referenceValue)}matches(e){const t=Ae.comparator(e.key,this.key);return this.matchesComparison(t)}}class hN extends xt{constructor(e,t){super(e,"in",t),this.keys=$I("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class fN extends xt{constructor(e,t){super(e,"not-in",t),this.keys=$I("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function $I(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Ae.fromName(r.referenceValue))}class pN extends xt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return mc(t)&&pc(t.arrayValue,this.value)}}class FI extends xt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&pc(this.value.arrayValue,t)}}class mN extends xt{constructor(e,t){super(e,"not-in",t)}matches(e){if(pc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!pc(this.value.arrayValue,t)}}class gN extends xt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!mc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>pc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vN{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function vm(n,e=null,t=[],r=[],s=null,i=null,o=null){return new vN(n,e,t,r,s,i,o)}function da(n){const e=Te(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>gm(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Nc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Tl(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Tl(r)).join(",")),e.ue=t}return e.ue}function Oc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!cN(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!VI(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!p_(n.startAt,e.startAt)&&p_(n.endAt,e.endAt)}function vh(n){return Ae.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function yh(n,e){return n.filters.filter(t=>t instanceof xt&&t.field.isEqual(e))}function m_(n,e,t){let r=Gd,s=!0;for(const i of yh(n,e)){let o=Gd,a=!0;switch(i.op){case"<":case"<=":o=lN(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Gd}d_({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];d_({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function g_(n,e,t){let r=Xi,s=!0;for(const i of yh(n,e)){let o=Xi,a=!0;switch(i.op){case">=":case">":o=uN(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Xi}h_({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];h_({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pi{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function UI(n,e,t,r,s,i,o,a){return new pi(n,e,t,r,s,i,o,a)}function ql(n){return new pi(n)}function v_(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Pg(n){return n.collectionGroup!==null}function hl(n){const e=Te(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new zt(on.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new gc(i,r))}),t.has(on.keyField().canonicalString())||e.ce.push(new gc(on.keyField(),r))}return e.ce}function fr(n){const e=Te(n);return e.le||(e.le=BI(e,hl(n))),e.le}function jI(n){const e=Te(n);return e.he||(e.he=BI(e,n.explicitOrderBy)),e.he}function BI(n,e){if(n.limitType==="F")return vm(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new gc(s.field,i)});const t=n.endAt?new co(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new co(n.startAt.position,n.startAt.inclusive):null;return vm(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function ym(n,e){const t=n.filters.concat([e]);return new pi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function _h(n,e,t){return new pi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Vc(n,e){return Oc(fr(n),fr(e))&&n.limitType===e.limitType}function qI(n){return`${da(fr(n))}|lt:${n.limitType}`}function tl(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>LI(s)).join(", ")}]`),Nc(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Tl(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Tl(s)).join(",")),`Target(${r})`}(fr(n))}; limitType=${n.limitType})`}function Mc(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Ae.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of hl(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=f_(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,hl(r),s)||r.endAt&&!function(o,a,l){const c=f_(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,hl(r),s))}(n,e)}function zI(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function HI(n){return(e,t)=>{let r=!1;for(const s of hl(n)){const i=yN(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function yN(n,e,t){const r=n.field.isKeyField()?Ae.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?uo(l,c):Ce()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Ce()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){bo(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return PI(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _N=new Zt(Ae.comparator);function Pr(){return _N}const KI=new Zt(Ae.comparator);function Pu(...n){let e=KI;for(const t of n)e=e.insert(t.key,t);return e}function GI(n){let e=KI;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Es(){return qu()}function WI(){return qu()}function qu(){return new mi(n=>n.toString(),(n,e)=>n.isEqual(e))}const bN=new Zt(Ae.comparator),wN=new zt(Ae.comparator);function ot(...n){let e=wN;for(const t of n)e=e.add(t);return e}const xN=new zt(Xe);function Rg(){return xN}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cg(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:hc(e)?"-0":e}}function QI(n){return{integerValue:""+n}}function JI(n,e){return xI(e)?QI(e):Cg(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{constructor(){this._=void 0}}function IN(n,e,t){return n instanceof Sl?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&of(i)&&(i=af(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof ha?XI(n,e):n instanceof fa?ZI(n,e):function(s,i){const o=YI(s,i),a=y_(o)+y_(s.Pe);return pm(o)&&pm(s.Pe)?QI(a):Cg(s.serializer,a)}(n,e)}function EN(n,e,t){return n instanceof ha?XI(n,e):n instanceof fa?ZI(n,e):t}function YI(n,e){return n instanceof Pl?function(r){return pm(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Sl extends uf{}class ha extends uf{constructor(e){super(),this.elements=e}}function XI(n,e){const t=eE(e);for(const r of n.elements)t.some(s=>ks(s,r))||t.push(r);return{arrayValue:{values:t}}}class fa extends uf{constructor(e){super(),this.elements=e}}function ZI(n,e){let t=eE(e);for(const r of n.elements)t=t.filter(s=>!ks(s,r));return{arrayValue:{values:t}}}class Pl extends uf{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function y_(n){return sn(n.integerValue||n.doubleValue)}function eE(n){return mc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc{constructor(e,t){this.field=e,this.transform=t}}function TN(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof ha&&s instanceof ha||r instanceof fa&&s instanceof fa?xl(r.elements,s.elements,ks):r instanceof Pl&&s instanceof Pl?ks(r.Pe,s.Pe):r instanceof Sl&&s instanceof Sl}(n.transform,e.transform)}class AN{constructor(e,t){this.version=e,this.transformResults=t}}class an{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new an}static exists(e){return new an(void 0,e)}static updateTime(e){return new an(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Jd(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class cf{}function tE(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Hl(n.key,an.none()):new zl(n.key,n.data,an.none());{const t=n.data,r=Zn.empty();let s=new zt(on.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new gi(n.key,r,new Sr(s.toArray()),an.none())}}function SN(n,e,t){n instanceof zl?function(s,i,o){const a=s.value.clone(),l=b_(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof gi?function(s,i,o){if(!Jd(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=b_(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(nE(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function zu(n,e,t,r){return n instanceof zl?function(i,o,a,l){if(!Jd(i.precondition,o))return a;const c=i.value.clone(),d=w_(i.fieldTransforms,l,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof gi?function(i,o,a,l){if(!Jd(i.precondition,o))return a;const c=w_(i.fieldTransforms,l,o),d=o.data;return d.setAll(nE(i)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Jd(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function PN(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=YI(r.transform,s||null);i!=null&&(t===null&&(t=Zn.empty()),t.set(r.field,i))}return t||null}function __(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&xl(r,s,(i,o)=>TN(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class zl extends cf{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class gi extends cf{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function nE(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function b_(n,e,t){const r=new Map;Ve(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,EN(o,a,t[s]))}return r}function w_(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,IN(i,o,e))}return r}class Hl extends cf{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class kg extends cf{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dg{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&SN(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=zu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=zu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=WI();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=tE(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument($e.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ot())}isEqual(e){return this.batchId===e.batchId&&xl(this.mutations,e.mutations,(t,r)=>__(t,r))&&xl(this.baseMutations,e.baseMutations,(t,r)=>__(t,r))}}class Ng{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Ve(e.mutations.length===r.length);let s=function(){return bN}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Ng(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Og{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rE{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RN{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Cn,At;function sE(n){switch(n){default:return Ce();case W.CANCELLED:case W.UNKNOWN:case W.DEADLINE_EXCEEDED:case W.RESOURCE_EXHAUSTED:case W.INTERNAL:case W.UNAVAILABLE:case W.UNAUTHENTICATED:return!1;case W.INVALID_ARGUMENT:case W.NOT_FOUND:case W.ALREADY_EXISTS:case W.PERMISSION_DENIED:case W.FAILED_PRECONDITION:case W.ABORTED:case W.OUT_OF_RANGE:case W.UNIMPLEMENTED:case W.DATA_LOSS:return!0}}function iE(n){if(n===void 0)return En("GRPC error has no .code"),W.UNKNOWN;switch(n){case Cn.OK:return W.OK;case Cn.CANCELLED:return W.CANCELLED;case Cn.UNKNOWN:return W.UNKNOWN;case Cn.DEADLINE_EXCEEDED:return W.DEADLINE_EXCEEDED;case Cn.RESOURCE_EXHAUSTED:return W.RESOURCE_EXHAUSTED;case Cn.INTERNAL:return W.INTERNAL;case Cn.UNAVAILABLE:return W.UNAVAILABLE;case Cn.UNAUTHENTICATED:return W.UNAUTHENTICATED;case Cn.INVALID_ARGUMENT:return W.INVALID_ARGUMENT;case Cn.NOT_FOUND:return W.NOT_FOUND;case Cn.ALREADY_EXISTS:return W.ALREADY_EXISTS;case Cn.PERMISSION_DENIED:return W.PERMISSION_DENIED;case Cn.FAILED_PRECONDITION:return W.FAILED_PRECONDITION;case Cn.ABORTED:return W.ABORTED;case Cn.OUT_OF_RANGE:return W.OUT_OF_RANGE;case Cn.UNIMPLEMENTED:return W.UNIMPLEMENTED;case Cn.DATA_LOSS:return W.DATA_LOSS;default:return Ce()}}(At=Cn||(Cn={}))[At.OK=0]="OK",At[At.CANCELLED=1]="CANCELLED",At[At.UNKNOWN=2]="UNKNOWN",At[At.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",At[At.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",At[At.NOT_FOUND=5]="NOT_FOUND",At[At.ALREADY_EXISTS=6]="ALREADY_EXISTS",At[At.PERMISSION_DENIED=7]="PERMISSION_DENIED",At[At.UNAUTHENTICATED=16]="UNAUTHENTICATED",At[At.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",At[At.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",At[At.ABORTED=10]="ABORTED",At[At.OUT_OF_RANGE=11]="OUT_OF_RANGE",At[At.UNIMPLEMENTED=12]="UNIMPLEMENTED",At[At.INTERNAL=13]="INTERNAL",At[At.UNAVAILABLE=14]="UNAVAILABLE",At[At.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bh=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oE(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CN=new na([4294967295,4294967295],0);function x_(n){const e=oE().encode(n),t=new aI;return t.update(e),new Uint8Array(t.digest())}function I_(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new na([t,r],0),new na([s,i],0)]}class Vg{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ru(`Invalid padding: ${t}`);if(r<0)throw new Ru(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ru(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ru(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=na.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(na.fromNumber(r)));return s.compare(CN)===1&&(s=new na([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=x_(e),[r,s]=I_(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Vg(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=x_(e),[r,s]=I_(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Ru extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $c{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Fc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new $c($e.min(),s,new Zt(Xe),Pr(),ot())}}class Fc{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Fc(r,t,ot(),ot(),ot())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yd{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class aE{constructor(e,t){this.targetId=e,this.me=t}}class lE{constructor(e,t,r=vn.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class E_{constructor(){this.fe=0,this.ge=A_(),this.pe=vn.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ot(),t=ot(),r=ot();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:Ce()}}),new Fc(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=A_()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Ve(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class kN{constructor(e){this.Le=e,this.Be=new Map,this.ke=Pr(),this.qe=T_(),this.Qe=new Zt(Xe)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Ce()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(vh(i))if(r===0){const o=new Ae(i.path);this.Ue(t,o,tn.newNoDocument(o,$e.min()))}else Ve(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}bh==null||bh.et(function(d,f,g,v,x){var w,I,L,$,U,z;const le={localCacheCount:d,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},Z=f.unchangedNames;return Z&&(le.bloomFilter={applied:x===0,hashCount:(w=Z==null?void 0:Z.hashCount)!==null&&w!==void 0?w:0,bitmapLength:($=(L=(I=Z==null?void 0:Z.bits)===null||I===void 0?void 0:I.bitmap)===null||L===void 0?void 0:L.length)!==null&&$!==void 0?$:0,padding:(z=(U=Z==null?void 0:Z.bits)===null||U===void 0?void 0:U.padding)!==null&&z!==void 0?z:0,mightContain:A=>{var b;return(b=v==null?void 0:v.mightContain(A))!==null&&b!==void 0&&b}}),le}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=li(r).toUint8Array()}catch(l){if(l instanceof RI)return Xr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Vg(o,s,i)}catch(l){return Xr(l instanceof Ru?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&vh(a.target)){const l=new Ae(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,tn.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=ot();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new $c(e,t,this.Qe,this.ke,r);return this.ke=Pr(),this.qe=T_(),this.Qe=new Zt(Xe),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new E_,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new zt(Xe),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||fe("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new E_),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function T_(){return new Zt(Ae.comparator)}function A_(){return new Zt(Ae.comparator)}const DN=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),NN=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),ON=(()=>({and:"AND",or:"OR"}))();class VN{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function _m(n,e){return n.useProto3Json||Nc(e)?e:{value:e}}function Rl(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function uE(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function MN(n,e){return Rl(n,e.toTimestamp())}function Sn(n){return Ve(!!n),$e.fromTimestamp(function(t){const r=ai(t);return new hn(r.seconds,r.nanos)}(n))}function Mg(n,e){return bm(n,e).canonicalString()}function bm(n,e){const t=function(s){return new wt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function cE(n){const e=wt.fromString(n);return Ve(bE(e)),e}function vc(n,e){return Mg(n.databaseId,e.path)}function Rs(n,e){const t=cE(e);if(t.get(1)!==n.databaseId.projectId)throw new pe(W.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new pe(W.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Ae(fE(t))}function dE(n,e){return Mg(n.databaseId,e)}function hE(n){const e=cE(n);return e.length===4?wt.emptyPath():fE(e)}function wm(n){return new wt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function fE(n){return Ve(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function S_(n,e,t){return{name:vc(n,e),fields:t.value.mapValue.fields}}function pE(n,e,t){const r=Rs(n,e.name),s=Sn(e.updateTime),i=e.createTime?Sn(e.createTime):$e.min(),o=new Zn({mapValue:{fields:e.fields}}),a=tn.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function LN(n,e){return"found"in e?function(r,s){Ve(!!s.found),s.found.name,s.found.updateTime;const i=Rs(r,s.found.name),o=Sn(s.found.updateTime),a=s.found.createTime?Sn(s.found.createTime):$e.min(),l=new Zn({mapValue:{fields:s.found.fields}});return tn.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Ve(!!s.missing),Ve(!!s.readTime);const i=Rs(r,s.missing),o=Sn(s.readTime);return tn.newNoDocument(i,o)}(n,e):Ce()}function $N(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Ce()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,d){return c.useProto3Json?(Ve(d===void 0||typeof d=="string"),vn.fromBase64String(d||"")):(Ve(d===void 0||d instanceof Buffer||d instanceof Uint8Array),vn.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const d=c.code===void 0?W.UNKNOWN:iE(c.code);return new pe(d,c.message||"")}(o);t=new lE(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Rs(n,r.document.name),i=Sn(r.document.updateTime),o=r.document.createTime?Sn(r.document.createTime):$e.min(),a=new Zn({mapValue:{fields:r.document.fields}}),l=tn.newFoundDocument(s,i,o,a),c=r.targetIds||[],d=r.removedTargetIds||[];t=new Yd(c,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Rs(n,r.document),i=r.readTime?Sn(r.readTime):$e.min(),o=tn.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Yd([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Rs(n,r.document),i=r.removedTargetIds||[];t=new Yd([],i,s,null)}else{if(!("filter"in e))return Ce();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new RN(s,i),a=r.targetId;t=new aE(a,o)}}return t}function yc(n,e){let t;if(e instanceof zl)t={update:S_(n,e.key,e.value)};else if(e instanceof Hl)t={delete:vc(n,e.key)};else if(e instanceof gi)t={update:S_(n,e.key,e.data),updateMask:zN(e.fieldMask)};else{if(!(e instanceof kg))return Ce();t={verify:vc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Sl)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof ha)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof fa)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Pl)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Ce()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:MN(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Ce()}(n,e.precondition)),t}function xm(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?an.updateTime(Sn(i.updateTime)):i.exists!==void 0?an.exists(i.exists):an.none()}(e.currentDocument):an.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Ve(a.setToServerValue==="REQUEST_TIME"),l=new Sl;else if("appendMissingElements"in a){const d=a.appendMissingElements.values||[];l=new ha(d)}else if("removeAllFromArray"in a){const d=a.removeAllFromArray.values||[];l=new fa(d)}else"increment"in a?l=new Pl(o,a.increment):Ce();const c=on.fromServerFormat(a.fieldPath);return new Lc(c,l)}(n,s)):[];if(e.update){e.update.name;const s=Rs(n,e.update.name),i=new Zn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new Sr(c.map(d=>on.fromServerFormat(d)))}(e.updateMask);return new gi(s,i,o,t,r)}return new zl(s,i,t,r)}if(e.delete){const s=Rs(n,e.delete);return new Hl(s,t)}if(e.verify){const s=Rs(n,e.verify);return new kg(s,t)}return Ce()}function FN(n,e){return n&&n.length>0?(Ve(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?Sn(s.updateTime):Sn(i);return o.isEqual($e.min())&&(o=Sn(i)),new AN(o,s.transformResults||[])}(t,e))):[]}function mE(n,e){return{documents:[dE(n,e.path)]}}function df(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=dE(n,s);const i=function(c){if(c.length!==0)return _E(Bt.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(d=>function(g){return{field:qi(g.field),direction:jN(g.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=_m(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function gE(n,e,t,r){const{_t:s,parent:i}=df(n,e),o={},a=[];let l=0;return t.forEach(c=>{const d=r?c.alias:"aggregate_"+l++;o[d]=c.alias,c.aggregateType==="count"?a.push({alias:d,count:{}}):c.aggregateType==="avg"?a.push({alias:d,avg:{field:qi(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:d,sum:{field:qi(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function vE(n){let e=hE(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Ve(r===1);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(f){const g=yE(f);return g instanceof Bt&&Sg(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(x){return new gc(nl(x.field),function(I){switch(I){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,Nc(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,v=f.values||[];return new co(v,g)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const g=!f.before,v=f.values||[];return new co(v,g)}(t.endAt)),UI(e,s,o,i,a,"F",l,c)}function UN(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ce()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function yE(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=nl(t.unaryFilter.field);return xt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=nl(t.unaryFilter.field);return xt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=nl(t.unaryFilter.field);return xt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=nl(t.unaryFilter.field);return xt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Ce()}}(n):n.fieldFilter!==void 0?function(t){return xt.create(nl(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ce()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Bt.create(t.compositeFilter.filters.map(r=>yE(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Ce()}}(t.compositeFilter.op))}(n):Ce()}function jN(n){return DN[n]}function BN(n){return NN[n]}function qN(n){return ON[n]}function qi(n){return{fieldPath:n.canonicalString()}}function nl(n){return on.fromServerFormat(n.fieldPath)}function _E(n){return n instanceof xt?function(t){if(t.op==="=="){if(c_(t.value))return{unaryFilter:{field:qi(t.field),op:"IS_NAN"}};if(u_(t.value))return{unaryFilter:{field:qi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(c_(t.value))return{unaryFilter:{field:qi(t.field),op:"IS_NOT_NAN"}};if(u_(t.value))return{unaryFilter:{field:qi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qi(t.field),op:BN(t.op),value:t.value}}}(n):n instanceof Bt?function(t){const r=t.getFilters().map(s=>_E(s));return r.length===1?r[0]:{compositeFilter:{op:qN(t.op),filters:r}}}(n):Ce()}function zN(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function bE(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs{constructor(e,t,r,s,i=$e.min(),o=$e.min(),a=vn.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Qs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Qs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Qs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Qs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wE{constructor(e){this.ct=e}}function HN(n,e){let t;if(e.document)t=pE(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Ae.fromSegments(e.noDocument.path),s=ma(e.noDocument.readTime);t=tn.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Ce();{const r=Ae.fromSegments(e.unknownDocument.path),s=ma(e.unknownDocument.version);t=tn.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new hn(s[0],s[1]);return $e.fromTimestamp(i)}(e.readTime)),t}function P_(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:wh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:vc(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Rl(i,o.version.toTimestamp()),createTime:Rl(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:pa(e.version)};else{if(!e.isUnknownDocument())return Ce();r.unknownDocument={path:t.path.toArray(),version:pa(e.version)}}return r}function wh(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function pa(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ma(n){const e=new hn(n.seconds,n.nanoseconds);return $e.fromTimestamp(e)}function Wo(n,e){const t=(e.baseMutations||[]).map(i=>xm(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>xm(n.ct,i)),s=hn.fromMillis(e.localWriteTimeMs);return new Dg(e.batchId,s,t,r)}function Cu(n){const e=ma(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?ma(n.lastLimboFreeSnapshotVersion):$e.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Ve(i.documents.length===1),fr(ql(hE(i.documents[0])))}(n.query):function(i){return fr(vE(i))}(n.query),new Qs(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,vn.fromBase64String(n.resumeToken))}function xE(n,e){const t=pa(e.snapshotVersion),r=pa(e.lastLimboFreeSnapshotVersion);let s;s=vh(e.target)?mE(n.ct,e.target):df(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:da(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Lg(n){const e=vE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?_h(e,e.limit,"L"):e}function Cp(n,e){return new Og(e.largestBatchId,xm(n.ct,e.overlayMutation))}function R_(n,e){const t=e.path.lastSegment();return[n,hr(e.path.popLast()),t]}function C_(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:pa(r.readTime),documentKey:hr(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KN{getBundleMetadata(e,t){return k_(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:ma(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return k_(e).put(function(s){return{bundleId:s.id,createTime:pa(Sn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return D_(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Lg(i.bundledQuery),readTime:ma(i.readTime)}}(r)})}saveNamedQuery(e,t){return D_(e).put(function(s){return{name:s.name,readTime:pa(Sn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function k_(n){return Ln(n,"bundles")}function D_(n){return Ln(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hf{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new hf(e,r)}getOverlay(e,t){return gu(e).get(R_(this.userId,t)).next(r=>r?Cp(this.serializer,r):null)}getOverlays(e,t){const r=Es();return q.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Og(t,o);s.push(this.ht(e,a))}),q.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(hr(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(gu(e).j("collectionPathOverlayIndex",a))}),q.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Es(),i=hr(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return gu(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=Cp(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Es();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return gu(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,d)=>{const f=Cp(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>i)}ht(e,t){return gu(e).put(function(s,i,o){const[a,l,c]=R_(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:yc(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function gu(n){return Ln(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GN{Pt(e){return Ln(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?vn.fromUint8Array(r):vn.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qo{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(sn(e.integerValue));else if("doubleValue"in e){const r=sn(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),hc(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=ai(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(li(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?CI(e)?this.dt(t,Number.MAX_SAFE_INTEGER):lf(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Ce()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(sn(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),Ae.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Qo.vt=new Qo;function WN(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function N_(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=WN(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class QN{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=N_(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=N_(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class JN{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class YN{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class vu{constructor(){this.jt=new QN,this.Ht=new JN(this.jt),this.Jt=new YN(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Jo(this.indexId,this.documentKey,this.arrayValue,r)}}function Vi(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=O_(n.arrayValue,e.arrayValue),t!==0?t:(t=O_(n.directionalValue,e.directionalValue),t!==0?t:Ae.comparator(n.documentKey,e.documentKey)))}function O_(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V_{constructor(e){this.Xt=new zt((t,r)=>on.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Ve(e.collectionGroup===this.collectionId),this.nn)return!1;const t=dm(e);if(t!==void 0&&!this.sn(t))return!1;const r=qo(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new zt(on.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new ra(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new ra(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new ra(r.field,r.dir==="asc"?0:1)));return new Il(Il.UNKNOWN_ID,this.collectionId,t,El.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IE(n){var e,t;if(Ve(n instanceof xt||n instanceof Bt),n instanceof xt){if(n instanceof FI){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>xt.create(n.field,"==",i)))||[];return Bt.create(s,"or")}return n}const r=n.filters.map(s=>IE(s));return Bt.create(r,n.op)}function XN(n){if(n.getFilters().length===0)return[];const e=Tm(IE(n));return Ve(EE(e)),Im(e)||Em(e)?[e]:e.getFilters()}function Im(n){return n instanceof xt}function Em(n){return n instanceof Bt&&Sg(n)}function EE(n){return Im(n)||Em(n)||function(t){if(t instanceof Bt&&mm(t)){for(const r of t.getFilters())if(!Im(r)&&!Em(r))return!1;return!0}return!1}(n)}function Tm(n){if(Ve(n instanceof xt||n instanceof Bt),n instanceof xt)return n;if(n.filters.length===1)return Tm(n.filters[0]);const e=n.filters.map(r=>Tm(r));let t=Bt.create(e,n.op);return t=xh(t),EE(t)?t:(Ve(t instanceof Bt),Ve(Al(t)),Ve(t.filters.length>1),t.filters.reduce((r,s)=>$g(r,s)))}function $g(n,e){let t;return Ve(n instanceof xt||n instanceof Bt),Ve(e instanceof xt||e instanceof Bt),t=n instanceof xt?e instanceof xt?function(s,i){return Bt.create([s,i],"and")}(n,e):M_(n,e):e instanceof xt?M_(e,n):function(s,i){if(Ve(s.filters.length>0&&i.filters.length>0),Al(s)&&Al(i))return MI(s,i.getFilters());const o=mm(s)?s:i,a=mm(s)?i:s,l=o.filters.map(c=>$g(c,a));return Bt.create(l,"or")}(n,e),xh(t)}function M_(n,e){if(Al(e))return MI(e,n.getFilters());{const t=e.filters.map(r=>$g(n,r));return Bt.create(t,"or")}}function xh(n){if(Ve(n instanceof xt||n instanceof Bt),n instanceof xt)return n;const e=n.getFilters();if(e.length===1)return xh(e[0]);if(OI(n))return n;const t=e.map(s=>xh(s)),r=[];return t.forEach(s=>{s instanceof xt?r.push(s):s instanceof Bt&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Bt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZN{constructor(){this.un=new Fg}addToCollectionParentIndex(e,t){return this.un.add(t),q.resolve()}getCollectionParents(e,t){return q.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return q.resolve()}deleteFieldIndex(e,t){return q.resolve()}deleteAllFieldIndexes(e){return q.resolve()}createTargetIndexes(e,t){return q.resolve()}getDocumentsMatchingTarget(e,t){return q.resolve(null)}getIndexType(e,t){return q.resolve(0)}getFieldIndexes(e,t){return q.resolve([])}getNextCollectionGroupToUpdate(e){return q.resolve(null)}getMinOffset(e,t){return q.resolve(jr.min())}getMinOffsetFromCollectionGroup(e,t){return q.resolve(jr.min())}updateCollectionGroup(e,t,r){return q.resolve()}updateIndexEntries(e,t){return q.resolve()}}class Fg{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new zt(wt.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new zt(wt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pd=new Uint8Array(0);class eO{constructor(e,t){this.databaseId=t,this.cn=new Fg,this.ln=new mi(r=>da(r),(r,s)=>Oc(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:hr(s)};return L_(e).put(i)}return q.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[gI(t),""],!1,!0);return L_(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Is(o.parent))}return r})}addFieldIndex(e,t){const r=yu(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Ja(e);return i.next(a=>{o.put(C_(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=yu(e),s=Ja(e),i=Qa(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=yu(e),r=Qa(e),s=Ja(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return q.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new V_(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Qa(e);let s=!0;const i=new Map;return q.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=ot();const a=[];return q.forEach(i,(l,c)=>{fe("IndexedDbIndexManager",`Using index ${function(U){return`id=${U.indexId}|cg=${U.collectionGroup}|f=${U.fields.map(z=>`${z.fieldPath}:${z.kind}`).join(",")}`}(l)} to execute ${da(t)}`);const d=function(U,z){const le=dm(z);if(le===void 0)return null;for(const Z of yh(U,le.fieldPath))switch(Z.op){case"array-contains-any":return Z.value.arrayValue.values||[];case"array-contains":return[Z.value]}return null}(c,l),f=function(U,z){const le=new Map;for(const Z of qo(z))for(const A of yh(U,Z.fieldPath))switch(A.op){case"==":case"in":le.set(Z.fieldPath.canonicalString(),A.value);break;case"not-in":case"!=":return le.set(Z.fieldPath.canonicalString(),A.value),Array.from(le.values())}return null}(c,l),g=function(U,z){const le=[];let Z=!0;for(const A of qo(z)){const b=A.kind===0?m_(U,A.fieldPath,U.startAt):g_(U,A.fieldPath,U.startAt);le.push(b.value),Z&&(Z=b.inclusive)}return new co(le,Z)}(c,l),v=function(U,z){const le=[];let Z=!0;for(const A of qo(z)){const b=A.kind===0?g_(U,A.fieldPath,U.endAt):m_(U,A.fieldPath,U.endAt);le.push(b.value),Z&&(Z=b.inclusive)}return new co(le,Z)}(c,l),x=this.In(l,c,g),w=this.In(l,c,v),I=this.Tn(l,c,f),L=this.En(l.indexId,d,x,g.inclusive,w,v.inclusive,I);return q.forEach(L,$=>r.G($,t.limit).next(U=>{U.forEach(z=>{const le=Ae.fromSegments(z.documentKey);o.has(le)||(o=o.add(le),a.push(le))})}))}).next(()=>a)}return q.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=XN(Bt.create(e.filters,"and")).map(r=>vm(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),d=[];for(let f=0;f<l;++f){const g=t?this.dn(t[f/c]):Pd,v=this.An(e,g,r[f%c],s),x=this.Rn(e,g,i[f%c],o),w=a.map(I=>this.An(e,g,I,!0));d.push(...this.createRange(v,x,w))}return d}An(e,t,r,s){const i=new Jo(e,Ae.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new Jo(e,Ae.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new V_(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return q.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new zt(on.comparator),d=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?d=!0:c=c.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(d?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new vu;for(const s of qo(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);Qo.vt.It(i,o)}return r.zt()}dn(e){const t=new vu;return Qo.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new vu;return Qo.vt.It(ca(this.databaseId,t),r.Yt(function(i){const o=qo(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new vu);let i=0;for(const o of qo(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&mc(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);Qo.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new vu;l.seed(a.zt()),Qo.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof xt&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=yu(e),s=Ja(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return q.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(d,f){const g=f?new El(f.sequenceNumber,new jr(ma(f.readTime),new Ae(Is(f.documentKey)),f.largestBatchId)):El.empty(),v=d.fields.map(([x,w])=>new ra(on.fromServerFormat(x),w));return new Il(d.indexId,d.collectionGroup,v,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Xe(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=yu(e),i=Ja(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>q.forEach(a,l=>i.put(C_(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return q.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?q.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),q.forEach(a,l=>this.wn(e,s,l).next(c=>{const d=this.Sn(i,l);return c.isEqual(d)?q.resolve():this.bn(e,i,l,c,d)}))))})}Dn(e,t,r,s){return Qa(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return Qa(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=Qa(e);let i=new zt(Vi);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new Jo(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new zt(Vi);const s=this.Vn(t,e);if(s==null)return r;const i=dm(t);if(i!=null){const o=e.data.field(i.fieldPath);if(mc(o))for(const a of o.arrayValue.values||[])r=r.add(new Jo(t.indexId,e.key,this.dn(a),s))}else r=r.add(new Jo(t.indexId,e.key,Pd,s));return r}bn(e,t,r,s,i){fe("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,d,f,g){const v=l.getIterator(),x=c.getIterator();let w=Wa(v),I=Wa(x);for(;w||I;){let L=!1,$=!1;if(w&&I){const U=d(w,I);U<0?$=!0:U>0&&(L=!0)}else w!=null?$=!0:L=!0;L?(f(I),I=Wa(x)):$?(g(w),w=Wa(v)):(w=Wa(v),I=Wa(x))}}(s,i,Vi,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),q.waitFor(o)}yn(e){let t=1;return Ja(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Vi(o,a)).filter((o,a,l)=>!a||Vi(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Vi(o,e),l=Vi(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Pd,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Pd,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return Vi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next($_)}getMinOffset(e,t){return q.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||Ce())).next($_)}}function L_(n){return Ln(n,"collectionParents")}function Qa(n){return Ln(n,"indexEntries")}function yu(n){return Ln(n,"indexConfiguration")}function Ja(n){return Ln(n,"indexState")}function $_(n){Ve(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Eg(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new jr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ar{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new ar(e,ar.DEFAULT_COLLECTION_PERCENTILE,ar.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TE(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(d,f,g)=>(a++,g.delete()));i.push(l.next(()=>{Ve(a===1)}));const c=[];for(const d of t.mutations){const f=II(e,d.key.path,t.batchId);i.push(s.delete(f)),c.push(d.key)}return q.waitFor(i).next(()=>c)}function Ih(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Ce();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ar.DEFAULT_COLLECTION_PERCENTILE=10,ar.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ar.DEFAULT=new ar(41943040,ar.DEFAULT_COLLECTION_PERCENTILE,ar.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ar.DISABLED=new ar(-1,0,0);class ff{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Ve(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new ff(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Mi(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=rl(e),o=Mi(e);return o.add({}).next(a=>{Ve(typeof a=="number");const l=new Dg(a,t,r,s),c=function(v,x,w){const I=w.baseMutations.map($=>yc(v.ct,$)),L=w.mutations.map($=>yc(v.ct,$));return{userId:x,batchId:w.batchId,localWriteTimeMs:w.localWriteTime.toMillis(),baseMutations:I,mutations:L}}(this.serializer,this.userId,l),d=[];let f=new zt((g,v)=>Xe(g.canonicalString(),v.canonicalString()));for(const g of s){const v=II(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),d.push(o.put(c)),d.push(i.put(v,BD))}return f.forEach(g=>{d.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),q.waitFor(d).next(()=>l)})}lookupMutationBatch(e,t){return Mi(e).get(t).next(r=>r?(Ve(r.userId===this.userId),Wo(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?q.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Mi(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Ve(a.batchId>=r),i=Wo(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Mi(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Mi(e).U("userMutationsIndex",t).next(r=>r.map(s=>Wo(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Kd(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return rl(e).J({range:s},(o,a,l)=>{const[c,d,f]=o,g=Is(d);if(c===this.userId&&t.path.isEqual(g))return Mi(e).get(f).next(v=>{if(!v)throw Ce();Ve(v.userId===this.userId),i.push(Wo(this.serializer,v))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new zt(Xe);const s=[];return t.forEach(i=>{const o=Kd(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=rl(e).J({range:a},(c,d,f)=>{const[g,v,x]=c,w=Is(v);g===this.userId&&i.path.isEqual(w)?r=r.add(x):f.done()});s.push(l)}),q.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Kd(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new zt(Xe);return rl(e).J({range:o},(l,c,d)=>{const[f,g,v]=l,x=Is(g);f===this.userId&&r.isPrefixOf(x)?x.length===s&&(a=a.add(v)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(Mi(e).get(i).next(o=>{if(o===null)throw Ce();Ve(o.userId===this.userId),r.push(Wo(this.serializer,o))}))}),q.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return TE(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),q.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return q.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return rl(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=Is(i[1]);s.push(l)}else a.done()}).next(()=>{Ve(s.length===0)})})}containsKey(e,t){return AE(e,this.userId,t)}Nn(e){return SE(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function AE(n,e,t){const r=Kd(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return rl(n).J({range:i,H:!0},(a,l,c)=>{const[d,f,g]=a;d===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function Mi(n){return Ln(n,"mutations")}function rl(n){return Ln(n,"documentMutations")}function SE(n){return Ln(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ga{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new ga(0)}static kn(){return new ga(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tO{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new ga(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>$e.fromTimestamp(new hn(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ya(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Ve(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Ya(e).J((o,a)=>{const l=Cu(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>q.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Ya(e).J((r,s)=>{const i=Cu(s);t(i)})}qn(e){return U_(e).get("targetGlobalKey").next(t=>(Ve(t!==null),t))}Qn(e,t){return U_(e).put("targetGlobalKey",t)}Kn(e,t){return Ya(e).put(xE(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=da(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Ya(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=Cu(a);Oc(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=zi(e);return t.forEach(o=>{const a=hr(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),q.waitFor(s)}removeMatchingKeys(e,t,r){const s=zi(e);return q.forEach(t,i=>{const o=hr(i.path);return q.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=zi(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=zi(e);let i=ot();return s.J({range:r,H:!0},(o,a,l)=>{const c=Is(o[1]),d=new Ae(c);i=i.add(d)}).next(()=>i)}containsKey(e,t){const r=hr(t.path),s=IDBKeyRange.bound([r],[gI(r)],!1,!0);let i=0;return zi(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return Ya(e).get(t).next(r=>r?Cu(r):null)}}function Ya(n){return Ln(n,"targets")}function U_(n){return Ln(n,"targetGlobal")}function zi(n){return Ln(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j_([n,e],[t,r]){const s=Xe(n,t);return s===0?Xe(e,r):s}class nO{constructor(e){this.Un=e,this.buffer=new zt(j_),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();j_(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class PE{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){fe("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){_o(t)?fe("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await yo(t)}await this.Hn(3e5)})}}class rO{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return q.resolve(Ar.oe);const r=new nO(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(fe("LruGarbageCollector","Garbage collection skipped; disabled"),q.resolve(F_)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(fe("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),F_):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(fe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),el()<=_t.DEBUG&&fe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-d}ms`),q.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function RE(n,e){return new rO(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sO{constructor(e,t){this.db=e,this.garbageCollector=RE(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return Rd(e,r)}removeReference(e,t,r){return Rd(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Rd(e,t)}nr(e,t){return function(s,i){let o=!1;return SE(s).Y(a=>AE(s,a,i).next(l=>(l&&(o=!0),q.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,$e.min()),zi(e).delete(function(f){return[0,hr(f.path)]}(o))))});s.push(l)}}).next(()=>q.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Rd(e,t)}tr(e,t){const r=zi(e);let s,i=Ar.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==Ar.oe&&t(new Ae(Is(s)),i),i=c,s=l):i=Ar.oe}).next(()=>{i!==Ar.oe&&t(new Ae(Is(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Rd(n,e){return zi(n).put(function(r,s){return{targetId:0,path:hr(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CE{constructor(){this.changes=new mi(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,tn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?q.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iO{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Uo(e).put(r)}removeEntry(e,t,r){return Uo(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],wh(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=tn.newInvalidDocument(t);return Uo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(_u(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:tn.newInvalidDocument(t)};return Uo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(_u(t))},(s,i)=>{r={document:this.ir(t,i),size:Ih(i)}}).next(()=>r)}getEntries(e,t){let r=Pr();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=Pr(),s=new Zt(Ae.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,Ih(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return q.resolve();let s=new zt(z_);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(_u(s.first()),_u(s.last())),o=s.getIterator();let a=o.getNext();return Uo(e).J({index:"documentKeyIndex",range:i},(l,c,d)=>{const f=Ae.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&z_(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?d.$(_u(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),wh(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Uo(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let d=Pr();for(const f of c){const g=this.ir(Ae.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(Mc(t,g)||s.has(g.key))&&(d=d.insert(g.key,g))}return d})}getAllFromCollectionGroup(e,t,r,s){let i=Pr();const o=q_(t,r),a=q_(t,jr.max());return Uo(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,d)=>{const f=this.ir(Ae.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&d.done()}).next(()=>i)}newChangeBuffer(e){return new oO(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return B_(e).get("remoteDocumentGlobalKey").next(t=>(Ve(!!t),t))}rr(e,t){return B_(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=HN(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual($e.min())))return r}return tn.newInvalidDocument(e)}}function kE(n){return new iO(n)}class oO extends CE{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new mi(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new zt((i,o)=>Xe(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=P_(this.cr.serializer,o);s=s.add(i.path.popLast());const c=Ih(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=P_(this.cr.serializer,o.convertToNoDocument($e.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),q.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function B_(n){return Ln(n,"remoteDocumentGlobal")}function Uo(n){return Ln(n,"remoteDocumentsV14")}function _u(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function q_(n,e){const t=e.documentKey.path.toArray();return[n,wh(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function z_(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Xe(t[i],r[i]),s)return s;return s=Xe(t.length,r.length),s||(s=Xe(t[t.length-2],r[r.length-2]),s||Xe(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aO{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DE{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&zu(r.mutation,s,Sr.empty(),hn.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ot()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ot()){const s=Es();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Pu();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Es();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ot()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Pr();const o=qu(),a=function(){return qu()}();return t.forEach((l,c)=>{const d=r.get(c.key);s.has(c.key)&&(d===void 0||d.mutation instanceof gi)?i=i.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),zu(d.mutation,c,d.mutation.getFieldMask(),hn.now())):o.set(c.key,Sr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var f;return a.set(c,new aO(d,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=qu();let s=new Zt((o,a)=>o-a),i=ot();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let d=r.get(l)||Sr.empty();d=a.applyToLocalView(c,d),r.set(l,d);const f=(s.get(a.batchId)||ot()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,d=l.value,f=WI();d.forEach(g=>{if(!i.has(g)){const v=tE(t.get(g),r.get(g));v!==null&&f.set(g,v),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return q.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return Ae.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Pg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):q.resolve(Es());let a=-1,l=i;return o.next(c=>q.forEach(c,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(d)?q.resolve():this.remoteDocumentCache.getEntry(e,d).next(g=>{l=l.insert(d,g)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,ot())).next(d=>({batchId:a,changes:GI(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ae(t)).next(r=>{let s=Pu();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Pu();return this.indexManager.getCollectionParents(e,i).next(a=>q.forEach(a,l=>{const c=function(f,g){return new pi(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(d=>{d.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const d=c.getKey();o.get(d)===null&&(o=o.insert(d,tn.newInvalidDocument(d)))});let a=Pu();return o.forEach((l,c)=>{const d=i.get(l);d!==void 0&&zu(d.mutation,c,Sr.empty(),hn.now()),Mc(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lO{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return q.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Sn(s.createTime)}}(t)),q.resolve()}getNamedQuery(e,t){return q.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Lg(s.bundledQuery),readTime:Sn(s.readTime)}}(t)),q.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uO{constructor(){this.overlays=new Zt(Ae.comparator),this.Ir=new Map}getOverlay(e,t){return q.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Es();return q.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),q.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),q.resolve()}getOverlaysForCollection(e,t,r){const s=Es(),i=t.length+1,o=new Ae(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return q.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Zt((c,d)=>c-d);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let d=i.get(c.largestBatchId);d===null&&(d=Es(),i=i.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}const a=Es(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=s)););return q.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Og(t,r));let i=this.Ir.get(t);i===void 0&&(i=ot(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cO{constructor(){this.sessionToken=vn.EMPTY_BYTE_STRING}getSessionToken(e){return q.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,q.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ug{constructor(){this.Tr=new zt(Bn.Er),this.dr=new zt(Bn.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new Bn(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Bn(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new Ae(new wt([])),r=new Bn(t,e),s=new Bn(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Ae(new wt([])),r=new Bn(t,e),s=new Bn(t,e+1);let i=ot();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Bn(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Bn{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Ae.comparator(e.key,t.key)||Xe(e.wr,t.wr)}static Ar(e,t){return Xe(e.wr,t.wr)||Ae.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dO{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new zt(Bn.Er)}checkEmpty(e){return q.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Dg(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new Bn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return q.resolve(o)}lookupMutationBatch(e,t){return q.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return q.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return q.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return q.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Bn(t,0),s=new Bn(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),q.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new zt(Xe);return t.forEach(s=>{const i=new Bn(s,0),o=new Bn(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),q.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Ae.isDocumentKey(i)||(i=i.child(""));const o=new Bn(new Ae(i),0);let a=new zt(Xe);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),q.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Ve(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return q.forEach(t.mutations,s=>{const i=new Bn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new Bn(t,0),s=this.br.firstAfterOrEqual(r);return q.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,q.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hO{constructor(e){this.Mr=e,this.docs=function(){return new Zt(Ae.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return q.resolve(r?r.document.mutableCopy():tn.newInvalidDocument(t))}getEntries(e,t){let r=Pr();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():tn.newInvalidDocument(s))}),q.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Pr();const o=t.path,a=new Ae(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:d}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Eg(yI(d),r)<=0||(s.has(d.key)||Mc(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return q.resolve(i)}getAllFromCollectionGroup(e,t,r,s){Ce()}Or(e,t){return q.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new fO(this)}getSize(e){return q.resolve(this.size)}}class fO extends CE{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),q.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pO{constructor(e){this.persistence=e,this.Nr=new mi(t=>da(t),Oc),this.lastRemoteSnapshotVersion=$e.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Ug,this.targetCount=0,this.kr=ga.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),q.resolve()}getLastRemoteSnapshotVersion(e){return q.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return q.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),q.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),q.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new ga(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,q.resolve()}updateTargetData(e,t){return this.Kn(t),q.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,q.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),q.waitFor(i).next(()=>s)}getTargetCount(e){return q.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return q.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),q.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),q.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),q.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return q.resolve(r)}containsKey(e,t){return q.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jg{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Ar(0),this.Kr=!1,this.Kr=!0,this.$r=new cO,this.referenceDelegate=e(this),this.Ur=new pO(this),this.indexManager=new ZN,this.remoteDocumentCache=function(s){return new hO(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new wE(t),this.Gr=new lO(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new uO,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new dO(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){fe("MemoryPersistence","Starting transaction:",e);const s=new mO(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return q.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class mO extends bI{constructor(e){super(),this.currentSequenceNumber=e}}class pf{constructor(e){this.persistence=e,this.Jr=new Ug,this.Yr=null}static Zr(e){return new pf(e)}get Xr(){if(this.Yr)return this.Yr;throw Ce()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),q.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),q.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),q.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return q.forEach(this.Xr,r=>{const s=Ae.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,$e.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return q.or([()=>q.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Eh{constructor(e,t){this.persistence=e,this.ti=new mi(r=>hr(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=RE(this,t)}static Zr(e,t){return new Eh(e,t)}zr(){}jr(e){return q.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return q.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?q.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,$e.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),q.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),q.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),q.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),q.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Wd(e.data.value)),t}nr(e,t,r){return q.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return q.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gO{constructor(e){this.serializer=e}O(e,t,r,s){const i=new sf("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",s_,{unique:!0}),l.createObjectStore("documentMutations")}(e),H_(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=q.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),H_(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:$e.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(d=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",s_,{unique:!0});const f=c.store("mutations"),g=d.map(v=>f.put(v));return q.waitFor(g)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:eN});c.createIndex("collectionPathOverlayIndex",tN,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",nN,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:qD});c.createIndex("documentKeyIndex",zD),c.createIndex("collectionGroupIndex",HD)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:JD}).createIndex("sequenceNumberIndex",YD,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:XD}).createIndex("documentKeyIndex",ZD,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Ih(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>q.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>q.forEach(a,l=>{Ve(l.userId===i.userId);const c=Wo(this.serializer,l);return TE(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new wt(o),c=function(f){return[0,hr(f)]}(l);i.push(t.get(c).next(d=>d?q.resolve():(f=>t.put({targetId:0,path:hr(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>q.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:QD});const r=t.store("collectionParents"),s=new Fg,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:hr(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new wt(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const d=Is(a);return i(d.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=Cu(s),o=xE(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new Ae(wt.fromString(f.document.name).popFirst(5)):f.noDocument?Ae.fromSegments(f.noDocument.path):f.unknownDocument?Ae.fromSegments(f.unknownDocument.path):Ce()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>q.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=kE(this.serializer),i=new jg(pf.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let d=(c=a.get(l.userId))!==null&&c!==void 0?c:ot();Wo(this.serializer,l).keys().forEach(f=>d=d.add(f)),a.set(l.userId,d)}),q.forEach(a,(l,c)=>{const d=new qn(c),f=hf.lt(this.serializer,d),g=i.getIndexManager(d),v=ff.lt(d,this.serializer,g,i.referenceDelegate);return new DE(s,v,f,g).recalculateAndSaveOverlaysForDocumentKeys(new hm(t,Ar.oe),l).next()})})}}function H_(n){n.createObjectStore("targetDocuments",{keyPath:GD}).createIndex("documentTargetsIndex",WD,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",KD,{unique:!0}),n.createObjectStore("targetGlobal")}const kp="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Bg{constructor(e,t,r,s,i,o,a,l,c,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!Bg.D())throw new pe(W.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new sO(this,s),this.Ai=t+"main",this.serializer=new wE(l),this.Ri=new Ps(this.Ai,this.hi,new gO(this.serializer)),this.$r=new GN,this.Ur=new tO(this.referenceDelegate,this.serializer),this.remoteDocumentCache=kE(this.serializer),this.Gr=new KN,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&En("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new pe(W.FAILED_PRECONDITION,kp);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Ar(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Cd(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(_o(e))return fe("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return fe("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return bu(e).get("owner").next(t=>q.resolve(this.vi(t)))}Ci(e){return Cd(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=Ln(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return q.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?q.resolve(!0):bu(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new pe(W.FAILED_PRECONDITION,kp);return!1}}return!(!this.networkEnabled||!this.inForeground)||Cd(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&fe("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new hm(e,Ar.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Cd(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return ff.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new eO(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return hf.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){fe("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?iN:l===16?sN:l===15?Ag:l===14?AI:l===13?TI:l===12?rN:l===11?EI:void Ce()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new hm(a,this.Qr?this.Qr.next():Ar.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw En(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new pe(W.FAILED_PRECONDITION,_I);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return bu(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new pe(W.FAILED_PRECONDITION,kp)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return bu(e).put("owner",t)}static D(){return Ps.D()}bi(e){const t=bu(e);return t.get("owner").next(r=>this.vi(r)?(fe("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):q.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(En(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;Px()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return fe("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return En("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){En("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function bu(n){return Ln(n,"owner")}function Cd(n){return Ln(n,"clientMetadata")}function qg(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zg{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=ot(),s=ot();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new zg(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vO{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NE{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Px()?8:wI(Mn())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new vO;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(el()<=_t.DEBUG&&fe("QueryEngine","SDK will not create cache indexes for query:",tl(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),q.resolve()):(el()<=_t.DEBUG&&fe("QueryEngine","Query:",tl(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(el()<=_t.DEBUG&&fe("QueryEngine","The SDK decides to create cache indexes for query:",tl(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,fr(t))):q.resolve())}Yi(e,t){if(v_(t))return q.resolve(null);let r=fr(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=_h(t,null,"F"),r=fr(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=ot(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,_h(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return v_(t)||s.isEqual($e.min())?q.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?q.resolve(null):(el()<=_t.DEBUG&&fe("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),tl(t)),this.rs(e,o,t,vI(s,-1)).next(a=>a))})}ts(e,t){let r=new zt(HI(e));return t.forEach((s,i)=>{Mc(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return el()<=_t.DEBUG&&fe("QueryEngine","Using full collection scan to execute query:",tl(t)),this.Ji.getDocumentsMatchingQuery(e,t,jr.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yO{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Zt(Xe),this._s=new mi(i=>da(i),Oc),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new DE(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function OE(n,e,t,r){return new yO(n,e,t,r)}async function VE(n,e){const t=Te(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=ot();for(const c of s){o.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}for(const c of i){a.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function _O(n,e){const t=Te(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,d){const f=c.batch,g=f.keys();let v=q.resolve();return g.forEach(x=>{v=v.next(()=>d.getEntry(l,x)).next(w=>{const I=c.docVersions.get(x);Ve(I!==null),w.version.compareTo(I)<0&&(f.applyToRemoteDocument(w,c),w.isValidDocument()&&(w.setReadTime(c.commitVersion),d.addEntry(w)))})}),v.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=ot();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function ME(n){const e=Te(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function bO(n,e){const t=Te(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((d,f)=>{const g=s.get(f);if(!g)return;a.push(t.Ur.removeMatchingKeys(i,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,d.addedDocuments,f)));let v=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?v=v.withResumeToken(vn.EMPTY_BYTE_STRING,$e.min()).withLastLimboFreeSnapshotVersion($e.min()):d.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(d.resumeToken,r)),s=s.insert(f,v),function(w,I,L){return w.resumeToken.approximateByteSize()===0||I.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8?!0:L.addedDocuments.size+L.modifiedDocuments.size+L.removedDocuments.size>0}(g,v,d)&&a.push(t.Ur.updateTargetData(i,v))});let l=Pr(),c=ot();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),a.push(LE(i,o,e.documentUpdates).next(d=>{l=d.Ps,c=d.Is})),!r.isEqual($e.min())){const d=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(d)}return q.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function LE(n,e,t){let r=ot(),s=ot();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Pr();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual($e.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):fe("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function wO(n,e){const t=Te(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Cl(n,e){const t=Te(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,q.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new Qs(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function kl(n,e,t){const r=Te(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!_o(o))throw o;fe("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Th(n,e,t){const r=Te(n);let s=$e.min(),i=ot();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,d){const f=Te(l),g=f._s.get(d);return g!==void 0?q.resolve(f.os.get(g)):f.Ur.getTargetData(c,d)}(r,o,fr(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:$e.min(),t?i:ot())).next(a=>(UE(r,zI(e),a),{documents:a,Ts:i})))}function $E(n,e){const t=Te(n),r=Te(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function FE(n,e){const t=Te(n),r=t.us.get(e)||$e.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,vI(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(UE(t,e,s),s))}function UE(n,e,t){let r=n.us.get(e)||$e.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function xO(n,e,t,r){const s=Te(n);let i=ot(),o=Pr();for(const c of t){const d=e.Es(c.metadata.name);c.document&&(i=i.add(d));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(d,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await Cl(s,function(d){return fr(ql(wt.fromString(`__bundle__/docs/${d}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>LE(c,a,o).next(d=>(a.apply(c),d)).next(d=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,d.Ps,d.Is)).next(()=>d.Ps)))}async function IO(n,e,t=ot()){const r=await Cl(n,fr(Lg(e.bundledQuery))),s=Te(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=Sn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(vn.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function K_(n,e){return`firestore_clients_${n}_${e}`}function G_(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Dp(n,e){return`firestore_targets_${n}_${e}`}class Ah{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new pe(s.error.code,s.error.message))),o?new Ah(e,t,s.state,i):(En("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Hu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new pe(r.error.code,r.error.message))),i?new Hu(e,r.state,s):(En("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Sh{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Rg();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=xI(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Sh(e,i):(En("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Hg{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Hg(t.clientId,t.onlineState):(En("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Am{constructor(){this.activeTargetIds=Rg()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Np{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Zt(Xe),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=K_(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Am),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(K_(this.persistenceKey,r));if(s){const i=Sh.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Dp(this.persistenceKey,e));if(s){const i=Hu.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Dp(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return fe("SharedClientState","READ",e,t),t}setItem(e,t){fe("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){fe("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(fe("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void En("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=Ar.oe;if(i!=null)try{const a=JSON.parse(i);Ve(typeof a=="number"),o=a}catch(a){En("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Ar.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new Ah(this.currentUser,e,t,r),i=G_(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=G_(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Dp(this.persistenceKey,e),i=new Hu(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Sh.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Ah.Rs(new qn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return Hu.Rs(s,t)}Ls(e){return Hg.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);fe("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Rg();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class jE{constructor(){this.so=new Am,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Am,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EO{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W_{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){fe("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){fe("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kd=null;function Op(){return kd===null?kd=function(){return 268435456+Math.round(2147483648*Math.random())}():kd++,"0x"+kd.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TO={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AO{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ir="WebChannelConnection";class SO extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=Op(),l=this.xo(t,r.toUriEncodedString());fe("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(d=>(fe("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw Xr("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",l,"request:",s),d})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Bl}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=TO[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Op();return new Promise((o,a)=>{const l=new lI;l.setWithCredentials(!0),l.listenOnce(uI.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Hd.NO_ERROR:const d=l.getResponseJson();fe(ir,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(d)),o(d);break;case Hd.TIMEOUT:fe(ir,`RPC '${e}' ${i} timed out`),a(new pe(W.DEADLINE_EXCEEDED,"Request time out"));break;case Hd.HTTP_ERROR:const f=l.getStatus();if(fe(ir,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const v=g==null?void 0:g.error;if(v&&v.status&&v.message){const x=function(I){const L=I.toLowerCase().replace(/_/g,"-");return Object.values(W).indexOf(L)>=0?L:W.UNKNOWN}(v.status);a(new pe(x,v.message))}else a(new pe(W.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new pe(W.UNAVAILABLE,"Connection failed."));break;default:Ce()}}finally{fe(ir,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);fe(ir,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=Op(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=hI(),a=dI(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=i.join("");fe(ir,`Creating RPC '${e}' stream ${s}: ${d}`,l);const f=o.createWebChannel(d,l);let g=!1,v=!1;const x=new AO({Io:I=>{v?fe(ir,`Not sending because RPC '${e}' stream ${s} is closed:`,I):(g||(fe(ir,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),fe(ir,`RPC '${e}' stream ${s} sending:`,I),f.send(I))},To:()=>f.close()}),w=(I,L,$)=>{I.listen(L,U=>{try{$(U)}catch(z){setTimeout(()=>{throw z},0)}})};return w(f,Su.EventType.OPEN,()=>{v||(fe(ir,`RPC '${e}' stream ${s} transport opened.`),x.yo())}),w(f,Su.EventType.CLOSE,()=>{v||(v=!0,fe(ir,`RPC '${e}' stream ${s} transport closed`),x.So())}),w(f,Su.EventType.ERROR,I=>{v||(v=!0,Xr(ir,`RPC '${e}' stream ${s} transport errored:`,I),x.So(new pe(W.UNAVAILABLE,"The operation could not be completed")))}),w(f,Su.EventType.MESSAGE,I=>{var L;if(!v){const $=I.data[0];Ve(!!$);const U=$,z=U.error||((L=U[0])===null||L===void 0?void 0:L.error);if(z){fe(ir,`RPC '${e}' stream ${s} received error:`,z);const le=z.status;let Z=function(E){const D=Cn[E];if(D!==void 0)return iE(D)}(le),A=z.message;Z===void 0&&(Z=W.INTERNAL,A="Unknown error status: "+le+" with message "+z.message),v=!0,x.So(new pe(Z,A)),f.close()}else fe(ir,`RPC '${e}' stream ${s} received:`,$),x.bo($)}}),w(a,cI.STAT_EVENT,I=>{I.stat===cm.PROXY?fe(ir,`RPC '${e}' stream ${s} detected buffering proxy`):I.stat===cm.NOPROXY&&fe(ir,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{x.wo()},0),x}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BE(){return typeof window<"u"?window:null}function Xd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uc(n){return new VN(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kg{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&fe("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qE{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Kg(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===W.RESOURCE_EXHAUSTED?(En(t.toString()),En("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===W.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new pe(W.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return fe("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(fe("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class PO extends qE{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=$N(this.serializer,e),r=function(i){if(!("targetChange"in i))return $e.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?$e.min():o.readTime?Sn(o.readTime):$e.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=wm(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=vh(l)?{documents:mE(i,l)}:{query:df(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=uE(i,o.resumeToken);const c=_m(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo($e.min())>0){a.readTime=Rl(i,o.snapshotVersion.toTimestamp());const c=_m(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=UN(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=wm(this.serializer),t.removeTarget=e,this.a_(t)}}class RO extends qE{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Ve(!!e.streamToken),this.lastStreamToken=e.streamToken,Ve(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Ve(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=FN(e.writeResults,e.commitTime),r=Sn(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=wm(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>yc(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CO extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new pe(W.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,bm(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===W.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new pe(W.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,bm(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===W.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new pe(W.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class kO{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(En(t),this.D_=!1):fe("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DO{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{wo(this)&&(fe("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=Te(l);c.L_.add(4),await Kl(c),c.q_.set("Unknown"),c.L_.delete(4),await jc(c)}(this))})}),this.q_=new kO(r,s)}}async function jc(n){if(wo(n))for(const e of n.B_)await e(!0)}async function Kl(n){for(const e of n.B_)await e(!1)}function mf(n,e){const t=Te(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Qg(t)?Wg(t):Wl(t).r_()&&Gg(t,e))}function Dl(n,e){const t=Te(n),r=Wl(t);t.N_.delete(e),r.r_()&&zE(t,e),t.N_.size===0&&(r.r_()?r.o_():wo(t)&&t.q_.set("Unknown"))}function Gg(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($e.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Wl(n).A_(e)}function zE(n,e){n.Q_.xe(e),Wl(n).R_(e)}function Wg(n){n.Q_=new kN({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Wl(n).start(),n.q_.v_()}function Qg(n){return wo(n)&&!Wl(n).n_()&&n.N_.size>0}function wo(n){return Te(n).L_.size===0}function HE(n){n.Q_=void 0}async function NO(n){n.q_.set("Online")}async function OO(n){n.N_.forEach((e,t)=>{Gg(n,e)})}async function VO(n,e){HE(n),Qg(n)?(n.q_.M_(e),Wg(n)):n.q_.set("Unknown")}async function MO(n,e,t){if(n.q_.set("Online"),e instanceof lE&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){fe("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Ph(n,r)}else if(e instanceof Yd?n.Q_.Ke(e):e instanceof aE?n.Q_.He(e):n.Q_.We(e),!t.isEqual($e.min()))try{const r=await ME(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.N_.get(c);d&&i.N_.set(c,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const d=i.N_.get(l);if(!d)return;i.N_.set(l,d.withResumeToken(vn.EMPTY_BYTE_STRING,d.snapshotVersion)),zE(i,l);const f=new Qs(d.target,l,c,d.sequenceNumber);Gg(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){fe("RemoteStore","Failed to raise snapshot:",r),await Ph(n,r)}}async function Ph(n,e,t){if(!_o(e))throw e;n.L_.add(1),await Kl(n),n.q_.set("Offline"),t||(t=()=>ME(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{fe("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await jc(n)})}function KE(n,e){return e().catch(t=>Ph(n,t,e))}async function Gl(n){const e=Te(n),t=ho(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;LO(e);)try{const s=await wO(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,$O(e,s)}catch(s){await Ph(e,s)}GE(e)&&WE(e)}function LO(n){return wo(n)&&n.O_.length<10}function $O(n,e){n.O_.push(e);const t=ho(n);t.r_()&&t.V_&&t.m_(e.mutations)}function GE(n){return wo(n)&&!ho(n).n_()&&n.O_.length>0}function WE(n){ho(n).start()}async function FO(n){ho(n).p_()}async function UO(n){const e=ho(n);for(const t of n.O_)e.m_(t.mutations)}async function jO(n,e,t){const r=n.O_.shift(),s=Ng.from(r,e,t);await KE(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Gl(n)}async function BO(n,e){e&&ho(n).V_&&await async function(r,s){if(function(o){return sE(o)&&o!==W.ABORTED}(s.code)){const i=r.O_.shift();ho(r).s_(),await KE(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Gl(r)}}(n,e),GE(n)&&WE(n)}async function Q_(n,e){const t=Te(n);t.asyncQueue.verifyOperationInProgress(),fe("RemoteStore","RemoteStore received new credentials");const r=wo(t);t.L_.add(3),await Kl(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await jc(t)}async function Sm(n,e){const t=Te(n);e?(t.L_.delete(2),await jc(t)):e||(t.L_.add(2),await Kl(t),t.q_.set("Unknown"))}function Wl(n){return n.K_||(n.K_=function(t,r,s){const i=Te(t);return i.w_(),new PO(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:NO.bind(null,n),Ro:OO.bind(null,n),mo:VO.bind(null,n),d_:MO.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Qg(n)?Wg(n):n.q_.set("Unknown")):(await n.K_.stop(),HE(n))})),n.K_}function ho(n){return n.U_||(n.U_=function(t,r,s){const i=Te(t);return i.w_(),new RO(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:FO.bind(null,n),mo:BO.bind(null,n),f_:UO.bind(null,n),g_:jO.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await Gl(n)):(await n.U_.stop(),n.O_.length>0&&(fe("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jg{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Hn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Jg(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new pe(W.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ql(n,e){if(En("AsyncQueue",`${e}: ${n}`),_o(n))return new pe(W.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fl{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Ae.comparator(t.key,r.key):(t,r)=>Ae.comparator(t.key,r.key),this.keyedMap=Pu(),this.sortedSet=new Zt(this.comparator)}static emptySet(e){return new fl(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof fl)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new fl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J_{constructor(){this.W_=new Zt(Ae.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Ce():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Nl{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Nl(e,t,fl.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Vc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qO{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class zO{constructor(){this.queries=Y_(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=Te(t),i=s.queries;s.queries=Y_(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new pe(W.ABORTED,"Firestore shutting down"))}}function Y_(){return new mi(n=>qI(n),Vc)}async function Yg(n,e){const t=Te(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new qO,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Ql(o,`Initialization of query '${tl(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Zg(t)}async function Xg(n,e){const t=Te(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function HO(n,e){const t=Te(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&Zg(t)}function KO(n,e,t){const r=Te(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function Zg(n){n.Y_.forEach(e=>{e.next()})}var Pm,X_;(X_=Pm||(Pm={})).ea="default",X_.Cache="cache";class ev{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Nl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Nl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Pm.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GO{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z_{constructor(e){this.serializer=e}Es(e){return Rs(this.serializer,e)}ds(e){return e.metadata.exists?pE(this.serializer,e.document,!1):tn.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Sn(e)}}class WO{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=QE(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=wt.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new Z_(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||ot()).add(i);t.set(o,a)}}return t}async complete(){const e=await xO(this.localStore,new Z_(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await IO(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function QE(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JE{constructor(e){this.key=e}}class YE{constructor(e){this.key=e}}class XE{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ot(),this.mutatedKeys=ot(),this.Aa=HI(e),this.Ra=new fl(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new J_,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,f)=>{const g=s.get(d),v=Mc(this.query,f)?f:null,x=!!g&&this.mutatedKeys.has(g.key),w=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let I=!1;g&&v?g.data.isEqual(v.data)?x!==w&&(r.track({type:3,doc:v}),I=!0):this.ga(g,v)||(r.track({type:2,doc:v}),I=!0,(l&&this.Aa(v,l)>0||c&&this.Aa(v,c)<0)&&(a=!0)):!g&&v?(r.track({type:0,doc:v}),I=!0):g&&!v&&(r.track({type:1,doc:g}),I=!0,(l||c)&&(a=!0)),I&&(v?(o=o.add(v),i=w?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((d,f)=>function(v,x){const w=I=>{switch(I){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ce()}};return w(v)-w(x)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new Nl(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new J_,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=ot(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new YE(r))}),this.da.forEach(r=>{e.has(r)||t.push(new JE(r))}),t}ba(e){this.Ta=e.Ts,this.da=ot();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Nl.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class QO{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class JO{constructor(e){this.key=e,this.va=!1}}class YO{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new mi(a=>qI(a),Vc),this.Ma=new Map,this.xa=new Set,this.Oa=new Zt(Ae.comparator),this.Na=new Map,this.La=new Ug,this.Ba={},this.ka=new Map,this.qa=ga.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function XO(n,e,t=!0){const r=gf(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await ZE(r,e,t,!0),s}async function ZO(n,e){const t=gf(n);await ZE(t,e,!0,!1)}async function ZE(n,e,t,r){const s=await Cl(n.localStore,fr(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await tv(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&mf(n.remoteStore,s),a}async function tv(n,e,t,r,s){n.Ka=(f,g,v)=>async function(w,I,L,$){let U=I.view.ma(L);U.ns&&(U=await Th(w.localStore,I.query,!1).then(({documents:A})=>I.view.ma(A,U)));const z=$&&$.targetChanges.get(I.targetId),le=$&&$.targetMismatches.get(I.targetId)!=null,Z=I.view.applyChanges(U,w.isPrimaryClient,z,le);return Rm(w,I.targetId,Z.wa),Z.snapshot}(n,f,g,v);const i=await Th(n.localStore,e,!0),o=new XE(e,i.Ts),a=o.ma(i.documents),l=Fc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);Rm(n,t,c.wa);const d=new QO(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function eV(n,e,t){const r=Te(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Vc(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await kl(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Dl(r.remoteStore,s.targetId),Ol(r,s.targetId)}).catch(yo)):(Ol(r,s.targetId),await kl(r.localStore,s.targetId,!0))}async function tV(n,e){const t=Te(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Dl(t.remoteStore,r.targetId))}async function nV(n,e,t){const r=iv(n);try{const s=await function(o,a){const l=Te(o),c=hn.now(),d=a.reduce((v,x)=>v.add(x.key),ot());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",v=>{let x=Pr(),w=ot();return l.cs.getEntries(v,d).next(I=>{x=I,x.forEach((L,$)=>{$.isValidDocument()||(w=w.add(L))})}).next(()=>l.localDocuments.getOverlayedDocuments(v,x)).next(I=>{f=I;const L=[];for(const $ of a){const U=PN($,f.get($.key).overlayedDocument);U!=null&&L.push(new gi($.key,U,DI(U.value.mapValue),an.exists(!0)))}return l.mutationQueue.addMutationBatch(v,c,L,a)}).next(I=>{g=I;const L=I.applyToLocalDocumentSet(f,w);return l.documentOverlayCache.saveOverlays(v,I.batchId,L)})}).then(()=>({batchId:g.batchId,changes:GI(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new Zt(Xe)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await vi(r,s.changes),await Gl(r.remoteStore)}catch(s){const i=Ql(s,"Failed to persist write");t.reject(i)}}async function eT(n,e){const t=Te(n);try{const r=await bO(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Ve(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Ve(o.va):s.removedDocuments.size>0&&(Ve(o.va),o.va=!1))}),await vi(t,r,e)}catch(r){await yo(r)}}function eb(n,e,t){const r=Te(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Te(o);l.onlineState=a;let c=!1;l.queries.forEach((d,f)=>{for(const g of f.j_)g.Z_(a)&&(c=!0)}),c&&Zg(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function rV(n,e,t){const r=Te(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Zt(Ae.comparator);o=o.insert(i,tn.newNoDocument(i,$e.min()));const a=ot().add(i),l=new $c($e.min(),new Map,new Zt(Xe),o,a);await eT(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),sv(r)}else await kl(r.localStore,e,!1).then(()=>Ol(r,e,t)).catch(yo)}async function sV(n,e){const t=Te(n),r=e.batch.batchId;try{const s=await _O(t.localStore,e);rv(t,r,null),nv(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await vi(t,s)}catch(s){await yo(s)}}async function iV(n,e,t){const r=Te(n);try{const s=await function(o,a){const l=Te(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(Ve(f!==null),d=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>l.localDocuments.getDocuments(c,d))})}(r.localStore,e);rv(r,e,t),nv(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await vi(r,s)}catch(s){await yo(s)}}async function oV(n,e){const t=Te(n);wo(t.remoteStore)||fe("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=Te(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Ql(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function nv(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function rv(n,e,t){const r=Te(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Ol(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||tT(n,r)})}function tT(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Dl(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),sv(n))}function Rm(n,e,t){for(const r of t)r instanceof JE?(n.La.addReference(r.key,e),aV(n,r)):r instanceof YE?(fe("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||tT(n,r.key)):Ce()}function aV(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(fe("SyncEngine","New document in limbo: "+t),n.xa.add(r),sv(n))}function sv(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Ae(wt.fromString(e)),r=n.qa.next();n.Na.set(r,new JO(t)),n.Oa=n.Oa.insert(t,r),mf(n.remoteStore,new Qs(fr(ql(t.path)),r,"TargetPurposeLimboResolution",Ar.oe))}}async function vi(n,e,t){const r=Te(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var d;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(d=t==null?void 0:t.targetChanges.get(l.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=zg.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const d=Te(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>q.forEach(c,g=>q.forEach(g.$i,v=>d.persistence.referenceDelegate.addReference(f,g.targetId,v)).next(()=>q.forEach(g.Ui,v=>d.persistence.referenceDelegate.removeReference(f,g.targetId,v)))))}catch(f){if(!_o(f))throw f;fe("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const g=f.targetId;if(!f.fromCache){const v=d.os.get(g),x=v.snapshotVersion,w=v.withLastLimboFreeSnapshotVersion(x);d.os=d.os.insert(g,w)}}}(r.localStore,i))}async function lV(n,e){const t=Te(n);if(!t.currentUser.isEqual(e)){fe("SyncEngine","User change. New user:",e.toKey());const r=await VE(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new pe(W.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await vi(t,r.hs)}}function uV(n,e){const t=Te(n),r=t.Na.get(e);if(r&&r.va)return ot().add(r.key);{let s=ot();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function cV(n,e){const t=Te(n),r=await Th(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&Rm(t,e.targetId,s.wa),s}async function dV(n,e){const t=Te(n);return FE(t.localStore,e).then(r=>vi(t,r))}async function hV(n,e,t,r){const s=Te(n),i=await function(a,l){const c=Te(a),d=Te(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,l).next(g=>g?c.localDocuments.getDocuments(f,g):q.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Gl(s.remoteStore):t==="acknowledged"||t==="rejected"?(rv(s,e,r||null),nv(s,e),function(a,l){Te(Te(a).mutationQueue).On(l)}(s.localStore,e)):Ce(),await vi(s,i)):fe("SyncEngine","Cannot apply mutation batch with id: "+e)}async function fV(n,e){const t=Te(n);if(gf(t),iv(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await tb(t,r.toArray());t.Qa=!0,await Sm(t.remoteStore,!0);for(const i of s)mf(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Ol(t,o),kl(t.localStore,o,!0))),Dl(t.remoteStore,o)}),await s,await tb(t,r),function(o){const a=Te(o);a.Na.forEach((l,c)=>{Dl(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Zt(Ae.comparator)}(t),t.Qa=!1,await Sm(t.remoteStore,!1)}}async function tb(n,e,t){const r=Te(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await Cl(r.localStore,fr(l[0]));for(const c of l){const d=r.Fa.get(c),f=await cV(r,d);f.snapshot&&i.push(f.snapshot)}}else{const c=await $E(r.localStore,o);a=await Cl(r.localStore,c),await tv(r,nT(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function nT(n){return UI(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function pV(n){return function(t){return Te(Te(t).persistence).Qi()}(Te(n).localStore)}async function mV(n,e,t,r){const s=Te(n);if(s.Qa)return void fe("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await FE(s.localStore,zI(i[0])),a=$c.createSynthesizedRemoteEventForCurrentChange(e,t==="current",vn.EMPTY_BYTE_STRING);await vi(s,o,a);break}case"rejected":await kl(s.localStore,e,!0),Ol(s,e,r);break;default:Ce()}}async function gV(n,e,t){const r=gf(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){fe("SyncEngine","Adding an already active target "+s);continue}const i=await $E(r.localStore,s),o=await Cl(r.localStore,i);await tv(r,nT(i),o.targetId,!1,o.resumeToken),mf(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await kl(r.localStore,s,!1).then(()=>{Dl(r.remoteStore,s),Ol(r,s)}).catch(yo)}}function gf(n){const e=Te(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=eT.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=uV.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=rV.bind(null,e),e.Ca.d_=HO.bind(null,e.eventManager),e.Ca.$a=KO.bind(null,e.eventManager),e}function iv(n){const e=Te(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=sV.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=iV.bind(null,e),e}function vV(n,e,t){const r=Te(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(v,x){const w=Te(v),I=Sn(x.createTime);return w.persistence.runTransaction("hasNewerBundle","readonly",L=>w.Gr.getBundleMetadata(L,x.id)).then(L=>!!L&&L.createTime.compareTo(I)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(v){return{taskState:"Success",documentsLoaded:v.totalDocuments,bytesLoaded:v.totalBytes,totalDocuments:v.totalDocuments,totalBytes:v.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(QE(l));const c=new WO(l,i.localStore,o.serializer);let d=await o.Ua();for(;d;){const g=await c.la(d);g&&a._updateProgress(g),d=await o.Ua()}const f=await c.complete();return await vi(i,f.Ia,void 0),await function(v,x){const w=Te(v);return w.persistence.runTransaction("Save bundle","readwrite",I=>w.Gr.saveBundleMetadata(I,x))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return Xr("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class fo{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Uc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return OE(this.persistence,new NE,e.initialUser,this.serializer)}Ga(e){return new jg(pf.Zr,this.serializer)}Wa(e){return new jE}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}fo.provider={build:()=>new fo};class yV extends fo{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Ve(this.persistence.referenceDelegate instanceof Eh);const r=this.persistence.referenceDelegate.garbageCollector;return new PE(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?ar.withCacheSize(this.cacheSizeBytes):ar.DEFAULT;return new jg(r=>Eh.Zr(r,t),this.serializer)}}class ov extends fo{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await iv(this.Ja.syncEngine),await Gl(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return OE(this.persistence,new NE,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new PE(r,e.asyncQueue,t)}Ha(e,t){const r=new UD(t,this.persistence);return new FD(e.asyncQueue,r)}Ga(e){const t=qg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?ar.withCacheSize(this.cacheSizeBytes):ar.DEFAULT;return new Bg(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,BE(),Xd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new jE}}class rT extends ov{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Np&&(this.sharedClientState.syncEngine={no:hV.bind(null,t),ro:mV.bind(null,t),io:gV.bind(null,t),Qi:pV.bind(null,t),eo:dV.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await fV(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=BE();if(!Np.D(t))throw new pe(W.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=qg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Np(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class po{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>eb(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=lV.bind(null,this.syncEngine),await Sm(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new zO}()}createDatastore(e){const t=Uc(e.databaseInfo.databaseId),r=function(i){return new SO(i)}(e.databaseInfo);return function(i,o,a,l){return new CO(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new DO(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>eb(this.syncEngine,t,0),function(){return W_.D()?new W_:new EO}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,d){const f=new YO(s,i,o,a,l,c);return d&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Te(s);fe("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Kl(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}po.provider={build:()=>new po};function nb(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vf{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):En("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _V{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new Hn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new GO(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bV{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new pe(W.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=Te(s),a={documents:i.map(f=>vc(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,wt.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const g=LN(o.serializer,f);c.set(g.key.toString(),g)});const d=[];return i.forEach(f=>{const g=c.get(f.toString());Ve(!!g),d.push(g)}),d}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Hl(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=Ae.fromPath(r);this.mutations.push(new kg(s,this.precondition(s)))}),await async function(r,s){const i=Te(r),o={writes:s.map(a=>yc(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,wt.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Ce();t=$e.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new pe(W.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual($e.min())?an.exists(!1):an.updateTime(t):an.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual($e.min()))throw new pe(W.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return an.updateTime(t)}return an.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wV{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Kg(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new bV(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!Nc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!sE(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xV{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=qn.UNAUTHENTICATED,this.clientId=mI.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{fe("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(fe("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Hn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Ql(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Vp(n,e){n.asyncQueue.verifyOperationInProgress(),fe("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await VE(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function rb(n,e){n.asyncQueue.verifyOperationInProgress();const t=await av(n);fe("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Q_(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Q_(e.remoteStore,s)),n._onlineComponents=e}async function av(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){fe("FirestoreClient","Using user provided OfflineComponentProvider");try{await Vp(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===W.FAILED_PRECONDITION||s.code===W.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Xr("Error using user provided cache. Falling back to memory cache: "+t),await Vp(n,new fo)}}else fe("FirestoreClient","Using default OfflineComponentProvider"),await Vp(n,new fo);return n._offlineComponents}async function yf(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(fe("FirestoreClient","Using user provided OnlineComponentProvider"),await rb(n,n._uninitializedComponentsProvider._online)):(fe("FirestoreClient","Using default OnlineComponentProvider"),await rb(n,new po))),n._onlineComponents}function sT(n){return av(n).then(e=>e.persistence)}function Jl(n){return av(n).then(e=>e.localStore)}function iT(n){return yf(n).then(e=>e.remoteStore)}function lv(n){return yf(n).then(e=>e.syncEngine)}function oT(n){return yf(n).then(e=>e.datastore)}async function Vl(n){const e=await yf(n),t=e.eventManager;return t.onListen=XO.bind(null,e.syncEngine),t.onUnlisten=eV.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=ZO.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=tV.bind(null,e.syncEngine),t}function IV(n){return n.asyncQueue.enqueue(async()=>{const e=await sT(n),t=await iT(n);return e.setNetworkEnabled(!0),function(s){const i=Te(s);return i.L_.delete(0),jc(i)}(t)})}function EV(n){return n.asyncQueue.enqueue(async()=>{const e=await sT(n),t=await iT(n);return e.setNetworkEnabled(!1),async function(s){const i=Te(s);i.L_.add(0),await Kl(i),i.q_.set("Offline")}(t)})}function TV(n,e){const t=new Hn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,d){const f=Te(c);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,d))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new pe(W.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Ql(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Jl(n),e,t)),t.promise}function aT(n,e,t={}){const r=new Hn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new vf({next:g=>{d.Za(),o.enqueueAndForget(()=>Xg(i,f));const v=g.docs.has(a);!v&&g.fromCache?c.reject(new pe(W.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&g.fromCache&&l&&l.source==="server"?c.reject(new pe(W.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new ev(ql(a.path),d,{includeMetadataChanges:!0,_a:!0});return Yg(i,f)}(await Vl(n),n.asyncQueue,e,t,r)),r.promise}function AV(n,e){const t=new Hn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await Th(s,i,!0),l=new XE(i,a.Ts),c=l.ma(a.documents),d=l.applyChanges(c,!1);o.resolve(d.snapshot)}catch(a){const l=Ql(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Jl(n),e,t)),t.promise}function lT(n,e,t={}){const r=new Hn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new vf({next:g=>{d.Za(),o.enqueueAndForget(()=>Xg(i,f)),g.fromCache&&l.source==="server"?c.reject(new pe(W.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new ev(a,d,{includeMetadataChanges:!0,_a:!0});return Yg(i,f)}(await Vl(n),n.asyncQueue,e,t,r)),r.promise}function SV(n,e,t){const r=new Hn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await oT(n);r.resolve(async function(o,a,l){var c;const d=Te(o),{request:f,ut:g,parent:v}=gE(d.serializer,jI(a),l);d.connection.Fo||delete f.parent;const x=(await d.Lo("RunAggregationQuery",d.serializer.databaseId,v,f,1)).filter(I=>!!I.result);Ve(x.length===1);const w=(c=x[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(w).reduce((I,L)=>(I[g[L]]=w[L],I),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function PV(n,e){const t=new vf(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){Te(s).Y_.add(i),i.next()}(await Vl(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){Te(s).Y_.delete(i)}(await Vl(n),t))}}function RV(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?oE().encode(o):o,function(d,f){return new _V(d,f)}(function(d,f){if(d instanceof Uint8Array)return nb(d,f);if(d instanceof ArrayBuffer)return nb(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,Uc(e));n.asyncQueue.enqueueAndForget(async()=>{vV(await lv(n),s,r)})}function CV(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=Te(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await Jl(n),e))}function kV(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=Te(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,g,v,x,w){f=[...f],g=[...g],f.sort(v),g.sort(v);const I=f.length,L=g.length;let $=0,U=0;for(;$<L&&U<I;){const z=v(f[U],g[$]);z<0?w(f[U++]):z>0?x(g[$++]):($++,U++)}for(;$<L;)x(g[$++]);for(;U<I;)w(f[U++])}(c,s,VD,d=>{a.push(o.addFieldIndex(l,d))},d=>{a.push(o.deleteFieldIndex(l,d))})).next(()=>q.waitFor(a)))}(await Jl(n),e))}function DV(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){Te(r).ss.zi=s}(await Jl(n),e))}function NV(n){return n.asyncQueue.enqueue(async()=>function(t){const r=Te(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Jl(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uT(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sb=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uv(n,e,t){if(!t)throw new pe(W.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function OV(n,e,t,r){if(e===!0&&r===!0)throw new pe(W.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ib(n){if(!Ae.isDocumentKey(n))throw new pe(W.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ob(n){if(Ae.isDocumentKey(n))throw new pe(W.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function _f(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ce()}function gt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new pe(W.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=_f(n);throw new pe(W.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function cT(n,e){if(e<=0)throw new pe(W.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ab{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new pe(W.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new pe(W.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}OV("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=uT((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new pe(W.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new pe(W.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new pe(W.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Bc{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ab({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new pe(W.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new pe(W.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ab(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new SD;switch(r.type){case"firstParty":return new kD(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new pe(W.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=sb.get(t);r&&(fe("ComponentProvider","Removing Datastore"),sb.delete(t),r.terminate())}(this),Promise.resolve()}}function VV(n,e,t,r={}){var s;const i=(n=gt(n,Bc))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Xr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=qn.MOCK_USER;else{a=Sx(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new pe(W.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new qn(c)}n._authCredentials=new PD(new fI(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new er(this.firestore,e,this._query)}}class Pn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Cs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Pn(this.firestore,e,this._key)}}class Cs extends er{constructor(e,t,r){super(e,t,ql(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Pn(this.firestore,null,new Ae(e))}withConverter(e){return new Cs(this.firestore,e,this._path)}}function tt(n,e,...t){if(n=Ne(n),uv("collection","path",e),n instanceof Bc){const r=wt.fromString(e,...t);return ob(r),new Cs(n,null,r)}{if(!(n instanceof Pn||n instanceof Cs))throw new pe(W.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(wt.fromString(e,...t));return ob(r),new Cs(n.firestore,null,r)}}function GK(n,e){if(n=gt(n,Bc),uv("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new pe(W.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new er(n,null,function(r){return new pi(wt.emptyPath(),r)}(e))}function _e(n,e,...t){if(n=Ne(n),arguments.length===1&&(e=mI.newId()),uv("doc","path",e),n instanceof Bc){const r=wt.fromString(e,...t);return ib(r),new Pn(n,null,new Ae(r))}{if(!(n instanceof Pn||n instanceof Cs))throw new pe(W.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(wt.fromString(e,...t));return ib(r),new Pn(n.firestore,n instanceof Cs?n.converter:null,new Ae(r))}}function WK(n,e){return n=Ne(n),e=Ne(e),(n instanceof Pn||n instanceof Cs)&&(e instanceof Pn||e instanceof Cs)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function dT(n,e){return n=Ne(n),e=Ne(e),n instanceof er&&e instanceof er&&n.firestore===e.firestore&&Vc(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lb{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Kg(this,"async_queue_retry"),this.Vu=()=>{const r=Xd();r&&fe("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Xd();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Xd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Hn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!_o(e))throw e;fe("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw En("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Jg.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&Ce()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function Cm(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class MV{constructor(){this._progressObserver={},this._taskCompletionResolver=new Hn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QK=-1;class Qt extends Bc{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new lb,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new lb(e),this._firestoreClient=void 0,await e}}}function JK(n,e,t){t||(t="(default)");const r=fi(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(oo(i,e))return s;throw new pe(W.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new pe(W.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new pe(W.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function LV(n,e){const t=typeof n=="object"?n:jl(),r=typeof n=="string"?n:e||"(default)",s=fi(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=Ex("firestore");i&&VV(s,...i)}return s}function fn(n){if(n._terminated)throw new pe(W.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||hT(n),n._firestoreClient}function hT(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,d){return new aN(a,l,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,uT(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new xV(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function $V(n,e){Xr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return fT(n,po.provider,{build:r=>new ov(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function YK(n){Xr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();fT(n,po.provider,{build:t=>new rT(t,e.cacheSizeBytes)})}function fT(n,e,t){if((n=gt(n,Qt))._firestoreClient||n._terminated)throw new pe(W.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new pe(W.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},hT(n)}function XK(n){if(n._initialized&&!n._terminated)throw new pe(W.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Hn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Ps.D())return Promise.resolve();const s=r+"main";await Ps.delete(s)}(qg(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function ZK(n){return function(t){const r=new Hn;return t.asyncQueue.enqueueAndForget(async()=>oV(await lv(t),r)),r.promise}(fn(n=gt(n,Qt)))}function eG(n){return IV(fn(n=gt(n,Qt)))}function tG(n){return EV(fn(n=gt(n,Qt)))}function nG(n){return zk(n.app,"firestore",n._databaseId.database),n._delete()}function rG(n,e){const t=fn(n=gt(n,Qt)),r=new MV;return RV(t,n._databaseId,e,r),r}function sG(n,e){return CV(fn(n=gt(n,Qt)),e).then(t=>t?new er(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _c{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class FV{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(e){this._byteString=e}static fromBase64String(e){try{return new va(vn.fromBase64String(e))}catch(t){throw new pe(W.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new va(vn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ia{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new pe(W.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new on(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function iG(){return new Ia("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cv{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new pe(W.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new pe(W.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Xe(this._lat,e._lat)||Xe(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bf{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UV=/^__.*__$/;class jV{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new gi(e,this.data,this.fieldMask,t,this.fieldTransforms):new zl(e,this.data,t,this.fieldTransforms)}}class pT{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new gi(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function mT(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ce()}}class wf{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new wf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Rh(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(mT(this.Cu)&&UV.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class BV{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Uc(e)}Qu(e,t,r,s=!1){return new wf({Cu:e,methodName:t,qu:r,path:on.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ta(n){const e=n._freezeSettings(),t=Uc(n._databaseId);return new BV(n._databaseId,!!e.ignoreUndefinedProperties,t)}function xf(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);vv("Data must be an object, but it was:",o,r);const a=yT(r,o);let l,c;if(i.merge)l=new Sr(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const f of i.mergeFields){const g=bc(e,f,t);if(!o.contains(g))throw new pe(W.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);bT(d,g)||d.push(g)}l=new Sr(d),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new jV(new Zn(a),l,c)}class qc extends Ea{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof qc}}function gT(n,e,t){return new wf({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class dv extends Ea{_toFieldTransform(e){return new Lc(e.path,new Sl)}isEqual(e){return e instanceof dv}}class hv extends Ea{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=gT(this,e,!0),r=this.Ku.map(i=>Aa(i,t)),s=new ha(r);return new Lc(e.path,s)}isEqual(e){return e instanceof hv&&oo(this.Ku,e.Ku)}}class fv extends Ea{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=gT(this,e,!0),r=this.Ku.map(i=>Aa(i,t)),s=new fa(r);return new Lc(e.path,s)}isEqual(e){return e instanceof fv&&oo(this.Ku,e.Ku)}}class pv extends Ea{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new Pl(e.serializer,JI(e.serializer,this.$u));return new Lc(e.path,t)}isEqual(e){return e instanceof pv&&this.$u===e.$u}}function mv(n,e,t,r){const s=n.Qu(1,e,t);vv("Data must be an object, but it was:",s,r);const i=[],o=Zn.empty();bo(r,(l,c)=>{const d=If(e,l,t);c=Ne(c);const f=s.Nu(d);if(c instanceof qc)i.push(d);else{const g=Aa(c,f);g!=null&&(i.push(d),o.set(d,g))}});const a=new Sr(i);return new pT(o,a,s.fieldTransforms)}function gv(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[bc(e,r,t)],l=[s];if(i.length%2!=0)throw new pe(W.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(bc(e,i[g])),l.push(i[g+1]);const c=[],d=Zn.empty();for(let g=a.length-1;g>=0;--g)if(!bT(c,a[g])){const v=a[g];let x=l[g];x=Ne(x);const w=o.Nu(v);if(x instanceof qc)c.push(v);else{const I=Aa(x,w);I!=null&&(c.push(v),d.set(v,I))}}const f=new Sr(c);return new pT(d,f,o.fieldTransforms)}function vT(n,e,t,r=!1){return Aa(t,n.Qu(r?4:3,e))}function Aa(n,e){if(_T(n=Ne(n)))return vv("Unsupported field value:",e,n),yT(n,e);if(n instanceof Ea)return function(r,s){if(!mT(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=Aa(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Ne(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return JI(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=hn.fromDate(r);return{timestampValue:Rl(s.serializer,i)}}if(r instanceof hn){const i=new hn(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Rl(s.serializer,i)}}if(r instanceof cv)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof va)return{bytesValue:uE(s.serializer,r._byteString)};if(r instanceof Pn){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Mg(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof bf)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Cg(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${_f(r)}`)}(n,e)}function yT(n,e){const t={};return PI(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):bo(n,(r,s)=>{const i=Aa(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function _T(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof hn||n instanceof cv||n instanceof va||n instanceof Pn||n instanceof Ea||n instanceof bf)}function vv(n,e,t){if(!_T(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=_f(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function bc(n,e,t){if((e=Ne(e))instanceof Ia)return e._internalPath;if(typeof e=="string")return If(n,e);throw Rh("Field path arguments must be of type string or ",n,!1,void 0,t)}const qV=new RegExp("[~\\*/\\[\\]]");function If(n,e,t){if(e.search(qV)>=0)throw Rh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ia(...e.split("."))._internalPath}catch{throw Rh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Rh(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new pe(W.INVALID_ARGUMENT,a+n+l)}function bT(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Pn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new zV(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ef("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class zV extends wc{data(){return super.data()}}function Ef(n,e){return typeof e=="string"?If(n,e):e instanceof Ia?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new pe(W.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class yv{}class zc extends yv{}function xc(n,e,...t){let r=[];e instanceof yv&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Yl).length,a=i.filter(l=>l instanceof Hc).length;if(o>1||o>0&&a>0)throw new pe(W.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Hc extends zc{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Hc(e,t,r)}_apply(e){const t=this._parse(e);return IT(e._query,t),new er(e.firestore,e.converter,ym(e._query,t))}_parse(e){const t=Ta(e.firestore);return function(i,o,a,l,c,d,f){let g;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new pe(W.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){cb(f,d);const v=[];for(const x of f)v.push(ub(l,i,x));g={arrayValue:{values:v}}}else g=ub(l,i,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||cb(f,d),g=vT(a,o,f,d==="in"||d==="not-in");return xt.create(c,d,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Ch(n,e,t){const r=e,s=Ef("where",n);return Hc._create(s,r,t)}class Yl extends yv{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Yl(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Bt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)IT(o,l),o=ym(o,l)}(e._query,t),new er(e.firestore,e.converter,ym(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function oG(...n){return n.forEach(e=>ET("or",e)),Yl._create("or",n)}function aG(...n){return n.forEach(e=>ET("and",e)),Yl._create("and",n)}class _v extends zc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new _v(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new pe(W.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new pe(W.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new gc(i,o)}(e._query,this._field,this._direction);return new er(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new pi(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function HV(n,e="asc"){const t=e,r=Ef("orderBy",n);return _v._create(r,t)}class Tf extends zc{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Tf(e,t,r)}_apply(e){return new er(e.firestore,e.converter,_h(e._query,this._limit,this._limitType))}}function lG(n){return cT("limit",n),Tf._create("limit",n,"F")}function uG(n){return cT("limitToLast",n),Tf._create("limitToLast",n,"L")}class Af extends zc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Af(e,t,r)}_apply(e){const t=xT(e,this.type,this._docOrFields,this._inclusive);return new er(e.firestore,e.converter,function(s,i){return new pi(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function cG(...n){return Af._create("startAt",n,!0)}function dG(...n){return Af._create("startAfter",n,!1)}class Sf extends zc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Sf(e,t,r)}_apply(e){const t=xT(e,this.type,this._docOrFields,this._inclusive);return new er(e.firestore,e.converter,function(s,i){return new pi(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function hG(...n){return Sf._create("endBefore",n,!1)}function fG(...n){return Sf._create("endAt",n,!0)}function xT(n,e,t,r){if(t[0]=Ne(t[0]),t[0]instanceof wc)return function(i,o,a,l,c){if(!l)throw new pe(W.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const d=[];for(const f of hl(i))if(f.field.isKeyField())d.push(ca(o,l.key));else{const g=l.data.field(f.field);if(of(g))throw new pe(W.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const v=f.field.canonicalString();throw new pe(W.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${v}' (used as the orderBy) does not exist.`)}d.push(g)}return new co(d,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Ta(n.firestore);return function(o,a,l,c,d,f){const g=o.explicitOrderBy;if(d.length>g.length)throw new pe(W.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const v=[];for(let x=0;x<d.length;x++){const w=d[x];if(g[x].field.isKeyField()){if(typeof w!="string")throw new pe(W.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof w}`);if(!Pg(o)&&w.indexOf("/")!==-1)throw new pe(W.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${w}' contains a slash.`);const I=o.path.child(wt.fromString(w));if(!Ae.isDocumentKey(I))throw new pe(W.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${I}' is not because it contains an odd number of segments.`);const L=new Ae(I);v.push(ca(a,L))}else{const I=vT(l,c,w);v.push(I)}}return new co(v,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function ub(n,e,t){if(typeof(t=Ne(t))=="string"){if(t==="")throw new pe(W.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Pg(e)&&t.indexOf("/")!==-1)throw new pe(W.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(wt.fromString(t));if(!Ae.isDocumentKey(r))throw new pe(W.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ca(n,new Ae(r))}if(t instanceof Pn)return ca(n,t._key);throw new pe(W.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${_f(t)}.`)}function cb(n,e){if(!Array.isArray(n)||n.length===0)throw new pe(W.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function IT(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new pe(W.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new pe(W.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function ET(n,e){if(!(e instanceof Hc||e instanceof Yl))throw new pe(W.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class TT{convertValue(e,t="none"){switch(lo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return sn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(li(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ce()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return bo(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>sn(o.doubleValue));return new bf(i)}convertGeoPoint(e){return new cv(sn(e.latitude),sn(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=af(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(fc(e));default:return null}}convertTimestamp(e){const t=ai(e);return new hn(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=wt.fromString(e);Ve(bE(r));const s=new ua(r.get(1),r.get(3)),i=new Ae(r.popFirst(5));return s.isEqual(t)||En(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pf(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class KV extends TT{constructor(e){super(),this.firestore=e}convertBytes(e){return new va(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pn(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pG(n){return new _c("sum",bc("sum",n))}function mG(n){return new _c("avg",bc("average",n))}function GV(){return new _c("count")}function gG(n,e){var t,r;return n instanceof _c&&e instanceof _c&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function vG(n,e){return dT(n.query,e.query)&&oo(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zo{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ml extends wc{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Zd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Ef("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Zd extends Ml{data(e={}){return super.data(e)}}class Ll{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Zo(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Zd(this._firestore,this._userDataWriter,r.key,r,new Zo(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new pe(W.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Zd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Zo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Zd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Zo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,d=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:WV(a.type),doc:l,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function WV(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ce()}}function yG(n,e){return n instanceof Ml&&e instanceof Ml?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ll&&e instanceof Ll&&n._firestore===e._firestore&&dT(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ht(n){n=gt(n,Pn);const e=gt(n.firestore,Qt);return aT(fn(e),n._key).then(t=>bv(e,n,t))}class xo extends TT{constructor(e){super(),this.firestore=e}convertBytes(e){return new va(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pn(this.firestore,null,t)}}function _G(n){n=gt(n,Pn);const e=gt(n.firestore,Qt),t=fn(e),r=new xo(e);return TV(t,n._key).then(s=>new Ml(e,r,n._key,s,new Zo(s!==null&&s.hasLocalMutations,!0),n.converter))}function bG(n){n=gt(n,Pn);const e=gt(n.firestore,Qt);return aT(fn(e),n._key,{source:"server"}).then(t=>bv(e,n,t))}function Ft(n){n=gt(n,er);const e=gt(n.firestore,Qt),t=fn(e),r=new xo(e);return wT(n._query),lT(t,n._query).then(s=>new Ll(e,r,n,s))}function wG(n){n=gt(n,er);const e=gt(n.firestore,Qt),t=fn(e),r=new xo(e);return AV(t,n._query).then(s=>new Ll(e,r,n,s))}function xG(n){n=gt(n,er);const e=gt(n.firestore,Qt),t=fn(e),r=new xo(e);return lT(t,n._query,{source:"server"}).then(s=>new Ll(e,r,n,s))}function Xt(n,e,t){n=gt(n,Pn);const r=gt(n.firestore,Qt),s=Pf(n.converter,e,t);return Kc(r,[xf(Ta(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,an.none())])}function Io(n,e,t,...r){n=gt(n,Pn);const s=gt(n.firestore,Qt),i=Ta(s);let o;return o=typeof(e=Ne(e))=="string"||e instanceof Ia?gv(i,"updateDoc",n._key,e,t,r):mv(i,"updateDoc",n._key,e),Kc(s,[o.toMutation(n._key,an.exists(!0))])}function $l(n){return Kc(gt(n.firestore,Qt),[new Hl(n._key,an.none())])}function Sa(n,e){const t=gt(n.firestore,Qt),r=_e(n),s=Pf(n.converter,e);return Kc(t,[xf(Ta(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,an.exists(!1))]).then(()=>r)}function IG(n,...e){var t,r,s;n=Ne(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Cm(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Cm(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,d;if(n instanceof Pn)c=gt(n.firestore,Qt),d=ql(n._key.path),l={next:f=>{e[o]&&e[o](bv(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=gt(n,er);c=gt(f.firestore,Qt),d=f._query;const g=new xo(c);l={next:v=>{e[o]&&e[o](new Ll(c,g,f,v))},error:e[o+1],complete:e[o+2]},wT(n._query)}return function(g,v,x,w){const I=new vf(w),L=new ev(v,I,x);return g.asyncQueue.enqueueAndForget(async()=>Yg(await Vl(g),L)),()=>{I.Za(),g.asyncQueue.enqueueAndForget(async()=>Xg(await Vl(g),L))}}(fn(c),d,a,l)}function EG(n,e){return PV(fn(n=gt(n,Qt)),Cm(e)?e:{next:e})}function Kc(n,e){return function(r,s){const i=new Hn;return r.asyncQueue.enqueueAndForget(async()=>nV(await lv(r),s,i)),i.promise}(fn(n),e)}function bv(n,e,t){const r=t.docs.get(e._key),s=new xo(n);return new Ml(n,s,e._key,r,new Zo(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TG(n){return QV(n,{count:GV()})}function QV(n,e){const t=gt(n.firestore,Qt),r=fn(t),s=SI(e,(i,o)=>new rE(o,i.aggregateType,i._internalFieldPath));return SV(r,n._query,s).then(i=>function(a,l,c){const d=new xo(a);return new FV(l,d,c)}(t,n,i))}class JV{constructor(e){this.kind="memory",this._onlineComponentProvider=po.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=fo.provider}toJSON(){return{kind:this.kind}}}class YV{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=nM(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class XV{constructor(){this.kind="memoryEager",this._offlineComponentProvider=fo.provider}toJSON(){return{kind:this.kind}}}class ZV{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new yV(e)}}toJSON(){return{kind:this.kind}}}function AG(){return new XV}function SG(n){return new ZV(n==null?void 0:n.cacheSizeBytes)}function PG(n){return new JV(n)}function RG(n){return new YV(n)}class eM{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=po.provider,this._offlineComponentProvider={build:t=>new ov(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class tM{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=po.provider,this._offlineComponentProvider={build:t=>new rT(t,e==null?void 0:e.cacheSizeBytes)}}}function nM(n){return new eM(n==null?void 0:n.forceOwnership)}function CG(){return new tM}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rM={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sM{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ta(e)}set(e,t,r){this._verifyNotCommitted();const s=Hi(e,this._firestore),i=Pf(s.converter,t,r),o=xf(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,an.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Hi(e,this._firestore);let o;return o=typeof(t=Ne(t))=="string"||t instanceof Ia?gv(this._dataReader,"WriteBatch.update",i._key,t,r,s):mv(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,an.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Hi(e,this._firestore);return this._mutations=this._mutations.concat(new Hl(t._key,an.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new pe(W.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Hi(n,e){if((n=Ne(n)).firestore!==e)throw new pe(W.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iM extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Ta(t)}get(t){const r=Hi(t,this._firestore),s=new KV(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return Ce();const o=i[0];if(o.isFoundDocument())return new wc(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new wc(this._firestore,s,r._key,null,r.converter);throw Ce()})}set(t,r,s){const i=Hi(t,this._firestore),o=Pf(i.converter,r,s),a=xf(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=Hi(t,this._firestore);let a;return a=typeof(r=Ne(r))=="string"||r instanceof Ia?gv(this._dataReader,"Transaction.update",o._key,r,s,i):mv(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=Hi(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Hi(e,this._firestore),r=new xo(this._firestore);return super.get(e).then(s=>new Ml(this._firestore,r,t._key,s._document,new Zo(!1,!1),t.converter))}}function DG(n,e,t){n=gt(n,Qt);const r=Object.assign(Object.assign({},rM),t);return function(i){if(i.maxAttempts<1)throw new pe(W.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new Hn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await oT(i);new wV(i.asyncQueue,c,a,o,l).au()}),l.promise}(fn(n),s=>e(new iM(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NG(){return new qc("deleteField")}function tr(){return new dv("serverTimestamp")}function oM(...n){return new hv("arrayUnion",n)}function OG(...n){return new fv("arrayRemove",n)}function VG(n){return new pv("increment",n)}function MG(n){return new bf(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wv(n){return fn(n=gt(n,Qt)),new sM(n,e=>Kc(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LG(n,e){const t=fn(n=gt(n,Qt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Xr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(d){throw new pe(W.INVALID_ARGUMENT,"Failed to parse JSON: "+(d==null?void 0:d.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=db(l,"collectionGroup"),d=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=If("setIndexConfiguration",db(f,"fieldPath"));f.arrayConfig==="CONTAINS"?d.push(new ra(g,2)):f.order==="ASCENDING"?d.push(new ra(g,0)):f.order==="DESCENDING"&&d.push(new ra(g,1))}a.push(new Il(Il.UNKNOWN_ID,c,d,El.empty()))}return a}(e);return kV(t,r)}function db(n,e){if(typeof n[e]!="string")throw new pe(W.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aM{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function $G(n){var e;n=gt(n,Qt);const t=hb.get(n);if(t)return t;if(((e=fn(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new aM(n);return hb.set(n,r),r}function FG(n){AT(n,!0)}function UG(n){AT(n,!1)}function jG(n){NV(fn(n._firestore)).then(e=>fe("deleting all persistent cache indexes succeeded")).catch(e=>Xr("deleting all persistent cache indexes failed",e))}function AT(n,e){DV(fn(n._firestore),e).then(t=>fe(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>Xr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const hb=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BG(n){var e;const t=(e=fn(gt(n.firestore,Qt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:df(t,fr(n._query))._t}function qG(n,e){var t;const r=SI(e,(i,o)=>new rE(o,i.aggregateType,i._internalFieldPath)),s=(t=fn(gt(n.firestore,Qt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:gE(s,jI(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zG{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return xv.instance.onExistenceFilterMismatch(e)}}class xv{constructor(){this.Uu=new Map}static get instance(){return Dd||(Dd=new xv,function(t){if(bh)throw new Error("a TestingHooksSpi instance is already set");bh=t}(Dd)),Dd}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let Dd=null;(function(e,t=!0){(function(s){Bl=s})(xa),cs(new Yr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Qt(new RD(r.getProvider("auth-internal")),new DD(r.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new pe(W.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ua(c.options.projectId,d)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Rr(t_,"4.7.3",e),Rr(t_,"4.7.3","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ST="firebasestorage.googleapis.com",PT="storageBucket",lM=2*60*1e3,uM=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _n extends ds{constructor(e,t,r=0){super(Mp(e),`Firebase Storage: ${t} (${Mp(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,_n.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Mp(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var yn;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(yn||(yn={}));function Mp(n){return"storage/"+n}function Iv(){const n="An unknown error occurred, please check the error payload for server response.";return new _n(yn.UNKNOWN,n)}function cM(n){return new _n(yn.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function dM(n){return new _n(yn.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function hM(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new _n(yn.UNAUTHENTICATED,n)}function fM(){return new _n(yn.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function pM(n){return new _n(yn.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function mM(){return new _n(yn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function gM(){return new _n(yn.CANCELED,"User canceled the upload/download.")}function vM(n){return new _n(yn.INVALID_URL,"Invalid URL '"+n+"'.")}function yM(n){return new _n(yn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function _M(){return new _n(yn.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+PT+"' property when initializing the app?")}function bM(){return new _n(yn.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function wM(){return new _n(yn.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function xM(n){return new _n(yn.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function km(n){return new _n(yn.INVALID_ARGUMENT,n)}function RT(){return new _n(yn.APP_DELETED,"The Firebase app was deleted.")}function IM(n){return new _n(yn.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Ku(n,e){return new _n(yn.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function wu(n){throw new _n(yn.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ur{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=Ur.makeFromUrl(e,t)}catch{return new Ur(e,"")}if(r.path==="")return r;throw yM(e)}static makeFromUrl(e,t){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(z){z.path.charAt(z.path.length-1)==="/"&&(z.path_=z.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),l={bucket:1,path:3};function c(z){z.path_=decodeURIComponent(z.path)}const d="v[A-Za-z0-9_]+",f=t.replace(/[.]/g,"\\."),g="(/([^?#]*).*)?$",v=new RegExp(`^https?://${f}/${d}/b/${s}/o${g}`,"i"),x={bucket:1,path:3},w=t===ST?"(?:storage.googleapis.com|storage.cloud.google.com)":t,I="([^?#]*)",L=new RegExp(`^https?://${w}/${s}/${I}`,"i"),U=[{regex:a,indices:l,postModify:i},{regex:v,indices:x,postModify:c},{regex:L,indices:{bucket:1,path:2},postModify:c}];for(let z=0;z<U.length;z++){const le=U[z],Z=le.regex.exec(e);if(Z){const A=Z[le.indices.bucket];let b=Z[le.indices.path];b||(b=""),r=new Ur(A,b),le.postModify(r);break}}if(r==null)throw vM(e);return r}}class EM{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TM(n,e,t){let r=1,s=null,i=null,o=!1,a=0;function l(){return a===2}let c=!1;function d(...I){c||(c=!0,e.apply(null,I))}function f(I){s=setTimeout(()=>{s=null,n(v,l())},I)}function g(){i&&clearTimeout(i)}function v(I,...L){if(c){g();return}if(I){g(),d.call(null,I,...L);return}if(l()||o){g(),d.call(null,I,...L);return}r<64&&(r*=2);let U;a===1?(a=2,U=0):U=(r+Math.random())*1e3,f(U)}let x=!1;function w(I){x||(x=!0,g(),!c&&(s!==null?(I||(a=2),clearTimeout(s),f(0)):I||(a=1)))}return f(0),i=setTimeout(()=>{o=!0,w(!0)},t),w}function AM(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SM(n){return n!==void 0}function PM(n){return typeof n=="object"&&!Array.isArray(n)}function Ev(n){return typeof n=="string"||n instanceof String}function fb(n){return Tv()&&n instanceof Blob}function Tv(){return typeof Blob<"u"}function pb(n,e,t,r){if(r<e)throw km(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw km(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rf(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function CT(n){const e=encodeURIComponent;let t="?";for(const r in n)if(n.hasOwnProperty(r)){const s=e(r)+"="+e(n[r]);t=t+s+"&"}return t=t.slice(0,-1),t}var sa;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(sa||(sa={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RM(n,e){const t=n>=500&&n<600,s=[408,429].indexOf(n)!==-1,i=e.indexOf(n)!==-1;return t||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CM{constructor(e,t,r,s,i,o,a,l,c,d,f,g=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=d,this.connectionFactory_=f,this.retry=g,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((v,x)=>{this.resolve_=v,this.reject_=x,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new Nd(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=a=>{const l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const a=i.getErrorCode()===sa.NO_ERROR,l=i.getStatus();if(!a||RM(l,this.additionalRetryCodes_)&&this.retry){const d=i.getErrorCode()===sa.ABORT;r(!1,new Nd(!1,null,d));return}const c=this.successCodes_.indexOf(l)!==-1;r(!0,new Nd(c,i))})},t=(r,s)=>{const i=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const l=this.callback_(a,a.getResponse());SM(l)?i(l):i()}catch(l){o(l)}else if(a!==null){const l=Iv();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(s.canceled){const l=this.appDelete_?RT():gM();o(l)}else{const l=mM();o(l)}};this.canceled_?t(!1,new Nd(!1,null,!0)):this.backoffId_=TM(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&AM(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Nd{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function kM(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function DM(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function NM(n,e){e&&(n["X-Firebase-GMPID"]=e)}function OM(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function VM(n,e,t,r,s,i,o=!0){const a=CT(n.urlParams),l=n.url+a,c=Object.assign({},n.headers);return NM(c,e),kM(c,t),DM(c,i),OM(c,r),new CM(l,n.method,c,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MM(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function LM(...n){const e=MM();if(e!==void 0){const t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(Tv())return new Blob(n);throw new _n(yn.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function $M(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FM(n){if(typeof atob>"u")throw xM("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ts={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Lp{constructor(e,t){this.data=e,this.contentType=t||null}}function UM(n,e){switch(n){case Ts.RAW:return new Lp(kT(e));case Ts.BASE64:case Ts.BASE64URL:return new Lp(DT(n,e));case Ts.DATA_URL:return new Lp(BM(e),qM(e))}throw Iv()}function kT(n){const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const i=r,o=n.charCodeAt(++t);r=65536|(i&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function jM(n){let e;try{e=decodeURIComponent(n)}catch{throw Ku(Ts.DATA_URL,"Malformed data URL.")}return kT(e)}function DT(n,e){switch(n){case Ts.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw Ku(n,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Ts.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw Ku(n,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=FM(e)}catch(s){throw s.message.includes("polyfill")?s:Ku(n,"Invalid character found")}const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}class NT{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw Ku(Ts.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;r!=null&&(this.base64=zM(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function BM(n){const e=new NT(n);return e.base64?DT(Ts.BASE64,e.rest):jM(e.rest)}function qM(n){return new NT(n).contentType}function zM(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ki{constructor(e,t){let r=0,s="";fb(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,t){if(fb(this.data_)){const r=this.data_,s=$M(r,e,t);return s===null?null:new Ki(s)}else{const r=new Uint8Array(this.data_.buffer,e,t-e);return new Ki(r,!0)}}static getBlob(...e){if(Tv()){const t=e.map(r=>r instanceof Ki?r.data_:r);return new Ki(LM.apply(null,t))}else{const t=e.map(o=>Ev(o)?UM(Ts.RAW,o).data:o.data_);let r=0;t.forEach(o=>{r+=o.byteLength});const s=new Uint8Array(r);let i=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)s[i++]=o[a]}),new Ki(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OT(n){let e;try{e=JSON.parse(n)}catch{return null}return PM(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HM(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function KM(n,e){const t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function VT(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GM(n,e){return e}class vr{constructor(e,t,r,s){this.server=e,this.local=t||e,this.writable=!!r,this.xform=s||GM}}let Od=null;function WM(n){return!Ev(n)||n.length<2?n:VT(n)}function MT(){if(Od)return Od;const n=[];n.push(new vr("bucket")),n.push(new vr("generation")),n.push(new vr("metageneration")),n.push(new vr("name","fullPath",!0));function e(i,o){return WM(o)}const t=new vr("name");t.xform=e,n.push(t);function r(i,o){return o!==void 0?Number(o):o}const s=new vr("size");return s.xform=r,n.push(s),n.push(new vr("timeCreated")),n.push(new vr("updated")),n.push(new vr("md5Hash",null,!0)),n.push(new vr("cacheControl",null,!0)),n.push(new vr("contentDisposition",null,!0)),n.push(new vr("contentEncoding",null,!0)),n.push(new vr("contentLanguage",null,!0)),n.push(new vr("contentType",null,!0)),n.push(new vr("metadata","customMetadata",!0)),Od=n,Od}function QM(n,e){function t(){const r=n.bucket,s=n.fullPath,i=new Ur(r,s);return e._makeStorageReference(i)}Object.defineProperty(n,"ref",{get:t})}function JM(n,e,t){const r={};r.type="file";const s=t.length;for(let i=0;i<s;i++){const o=t[i];r[o.local]=o.xform(r,e[o.server])}return QM(r,n),r}function LT(n,e,t){const r=OT(e);return r===null?null:JM(n,r,t)}function YM(n,e,t,r){const s=OT(e);if(s===null||!Ev(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(c=>{const d=n.bucket,f=n.fullPath,g="/b/"+o(d)+"/o/"+o(f),v=Rf(g,t,r),x=CT({alt:"media",token:c});return v+x})[0]}function XM(n,e){const t={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(t[i.server]=n[i.local])}return JSON.stringify(t)}class Av{constructor(e,t,r,s){this.url=e,this.method=t,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $T(n){if(!n)throw Iv()}function ZM(n,e){function t(r,s){const i=LT(n,s,e);return $T(i!==null),i}return t}function eL(n,e){function t(r,s){const i=LT(n,s,e);return $T(i!==null),YM(i,s,n.host,n._protocol)}return t}function FT(n){function e(t,r){let s;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?s=fM():s=hM():t.getStatus()===402?s=dM(n.bucket):t.getStatus()===403?s=pM(n.path):s=r,s.status=t.getStatus(),s.serverResponse=r.serverResponse,s}return e}function UT(n){const e=FT(n);function t(r,s){let i=e(r,s);return r.getStatus()===404&&(i=cM(n.path)),i.serverResponse=s.serverResponse,i}return t}function tL(n,e,t){const r=e.fullServerUrl(),s=Rf(r,n.host,n._protocol),i="GET",o=n.maxOperationRetryTime,a=new Av(s,i,eL(n,t),o);return a.errorHandler=UT(e),a}function nL(n,e){const t=e.fullServerUrl(),r=Rf(t,n.host,n._protocol),s="DELETE",i=n.maxOperationRetryTime;function o(l,c){}const a=new Av(r,s,o,i);return a.successCodes=[200,204],a.errorHandler=UT(e),a}function rL(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function sL(n,e,t){const r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=rL(null,e)),r}function iL(n,e,t,r,s){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let U="";for(let z=0;z<2;z++)U=U+Math.random().toString().slice(2);return U}const l=a();o["Content-Type"]="multipart/related; boundary="+l;const c=sL(e,r,s),d=XM(c,t),f="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+d+`\r
--`+l+`\r
Content-Type: `+c.contentType+`\r
\r
`,g=`\r
--`+l+"--",v=Ki.getBlob(f,r,g);if(v===null)throw bM();const x={name:c.fullPath},w=Rf(i,n.host,n._protocol),I="POST",L=n.maxUploadRetryTime,$=new Av(w,I,ZM(n,t),L);return $.urlParams=x,$.headers=o,$.body=v.uploadData(),$.errorHandler=FT(e),$}class oL{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=sa.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=sa.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=sa.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,s){if(this.sent_)throw wu("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),s!==void 0)for(const i in s)s.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,s[i].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw wu("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw wu("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw wu("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw wu("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class aL extends oL{initXhr(){this.xhr_.responseType="text"}}function Sv(){return new aL}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ya{constructor(e,t){this._service=e,t instanceof Ur?this._location=t:this._location=Ur.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new ya(e,t)}get root(){const e=new Ur(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return VT(this._location.path)}get storage(){return this._service}get parent(){const e=HM(this._location.path);if(e===null)return null;const t=new Ur(this._location.bucket,e);return new ya(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw IM(e)}}function lL(n,e,t){n._throwIfRoot("uploadBytes");const r=iL(n.storage,n._location,MT(),new Ki(e,!0),t);return n.storage.makeRequestWithTokens(r,Sv).then(s=>({metadata:s,ref:n}))}function uL(n){n._throwIfRoot("getDownloadURL");const e=tL(n.storage,n._location,MT());return n.storage.makeRequestWithTokens(e,Sv).then(t=>{if(t===null)throw wM();return t})}function cL(n){n._throwIfRoot("deleteObject");const e=nL(n.storage,n._location);return n.storage.makeRequestWithTokens(e,Sv)}function dL(n,e){const t=KM(n._location.path,e),r=new Ur(n._location.bucket,t);return new ya(n.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hL(n){return/^[A-Za-z]+:\/\//.test(n)}function fL(n,e){return new ya(n,e)}function jT(n,e){if(n instanceof Pv){const t=n;if(t._bucket==null)throw _M();const r=new ya(t,t._bucket);return e!=null?jT(r,e):r}else return e!==void 0?dL(n,e):n}function pL(n,e){if(e&&hL(e)){if(n instanceof Pv)return fL(n,e);throw km("To use ref(service, url), the first argument must be a Storage instance.")}else return jT(n,e)}function mb(n,e){const t=e==null?void 0:e[PT];return t==null?null:Ur.makeFromBucketSpec(t,n)}function mL(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";const{mockUserToken:s}=r;s&&(n._overrideAuthToken=typeof s=="string"?s:Sx(s,n.app.options.projectId))}class Pv{constructor(e,t,r,s,i){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._bucket=null,this._host=ST,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=lM,this._maxUploadRetryTime=uM,this._requests=new Set,s!=null?this._bucket=Ur.makeFromBucketSpec(s,this._host):this._bucket=mb(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Ur.makeFromBucketSpec(this._url,e):this._bucket=mb(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){pb("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){pb("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ya(this,e)}_makeRequest(e,t,r,s,i=!0){if(this._deleted)return new EM(RT());{const o=VM(e,this._appId,r,s,t,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,s).getPromise()}}const gb="@firebase/storage",vb="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BT="storage";function gL(n,e,t){return n=Ne(n),lL(n,e,t)}function vL(n){return n=Ne(n),uL(n)}function yL(n){return n=Ne(n),cL(n)}function qT(n,e){return n=Ne(n),pL(n,e)}function _L(n=jl(),e){n=Ne(n);const r=fi(n,BT).getImmediate({identifier:e}),s=Ex("storage");return s&&bL(r,...s),r}function bL(n,e,t,r={}){mL(n,e,t,r)}function wL(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new Pv(t,r,s,e,xa)}function xL(){cs(new Yr(BT,wL,"PUBLIC").setMultipleInstances(!0)),Rr(gb,vb,""),Rr(gb,vb,"esm2017")}xL();function Rv(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HG={PHONE:"phone",TOTP:"totp"},KG={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},GG={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},WG={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},QG={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IL(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function zT(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const JG=IL,EL=zT,HT=new wa("auth","Firebase",zT()),YG={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kh=new fg("@firebase/auth");function TL(n,...e){kh.logLevel<=_t.WARN&&kh.warn(`Auth (${xa}): ${n}`,...e)}function eh(n,...e){kh.logLevel<=_t.ERROR&&kh.error(`Auth (${xa}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cr(n,...e){throw kv(n,...e)}function xr(n,...e){return kv(n,...e)}function Cv(n,e,t){const r=Object.assign(Object.assign({},EL()),{[e]:t});return new wa("auth","Firebase",r).create(e,{appName:n.name})}function Kn(n){return Cv(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Xl(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Cr(n,"argument-error"),Cv(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function kv(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return HT.create(n,...e)}function xe(n,e,...t){if(!n)throw kv(e,...t)}function As(n){const e="INTERNAL ASSERTION FAILED: "+n;throw eh(e),new Error(e)}function ui(n,e){n||As(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ic(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Dv(){return yb()==="http:"||yb()==="https:"}function yb(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AL(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Dv()||$C()||"connection"in navigator)?navigator.onLine:!0}function SL(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gc{constructor(e,t){this.shortDelay=e,this.longDelay=t,ui(t>e,"Short delay should be less than long delay!"),this.isMobile=VC()||FC()}get(){return AL()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nv(n,e){ui(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KT{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;As("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;As("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;As("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PL={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RL=new Gc(3e4,6e4);function nn(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function rn(n,e,t,r,s={}){return GT(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Ul(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return LC()||(c.referrerPolicy="no-referrer"),KT.fetch()(WT(n,n.config.apiHost,t,a),c)})}async function GT(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},PL),e);try{const s=new kL(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw ku(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw ku(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw ku(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw ku(n,"user-disabled",o);const d=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw Cv(n,d,c);Cr(n,d)}}catch(s){if(s instanceof ds)throw s;Cr(n,"network-request-failed",{message:String(s)})}}async function yi(n,e,t,r,s={}){const i=await rn(n,e,t,r,s);return"mfaPendingCredential"in i&&Cr(n,"multi-factor-auth-required",{_serverResponse:i}),i}function WT(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Nv(n.config,s):`${n.config.apiScheme}://${s}`}function CL(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class kL{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(xr(this.auth,"network-request-failed")),RL.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function ku(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=xr(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _b(n){return n!==void 0&&n.getResponse!==void 0}function bb(n){return n!==void 0&&n.enterprise!==void 0}class QT{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return CL(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DL(n){return(await rn(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function JT(n,e){return rn(n,"GET","/v2/recaptchaConfig",nn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NL(n,e){return rn(n,"POST","/v1/accounts:delete",e)}async function OL(n,e){return rn(n,"POST","/v1/accounts:update",e)}async function YT(n,e){return rn(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gu(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XG(n,e=!1){return Ne(n).getIdToken(e)}async function VL(n,e=!1){const t=Ne(n),r=await t.getIdToken(e),s=Cf(r);xe(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Gu($p(s.auth_time)),issuedAtTime:Gu($p(s.iat)),expirationTime:Gu($p(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function $p(n){return Number(n)*1e3}function Cf(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return eh("JWT malformed, contained fewer than 3 sections"),null;try{const s=xx(t);return s?JSON.parse(s):(eh("Failed to decode base64 JWT payload"),null)}catch(s){return eh("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function wb(n){const e=Cf(n);return xe(e,"internal-error"),xe(typeof e.exp<"u","internal-error"),xe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ci(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof ds&&ML(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function ML({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LL{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dm{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Gu(this.lastLoginAt),this.creationTime=Gu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ec(n){var e;const t=n.auth,r=await n.getIdToken(),s=await ci(n,YT(t,{idToken:r}));xe(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?XT(i.providerUserInfo):[],a=FL(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Dm(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function $L(n){const e=Ne(n);await Ec(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function FL(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function XT(n){return n.map(e=>{var{providerId:t}=e,r=Rv(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UL(n,e){const t=await GT(n,{},async()=>{const r=Ul({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=WT(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",KT.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function jL(n,e){return rn(n,"POST","/v2/accounts:revokeToken",nn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){xe(e.idToken,"internal-error"),xe(typeof e.idToken<"u","internal-error"),xe(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):wb(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){xe(e.length!==0,"internal-error");const t=wb(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(xe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await UL(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new pl;return r&&(xe(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(xe(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(xe(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new pl,this.toJSON())}_performRefresh(){return As("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Li(n,e){xe(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Js{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=Rv(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new LL(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Dm(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await ci(this,this.stsTokenManager.getToken(this.auth,e));return xe(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return VL(this,e)}reload(){return $L(this)}_assign(e){this!==e&&(xe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Js(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){xe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Ec(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Tn(this.auth.app))return Promise.reject(Kn(this.auth));const e=await this.getIdToken();return await ci(this,NL(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,d;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(s=t.email)!==null&&s!==void 0?s:void 0,v=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,x=(o=t.photoURL)!==null&&o!==void 0?o:void 0,w=(a=t.tenantId)!==null&&a!==void 0?a:void 0,I=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,L=(c=t.createdAt)!==null&&c!==void 0?c:void 0,$=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:U,emailVerified:z,isAnonymous:le,providerData:Z,stsTokenManager:A}=t;xe(U&&A,e,"internal-error");const b=pl.fromJSON(this.name,A);xe(typeof U=="string",e,"internal-error"),Li(f,e.name),Li(g,e.name),xe(typeof z=="boolean",e,"internal-error"),xe(typeof le=="boolean",e,"internal-error"),Li(v,e.name),Li(x,e.name),Li(w,e.name),Li(I,e.name),Li(L,e.name),Li($,e.name);const E=new Js({uid:U,auth:e,email:g,emailVerified:z,displayName:f,isAnonymous:le,photoURL:x,phoneNumber:v,tenantId:w,stsTokenManager:b,createdAt:L,lastLoginAt:$});return Z&&Array.isArray(Z)&&(E.providerData=Z.map(D=>Object.assign({},D))),I&&(E._redirectEventId=I),E}static async _fromIdTokenResponse(e,t,r=!1){const s=new pl;s.updateFromServerResponse(t);const i=new Js({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Ec(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];xe(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?XT(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new pl;a.updateFromIdToken(r);const l=new Js({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Dm(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xb=new Map;function Ys(n){ui(n instanceof Function,"Expected a class definition");let e=xb.get(n);return e?(ui(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,xb.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZT{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ZT.type="NONE";const Ib=ZT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function th(n,e,t){return`firebase:${n}:${e}:${t}`}class ml{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=th(this.userKey,s.apiKey,i),this.fullPersistenceKey=th("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Js._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new ml(Ys(Ib),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||Ys(Ib);const o=th(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const d=await c._get(o);if(d){const f=Js._fromJSON(e,d);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new ml(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new ml(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eb(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(rA(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(eA(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(iA(e))return"Blackberry";if(oA(e))return"Webos";if(tA(e))return"Safari";if((e.includes("chrome/")||nA(e))&&!e.includes("edge/"))return"Chrome";if(sA(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function eA(n=Mn()){return/firefox\//i.test(n)}function tA(n=Mn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function nA(n=Mn()){return/crios\//i.test(n)}function rA(n=Mn()){return/iemobile/i.test(n)}function sA(n=Mn()){return/android/i.test(n)}function iA(n=Mn()){return/blackberry/i.test(n)}function oA(n=Mn()){return/webos/i.test(n)}function Ov(n=Mn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function BL(n=Mn()){var e;return Ov(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function qL(){return UC()&&document.documentMode===10}function aA(n=Mn()){return Ov(n)||sA(n)||oA(n)||iA(n)||/windows phone/i.test(n)||rA(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lA(n,e=[]){let t;switch(n){case"Browser":t=Eb(Mn());break;case"Worker":t=`${Eb(Mn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${xa}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zL{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HL(n,e={}){return rn(n,"GET","/v2/passwordPolicy",nn(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KL=6;class GL{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:KL,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WL{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Tb(this),this.idTokenSubscription=new Tb(this),this.beforeStateQueue=new zL(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=HT,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ys(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await ml.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await YT(this,{idToken:e}),r=await Js._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Tn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return xe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ec(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=SL()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Tn(this.app))return Promise.reject(Kn(this));const t=e?Ne(e):null;return t&&xe(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&xe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Tn(this.app)?Promise.reject(Kn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Tn(this.app)?Promise.reject(Kn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ys(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await HL(this),t=new GL(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new wa("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await jL(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ys(e)||this._popupRedirectResolver;xe(t,this,"argument-error"),this.redirectPersistenceManager=await ml.create(this,[Ys(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(xe(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return xe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=lA(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&TL(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function bn(n){return Ne(n)}class Tb{constructor(e){this.auth=e,this.observer=null,this.addObserver=KC(t=>this.observer=t)}get next(){return xe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function QL(n){Wc=n}function Vv(n){return Wc.loadJS(n)}function JL(){return Wc.recaptchaV2Script}function YL(){return Wc.recaptchaEnterpriseScript}function XL(){return Wc.gapiScript}function uA(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const ZL="recaptcha-enterprise",e4="NO_RECAPTCHA";class cA{constructor(e){this.type=ZL,this.auth=bn(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{JT(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new QT(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;bb(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(e4)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&bb(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=YL();l.length!==0&&(l+=a),Vv(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function Ab(n,e,t,r=!1){const s=new cA(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Tc(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Ab(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Ab(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function t4(n){const e=bn(n),t=await JT(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new QT(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new cA(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n4(n,e){const t=fi(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(oo(i,e??{}))return s;Cr(s,"already-initialized")}return t.initialize({options:e})}function r4(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Ys);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function s4(n,e,t){const r=bn(n);xe(r._canInitEmulator,r,"emulator-config-failed"),xe(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=dA(e),{host:o,port:a}=i4(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||o4()}function dA(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function i4(n){const e=dA(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Sb(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:Sb(o)}}}function Sb(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function o4(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qc{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return As("not implemented")}_getIdTokenResponse(e){return As("not implemented")}_linkToIdToken(e,t){return As("not implemented")}_getReauthenticationResolver(e){return As("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hA(n,e){return rn(n,"POST","/v1/accounts:resetPassword",nn(n,e))}async function a4(n,e){return rn(n,"POST","/v1/accounts:update",e)}async function l4(n,e){return rn(n,"POST","/v1/accounts:signUp",e)}async function u4(n,e){return rn(n,"POST","/v1/accounts:update",nn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c4(n,e){return yi(n,"POST","/v1/accounts:signInWithPassword",nn(n,e))}async function kf(n,e){return rn(n,"POST","/v1/accounts:sendOobCode",nn(n,e))}async function d4(n,e){return kf(n,e)}async function h4(n,e){return kf(n,e)}async function f4(n,e){return kf(n,e)}async function p4(n,e){return kf(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m4(n,e){return yi(n,"POST","/v1/accounts:signInWithEmailLink",nn(n,e))}async function g4(n,e){return yi(n,"POST","/v1/accounts:signInWithEmailLink",nn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ac extends Qc{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Ac(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Ac(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Tc(e,t,"signInWithPassword",c4);case"emailLink":return m4(e,{email:this._email,oobCode:this._password});default:Cr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Tc(e,r,"signUpPassword",l4);case"emailLink":return g4(e,{idToken:t,email:this._email,oobCode:this._password});default:Cr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ri(n,e){return yi(n,"POST","/v1/accounts:signInWithIdp",nn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v4="http://localhost";class di extends Qc{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new di(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Cr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=Rv(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new di(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return ri(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ri(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ri(e,t)}buildRequest(){const e={requestUri:v4,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ul(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y4(n,e){return rn(n,"POST","/v1/accounts:sendVerificationCode",nn(n,e))}async function _4(n,e){return yi(n,"POST","/v1/accounts:signInWithPhoneNumber",nn(n,e))}async function b4(n,e){const t=await yi(n,"POST","/v1/accounts:signInWithPhoneNumber",nn(n,e));if(t.temporaryProof)throw ku(n,"account-exists-with-different-credential",t);return t}const w4={USER_NOT_FOUND:"user-not-found"};async function x4(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return yi(n,"POST","/v1/accounts:signInWithPhoneNumber",nn(n,t),w4)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia extends Qc{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ia({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ia({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return _4(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return b4(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return x4(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new ia({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I4(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function E4(n){const e=Tu(Au(n)).link,t=e?Tu(Au(e)).deep_link_id:null,r=Tu(Au(n)).deep_link_id;return(r?Tu(Au(r)).link:null)||r||t||e||n}class Jc{constructor(e){var t,r,s,i,o,a;const l=Tu(Au(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,d=(r=l.oobCode)!==null&&r!==void 0?r:null,f=I4((s=l.mode)!==null&&s!==void 0?s:null);xe(c&&d&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=d,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=E4(e);try{return new Jc(t)}catch{return null}}}function ZG(n){return Jc.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa{constructor(){this.providerId=Pa.PROVIDER_ID}static credential(e,t){return Ac._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Jc.parseLink(t);return xe(r,"argument-error"),Ac._fromEmailAndCode(e,r.code,r.tenantId)}}Pa.PROVIDER_ID="password";Pa.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Pa.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zl extends _i{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class nh extends Zl{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return xe("providerId"in t&&"signInMethod"in t,"argument-error"),di._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return xe(e.idToken||e.accessToken,"argument-error"),di._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return nh.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return nh.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new nh(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi extends Zl{constructor(){super("facebook.com")}static credential(e){return di._fromParams({providerId:Gi.PROVIDER_ID,signInMethod:Gi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Gi.credentialFromTaggedObject(e)}static credentialFromError(e){return Gi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Gi.credential(e.oauthAccessToken)}catch{return null}}}Gi.FACEBOOK_SIGN_IN_METHOD="facebook.com";Gi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi extends Zl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return di._fromParams({providerId:Wi.PROVIDER_ID,signInMethod:Wi.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Wi.credentialFromTaggedObject(e)}static credentialFromError(e){return Wi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Wi.credential(t,r)}catch{return null}}}Wi.GOOGLE_SIGN_IN_METHOD="google.com";Wi.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qi extends Zl{constructor(){super("github.com")}static credential(e){return di._fromParams({providerId:Qi.PROVIDER_ID,signInMethod:Qi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Qi.credentialFromTaggedObject(e)}static credentialFromError(e){return Qi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Qi.credential(e.oauthAccessToken)}catch{return null}}}Qi.GITHUB_SIGN_IN_METHOD="github.com";Qi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T4="http://localhost";class Sc extends Qc{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return ri(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ri(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ri(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Sc(r,i)}static _create(e,t){return new Sc(e,t)}buildRequest(){return{requestUri:T4,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A4="saml.";class Nm extends _i{constructor(e){xe(e.startsWith(A4),"argument-error"),super(e)}static credentialFromResult(e){return Nm.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Nm.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Sc.fromJSON(e);return xe(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Sc._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji extends Zl{constructor(){super("twitter.com")}static credential(e,t){return di._fromParams({providerId:Ji.PROVIDER_ID,signInMethod:Ji.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ji.credentialFromTaggedObject(e)}static credentialFromError(e){return Ji.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Ji.credential(t,r)}catch{return null}}}Ji.TWITTER_SIGN_IN_METHOD="twitter.com";Ji.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fA(n,e){return yi(n,"POST","/v1/accounts:signUp",nn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Js._fromIdTokenResponse(e,r,s),o=Pb(r);return new Zr({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Pb(r);return new Zr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Pb(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pA(n){var e;if(Tn(n.app))return Promise.reject(Kn(n));const t=bn(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Zr({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await fA(t,{returnSecureToken:!0}),s=await Zr._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh extends ds{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Dh.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Dh(e,t,r,s)}}function mA(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Dh._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gA(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e7(n,e){const t=Ne(n);await Df(!0,t,e);const{providerUserInfo:r}=await OL(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=gA(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Mv(n,e,t=!1){const r=await ci(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Zr._forOperation(n,"link",r)}async function Df(n,e,t){await Ec(e);const r=gA(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";xe(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vA(n,e,t=!1){const{auth:r}=n;if(Tn(r.app))return Promise.reject(Kn(r));const s="reauthenticate";try{const i=await ci(n,mA(r,s,e,n),t);xe(i.idToken,r,"internal-error");const o=Cf(i.idToken);xe(o,r,"internal-error");const{sub:a}=o;return xe(n.uid===a,r,"user-mismatch"),Zr._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Cr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yA(n,e,t=!1){if(Tn(n.app))return Promise.reject(Kn(n));const r="signIn",s=await mA(n,r,e),i=await Zr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Lv(n,e){return yA(bn(n),e)}async function S4(n,e){const t=Ne(n);return await Df(!1,t,e.providerId),Mv(t,e)}async function P4(n,e){return vA(Ne(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R4(n,e){return yi(n,"POST","/v1/accounts:signInWithCustomToken",nn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t7(n,e){if(Tn(n.app))return Promise.reject(Kn(n));const t=bn(n),r=await R4(t,{token:e,returnSecureToken:!0}),s=await Zr._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yc{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?$v._fromServerResponse(e,t):"totpInfo"in t?Fv._fromServerResponse(e,t):Cr(e,"internal-error")}}class $v extends Yc{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new $v(t)}}class Fv extends Yc{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Fv(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nf(n,e,t){var r;xe(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),xe(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(xe(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(xe(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uv(n){const e=bn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function C4(n,e,t){const r=bn(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Nf(r,s,t),await Tc(r,s,"getOobCode",h4)}async function k4(n,e,t){await hA(Ne(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Uv(n),r})}async function n7(n,e){await u4(Ne(n),{oobCode:e})}async function D4(n,e){const t=Ne(n),r=await hA(t,{oobCode:e}),s=r.requestType;switch(xe(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":xe(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":xe(r.mfaInfo,t,"internal-error");default:xe(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Yc._fromServerResponse(bn(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function N4(n,e){const{data:t}=await D4(Ne(n),e);return t.email}async function O4(n,e,t){if(Tn(n.app))return Promise.reject(Kn(n));const r=bn(n),o=await Tc(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",fA).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Uv(n),l}),a=await Zr._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function _A(n,e,t){return Tn(n.app)?Promise.reject(Kn(n)):Lv(Ne(n),Pa.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Uv(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r7(n,e,t){const r=bn(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){xe(a.handleCodeInApp,r,"argument-error"),a&&Nf(r,o,a)}i(s,t),await Tc(r,s,"getOobCode",f4)}function s7(n,e){const t=Jc.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function i7(n,e,t){if(Tn(n.app))return Promise.reject(Kn(n));const r=Ne(n),s=Pa.credentialWithLink(e,t||Ic());return xe(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Lv(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V4(n,e){return rn(n,"POST","/v1/accounts:createAuthUri",nn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o7(n,e){const t=Dv()?Ic():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await V4(Ne(n),r);return s||[]}async function a7(n,e){const t=Ne(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Nf(t.auth,s,e);const{email:i}=await d4(t.auth,s);i!==n.email&&await n.reload()}async function l7(n,e,t){const r=Ne(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Nf(r.auth,i,t);const{email:o}=await p4(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M4(n,e){return rn(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function u7(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Ne(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await ci(r,M4(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function L4(n,e){const t=Ne(n);return Tn(t.auth.app)?Promise.reject(Kn(t.auth)):bA(t,e,null)}function $4(n,e){return bA(Ne(n),null,e)}async function bA(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await ci(n,a4(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F4(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=Cf(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new gl(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new U4(i,s);case"github.com":return new j4(i,s);case"google.com":return new B4(i,s);case"twitter.com":return new q4(i,s,n.screenName||null);case"custom":case"anonymous":return new gl(i,null);default:return new gl(i,r,s)}}class gl{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class wA extends gl{constructor(e,t,r,s){super(e,t,r),this.username=s}}class U4 extends gl{constructor(e,t){super(e,"facebook.com",t)}}class j4 extends wA{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class B4 extends gl{constructor(e,t){super(e,"google.com",t)}}class q4 extends wA{constructor(e,t,r){super(e,"twitter.com",t,r)}}function c7(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:F4(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z4(n,e){return Ne(n).setPersistence(e)}function d7(n){return t4(n)}async function h7(n,e){return bn(n).validatePassword(e)}function H4(n,e,t,r){return Ne(n).onIdTokenChanged(e,t,r)}function K4(n,e,t){return Ne(n).beforeAuthStateChanged(e,t)}function G4(n,e,t,r){return Ne(n).onAuthStateChanged(e,t,r)}function f7(n){Ne(n).useDeviceLanguage()}function p7(n,e){return Ne(n).updateCurrentUser(e)}function W4(n){return Ne(n).signOut()}function m7(n,e){return bn(n).revokeAccessToken(e)}async function g7(n){return Ne(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new ea("enroll",e,t)}static _fromMfaPendingCredential(e){return new ea("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return ea._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return ea._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jv{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=bn(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Yc._fromServerResponse(r,a));xe(s.mfaPendingCredential,r,"internal-error");const o=ea._fromMfaPendingCredential(s.mfaPendingCredential);return new jv(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const d=await Zr._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(d.user),d;case"reauthenticate":return xe(t.user,r,"internal-error"),Zr._forOperation(t.user,t.operationType,c);default:Cr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function v7(n,e){var t;const r=Ne(n),s=e;return xe(e.customData.operationType,r,"argument-error"),xe((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),jv._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q4(n,e){return rn(n,"POST","/v2/accounts/mfaEnrollment:start",nn(n,e))}function J4(n,e){return rn(n,"POST","/v2/accounts/mfaEnrollment:finalize",nn(n,e))}function Y4(n,e){return rn(n,"POST","/v2/accounts/mfaEnrollment:start",nn(n,e))}function X4(n,e){return rn(n,"POST","/v2/accounts/mfaEnrollment:finalize",nn(n,e))}function Z4(n,e){return rn(n,"POST","/v2/accounts/mfaEnrollment:withdraw",nn(n,e))}class Bv{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Yc._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Bv(e)}async getSession(){return ea._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await ci(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await ci(this.user,Z4(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Fp=new WeakMap;function y7(n){const e=Ne(n);return Fp.has(e)||Fp.set(e,Bv._fromUser(e)),Fp.get(e)}const Nh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xA{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Nh,"1"),this.storage.removeItem(Nh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e3=1e3,t3=10;class IA extends xA{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=aA(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);qL()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,t3):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}IA.type="LOCAL";const EA=IA;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TA extends xA{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}TA.type="SESSION";const AA=TA;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n3(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Of{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Of(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await n3(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Of.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vf(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r3{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=Vf("",20);s.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===c)switch(g.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kn(){return window}function s3(n){kn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qv(){return typeof kn().WorkerGlobalScope<"u"&&typeof kn().importScripts=="function"}async function i3(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function o3(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function a3(){return qv()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SA="firebaseLocalStorageDb",l3=1,Oh="firebaseLocalStorage",PA="fbase_key";class Xc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Mf(n,e){return n.transaction([Oh],e?"readwrite":"readonly").objectStore(Oh)}function u3(){const n=indexedDB.deleteDatabase(SA);return new Xc(n).toPromise()}function Om(){const n=indexedDB.open(SA,l3);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Oh,{keyPath:PA})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Oh)?e(r):(r.close(),await u3(),e(await Om()))})})}async function Rb(n,e,t){const r=Mf(n,!0).put({[PA]:e,value:t});return new Xc(r).toPromise()}async function c3(n,e){const t=Mf(n,!1).get(e),r=await new Xc(t).toPromise();return r===void 0?null:r.value}function Cb(n,e){const t=Mf(n,!0).delete(e);return new Xc(t).toPromise()}const d3=800,h3=3;class RA{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Om(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>h3)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return qv()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Of._getInstance(a3()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await i3(),!this.activeServiceWorker)return;this.sender=new r3(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||o3()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Om();return await Rb(e,Nh,"1"),await Cb(e,Nh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Rb(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>c3(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Cb(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Mf(s,!1).getAll();return new Xc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),d3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}RA.type="LOCAL";const f3=RA;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p3(n,e){return rn(n,"POST","/v2/accounts/mfaSignIn:start",nn(n,e))}function m3(n,e){return rn(n,"POST","/v2/accounts/mfaSignIn:finalize",nn(n,e))}function g3(n,e){return rn(n,"POST","/v2/accounts/mfaSignIn:finalize",nn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v3=500,y3=6e4,Vd=1e12;class _3{constructor(e){this.auth=e,this.counter=Vd,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new b3(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Vd;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Vd;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Vd;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class b3{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;xe(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=w3(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},y3)},v3))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function w3(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Up=uA("rcb"),x3=new Gc(3e4,6e4);class I3{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=kn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return xe(E3(t),e,"argument-error"),this.shouldResolveImmediately(t)&&_b(kn().grecaptcha)?Promise.resolve(kn().grecaptcha):new Promise((r,s)=>{const i=kn().setTimeout(()=>{s(xr(e,"network-request-failed"))},x3.get());kn()[Up]=()=>{kn().clearTimeout(i),delete kn()[Up];const a=kn().grecaptcha;if(!a||!_b(a)){s(xr(e,"internal-error"));return}const l=a.render;a.render=(c,d)=>{const f=l(c,d);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${JL()}?${Ul({onload:Up,render:"explicit",hl:t})}`;Vv(o).catch(()=>{clearTimeout(i),s(xr(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=kn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function E3(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class T3{async load(e){return new _3(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CA="recaptcha",A3={theme:"light",type:"image"};class _7{constructor(e,t,r=Object.assign({},A3)){this.parameters=r,this.type=CA,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=bn(e),this.isInvisible=this.parameters.size==="invisible",xe(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;xe(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new T3:new I3,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){xe(!this.parameters.sitekey,this.auth,"argument-error"),xe(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),xe(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=kn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){xe(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){xe(Dv()&&!qv(),this.auth,"internal-error"),await S3(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await DL(this.auth);xe(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return xe(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function S3(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zv{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=ia._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function b7(n,e,t){if(Tn(n.app))return Promise.reject(Kn(n));const r=bn(n),s=await Lf(r,e,Ne(t));return new zv(s,i=>Lv(r,i))}async function w7(n,e,t){const r=Ne(n);await Df(!1,r,"phone");const s=await Lf(r.auth,e,Ne(t));return new zv(s,i=>S4(r,i))}async function x7(n,e,t){const r=Ne(n);if(Tn(r.auth.app))return Promise.reject(Kn(r.auth));const s=await Lf(r.auth,e,Ne(t));return new zv(s,i=>P4(r,i))}async function Lf(n,e,t){var r;const s=await t.verify();try{xe(typeof s=="string",n,"argument-error"),xe(t.type===CA,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return xe(o.type==="enroll",n,"internal-error"),(await Q4(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{xe(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return xe(a,n,"missing-multi-factor-info"),(await p3(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await y4(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function I7(n,e){const t=Ne(n);if(Tn(t.auth.app))return Promise.reject(Kn(t.auth));await Mv(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vl{constructor(e){this.providerId=vl.PROVIDER_ID,this.auth=bn(e)}verifyPhoneNumber(e,t){return Lf(this.auth,e,Ne(t))}static credential(e,t){return ia._fromVerification(e,t)}static credentialFromResult(e){const t=e;return vl.credentialFromTaggedObject(t)}static credentialFromError(e){return vl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?ia._fromTokenResponse(t,r):null}}vl.PROVIDER_ID="phone";vl.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ra(n,e){return e?Ys(e):(xe(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hv extends Qc{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ri(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ri(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ri(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function P3(n){return yA(n.auth,new Hv(n),n.bypassAuthState)}function R3(n){const{auth:e,user:t}=n;return xe(t,e,"internal-error"),vA(t,new Hv(n),n.bypassAuthState)}async function C3(n){const{auth:e,user:t}=n;return xe(t,e,"internal-error"),Mv(t,new Hv(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kA{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return P3;case"linkViaPopup":case"linkViaRedirect":return C3;case"reauthViaPopup":case"reauthViaRedirect":return R3;default:Cr(this.auth,"internal-error")}}resolve(e){ui(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ui(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k3=new Gc(2e3,1e4);async function E7(n,e,t){if(Tn(n.app))return Promise.reject(xr(n,"operation-not-supported-in-this-environment"));const r=bn(n);Xl(n,e,_i);const s=Ra(r,t);return new Xs(r,"signInViaPopup",e,s).executeNotNull()}async function T7(n,e,t){const r=Ne(n);if(Tn(r.auth.app))return Promise.reject(xr(r.auth,"operation-not-supported-in-this-environment"));Xl(r.auth,e,_i);const s=Ra(r.auth,t);return new Xs(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function A7(n,e,t){const r=Ne(n);Xl(r.auth,e,_i);const s=Ra(r.auth,t);return new Xs(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Xs extends kA{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Xs.currentPopupAction&&Xs.currentPopupAction.cancel(),Xs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return xe(e,this.auth,"internal-error"),e}async onExecution(){ui(this.filter.length===1,"Popup operations only handle one event");const e=Vf();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(xr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(xr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Xs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(xr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,k3.get())};e()}}Xs.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D3="pendingRedirect",rh=new Map;class N3 extends kA{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=rh.get(this.auth._key());if(!e){try{const r=await O3(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}rh.set(this.auth._key(),e)}return this.bypassAuthState||rh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function O3(n,e){const t=NA(e),r=DA(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function Kv(n,e){return DA(n)._set(NA(e),"true")}function V3(n,e){rh.set(n._key(),e)}function DA(n){return Ys(n._redirectPersistence)}function NA(n){return th(D3,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S7(n,e,t){return M3(n,e,t)}async function M3(n,e,t){if(Tn(n.app))return Promise.reject(Kn(n));const r=bn(n);Xl(n,e,_i),await r._initializationPromise;const s=Ra(r,t);return await Kv(s,r),s._openRedirect(r,e,"signInViaRedirect")}function P7(n,e,t){return L3(n,e,t)}async function L3(n,e,t){const r=Ne(n);if(Xl(r.auth,e,_i),Tn(r.auth.app))return Promise.reject(Kn(r.auth));await r.auth._initializationPromise;const s=Ra(r.auth,t);await Kv(s,r.auth);const i=await VA(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function R7(n,e,t){return $3(n,e,t)}async function $3(n,e,t){const r=Ne(n);Xl(r.auth,e,_i),await r.auth._initializationPromise;const s=Ra(r.auth,t);await Df(!1,r,e.providerId),await Kv(s,r.auth);const i=await VA(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function C7(n,e){return await bn(n)._initializationPromise,OA(n,e,!1)}async function OA(n,e,t=!1){if(Tn(n.app))return Promise.reject(Kn(n));const r=bn(n),s=Ra(r,e),o=await new N3(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function VA(n){const e=Vf(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F3=10*60*1e3;class U3{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!j3(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!MA(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(xr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=F3&&this.cachedEventUids.clear(),this.cachedEventUids.has(kb(e))}saveEventToCache(e){this.cachedEventUids.add(kb(e)),this.lastProcessedEventTime=Date.now()}}function kb(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function MA({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function j3(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return MA(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function B3(n,e={}){return rn(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q3=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,z3=/^https?/;async function H3(n){if(n.config.emulator)return;const{authorizedDomains:e}=await B3(n);for(const t of e)try{if(K3(t))return}catch{}Cr(n,"unauthorized-domain")}function K3(n){const e=Ic(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!z3.test(t))return!1;if(q3.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G3=new Gc(3e4,6e4);function Db(){const n=kn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function W3(n){return new Promise((e,t)=>{var r,s,i;function o(){Db(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Db(),t(xr(n,"network-request-failed"))},timeout:G3.get()})}if(!((s=(r=kn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=kn().gapi)===null||i===void 0)&&i.load)o();else{const a=uA("iframefcb");return kn()[a]=()=>{gapi.load?o():t(xr(n,"network-request-failed"))},Vv(`${XL()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw sh=null,e})}let sh=null;function Q3(n){return sh=sh||W3(n),sh}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J3=new Gc(5e3,15e3),Y3="__/auth/iframe",X3="emulator/auth/iframe",Z3={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},e$=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function t$(n){const e=n.config;xe(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Nv(e,X3):`https://${n.config.authDomain}/${Y3}`,r={apiKey:e.apiKey,appName:n.name,v:xa},s=e$.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Ul(r).slice(1)}`}async function n$(n){const e=await Q3(n),t=kn().gapi;return xe(t,n,"internal-error"),e.open({where:document.body,url:t$(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Z3,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=xr(n,"network-request-failed"),a=kn().setTimeout(()=>{i(o)},J3.get());function l(){kn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r$={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},s$=500,i$=600,o$="_blank",a$="http://localhost";class Nb{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function l$(n,e,t,r=s$,s=i$){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},r$),{width:r.toString(),height:s.toString(),top:i,left:o}),c=Mn().toLowerCase();t&&(a=nA(c)?o$:t),eA(c)&&(e=e||a$,l.scrollbars="yes");const d=Object.entries(l).reduce((g,[v,x])=>`${g}${v}=${x},`,"");if(BL(c)&&a!=="_self")return u$(e||"",a),new Nb(null);const f=window.open(e||"",a,d);xe(f,n,"popup-blocked");try{f.focus()}catch{}return new Nb(f)}function u$(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c$="__/auth/handler",d$="emulator/auth/handler",h$=encodeURIComponent("fac");async function Ob(n,e,t,r,s,i){xe(n.config.authDomain,n,"auth-domain-config-required"),xe(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:xa,eventId:s};if(e instanceof _i){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",HC(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,f]of Object.entries(i||{}))o[d]=f}if(e instanceof Zl){const d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const l=await n._getAppCheckToken(),c=l?`#${h$}=${encodeURIComponent(l)}`:"";return`${f$(n)}?${Ul(a).slice(1)}${c}`}function f$({config:n}){return n.emulator?Nv(n,d$):`https://${n.authDomain}/${c$}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jp="webStorageSupport";class p${constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=AA,this._completeRedirectFn=OA,this._overrideRedirectResult=V3}async _openPopup(e,t,r,s){var i;ui((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await Ob(e,t,r,Ic(),s);return l$(e,o,Vf())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Ob(e,t,r,Ic(),s);return s3(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(ui(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await n$(e),r=new U3(e);return t.register("authEvent",s=>(xe(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(jp,{type:jp},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[jp];o!==void 0&&t(!!o),Cr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=H3(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return aA()||tA()||Ov()}}const m$=p$;class LA{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return As("unexpected MultiFactorSessionType")}}}class Gv extends LA{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Gv(e)}_finalizeEnroll(e,t,r){return J4(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return m3(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class g${constructor(){}static assertion(e){return Gv._fromCredential(e)}}g$.FACTOR_ID="phone";class v${static assertionForEnrollment(e,t){return Pc._fromSecret(e,t)}static assertionForSignIn(e,t){return Pc._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;xe(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await Y4(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return Wv._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}v$.FACTOR_ID="totp";class Pc extends LA{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Pc(t,void 0,e)}static _fromEnrollmentId(e,t){return new Pc(t,e)}async _finalizeEnroll(e,t,r){return xe(typeof this.secret<"u",e,"argument-error"),X4(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){xe(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return g3(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class Wv{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new Wv(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(Md(e)||Md(t))&&(s=!0),s&&(Md(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),Md(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Md(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var Vb="@firebase/auth",Mb="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y${constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){xe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _$(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function b$(n){cs(new Yr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;xe(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:lA(n)},c=new WL(r,s,i,l);return r4(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),cs(new Yr("auth-internal",e=>{const t=bn(e.getProvider("auth").getImmediate());return(r=>new y$(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Rr(Vb,Mb,_$(n)),Rr(Vb,Mb,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w$=5*60,x$=Ax("authIdTokenMaxAge")||w$;let Lb=null;const I$=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>x$)return;const s=t==null?void 0:t.token;Lb!==s&&(Lb=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function E$(n=jl()){const e=fi(n,"auth");if(e.isInitialized())return e.getImmediate();const t=n4(n,{popupRedirectResolver:m$,persistence:[f3,EA,AA]}),r=Ax("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=I$(i.toString());K4(t,o,()=>o(t.currentUser)),H4(t,a=>o(a))}}const s=Ix("auth");return s&&s4(t,`http://${s}`),t}function T$(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}QL({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=xr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",T$().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});b$("Browser");const A$={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},Qv=Dx(A$),te=LV(Qv),Jv=_L(Qv),Le=E$(Qv);try{$V(te)}catch{}try{z4(Le,EA)}catch{}G4(Le,n=>{n||pA(Le)});async function S$(n,e){try{return(await O4(Le,n,e)).user}catch(t){throw t}}async function $A(n,e){try{return(await _A(Le,n,e)).user}catch(t){throw t}}async function Yv(n){try{await C4(Le,n)}catch(e){throw e}}async function P$(n){try{const e=Le.currentUser;if(e)await $4(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const Qr=Object.freeze(Object.defineProperty({__proto__:null,auth:Le,createPlayerAccount:S$,db:te,getMessaging:xg,resetPlayerPassword:Yv,signInPlayer:$A,storage:Jv,updatePlayerPassword:P$},Symbol.toStringTag,{value:"Module"})),Vm="BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8";async function Xv(){try{return await iI()}catch{return!1}}async function FA(){if(typeof navigator>"u"||!navigator.serviceWorker)return null;const n=await navigator.serviceWorker.getRegistration();if(n&&n.active)return n;const e=await navigator.serviceWorker.register("/service-worker.js");return new Promise(t=>{if(e.active){t(e);return}const r=()=>{e.active&&(e.removeEventListener("statechange",r),t(e))};e.addEventListener("statechange",r)})}async function UA(n){var i;if(!await Xv()||await Notification.requestPermission()!=="granted")return null;const t=xg(jl());let r=n||await FA();const s=await oI(t,r?{vapidKey:Vm,serviceWorkerRegistration:r}:{vapidKey:Vm});try{const o=((i=Le==null?void 0:Le.currentUser)==null?void 0:i.email)||"anonymous";o&&s&&await Xt(_e(te,"userPushTokens",o),{tokens:oM(s),lastToken:s,email:o,updatedAt:tr(),userAgent:navigator.userAgent,lastActivation:tr()},{merge:!0})}catch{}return s}async function Wu(){try{const n=localStorage.getItem("fcmToken");if(n){const r=xg(jl());try{const s=await oI(r,{vapidKey:Vm});if(s===n)return{active:!0,token:s}}catch{}}const e=await FA(),t=await UA(e);return t?(localStorage.setItem("fcmToken",t),{active:!0,token:t}):{active:!1,error:"Failed to get token"}}catch(n){return{active:!1,error:n.message}}}function R$(){setInterval(async()=>{try{const n=await Wu();n.active||(console.log("Push notifications inactive, attempting to reactivate..."),window.dispatchEvent(new CustomEvent("push-status-changed",{detail:n})))}catch(n){console.warn("Push health check failed:",n)}},5*60*1e3)}const C$=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function k$(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function jA(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function D$(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function BA(n){if(!n)return!1;const e=String(n).toLowerCase();return C$.some(t=>e.includes(t.toLowerCase()))}function Mm(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?D$(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>Mm(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=BA(t)?"••••":Mm(r);return e}return n}function N$(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&BA(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(Mm(r))}return e}const O$=jA(k$());function Ld(n,e){const t=jA(n);return(...r)=>{if(t<O$)return;const s=N$(r);console[e](...s)}}const N={debug:Ld("debug","log"),info:Ld("info","info"),warn:Ld("warn","warn"),error:Ld("error","error")},Zv="userNavigation";async function Yo(n,e,t={}){try{if(!n||!e){N.warn("Données manquantes pour tracker la navigation",{userId:n,path:e});return}if(["/reset-password","/magic","/join","/login","/signup"].some(o=>e.startsWith(o))){N.debug("Page exclue du tracking:",e);return}const s={userId:n,lastVisitedPage:e,lastVisitedAt:tr(),deviceInfo:L$(),...t},i=n.includes("@")?`email_${n.replace(/[^a-zA-Z0-9]/g,"_")}`:n;await Xt(_e(te,Zv,i),s,{merge:!0}),N.debug("Navigation trackée dans Firestore:",{userId:n,path:e,docId:i})}catch(r){N.error("Erreur lors du tracking de la navigation",r)}}async function V$(n){try{if(!n)return N.warn("Aucun userId fourni pour récupérer la navigation"),null;const e=n.includes("@")?`email_${n.replace(/[^a-zA-Z0-9]/g,"_")}`:n,t=_e(te,Zv,e),r=await Ht(t);if(r.exists()){const s=r.data();return N.debug("Dernière page visitée récupérée:",s),s}else return N.debug("Aucune navigation trouvée pour:",n),null}catch(e){return N.error("Erreur lors de la récupération de la navigation",e),null}}async function M$(n){try{if(!n){N.warn("Aucun userId fourni pour effacer la navigation");return}const e=n.includes("@")?`email_${n.replace(/[^a-zA-Z0-9]/g,"_")}`:n,t=_e(te,Zv,e);await Xt(t,{userId:n,lastVisitedPage:null,lastVisitedAt:tr(),cleared:!0}),N.debug("Historique de navigation effacé pour:",n)}catch(e){N.error("Erreur lors de l'effacement de la navigation",e)}}function $b(n){return!(!n||["/reset-password","/magic","/join","/login","/signup"].some(t=>n.startsWith(t))||n===window.location.pathname)}function L$(){try{return{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,timestamp:new Date().toISOString()}}catch{return{timestamp:new Date().toISOString()}}}function $$(){try{const n=localStorage.getItem("hatcast_current_user_id");if(n)return n;const t=new URLSearchParams(window.location.search).get("email");return t||null}catch(n){return N.error("Erreur lors de la récupération de l'ID utilisateur",n),null}}const F$={class:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between"},U$={class:"flex items-center space-x-3"},j$={class:"bg-white rounded-2xl shadow-2xl border border-gray-100 p-6 mx-4 max-w-sm w-full transform hover:scale-105 transition-all duration-300 cursor-pointer"},B$={class:"flex justify-center"},q$={key:0,class:"fixed inset-0 z-[200] flex items-center justify-center bg-black/50 backdrop-blur-sm"},z$={__name:"App",setup(n){const e=S(null),t=S(!1),r=S(!1),s=S(!1),i=S(!1),o=vo();Ct(()=>o.path,async(x,w)=>{if(x!==w){const I=$$();if(I){const L={};if(x.startsWith("/season/")){const $=x.split("/");$.length>=3&&(L.seasonSlug=$[2])}if(x.includes("/event/")){const $=x.match(/\/event\/([^\/]+)/);$&&(L.eventId=$[1])}await Yo(I,x,L)}}},{immediate:!0});function a(x){x.preventDefault(),e.value=x,t.value=!0;const w=localStorage.getItem("hatcast-pwa-banner-last-shown"),I=Date.now(),L=24*60*60*1e3;w&&I-parseInt(w)<L?t.value=!1:localStorage.setItem("hatcast-pwa-banner-last-shown",I.toString())}async function l(){if(e.value){try{e.value.prompt();const{outcome:x}=await e.value.userChoice;x==="accepted"?(console.log("PWA installée avec succès"),localStorage.setItem("hatcast-pwa-installed","true")):console.log("Installation PWA refusée par l'utilisateur")}catch(x){console.error("Erreur lors de l'installation PWA:",x)}t.value=!1,e.value=null,i.value=!0}}function c(){i.value=!0,localStorage.setItem("hatcast-pwa-banner-dismissed",Date.now().toString())}function d(){t.value=!1,e.value=null,i.value=!0,localStorage.setItem("hatcast-pwa-installed","true")}function f(){const x=localStorage.getItem("hatcast-pwa-installed"),w=localStorage.getItem("hatcast-pwa-banner-dismissed");if(x==="true"){t.value=!1;return}if(w){const I=Date.now(),L=60*60*1e3;I-parseInt(w)<L&&(i.value=!0)}}function g(){s.value=!0,console.log("🚀 Début de la mise à jour PWA..."),setTimeout(async()=>{try{if(console.log("📡 Vérification du service worker..."),"serviceWorker"in navigator){const x=await navigator.serviceWorker.getRegistration();console.log("🔍 Enregistrement SW trouvé:",x),x&&x.active?(console.log("✅ Service worker actif trouvé, envoi du message SKIP_WAITING..."),x.active.postMessage({type:"SKIP_WAITING"}),console.log("📤 Message SKIP_WAITING envoyé"),await new Promise(w=>setTimeout(w,500)),console.log("⏳ Attente de 500ms terminée"),x.waiting?(console.log("🔄 Service worker en attente détecté, attente de l'activation..."),await new Promise(w=>{const I=()=>{x.waiting?(console.log("⏳ Service worker toujours en attente, nouvelle vérification dans 100ms..."),setTimeout(I,100)):(console.log("✅ Service worker activé avec succès"),w())};I()})):console.log("ℹ️ Aucun service worker en attente")):console.warn("⚠️ Aucun service worker actif trouvé")}else console.warn("⚠️ Service Worker non supporté sur cet appareil");console.log("🔄 Rechargement de la page..."),window.location.reload()}catch(x){console.error("❌ Erreur lors de la mise à jour:",x),s.value=!1,alert(`Erreur lors de la mise à jour: ${x.message}

Veuillez rafraîchir manuellement la page.`)}},1e3)}function v(){r.value=!0}return An(()=>{f(),Wu().then(x=>{x.active?console.log("Notifications push actives au démarrage"):console.log("Notifications push inactives au démarrage:",x.error)}),window.addEventListener("beforeinstallprompt",a),window.addEventListener("appinstalled",d),window.addEventListener("pwa-update-test",v),"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{s.value||(r.value=!0)}),navigator.serviceWorker.addEventListener("message",x=>{x.data&&x.data.type==="SW_UPDATING"&&console.log("Service worker en cours de mise à jour...")}),setInterval(()=>{navigator.serviceWorker.getRegistration().then(x=>{x&&x.update()})},60*60*1e3))}),rg(()=>{window.removeEventListener("beforeinstallprompt",a),window.removeEventListener("appinstalled",d),window.removeEventListener("pwa-update-test",v)}),(x,w)=>{const I=YS("router-view");return k(),O(bt,null,[je(I),je(dp,{name:"install-banner",appear:""},{default:Fd(()=>[t.value&&!i.value?(k(),O("div",{key:0,class:"fixed top-0 left-0 right-0 z-[99999] bg-black text-white shadow-lg border-b border-gray-800",onClick:l},[h("div",F$,[w[1]||(w[1]=h("div",{class:"flex items-center space-x-3 flex-1"},[h("img",{src:IR,alt:"HatCast",class:"w-8 h-8 rounded-lg"}),h("div",{class:"flex-1"},[h("div",{class:"flex items-center space-x-2"},[h("span",{class:"font-semibold text-lg text-white"},"HatCast")]),h("p",{class:"text-sm text-gray-300 leading-tight"}," Installez l'app pour une meilleure expérience ")])],-1)),h("div",U$,[h("button",{class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",onClick:ft(l,["stop"])}," Installer "),h("button",{class:"text-gray-400 hover:text-white p-2 rounded-full hover:bg-gray-800 transition-colors",onClick:ft(c,["stop"]),"aria-label":"Fermer la barre d'installation"},w[0]||(w[0]=[h("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])])):ie("",!0)]),_:1}),je(dp,{name:"update-banner",appear:""},{default:Fd(()=>[r.value&&!s.value?(k(),O("div",{key:0,class:"fixed inset-0 z-[200] flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:g},[h("div",j$,[w[3]||(w[3]=h("div",{class:"flex justify-center mb-4"},[h("div",{class:"w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center shadow-lg"},[h("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})])])],-1)),w[4]||(w[4]=h("div",{class:"text-center mb-6"},[h("h3",{class:"text-xl font-bold text-gray-900 mb-2"}," 🎉 Nouvelle version disponible ! "),h("p",{class:"text-gray-600 leading-relaxed"}," HatCast a été amélioré avec de nouvelles fonctionnalités et corrections. Mettez à jour maintenant pour profiter des dernières améliorations. ")],-1)),h("div",B$,[h("button",{class:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 transition-all duration-200 flex items-center space-x-2",onClick:ft(g,["stop"])},w[2]||(w[2]=[h("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),h("span",null,"Mettre à jour maintenant",-1)]))]),w[5]||(w[5]=h("p",{class:"text-center text-xs text-gray-400 mt-4"}," Cliquez n'importe où pour fermer ",-1))])])):ie("",!0)]),_:1}),je(dp,{name:"update-progress",appear:""},{default:Fd(()=>[s.value?(k(),O("div",q$,w[6]||(w[6]=[h("div",{class:"bg-white rounded-2xl shadow-2xl border border-gray-100 p-8 mx-4 max-w-sm w-full text-center"},[h("div",{class:"flex justify-center mb-6"},[h("div",{class:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[h("svg",{class:"w-10 h-10 text-white animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})])])]),h("h3",{class:"text-xl font-bold text-gray-900 mb-3"}," Mise à jour en cours... "),h("p",{class:"text-gray-600"}," Veuillez patienter pendant qu'HatCast se met à jour "),h("div",{class:"mt-6 bg-gray-200 rounded-full h-2 overflow-hidden"},[h("div",{class:"bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full animate-pulse"})])],-1)]))):ie("",!0)]),_:1})],64)}}},H$="modulepreload",K$=function(n){return"/"+n},Fb={},mt=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=K$(i),i in Fb)return;Fb[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":H$,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((d,f)=>{c.addEventListener("load",d),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function G$(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=n;let a,l;const c=async(f=!0)=>{await l};async function d(){if("serviceWorker"in navigator){const{Workbox:f}=await mt(()=>import("./workbox-window.prod.es5-5ffdab76.js"),[]);a=new f("/service-worker.js",{scope:"/",type:"classic"}),a.addEventListener("activated",g=>{(g.isUpdate||g.isExternal)&&window.location.reload()}),a.addEventListener("installed",g=>{g.isUpdate||r==null||r()}),a.register({immediate:e}).then(g=>{i?i("/service-worker.js",g):s==null||s(g)}).catch(g=>{o==null||o(g)})}}return l=d(),c}const Ca="seasons";async function W$(n,e,t,r="",s=""){return await Sa(tt(te,Ca),{name:n,slug:e,pinCode:t,description:r,logoUrl:s,createdAt:tr()})}async function Q$(n){return await $l(_e(te,Ca,n))}async function sl(){const n=xc(tt(te,Ca),HV("createdAt","desc"));return(await Ft(n)).docs.map(t=>({id:t.id,...t.data()}))}async function Vh(n,e){const t=await Ht(_e(te,Ca,n));return t.exists()?t.data().pinCode===e:!1}async function Lm(n){const e=await Ht(_e(te,Ca,n));return e.exists()?e.data().pinCode:null}async function xu(n,e){const t=_e(te,Ca,n);await Io(t,{sortOrder:e})}async function J$(n,e){const t=_e(te,Ca,n);await Io(t,e)}const ey="lastVisitedSeason",qA="lastVisitedSeasonTimestamp";async function Y$(n){if(n)try{const e=Le.currentUser,t=e==null?void 0:e.email;try{localStorage.setItem(ey,n),localStorage.setItem(qA,Date.now().toString())}catch(r){N.warn("Erreur lors de la sauvegarde localStorage",r)}if(t)try{const r=_e(te,"userPreferences",t);await Xt(r,{lastVisitedSeason:n,lastVisitedSeasonTimestamp:Date.now()},{merge:!0}),N.debug("Préférence de saison sauvegardée dans Firebase",{seasonSlug:n,userEmail:t})}catch(r){N.warn("Erreur lors de la sauvegarde Firebase",r)}}catch(e){N.error("Erreur lors de la mémorisation de la saison",e)}}async function zA(){try{const n=Le.currentUser,e=n==null?void 0:n.email;if(e)try{const t=_e(te,"userPreferences",e),r=await Ht(t);if(r.exists()){const s=r.data();if(s.lastVisitedSeason)return N.debug("Préférence de saison récupérée depuis Firebase",{seasonSlug:s.lastVisitedSeason}),s.lastVisitedSeason}}catch(t){N.warn("Erreur lors de la récupération Firebase",t)}try{const t=localStorage.getItem(ey);if(t)return N.debug("Préférence de saison récupérée depuis localStorage",{seasonSlug:t}),t}catch(t){N.warn("Erreur lors de la lecture localStorage",t)}return null}catch(n){return N.error("Erreur lors de la récupération de la dernière saison",n),null}}async function X$(n=null){var e;try{const t=n||((e=Le.currentUser)==null?void 0:e.email);try{localStorage.removeItem(ey),localStorage.removeItem(qA)}catch(r){N.warn("Erreur lors du nettoyage localStorage",r)}if(t)try{const r=_e(te,"userPreferences",t);await Xt(r,{lastVisitedSeason:null,lastVisitedSeasonTimestamp:null},{merge:!0}),N.debug("Préférence de saison nettoyée dans Firebase",{userEmail:t})}catch(r){N.warn("Erreur lors du nettoyage Firebase",r)}}catch(t){N.error("Erreur lors du nettoyage des préférences",t)}}function Z$(n,e){return!n||!e||!Array.isArray(e)?!1:e.some(t=>t.slug===n)}const Ss=S(null),Zi=S(!1),Ws=S(!1),eF=He(()=>{var n;return!!Ss.value&&!((n=Ss.value)!=null&&n.isAnonymous)});He(()=>!!Ss.value);function yl(){var n;try{const e=Le.currentUser;e!==Ss.value&&(Ss.value=e,N.debug("Synchronisation forcée de l'état d'authentification",{user:((n=Ss.value)==null?void 0:n.email)||"non connecté"}))}catch(e){N.error("Erreur lors de la synchronisation forcée",e)}}function tF(){var n;if(N.debug("Tentative d'initialisation du service d'authentification",{isInitialized:Zi.value,isInitializing:Ws.value}),Zi.value||Ws.value){N.debug("Service déjà initialisé ou en cours d'initialisation, sortie");return}Ws.value=!0,N.debug("Marquage du service comme en cours d'initialisation");try{Ss.value=Le.currentUser,N.debug("État initial de l'utilisateur:",((n=Ss.value)==null?void 0:n.email)||"non connecté");const e=Le.onAuthStateChanged(async t=>{const r=Ss.value;Ss.value=t,Zi.value=!0,Ws.value=!1,N.debug("État d'authentification changé",{isLoggedIn:!!t,email:(t==null?void 0:t.email)||"non connecté"});try{if(t&&!r){const s=window.location.pathname;s&&s!=="/"&&(await Yo(t.uid,s),N.debug("Navigation trackée pour nouvelle connexion:",s))}else!t&&r&&(await M$(r.uid),N.debug("Historique de navigation effacé pour déconnexion"))}catch(s){N.error("Erreur lors du tracking de navigation:",s)}});window._authStateUnsubscribe=e,N.info("Service d'état d'authentification initialisé avec succès")}catch(e){N.error("Erreur lors de l'initialisation du service d'authentification:",e),Ws.value=!1}}function HA(){return new Promise((n,e)=>{if(N.debug("waitForInitialization appelé",{isInitialized:Zi.value,isInitializing:Ws.value}),Zi.value){N.debug("Service déjà initialisé, résolution immédiate"),n();return}if(!Ws.value){N.warn("Service d'authentification non initialisé et non en cours d'initialisation"),e(new Error("Service d'authentification non initialisé"));return}const t=setInterval(()=>{N.debug("Vérification de l'initialisation...",{isInitialized:Zi.value,isInitializing:Ws.value}),Zi.value&&(clearInterval(t),N.debug("Service initialisé, résolution"),n())},100);setTimeout(()=>{clearInterval(t),N.warn("Timeout de waitForInitialization, rejet de la promesse"),e(new Error("Timeout d'initialisation du service d'authentification"))},5e3)})}function nF(){N.debug("Initialisation forcée demandée"),!Zi.value&&!Ws.value&&Mh()}function Mh(){if(N.debug("Tentative d'auto-initialisation du service d'authentification"),typeof Le>"u"||!Le){N.warn("Firebase auth non disponible, nouvelle tentative dans 500ms"),setTimeout(Mh,500);return}try{tF()}catch(n){N.error("Erreur lors de l'auto-initialisation:",n),setTimeout(Mh,1e3)}}setTimeout(Mh,100);const rF={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center"},sF={class:"text-center"},iF={class:"text-white text-lg"},oF={__name:"SeasonResolver",setup(n){const e=ba(),t=S("Chargement...");return An(async()=>{try{if(new URLSearchParams(window.location.search).get("p")==="reset-password"){N.info("Redirection vers la page de reset password"),e.replace("/reset-password");return}t.value="Vérification de votre session...",yl(),await HA();const i=await new Promise((l,c)=>{const d=setTimeout(()=>{c(new Error("Timeout Firebase Auth"))},3e3),f=Le.onAuthStateChanged(g=>{clearTimeout(d),f(),l(g)});Le.currentUser&&(clearTimeout(d),f(),l(Le.currentUser))}),o=i==null?void 0:i.email;if(!o){N.info("Utilisateur non connecté, redirection vers /seasons"),e.replace("/seasons");return}t.value="Récupération de vos préférences...";const a=await zA();if(!a){N.info("Aucune saison mémorisée, redirection vers /seasons"),e.replace("/seasons");return}t.value="Vérification de la saison...";try{const l=await sl();if(!Z$(a,l)){N.info("Saison mémorisée n'existe plus, redirection vers /seasons"),await X$(o),e.replace("/seasons");return}}catch(l){N.error("Erreur lors de la vérification des saisons",l),e.replace("/seasons");return}N.info("Redirection vers la saison mémorisée",{seasonSlug:a}),e.replace(`/season/${a}`)}catch(r){N.error("Erreur lors de la résolution de la saison",r),e.replace("/seasons")}}),(r,s)=>(k(),O("div",rF,[h("div",sF,[s[0]||(s[0]=h("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"},null,-1)),h("p",iF,ee(t.value),1)])]))}},aF="/logos/hatcast-mask.png",$m="/logos/hatcast-logo-mobile.png";async function lF(n,e=800,t=800,r=.8){return new Promise((s,i)=>{const o=document.createElement("canvas"),a=o.getContext("2d"),l=new Image;l.onload=()=>{let{width:c,height:d}=l;c>e&&(d=d*e/c,c=e),d>t&&(c=c*t/d,d=t),o.width=c,o.height=d,a.drawImage(l,0,0,c,d),o.toBlob(f=>{if(f){const g=new File([f],n.name,{type:"image/jpeg",lastModified:Date.now()});s(g)}else i(new Error("Erreur lors du redimensionnement"))},"image/jpeg",r)},l.onerror=()=>i(new Error("Erreur lors du chargement de l'image")),l.src=URL.createObjectURL(n)})}async function KA(){if(!Le.currentUser){N.info("Aucun utilisateur connecté, tentative de connexion anonyme...");try{await pA(Le),N.info("Connexion anonyme réussie")}catch(n){throw N.error("Erreur lors de la connexion anonyme:",n),new Error("Impossible de s'authentifier: "+n.message)}}await new Promise(n=>setTimeout(n,1e3))}async function uF(n,e,t={}){var r;try{if(N.info("Début upload image",{fileName:n.name,path:e,originalSize:`${(n.size/1024/1024).toFixed(2)}MB`}),await KA(),!n.type.startsWith("image/"))throw new Error("Le fichier doit être une image");if(n.size>10*1024*1024)throw new Error("L'image est trop volumineuse (max 10MB)");let s=n;if(t.resize!==!1&&(n.size>1024*1024||t.forceResize)){N.info("Redimensionnement de l'image pour optimiser les performances...");try{s=await lF(n,t.maxWidth||800,t.maxHeight||800,t.quality||.8),N.info("Image redimensionnée",{newSize:`${(s.size/1024/1024).toFixed(2)}MB`,compression:`${((1-s.size/n.size)*100).toFixed(1)}%`})}catch(x){N.warn("Erreur lors du redimensionnement, utilisation du fichier original:",x),s=n}}const a=`${Date.now()}_${n.name}`,l=`${e}/${a}`,c=qT(Jv,l);N.info("Tentative d'upload vers Firebase Storage...",{fullPath:l,user:(r=Le.currentUser)==null?void 0:r.uid,isAuthenticated:!!Le.currentUser,finalSize:`${(s.size/1024/1024).toFixed(2)}MB`});const d=gL(c,s),f=new Promise((x,w)=>setTimeout(()=>w(new Error("Timeout: Upload trop long")),3e4)),g=await Promise.race([d,f]);N.info("Image uploadée avec succès",{fullPath:l});const v=await vL(g.ref);return N.info("URL de téléchargement récupérée",{downloadURL:v}),v}catch(s){if(N.error("Erreur lors de l'upload de l'image",s),s.message.includes("CORS")||s.message.includes("preflight")||s.message.includes("permission")||s.message.includes("unauthenticated")||s.message.includes("ERR_FAILED")||s.message.includes("Timeout"))return N.warn("Erreur d'accès détectée, utilisation du stockage local temporaire",s.message),await cF(n,e);throw s}}async function cF(n,e){return new Promise((t,r)=>{const s=new FileReader;s.onload=i=>{const o=i.target.result;N.info("Image stockée localement en base64",{path:e}),t(o)},s.onerror=()=>r(new Error("Erreur lors de la lecture du fichier")),s.readAsDataURL(n)})}async function dF(n){var e;try{if(N.info("Début suppression image",{imageUrl:n}),n.startsWith("data:image/")){N.info("Image locale (base64), suppression ignorée");return}await KA();const r=(e=new URL(n).pathname.split("/o/")[1])==null?void 0:e.split("?")[0];if(!r)throw new Error("Impossible d'extraire le chemin de l'image");const s=decodeURIComponent(r),i=qT(Jv,s);await yL(i),N.info("Image supprimée avec succès",{decodedPath:s})}catch(t){throw N.error("Erreur lors de la suppression de l'image",t),t}}function hF(n){return n&&n.includes("firebasestorage.googleapis.com")}const Bp=7*24*60*60*1e3,Iu="hatcast_pin_session";class fF{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(Iu);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<Bp){try{t.timestamp=Date.now(),localStorage.setItem(Iu,JSON.stringify(t))}catch{}return t}else this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(Iu,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){if(!this.sessionData)return!1;const t=this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<Bp;if(t)try{this.sessionData.timestamp=Date.now(),localStorage.setItem(Iu,JSON.stringify(this.sessionData))}catch{}return t}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(Iu),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=Bp-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const Qn=new fF,pF={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},mF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},gF={class:"text-center mb-6"},vF={class:"text-gray-300"},yF={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},_F={class:"text-sm text-green-400"},bF={class:"mb-6"},wF={class:"mb-4"},xF={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},IF={class:"flex justify-end space-x-3"},EF=["disabled"],GA={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(""),o=S(null);Ct(()=>t.show,d=>{d&&(s.value="",i.value="",jt(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(d,f)=>n.show?(k(),O("div",pF,[h("div",mF,[h("div",gF,[f[1]||(f[1]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),h("p",vF,ee(n.message),1),n.sessionInfo?(k(),O("div",yF,[h("p",_F," Session active : "+ee(n.sessionInfo.timeRemaining)+" min restantes ",1)])):ie("",!0)]),h("div",bF,[h("div",wF,[f[3]||(f[3]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),it(h("input",{"onUpdate:modelValue":f[0]||(f[0]=g=>s.value=g),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[or(l,["enter"]),or(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[$t,s.value]])]),f[4]||(f[4]=h("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(k(),O("div",xF,ee(i.value||t.error),1)):ie("",!0),h("div",IF,[h("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,EF)])])])):ie("",!0)}},Ub="hatcast_trusted_players",jb=180*24*60*60*1e3;class TF{constructor(){this.trustedMap=this.load()}load(){try{const e=localStorage.getItem(Ub);if(!e)return{};const t=JSON.parse(e);return typeof t=="object"&&t!==null?t:{}}catch{return{}}}persist(){try{localStorage.setItem(Ub,JSON.stringify(this.trustedMap))}catch{}}isPasswordCached(e){if(!e)return!1;const t=this.trustedMap[e];if(!t)return!1;const r=Date.now(),s=r-t<jb;return s?(this.trustedMap[e]=r,this.persist()):(delete this.trustedMap[e],this.persist()),s}getCachedPassword(e){return null}saveSession(e,t){e&&(this.trustedMap[e]=Date.now(),this.persist())}clearSession(e){e&&(delete this.trustedMap[e],this.persist())}clearExpiredSessions(){const e=Date.now();let t=!1;for(const[r,s]of Object.entries(this.trustedMap))e-s>jb&&(delete this.trustedMap[r],t=!0);t&&this.persist()}clearAllSessions(){this.trustedMap={},this.persist()}}const mo=new TF,$f=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},AF={};function SF(n,e){return k(),O(bt,null,[e[0]||(e[0]=h("div",{class:"text-gray-300"},"🎭 Ça marche déjà super bien sans, mais avec un compte, c'est encore plus cool :",-1)),e[1]||(e[1]=h("div",null,[ut("• "),h("span",{class:"text-blue-300"},"🔒 Tes dispos sont à l'abri :"),ut(" plus personne ne peut modifier tes choix à ta place")],-1)),e[2]||(e[2]=h("div",null,[ut("• "),h("span",{class:"text-blue-300"},"📧 Alertes VIP :"),ut(" sois le premier informé des nouveaux spectacles et sélections")],-1)),e[3]||(e[3]=h("div",null,[ut("• "),h("span",{class:"text-blue-300"},"⚡ Saisie express :"),ut(" ton nom reste en haut de la liste, plus besoin de le chercher")],-1))],64)}const Bb=$f(AF,[["render",SF]]),PF={key:0,class:"mt-4"},RF={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-2"},CF={key:1},kF={key:0,class:"mt-3 pt-3 border-t border-blue-500/20 text-sm text-gray-300 space-y-2"},ty={__name:"AccountBenefitsHint",props:{inline:{type:Boolean,default:!1}},setup(n){const e=S(!1);return(t,r)=>n.inline?(k(),O("div",CF,[h("button",{onClick:r[1]||(r[1]=s=>e.value=!e.value),class:"text-blue-300 hover:text-blue-200 text-sm font-medium flex items-center gap-2 transition-colors"},[r[3]||(r[3]=h("span",null,"À quoi sert un compte ?",-1)),h("span",{class:dn(["transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(k(),O("div",kF,[je(Bb)])):ie("",!0)])):(k(),O("div",PF,[h("button",{onClick:r[0]||(r[0]=s=>e.value=!e.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[r[2]||(r[2]=h("h3",{class:"text-sm font-semibold text-blue-300"},"💡 À quoi sert un compte ?",-1)),h("span",{class:dn(["text-blue-300 transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(k(),O("div",RF,[je(Bb)])):ie("",!0)]))}},DF={class:"space-y-4"},NF={class:"flex items-center justify-between"},OF={class:"flex items-center gap-2 text-gray-300 text-sm"},VF={key:0,class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},MF={key:1,class:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm"},LF={class:"flex justify-center gap-3 mt-2"},$F=["disabled"],FF={key:0,class:"animate-spin"},UF={key:1},WA={__name:"AccountLoginModal",props:{show:{type:Boolean,default:!1}},emits:["close","success"],setup(n,{emit:e}){const t=e,r=S(""),s=S(""),i=S(!1),o=S(""),a=S(""),l=S(!0),c=He(()=>!!r.value&&r.value.includes("@")&&!!s.value);async function d(){if(c.value){i.value=!0,o.value="",a.value="";try{if(await $A(r.value.trim(),s.value),l.value)try{mo.saveSession(r.value.trim())}catch{}t("success")}catch{o.value="Email ou mot de passe incorrect"}finally{i.value=!1}}}async function f(){if(!r.value||!r.value.includes("@")){o.value="Saisissez votre email pour recevoir un lien de réinitialisation",setTimeout(()=>{o.value=""},2500);return}i.value=!0,o.value="",a.value="";try{await Yv(r.value.trim()),a.value="Email de réinitialisation envoyé"}catch{o.value="Impossible d'envoyer l'email de réinitialisation"}finally{i.value=!1}}return(g,v)=>n.show?(k(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:v[6]||(v[6]=x=>g.$emit("close"))},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:v[5]||(v[5]=ft(()=>{},["stop"]))},[h("button",{onClick:v[0]||(v[0]=x=>g.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),v[10]||(v[10]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Se connecter</h2><p class="text-sm text-gray-300">Connectez-vous pour gérer votre compte et vos préférences</p></div>',1)),h("div",DF,[je(ty),h("div",null,[v[7]||(v[7]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Email",-1)),it(h("input",{"onUpdate:modelValue":v[1]||(v[1]=x=>r.value=x),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[$t,r.value]])]),h("div",null,[v[8]||(v[8]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),it(h("input",{"onUpdate:modelValue":v[2]||(v[2]=x=>s.value=x),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe"},null,512),[[$t,s.value]])]),h("div",NF,[h("label",OF,[it(h("input",{type:"checkbox","onUpdate:modelValue":v[3]||(v[3]=x=>l.value=x),class:"w-4 h-4"},null,512),[[Yi,l.value]]),v[9]||(v[9]=h("span",null,"Rester connecté sur cet appareil",-1))]),h("button",{onClick:f,class:"text-sm text-blue-400 hover:text-blue-300 underline"},"Mot de passe oublié ?")]),o.value?(k(),O("div",VF,ee(o.value),1)):ie("",!0),a.value?(k(),O("div",MF,ee(a.value),1)):ie("",!0),h("div",LF,[h("button",{onClick:d,disabled:!c.value||i.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(k(),O("span",FF,"⏳")):(k(),O("span",UF,"Se connecter"))],8,$F),h("button",{onClick:v[4]||(v[4]=x=>g.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])])):ie("",!0)}},Ff="magicLinks";function Uf({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function ny(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function Lh({seasonId:n,playerId:e,eventId:t,action:r,slug:s}){const i=Uf({seasonId:n,playerId:e,eventId:t,action:r}),o=ny(40),a=_e(te,Ff,i),l=Date.now()+1e3*60*60*24*7;await Xt(a,{seasonId:n,playerId:e,eventId:t,token:o,action:r,expiresAt:l});let d=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(r)}`;return s&&(d+=`&slug=${encodeURIComponent(s)}`),{id:i,token:o,url:d}}async function QA({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=Uf({seasonId:n,playerId:e,eventId:r,action:s}),o=ny(40),a=_e(te,Ff,i),l=Date.now()+1e3*60*60*24*7;await Xt(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const d=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:d}}async function JA({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=Uf({seasonId:n,playerId:e,eventId:t,action:s}),o=_e(te,Ff,i),a=await Ht(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function Fm({seasonId:n,playerId:e,eventId:t,action:r}){const s=Uf({seasonId:n,playerId:e,eventId:t,action:r}),i=_e(te,Ff,s);await $l(i)}const ry="accountMagicLinks";function jf(n){return`account__${n}`}async function YA({currentEmail:n,newEmail:e}){const t=ny(40),r=jf(t),s=_e(te,ry,r),i=Date.now()+1e3*60*60*24*7;await Xt(s,{token:t,currentEmail:n,newEmail:e,action:"account_email_update",expiresAt:i});const a=`${window.location.origin+"/"}magic?a=account_email_update&t=${encodeURIComponent(t)}`;return{id:r,token:t,url:a}}async function XA({token:n}){const e=jf(n),t=_e(te,ry,e),r=await Ht(t);if(!r.exists())return{valid:!1,reason:"not_found"};const s=r.data();return s.token!==n?{valid:!1,reason:"token_mismatch"}:typeof s.expiresAt=="number"&&Date.now()>s.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:s}}async function ZA({token:n}){const e=jf(n),t=_e(te,ry,e);await $l(t)}const e1=Object.freeze(Object.defineProperty({__proto__:null,buildAccountId:jf,consumeAccountEmailUpdateLink:ZA,consumeMagicLink:Fm,createAccountEmailUpdateLink:YA,createEmailVerificationLink:QA,createMagicLink:Lh,verifyAccountEmailUpdateLink:XA,verifyMagicLink:JA},Symbol.toStringTag,{value:"Module"}));async function Zc({toEmail:n,title:e,body:t,data:r={},reason:s="generic"}){if(!n)return{success:!1,error:"missing_toEmail"};const i={to:n,title:e,body:t,data:r,reason:s,createdAt:tr()};return await Sa(tt(te,"pushQueue"),i),{success:!0}}function jF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,yesUrl:s,noUrl:i}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>${n?`<strong>${n}</strong>`:"<strong>Hello</strong>"},</p>
      <p>🎯 <strong>Nouveau spectacle à l'horizon !</strong></p>
      <p>Es-tu dispo le ${t} pour <a href="${r}" style="color:#3b82f6;text-decoration:underline;font-weight:600;">${e}</a> ?</p>
      <p>🎭 <em>On a besoin de toi pour que ça brille ! ✨</em></p>
      <p style="margin-top: 12px; text-align: center;">
        <a href="${s}" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;">✅ Dispo</a>
        <a href="${i}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
      </p>
      <p style="margin-top: 16px; color:#6b7280;">Détails : <a href="${r}" style="color:#3b82f6;text-decoration:underline;">${r}</a></p>
    </div>
  `}function BF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`${n?`${n}`:"Hello"},

🎯 Nouveau spectacle à l'horizon ! 

Es-tu dispo le ${t} pour ${e} ?

🎭 On a besoin de toi pour que ça brille ! ✨

✅ Dispo ❌ Pas dispo

Lien direct : ${r}`}function qF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`${n?`Bonjour ${n}`:"Hello"},

Tu es sélectionné(e) pour ${e} le ${t}!

🕺 Prépares-toi à briller, toute l'équipe compte sur toi!

Un imprévu ?😬 
Pas de souci, signales vite ton indisponibilité ici pour qu'on relance la sélection du spectacle : ${r}`}function zF({playerName:n,eventTitle:e,eventUrl:t,activationUrl:r,seasonTitle:s}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>${n?`<strong>${n}</strong>`:"<strong>Hello</strong>"},</p>
      <p>🔔 <strong>Active tes notifications pour ne rien rater !</strong></p>
      <p>Tu veux être informé(e) en temps réel de <strong>tous tes événements</strong> de la saison <strong>${s}</strong> ?</p>
      <p>🎯 <em>Clique sur le bouton ci-dessous pour activer tes notifications et recevoir des alertes pour tes événements !</em></p>
      <p style="margin-top: 16px; text-align: center;">
        <a href="${r}" style="display:inline-block;padding:12px 24px;background:linear-gradient(135deg, #8b5cf6, #ec4899);color:white;border-radius:8px;text-decoration:none;font-weight:600;box-shadow:0 4px 12px rgba(139, 92, 246, 0.3);">🔔 Activer mes notifications</a>
      </p>
      <p style="margin-top: 16px; color:#6b7280; font-size: 14px;">
        <em>En activant tes notifications, tu recevras des alertes pour :</em><br>
        • Les demandes de disponibilité<br>
        • Les sélections de joueurs<br>
        • Les changements d'horaires<br>
        • Les annonces importantes
      </p>
      <p style="margin-top: 16px; color:#6b7280;">Détails de l'événement : <a href="${t}" style="color:#3b82f6;text-decoration:underline;">${t}</a></p>
    </div>
  `}const HF="HatCast <impropick@gmail.com>",KF="impropick@gmail.com";function ed(n=null){return{from:n||HF,replyTo:n||KF}}async function GF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,eventUrl:o=void 0,reason:a="new_event",fromEmail:l=void 0}){try{const v=_e(te,"userPreferences",n),x=await Ht(v);if(x.exists()){const w=x.data();if((w==null?void 0:w.notifyAvailability)===!1)return{success:!0,skipped:!0}}}catch{}const c=jF({playerName:e,eventTitle:t,eventDate:r,eventUrl:o,yesUrl:s,noUrl:i}),d=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,f={to:n,message:{subject:d,html:c},createdAt:tr(),meta:{reason:a,eventTitle:t,eventDate:r,playerName:e}},g=ed(l);f.from=g.from,f.replyTo=g.replyTo,await Sa(tt(te,"mail"),f);try{const v=_e(te,"userPreferences",n),x=await Ht(v),w=x.exists()?x.data():{};if((w==null?void 0:w.notifyAvailabilityPush)!==!1){const I=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,L=`${e}, t'es dispo ?`;await Zc({toEmail:n,title:I,body:L,data:{url:o||window.location.origin,yesUrl:s,noUrl:i,reason:a},reason:a==="reminder"?"availability_reminder":"availability_request"})}}catch{}return{success:!0}}async function t1({toEmail:n,verifyUrl:e,purpose:t="player_protection",displayName:r="utilisateur",fromEmail:s=void 0}){const i=t==="account_email_update",o=i?"Vérification de votre nouvelle adresse email":"Vérification de votre email",a=`Bonjour ${r},`,l=i?"Pour sécuriser votre compte, merci de confirmer que vous avez accès à cette nouvelle adresse email.":"Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.",c=i?"Confirmer mon adresse email":"Vérifier mon email",d=i?"Confirmez votre nouvelle adresse email":"Confirmez votre email pour activer la protection",f=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>${o}</h2>
      <p>${a}</p>
      <p>${l}</p>
      <p>
        <a href="${e}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">${c}</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,g={to:n,message:{subject:d,html:f},createdAt:tr(),meta:{reason:t,displayName:r}},v=ed(s);g.from=v.from,g.replyTo=v.replyTo,await Sa(tt(te,"mail"),g)}async function WF({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){return t1({toEmail:n,verifyUrl:t,purpose:"player_protection",displayName:e,fromEmail:r})}async function QF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0,noUrl:l=void 0}){try{const v=_e(te,"userPreferences",n),x=await Ht(v);if(x.exists()){const w=x.data();if((w==null?void 0:w.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}N.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const c=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,d=o||`🎭 Sélection confirmée · ${t}`;N.debug("queueSelectionEmail html/subject ready");const f={to:n,message:{subject:d,html:c},createdAt:tr(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}},g=ed(a);f.from=g.from,f.replyTo=g.replyTo,N.debug("queueSelectionEmail firestore payload ready");try{await Sa(tt(te,"mail"),f);try{const v=_e(te,"userPreferences",n),x=await Ht(v),w=x.exists()?x.data():{};console.log("Préférences utilisateur pour notifications push",{toEmail:n,prefs:w,notifySelectionPush:w==null?void 0:w.notifySelectionPush,shouldSendPush:(w==null?void 0:w.notifySelectionPush)!==!1}),(w==null?void 0:w.notifySelectionPush)!==!1?(console.log("Envoi notification push de sélection",{toEmail:n,playerName:e,eventTitle:t}),await Zc({toEmail:n,title:"🎭 Sélection confirmée",body:`${e}, tu as été sélectionné(e) pour ${t} (${r}) 🎉`,data:{url:s||window.location.origin,noUrl:l},reason:"selection"}),console.log("Notification push de sélection envoyée avec succès")):console.log("Notification push de sélection désactivée par préférences utilisateur")}catch(v){console.error("Erreur lors de l'envoi de la notification push de sélection",v)}return N.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(v){throw N.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:v}),v}}async function JF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,newSelectedPlayers:i=[],html:o=void 0,subject:a=void 0,fromEmail:l=void 0}){try{const x=_e(te,"userPreferences",n),w=await Ht(x);if(w.exists()){const I=w.data();if((I==null?void 0:I.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}const c=Array.isArray(i)?i.join(", "):"",d=o||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Sélection mise à jour</h2>
      <p>Bonjour ${e},</p>
      <p>La sélection pour <strong>${t}</strong> (${r}) a été mise à jour et tu n'en fais plus partie 😔.</p>
      ${c?`<p>Nouvelle sélection: <strong>${c}</strong>.</p>`:""}
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#6b7280;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: mise à jour de sélection (relance auto ou ajustement manuel).</p>
    </div>
  `,f=a||`🎭 Tu n'es plus dans la sélection · ${t}`,g={to:n,message:{subject:f,html:d},createdAt:tr(),meta:{reason:"deselection",eventTitle:t,eventDate:r,playerName:e,newSelectedPlayers:i}},v=ed(l);g.from=v.from,g.replyTo=v.replyTo,await Sa(tt(te,"mail"),g);try{const x=_e(te,"userPreferences",n),w=await Ht(x),I=w.exists()?w.data():{};(I==null?void 0:I.notifySelectionPush)!==!1&&await Zc({toEmail:n,title:"🎭 Sélection mise à jour",body:`${e}, tu n'es plus sélectionné(e) pour ${t} (${r}) 😔`,data:{url:s||window.location.origin,noUrl:s&&s.includes("/event/")?s.replace("/event/","/magic?auto=no&event="):void 0},reason:"deselection"})}catch{}return{success:!0}}async function YF({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(N.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await mt(()=>Promise.resolve().then(()=>td),void 0),{createMagicLink:a}=await mt(()=>Promise.resolve().then(()=>e1),void 0),l=`${window.location.origin}/season/${s}/event/${n}`;t.join(", ");const c=`🎭 Sélection confirmée · ${e.title}`,d=[];for(const f of t){N.debug("Traitement du joueur",{playerName:f});try{const g=i==null?void 0:i.find($=>$.name===f);if(!g){N.warn("Joueur non trouvé",{playerName:f});continue}N.debug("Joueur trouvé");const v=await o(g.id,r);if(!v){N.warn("Pas d'email pour le joueur",{playerName:f});continue}N.debug("Email trouvé pour joueur");const w=`${(await a({seasonId:r,playerId:g.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,I=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${$h(e.date)}).</p>
          <p>Un imprévu ?</p>
          <p>
            <a href="${w}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;margin-right:8px;">❌ Plus dispo</a>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
          </p>
        </div>
      `;N.debug("HTML généré pour joueur");const L=QF({toEmail:v,playerName:f,eventTitle:e.title,eventDate:$h(e.date),eventUrl:l,html:I,subject:c,noUrl:w});d.push(L),N.info("Email ajouté à la queue",{playerName:f})}catch(g){N.error("Erreur lors de l'envoi de l'email de sélection",{playerName:f,error:g})}}return N.info("Nombre total d'emails à envoyer",{count:d.length}),await Promise.all(d),N.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:d.length}}async function XF({eventId:n,eventData:e,removedPlayers:t,newSelectedPlayers:r,seasonId:s,seasonSlug:i,players:o}){if(N.info("sendDeselectionEmailsForEvent",{eventId:n,seasonId:s,removedCount:t==null?void 0:t.length}),!e||!t||t.length===0)return{success:!0,count:0};const{getPlayerEmail:a}=await mt(()=>Promise.resolve().then(()=>td),void 0),l=`${window.location.origin}/season/${i}/event/${n}`,c=[],d=Array.isArray(r)?r.join(", "):"";for(const f of t)try{const g=o==null?void 0:o.find(w=>w.name===f);if(!g){N.warn("Joueur retiré non trouvé",{playerName:f});continue}const v=await a(g.id,s);if(!v){N.warn("Pas d'email pour le joueur retiré",{playerName:f});continue}const x=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection mise à jour</h2>
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu n'es plus sélectionné(e) pour <strong>${e.title}</strong> (${$h(e.date)}) 😔.</p>
          ${d?`<p>Nouvelle sélection: <strong>${d}</strong>.</p>`:""}
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #6b7280;color:#6b7280;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;c.push(JF({toEmail:v,playerName:f,eventTitle:e.title,eventDate:$h(e.date),eventUrl:l,newSelectedPlayers:r,html:x}))}catch(g){N.error("Erreur lors de l'envoi de l'email de désélection",{playerName:f,error:g})}return await Promise.all(c),N.info("Emails de désélection envoyés",{count:c.length}),{success:!0,count:c.length}}function $h(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}async function ZF({toEmail:n,playerName:e,eventTitle:t,eventUrl:r,activationUrl:s,seasonTitle:i,fromEmail:o=void 0}){const a=zF({playerName:e,eventTitle:t,eventUrl:r,activationUrl:s,seasonTitle:i}),l=`🔔 Active tes notifications pour ${i}`,c={to:n,message:{subject:l,html:a},createdAt:tr(),meta:{reason:"notification_activation",eventTitle:t,playerName:e}},d=ed(o);c.from=d.from,c.replyTo=d.replyTo;try{return await Sa(tt(te,"mail"),c),N.info("Email d'activation des notifications ajouté à la queue",{toEmail:n,playerName:e}),{success:!0}}catch(f){throw N.error("Erreur lors de l'ajout de l'email d'activation à la queue",f),f}}function sy(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function n1(n){return`seasonPreferredPlayer:${n||"global"}`}function Um(n,e){try{const t=n1(n),r=localStorage.getItem(t);if(!r){localStorage.setItem(t,JSON.stringify([e]));return}if(r.startsWith("[")){const s=JSON.parse(r);s.includes(e)||(s.push(e),localStorage.setItem(t,JSON.stringify(s)))}else r!==e&&localStorage.setItem(t,JSON.stringify([r,e]))}catch{}}function eU(n,e){try{const t=n1(n),r=localStorage.getItem(t);if(!r)return;if(r.startsWith("[")){const s=JSON.parse(r).filter(i=>i!==e);s.length===0?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(s))}else r===e&&localStorage.removeItem(t)}catch{}}async function r1(n,e,t,r=null){try{N.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await eu(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await mt(()=>import("./index.esm-e12eeb83.js"),[]),{db:c}=await mt(()=>Promise.resolve().then(()=>Qr),void 0),d=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(d,a("email","==",e)),g=await l(f);if(!g.empty&&g.docs.find(U=>U.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");N.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:v}=await mt(()=>import("./index.esm-e8328fa5.js"),[]),{auth:x}=await mt(()=>Promise.resolve().then(()=>Qr),void 0),w=await v(x,e,t);N.info("Compte Firebase Auth créé",{uid:w.user.uid});const I=sy(t),L=r?_e(c,"seasons",r,"playerProtection",n):_e(c,"playerProtection",n);return await Xt(L,{playerId:n,email:e,passwordHash:I,firebaseUid:w.user.uid,isProtected:!0,createdAt:new Date}),N.info("Protection sauvegardée dans Firestore"),r&&Um(r,n),{success:!0}}catch(s){throw N.error("Erreur lors de la protection du joueur",s),s}}async function s1({playerId:n,email:e,seasonId:t=null}){const r=t?_e(te,"seasons",t,"playerProtection",n):_e(te,"playerProtection",n);(await Ht(r)).exists()?await Io(r,{email:e,updatedAt:new Date}):await Xt(r,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:i}=await QA({seasonId:t,playerId:n,email:e});return{success:!0,url:i}}async function i1({playerId:n,seasonId:e=null}){const t=e?_e(te,"seasons",e,"playerProtection",n):_e(te,"playerProtection",n);if(!(await Ht(t)).exists())throw new Error("Protection introuvable");return await Io(t,{emailVerifiedAt:new Date}),{success:!0}}async function o1({playerId:n,seasonId:e=null}){const t=e?_e(te,"seasons",e,"playerProtection",n):_e(te,"playerProtection",n);return await Io(t,{emailVerifiedAt:null}),{success:!0}}async function a1(n,e=null){try{const t=e?_e(te,"seasons",e,"playerProtection",n):_e(te,"playerProtection",n);return await Xt(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date}),e&&eU(e,n),{success:!0,email:""}}catch(t){throw N.error("Erreur lors de la suppression de la protection",t),t}}async function no(n,e=null){try{const t=e?_e(te,"seasons",e,"playerProtection",n):_e(te,"playerProtection",n),r=await Ht(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return N.error("Erreur lors de la vérification de protection",t),!1}}async function eu(n,e=null){try{const t=e?_e(te,"seasons",e,"playerProtection",n):_e(te,"playerProtection",n),r=await Ht(t);return r.exists()?r.data():null}catch(t){return N.error("Erreur lors de la récupération des données de protection",t),null}}async function l1(n,e=null){try{const t=await eu(n,e);return(t==null?void 0:t.email)||""}catch(t){return N.error("Erreur lors de la récupération de l'email",t),""}}async function jm(n=null){try{const e=n?tt(te,"seasons",n,"playerProtection"):tt(te,"playerProtection");return(await Ft(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return N.error("Erreur lors du chargement des protections",e),[]}}async function Bf(n){try{const e=[],t=xc(tt(te,"playerProtection"),Ch("email","==",n));(await Ft(t)).forEach(i=>{const o=i.data();o!=null&&o.isProtected&&e.push({seasonId:null,playerId:i.id,...o})});const s=await Ft(tt(te,"seasons"));for(const i of s.docs){const o=i.id,a=xc(tt(te,"seasons",o,"playerProtection"),Ch("email","==",n));(await Ft(a)).forEach(c=>{var f;const d=c.data();d!=null&&d.isProtected&&e.push({seasonId:o,seasonName:(f=i.data())==null?void 0:f.name,playerId:c.id,...d})})}return e}catch(e){return N.error("Erreur listAssociationsForEmail",e),[]}}async function u1(n,e,t=null){try{const r=await eu(n,t);if(!r||!r.isProtected)return!1;if(r.email){N.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await mt(()=>import("./index.esm-e8328fa5.js"),[]),{auth:i}=await mt(()=>Promise.resolve().then(()=>Qr),void 0);return await s(i,r.email,e),N.debug("Mot de passe Firebase Auth valide"),mo.saveSession(n),t&&Um(t,n),!0}catch(s){return N.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{N.debug("Vérification avec hash local");const s=sy(e),i=r.passwordHash===s;return i&&(mo.saveSession(n),t&&Um(t,n)),i}}catch(r){return N.error("Erreur lors de la vérification du mot de passe",r),!1}}async function c1({playerId:n,seasonId:e=null}){const t=e?_e(te,"seasons",e,"playerProtection",n):_e(te,"playerProtection",n),r=await Ht(t);if(!r.exists())throw new Error("Protection introuvable");const s=r.data();if(s!=null&&s.email)return await Io(t,{isProtected:!0,updatedAt:new Date}),{success:!0};throw new Error("Email non défini pour cette protection")}function oa(n){return mo.isPasswordCached(n)}function tU(n){return null}async function d1(n,e=null){try{N.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await eu(n,e);if(N.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(N.debug("Email à utiliser (masqué)"),t.firebaseUid){N.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await mt(()=>import("./index.esm-e8328fa5.js"),[]),{auth:s}=await mt(()=>Promise.resolve().then(()=>Qr),void 0);N.debug("Tentative d'envoi d'email"),await r(s,t.email),N.info("Email envoyé avec succès via Firebase Auth")}else{N.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await mt(()=>import("./index.esm-e8328fa5.js"),[]),{auth:i}=await mt(()=>Promise.resolve().then(()=>Qr),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);N.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),N.info("Email envoyé avec succès");const{updateDoc:l}=await mt(()=>import("./index.esm-e12eeb83.js"),[]),{db:c}=await mt(()=>Promise.resolve().then(()=>Qr),void 0),d=e?_e(c,"seasons",e,"playerProtection",n):_e(c,"playerProtection",n);await l(d,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")N.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),N.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw N.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function nU(n,e,t=null){try{const r=sy(e),s=t?_e(te,"seasons",t,"playerProtection",n):_e(te,"playerProtection",n);return await Io(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw N.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function rU(n){return new Promise((e,t)=>{N.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const td=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:o1,finalizeProtectionAfterVerification:c1,getCachedPlayerPassword:tU,getPlayerEmail:l1,getPlayerProtectionData:eu,isPlayerPasswordCached:oa,isPlayerProtected:no,listAssociationsForEmail:Bf,listProtectedPlayers:jm,markEmailVerifiedForProtection:i1,protectPlayer:r1,requirePlayerPasswordForAvailability:rU,sendPasswordResetEmail:d1,startEmailVerificationForProtection:s1,unprotectPlayer:a1,updatePlayerPasswordInFirestore:nU,verifyPlayerPassword:u1},Symbol.toStringTag,{value:"Module"})),sU={class:"mb-4 md:mb-6"},iU={class:"flex items-start gap-4"},oU={class:"flex items-center gap-3"},aU={class:"space-y-2"},lU={class:"flex items-center gap-2"},uU={class:"text-gray-400 text-xs md:text-sm"},cU={key:0,class:"flex items-center gap-2"},dU=["title"],hU={class:"text-blue-200"},fU={class:"space-y-4 md:space-y-6"},pU={class:"space-y-2 md:space-y-3"},mU={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},gU=["disabled"],vU={key:0,class:"mt-2 text-xs text-red-300"},yU={key:1,class:"mt-2 text-xs text-green-300"},_U={class:"space-y-2 md:space-y-3"},bU={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},wU={class:"flex items-center justify-between mb-4"},xU={class:"space-y-4"},IU=["disabled"],EU={key:0,class:"text-xs text-red-300 text-center"},TU={key:1,class:"text-xs text-green-300 text-center"},AU={class:"flex items-center justify-between mb-4"},SU={class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},PU={class:"space-y-3"},RU={key:0,class:"text-sm text-gray-400 text-center py-4"},CU={key:1,class:"space-y-2"},kU={class:"flex items-center gap-2 min-w-0 flex-1"},DU={class:"truncate"},NU={class:"text-white font-medium text-sm"},OU={class:"text-gray-400 text-xs"},VU=["onClick"],h1={__name:"AccountMenu",props:{show:{type:Boolean,default:!1},seasonId:{type:String,default:null}},emits:["close","delete-account","open-player"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(""),o=S(!1),a=S(""),l=S(""),c=S(!1),d=S(!1),f=S(""),g=S(""),v=S([]),x=S(!1),w=S(!1);Ct(s,A=>{i.value=A||""}),Ct(i,A=>{c.value=!!A&&A.includes("@")&&A!==s.value});async function I(){if(c.value){o.value=!0,a.value="",l.value="";try{const A=await YA({currentEmail:s.value,newEmail:i.value.trim()});await t1({toEmail:i.value.trim(),verifyUrl:A.url,purpose:"account_email_update",displayName:"utilisateur"}),l.value=`Un email de vérification a été envoyé à ${i.value.trim()}. Cliquez sur le lien pour confirmer le changement.`}catch(A){a.value=(A==null?void 0:A.code)==="auth/requires-recent-login"?"Veuillez vous reconnecter pour modifier votre email":"Impossible de mettre à jour l'email"}finally{o.value=!1}}}async function L(){if(s.value){d.value=!0,f.value="",g.value="";try{const A=window.location.pathname+window.location.search,b={lastVisitedPage:A,timestamp:Date.now(),email:s.value,context:"account_menu_password_reset",returnToAccountMenu:!0,modalState:{accountMenu:!0,eventDetails:A.includes("modal=event_details"),playerDetails:A.includes("modal=player_details"),eventId:new URLSearchParams(window.location.search).get("event"),playerId:new URLSearchParams(window.location.search).get("player")}};localStorage.setItem("pendingPasswordResetNavigation",JSON.stringify(b)),await Yv(s.value),g.value="Email de réinitialisation envoyé. Vérifiez votre boîte de réception."}catch{f.value="Impossible d'envoyer l'email de réinitialisation. Veuillez réessayer."}finally{d.value=!1}}}function $(A){return`${A.seasonId||"global"}__${A.playerId}`}async function U(){try{const A=s.value?await Bf(s.value):[],b=[];for(const E of A){let D=E.playerId,F=E.seasonId||"—";try{if(E.seasonId){const V=_e(te,"seasons",E.seasonId,"players",E.playerId),C=await Ht(V);C.exists()&&(D=C.data().name||D);const Fe=_e(te,"seasons",E.seasonId),vt=await Ht(Fe);vt.exists()&&(F=vt.data().name||F)}}catch{}b.push({...E,playerName:D,seasonName:F})}v.value=b}catch{v.value=[]}}async function z(A){if(confirm(`Êtes-vous sûr de vouloir dissocier le joueur "${A.playerName}" de votre compte ?`))try{const{deleteDoc:b}=await mt(()=>import("./index.esm-e12eeb83.js"),[]);if(A.seasonId){const D=_e(te,"seasons",A.seasonId,"playerProtection",A.playerId);await b(D)}else{const D=_e(te,"playerProtection",A.playerId);await b(D)}try{if(A.seasonId){const D=`seasonPreferredPlayer:${A.seasonId}`,F=localStorage.getItem(D);if(F)if(F.startsWith("[")){const C=(JSON.parse(F)||[]).filter(Fe=>Fe!==A.playerId);localStorage.setItem(D,JSON.stringify(C))}else F===A.playerId&&localStorage.removeItem(D)}}catch{}await U();const E=`Joueur "${A.playerName}" dissocié avec succès`}catch(b){console.error("Erreur lors de la dissociation:",b),alert(`Erreur lors de la dissociation: ${b.message||"Veuillez réessayer"}`)}}function le(A){r("open-player",A),Z()}function Z(){r("close")}return Ct(()=>t.show,A=>{var b;if(A)try{s.value=((b=Le==null?void 0:Le.currentUser)==null?void 0:b.email)||"",U()}catch{}}),An(()=>{var A;if(t.show)try{s.value=((A=Le==null?void 0:Le.currentUser)==null?void 0:A.email)||"",U()}catch{}}),(A,b)=>n.show?(k(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-2 md:p-4",onClick:Z},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg md:max-w-xl max-h-[90vh] overflow-y-auto",onClick:b[3]||(b[3]=ft(()=>{},["stop"]))},[h("button",{onClick:Z,class:"absolute right-2 md:right-3 top-2 md:top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),h("div",sU,[h("div",iU,[h("div",oU,[b[13]||(b[13]=h("div",{class:"w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0"},[h("span",{class:"text-lg md:text-xl"},"👤")],-1)),h("div",aU,[b[12]||(b[12]=h("h3",{class:"text-white font-semibold text-base md:text-lg"},"Mon compte",-1)),h("div",lU,[h("span",uU,ee(s.value||"Non défini"),1),h("button",{onClick:b[0]||(b[0]=E=>x.value=!0),class:"text-indigo-400 hover:text-indigo-300 transition-colors p-1 hover:bg-indigo-400/10 rounded flex-shrink-0",title:"Modifier l'email","aria-label":"Modifier l'email"}," ✏️ ")]),v.value.length>0?(k(),O("div",cU,[h("button",{onClick:b[1]||(b[1]=E=>v.value.length===1?le(v.value[0]):w.value=!0),class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-xs md:text-sm hover:bg-blue-500/30 transition-colors cursor-pointer",title:v.value.length===1?`Voir ${v.value[0].playerName}`:"Gérer mes joueurs"},[b[11]||(b[11]=h("span",{class:"text-blue-300"},"⭐",-1)),h("span",hU,ee(v.value.length===1?v.value[0].playerName:`${v.value.length} joueurs`),1)],8,dU)])):ie("",!0)])])])]),b[18]||(b[18]=h("div",{class:"border-t border-white/10 mb-4 md:mb-6"},null,-1)),h("div",fU,[h("div",pU,[b[15]||(b[15]=h("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[h("span",{class:"text-green-400"},"🔑"),ut(" Mot de passe ")],-1)),h("div",mU,[b[14]||(b[14]=h("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Vous pouvez changer votre mot de passe pour sécuriser vos opérations sensibles.",-1)),h("button",{onClick:L,disabled:d.value,class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},ee(d.value?"⏳":"Changer de mot de passe"),9,gU),f.value?(k(),O("div",vU,ee(f.value),1)):ie("",!0),g.value?(k(),O("div",yU,ee(g.value),1)):ie("",!0)])]),h("div",_U,[b[17]||(b[17]=h("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[h("span",{class:"text-red-400"},"⚠️"),ut(" Suppression de compte ")],-1)),h("div",bU,[b[16]||(b[16]=h("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Cette action est irréversible et supprimera définitivement votre compte.",-1)),h("button",{onClick:b[2]||(b[2]=E=>A.$emit("delete-account")),class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-red-600 text-white hover:bg-red-500 text-sm"},"Supprimer mon compte")])])]),h("div",{class:"mt-4 md:mt-6 text-center"},[h("button",{onClick:Z,class:"px-4 md:px-6 py-2 md:py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 text-sm"},"Fermer")])]),x.value?(k(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:b[7]||(b[7]=E=>x.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-md",onClick:b[6]||(b[6]=ft(()=>{},["stop"]))},[h("div",wU,[b[19]||(b[19]=h("h3",{class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},[h("span",{class:"text-blue-400"},"📧"),ut(" Modifier l'email ")],-1)),h("button",{onClick:b[4]||(b[4]=E=>x.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),h("div",xU,[h("div",null,[b[20]||(b[20]=h("label",{class:"block text-xs text-gray-400 mb-2"},"Nouvelle adresse email",-1)),it(h("input",{"onUpdate:modelValue":b[5]||(b[5]=E=>i.value=E),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400 text-sm",placeholder:"nouvel@email.com"},null,512),[[$t,i.value]])]),h("button",{onClick:I,disabled:!c.value||o.value,class:"w-full px-4 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},ee(o.value?"⏳":"Mettre à jour"),9,IU),a.value?(k(),O("div",EU,ee(a.value),1)):ie("",!0),l.value?(k(),O("div",TU,ee(l.value),1)):ie("",!0)])])])):ie("",!0),w.value?(k(),O("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:b[10]||(b[10]=E=>w.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg",onClick:b[9]||(b[9]=ft(()=>{},["stop"]))},[h("div",AU,[h("h3",SU,[b[21]||(b[21]=h("span",{class:"text-yellow-400"},"⭐",-1)),ut(" "+ee(v.value.length<=1?"Mon joueur":"Mes joueurs"),1)]),h("button",{onClick:b[8]||(b[8]=E=>w.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),h("div",PU,[v.value.length===0?(k(),O("div",RU," Aucun joueur associé pour le moment. ")):(k(),O("div",CU,[(k(!0),O(bt,null,Lr(v.value,E=>(k(),O("div",{key:$(E),class:"flex items-center justify-between p-3 bg-gray-800/30 rounded-lg"},[h("div",kU,[b[22]||(b[22]=h("span",{class:"text-yellow-400 text-sm"},"⭐",-1)),h("div",DU,[h("div",NU,ee(E.playerName||"—"),1),h("div",OU,ee(E.seasonName||E.seasonId||"—"),1)])]),h("button",{onClick:D=>z(E),class:"p-1.5 rounded bg-red-600/20 text-red-400 hover:bg-red-600/30 hover:text-red-300 transition-colors duration-200 flex-shrink-0",title:"Dissocier ce joueur","aria-label":"Dissocier ce joueur"}," 🗑️ ",8,VU)]))),128))]))])])])):ie("",!0)])):ie("",!0)}},qb="/logos/hatcast-logo-desktop.png",MU={key:0,class:"w-10 h-10 bg-gray-600 animate-pulse rounded-full"},LU=["aria-expanded"],Bm={__name:"AccountDropdown",props:{isConnected:{type:Boolean,default:!1},buttonClass:{type:String,default:"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700"}},emits:["open-account-menu","open-help","open-notifications","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=S(!0),o=S(null),a=S({});Ct(()=>t.isConnected,I=>{i.value=!1},{immediate:!0}),An(()=>{i.value=!1});function l(){r("open-login")}function c(){s.value=!s.value,s.value&&jt(()=>d())}function d(){if(o.value){const I=o.value.getBoundingClientRect();a.value={top:`${I.bottom+8}px`,right:`${window.innerWidth-I.right}px`}}}function f(){s.value=!1,r("open-account-menu")}function g(){s.value=!1,r("open-help")}function v(){s.value=!1,r("open-notifications")}async function x(){s.value=!1;try{await Le.signOut(),r("logout")}catch(I){console.error("Erreur lors de la déconnexion:",I)}}function w(){s.value=!1}return An(()=>{document.addEventListener("click",w),window.addEventListener("resize",d),window.addEventListener("scroll",d,{passive:!0})}),Zs(()=>{document.removeEventListener("click",w),window.removeEventListener("resize",d),window.removeEventListener("scroll",d)}),(I,L)=>(k(),O("div",{class:"relative",onClick:L[0]||(L[0]=ft(()=>{},["stop"]))},[i.value?(k(),O("div",MU)):n.isConnected?(k(),O("button",{key:2,onClick:c,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte","aria-expanded":s.value,"aria-haspopup":"true",ref_key:"dropdownButton",ref:o},L[1]||(L[1]=[h("span",{class:"text-2xl"},"👤",-1)]),8,LU)):(k(),O("button",{key:1,onClick:l,class:dn(["px-4 py-2 rounded-lg transition-all duration-300 border transition-colors",n.buttonClass])}," Connexion ",2)),(k(),ei(Zu,{to:"body"},[s.value&&n.isConnected?(k(),O("div",{key:0,class:"fixed w-auto min-w-[180px] max-w-[200px] md:min-w-[200px] md:max-w-[240px] bg-gray-900 border border-white/20 rounded-lg shadow-xl py-1 z-[9999]",style:Mr(a.value),role:"menu"},[h("button",{onClick:f,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},L[2]||(L[2]=[h("span",{class:"text-base md:text-lg flex-shrink-0"},"👤",-1),h("span",{class:"truncate"},"Mon compte",-1)])),h("button",{onClick:v,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},L[3]||(L[3]=[h("span",{class:"text-base md:text-lg flex-shrink-0"},"🔔",-1),h("span",{class:"truncate"},"Notifications",-1)])),h("button",{onClick:g,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},L[4]||(L[4]=[h("span",{class:"text-base md:text-lg flex-shrink-0"},"❓",-1),h("span",{class:"truncate"},"Aide",-1)])),L[6]||(L[6]=h("div",{class:"border-t border-white/10 my-1"},null,-1)),h("button",{onClick:x,class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},L[5]||(L[5]=[h("span",{class:"text-base md:text-lg flex-shrink-0"},"🚪",-1),h("span",{class:"truncate"},"Se déconnecter",-1)]))],4)):ie("",!0)]))]))}},$U={class:"container mx-auto px-4 py-4"},FU={class:"flex items-center justify-between"},UU={class:"flex items-center"},jU={href:"/",class:"flex items-center"},BU={class:"relative w-48 h-12 md:w-56 md:h-14"},qU={class:"flex items-center gap-2"},zU={__name:"AppHeader",props:{isScrolled:{type:Boolean,default:!1}},emits:["open-account-menu","open-help","open-notifications","open-players","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=vo(),i=He(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");Ct(()=>s.path,()=>{yl(),setTimeout(()=>{yl()},100)},{immediate:!0}),Zs(()=>{window._appHeaderUnsubscribe&&(window._appHeaderUnsubscribe(),delete window._appHeaderUnsubscribe)});function o(){r("open-account-menu")}function a(){r("open-help")}function l(){r("open-notifications")}function c(){r("open-players")}function d(){r("logout")}function f(){r("open-login")}return(g,v)=>(k(),O("header",{class:dn(["fixed top-0 left-0 right-0 z-50 transition-all duration-300",n.isScrolled?"bg-white/95 backdrop-blur-md border-b border-gray-200/50 shadow-lg":"bg-transparent"])},[h("nav",$U,[h("div",FU,[h("div",UU,[h("a",jU,[h("div",BU,[n.isScrolled?(k(),O(bt,{key:1},[v[2]||(v[2]=h("img",{src:$m,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 md:hidden"},null,-1)),v[3]||(v[3]=h("img",{src:qb,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 hidden md:block"},null,-1))],64)):(k(),O(bt,{key:0},[v[0]||(v[0]=h("img",{src:$m,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 md:hidden brightness-0 invert"},null,-1)),v[1]||(v[1]=h("img",{src:qb,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 hidden md:block brightness-0 invert"},null,-1))],64))])])]),h("div",qU,[je(Bm,{"is-connected":$r(eF),"button-class":i.value,onOpenAccountMenu:o,onOpenHelp:a,onOpenNotifications:l,onOpenPlayers:c,onLogout:d,onOpenLogin:f},null,8,["is-connected","button-class"]),eP(g.$slots,"actions")])])])],2))}},HU={class:"space-y-4 md:space-y-6"},KU={class:"space-y-2 md:space-y-3"},GU={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},WU={class:"flex items-center justify-between"},QU={class:"flex items-center gap-2"},JU={class:"flex items-center justify-between"},YU={class:"flex items-center gap-2"},XU={class:"space-y-2 md:space-y-3"},ZU={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},e6={class:"flex items-center justify-between"},t6={class:"flex items-center gap-2"},n6={class:"flex items-center justify-between"},r6={class:"flex items-center gap-2"},s6={class:"flex items-center justify-between pt-2 border-t border-white/10"},i6=["disabled"],o6={key:1,class:"inline-flex items-center text-xs text-gray-300"},a6={class:"flex items-center justify-between pt-2"},l6=["disabled"],u6={key:0,class:"text-xs text-green-300"},c6={key:1,class:"text-xs text-red-300"},d6={key:2,class:"text-[10px] text-gray-400 break-all"},h6={class:"text-[10px] text-gray-500"},f6={key:0,class:"text-xs text-red-300"},p6={key:1,class:"text-xs text-green-300"},m6={class:"mt-6 flex justify-between items-center"},g6=["disabled"],f1={__name:"NotificationsModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S({notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),o=S(!1),a=S(""),l=S(""),c=S(!1),d=S(""),f=S(""),g=S(!1),v=S(localStorage.getItem("fcmToken")||""),x=S(!1),w=function(b){try{return b?b.length>20?b.slice(0,8)+"…"+b.slice(-6):b:""}catch{return""}}("BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8");function I(A){const{active:b,token:E}=A.detail;b&&E?(v.value=E,x.value=!0,localStorage.setItem("fcmToken",E),console.log("Notifications push réactivées automatiquement")):(x.value=!1,v.value="",localStorage.removeItem("fcmToken"),console.log("Notifications push désactivées"))}async function L(){try{if(!s.value)return;const A=_e(te,"userPreferences",s.value),b=await Ht(A);if(b.exists()){const E=b.data()||{};i.value.notifyAvailability=E.notifyAvailability!==!1,i.value.notifySelection=E.notifySelection!==!1,i.value.notifySelectionPush=E.notifySelectionPush!==!1,i.value.notifyAvailabilityPush=E.notifyAvailabilityPush!==!1}else i.value={notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}}catch{}}async function $(){if(s.value){c.value=!0,f.value="",d.value="";try{if(!(await Wu()).active){f.value="Notifications push non actives sur cet appareil";return}await Zc({toEmail:s.value,title:"Test HatCast",body:"Ceci est un test de notification",data:{url:"/"},reason:"manual_test"}),d.value="OK"}catch{f.value="Échec de l'envoi du test"}finally{c.value=!1}}}function U(){const A=new CustomEvent("pwa-update-test",{detail:{type:"test-update",timestamp:Date.now()}});window.dispatchEvent(A),alert(`🧪 Test de mise à jour PWA déclenché !

Vérifiez que la modal de mise à jour apparaît dans l'interface principale.`)}async function z(){try{if(g.value=!0,!await Xv()){f.value="Push non supporté sur cet appareil";return}const b=await Wu();b.active?(v.value=b.token,x.value=!0,localStorage.setItem("fcmToken",b.token),console.log("Notifications push activées avec succès")):f.value=`Activation impossible: ${b.error}`}catch(A){const b=typeof Notification<"u"?Notification.permission:"unknown",E=A&&(A.message||A.code)?` (${A.message||A.code})`:"";f.value=`Activation impossible – permission: ${b}${E}`}finally{g.value=!1}}async function le(){if(s.value){o.value=!0,a.value="",l.value="";try{const A=_e(te,"userPreferences",s.value);await Xt(A,{...i.value},{merge:!0}),l.value="Préférences sauvegardées"}catch{a.value="Impossible de sauvegarder vos préférences"}finally{o.value=!1}}}function Z(){r("close")}return Ct(()=>t.show,A=>{A&&L()}),An(()=>{var A;try{s.value=((A=Le==null?void 0:Le.currentUser)==null?void 0:A.email)||"",x.value=typeof Notification<"u"&&Notification.permission==="granted"&&!!localStorage.getItem("fcmToken"),R$(),window.addEventListener("push-status-changed",I),Wu().then(b=>{b.active&&(v.value=b.token,x.value=!0,localStorage.setItem("fcmToken",b.token))})}catch{}t.show&&L()}),Zs(()=>{window.removeEventListener("push-status-changed",I)}),(A,b)=>n.show?(k(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:Z},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:b[4]||(b[4]=ft(()=>{},["stop"]))},[h("button",{onClick:Z,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),b[16]||(b[16]=lr('<div class="mb-4 md:mb-6"><div class="flex items-start gap-4"><div class="flex items-center gap-3"><div class="w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0"><span class="text-lg md:text-xl">🔔</span></div><div class="space-y-2"><h3 class="text-white font-semibold text-base md:text-lg">Notifications</h3><p class="text-gray-400 text-xs md:text-sm">Ne ratez rien, soyez le premier prévenu !</p></div></div></div></div><div class="border-t border-white/10 mb-4 md:mb-6"></div>',2)),h("div",HU,[h("div",KU,[b[7]||(b[7]=h("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[h("span",{class:"text-blue-400"},"📧"),ut(" Emails ")],-1)),h("div",GU,[h("div",WU,[h("label",QU,[it(h("input",{type:"checkbox","onUpdate:modelValue":b[0]||(b[0]=E=>i.value.notifyAvailability=E),class:"w-4 h-4"},null,512),[[Yi,i.value.notifyAvailability]]),b[5]||(b[5]=h("span",{class:"text-sm text-white"},"M'envoyer un email lorsqu'un événement a besoin de joueurs",-1))])]),h("div",JU,[h("label",YU,[it(h("input",{type:"checkbox","onUpdate:modelValue":b[1]||(b[1]=E=>i.value.notifySelection=E),class:"w-4 h-4"},null,512),[[Yi,i.value.notifySelection]]),b[6]||(b[6]=h("span",{class:"text-sm text-white"},"M'envoyer un email lorsque je suis concerné par une sélection",-1))])])])]),h("div",XU,[b[15]||(b[15]=h("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[h("span",{class:"text-emerald-400"},"📱"),ut(" Mobile (expérimental) ")],-1)),h("div",ZU,[b[14]||(b[14]=h("div",{class:"text-xs text-emerald-200 mb-1"},"Fonctionnalité en test: activable uniquement ici.",-1)),h("div",e6,[h("label",t6,[it(h("input",{type:"checkbox","onUpdate:modelValue":b[2]||(b[2]=E=>i.value.notifySelectionPush=E),class:"w-4 h-4"},null,512),[[Yi,i.value.notifySelectionPush]]),b[8]||(b[8]=h("span",{class:"text-sm text-white"},"Me notifier lorsque je suis concerné par une sélection",-1))])]),h("div",n6,[h("label",r6,[it(h("input",{type:"checkbox","onUpdate:modelValue":b[3]||(b[3]=E=>i.value.notifyAvailabilityPush=E),class:"w-4 h-4"},null,512),[[Yi,i.value.notifyAvailabilityPush]]),b[9]||(b[9]=h("span",{class:"text-sm text-white"},"Me notifier lorsqu'un événement a besoin de joueurs",-1))])]),h("div",s6,[b[11]||(b[11]=h("div",{class:"text-xs text-gray-400"},"Notifications sur cet appareil",-1)),x.value?(k(),O("span",o6,b[10]||(b[10]=[h("span",{class:"mr-1 text-emerald-400"},"✓",-1),ut(" Actif ")]))):(k(),O("button",{key:0,onClick:z,disabled:g.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},ee(g.value?"...":"Activer"),9,i6))]),h("div",a6,[b[12]||(b[12]=h("div",{class:"text-xs text-gray-400"},"Test de notification push",-1)),h("button",{onClick:$,disabled:c.value||!s.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},ee(c.value?"Envoi…":"Envoyer un test"),9,l6)]),h("div",{class:"flex items-center justify-between pt-2"},[b[13]||(b[13]=h("div",{class:"text-xs text-gray-400"},"Test de mise à jour PWA",-1)),h("button",{onClick:U,class:"px-3 py-1 rounded bg-blue-600 text-white text-xs hover:bg-blue-500 transition-colors"}," 🧪 Simuler maj ")]),d.value?(k(),O("div",u6,"Notification test envoyée (vérifiez votre appareil)")):ie("",!0),f.value?(k(),O("div",c6,ee(f.value),1)):ie("",!0),v.value?(k(),O("div",d6,"FCM token: "+ee(v.value),1)):ie("",!0),h("div",h6,"VAPID: "+ee($r(w)||"indisponible"),1)])]),a.value?(k(),O("div",f6,ee(a.value),1)):ie("",!0),l.value?(k(),O("div",p6,ee(l.value),1)):ie("",!0)]),h("div",m6,[h("button",{onClick:le,disabled:o.value,class:"px-4 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-500 disabled:opacity-50"},ee(o.value?"⏳":"Sauvegarder"),9,g6),h("button",{onClick:Z,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ie("",!0)}},v6={class:"space-y-3"},y6={key:0,class:"text-sm text-gray-400"},_6={key:1,class:"space-y-2"},b6={class:"flex items-center justify-between gap-3"},w6={class:"truncate"},x6={class:"text-white font-semibold"},I6={class:"text-gray-400 text-xs"},E6=["onClick"],p1={__name:"PlayersModal",props:{show:{type:Boolean,default:!1}},emits:["close","manage-player"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S([]);function o(d){return`${d.seasonId||"global"}__${d.playerId}`}async function a(){var d;try{s.value=((d=Le==null?void 0:Le.currentUser)==null?void 0:d.email)||""}catch{}try{const f=s.value?await Bf(s.value):[],g=[];for(const v of f){let x=v.playerId;try{if(v.seasonId){const w=_e(te,"seasons",v.seasonId,"players",v.playerId),I=await Ht(w);I.exists()&&(x=I.data().name||x)}}catch{}g.push({...v,playerName:x})}i.value=g}catch{i.value=[]}}function l(d){r("manage-player",d),c()}function c(){r("close")}return Ct(()=>t.show,d=>{d&&a()}),An(()=>{t.show&&a()}),(d,f)=>n.show?(k(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:c},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:f[0]||(f[0]=ft(()=>{},["stop"]))},[h("button",{onClick:c,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),f[2]||(f[2]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👥</span></div><h2 class="text-2xl font-bold text-white mb-1">Mes joueurs</h2><p class="text-sm text-gray-300">Gérez vos associations de joueurs</p></div>',1)),h("div",v6,[f[1]||(f[1]=h("h3",{class:"text-white font-semibold mb-2"},"Mes joueurs associés",-1)),i.value.length===0?(k(),O("div",y6,"Aucun joueur associé pour le moment.")):(k(),O("ul",_6,[(k(!0),O(bt,null,Lr(i.value,g=>(k(),O("li",{key:o(g),class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},[h("div",b6,[h("div",w6,[h("div",x6,ee(g.seasonName||g.seasonId||"—"),1),h("div",I6,"Joueur : "+ee(g.playerName||"—"),1)]),h("button",{onClick:v=>l(g),class:"px-3 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-xs"},"Gérer",8,E6)])]))),128))]))]),h("div",{class:"mt-6 text-center"},[h("button",{onClick:c,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ie("",!0)}};let pr="mock",ro=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],_a=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function iy(n){pr=n}async function T6(){if(pr!=="firebase"||!(await Ft(tt(te,"seasons"))).empty)return;const e=_e(tt(te,"seasons"));await Xt(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:tr()});const t=await Ft(tt(te,"players"));for(const o of t.docs)await Xt(_e(e,"players",o.id),o.data());const r=await Ft(tt(te,"events"));for(const o of r.docs)await Xt(_e(e,"events",o.id),o.data());const s=await Ft(tt(te,"availability"));for(const o of s.docs)await Xt(_e(e,"availability",o.id),o.data());const i=await Ft(tt(te,"selections"));for(const o of i.docs)await Xt(_e(e,"selections",o.id),o.data())}async function m1(){pr==="firebase"&&await T6()}async function Fh(n=null){let e;return pr==="firebase"?n?e=(await Ft(tt(te,"seasons",n,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=(await Ft(tt(te,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=_a,e.sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const d=new Date(c);return isNaN(d.getTime())?null:d},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function Qu(n=null){let e;return pr==="firebase"?n?e=(await Ft(tt(te,"seasons",n,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=(await Ft(tt(te,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=ro,e.sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function g1(n,e=null){if(pr==="firebase"){const t=_e(e?tt(te,"seasons",e,"players"):tt(te,"players"));return await Xt(t,{name:n}),t.id}else{const t=`p${ro.length+1}`;return ro.push({id:t,name:n}),t}}async function A6(n,e=null){if(pr==="firebase"){const t=e?_e(te,"seasons",e,"players",n):_e(te,"players",n);await $l(t);const r=e?await Ft(tt(te,"seasons",e,"availability")):await Ft(tt(te,"availability")),s=wv(te);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else ro=ro.filter(t=>t.id!==n)}async function S6(n,e,t=null){if(pr==="firebase"){const r=t?_e(te,"seasons",t,"players",n):_e(te,"players",n),s=await Ht(r),i=s.exists()&&s.data().name||null;if(await Xt(r,{name:e},{merge:!0}),i&&i!==e){const o=wv(te);try{const a=t?_e(te,"seasons",t,"availability",i):_e(te,"availability",i),l=await Ht(a);if(l.exists()){const c=l.data()||{},d=t?_e(te,"seasons",t,"availability",e):_e(te,"availability",e);o.set(d,c,{merge:!0}),o.delete(a)}}catch{}try{const a=t?tt(te,"seasons",t,"selections"):tt(te,"selections");(await Ft(a)).forEach(c=>{var f;const d=Array.isArray((f=c.data())==null?void 0:f.players)?c.data().players:[];if(d.includes(i)){const g=d.map(v=>v===i?e:v);o.update(c.ref,{players:g})}})}catch{}await o.commit()}}else{const r=ro.findIndex(s=>s.id===n);r!==-1&&(ro[r]={...ro[r],name:e})}}async function zo(n,e,t=null){if(pr==="firebase"){const r=t?await Ft(tt(te,"seasons",t,"availability")):await Ft(tt(te,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function Ho(n=null){if(pr==="firebase"){const e=n?await Ft(tt(te,"seasons",n,"selections")):await Ft(tt(te,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function zb(n,e,t=null){if(pr==="firebase"){const r=t?_e(te,"seasons",t,"availability",n):_e(te,"availability",n);await Xt(r,e)}}async function P6({seasonId:n,playerName:e,eventId:t,value:r}){if(pr!=="firebase")return;const s=n?_e(te,"seasons",n,"availability",e):_e(te,"availability",e),i=await Ht(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await Xt(s,a)}async function qm(n,e,t=null){if(pr==="firebase"){const r=t?_e(te,"seasons",t,"selections",n):_e(te,"selections",n);await Xt(r,{players:e})}}async function R6(n,e=null){if(N.info("Suppression de l'événement",{eventId:n}),pr==="firebase")try{N.debug("Suppression de l'événement dans Firestore");const t=e?_e(te,"seasons",e,"events",n):_e(te,"events",n);await $l(t),N.debug("Suppression de la sélection associée");const r=e?_e(te,"seasons",e,"selections",n):_e(te,"selections",n);await $l(r),N.debug("Suppression des disponibilités");const s=e?await Ft(tt(te,"seasons",e,"availability")):await Ft(tt(te,"availability")),i=wv(te);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){N.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),N.info("Opérations de suppression terminées avec succès")}catch(t){throw N.error("Erreur lors de la suppression",t),t}else _a=_a.filter(t=>t.id!==n)}async function C6(n,e=null){if(pr==="firebase"){const t=_e(e?tt(te,"seasons",e,"events"):tt(te,"events"));return await Xt(t,n),t.id}else{const t=`event${_a.length+1}`;return _a.push({id:t,...n}),t}}async function Hb(n,e,t=null){if(pr==="firebase"){const r=t?_e(te,"seasons",t,"events",n):_e(te,"events",n);await Xt(r,e,{merge:!0})}else{const r=_a.findIndex(s=>s.id===n);r!==-1&&(_a[r]={id:n,...e})}}const k6={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},D6={class:"hero-section relative overflow-hidden pt-24"},N6={class:"hero-content py-16 md:py-24 px-4 relative z-10"},O6={class:"container mx-auto"},V6={class:"grid grid-cols-1 lg:grid-cols-2 gap-16 lg:gap-24 items-center"},M6={class:"text-center lg:text-left order-1 lg:order-2"},L6={class:"hero-cta mb-10"},$6={class:"flex flex-col sm:flex-row gap-4 items-center justify-center"},F6={class:"seasons-section py-16"},U6={class:"container mx-auto px-4"},j6=["aria-busy"],B6={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center animate-pulse"},q6={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center"},z6=["onClick"],H6={class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg overflow-hidden"},K6=["src","alt"],G6={key:1,class:"text-2xl"},W6={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},Q6={key:0,class:"text-gray-300 text-sm mb-4 line-clamp-2 leading-relaxed"},J6={class:"flex justify-center gap-6 text-sm"},Y6={class:"text-center"},X6={class:"text-white font-semibold"},Z6={class:"text-center"},e5={class:"text-white font-semibold"},t5={class:"absolute top-4 right-4"},n5=["onClick","aria-expanded"],r5={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},s5=["onClick"],i5=["onClick"],o5=["onClick"],a5=["onClick"],l5=["onClick"],u5={class:"text-center mt-12"},c5={key:2,class:"text-center py-16"},d5={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},h5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},f5={class:"mb-6"},p5={class:"mb-6"},m5={class:"mb-6"},g5={class:"mb-6"},v5={class:"flex justify-end space-x-3"},y5=["disabled"],_5={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},b5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},w5={class:"text-center mb-6"},x5={class:"text-gray-300"},I5={key:2,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},E5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},T5={class:"text-center mb-6"},A5={class:"text-gray-300"},S5={class:"mb-6"},P5={class:"mb-6"},R5={class:"mb-6"},C5={key:0,class:"mb-4 text-center"},k5={class:"w-20 h-20 mx-auto mb-3 rounded-full overflow-hidden border-2 border-white/20"},D5=["src","alt"],N5=["disabled"],O5={key:0,class:"text-2xl mb-2 animate-spin"},V5={key:1,class:"text-2xl mb-2"},M5={class:"text-sm"},L5={key:0},$5={key:1},F5={key:2},U5={key:2,class:"text-xs text-gray-400 mt-1"},j5={class:"flex justify-end space-x-3"},B5=["disabled"],q5={key:0,class:"flex items-center gap-2"},z5={key:1},H5={__name:"Seasons",setup(n){const e=S([]),t=S(!0),r=ba(),s=S(null),i=S(!1),o=S(!1),a=S(!1),l=S(""),c=S(""),d=S(""),f=S(""),g=S(""),v=S(""),x=S(null),w=S(""),I=S(null),L=S(null),$=S(!1),U=S(!1),z=S(null),le=S(""),Z=S(!1),A=S(!1),b=S(!1),E=S(!1),D=S(!1);An(async()=>{var B,be;try{N.info("Début du chargement des saisons"),iy("firebase"),N.info("Mode de stockage défini sur Firebase"),await m1(),N.info("Stockage initialisé"),N.info("Attente de l'initialisation du service d'authentification...");try{nF(),await HA(),N.info("Service d'authentification initialisé")}catch(ze){N.warn("Service d'authentification non initialisé, continuation sans authentification:",ze.message||"Erreur inconnue")}try{yl(),N.info("Synchronisation forcée effectuée")}catch(ze){N.warn("Erreur lors de la synchronisation forcée:",ze)}N.info("Chargement des saisons...");try{e.value=await sl(),N.info("Saisons chargées",{count:((B=e.value)==null?void 0:B.length)||0})}catch(ze){throw N.error("Erreur lors du chargement des saisons:",ze),ze}if(e.value.length>0){N.info("Chargement des données des saisons...");const ze=await Promise.all(e.value.map(async Qe=>{try{N.debug(`Chargement des données pour la saison: ${Qe.name} (ID: ${Qe.id})`);let at,ht;try{at=await Fh(Qe.id),N.debug(`Événements chargés pour ${Qe.name}:`,at)}catch(Et){N.warn(`Erreur lors du chargement des événements pour ${Qe.name}:`,Et),at=[]}try{ht=await Qu(Qe.id),N.debug(`Joueurs chargés pour ${Qe.name}:`,ht)}catch(Et){N.warn(`Erreur lors du chargement des joueurs pour ${Qe.name}:`,Et),ht=[]}return N.debug(`Saison ${Qe.name}: ${(at==null?void 0:at.length)||0} événements, ${(ht==null?void 0:ht.length)||0} joueurs`),{...Qe,events:at||[],players:ht||[]}}catch(at){return N.warn(`Erreur lors du chargement des données pour la saison ${Qe.id}:`,at),{...Qe,events:[],players:[]}}}));e.value=ze,N.info("Données des saisons chargées",{count:e.value.length}),e.value.forEach(Qe=>{var at,ht;N.info(`Saison finale ${Qe.name}: ${((at=Qe.events)==null?void 0:at.length)||0} événements, ${((ht=Qe.players)==null?void 0:ht.length)||0} joueurs`)})}Oe().catch(ze=>N.error("Migration sortOrder échouée",ze))}catch(ze){N.error("Erreur lors du chargement initial des saisons:",ze),N.error("Stack trace:",ze.stack);try{N.info("Tentative de fallback pour charger les saisons..."),e.value=await sl(),N.info("Saisons chargées en fallback",{count:((be=e.value)==null?void 0:be.length)||0})}catch(Qe){N.error("Échec du fallback pour charger les saisons:",Qe)}}finally{t.value=!1,N.info("Chargement terminé, isLoading = false")}const oe=()=>{D.value=window.scrollY>10};return window.addEventListener("scroll",oe,{passive:!0}),()=>{window.removeEventListener("scroll",oe)}});const F=He(()=>[...e.value].sort((oe,B)=>{var ht,Et;const be=typeof oe.sortOrder=="number"?oe.sortOrder:Number.MAX_SAFE_INTEGER,ze=typeof B.sortOrder=="number"?B.sortOrder:Number.MAX_SAFE_INTEGER;if(be!==ze)return be-ze;const Qe=(ht=oe.createdAt)!=null&&ht.toMillis?oe.createdAt.toMillis():0,at=(Et=B.createdAt)!=null&&Et.toMillis?B.createdAt.toMillis():0;return Qe!==at?at-Qe:(oe.name||"").localeCompare(B.name||"")}));function V(oe){r.push(`/season/${oe}`)}function C(oe){s.value=s.value===oe?null:oe}function Fe(){s.value=null}function vt(oe){L.value=oe,g.value=oe.name,v.value=oe.description||"",x.value=null,w.value=oe.logoUrl||"",a.value=!0,Fe()}function It(){a.value=!1,L.value=null,g.value="",v.value="",x.value=null,w.value="",$.value=!1}async function We(){a.value=!1,await he({type:"editSeason",data:{seasonId:L.value.id,seasonName:L.value.name,newName:g.value.trim(),newDescription:v.value.trim(),newLogo:x.value,newLogoPreview:w.value,oldName:L.value.name,oldDescription:L.value.description||"",oldLogoUrl:L.value.logoUrl||""}})}function Se(){const oe=document.querySelector(".help-section");oe&&oe.scrollIntoView({behavior:"smooth"})}function me(){const oe=document.querySelector(".seasons-section");oe&&oe.scrollIntoView({behavior:"smooth"})}function Be(oe){const B=oe.target.files[0];if(B){x.value=B,$.value=!0;const be=new FileReader;be.onload=ze=>{w.value=ze.target.result,$.value=!1},be.onerror=()=>{$.value=!1},be.readAsDataURL(B)}}function ae(){console.log("removeLogo appelé"),x.value=null,w.value="",console.log("Logo supprimé")}function re(){const oe=document.querySelector('input[type="file"][accept="image/*"]');oe?oe.click():console.error("Input file non trouvé pour triggerLogoUpload")}async function Oe(){if(!e.value.length)return;const oe=e.value.map(be=>typeof be.sortOrder=="number"?be.sortOrder:null).filter(be=>be!==null);let B=oe.length?Math.max(...oe):0;for(const be of e.value)if(typeof be.sortOrder!="number"){B+=1;try{await xu(be.id,B),be.sortOrder=B}catch(ze){N.error("Erreur migration sortOrder",{seasonName:be==null?void 0:be.name,error:ze})}}}async function St(oe){try{if(!(oe!=null&&oe.id)){alert("Saison introuvable");return}const[B,be]=await Promise.all([Fh(oe.id),Qu(oe.id)]),[ze,Qe]=await Promise.all([zo(be,B,oe.id),Ho(oe.id)]),at=["Joueur",...B.map(Gn=>kt(Gn))],ht=[];for(const Gn of be){const nr=(Gn==null?void 0:Gn.name)||"",On=(ze==null?void 0:ze[nr])||{},wi=[nr,...B.map(Ds=>rt(On[Ds.id],Qe==null?void 0:Qe[Ds.id],nr))];ht.push(wi)}const Et=we([at,...ht]),$n=new Blob(["\uFEFF"+Et],{type:"text/csv;charset=utf-8;"}),Pt=(oe==null?void 0:oe.name)||(oe==null?void 0:oe.slug)||"saison",Ir=`${ke(Pt)}-disponibilites.csv`,Ze=URL.createObjectURL($n),lt=document.createElement("a");lt.href=Ze,lt.download=Ir,document.body.appendChild(lt),lt.click(),document.body.removeChild(lt),URL.revokeObjectURL(Ze),N.info("Export CSV saison",{seasonId:oe.id,events:B.length,players:be.length})}catch(B){N.error("Erreur export CSV",B),alert("Erreur lors de l'export CSV. Veuillez réessayer.")}}function Ot(oe){if(!oe)return null;if(oe instanceof Date)return oe;if(typeof(oe==null?void 0:oe.toDate)=="function")return oe.toDate();if(typeof oe=="string"||typeof oe=="number"){const B=new Date(oe);return isNaN(B.getTime())?null:B}return null}function kt(oe){const B=Ot(oe==null?void 0:oe.date),be=B?`${B.getFullYear()}-${String(B.getMonth()+1).padStart(2,"0")}-${String(B.getDate()).padStart(2,"0")}`:"",ze=(oe==null?void 0:oe.title)||"Sans titre";return`${be} · ${ze}`.trim()}function Q(oe){return oe===!0||oe==="oui"?"disponible":oe===!1||oe==="non"?"non disponible":""}function we(oe){return oe.map(B=>B.map(ye).join(",")).join(`
`)}function ye(oe){const B=String(oe??"");return/[",\n\r]/.test(B)?'"'+B.replace(/"/g,'""')+'"':B}function ke(oe){return String(oe||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9\-_. ]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$|^\.+|\.+$/g,"")||"fichier"}function rt(oe,B,be){return Array.isArray(B)&&B.includes(be)?oe===!1||oe==="non"?"non disponible":"sélectionné":Q(oe)}async function yt(oe){if(Fe(),oe<=0)return;const B=[...F.value],be=B[oe],ze=B[oe-1],Qe=be.sortOrder;be.sortOrder=ze.sortOrder,ze.sortOrder=Qe;try{await Promise.all([xu(be.id,be.sortOrder),xu(ze.id,ze.sortOrder)])}catch(at){N.error("Erreur lors du déplacement vers le haut",at)}}async function P(oe){Fe();const B=[...F.value];if(oe>=B.length-1)return;const be=B[oe],ze=B[oe+1],Qe=be.sortOrder;be.sortOrder=ze.sortOrder,ze.sortOrder=Qe;try{await Promise.all([xu(be.id,be.sortOrder),xu(ze.id,ze.sortOrder)])}catch(at){N.error("Erreur lors du déplacement vers le bas",at)}}function M(){l.value&&(c.value=l.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function G(){f.value=f.value.replace(/[^0-9]/g,""),f.value.length>4&&(f.value=f.value.slice(0,4))}async function ue(){if(!l.value.trim()||!c.value.trim()||!f.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(f.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await W$(l.value.trim(),c.value.trim(),f.value.trim(),d.value.trim(),""),e.value=await sl(),await Oe(),ne()}catch(oe){N.error("Erreur lors de la création de la saison",oe),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function ne(){i.value=!1,l.value="",c.value="",d.value="",f.value=""}function de(oe){I.value=oe,o.value=!0}async function Ie(){o.value=!1,await he({type:"deleteSeason",data:{seasonId:I.value.id,seasonName:I.value.name}})}function Y(){o.value=!1,I.value=null}function ge(){return z.value?{deleteSeason:"Suppression de saison - Code PIN requis",editSeason:"Modification de saison - Code PIN requis"}[z.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function he(oe){const B=oe.type==="editSeason"?oe.data.seasonId:I.value.id;if(Qn.isPinCached(B)){const be=Qn.getCachedPin(B);if(N.debug("PIN en cache trouvé, utilisation automatique"),await Vh(B,be)){await qe(oe);return}else Qn.clearSession()}z.value=oe,U.value=!0}async function Re(oe){var B,be,ze,Qe;N.debug("PIN soumis pour l'opération",{operationType:(B=z.value)==null?void 0:B.type});try{const at=((ze=(be=z.value)==null?void 0:be.data)==null?void 0:ze.seasonId)||((Qe=I.value)==null?void 0:Qe.id),ht=await Vh(at,oe);if(N.debug("PIN validé",{valid:ht}),ht){Qn.saveSession(at,oe),N.debug("PIN correct, fermeture de la modal et exécution de l'opération"),U.value=!1;const Et=z.value;z.value=null,N.debug("Appel de executePendingOperation",{operationType:Et==null?void 0:Et.type}),await qe(Et)}else le.value="Code PIN incorrect",setTimeout(()=>{le.value=""},3e3)}catch(at){N.error("Erreur lors de la vérification du PIN",at),le.value="Erreur lors de la vérification du code PIN"}}function ve(){U.value=!1,z.value=null,le.value=""}function De(){return I.value&&Qn.isPinCached(I.value.id)?{timeRemaining:Qn.getTimeRemaining(),isExpiringSoon:Qn.isExpiringSoon()}:null}async function qe(oe){var ze;if(N.debug("executePendingOperation appelé",{hasOperation:!!oe}),!oe){N.warn("Aucune opération à exécuter");return}const{type:B,data:be}=oe;N.info("Exécution de l'opération",{type:B});try{switch(B){case"deleteSeason":N.info("Suppression de la saison",{seasonId:be.seasonId}),await Q$(be.seasonId),N.info("Saison supprimée, rechargement de la liste"),e.value=await sl(),N.info("Liste des saisons rechargée",{count:((ze=e.value)==null?void 0:ze.length)||0});break;case"editSeason":N.info("Modification de la saison",{seasonId:be.seasonId});const Qe=be.newName!==be.oldName,at=be.newDescription!==be.oldDescription,ht=be.newLogo!==null;if(!Qe&&!at&&!ht){N.info("Aucun changement détecté, opération annulée");return}const Et={};if(be.newName!==be.oldName&&(Et.name=be.newName),be.newDescription!==be.oldDescription&&(Et.description=be.newDescription),be.newLogo)try{$.value=!0,N.info("Upload du nouveau logo...");const Pt=await uF(be.newLogo,`season-logos/${be.seasonId}`,{resize:!0,maxWidth:64,maxHeight:64,quality:.6});if(Et.logoUrl=Pt,be.oldLogoUrl&&hF(be.oldLogoUrl))try{await dF(be.oldLogoUrl),N.info("Ancien logo supprimé")}catch(Ir){N.warn("Erreur lors de la suppression de l'ancien logo:",Ir)}}catch(Pt){throw N.error("Erreur lors de l'upload du logo:",Pt),new Error("Erreur lors de l'upload du logo: "+Pt.message)}finally{$.value=!1}await J$(be.seasonId,Et);const $n=e.value.findIndex(Pt=>Pt.id===be.seasonId);$n!==-1&&(Et.name&&(e.value[$n].name=be.newName),Et.description!==void 0&&(e.value[$n].description=be.newDescription),Et.logoUrl&&(e.value[$n].logoUrl=Et.logoUrl)),N.info("Saison modifiée avec succès",{seasonId:be.seasonId,oldName:be.oldName,newName:be.newName,oldDescription:be.oldDescription,newDescription:be.newDescription});break;default:N.warn("Type d'opération non reconnu",{type:B})}}catch(Qe){N.error("Erreur lors de l'exécution de l'opération",Qe),alert("Erreur lors de l'opération. Veuillez réessayer.")}}function Ue(){Z.value=!0}function Ye(){Z.value=!1}function ct(){Z.value=!1,bi()}function en(){A.value=!0}function Jt(){A.value=!1}function wn(){b.value=!0}function qt(){b.value=!1}function mr(){E.value=!0}function kr(){E.value=!1}function ln(){N.debug("Gestion de joueur demandée")}async function Nn(){try{await Le.signOut(),A.value=!1,N.info("Utilisateur déconnecté avec succès")}catch(oe){N.error("Erreur lors de la déconnexion",oe),alert("Erreur lors de la déconnexion. Veuillez réessayer.")}}async function bi(){try{const oe=await zA();if(oe){r.push(`/season/${oe}`);return}}catch(oe){N.warn("Impossible de récupérer la saison préférée",oe)}me()}return An(()=>(yl(),()=>{})),Ct(()=>r.currentRoute.value.path,async oe=>{var B;if(oe==="/"&&(yl(),e.value.length===0&&!t.value)){t.value=!0;try{e.value=await sl(),N.info("Saisons rechargées lors du changement de route",{count:((B=e.value)==null?void 0:B.length)||0})}catch(be){N.error("Erreur lors du rechargement des saisons",be)}finally{t.value=!1}}},{immediate:!0}),(oe,B)=>{var be,ze,Qe,at,ht,Et,$n,Pt,Ir;return k(),O("div",k6,[je(zU,{"is-scrolled":D.value,onOpenAccountMenu:en,onOpenHelp:Se,onOpenNotifications:wn,onOpenPlayers:mr,onLogout:Nn,onOpenLogin:Ue},null,8,["is-scrolled"]),h("section",D6,[h("div",N6,[h("div",O6,[h("div",V6,[B[13]||(B[13]=lr('<div class="text-center order-2 lg:order-1"><div class="hero-content-wrapper"><div class="hero-illustration relative hidden lg:block"><div class="relative mx-auto lg:mx-0 w-full max-w-lg"><div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-4 shadow-2xl border border-white/10 relative overflow-hidden"><div class="absolute inset-0 bg-gradient-to-br from-pink-500/10 via-purple-500/10 to-cyan-500/10 rounded-3xl blur-xl"></div><div class="relative z-10"><div class="flex items-center gap-3 mb-4"><div class="flex gap-2"><div class="w-3 h-3 bg-red-500 rounded-full"></div><div class="w-3 h-3 bg-yellow-500 rounded-full"></div><div class="w-3 h-3 bg-green-500 rounded-full"></div></div><div class="text-gray-400 text-sm">HatCast - Grille des disponibilités</div></div></div><div class="bg-gray-700 rounded-2xl p-4 min-h-[300px]"><div class="grid grid-cols-4 gap-2 mb-4"><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">15 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">22 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">29 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">5 Fév</div></div><div class="space-y-2"><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Marie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-gray-500/20 border border-gray-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Pierre</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Sophie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div></div></div></div></div><div class="absolute -top-4 -right-4 w-20 h-20 bg-gradient-to-r from-pink-400 to-purple-500 rounded-2xl shadow-xl transform rotate-12 z-30"></div><div class="absolute -bottom-4 -left-4 w-16 h-16 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-2xl shadow-xl transform -rotate-12 z-30 flex items-center justify-center"><img src="'+aF+'" alt="Masque HatCast" class="w-10 h-10 object-contain transform rotate-12"></div></div></div></div>',1)),h("div",M6,[B[12]||(B[12]=lr('<div class="hero-title mb-8"><h1 class="text-4xl md:text-6xl font-bold text-white mb-6 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent leading-tight"> Faites vos équipes d&#39;impro…<br>en un clin d&#39;œil </h1></div><div class="hero-subtitle mb-10"><p class="text-xl md:text-2xl text-gray-300 leading-relaxed max-w-2xl"> Plus de casse-tête pour savoir qui joue quand. Chacun indique ses dispos, <strong class="text-white">HatCast compose l&#39;équipe pour vous</strong>, équitablement et sans tension. </p></div>',2)),h("div",L6,[h("div",$6,[h("button",{onClick:B[0]||(B[0]=Ze=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-5 px-10 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105 text-lg md:text-xl"}," 🚀 Démarrez "),h("button",{onClick:Se,class:"inline-flex items-center gap-2 text-cyan-300 hover:text-cyan-200 font-medium py-3 px-6 rounded-lg hover:bg-cyan-500/10 transition-all duration-300 border border-cyan-500/30 hover:border-cyan-400/50"},B[10]||(B[10]=[h("span",null,"ℹ️",-1),ut(" En savoir plus ")]))])]),h("div",{class:"hero-hint text-center"},[h("button",{onClick:me,class:"inline-flex items-center gap-2 text-gray-400 hover:text-cyan-300 transition-all duration-300 text-sm cursor-pointer group"},B[11]||(B[11]=[h("span",{class:"group-hover:animate-bounce"},"↓",-1),h("span",null,"Vos saisons ci-dessous",-1),h("span",{class:"group-hover:animate-bounce"},"↓",-1)]))])])])])]),B[14]||(B[14]=h("div",{class:"hero-background absolute inset-0 z-0"},[h("div",{class:"absolute top-20 left-10 w-32 h-32 bg-pink-500/10 rounded-full blur-3xl"}),h("div",{class:"absolute bottom-20 right-10 w-40 h-40 bg-purple-500/10 rounded-full blur-3xl"}),h("div",{class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-cyan-500/5 rounded-full blur-3xl"})],-1))]),h("section",F6,[h("div",U6,[B[32]||(B[32]=h("div",{class:"text-center mb-12"},[h("h2",{class:"text-3xl md:text-4xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"}," Saisons en cours "),h("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto"}," Sélectionnez une saison pour gérer les disponibilités et équipes. ")],-1)),h("div",{class:"pb-16","aria-busy":t.value},[t.value?(k(),O("div",B6,[(k(),O(bt,null,Lr(8,Ze=>h("div",{key:"skeleton-"+Ze,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8 w-full max-w-sm"},B[15]||(B[15]=[h("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),h("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),h("div",{class:"h-px bg-white/10 mb-4"},null,-1),h("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(k(),O("div",q6,[(k(!0),O(bt,null,Lr(F.value,(Ze,lt)=>{var Gn,nr;return k(),O("div",{key:Ze.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20 w-full max-w-sm"},[h("div",{onClick:On=>V(Ze.slug),class:"text-center cursor-pointer"},[h("div",H6,[Ze.logoUrl?(k(),O("img",{key:0,src:Ze.logoUrl,alt:`Logo de ${Ze.name}`,class:"w-full h-full object-cover"},null,8,K6)):(k(),O("span",G6,"🎭"))]),h("h2",W6,ee(Ze.name),1),Ze.description?(k(),O("p",Q6,ee(Ze.description),1)):ie("",!0),B[18]||(B[18]=h("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),h("div",J6,[h("div",Y6,[h("div",X6,ee(((Gn=Ze.events)==null?void 0:Gn.length)||0),1),B[16]||(B[16]=h("div",{class:"text-gray-400 text-xs"},"Événements",-1))]),h("div",Z6,[h("div",e5,ee(((nr=Ze.players)==null?void 0:nr.length)||0),1),B[17]||(B[17]=h("div",{class:"text-gray-400 text-xs"},"Joueurs",-1))])])],8,z6),h("div",t5,[h("div",{class:"relative",onClick:B[1]||(B[1]=ft(()=>{},["stop"]))},[h("button",{onClick:On=>C(lt),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===lt,"aria-haspopup":"true",title:"Options"},B[19]||(B[19]=[h("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,n5),s.value===lt?(k(),O("div",r5,[h("button",{onClick:On=>{St(Ze),Fe()},class:"w-full text-left px-4 py-2 text-sm text-emerald-300 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},B[20]||(B[20]=[h("span",null,"📊",-1),ut(" Exporter CSV ")]),8,s5),B[25]||(B[25]=h("div",{class:"border-t border-white/10 my-1"},null,-1)),h("button",{onClick:On=>yt(lt),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},B[21]||(B[21]=[h("span",null,"⬆️",-1),ut(" Avancer ")]),8,i5),h("button",{onClick:On=>P(lt),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},B[22]||(B[22]=[h("span",null,"⬇️",-1),ut(" Reculer ")]),8,o5),B[26]||(B[26]=h("div",{class:"border-t border-white/10 my-1"},null,-1)),h("button",{onClick:On=>vt(Ze),class:"w-full text-left px-4 py-2 text-sm text-blue-300 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},B[23]||(B[23]=[h("span",null,"✏️",-1),ut(" Modifier ")]),8,a5),B[27]||(B[27]=h("div",{class:"border-t border-white/10 my-1"},null,-1)),h("button",{onClick:On=>de(Ze),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2",role:"menuitem"},B[24]||(B[24]=[h("span",null,"🗑️",-1),ut(" Supprimer ")]),8,l5)])):ie("",!0)])])])}),128))])):ie("",!0),h("div",u5,[h("button",{onClick:B[2]||(B[2]=Ze=>i.value=!0),class:"inline-flex items-center gap-3 bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-semibold py-4 px-8 rounded-xl text-lg hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-pink-500/25"},B[28]||(B[28]=[h("span",null,"➕",-1),ut(" Nouvelle saison ")]))]),!t.value&&e.value.length===0?(k(),O("div",c5,[B[29]||(B[29]=h("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[h("span",{class:"text-4xl"},"🎪")],-1)),B[30]||(B[30]=h("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),B[31]||(B[31]=h("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),h("button",{onClick:B[3]||(B[3]=Ze=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):ie("",!0)],8,j6)])]),i.value?(k(),O("div",d5,[h("div",h5,[B[39]||(B[39]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),h("div",f5,[B[33]||(B[33]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),it(h("input",{"onUpdate:modelValue":B[4]||(B[4]=Ze=>l.value=Ze),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:M},null,544),[[$t,l.value]])]),h("div",p5,[B[34]||(B[34]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),it(h("input",{"onUpdate:modelValue":B[5]||(B[5]=Ze=>c.value=Ze),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[$t,c.value]])]),h("div",m5,[B[35]||(B[35]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description (optionnel)",-1)),it(h("textarea",{"onUpdate:modelValue":B[6]||(B[6]=Ze=>d.value=Ze),rows:"3",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",placeholder:"Ex: Saison 2025-2026 de la troupe d'improvisation La Malice"},null,512),[[$t,d.value]]),B[36]||(B[36]=h("p",{class:"text-xs text-gray-400 mt-1"},"Une brève description de votre saison",-1))]),h("div",g5,[B[37]||(B[37]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),it(h("input",{"onUpdate:modelValue":B[7]||(B[7]=Ze=>f.value=Ze),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:G},null,544),[[$t,f.value]]),B[38]||(B[38]=h("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),h("div",v5,[h("button",{onClick:ne,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:ue,disabled:!l.value.trim()||!c.value.trim()||!f.value.trim()||f.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,y5)])])])):ie("",!0),o.value?(k(),O("div",_5,[h("div",b5,[h("div",w5,[B[40]||(B[40]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"⚠️")],-1)),B[41]||(B[41]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),h("p",x5,'Êtes-vous sûr de vouloir supprimer la saison "'+ee((be=I.value)==null?void 0:be.name)+'" ?',1)]),B[42]||(B[42]=h("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:Y,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:Ie,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ie("",!0),a.value?(k(),O("div",I5,[h("div",E5,[h("div",T5,[B[43]||(B[43]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"✏️")],-1)),B[44]||(B[44]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Modifier la saison",-1)),h("p",A5,'Modifiez les informations de la saison "'+ee((ze=L.value)==null?void 0:ze.name)+'"',1)]),h("div",S5,[B[45]||(B[45]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),it(h("input",{"onUpdate:modelValue":B[8]||(B[8]=Ze=>g.value=Ze),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026"},null,512),[[$t,g.value]])]),h("div",P5,[B[46]||(B[46]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description (optionnel)",-1)),it(h("textarea",{"onUpdate:modelValue":B[9]||(B[9]=Ze=>v.value=Ze),rows:"3",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400 resize-none",placeholder:"Ex: Saison 2025-2026 de la troupe d'improvisation La Malice"},null,512),[[$t,v.value]])]),h("div",R5,[B[47]||(B[47]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Logo de la troupe (optionnel)",-1)),w.value||(Qe=L.value)!=null&&Qe.logoUrl?(k(),O("div",C5,[h("div",k5,[h("img",{src:w.value||((at=L.value)==null?void 0:at.logoUrl),alt:`Logo de ${(ht=L.value)==null?void 0:ht.name}`,class:"w-full h-full object-cover"},null,8,D5)]),w.value||(Et=L.value)!=null&&Et.logoUrl?(k(),O("button",{key:0,onClick:ae,type:"button",class:"text-xs text-red-400 hover:text-red-300 transition-colors"}," Supprimer le logo ")):ie("",!0)])):ie("",!0),h("div",{class:dn(["border-2 border-dashed rounded-lg p-6 text-center transition-all duration-300",$.value?"border-blue-500 bg-blue-900/20 animate-pulse":"border-gray-600 hover:border-gray-500"])},[h("input",{ref:"logoFileInput",type:"file",accept:"image/*",onChange:Be,class:"hidden"},null,544),h("button",{onClick:re,type:"button",disabled:$.value,class:"text-gray-300 hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[$.value?(k(),O("div",O5,"⏳")):(k(),O("div",V5,"📷")),h("div",M5,[$.value?(k(),O("span",L5," Upload en cours... ")):!w.value&&!(($n=L.value)!=null&&$n.logoUrl)?(k(),O("span",$5," Cliquez pour ajouter un logo ")):(k(),O("span",F5," Cliquez pour changer le logo "))]),$.value?ie("",!0):(k(),O("div",U5," PNG, JPG, GIF (max 5MB) "))],8,N5)],2)]),B[49]||(B[49]=h("p",{class:"mb-6 text-sm text-blue-400 bg-blue-900/20 p-3 rounded-lg border border-blue-500/20"}," ℹ️ Le slug de l'URL restera inchangé pour préserver les liens existants. ",-1)),h("div",j5,[h("button",{onClick:It,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:We,disabled:!g.value.trim()||g.value.trim()===((Pt=L.value)==null?void 0:Pt.name)&&v.value===(((Ir=L.value)==null?void 0:Ir.description)||"")&&!x.value||$.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"},[$.value?(k(),O("span",q5,B[48]||(B[48]=[h("span",{class:"animate-spin"},"⏳",-1),ut(" Upload en cours... ")]))):(k(),O("span",z5,"Modifier"))],8,B5)])])])):ie("",!0),je(GA,{show:U.value,message:ge(),error:le.value,"session-info":De(),onSubmit:Re,onCancel:ve},null,8,["show","message","error","session-info"]),B[50]||(B[50]=lr('<section class="help-section py-20 bg-gradient-to-br from-gray-900/50 to-gray-800/50 border-t border-white/10"><div class="container mx-auto px-4"><div class="max-w-6xl mx-auto"><div class="text-center mb-16"><h2 class="text-4xl md:text-5xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"> Qu&#39;est-ce que HatCast ? </h2><p class="text-xl text-purple-300 max-w-3xl mx-auto"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête </p></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16"><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-pink-500/20 to-purple-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-pink-500/30"><span class="text-4xl">🎭</span></div><h3 class="text-xl font-bold text-white mb-3">Gestion des saisons</h3><p class="text-gray-300 text-sm leading-relaxed"> Déclarez tous vos spectacles et indiquez combien de joueurs vous aurez besoin. Organisez votre saison d&#39;impro de A à Z. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-purple-500/20 to-cyan-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-purple-500/30"><span class="text-4xl">📅</span></div><h3 class="text-xl font-bold text-white mb-3">Sondage de disponibilités</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez des sondages pour vos événements. Chaque joueur indique ses disponibilités et HatCast optimise la composition des équipes. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-cyan-500/20 to-pink-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-cyan-500/30"><span class="text-4xl">🎲</span></div><h3 class="text-xl font-bold text-white mb-3">Sélection auto ou manuelle</h3><p class="text-gray-300 text-sm leading-relaxed"> Laissez le hasard pondéré décider ou reprenez la main à tout moment. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-green-500/20 to-blue-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-green-500/30"><span class="text-4xl">📱</span></div><h3 class="text-xl font-bold text-white mb-3">Pensé pour le mobile</h3><p class="text-gray-300 text-sm leading-relaxed"> Utilisez HatCast facilement sur smartphone ou tablette, où que vous soyez. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-blue-500/20 to-indigo-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-blue-500/30"><span class="text-4xl">🔐</span></div><h3 class="text-xl font-bold text-white mb-3">Comptes facultatifs</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez un compte pour recevoir des rappels et sécuriser vos infos. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-emerald-500/20 to-teal-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-emerald-500/30"><span class="text-4xl">🔔</span></div><h3 class="text-xl font-bold text-white mb-3">Notifications intelligentes</h3><p class="text-gray-300 text-sm leading-relaxed"> Recevez des alertes par email et push pour les événements et sélections. Restez informé sans être submergé. </p></div></div></div></div></section><footer class="border-t border-white/10 bg-gradient-to-br from-gray-950 to-black"><div class="container mx-auto px-4 py-12"><div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8"><div><div class="flex items-center gap-3 mb-4"><div class="relative w-32 h-8"><img src="'+$m+'" alt="Logo HatCast" class="w-full h-full brightness-0 invert"></div></div><p class="text-gray-300 text-sm leading-relaxed max-w-md"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête. </p></div><div><h4 class="text-white font-semibold mb-4 text-sm uppercase tracking-wider">Feedback</h4><div class="space-y-2"><a href="https://github.com/plamarque/hatcast/issues" target="_blank" rel="noopener noreferrer" class="block text-gray-300 hover:text-blue-300 transition-colors text-sm"> 🐛 Signaler un bug </a><a href="https://github.com/plamarque/hatcast" target="_blank" rel="noopener noreferrer" class="block text-gray-300 hover:text-blue-300 transition-colors text-sm"> 🔗 Code source </a></div></div></div><div class="text-center text-xs text-gray-500 pt-6"><span>© Patrice Lamarque 2025</span></div></div></footer>',2)),je(WA,{show:Z.value,onClose:Ye,onSuccess:ct},null,8,["show"]),je(h1,{show:A.value,onClose:Jt,onLogoutDevice:Nn},null,8,["show"]),je(f1,{show:b.value,onClose:qt},null,8,["show"]),je(p1,{show:E.value,onClose:kr,onManagePlayer:ln},null,8,["show"])])}}};function K5({reason:n,recipientName:e,eventTitle:t,eventDate:r,urls:s={},prefs:i={},extra:o={}}){var l,c;const a={email:null,push:null};if(n==="availability_request"||n==="availability_reminder"){const d=(i==null?void 0:i.notifyAvailability)!==!1,f=(i==null?void 0:i.notifyAvailabilityPush)!==!1;a.email={enabled:d,subject:n==="availability_reminder"?`Rappel disponibilité · ${t} (${r})`:`Disponibilité demandée · ${t} (${r})`},a.push={enabled:f,title:n==="availability_reminder"?"⏰ Rappel disponibilité":"🎯 Nouveau spectacle !",body:n==="availability_reminder"?`${e}, ${t} (${r})`:`🎭 On a besoin de toi pour ${t} le ${r} !`,data:{url:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,reason:n}},console.log("URLs pour notifications de disponibilité:",{eventUrl:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,urls:s})}if(n==="selection"){const d=(i==null?void 0:i.notifySelection)!==!1,f=(i==null?void 0:i.notifySelectionPush)!==!1;a.email={enabled:d,subject:`🎭 Equipe pour ${t}`},a.push={enabled:f,title:"🎭 Tu es sélectionné(e) !",body:`🕺 Prépares-toi à briller pour ${t} le ${r}!`,data:{url:s.eventUrl,noUrl:s.noUrl,reason:n}},console.log("URLs pour notifications de sélection:",{eventUrl:s.eventUrl,noUrl:s.noUrl,urls:s})}return console.log("buildNotificationPayloads",{reason:n,recipientName:e,prefs:i,payloads:a,emailEnabled:(l=a.email)==null?void 0:l.enabled,pushEnabled:(c=a.push)==null?void 0:c.enabled}),a}async function G5({reason:n,recipientEmail:e,recipientName:t,eventTitle:r,eventDate:s,urls:i={},extra:o={}}){var g;if(!e)return{success:!1,skipped:!0,reason:"missing_email"};const a=await Ht(_e(te,"userPreferences",e)).catch(()=>null),l=a!=null&&a.exists()?a.data():{},c=K5({reason:n,recipientName:t,eventTitle:r,eventDate:s,urls:i,prefs:l,extra:o}),d=[];return c.email&&c.email.enabled&&(n==="availability_request"||n==="availability_reminder"?await GF({toEmail:e,playerName:t,eventTitle:r,eventDate:s,yesUrl:i.yesUrl,noUrl:i.noUrl,eventUrl:i.eventUrl,reason:n==="availability_reminder"?"reminder":"new_event"}).then(()=>d.push({channel:"email",success:!0})).catch(v=>{N.error("notifyRecipientAcrossChannels email error",v),d.push({channel:"email",success:!1})}):n==="selection"&&d.push({channel:"email",success:!0,skipped:!0,note:"batch_handled_elsewhere"})),c.push&&c.push.enabled?(N.debug("Envoi notification push",{reason:n,recipientEmail:e,title:c.push.title,body:c.push.body}),await Zc({toEmail:e,title:c.push.title,body:c.push.body,data:c.push.data||{},reason:n}).then(()=>{N.info("Notification push envoyée avec succès",{reason:n,recipientEmail:e}),d.push({channel:"push",success:!0})}).catch(v=>{N.error("notifyRecipientAcrossChannels push error",v),d.push({channel:"push",success:!1})})):N.debug("Notification push désactivée ou non configurée",{reason:n,recipientEmail:e,hasPayload:!!c.push,enabled:(g=c.push)==null?void 0:g.enabled,prefs:l}),{success:d.some(v=>v.success),results:d}}async function Kb({eventId:n,eventData:e,players:t,seasonId:r,seasonSlug:s,createMagicLink:i,reminder:o=!1,getAvailabilityForEvent:a=null}){const l=[],c=`${window.location.origin}/season/${s}/event/${n}`;for(const d of t)try{if(o&&typeof a=="function"){const v=await Promise.resolve(a(d.name,n));if(v===!0||v===!1)continue}const f={};if(typeof i=="function"){const v=await i({seasonId:r,playerId:d.id,eventId:n,action:"yes"}),x=await i({seasonId:r,playerId:d.id,eventId:n,action:"no"});f.yesUrl=`${v.url}&slug=${encodeURIComponent(s)}`,f.noUrl=`${x.url}&slug=${encodeURIComponent(s)}`}f.eventUrl=c,(await G5({reason:o?"availability_reminder":"availability_request",recipientEmail:d.email,recipientName:d.name,eventTitle:e.title,eventDate:W5(e.date),urls:f})).success||l.push(d.id)}catch{l.push(d.id)}return{success:!0,failures:l}}async function Gb(n){return YF(n)}function W5(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Q5(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//HatCast//Calendar Event//FR","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${n.id}@impropick.com`,`DTSTAMP:${new Date().toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTSTART:${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTEND:${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`SUMMARY:${n.title}`,`DESCRIPTION:${n.description||""}${e?`\\n\\nSaison : ${e}`:""}`,"STATUS:CONFIRMED","SEQUENCE:0","BEGIN:VALARM","TRIGGER:-PT1H","ACTION:DISPLAY",`DESCRIPTION:Rappel : ${n.title}`,"END:VALARM","END:VEVENT","END:VCALENDAR"].join(`\r
`)}function J5(n,e=""){const t=Q5(n,e),r=new Blob([t],{type:"text/calendar;charset=utf-8"}),s=URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=`${n.title.replace(/[^a-z0-9]/gi,"_")}_${n.date}.ics`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}function Y5(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://calendar.google.com/calendar/render?${new URLSearchParams({action:"TEMPLATE",text:n.title,dates:`${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z/${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,details:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"HatCast",sf:"true",output:"xml"}).toString()}`}function X5(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://outlook.live.com/calendar/0/deeplink/compose?${new URLSearchParams({subject:n.title,startdt:r.toISOString(),enddt:s.toISOString(),body:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"HatCast",allday:"false"}).toString()}`}function Z5(n,e=""){const t=Y5(n,e);window.open(t,"_blank")}function ej(n,e=""){const t=X5(n,e);window.open(t,"_blank")}function tj(n,e,t=""){switch(n){case"ics":J5(e,t);break;case"google":Z5(e,t);break;case"outlook":ej(e,t);break;default:console.warn("Type de calendrier non supporté:",n)}}function v1(){const n=!!localStorage.getItem("fcmToken")||!!localStorage.getItem("userEmail")||!!localStorage.getItem("authUser"),e=Notification.permission==="granted"&&!!localStorage.getItem("fcmToken");return!n&&!e}async function y1({seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i}){try{let o=i;try{const c=await Ht(_e(te,"seasons",n));c.exists()&&(o=c.data().title||i)}catch(c){console.warn("Impossible de récupérer le titre de la saison, utilisation du slug:",c)}const a=await Lh({seasonId:n,playerId:"notification_activation",eventId:e,action:"activate_notifications",slug:i}),l=`${n}_${e}_${r.replace(/[^a-zA-Z0-9]/g,"_")}`;return await Xt(_e(te,"notificationActivations",l),{seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i,magicLinkId:a.id,magicLinkUrl:a.url,requestedAt:tr(),status:"pending"}),await ZF({toEmail:r,playerName:t,eventTitle:s,eventUrl:`${window.location.origin}/season/${i}/event/${e}`,activationUrl:a.url,seasonTitle:o}),N.info("Demande d'activation des notifications créée",{activationId:l,email:r,playerName:t,eventId:e}),{success:!0,activationId:l,magicLink:a}}catch(o){throw N.error("Erreur lors de la création de la demande d'activation",o),o}}async function nj(n){try{const e=await rj(n);if(!e)throw new Error("Données d'activation introuvables");const{verifyMagicLink:t}=await mt(()=>Promise.resolve().then(()=>e1),void 0);if(!(await t({seasonId:e.seasonId,playerId:"notification_activation",eventId:e.eventId,token:n,action:"activate_notifications"})).valid)throw new Error("Magic link invalide ou expiré");const s=await _1(),i=await oj(e.email);return await b1(e.email,{notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),await sj(e.activationId),await w1(e),N.info("Notifications activées avec succès",{email:e.email,playerName:e.playerName,pushStatus:s}),{success:!0,email:e.email,playerName:e.playerName,pushStatus:s,accountStatus:i}}catch(e){throw N.error("Erreur lors de l'activation des notifications",e),e}}async function rj(n){try{const{collection:e,query:t,where:r,getDocs:s}=await mt(()=>import("./index.esm-e12eeb83.js"),[]),i=t(e(te,"notificationActivations"),r("status","==","pending")),o=await s(i);for(const a of o.docs){const l=a.data();if(l.magicLinkUrl&&l.magicLinkUrl.includes(n))return{...l,activationId:a.id}}return null}catch(e){return N.error("Erreur lors de la récupération des données d'activation",e),null}}async function _1(){try{if(!await Xv())return{active:!1,reason:"not_supported"};if(await Notification.requestPermission()!=="granted")return{active:!1,reason:"permission_denied"};const e=await UA();return e?{active:!0,token:e}:{active:!1,reason:"token_failed"}}catch(n){return N.error("Erreur lors de l'activation des notifications push",n),{active:!1,reason:"error",error:n.message}}}async function b1(n,e){try{await Xt(_e(te,"userPreferences",n),{...e,updatedAt:tr(),notificationActivatedAt:tr()},{merge:!0})}catch(t){throw N.error("Erreur lors de la mise à jour des préférences",t),t}}async function sj(n){try{await Io(_e(te,"notificationActivations",n),{status:"completed",completedAt:tr()})}catch(e){N.error("Erreur lors de la finalisation de l'activation",e)}}async function w1(n){try{const{collection:e,query:t,where:r,getDocs:s,setDoc:i}=await mt(()=>import("./index.esm-e12eeb83.js"),[]),o=t(e(te,"playerAssociations"),r("email","==",n.email),r("seasonId","==",n.seasonId));if(!(await s(o)).empty){N.info("Association joueur-email déjà existante",{email:n.email,seasonId:n.seasonId});return}await i(_e(te,"playerAssociations",`${n.seasonId}_${n.email}`),{email:n.email,seasonId:n.seasonId,playerName:n.playerName,associatedAt:tr(),source:"notification_activation"}),N.info("Joueur associé à l'email",{email:n.email,playerName:n.playerName,seasonId:n.seasonId})}catch(e){N.error("Erreur lors de l'association du joueur",e)}}async function ij({seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i}){try{console.log("🔔 Activation directe des notifications pour utilisateur connecté");const o=await _1();return await b1(r,{notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),await w1({seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i}),N.info("Notifications activées directement pour utilisateur connecté",{email:r,playerName:t,eventId:e,pushStatus:o}),{success:!0,email:r,playerName:t,pushStatus:o,directActivation:!0}}catch(o){throw N.error("Erreur lors de l'activation directe des notifications",o),o}}async function oj(n){try{const{auth:e}=await mt(()=>Promise.resolve().then(()=>Qr),void 0),{signInWithEmailAndPassword:t,createUserWithEmailAndPassword:r}=await mt(()=>import("./index.esm-e8328fa5.js"),[]);try{return await t(e,n,"temp_password_123"),N.info("Compte Firebase Auth existant trouvé",{email:n}),{created:!1,reason:"already_exists"}}catch(s){if(s.code==="auth/user-not-found")try{const i=await r(e,n,"temp_password_123"),{sendPasswordResetEmail:o}=await mt(()=>import("./index.esm-e8328fa5.js"),[]);return await o(e,n),N.info("Compte Firebase Auth créé avec succès",{email:n,uid:i.user.uid}),{created:!0,reason:"new_account_created",uid:i.user.uid,passwordResetSent:!0}}catch(i){return N.error("Erreur lors de la création du compte Firebase Auth",i),{created:!1,reason:"creation_failed",error:i.message}}else return N.warn("Erreur de connexion Firebase Auth",{email:n,error:s.code}),{created:!1,reason:"auth_error",error:s.code}}}catch(e){return N.error("Erreur lors de la vérification/création du compte Firebase Auth",e),{created:!1,reason:"general_error",error:e.message}}}const x1=Object.freeze(Object.defineProperty({__proto__:null,activateNotificationsForConnectedUser:ij,createNotificationActivationRequest:y1,processNotificationActivation:nj,shouldPromptForNotifications:v1},Symbol.toStringTag,{value:"Module"}));const aj={class:"space-y-4"},lj={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},uj={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},cj={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},dj={key:0,class:"space-y-3"},hj={class:"text-gray-300 text-sm mb-3"},fj={class:"text-white font-medium"},pj={class:"text-green-400 font-medium"},mj={class:"text-yellow-400 font-medium"},gj={class:"flex flex-wrap gap-2"},vj=["title"],yj={key:0,class:"text-green-400 text-xs"},_j={key:1,class:"text-yellow-400 text-xs"},bj={key:1,class:"text-amber-400 text-sm"},wj={class:"space-y-3"},xj={key:0,class:"fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in"},Ij={class:"whitespace-pre-wrap font-sans"},Ej={__name:"MessagePreview",props:{mode:{type:String,required:!0,validator:n=>["event","selection"].includes(n)},event:{type:Object,required:!0},seasonId:{type:String,required:!0},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},selectedPlayers:{type:Array,default:()=>[]},availabilityByPlayer:{type:Object,default:()=>({})}},setup(n){const e=n,t=S(!1),r=S(!1),s=S([]),i=S([]),o=S([]),a=He(()=>!e.event||!e.seasonSlug?"":`${window.location.origin}/season/${e.seasonSlug}/event/${e.event.id}`),l=He(()=>{const x=i.value.map(I=>({...I,hasContact:I.id!=="ALL",missingReason:""})),w=o.value.map(I=>({...I,hasContact:!1,missingReason:"Aucun canal actif"}));return[{id:"ALL",name:"Tous",hasContact:!0},...x.filter(I=>I.id!=="ALL"),...w]}),c=He(()=>{var L,$;if(!e.event)return"";const x=g((L=e.event)==null?void 0:L.date),w=($=e.event)==null?void 0:$.title,I=a.value;return e.mode==="event"?BF({playerName:"",eventTitle:w,eventDate:x,eventUrl:I}):qF({playerName:"",eventTitle:w,eventDate:x,eventUrl:I})}),d=He(()=>c.value);function f(){navigator.clipboard.writeText(d.value),r.value=!0,setTimeout(()=>{r.value=!1},2e3)}function g(x){if(!x)return"";const w=new Date(x),I={weekday:"long",day:"numeric",month:"long",year:"numeric"};return w.toLocaleDateString("fr-FR",I)}async function v(){if(!e.seasonId)return;let x=[];e.mode==="selection"?(x=e.players.filter($=>e.selectedPlayers.includes($.name)),console.log("Mode sélection - targetPlayers:",x)):(x=e.players,console.log("Mode événement - targetPlayers (tous):",x));const w=[];for(const $ of x)try{const{getPlayerEmail:U}=await mt(()=>Promise.resolve().then(()=>td),void 0),z=await U($.id,e.seasonId);console.log(`Email pour ${$.name}:`,z),z&&w.push({...$,email:z})}catch(U){console.warn(`Impossible de charger l'email pour ${$.name}:`,U)}console.log("Players avec email:",w),s.value=w;const I={id:"ALL",name:"Tous"};i.value=[I,...w];const L=x.filter($=>!w.find(U=>U.id===$.id)).map($=>({id:$.id,name:$.name}));o.value=L,console.log("Recipients finaux:",{recipients:i.value,nonContactRecipients:o.value,allDisplayRecipients:l.value})}return An(()=>{v()}),Ct(()=>[e.selectedPlayers,e.availabilityByPlayer],()=>{v()},{deep:!0}),(x,w)=>(k(),O("div",aj,[h("div",null,[h("label",lj,[w[1]||(w[1]=ut(" Personnes à Prévenir ")),h("button",{onClick:w[0]||(w[0]=I=>t.value=!t.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),t.value?(k(),O("div",uj,w[2]||(w[2]=[h("p",{class:"text-blue-200 text-sm"},[ut(" Cette liste montre tous les joueurs ciblés: "),h("span",{class:"text-gray-200"},"ceux notifiables (email/push actifs)"),ut(" et "),h("span",{class:"text-yellow-300"},"ceux en jaune sans canal actif"),ut(". Les joueurs en jaune ne peuvent pas être notifiés automatiquement. Utilise le message ci-dessous pour les contacter manuellement. ")],-1)]))):ie("",!0),h("div",cj,[l.value.length>0?(k(),O("div",dj,[h("div",hj,[h("span",fj,ee(l.value.length-1),1),w[3]||(w[3]=ut(" personnes à prévenir. ")),h("span",pj,ee(s.value.length),1),w[4]||(w[4]=ut(" seront notifiées, ")),h("span",mj,ee(o.value.length),1),w[5]||(w[5]=ut(" devront être prévenues manuellement. "))]),h("div",gj,[(k(!0),O(bt,null,Lr(l.value.filter(I=>I.id!=="ALL"),I=>(k(),O("span",{key:I.id||I.name,class:dn(["px-3 py-1 rounded text-sm border flex items-center gap-1",I.hasContact?"bg-gray-700 border-gray-600 text-white":"bg-yellow-900/20 border-yellow-600/40 text-yellow-200 opacity-75"]),title:I.hasContact?"Peut être notifié automatiquement":"Aucun canal actif - notification manuelle requise"},[ut(ee(I.name)+" ",1),I.hasContact?(k(),O("span",yj,"✓")):(k(),O("span",_j,"⚠️"))],10,vj))),128))])])):(k(),O("div",bj," ⚠️ Aucun destinataire disponible. "))])]),h("div",null,[w[6]||(w[6]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Message à copier pour les contacts manuels :",-1)),h("div",wj,[r.value?(k(),O("div",xj," ✅ Copié ! ")):ie("",!0),h("div",{class:"w-full p-3 bg-gray-800 border border-gray-700 rounded-md text-white text-sm cursor-pointer hover:bg-gray-700 transition-colors",onClick:f,title:"Cliquer pour copier le texte"},[h("pre",Ij,ee(d.value),1)])])])]))}},Tj=$f(Ej,[["__scopeId","data-v-88cc77b7"]]);const Aj={class:"relative p-5 pb-4 border-b border-white/10"},Sj={class:"text-xl md:text-2xl font-bold text-white pr-10 flex items-center gap-2"},Pj={class:"hidden sm:inline"},Rj={key:0,class:"text-sm text-purple-300 mt-1"},Cj={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},kj={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},Dj={class:"flex items-center gap-2 w-full"},Nj=["disabled"],Oj={key:0},Vj={key:1,class:"inline-flex items-center gap-2"},Mj={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]},sending:{type:Boolean,default:!1},availabilityByPlayer:{type:Object,default:()=>({})}},emits:["close","notifications-sent","send-notifications"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=He(()=>t.sending||s.value);function o(){r("close")}function a(c){var f;return c?(typeof c=="string"?new Date(c):((f=c.toDate)==null?void 0:f.call(c))||c).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}async function l(){if(t.event){s.value=!0;try{r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:t.mode==="selection"?"selection":"event",selectedPlayers:t.selectedPlayers,scope:"all"})}catch(c){console.error("Erreur lors de l'envoi des notifications:",c),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer."),s.value=!1}}}return Ct(()=>t.sending,c=>{c||(s.value=!1)}),(c,d)=>n.show?(k(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:o},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:d[0]||(d[0]=ft(()=>{},["stop"]))},[h("div",Aj,[h("button",{onClick:o,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),h("h2",Sj,[h("span",Pj,ee(n.mode==="selection"?"📣":"📢"),1),h("span",null,ee(n.mode==="selection"?"Confirmer la sélection":"Confirmer l'événement"),1)]),n.event?(k(),O("p",Rj,ee(n.event.title)+" — "+ee(a(n.event.date)),1)):ie("",!0)]),h("div",Cj,[je(Tj,{mode:n.mode,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,"selected-players":n.selectedPlayers,"availability-by-player":n.availabilityByPlayer},null,8,["mode","event","season-id","season-slug","players","selected-players","availability-by-player"])]),h("div",kj,[h("div",Dj,[h("button",{onClick:l,disabled:i.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[i.value?(k(),O("span",Vj,d[2]||(d[2]=[h("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[h("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),h("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),ut(" Envoi en cours... ")]))):(k(),O("span",Oj,d[1]||(d[1]=[h("span",{class:"hidden sm:inline"},"🔔 Confirmer et notifier",-1),h("span",{class:"sm:hidden"},"🔔 Confirmer",-1)])))],8,Nj)]),h("button",{onClick:o,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):ie("",!0)}},I1=$f(Mj,[["__scopeId","data-v-4b6a7b48"]]),Lj={class:"relative p-6 pb-4 border-b border-white/10"},$j={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},Fj={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(k(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=ft(()=>{},["stop"]))},[h("div",Lj,[h("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=h("div",{class:"flex items-center gap-3"},[h("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"❓"),h("div",null,[h("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Kezako ?"),h("p",{class:"text-sm text-purple-300"},"L'appli pour organiser vos spectacles d'improvisation de manière simple et apaisée")])],-1))]),s[5]||(s[5]=lr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">C&#39;est quoi ?</h3><p> HatCast est une appli conçue pour faciliter <span class="text-white">la sélection des joueurs d&#39;impro</span> pour les spectacles. L&#39;idée est née au sein de <span class="text-purple-300">La Malice</span> pour <span class="text-white">dépersonnaliser une tâche délicate</span> qui créait des tensions depuis des années. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">Comment ça marche</h3><p> L&#39;asso déclare ses dates et le nombre de personnes nécessaires. Les joueurs indiquent leurs disponibilités. L&#39;appli propose des sélections. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Sélection auto ou manuelle</h3><p> Le <span class="text-white">mode sélection auto</span> s&#39;appuie sur le hasard (pondéré) pour simplifier la vie. Vous pouvez aussi repasser en mode <span class="text-white">manuel</span> si besoin. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Pensée mobile • Libre d&#39;utilisation</h3><p> L&#39;appli est <span class="text-white">pensée pour le mobile</span> et peut être utilisée librement par La Malice ou <span class="text-white">toute autre troupe</span>. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Comptes (facultatif)</h3><p> Les joueurs qui le souhaitent peuvent créer un compte via leur email pour <span class="text-white">recevoir des notifications</span>, <span class="text-white">protéger leurs saisies</span> et bénéficier d&#39;un meilleur confort d&#39;utilisation. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2 text-sm"><h3 class="text-white font-semibold">Statut &amp; licence</h3><p> Application <span class="text-white">en cours de développement</span>, <span class="text-white">sans garanties</span> à ce stade. Licence libre <span class="text-white">MIT</span>. </p><p>Contact &amp; retours : <a href="mailto:impropick@gmail.com" class="text-blue-300 underline">impropick@gmail.com</a></p></div></div>',1)),h("div",$j,[h("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ie("",!0)}},Uj={class:"text-center mb-6"},jj={class:"text-lg text-gray-300"},Bj={class:"mb-6"},qj={class:"space-y-4"},zj={class:"flex items-center gap-2 text-gray-300 text-sm"},Hj=["disabled"],Kj={key:0,class:"animate-spin"},Gj={key:1},Wj={class:"mb-6 text-center"},Qj={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Jj={class:"text-red-300 text-sm"},Yj={class:"text-center mb-6"},Xj={class:"text-lg text-gray-300"},Zj={class:"mb-6"},eB=["disabled"],tB={key:0,class:"animate-spin"},nB={key:1},rB={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},sB={class:"text-red-300 text-sm"},iB={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},oB={class:"text-green-300 text-sm"},aB={class:"flex justify-center"},oy={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(!1),o=S(""),a=S(!1),l=S(""),c=S(""),d=S(null),f=S(!0);async function g(){if(s.value){i.value=!0,o.value="";try{const w=await Lm(t.seasonId);if(s.value===w){if(f.value)try{mo.saveSession(t.player.id)}catch{}r("verified",{type:"season_pin"}),x();return}if(await u1(t.player.id,s.value,t.seasonId)){if(f.value)try{mo.saveSession(t.player.id)}catch{}r("verified",{type:"player_password"}),x()}else o.value="Mot de passe incorrect. Veuillez réessayer."}catch(w){N.error("Erreur lors de la vérification",w),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function v(){i.value=!0,l.value="",c.value="";try{const w=await d1(t.player.id,t.seasonId);c.value=w.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(w){N.error("Erreur lors de l'envoi de l'email",w),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function x(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return Ct(()=>t.show,w=>{w&&jt(()=>{d.value&&d.value.focus()})}),(w,I)=>{var L,$;return k(),O(bt,null,[n.show?(k(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:x},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:I[3]||(I[3]=ft(()=>{},["stop"]))},[h("div",Uj,[I[7]||(I[7]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔐")],-1)),I[8]||(I[8]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),h("p",jj,ee((L=n.player)==null?void 0:L.name),1),I[9]||(I[9]=h("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),h("div",Bj,[h("div",qj,[h("div",null,[I[10]||(I[10]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),it(h("input",{"onUpdate:modelValue":I[0]||(I[0]=U=>s.value=U),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:or(g,["enter"]),ref_key:"passwordInput",ref:d},null,544),[[$t,s.value]])]),h("div",zj,[it(h("input",{id:"staySignedIn",type:"checkbox","onUpdate:modelValue":I[1]||(I[1]=U=>f.value=U),class:"w-4 h-4"},null,512),[[Yi,f.value]]),I[11]||(I[11]=h("label",{for:"staySignedIn"},"Rester connecté sur cet appareil",-1))])]),h("button",{onClick:g,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(k(),O("span",Kj,"⏳")):(k(),O("span",Gj,"🔓")),h("span",null,ee(i.value?"Vérification...":"Vérifier"),1)],8,Hj)]),h("div",Wj,[h("button",{onClick:I[2]||(I[2]=U=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(k(),O("div",Qj,[h("div",Jj,ee(o.value),1)])):ie("",!0),h("div",{class:"flex justify-center"},[h("button",{onClick:x,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ie("",!0),a.value?(k(),O("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:I[6]||(I[6]=U=>a.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:I[5]||(I[5]=ft(()=>{},["stop"]))},[h("div",Yj,[I[12]||(I[12]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"📧")],-1)),I[13]||(I[13]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),h("p",Xj,ee(($=n.player)==null?void 0:$.name),1)]),h("div",Zj,[I[14]||(I[14]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:v,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(k(),O("span",tB,"⏳")):(k(),O("span",nB,"📧")),h("span",null,ee(i.value?"Envoi...":"Envoyer l'email"),1)],8,eB)]),l.value?(k(),O("div",rB,[h("div",sB,ee(l.value),1)])):ie("",!0),c.value?(k(),O("div",iB,[h("div",oB,ee(c.value),1)])):ie("",!0),h("div",aB,[h("button",{onClick:I[4]||(I[4]=U=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ie("",!0)],64)}}},lB={class:"text-center mb-6"},uB={class:"text-sm text-gray-300"},cB={key:0,class:"space-y-4"},dB={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},hB={key:1,class:"space-y-4"},fB=["disabled"],pB={key:0,class:"animate-spin"},mB={key:1},gB={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},vB={class:"mt-6 flex justify-center gap-3"},yB=["disabled"],_B={key:0,class:"animate-spin"},bB={key:1},E1={__name:"AccountClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=S(1),i=S(""),o=S(""),a=S(""),l=S(!1),c=S(""),d=S(!1),f=vo(),g=He(()=>i.value&&i.value.includes("@")),v=He(()=>o.value&&a.value&&o.value===a.value&&o.value.length>=6);async function x(){var $,U,z;if(!(!g.value||!(($=t.player)!=null&&$.id))){l.value=!0,c.value="";try{const le=await s1({playerId:t.player.id,email:i.value.trim(),seasonId:t.seasonId}),Z=(U=f.params)==null?void 0:U.slug,A=`${le.url}${Z?`&slug=${encodeURIComponent(Z)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await WF({toEmail:i.value,playerName:((z=t.player)==null?void 0:z.name)||"joueur",verifyUrl:A}),d.value=!0}catch{c.value="Impossible d'envoyer l'email de vérification"}finally{l.value=!1}}}async function w(){try{await o1({playerId:t.player.id,seasonId:t.seasonId})}catch{}s.value=1,d.value=!1,i.value="",o.value="",a.value=""}async function I(){var $;try{const U=await eu(($=t.player)==null?void 0:$.id,t.seasonId);U!=null&&U.email&&(U!=null&&U.emailVerifiedAt)?s.value=2:s.value=1}catch{s.value=1}}An(()=>{I()}),Ct(()=>t.show,$=>{$&&I()});async function L(){if(v.value){l.value=!0,c.value="";try{await r1(t.player.id,i.value.trim(),o.value,t.seasonId),r("success")}catch($){c.value=($==null?void 0:$.message)||"Erreur lors de l'association"}finally{l.value=!1}}}return($,U)=>{var z;return n.show?(k(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:U[6]||(U[6]=le=>$.$emit("close"))},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:U[5]||(U[5]=ft(()=>{},["stop"]))},[h("button",{onClick:U[0]||(U[0]=le=>$.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),h("div",lB,[U[7]||(U[7]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"👤")],-1)),U[8]||(U[8]=h("h2",{class:"text-2xl font-bold text-white mb-1"},"Associer un compte",-1)),h("p",uB,"Pour sécuriser les saisies de "+ee((z=n.player)==null?void 0:z.name),1),je(ty)]),s.value===1?(k(),O("div",cB,[h("div",null,[U[9]||(U[9]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),it(h("input",{"onUpdate:modelValue":U[1]||(U[1]=le=>i.value=le),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[$t,i.value]])]),d.value?(k(),O("div",dB,[U[10]||(U[10]=h("span",null,"✅",-1)),h("span",null,"Un email a été envoyé à "+ee(i.value)+". Cliquez sur le lien contenu dans l'email pour continuer.",1)])):ie("",!0)])):s.value===2?(k(),O("div",hB,[h("div",{class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},[U[11]||(U[11]=h("span",null,"✅",-1)),U[12]||(U[12]=h("span",null,"Adresse email vérifiée",-1)),h("button",{type:"button",onClick:w,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")]),h("div",null,[U[13]||(U[13]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),it(h("input",{"onUpdate:modelValue":U[2]||(U[2]=le=>o.value=le),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[$t,o.value]])]),h("div",null,[U[14]||(U[14]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),it(h("input",{"onUpdate:modelValue":U[3]||(U[3]=le=>a.value=le),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[$t,a.value]])]),h("button",{onClick:L,disabled:!v.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(k(),O("span",pB,"⏳")):(k(),O("span",mB,"🔒")),h("span",null,ee(l.value?"Association...":"Associer ce joueur"),1)],8,fB)])):ie("",!0),c.value?(k(),O("div",gB,ee(c.value),1)):ie("",!0),h("div",vB,[s.value===1?(k(),O("button",{key:0,onClick:x,disabled:!g.value||l.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(k(),O("span",_B,"⏳")):(k(),O("span",bB,"✉️")),h("span",null,ee(l.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,yB)):ie("",!0),h("button",{onClick:U[4]||(U[4]=le=>$.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])):ie("",!0)}}},wB={class:"text-center mb-6"},xB={class:"text-2xl font-bold text-white mb-2"},IB={class:"text-lg text-gray-300"},EB={class:"mb-6"},TB={class:"flex items-center space-x-3"},AB={class:"text-2xl"},SB={class:"font-semibold text-white"},PB={class:"text-sm text-gray-300"},RB={key:0,class:"mb-6"},CB={key:1,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},kB={class:"text-red-300 text-sm"},DB={key:2,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},NB={class:"text-green-300 text-sm"},OB={class:"flex justify-center gap-3"},VB=["disabled"],MB={__name:"PlayerClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=S(!1),o=S(!1),a=S(""),l=S(""),c=S(!1);vo();const d=S(!1);He(()=>!1),He(()=>!1);function f(){l.value="Compte créé et joueur associé !",s.value=!0,c.value=!1,r("update")}async function g(){var L;if((L=t.player)!=null&&L.id){s.value=await no(t.player.id,t.seasonId);try{const{isPlayerPasswordCached:$}=await mt(()=>Promise.resolve().then(()=>td),void 0);i.value=$(t.player.id)}catch{i.value=!1}}}function v(){var L;a.value="";try{if((L=t.player)!=null&&L.id&&oa(t.player.id)){x();return}}catch{}d.value=!0}async function x(){o.value=!0,a.value="",l.value="";try{const L=await a1(t.player.id,t.seasonId);l.value="Joueur déverrouillé!",s.value=!1,L.email&&(email.value=L.email),r("update")}catch(L){logger.error("Erreur lors de la désactivation de la protection",L),a.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{o.value=!1}}function w(){d.value=!1,x()}function I(){r("close")}return Ct(()=>t.player,()=>{t.show&&t.player&&g()},{immediate:!0}),Ct(()=>t.show,L=>{L&&t.player&&(a.value="",l.value="",d.value=!1,g(),t.onboarding&&jt(()=>{}))}),(L,$)=>{var U;return k(),O(bt,null,[n.show?(k(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:I},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:$[1]||($[1]=ft(()=>{},["stop"]))},[h("button",{onClick:I,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),h("div",wB,[$[4]||($[4]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔒")],-1)),h("h2",xB,ee(s.value?"Déverrouiller ce joueur":"Verrouiller ce joueur"),1),h("p",IB,ee((U=n.player)==null?void 0:U.name),1)]),h("div",EB,[h("div",{class:dn(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[h("div",TB,[h("span",AB,ee(s.value?"🔒":"🔓"),1),h("div",null,[h("div",SB,ee(s.value?i.value?"Joueur associé à votre compte":"Ce joueur est associé à un compte utilisateur":"Joueur sans compte"),1),h("div",PB,ee(s.value?i.value?"Seul vous pouvez modifier":"Seul le titulaire peut modifier les disponibilités":"Tout le monde peut modifier les disponibilités"),1)])])],2)]),s.value?ie("",!0):(k(),O("div",RB,$[5]||($[5]=[h("div",{class:"text-sm text-gray-300"},"Vous pouvez protéger vos saisies de disponibilités avec un compte utilisateur.",-1)]))),a.value?(k(),O("div",CB,[h("div",kB,ee(a.value),1)])):ie("",!0),l.value?(k(),O("div",DB,[h("div",NB,ee(l.value),1)])):ie("",!0),h("div",OB,[s.value?(k(),O("button",{key:1,onClick:v,disabled:o.value,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," 🔓 Dissocier ",8,VB)):(k(),O("button",{key:0,onClick:$[0]||($[0]=z=>c.value=!0),class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300"}," Associer un compte ")),h("button",{onClick:I,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ie("",!0),je(E1,{show:c.value,player:n.player,"season-id":n.seasonId,onClose:$[2]||($[2]=z=>c.value=!1),onSuccess:f},null,8,["show","player","season-id"]),je(oy,{show:d.value,player:n.player,seasonId:n.seasonId,onClose:$[3]||($[3]=z=>d.value=!1),onVerified:w},null,8,["show","player","seasonId"])],64)}}};const LB={class:"relative p-4 md:p-6 border-b border-white/10"},$B={class:"flex items-start gap-4 md:gap-6"},FB={class:"flex-1 min-w-0"},UB={class:"flex items-center gap-3 mb-2"},jB={class:"text-xl md:text-2xl font-bold text-white leading-tight"},BB={class:"flex items-center gap-2"},qB={key:0,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-full"},zB={key:1,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-full"},HB={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},KB={class:"grid grid-cols-3 gap-3 md:gap-4"},GB={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},WB={class:"text-xl md:text-2xl font-bold text-white"},QB={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},JB={class:"text-xl md:text-2xl font-bold text-white"},YB={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30 text-center"},XB={class:"text-xl md:text-2xl font-bold text-white"},ZB={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},eq={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},tq={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},nq={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},rq={class:"mb-6"},sq={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null},isProtected:{type:Boolean,default:!1},isPreferred:{type:Boolean,default:!1}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=S(!1),o=S(""),a=S(null),l=S(!1),c=S(!1),d=S(null);S(!1);const f=S(!1),g=S(!1),v=S(null),x=S(null),w=S({position:"fixed",top:"0px",left:"0px"}),I=S(null),L=S({position:"fixed",top:"0px",left:"0px"}),$=S(!1),U=S(!1);function z(){s("close"),f.value=!1,g.value=!1,w.value={position:"fixed",top:"0px",left:"0px"},L.value={position:"fixed",top:"0px",left:"0px"}}function le(){var Se;o.value=((Se=r.player)==null?void 0:Se.name)||"",i.value=!0,jt(()=>{a.value&&a.value.focus()})}function Z(){i.value=!1,o.value=""}async function A(){var me,Be;if(!o.value.trim())return;if(await no((me=r.player)==null?void 0:me.id,r.seasonId)){oa((Be=r.player)==null?void 0:Be.id)?b():(d.value="update",c.value=!0);return}b()}function b(){var Se;s("update",{playerId:(Se=r.player)==null?void 0:Se.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function E(){var me,Be;if(await no((me=r.player)==null?void 0:me.id,r.seasonId)){oa((Be=r.player)==null?void 0:Be.id)?D():(d.value="delete",c.value=!0);return}D()}function D(){var Se;s("delete",(Se=r.player)==null?void 0:Se.id)}function F(){s("refresh")}function V(Se){d.value==="update"?b():d.value==="delete"&&D(),d.value=null}function C(){try{const Se=v.value;if(!Se)return;const me=Se.getBoundingClientRect(),Be=8;if(window.innerWidth>768){const ae=Math.max(Be,Math.round(me.top-Be)),re=Math.max(Be,Math.round(me.left));w.value={position:"fixed",top:`${ae}px`,left:`${re}px`,zIndex:400}}else{const ae=Math.min(window.innerHeight-Be,Math.round(me.bottom+Be)),re=Math.max(Be,Math.round(me.left));w.value={position:"fixed",top:`${ae}px`,left:`${re}px`,zIndex:400}}}catch{}}function Fe(){try{const ae=Math.max(8,window.innerHeight-8-48-120),re=Math.max(8,Math.round(window.innerWidth-200-8));L.value={position:"fixed",top:`${ae}px`,left:`${re}px`,zIndex:400}}catch{}}function vt(){f.value=!f.value,f.value&&jt(()=>C())}function It(){g.value=!g.value,g.value&&jt(()=>Fe())}Ct(()=>r.show,Se=>{var me;Se||(i.value=!1,o.value="",d.value=null,l.value=!1,f.value=!1,g.value=!1),Se&&((me=r.player)!=null&&me.id)&&(no(r.player.id,r.seasonId).then(Be=>{$.value=!!Be}),mt(()=>Promise.resolve().then(()=>td),void 0).then(Be=>{try{U.value=!!Be.isPlayerPasswordCached(r.player.id)}catch{U.value=!1}}))}),An(()=>{document.addEventListener("click",Se=>{if(f.value){const me=v.value,Be=x.value,ae=me&&me.contains(Se.target),re=Be&&Be.contains(Se.target);!ae&&!re&&(f.value=!1)}if(g.value){const me=I.value;me&&me.contains(Se.target)||(g.value=!1)}}),document.addEventListener("keydown",Se=>{Se.key==="Escape"&&(f.value&&(f.value=!1),g.value&&(g.value=!1))}),window.addEventListener("resize",()=>{f.value&&C(),g.value&&Fe()}),window.addEventListener("scroll",()=>{f.value&&C(),g.value&&Fe()},{passive:!0})}),e({openProtection(){l.value=!0}});const We=S({position:null});return Ct(()=>r.show,Se=>{Se&&r.onboardingStep===4?jt(()=>{const me=document.querySelectorAll("button");let Be=null;if(me.forEach(ae=>{!Be&&ae.textContent&&ae.textContent.includes("Protection")&&(Be=ae)}),Be){const ae=Be.getBoundingClientRect();We.value.position={x:Math.round(ae.right+8),y:Math.round(ae.top+window.scrollY-4)}}}):Se||(We.value.position=null)}),(Se,me)=>{var Be;return k(),O(bt,null,[n.show?(k(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:z},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-xl max-h-[92vh] flex flex-col",onClick:me[6]||(me[6]=ft(()=>{},["stop"]))},[h("div",LB,[h("button",{onClick:z,class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),h("div",$B,[me[15]||(me[15]=h("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex-shrink-0 flex items-center justify-center"},[h("span",{class:"text-xl md:text-2xl"},"👤")],-1)),h("div",FB,[h("div",UB,[h("h2",jB,ee((Be=n.player)==null?void 0:Be.name),1),h("div",BB,[n.isProtected?(k(),O("div",qB,me[13]||(me[13]=[h("span",{class:"text-yellow-400 text-sm"},"🔒",-1),h("span",{class:"text-yellow-300 text-xs font-medium"},"Protégé",-1)]))):ie("",!0),n.isPreferred?(k(),O("div",zB,me[14]||(me[14]=[h("span",{class:"text-purple-400 text-sm"},"⭐",-1),h("span",{class:"text-purple-300 text-xs font-medium"},"Favori",-1)]))):ie("",!0)])])])])]),h("div",HB,[h("div",null,[h("div",KB,[h("div",GB,[h("div",WB,ee(r.stats.availability),1),me[16]||(me[16]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibilités",-1))]),h("div",QB,[h("div",JB,ee(r.stats.selection),1),me[17]||(me[17]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Sélections",-1))]),h("div",YB,[h("div",XB,ee(r.stats.ratio),1),me[18]||(me[18]=h("div",{class:"text-xs md:text-sm text-gray-300"},"% de sélection",-1))])])]),h("div",ZB,[h("button",{onClick:me[0]||(me[0]=ae=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},[h("span",null,ee($.value?"🔓":"🔒"),1),h("span",null,ee($.value?"Déverrouiller":"Verrouiller"),1)]),h("div",{class:"relative",ref_key:"playerMoreActionsRef",ref:v},[h("button",{onClick:me[1]||(me[1]=ae=>vt()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},me[19]||(me[19]=[h("span",null,"⋯",-1),h("span",null,"Plus",-1)]))],512),h("button",{onClick:z,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer "),(k(),ei(Zu,{to:"body"},[f.value?(k(),O("div",{key:0,ref_key:"playerMoreActionsDropdownRef",ref:x,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:Mr(w.value)},[h("button",{onClick:me[2]||(me[2]=ae=>{le(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},me[20]||(me[20]=[h("span",null,"✏️",-1),h("span",null,"Renommer",-1)])),h("button",{onClick:me[3]||(me[3]=ae=>{E(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},me[21]||(me[21]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)]))],4)):ie("",!0)]))])]),h("div",eq,[h("button",{onClick:me[4]||(me[4]=ae=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},ee($.value?"🔓 Déverrouiller":"🔒 Verrouiller"),1),h("button",{onClick:me[5]||(me[5]=ae=>It()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ "),h("button",{onClick:z,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer ")])])])):ie("",!0),(k(),ei(Zu,{to:"body"},[g.value?(k(),O("div",{key:0,ref_key:"playerMoreActionsMobileDropdownRef",ref:I,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:Mr(L.value)},[h("button",{onClick:me[7]||(me[7]=ae=>{le(),g.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},me[22]||(me[22]=[h("span",null,"✏️",-1),h("span",null,"Renommer",-1)])),h("button",{onClick:me[8]||(me[8]=ae=>{E(),g.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},me[23]||(me[23]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)]))],4)):ie("",!0)])),i.value?(k(),O("div",tq,[h("div",nq,[me[25]||(me[25]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Renommer le joueur",-1)),h("div",rq,[me[24]||(me[24]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),it(h("input",{"onUpdate:modelValue":me[9]||(me[9]=ae=>o.value=ae),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[or(Z,["esc"]),or(A,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[$t,o.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:Z,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:A,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ie("",!0),je(MB,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:me[10]||(me[10]=ae=>l.value=!1),onUpdate:F,onOnboardingFinished:me[11]||(me[11]=ae=>Se.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),je(oy,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:me[12]||(me[12]=ae=>c.value=!1),onVerified:V},null,8,["show","player","seasonId"])],64)}}},iq=$f(sq,[["__scopeId","data-v-8237d7ee"]]),oq={class:"relative p-6 pb-4 border-b border-white/10"},aq={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},lq={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(k(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=ft(()=>{},["stop"]))},[h("div",oq,[h("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=h("div",{class:"flex items-center gap-3"},[h("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),h("div",null,[h("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),h("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=lr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),h("div",aq,[h("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ie("",!0)}},uq={class:"relative p-4 md:p-6 border-b border-white/10"},cq={class:"flex items-start gap-4 md:gap-6"},dq={class:"flex-1 min-w-0"},hq={class:"text-xl md:text-2xl font-bold text-white leading-tight mb-2"},fq={class:"flex items-center gap-3"},pq={class:"text-base md:text-lg text-purple-300"},mq={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},gq={class:"text-blue-200"},vq={key:0,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm flex items-center gap-1",title:"Prêt pour la sélection"},yq={key:1,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded text-sm flex items-center gap-1",title:"Sélection complète"},_q={key:2,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded text-sm flex items-center gap-1",title:"Sélection incomplète"},bq={key:3,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded text-sm flex items-center gap-1",title:"Pas assez de joueurs disponibles"},wq={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},xq={class:"grid grid-cols-3 gap-3 md:gap-4 mb-4"},Iq={class:"bg-gradient-to-r from-yellow-500/20 to-orange-500/20 p-3 md:p-4 rounded-lg border border-yellow-500/30 text-center"},Eq={class:"text-xl md:text-2xl font-bold text-yellow-300"},Tq={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},Aq={class:"text-xl md:text-2xl font-bold text-white"},Sq={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},Pq={class:"text-xl md:text-2xl font-bold text-white"},Rq={class:"mb-3"},Cq={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},kq={key:0,class:"flex items-center justify-between gap-2"},Dq=["title"],Nq={key:0,class:"text-purple-400 mr-2"},Oq={key:1,class:"text-green-400 mr-2"},Vq={key:2,class:"text-red-400 mr-2"},Mq={key:3,class:"text-gray-400 mr-2"},Lq=["onClick"],$q={key:1,class:"flex items-center justify-center"},Fq=["onChange"],Uq=["value"],jq=["onClick"],Bq={key:0,class:"mb-3"},qq={key:1,class:"mb-3"},zq={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},Hq={class:"flex-1"},Kq={class:"text-blue-300 text-sm font-medium"},Gq={class:"sticky bottom-0 w-full p-3 bg-gray-900/80 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},Wq=["disabled","title"],Qq=["disabled"],Jq={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-notifications","updateSelection"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=S(!1),o=S("Copier le message"),a=S(!1),l=S(!1),c=S(""),d=S(!1),f=S(!1),g=He(()=>{var ae;return((ae=r.event)==null?void 0:ae.playerCount)||6}),v=S([]),x=S(null),w=He(()=>(r.players||[]).map(ae=>ae.name).filter(ae=>{var re;return((re=r.playerAvailability)==null?void 0:re[ae])===!0}).sort((ae,re)=>ae.localeCompare(re,"fr",{sensitivity:"base"})));function I(ae){const re=new Set(v.value.filter(Boolean)),Oe=v.value[ae];return Oe&&re.delete(Oe),w.value.filter(St=>!re.has(St))}function L(ae){x.value=ae}function $(){x.value=null}async function U(ae,re){var St;const Oe=((St=ae==null?void 0:ae.target)==null?void 0:St.value)||"";Oe&&(v.value[re]=Oe,await F()),x.value=null}async function z(ae){v.value[ae]=null,await F()}He(()=>(I(-1).length<g.value,""));const le=He(()=>r.currentSelection&&r.currentSelection.length>0);function Z(){var St;const ae=r.currentSelection||[],re=((St=r.event)==null?void 0:St.playerCount)||6,Oe=r.availableCount||0;if(ae.length>0){const Ot=ae.some(Q=>!vt(Q)),kt=Oe<re;if(Ot||kt)return{type:"incomplete",hasUnavailablePlayers:Ot,hasInsufficientPlayers:kt,unavailablePlayers:ae.filter(Q=>!vt(Q)),availableCount:Oe,requiredCount:re}}return Oe<re?{type:"insufficient",availableCount:Oe,requiredCount:re}:ae.length===0?{type:"ready",availableCount:Oe,requiredCount:re}:{type:"complete",availableCount:Oe,requiredCount:re}}const A=He(()=>{var St;if(!le.value)return!1;const ae=r.currentSelection.some(Ot=>!vt(Ot)),re=((St=r.event)==null?void 0:St.playerCount)||6,Oe=r.availableCount<re;return ae||Oe});He(()=>{var Oe;if(!A.value)return"";const ae=r.currentSelection.filter(St=>!vt(St)),re=((Oe=r.event)==null?void 0:Oe.playerCount)||6;return ae.length>0?ae.length===1?`${ae[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${ae.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<re?`Seulement ${r.availableCount} joueurs disponibles pour ${re} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),He(()=>{if(!r.event||!le.value)return"";const ae=b(r.event.date),re=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${ae} : ${re}`}),Ct(()=>r.show,ae=>{if(ae){i.value=!1,o.value="Copier le message",l.value=!1,c.value="",d.value=!1,a.value=!1;const re=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Oe=g.value;v.value=Array.from({length:Oe},(St,Ot)=>re[Ot]||null),x.value=null}}),Ct([g,()=>r.currentSelection,()=>{var ae;return(ae=r.event)==null?void 0:ae.id}],()=>{if(!r.show)return;const ae=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],re=g.value,Oe=Array.from({length:re},(St,Ot)=>ae[Ot]||v.value[Ot]||null);v.value=Oe.slice(0,re)});function b(ae){var Oe;return ae?(typeof ae=="string"?new Date(ae):((Oe=ae.toDate)==null?void 0:Oe.call(ae))||ae).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function E(){s("selection")}function D(){s("perfect")}async function F(){var ae;if(!(!((ae=r.event)!=null&&ae.id)||!r.seasonId))try{const re=v.value.filter(Boolean);await qm(r.event.id,re,r.seasonId),console.debug("Sélection sauvegardée automatiquement")}catch(re){console.error("Erreur lors de la sauvegarde automatique:",re)}}function V(){s("close")}function C(){a.value=!0}function Fe(){f.value=!0}function vt(ae){return r.playerAvailability[ae]===!0}function It(ae){return r.playerAvailability[ae]===!1}function We(ae){return r.currentSelection.includes(ae)&&vt(ae)}function Se(ae=!1,re=!1){if(d.value=ae,ae){const Oe=b(r.event.date),St=r.currentSelection.join(", ");re?c.value=`Sélection mise à jour pour ${r.event.title} du ${Oe} : ${St}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`:c.value=`Nouvelle sélection pour ${r.event.title} du ${Oe} : ${St}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`}else c.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function me(){l.value=!1}e({showSuccess:Se});function Be(ae){s("send-notifications",ae)}return(ae,re)=>{var Oe,St,Ot,kt;return k(),O(bt,null,[n.show?(k(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:V},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:re[1]||(re[1]=ft(()=>{},["stop"]))},[h("div",uq,[h("button",{onClick:V,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),h("div",cq,[re[9]||(re[9]=h("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[h("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),h("div",dq,[h("h2",hq,"Sélection pour "+ee((Oe=n.event)==null?void 0:Oe.title),1),h("div",fq,[h("p",pq,ee(b((St=n.event)==null?void 0:St.date)),1),h("div",mq,[re[4]||(re[4]=h("span",{class:"text-blue-300"},"👥",-1)),h("span",gq,ee(((Ot=n.event)==null?void 0:Ot.playerCount)||6)+" joueurs",1)]),Z().type==="ready"?(k(),O("div",vq,re[5]||(re[5]=[h("span",{class:"text-blue-300 text-xs"},"🆕",-1),h("span",{class:"text-blue-200 text-xs"},"Nouveau",-1)]))):Z().type==="complete"?(k(),O("div",yq,re[6]||(re[6]=[h("span",{class:"text-green-300 text-xs"},"✅",-1),h("span",{class:"text-green-200 text-xs"},"Complet",-1)]))):Z().type==="incomplete"?(k(),O("div",_q,re[7]||(re[7]=[h("span",{class:"text-orange-300 text-xs"},"⚠️",-1),h("span",{class:"text-orange-200 text-xs"},"À finaliser",-1)]))):Z().type==="insufficient"?(k(),O("div",bq,re[8]||(re[8]=[h("span",{class:"text-red-300 text-xs"},"❌",-1),h("span",{class:"text-red-200 text-xs"},"Manque",-1)]))):ie("",!0)])])])]),h("div",wq,[h("div",xq,[h("div",Iq,[h("div",Eq,ee(Math.max((((kt=n.event)==null?void 0:kt.playerCount)||6)-n.selectedCount,0)),1),re[10]||(re[10]=h("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))]),h("div",Tq,[h("div",Aq,ee(n.availableCount),1),re[11]||(re[11]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),h("div",Sq,[h("div",Pq,ee(n.selectedCount),1),re[12]||(re[12]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))])]),h("div",Rq,[h("div",{class:"flex items-center gap-2 mb-2"},[re[14]||(re[14]=h("h3",{class:"text-base md:text-lg font-semibold text-white"},"Joueurs sélectionnés",-1)),h("button",{onClick:Fe,class:"text-blue-300 hover:text-blue-200 p-1 rounded-full hover:bg-blue-500/10 transition-colors",title:"Comment fonctionne la sélection automatique ?"},re[13]||(re[13]=[h("span",{class:"text-sm"},"❓",-1)]))]),h("div",Cq,[(k(!0),O(bt,null,Lr(v.value,(Q,we)=>(k(),O("div",{key:"sel-slot-"+we,class:dn(["relative p-3 rounded-lg border text-center transition-colors",Q?["bg-gradient-to-r",It(Q)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":vt(Q)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[Q?(k(),O("div",kq,[h("div",{class:"flex-1 text-white font-medium truncate",title:Q},[We(Q)?(k(),O("span",Nq,"🎭")):vt(Q)?(k(),O("span",Oq,"✅")):It(Q)?(k(),O("span",Vq,"❌")):(k(),O("span",Mq,"–")),ut(" "+ee(Q),1)],8,Dq),h("button",{onClick:ye=>z(we),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer ce joueur"}," × ",8,Lq)])):(k(),O("div",$q,[x.value===we?(k(),O("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:ye=>U(ye,we),onBlur:re[0]||(re[0]=ye=>$())},[re[15]||(re[15]=h("option",{value:""},"— Choisir —",-1)),(k(!0),O(bt,null,Lr(I(we),ye=>(k(),O("option",{key:ye,value:ye},ee(ye),9,Uq))),128))],40,Fq)):(k(),O("button",{key:1,onClick:ye=>L(we),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter un joueur"},re[16]||(re[16]=[h("span",{class:"text-lg"},"＋",-1),h("span",{class:"text-sm"},"Ajouter",-1)]),8,jq))]))],2))),128))])]),le.value?(k(),O("div",Bq,re[17]||(re[17]=[h("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[h("div",{class:"text-yellow-400"},"⚠️"),h("div",{class:"text-yellow-200 text-sm"},"Pensez à prévenir les gens de vos changements !")],-1)]))):ie("",!0),l.value?(k(),O("div",qq,[h("div",zq,[re[19]||(re[19]=h("div",{class:"text-blue-400 text-xl"},"✨",-1)),h("div",Hq,[h("p",Kq,ee(c.value),1)]),h("button",{onClick:me,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},re[18]||(re[18]=[h("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):ie("",!0)]),h("div",Gq,[h("button",{onClick:E,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":le.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},re[20]||(re[20]=[ut(" ✨ "),h("span",{class:"hidden sm:inline"},"Sélection Auto",-1),h("span",{class:"sm:hidden"},"Auto",-1)]),8,Wq),h("button",{onClick:C,disabled:!le.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},re[21]||(re[21]=[ut(" 📣 "),h("span",{class:"hidden sm:inline"},"Annoncer",-1),h("span",{class:"sm:hidden"},"Annoncer",-1)]),8,Qq),h("button",{onClick:D,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 whitespace-nowrap"},re[22]||(re[22]=[h("span",{class:"hidden sm:inline"},"Fermer",-1),h("span",{class:"sm:hidden"},"Fermer",-1)]))])])])):ie("",!0),je(I1,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:re[2]||(re[2]=Q=>a.value=!1),onSendNotifications:Be},null,8,["show","event","season-id","season-slug","players","selected-players"]),je(lq,{show:f.value,onClose:re[3]||(re[3]=Q=>f.value=!1)},null,8,["show"])],64)}}},Yq={class:"flex flex-col items-center justify-center"},Xq={key:0,class:"text-center"},Zq={key:1,class:"text-center"},e9={key:2,class:"text-center"},t9={key:3,class:"text-center text-gray-400"},n9=["title"],Wb={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},compact:{type:Boolean,default:!1},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=He(()=>!(t.chancePercent==null||t.isAvailable!==!0)),o=He(()=>t.disabled?"Événement archivé — désarchivez pour modifier":t.isSelected&&t.isAvailable===!0?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){t.disabled||r("toggle",t.playerName,t.eventId)}return(l,c)=>(k(),O("div",{class:dn(["flex items-center justify-center transition-all duration-200 rounded font-medium text-white mx-0.5 my-0.25",[n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer hover:scale-105",n.compact?"min-h-0 p-1 md:p-2 text-xs":"min-h-20 p-2 md:p-3 text-sm",n.isSelected&&n.isAvailable===!0?"bg-gradient-to-br from-purple-500/60 to-pink-500/60":"",!n.isSelected&&n.isAvailable===!0?"bg-green-500/60":"",n.isAvailable===!1?"bg-red-500/60":"",n.isAvailable===null||n.isAvailable===void 0?"bg-gray-500/40":""]]),onClick:a,onMouseenter:c[0]||(c[0]=d=>s.value=!0),onMouseleave:c[1]||(c[1]=d=>s.value=!1)},[h("div",Yq,[n.isSelected&&n.isAvailable===!0?(k(),O("span",Xq," Joue ")):n.isAvailable===!0?(k(),O("span",Zq," Disponible ")):n.isAvailable===!1?(k(),O("span",e9," Pas disponible ")):(k(),O("span",t9," – ")),i.value&&n.isAvailable===!0?(k(),O("span",{key:4,class:"text-[10px] md:text-xs px-1.5 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 mt-1",title:o.value},ee(n.chancePercent)+"% ",9,n9)):ie("",!0)])],34))}},r9={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},s9={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},i9={class:"text-2xl md:text-3xl font-bold text-white mb-3"},o9={class:"text-gray-300 mb-6"},a9={class:"flex flex-col items-stretch justify-center gap-3"},l9=["value"],u9={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=He(()=>`${s}/season/${t.seasonSlug}`),o=S(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=He(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=He(()=>a.value>0),c=S(l.value);Ct(a,I=>{c.value=I>0});const d=He(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=He(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function g(){c.value=!1,r("create-event")}function v(){c.value=!1,r("add-player")}function x(){var I;try{(I=navigator.clipboard)==null||I.writeText(i.value)}catch{}r("copy-link")}async function w(){try{if(t.seasonId){const{db:I}=await mt(()=>Promise.resolve().then(()=>Qr),void 0),{doc:L,updateDoc:$}=await mt(()=>import("./index.esm-e12eeb83.js"),[]);await $(L(I,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(I,L)=>l.value&&c.value?(k(),O("div",r9,[h("div",s9,[L[1]||(L[1]=h("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[h("span",{class:"text-3xl"},"🎬")],-1)),h("h2",i9,ee(d.value),1),h("p",o9,ee(f.value),1),h("div",a9,[a.value===1?(k(),O("button",{key:0,onClick:g,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(k(),O("button",{key:1,onClick:v,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(k(),O(bt,{key:2},[h("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:L[0]||(L[0]=$=>$.target.select())},null,40,l9),h("div",{class:"flex gap-3 justify-center"},[h("button",{onClick:x,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),h("button",{onClick:w,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):ie("",!0)])])])):ie("",!0)}},c9={class:"sticky top-0 z-[60] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},d9={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},h9={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},f9={class:"hidden md:flex items-center gap-2"},p9={class:"md:hidden"},m9={__name:"SeasonHeader",props:{seasonName:{type:String,default:""},isScrolled:{type:Boolean,default:!1}},emits:["go-back","open-account-menu","open-help","open-notifications","open-players","logout","open-login","open-account"],setup(n,{emit:e}){const t=n,r=e,s=S(null),i=He(()=>{var w;return!!s.value&&!((w=s.value)!=null&&w.isAnonymous)}),o=He(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");function a(w){s.value=w}An(()=>{s.value=Le.currentUser;const w=Le.onAuthStateChanged(a);window._seasonHeaderUnsubscribe=w}),Zs(()=>{window._seasonHeaderUnsubscribe&&(window._seasonHeaderUnsubscribe(),delete window._seasonHeaderUnsubscribe)});function l(){r("go-back")}function c(){r("open-account-menu")}function d(){r("open-login")}function f(){r("open-help")}function g(){r("open-notifications")}function v(){r("open-players")}function x(){r("logout")}return(w,I)=>(k(),O("div",c9,[h("button",{onClick:l,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour aux saisons"},I[0]||(I[0]=[h("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),h("h1",d9,ee(n.seasonName?n.seasonName:"Chargement..."),1),h("div",h9,[h("div",f9,[je(Bm,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:c,onOpenHelp:f,onOpenNotifications:g,onOpenPlayers:v,onLogout:x,onOpenLogin:d},null,8,["is-connected","button-class"]),i.value?ie("",!0):(k(),O("button",{key:0,onClick:f,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},I[1]||(I[1]=[h("span",{class:"text-2xl"},"❓",-1)])))]),h("div",p9,[je(Bm,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:c,onOpenHelp:f,onOpenNotifications:g,onOpenPlayers:v,onLogout:x,onOpenLogin:d},null,8,["is-connected","button-class"])])])]))}},g9={key:0,class:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/50"},v9={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-2xl shadow-2xl w-full max-w-md p-6 relative"},y9={class:"text-center mb-6"},_9={class:"text-gray-300 text-sm"},b9={class:"font-medium text-white"},w9={key:0,class:"space-y-4"},x9=["disabled"],I9={key:0,class:"mt-2 text-xs"},E9={key:0,class:"text-green-400"},T9={key:1,class:"text-red-400"},A9={class:"flex gap-3"},S9=["disabled"],P9={key:0,class:"animate-spin"},R9={key:1},C9={key:1,class:"text-center"},k9={class:"text-green-400 text-sm mb-4"},D9={class:"font-medium text-white"},N9={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg"},O9={class:"text-red-300 text-sm"},V9={__name:"NotificationPromptModal",props:{show:{type:Boolean,default:!1},playerName:{type:String,required:!0},eventTitle:{type:String,required:!0},seasonId:{type:String,required:!0},seasonSlug:{type:String,required:!0},eventId:{type:String,required:!0}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(!1),o=S(""),a=S(!1),l=He(()=>{const d=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,f=s.value,g=d.test(f),v=i.value;return f&&g&&!v});async function c(){var d;if(l.value){i.value=!0,o.value="";try{console.log("🚀 Début de l'activation des notifications...");const{auth:f}=await mt(()=>Promise.resolve().then(()=>Qr),void 0),g=((d=f.currentUser)==null?void 0:d.email)===s.value;if(g){console.log("✅ Utilisateur déjà connecté, activation directe...");const{activateNotificationsForConnectedUser:v}=await mt(()=>Promise.resolve().then(()=>x1),void 0),x=await v({seasonId:t.seasonId,eventId:t.eventId,playerName:t.playerName,email:s.value,eventTitle:t.eventTitle,seasonSlug:t.seasonSlug});console.log("✅ Notifications activées directement:",x),a.value=!0,r("success",{email:s.value,playerName:t.playerName,directActivation:!0})}else{console.log("📧 Utilisateur non connecté, envoi de l'email d'activation...");const v=await y1({seasonId:t.seasonId,eventId:t.eventId,playerName:t.playerName,email:s.value,eventTitle:t.eventTitle,seasonSlug:t.seasonSlug});console.log("✅ Résultat de la création:",v),a.value=!0,r("success",{email:s.value,playerName:t.playerName,directActivation:!1})}N.info("Activation des notifications terminée",{email:s.value,playerName:t.playerName,eventId:t.eventId,directActivation:g})}catch(f){console.error("❌ Erreur lors de l'activation:",f),N.error("Erreur lors de l'activation des notifications",f),o.value="Impossible d'activer les notifications. Veuillez réessayer."}finally{i.value=!1}}}return(d,f)=>n.show?(k(),O("div",g9,[h("div",v9,[h("button",{onClick:f[0]||(f[0]=g=>d.$emit("close")),class:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors p-1 rounded-full hover:bg-white/10",title:"Fermer"},f[3]||(f[3]=[h("span",{class:"text-xl"},"✖️",-1)])),h("div",y9,[f[5]||(f[5]=h("div",{class:"w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center bg-gradient-to-r from-purple-500 to-pink-600"},[h("span",{class:"text-2xl"},"🔔")],-1)),f[6]||(f[6]=h("h2",{class:"text-xl font-bold text-white mb-2"},"Ne rates rien !",-1)),h("p",_9,[h("span",b9,ee(n.playerName),1),f[4]||(f[4]=ut(", active tes notifications pour recevoir des alertes en temps réel sur tes événements. "))])]),a.value?(k(),O("div",C9,[h("p",k9,[f[8]||(f[8]=ut(" Email envoyé à ")),h("span",D9,ee(s.value),1)]),f[9]||(f[9]=h("p",{class:"text-gray-300 text-xs"}," Clique sur le lien qu'il contient pour activer tes notifications ",-1))])):(k(),O("div",w9,[h("div",null,[f[7]||(f[7]=h("label",{for:"email",class:"block text-sm font-medium text-gray-300 mb-2"}," Ton adresse email ",-1)),it(h("input",{id:"email","onUpdate:modelValue":f[1]||(f[1]=g=>s.value=g),type:"email",placeholder:"votre@email.com",class:dn(["w-full px-4 py-3 bg-gray-800 border rounded-lg text-white placeholder-gray-400 focus:outline-none transition-colors",[s.value&&!l.value?"border-red-500 focus:border-red-500":s.value&&l.value?"border-green-500 focus:border-green-500":"border-white/20 focus:border-purple-500"]]),disabled:i.value},null,10,x9),[[$t,s.value]]),s.value&&!i.value?(k(),O("div",I9,[l.value?(k(),O("span",E9,"✅ Email valide")):(k(),O("span",T9,"❌ Format d'email invalide"))])):ie("",!0)]),h("div",A9,[h("button",{onClick:c,disabled:!l.value||i.value,class:dn(["flex-1 px-6 py-3 rounded-lg transition-all duration-300 font-medium",[l.value&&!i.value?"bg-gradient-to-r from-purple-500 to-pink-600 text-white hover:from-purple-600 hover:to-pink-700":"bg-gray-600 text-gray-300 cursor-not-allowed"]])},[i.value?(k(),O("span",P9,"⏳")):(k(),O("span",R9,"Activer les notifications"))],10,S9),h("button",{onClick:f[2]||(f[2]=g=>d.$emit("close")),class:"flex-1 px-6 py-3 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition-all duration-300 font-medium"}," Pas Maintenant ")])])),o.value?(k(),O("div",N9,[h("div",O9,ee(o.value),1)])):ie("",!0)])])):ie("",!0)}},M9={key:0,class:"fixed inset-0 z-[300] flex items-center justify-center p-4 bg-black/60"},L9={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center relative"},$9={class:"text-gray-300 mb-6"},F9={class:"font-semibold text-white"},U9={class:"bg-blue-500/20 border border-blue-500/30 rounded-lg p-4 mb-6"},j9={class:"flex items-start gap-3"},B9={class:"text-left flex-1"},q9={key:0,class:"mb-6 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},z9={class:"flex items-start gap-3"},H9={class:"text-left"},K9={class:"text-green-200 text-sm"},G9={class:"font-mono"},W9={class:"flex gap-3"},Q9=["disabled"],J9={key:0,class:"animate-spin"},Y9={key:1},X9={__name:"NotificationSuccessModal",props:{show:{type:Boolean,default:!1},playerName:{type:String,required:!0},email:{type:String,required:!0},seasonSlug:{type:String,required:!0},eventId:{type:String,default:null}},emits:["close","createPassword"],setup(n,{emit:e}){const t=n;ba();const r=S(!1),s=S(!1);async function i(){s.value=!0;try{const{createUserWithEmailAndPassword:o,sendPasswordResetEmail:a}=await mt(()=>import("./index.esm-e8328fa5.js"),[]),{auth:l}=await mt(()=>Promise.resolve().then(()=>Qr),void 0);console.log("🚀 Tentative de création de compte pour:",t.email);const c={lastVisitedPage:window.location.pathname+window.location.search,timestamp:Date.now(),email:t.email};localStorage.setItem("pendingPasswordResetNavigation",JSON.stringify(c)),console.log("💾 Navigation sauvegardée pour redirection après reset:",c);const d="TempPass123!",f=await o(l,t.email,d);console.log("✅ Compte créé avec succès, UID:",f.user.uid),console.log("📧 Envoi de l'email de réinitialisation..."),await a(l,t.email),console.log("✅ Email de réinitialisation envoyé avec succès à",t.email),await l.signOut(),r.value=!0}catch(o){if(console.error("❌ Erreur lors de la création du compte:",o),o.code==="auth/email-already-in-use")try{console.log("📧 Utilisateur existant, envoi direct de l'email de réinitialisation...");const{sendPasswordResetEmail:a}=await mt(()=>import("./index.esm-e8328fa5.js"),[]),l={lastVisitedPage:window.location.pathname+window.location.search,timestamp:Date.now(),email:t.email};localStorage.setItem("pendingPasswordResetNavigation",JSON.stringify(l)),console.log("💾 Navigation sauvegardée pour utilisateur existant:",l),await a(auth,t.email),console.log("✅ Email de réinitialisation envoyé avec succès à",t.email),r.value=!0}catch(a){console.error("❌ Erreur lors de l'envoi de l'email de réinitialisation:",a)}else o.code==="auth/weak-password"?console.error("❌ Mot de passe temporaire trop faible"):o.code==="auth/invalid-email"?console.error("❌ Email invalide"):console.error("❌ Erreur inconnue:",o.message)}finally{s.value=!1}}return(o,a)=>n.show?(k(),O("div",M9,[h("div",L9,[h("button",{onClick:a[0]||(a[0]=l=>o.$emit("close")),class:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors duration-200 text-xl font-bold",title:"Fermer"}," ✖️ "),a[9]||(a[9]=h("div",{class:"w-20 h-20 rounded-full mx-auto mb-6 flex items-center justify-center bg-green-500"},[h("span",{class:"text-3xl"},"✅")],-1)),a[10]||(a[10]=h("h1",{class:"text-2xl font-bold text-white mb-4"},"Notifications activées !",-1)),h("p",$9,[a[2]||(a[2]=ut(" Nous enverrons désormais les alertes spectacle à ")),h("span",F9,ee(n.email),1)]),h("div",U9,[h("div",j9,[a[4]||(a[4]=h("span",{class:"text-blue-400 text-lg"},"💡",-1)),h("div",B9,[a[3]||(a[3]=h("p",{class:"text-blue-300 text-sm font-medium mb-3"}," Psst... tant que tu y es : ajoute un mot de passe pour sécuriser ton compte ! ",-1)),je(ty,{inline:!0})])])]),r.value?(k(),O("div",q9,[h("div",z9,[a[8]||(a[8]=h("span",{class:"text-green-400 text-lg"},"✅",-1)),h("div",H9,[a[7]||(a[7]=h("p",{class:"text-green-300 text-sm font-medium mb-1"},"Email envoyé !",-1)),h("p",K9,[a[5]||(a[5]=ut(" Vérifie ta boîte mail à ")),h("span",G9,ee(n.email),1),a[6]||(a[6]=ut(" et clique sur le lien pour créer ton mot de passe. "))])])])])):ie("",!0),h("div",W9,[h("button",{onClick:i,class:dn(["flex-1 px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 font-medium",{"opacity-50 cursor-not-allowed":r.value||s.value}]),disabled:r.value||s.value},[s.value?(k(),O("span",J9,"⏳")):(k(),O("span",Y9,"🔐 Créer mon mot de passe"))],10,Q9),h("button",{onClick:a[1]||(a[1]=l=>o.$emit("close")),class:"flex-1 px-6 py-3 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition-all duration-300 font-medium"},ee(r.value?"Fermer":"Plus tard"),1)])])])):ie("",!0)}};const Z9={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},ez={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},tz={class:"flex items-stretch relative"},nz={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},rz={class:"flex-1 overflow-hidden"},sz=["data-event-id"],iz=["title","onClick"],oz={class:"flex flex-col items-center flex-1 justify-center"},az={class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2 group-hover:text-purple-300 transition-colors duration-200"},lz={key:0,class:"mt-1 text-xs text-gray-400"},uz={class:"relative"},cz=["onClick","title"],dz={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},hz={class:"p-2"},fz=["onClick"],pz=["onClick"],mz=["onClick"],gz={class:"flex flex-col items-center mt-2"},vz={key:0,class:"px-2 py-1 bg-gray-500/20 border border-gray-400/30 rounded-md mx-auto flex items-center justify-center",title:"Événement archivé"},yz=["title","onClick"],_z=["title","onClick"],bz=["title","onClick"],wz=["title","onClick"],xz=["title","aria-label"],Iz={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ez={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},Tz={key:0,class:"pointer-events-none"},Az={class:"flex items-center justify-between"},Sz={key:1,class:"pointer-events-none"},Pz={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},Rz={class:"flex items-center justify-between"},Cz={key:2,class:"pointer-events-none"},kz={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},Dz={class:"flex items-center justify-between"},Nz={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},Oz=["data-player-id"],Vz={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},Mz={class:"px-4 md:px-5 font-bold text-xl md:text-2xl flex items-center w-full min-w-0"},Lz={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Mon joueur"},$z={key:1,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},Fz=["onClick","title"],Uz={class:"group-hover:text-purple-300 transition-colors duration-200"},jz=["data-event-id"],Bz={class:"border-t border-white/10"},qz={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},zz={class:"px-4 md:px-5 flex items-center"},Hz=["data-event-id"],Kz={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},Gz={class:"text-center"},Wz={class:"text-white text-lg"},Qz={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},Jz={class:"text-white/60 text-xs mt-2"},Yz={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},Xz={class:"flex items-center space-x-2"},Zz={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},e8={class:"flex items-center space-x-2"},t8={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},n8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},r8={class:"mb-6"},s8={class:"mb-6"},i8={class:"mb-6"},o8={class:"mb-6 flex items-center gap-3"},a8={class:"mb-6"},l8={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},u8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},c8={class:"mb-6"},d8={class:"flex justify-end space-x-3"},h8={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},f8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},p8={class:"flex justify-end space-x-3"},m8={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},g8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},v8={class:"flex justify-end space-x-3"},y8={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},_8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},b8={class:"text-center mb-6"},w8={class:"text-gray-300"},x8={key:0},I8={key:1},E8={class:"relative p-4 md:p-6 border-b border-white/10"},T8={class:"flex items-start gap-4 md:gap-6"},A8={class:"flex-1 min-w-0"},S8={class:"flex items-center gap-3 mb-2"},P8={class:"text-xl md:text-2xl font-bold text-white leading-tight"},R8={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},C8={class:"text-blue-200"},k8={class:"flex items-center gap-3 mb-3"},D8={class:"text-base md:text-lg text-purple-300"},N8={class:"relative"},O8={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},V8={class:"p-2"},M8={key:0,class:"text-sm text-gray-300 bg-gray-800/30 p-3 rounded-lg border border-gray-600/30"},L8={class:"flex items-center gap-2 mt-3"},$8={key:0,class:"flex items-center gap-2 px-3 py-1.5 bg-blue-500/15 border border-blue-400/25 rounded text-sm"},F8={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},U8={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},j8={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},B8={class:"text-xl md:text-2xl font-bold text-white"},q8={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},z8={class:"text-xl md:text-2xl font-bold text-white"},H8={class:"p-3 md:p-4 rounded-lg border border-yellow-500/30 bg-yellow-500/10 text-center"},K8={class:"text-xl md:text-2xl font-bold text-yellow-300"},G8={key:0,class:"mb-4 md:mb-6"},W8={class:"mb-3 flex items-center"},Q8=["title"],J8={class:"truncate"},Y8={class:"space-y-0.5"},X8={class:"flex items-center min-w-0 gap-1.5"},Z8={key:0,class:"text-yellow-400 mr-1 text-xs",title:"Mon joueur"},eH={key:1,class:"text-yellow-400 mr-1 text-xs",title:"Joueur protégé par mot de passe"},tH=["title"],nH={class:"flex-0 p-0"},rH={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},sH=["disabled","title"],iH=["title"],oH={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},aH=["disabled","title"],lH={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},uH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},cH={class:"mb-6"},dH={class:"mb-6"},hH={class:"mb-6"},fH={class:"mb-6 flex items-center gap-3"},pH={class:"mb-6"},mH={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},gH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},vH={class:"mb-6"},yH={class:"space-y-4"},_H=["disabled"],bH={key:0,class:"animate-spin"},wH={key:1},xH={class:"mb-6 text-center"},IH={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},EH={class:"text-red-300 text-sm"},TH={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},AH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},SH={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},PH={class:"space-y-4"},RH={class:"mt-2 text-center"},CH={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},kH={class:"text-red-300 text-sm"},DH={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},NH=["disabled"],OH={key:0,class:"animate-spin"},VH={key:1},MH={class:"mb-6"},LH=["disabled"],$H={key:0,class:"animate-spin"},FH={key:1},UH={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},jH={class:"text-red-300 text-sm"},BH={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},qH={class:"text-green-300 text-sm"},zH={class:"flex justify-center"},HH={class:"mb-6"},KH=["disabled"],GH={key:0,class:"animate-spin"},WH={key:1},QH={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},JH={class:"text-red-300 text-sm"},YH={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},XH={class:"text-green-300 text-sm"},ZH={class:"flex justify-center"},eK={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},tK={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},nK={class:"flex gap-3"},Qb={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=ba(),r=vo(),s=S(null);function i(_){console.log("🔄 GridBoard - onAuthStateChanged:",(_==null?void 0:_.email)||"null"),s.value=_,jt(()=>{a()})}const o=S(!1);async function a(){var _;if(!((_=Y.value)!=null&&_.id)){o.value=!1;return}try{o.value=await z1(Y.value.id)}catch(m){console.error("Erreur lors de la mise à jour de l'état de surveillance:",m),o.value=!1}}const l=e.slug,c=S(""),d=S(""),f=S({}),g=S(!1),v=S(!1),x=S(null),w=S(null),I=S(""),L=S(""),$=S(6),U=S(!1),z=S(""),le=S(null),Z=S(null),A=S(null),b=S({position:null,side:null}),E=S({position:null}),D=S({position:null}),F=S(!1),V=S(null),C=S(!1),Fe=S(null),vt=S(null),It=S(!1),We=S(null),Se=S(""),me=S(!1),Be=S(null),ae=S(""),re=S(""),Oe=S(!1),St=S(null),Ot=S(!1),kt=S(null),Q=S(""),we=S(""),ye=S(!1),ke=S(null),rt=S(!1),yt=S(!1),P=S(""),M=S(""),G=S(!1),ue=S(!1),ne=S(""),de=S(""),Ie=S(!1),Y=S(null),ge=S(""),he=S(!1),Re=S(!1),ve=S(!1),De=S(null),qe=S(null),Ue=S({position:"fixed",top:"0px",left:"0px"}),Ye=S(null),ct=S({position:"fixed",top:"0px",left:"0px"}),en=S(null),Jt=S(!1),wn=S(!1),qt=S(null),mr=S(!1),kr=S(null);function ln(){try{const _=De.value;if(!_)return;const m=_.getBoundingClientRect(),R=8;if(window.innerWidth>768){const H=Math.max(R,Math.round(m.top-R)),X=Math.max(R,Math.round(m.left));Ue.value={position:"fixed",top:`${H}px`,left:`${X}px`,zIndex:400}}else{const H=Math.min(window.innerHeight-R,Math.round(m.bottom+R)),X=Math.max(R,Math.round(m.left));Ue.value={position:"fixed",top:`${H}px`,left:`${X}px`,zIndex:400}}}catch{}}function Nn(){try{const H=Math.max(8,window.innerHeight-8-48-200),X=Math.max(8,Math.round(window.innerWidth-200-8));ct.value={position:"fixed",top:`${H}px`,left:`${X}px`,zIndex:400}}catch{}}function bi(){ve.value=!ve.value,ve.value&&jt(()=>ln())}function oe(){Re.value=!Re.value,Re.value&&jt(()=>Nn())}function B(_){en.value===_?en.value=null:en.value=_}function be(){en.value=null}function ze(){Jt.value=!Jt.value}function Qe(){Jt.value=!1}const at=S(!1),ht=S(null),Et=S(null),$n=S(null),Pt=S(0);function Ir(){var _;try{if(!d.value||!f.value||f.value.onboardingCreatorDone!==!0||Je.value.length===0)return;const m=localStorage.getItem(`playerTourCompleted:${d.value}`);try{const H=((_=Le==null?void 0:Le.currentUser)==null?void 0:_.email)||"";H&&Bf(H).then(async X=>{const ce=X.filter(se=>se.seasonId===d.value);if(ce.length>0){const se=`seasonPreferredPlayer:${d.value}`,Pe=localStorage.getItem(se);let Ge=[];if(Pe)if(Pe.startsWith("["))try{Ge=JSON.parse(Pe)||[]}catch{}else Ge=[Pe];const nt=new Set(Ge);ce.forEach(cn=>nt.add(cn.playerId));const Rt=Array.from(nt);localStorage.setItem(se,JSON.stringify(Rt))}}).catch(()=>{})}catch{}const R=localStorage.getItem(`startPlayerTour:${d.value}`);!m&&R&&(Pt.value=1,localStorage.removeItem(`startPlayerTour:${d.value}`),jt(()=>{const H=document.querySelector('button[data-onboarding="add-player"]');if(H){H.scrollIntoView({behavior:"smooth",block:"end"});const X=H.getBoundingClientRect(),ce=document.getElementById("coachmark-add"),se=280,Pe=100,Ge=(ce==null?void 0:ce.offsetWidth)||se,nt=(ce==null?void 0:ce.offsetHeight)||Pe,Rt=Math.round(X.right+12);if(Rt+Ge<=window.innerWidth-12){const xn=X.top+X.height/2-nt/2,In=-14,Vt=12,Vr=window.innerHeight-nt-12,rs=Math.max(Vt,Math.min(Math.round(xn+In),Vr));b.value={position:{x:Rt,y:rs},side:"right"}}else{const xn=Math.round(X.left+X.width/2-Ge/2),In=Math.round(X.top-nt-8),Vt=8,Vr=window.innerWidth-Ge-8;b.value={position:{x:Math.max(Vt,Math.min(xn,Vr)),y:In},side:null}}}}))}catch{}}const Ze=S(!1),lt=S(null),Gn=S(null),nr=S(!1),On=S(null),wi=S(!1),Ds=S(null),hs=S(!1),Ns=S(!1),tu=S(!1),fs=S(!1),ka=S(!1),Eo=S(!1),To=S(null);function ps(){Ns.value=!0;const _=`/season/${e.slug}`,m=new URLSearchParams(window.location.search);m.delete("open"),m.set("open","account");const R=`${_}?${m.toString()}`;t.push(R)}function Da(){Ns.value=!1;const _=`/season/${e.slug}`,m=new URLSearchParams(window.location.search);m.delete("open");const R=m.toString()?`${_}?${m.toString()}`:_;t.push(R)}function nd(){ka.value=!0}function nu(){ka.value=!1}function ru(){Eo.value=!0}function rd(){Eo.value=!1}function su(){try{const H=Le==null?void 0:Le.currentUser;if(!H||H.isAnonymous){let X=null;if(ns.value&&ns.value.size>0){const ce=ns.value.values().next().value;X=st.value.find(se=>se.id===ce)||null}X||(X=st.value[0]||null),fs.value=!0,X&&(To.value=X);return}}catch{}Ns.value=!0;const _=`/season/${e.slug}`,m=new URLSearchParams(window.location.search);m.delete("open"),m.set("open","account");const R=`${_}?${m.toString()}`;t.push(R)}async function qf(){var _;try{const m=(_=Le==null?void 0:Le.currentUser)==null?void 0:_.email;if(!m)return;const{resetPlayerPassword:R}=await mt(()=>Promise.resolve().then(()=>Qr),void 0);await R(m),Me.value=!0,pt.value="Email de réinitialisation envoyé.",setTimeout(()=>{Me.value=!1},3e3)}catch{Fn.value=!0,Ti.value="Impossible d'envoyer l'email de réinitialisation.",setTimeout(()=>{Fn.value=!1},3e3)}}async function Ao(){try{await W4(Le),Da();const _=`/season/${e.slug}`,m=new URLSearchParams(window.location.search);m.delete("open");const R=m.toString()?`${_}?${m.toString()}`:_;t.push(R),Me.value=!0,pt.value="Déconnecté de cet appareil.",setTimeout(()=>{Me.value=!1},2500)}catch{Fn.value=!0,Ti.value="Déconnexion impossible.",setTimeout(()=>{Fn.value=!1},3e3)}}async function sd(){alert("Suppression de compte: contactez l'organisateur pour dissocier vos joueurs. Fonction complète à venir.")}async function Na(_){var m;Da();try{if(_.seasonId&&_.seasonId!==d.value){const R=_e(te,"seasons",_.seasonId),X=(await Ft(tt(te,"seasons"))).docs.find(se=>se.id===_.seasonId),ce=(m=X==null?void 0:X.data())==null?void 0:m.slug;if(ce){t.push(`/season/${ce}?player=${encodeURIComponent(_.playerId)}&open=protection`);return}}else{const R=st.value.find(H=>H.id===_.playerId);if(R){_d(R);return}t.push(`?player=${encodeURIComponent(_.playerId)}&open=protection`)}}catch{}}An(async()=>{s.value=Le.currentUser;const _=Le.onAuthStateChanged(i);window._gridBoardUnsubscribe=_;try{d.value&&localStorage.getItem(`dismissCreatorOnboarding:${d.value}`)&&(onboardingDismissedShare.value=!0)}catch{}try{const R=window.location.pathname;if(R&&R!=="/"){const X=new URLSearchParams(window.location.search).get("email")||localStorage.getItem("hatcast_last_email");X&&(await Yo(X,R,{seasonSlug:e.slug,source:"grid_board"}),N.debug("Navigation trackée pour utilisateur non connecté:",{email:X,path:R}))}}catch(R){N.error("Erreur lors du tracking de navigation:",R)}try{const R=new URLSearchParams(window.location.search);if(R.get("open")==="account"&&jt(()=>{Ns.value=!0,N.debug(`Ouverture automatique de "Mon Compte" depuis l'URL`)}),R.get("modal")==="event_details"&&R.get("event")){const H=R.get("event"),X=Je.value.find(ce=>ce.id===H);X&&jt(()=>{yd(X),N.debug("Ouverture automatique des détails d'événement depuis l'URL:",H)})}if(R.get("modal")==="player_details"&&R.get("player")){const H=R.get("player"),X=st.value.find(ce=>ce.id===H);X&&jt(()=>{_d(X),N.debug("Ouverture automatique des détails de joueur depuis l'URL:",H)})}}catch(R){N.error("Erreur lors de la détection automatique des modales:",R)}const m=()=>{g.value=window.scrollY>10};return window.addEventListener("scroll",m,{passive:!0}),document.addEventListener("click",R=>{if(ve.value){const H=De.value,X=qe.value,ce=H&&H.contains(R.target),se=X&&X.contains(R.target);!ce&&!se&&(ve.value=!1)}if(Re.value){const H=Ye.value;H&&H.contains(R.target)||(Re.value=!1)}}),document.addEventListener("keydown",R=>{R.key==="Escape"&&(ve.value&&(ve.value=!1),Re.value&&(Re.value=!1))}),window.addEventListener("resize",()=>{ve.value&&ln(),Re.value&&Nn()}),window.addEventListener("scroll",()=>{ve.value&&ln(),Re.value&&Nn()},{passive:!0}),()=>{window.removeEventListener("scroll",m)}});function So(){jt(()=>{Po()})}const rr=S(new Set),es=S(!0),ms=S(0),Os=S("Préparation de la grille"),ts=S(e.eventId||null),iu=S(!1),xi=S(null);Ct(()=>e.eventId,_=>{if(_)if(ts.value=_,Je.value.length>0)my(_);else{const m=Ct(Je,R=>{R.length>0&&(my(_),m())},{immediate:!0})}});const Vs=He(()=>st.value.map(_=>({..._,isProtected:rr.value.has(_.id),email:null}))),id=He(()=>ts.value?sr.value.findIndex(_=>_.id===ts.value):-1);He(()=>{if(!ts.value||id.value===-1)return!1;if(window.innerWidth<=768){const _=document.querySelector(`[data-event-id="${ts.value}"]`);if(_){const m=_.getBoundingClientRect();return m.left>=0&&m.right<=window.innerWidth}}return!0});const Dr=S(null),od=S(!1),ad=S(!1),Oa=S(0),ld=S(null),gr=S(null),Br=S(null);function Rn(){const _=Dr.value;if(!_)return;const{scrollLeft:m,scrollWidth:R,clientWidth:H}=_;od.value=m>2,ad.value=m<R-H-2}function Po(){var _;try{Rn(),Oa.value=((_=Dr.value)==null?void 0:_.scrollLeft)||0}catch{}}function Ro(_){const m=Dr.value;if(!m)return;let R=0;const H=m.querySelector("tbody tr td[data-event-id]");if(H)R=H.getBoundingClientRect().width;else if(gr!=null&&gr.value){const ce=gr.value.querySelector(".col-event");ce&&(R=ce.getBoundingClientRect().width)}(!R||!isFinite(R))&&(R=m.clientWidth*.6);const X=m.scrollLeft+_*R;m.scrollTo({left:X,behavior:"smooth"})}const Ii=S(null);S(0);const Dt=S(!1),Ms=S(!1),qr=S(0);function Ei(_,m){m&&typeof m.preventDefault=="function"&&m.preventDefault(),zr(),Ro(_)}function Va(_,m){if(m&&typeof m.preventDefault=="function"&&m.preventDefault(),Dt.value)return;Dt.value=!0,qr.value=_,Ms.value=!1;const R=Dr.value;if(!R)return;let H=0;const X=R.querySelector("tbody tr td[data-event-id]");if(X)H=X.getBoundingClientRect().width;else if(gr!=null&&gr.value){const Ge=gr.value.querySelector(".col-event");Ge&&(H=Ge.getBoundingClientRect().width)}(!H||!isFinite(H))&&(H=R.clientWidth*.6);const ce=H/6,se=120,Pe=()=>{if(!Dt.value||qr.value===0)return;Ms.value||(Ms.value=!0);const Ge=R.scrollLeft+qr.value*ce;R.scrollTo({left:Ge,behavior:"auto"}),Ii.value=window.setTimeout(Pe,se)};Ii.value=window.setTimeout(Pe,250)}function zr(_){_&&typeof _.preventDefault=="function"&&_.preventDefault();const m=Dt.value,R=Ms.value;if(Dt.value=!1,Ii.value&&(clearTimeout(Ii.value),Ii.value=null),_&&typeof _.type=="string"&&_.type.startsWith("touch")&&!R){const H=qr.value||0;H!==0&&Ro(H),qr.value=0;return}qr.value=0,m&&R&&zf()}function zf(){const _=Dr.value;if(!_)return;let m=0;const R=_.querySelector("tbody tr td[data-event-id]");if(R)m=R.getBoundingClientRect().width;else if(gr!=null&&gr.value){const se=gr.value.querySelector(".col-event");se&&(m=se.getBoundingClientRect().width)}if(!m||!isFinite(m)||m<=0)return;const H=_.scrollLeft,ce=Math.round(H/m)*m;_.scrollTo({left:ce,behavior:"smooth"})}function Hf(_){le.value=_;const m=document.querySelector(`[data-player-id="${_}"]`);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),Me.value=!0,pt.value="Nouveau joueur ajouté !",setTimeout(()=>{Me.value=!1},3e3)}function Kf(){if(Pt.value!==1)return;const _=document.querySelector('button[data-onboarding="add-player"]');if(!_)return;const m=_.getBoundingClientRect(),R=document.getElementById("coachmark-add"),H=280,X=100,ce=R!=null&&R.offsetWidth&&R.offsetWidth>0?R.offsetWidth:H,se=R!=null&&R.offsetHeight&&R.offsetHeight>0?R.offsetHeight:X,Pe=Math.round(m.right+12);if(Pe+ce<=window.innerWidth-12){const nt=m.top+m.height/2-se/2,cn=ud(nt+-14,se);b.value={position:{x:Pe,y:cn},side:"right"}}else{const nt=Math.round(m.left+m.width/2-ce/2),Rt=ud(m.top-se-8,se),cn=8,xn=window.innerWidth-ce-8;b.value={position:{x:Math.max(cn,Math.min(nt,xn)),y:Rt},side:null}}}function ud(_,m){const R=pageHeaderRef==null?void 0:pageHeaderRef.value,H=R?Math.max(0,Math.round(R.getBoundingClientRect().height||0)):0,X=Math.max(12,H+8),ce=window.innerHeight-m-12;return Math.max(X,Math.min(Math.round(_),ce))}function gs(){var _;Pt.value===1&&((_=b.value)!=null&&_.position)&&Kf()}An(()=>{window.addEventListener("scroll",gs,{passive:!0}),window.addEventListener("resize",gs)}),Zs(()=>{window._gridBoardUnsubscribe&&(window._gridBoardUnsubscribe(),delete window._gridBoardUnsubscribe),window.removeEventListener("scroll",gs),window.removeEventListener("resize",gs)});function Nr(_){return rr.value.has(_)}async function Ma(){if(d.value)try{const _=await jm(d.value),m=new Set;_.forEach(R=>{R.isProtected&&m.add(R.playerId||R.id)}),rr.value=m}catch{const m=new Set;for(const R of st.value)await no(R.id,d.value)&&m.add(R.id);rr.value=m}}const Me=S(!1),pt=S(""),Fn=S(!1),Ti=S("");function Gf(){try{const _=`${window.location.origin}/season/${l}`;navigator.clipboard.writeText(_),Me.value=!0,pt.value="Lien copié dans le presse-papiers",setTimeout(()=>{Me.value=!1},2500)}catch{Fn.value=!0,Ti.value="Impossible de copier le lien",setTimeout(()=>{Fn.value=!1},2500)}}async function cd(_){await pn({type:"deleteEvent",data:{eventId:_}})}async function vs(_=null){const m=_||x.value;if(!m){console.error("Aucun événement à supprimer");return}try{await R6(m,d.value),Je.value=Je.value.filter(R=>R.id!==m),await Promise.all([Fh(d.value),zo(st.value,Je.value,d.value),Ho(d.value)]).then(([R,H,X])=>{Je.value=R,un.value=H,dt.value=X}),v.value=!1,x.value=null,Me.value=!0,pt.value="Événement supprimé avec succès !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function Wf(){v.value=!1,x.value=null}async function ou(){if(!w.value||!I.value.trim()||!L.value)return;const _=parseInt($.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const m={title:I.value.trim(),date:L.value,description:ge.value.trim()||"",playerCount:_,archived:!!he.value};await Hb(w.value,m,d.value),!m.archived&&st.value.length>0&&rr.value.size>0&&(Ds.value={id:w.value,...m},wi.value=!0),await Promise.all([Fh(d.value),zo(st.value,Je.value,d.value),Ho(d.value)]).then(([R,H,X])=>{Je.value=R,un.value=H,dt.value=X}),w.value=null,I.value="",L.value="",ge.value="",$.value=6,he.value=!1,Me.value=!0,pt.value="Événement mis à jour avec succès !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function La(){if(z.value.trim())try{const _=z.value.trim(),m=await g1(_,d.value);await Promise.all([Qu(d.value),zo(st.value,Je.value,d.value),Ho(d.value)]).then(([R,H,X])=>{st.value=R,un.value=H,dt.value=X,Ma();const ce=st.value.find(Pe=>Pe.id===m);Hf(m),Z.value=m,A.value=sr.value&&sr.value[0]&&sr.value[0].id?sr.value[0].id:null;try{d.value&&localStorage.setItem(`lastAddedPlayerId:${d.value}`,m)}catch{}try{typeof Pt<"u"&&(Pt.value=2)}catch{}const se=document.querySelector(`[data-player-id="${m}"]`);se&&se.scrollIntoView({behavior:"smooth",block:"center"}),jt(()=>{const Pe=`[data-player-id="${Z.value}"] td[data-event-id="${A.value}"]`,Ge=document.querySelector(Pe);if(Ge){const nt=Ge.getBoundingClientRect();E.value.position={x:Math.round(nt.left),y:Math.round(nt.top+window.scrollY-48)}}}),Me.value=!0,pt.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Me.value=!1},3e3),setTimeout(()=>{Me.value=!1,pt.value=""},5e3)}),U.value=!1,z.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function ys(){w.value=null,I.value="",L.value="",ge.value="",$.value=6}S(null);const Co=S(!1),Hr=S(""),Kr=S(""),Ai=S(""),Ls=S(6),Kt=S(!1);async function Qf(){if(!Hr.value.trim()||!Kr.value){alert("Veuillez remplir le titre et la date de l'événement");return}const _=parseInt(Ls.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const m={title:Hr.value.trim(),date:Kr.value,description:Ai.value.trim()||"",playerCount:_,archived:!!Kt.value};await Jf(m)}async function Jf(_){try{const m=await C6(_,d.value);Je.value=[...Je.value,{id:m,..._}];const R={};for(const H of st.value)R[H.name]=un.value[H.name]||{},R[H.name][m]=null,await zb(H.name,R[H.name],d.value);Hr.value="",Kr.value="",Ai.value="",Ls.value=6,Kt.value=!1,Co.value=!1,await Promise.resolve(),Me.value=!0,pt.value="Événement créé avec succès !",!_.archived&&st.value.length>0&&rr.value.size>0&&(Ds.value={id:m,..._},wi.value=!0),setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function dd(){Hr.value="",Kr.value="",Ai.value="",Ls.value=6,Co.value=!1}async function au(){await pn({type:"addEvent",data:{}})}const Je=S([]),st=S([]),un=S({}),dt=S({}),hd=S({}),lu=S({});Ct([()=>Je.value.length,()=>st.value.length,es],()=>{es.value||jt(()=>{Po()})}),Ct([()=>st.value.length,()=>Je.value.length,d],()=>{Ir()}),An(async()=>{try{iy("firebase"),await m1();const m=xc(tt(te,"seasons"),Ch("slug","==",e.slug)),R=await Ft(m);if(R.empty){t.push("/seasons");return}else{const se=R.docs[0];d.value=se.id;const Pe=se.data();c.value=Pe.name,f.value=Pe,document.title=`Saison : ${c.value}`,Y$(e.slug)}if(d.value){Os.value="Chargement des événements de la saison",ms.value=20;const se=await Ft(tt(te,"seasons",d.value,"events"));Je.value=se.docs.map(Vt=>({id:Vt.id,...Vt.data(),playerCount:Vt.data().playerCount||6})),Os.value="Chargement des joueurs",ms.value=45;const Pe=await Ft(tt(te,"seasons",d.value,"players"));st.value=Pe.docs.map(Vt=>({id:Vt.id,...Vt.data()})),Os.value="Chargement des disponibilités",ms.value=70;const Ge=await Ft(tt(te,"seasons",d.value,"availability")),nt={};Ge.docs.forEach(Vt=>{const Vr=Vt.data(),rs={};Object.keys(Vr).forEach(Vo=>{const Ka=Vr[Vo];rs[Vo]=Ka==="oui"?!0:Ka==="non"?!1:Ka}),nt[Vt.id]=rs}),un.value=nt,Os.value="Chargement des sélections",ms.value=85;const Rt=await Ft(tt(te,"seasons",d.value,"selections")),cn={};Rt.docs.forEach(Vt=>{cn[Vt.id]=Vt.data().players||[]}),dt.value=cn;const xn=await jm(d.value),In=new Set;Array.isArray(xn)&&xn.forEach(Vt=>{Vt.isProtected&&In.add(Vt.playerId||Vt.id)}),rr.value=In}const H=se=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>se()):setTimeout(se,0)};Os.value="Préparation de l'interface",ms.value=95,H(()=>{p(),y()}),await jt(),ms.value=100,es.value=!1,jt(()=>{Rn(),requestAnimationFrame(()=>Rn()),setTimeout(()=>Rn(),250);const se=Dr.value;se&&(se.addEventListener("scroll",Pe=>{Rn(),Oa.value=se.scrollLeft||0},{passive:!0}),window.addEventListener("resize",Rn),typeof ResizeObserver<"u"&&(Br.value=new ResizeObserver(()=>{Rn()}),Br.value.observe(se)))});const X=r.query.event;if(X&&Je.value.length>0){const se=Je.value.find(Pe=>Pe.id===X);se?(await tp(X,se),r.query.modal==="event_details"&&yd(se)):(console.warn("Événement non trouvé avec l'ID"),Fn.value=!0,Ti.value="Événement non trouvé",setTimeout(()=>{Fn.value=!1},3e3))}const ce=r.query.player;if(ce&&st.value.length>0){const se=st.value.find(Pe=>Pe.id===ce);se&&(_d(se),await jt(),r.query.verified==="1"&&(Me.value=!0,pt.value="Joueur associé à votre compte.",setTimeout(()=>{Me.value=!1},2500)))}if(r.query.notificationSuccess==="1")console.debug("✅ Paramètres notificationSuccess détectés"),kr.value={email:decodeURIComponent(r.query.email||""),playerName:decodeURIComponent(r.query.playerName||""),eventId:r.query.eventId||null},setTimeout(()=>{mr.value=!0},100),t.replace({query:{...r.query,notificationSuccess:void 0,email:void 0,playerName:void 0,eventId:void 0}});else{const se=new URLSearchParams(window.location.search),Pe=se.get("notificationSuccess"),Ge=se.get("email"),nt=se.get("playerName"),Rt=se.get("eventId");Pe==="1"&&(console.debug("✅ Paramètres détectés via fallback"),kr.value={email:decodeURIComponent(Ge||""),playerName:decodeURIComponent(nt||""),eventId:Rt||null},setTimeout(()=>{mr.value=!0},100),t.replace({query:{...r.query,notificationSuccess:void 0,email:void 0,playerName:void 0,eventId:void 0}}))}}catch(_){console.error("Erreur lors du chargement de la grille:",_),Fn.value=!0,Ti.value="Erreur lors du chargement des données",setTimeout(()=>{Fn.value=!1},5e3),es.value=!1}}),Ct(()=>r.params.eventId,_=>{if(_){const m=()=>{const R=Je.value.find(H=>H.id===_);return R?(yd(R),!0):!1};if(Je.value.length>0)m();else{const R=Ct(Je,H=>{H.length>0&&m()&&R()},{immediate:!0})}}},{immediate:!0});function Si(_){if(!_)return null;if(_ instanceof Date)return _;if(typeof(_==null?void 0:_.toDate)=="function")return _.toDate();if(typeof _=="string"||typeof _=="number"){const m=new Date(_);return isNaN(m.getTime())?null:m}return null}const $s=He(()=>{let _=null;try{d.value&&(_=localStorage.getItem(`seasonPreferredPlayer:${d.value}`))}catch{}const m=[...st.value].sort((se,Pe)=>(se.name||"").localeCompare(Pe.name||"","fr",{sensitivity:"base"}));if(!_)return m;let R=[];try{_.startsWith("[")?R=JSON.parse(_):_&&(R=[_])}catch{R=[]}const H=new Set(R);if(H.size===0)return m;const X=m.filter(se=>H.has(se.id)),ce=m.filter(se=>!H.has(se.id));return[...X,...ce]}),ns=He(()=>{try{if(d.value){const _=localStorage.getItem(`seasonPreferredPlayer:${d.value}`);if(!_)return new Set;if(_.startsWith("[")){const m=JSON.parse(_);return new Set(Array.isArray(m)?m:[])}return new Set([_])}}catch{}return new Set}),$a=He(()=>[...Je.value].sort((_,m)=>{const R=Si(_.date),H=Si(m.date),X=R?R.getTime():Number.POSITIVE_INFINITY,ce=H?H.getTime():Number.POSITIVE_INFINITY;return X!==ce?X-ce:(_.title||"").localeCompare(m.title||"","fr",{sensitivity:"base"})})),Fs=S(!1),sr=He(()=>{const _=$a.value;return Fs.value?_:_.filter(m=>!m.archived)});function Yf(){Fs.value=!Fs.value}const Fa=S("selected"),ko=He(()=>{var R;if(!Y.value)return $s.value;const _=Y.value.id,m=new Set(((R=dt.value)==null?void 0:R[_])||[]);return $s.value.filter(H=>{var Pe;const X=H.name,ce=(Pe=un.value[X])==null?void 0:Pe[_],se=m.has(X);switch(Fa.value){case"selected":return se;case"available":return ce===!0&&!se;case"unavailable":return ce===!1;case"unknown":return ce!==!0&&ce!==!1;case"all":default:return!0}})}),fd=He(()=>Y.value?No(Y.value.id):null),pd=He(()=>{if(!Y.value)return!1;const _=No(Y.value.id);return _.type==="incomplete"||_.type==="insufficient"}),Ua=He(()=>Y.value?du(Y.value.id):"");async function Pi(_,m){const R=st.value.find(ce=>ce.name===_);if(!R){console.error("Joueur non trouvé");return}const H=Je.value.find(ce=>ce.id===m);if(!H){console.error("Événement non trouvé");return}if(H.archived){Me.value=!0,pt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Me.value=!1},3e3);return}if(Nr(R.id)){const ce=oa(R.id),se=$n.value===R.id;ce||se?(se&&($n.value=null),ja(R,m)):(Et.value={playerName:_,eventId:m},ht.value=R,at.value=!0);return}ja(R,m)}function ja(_,m){var X,ce,se;const R=(X=un.value[_.name])==null?void 0:X[m];let H;R===!0?H=!1:R===!1?H=void 0:H=!0,H===void 0?un.value[_.name]&&delete un.value[_.name][m]:(un.value[_.name]||(un.value[_.name]={}),un.value[_.name][m]=H);try{typeof Pt<"u"&&Pt.value===1&&_.id===(Z.value||((ce=$s.value[0])==null?void 0:ce.id))&&m===(A.value||((se=sr.value[0])==null?void 0:se.id))&&(Pt.value=3,jt(()=>{const Ge=document.querySelector(`[data-player-id="${_.id}"]`);if(Ge){const nt=Ge.querySelector(".player-name");if(nt){const Rt=nt.getBoundingClientRect();D.value.position={x:Math.round(Rt.right+8),y:Math.round(Rt.top+window.scrollY-4)}}}}),Zs(()=>{try{window.removeEventListener("resize",Rn)}catch{}try{Br.value&&Br.value.disconnect()}catch{}}))}catch{}zb(_.name,un.value[_.name],d.value).then(async()=>{await jt(),y(),Me.value=!0,pt.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Me.value=!1},3e3)}).catch(Pe=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function Wn(_,m){var R;return(R=un.value[_])==null?void 0:R[m]}function md(_,m){var X;const R=dt.value[m]||[],H=(X=un.value[_])==null?void 0:X[m];return R.includes(_)&&H===!0}async function gd(_,m=6){const R=Je.value.find(se=>se.id===_),H=(R==null?void 0:R.playerCount)||6,X=dt.value[_]||[];if(X.length>0&&X.every(se=>Wn(se,_))){const Pe=st.value.filter(Rt=>Wn(Rt.name,_)).map(Rt=>{const cn=Us(Rt.name);return{name:Rt.name,weight:1/(1+cn)}}),Ge=[],nt=[...Pe];for(;Ge.length<H&&nt.length>0;){const Rt=nt.reduce((In,Vt)=>In+Vt.weight,0);let cn=Math.random()*Rt;const xn=nt.findIndex(In=>(cn-=In.weight,cn<=0));xn>=0&&(Ge.push(nt[xn].name),nt.splice(xn,1))}dt.value[_]=Ge}else{const se=X.filter(Ge=>Wn(Ge,_)),Pe=H-se.length;if(Pe<=0)dt.value[_]=se;else{const Ge=new Set(se),Rt=st.value.filter(In=>Wn(In.name,_)&&!Ge.has(In.name)).map(In=>{const Vt=Us(In.name);return{name:In.name,weight:1/(1+Vt)}}),cn=[],xn=[...Rt];for(;cn.length<Pe&&xn.length>0;){const In=xn.reduce((rs,Vo)=>rs+Vo.weight,0);let Vt=Math.random()*In;const Vr=xn.findIndex(rs=>(Vt-=rs.weight,Vt<=0));Vr>=0&&(cn.push(xn[Vr].name),xn.splice(Vr,1))}dt.value[_]=[...se,...cn]}}await qm(_,dt.value[_],d.value),p(),y()}async function _s(_,m=6){var se,Pe;const R=Ze.value,H=(se=lt.value)==null?void 0:se.id,X=dt.value[_]&&dt.value[_].length>0,ce=X?[...dt.value[_]]:[];if(await gd(_,m),R&&!Ze.value&&(Ze.value=!0,lt.value=Je.value.find(Ge=>Ge.id===H)),Ze.value&&((Pe=lt.value)==null?void 0:Pe.id)===_){if(await jt(),Gn.value&&Gn.value.showSuccess){const Ge=dt.value[_]||[],nt=ce.filter(cn=>Ge.includes(cn)),Rt=nt.length>0&&nt.length<ce.length;Gn.value.showSuccess(X,Rt)}}else Me.value=!0,Je.value.find(Ge=>Ge.id===_),dt.value[_],X?pt.value="Sélection mise à jour avec succès !":pt.value="Sélection effectuée avec succès !",setTimeout(()=>{Me.value=!1},3e3)}function Ba(_){_===0?b.value.position=null:_===1?E.value.position=null:_===2&&(D.value.position=null)}function vd(_){var R;return _?(typeof _=="string"?new Date(_):((R=_.toDate)==null?void 0:R.call(_))||_).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function uu(_){var R;return _?(typeof _=="string"?new Date(_):((R=_.toDate)==null?void 0:R.call(_))||_).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Us(_){return Object.values(dt.value).filter(m=>m.includes(_)).length}function Ri(_){const m=un.value[_]||{};return Object.values(m).filter(R=>R===!0).length}function Un(_){return _?Object.values(un.value).filter(m=>m[_]===!0).length:0}function Do(_){return _?(dt.value[_]||[]).length:0}function cu(_){const m=Je.value.find(H=>H.id===_),R=(m==null?void 0:m.playerCount)||6;return Do(_)>=R}function Ci(_){const m=Ri(_),R=Us(_);return m===0?0:R/m}function u(_){hd.value[_]={availability:Ri(_),selection:Us(_),ratio:Ci(_)}}function p(){st.value.forEach(_=>u(_.name))}function y(){const _={};Je.value.forEach(m=>{const R=m.playerCount||6,X=st.value.filter(se=>Wn(se.name,m.id)===!0).map(se=>{const Pe=Us(se.name);return{name:se.name,weight:1/(1+Pe)}}),ce=X.reduce((se,Pe)=>se+Pe.weight,0);X.forEach(se=>{const Pe=Math.min(1,se.weight/ce*R);_[se.name]||(_[se.name]={}),_[se.name][m.id]=Math.round(Pe*100)})}),lu.value=_}const T=S(null),j=S(!1);async function J(_=null){const m=_||T.value;if(!m){console.error("Aucun joueur à supprimer");return}try{await A6(m,d.value),st.value=st.value.filter(R=>R.id!==m),j.value=!1,T.value=null,Me.value=!0,pt.value="Joueur supprimé avec succès !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function Ee(){j.value=!1,T.value=null}async function Ut(_){dy(),await no(_,d.value)?await ki({type:"deletePlayer",data:{playerId:_}}):await pn({type:"deletePlayer",data:{playerId:_}})}async function Vn(){if(V.value){const _=Je.value.find(R=>R.id===V.value),m=(_==null?void 0:_.playerCount)||6;await _s(V.value,m),F.value=!1,V.value=null}}function Tt(){F.value=!1,V.value=null}function jn(){return We.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis",updateSelection:"Mise à jour de sélection - Code PIN requis"}[We.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function pn(_){if(Qn.isPinCached(d.value)){const m=Qn.getCachedPin(d.value);if(await Vh(d.value,m)){await Di(_);return}else Qn.clearSession()}We.value=_,It.value=!0}async function ki(_){const m=_.data.playerId;try{if(Qn.isPinCached(d.value)){await Di(_);return}}catch{}if(oa(m)){await Di(_);return}Be.value=_,me.value=!0}async function Or(_){try{if(await Vh(d.value,_)){Qn.saveSession(d.value,_),It.value=!1;const R=We.value;We.value=null,await Di(R)}else Se.value="Code PIN incorrect",setTimeout(()=>{Se.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),Se.value="Erreur lors de la vérification du code PIN"}}function qa(){It.value=!1,We.value=null,Se.value=""}async function za(_){if(_){Oe.value=!0,ae.value="";try{const m=Be.value.data.playerId,R=await Lm(d.value);if(_===R){try{Qn.saveSession(d.value,_)}catch{}try{mo.saveSession(Be.value.data.playerId)}catch{}me.value=!1;const X=Be.value;Be.value=null,re.value="",await Di(X);return}if(await verifyPlayerPassword(m,_,d.value)){me.value=!1;const X=Be.value;Be.value=null,re.value="",await Di(X)}else ae.value="Mot de passe incorrect",setTimeout(()=>{ae.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),ae.value="Erreur lors de la vérification du mot de passe"}finally{Oe.value=!1}}}function A1(){me.value=!1,Be.value=null,ae.value="",re.value="",Oe.value=!1}async function ay(_){if(_){ye.value=!0,Q.value="";try{const m=kt.value.data.player,R=await Lm(d.value);if(_===R){try{Qn.saveSession(d.value,_)}catch{}try{mo.saveSession(kt.value.data.player.id)}catch{}Ot.value=!1;const X=kt.value;kt.value=null,we.value="",await Di(X);return}if(await verifyPlayerPassword(m.id,_,d.value)){Ot.value=!1;const X=kt.value;kt.value=null,we.value="",await Di(X)}else Q.value="Mot de passe incorrect",setTimeout(()=>{Q.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),Q.value="Erreur lors de la vérification du mot de passe"}finally{ye.value=!1}}}function S1(){Ot.value=!1,kt.value=null,Q.value="",we.value="",ye.value=!1}async function P1(){yt.value=!0,P.value="",M.value="";try{const _=kt.value.data.player,m=await sendPasswordResetEmail(_.id,d.value);M.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),P.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{yt.value=!1}}async function R1(){ue.value=!0,ne.value="",de.value="";try{const _=Be.value.data.playerId,m=await sendPasswordResetEmail(_,d.value);de.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),ne.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{ue.value=!1}}function C1(){return Qn.isPinCached(d.value)?{timeRemaining:Qn.getTimeRemaining(),isExpiringSoon:Qn.isExpiringSoon()}:null}async function Di(_){var H;if(!_)return;const{type:m,data:R}=_;try{switch(m){case"deleteEvent":x.value=R.eventId,v.value=!0;break;case"addEvent":Co.value=!0;break;case"deletePlayer":T.value=R.playerId,j.value=!0;break;case"launchSelection":dt.value[R.eventId]&&dt.value[R.eventId].length>0?(V.value=R.eventId,F.value=!0,Ie.value=!1):(await _s(R.eventId,R.count),Ie.value=!1);break;case"toggleAvailability":ja(R.player,R.eventId);break;case"toggleArchive":await setEventArchived(R.eventId,R.archived,d.value);{const X=Je.value.findIndex(ce=>ce.id===R.eventId);X!==-1&&(Je.value[X]={...Je.value[X],archived:!!R.archived}),he.value=!!R.archived}break;case"updateSelection":{const{eventId:X,players:ce}=R,se=[...dt.value[X]||[]],Pe=Array.isArray(ce)?ce:[];await qm(X,Pe,d.value),dt.value[X]=Pe;try{const Ge=se.filter(nt=>!Pe.includes(nt));if(Ge.length>0){const nt=Je.value.find(Rt=>Rt.id===X);await XF({eventId:X,eventData:nt,removedPlayers:Ge,newSelectedPlayers:Pe,seasonId:d.value,seasonSlug:l,players:Vs.value})}}catch{}try{(H=Gn.value)==null||H.showSuccess(!0,!0)}catch{}}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),Me.value=!0,pt.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Me.value=!1},3e3)}}function k1(){t.push("/seasons")}Zs(()=>{const _=Dr.value;_&&_.removeEventListener("scroll",Rn),window.removeEventListener("resize",Rn)});async function yd(_){Y.value=_,ge.value=_.description||"",he.value=!!_.archived;const m=`/season/${e.slug}?event=${_.id}&modal=event_details`;t.push(m);try{const R=getCurrentUserId();R&&(await Yo(R,m,{seasonSlug:e.slug,eventId:_.id,eventTitle:_.title,navigationType:"event_details",context:{currentPage:m,timestamp:new Date().toISOString()}}),N.debug("État de navigation événement tracké:",{eventId:_.id,userId:R,url:m}))}catch(R){N.error("Erreur lors du tracking de l'état de navigation:",R)}try{const[R,H]=await Promise.all([zo(st.value,Je.value,d.value),Ho(d.value)]);un.value=R,dt.value=H}catch(R){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",R)}Ie.value=!0,jt(()=>{a()})}function Xf(){Ie.value=!1,Y.value=null,ge.value="",Re.value=!1,ve.value=!1,be(),Qe(),Ue.value={position:"fixed",top:"0px",left:"0px"},ct.value={position:"fixed",top:"0px",left:"0px"};const _=`/season/${e.slug}`;if(r.path!==_){t.push(_);try{const m=getCurrentUserId();m&&(Yo(m,_,{seasonSlug:e.slug,navigationType:"season_overview",context:{previousPage:r.path,timestamp:new Date().toISOString()}}),N.debug("Retour à la vue d'ensemble tracké:",{userId:m,url:_}))}catch(m){N.error("Erreur lors du tracking du retour à la vue d'ensemble:",m)}}}function Ha(_,m=null){const R=m||Y.value;if(R)try{tj(_,R,c.value),Me.value=!0,_==="ics"?pt.value="Fichier .ics téléchargé ! Importez-le dans votre agenda":_==="google"?pt.value="Google Calendar ouvert dans un nouvel onglet":_==="outlook"&&(pt.value="Outlook ouvert dans un nouvel onglet"),setTimeout(()=>{Me.value=!1},3e3)}catch(H){console.error("Erreur lors de l'ajout au calendrier:",H),Me.value=!0,pt.value="Erreur lors de l'ajout au calendrier",setTimeout(()=>{Me.value=!1},3e3)}}function ly(){Xf(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function D1(_,m){var ce;const R=st.value.find(se=>se.name===_);if(!R){console.error("Joueur non trouvé");return}const H=Je.value.find(se=>se.id===m);if(H!=null&&H.archived){Me.value=!0,pt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Me.value=!1},3e3);return}const X=Nr(R.id);if(X)if(oa(R.id))await Pi(_,m);else{Et.value={playerName:_,eventId:m},ht.value=R,at.value=!0;return}else await Pi(_,m);(ce=Le.currentUser)!=null&&ce.email||(!X&&v1()?(qt.value={playerName:_,eventTitle:(H==null?void 0:H.title)||"cet événement",eventId:m},wn.value=!0):X||(fs.value=!0))}function N1(_,m){return(dt.value[m]||[]).includes(_)}async function O1(_){if(ht.value&&($n.value=ht.value.id),Et.value){const{playerName:m,eventId:R}=Et.value;await Pi(m,R),Et.value=null}at.value=!1,ht.value=null}function uy(){w.value=Y.value.id,I.value=Y.value.title,L.value=Y.value.date,ge.value=Y.value.description||"",$.value=Y.value.playerCount||6,Ie.value=!1}async function cy(){if(Y.value)try{const _=!Y.value.archived,m={...Y.value,archived:_};await Hb(Y.value.id,m,d.value),Y.value.archived=_;const R=Je.value.findIndex(H=>H.id===Y.value.id);R!==-1&&(Je.value[R].archived=_),Me.value=!0,pt.value=_?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function _d(_){Fe.value=_,C.value=!0;const m=`/season/${e.slug}?player=${_.id}&modal=player_details`;t.push(m);try{const R=getCurrentUserId();R&&(Yo(R,m,{seasonSlug:e.slug,playerId:_.id,playerName:_.name,navigationType:"player_details",context:{currentPage:m,timestamp:new Date().toISOString()}}),N.debug("État de navigation joueur tracké:",{playerId:_.id,userId:R,url:m}))}catch(R){N.error("Erreur lors du tracking de l'état de navigation joueur:",R)}try{typeof Pt<"u"&&Pt.value}catch{}}function dy(){C.value=!1,Fe.value=null;const _=`/season/${e.slug}`;if(r.path!==_){t.push(_);try{const m=getCurrentUserId();m&&(Yo(m,_,{seasonSlug:e.slug,navigationType:"season_overview",context:{previousPage:r.path,timestamp:new Date().toISOString()}}),N.debug("Retour à la vue d'ensemble tracké:",{userId:m,url:_}))}catch(m){N.error("Erreur lors du tracking du retour à la vue d'ensemble:",m)}}}async function V1({playerId:_,newName:m}){try{await S6(_,m,d.value),await Promise.all([Qu(d.value),zo(st.value,Je.value,d.value),Ho(d.value)]).then(([R,H,X])=>{if(st.value=R,un.value=H,dt.value=X,Ma(),Fe.value&&Fe.value.id===_){const ce=R.find(se=>se.id===_);ce&&(Fe.value=ce)}}),Me.value=!0,pt.value="Joueur mis à jour avec succès !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function M1(){try{await Promise.all([Qu(d.value),zo(st.value,Je.value,d.value),Ho(d.value)]).then(([_,m,R])=>{if(st.value=_,un.value=m,dt.value=R,Ma(),Fe.value){const H=_.find(X=>X.id===Fe.value.id);H&&(Fe.value=H)}}),Me.value=!0,pt.value="Données mises à jour !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function L1(_){if(!_)return{availability:0,selection:0,ratio:0};const m=Ri(_.name),R=Us(_.name),H=m===0?0:Math.round(R/m*100);return{availability:m,selection:R,ratio:H}}function No(_){const m=dt.value[_]||[],R=Je.value.find(ce=>ce.id===_),H=(R==null?void 0:R.playerCount)||6,X=Un(_);if(m.length>0){const ce=m.some(Pe=>!Wn(Pe,_)),se=X<H;if(ce||se)return{type:"incomplete",hasUnavailablePlayers:ce,hasInsufficientPlayers:se,unavailablePlayers:m.filter(Pe=>!Wn(Pe,_)),availableCount:X,requiredCount:H}}return X<H?{type:"insufficient",availableCount:X,requiredCount:H}:m.length===0?{type:"ready",availableCount:X,requiredCount:H}:{type:"complete",availableCount:X,requiredCount:H}}function du(_){const m=No(_);switch(m.type){case"incomplete":return m.hasUnavailablePlayers?m.unavailablePlayers.length===1?`Sélection incomplète : ${m.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${m.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${m.availableCount} joueurs disponibles pour ${m.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${m.availableCount} disponibles pour ${m.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${m.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${m.availableCount} joueurs disponibles`;default:return""}}async function $1(){const _=[];for(const m of st.value){if(!await no(m.id,d.value))continue;const H=await l1(m.id,d.value);H&&_.push({...m,email:H})}return _}function bd(_){if(_!=null&&_.archived){Me.value=!0,pt.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{Me.value=!1},3e3);return}hy(),On.value=_,nr.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","announce"),m.set("event",(_==null?void 0:_.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function F1(){nr.value=!1,On.value=null;try{const _=new URLSearchParams(window.location.search);_.get("modal")==="announce"&&(_.delete("modal"),_.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${_.toString()}`))}catch{}}function hy(){wi.value=!1,Ds.value=null}const Zf=S(!1);async function fy({eventId:_,eventData:m,reason:R,selectedPlayers:H,scope:X="all",recipient:ce=null}){Zf.value=!0;try{R==="selection"?(X==="single"&&(ce!=null&&ce.email)?await Gb({eventId:_,eventData:m,selectedPlayers:[ce.name],seasonId:d.value,seasonSlug:l,players:Vs.value}):await Gb({eventId:_,eventData:m,selectedPlayers:H,seasonId:d.value,seasonSlug:l,players:Vs.value}),Me.value=!0,pt.value=X==="single"?`Notification envoyée à ${(ce==null?void 0:ce.name)||"1 joueur"}`:"Notifications de sélection envoyées à tous les joueurs sélectionnés !",setTimeout(()=>{Me.value=!1},3e3)):(X==="single"&&(ce!=null&&ce.email)?await Kb({eventId:_,eventData:m,players:[ce],seasonId:d.value,seasonSlug:l,createMagicLink:Lh,reminder:!1,getAvailabilityForEvent:(se,Pe)=>Wn(se,Pe)}):await Kb({eventId:_,eventData:m,players:await $1(),seasonId:d.value,seasonSlug:l,createMagicLink:Lh,reminder:!1,getAvailabilityForEvent:(se,Pe)=>Wn(se,Pe)}),Me.value=!0,pt.value=X==="single"?`Notification envoyée à ${(ce==null?void 0:ce.name)||"1 joueur"}`:"Notifications envoyées à tous les joueurs protégés !",setTimeout(()=>{Me.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),Me.value=!0,pt.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Me.value=!1},3e3)}Zf.value=!1}function ep(_){if(!_)return{};const m={};return st.value.forEach(R=>{m[R.name]=Wn(R.name,_)}),m}function Oo(_){if(_!=null&&_.archived){Me.value=!0,pt.value="Impossible d'ouvrir la sélection sur un événement archivé",setTimeout(()=>{Me.value=!1},3e3);return}lt.value=_,Ze.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","selection"),m.set("event",(_==null?void 0:_.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function py(){Ze.value=!1,lt.value=null;try{const _=new URLSearchParams(window.location.search);_.get("modal")==="selection"&&(_.delete("modal"),_.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${_.toString()}`))}catch{}}async function U1(){if(!lt.value)return;const _=lt.value.id,m=lt.value.playerCount||6;if(Un(_)===0){Me.value=!0,pt.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Me.value=!1},3e3);return}await pn({type:"launchSelection",data:{eventId:_,count:m}})}function j1(){py(),Me.value=!0,pt.value="Sélection validée !",setTimeout(()=>{Me.value=!1},3e3)}async function B1(_){if(!_||!_.eventId)return;const{eventId:m,players:R}=_;await pn({type:"updateSelection",data:{eventId:m,players:R}})}async function tp(_,m){if(!_||!m)return;gy(),ts.value=_,iu.value=!0,await jt();const R=document.querySelector(`[data-event-id="${_}"]`);if(!R){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(se=>{se.classList.remove("focused-event-highlight")});const H=document.querySelectorAll(`[data-event-id="${_}"]`);H.forEach(se=>{se.classList.add("focused-event-highlight")});const X=H[0],ce=H[H.length-1];X&&X.classList.add("focused-event-column-start"),ce&&ce.classList.add("focused-event-column-end"),await q1(R),Me.value=!0,pt.value=`Événement ciblé : ${m.title}`,setTimeout(()=>{Me.value=!1},4e3),xi.value=setTimeout(()=>{gy()},8e3)}function my(_){if(!_)return;const m=Je.value.find(R=>R.id===_);if(!m){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const R=Je.value.find(H=>H.id===_);R?tp(_,R):console.error("Événement toujours introuvable après retry")},500);return}tp(_,m)}Ct(Je,_=>{try{const m=new URLSearchParams(window.location.search),R=m.get("modal"),H=m.get("event");if(!R||!H)return;const X=_.find(ce=>ce.id===H);if(!X)return;R==="announce"&&bd(X),R==="selection"&&Oo(X)}catch{}},{immediate:!0});async function q1(_){if(!_)return;if(await new Promise(R=>setTimeout(R,100)),window.innerWidth<=768){const R=Dr.value;if(R){const H=_.offsetLeft,X=_.offsetWidth,ce=R.clientWidth,se=H-ce/2+X/2,Pe=R.scrollWidth-ce,Ge=Math.max(0,Math.min(se,Pe));R.scrollTo({left:Ge,behavior:"smooth"}),setTimeout(()=>{const nt=_.getBoundingClientRect();if(nt.left<0||nt.right>window.innerWidth){const Rt=H-20;R.scrollTo({left:Math.max(0,Rt),behavior:"smooth"})}},500)}}else _.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const m=Dr.value;m&&setTimeout(()=>{const R=document.querySelector(`[data-event-id="${ts.value}"]`);if(R&&R.closest("tbody")){const H=R.offsetLeft,X=R.offsetWidth,ce=m.clientWidth,se=H-ce/2+X/2,Pe=m.scrollWidth-ce,Ge=Math.max(0,Math.min(se,Pe));m.scrollTo({left:Ge,behavior:"smooth"})}},300)}function gy(){xi.value&&(clearTimeout(xi.value),xi.value=null),ts.value=null,iu.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(_=>{_.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(_=>{_.classList.remove("focused-event-column-start","focused-event-column-end")})}async function z1(_){var m,R;if(!_)return!1;try{if(console.log("🔍 isEventMonitored - currentUser:",((m=s.value)==null?void 0:m.email)||"null"),!((R=s.value)!=null&&R.email))return!1;const{db:H}=await mt(()=>Promise.resolve().then(()=>Qr),void 0),{doc:X,getDoc:ce}=await mt(()=>import("./index.esm-e12eeb83.js"),[]),se=await ce(X(H,"userPreferences",s.value.email));if(se.exists()){const Pe=se.data(),Ge=Pe.notifyAvailability===!0||Pe.notifySelection===!0,nt=(Pe.notifyAvailabilityPush===!0||Pe.notifySelectionPush===!0)&&!!localStorage.getItem("fcmToken");return Ge||nt}return!1}catch(H){return console.error("Erreur lors de la vérification de surveillance:",H),!1}}function H1(_){_&&(qt.value={playerName:"Vous",eventTitle:_.title||"ce spectacle",seasonId:d.value,seasonSlug:e.slug,eventId:_.id},wn.value=!0)}function K1(_){wn.value=!1,qt.value=null,Me.value=!0,_.directActivation?pt.value=`Notifications activées directement pour ${_.playerName} !`:pt.value=`Email envoyé à ${_.email} pour activer les notifications !`,setTimeout(()=>{Me.value=!1},4e3),N.info("Activation des notifications terminée avec succès",_)}return(_,m)=>{var R,H,X,ce,se,Pe,Ge,nt,Rt,cn,xn,In,Vt,Vr,rs,Vo,Ka,vy,yy,_y,by,wy,xy,Iy,Ey,Ty,Ay,Sy,Py,Ry;return k(),O(bt,null,[h("div",Z9,[je(m9,{"season-name":c.value,"is-scrolled":g.value,onGoBack:k1,onOpenAccountMenu:ps,onOpenHelp:m[0]||(m[0]=K=>hs.value=!0),onOpenNotifications:nd,onOpenPlayers:ru,onLogout:Ao,onOpenLogin:su,onOpenAccount:su},null,8,["season-name","is-scrolled"]),h("div",ez,[h("div",{ref_key:"headerBarRef",ref:ld,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[h("div",tz,[Je.value.length===0&&st.value.length===0?ie("",!0):(k(),O("div",nz,[h("div",{class:"flex items-center justify-center h-full gap-2"},[h("button",{onClick:au,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},m[77]||(m[77]=[h("span",{class:"text-lg"},"➕",-1),h("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),h("span",{class:"sm:hidden"},"Événement",-1)]))])])),h("div",rz,[h("div",{ref_key:"headerEventsRef",ref:gr,class:"flex relative z-[60]",style:Mr({transform:`translateX(-${Oa.value}px)`})},[(k(!0),O(bt,null,Lr(sr.value,K=>(k(),O("div",{key:"h-"+K.id,"data-event-id":K.id,class:dn(["col-event flex-shrink-0 p-3 text-center flex flex-col justify-between",{"archived-header":K.archived}])},[h("div",{class:"flex flex-col items-center justify-between p-2 rounded-lg hover:bg-white/10 transition-colors duration-200 cursor-pointer group h-24",title:K.title+" - Cliquez pour voir les détails",onClick:ft(mn=>yd(K),["stop"])},[h("div",oz,[h("div",az,ee(K.title||"Sans titre"),1),K.archived?(k(),O("div",lz,"(Archivé)")):ie("",!0)]),h("div",uz,[h("div",{onClick:ft(mn=>B(K.id),["stop"]),class:"header-date text-[16px] md:text-base text-gray-300 group-hover:text-purple-200 transition-colors duration-200 cursor-pointer hover:bg-white/10 px-2 py-1 rounded",title:uu(K.date)+" - Cliquez pour ajouter à votre agenda"},ee(vd(K.date)),9,cz),en.value===K.id?(k(),O("div",dz,[h("div",hz,[h("button",{onClick:ft(mn=>{Ha("google",K),be()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},m[78]||(m[78]=[h("span",null,"🌐",-1),h("span",null,"Google Calendar",-1)]),8,fz),h("button",{onClick:ft(mn=>{Ha("outlook",K),be()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},m[79]||(m[79]=[h("span",null,"📧",-1),h("span",null,"Outlook",-1)]),8,pz),h("button",{onClick:ft(mn=>{Ha("ics",K),be()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},m[80]||(m[80]=[h("span",null,"📥",-1),h("span",null,"Télécharger (.ics)",-1)]),8,mz)])])):ie("",!0)])],8,iz),h("div",gz,[K.archived?(k(),O("div",vz,m[81]||(m[81]=[h("span",{class:"text-xs text-gray-300 font-medium"},"📁",-1),h("span",{class:"text-xs text-gray-200 font-medium ml-1"},"Archivé",-1)]))):No(K.id).type==="ready"?(k(),O("div",{key:1,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-blue-500/30 transition-colors duration-200 cursor-pointer group",title:du(K.id)+" - Cliquez pour ouvrir la sélection",onClick:ft(mn=>Oo(K),["stop"])},m[82]||(m[82]=[h("span",{class:"text-xs text-blue-300 font-medium group-hover:text-blue-200"},"🆕",-1),h("span",{class:"text-xs text-blue-200 font-medium ml-1 group-hover:text-blue-100"},"Nouveau",-1)]),8,yz)):No(K.id).type==="complete"?(k(),O("div",{key:2,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-green-500/30 transition-colors duration-200 cursor-pointer group",title:du(K.id)+" - Cliquez pour ouvrir la sélection",onClick:ft(mn=>Oo(K),["stop"])},m[83]||(m[83]=[h("span",{class:"text-xs text-green-300 font-medium group-hover:text-green-200"},"✅",-1),h("span",{class:"text-xs text-green-200 font-medium ml-1 group-hover:text-green-100"},"Complet",-1)]),8,_z)):No(K.id).type==="incomplete"?(k(),O("div",{key:3,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-orange-500/30 transition-colors duration-200 cursor-pointer group",title:du(K.id)+" - Cliquez pour ouvrir la sélection",onClick:ft(mn=>Oo(K),["stop"])},m[84]||(m[84]=[h("span",{class:"text-xs text-orange-300 font-medium group-hover:text-orange-200"},"⚠️",-1),h("span",{class:"text-xs text-orange-200 font-medium ml-1 group-hover:text-orange-100"},"À finaliser",-1)]),8,bz)):No(K.id).type==="insufficient"?(k(),O("div",{key:4,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-red-500/30 transition-colors duration-200 cursor-pointer group",title:du(K.id)+" - Cliquez pour ouvrir la sélection",onClick:ft(mn=>Oo(K),["stop"])},m[85]||(m[85]=[h("span",{class:"text-xs text-red-300 font-medium group-hover:text-red-200"},"❌",-1),h("span",{class:"text-xs text-red-200 font-medium ml-1 group-hover:text-red-100"},"Manque",-1)]),8,wz)):ie("",!0)])],10,sz))),128))],4)]),m[88]||(m[88]=h("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),h("button",{onClick:Yf,class:"absolute right-2 top-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[86] backdrop-blur-sm",title:Fs.value?"Masquer les événements archivés":"Afficher les événements archivés","aria-label":Fs.value?"Masquer les événements archivés":"Afficher les événements archivés"},[(k(),O("svg",Iz,[m[86]||(m[86]=h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),m[87]||(m[87]=h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),Fs.value?ie("",!0):(k(),O("path",Ez))]))],8,xz),it(h("button",{onClick:m[1]||(m[1]=ft(K=>Ei(-1,K),["prevent"])),onMousedown:m[2]||(m[2]=ft(K=>Va(-1,K),["prevent"])),onMouseup:m[3]||(m[3]=K=>zr(K)),onMouseleave:m[4]||(m[4]=K=>zr(K)),onTouchstart:m[5]||(m[5]=ft(K=>Va(-1,K),["prevent"])),onTouchend:m[6]||(m[6]=K=>zr(K)),onTouchcancel:m[7]||(m[7]=K=>zr(K)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[fp,od.value]]),it(h("button",{onClick:m[8]||(m[8]=ft(K=>Ei(1,K),["prevent"])),onMousedown:m[9]||(m[9]=ft(K=>Va(1,K),["prevent"])),onMouseup:m[10]||(m[10]=K=>zr(K)),onMouseleave:m[11]||(m[11]=K=>zr(K)),onTouchstart:m[12]||(m[12]=ft(K=>Va(1,K),["prevent"])),onTouchend:m[13]||(m[13]=K=>zr(K)),onTouchcancel:m[14]||(m[14]=K=>zr(K)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[fp,ad.value]])])],512),it(h("div",{ref_key:"gridboardRef",ref:Dr,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[Pt.value===1?(k(),O("div",Tz,[b.value.position?(k(),O("div",{key:0,class:"fixed z-[400]",style:Mr({left:b.value.position.x+"px",top:b.value.position.y+"px"})},[h("div",{id:"coachmark-add",class:dn(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":b.value.side==="right","coachmark-left":b.value.side==="left"}])},[m[90]||(m[90]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),m[91]||(m[91]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),h("div",Az,[m[89]||(m[89]=h("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),h("button",{onClick:m[15]||(m[15]=K=>Ba(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):ie("",!0)])):ie("",!0),Pt.value===2&&Z.value&&A.value?(k(),O("div",Sz,[E.value.position?(k(),O("div",{key:0,class:"fixed z-[400]",style:Mr({position:"absolute",left:E.value.position.x+"px",top:E.value.position.y+"px"})},[h("div",Pz,[m[93]||(m[93]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),m[94]||(m[94]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),h("div",Rz,[m[92]||(m[92]=h("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),h("button",{onClick:m[16]||(m[16]=K=>Ba(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ie("",!0)])):ie("",!0),Pt.value===3&&Z.value?(k(),O("div",Cz,[D.value.position?(k(),O("div",{key:0,class:"fixed z-[400]",style:Mr({position:"absolute",left:D.value.position.x+"px",top:D.value.position.y+"px"})},[h("div",kz,[m[96]||(m[96]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),m[97]||(m[97]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),h("div",Dz,[m[95]||(m[95]=h("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),h("button",{onClick:m[17]||(m[17]=K=>Ba(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ie("",!0)])):ie("",!0),h("table",Nz,[h("colgroup",null,[m[98]||(m[98]=h("col",{class:"col-left"},null,-1)),(k(!0),O(bt,null,Lr(sr.value,(K,mn)=>(k(),O("col",{key:"c"+mn,class:"col-event"}))),128)),m[99]||(m[99]=h("col",{class:"col-right"},null,-1))]),m[103]||(m[103]=h("thead",{class:"hidden"},null,-1)),h("tbody",null,[(k(!0),O(bt,null,Lr($s.value,K=>{var mn;return k(),O("tr",{key:K.id,class:dn(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":K.id===le.value,"preferred-player":ns.value.has(K.id)}]),"data-player-id":K.id},[h("td",Vz,[h("div",Mz,[ns.value.has(K.id)?(k(),O("span",Lz," ⭐ ")):Nr(K.id)?(k(),O("span",$z," 🔒 ")):ie("",!0),h("div",{onClick:Er=>_d(K),class:dn(["player-name hover:bg-white/10 rounded-lg p-2 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight block truncate max-w-full flex-1 min-w-0 group",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":Pt.value===3&&K.id===(Z.value||((mn=$s.value[0])==null?void 0:mn.id))}]),title:"Cliquez pour voir les détails : "+K.name},[h("span",Uz,ee(K.name),1)],10,Fz)])]),(k(!0),O(bt,null,Lr(sr.value,Er=>{var Cy,ky,Dy;return k(),O("td",{key:Er.id,"data-event-id":Er.id,class:dn(["p-0",Er.archived?"archived-col":"",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":Pt.value===2&&K.id===(Z.value||((Cy=$s.value[0])==null?void 0:Cy.id))&&Er.id===(A.value||((ky=sr.value[0])==null?void 0:ky.id))}])},[je(Wb,{"player-name":K.name,"event-id":Er.id,"is-available":Wn(K.name,Er.id),"is-selected":md(K.name,Er.id),"chance-percent":((Dy=lu.value[K.name])==null?void 0:Dy[Er.id])??null,"show-selected-chance":cu(Er.id),disabled:Er.archived===!0,onToggle:Pi},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])],10,jz)}),128)),m[100]||(m[100]=h("td",{class:"p-3 md:p-4"},null,-1))],10,Oz)}),128)),h("tr",Bz,[h("td",qz,[h("div",zz,[h("button",{onClick:m[18]||(m[18]=K=>U.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},m[101]||(m[101]=[h("span",{class:"text-lg"},"➕",-1),h("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),h("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(k(!0),O(bt,null,Lr(sr.value,K=>(k(),O("td",{key:"add-row-"+K.id,"data-event-id":K.id,class:dn(["p-3 md:p-5",K.archived?"archived-col":""])},null,10,Hz))),128)),m[102]||(m[102]=h("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[fp,!es.value]])])]),es.value?(k(),O("div",Kz,[h("div",Gz,[m[104]||(m[104]=h("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[h("span",{class:"text-3xl"},"🎭")],-1)),h("p",Wz,ee(Os.value)+"…",1),h("div",Qz,[h("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:Mr({width:ms.value+"%"})},null,4)]),h("p",Jz,ee(ms.value)+"%",1)])])):ie("",!0),es.value?ie("",!0):(k(),ei(u9,{key:1,"season-id":d.value,"season-slug":$r(l),"players-count":st.value.length,"events-count":Je.value.length,"onboarding-done":((R=f.value)==null?void 0:R.onboardingCreatorDone)===!0,onCreateEvent:au,onAddPlayer:m[19]||(m[19]=()=>{U.value=!0}),onCopyLink:Gf,onDismissed:So},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),ie("",!0),Me.value?(k(),O("div",Yz,[h("div",Xz,[m[105]||(m[105]=h("span",{class:"text-xl"},"✨",-1)),h("span",null,ee(pt.value),1)])])):ie("",!0),Fn.value?(k(),O("div",Zz,[h("div",e8,[m[106]||(m[106]=h("span",{class:"text-xl"},"⚠️",-1)),h("span",null,ee(Ti.value),1)])])):ie("",!0),Co.value?(k(),O("div",t8,[h("div",n8,[m[112]||(m[112]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),h("div",r8,[m[107]||(m[107]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),it(h("input",{"onUpdate:modelValue":m[20]||(m[20]=K=>Hr.value=K),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[$t,Hr.value]])]),h("div",s8,[m[108]||(m[108]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),it(h("input",{"onUpdate:modelValue":m[21]||(m[21]=K=>Kr.value=K),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[$t,Kr.value]])]),h("div",i8,[m[109]||(m[109]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),it(h("textarea",{"onUpdate:modelValue":m[22]||(m[22]=K=>Ai.value=K),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[$t,Ai.value]])]),h("div",o8,[it(h("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":m[23]||(m[23]=K=>Kt.value=K),class:"w-4 h-4"},null,512),[[Yi,Kt.value]]),m[110]||(m[110]=h("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),h("div",a8,[m[111]||(m[111]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),it(h("input",{"onUpdate:modelValue":m[24]||(m[24]=K=>Ls.value=K),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[$t,Ls.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:dd,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:Qf,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):ie("",!0),U.value?(k(),O("div",l8,[h("div",u8,[m[114]||(m[114]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),h("div",c8,[m[113]||(m[113]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),it(h("input",{"onUpdate:modelValue":m[25]||(m[25]=K=>z.value=K),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[$t,z.value]])]),h("div",d8,[h("button",{onClick:m[26]||(m[26]=K=>U.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:La,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):ie("",!0),v.value?(k(),O("div",h8,[h("div",f8,[m[115]||(m[115]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),h("div",p8,[h("button",{onClick:Wf,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:m[27]||(m[27]=()=>vs()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ie("",!0),j.value?(k(),O("div",m8,[h("div",g8,[m[116]||(m[116]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),h("div",v8,[h("button",{onClick:Ee,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{onClick:m[28]||(m[28]=()=>J()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):ie("",!0),F.value?(k(),O("div",y8,[h("div",_8,[h("div",b8,[m[117]||(m[117]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🎭")],-1)),m[118]||(m[118]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),h("p",w8,[V.value&&dt.value[V.value]&&dt.value[V.value].every(K=>Wn(K,V.value))?(k(),O("span",x8,"Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.")):(k(),O("span",I8,"La sélection sera mise à jour : les joueurs disponibles seront conservés, les slots vides seront complétés."))])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:Tt,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{onClick:Vn,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):ie("",!0),Ie.value?(k(),O("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:Xf},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:m[43]||(m[43]=ft(()=>{},["stop"]))},[h("div",E8,[h("button",{onClick:Xf,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),h("div",T8,[m[126]||(m[126]=h("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[h("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),h("div",A8,[h("div",S8,[h("h2",P8,ee((H=Y.value)==null?void 0:H.title),1),h("div",R8,[m[119]||(m[119]=h("span",{class:"text-blue-300"},"👥",-1)),h("span",C8,ee(((X=Y.value)==null?void 0:X.playerCount)||6)+" joueurs",1)])]),h("div",k8,[h("p",D8,ee(uu((ce=Y.value)==null?void 0:ce.date)),1),h("div",N8,[h("button",{onClick:m[29]||(m[29]=K=>ze()),class:"px-3 py-1.5 hover:bg-white/20 rounded text-purple-300 hover:text-green-400 transition-colors duration-200 text-sm flex items-center gap-2 border border-purple-500/30",title:"Ajouter à votre agenda"},m[120]||(m[120]=[h("span",null,"📅",-1),h("span",null,"Agenda",-1)])),Jt.value?(k(),O("div",O8,[h("div",V8,[h("button",{onClick:m[30]||(m[30]=K=>{Ha("google"),Qe()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},m[121]||(m[121]=[h("span",null,"🌐",-1),h("span",null,"Google Calendar",-1)])),h("button",{onClick:m[31]||(m[31]=K=>{Ha("outlook"),Qe()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},m[122]||(m[122]=[h("span",null,"📧",-1),h("span",null,"Outlook",-1)])),h("button",{onClick:m[32]||(m[32]=K=>{Ha("ics"),Qe()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},m[123]||(m[123]=[h("span",null,"📥",-1),h("span",null,"Télécharger (.ics)",-1)]))])])):ie("",!0)])]),(se=Y.value)!=null&&se.description?(k(),O("div",M8,ee(Y.value.description),1)):ie("",!0),h("div",L8,[o.value?(k(),O("div",$8,m[124]||(m[124]=[h("span",{class:"text-blue-300"},"✅",-1),h("span",{class:"text-blue-200"},"Notifications activées",-1)]))):(k(),O("button",{key:1,onClick:m[33]||(m[33]=K=>H1(Y.value)),class:"flex items-center gap-2 px-3 py-1.5 bg-gray-500/15 border border-gray-400/25 rounded text-sm hover:bg-gray-500/25 transition-colors duration-200 cursor-pointer",title:"Reçois des alertes en temps réel : sélections, changements d'horaires, et plus !"},m[125]||(m[125]=[h("span",{class:"text-gray-300"},"🔔",-1),h("span",{class:"text-gray-200"},"Activer les notifications",-1)])))])])])]),h("div",F8,[h("div",U8,[h("div",j8,[h("div",B8,ee(Un((Pe=Y.value)==null?void 0:Pe.id)),1),m[127]||(m[127]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),h("div",q8,[h("div",z8,ee(Do((Ge=Y.value)==null?void 0:Ge.id)),1),m[128]||(m[128]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),h("div",H8,[h("div",K8,ee(Math.max((((nt=Y.value)==null?void 0:nt.playerCount)||6)-Do((Rt=Y.value)==null?void 0:Rt.id),0)),1),m[129]||(m[129]=h("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))])]),Y.value?(k(),O("div",G8,[h("div",W8,[pd.value?(k(),O("div",{key:0,class:dn(["flex items-center gap-2 px-2 py-1 rounded-md border text-[11px] md:text-xs max-w-[70%] truncate",((cn=fd.value)==null?void 0:cn.type)==="incomplete"?"bg-yellow-500/10 border-yellow-500/30 text-yellow-200":"bg-orange-500/10 border-orange-500/30 text-orange-200"]),title:Ua.value},[m[130]||(m[130]=h("span",null,"⚠️",-1)),h("span",J8,ee(Ua.value),1)],10,Q8)):ie("",!0),it(h("select",{"onUpdate:modelValue":m[34]||(m[34]=K=>Fa.value=K),class:"ml-auto bg-gray-800 text-white rounded-md px-3 py-2 border border-white/10 focus:outline-none text-sm",title:"Filtrer les joueurs par statut"},m[131]||(m[131]=[lr('<option value="selected">Sélectionnés</option><option value="available">Disponibles</option><option value="unavailable">Non Disponibles</option><option value="unknown">Pas de réponse</option><option value="all">Tous</option>',5)]),512),[[pR,Fa.value]])]),h("div",Y8,[(k(!0),O(bt,null,Lr(ko.value,K=>{var mn,Er;return k(),O("div",{key:K.id,class:"flex items-center justify-between px-2 py-1.5 rounded-md hover:bg-gray-800/40 transition-colors"},[h("div",X8,[ns.value.has(K.id)?(k(),O("span",Z8," ⭐ ")):Nr(K.id)?(k(),O("span",eH," 🔒 ")):ie("",!0),h("span",{class:"text-white text-sm md:text-base block truncate max-w-full flex-1 min-w-0",title:K.name},ee(K.name),9,tH)]),h("div",nH,[je(Wb,{"player-name":K.name,"event-id":Y.value.id,"is-available":ep(Y.value.id)[K.name],"is-selected":N1(K.name,Y.value.id),"chance-percent":((mn=lu.value[K.name])==null?void 0:mn[Y.value.id])??null,"show-selected-chance":cu(Y.value.id),disabled:((Er=Y.value)==null?void 0:Er.archived)===!0,compact:!0,onToggle:D1},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])])])}),128))])])):ie("",!0),h("div",rH,[h("button",{onClick:m[35]||(m[35]=K=>Oo(Y.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},m[132]||(m[132]=[h("span",null,"🎭",-1),h("span",null,"Sélectionner",-1)])),h("button",{onClick:m[36]||(m[36]=K=>bd(Y.value)),disabled:(xn=Y.value)==null?void 0:xn.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(In=Y.value)!=null&&In.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[133]||(m[133]=[h("span",null,"📢",-1),h("span",null,"Annoncer",-1)]),8,sH),h("div",{class:"relative",ref_key:"eventMoreActionsRef",ref:De},[h("button",{onClick:m[37]||(m[37]=K=>bi()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},m[134]||(m[134]=[h("span",null,"⋯",-1),h("span",null,"Plus",-1)]))],512),h("button",{onClick:ly,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),(k(),ei(Zu,{to:"body"},[ve.value?(k(),O("div",{key:0,ref_key:"eventMoreActionsDropdownRef",ref:qe,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:Mr(Ue.value)},[h("button",{onClick:m[38]||(m[38]=K=>{uy(),ve.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[135]||(m[135]=[h("span",null,"✏️",-1),h("span",null,"Modifier",-1)])),h("button",{onClick:m[39]||(m[39]=K=>{cy(),ve.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10",title:(Vt=Y.value)!=null&&Vt.archived?"Désarchiver cet événement":"Archiver cet événement"},[h("span",null,ee((Vr=Y.value)!=null&&Vr.archived?"📂":"📁"),1),h("span",null,ee((rs=Y.value)!=null&&rs.archived?"Désarchiver":"Archiver"),1)],8,iH),h("button",{onClick:m[40]||(m[40]=K=>{var mn;cd((mn=Y.value)==null?void 0:mn.id),ve.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[136]||(m[136]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)]))],4)):ie("",!0)]))])]),h("div",oH,[h("button",{onClick:m[41]||(m[41]=K=>Oo(Y.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),h("button",{onClick:ly,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),h("button",{onClick:m[42]||(m[42]=K=>oe()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):ie("",!0),(k(),ei(Zu,{to:"body"},[Re.value?(k(),O("div",{key:0,ref_key:"eventMoreActionsMobileDropdownRef",ref:Ye,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:Mr(ct.value)},[h("button",{onClick:m[44]||(m[44]=K=>{bd(Y.value),Re.value=!1}),disabled:(Vo=Y.value)==null?void 0:Vo.archived,class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10 disabled:opacity-50 disabled:cursor-not-allowed",title:(Ka=Y.value)!=null&&Ka.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[137]||(m[137]=[h("span",null,"📢",-1),h("span",null,"Annoncer",-1)]),8,aH),h("button",{onClick:m[45]||(m[45]=K=>{uy(),Re.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[138]||(m[138]=[h("span",null,"✏️",-1),h("span",null,"Modifier",-1)])),h("button",{onClick:m[46]||(m[46]=K=>{cy(),Re.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},[h("span",null,ee((vy=Y.value)!=null&&vy.archived?"📂":"📁"),1),h("span",null,ee((yy=Y.value)!=null&&yy.archived?"Désarchiver":"Archiver"),1)]),h("button",{onClick:m[47]||(m[47]=K=>{var mn;cd((mn=Y.value)==null?void 0:mn.id),Re.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[139]||(m[139]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)]))],4)):ie("",!0)])),je(oy,{show:at.value,player:ht.value,seasonId:d.value,onClose:m[48]||(m[48]=K=>at.value=!1),onVerified:O1},null,8,["show","player","seasonId"]),w.value?(k(),O("div",lH,[h("div",uH,[m[145]||(m[145]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),h("div",cH,[m[140]||(m[140]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),it(h("input",{"onUpdate:modelValue":m[49]||(m[49]=K=>I.value=K),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[or(ys,["esc"]),or(ou,["enter"])],ref:"editTitleInput"},null,544),[[$t,I.value]])]),h("div",dH,[m[141]||(m[141]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),it(h("input",{"onUpdate:modelValue":m[50]||(m[50]=K=>L.value=K),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[or(ys,["esc"]),or(ou,["enter"])]},null,544),[[$t,L.value]])]),h("div",hH,[m[142]||(m[142]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),it(h("textarea",{"onUpdate:modelValue":m[51]||(m[51]=K=>ge.value=K),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:or(ys,["esc"])},null,544),[[$t,ge.value]])]),h("div",fH,[it(h("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":m[52]||(m[52]=K=>he.value=K),class:"w-4 h-4"},null,512),[[Yi,he.value]]),m[143]||(m[143]=h("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),h("div",pH,[m[144]||(m[144]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),it(h("input",{"onUpdate:modelValue":m[53]||(m[53]=K=>$.value=K),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:or(ys,["esc"])},null,544),[[$t,$.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:ys,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:ou,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ie("",!0),je(GA,{show:It.value,message:jn(),error:Se.value,"session-info":C1(),onSubmit:Or,onCancel:qa},null,8,["show","message","error","session-info"]),me.value?(k(),O("div",mH,[h("div",gH,[m[147]||(m[147]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),h("div",vH,[h("div",yH,[h("div",null,[m[146]||(m[146]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),it(h("input",{"onUpdate:modelValue":m[54]||(m[54]=K=>re.value=K),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[55]||(m[55]=or(K=>za(re.value),["enter"])),ref_key:"playerPasswordInputRef",ref:St},null,544),[[$t,re.value]])])]),h("button",{onClick:m[56]||(m[56]=K=>za(re.value)),disabled:!re.value||Oe.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Oe.value?(k(),O("span",bH,"⏳")):(k(),O("span",wH,"🔓")),h("span",null,ee(Oe.value?"Vérification...":"Vérifier et supprimer"),1)],8,_H)]),h("div",xH,[h("button",{onClick:m[57]||(m[57]=K=>G.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),ae.value?(k(),O("div",IH,[h("div",EH,ee(ae.value),1)])):ie("",!0),h("div",{class:"flex justify-center"},[h("button",{onClick:A1,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ie("",!0),Ot.value?(k(),O("div",TH,[h("div",AH,[m[150]||(m[150]=lr('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),h("div",SH,[h("div",PH,[h("div",null,[m[148]||(m[148]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),it(h("input",{"onUpdate:modelValue":m[58]||(m[58]=K=>we.value=K),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[59]||(m[59]=or(K=>ay(we.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:ke},null,544),[[$t,we.value]])])]),h("div",RH,[h("button",{onClick:m[60]||(m[60]=K=>rt.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),Q.value?(k(),O("div",CH,[h("div",kH,ee(Q.value),1)])):ie("",!0)]),h("div",DH,[h("button",{onClick:S1,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),h("button",{onClick:m[61]||(m[61]=K=>ay(we.value)),disabled:!we.value||ye.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[ye.value?(k(),O("span",OH,"⏳")):(k(),O("span",VH,"🔓")),h("span",null,[ut(ee(ye.value?"Vérification...":"Vérifier"),1),m[149]||(m[149]=h("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,NH)])])])):ie("",!0),rt.value?(k(),O("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[64]||(m[64]=K=>rt.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[63]||(m[63]=ft(()=>{},["stop"]))},[m[152]||(m[152]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),h("div",MH,[m[151]||(m[151]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:P1,disabled:yt.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[yt.value?(k(),O("span",$H,"⏳")):(k(),O("span",FH,"📧")),h("span",null,ee(yt.value?"Envoi...":"Envoyer l'email"),1)],8,LH)]),P.value?(k(),O("div",UH,[h("div",jH,ee(P.value),1)])):ie("",!0),M.value?(k(),O("div",BH,[h("div",qH,ee(M.value),1)])):ie("",!0),h("div",zH,[h("button",{onClick:m[62]||(m[62]=K=>rt.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ie("",!0),G.value?(k(),O("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[67]||(m[67]=K=>G.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[66]||(m[66]=ft(()=>{},["stop"]))},[m[154]||(m[154]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),h("div",HH,[m[153]||(m[153]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:R1,disabled:ue.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[ue.value?(k(),O("span",GH,"⏳")):(k(),O("span",WH,"📧")),h("span",null,ee(ue.value?"Envoi...":"Envoyer l'email"),1)],8,KH)]),ne.value?(k(),O("div",QH,[h("div",JH,ee(ne.value),1)])):ie("",!0),de.value?(k(),O("div",YH,[h("div",XH,ee(de.value),1)])):ie("",!0),h("div",ZH,[h("button",{onClick:m[65]||(m[65]=K=>G.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ie("",!0),je(iq,{ref_key:"playerModalRef",ref:vt,show:C.value,player:Fe.value,stats:L1(Fe.value),seasonId:d.value,"onboarding-step":Pt.value,"onboarding-player-id":Z.value,"is-protected":Fe.value?rr.value.has(Fe.value.id):!1,"is-preferred":Fe.value?ns.value.has(Fe.value.id):!1,onClose:dy,onUpdate:V1,onDelete:Ut,onRefresh:M1,onAdvanceOnboarding:m[68]||(m[68]=K=>{try{typeof Pt.value<"u"&&(Pt.value.value=K)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id","is-protected","is-preferred"]),je(Jq,{ref_key:"selectionModalRef",ref:Gn,show:Ze.value,event:lt.value,"current-selection":dt.value[(_y=lt.value)==null?void 0:_y.id]||[],"available-count":Un((by=lt.value)==null?void 0:by.id),"selected-count":Do((wy=lt.value)==null?void 0:wy.id),"player-availability":ep((xy=lt.value)==null?void 0:xy.id),"season-id":d.value,"season-slug":$r(l),players:Vs.value,onClose:py,onSelection:U1,onPerfect:j1,onSendNotifications:fy,onUpdateSelection:B1},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),je(I1,{show:nr.value,event:On.value,"season-id":d.value,"season-slug":$r(l),players:Vs.value,sending:Zf.value,"availability-by-player":ep((Iy=On.value)==null?void 0:Iy.id),onClose:F1,onSendNotifications:fy},null,8,["show","event","season-id","season-slug","players","sending","availability-by-player"]),je(Fj,{show:hs.value,onClose:m[69]||(m[69]=K=>hs.value=!1)},null,8,["show"]),je(h1,{show:Ns.value,"season-id":d.value,onClose:Da,onManagePlayer:Na,onChangePassword:qf,onLogoutDevice:Ao,onDeleteAccount:sd},null,8,["show","season-id"]),je(f1,{show:ka.value,onClose:nu},null,8,["show"]),je(p1,{show:Eo.value,onClose:rd,onManagePlayer:Na},null,8,["show"]),je(V9,{show:wn.value,"player-name":((Ey=qt.value)==null?void 0:Ey.playerName)||"","event-title":((Ty=qt.value)==null?void 0:Ty.eventTitle)||"","season-id":d.value,"season-slug":$r(l),"event-id":((Ay=qt.value)==null?void 0:Ay.eventId)||"",onClose:m[70]||(m[70]=K=>wn.value=!1),onSuccess:K1},null,8,["show","player-name","event-title","season-id","season-slug","event-id"]),je(X9,{show:mr.value,"player-name":((Sy=kr.value)==null?void 0:Sy.playerName)||"",email:((Py=kr.value)==null?void 0:Py.email)||"","season-slug":$r(l),"event-id":((Ry=kr.value)==null?void 0:Ry.eventId)||null,onClose:m[71]||(m[71]=K=>mr.value=!1)},null,8,["show","player-name","email","season-slug","event-id"]),je(E1,{show:tu.value,player:To.value,"season-id":d.value,onClose:m[72]||(m[72]=K=>tu.value=!1),onSuccess:m[73]||(m[73]=()=>{tu.value=!1,Ns.value=!0})},null,8,["show","player","season-id"]),je(WA,{show:fs.value,onClose:m[74]||(m[74]=K=>fs.value=!1),onSuccess:m[75]||(m[75]=()=>{fs.value=!1,Ns.value=!0})},null,8,["show"]),wi.value?(k(),O("div",eK,[h("div",tK,[m[155]||(m[155]=h("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),m[156]||(m[156]=h("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),h("div",nK,[h("button",{onClick:m[76]||(m[76]=K=>bd(Ds.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),h("button",{onClick:hy,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):ie("",!0)],64)}}},rK={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},sK={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},iK={key:0,class:"text-center py-8"},oK={key:1,class:"text-center py-8"},aK={class:"text-gray-300 mb-6"},lK={key:2,class:"space-y-6"},uK={class:"text-center"},cK={class:"text-gray-300 mb-4"},dK={class:"font-semibold text-white"},hK={class:"space-y-4"},fK=["disabled"],pK={key:0,class:"animate-spin"},mK={key:1},gK={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},vK={class:"text-red-300 text-sm"},yK={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},_K={class:"text-green-300 text-sm"},bK={__name:"PasswordReset",setup(n){const e=vo(),t=ba(),r=S(!0),s=S(""),i=S(""),o=S(""),a=S(""),l=S(""),c=S(!1),d=S(""),f=S(""),g=He(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);An(async()=>{try{const{oobCode:w}=e.query;if(N.debug("Token reçu (masqué)"),!w){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=w;try{N.debug("Vérification du token et récupération de l'email...");const I=await N4(Le,w);i.value=I,N.info("Email récupéré depuis le token:",I)}catch(I){N.error("Erreur lors de la vérification du token:",I),s.value="Lien de réinitialisation invalide ou expiré",r.value=!1;return}r.value=!1}catch(w){N.error("Erreur lors de la vérification du lien",w),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function v(){if(g.value){c.value=!0,d.value="",f.value="";try{N.debug("Début réinitialisation avec token (masqué)"),await k4(Le,o.value,a.value),N.info("Mot de passe Firebase Auth mis à jour"),N.info("Réinitialisation terminée avec Firebase Auth");try{N.debug("Tentative de connexion automatique...");const w=await _A(Le,i.value,a.value);N.info("Connexion automatique réussie après reset",{uid:w.user.uid}),f.value="Mot de passe réinitialisé et connexion réussie ! Redirection...",setTimeout(()=>{x()},2e3)}catch(w){N.error("Erreur lors de la connexion automatique",w),f.value="Mot de passe réinitialisé ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{x()},3e3)}}catch(w){N.error("Erreur lors de la réinitialisation",w),w.code==="auth/weak-password"?d.value="Le mot de passe doit contenir au moins 6 caractères":w.code==="auth/invalid-action-code"?d.value="Lien de réinitialisation invalide ou expiré":d.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}async function x(){try{const w=localStorage.getItem("pendingPasswordResetNavigation");if(w)try{const L=JSON.parse(w),{lastVisitedPage:$,timestamp:U,email:z}=L,le=Date.now()-U<36e5,Z=z===i.value;if(le&&Z&&$b($)){if(N.info("✅ Redirection vers la page sauvegardée:",$),localStorage.removeItem("pendingPasswordResetNavigation"),L.returnToAccountMenu){const A=new URL($,window.location.origin),b=new URLSearchParams(A.search);if(L.modalState){const{modalState:D}=L;D.eventId&&(b.set("event",D.eventId),b.set("modal","event_details")),D.playerId&&(b.set("player",D.playerId),b.set("modal","player_details")),b.set("open","account")}const E=`${A.pathname}?${b.toString()}`;N.info('🔄 Redirection vers "Mon Compte" avec état complet:',E),t.push(E)}else t.push($);return}else N.info("⚠️ Navigation sauvegardée invalide ou expirée, nettoyage..."),localStorage.removeItem("pendingPasswordResetNavigation")}catch(L){N.error("Erreur lors du parsing de la navigation sauvegardée:",L),localStorage.removeItem("pendingPasswordResetNavigation")}const I=await V$(i.value);I!=null&&I.lastVisitedPage&&$b(I.lastVisitedPage)?(N.info("Redirection vers la dernière page visitée (Firestore):",I.lastVisitedPage),t.push(I.lastVisitedPage)):(N.info("Aucune page précédente valide, redirection vers les saisons"),t.push("/seasons"))}catch(w){N.error("Erreur lors de la récupération de la navigation, redirection vers les saisons",w),t.push("/seasons")}}return(w,I)=>(k(),O("div",rK,[h("div",sK,[I[8]||(I[8]=lr('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(k(),O("div",iK,I[2]||(I[2]=[h("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),h("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(k(),O("div",oK,[I[3]||(I[3]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"❌")],-1)),I[4]||(I[4]=h("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),h("p",aK,ee(s.value),1),h("button",{onClick:x,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):o.value?(k(),O("div",lK,[h("div",uK,[h("p",cK,[I[5]||(I[5]=ut(" Réinitialisation pour ")),h("span",dK,ee(i.value),1)])]),h("div",hK,[h("div",null,[I[6]||(I[6]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),it(h("input",{"onUpdate:modelValue":I[0]||(I[0]=L=>a.value=L),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:or(v,["enter"])},null,544),[[$t,a.value]])]),h("div",null,[I[7]||(I[7]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),it(h("input",{"onUpdate:modelValue":I[1]||(I[1]=L=>l.value=L),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:or(v,["enter"])},null,544),[[$t,l.value]])])]),h("button",{onClick:v,disabled:!g.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(k(),O("span",pK,"⏳")):(k(),O("span",mK,"🔑")),h("span",null,ee(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,fK),d.value?(k(),O("div",gK,[h("div",vK,ee(d.value),1)])):ie("",!0),f.value?(k(),O("div",yK,[h("div",_K,ee(f.value),1)])):ie("",!0)])):ie("",!0)])]))}},wK={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},xK={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},IK={class:"text-3xl"},EK={class:"text-2xl font-bold text-white mb-2"},TK={class:"text-gray-300 mb-6"},AK={__name:"MagicLink",setup(n){const e=vo(),t=ba(),r=S("loading"),s=S("Traitement en cours..."),i=S("Merci de patienter pendant la validation du lien."),o=He(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/seasons")}return An(async()=>{var l,c,d;try{iy("firebase");const f=String(e.query.sid||""),g=String(e.query.pid||"");let v=String(e.query.eid||"");const x=String(e.query.t||""),w=String(e.query.a||""),I=String(e.query.slug||"");if(!x||!w){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(w==="account_email_update"){const Z=await XA({token:x});if(!Z.valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}try{await L4(Le.currentUser,Z.data.newEmail),await ZA({token:x}),r.value="ok",s.value="Email mis à jour",i.value="Votre adresse email a été mise à jour avec succès."}catch{r.value="error",s.value="Action impossible",i.value="Veuillez vous reconnecter puis réessayer."}return}if(w==="verify_email"&&(v="protection"),!(await JA({seasonId:f,playerId:g,eventId:v,token:x,action:w})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(w==="verify_email"){await i1({playerId:g,seasonId:f});try{await c1({playerId:g,seasonId:f})}catch{}await Fm({seasonId:f,playerId:g,eventId:"protection",action:w}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(I?()=>t.push(`/season/${I}?player=${encodeURIComponent(g)}&verified=1`):()=>t.push("/seasons"),800);return}if(w==="activate_notifications"){try{const{processNotificationActivation:Z}=await mt(()=>Promise.resolve().then(()=>x1),void 0),A=await Z(x);if(A.success)r.value="ok",s.value="Notifications activées !",(l=A.accountStatus)!=null&&l.created?i.value=`Parfait ! Tes notifications sont maintenant actives pour ${A.playerName}. Un compte a été créé avec ton email et tu recevras un email pour définir ton mot de passe.`:i.value=`Parfait ! Tes notifications sont maintenant actives pour ${A.playerName}. Tu recevras des alertes pour tes événements.`,i.value+=`

💡 Conseil : Pour une meilleure expérience, tu peux créer un mot de passe pour ton compte et te connecter directement à l'avenir.`,(c=A.accountStatus)!=null&&c.created?I&&v?t.push(`/season/${I}?event=${v}&modal=event_details&notificationSuccess=1&email=${encodeURIComponent(A.email)}&playerName=${encodeURIComponent(A.playerName)}&eventId=${v}`):I?t.push(`/season/${I}?notificationSuccess=1&email=${encodeURIComponent(A.email)}&playerName=${encodeURIComponent(A.playerName)}`):t.push("/seasons"):I&&v?t.push(`/season/${I}?event=${v}&modal=event_details`):I?t.push(`/season/${I}`):t.push("/seasons");else throw new Error("Échec de l'activation des notifications")}catch(Z){N.error("Erreur lors de l'activation des notifications",Z),r.value="error",s.value="Erreur d'activation",i.value="Impossible d'activer tes notifications. Veuillez réessayer."}return}const $=_e(te,"seasons",f,"players",g),U=await Ht($),z=U.exists()&&U.data().name||"";if(!z){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}if(await P6({seasonId:f,playerName:z,eventId:v,value:w==="yes"}),w==="no")try{const Z=_e(te,"seasons",f,"selections",v),A=await Ht(Z);if(A.exists()){const b=Array.isArray((d=A.data())==null?void 0:d.players)?A.data().players:[],E=b.filter(D=>D!==z);E.length!==b.length&&await setDoc(Z,{players:E},{merge:!0})}}catch{}await Fm({seasonId:f,playerId:g,eventId:v,action:w}),r.value="ok",s.value="Merci !",i.value=w==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible. (Si vous étiez sélectionné(e), vous avez été retiré(e) de la sélection.)",setTimeout(I?()=>t.push(`/season/${I}/event/${v}`):()=>t.push("/seasons"),1200)}catch(f){N.error("Magic link error",f),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(k(),O("div",wK,[h("div",xK,[h("div",{class:dn(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[h("span",IK,ee(o.value),1)],2),h("h1",EK,ee(s.value),1),h("p",TK,ee(i.value),1),h("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},SK={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},PK={class:"text-center py-12 px-4"},RK={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},CK={class:"container mx-auto px-4 pb-16"},kK={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},DK={class:"space-y-5"},NK=["onKeydown"],OK={class:"flex items-center justify-end gap-3 pt-2"},VK=["disabled"],MK={key:0,class:"mt-6 text-sm text-gray-200"},LK={__name:"JoinSeason",setup(n){const e=vo(),t=ba(),r=e.params.slug,s=S(""),i=S(""),o=S(""),a=S(!1),l=S("");An(async()=>{const f=xc(tt(te,"seasons"),Ch("slug","==",r)),g=await Ft(f);if(g.empty)l.value="Saison introuvable";else{const v=g.docs[0];s.value=v.id,i.value=v.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function d(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await g1(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){N.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,g)=>(k(),O("div",SK,[h("div",PK,[h("h1",RK,ee(i.value||"Rejoindre la saison"),1),g[1]||(g[1]=h("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),h("div",CK,[h("div",kK,[g[3]||(g[3]=h("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),h("div",DK,[h("div",null,[g[2]||(g[2]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),it(h("input",{"onUpdate:modelValue":g[0]||(g[0]=v=>o.value=v),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:or(ft(d,["prevent"]),["enter"])},null,40,NK),[[$t,o.value]])]),h("div",OK,[h("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{disabled:!o.value.trim()||a.value,onClick:d,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,VK)])]),l.value?(k(),O("div",MK,ee(l.value),1)):ie("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const $K=[{path:"/",component:oF},{path:"/seasons",component:H5},{path:"/season/:slug",component:Qb,props:!0},{path:"/season/:slug/event/:eventId",component:Qb,props:!0},{path:"/season/:slug/join",component:LK,props:!0},{path:"/reset-password",component:bK},{path:"/magic",component:AK}],FK=TC({history:eC("/"),routes:$K});let il;window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),il=n,console.log("Événement beforeinstallprompt capturé")});window.addEventListener("appinstalled",n=>{console.log("Application installée"),il=null});window.triggerInstall=()=>{il&&(il.prompt(),il.userChoice.then(n=>{n.outcome==="accepted"?console.log("Utilisateur a accepté l'installation"):console.log("Utilisateur a refusé l'installation"),il=null}))};window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches&&console.log("Application déjà installée en mode standalone");const T1=bR(z$);T1.use(FK);T1.mount("#app");G$({immediate:!0,onRegistered(n){window.__swReg=n}});export{tt as $,TT as A,va as B,Cs as C,Pn as D,qG as E,Ia as F,cv as G,BG as H,zK as I,Xr as J,OV as K,MV as L,Sa as M,gG as N,vG as O,aM as P,er as Q,aG as R,QK as S,hn as T,OG as U,bf as V,sM as W,oM as X,mG as Y,XK as Z,mI as _,_c as a,Jc as a$,GK as a0,VV as a1,GV as a2,jG as a3,$l as a4,NG as a5,tG as a6,UG as a7,_e as a8,iG as a9,sG as aA,IG as aB,EG as aC,oG as aD,HV as aE,RG as aF,CG as aG,nM as aH,xc as aI,dT as aJ,WK as aK,DG as aL,tr as aM,Xt as aN,LG as aO,UK as aP,yG as aQ,dG as aR,cG as aS,pG as aT,nG as aU,Io as aV,MG as aW,ZK as aX,Ch as aY,wv as aZ,QG as a_,$V as aa,YK as ab,eG as ac,FG as ad,fG as ae,hG as af,fn as ag,Kc as ah,QV as ai,TG as aj,Ht as ak,_G as al,bG as am,Ft as an,wG as ao,xG as ap,LV as aq,$G as ar,VG as as,JK as at,lG as au,uG as av,rG as aw,AG as ax,PG as ay,SG as az,FV as b,pA as b$,Qc as b0,YG as b1,Ac as b2,Pa as b3,Gi as b4,HG as b5,Qi as b6,Wi as b7,di as b8,nh as b9,VL as bA,v7 as bB,C7 as bC,Ib as bD,f3 as bE,n4 as bF,d7 as bG,s7 as bH,S4 as bI,w7 as bJ,A7 as bK,R7 as bL,y7 as bM,G4 as bN,H4 as bO,ZG as bP,EL as bQ,P4 as bR,x7 as bS,T7 as bT,P7 as bU,$L as bV,m7 as bW,a7 as bX,C4 as bY,r7 as bZ,z4 as b_,WG as ba,ia as bb,vl as bc,g$ as bd,KG as be,_7 as bf,Nm as bg,GG as bh,v$ as bi,Wv as bj,Ji as bk,n7 as bl,K4 as bm,EA as bn,m$ as bo,AA as bp,D4 as bq,k4 as br,s4 as bs,O4 as bt,JG as bu,g7 as bv,o7 as bw,c7 as bx,E$ as by,XG as bz,Ml as c,Lv as c0,t7 as c1,_A as c2,i7 as c3,b7 as c4,E7 as c5,S7 as c6,W4 as c7,e7 as c8,p7 as c9,L4 as ca,$4 as cb,I7 as cc,u7 as cd,f7 as ce,h7 as cf,l7 as cg,N4 as ch,Ea as d,Qt as e,pe as f,Yl as g,zc as h,Zd as i,Sf as j,Hc as k,Tf as l,_v as m,Ll as n,Af as o,Zo as p,iM as q,vn as r,ua as s,Ae as t,BK as u,SD as v,on as w,zG as x,gt as y,jK as z};
