(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function zm(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const qt={},nl=[],os=()=>{},j1=()=>!1,jh=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Hm=n=>n.startsWith("onUpdate:"),Nn=Object.assign,Km=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},B1=Object.prototype.hasOwnProperty,Mt=(n,e)=>B1.call(n,e),He=Array.isArray,rl=n=>Lc(n)==="[object Map]",Vl=n=>Lc(n)==="[object Set]",Dy=n=>Lc(n)==="[object Date]",et=n=>typeof n=="function",pn=n=>typeof n=="string",cs=n=>typeof n=="symbol",zt=n=>n!==null&&typeof n=="object",Qb=n=>(zt(n)||et(n))&&et(n.then)&&et(n.catch),Jb=Object.prototype.toString,Lc=n=>Jb.call(n),q1=n=>Lc(n).slice(8,-1),Yb=n=>Lc(n)==="[object Object]",Gm=n=>pn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Uu=zm(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Bh=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},z1=/-(\w)/g,Xr=Bh(n=>n.replace(z1,(e,t)=>t?t.toUpperCase():"")),H1=/\B([A-Z])/g,uo=Bh(n=>n.replace(H1,"-$1").toLowerCase()),qh=Bh(n=>n.charAt(0).toUpperCase()+n.slice(1)),np=Bh(n=>n?`on${qh(n)}`:""),Wi=(n,e)=>!Object.is(n,e),Fd=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},qp=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},oh=n=>{const e=parseFloat(n);return isNaN(e)?n:e},K1=n=>{const e=pn(n)?Number(n):NaN;return isNaN(e)?n:e};let Ny;const zh=()=>Ny||(Ny=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Ur(n){if(He(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=pn(r)?J1(r):Ur(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(pn(n)||zt(n))return n}const G1=/;(?![^(]*\))/g,W1=/:([^]+)/,Q1=/\/\*[^]*?\*\//g;function J1(n){const e={};return n.replace(Q1,"").split(G1).forEach(t=>{if(t){const r=t.split(W1);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function cn(n){let e="";if(pn(n))e=n;else if(He(n))for(let t=0;t<n.length;t++){const r=cn(n[t]);r&&(e+=r+" ")}else if(zt(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const Y1="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",X1=zm(Y1);function Xb(n){return!!n||n===""}function Z1(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=$c(n[r],e[r]);return t}function $c(n,e){if(n===e)return!0;let t=Dy(n),r=Dy(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=cs(n),r=cs(e),t||r)return n===e;if(t=He(n),r=He(e),t||r)return t&&r?Z1(n,e):!1;if(t=zt(n),r=zt(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!$c(n[o],e[o]))return!1}}return String(n)===String(e)}function Wm(n,e){return n.findIndex(t=>$c(t,e))}const Zb=n=>!!(n&&n.__v_isRef===!0),ee=n=>pn(n)?n:n==null?"":He(n)||zt(n)&&(n.toString===Jb||!et(n.toString))?Zb(n)?ee(n.value):JSON.stringify(n,ew,2):String(n),ew=(n,e)=>Zb(e)?ew(n,e.value):rl(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[rp(r,i)+" =>"]=s,t),{})}:Vl(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>rp(t))}:cs(e)?rp(e):zt(e)&&!He(e)&&!Yb(e)?String(e):e,rp=(n,e="")=>{var t;return cs(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Rr;class eS{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Rr,!e&&Rr&&(this.index=(Rr.scopes||(Rr.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Rr;try{return Rr=this,e()}finally{Rr=t}}}on(){++this._on===1&&(this.prevScope=Rr,Rr=this)}off(){this._on>0&&--this._on===0&&(Rr=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function tS(){return Rr}let Gt;const sp=new WeakSet;class tw{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Rr&&Rr.active&&Rr.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,sp.has(this)&&(sp.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||rw(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Oy(this),sw(this);const e=Gt,t=as;Gt=this,as=!0;try{return this.fn()}finally{iw(this),Gt=e,as=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Ym(e);this.deps=this.depsTail=void 0,Oy(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?sp.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){zp(this)&&this.run()}get dirty(){return zp(this)}}let nw=0,ju,Bu;function rw(n,e=!1){if(n.flags|=8,e){n.next=Bu,Bu=n;return}n.next=ju,ju=n}function Qm(){nw++}function Jm(){if(--nw>0)return;if(Bu){let e=Bu;for(Bu=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;ju;){let e=ju;for(ju=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function sw(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function iw(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),Ym(r),nS(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function zp(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(ow(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function ow(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===sc)||(n.globalVersion=sc,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!zp(n))))return;n.flags|=2;const e=n.dep,t=Gt,r=as;Gt=n,as=!0;try{sw(n);const s=n.fn(n._value);(e.version===0||Wi(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{Gt=t,as=r,iw(n),n.flags&=-3}}function Ym(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)Ym(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function nS(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let as=!0;const aw=[];function ti(){aw.push(as),as=!1}function ni(){const n=aw.pop();as=n===void 0?!0:n}function Oy(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Gt;Gt=void 0;try{e()}finally{Gt=t}}}let sc=0;class rS{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Xm{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Gt||!as||Gt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Gt)t=this.activeLink=new rS(Gt,this),Gt.deps?(t.prevDep=Gt.depsTail,Gt.depsTail.nextDep=t,Gt.depsTail=t):Gt.deps=Gt.depsTail=t,lw(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=Gt.depsTail,t.nextDep=void 0,Gt.depsTail.nextDep=t,Gt.depsTail=t,Gt.deps===t&&(Gt.deps=r)}return t}trigger(e){this.version++,sc++,this.notify(e)}notify(e){Qm();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Jm()}}}function lw(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)lw(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const Hp=new WeakMap,Ko=Symbol(""),Kp=Symbol(""),ic=Symbol("");function ar(n,e,t){if(as&&Gt){let r=Hp.get(n);r||Hp.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new Xm),s.map=r,s.key=t),s.track()}}function qs(n,e,t,r,s,i){const o=Hp.get(n);if(!o){sc++;return}const a=l=>{l&&l.trigger()};if(Qm(),e==="clear")o.forEach(a);else{const l=He(n),c=l&&Gm(t);if(l&&t==="length"){const h=Number(r);o.forEach((f,g)=>{(g==="length"||g===ic||!cs(g)&&g>=h)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(ic)),e){case"add":l?c&&a(o.get("length")):(a(o.get(Ko)),rl(n)&&a(o.get(Kp)));break;case"delete":l||(a(o.get(Ko)),rl(n)&&a(o.get(Kp)));break;case"set":rl(n)&&a(o.get(Ko));break}}Jm()}function qa(n){const e=Dt(n);return e===n?e:(ar(e,"iterate",ic),Yr(n)?e:e.map(Gn))}function Hh(n){return ar(n=Dt(n),"iterate",ic),n}const sS={__proto__:null,[Symbol.iterator](){return ip(this,Symbol.iterator,Gn)},concat(...n){return qa(this).concat(...n.map(e=>He(e)?qa(e):e))},entries(){return ip(this,"entries",n=>(n[1]=Gn(n[1]),n))},every(n,e){return $s(this,"every",n,e,void 0,arguments)},filter(n,e){return $s(this,"filter",n,e,t=>t.map(Gn),arguments)},find(n,e){return $s(this,"find",n,e,Gn,arguments)},findIndex(n,e){return $s(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return $s(this,"findLast",n,e,Gn,arguments)},findLastIndex(n,e){return $s(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return $s(this,"forEach",n,e,void 0,arguments)},includes(...n){return op(this,"includes",n)},indexOf(...n){return op(this,"indexOf",n)},join(n){return qa(this).join(n)},lastIndexOf(...n){return op(this,"lastIndexOf",n)},map(n,e){return $s(this,"map",n,e,void 0,arguments)},pop(){return bu(this,"pop")},push(...n){return bu(this,"push",n)},reduce(n,...e){return Vy(this,"reduce",n,e)},reduceRight(n,...e){return Vy(this,"reduceRight",n,e)},shift(){return bu(this,"shift")},some(n,e){return $s(this,"some",n,e,void 0,arguments)},splice(...n){return bu(this,"splice",n)},toReversed(){return qa(this).toReversed()},toSorted(n){return qa(this).toSorted(n)},toSpliced(...n){return qa(this).toSpliced(...n)},unshift(...n){return bu(this,"unshift",n)},values(){return ip(this,"values",Gn)}};function ip(n,e,t){const r=Hh(n),s=r[e]();return r!==n&&!Yr(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const iS=Array.prototype;function $s(n,e,t,r,s,i){const o=Hh(n),a=o!==n&&!Yr(n),l=o[e];if(l!==iS[e]){const f=l.apply(n,i);return a?Gn(f):f}let c=t;o!==n&&(a?c=function(f,g){return t.call(this,Gn(f),g,n)}:t.length>2&&(c=function(f,g){return t.call(this,f,g,n)}));const h=l.call(o,c,r);return a&&s?s(h):h}function Vy(n,e,t,r){const s=Hh(n);let i=t;return s!==n&&(Yr(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,Gn(a),l,n)}),s[e](i,...r)}function op(n,e,t){const r=Dt(n);ar(r,"iterate",ic);const s=r[e](...t);return(s===-1||s===!1)&&tg(t[0])?(t[0]=Dt(t[0]),r[e](...t)):s}function bu(n,e,t=[]){ti(),Qm();const r=Dt(n)[e].apply(n,t);return Jm(),ni(),r}const oS=zm("__proto__,__v_isRef,__isVue"),uw=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(cs));function aS(n){cs(n)||(n=String(n));const e=Dt(this);return ar(e,"has",n),e.hasOwnProperty(n)}class cw{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?vS:pw:i?fw:hw).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=He(e);if(!s){let l;if(o&&(l=sS[t]))return l;if(t==="hasOwnProperty")return aS}const a=Reflect.get(e,t,ur(e)?e:r);return(cs(t)?uw.has(t):oS(t))||(s||ar(e,"get",t),i)?a:ur(a)?o&&Gm(t)?a:a.value:zt(a)?s?gw(a):Kh(a):a}}class dw extends cw{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=Xi(i);if(!Yr(r)&&!Xi(r)&&(i=Dt(i),r=Dt(r)),!He(e)&&ur(i)&&!ur(r))return l?!1:(i.value=r,!0)}const o=He(e)&&Gm(t)?Number(t)<e.length:Mt(e,t),a=Reflect.set(e,t,r,ur(e)?e:s);return e===Dt(s)&&(o?Wi(r,i)&&qs(e,"set",t,r):qs(e,"add",t,r)),a}deleteProperty(e,t){const r=Mt(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&qs(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!cs(t)||!uw.has(t))&&ar(e,"has",t),r}ownKeys(e){return ar(e,"iterate",He(e)?"length":Ko),Reflect.ownKeys(e)}}class lS extends cw{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const uS=new dw,cS=new lS,dS=new dw(!0);const Gp=n=>n,xd=n=>Reflect.getPrototypeOf(n);function hS(n,e,t){return function(...r){const s=this.__v_raw,i=Dt(s),o=rl(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),h=t?Gp:e?ah:Gn;return!e&&ar(i,"iterate",l?Kp:Ko),{next(){const{value:f,done:g}=c.next();return g?{value:f,done:g}:{value:a?[h(f[0]),h(f[1])]:h(f),done:g}},[Symbol.iterator](){return this}}}}function Id(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function fS(n,e){const t={get(s){const i=this.__v_raw,o=Dt(i),a=Dt(s);n||(Wi(s,a)&&ar(o,"get",s),ar(o,"get",a));const{has:l}=xd(o),c=e?Gp:n?ah:Gn;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&ar(Dt(s),"iterate",Ko),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=Dt(i),a=Dt(s);return n||(Wi(s,a)&&ar(o,"has",s),ar(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=Dt(a),c=e?Gp:n?ah:Gn;return!n&&ar(l,"iterate",Ko),a.forEach((h,f)=>s.call(i,c(h),c(f),o))}};return Nn(t,n?{add:Id("add"),set:Id("set"),delete:Id("delete"),clear:Id("clear")}:{add(s){!e&&!Yr(s)&&!Xi(s)&&(s=Dt(s));const i=Dt(this);return xd(i).has.call(i,s)||(i.add(s),qs(i,"add",s,s)),this},set(s,i){!e&&!Yr(i)&&!Xi(i)&&(i=Dt(i));const o=Dt(this),{has:a,get:l}=xd(o);let c=a.call(o,s);c||(s=Dt(s),c=a.call(o,s));const h=l.call(o,s);return o.set(s,i),c?Wi(i,h)&&qs(o,"set",s,i):qs(o,"add",s,i),this},delete(s){const i=Dt(this),{has:o,get:a}=xd(i);let l=o.call(i,s);l||(s=Dt(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&qs(i,"delete",s,void 0),c},clear(){const s=Dt(this),i=s.size!==0,o=s.clear();return i&&qs(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=hS(s,n,e)}),t}function Zm(n,e){const t=fS(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(Mt(t,s)&&s in r?t:r,s,i)}const pS={get:Zm(!1,!1)},mS={get:Zm(!1,!0)},gS={get:Zm(!0,!1)};const hw=new WeakMap,fw=new WeakMap,pw=new WeakMap,vS=new WeakMap;function yS(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function _S(n){return n.__v_skip||!Object.isExtensible(n)?0:yS(q1(n))}function Kh(n){return Xi(n)?n:eg(n,!1,uS,pS,hw)}function mw(n){return eg(n,!1,dS,mS,fw)}function gw(n){return eg(n,!0,cS,gS,pw)}function eg(n,e,t,r,s){if(!zt(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=_S(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function sl(n){return Xi(n)?sl(n.__v_raw):!!(n&&n.__v_isReactive)}function Xi(n){return!!(n&&n.__v_isReadonly)}function Yr(n){return!!(n&&n.__v_isShallow)}function tg(n){return n?!!n.__v_raw:!1}function Dt(n){const e=n&&n.__v_raw;return e?Dt(e):n}function bS(n){return!Mt(n,"__v_skip")&&Object.isExtensible(n)&&qp(n,"__v_skip",!0),n}const Gn=n=>zt(n)?Kh(n):n,ah=n=>zt(n)?gw(n):n;function ur(n){return n?n.__v_isRef===!0:!1}function S(n){return vw(n,!1)}function wS(n){return vw(n,!0)}function vw(n,e){return ur(n)?n:new xS(n,e)}class xS{constructor(e,t){this.dep=new Xm,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Dt(e),this._value=t?e:Gn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Yr(e)||Xi(e);e=r?e:Dt(e),Wi(e,t)&&(this._rawValue=e,this._value=r?e:Gn(e),this.dep.trigger())}}function Br(n){return ur(n)?n.value:n}const IS={get:(n,e,t)=>e==="__v_raw"?n:Br(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return ur(s)&&!ur(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function yw(n){return sl(n)?n:new Proxy(n,IS)}class ES{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Xm(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=sc-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Gt!==this)return rw(this,!0),!0}get value(){const e=this.dep.track();return ow(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function TS(n,e,t=!1){let r,s;return et(n)?r=n:(r=n.get,s=n.set),new ES(r,s,t)}const Ed={},lh=new WeakMap;let Do;function AS(n,e=!1,t=Do){if(t){let r=lh.get(t);r||lh.set(t,r=[]),r.push(n)}}function SS(n,e,t=qt){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=q=>s?q:Yr(q)||s===!1||s===0?zs(q,1):zs(q);let h,f,g,v,x=!1,w=!1;if(ur(n)?(f=()=>n.value,x=Yr(n)):sl(n)?(f=()=>c(n),x=!0):He(n)?(w=!0,x=n.some(q=>sl(q)||Yr(q)),f=()=>n.map(q=>{if(ur(q))return q.value;if(sl(q))return c(q);if(et(q))return l?l(q,2):q()})):et(n)?e?f=l?()=>l(n,2):n:f=()=>{if(g){ti();try{g()}finally{ni()}}const q=Do;Do=h;try{return l?l(n,3,[v]):n(v)}finally{Do=q}}:f=os,e&&s){const q=f,te=s===!0?1/0:s;f=()=>zs(q(),te)}const I=tS(),$=()=>{h.stop(),I&&I.active&&Km(I.effects,h)};if(i&&e){const q=e;e=(...te)=>{q(...te),$()}}let L=w?new Array(n.length).fill(Ed):Ed;const U=q=>{if(!(!(h.flags&1)||!h.dirty&&!q))if(e){const te=h.run();if(s||x||(w?te.some((X,A)=>Wi(X,L[A])):Wi(te,L))){g&&g();const X=Do;Do=h;try{const A=[te,L===Ed?void 0:w&&L[0]===Ed?[]:L,v];L=te,l?l(e,3,A):e(...A)}finally{Do=X}}}else h.run()};return a&&a(U),h=new tw(f),h.scheduler=o?()=>o(U,!1):U,v=q=>AS(q,!1,h),g=h.onStop=()=>{const q=lh.get(h);if(q){if(l)l(q,4);else for(const te of q)te();lh.delete(h)}},e?r?U(!0):L=h.run():o?o(U.bind(null,!0),!0):h.run(),$.pause=h.pause.bind(h),$.resume=h.resume.bind(h),$.stop=$,$}function zs(n,e=1/0,t){if(e<=0||!zt(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,ur(n))zs(n.value,e,t);else if(He(n))for(let r=0;r<n.length;r++)zs(n[r],e,t);else if(Vl(n)||rl(n))n.forEach(r=>{zs(r,e,t)});else if(Yb(n)){for(const r in n)zs(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&zs(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Fc(n,e,t,r){try{return r?n(...r):n()}catch(s){Gh(s,e,t)}}function ds(n,e,t,r){if(et(n)){const s=Fc(n,e,t,r);return s&&Qb(s)&&s.catch(i=>{Gh(i,e,t)}),s}if(He(n)){const s=[];for(let i=0;i<n.length;i++)s.push(ds(n[i],e,t,r));return s}}function Gh(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||qt;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const h=a.ec;if(h){for(let f=0;f<h.length;f++)if(h[f](n,l,c)===!1)return}a=a.parent}if(i){ti(),Fc(i,null,10,[n,l,c]),ni();return}}PS(n,t,s,r,o)}function PS(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const br=[];let Es=-1;const il=[];let Di=null,Wa=0;const _w=Promise.resolve();let uh=null;function rn(n){const e=uh||_w;return n?e.then(this?n.bind(this):n):e}function RS(n){let e=Es+1,t=br.length;for(;e<t;){const r=e+t>>>1,s=br[r],i=oc(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function ng(n){if(!(n.flags&1)){const e=oc(n),t=br[br.length-1];!t||!(n.flags&2)&&e>=oc(t)?br.push(n):br.splice(RS(e),0,n),n.flags|=1,bw()}}function bw(){uh||(uh=_w.then(xw))}function CS(n){He(n)?il.push(...n):Di&&n.id===-1?Di.splice(Wa+1,0,n):n.flags&1||(il.push(n),n.flags|=1),bw()}function My(n,e,t=Es+1){for(;t<br.length;t++){const r=br[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;br.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function ww(n){if(il.length){const e=[...new Set(il)].sort((t,r)=>oc(t)-oc(r));if(il.length=0,Di){Di.push(...e);return}for(Di=e,Wa=0;Wa<Di.length;Wa++){const t=Di[Wa];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Di=null,Wa=0}}const oc=n=>n.id==null?n.flags&2?-1:1/0:n.id;function xw(n){const e=os;try{for(Es=0;Es<br.length;Es++){const t=br[Es];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Fc(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;Es<br.length;Es++){const t=br[Es];t&&(t.flags&=-2)}Es=-1,br.length=0,ww(),uh=null,(br.length||il.length)&&xw()}}let Bn=null,Iw=null;function ch(n){const e=Bn;return Bn=n,Iw=n&&n.type.__scopeId||null,e}function Ud(n,e=Bn,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&Qy(-1);const i=ch(e);let o;try{o=n(...s)}finally{ch(i),r._d&&Qy(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function st(n,e){if(Bn===null)return n;const t=Xh(Bn),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=qt]=e[s];i&&(et(i)&&(i={mounted:i,updated:i}),i.deep&&zs(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function So(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(ti(),ds(l,t,8,[n.el,a,n,e]),ni())}}const Ew=Symbol("_vte"),Tw=n=>n.__isTeleport,qu=n=>n&&(n.disabled||n.disabled===""),Ly=n=>n&&(n.defer||n.defer===""),$y=n=>typeof SVGElement<"u"&&n instanceof SVGElement,Fy=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,Wp=(n,e)=>{const t=n&&n.to;return pn(t)?e?e(t):null:t},Aw={name:"Teleport",__isTeleport:!0,process(n,e,t,r,s,i,o,a,l,c){const{mc:h,pc:f,pbc:g,o:{insert:v,querySelector:x,createText:w,createComment:I}}=c,$=qu(e.props);let{shapeFlag:L,children:U,dynamicChildren:q}=e;if(n==null){const te=e.el=w(""),X=e.anchor=w("");v(te,t,r),v(X,t,r);const A=(T,k)=>{L&16&&(s&&s.isCE&&(s.ce._teleportTarget=T),h(U,T,k,s,i,o,a,l))},b=()=>{const T=e.target=Wp(e.props,x),k=Sw(T,e,w,v);T&&(o!=="svg"&&$y(T)?o="svg":o!=="mathml"&&Fy(T)&&(o="mathml"),$||(A(T,k),jd(e,!1)))};$&&(A(t,X),jd(e,!0)),Ly(e.props)?(e.el.__isMounted=!1,_r(()=>{b(),delete e.el.__isMounted},i)):b()}else{if(Ly(e.props)&&n.el.__isMounted===!1){_r(()=>{Aw.process(n,e,t,r,s,i,o,a,l,c)},i);return}e.el=n.el,e.targetStart=n.targetStart;const te=e.anchor=n.anchor,X=e.target=n.target,A=e.targetAnchor=n.targetAnchor,b=qu(n.props),T=b?t:X,k=b?te:A;if(o==="svg"||$y(X)?o="svg":(o==="mathml"||Fy(X))&&(o="mathml"),q?(g(n.dynamicChildren,q,T,s,i,o,a),ag(n,e,!0)):l||f(n,e,T,k,s,i,o,a,!1),$)b?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):Td(e,t,te,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const F=e.target=Wp(e.props,x);F&&Td(e,F,null,c,0)}else b&&Td(e,X,A,c,1);jd(e,$)}},remove(n,e,t,{um:r,o:{remove:s}},i){const{shapeFlag:o,children:a,anchor:l,targetStart:c,targetAnchor:h,target:f,props:g}=n;if(f&&(s(c),s(h)),i&&s(l),o&16){const v=i||!qu(g);for(let x=0;x<a.length;x++){const w=a[x];r(w,e,t,v,!!w.dynamicChildren)}}},move:Td,hydrate:kS};function Td(n,e,t,{o:{insert:r},m:s},i=2){i===0&&r(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:h}=n,f=i===2;if(f&&r(o,e,t),(!f||qu(h))&&l&16)for(let g=0;g<c.length;g++)s(c[g],e,t,2);f&&r(a,e,t)}function kS(n,e,t,r,s,i,{o:{nextSibling:o,parentNode:a,querySelector:l,insert:c,createText:h}},f){const g=e.target=Wp(e.props,l);if(g){const v=qu(e.props),x=g._lpa||g.firstChild;if(e.shapeFlag&16)if(v)e.anchor=f(o(n),e,a(n),t,r,s,i),e.targetStart=x,e.targetAnchor=x&&o(x);else{e.anchor=o(n);let w=x;for(;w;){if(w&&w.nodeType===8){if(w.data==="teleport start anchor")e.targetStart=w;else if(w.data==="teleport anchor"){e.targetAnchor=w,g._lpa=e.targetAnchor&&o(e.targetAnchor);break}}w=o(w)}e.targetAnchor||Sw(g,e,h,c),f(x&&o(x),e,g,t,r,s,i)}jd(e,v)}return e.anchor&&o(e.anchor)}const ac=Aw;function jd(n,e){const t=n.ctx;if(t&&t.ut){let r,s;for(e?(r=n.el,s=n.anchor):(r=n.targetStart,s=n.targetAnchor);r&&r!==s;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function Sw(n,e,t,r){const s=e.targetStart=t(""),i=e.targetAnchor=t("");return s[Ew]=i,n&&(r(s,n),r(i,n)),i}const Ni=Symbol("_leaveCb"),Ad=Symbol("_enterCb");function DS(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Tn(()=>{n.isMounted=!0}),rg(()=>{n.isUnmounting=!0}),n}const Jr=[Function,Array],Pw={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Jr,onEnter:Jr,onAfterEnter:Jr,onEnterCancelled:Jr,onBeforeLeave:Jr,onLeave:Jr,onAfterLeave:Jr,onLeaveCancelled:Jr,onBeforeAppear:Jr,onAppear:Jr,onAfterAppear:Jr,onAppearCancelled:Jr},Rw=n=>{const e=n.subTree;return e.component?Rw(e.component):e},NS={name:"BaseTransition",props:Pw,setup(n,{slots:e}){const t=CP(),r=DS();return()=>{const s=e.default&&Dw(e.default(),!0);if(!s||!s.length)return;const i=Cw(s),o=Dt(n),{mode:a}=o;if(r.isLeaving)return ap(i);const l=Uy(i);if(!l)return ap(i);let c=Qp(l,o,r,t,f=>c=f);l.type!==lr&&lc(l,c);let h=t.subTree&&Uy(t.subTree);if(h&&h.type!==lr&&!Lo(l,h)&&Rw(t).type!==lr){let f=Qp(h,o,r,t);if(lc(h,f),a==="out-in"&&l.type!==lr)return r.isLeaving=!0,f.afterLeave=()=>{r.isLeaving=!1,t.job.flags&8||t.update(),delete f.afterLeave,h=void 0},ap(i);a==="in-out"&&l.type!==lr?f.delayLeave=(g,v,x)=>{const w=kw(r,h);w[String(h.key)]=h,g[Ni]=()=>{v(),g[Ni]=void 0,delete c.delayedLeave,h=void 0},c.delayedLeave=()=>{x(),delete c.delayedLeave,h=void 0}}:h=void 0}else h&&(h=void 0);return i}}};function Cw(n){let e=n[0];if(n.length>1){for(const t of n)if(t.type!==lr){e=t;break}}return e}const OS=NS;function kw(n,e){const{leavingVNodes:t}=n;let r=t.get(e.type);return r||(r=Object.create(null),t.set(e.type,r)),r}function Qp(n,e,t,r,s){const{appear:i,mode:o,persisted:a=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:h,onEnterCancelled:f,onBeforeLeave:g,onLeave:v,onAfterLeave:x,onLeaveCancelled:w,onBeforeAppear:I,onAppear:$,onAfterAppear:L,onAppearCancelled:U}=e,q=String(n.key),te=kw(t,n),X=(T,k)=>{T&&ds(T,r,9,k)},A=(T,k)=>{const F=k[1];X(T,k),He(T)?T.every(M=>M.length<=1)&&F():T.length<=1&&F()},b={mode:o,persisted:a,beforeEnter(T){let k=l;if(!t.isMounted)if(i)k=I||l;else return;T[Ni]&&T[Ni](!0);const F=te[q];F&&Lo(n,F)&&F.el[Ni]&&F.el[Ni](),X(k,[T])},enter(T){let k=c,F=h,M=f;if(!t.isMounted)if(i)k=$||c,F=L||h,M=U||f;else return;let R=!1;const Ke=T[Ad]=ct=>{R||(R=!0,ct?X(M,[T]):X(F,[T]),b.delayedLeave&&b.delayedLeave(),T[Ad]=void 0)};k?A(k,[T,Ke]):Ke()},leave(T,k){const F=String(n.key);if(T[Ad]&&T[Ad](!0),t.isUnmounting)return k();X(g,[T]);let M=!1;const R=T[Ni]=Ke=>{M||(M=!0,k(),Ke?X(w,[T]):X(x,[T]),T[Ni]=void 0,te[F]===n&&delete te[F])};te[F]=n,v?A(v,[T,R]):R()},clone(T){const k=Qp(T,e,t,r,s);return s&&s(k),k}};return b}function ap(n){if(Wh(n))return n=Zi(n),n.children=null,n}function Uy(n){if(!Wh(n))return Tw(n.type)&&n.children?Cw(n.children):n;if(n.component)return n.component.subTree;const{shapeFlag:e,children:t}=n;if(t){if(e&16)return t[0];if(e&32&&et(t.default))return t.default()}}function lc(n,e){n.shapeFlag&6&&n.component?(n.transition=e,lc(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function Dw(n,e=!1,t){let r=[],s=0;for(let i=0;i<n.length;i++){let o=n[i];const a=t==null?o.key:String(t)+String(o.key!=null?o.key:i);o.type===mt?(o.patchFlag&128&&s++,r=r.concat(Dw(o.children,e,a))):(e||o.type!==lr)&&r.push(a!=null?Zi(o,{key:a}):o)}if(s>1)for(let i=0;i<r.length;i++)r[i].patchFlag=-2;return r}/*! #__NO_SIDE_EFFECTS__ */function Nw(n,e){return et(n)?(()=>Nn({name:n.name},e,{setup:n}))():n}function Ow(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function zu(n,e,t,r,s=!1){if(He(n)){n.forEach((x,w)=>zu(x,e&&(He(e)?e[w]:e),t,r,s));return}if(ol(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&zu(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?Xh(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,h=a.refs===qt?a.refs={}:a.refs,f=a.setupState,g=Dt(f),v=f===qt?()=>!1:x=>Mt(g,x);if(c!=null&&c!==l&&(pn(c)?(h[c]=null,v(c)&&(f[c]=null)):ur(c)&&(c.value=null)),et(l))Fc(l,a,12,[o,h]);else{const x=pn(l),w=ur(l);if(x||w){const I=()=>{if(n.f){const $=x?v(l)?f[l]:h[l]:l.value;s?He($)&&Km($,i):He($)?$.includes(i)||$.push(i):x?(h[l]=[i],v(l)&&(f[l]=h[l])):(l.value=[i],n.k&&(h[n.k]=l.value))}else x?(h[l]=o,v(l)&&(f[l]=o)):w&&(l.value=o,n.k&&(h[n.k]=o))};o?(I.id=-1,_r(I,t)):I()}}}zh().requestIdleCallback;zh().cancelIdleCallback;const ol=n=>!!n.type.__asyncLoader,Wh=n=>n.type.__isKeepAlive;function VS(n,e){Vw(n,"a",e)}function MS(n,e){Vw(n,"da",e)}function Vw(n,e,t=Wn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(Qh(e,r,t),t){let s=t.parent;for(;s&&s.parent;)Wh(s.parent.vnode)&&LS(r,e,t,s),s=s.parent}}function LS(n,e,t,r){const s=Qh(e,n,r,!0);Js(()=>{Km(r[e],s)},t)}function Qh(n,e,t=Wn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{ti();const a=Uc(t),l=ds(e,t,n,o);return a(),ni(),l});return r?s.unshift(i):s.push(i),i}}const ui=n=>(e,t=Wn)=>{(!dc||n==="sp")&&Qh(n,(...r)=>e(...r),t)},$S=ui("bm"),Tn=ui("m"),FS=ui("bu"),US=ui("u"),rg=ui("bum"),Js=ui("um"),jS=ui("sp"),BS=ui("rtg"),qS=ui("rtc");function zS(n,e=Wn){Qh("ec",n,e)}const Mw="components";function HS(n,e){return GS(Mw,n,!0,e)||n}const KS=Symbol.for("v-ndc");function GS(n,e,t=!0,r=!1){const s=Bn||Wn;if(s){const i=s.type;if(n===Mw){const a=VP(i,!1);if(a&&(a===e||a===Xr(e)||a===qh(Xr(e))))return i}const o=jy(s[n]||i[n],e)||jy(s.appContext[n],e);return!o&&r?i:o}}function jy(n,e){return n&&(n[e]||n[Xr(e)]||n[qh(Xr(e))])}function jr(n,e,t,r){let s;const i=t&&t[r],o=He(n);if(o||pn(n)){const a=o&&sl(n);let l=!1,c=!1;a&&(l=!Yr(n),c=Xi(n),n=Hh(n)),s=new Array(n.length);for(let h=0,f=n.length;h<f;h++)s[h]=e(l?c?ah(Gn(n[h])):Gn(n[h]):n[h],h,void 0,i&&i[h])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(zt(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const h=a[l];s[l]=e(n[h],h,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}function WS(n,e,t={},r,s){if(Bn.ce||Bn.parent&&ol(Bn.parent)&&Bn.parent.ce)return e!=="default"&&(t.name=e),C(),Ys(mt,null,[Be("slot",t,r&&r())],64);let i=n[e];i&&i._c&&(i._d=!1),C();const o=i&&Lw(i(t)),a=t.key||o&&o.key,l=Ys(mt,{key:(a&&!cs(a)?a:`_${e}`)+(!o&&r?"_fb":"")},o||(r?r():[]),o&&n._===1?64:-2);return!s&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),i&&i._c&&(i._d=!0),l}function Lw(n){return n.some(e=>cc(e)?!(e.type===lr||e.type===mt&&!Lw(e.children)):!0)?n:null}const Jp=n=>n?tx(n)?Xh(n):Jp(n.parent):null,Hu=Nn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Jp(n.parent),$root:n=>Jp(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>sg(n),$forceUpdate:n=>n.f||(n.f=()=>{ng(n.update)}),$nextTick:n=>n.n||(n.n=rn.bind(n.proxy)),$watch:n=>mP.bind(n)}),lp=(n,e)=>n!==qt&&!n.__isScriptSetup&&Mt(n,e),QS={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const v=o[e];if(v!==void 0)switch(v){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(lp(r,e))return o[e]=1,r[e];if(s!==qt&&Mt(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&Mt(c,e))return o[e]=3,i[e];if(t!==qt&&Mt(t,e))return o[e]=4,t[e];Yp&&(o[e]=0)}}const h=Hu[e];let f,g;if(h)return e==="$attrs"&&ar(n.attrs,"get",""),h(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==qt&&Mt(t,e))return o[e]=4,t[e];if(g=l.config.globalProperties,Mt(g,e))return g[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return lp(s,e)?(s[e]=t,!0):r!==qt&&Mt(r,e)?(r[e]=t,!0):Mt(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==qt&&Mt(n,o)||lp(e,o)||(a=i[0])&&Mt(a,o)||Mt(r,o)||Mt(Hu,o)||Mt(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:Mt(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function By(n){return He(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let Yp=!0;function JS(n){const e=sg(n),t=n.proxy,r=n.ctx;Yp=!1,e.beforeCreate&&qy(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:h,beforeMount:f,mounted:g,beforeUpdate:v,updated:x,activated:w,deactivated:I,beforeDestroy:$,beforeUnmount:L,destroyed:U,unmounted:q,render:te,renderTracked:X,renderTriggered:A,errorCaptured:b,serverPrefetch:T,expose:k,inheritAttrs:F,components:M,directives:R,filters:Ke}=e;if(c&&YS(c,r,null),o)for(const Ge in o){const Ae=o[Ge];et(Ae)&&(r[Ge]=Ae.bind(t))}if(s){const Ge=s.call(t,t);zt(Ge)&&(n.data=Kh(Ge))}if(Yp=!0,i)for(const Ge in i){const Ae=i[Ge],he=et(Ae)?Ae.bind(t,t):et(Ae.get)?Ae.get.bind(t,t):os,Qe=!et(Ae)&&et(Ae.set)?Ae.set.bind(t):os,le=qe({get:he,set:Qe});Object.defineProperty(r,Ge,{enumerable:!0,configurable:!0,get:()=>le.value,set:re=>le.value=re})}if(a)for(const Ge in a)$w(a[Ge],r,t,Ge);if(l){const Ge=et(l)?l.call(t):l;Reflect.ownKeys(Ge).forEach(Ae=>{Bd(Ae,Ge[Ae])})}h&&qy(h,n,"c");function dt(Ge,Ae){He(Ae)?Ae.forEach(he=>Ge(he.bind(t))):Ae&&Ge(Ae.bind(t))}if(dt($S,f),dt(Tn,g),dt(FS,v),dt(US,x),dt(VS,w),dt(MS,I),dt(zS,b),dt(qS,X),dt(BS,A),dt(rg,L),dt(Js,q),dt(jS,T),He(k))if(k.length){const Ge=n.exposed||(n.exposed={});k.forEach(Ae=>{Object.defineProperty(Ge,Ae,{get:()=>t[Ae],set:he=>t[Ae]=he})})}else n.exposed||(n.exposed={});te&&n.render===os&&(n.render=te),F!=null&&(n.inheritAttrs=F),M&&(n.components=M),R&&(n.directives=R),T&&Ow(n)}function YS(n,e,t=os){He(n)&&(n=Xp(n));for(const r in n){const s=n[r];let i;zt(s)?"default"in s?i=ls(s.from||r,s.default,!0):i=ls(s.from||r):i=ls(s),ur(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function qy(n,e,t){ds(He(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function $w(n,e,t,r){let s=r.includes(".")?Jw(t,r):()=>t[r];if(pn(n)){const i=e[n];et(i)&&kt(s,i)}else if(et(n))kt(s,n.bind(t));else if(zt(n))if(He(n))n.forEach(i=>$w(i,e,t,r));else{const i=et(n.handler)?n.handler.bind(t):e[n.handler];et(i)&&kt(s,i,n)}}function sg(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>dh(l,c,o,!0)),dh(l,e,o)),zt(e)&&i.set(e,l),l}function dh(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&dh(n,i,t,!0),s&&s.forEach(o=>dh(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=XS[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const XS={data:zy,props:Hy,emits:Hy,methods:Du,computed:Du,beforeCreate:yr,created:yr,beforeMount:yr,mounted:yr,beforeUpdate:yr,updated:yr,beforeDestroy:yr,beforeUnmount:yr,destroyed:yr,unmounted:yr,activated:yr,deactivated:yr,errorCaptured:yr,serverPrefetch:yr,components:Du,directives:Du,watch:eP,provide:zy,inject:ZS};function zy(n,e){return e?n?function(){return Nn(et(n)?n.call(this,this):n,et(e)?e.call(this,this):e)}:e:n}function ZS(n,e){return Du(Xp(n),Xp(e))}function Xp(n){if(He(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function yr(n,e){return n?[...new Set([].concat(n,e))]:e}function Du(n,e){return n?Nn(Object.create(null),n,e):e}function Hy(n,e){return n?He(n)&&He(e)?[...new Set([...n,...e])]:Nn(Object.create(null),By(n),By(e??{})):e}function eP(n,e){if(!n)return e;if(!e)return n;const t=Nn(Object.create(null),n);for(const r in e)t[r]=yr(n[r],e[r]);return t}function Fw(){return{app:null,config:{isNativeTag:j1,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let tP=0;function nP(n,e){return function(r,s=null){et(r)||(r=Nn({},r)),s!=null&&!zt(s)&&(s=null);const i=Fw(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:tP++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:LP,get config(){return i.config},set config(h){},use(h,...f){return o.has(h)||(h&&et(h.install)?(o.add(h),h.install(c,...f)):et(h)&&(o.add(h),h(c,...f))),c},mixin(h){return i.mixins.includes(h)||i.mixins.push(h),c},component(h,f){return f?(i.components[h]=f,c):i.components[h]},directive(h,f){return f?(i.directives[h]=f,c):i.directives[h]},mount(h,f,g){if(!l){const v=c._ceVNode||Be(r,s);return v.appContext=i,g===!0?g="svg":g===!1&&(g=void 0),f&&e?e(v,h):n(v,h,g),l=!0,c._container=h,h.__vue_app__=c,Xh(v.component)}},onUnmount(h){a.push(h)},unmount(){l&&(ds(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(h,f){return i.provides[h]=f,c},runWithContext(h){const f=al;al=c;try{return h()}finally{al=f}}};return c}}let al=null;function Bd(n,e){if(Wn){let t=Wn.provides;const r=Wn.parent&&Wn.parent.provides;r===t&&(t=Wn.provides=Object.create(r)),t[n]=e}}function ls(n,e,t=!1){const r=Wn||Bn;if(r||al){let s=al?al._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&et(e)?e.call(r&&r.proxy):e}}const Uw={},jw=()=>Object.create(Uw),Bw=n=>Object.getPrototypeOf(n)===Uw;function rP(n,e,t,r=!1){const s={},i=jw();n.propsDefaults=Object.create(null),qw(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:mw(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function sP(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=Dt(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let f=0;f<h.length;f++){let g=h[f];if(Jh(n.emitsOptions,g))continue;const v=e[g];if(l)if(Mt(i,g))v!==i[g]&&(i[g]=v,c=!0);else{const x=Xr(g);s[x]=Zp(l,a,x,v,n,!1)}else v!==i[g]&&(i[g]=v,c=!0)}}}else{qw(n,e,s,i)&&(c=!0);let h;for(const f in a)(!e||!Mt(e,f)&&((h=uo(f))===f||!Mt(e,h)))&&(l?t&&(t[f]!==void 0||t[h]!==void 0)&&(s[f]=Zp(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!Mt(e,f))&&(delete i[f],c=!0)}c&&qs(n.attrs,"set","")}function qw(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(Uu(l))continue;const c=e[l];let h;s&&Mt(s,h=Xr(l))?!i||!i.includes(h)?t[h]=c:(a||(a={}))[h]=c:Jh(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=Dt(t),c=a||qt;for(let h=0;h<i.length;h++){const f=i[h];t[f]=Zp(s,l,f,c[f],n,!Mt(c,f))}}return o}function Zp(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=Mt(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&et(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const h=Uc(s);r=c[t]=l.call(null,e),h()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===uo(t))&&(r=!0))}return r}const iP=new WeakMap;function zw(n,e,t=!1){const r=t?iP:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!et(n)){const h=f=>{l=!0;const[g,v]=zw(f,e,!0);Nn(o,g),v&&a.push(...v)};!t&&e.mixins.length&&e.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!i&&!l)return zt(n)&&r.set(n,nl),nl;if(He(i))for(let h=0;h<i.length;h++){const f=Xr(i[h]);Ky(f)&&(o[f]=qt)}else if(i)for(const h in i){const f=Xr(h);if(Ky(f)){const g=i[h],v=o[f]=He(g)||et(g)?{type:g}:Nn({},g),x=v.type;let w=!1,I=!0;if(He(x))for(let $=0;$<x.length;++$){const L=x[$],U=et(L)&&L.name;if(U==="Boolean"){w=!0;break}else U==="String"&&(I=!1)}else w=et(x)&&x.name==="Boolean";v[0]=w,v[1]=I,(w||Mt(v,"default"))&&a.push(f)}}const c=[o,a];return zt(n)&&r.set(n,c),c}function Ky(n){return n[0]!=="$"&&!Uu(n)}const ig=n=>n[0]==="_"||n==="$stable",og=n=>He(n)?n.map(Ts):[Ts(n)],oP=(n,e,t)=>{if(e._n)return e;const r=Ud((...s)=>og(e(...s)),t);return r._c=!1,r},Hw=(n,e,t)=>{const r=n._ctx;for(const s in n){if(ig(s))continue;const i=n[s];if(et(i))e[s]=oP(s,i,r);else if(i!=null){const o=og(i);e[s]=()=>o}}},Kw=(n,e)=>{const t=og(e);n.slots.default=()=>t},Gw=(n,e,t)=>{for(const r in e)(t||!ig(r))&&(n[r]=e[r])},aP=(n,e,t)=>{const r=n.slots=jw();if(n.vnode.shapeFlag&32){const s=e.__;s&&qp(r,"__",s,!0);const i=e._;i?(Gw(r,e,t),t&&qp(r,"_",i,!0)):Hw(e,r)}else e&&Kw(n,e)},lP=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=qt;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:Gw(s,e,t):(i=!e.$stable,Hw(e,s)),o=e}else e&&(Kw(n,e),o={default:1});if(i)for(const a in s)!ig(a)&&o[a]==null&&delete s[a]},_r=xP;function uP(n){return cP(n)}function cP(n,e){const t=zh();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:h,parentNode:f,nextSibling:g,setScopeId:v=os,insertStaticContent:x}=n,w=(P,V,H,K=null,Z=null,ue=null,ge=void 0,me=null,ye=!!V.dynamicChildren)=>{if(P===V)return;P&&!Lo(P,V)&&(K=Y(P),re(P,Z,ue,!0),P=null),V.patchFlag===-2&&(ye=!1,V.dynamicChildren=null);const{type:fe,ref:Ve,shapeFlag:Te}=V;switch(fe){case Yh:I(P,V,H,K);break;case lr:$(P,V,H,K);break;case qd:P==null&&L(V,H,K,ge);break;case mt:M(P,V,H,K,Z,ue,ge,me,ye);break;default:Te&1?te(P,V,H,K,Z,ue,ge,me,ye):Te&6?R(P,V,H,K,Z,ue,ge,me,ye):(Te&64||Te&128)&&fe.process(P,V,H,K,Z,ue,ge,me,ye,Pe)}Ve!=null&&Z?zu(Ve,P&&P.ref,ue,V||P,!V):Ve==null&&P&&P.ref!=null&&zu(P.ref,null,ue,P,!0)},I=(P,V,H,K)=>{if(P==null)r(V.el=a(V.children),H,K);else{const Z=V.el=P.el;V.children!==P.children&&c(Z,V.children)}},$=(P,V,H,K)=>{P==null?r(V.el=l(V.children||""),H,K):V.el=P.el},L=(P,V,H,K)=>{[P.el,P.anchor]=x(P.children,V,H,K,P.el,P.anchor)},U=({el:P,anchor:V},H,K)=>{let Z;for(;P&&P!==V;)Z=g(P),r(P,H,K),P=Z;r(V,H,K)},q=({el:P,anchor:V})=>{let H;for(;P&&P!==V;)H=g(P),s(P),P=H;s(V)},te=(P,V,H,K,Z,ue,ge,me,ye)=>{V.type==="svg"?ge="svg":V.type==="math"&&(ge="mathml"),P==null?X(V,H,K,Z,ue,ge,me,ye):T(P,V,Z,ue,ge,me,ye)},X=(P,V,H,K,Z,ue,ge,me)=>{let ye,fe;const{props:Ve,shapeFlag:Te,transition:ke,dirs:Fe}=P;if(ye=P.el=o(P.type,ue,Ve&&Ve.is,Ve),Te&8?h(ye,P.children):Te&16&&b(P.children,ye,null,K,Z,up(P,ue),ge,me),Fe&&So(P,null,K,"created"),A(ye,P,P.scopeId,ge,K),Ve){for(const We in Ve)We!=="value"&&!Uu(We)&&i(ye,We,null,Ve[We],ue,K);"value"in Ve&&i(ye,"value",null,Ve.value,ue),(fe=Ve.onVnodeBeforeMount)&&Is(fe,K,P)}Fe&&So(P,null,K,"beforeMount");const Ue=dP(Z,ke);Ue&&ke.beforeEnter(ye),r(ye,V,H),((fe=Ve&&Ve.onVnodeMounted)||Ue||Fe)&&_r(()=>{fe&&Is(fe,K,P),Ue&&ke.enter(ye),Fe&&So(P,null,K,"mounted")},Z)},A=(P,V,H,K,Z)=>{if(H&&v(P,H),K)for(let ue=0;ue<K.length;ue++)v(P,K[ue]);if(Z){let ue=Z.subTree;if(V===ue||Xw(ue.type)&&(ue.ssContent===V||ue.ssFallback===V)){const ge=Z.vnode;A(P,ge,ge.scopeId,ge.slotScopeIds,Z.parent)}}},b=(P,V,H,K,Z,ue,ge,me,ye=0)=>{for(let fe=ye;fe<P.length;fe++){const Ve=P[fe]=me?Oi(P[fe]):Ts(P[fe]);w(null,Ve,V,H,K,Z,ue,ge,me)}},T=(P,V,H,K,Z,ue,ge)=>{const me=V.el=P.el;let{patchFlag:ye,dynamicChildren:fe,dirs:Ve}=V;ye|=P.patchFlag&16;const Te=P.props||qt,ke=V.props||qt;let Fe;if(H&&Po(H,!1),(Fe=ke.onVnodeBeforeUpdate)&&Is(Fe,H,V,P),Ve&&So(V,P,H,"beforeUpdate"),H&&Po(H,!0),(Te.innerHTML&&ke.innerHTML==null||Te.textContent&&ke.textContent==null)&&h(me,""),fe?k(P.dynamicChildren,fe,me,H,K,up(V,Z),ue):ge||Ae(P,V,me,null,H,K,up(V,Z),ue,!1),ye>0){if(ye&16)F(me,Te,ke,H,Z);else if(ye&2&&Te.class!==ke.class&&i(me,"class",null,ke.class,Z),ye&4&&i(me,"style",Te.style,ke.style,Z),ye&8){const Ue=V.dynamicProps;for(let We=0;We<Ue.length;We++){const rt=Ue[We],nn=Te[rt],Bt=ke[rt];(Bt!==nn||rt==="value")&&i(me,rt,nn,Bt,Z,H)}}ye&1&&P.children!==V.children&&h(me,V.children)}else!ge&&fe==null&&F(me,Te,ke,H,Z);((Fe=ke.onVnodeUpdated)||Ve)&&_r(()=>{Fe&&Is(Fe,H,V,P),Ve&&So(V,P,H,"updated")},K)},k=(P,V,H,K,Z,ue,ge)=>{for(let me=0;me<V.length;me++){const ye=P[me],fe=V[me],Ve=ye.el&&(ye.type===mt||!Lo(ye,fe)||ye.shapeFlag&198)?f(ye.el):H;w(ye,fe,Ve,null,K,Z,ue,ge,!0)}},F=(P,V,H,K,Z)=>{if(V!==H){if(V!==qt)for(const ue in V)!Uu(ue)&&!(ue in H)&&i(P,ue,V[ue],null,Z,K);for(const ue in H){if(Uu(ue))continue;const ge=H[ue],me=V[ue];ge!==me&&ue!=="value"&&i(P,ue,me,ge,Z,K)}"value"in H&&i(P,"value",V.value,H.value,Z)}},M=(P,V,H,K,Z,ue,ge,me,ye)=>{const fe=V.el=P?P.el:a(""),Ve=V.anchor=P?P.anchor:a("");let{patchFlag:Te,dynamicChildren:ke,slotScopeIds:Fe}=V;Fe&&(me=me?me.concat(Fe):Fe),P==null?(r(fe,H,K),r(Ve,H,K),b(V.children||[],H,Ve,Z,ue,ge,me,ye)):Te>0&&Te&64&&ke&&P.dynamicChildren?(k(P.dynamicChildren,ke,H,Z,ue,ge,me),(V.key!=null||Z&&V===Z.subTree)&&ag(P,V,!0)):Ae(P,V,H,Ve,Z,ue,ge,me,ye)},R=(P,V,H,K,Z,ue,ge,me,ye)=>{V.slotScopeIds=me,P==null?V.shapeFlag&512?Z.ctx.activate(V,H,K,ge,ye):Ke(V,H,K,Z,ue,ge,ye):ct(P,V,ye)},Ke=(P,V,H,K,Z,ue,ge)=>{const me=P.component=RP(P,K,Z);if(Wh(P)&&(me.ctx.renderer=Pe),kP(me,!1,ge),me.asyncDep){if(Z&&Z.registerDep(me,dt,ge),!P.el){const ye=me.subTree=Be(lr);$(null,ye,V,H)}}else dt(me,P,V,H,Z,ue,ge)},ct=(P,V,H)=>{const K=V.component=P.component;if(bP(P,V,H))if(K.asyncDep&&!K.asyncResolved){Ge(K,V,H);return}else K.next=V,K.update();else V.el=P.el,K.vnode=V},dt=(P,V,H,K,Z,ue,ge)=>{const me=()=>{if(P.isMounted){let{next:Te,bu:ke,u:Fe,parent:Ue,vnode:We}=P;{const Jt=Ww(P);if(Jt){Te&&(Te.el=We.el,Ge(P,Te,ge)),Jt.asyncDep.then(()=>{P.isUnmounted||me()});return}}let rt=Te,nn;Po(P,!1),Te?(Te.el=We.el,Ge(P,Te,ge)):Te=We,ke&&Fd(ke),(nn=Te.props&&Te.props.onVnodeBeforeUpdate)&&Is(nn,Ue,Te,We),Po(P,!0);const Bt=cp(P),On=P.subTree;P.subTree=Bt,w(On,Bt,f(On.el),Y(On),P,Z,ue),Te.el=Bt.el,rt===null&&wP(P,Bt.el),Fe&&_r(Fe,Z),(nn=Te.props&&Te.props.onVnodeUpdated)&&_r(()=>Is(nn,Ue,Te,We),Z)}else{let Te;const{el:ke,props:Fe}=V,{bm:Ue,m:We,parent:rt,root:nn,type:Bt}=P,On=ol(V);if(Po(P,!1),Ue&&Fd(Ue),!On&&(Te=Fe&&Fe.onVnodeBeforeMount)&&Is(Te,rt,V),Po(P,!0),ke&&vt){const Jt=()=>{P.subTree=cp(P),vt(ke,P.subTree,P,Z,null)};On&&Bt.__asyncHydrate?Bt.__asyncHydrate(ke,P,Jt):Jt()}else{nn.ce&&nn.ce._def.shadowRoot!==!1&&nn.ce._injectChildStyle(Bt);const Jt=P.subTree=cp(P);w(null,Jt,H,K,P,Z,ue),V.el=Jt.el}if(We&&_r(We,Z),!On&&(Te=Fe&&Fe.onVnodeMounted)){const Jt=V;_r(()=>Is(Te,rt,Jt),Z)}(V.shapeFlag&256||rt&&ol(rt.vnode)&&rt.vnode.shapeFlag&256)&&P.a&&_r(P.a,Z),P.isMounted=!0,V=H=K=null}};P.scope.on();const ye=P.effect=new tw(me);P.scope.off();const fe=P.update=ye.run.bind(ye),Ve=P.job=ye.runIfDirty.bind(ye);Ve.i=P,Ve.id=P.uid,ye.scheduler=()=>ng(Ve),Po(P,!0),fe()},Ge=(P,V,H)=>{V.component=P;const K=P.vnode.props;P.vnode=V,P.next=null,sP(P,V.props,K,H),lP(P,V.children,H),ti(),My(P),ni()},Ae=(P,V,H,K,Z,ue,ge,me,ye=!1)=>{const fe=P&&P.children,Ve=P?P.shapeFlag:0,Te=V.children,{patchFlag:ke,shapeFlag:Fe}=V;if(ke>0){if(ke&128){Qe(fe,Te,H,K,Z,ue,ge,me,ye);return}else if(ke&256){he(fe,Te,H,K,Z,ue,ge,me,ye);return}}Fe&8?(Ve&16&&tn(fe,Z,ue),Te!==fe&&h(H,Te)):Ve&16?Fe&16?Qe(fe,Te,H,K,Z,ue,ge,me,ye):tn(fe,Z,ue,!0):(Ve&8&&h(H,""),Fe&16&&b(Te,H,K,Z,ue,ge,me,ye))},he=(P,V,H,K,Z,ue,ge,me,ye)=>{P=P||nl,V=V||nl;const fe=P.length,Ve=V.length,Te=Math.min(fe,Ve);let ke;for(ke=0;ke<Te;ke++){const Fe=V[ke]=ye?Oi(V[ke]):Ts(V[ke]);w(P[ke],Fe,H,null,Z,ue,ge,me,ye)}fe>Ve?tn(P,Z,ue,!0,!1,Te):b(V,H,K,Z,ue,ge,me,ye,Te)},Qe=(P,V,H,K,Z,ue,ge,me,ye)=>{let fe=0;const Ve=V.length;let Te=P.length-1,ke=Ve-1;for(;fe<=Te&&fe<=ke;){const Fe=P[fe],Ue=V[fe]=ye?Oi(V[fe]):Ts(V[fe]);if(Lo(Fe,Ue))w(Fe,Ue,H,null,Z,ue,ge,me,ye);else break;fe++}for(;fe<=Te&&fe<=ke;){const Fe=P[Te],Ue=V[ke]=ye?Oi(V[ke]):Ts(V[ke]);if(Lo(Fe,Ue))w(Fe,Ue,H,null,Z,ue,ge,me,ye);else break;Te--,ke--}if(fe>Te){if(fe<=ke){const Fe=ke+1,Ue=Fe<Ve?V[Fe].el:K;for(;fe<=ke;)w(null,V[fe]=ye?Oi(V[fe]):Ts(V[fe]),H,Ue,Z,ue,ge,me,ye),fe++}}else if(fe>ke)for(;fe<=Te;)re(P[fe],Z,ue,!0),fe++;else{const Fe=fe,Ue=fe,We=new Map;for(fe=Ue;fe<=ke;fe++){const _n=V[fe]=ye?Oi(V[fe]):Ts(V[fe]);_n.key!=null&&We.set(_n.key,fe)}let rt,nn=0;const Bt=ke-Ue+1;let On=!1,Jt=0;const Kr=new Array(Bt);for(fe=0;fe<Bt;fe++)Kr[fe]=0;for(fe=Fe;fe<=Te;fe++){const _n=P[fe];if(nn>=Bt){re(_n,Z,ue,!0);continue}let Pn;if(_n.key!=null)Pn=We.get(_n.key);else for(rt=Ue;rt<=ke;rt++)if(Kr[rt-Ue]===0&&Lo(_n,V[rt])){Pn=rt;break}Pn===void 0?re(_n,Z,ue,!0):(Kr[Pn-Ue]=fe+1,Pn>=Jt?Jt=Pn:On=!0,w(_n,V[Pn],H,null,Z,ue,ge,me,ye),nn++)}const Vs=On?hP(Kr):nl;for(rt=Vs.length-1,fe=Bt-1;fe>=0;fe--){const _n=Ue+fe,Pn=V[_n],vi=_n+1<Ve?V[_n+1].el:K;Kr[fe]===0?w(null,Pn,H,vi,Z,ue,ge,me,ye):On&&(rt<0||fe!==Vs[rt]?le(Pn,H,vi,2):rt--)}}},le=(P,V,H,K,Z=null)=>{const{el:ue,type:ge,transition:me,children:ye,shapeFlag:fe}=P;if(fe&6){le(P.component.subTree,V,H,K);return}if(fe&128){P.suspense.move(V,H,K);return}if(fe&64){ge.move(P,V,H,Pe);return}if(ge===mt){r(ue,V,H);for(let Te=0;Te<ye.length;Te++)le(ye[Te],V,H,K);r(P.anchor,V,H);return}if(ge===qd){U(P,V,H);return}if(K!==2&&fe&1&&me)if(K===0)me.beforeEnter(ue),r(ue,V,H),_r(()=>me.enter(ue),Z);else{const{leave:Te,delayLeave:ke,afterLeave:Fe}=me,Ue=()=>{P.ctx.isUnmounted?s(ue):r(ue,V,H)},We=()=>{Te(ue,()=>{Ue(),Fe&&Fe()})};ke?ke(ue,Ue,We):We()}else r(ue,V,H)},re=(P,V,H,K=!1,Z=!1)=>{const{type:ue,props:ge,ref:me,children:ye,dynamicChildren:fe,shapeFlag:Ve,patchFlag:Te,dirs:ke,cacheIndex:Fe}=P;if(Te===-2&&(Z=!1),me!=null&&(ti(),zu(me,null,H,P,!0),ni()),Fe!=null&&(V.renderCache[Fe]=void 0),Ve&256){V.ctx.deactivate(P);return}const Ue=Ve&1&&ke,We=!ol(P);let rt;if(We&&(rt=ge&&ge.onVnodeBeforeUnmount)&&Is(rt,V,P),Ve&6)Pt(P.component,H,K);else{if(Ve&128){P.suspense.unmount(H,K);return}Ue&&So(P,null,V,"beforeUnmount"),Ve&64?P.type.remove(P,V,H,Pe,K):fe&&!fe.hasOnce&&(ue!==mt||Te>0&&Te&64)?tn(fe,V,H,!1,!0):(ue===mt&&Te&384||!Z&&Ve&16)&&tn(ye,V,H),K&&Ne(P)}(We&&(rt=ge&&ge.onVnodeUnmounted)||Ue)&&_r(()=>{rt&&Is(rt,V,P),Ue&&So(P,null,V,"unmounted")},H)},Ne=P=>{const{type:V,el:H,anchor:K,transition:Z}=P;if(V===mt){ht(H,K);return}if(V===qd){q(P);return}const ue=()=>{s(H),Z&&!Z.persisted&&Z.afterLeave&&Z.afterLeave()};if(P.shapeFlag&1&&Z&&!Z.persisted){const{leave:ge,delayLeave:me}=Z,ye=()=>ge(H,ue);me?me(P.el,ue,ye):ye()}else ue()},ht=(P,V)=>{let H;for(;P!==V;)H=g(P),s(P),P=H;s(V)},Pt=(P,V,H)=>{const{bum:K,scope:Z,job:ue,subTree:ge,um:me,m:ye,a:fe,parent:Ve,slots:{__:Te}}=P;Gy(ye),Gy(fe),K&&Fd(K),Ve&&He(Te)&&Te.forEach(ke=>{Ve.renderCache[ke]=void 0}),Z.stop(),ue&&(ue.flags|=8,re(ge,P,V,H)),me&&_r(me,V),_r(()=>{P.isUnmounted=!0},V),V&&V.pendingBranch&&!V.isUnmounted&&P.asyncDep&&!P.asyncResolved&&P.suspenseId===V.pendingId&&(V.deps--,V.deps===0&&V.resolve())},tn=(P,V,H,K=!1,Z=!1,ue=0)=>{for(let ge=ue;ge<P.length;ge++)re(P[ge],V,H,K,Z)},Y=P=>{if(P.shapeFlag&6)return Y(P.component.subTree);if(P.shapeFlag&128)return P.suspense.next();const V=g(P.anchor||P.el),H=V&&V[Ew];return H?g(H):V};let xe=!1;const ve=(P,V,H)=>{P==null?V._vnode&&re(V._vnode,null,null,!0):w(V._vnode||null,P,V,null,null,null,H),V._vnode=P,xe||(xe=!0,My(),ww(),xe=!1)},Pe={p:w,um:re,m:le,r:Ne,mt:Ke,mc:b,pc:Ae,pbc:k,n:Y,o:n};let nt,vt;return e&&([nt,vt]=e(Pe)),{render:ve,hydrate:nt,createApp:nP(ve,nt)}}function up({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Po({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function dP(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function ag(n,e,t=!1){const r=n.children,s=e.children;if(He(r)&&He(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=Oi(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&ag(o,a)),a.type===Yh&&(a.el=o.el),a.type===lr&&!a.el&&(a.el=o.el)}}function hP(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function Ww(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Ww(e)}function Gy(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const fP=Symbol.for("v-scx"),pP=()=>ls(fP);function kt(n,e,t){return Qw(n,e,t)}function Qw(n,e,t=qt){const{immediate:r,deep:s,flush:i,once:o}=t,a=Nn({},t),l=e&&r||!e&&i!=="post";let c;if(dc){if(i==="sync"){const v=pP();c=v.__watcherHandles||(v.__watcherHandles=[])}else if(!l){const v=()=>{};return v.stop=os,v.resume=os,v.pause=os,v}}const h=Wn;a.call=(v,x,w)=>ds(v,h,x,w);let f=!1;i==="post"?a.scheduler=v=>{_r(v,h&&h.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(v,x)=>{x?v():ng(v)}),a.augmentJob=v=>{e&&(v.flags|=4),f&&(v.flags|=2,h&&(v.id=h.uid,v.i=h))};const g=SS(n,e,a);return dc&&(c?c.push(g):l&&g()),g}function mP(n,e,t){const r=this.proxy,s=pn(n)?n.includes(".")?Jw(r,n):()=>r[n]:n.bind(r,r);let i;et(e)?i=e:(i=e.handler,t=e);const o=Uc(this),a=Qw(s,i.bind(r),t);return o(),a}function Jw(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const gP=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Xr(e)}Modifiers`]||n[`${uo(e)}Modifiers`];function vP(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||qt;let s=t;const i=e.startsWith("update:"),o=i&&gP(r,e.slice(7));o&&(o.trim&&(s=t.map(h=>pn(h)?h.trim():h)),o.number&&(s=t.map(oh)));let a,l=r[a=np(e)]||r[a=np(Xr(e))];!l&&i&&(l=r[a=np(uo(e))]),l&&ds(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,ds(c,n,6,s)}}function Yw(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!et(n)){const l=c=>{const h=Yw(c,e,!0);h&&(a=!0,Nn(o,h))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(zt(n)&&r.set(n,null),null):(He(i)?i.forEach(l=>o[l]=null):Nn(o,i),zt(n)&&r.set(n,o),o)}function Jh(n,e){return!n||!jh(e)?!1:(e=e.slice(2).replace(/Once$/,""),Mt(n,e[0].toLowerCase()+e.slice(1))||Mt(n,uo(e))||Mt(n,e))}function cp(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:h,props:f,data:g,setupState:v,ctx:x,inheritAttrs:w}=n,I=ch(n);let $,L;try{if(t.shapeFlag&4){const q=s||r,te=q;$=Ts(c.call(te,q,h,f,v,g,x)),L=a}else{const q=e;$=Ts(q.length>1?q(f,{attrs:a,slots:o,emit:l}):q(f,null)),L=e.props?a:yP(a)}}catch(q){Ku.length=0,Gh(q,n,1),$=Be(lr)}let U=$;if(L&&w!==!1){const q=Object.keys(L),{shapeFlag:te}=U;q.length&&te&7&&(i&&q.some(Hm)&&(L=_P(L,i)),U=Zi(U,L,!1,!0))}return t.dirs&&(U=Zi(U,null,!1,!0),U.dirs=U.dirs?U.dirs.concat(t.dirs):t.dirs),t.transition&&lc(U,t.transition),$=U,ch(I),$}const yP=n=>{let e;for(const t in n)(t==="class"||t==="style"||jh(t))&&((e||(e={}))[t]=n[t]);return e},_P=(n,e)=>{const t={};for(const r in n)(!Hm(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function bP(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?Wy(r,o,c):!!o;if(l&8){const h=e.dynamicProps;for(let f=0;f<h.length;f++){const g=h[f];if(o[g]!==r[g]&&!Jh(c,g))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Wy(r,o,c):!0:!!o;return!1}function Wy(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!Jh(t,i))return!0}return!1}function wP({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const Xw=n=>n.__isSuspense;function xP(n,e){e&&e.pendingBranch?He(n)?e.effects.push(...n):e.effects.push(n):CS(n)}const mt=Symbol.for("v-fgt"),Yh=Symbol.for("v-txt"),lr=Symbol.for("v-cmt"),qd=Symbol.for("v-stc"),Ku=[];let qr=null;function C(n=!1){Ku.push(qr=n?null:[])}function IP(){Ku.pop(),qr=Ku[Ku.length-1]||null}let uc=1;function Qy(n,e=!1){uc+=n,n<0&&qr&&e&&(qr.hasOnce=!0)}function Zw(n){return n.dynamicChildren=uc>0?qr||nl:null,IP(),uc>0&&qr&&qr.push(n),n}function D(n,e,t,r,s,i){return Zw(d(n,e,t,r,s,i,!0))}function Ys(n,e,t,r,s){return Zw(Be(n,e,t,r,s,!0))}function cc(n){return n?n.__v_isVNode===!0:!1}function Lo(n,e){return n.type===e.type&&n.key===e.key}const ex=({key:n})=>n??null,zd=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?pn(n)||ur(n)||et(n)?{i:Bn,r:n,k:e,f:!!t}:n:null);function d(n,e=null,t=null,r=0,s=null,i=n===mt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&ex(e),ref:e&&zd(e),scopeId:Iw,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Bn};return a?(lg(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=pn(t)?8:16),uc>0&&!o&&qr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&qr.push(l),l}const Be=EP;function EP(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===KS)&&(n=lr),cc(n)){const a=Zi(n,e,!0);return t&&lg(a,t),uc>0&&!i&&qr&&(a.shapeFlag&6?qr[qr.indexOf(n)]=a:qr.push(a)),a.patchFlag=-2,a}if(MP(n)&&(n=n.__vccOpts),e){e=TP(e);let{class:a,style:l}=e;a&&!pn(a)&&(e.class=cn(a)),zt(l)&&(tg(l)&&!He(l)&&(l=Nn({},l)),e.style=Ur(l))}const o=pn(n)?1:Xw(n)?128:Tw(n)?64:zt(n)?4:et(n)?2:0;return d(n,e,t,r,s,o,i,!0)}function TP(n){return n?tg(n)||Bw(n)?Nn({},n):n:null}function Zi(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?AP(s||{},e):s,h={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&ex(c),ref:e&&e.ref?t&&i?He(i)?i.concat(zd(e)):[i,zd(e)]:zd(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==mt?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Zi(n.ssContent),ssFallback:n.ssFallback&&Zi(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&lc(h,l.clone(h)),h}function ut(n=" ",e=0){return Be(Yh,null,n,e)}function or(n,e){const t=Be(qd,null,n);return t.staticCount=e,t}function ie(n="",e=!1){return e?(C(),Ys(lr,null,n)):Be(lr,null,n)}function Ts(n){return n==null||typeof n=="boolean"?Be(lr):He(n)?Be(mt,null,n.slice()):cc(n)?Oi(n):Be(Yh,null,String(n))}function Oi(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Zi(n)}function lg(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(He(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),lg(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!Bw(e)?e._ctx=Bn:s===3&&Bn&&(Bn.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else et(e)?(e={default:e,_ctx:Bn},t=32):(e=String(e),r&64?(t=16,e=[ut(e)]):t=8);n.children=e,n.shapeFlag|=t}function AP(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=cn([e.class,r.class]));else if(s==="style")e.style=Ur([e.style,r.style]);else if(jh(s)){const i=e[s],o=r[s];o&&i!==o&&!(He(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function Is(n,e,t,r=null){ds(n,e,7,[t,r])}const SP=Fw();let PP=0;function RP(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||SP,i={uid:PP++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new eS(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:zw(r,s),emitsOptions:Yw(r,s),emit:null,emitted:null,propsDefaults:qt,inheritAttrs:r.inheritAttrs,ctx:qt,data:qt,props:qt,attrs:qt,slots:qt,refs:qt,setupState:qt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=vP.bind(null,i),n.ce&&n.ce(i),i}let Wn=null;const CP=()=>Wn||Bn;let hh,em;{const n=zh(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};hh=e("__VUE_INSTANCE_SETTERS__",t=>Wn=t),em=e("__VUE_SSR_SETTERS__",t=>dc=t)}const Uc=n=>{const e=Wn;return hh(n),n.scope.on(),()=>{n.scope.off(),hh(e)}},Jy=()=>{Wn&&Wn.scope.off(),hh(null)};function tx(n){return n.vnode.shapeFlag&4}let dc=!1;function kP(n,e=!1,t=!1){e&&em(e);const{props:r,children:s}=n.vnode,i=tx(n);rP(n,r,i,e),aP(n,s,t||e);const o=i?DP(n,e):void 0;return e&&em(!1),o}function DP(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,QS);const{setup:r}=t;if(r){ti();const s=n.setupContext=r.length>1?OP(n):null,i=Uc(n),o=Fc(r,n,0,[n.props,s]),a=Qb(o);if(ni(),i(),(a||n.sp)&&!ol(n)&&Ow(n),a){if(o.then(Jy,Jy),e)return o.then(l=>{Yy(n,l,e)}).catch(l=>{Gh(l,n,0)});n.asyncDep=o}else Yy(n,o,e)}else nx(n,e)}function Yy(n,e,t){et(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:zt(e)&&(n.setupState=yw(e)),nx(n,t)}let Xy;function nx(n,e,t){const r=n.type;if(!n.render){if(!e&&Xy&&!r.render){const s=r.template||sg(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=Nn(Nn({isCustomElement:i,delimiters:a},o),l);r.render=Xy(s,c)}}n.render=r.render||os}{const s=Uc(n);ti();try{JS(n)}finally{ni(),s()}}}const NP={get(n,e){return ar(n,"get",""),n[e]}};function OP(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,NP),slots:n.slots,emit:n.emit,expose:e}}function Xh(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(yw(bS(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in Hu)return Hu[t](n)},has(e,t){return t in e||t in Hu}})):n.proxy}function VP(n,e=!0){return et(n)?n.displayName||n.name:n.name||e&&n.__name}function MP(n){return et(n)&&"__vccOpts"in n}const qe=(n,e)=>TS(n,e,dc);function ug(n,e,t){const r=arguments.length;return r===2?zt(e)&&!He(e)?cc(e)?Be(n,null,[e]):Be(n,e):Be(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&cc(t)&&(t=[t]),Be(n,e,t))}const LP="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let tm;const Zy=typeof window<"u"&&window.trustedTypes;if(Zy)try{tm=Zy.createPolicy("vue",{createHTML:n=>n})}catch{}const rx=tm?n=>tm.createHTML(n):n=>n,$P="http://www.w3.org/2000/svg",FP="http://www.w3.org/1998/Math/MathML",js=typeof document<"u"?document:null,e0=js&&js.createElement("template"),UP={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?js.createElementNS($P,n):e==="mathml"?js.createElementNS(FP,n):t?js.createElement(n,{is:t}):js.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>js.createTextNode(n),createComment:n=>js.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>js.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{e0.innerHTML=rx(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=e0.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Si="transition",wu="animation",hc=Symbol("_vtc"),sx={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},jP=Nn({},Pw,sx),BP=n=>(n.displayName="Transition",n.props=jP,n),dp=BP((n,{slots:e})=>ug(OS,qP(n),e)),Ro=(n,e=[])=>{He(n)?n.forEach(t=>t(...e)):n&&n(...e)},t0=n=>n?He(n)?n.some(e=>e.length>1):n.length>1:!1;function qP(n){const e={};for(const M in n)M in sx||(e[M]=n[M]);if(n.css===!1)return e;const{name:t="v",type:r,duration:s,enterFromClass:i=`${t}-enter-from`,enterActiveClass:o=`${t}-enter-active`,enterToClass:a=`${t}-enter-to`,appearFromClass:l=i,appearActiveClass:c=o,appearToClass:h=a,leaveFromClass:f=`${t}-leave-from`,leaveActiveClass:g=`${t}-leave-active`,leaveToClass:v=`${t}-leave-to`}=n,x=zP(s),w=x&&x[0],I=x&&x[1],{onBeforeEnter:$,onEnter:L,onEnterCancelled:U,onLeave:q,onLeaveCancelled:te,onBeforeAppear:X=$,onAppear:A=L,onAppearCancelled:b=U}=e,T=(M,R,Ke,ct)=>{M._enterCancelled=ct,Co(M,R?h:a),Co(M,R?c:o),Ke&&Ke()},k=(M,R)=>{M._isLeaving=!1,Co(M,f),Co(M,v),Co(M,g),R&&R()},F=M=>(R,Ke)=>{const ct=M?A:L,dt=()=>T(R,M,Ke);Ro(ct,[R,dt]),n0(()=>{Co(R,M?l:i),Fs(R,M?h:a),t0(ct)||r0(R,r,w,dt)})};return Nn(e,{onBeforeEnter(M){Ro($,[M]),Fs(M,i),Fs(M,o)},onBeforeAppear(M){Ro(X,[M]),Fs(M,l),Fs(M,c)},onEnter:F(!1),onAppear:F(!0),onLeave(M,R){M._isLeaving=!0;const Ke=()=>k(M,R);Fs(M,f),M._enterCancelled?(Fs(M,g),o0()):(o0(),Fs(M,g)),n0(()=>{M._isLeaving&&(Co(M,f),Fs(M,v),t0(q)||r0(M,r,I,Ke))}),Ro(q,[M,Ke])},onEnterCancelled(M){T(M,!1,void 0,!0),Ro(U,[M])},onAppearCancelled(M){T(M,!0,void 0,!0),Ro(b,[M])},onLeaveCancelled(M){k(M),Ro(te,[M])}})}function zP(n){if(n==null)return null;if(zt(n))return[hp(n.enter),hp(n.leave)];{const e=hp(n);return[e,e]}}function hp(n){return K1(n)}function Fs(n,e){e.split(/\s+/).forEach(t=>t&&n.classList.add(t)),(n[hc]||(n[hc]=new Set)).add(e)}function Co(n,e){e.split(/\s+/).forEach(r=>r&&n.classList.remove(r));const t=n[hc];t&&(t.delete(e),t.size||(n[hc]=void 0))}function n0(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let HP=0;function r0(n,e,t,r){const s=n._endId=++HP,i=()=>{s===n._endId&&r()};if(t!=null)return setTimeout(i,t);const{type:o,timeout:a,propCount:l}=KP(n,e);if(!o)return r();const c=o+"end";let h=0;const f=()=>{n.removeEventListener(c,g),i()},g=v=>{v.target===n&&++h>=l&&f()};setTimeout(()=>{h<l&&f()},a+1),n.addEventListener(c,g)}function KP(n,e){const t=window.getComputedStyle(n),r=x=>(t[x]||"").split(", "),s=r(`${Si}Delay`),i=r(`${Si}Duration`),o=s0(s,i),a=r(`${wu}Delay`),l=r(`${wu}Duration`),c=s0(a,l);let h=null,f=0,g=0;e===Si?o>0&&(h=Si,f=o,g=i.length):e===wu?c>0&&(h=wu,f=c,g=l.length):(f=Math.max(o,c),h=f>0?o>c?Si:wu:null,g=h?h===Si?i.length:l.length:0);const v=h===Si&&/\b(transform|all)(,|$)/.test(r(`${Si}Property`).toString());return{type:h,timeout:f,propCount:g,hasTransform:v}}function s0(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max(...e.map((t,r)=>i0(t)+i0(n[r])))}function i0(n){return n==="auto"?0:Number(n.slice(0,-1).replace(",","."))*1e3}function o0(){return document.body.offsetHeight}function GP(n,e,t){const r=n[hc];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const fh=Symbol("_vod"),ix=Symbol("_vsh"),fp={beforeMount(n,{value:e},{transition:t}){n[fh]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):xu(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),xu(n,!0),r.enter(n)):r.leave(n,()=>{xu(n,!1)}):xu(n,e))},beforeUnmount(n,{value:e}){xu(n,e)}};function xu(n,e){n.style.display=e?n[fh]:"none",n[ix]=!e}const WP=Symbol(""),QP=/(^|;)\s*display\s*:/;function JP(n,e,t){const r=n.style,s=pn(t);let i=!1;if(t&&!s){if(e)if(pn(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&Hd(r,a,"")}else for(const o in e)t[o]==null&&Hd(r,o,"");for(const o in t)o==="display"&&(i=!0),Hd(r,o,t[o])}else if(s){if(e!==t){const o=r[WP];o&&(t+=";"+o),r.cssText=t,i=QP.test(t)}}else e&&n.removeAttribute("style");fh in n&&(n[fh]=i?r.display:"",n[ix]&&(r.display="none"))}const a0=/\s*!important$/;function Hd(n,e,t){if(He(t))t.forEach(r=>Hd(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=YP(n,e);a0.test(t)?n.setProperty(uo(r),t.replace(a0,""),"important"):n[r]=t}}const l0=["Webkit","Moz","ms"],pp={};function YP(n,e){const t=pp[e];if(t)return t;let r=Xr(e);if(r!=="filter"&&r in n)return pp[e]=r;r=qh(r);for(let s=0;s<l0.length;s++){const i=l0[s]+r;if(i in n)return pp[e]=i}return e}const u0="http://www.w3.org/1999/xlink";function c0(n,e,t,r,s,i=X1(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(u0,e.slice(6,e.length)):n.setAttributeNS(u0,e,t):t==null||i&&!Xb(t)?n.removeAttribute(e):n.setAttribute(e,i?"":cs(t)?String(t):t)}function d0(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?rx(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=Xb(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function Mi(n,e,t,r){n.addEventListener(e,t,r)}function XP(n,e,t,r){n.removeEventListener(e,t,r)}const h0=Symbol("_vei");function ZP(n,e,t,r,s=null){const i=n[h0]||(n[h0]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=eR(e);if(r){const c=i[e]=rR(r,s);Mi(n,a,c,l)}else o&&(XP(n,a,o,l),i[e]=void 0)}}const f0=/(?:Once|Passive|Capture)$/;function eR(n){let e;if(f0.test(n)){e={};let r;for(;r=n.match(f0);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):uo(n.slice(2)),e]}let mp=0;const tR=Promise.resolve(),nR=()=>mp||(tR.then(()=>mp=0),mp=Date.now());function rR(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;ds(sR(r,t.value),e,5,[r])};return t.value=n,t.attached=nR(),t}function sR(n,e){if(He(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const p0=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,iR=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?GP(n,r,o):e==="style"?JP(n,t,r):jh(e)?Hm(e)||ZP(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):oR(n,e,r,o))?(d0(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&c0(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!pn(r))?d0(n,Xr(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),c0(n,e,r,o))};function oR(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&p0(e)&&et(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return p0(e)&&pn(t)?!1:e in n}const ml=n=>{const e=n.props["onUpdate:modelValue"]||!1;return He(e)?t=>Fd(e,t):e};function aR(n){n.target.composing=!0}function m0(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Xs=Symbol("_assign"),Lt={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[Xs]=ml(s);const i=r||s.props&&s.props.type==="number";Mi(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=oh(a)),n[Xs](a)}),t&&Mi(n,"change",()=>{n.value=n.value.trim()}),e||(Mi(n,"compositionstart",aR),Mi(n,"compositionend",m0),Mi(n,"change",m0))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[Xs]=ml(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?oh(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},Hi={deep:!0,created(n,e,t){n[Xs]=ml(t),Mi(n,"change",()=>{const r=n._modelValue,s=fc(n),i=n.checked,o=n[Xs];if(He(r)){const a=Wm(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(Vl(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(ox(n,i))})},mounted:g0,beforeUpdate(n,e,t){n[Xs]=ml(t),g0(n,e,t)}};function g0(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(He(e))s=Wm(e,r.props.value)>-1;else if(Vl(e))s=e.has(r.props.value);else{if(e===t)return;s=$c(e,ox(n,!0))}n.checked!==s&&(n.checked=s)}const lR={deep:!0,created(n,{value:e,modifiers:{number:t}},r){const s=Vl(e);Mi(n,"change",()=>{const i=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>t?oh(fc(o)):fc(o));n[Xs](n.multiple?s?new Set(i):i:i[0]),n._assigning=!0,rn(()=>{n._assigning=!1})}),n[Xs]=ml(r)},mounted(n,{value:e}){v0(n,e)},beforeUpdate(n,e,t){n[Xs]=ml(t)},updated(n,{value:e}){n._assigning||v0(n,e)}};function v0(n,e){const t=n.multiple,r=He(e);if(!(t&&!r&&!Vl(e))){for(let s=0,i=n.options.length;s<i;s++){const o=n.options[s],a=fc(o);if(t)if(r){const l=typeof a;l==="string"||l==="number"?o.selected=e.some(c=>String(c)===String(a)):o.selected=Wm(e,a)>-1}else o.selected=e.has(a);else if($c(fc(o),e)){n.selectedIndex!==s&&(n.selectedIndex=s);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function fc(n){return"_value"in n?n._value:n.value}function ox(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const uR=["ctrl","shift","alt","meta"],cR={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>uR.some(t=>n[`${t}Key`]&&!e.includes(t))},ft=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=cR[e[o]];if(a&&a(s,e))return}return n(s,...i)})},dR={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},sr=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=uo(s.key);if(e.some(o=>o===i||dR[o]===i))return n(s)})},hR=Nn({patchProp:iR},UP);let y0;function fR(){return y0||(y0=uP(hR))}const pR=(...n)=>{const e=fR().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=gR(r);if(!s)return;const i=e._component;!et(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,mR(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function mR(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function gR(n){return pn(n)?document.querySelector(n):n}const vR="/icons/icon-48x48.png";/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const Qa=typeof document<"u";function ax(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function yR(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&ax(n.default)}const Vt=Object.assign;function gp(n,e){const t={};for(const r in e){const s=e[r];t[r]=hs(s)?s.map(n):n(s)}return t}const Gu=()=>{},hs=Array.isArray,lx=/#/g,_R=/&/g,bR=/\//g,wR=/=/g,xR=/\?/g,ux=/\+/g,IR=/%5B/g,ER=/%5D/g,cx=/%5E/g,TR=/%60/g,dx=/%7B/g,AR=/%7C/g,hx=/%7D/g,SR=/%20/g;function cg(n){return encodeURI(""+n).replace(AR,"|").replace(IR,"[").replace(ER,"]")}function PR(n){return cg(n).replace(dx,"{").replace(hx,"}").replace(cx,"^")}function nm(n){return cg(n).replace(ux,"%2B").replace(SR,"+").replace(lx,"%23").replace(_R,"%26").replace(TR,"`").replace(dx,"{").replace(hx,"}").replace(cx,"^")}function RR(n){return nm(n).replace(wR,"%3D")}function CR(n){return cg(n).replace(lx,"%23").replace(xR,"%3F")}function kR(n){return n==null?"":CR(n).replace(bR,"%2F")}function pc(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const DR=/\/$/,NR=n=>n.replace(DR,"");function vp(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=LR(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:pc(o)}}function OR(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function _0(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function VR(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&gl(e.matched[r],t.matched[s])&&fx(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function gl(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function fx(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!MR(n[t],e[t]))return!1;return!0}function MR(n,e){return hs(n)?b0(n,e):hs(e)?b0(e,n):n===e}function b0(n,e){return hs(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function LR(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const Pi={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var mc;(function(n){n.pop="pop",n.push="push"})(mc||(mc={}));var Wu;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Wu||(Wu={}));function $R(n){if(!n)if(Qa){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),NR(n)}const FR=/^[^#]+#/;function UR(n,e){return n.replace(FR,"#")+e}function jR(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const Zh=()=>({left:window.scrollX,top:window.scrollY});function BR(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=jR(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function w0(n,e){return(history.state?history.state.position-e:-1)+n}const rm=new Map;function qR(n,e){rm.set(n,e)}function zR(n){const e=rm.get(n);return rm.delete(n),e}let HR=()=>location.protocol+"//"+location.host;function px(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),_0(l,"")}return _0(t,n)+r+s}function KR(n,e,t,r){let s=[],i=[],o=null;const a=({state:g})=>{const v=px(n,location),x=t.value,w=e.value;let I=0;if(g){if(t.value=v,e.value=g,o&&o===x){o=null;return}I=w?g.position-w.position:0}else r(v);s.forEach($=>{$(t.value,x,{delta:I,type:mc.pop,direction:I?I>0?Wu.forward:Wu.back:Wu.unknown})})};function l(){o=t.value}function c(g){s.push(g);const v=()=>{const x=s.indexOf(g);x>-1&&s.splice(x,1)};return i.push(v),v}function h(){const{history:g}=window;g.state&&g.replaceState(Vt({},g.state,{scroll:Zh()}),"")}function f(){for(const g of i)g();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",h)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",h,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function x0(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?Zh():null}}function GR(n){const{history:e,location:t}=window,r={value:px(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,h){const f=n.indexOf("#"),g=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:HR()+n+l;try{e[h?"replaceState":"pushState"](c,"",g),s.value=c}catch(v){console.error(v),t[h?"replace":"assign"](g)}}function o(l,c){const h=Vt({},e.state,x0(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,h,!0),r.value=l}function a(l,c){const h=Vt({},s.value,e.state,{forward:l,scroll:Zh()});i(h.current,h,!0);const f=Vt({},x0(r.value,l,null),{position:h.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function WR(n){n=$R(n);const e=GR(n),t=KR(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=Vt({location:"",base:n,go:r,createHref:UR.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function QR(n){return typeof n=="string"||n&&typeof n=="object"}function mx(n){return typeof n=="string"||typeof n=="symbol"}const gx=Symbol("");var I0;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(I0||(I0={}));function vl(n,e){return Vt(new Error,{type:n,[gx]:!0},e)}function Us(n,e){return n instanceof Error&&gx in n&&(e==null||!!(n.type&e))}const E0="[^/]+?",JR={sensitive:!1,strict:!1,start:!0,end:!0},YR=/[.+*?^${}()[\]/\\]/g;function XR(n,e){const t=Vt({},JR,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const h=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const g=c[f];let v=40+(t.sensitive?.25:0);if(g.type===0)f||(s+="/"),s+=g.value.replace(YR,"\\$&"),v+=40;else if(g.type===1){const{value:x,repeatable:w,optional:I,regexp:$}=g;i.push({name:x,repeatable:w,optional:I});const L=$||E0;if(L!==E0){v+=10;try{new RegExp(`(${L})`)}catch(q){throw new Error(`Invalid custom RegExp for param "${x}" (${L}): `+q.message)}}let U=w?`((?:${L})(?:/(?:${L}))*)`:`(${L})`;f||(U=I&&c.length<2?`(?:/${U})`:"/"+U),I&&(U+="?"),s+=U,v+=20,I&&(v+=-8),w&&(v+=-20),L===".*"&&(v+=-50)}h.push(v)}r.push(h)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const h=c.match(o),f={};if(!h)return null;for(let g=1;g<h.length;g++){const v=h[g]||"",x=i[g-1];f[x.name]=v&&x.repeatable?v.split("/"):v}return f}function l(c){let h="",f=!1;for(const g of n){(!f||!h.endsWith("/"))&&(h+="/"),f=!1;for(const v of g)if(v.type===0)h+=v.value;else if(v.type===1){const{value:x,repeatable:w,optional:I}=v,$=x in c?c[x]:"";if(hs($)&&!w)throw new Error(`Provided param "${x}" is an array but it is not repeatable (* or + modifiers)`);const L=hs($)?$.join("/"):$;if(!L)if(I)g.length<2&&(h.endsWith("/")?h=h.slice(0,-1):f=!0);else throw new Error(`Missing required param "${x}"`);h+=L}}return h||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function ZR(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function vx(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=ZR(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(T0(r))return 1;if(T0(s))return-1}return s.length-r.length}function T0(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const eC={type:0,value:""},tC=/[a-zA-Z0-9_]/;function nC(n){if(!n)return[[]];if(n==="/")return[[eC]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(v){throw new Error(`ERR (${t})/"${c}": ${v}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",h="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:h,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function g(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):g();break;case 4:g(),t=r;break;case 1:l==="("?t=2:tC.test(l)?g():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?h[h.length-1]=="\\"?h=h.slice(0,-1)+l:t=3:h+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,h="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function rC(n,e,t){const r=XR(nC(n.path),t),s=Vt(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function sC(n,e){const t=[],r=new Map;e=R0({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,g,v){const x=!v,w=S0(f);w.aliasOf=v&&v.record;const I=R0(e,f),$=[w];if("alias"in f){const q=typeof f.alias=="string"?[f.alias]:f.alias;for(const te of q)$.push(S0(Vt({},w,{components:v?v.record.components:w.components,path:te,aliasOf:v?v.record:w})))}let L,U;for(const q of $){const{path:te}=q;if(g&&te[0]!=="/"){const X=g.record.path,A=X[X.length-1]==="/"?"":"/";q.path=g.record.path+(te&&A+te)}if(L=rC(q,g,I),v?v.alias.push(L):(U=U||L,U!==L&&U.alias.push(L),x&&f.name&&!P0(L)&&o(f.name)),yx(L)&&l(L),w.children){const X=w.children;for(let A=0;A<X.length;A++)i(X[A],L,v&&v.children[A])}v=v||L}return U?()=>{o(U)}:Gu}function o(f){if(mx(f)){const g=r.get(f);g&&(r.delete(f),t.splice(t.indexOf(g),1),g.children.forEach(o),g.alias.forEach(o))}else{const g=t.indexOf(f);g>-1&&(t.splice(g,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const g=aC(f,t);t.splice(g,0,f),f.record.name&&!P0(f)&&r.set(f.record.name,f)}function c(f,g){let v,x={},w,I;if("name"in f&&f.name){if(v=r.get(f.name),!v)throw vl(1,{location:f});I=v.record.name,x=Vt(A0(g.params,v.keys.filter(U=>!U.optional).concat(v.parent?v.parent.keys.filter(U=>U.optional):[]).map(U=>U.name)),f.params&&A0(f.params,v.keys.map(U=>U.name))),w=v.stringify(x)}else if(f.path!=null)w=f.path,v=t.find(U=>U.re.test(w)),v&&(x=v.parse(w),I=v.record.name);else{if(v=g.name?r.get(g.name):t.find(U=>U.re.test(g.path)),!v)throw vl(1,{location:f,currentLocation:g});I=v.record.name,x=Vt({},g.params,f.params),w=v.stringify(x)}const $=[];let L=v;for(;L;)$.unshift(L.record),L=L.parent;return{name:I,path:w,params:x,matched:$,meta:oC($)}}n.forEach(f=>i(f));function h(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:h,getRoutes:a,getRecordMatcher:s}}function A0(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function S0(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:iC(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function iC(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function P0(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function oC(n){return n.reduce((e,t)=>Vt(e,t.meta),{})}function R0(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function aC(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;vx(n,e[i])<0?r=i:t=i+1}const s=lC(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function lC(n){let e=n;for(;e=e.parent;)if(yx(e)&&vx(n,e)===0)return e}function yx({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function uC(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(ux," "),o=i.indexOf("="),a=pc(o<0?i:i.slice(0,o)),l=o<0?null:pc(i.slice(o+1));if(a in e){let c=e[a];hs(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function C0(n){let e="";for(let t in n){const r=n[t];if(t=RR(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(hs(r)?r.map(i=>i&&nm(i)):[r&&nm(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function cC(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=hs(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const dC=Symbol(""),k0=Symbol(""),ef=Symbol(""),dg=Symbol(""),sm=Symbol("");function Iu(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function Vi(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=g=>{g===!1?l(vl(4,{from:t,to:e})):g instanceof Error?l(g):QR(g)?l(vl(2,{from:e,to:g})):(o&&r.enterCallbacks[s]===o&&typeof g=="function"&&o.push(g),a())},h=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(h);n.length<3&&(f=f.then(c)),f.catch(g=>l(g))})}function yp(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(ax(l)){const h=(l.__vccOpts||l)[e];h&&i.push(Vi(h,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(h=>{if(!h)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=yR(h)?h.default:h;o.mods[a]=h,o.components[a]=f;const v=(f.__vccOpts||f)[e];return v&&Vi(v,t,r,o,a,s)()}))}}return i}function D0(n){const e=ls(ef),t=ls(dg),r=qe(()=>{const l=Br(n.to);return e.resolve(l)}),s=qe(()=>{const{matched:l}=r.value,{length:c}=l,h=l[c-1],f=t.matched;if(!h||!f.length)return-1;const g=f.findIndex(gl.bind(null,h));if(g>-1)return g;const v=N0(l[c-2]);return c>1&&N0(h)===v&&f[f.length-1].path!==v?f.findIndex(gl.bind(null,l[c-2])):g}),i=qe(()=>s.value>-1&&gC(t.params,r.value.params)),o=qe(()=>s.value>-1&&s.value===t.matched.length-1&&fx(t.params,r.value.params));function a(l={}){if(mC(l)){const c=e[Br(n.replace)?"replace":"push"](Br(n.to)).catch(Gu);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:qe(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function hC(n){return n.length===1?n[0]:n}const fC=Nw({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:D0,setup(n,{slots:e}){const t=Kh(D0(n)),{options:r}=ls(ef),s=qe(()=>({[O0(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[O0(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&hC(e.default(t));return n.custom?i:ug("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),pC=fC;function mC(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function gC(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!hs(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function N0(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const O0=(n,e,t)=>n??e??t,vC=Nw({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=ls(sm),s=qe(()=>n.route||r.value),i=ls(k0,0),o=qe(()=>{let c=Br(i);const{matched:h}=s.value;let f;for(;(f=h[c])&&!f.components;)c++;return c}),a=qe(()=>s.value.matched[o.value]);Bd(k0,qe(()=>o.value+1)),Bd(dC,a),Bd(sm,s);const l=S();return kt(()=>[l.value,a.value,n.name],([c,h,f],[g,v,x])=>{h&&(h.instances[f]=c,v&&v!==h&&c&&c===g&&(h.leaveGuards.size||(h.leaveGuards=v.leaveGuards),h.updateGuards.size||(h.updateGuards=v.updateGuards))),c&&h&&(!v||!gl(h,v)||!g)&&(h.enterCallbacks[f]||[]).forEach(w=>w(c))},{flush:"post"}),()=>{const c=s.value,h=n.name,f=a.value,g=f&&f.components[h];if(!g)return V0(t.default,{Component:g,route:c});const v=f.props[h],x=v?v===!0?c.params:typeof v=="function"?v(c):v:null,I=ug(g,Vt({},x,e,{onVnodeUnmounted:$=>{$.component.isUnmounted&&(f.instances[h]=null)},ref:l}));return V0(t.default,{Component:I,route:c})||I}}});function V0(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const yC=vC;function _C(n){const e=sC(n.routes,n),t=n.parseQuery||uC,r=n.stringifyQuery||C0,s=n.history,i=Iu(),o=Iu(),a=Iu(),l=wS(Pi);let c=Pi;Qa&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=gp.bind(null,Y=>""+Y),f=gp.bind(null,kR),g=gp.bind(null,pc);function v(Y,xe){let ve,Pe;return mx(Y)?(ve=e.getRecordMatcher(Y),Pe=xe):Pe=Y,e.addRoute(Pe,ve)}function x(Y){const xe=e.getRecordMatcher(Y);xe&&e.removeRoute(xe)}function w(){return e.getRoutes().map(Y=>Y.record)}function I(Y){return!!e.getRecordMatcher(Y)}function $(Y,xe){if(xe=Vt({},xe||l.value),typeof Y=="string"){const V=vp(t,Y,xe.path),H=e.resolve({path:V.path},xe),K=s.createHref(V.fullPath);return Vt(V,H,{params:g(H.params),hash:pc(V.hash),redirectedFrom:void 0,href:K})}let ve;if(Y.path!=null)ve=Vt({},Y,{path:vp(t,Y.path,xe.path).path});else{const V=Vt({},Y.params);for(const H in V)V[H]==null&&delete V[H];ve=Vt({},Y,{params:f(V)}),xe.params=f(xe.params)}const Pe=e.resolve(ve,xe),nt=Y.hash||"";Pe.params=h(g(Pe.params));const vt=OR(r,Vt({},Y,{hash:PR(nt),path:Pe.path})),P=s.createHref(vt);return Vt({fullPath:vt,hash:nt,query:r===C0?cC(Y.query):Y.query||{}},Pe,{redirectedFrom:void 0,href:P})}function L(Y){return typeof Y=="string"?vp(t,Y,l.value.path):Vt({},Y)}function U(Y,xe){if(c!==Y)return vl(8,{from:xe,to:Y})}function q(Y){return A(Y)}function te(Y){return q(Vt(L(Y),{replace:!0}))}function X(Y){const xe=Y.matched[Y.matched.length-1];if(xe&&xe.redirect){const{redirect:ve}=xe;let Pe=typeof ve=="function"?ve(Y):ve;return typeof Pe=="string"&&(Pe=Pe.includes("?")||Pe.includes("#")?Pe=L(Pe):{path:Pe},Pe.params={}),Vt({query:Y.query,hash:Y.hash,params:Pe.path!=null?{}:Y.params},Pe)}}function A(Y,xe){const ve=c=$(Y),Pe=l.value,nt=Y.state,vt=Y.force,P=Y.replace===!0,V=X(ve);if(V)return A(Vt(L(V),{state:typeof V=="object"?Vt({},nt,V.state):nt,force:vt,replace:P}),xe||ve);const H=ve;H.redirectedFrom=xe;let K;return!vt&&VR(r,Pe,ve)&&(K=vl(16,{to:H,from:Pe}),le(Pe,Pe,!0,!1)),(K?Promise.resolve(K):k(H,Pe)).catch(Z=>Us(Z)?Us(Z,2)?Z:Qe(Z):Ae(Z,H,Pe)).then(Z=>{if(Z){if(Us(Z,2))return A(Vt({replace:P},L(Z.to),{state:typeof Z.to=="object"?Vt({},nt,Z.to.state):nt,force:vt}),xe||H)}else Z=M(H,Pe,!0,P,nt);return F(H,Pe,Z),Z})}function b(Y,xe){const ve=U(Y,xe);return ve?Promise.reject(ve):Promise.resolve()}function T(Y){const xe=ht.values().next().value;return xe&&typeof xe.runWithContext=="function"?xe.runWithContext(Y):Y()}function k(Y,xe){let ve;const[Pe,nt,vt]=bC(Y,xe);ve=yp(Pe.reverse(),"beforeRouteLeave",Y,xe);for(const V of Pe)V.leaveGuards.forEach(H=>{ve.push(Vi(H,Y,xe))});const P=b.bind(null,Y,xe);return ve.push(P),tn(ve).then(()=>{ve=[];for(const V of i.list())ve.push(Vi(V,Y,xe));return ve.push(P),tn(ve)}).then(()=>{ve=yp(nt,"beforeRouteUpdate",Y,xe);for(const V of nt)V.updateGuards.forEach(H=>{ve.push(Vi(H,Y,xe))});return ve.push(P),tn(ve)}).then(()=>{ve=[];for(const V of vt)if(V.beforeEnter)if(hs(V.beforeEnter))for(const H of V.beforeEnter)ve.push(Vi(H,Y,xe));else ve.push(Vi(V.beforeEnter,Y,xe));return ve.push(P),tn(ve)}).then(()=>(Y.matched.forEach(V=>V.enterCallbacks={}),ve=yp(vt,"beforeRouteEnter",Y,xe,T),ve.push(P),tn(ve))).then(()=>{ve=[];for(const V of o.list())ve.push(Vi(V,Y,xe));return ve.push(P),tn(ve)}).catch(V=>Us(V,8)?V:Promise.reject(V))}function F(Y,xe,ve){a.list().forEach(Pe=>T(()=>Pe(Y,xe,ve)))}function M(Y,xe,ve,Pe,nt){const vt=U(Y,xe);if(vt)return vt;const P=xe===Pi,V=Qa?history.state:{};ve&&(Pe||P?s.replace(Y.fullPath,Vt({scroll:P&&V&&V.scroll},nt)):s.push(Y.fullPath,nt)),l.value=Y,le(Y,xe,ve,P),Qe()}let R;function Ke(){R||(R=s.listen((Y,xe,ve)=>{if(!Pt.listening)return;const Pe=$(Y),nt=X(Pe);if(nt){A(Vt(nt,{replace:!0,force:!0}),Pe).catch(Gu);return}c=Pe;const vt=l.value;Qa&&qR(w0(vt.fullPath,ve.delta),Zh()),k(Pe,vt).catch(P=>Us(P,12)?P:Us(P,2)?(A(Vt(L(P.to),{force:!0}),Pe).then(V=>{Us(V,20)&&!ve.delta&&ve.type===mc.pop&&s.go(-1,!1)}).catch(Gu),Promise.reject()):(ve.delta&&s.go(-ve.delta,!1),Ae(P,Pe,vt))).then(P=>{P=P||M(Pe,vt,!1),P&&(ve.delta&&!Us(P,8)?s.go(-ve.delta,!1):ve.type===mc.pop&&Us(P,20)&&s.go(-1,!1)),F(Pe,vt,P)}).catch(Gu)}))}let ct=Iu(),dt=Iu(),Ge;function Ae(Y,xe,ve){Qe(Y);const Pe=dt.list();return Pe.length?Pe.forEach(nt=>nt(Y,xe,ve)):console.error(Y),Promise.reject(Y)}function he(){return Ge&&l.value!==Pi?Promise.resolve():new Promise((Y,xe)=>{ct.add([Y,xe])})}function Qe(Y){return Ge||(Ge=!Y,Ke(),ct.list().forEach(([xe,ve])=>Y?ve(Y):xe()),ct.reset()),Y}function le(Y,xe,ve,Pe){const{scrollBehavior:nt}=n;if(!Qa||!nt)return Promise.resolve();const vt=!ve&&zR(w0(Y.fullPath,0))||(Pe||!ve)&&history.state&&history.state.scroll||null;return rn().then(()=>nt(Y,xe,vt)).then(P=>P&&BR(P)).catch(P=>Ae(P,Y,xe))}const re=Y=>s.go(Y);let Ne;const ht=new Set,Pt={currentRoute:l,listening:!0,addRoute:v,removeRoute:x,clearRoutes:e.clearRoutes,hasRoute:I,getRoutes:w,resolve:$,options:n,push:q,replace:te,go:re,back:()=>re(-1),forward:()=>re(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:dt.add,isReady:he,install(Y){const xe=this;Y.component("RouterLink",pC),Y.component("RouterView",yC),Y.config.globalProperties.$router=xe,Object.defineProperty(Y.config.globalProperties,"$route",{enumerable:!0,get:()=>Br(l)}),Qa&&!Ne&&l.value===Pi&&(Ne=!0,q(s.location).catch(nt=>{}));const ve={};for(const nt in Pi)Object.defineProperty(ve,nt,{get:()=>l.value[nt],enumerable:!0});Y.provide(ef,xe),Y.provide(dg,mw(ve)),Y.provide(sm,l);const Pe=Y.unmount;ht.add(Y),Y.unmount=function(){ht.delete(Y),ht.size<1&&(c=Pi,R&&R(),R=null,l.value=Pi,Ne=!1,Ge=!1),Pe()}}};function tn(Y){return Y.reduce((xe,ve)=>xe.then(()=>T(ve)),Promise.resolve())}return Pt}function bC(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>gl(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>gl(c,l))||s.push(l))}return[t,r,s]}function da(){return ls(ef)}function co(n){return ls(dg)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _x=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},wC=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},bx={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|c>>6,v=c&63;l||(v=64,o||(g=64)),r.push(t[h],t[f],t[g],t[v])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(_x(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):wC(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new xC;const g=i<<2|a>>4;if(r.push(g),c!==64){const v=a<<4&240|c>>2;if(r.push(v),f!==64){const x=c<<6&192|f;r.push(x)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class xC extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const IC=function(n){const e=_x(n);return bx.encodeByteArray(e,!0)},ph=function(n){return IC(n).replace(/\./g,"")},wx=function(n){try{return bx.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TC=()=>EC().__FIREBASE_DEFAULTS__,AC=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},SC=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&wx(n[1]);return e&&JSON.parse(e)},tf=()=>{try{return TC()||AC()||SC()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},xx=n=>{var e,t;return(t=(e=tf())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Ix=n=>{const e=xx(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Ex=()=>{var n;return(n=tf())===null||n===void 0?void 0:n.config},Tx=n=>{var e;return(e=tf())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ax(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[ph(JSON.stringify(t)),ph(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ln(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function RC(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ln())}function CC(){var n;const e=(n=tf())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function kC(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function DC(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function NC(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function OC(){const n=Ln();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Sx(){return!CC()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function hg(){try{return typeof indexedDB=="object"}catch{return!1}}function Px(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}function VC(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MC="FirebaseError";class ps extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=MC,Object.setPrototypeOf(this,ps.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ha.prototype.create)}}class ha{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?LC(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new ps(s,a,r)}}function LC(n,e){return n.replace($C,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const $C=/\{\$([^}]+)}/g;function FC(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function eo(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(M0(i)&&M0(o)){if(!eo(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function M0(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ml(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Nu(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Ou(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function UC(n,e){const t=new jC(n,e);return t.subscribe.bind(t)}class jC{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");BC(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=_p),s.error===void 0&&(s.error=_p),s.complete===void 0&&(s.complete=_p);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function BC(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function _p(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function De(n){return n&&n._delegate?n._delegate:n}class Zr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const No="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qC{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new PC;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(HC(e))try{this.getOrInitializeService({instanceIdentifier:No})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=No){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=No){return this.instances.has(e)}getOptions(e=No){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:zC(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=No){return this.component?this.component.multipleInstances?e:No:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function zC(n){return n===No?void 0:n}function HC(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KC{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new qC(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _t;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(_t||(_t={}));const GC={debug:_t.DEBUG,verbose:_t.VERBOSE,info:_t.INFO,warn:_t.WARN,error:_t.ERROR,silent:_t.SILENT},WC=_t.INFO,QC={[_t.DEBUG]:"log",[_t.VERBOSE]:"log",[_t.INFO]:"info",[_t.WARN]:"warn",[_t.ERROR]:"error"},JC=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=QC[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class fg{constructor(e){this.name=e,this._logLevel=WC,this._logHandler=JC,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in _t))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?GC[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,_t.DEBUG,...e),this._logHandler(this,_t.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,_t.VERBOSE,...e),this._logHandler(this,_t.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,_t.INFO,...e),this._logHandler(this,_t.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,_t.WARN,...e),this._logHandler(this,_t.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,_t.ERROR,...e),this._logHandler(this,_t.ERROR,...e)}}const YC=(n,e)=>e.some(t=>n instanceof t);let L0,$0;function XC(){return L0||(L0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ZC(){return $0||($0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Rx=new WeakMap,im=new WeakMap,Cx=new WeakMap,bp=new WeakMap,pg=new WeakMap;function ek(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Zs(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Rx.set(t,n)}).catch(()=>{}),pg.set(e,n),e}function tk(n){if(im.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});im.set(n,e)}let om={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return im.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Cx.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Zs(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function nk(n){om=n(om)}function rk(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(wp(this),e,...t);return Cx.set(r,e.sort?e.sort():[e]),Zs(r)}:ZC().includes(n)?function(...e){return n.apply(wp(this),e),Zs(Rx.get(this))}:function(...e){return Zs(n.apply(wp(this),e))}}function sk(n){return typeof n=="function"?rk(n):(n instanceof IDBTransaction&&tk(n),YC(n,XC())?new Proxy(n,om):n)}function Zs(n){if(n instanceof IDBRequest)return ek(n);if(bp.has(n))return bp.get(n);const e=sk(n);return e!==n&&(bp.set(n,e),pg.set(e,n)),e}const wp=n=>pg.get(n);function nf(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Zs(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Zs(o.result),l.oldVersion,l.newVersion,Zs(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function xp(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),Zs(t).then(()=>{})}const ik=["get","getKey","getAll","getAllKeys","count"],ok=["put","add","delete","clear"],Ip=new Map;function F0(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Ip.get(e))return Ip.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=ok.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||ik.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return Ip.set(e,i),i}nk(n=>({...n,get:(e,t,r)=>F0(e,t)||n.get(e,t,r),has:(e,t)=>!!F0(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ak{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(lk(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function lk(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const am="@firebase/app",U0="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ri=new fg("@firebase/app"),uk="@firebase/app-compat",ck="@firebase/analytics-compat",dk="@firebase/analytics",hk="@firebase/app-check-compat",fk="@firebase/app-check",pk="@firebase/auth",mk="@firebase/auth-compat",gk="@firebase/database",vk="@firebase/data-connect",yk="@firebase/database-compat",_k="@firebase/functions",bk="@firebase/functions-compat",wk="@firebase/installations",xk="@firebase/installations-compat",Ik="@firebase/messaging",Ek="@firebase/messaging-compat",Tk="@firebase/performance",Ak="@firebase/performance-compat",Sk="@firebase/remote-config",Pk="@firebase/remote-config-compat",Rk="@firebase/storage",Ck="@firebase/storage-compat",kk="@firebase/firestore",Dk="@firebase/vertexai-preview",Nk="@firebase/firestore-compat",Ok="firebase",Vk="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh="[DEFAULT]",Mk={[am]:"fire-core",[uk]:"fire-core-compat",[dk]:"fire-analytics",[ck]:"fire-analytics-compat",[fk]:"fire-app-check",[hk]:"fire-app-check-compat",[pk]:"fire-auth",[mk]:"fire-auth-compat",[gk]:"fire-rtdb",[vk]:"fire-data-connect",[yk]:"fire-rtdb-compat",[_k]:"fire-fn",[bk]:"fire-fn-compat",[wk]:"fire-iid",[xk]:"fire-iid-compat",[Ik]:"fire-fcm",[Ek]:"fire-fcm-compat",[Tk]:"fire-perf",[Ak]:"fire-perf-compat",[Sk]:"fire-rc",[Pk]:"fire-rc-compat",[Rk]:"fire-gcs",[Ck]:"fire-gcs-compat",[kk]:"fire-fst",[Nk]:"fire-fst-compat",[Dk]:"fire-vertex","fire-js":"fire-js",[Ok]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gh=new Map,Lk=new Map,lm=new Map;function j0(n,e){try{n.container.addComponent(e)}catch(t){ri.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function fs(n){const e=n.name;if(lm.has(e))return ri.debug(`There were multiple attempts to register component ${e}.`),!1;lm.set(e,n);for(const t of gh.values())j0(t,n);for(const t of Lk.values())j0(t,n);return!0}function ci(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function $k(n,e,t=mh){ci(n,e).clearInstance(t)}function En(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fk={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Qi=new ha("app","Firebase",Fk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uk{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Zr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Qi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fa=Vk;function kx(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:mh,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Qi.create("bad-app-name",{appName:String(s)});if(t||(t=Ex()),!t)throw Qi.create("no-options");const i=gh.get(s);if(i){if(eo(t,i.options)&&eo(r,i.config))return i;throw Qi.create("duplicate-app",{appName:s})}const o=new KC(s);for(const l of lm.values())o.addComponent(l);const a=new Uk(t,r,o);return gh.set(s,a),a}function Ll(n=mh){const e=gh.get(n);if(!e&&n===mh&&Ex())return kx();if(!e)throw Qi.create("no-app",{appName:n});return e}function Nr(n,e,t){var r;let s=(r=Mk[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ri.warn(a.join(" "));return}fs(new Zr(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jk="firebase-heartbeat-database",Bk=1,gc="firebase-heartbeat-store";let Ep=null;function Dx(){return Ep||(Ep=nf(jk,Bk,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(gc)}catch(t){console.warn(t)}}}}).catch(n=>{throw Qi.create("idb-open",{originalErrorMessage:n.message})})),Ep}async function qk(n){try{const t=(await Dx()).transaction(gc),r=await t.objectStore(gc).get(Nx(n));return await t.done,r}catch(e){if(e instanceof ps)ri.warn(e.message);else{const t=Qi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ri.warn(t.message)}}}async function B0(n,e){try{const r=(await Dx()).transaction(gc,"readwrite");await r.objectStore(gc).put(e,Nx(n)),await r.done}catch(t){if(t instanceof ps)ri.warn(t.message);else{const r=Qi.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});ri.warn(r.message)}}}function Nx(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zk=1024,Hk=30*24*60*60*1e3;class Kk{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Wk(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=q0();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=Hk}),this._storage.overwrite(this._heartbeatsCache))}catch(r){ri.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=q0(),{heartbeatsToSend:r,unsentEntries:s}=Gk(this._heartbeatsCache.heartbeats),i=ph(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return ri.warn(t),""}}}function q0(){return new Date().toISOString().substring(0,10)}function Gk(n,e=zk){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),z0(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),z0(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Wk{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return hg()?Px().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await qk(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return B0(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return B0(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function z0(n){return ph(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qk(n){fs(new Zr("platform-logger",e=>new ak(e),"PRIVATE")),fs(new Zr("heartbeat",e=>new Kk(e),"PRIVATE")),Nr(am,U0,n),Nr(am,U0,"esm2017"),Nr("fire-js","")}Qk("");const Ox="@firebase/installations",mg="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vx=1e4,Mx=`w:${mg}`,Lx="FIS_v2",Jk="https://firebaseinstallations.googleapis.com/v1",Yk=60*60*1e3,Xk="installations",Zk="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e2={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Xo=new ha(Xk,Zk,e2);function $x(n){return n instanceof ps&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fx({projectId:n}){return`${Jk}/projects/${n}/installations`}function Ux(n){return{token:n.token,requestStatus:2,expiresIn:n2(n.expiresIn),creationTime:Date.now()}}async function jx(n,e){const r=(await e.json()).error;return Xo.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function Bx({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function t2(n,{refreshToken:e}){const t=Bx(n);return t.append("Authorization",r2(e)),t}async function qx(n){const e=await n();return e.status>=500&&e.status<600?n():e}function n2(n){return Number(n.replace("s","000"))}function r2(n){return`${Lx} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s2({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=Fx(n),s=Bx(n),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={fid:t,authVersion:Lx,appId:n.appId,sdkVersion:Mx},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await qx(()=>fetch(r,a));if(l.ok){const c=await l.json();return{fid:c.fid||t,registrationStatus:2,refreshToken:c.refreshToken,authToken:Ux(c.authToken)}}else throw await jx("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zx(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i2(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o2=/^[cdef][\w-]{21}$/,um="";function a2(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=l2(n);return o2.test(t)?t:um}catch{return um}}function l2(n){return i2(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rf(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hx=new Map;function Kx(n,e){const t=rf(n);Gx(t,e),u2(t,e)}function Gx(n,e){const t=Hx.get(n);if(t)for(const r of t)r(e)}function u2(n,e){const t=c2();t&&t.postMessage({key:n,fid:e}),d2()}let qo=null;function c2(){return!qo&&"BroadcastChannel"in self&&(qo=new BroadcastChannel("[Firebase] FID Change"),qo.onmessage=n=>{Gx(n.data.key,n.data.fid)}),qo}function d2(){Hx.size===0&&qo&&(qo.close(),qo=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h2="firebase-installations-database",f2=1,Zo="firebase-installations-store";let Tp=null;function gg(){return Tp||(Tp=nf(h2,f2,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Zo)}}})),Tp}async function vh(n,e){const t=rf(n),s=(await gg()).transaction(Zo,"readwrite"),i=s.objectStore(Zo),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&Kx(n,e.fid),e}async function Wx(n){const e=rf(n),r=(await gg()).transaction(Zo,"readwrite");await r.objectStore(Zo).delete(e),await r.done}async function sf(n,e){const t=rf(n),s=(await gg()).transaction(Zo,"readwrite"),i=s.objectStore(Zo),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&Kx(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vg(n){let e;const t=await sf(n.appConfig,r=>{const s=p2(r),i=m2(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===um?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function p2(n){const e=n||{fid:a2(),registrationStatus:0};return Qx(e)}function m2(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Xo.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=g2(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:v2(n)}:{installationEntry:e}}async function g2(n,e){try{const t=await s2(n,e);return vh(n.appConfig,t)}catch(t){throw $x(t)&&t.customData.serverCode===409?await Wx(n.appConfig):await vh(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function v2(n){let e=await H0(n.appConfig);for(;e.registrationStatus===1;)await zx(100),e=await H0(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await vg(n);return r||t}return e}function H0(n){return sf(n,e=>{if(!e)throw Xo.create("installation-not-found");return Qx(e)})}function Qx(n){return y2(n)?{fid:n.fid,registrationStatus:0}:n}function y2(n){return n.registrationStatus===1&&n.registrationTime+Vx<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _2({appConfig:n,heartbeatServiceProvider:e},t){const r=b2(n,t),s=t2(n,t),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={installation:{sdkVersion:Mx,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await qx(()=>fetch(r,a));if(l.ok){const c=await l.json();return Ux(c)}else throw await jx("Generate Auth Token",l)}function b2(n,{fid:e}){return`${Fx(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yg(n,e=!1){let t;const r=await sf(n.appConfig,i=>{if(!Jx(i))throw Xo.create("not-registered");const o=i.authToken;if(!e&&I2(o))return i;if(o.requestStatus===1)return t=w2(n,e),i;{if(!navigator.onLine)throw Xo.create("app-offline");const a=T2(i);return t=x2(n,a),a}});return t?await t:r.authToken}async function w2(n,e){let t=await K0(n.appConfig);for(;t.authToken.requestStatus===1;)await zx(100),t=await K0(n.appConfig);const r=t.authToken;return r.requestStatus===0?yg(n,e):r}function K0(n){return sf(n,e=>{if(!Jx(e))throw Xo.create("not-registered");const t=e.authToken;return A2(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function x2(n,e){try{const t=await _2(n,e),r=Object.assign(Object.assign({},e),{authToken:t});return await vh(n.appConfig,r),t}catch(t){if($x(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await Wx(n.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await vh(n.appConfig,r)}throw t}}function Jx(n){return n!==void 0&&n.registrationStatus===2}function I2(n){return n.requestStatus===2&&!E2(n)}function E2(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+Yk}function T2(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function A2(n){return n.requestStatus===1&&n.requestTime+Vx<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function S2(n){const e=n,{installationEntry:t,registrationPromise:r}=await vg(e);return r?r.catch(console.error):yg(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function P2(n,e=!1){const t=n;return await R2(t),(await yg(t,e)).token}async function R2(n){const{registrationPromise:e}=await vg(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C2(n){if(!n||!n.options)throw Ap("App Configuration");if(!n.name)throw Ap("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Ap(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Ap(n){return Xo.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yx="installations",k2="installations-internal",D2=n=>{const e=n.getProvider("app").getImmediate(),t=C2(e),r=ci(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},N2=n=>{const e=n.getProvider("app").getImmediate(),t=ci(e,Yx).getImmediate();return{getId:()=>S2(t),getToken:s=>P2(t,s)}};function O2(){fs(new Zr(Yx,D2,"PUBLIC")),fs(new Zr(k2,N2,"PRIVATE"))}O2();Nr(Ox,mg);Nr(Ox,mg,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V2="/firebase-messaging-sw.js",M2="/firebase-cloud-messaging-push-scope",Xx="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",L2="https://fcmregistrations.googleapis.com/v1",Zx="google.c.a.c_id",$2="google.c.a.c_l",F2="google.c.a.ts",U2="google.c.a.e";var G0;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(G0||(G0={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var vc;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(vc||(vc={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bs(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function j2(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),s=new Uint8Array(r.length);for(let i=0;i<r.length;++i)s[i]=r.charCodeAt(i);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sp="fcm_token_details_db",B2=5,W0="fcm_token_object_Store";async function q2(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(i=>i.name).includes(Sp))return null;let e=null;return(await nf(Sp,B2,{upgrade:async(r,s,i,o)=>{var a;if(s<2||!r.objectStoreNames.contains(W0))return;const l=o.objectStore(W0),c=await l.index("fcmSenderId").get(n);if(await l.clear(),!!c){if(s===2){const h=c;if(!h.auth||!h.p256dh||!h.endpoint)return;e={token:h.fcmToken,createTime:(a=h.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:h.auth,p256dh:h.p256dh,endpoint:h.endpoint,swScope:h.swScope,vapidKey:typeof h.vapidKey=="string"?h.vapidKey:Bs(h.vapidKey)}}}else if(s===3){const h=c;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:Bs(h.auth),p256dh:Bs(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:Bs(h.vapidKey)}}}else if(s===4){const h=c;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:Bs(h.auth),p256dh:Bs(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:Bs(h.vapidKey)}}}}}})).close(),await xp(Sp),await xp("fcm_vapid_details_db"),await xp("undefined"),z2(e)?e:null}function z2(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H2="firebase-messaging-database",K2=1,yc="firebase-messaging-store";let Pp=null;function eI(){return Pp||(Pp=nf(H2,K2,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(yc)}}})),Pp}async function G2(n){const e=tI(n),r=await(await eI()).transaction(yc).objectStore(yc).get(e);if(r)return r;{const s=await q2(n.appConfig.senderId);if(s)return await _g(n,s),s}}async function _g(n,e){const t=tI(n),s=(await eI()).transaction(yc,"readwrite");return await s.objectStore(yc).put(e,t),await s.done,e}function tI({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W2={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},wr=new ha("messaging","Messaging",W2);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q2(n,e){const t=await wg(n),r=nI(e),s={method:"POST",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(bg(n.appConfig),s)).json()}catch(o){throw wr.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw wr.create("token-subscribe-failed",{errorInfo:o})}if(!i.token)throw wr.create("token-subscribe-no-token");return i.token}async function J2(n,e){const t=await wg(n),r=nI(e.subscriptionOptions),s={method:"PATCH",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(`${bg(n.appConfig)}/${e.token}`,s)).json()}catch(o){throw wr.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw wr.create("token-update-failed",{errorInfo:o})}if(!i.token)throw wr.create("token-update-no-token");return i.token}async function Y2(n,e){const r={method:"DELETE",headers:await wg(n)};try{const i=await(await fetch(`${bg(n.appConfig)}/${e}`,r)).json();if(i.error){const o=i.error.message;throw wr.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw wr.create("token-unsubscribe-failed",{errorInfo:s==null?void 0:s.toString()})}}function bg({projectId:n}){return`${L2}/projects/${n}/registrations`}async function wg({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function nI({p256dh:n,auth:e,endpoint:t,vapidKey:r}){const s={web:{endpoint:t,auth:e,p256dh:n}};return r!==Xx&&(s.web.applicationPubKey=r),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X2=7*24*60*60*1e3;async function Z2(n){const e=await tD(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:Bs(e.getKey("auth")),p256dh:Bs(e.getKey("p256dh"))},r=await G2(n.firebaseDependencies);if(r){if(nD(r.subscriptionOptions,t))return Date.now()>=r.createTime+X2?eD(n,{token:r.token,createTime:Date.now(),subscriptionOptions:t}):r.token;try{await Y2(n.firebaseDependencies,r.token)}catch(s){console.warn(s)}return Q0(n.firebaseDependencies,t)}else return Q0(n.firebaseDependencies,t)}async function eD(n,e){try{const t=await J2(n.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await _g(n.firebaseDependencies,r),t}catch(t){throw t}}async function Q0(n,e){const r={token:await Q2(n,e),createTime:Date.now(),subscriptionOptions:e};return await _g(n,r),r.token}async function tD(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:j2(e)})}function nD(n,e){const t=e.vapidKey===n.vapidKey,r=e.endpoint===n.endpoint,s=e.auth===n.auth,i=e.p256dh===n.p256dh;return t&&r&&s&&i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J0(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return rD(e,n),sD(e,n),iD(e,n),e}function rD(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const r=e.notification.body;r&&(n.notification.body=r);const s=e.notification.image;s&&(n.notification.image=s);const i=e.notification.icon;i&&(n.notification.icon=i)}function sD(n,e){e.data&&(n.data=e.data)}function iD(n,e){var t,r,s,i,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(s=(r=e.fcmOptions)===null||r===void 0?void 0:r.link)!==null&&s!==void 0?s:(i=e.notification)===null||i===void 0?void 0:i.click_action;a&&(n.fcmOptions.link=a);const l=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;l&&(n.fcmOptions.analyticsLabel=l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oD(n){return typeof n=="object"&&!!n&&Zx in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */aD("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function aD(n,e){const t=[];for(let r=0;r<n.length;r++)t.push(n.charAt(r)),r<e.length&&t.push(e.charAt(r));return t.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lD(n){if(!n||!n.options)throw Rp("App Configuration Object");if(!n.name)throw Rp("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const r of e)if(!t[r])throw Rp(r);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function Rp(n){return wr.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uD{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=lD(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cD(n){try{n.swRegistration=await navigator.serviceWorker.register(V2,{scope:M2}),n.swRegistration.update().catch(()=>{})}catch(e){throw wr.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dD(n,e){if(!e&&!n.swRegistration&&await cD(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw wr.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hD(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=Xx)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rI(n,e){if(!navigator)throw wr.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw wr.create("permission-blocked");return await hD(n,e==null?void 0:e.vapidKey),await dD(n,e==null?void 0:e.serviceWorkerRegistration),Z2(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fD(n,e,t){const r=pD(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:t[Zx],message_name:t[$2],message_time:t[F2],message_device_time:Math.floor(Date.now()/1e3)})}function pD(n){switch(n){case vc.NOTIFICATION_CLICKED:return"notification_open";case vc.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mD(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===vc.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(J0(t)):n.onMessageHandler.next(J0(t)));const r=t.data;oD(r)&&r[U2]==="1"&&await fD(n,t.messageType,r)}const Y0="@firebase/messaging",X0="0.12.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gD=n=>{const e=new uD(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>mD(e,t)),e},vD=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:r=>rI(e,r)}};function yD(){fs(new Zr("messaging",gD,"PUBLIC")),fs(new Zr("messaging-internal",vD,"PRIVATE")),Nr(Y0,X0),Nr(Y0,X0,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sI(){try{await Px()}catch{return!1}return typeof window<"u"&&hg()&&VC()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xg(n=Ll()){return sI().then(e=>{if(!e)throw wr.create("unsupported-browser")},e=>{throw wr.create("indexed-db-unsupported")}),ci(De(n),"messaging").getImmediate()}async function iI(n,e){return n=De(n),rI(n,e)}yD();var _D="firebase",bD="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Nr(_D,bD,"app");var Z0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Go,oI;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(A,b){function T(){}T.prototype=b.prototype,A.D=b.prototype,A.prototype=new T,A.prototype.constructor=A,A.C=function(k,F,M){for(var R=Array(arguments.length-2),Ke=2;Ke<arguments.length;Ke++)R[Ke-2]=arguments[Ke];return b.prototype[F].apply(k,R)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(A,b,T){T||(T=0);var k=Array(16);if(typeof b=="string")for(var F=0;16>F;++F)k[F]=b.charCodeAt(T++)|b.charCodeAt(T++)<<8|b.charCodeAt(T++)<<16|b.charCodeAt(T++)<<24;else for(F=0;16>F;++F)k[F]=b[T++]|b[T++]<<8|b[T++]<<16|b[T++]<<24;b=A.g[0],T=A.g[1],F=A.g[2];var M=A.g[3],R=b+(M^T&(F^M))+k[0]+3614090360&4294967295;b=T+(R<<7&4294967295|R>>>25),R=M+(F^b&(T^F))+k[1]+3905402710&4294967295,M=b+(R<<12&4294967295|R>>>20),R=F+(T^M&(b^T))+k[2]+606105819&4294967295,F=M+(R<<17&4294967295|R>>>15),R=T+(b^F&(M^b))+k[3]+3250441966&4294967295,T=F+(R<<22&4294967295|R>>>10),R=b+(M^T&(F^M))+k[4]+4118548399&4294967295,b=T+(R<<7&4294967295|R>>>25),R=M+(F^b&(T^F))+k[5]+1200080426&4294967295,M=b+(R<<12&4294967295|R>>>20),R=F+(T^M&(b^T))+k[6]+2821735955&4294967295,F=M+(R<<17&4294967295|R>>>15),R=T+(b^F&(M^b))+k[7]+4249261313&4294967295,T=F+(R<<22&4294967295|R>>>10),R=b+(M^T&(F^M))+k[8]+1770035416&4294967295,b=T+(R<<7&4294967295|R>>>25),R=M+(F^b&(T^F))+k[9]+2336552879&4294967295,M=b+(R<<12&4294967295|R>>>20),R=F+(T^M&(b^T))+k[10]+4294925233&4294967295,F=M+(R<<17&4294967295|R>>>15),R=T+(b^F&(M^b))+k[11]+2304563134&4294967295,T=F+(R<<22&4294967295|R>>>10),R=b+(M^T&(F^M))+k[12]+1804603682&4294967295,b=T+(R<<7&4294967295|R>>>25),R=M+(F^b&(T^F))+k[13]+4254626195&4294967295,M=b+(R<<12&4294967295|R>>>20),R=F+(T^M&(b^T))+k[14]+2792965006&4294967295,F=M+(R<<17&4294967295|R>>>15),R=T+(b^F&(M^b))+k[15]+1236535329&4294967295,T=F+(R<<22&4294967295|R>>>10),R=b+(F^M&(T^F))+k[1]+4129170786&4294967295,b=T+(R<<5&4294967295|R>>>27),R=M+(T^F&(b^T))+k[6]+3225465664&4294967295,M=b+(R<<9&4294967295|R>>>23),R=F+(b^T&(M^b))+k[11]+643717713&4294967295,F=M+(R<<14&4294967295|R>>>18),R=T+(M^b&(F^M))+k[0]+3921069994&4294967295,T=F+(R<<20&4294967295|R>>>12),R=b+(F^M&(T^F))+k[5]+3593408605&4294967295,b=T+(R<<5&4294967295|R>>>27),R=M+(T^F&(b^T))+k[10]+38016083&4294967295,M=b+(R<<9&4294967295|R>>>23),R=F+(b^T&(M^b))+k[15]+3634488961&4294967295,F=M+(R<<14&4294967295|R>>>18),R=T+(M^b&(F^M))+k[4]+3889429448&4294967295,T=F+(R<<20&4294967295|R>>>12),R=b+(F^M&(T^F))+k[9]+568446438&4294967295,b=T+(R<<5&4294967295|R>>>27),R=M+(T^F&(b^T))+k[14]+3275163606&4294967295,M=b+(R<<9&4294967295|R>>>23),R=F+(b^T&(M^b))+k[3]+4107603335&4294967295,F=M+(R<<14&4294967295|R>>>18),R=T+(M^b&(F^M))+k[8]+1163531501&4294967295,T=F+(R<<20&4294967295|R>>>12),R=b+(F^M&(T^F))+k[13]+2850285829&4294967295,b=T+(R<<5&4294967295|R>>>27),R=M+(T^F&(b^T))+k[2]+4243563512&4294967295,M=b+(R<<9&4294967295|R>>>23),R=F+(b^T&(M^b))+k[7]+1735328473&4294967295,F=M+(R<<14&4294967295|R>>>18),R=T+(M^b&(F^M))+k[12]+2368359562&4294967295,T=F+(R<<20&4294967295|R>>>12),R=b+(T^F^M)+k[5]+4294588738&4294967295,b=T+(R<<4&4294967295|R>>>28),R=M+(b^T^F)+k[8]+2272392833&4294967295,M=b+(R<<11&4294967295|R>>>21),R=F+(M^b^T)+k[11]+1839030562&4294967295,F=M+(R<<16&4294967295|R>>>16),R=T+(F^M^b)+k[14]+4259657740&4294967295,T=F+(R<<23&4294967295|R>>>9),R=b+(T^F^M)+k[1]+2763975236&4294967295,b=T+(R<<4&4294967295|R>>>28),R=M+(b^T^F)+k[4]+1272893353&4294967295,M=b+(R<<11&4294967295|R>>>21),R=F+(M^b^T)+k[7]+4139469664&4294967295,F=M+(R<<16&4294967295|R>>>16),R=T+(F^M^b)+k[10]+3200236656&4294967295,T=F+(R<<23&4294967295|R>>>9),R=b+(T^F^M)+k[13]+681279174&4294967295,b=T+(R<<4&4294967295|R>>>28),R=M+(b^T^F)+k[0]+3936430074&4294967295,M=b+(R<<11&4294967295|R>>>21),R=F+(M^b^T)+k[3]+3572445317&4294967295,F=M+(R<<16&4294967295|R>>>16),R=T+(F^M^b)+k[6]+76029189&4294967295,T=F+(R<<23&4294967295|R>>>9),R=b+(T^F^M)+k[9]+3654602809&4294967295,b=T+(R<<4&4294967295|R>>>28),R=M+(b^T^F)+k[12]+3873151461&4294967295,M=b+(R<<11&4294967295|R>>>21),R=F+(M^b^T)+k[15]+530742520&4294967295,F=M+(R<<16&4294967295|R>>>16),R=T+(F^M^b)+k[2]+3299628645&4294967295,T=F+(R<<23&4294967295|R>>>9),R=b+(F^(T|~M))+k[0]+4096336452&4294967295,b=T+(R<<6&4294967295|R>>>26),R=M+(T^(b|~F))+k[7]+1126891415&4294967295,M=b+(R<<10&4294967295|R>>>22),R=F+(b^(M|~T))+k[14]+2878612391&4294967295,F=M+(R<<15&4294967295|R>>>17),R=T+(M^(F|~b))+k[5]+4237533241&4294967295,T=F+(R<<21&4294967295|R>>>11),R=b+(F^(T|~M))+k[12]+1700485571&4294967295,b=T+(R<<6&4294967295|R>>>26),R=M+(T^(b|~F))+k[3]+2399980690&4294967295,M=b+(R<<10&4294967295|R>>>22),R=F+(b^(M|~T))+k[10]+4293915773&4294967295,F=M+(R<<15&4294967295|R>>>17),R=T+(M^(F|~b))+k[1]+2240044497&4294967295,T=F+(R<<21&4294967295|R>>>11),R=b+(F^(T|~M))+k[8]+1873313359&4294967295,b=T+(R<<6&4294967295|R>>>26),R=M+(T^(b|~F))+k[15]+4264355552&4294967295,M=b+(R<<10&4294967295|R>>>22),R=F+(b^(M|~T))+k[6]+2734768916&4294967295,F=M+(R<<15&4294967295|R>>>17),R=T+(M^(F|~b))+k[13]+1309151649&4294967295,T=F+(R<<21&4294967295|R>>>11),R=b+(F^(T|~M))+k[4]+4149444226&4294967295,b=T+(R<<6&4294967295|R>>>26),R=M+(T^(b|~F))+k[11]+3174756917&4294967295,M=b+(R<<10&4294967295|R>>>22),R=F+(b^(M|~T))+k[2]+718787259&4294967295,F=M+(R<<15&4294967295|R>>>17),R=T+(M^(F|~b))+k[9]+3951481745&4294967295,A.g[0]=A.g[0]+b&4294967295,A.g[1]=A.g[1]+(F+(R<<21&4294967295|R>>>11))&4294967295,A.g[2]=A.g[2]+F&4294967295,A.g[3]=A.g[3]+M&4294967295}r.prototype.u=function(A,b){b===void 0&&(b=A.length);for(var T=b-this.blockSize,k=this.B,F=this.h,M=0;M<b;){if(F==0)for(;M<=T;)s(this,A,M),M+=this.blockSize;if(typeof A=="string"){for(;M<b;)if(k[F++]=A.charCodeAt(M++),F==this.blockSize){s(this,k),F=0;break}}else for(;M<b;)if(k[F++]=A[M++],F==this.blockSize){s(this,k),F=0;break}}this.h=F,this.o+=b},r.prototype.v=function(){var A=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);A[0]=128;for(var b=1;b<A.length-8;++b)A[b]=0;var T=8*this.o;for(b=A.length-8;b<A.length;++b)A[b]=T&255,T/=256;for(this.u(A),A=Array(16),b=T=0;4>b;++b)for(var k=0;32>k;k+=8)A[T++]=this.g[b]>>>k&255;return A};function i(A,b){var T=a;return Object.prototype.hasOwnProperty.call(T,A)?T[A]:T[A]=b(A)}function o(A,b){this.h=b;for(var T=[],k=!0,F=A.length-1;0<=F;F--){var M=A[F]|0;k&&M==b||(T[F]=M,k=!1)}this.g=T}var a={};function l(A){return-128<=A&&128>A?i(A,function(b){return new o([b|0],0>b?-1:0)}):new o([A|0],0>A?-1:0)}function c(A){if(isNaN(A)||!isFinite(A))return f;if(0>A)return I(c(-A));for(var b=[],T=1,k=0;A>=T;k++)b[k]=A/T|0,T*=4294967296;return new o(b,0)}function h(A,b){if(A.length==0)throw Error("number format error: empty string");if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(A.charAt(0)=="-")return I(h(A.substring(1),b));if(0<=A.indexOf("-"))throw Error('number format error: interior "-" character');for(var T=c(Math.pow(b,8)),k=f,F=0;F<A.length;F+=8){var M=Math.min(8,A.length-F),R=parseInt(A.substring(F,F+M),b);8>M?(M=c(Math.pow(b,M)),k=k.j(M).add(c(R))):(k=k.j(T),k=k.add(c(R)))}return k}var f=l(0),g=l(1),v=l(16777216);n=o.prototype,n.m=function(){if(w(this))return-I(this).m();for(var A=0,b=1,T=0;T<this.g.length;T++){var k=this.i(T);A+=(0<=k?k:4294967296+k)*b,b*=4294967296}return A},n.toString=function(A){if(A=A||10,2>A||36<A)throw Error("radix out of range: "+A);if(x(this))return"0";if(w(this))return"-"+I(this).toString(A);for(var b=c(Math.pow(A,6)),T=this,k="";;){var F=q(T,b).g;T=$(T,F.j(b));var M=((0<T.g.length?T.g[0]:T.h)>>>0).toString(A);if(T=F,x(T))return M+k;for(;6>M.length;)M="0"+M;k=M+k}},n.i=function(A){return 0>A?0:A<this.g.length?this.g[A]:this.h};function x(A){if(A.h!=0)return!1;for(var b=0;b<A.g.length;b++)if(A.g[b]!=0)return!1;return!0}function w(A){return A.h==-1}n.l=function(A){return A=$(this,A),w(A)?-1:x(A)?0:1};function I(A){for(var b=A.g.length,T=[],k=0;k<b;k++)T[k]=~A.g[k];return new o(T,~A.h).add(g)}n.abs=function(){return w(this)?I(this):this},n.add=function(A){for(var b=Math.max(this.g.length,A.g.length),T=[],k=0,F=0;F<=b;F++){var M=k+(this.i(F)&65535)+(A.i(F)&65535),R=(M>>>16)+(this.i(F)>>>16)+(A.i(F)>>>16);k=R>>>16,M&=65535,R&=65535,T[F]=R<<16|M}return new o(T,T[T.length-1]&-2147483648?-1:0)};function $(A,b){return A.add(I(b))}n.j=function(A){if(x(this)||x(A))return f;if(w(this))return w(A)?I(this).j(I(A)):I(I(this).j(A));if(w(A))return I(this.j(I(A)));if(0>this.l(v)&&0>A.l(v))return c(this.m()*A.m());for(var b=this.g.length+A.g.length,T=[],k=0;k<2*b;k++)T[k]=0;for(k=0;k<this.g.length;k++)for(var F=0;F<A.g.length;F++){var M=this.i(k)>>>16,R=this.i(k)&65535,Ke=A.i(F)>>>16,ct=A.i(F)&65535;T[2*k+2*F]+=R*ct,L(T,2*k+2*F),T[2*k+2*F+1]+=M*ct,L(T,2*k+2*F+1),T[2*k+2*F+1]+=R*Ke,L(T,2*k+2*F+1),T[2*k+2*F+2]+=M*Ke,L(T,2*k+2*F+2)}for(k=0;k<b;k++)T[k]=T[2*k+1]<<16|T[2*k];for(k=b;k<2*b;k++)T[k]=0;return new o(T,0)};function L(A,b){for(;(A[b]&65535)!=A[b];)A[b+1]+=A[b]>>>16,A[b]&=65535,b++}function U(A,b){this.g=A,this.h=b}function q(A,b){if(x(b))throw Error("division by zero");if(x(A))return new U(f,f);if(w(A))return b=q(I(A),b),new U(I(b.g),I(b.h));if(w(b))return b=q(A,I(b)),new U(I(b.g),b.h);if(30<A.g.length){if(w(A)||w(b))throw Error("slowDivide_ only works with positive integers.");for(var T=g,k=b;0>=k.l(A);)T=te(T),k=te(k);var F=X(T,1),M=X(k,1);for(k=X(k,2),T=X(T,2);!x(k);){var R=M.add(k);0>=R.l(A)&&(F=F.add(T),M=R),k=X(k,1),T=X(T,1)}return b=$(A,F.j(b)),new U(F,b)}for(F=f;0<=A.l(b);){for(T=Math.max(1,Math.floor(A.m()/b.m())),k=Math.ceil(Math.log(T)/Math.LN2),k=48>=k?1:Math.pow(2,k-48),M=c(T),R=M.j(b);w(R)||0<R.l(A);)T-=k,M=c(T),R=M.j(b);x(M)&&(M=g),F=F.add(M),A=$(A,R)}return new U(F,A)}n.A=function(A){return q(this,A).h},n.and=function(A){for(var b=Math.max(this.g.length,A.g.length),T=[],k=0;k<b;k++)T[k]=this.i(k)&A.i(k);return new o(T,this.h&A.h)},n.or=function(A){for(var b=Math.max(this.g.length,A.g.length),T=[],k=0;k<b;k++)T[k]=this.i(k)|A.i(k);return new o(T,this.h|A.h)},n.xor=function(A){for(var b=Math.max(this.g.length,A.g.length),T=[],k=0;k<b;k++)T[k]=this.i(k)^A.i(k);return new o(T,this.h^A.h)};function te(A){for(var b=A.g.length+1,T=[],k=0;k<b;k++)T[k]=A.i(k)<<1|A.i(k-1)>>>31;return new o(T,A.h)}function X(A,b){var T=b>>5;b%=32;for(var k=A.g.length-T,F=[],M=0;M<k;M++)F[M]=0<b?A.i(M+T)>>>b|A.i(M+T+1)<<32-b:A.i(M+T);return new o(F,A.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,oI=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=h,Go=o}).apply(typeof Z0<"u"?Z0:typeof self<"u"?self:typeof window<"u"?window:{});var Sd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var aI,Vu,lI,Kd,cm,uI,cI,dI;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,y){return u==Array.prototype||u==Object.prototype||(u[p]=y.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Sd=="object"&&Sd];for(var p=0;p<u.length;++p){var y=u[p];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var y=r;u=u.split(".");for(var E=0;E<u.length-1;E++){var B=u[E];if(!(B in y))break e;y=y[B]}u=u[u.length-1],E=y[u],p=p(E),p!=E&&p!=null&&e(y,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var y=0,E=!1,B={next:function(){if(!E&&y<u.length){var J=y++;return{value:p(J,u[J]),done:!1}}return E=!0,{done:!0,value:void 0}}};return B[Symbol.iterator]=function(){return B},B}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,y){return y})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function c(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function h(u,p,y){return u.call.apply(u.bind,arguments)}function f(u,p,y){if(!u)throw Error();if(2<arguments.length){var E=Array.prototype.slice.call(arguments,2);return function(){var B=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(B,E),u.apply(p,B)}}return function(){return u.apply(p,arguments)}}function g(u,p,y){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,g.apply(null,arguments)}function v(u,p){var y=Array.prototype.slice.call(arguments,1);return function(){var E=y.slice();return E.push.apply(E,arguments),u.apply(this,E)}}function x(u,p){function y(){}y.prototype=p.prototype,u.aa=p.prototype,u.prototype=new y,u.prototype.constructor=u,u.Qb=function(E,B,J){for(var Ie=Array(arguments.length-2),St=2;St<arguments.length;St++)Ie[St-2]=arguments[St];return p.prototype[B].apply(E,Ie)}}function w(u){const p=u.length;if(0<p){const y=Array(p);for(let E=0;E<p;E++)y[E]=u[E];return y}return[]}function I(u,p){for(let y=1;y<arguments.length;y++){const E=arguments[y];if(l(E)){const B=u.length||0,J=E.length||0;u.length=B+J;for(let Ie=0;Ie<J;Ie++)u[B+Ie]=E[Ie]}else u.push(E)}}class ${constructor(p,y){this.i=p,this.j=y,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function L(u){return/^[\s\xa0]*$/.test(u)}function U(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function q(u){return q[" "](u),u}q[" "]=function(){};var te=U().indexOf("Gecko")!=-1&&!(U().toLowerCase().indexOf("webkit")!=-1&&U().indexOf("Edge")==-1)&&!(U().indexOf("Trident")!=-1||U().indexOf("MSIE")!=-1)&&U().indexOf("Edge")==-1;function X(u,p,y){for(const E in u)p.call(y,u[E],E,u)}function A(u,p){for(const y in u)p.call(void 0,u[y],y,u)}function b(u){const p={};for(const y in u)p[y]=u[y];return p}const T="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function k(u,p){let y,E;for(let B=1;B<arguments.length;B++){E=arguments[B];for(y in E)u[y]=E[y];for(let J=0;J<T.length;J++)y=T[J],Object.prototype.hasOwnProperty.call(E,y)&&(u[y]=E[y])}}function F(u){var p=1;u=u.split(":");const y=[];for(;0<p&&u.length;)y.push(u.shift()),p--;return u.length&&y.push(u.join(":")),y}function M(u){a.setTimeout(()=>{throw u},0)}function R(){var u=he;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class Ke{constructor(){this.h=this.g=null}add(p,y){const E=ct.get();E.set(p,y),this.h?this.h.next=E:this.g=E,this.h=E}}var ct=new $(()=>new dt,u=>u.reset());class dt{constructor(){this.next=this.g=this.h=null}set(p,y){this.h=p,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let Ge,Ae=!1,he=new Ke,Qe=()=>{const u=a.Promise.resolve(void 0);Ge=()=>{u.then(le)}};var le=()=>{for(var u;u=R();){try{u.h.call(u.g)}catch(y){M(y)}var p=ct;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}Ae=!1};function re(){this.s=this.s,this.C=this.C}re.prototype.s=!1,re.prototype.ma=function(){this.s||(this.s=!0,this.N())},re.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ne(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}Ne.prototype.h=function(){this.defaultPrevented=!0};var ht=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const y=()=>{};a.addEventListener("test",y,p),a.removeEventListener("test",y,p)}catch{}return u}();function Pt(u,p){if(Ne.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var y=this.type=u.type,E=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(te){e:{try{q(p.nodeName);var B=!0;break e}catch{}B=!1}B||(p=null)}}else y=="mouseover"?p=u.fromElement:y=="mouseout"&&(p=u.toElement);this.relatedTarget=p,E?(this.clientX=E.clientX!==void 0?E.clientX:E.pageX,this.clientY=E.clientY!==void 0?E.clientY:E.pageY,this.screenX=E.screenX||0,this.screenY=E.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:tn[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&Pt.aa.h.call(this)}}x(Pt,Ne);var tn={2:"touch",3:"pen",4:"mouse"};Pt.prototype.h=function(){Pt.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var Y="closure_listenable_"+(1e6*Math.random()|0),xe=0;function ve(u,p,y,E,B){this.listener=u,this.proxy=null,this.src=p,this.type=y,this.capture=!!E,this.ha=B,this.key=++xe,this.da=this.fa=!1}function Pe(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function nt(u){this.src=u,this.g={},this.h=0}nt.prototype.add=function(u,p,y,E,B){var J=u.toString();u=this.g[J],u||(u=this.g[J]=[],this.h++);var Ie=P(u,p,E,B);return-1<Ie?(p=u[Ie],y||(p.fa=!1)):(p=new ve(p,this.src,J,!!E,B),p.fa=y,u.push(p)),p};function vt(u,p){var y=p.type;if(y in u.g){var E=u.g[y],B=Array.prototype.indexOf.call(E,p,void 0),J;(J=0<=B)&&Array.prototype.splice.call(E,B,1),J&&(Pe(p),u.g[y].length==0&&(delete u.g[y],u.h--))}}function P(u,p,y,E){for(var B=0;B<u.length;++B){var J=u[B];if(!J.da&&J.listener==p&&J.capture==!!y&&J.ha==E)return B}return-1}var V="closure_lm_"+(1e6*Math.random()|0),H={};function K(u,p,y,E,B){if(E&&E.once)return ge(u,p,y,E,B);if(Array.isArray(p)){for(var J=0;J<p.length;J++)K(u,p[J],y,E,B);return null}return y=Fe(y),u&&u[Y]?u.K(p,y,c(E)?!!E.capture:!!E,B):Z(u,p,y,!1,E,B)}function Z(u,p,y,E,B,J){if(!p)throw Error("Invalid event type");var Ie=c(B)?!!B.capture:!!B,St=Te(u);if(St||(u[V]=St=new nt(u)),y=St.add(p,y,E,Ie,J),y.proxy)return y;if(E=ue(),y.proxy=E,E.src=u,E.listener=y,u.addEventListener)ht||(B=Ie),B===void 0&&(B=!1),u.addEventListener(p.toString(),E,B);else if(u.attachEvent)u.attachEvent(fe(p.toString()),E);else if(u.addListener&&u.removeListener)u.addListener(E);else throw Error("addEventListener and attachEvent are unavailable.");return y}function ue(){function u(y){return p.call(u.src,u.listener,y)}const p=Ve;return u}function ge(u,p,y,E,B){if(Array.isArray(p)){for(var J=0;J<p.length;J++)ge(u,p[J],y,E,B);return null}return y=Fe(y),u&&u[Y]?u.L(p,y,c(E)?!!E.capture:!!E,B):Z(u,p,y,!0,E,B)}function me(u,p,y,E,B){if(Array.isArray(p))for(var J=0;J<p.length;J++)me(u,p[J],y,E,B);else E=c(E)?!!E.capture:!!E,y=Fe(y),u&&u[Y]?(u=u.i,p=String(p).toString(),p in u.g&&(J=u.g[p],y=P(J,y,E,B),-1<y&&(Pe(J[y]),Array.prototype.splice.call(J,y,1),J.length==0&&(delete u.g[p],u.h--)))):u&&(u=Te(u))&&(p=u.g[p.toString()],u=-1,p&&(u=P(p,y,E,B)),(y=-1<u?p[u]:null)&&ye(y))}function ye(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[Y])vt(p.i,u);else{var y=u.type,E=u.proxy;p.removeEventListener?p.removeEventListener(y,E,u.capture):p.detachEvent?p.detachEvent(fe(y),E):p.addListener&&p.removeListener&&p.removeListener(E),(y=Te(p))?(vt(y,u),y.h==0&&(y.src=null,p[V]=null)):Pe(u)}}}function fe(u){return u in H?H[u]:H[u]="on"+u}function Ve(u,p){if(u.da)u=!0;else{p=new Pt(p,this);var y=u.listener,E=u.ha||u.src;u.fa&&ye(u),u=y.call(E,p)}return u}function Te(u){return u=u[V],u instanceof nt?u:null}var ke="__closure_events_fn_"+(1e9*Math.random()>>>0);function Fe(u){return typeof u=="function"?u:(u[ke]||(u[ke]=function(p){return u.handleEvent(p)}),u[ke])}function Ue(){re.call(this),this.i=new nt(this),this.M=this,this.F=null}x(Ue,re),Ue.prototype[Y]=!0,Ue.prototype.removeEventListener=function(u,p,y,E){me(this,u,p,y,E)};function We(u,p){var y,E=u.F;if(E)for(y=[];E;E=E.F)y.push(E);if(u=u.M,E=p.type||p,typeof p=="string")p=new Ne(p,u);else if(p instanceof Ne)p.target=p.target||u;else{var B=p;p=new Ne(E,u),k(p,B)}if(B=!0,y)for(var J=y.length-1;0<=J;J--){var Ie=p.g=y[J];B=rt(Ie,E,!0,p)&&B}if(Ie=p.g=u,B=rt(Ie,E,!0,p)&&B,B=rt(Ie,E,!1,p)&&B,y)for(J=0;J<y.length;J++)Ie=p.g=y[J],B=rt(Ie,E,!1,p)&&B}Ue.prototype.N=function(){if(Ue.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var y=u.g[p],E=0;E<y.length;E++)Pe(y[E]);delete u.g[p],u.h--}}this.F=null},Ue.prototype.K=function(u,p,y,E){return this.i.add(String(u),p,!1,y,E)},Ue.prototype.L=function(u,p,y,E){return this.i.add(String(u),p,!0,y,E)};function rt(u,p,y,E){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var B=!0,J=0;J<p.length;++J){var Ie=p[J];if(Ie&&!Ie.da&&Ie.capture==y){var St=Ie.listener,Vn=Ie.ha||Ie.src;Ie.fa&&vt(u.i,Ie),B=St.call(Vn,E)!==!1&&B}}return B&&!E.defaultPrevented}function nn(u,p,y){if(typeof u=="function")y&&(u=g(u,y));else if(u&&typeof u.handleEvent=="function")u=g(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(u,p||0)}function Bt(u){u.g=nn(()=>{u.g=null,u.i&&(u.i=!1,Bt(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class On extends re{constructor(p,y){super(),this.m=p,this.l=y,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Bt(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Jt(u){re.call(this),this.h=u,this.g={}}x(Jt,re);var Kr=[];function Vs(u){X(u.g,function(p,y){this.g.hasOwnProperty(y)&&ye(p)},u),u.g={}}Jt.prototype.N=function(){Jt.aa.N.call(this),Vs(this)},Jt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var _n=a.JSON.stringify,Pn=a.JSON.parse,vi=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function se(){}se.prototype.h=null;function j(u){return u.h||(u.h=u.i())}function be(){}var Le={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Je(){Ne.call(this,"d")}x(Je,Ne);function ze(){Ne.call(this,"c")}x(ze,Ne);var It={},yt=null;function Ut(){return yt=yt||new Ue}It.La="serverreachability";function Rn(u){Ne.call(this,It.La,u)}x(Rn,Ne);function Xn(u){const p=Ut();We(p,new Rn(p))}It.STAT_EVENT="statevent";function ot(u,p){Ne.call(this,It.STAT_EVENT,u),this.stat=p}x(ot,Ne);function Rt(u){const p=Ut();We(p,new ot(p,u))}It.Ma="timingevent";function Zn(u,p){Ne.call(this,It.Ma,u),this.size=p}x(Zn,Ne);function er(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function bn(){this.g=!0}bn.prototype.xa=function(){this.g=!1};function yo(u,p,y,E,B,J){u.info(function(){if(u.g)if(J)for(var Ie="",St=J.split("&"),Vn=0;Vn<St.length;Vn++){var Et=St[Vn].split("=");if(1<Et.length){var Fn=Et[0];Et=Et[1];var Mn=Fn.split("_");Ie=2<=Mn.length&&Mn[1]=="type"?Ie+(Fn+"="+Et+"&"):Ie+(Fn+"=redacted&")}}else Ie=null;else Ie=J;return"XMLHTTP REQ ("+E+") [attempt "+B+"]: "+p+`
`+y+`
`+Ie})}function ms(u,p,y,E,B,J,Ie){u.info(function(){return"XMLHTTP RESP ("+E+") [ attempt "+B+"]: "+p+`
`+y+`
`+J+" "+Ie})}function gs(u,p,y,E){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+cd(u,y)+(E?" "+E:"")})}function Yl(u,p){u.info(function(){return"TIMEOUT: "+p})}bn.prototype.info=function(){};function cd(u,p){if(!u.g)return p;if(!p)return null;try{var y=JSON.parse(p);if(y){for(u=0;u<y.length;u++)if(Array.isArray(y[u])){var E=y[u];if(!(2>E.length)){var B=E[1];if(Array.isArray(B)&&!(1>B.length)){var J=B[0];if(J!="noop"&&J!="stop"&&J!="close")for(var Ie=1;Ie<B.length;Ie++)B[Ie]=""}}}}return _n(y)}catch{return p}}var xa={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ia={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Xl;function Ea(){}x(Ea,se),Ea.prototype.g=function(){return new XMLHttpRequest},Ea.prototype.i=function(){return{}},Xl=new Ea;function vs(u,p,y,E){this.j=u,this.i=p,this.l=y,this.R=E||1,this.U=new Jt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new dd}function dd(){this.i=null,this.g="",this.h=!1}var Zl={},eu={};function Ta(u,p,y){u.L=1,u.v=Ir(pr(p)),u.m=y,u.P=!0,hd(u,null)}function hd(u,p){u.F=Date.now(),Vr(u),u.A=pr(u.v);var y=u.A,E=u.R;Array.isArray(E)||(E=[String(E)]),ou(y.i,"t",E),u.C=0,y=u.j.J,u.h=new dd,u.g=Io(u.j,y?p:null,!u.m),0<u.O&&(u.M=new On(g(u.Y,u,u.g),u.O)),p=u.U,y=u.g,E=u.ca;var B="readystatechange";Array.isArray(B)||(B&&(Kr[0]=B.toString()),B=Kr);for(var J=0;J<B.length;J++){var Ie=K(y,B[J],E||p.handleEvent,!1,p.h||p);if(!Ie)break;p.g[Ie.key]=Ie}p=u.H?b(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),Xn(),yo(u.i,u.u,u.A,u.l,u.R,u.m)}vs.prototype.ca=function(u){u=u.target;const p=this.M;p&&nr(u)==3?p.j():this.Y(u)},vs.prototype.Y=function(u){try{if(u==this.g)e:{const Mn=nr(this.g);var p=this.g.Ba();const Ti=this.g.Z();if(!(3>Mn)&&(Mn!=3||this.g&&(this.h.h||this.g.oa()||ws(this.g)))){this.J||Mn!=4||p==7||(p==8||0>=Ti?Xn(3):Xn(2)),Gr(this);var y=this.g.Z();this.X=y;t:if(tu(this)){var E=ws(this.g);u="";var B=E.length,J=nr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){tr(this),Wr(this);var Ie="";break t}this.h.i=new a.TextDecoder}for(p=0;p<B;p++)this.h.h=!0,u+=this.h.i.decode(E[p],{stream:!(J&&p==B-1)});E.length=0,this.h.g+=u,this.C=0,Ie=this.h.g}else Ie=this.g.oa();if(this.o=y==200,ms(this.i,this.u,this.A,this.l,this.R,Mn,y),this.o){if(this.T&&!this.K){t:{if(this.g){var St,Vn=this.g;if((St=Vn.g?Vn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!L(St)){var Et=St;break t}}Et=null}if(y=Et)gs(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Aa(this,y);else{this.o=!1,this.s=3,Rt(12),tr(this),Wr(this);break e}}if(this.P){y=!0;let Sr;for(;!this.J&&this.C<Ie.length;)if(Sr=zf(this,Ie),Sr==eu){Mn==4&&(this.s=4,Rt(14),y=!1),gs(this.i,this.l,null,"[Incomplete Response]");break}else if(Sr==Zl){this.s=4,Rt(15),gs(this.i,this.l,Ie,"[Invalid Chunk]"),y=!1;break}else gs(this.i,this.l,Sr,null),Aa(this,Sr);if(tu(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Mn!=4||Ie.length!=0||this.h.h||(this.s=1,Rt(16),y=!1),this.o=this.o&&y,!y)gs(this.i,this.l,Ie,"[Invalid Chunked Response]"),tr(this),Wr(this);else if(0<Ie.length&&!this.W){this.W=!0;var Fn=this.j;Fn.g==this&&Fn.ba&&!Fn.M&&(Fn.j.info("Great, no buffering proxy detected. Bytes received: "+Ie.length),fu(Fn),Fn.M=!0,Rt(11))}}else gs(this.i,this.l,Ie,null),Aa(this,Ie);Mn==4&&tr(this),this.o&&!this.J&&(Mn==4?bd(this.j,this):(this.o=!1,Vr(this)))}else Wf(this.g),y==400&&0<Ie.indexOf("Unknown SID")?(this.s=3,Rt(12)):(this.s=0,Rt(13)),tr(this),Wr(this)}}}catch{}finally{}};function tu(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function zf(u,p){var y=u.C,E=p.indexOf(`
`,y);return E==-1?eu:(y=Number(p.substring(y,E)),isNaN(y)?Zl:(E+=1,E+y>p.length?eu:(p=p.slice(E,E+y),u.C=E+y,p)))}vs.prototype.cancel=function(){this.J=!0,tr(this)};function Vr(u){u.S=Date.now()+u.I,ys(u,u.I)}function ys(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=er(g(u.ba,u),p)}function Gr(u){u.B&&(a.clearTimeout(u.B),u.B=null)}vs.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(Yl(this.i,this.A),this.L!=2&&(Xn(),Rt(17)),tr(this),this.s=2,Wr(this)):ys(this,this.S-u)};function Wr(u){u.j.G==0||u.J||bd(u.j,u)}function tr(u){Gr(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,Vs(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function Aa(u,p){try{var y=u.j;if(y.G!=0&&(y.g==u||Pa(y.h,u))){if(!u.K&&Pa(y.h,u)&&y.G==3){try{var E=y.Da.g.parse(p)}catch{E=null}if(Array.isArray(E)&&E.length==3){var B=E;if(B[0]==0){e:if(!y.u){if(y.g)if(y.g.F+3e3<u.F)Ei(y),Ii(y);else break e;hu(y),Rt(18)}}else y.za=B[1],0<y.za-y.T&&37500>B[2]&&y.F&&y.v==0&&!y.C&&(y.C=er(g(y.Za,y),6e3));if(1>=Mr(y.h)&&y.ca){try{y.ca()}catch{}y.ca=void 0}}else Ar(y,11)}else if((u.K||y.g==u)&&Ei(y),!L(p))for(B=y.Da.g.parse(p),p=0;p<B.length;p++){let Et=B[p];if(y.T=Et[0],Et=Et[1],y.G==2)if(Et[0]=="c"){y.K=Et[1],y.ia=Et[2];const Fn=Et[3];Fn!=null&&(y.la=Fn,y.j.info("VER="+y.la));const Mn=Et[4];Mn!=null&&(y.Aa=Mn,y.j.info("SVER="+y.Aa));const Ti=Et[5];Ti!=null&&typeof Ti=="number"&&0<Ti&&(E=1.5*Ti,y.L=E,y.j.info("backChannelRequestTimeoutMs_="+E)),E=y;const Sr=u.g;if(Sr){const Ua=Sr.g?Sr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ua){var J=E.h;J.g||Ua.indexOf("spdy")==-1&&Ua.indexOf("quic")==-1&&Ua.indexOf("h2")==-1||(J.j=J.l,J.g=new Set,J.h&&(Ra(J,J.h),J.h=null))}if(E.D){const yu=Sr.g?Sr.g.getResponseHeader("X-HTTP-Session-Id"):null;yu&&(E.ya=yu,Nt(E.I,E.D,yu))}}y.G=3,y.l&&y.l.ua(),y.ba&&(y.R=Date.now()-u.F,y.j.info("Handshake RTT: "+y.R+"ms")),E=y;var Ie=u;if(E.qa=xo(E,E.J?E.ia:null,E.W),Ie.K){Ca(E.h,Ie);var St=Ie,Vn=E.L;Vn&&(St.I=Vn),St.B&&(Gr(St),Vr(St)),E.g=Ie}else mr(E);0<y.i.length&&Va(y)}else Et[0]!="stop"&&Et[0]!="close"||Ar(y,7);else y.G==3&&(Et[0]=="stop"||Et[0]=="close"?Et[0]=="stop"?Ar(y,7):cu(y):Et[0]!="noop"&&y.l&&y.l.ta(Et),y.v=0)}}Xn(4)}catch{}}var Sa=class{constructor(u,p){this.g=u,this.map=p}};function yi(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function fd(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function Mr(u){return u.h?1:u.g?u.g.size:0}function Pa(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function Ra(u,p){u.g?u.g.add(p):u.h=p}function Ca(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}yi.prototype.cancel=function(){if(this.i=pd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function pd(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const y of u.g.values())p=p.concat(y.D);return p}return w(u.i)}function fr(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],y=u.length,E=0;E<y;E++)p.push(u[E]);return p}p=[],y=0;for(E in u)p[y++]=u[E];return p}function ka(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var y=0;y<u;y++)p.push(y);return p}p=[],y=0;for(const E in u)p[y++]=E;return p}}}function Lr(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var y=ka(u),E=fr(u),B=E.length,J=0;J<B;J++)p.call(void 0,E[J],y&&y[J],u)}var nu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function md(u,p){if(u){u=u.split("&");for(var y=0;y<u.length;y++){var E=u[y].indexOf("="),B=null;if(0<=E){var J=u[y].substring(0,E);B=u[y].substring(E+1)}else J=u[y];p(J,B?decodeURIComponent(B.replace(/\+/g," ")):"")}}}function $r(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof $r){this.h=u.h,Ms(this,u.j),this.o=u.o,this.g=u.g,ns(this,u.s),this.l=u.l;var p=u.i,y=new at;y.i=p.i,p.g&&(y.g=new Map(p.g),y.h=p.h),ru(this,y),this.m=u.m}else u&&(p=String(u).match(nu))?(this.h=!1,Ms(this,p[1]||"",!0),this.o=_o(p[2]||""),this.g=_o(p[3]||"",!0),ns(this,p[4]),this.l=_o(p[5]||"",!0),ru(this,p[6]||"",!0),this.m=_o(p[7]||"")):(this.h=!1,this.i=new at(null,this.h))}$r.prototype.toString=function(){var u=[],p=this.j;p&&u.push(bo(p,su,!0),":");var y=this.g;return(y||p=="file")&&(u.push("//"),(p=this.o)&&u.push(bo(p,su,!0),"@"),u.push(encodeURIComponent(String(y)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.s,y!=null&&u.push(":",String(y))),(y=this.l)&&(this.g&&y.charAt(0)!="/"&&u.push("/"),u.push(bo(y,y.charAt(0)=="/"?Na:Da,!0))),(y=this.i.toString())&&u.push("?",y),(y=this.m)&&u.push("#",bo(y,Me)),u.join("")};function pr(u){return new $r(u)}function Ms(u,p,y){u.j=y?_o(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function ns(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function ru(u,p,y){p instanceof at?(u.i=p,Kf(u.i,u.h)):(y||(p=bo(p,iu)),u.i=new at(p,u.h))}function Nt(u,p,y){u.i.set(p,y)}function Ir(u){return Nt(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function _o(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function bo(u,p,y){return typeof u=="string"?(u=encodeURI(u).replace(p,Hf),y&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Hf(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var su=/[#\/\?@]/g,Da=/[#\?:]/g,Na=/[#\?]/g,iu=/[#\?@]/g,Me=/#/g;function at(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Cn(u){u.g||(u.g=new Map,u.h=0,u.i&&md(u.i,function(p,y){u.add(decodeURIComponent(p.replace(/\+/g," ")),y)}))}n=at.prototype,n.add=function(u,p){Cn(this),this.i=null,u=_i(this,u);var y=this.g.get(u);return y||this.g.set(u,y=[]),y.push(p),this.h+=1,this};function Ls(u,p){Cn(u),p=_i(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function gd(u,p){return Cn(u),p=_i(u,p),u.g.has(p)}n.forEach=function(u,p){Cn(this),this.g.forEach(function(y,E){y.forEach(function(B){u.call(p,B,E,this)},this)},this)},n.na=function(){Cn(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),y=[];for(let E=0;E<p.length;E++){const B=u[E];for(let J=0;J<B.length;J++)y.push(p[E])}return y},n.V=function(u){Cn(this);let p=[];if(typeof u=="string")gd(this,u)&&(p=p.concat(this.g.get(_i(this,u))));else{u=Array.from(this.g.values());for(let y=0;y<u.length;y++)p=p.concat(u[y])}return p},n.set=function(u,p){return Cn(this),this.i=null,u=_i(this,u),gd(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function ou(u,p,y){Ls(u,p),0<y.length&&(u.i=null,u.g.set(_i(u,p),w(y)),u.h+=y.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var y=0;y<p.length;y++){var E=p[y];const J=encodeURIComponent(String(E)),Ie=this.V(E);for(E=0;E<Ie.length;E++){var B=J;Ie[E]!==""&&(B+="="+encodeURIComponent(String(Ie[E]))),u.push(B)}}return this.i=u.join("&")};function _i(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function Kf(u,p){p&&!u.j&&(Cn(u),u.i=null,u.g.forEach(function(y,E){var B=E.toLowerCase();E!=B&&(Ls(this,E),ou(this,B,y))},u)),u.j=p}function au(u,p){const y=new bn;if(a.Image){const E=new Image;E.onload=v(Er,y,"TestLoadImage: loaded",!0,p,E),E.onerror=v(Er,y,"TestLoadImage: error",!1,p,E),E.onabort=v(Er,y,"TestLoadImage: abort",!1,p,E),E.ontimeout=v(Er,y,"TestLoadImage: timeout",!1,p,E),a.setTimeout(function(){E.ontimeout&&E.ontimeout()},1e4),E.src=u}else p(!1)}function Gf(u,p){const y=new bn,E=new AbortController,B=setTimeout(()=>{E.abort(),Er(y,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:E.signal}).then(J=>{clearTimeout(B),J.ok?Er(y,"TestPingServer: ok",!0,p):Er(y,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(B),Er(y,"TestPingServer: error",!1,p)})}function Er(u,p,y,E,B){try{B&&(B.onload=null,B.onerror=null,B.onabort=null,B.ontimeout=null),E(y)}catch{}}function Oa(){this.g=new vi}function bi(u,p,y){const E=y||"";try{Lr(u,function(B,J){let Ie=B;c(B)&&(Ie=_n(B)),p.push(E+J+"="+encodeURIComponent(Ie))})}catch(B){throw p.push(E+"type="+encodeURIComponent("_badmap")),B}}function rs(u){this.l=u.Ub||null,this.j=u.eb||!1}x(rs,se),rs.prototype.g=function(){return new _s(this.l,this.j)},rs.prototype.i=function(u){return function(){return u}}({});function _s(u,p){Ue.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(_s,Ue),n=_s.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,wo(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,bs(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,wo(this)),this.g&&(this.readyState=3,wo(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;wi(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function wi(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?bs(this):wo(this),this.readyState==3&&wi(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,bs(this))},n.Qa=function(u){this.g&&(this.response=u,bs(this))},n.ga=function(){this.g&&bs(this)};function bs(u){u.readyState=4,u.l=null,u.j=null,u.v=null,wo(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var y=p.next();!y.done;)y=y.value,u.push(y[0]+": "+y[1]),y=p.next();return u.join(`\r
`)};function wo(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(_s.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function vd(u){let p="";return X(u,function(y,E){p+=E,p+=":",p+=y,p+=`\r
`}),p}function lu(u,p,y){e:{for(E in y){var E=!1;break e}E=!0}E||(y=vd(y),typeof u=="string"?y!=null&&encodeURIComponent(String(y)):Nt(u,p,y))}function Yt(u){Ue.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(Yt,Ue);var Ze=/^https?$/i,pt=["POST","PUT"];n=Yt.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,y,E){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Xl.g(),this.v=this.o?j(this.o):j(Xl),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(J){ln(this,J);return}if(u=y||"",y=new Map(this.headers),E)if(Object.getPrototypeOf(E)===Object.prototype)for(var B in E)y.set(B,E[B]);else if(typeof E.keys=="function"&&typeof E.get=="function")for(const J of E.keys())y.set(J,E.get(J));else throw Error("Unknown input type for opt_headers: "+String(E));E=Array.from(y.keys()).find(J=>J.toLowerCase()=="content-type"),B=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(pt,p,void 0))||E||B||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[J,Ie]of y)this.g.setRequestHeader(J,Ie);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{uu(this),this.u=!0,this.g.send(u),this.u=!1}catch(J){ln(this,J)}};function ln(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,At(u),xi(u)}function At(u){u.A||(u.A=!0,We(u,"complete"),We(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,We(this,"complete"),We(this,"abort"),xi(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),xi(this,!0)),Yt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?yd(this):this.bb())},n.bb=function(){yd(this)};function yd(u){if(u.h&&typeof o<"u"&&(!u.v[1]||nr(u)!=4||u.Z()!=2)){if(u.u&&nr(u)==4)nn(u.Ea,0,u);else if(We(u,"readystatechange"),nr(u)==4){u.h=!1;try{const Ie=u.Z();e:switch(Ie){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var y;if(!(y=p)){var E;if(E=Ie===0){var B=String(u.D).match(nu)[1]||null;!B&&a.self&&a.self.location&&(B=a.self.location.protocol.slice(0,-1)),E=!Ze.test(B?B.toLowerCase():"")}y=E}if(y)We(u,"complete"),We(u,"success");else{u.m=6;try{var J=2<nr(u)?u.g.statusText:""}catch{J=""}u.l=J+" ["+u.Z()+"]",At(u)}}finally{xi(u)}}}}function xi(u,p){if(u.g){uu(u);const y=u.g,E=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||We(u,"ready");try{y.onreadystatechange=E}catch{}}}function uu(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function nr(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<nr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),Pn(p)}};function ws(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Wf(u){const p={};u=(u.g&&2<=nr(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let E=0;E<u.length;E++){if(L(u[E]))continue;var y=F(u[E]);const B=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const J=p[B]||[];p[B]=J,J.push(y)}A(p,function(E){return E.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Qr(u,p,y){return y&&y.internalChannelParams&&y.internalChannelParams[u]||p}function Tr(u){this.Aa=0,this.i=[],this.j=new bn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Qr("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Qr("baseRetryDelayMs",5e3,u),this.cb=Qr("retryDelaySeedMs",1e4,u),this.Wa=Qr("forwardChannelMaxRetries",2,u),this.wa=Qr("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new yi(u&&u.concurrentRequestLimit),this.Da=new Oa,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Tr.prototype,n.la=8,n.G=1,n.connect=function(u,p,y,E){Rt(0),this.W=u,this.H=p||{},y&&E!==void 0&&(this.H.OSID=y,this.H.OAID=E),this.F=this.X,this.I=xo(this,null,this.W),Va(this)};function cu(u){if(_d(u),u.G==3){var p=u.U++,y=pr(u.I);if(Nt(y,"SID",u.K),Nt(y,"RID",p),Nt(y,"TYPE","terminate"),xs(u,y),p=new vs(u,u.j,p),p.L=2,p.v=Ir(pr(y)),y=!1,a.navigator&&a.navigator.sendBeacon)try{y=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!y&&a.Image&&(new Image().src=p.v,y=!0),y||(p.g=Io(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Vr(p)}La(u)}function Ii(u){u.g&&(fu(u),u.g.cancel(),u.g=null)}function _d(u){Ii(u),u.u&&(a.clearTimeout(u.u),u.u=null),Ei(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function Va(u){if(!fd(u.h)&&!u.s){u.s=!0;var p=u.Ga;Ge||Qe(),Ae||(Ge(),Ae=!0),he.add(p,u),u.B=0}}function Qf(u,p){return Mr(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=er(g(u.Ga,u,p),mu(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const B=new vs(this,this.j,u);let J=this.o;if(this.S&&(J?(J=b(J),k(J,this.S)):J=this.S),this.m!==null||this.O||(B.H=J,J=null),this.P)e:{for(var p=0,y=0;y<this.i.length;y++){t:{var E=this.i[y];if("__data__"in E.map&&(E=E.map.__data__,typeof E=="string")){E=E.length;break t}E=void 0}if(E===void 0)break;if(p+=E,4096<p){p=y;break e}if(p===4096||y===this.i.length-1){p=y+1;break e}}p=1e3}else p=1e3;p=Ma(this,B,p),y=pr(this.I),Nt(y,"RID",u),Nt(y,"CVER",22),this.D&&Nt(y,"X-HTTP-Session-Id",this.D),xs(this,y),J&&(this.O?p="headers="+encodeURIComponent(String(vd(J)))+"&"+p:this.m&&lu(y,this.m,J)),Ra(this.h,B),this.Ua&&Nt(y,"TYPE","init"),this.P?(Nt(y,"$req",p),Nt(y,"SID","null"),B.T=!0,Ta(B,y,null)):Ta(B,y,p),this.G=2}}else this.G==3&&(u?du(this,u):this.i.length==0||fd(this.h)||du(this))};function du(u,p){var y;p?y=p.l:y=u.U++;const E=pr(u.I);Nt(E,"SID",u.K),Nt(E,"RID",y),Nt(E,"AID",u.T),xs(u,E),u.m&&u.o&&lu(E,u.m,u.o),y=new vs(u,u.j,y,u.B+1),u.m===null&&(y.H=u.o),p&&(u.i=p.D.concat(u.i)),p=Ma(u,y,1e3),y.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),Ra(u.h,y),Ta(y,E,p)}function xs(u,p){u.H&&X(u.H,function(y,E){Nt(p,E,y)}),u.l&&Lr({},function(y,E){Nt(p,E,y)})}function Ma(u,p,y){y=Math.min(u.i.length,y);var E=u.l?g(u.l.Na,u.l,u):null;e:{var B=u.i;let J=-1;for(;;){const Ie=["count="+y];J==-1?0<y?(J=B[0].g,Ie.push("ofs="+J)):J=0:Ie.push("ofs="+J);let St=!0;for(let Vn=0;Vn<y;Vn++){let Et=B[Vn].g;const Fn=B[Vn].map;if(Et-=J,0>Et)J=Math.max(0,B[Vn].g-100),St=!1;else try{bi(Fn,Ie,"req"+Et+"_")}catch{E&&E(Fn)}}if(St){E=Ie.join("&");break e}}}return u=u.i.splice(0,y),p.D=u,E}function mr(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;Ge||Qe(),Ae||(Ge(),Ae=!0),he.add(p,u),u.v=0}}function hu(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=er(g(u.Fa,u),mu(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,pu(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=er(g(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Rt(10),Ii(this),pu(this))};function fu(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function pu(u){u.g=new vs(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=pr(u.qa);Nt(p,"RID","rpc"),Nt(p,"SID",u.K),Nt(p,"AID",u.T),Nt(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&Nt(p,"TO",u.ja),Nt(p,"TYPE","xmlhttp"),xs(u,p),u.m&&u.o&&lu(p,u.m,u.o),u.L&&(u.g.I=u.L);var y=u.g;u=u.ia,y.L=1,y.v=Ir(pr(p)),y.m=null,y.P=!0,hd(y,u)}n.Za=function(){this.C!=null&&(this.C=null,Ii(this),hu(this),Rt(19))};function Ei(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function bd(u,p){var y=null;if(u.g==p){Ei(u),fu(u),u.g=null;var E=2}else if(Pa(u.h,p))y=p.D,Ca(u.h,p),E=1;else return;if(u.G!=0){if(p.o)if(E==1){y=p.m?p.m.length:0,p=Date.now()-p.F;var B=u.B;E=Ut(),We(E,new Zn(E,y)),Va(u)}else mr(u);else if(B=p.s,B==3||B==0&&0<p.X||!(E==1&&Qf(u,p)||E==2&&hu(u)))switch(y&&0<y.length&&(p=u.h,p.i=p.i.concat(y)),B){case 1:Ar(u,5);break;case 4:Ar(u,10);break;case 3:Ar(u,6);break;default:Ar(u,2)}}}function mu(u,p){let y=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(y*=2),y*p}function Ar(u,p){if(u.j.info("Error code "+p),p==2){var y=g(u.fb,u),E=u.Xa;const B=!E;E=new $r(E||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Ms(E,"https"),Ir(E),B?au(E.toString(),y):Gf(E.toString(),y)}else Rt(2);u.G=0,u.l&&u.l.sa(p),La(u),_d(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),Rt(2)):(this.j.info("Failed to ping google.com"),Rt(1))};function La(u){if(u.G=0,u.ka=[],u.l){const p=pd(u.h);(p.length!=0||u.i.length!=0)&&(I(u.ka,p),I(u.ka,u.i),u.h.i.length=0,w(u.i),u.i.length=0),u.l.ra()}}function xo(u,p,y){var E=y instanceof $r?pr(y):new $r(y);if(E.g!="")p&&(E.g=p+"."+E.g),ns(E,E.s);else{var B=a.location;E=B.protocol,p=p?p+"."+B.hostname:B.hostname,B=+B.port;var J=new $r(null);E&&Ms(J,E),p&&(J.g=p),B&&ns(J,B),y&&(J.l=y),E=J}return y=u.D,p=u.ya,y&&p&&Nt(E,y,p),Nt(E,"VER",u.la),xs(u,E),E}function Io(u,p,y){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new Yt(new rs({eb:y})):new Yt(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function gu(){}n=gu.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function $a(){}$a.prototype.g=function(u,p){return new gr(u,p)};function gr(u,p){Ue.call(this),this.g=new Tr(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!L(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!L(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new ss(this)}x(gr,Ue),gr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},gr.prototype.close=function(){cu(this.g)},gr.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var y={};y.__data__=u,u=y}else this.u&&(y={},y.__data__=_n(u),u=y);p.i.push(new Sa(p.Ya++,u)),p.G==3&&Va(p)},gr.prototype.N=function(){this.g.l=null,delete this.j,cu(this.g),delete this.g,gr.aa.N.call(this)};function vu(u){Je.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const y in p){u=y;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}x(vu,Je);function Fa(){ze.call(this),this.status=1}x(Fa,ze);function ss(u){this.g=u}x(ss,gu),ss.prototype.ua=function(){We(this.g,"a")},ss.prototype.ta=function(u){We(this.g,new vu(u))},ss.prototype.sa=function(u){We(this.g,new Fa)},ss.prototype.ra=function(){We(this.g,"b")},$a.prototype.createWebChannel=$a.prototype.g,gr.prototype.send=gr.prototype.o,gr.prototype.open=gr.prototype.m,gr.prototype.close=gr.prototype.close,dI=function(){return new $a},cI=function(){return Ut()},uI=It,cm={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},xa.NO_ERROR=0,xa.TIMEOUT=8,xa.HTTP_ERROR=6,Kd=xa,Ia.COMPLETE="complete",lI=Ia,be.EventType=Le,Le.OPEN="a",Le.CLOSE="b",Le.ERROR="c",Le.MESSAGE="d",Ue.prototype.listen=Ue.prototype.K,Vu=be,Yt.prototype.listenOnce=Yt.prototype.L,Yt.prototype.getLastError=Yt.prototype.Ka,Yt.prototype.getLastErrorCode=Yt.prototype.Ba,Yt.prototype.getStatus=Yt.prototype.Z,Yt.prototype.getResponseJson=Yt.prototype.Oa,Yt.prototype.getResponseText=Yt.prototype.oa,Yt.prototype.send=Yt.prototype.ea,Yt.prototype.setWithCredentials=Yt.prototype.Ha,aI=Yt}).apply(typeof Sd<"u"?Sd:typeof self<"u"?self:typeof window<"u"?window:{});const e_="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}jn.UNAUTHENTICATED=new jn(null),jn.GOOGLE_CREDENTIALS=new jn("google-credentials-uid"),jn.FIRST_PARTY=new jn("first-party-uid"),jn.MOCK_USER=new jn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $l="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const to=new fg("@firebase/firestore");function Ja(){return to.logLevel}function DK(n){to.setLogLevel(n)}function ce(n,...e){if(to.logLevel<=_t.DEBUG){const t=e.map(Ig);to.debug(`Firestore (${$l}): ${n}`,...t)}}function In(n,...e){if(to.logLevel<=_t.ERROR){const t=e.map(Ig);to.error(`Firestore (${$l}): ${n}`,...t)}}function es(n,...e){if(to.logLevel<=_t.WARN){const t=e.map(Ig);to.warn(`Firestore (${$l}): ${n}`,...t)}}function Ig(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ce(n="Unexpected state"){const e=`FIRESTORE (${$l}) INTERNAL ASSERTION FAILED: `+n;throw In(e),new Error(e)}function Oe(n,e){n||Ce()}function NK(n,e){n||Ce()}function Ee(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class de extends ps{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hI{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class wD{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(jn.UNAUTHENTICATED))}shutdown(){}}class xD{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class ID{constructor(e){this.t=e,this.currentUser=jn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Oe(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new qn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new qn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{ce("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(ce("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new qn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(ce("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Oe(typeof r.accessToken=="string"),new hI(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Oe(e===null||typeof e=="string"),new jn(e)}}class ED{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=jn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class TD{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new ED(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(jn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class fI{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class AD{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Oe(this.o===void 0);const r=i=>{i.error!=null&&ce("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,ce("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{ce("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):ce("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Oe(typeof t.token=="string"),this.R=t.token,new fI(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class OK{getToken(){return Promise.resolve(new fI(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SD(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pI{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=SD(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Xe(n,e){return n<e?-1:n>e?1:0}function yl(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function mI(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new de(Q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new de(Q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new de(Q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new de(Q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return dn.fromMillis(Date.now())}static fromDate(e){return dn.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new dn(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Xe(this.nanoseconds,e.nanoseconds):Xe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $e{constructor(e){this.timestamp=e}static fromTimestamp(e){return new $e(e)}static min(){return new $e(new dn(0,0))}static max(){return new $e(new dn(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _c{constructor(e,t,r){t===void 0?t=0:t>e.length&&Ce(),r===void 0?r=e.length-t:r>e.length-t&&Ce(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return _c.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof _c?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class bt extends _c{construct(e,t,r){return new bt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new de(Q.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new bt(t)}static emptyPath(){return new bt([])}}const PD=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class on extends _c{construct(e,t,r){return new on(e,t,r)}static isValidIdentifier(e){return PD.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),on.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new on(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new de(Q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new de(Q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new de(Q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new de(Q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new on(t)}static emptyPath(){return new on([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Se{constructor(e){this.path=e}static fromPath(e){return new Se(bt.fromString(e))}static fromName(e){return new Se(bt.fromString(e).popFirst(5))}static empty(){return new Se(bt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&bt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return bt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Se(new bt(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _l{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function dm(n){return n.fields.find(e=>e.kind===2)}function Oo(n){return n.fields.filter(e=>e.kind!==2)}function RD(n,e){let t=Xe(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=CD(n.fields[r],e.fields[r]),t!==0)return t;return Xe(n.fields.length,e.fields.length)}_l.UNKNOWN_ID=-1;class Wo{constructor(e,t){this.fieldPath=e,this.kind=t}}function CD(n,e){const t=on.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Xe(n.kind,e.kind)}class bl{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new bl(0,Hr.min())}}function gI(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=$e.fromTimestamp(r===1e9?new dn(t+1,0):new dn(t,r));return new Hr(s,Se.empty(),e)}function vI(n){return new Hr(n.readTime,n.key,-1)}class Hr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Hr($e.min(),Se.empty(),-1)}static max(){return new Hr($e.max(),Se.empty(),-1)}}function Eg(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Se.comparator(n.documentKey,e.documentKey),t!==0?t:Xe(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class _I{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ho(n){if(n.code!==Q.FAILED_PRECONDITION||n.message!==yI)throw n;ce("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ce(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new z((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof z?t:z.resolve(t)}catch(t){return z.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):z.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):z.reject(t)}static resolve(e){return new z((t,r)=>{t(e)})}static reject(e){return new z((t,r)=>{r(e)})}static waitFor(e){return new z((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=z.resolve(!1);for(const r of e)t=t.next(s=>s?z.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new z((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(h=>{o[c]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new z((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class of{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new qn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Qu(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=Tg(r.target.error);this.V.reject(new Qu(e,s))}}static open(e,t,r,s){try{return new of(t,e.transaction(s,r))}catch(i){throw new Qu(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(ce("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new DD(t)}}class ks{constructor(e,t,r){this.name=e,this.version=t,this.p=r,ks.S(Ln())===12.2&&In("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return ce("SimpleDb","Removing database:",e),$o(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!hg())return!1;if(ks.v())return!0;const e=Ln(),t=ks.S(e),r=0<t&&t<10,s=bI(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(ce("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Qu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new de(Q.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new de(Q.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Qu(e,o))},s.onupgradeneeded=i=>{ce("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{ce("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=of.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),z.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(ce("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function bI(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class kD{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return $o(this.B.delete())}}class Qu extends de{constructor(e,t){super(Q.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function fo(n){return n.name==="IndexedDbTransactionError"}class DD{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(ce("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(ce("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),$o(r)}add(e){return ce("SimpleDb","ADD",this.store.name,e,e),$o(this.store.add(e))}get(e){return $o(this.store.get(e)).next(t=>(t===void 0&&(t=null),ce("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return ce("SimpleDb","DELETE",this.store.name,e),$o(this.store.delete(e))}count(){return ce("SimpleDb","COUNT",this.store.name),$o(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new z((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new z((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){ce("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new z((r,s)=>{t.onerror=i=>{const o=Tg(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new z((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new kD(a),c=t(a.primaryKey,a.value,l);if(c instanceof z){const h=c.catch(f=>(l.done(),z.reject(f)));r.push(h)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>z.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function $o(n){return new z((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Tg(r.target.error);t(s)}})}let t_=!1;function Tg(n){const e=ks.S(Ln());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new de("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return t_||(t_=!0,setTimeout(()=>{throw r},0)),r}}return n}class ND{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){ce("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{ce("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){fo(t)?ce("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await ho(t)}await this.X(6e4)})}}class OD{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return z.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return ce("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(ce("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=vI(i);Eg(o,r)>0&&(r=o)}),new Hr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Cr.oe=-1;function jc(n){return n==null}function bc(n){return n===0&&1/n==-1/0}function wI(n){return typeof n=="number"&&Number.isInteger(n)&&!bc(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cr(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=n_(e)),e=VD(n.get(t),e);return n_(e)}function VD(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function n_(n){return n+""}function As(n){const e=n.length;if(Oe(e>=2),e===2)return Oe(n.charAt(0)===""&&n.charAt(1)===""),bt.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&Ce(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:Ce()}i=o+2}return new bt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r_=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gd(n,e){return[n,cr(e)]}function xI(n,e,t){return[n,cr(e),t]}const MD={},LD=["prefixPath","collectionGroup","readTime","documentId"],$D=["prefixPath","collectionGroup","documentId"],FD=["collectionGroup","readTime","prefixPath","documentId"],UD=["canonicalId","targetId"],jD=["targetId","path"],BD=["path","targetId"],qD=["collectionId","parent"],zD=["indexId","uid"],HD=["uid","sequenceNumber"],KD=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],GD=["indexId","uid","orderedDocumentKey"],WD=["userId","collectionPath","documentId"],QD=["userId","collectionPath","largestBatchId"],JD=["userId","collectionGroup","largestBatchId"],II=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],YD=[...II,"documentOverlays"],EI=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],TI=EI,Ag=[...TI,"indexConfiguration","indexState","indexEntries"],XD=Ag,ZD=[...Ag,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hm extends _I{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function $n(n,e){const t=Ee(n);return ks.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s_(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function po(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function AI(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function SI(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qt{constructor(e,t){this.comparator=e,this.root=t||Kn.EMPTY}insert(e,t){return new Qt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Kn.BLACK,null,null))}remove(e){return new Qt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Kn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Pd(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Pd(this.root,e,this.comparator,!1)}getReverseIterator(){return new Pd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Pd(this.root,e,this.comparator,!0)}}class Pd{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Kn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Kn.RED,this.left=s??Kn.EMPTY,this.right=i??Kn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Kn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Kn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Kn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Kn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Kn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ce();const e=this.left.check();if(e!==this.right.check())throw Ce();return e+(this.isRed()?0:1)}}Kn.EMPTY=null,Kn.RED=!0,Kn.BLACK=!1;Kn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ce()}get value(){throw Ce()}get color(){throw Ce()}get left(){throw Ce()}get right(){throw Ce()}copy(e,t,r,s,i){return this}insert(e,t,r){return new Kn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e){this.comparator=e,this.data=new Qt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new i_(this.data.getIterator())}getIteratorFrom(e){return new i_(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof jt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new jt(this.comparator);return t.data=e,t}}class i_{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function za(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kr{constructor(e){this.fields=e,e.sort(on.comparator)}static empty(){return new kr([])}unionWith(e){let t=new jt(on.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new kr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return yl(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PI extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MK(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new PI("Invalid base64 string: "+i):i}}(e);return new mn(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new mn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Xe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}mn.EMPTY_BYTE_STRING=new mn("");const eN=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function si(n){if(Oe(!!n),typeof n=="string"){let e=0;const t=eN.exec(n);if(Oe(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:sn(n.seconds),nanos:sn(n.nanos)}}function sn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ii(n){return typeof n=="string"?mn.fromBase64String(n):mn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function af(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function lf(n){const e=n.mapValue.fields.__previous_value__;return af(e)?lf(e):e}function wc(n){const e=si(n.mapValue.fields.__local_write_time__.timestampValue);return new dn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tN{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class ea{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ea("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ea&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ki={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Wd={nullValue:"NULL_VALUE"};function no(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?af(n)?4:RI(n)?9007199254740991:uf(n)?10:11:Ce()}function Os(n,e){if(n===e)return!0;const t=no(n);if(t!==no(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return wc(n).isEqual(wc(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=si(s.timestampValue),a=si(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return ii(s.bytesValue).isEqual(ii(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return sn(s.geoPointValue.latitude)===sn(i.geoPointValue.latitude)&&sn(s.geoPointValue.longitude)===sn(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return sn(s.integerValue)===sn(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=sn(s.doubleValue),a=sn(i.doubleValue);return o===a?bc(o)===bc(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return yl(n.arrayValue.values||[],e.arrayValue.values||[],Os);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(s_(o)!==s_(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Os(o[l],a[l])))return!1;return!0}(n,e);default:return Ce()}}function xc(n,e){return(n.values||[]).find(t=>Os(t,e))!==void 0}function ro(n,e){if(n===e)return 0;const t=no(n),r=no(e);if(t!==r)return Xe(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Xe(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=sn(i.integerValue||i.doubleValue),l=sn(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return o_(n.timestampValue,e.timestampValue);case 4:return o_(wc(n),wc(e));case 5:return Xe(n.stringValue,e.stringValue);case 6:return function(i,o){const a=ii(i),l=ii(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const h=Xe(a[c],l[c]);if(h!==0)return h}return Xe(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Xe(sn(i.latitude),sn(o.latitude));return a!==0?a:Xe(sn(i.longitude),sn(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return a_(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,h;const f=i.fields||{},g=o.fields||{},v=(a=f.value)===null||a===void 0?void 0:a.arrayValue,x=(l=g.value)===null||l===void 0?void 0:l.arrayValue,w=Xe(((c=v==null?void 0:v.values)===null||c===void 0?void 0:c.length)||0,((h=x==null?void 0:x.values)===null||h===void 0?void 0:h.length)||0);return w!==0?w:a_(v,x)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Ki.mapValue&&o===Ki.mapValue)return 0;if(i===Ki.mapValue)return 1;if(o===Ki.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},h=Object.keys(c);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const g=Xe(l[f],h[f]);if(g!==0)return g;const v=ro(a[l[f]],c[h[f]]);if(v!==0)return v}return Xe(l.length,h.length)}(n.mapValue,e.mapValue);default:throw Ce()}}function o_(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Xe(n,e);const t=si(n),r=si(e),s=Xe(t.seconds,r.seconds);return s!==0?s:Xe(t.nanos,r.nanos)}function a_(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=ro(t[s],r[s]);if(i)return i}return Xe(t.length,r.length)}function wl(n){return fm(n)}function fm(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=si(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ii(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Se.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=fm(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${fm(t.fields[o])}`;return s+"}"}(n.mapValue):Ce()}function Qd(n){switch(no(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=lf(n);return e?16+Qd(e):16;case 5:return 2*n.stringValue.length;case 6:return ii(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Qd(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return po(r.fields,(i,o)=>{s+=i.length+Qd(o)}),s}(n.mapValue);default:throw Ce()}}function ta(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function pm(n){return!!n&&"integerValue"in n}function Ic(n){return!!n&&"arrayValue"in n}function l_(n){return!!n&&"nullValue"in n}function u_(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Jd(n){return!!n&&"mapValue"in n}function uf(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Ju(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return po(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ju(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ju(n.arrayValue.values[t]);return e}return Object.assign({},n)}function RI(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const CI={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function nN(n){return"nullValue"in n?Wd:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?ta(ea.empty(),Se.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?uf(n)?CI:{mapValue:{}}:Ce()}function rN(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?ta(ea.empty(),Se.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?CI:"mapValue"in n?uf(n)?{mapValue:{}}:Ki:Ce()}function c_(n,e){const t=ro(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function d_(n,e){const t=ro(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{constructor(e){this.value=e}static empty(){return new Qn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Jd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ju(t)}setAll(e){let t=on.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Ju(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Jd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Os(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Jd(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){po(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Qn(Ju(this.value))}}function kI(n){const e=[];return po(n.fields,(t,r)=>{const s=new on([t]);if(Jd(r)){const i=kI(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new kr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Xt(e,0,$e.min(),$e.min(),$e.min(),Qn.empty(),0)}static newFoundDocument(e,t,r,s){return new Xt(e,1,t,$e.min(),r,s,0)}static newNoDocument(e,t){return new Xt(e,2,t,$e.min(),$e.min(),Qn.empty(),0)}static newUnknownDocument(e,t){return new Xt(e,3,t,$e.min(),$e.min(),Qn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($e.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Qn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Qn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$e.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Xt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Xt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class so{constructor(e,t){this.position=e,this.inclusive=t}}function h_(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=Se.comparator(Se.fromName(o.referenceValue),t.key):r=ro(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function f_(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Os(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ec{constructor(e,t="asc"){this.field=e,this.dir=t}}function sN(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DI{}class wt extends DI{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new iN(e,t,r):t==="array-contains"?new lN(e,r):t==="in"?new $I(e,r):t==="not-in"?new uN(e,r):t==="array-contains-any"?new cN(e,r):new wt(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new oN(e,r):new aN(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(ro(t,this.value)):t!==null&&no(this.value)===no(t)&&this.matchesComparison(ro(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ce()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ft extends DI{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Ft(e,t)}matches(e){return xl(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function xl(n){return n.op==="and"}function mm(n){return n.op==="or"}function Sg(n){return NI(n)&&xl(n)}function NI(n){for(const e of n.filters)if(e instanceof Ft)return!1;return!0}function gm(n){if(n instanceof wt)return n.field.canonicalString()+n.op.toString()+wl(n.value);if(Sg(n))return n.filters.map(e=>gm(e)).join(",");{const e=n.filters.map(t=>gm(t)).join(",");return`${n.op}(${e})`}}function OI(n,e){return n instanceof wt?function(r,s){return s instanceof wt&&r.op===s.op&&r.field.isEqual(s.field)&&Os(r.value,s.value)}(n,e):n instanceof Ft?function(r,s){return s instanceof Ft&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&OI(o,s.filters[a]),!0):!1}(n,e):void Ce()}function VI(n,e){const t=n.filters.concat(e);return Ft.create(t,n.op)}function MI(n){return n instanceof wt?function(t){return`${t.field.canonicalString()} ${t.op} ${wl(t.value)}`}(n):n instanceof Ft?function(t){return t.op.toString()+" {"+t.getFilters().map(MI).join(" ,")+"}"}(n):"Filter"}class iN extends wt{constructor(e,t,r){super(e,t,r),this.key=Se.fromName(r.referenceValue)}matches(e){const t=Se.comparator(e.key,this.key);return this.matchesComparison(t)}}class oN extends wt{constructor(e,t){super(e,"in",t),this.keys=LI("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class aN extends wt{constructor(e,t){super(e,"not-in",t),this.keys=LI("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function LI(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Se.fromName(r.referenceValue))}class lN extends wt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ic(t)&&xc(t.arrayValue,this.value)}}class $I extends wt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&xc(this.value.arrayValue,t)}}class uN extends wt{constructor(e,t){super(e,"not-in",t)}matches(e){if(xc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!xc(this.value.arrayValue,t)}}class cN extends wt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ic(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>xc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dN{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function vm(n,e=null,t=[],r=[],s=null,i=null,o=null){return new dN(n,e,t,r,s,i,o)}function na(n){const e=Ee(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>gm(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),jc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>wl(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>wl(r)).join(",")),e.ue=t}return e.ue}function Bc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!sN(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!OI(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!f_(n.startAt,e.startAt)&&f_(n.endAt,e.endAt)}function yh(n){return Se.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function _h(n,e){return n.filters.filter(t=>t instanceof wt&&t.field.isEqual(e))}function p_(n,e,t){let r=Wd,s=!0;for(const i of _h(n,e)){let o=Wd,a=!0;switch(i.op){case"<":case"<=":o=nN(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Wd}c_({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];c_({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function m_(n,e,t){let r=Ki,s=!0;for(const i of _h(n,e)){let o=Ki,a=!0;switch(i.op){case">=":case">":o=rN(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Ki}d_({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];d_({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class di{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function FI(n,e,t,r,s,i,o,a){return new di(n,e,t,r,s,i,o,a)}function Fl(n){return new di(n)}function g_(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Pg(n){return n.collectionGroup!==null}function ll(n){const e=Ee(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new jt(on.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new Ec(i,r))}),t.has(on.keyField().canonicalString())||e.ce.push(new Ec(on.keyField(),r))}return e.ce}function dr(n){const e=Ee(n);return e.le||(e.le=jI(e,ll(n))),e.le}function UI(n){const e=Ee(n);return e.he||(e.he=jI(e,n.explicitOrderBy)),e.he}function jI(n,e){if(n.limitType==="F")return vm(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Ec(s.field,i)});const t=n.endAt?new so(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new so(n.startAt.position,n.startAt.inclusive):null;return vm(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function ym(n,e){const t=n.filters.concat([e]);return new di(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function bh(n,e,t){return new di(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function qc(n,e){return Bc(dr(n),dr(e))&&n.limitType===e.limitType}function BI(n){return`${na(dr(n))}|lt:${n.limitType}`}function Ya(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>MI(s)).join(", ")}]`),jc(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>wl(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>wl(s)).join(",")),`Target(${r})`}(dr(n))}; limitType=${n.limitType})`}function zc(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Se.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of ll(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=h_(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,ll(r),s)||r.endAt&&!function(o,a,l){const c=h_(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,ll(r),s))}(n,e)}function qI(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function zI(n){return(e,t)=>{let r=!1;for(const s of ll(n)){const i=hN(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function hN(n,e,t){const r=n.field.isKeyField()?Se.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?ro(l,c):Ce()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Ce()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hi{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){po(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return SI(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fN=new Qt(Se.comparator);function Dr(){return fN}const HI=new Qt(Se.comparator);function Mu(...n){let e=HI;for(const t of n)e=e.insert(t.key,t);return e}function KI(n){let e=HI;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Ss(){return Yu()}function GI(){return Yu()}function Yu(){return new hi(n=>n.toString(),(n,e)=>n.isEqual(e))}const pN=new Qt(Se.comparator),mN=new jt(Se.comparator);function it(...n){let e=mN;for(const t of n)e=e.add(t);return e}const gN=new jt(Xe);function Rg(){return gN}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cg(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bc(e)?"-0":e}}function WI(n){return{integerValue:""+n}}function QI(n,e){return wI(e)?WI(e):Cg(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cf{constructor(){this._=void 0}}function vN(n,e,t){return n instanceof Il?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&af(i)&&(i=lf(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof ra?YI(n,e):n instanceof sa?XI(n,e):function(s,i){const o=JI(s,i),a=v_(o)+v_(s.Pe);return pm(o)&&pm(s.Pe)?WI(a):Cg(s.serializer,a)}(n,e)}function yN(n,e,t){return n instanceof ra?YI(n,e):n instanceof sa?XI(n,e):t}function JI(n,e){return n instanceof El?function(r){return pm(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Il extends cf{}class ra extends cf{constructor(e){super(),this.elements=e}}function YI(n,e){const t=ZI(e);for(const r of n.elements)t.some(s=>Os(s,r))||t.push(r);return{arrayValue:{values:t}}}class sa extends cf{constructor(e){super(),this.elements=e}}function XI(n,e){let t=ZI(e);for(const r of n.elements)t=t.filter(s=>!Os(s,r));return{arrayValue:{values:t}}}class El extends cf{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function v_(n){return sn(n.integerValue||n.doubleValue)}function ZI(n){return Ic(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hc{constructor(e,t){this.field=e,this.transform=t}}function _N(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof ra&&s instanceof ra||r instanceof sa&&s instanceof sa?yl(r.elements,s.elements,Os):r instanceof El&&s instanceof El?Os(r.Pe,s.Pe):r instanceof Il&&s instanceof Il}(n.transform,e.transform)}class bN{constructor(e,t){this.version=e,this.transformResults=t}}class an{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new an}static exists(e){return new an(void 0,e)}static updateTime(e){return new an(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Yd(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class df{}function eE(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new jl(n.key,an.none()):new Ul(n.key,n.data,an.none());{const t=n.data,r=Qn.empty();let s=new jt(on.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new fi(n.key,r,new kr(s.toArray()),an.none())}}function wN(n,e,t){n instanceof Ul?function(s,i,o){const a=s.value.clone(),l=__(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof fi?function(s,i,o){if(!Yd(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=__(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(tE(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Xu(n,e,t,r){return n instanceof Ul?function(i,o,a,l){if(!Yd(i.precondition,o))return a;const c=i.value.clone(),h=b_(i.fieldTransforms,l,o);return c.setAll(h),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof fi?function(i,o,a,l){if(!Yd(i.precondition,o))return a;const c=b_(i.fieldTransforms,l,o),h=o.data;return h.setAll(tE(i)),h.setAll(c),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Yd(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function xN(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=JI(r.transform,s||null);i!=null&&(t===null&&(t=Qn.empty()),t.set(r.field,i))}return t||null}function y_(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&yl(r,s,(i,o)=>_N(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Ul extends df{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class fi extends df{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function tE(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function __(n,e,t){const r=new Map;Oe(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,yN(o,a,t[s]))}return r}function b_(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,vN(i,o,e))}return r}class jl extends df{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class kg extends df{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dg{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&wN(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Xu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Xu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=GI();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=eE(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument($e.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),it())}isEqual(e){return this.batchId===e.batchId&&yl(this.mutations,e.mutations,(t,r)=>y_(t,r))&&yl(this.baseMutations,e.baseMutations,(t,r)=>y_(t,r))}}class Ng{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Oe(e.mutations.length===r.length);let s=function(){return pN}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Ng(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Og{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nE{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IN{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kn,Tt;function rE(n){switch(n){default:return Ce();case Q.CANCELLED:case Q.UNKNOWN:case Q.DEADLINE_EXCEEDED:case Q.RESOURCE_EXHAUSTED:case Q.INTERNAL:case Q.UNAVAILABLE:case Q.UNAUTHENTICATED:return!1;case Q.INVALID_ARGUMENT:case Q.NOT_FOUND:case Q.ALREADY_EXISTS:case Q.PERMISSION_DENIED:case Q.FAILED_PRECONDITION:case Q.ABORTED:case Q.OUT_OF_RANGE:case Q.UNIMPLEMENTED:case Q.DATA_LOSS:return!0}}function sE(n){if(n===void 0)return In("GRPC error has no .code"),Q.UNKNOWN;switch(n){case kn.OK:return Q.OK;case kn.CANCELLED:return Q.CANCELLED;case kn.UNKNOWN:return Q.UNKNOWN;case kn.DEADLINE_EXCEEDED:return Q.DEADLINE_EXCEEDED;case kn.RESOURCE_EXHAUSTED:return Q.RESOURCE_EXHAUSTED;case kn.INTERNAL:return Q.INTERNAL;case kn.UNAVAILABLE:return Q.UNAVAILABLE;case kn.UNAUTHENTICATED:return Q.UNAUTHENTICATED;case kn.INVALID_ARGUMENT:return Q.INVALID_ARGUMENT;case kn.NOT_FOUND:return Q.NOT_FOUND;case kn.ALREADY_EXISTS:return Q.ALREADY_EXISTS;case kn.PERMISSION_DENIED:return Q.PERMISSION_DENIED;case kn.FAILED_PRECONDITION:return Q.FAILED_PRECONDITION;case kn.ABORTED:return Q.ABORTED;case kn.OUT_OF_RANGE:return Q.OUT_OF_RANGE;case kn.UNIMPLEMENTED:return Q.UNIMPLEMENTED;case kn.DATA_LOSS:return Q.DATA_LOSS;default:return Ce()}}(Tt=kn||(kn={}))[Tt.OK=0]="OK",Tt[Tt.CANCELLED=1]="CANCELLED",Tt[Tt.UNKNOWN=2]="UNKNOWN",Tt[Tt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Tt[Tt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Tt[Tt.NOT_FOUND=5]="NOT_FOUND",Tt[Tt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Tt[Tt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Tt[Tt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Tt[Tt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Tt[Tt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Tt[Tt.ABORTED=10]="ABORTED",Tt[Tt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Tt[Tt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Tt[Tt.INTERNAL=13]="INTERNAL",Tt[Tt.UNAVAILABLE=14]="UNAVAILABLE",Tt[Tt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wh=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iE(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EN=new Go([4294967295,4294967295],0);function w_(n){const e=iE().encode(n),t=new oI;return t.update(e),new Uint8Array(t.digest())}function x_(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Go([t,r],0),new Go([s,i],0)]}class Vg{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Lu(`Invalid padding: ${t}`);if(r<0)throw new Lu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Lu(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Lu(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Go.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Go.fromNumber(r)));return s.compare(EN)===1&&(s=new Go([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=w_(e),[r,s]=x_(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Vg(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=w_(e),[r,s]=x_(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Lu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Gc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Kc($e.min(),s,new Qt(Xe),Dr(),it())}}class Gc{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Gc(r,t,it(),it(),it())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xd{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class oE{constructor(e,t){this.targetId=e,this.me=t}}class aE{constructor(e,t,r=mn.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class I_{constructor(){this.fe=0,this.ge=T_(),this.pe=mn.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=it(),t=it(),r=it();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:Ce()}}),new Gc(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=T_()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Oe(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class TN{constructor(e){this.Le=e,this.Be=new Map,this.ke=Dr(),this.qe=E_(),this.Qe=new Qt(Xe)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Ce()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(yh(i))if(r===0){const o=new Se(i.path);this.Ue(t,o,Xt.newNoDocument(o,$e.min()))}else Oe(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}wh==null||wh.et(function(h,f,g,v,x){var w,I,$,L,U,q;const te={localCacheCount:h,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},X=f.unchangedNames;return X&&(te.bloomFilter={applied:x===0,hashCount:(w=X==null?void 0:X.hashCount)!==null&&w!==void 0?w:0,bitmapLength:(L=($=(I=X==null?void 0:X.bits)===null||I===void 0?void 0:I.bitmap)===null||$===void 0?void 0:$.length)!==null&&L!==void 0?L:0,padding:(q=(U=X==null?void 0:X.bits)===null||U===void 0?void 0:U.padding)!==null&&q!==void 0?q:0,mightContain:A=>{var b;return(b=v==null?void 0:v.mightContain(A))!==null&&b!==void 0&&b}}),te}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=ii(r).toUint8Array()}catch(l){if(l instanceof PI)return es("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Vg(o,s,i)}catch(l){return es(l instanceof Lu?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&yh(a.target)){const l=new Se(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,Xt.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=it();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new Kc(e,t,this.Qe,this.ke,r);return this.ke=Dr(),this.qe=E_(),this.Qe=new Qt(Xe),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new I_,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new jt(Xe),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||ce("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new I_),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function E_(){return new Qt(Se.comparator)}function T_(){return new Qt(Se.comparator)}const AN=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),SN=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),PN=(()=>({and:"AND",or:"OR"}))();class RN{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function _m(n,e){return n.useProto3Json||jc(e)?e:{value:e}}function Tl(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function lE(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function CN(n,e){return Tl(n,e.toTimestamp())}function An(n){return Oe(!!n),$e.fromTimestamp(function(t){const r=si(t);return new dn(r.seconds,r.nanos)}(n))}function Mg(n,e){return bm(n,e).canonicalString()}function bm(n,e){const t=function(s){return new bt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function uE(n){const e=bt.fromString(n);return Oe(_E(e)),e}function Tc(n,e){return Mg(n.databaseId,e.path)}function Ds(n,e){const t=uE(e);if(t.get(1)!==n.databaseId.projectId)throw new de(Q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new de(Q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Se(hE(t))}function cE(n,e){return Mg(n.databaseId,e)}function dE(n){const e=uE(n);return e.length===4?bt.emptyPath():hE(e)}function wm(n){return new bt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function hE(n){return Oe(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function A_(n,e,t){return{name:Tc(n,e),fields:t.value.mapValue.fields}}function fE(n,e,t){const r=Ds(n,e.name),s=An(e.updateTime),i=e.createTime?An(e.createTime):$e.min(),o=new Qn({mapValue:{fields:e.fields}}),a=Xt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function kN(n,e){return"found"in e?function(r,s){Oe(!!s.found),s.found.name,s.found.updateTime;const i=Ds(r,s.found.name),o=An(s.found.updateTime),a=s.found.createTime?An(s.found.createTime):$e.min(),l=new Qn({mapValue:{fields:s.found.fields}});return Xt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Oe(!!s.missing),Oe(!!s.readTime);const i=Ds(r,s.missing),o=An(s.readTime);return Xt.newNoDocument(i,o)}(n,e):Ce()}function DN(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Ce()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,h){return c.useProto3Json?(Oe(h===void 0||typeof h=="string"),mn.fromBase64String(h||"")):(Oe(h===void 0||h instanceof Buffer||h instanceof Uint8Array),mn.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const h=c.code===void 0?Q.UNKNOWN:sE(c.code);return new de(h,c.message||"")}(o);t=new aE(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Ds(n,r.document.name),i=An(r.document.updateTime),o=r.document.createTime?An(r.document.createTime):$e.min(),a=new Qn({mapValue:{fields:r.document.fields}}),l=Xt.newFoundDocument(s,i,o,a),c=r.targetIds||[],h=r.removedTargetIds||[];t=new Xd(c,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Ds(n,r.document),i=r.readTime?An(r.readTime):$e.min(),o=Xt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Xd([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Ds(n,r.document),i=r.removedTargetIds||[];t=new Xd([],i,s,null)}else{if(!("filter"in e))return Ce();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new IN(s,i),a=r.targetId;t=new oE(a,o)}}return t}function Ac(n,e){let t;if(e instanceof Ul)t={update:A_(n,e.key,e.value)};else if(e instanceof jl)t={delete:Tc(n,e.key)};else if(e instanceof fi)t={update:A_(n,e.key,e.data),updateMask:$N(e.fieldMask)};else{if(!(e instanceof kg))return Ce();t={verify:Tc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Il)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof ra)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof sa)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof El)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Ce()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:CN(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Ce()}(n,e.precondition)),t}function xm(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?an.updateTime(An(i.updateTime)):i.exists!==void 0?an.exists(i.exists):an.none()}(e.currentDocument):an.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Oe(a.setToServerValue==="REQUEST_TIME"),l=new Il;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new ra(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new sa(h)}else"increment"in a?l=new El(o,a.increment):Ce();const c=on.fromServerFormat(a.fieldPath);return new Hc(c,l)}(n,s)):[];if(e.update){e.update.name;const s=Ds(n,e.update.name),i=new Qn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new kr(c.map(h=>on.fromServerFormat(h)))}(e.updateMask);return new fi(s,i,o,t,r)}return new Ul(s,i,t,r)}if(e.delete){const s=Ds(n,e.delete);return new jl(s,t)}if(e.verify){const s=Ds(n,e.verify);return new kg(s,t)}return Ce()}function NN(n,e){return n&&n.length>0?(Oe(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?An(s.updateTime):An(i);return o.isEqual($e.min())&&(o=An(i)),new bN(o,s.transformResults||[])}(t,e))):[]}function pE(n,e){return{documents:[cE(n,e.path)]}}function hf(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=cE(n,s);const i=function(c){if(c.length!==0)return yE(Ft.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(h=>function(g){return{field:Li(g.field),direction:VN(g.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=_m(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function mE(n,e,t,r){const{_t:s,parent:i}=hf(n,e),o={},a=[];let l=0;return t.forEach(c=>{const h=r?c.alias:"aggregate_"+l++;o[h]=c.alias,c.aggregateType==="count"?a.push({alias:h,count:{}}):c.aggregateType==="avg"?a.push({alias:h,avg:{field:Li(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:h,sum:{field:Li(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function gE(n){let e=dE(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Oe(r===1);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const g=vE(f);return g instanceof Ft&&Sg(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(x){return new Ec(Xa(x.field),function(I){switch(I){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,jc(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,v=f.values||[];return new so(v,g)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const g=!f.before,v=f.values||[];return new so(v,g)}(t.endAt)),FI(e,s,o,i,a,"F",l,c)}function ON(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ce()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function vE(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Xa(t.unaryFilter.field);return wt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Xa(t.unaryFilter.field);return wt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Xa(t.unaryFilter.field);return wt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Xa(t.unaryFilter.field);return wt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Ce()}}(n):n.fieldFilter!==void 0?function(t){return wt.create(Xa(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ce()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Ft.create(t.compositeFilter.filters.map(r=>vE(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Ce()}}(t.compositeFilter.op))}(n):Ce()}function VN(n){return AN[n]}function MN(n){return SN[n]}function LN(n){return PN[n]}function Li(n){return{fieldPath:n.canonicalString()}}function Xa(n){return on.fromServerFormat(n.fieldPath)}function yE(n){return n instanceof wt?function(t){if(t.op==="=="){if(u_(t.value))return{unaryFilter:{field:Li(t.field),op:"IS_NAN"}};if(l_(t.value))return{unaryFilter:{field:Li(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(u_(t.value))return{unaryFilter:{field:Li(t.field),op:"IS_NOT_NAN"}};if(l_(t.value))return{unaryFilter:{field:Li(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Li(t.field),op:MN(t.op),value:t.value}}}(n):n instanceof Ft?function(t){const r=t.getFilters().map(s=>yE(s));return r.length===1?r[0]:{compositeFilter:{op:LN(t.op),filters:r}}}(n):Ce()}function $N(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function _E(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ks{constructor(e,t,r,s,i=$e.min(),o=$e.min(),a=mn.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Ks(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ks(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ks(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ks(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bE{constructor(e){this.ct=e}}function FN(n,e){let t;if(e.document)t=fE(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Se.fromSegments(e.noDocument.path),s=oa(e.noDocument.readTime);t=Xt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Ce();{const r=Se.fromSegments(e.unknownDocument.path),s=oa(e.unknownDocument.version);t=Xt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new dn(s[0],s[1]);return $e.fromTimestamp(i)}(e.readTime)),t}function S_(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:xh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:Tc(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Tl(i,o.version.toTimestamp()),createTime:Tl(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:ia(e.version)};else{if(!e.isUnknownDocument())return Ce();r.unknownDocument={path:t.path.toArray(),version:ia(e.version)}}return r}function xh(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function ia(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function oa(n){const e=new dn(n.seconds,n.nanoseconds);return $e.fromTimestamp(e)}function Fo(n,e){const t=(e.baseMutations||[]).map(i=>xm(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>xm(n.ct,i)),s=dn.fromMillis(e.localWriteTimeMs);return new Dg(e.batchId,s,t,r)}function $u(n){const e=oa(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?oa(n.lastLimboFreeSnapshotVersion):$e.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Oe(i.documents.length===1),dr(Fl(dE(i.documents[0])))}(n.query):function(i){return dr(gE(i))}(n.query),new Ks(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,mn.fromBase64String(n.resumeToken))}function wE(n,e){const t=ia(e.snapshotVersion),r=ia(e.lastLimboFreeSnapshotVersion);let s;s=yh(e.target)?pE(n.ct,e.target):hf(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:na(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Lg(n){const e=gE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?bh(e,e.limit,"L"):e}function Cp(n,e){return new Og(e.largestBatchId,xm(n.ct,e.overlayMutation))}function P_(n,e){const t=e.path.lastSegment();return[n,cr(e.path.popLast()),t]}function R_(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:ia(r.readTime),documentKey:cr(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UN{getBundleMetadata(e,t){return C_(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:oa(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return C_(e).put(function(s){return{bundleId:s.id,createTime:ia(An(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return k_(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Lg(i.bundledQuery),readTime:oa(i.readTime)}}(r)})}saveNamedQuery(e,t){return k_(e).put(function(s){return{name:s.name,readTime:ia(An(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function C_(n){return $n(n,"bundles")}function k_(n){return $n(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ff{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new ff(e,r)}getOverlay(e,t){return Eu(e).get(P_(this.userId,t)).next(r=>r?Cp(this.serializer,r):null)}getOverlays(e,t){const r=Ss();return z.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Og(t,o);s.push(this.ht(e,a))}),z.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(cr(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Eu(e).j("collectionPathOverlayIndex",a))}),z.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Ss(),i=cr(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Eu(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=Cp(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Ss();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Eu(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,h)=>{const f=Cp(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}ht(e,t){return Eu(e).put(function(s,i,o){const[a,l,c]=P_(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Ac(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function Eu(n){return $n(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jN{Pt(e){return $n(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?mn.fromUint8Array(r):mn.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uo{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(sn(e.integerValue));else if("doubleValue"in e){const r=sn(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),bc(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=si(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(ii(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?RI(e)?this.dt(t,Number.MAX_SAFE_INTEGER):uf(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Ce()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(sn(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),Se.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Uo.vt=new Uo;function BN(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function D_(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=BN(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class qN{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=D_(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=D_(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class zN{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class HN{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class Tu{constructor(){this.jt=new qN,this.Ht=new zN(this.jt),this.Jt=new HN(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new jo(this.indexId,this.documentKey,this.arrayValue,r)}}function Ri(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=N_(n.arrayValue,e.arrayValue),t!==0?t:(t=N_(n.directionalValue,e.directionalValue),t!==0?t:Se.comparator(n.documentKey,e.documentKey)))}function N_(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O_{constructor(e){this.Xt=new jt((t,r)=>on.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Oe(e.collectionGroup===this.collectionId),this.nn)return!1;const t=dm(e);if(t!==void 0&&!this.sn(t))return!1;const r=Oo(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new jt(on.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Wo(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Wo(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Wo(r.field,r.dir==="asc"?0:1)));return new _l(_l.UNKNOWN_ID,this.collectionId,t,bl.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xE(n){var e,t;if(Oe(n instanceof wt||n instanceof Ft),n instanceof wt){if(n instanceof $I){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>wt.create(n.field,"==",i)))||[];return Ft.create(s,"or")}return n}const r=n.filters.map(s=>xE(s));return Ft.create(r,n.op)}function KN(n){if(n.getFilters().length===0)return[];const e=Tm(xE(n));return Oe(IE(e)),Im(e)||Em(e)?[e]:e.getFilters()}function Im(n){return n instanceof wt}function Em(n){return n instanceof Ft&&Sg(n)}function IE(n){return Im(n)||Em(n)||function(t){if(t instanceof Ft&&mm(t)){for(const r of t.getFilters())if(!Im(r)&&!Em(r))return!1;return!0}return!1}(n)}function Tm(n){if(Oe(n instanceof wt||n instanceof Ft),n instanceof wt)return n;if(n.filters.length===1)return Tm(n.filters[0]);const e=n.filters.map(r=>Tm(r));let t=Ft.create(e,n.op);return t=Ih(t),IE(t)?t:(Oe(t instanceof Ft),Oe(xl(t)),Oe(t.filters.length>1),t.filters.reduce((r,s)=>$g(r,s)))}function $g(n,e){let t;return Oe(n instanceof wt||n instanceof Ft),Oe(e instanceof wt||e instanceof Ft),t=n instanceof wt?e instanceof wt?function(s,i){return Ft.create([s,i],"and")}(n,e):V_(n,e):e instanceof wt?V_(e,n):function(s,i){if(Oe(s.filters.length>0&&i.filters.length>0),xl(s)&&xl(i))return VI(s,i.getFilters());const o=mm(s)?s:i,a=mm(s)?i:s,l=o.filters.map(c=>$g(c,a));return Ft.create(l,"or")}(n,e),Ih(t)}function V_(n,e){if(xl(e))return VI(e,n.getFilters());{const t=e.filters.map(r=>$g(n,r));return Ft.create(t,"or")}}function Ih(n){if(Oe(n instanceof wt||n instanceof Ft),n instanceof wt)return n;const e=n.getFilters();if(e.length===1)return Ih(e[0]);if(NI(n))return n;const t=e.map(s=>Ih(s)),r=[];return t.forEach(s=>{s instanceof wt?r.push(s):s instanceof Ft&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Ft.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GN{constructor(){this.un=new Fg}addToCollectionParentIndex(e,t){return this.un.add(t),z.resolve()}getCollectionParents(e,t){return z.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return z.resolve()}deleteFieldIndex(e,t){return z.resolve()}deleteAllFieldIndexes(e){return z.resolve()}createTargetIndexes(e,t){return z.resolve()}getDocumentsMatchingTarget(e,t){return z.resolve(null)}getIndexType(e,t){return z.resolve(0)}getFieldIndexes(e,t){return z.resolve([])}getNextCollectionGroupToUpdate(e){return z.resolve(null)}getMinOffset(e,t){return z.resolve(Hr.min())}getMinOffsetFromCollectionGroup(e,t){return z.resolve(Hr.min())}updateCollectionGroup(e,t,r){return z.resolve()}updateIndexEntries(e,t){return z.resolve()}}class Fg{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new jt(bt.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new jt(bt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rd=new Uint8Array(0);class WN{constructor(e,t){this.databaseId=t,this.cn=new Fg,this.ln=new hi(r=>na(r),(r,s)=>Bc(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:cr(s)};return M_(e).put(i)}return z.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[mI(t),""],!1,!0);return M_(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(As(o.parent))}return r})}addFieldIndex(e,t){const r=Au(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Ka(e);return i.next(a=>{o.put(R_(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=Au(e),s=Ka(e),i=Ha(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Au(e),r=Ha(e),s=Ka(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return z.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new O_(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Ha(e);let s=!0;const i=new Map;return z.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=it();const a=[];return z.forEach(i,(l,c)=>{ce("IndexedDbIndexManager",`Using index ${function(U){return`id=${U.indexId}|cg=${U.collectionGroup}|f=${U.fields.map(q=>`${q.fieldPath}:${q.kind}`).join(",")}`}(l)} to execute ${na(t)}`);const h=function(U,q){const te=dm(q);if(te===void 0)return null;for(const X of _h(U,te.fieldPath))switch(X.op){case"array-contains-any":return X.value.arrayValue.values||[];case"array-contains":return[X.value]}return null}(c,l),f=function(U,q){const te=new Map;for(const X of Oo(q))for(const A of _h(U,X.fieldPath))switch(A.op){case"==":case"in":te.set(X.fieldPath.canonicalString(),A.value);break;case"not-in":case"!=":return te.set(X.fieldPath.canonicalString(),A.value),Array.from(te.values())}return null}(c,l),g=function(U,q){const te=[];let X=!0;for(const A of Oo(q)){const b=A.kind===0?p_(U,A.fieldPath,U.startAt):m_(U,A.fieldPath,U.startAt);te.push(b.value),X&&(X=b.inclusive)}return new so(te,X)}(c,l),v=function(U,q){const te=[];let X=!0;for(const A of Oo(q)){const b=A.kind===0?m_(U,A.fieldPath,U.endAt):p_(U,A.fieldPath,U.endAt);te.push(b.value),X&&(X=b.inclusive)}return new so(te,X)}(c,l),x=this.In(l,c,g),w=this.In(l,c,v),I=this.Tn(l,c,f),$=this.En(l.indexId,h,x,g.inclusive,w,v.inclusive,I);return z.forEach($,L=>r.G(L,t.limit).next(U=>{U.forEach(q=>{const te=Se.fromSegments(q.documentKey);o.has(te)||(o=o.add(te),a.push(te))})}))}).next(()=>a)}return z.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=KN(Ft.create(e.filters,"and")).map(r=>vm(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const g=t?this.dn(t[f/c]):Rd,v=this.An(e,g,r[f%c],s),x=this.Rn(e,g,i[f%c],o),w=a.map(I=>this.An(e,g,I,!0));h.push(...this.createRange(v,x,w))}return h}An(e,t,r,s){const i=new jo(e,Se.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new jo(e,Se.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new O_(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return z.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new jt(on.comparator),h=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?h=!0:c=c.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new Tu;for(const s of Oo(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);Uo.vt.It(i,o)}return r.zt()}dn(e){const t=new Tu;return Uo.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new Tu;return Uo.vt.It(ta(this.databaseId,t),r.Yt(function(i){const o=Oo(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new Tu);let i=0;for(const o of Oo(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&Ic(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);Uo.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new Tu;l.seed(a.zt()),Uo.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof wt&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=Au(e),s=Ka(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return z.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const g=f?new bl(f.sequenceNumber,new Hr(oa(f.readTime),new Se(As(f.documentKey)),f.largestBatchId)):bl.empty(),v=h.fields.map(([x,w])=>new Wo(on.fromServerFormat(x),w));return new _l(h.indexId,h.collectionGroup,v,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Xe(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=Au(e),i=Ka(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>z.forEach(a,l=>i.put(R_(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return z.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?z.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),z.forEach(a,l=>this.wn(e,s,l).next(c=>{const h=this.Sn(i,l);return c.isEqual(h)?z.resolve():this.bn(e,i,l,c,h)}))))})}Dn(e,t,r,s){return Ha(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return Ha(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=Ha(e);let i=new jt(Ri);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new jo(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new jt(Ri);const s=this.Vn(t,e);if(s==null)return r;const i=dm(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Ic(o))for(const a of o.arrayValue.values||[])r=r.add(new jo(t.indexId,e.key,this.dn(a),s))}else r=r.add(new jo(t.indexId,e.key,Rd,s));return r}bn(e,t,r,s,i){ce("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,h,f,g){const v=l.getIterator(),x=c.getIterator();let w=za(v),I=za(x);for(;w||I;){let $=!1,L=!1;if(w&&I){const U=h(w,I);U<0?L=!0:U>0&&($=!0)}else w!=null?L=!0:$=!0;$?(f(I),I=za(x)):L?(g(w),w=za(v)):(w=za(v),I=za(x))}}(s,i,Ri,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),z.waitFor(o)}yn(e){let t=1;return Ka(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Ri(o,a)).filter((o,a,l)=>!a||Ri(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Ri(o,e),l=Ri(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Rd,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Rd,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return Ri(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(L_)}getMinOffset(e,t){return z.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||Ce())).next(L_)}}function M_(n){return $n(n,"collectionParents")}function Ha(n){return $n(n,"indexEntries")}function Au(n){return $n(n,"indexConfiguration")}function Ka(n){return $n(n,"indexState")}function L_(n){Oe(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Eg(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Hr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ir{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new ir(e,ir.DEFAULT_COLLECTION_PERCENTILE,ir.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EE(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(h,f,g)=>(a++,g.delete()));i.push(l.next(()=>{Oe(a===1)}));const c=[];for(const h of t.mutations){const f=xI(e,h.key.path,t.batchId);i.push(s.delete(f)),c.push(h.key)}return z.waitFor(i).next(()=>c)}function Eh(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Ce();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ir.DEFAULT_COLLECTION_PERCENTILE=10,ir.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ir.DEFAULT=new ir(41943040,ir.DEFAULT_COLLECTION_PERCENTILE,ir.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ir.DISABLED=new ir(-1,0,0);class pf{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Oe(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new pf(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ci(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Za(e),o=Ci(e);return o.add({}).next(a=>{Oe(typeof a=="number");const l=new Dg(a,t,r,s),c=function(v,x,w){const I=w.baseMutations.map(L=>Ac(v.ct,L)),$=w.mutations.map(L=>Ac(v.ct,L));return{userId:x,batchId:w.batchId,localWriteTimeMs:w.localWriteTime.toMillis(),baseMutations:I,mutations:$}}(this.serializer,this.userId,l),h=[];let f=new jt((g,v)=>Xe(g.canonicalString(),v.canonicalString()));for(const g of s){const v=xI(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),h.push(o.put(c)),h.push(i.put(v,MD))}return f.forEach(g=>{h.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),z.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return Ci(e).get(t).next(r=>r?(Oe(r.userId===this.userId),Fo(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?z.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Ci(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Oe(a.batchId>=r),i=Fo(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Ci(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ci(e).U("userMutationsIndex",t).next(r=>r.map(s=>Fo(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Gd(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Za(e).J({range:s},(o,a,l)=>{const[c,h,f]=o,g=As(h);if(c===this.userId&&t.path.isEqual(g))return Ci(e).get(f).next(v=>{if(!v)throw Ce();Oe(v.userId===this.userId),i.push(Fo(this.serializer,v))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new jt(Xe);const s=[];return t.forEach(i=>{const o=Gd(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Za(e).J({range:a},(c,h,f)=>{const[g,v,x]=c,w=As(v);g===this.userId&&i.path.isEqual(w)?r=r.add(x):f.done()});s.push(l)}),z.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Gd(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new jt(Xe);return Za(e).J({range:o},(l,c,h)=>{const[f,g,v]=l,x=As(g);f===this.userId&&r.isPrefixOf(x)?x.length===s&&(a=a.add(v)):h.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(Ci(e).get(i).next(o=>{if(o===null)throw Ce();Oe(o.userId===this.userId),r.push(Fo(this.serializer,o))}))}),z.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return EE(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),z.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return z.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Za(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=As(i[1]);s.push(l)}else a.done()}).next(()=>{Oe(s.length===0)})})}containsKey(e,t){return TE(e,this.userId,t)}Nn(e){return AE(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function TE(n,e,t){const r=Gd(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Za(n).J({range:i,H:!0},(a,l,c)=>{const[h,f,g]=a;h===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function Ci(n){return $n(n,"mutations")}function Za(n){return $n(n,"documentMutations")}function AE(n){return $n(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new aa(0)}static kn(){return new aa(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QN{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new aa(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>$e.fromTimestamp(new dn(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ga(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Oe(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Ga(e).J((o,a)=>{const l=$u(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>z.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Ga(e).J((r,s)=>{const i=$u(s);t(i)})}qn(e){return F_(e).get("targetGlobalKey").next(t=>(Oe(t!==null),t))}Qn(e,t){return F_(e).put("targetGlobalKey",t)}Kn(e,t){return Ga(e).put(wE(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=na(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Ga(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=$u(a);Bc(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=$i(e);return t.forEach(o=>{const a=cr(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),z.waitFor(s)}removeMatchingKeys(e,t,r){const s=$i(e);return z.forEach(t,i=>{const o=cr(i.path);return z.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=$i(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=$i(e);let i=it();return s.J({range:r,H:!0},(o,a,l)=>{const c=As(o[1]),h=new Se(c);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=cr(t.path),s=IDBKeyRange.bound([r],[mI(r)],!1,!0);let i=0;return $i(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return Ga(e).get(t).next(r=>r?$u(r):null)}}function Ga(n){return $n(n,"targets")}function F_(n){return $n(n,"targetGlobal")}function $i(n){return $n(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U_([n,e],[t,r]){const s=Xe(n,t);return s===0?Xe(e,r):s}class JN{constructor(e){this.Un=e,this.buffer=new jt(U_),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();U_(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class SE{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){ce("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){fo(t)?ce("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await ho(t)}await this.Hn(3e5)})}}class YN{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return z.resolve(Cr.oe);const r=new JN(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(ce("LruGarbageCollector","Garbage collection skipped; disabled"),z.resolve($_)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(ce("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),$_):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(ce("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),Ja()<=_t.DEBUG&&ce("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-h}ms`),z.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function PE(n,e){return new YN(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XN{constructor(e,t){this.db=e,this.garbageCollector=PE(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return Cd(e,r)}removeReference(e,t,r){return Cd(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Cd(e,t)}nr(e,t){return function(s,i){let o=!1;return AE(s).Y(a=>TE(s,a,i).next(l=>(l&&(o=!0),z.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,$e.min()),$i(e).delete(function(f){return[0,cr(f.path)]}(o))))});s.push(l)}}).next(()=>z.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Cd(e,t)}tr(e,t){const r=$i(e);let s,i=Cr.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==Cr.oe&&t(new Se(As(s)),i),i=c,s=l):i=Cr.oe}).next(()=>{i!==Cr.oe&&t(new Se(As(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Cd(n,e){return $i(n).put(function(r,s){return{targetId:0,path:cr(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RE{constructor(){this.changes=new hi(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Xt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?z.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZN{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return ko(e).put(r)}removeEntry(e,t,r){return ko(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],xh(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Xt.newInvalidDocument(t);return ko(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Su(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:Xt.newInvalidDocument(t)};return ko(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Su(t))},(s,i)=>{r={document:this.ir(t,i),size:Eh(i)}}).next(()=>r)}getEntries(e,t){let r=Dr();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=Dr(),s=new Qt(Se.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,Eh(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return z.resolve();let s=new jt(q_);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Su(s.first()),Su(s.last())),o=s.getIterator();let a=o.getNext();return ko(e).J({index:"documentKeyIndex",range:i},(l,c,h)=>{const f=Se.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&q_(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?h.$(Su(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),xh(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ko(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let h=Dr();for(const f of c){const g=this.ir(Se.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(zc(t,g)||s.has(g.key))&&(h=h.insert(g.key,g))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=Dr();const o=B_(t,r),a=B_(t,Hr.max());return ko(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,h)=>{const f=this.ir(Se.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new eO(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return j_(e).get("remoteDocumentGlobalKey").next(t=>(Oe(!!t),t))}rr(e,t){return j_(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=FN(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual($e.min())))return r}return Xt.newInvalidDocument(e)}}function CE(n){return new ZN(n)}class eO extends RE{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new hi(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new jt((i,o)=>Xe(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=S_(this.cr.serializer,o);s=s.add(i.path.popLast());const c=Eh(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=S_(this.cr.serializer,o.convertToNoDocument($e.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),z.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function j_(n){return $n(n,"remoteDocumentGlobal")}function ko(n){return $n(n,"remoteDocumentsV14")}function Su(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function B_(n,e){const t=e.documentKey.path.toArray();return[n,xh(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function q_(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Xe(t[i],r[i]),s)return s;return s=Xe(t.length,r.length),s||(s=Xe(t[t.length-2],r[r.length-2]),s||Xe(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tO{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kE{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Xu(r.mutation,s,kr.empty(),dn.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,it()).next(()=>r))}getLocalViewOfDocuments(e,t,r=it()){const s=Ss();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Mu();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Ss();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,it()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Dr();const o=Yu(),a=function(){return Yu()}();return t.forEach((l,c)=>{const h=r.get(c.key);s.has(c.key)&&(h===void 0||h.mutation instanceof fi)?i=i.insert(c.key,c):h!==void 0?(o.set(c.key,h.mutation.getFieldMask()),Xu(h.mutation,c,h.mutation.getFieldMask(),dn.now())):o.set(c.key,kr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,h)=>o.set(c,h)),t.forEach((c,h)=>{var f;return a.set(c,new tO(h,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Yu();let s=new Qt((o,a)=>o-a),i=it();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let h=r.get(l)||kr.empty();h=a.applyToLocalView(c,h),r.set(l,h);const f=(s.get(a.batchId)||it()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,h=l.value,f=GI();h.forEach(g=>{if(!i.has(g)){const v=eE(t.get(g),r.get(g));v!==null&&f.set(g,v),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return z.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return Se.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Pg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):z.resolve(Ss());let a=-1,l=i;return o.next(c=>z.forEach(c,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?z.resolve():this.remoteDocumentCache.getEntry(e,h).next(g=>{l=l.insert(h,g)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,it())).next(h=>({batchId:a,changes:KI(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Se(t)).next(r=>{let s=Mu();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Mu();return this.indexManager.getCollectionParents(e,i).next(a=>z.forEach(a,l=>{const c=function(f,g){return new di(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(h=>{h.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const h=c.getKey();o.get(h)===null&&(o=o.insert(h,Xt.newInvalidDocument(h)))});let a=Mu();return o.forEach((l,c)=>{const h=i.get(l);h!==void 0&&Xu(h.mutation,c,kr.empty(),dn.now()),zc(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nO{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return z.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:An(s.createTime)}}(t)),z.resolve()}getNamedQuery(e,t){return z.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Lg(s.bundledQuery),readTime:An(s.readTime)}}(t)),z.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rO{constructor(){this.overlays=new Qt(Se.comparator),this.Ir=new Map}getOverlay(e,t){return z.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Ss();return z.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),z.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),z.resolve()}getOverlaysForCollection(e,t,r){const s=Ss(),i=t.length+1,o=new Se(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return z.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Qt((c,h)=>c-h);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let h=i.get(c.largestBatchId);h===null&&(h=Ss(),i=i.insert(c.largestBatchId,h)),h.set(c.getKey(),c)}}const a=Ss(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,h)=>a.set(c,h)),!(a.size()>=s)););return z.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Og(t,r));let i=this.Ir.get(t);i===void 0&&(i=it(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sO{constructor(){this.sessionToken=mn.EMPTY_BYTE_STRING}getSessionToken(e){return z.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,z.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ug{constructor(){this.Tr=new jt(Un.Er),this.dr=new jt(Un.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new Un(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Un(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new Se(new bt([])),r=new Un(t,e),s=new Un(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Se(new bt([])),r=new Un(t,e),s=new Un(t,e+1);let i=it();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Un(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Un{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Se.comparator(e.key,t.key)||Xe(e.wr,t.wr)}static Ar(e,t){return Xe(e.wr,t.wr)||Se.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iO{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new jt(Un.Er)}checkEmpty(e){return z.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Dg(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new Un(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return z.resolve(o)}lookupMutationBatch(e,t){return z.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return z.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return z.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return z.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Un(t,0),s=new Un(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),z.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new jt(Xe);return t.forEach(s=>{const i=new Un(s,0),o=new Un(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),z.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Se.isDocumentKey(i)||(i=i.child(""));const o=new Un(new Se(i),0);let a=new jt(Xe);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),z.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Oe(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return z.forEach(t.mutations,s=>{const i=new Un(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new Un(t,0),s=this.br.firstAfterOrEqual(r);return z.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,z.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oO{constructor(e){this.Mr=e,this.docs=function(){return new Qt(Se.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return z.resolve(r?r.document.mutableCopy():Xt.newInvalidDocument(t))}getEntries(e,t){let r=Dr();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Xt.newInvalidDocument(s))}),z.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Dr();const o=t.path,a=new Se(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:h}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Eg(vI(h),r)<=0||(s.has(h.key)||zc(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return z.resolve(i)}getAllFromCollectionGroup(e,t,r,s){Ce()}Or(e,t){return z.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new aO(this)}getSize(e){return z.resolve(this.size)}}class aO extends RE{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),z.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lO{constructor(e){this.persistence=e,this.Nr=new hi(t=>na(t),Bc),this.lastRemoteSnapshotVersion=$e.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Ug,this.targetCount=0,this.kr=aa.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),z.resolve()}getLastRemoteSnapshotVersion(e){return z.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return z.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),z.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),z.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new aa(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,z.resolve()}updateTargetData(e,t){return this.Kn(t),z.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,z.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),z.waitFor(i).next(()=>s)}getTargetCount(e){return z.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return z.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),z.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),z.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),z.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return z.resolve(r)}containsKey(e,t){return z.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jg{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Cr(0),this.Kr=!1,this.Kr=!0,this.$r=new sO,this.referenceDelegate=e(this),this.Ur=new lO(this),this.indexManager=new GN,this.remoteDocumentCache=function(s){return new oO(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new bE(t),this.Gr=new nO(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new rO,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new iO(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){ce("MemoryPersistence","Starting transaction:",e);const s=new uO(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return z.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class uO extends _I{constructor(e){super(),this.currentSequenceNumber=e}}class mf{constructor(e){this.persistence=e,this.Jr=new Ug,this.Yr=null}static Zr(e){return new mf(e)}get Xr(){if(this.Yr)return this.Yr;throw Ce()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),z.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),z.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),z.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return z.forEach(this.Xr,r=>{const s=Se.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,$e.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return z.or([()=>z.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Th{constructor(e,t){this.persistence=e,this.ti=new hi(r=>cr(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=PE(this,t)}static Zr(e,t){return new Th(e,t)}zr(){}jr(e){return z.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return z.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?z.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,$e.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),z.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),z.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),z.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),z.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Qd(e.data.value)),t}nr(e,t,r){return z.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return z.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cO{constructor(e){this.serializer=e}O(e,t,r,s){const i=new of("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",r_,{unique:!0}),l.createObjectStore("documentMutations")}(e),z_(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=z.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),z_(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:$e.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(h=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",r_,{unique:!0});const f=c.store("mutations"),g=h.map(v=>f.put(v));return z.waitFor(g)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:WD});c.createIndex("collectionPathOverlayIndex",QD,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",JD,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:LD});c.createIndex("documentKeyIndex",$D),c.createIndex("collectionGroupIndex",FD)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:zD}).createIndex("sequenceNumberIndex",HD,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:KD}).createIndex("documentKeyIndex",GD,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Eh(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>z.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>z.forEach(a,l=>{Oe(l.userId===i.userId);const c=Fo(this.serializer,l);return EE(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new bt(o),c=function(f){return[0,cr(f)]}(l);i.push(t.get(c).next(h=>h?z.resolve():(f=>t.put({targetId:0,path:cr(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>z.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:qD});const r=t.store("collectionParents"),s=new Fg,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:cr(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new bt(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const h=As(a);return i(h.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=$u(s),o=wE(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new Se(bt.fromString(f.document.name).popFirst(5)):f.noDocument?Se.fromSegments(f.noDocument.path):f.unknownDocument?Se.fromSegments(f.unknownDocument.path):Ce()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>z.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=CE(this.serializer),i=new jg(mf.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let h=(c=a.get(l.userId))!==null&&c!==void 0?c:it();Fo(this.serializer,l).keys().forEach(f=>h=h.add(f)),a.set(l.userId,h)}),z.forEach(a,(l,c)=>{const h=new jn(c),f=ff.lt(this.serializer,h),g=i.getIndexManager(h),v=pf.lt(h,this.serializer,g,i.referenceDelegate);return new kE(s,v,f,g).recalculateAndSaveOverlaysForDocumentKeys(new hm(t,Cr.oe),l).next()})})}}function z_(n){n.createObjectStore("targetDocuments",{keyPath:jD}).createIndex("documentTargetsIndex",BD,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",UD,{unique:!0}),n.createObjectStore("targetGlobal")}const kp="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Bg{constructor(e,t,r,s,i,o,a,l,c,h,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=h,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!Bg.D())throw new de(Q.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new XN(this,s),this.Ai=t+"main",this.serializer=new bE(l),this.Ri=new ks(this.Ai,this.hi,new cO(this.serializer)),this.$r=new jN,this.Ur=new QN(this.referenceDelegate,this.serializer),this.remoteDocumentCache=CE(this.serializer),this.Gr=new UN,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,h===!1&&In("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new de(Q.FAILED_PRECONDITION,kp);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Cr(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>kd(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(fo(e))return ce("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ce("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Pu(e).get("owner").next(t=>z.resolve(this.vi(t)))}Ci(e){return kd(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=$n(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return z.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?z.resolve(!0):Pu(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new de(Q.FAILED_PRECONDITION,kp);return!1}}return!(!this.networkEnabled||!this.inForeground)||kd(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&ce("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new hm(e,Cr.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>kd(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return pf.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new WN(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return ff.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){ce("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?ZD:l===16?XD:l===15?Ag:l===14?TI:l===13?EI:l===12?YD:l===11?II:void Ce()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new hm(a,this.Qr?this.Qr.next():Cr.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw In(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new de(Q.FAILED_PRECONDITION,yI);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Pu(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new de(Q.FAILED_PRECONDITION,kp)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Pu(e).put("owner",t)}static D(){return ks.D()}bi(e){const t=Pu(e);return t.get("owner").next(r=>this.vi(r)?(ce("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):z.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(In(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;Sx()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return ce("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return In("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){In("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Pu(n){return $n(n,"owner")}function kd(n){return $n(n,"clientMetadata")}function qg(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zg{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=it(),s=it();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new zg(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dO{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DE{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Sx()?8:bI(Ln())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new dO;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(Ja()<=_t.DEBUG&&ce("QueryEngine","SDK will not create cache indexes for query:",Ya(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),z.resolve()):(Ja()<=_t.DEBUG&&ce("QueryEngine","Query:",Ya(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Ja()<=_t.DEBUG&&ce("QueryEngine","The SDK decides to create cache indexes for query:",Ya(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,dr(t))):z.resolve())}Yi(e,t){if(g_(t))return z.resolve(null);let r=dr(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=bh(t,null,"F"),r=dr(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=it(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,bh(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return g_(t)||s.isEqual($e.min())?z.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?z.resolve(null):(Ja()<=_t.DEBUG&&ce("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ya(t)),this.rs(e,o,t,gI(s,-1)).next(a=>a))})}ts(e,t){let r=new jt(zI(e));return t.forEach((s,i)=>{zc(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return Ja()<=_t.DEBUG&&ce("QueryEngine","Using full collection scan to execute query:",Ya(t)),this.Ji.getDocumentsMatchingQuery(e,t,Hr.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hO{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Qt(Xe),this._s=new hi(i=>na(i),Bc),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new kE(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function NE(n,e,t,r){return new hO(n,e,t,r)}async function OE(n,e){const t=Ee(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=it();for(const c of s){o.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}for(const c of i){a.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function fO(n,e){const t=Ee(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,h){const f=c.batch,g=f.keys();let v=z.resolve();return g.forEach(x=>{v=v.next(()=>h.getEntry(l,x)).next(w=>{const I=c.docVersions.get(x);Oe(I!==null),w.version.compareTo(I)<0&&(f.applyToRemoteDocument(w,c),w.isValidDocument()&&(w.setReadTime(c.commitVersion),h.addEntry(w)))})}),v.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=it();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function VE(n){const e=Ee(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function pO(n,e){const t=Ee(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((h,f)=>{const g=s.get(f);if(!g)return;a.push(t.Ur.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,h.addedDocuments,f)));let v=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?v=v.withResumeToken(mn.EMPTY_BYTE_STRING,$e.min()).withLastLimboFreeSnapshotVersion($e.min()):h.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(h.resumeToken,r)),s=s.insert(f,v),function(w,I,$){return w.resumeToken.approximateByteSize()===0||I.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0}(g,v,h)&&a.push(t.Ur.updateTargetData(i,v))});let l=Dr(),c=it();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(ME(i,o,e.documentUpdates).next(h=>{l=h.Ps,c=h.Is})),!r.isEqual($e.min())){const h=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return z.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function ME(n,e,t){let r=it(),s=it();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Dr();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual($e.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):ce("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function mO(n,e){const t=Ee(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Al(n,e){const t=Ee(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,z.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new Ks(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function Sl(n,e,t){const r=Ee(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!fo(o))throw o;ce("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Ah(n,e,t){const r=Ee(n);let s=$e.min(),i=it();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,h){const f=Ee(l),g=f._s.get(h);return g!==void 0?z.resolve(f.os.get(g)):f.Ur.getTargetData(c,h)}(r,o,dr(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:$e.min(),t?i:it())).next(a=>(FE(r,qI(e),a),{documents:a,Ts:i})))}function LE(n,e){const t=Ee(n),r=Ee(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function $E(n,e){const t=Ee(n),r=t.us.get(e)||$e.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,gI(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(FE(t,e,s),s))}function FE(n,e,t){let r=n.us.get(e)||$e.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function gO(n,e,t,r){const s=Ee(n);let i=it(),o=Dr();for(const c of t){const h=e.Es(c.metadata.name);c.document&&(i=i.add(h));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(h,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await Al(s,function(h){return dr(Fl(bt.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>ME(c,a,o).next(h=>(a.apply(c),h)).next(h=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,h.Ps,h.Is)).next(()=>h.Ps)))}async function vO(n,e,t=it()){const r=await Al(n,dr(Lg(e.bundledQuery))),s=Ee(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=An(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(mn.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function H_(n,e){return`firestore_clients_${n}_${e}`}function K_(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Dp(n,e){return`firestore_targets_${n}_${e}`}class Sh{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new de(s.error.code,s.error.message))),o?new Sh(e,t,s.state,i):(In("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Zu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new de(r.error.code,r.error.message))),i?new Zu(e,r.state,s):(In("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ph{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Rg();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=wI(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Ph(e,i):(In("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Hg{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Hg(t.clientId,t.onlineState):(In("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Am{constructor(){this.activeTargetIds=Rg()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Np{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Qt(Xe),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=H_(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Am),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(H_(this.persistenceKey,r));if(s){const i=Ph.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Dp(this.persistenceKey,e));if(s){const i=Zu.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Dp(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return ce("SharedClientState","READ",e,t),t}setItem(e,t){ce("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){ce("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(ce("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void In("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=Cr.oe;if(i!=null)try{const a=JSON.parse(i);Oe(typeof a=="number"),o=a}catch(a){In("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Cr.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new Sh(this.currentUser,e,t,r),i=K_(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=K_(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Dp(this.persistenceKey,e),i=new Zu(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Ph.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Sh.Rs(new jn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return Zu.Rs(s,t)}Ls(e){return Hg.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);ce("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Rg();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class UE{constructor(){this.so=new Am,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Am,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yO{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G_{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){ce("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){ce("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dd=null;function Op(){return Dd===null?Dd=function(){return 268435456+Math.round(2147483648*Math.random())}():Dd++,"0x"+Dd.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _O={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bO{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rr="WebChannelConnection";class wO extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=Op(),l=this.xo(t,r.toUriEncodedString());ce("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(h=>(ce("RestConnection",`Received RPC '${t}' ${a}: `,h),h),h=>{throw es("RestConnection",`RPC '${t}' ${a} failed with error: `,h,"url: ",l,"request:",s),h})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+$l}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=_O[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Op();return new Promise((o,a)=>{const l=new aI;l.setWithCredentials(!0),l.listenOnce(lI.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Kd.NO_ERROR:const h=l.getResponseJson();ce(rr,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),o(h);break;case Kd.TIMEOUT:ce(rr,`RPC '${e}' ${i} timed out`),a(new de(Q.DEADLINE_EXCEEDED,"Request time out"));break;case Kd.HTTP_ERROR:const f=l.getStatus();if(ce(rr,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const v=g==null?void 0:g.error;if(v&&v.status&&v.message){const x=function(I){const $=I.toLowerCase().replace(/_/g,"-");return Object.values(Q).indexOf($)>=0?$:Q.UNKNOWN}(v.status);a(new de(x,v.message))}else a(new de(Q.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new de(Q.UNAVAILABLE,"Connection failed."));break;default:Ce()}}finally{ce(rr,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);ce(rr,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=Op(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=dI(),a=cI(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");ce(rr,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=o.createWebChannel(h,l);let g=!1,v=!1;const x=new bO({Io:I=>{v?ce(rr,`Not sending because RPC '${e}' stream ${s} is closed:`,I):(g||(ce(rr,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),ce(rr,`RPC '${e}' stream ${s} sending:`,I),f.send(I))},To:()=>f.close()}),w=(I,$,L)=>{I.listen($,U=>{try{L(U)}catch(q){setTimeout(()=>{throw q},0)}})};return w(f,Vu.EventType.OPEN,()=>{v||(ce(rr,`RPC '${e}' stream ${s} transport opened.`),x.yo())}),w(f,Vu.EventType.CLOSE,()=>{v||(v=!0,ce(rr,`RPC '${e}' stream ${s} transport closed`),x.So())}),w(f,Vu.EventType.ERROR,I=>{v||(v=!0,es(rr,`RPC '${e}' stream ${s} transport errored:`,I),x.So(new de(Q.UNAVAILABLE,"The operation could not be completed")))}),w(f,Vu.EventType.MESSAGE,I=>{var $;if(!v){const L=I.data[0];Oe(!!L);const U=L,q=U.error||(($=U[0])===null||$===void 0?void 0:$.error);if(q){ce(rr,`RPC '${e}' stream ${s} received error:`,q);const te=q.status;let X=function(T){const k=kn[T];if(k!==void 0)return sE(k)}(te),A=q.message;X===void 0&&(X=Q.INTERNAL,A="Unknown error status: "+te+" with message "+q.message),v=!0,x.So(new de(X,A)),f.close()}else ce(rr,`RPC '${e}' stream ${s} received:`,L),x.bo(L)}}),w(a,uI.STAT_EVENT,I=>{I.stat===cm.PROXY?ce(rr,`RPC '${e}' stream ${s} detected buffering proxy`):I.stat===cm.NOPROXY&&ce(rr,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{x.wo()},0),x}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jE(){return typeof window<"u"?window:null}function Zd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wc(n){return new RN(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kg{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&ce("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BE{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Kg(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===Q.RESOURCE_EXHAUSTED?(In(t.toString()),In("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===Q.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new de(Q.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return ce("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(ce("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class xO extends BE{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=DN(this.serializer,e),r=function(i){if(!("targetChange"in i))return $e.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?$e.min():o.readTime?An(o.readTime):$e.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=wm(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=yh(l)?{documents:pE(i,l)}:{query:hf(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=lE(i,o.resumeToken);const c=_m(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo($e.min())>0){a.readTime=Tl(i,o.snapshotVersion.toTimestamp());const c=_m(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=ON(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=wm(this.serializer),t.removeTarget=e,this.a_(t)}}class IO extends BE{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Oe(!!e.streamToken),this.lastStreamToken=e.streamToken,Oe(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Oe(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=NN(e.writeResults,e.commitTime),r=An(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=wm(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Ac(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EO extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new de(Q.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,bm(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===Q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new de(Q.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,bm(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new de(Q.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class TO{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(In(t),this.D_=!1):ce("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AO{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{mo(this)&&(ce("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=Ee(l);c.L_.add(4),await Bl(c),c.q_.set("Unknown"),c.L_.delete(4),await Qc(c)}(this))})}),this.q_=new TO(r,s)}}async function Qc(n){if(mo(n))for(const e of n.B_)await e(!0)}async function Bl(n){for(const e of n.B_)await e(!1)}function gf(n,e){const t=Ee(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Qg(t)?Wg(t):zl(t).r_()&&Gg(t,e))}function Pl(n,e){const t=Ee(n),r=zl(t);t.N_.delete(e),r.r_()&&qE(t,e),t.N_.size===0&&(r.r_()?r.o_():mo(t)&&t.q_.set("Unknown"))}function Gg(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($e.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}zl(n).A_(e)}function qE(n,e){n.Q_.xe(e),zl(n).R_(e)}function Wg(n){n.Q_=new TN({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),zl(n).start(),n.q_.v_()}function Qg(n){return mo(n)&&!zl(n).n_()&&n.N_.size>0}function mo(n){return Ee(n).L_.size===0}function zE(n){n.Q_=void 0}async function SO(n){n.q_.set("Online")}async function PO(n){n.N_.forEach((e,t)=>{Gg(n,e)})}async function RO(n,e){zE(n),Qg(n)?(n.q_.M_(e),Wg(n)):n.q_.set("Unknown")}async function CO(n,e,t){if(n.q_.set("Online"),e instanceof aE&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){ce("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Rh(n,r)}else if(e instanceof Xd?n.Q_.Ke(e):e instanceof oE?n.Q_.He(e):n.Q_.We(e),!t.isEqual($e.min()))try{const r=await VE(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.N_.get(c);h&&i.N_.set(c,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const h=i.N_.get(l);if(!h)return;i.N_.set(l,h.withResumeToken(mn.EMPTY_BYTE_STRING,h.snapshotVersion)),qE(i,l);const f=new Ks(h.target,l,c,h.sequenceNumber);Gg(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){ce("RemoteStore","Failed to raise snapshot:",r),await Rh(n,r)}}async function Rh(n,e,t){if(!fo(e))throw e;n.L_.add(1),await Bl(n),n.q_.set("Offline"),t||(t=()=>VE(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{ce("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Qc(n)})}function HE(n,e){return e().catch(t=>Rh(n,t,e))}async function ql(n){const e=Ee(n),t=io(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;kO(e);)try{const s=await mO(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,DO(e,s)}catch(s){await Rh(e,s)}KE(e)&&GE(e)}function kO(n){return mo(n)&&n.O_.length<10}function DO(n,e){n.O_.push(e);const t=io(n);t.r_()&&t.V_&&t.m_(e.mutations)}function KE(n){return mo(n)&&!io(n).n_()&&n.O_.length>0}function GE(n){io(n).start()}async function NO(n){io(n).p_()}async function OO(n){const e=io(n);for(const t of n.O_)e.m_(t.mutations)}async function VO(n,e,t){const r=n.O_.shift(),s=Ng.from(r,e,t);await HE(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await ql(n)}async function MO(n,e){e&&io(n).V_&&await async function(r,s){if(function(o){return rE(o)&&o!==Q.ABORTED}(s.code)){const i=r.O_.shift();io(r).s_(),await HE(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await ql(r)}}(n,e),KE(n)&&GE(n)}async function W_(n,e){const t=Ee(n);t.asyncQueue.verifyOperationInProgress(),ce("RemoteStore","RemoteStore received new credentials");const r=mo(t);t.L_.add(3),await Bl(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Qc(t)}async function Sm(n,e){const t=Ee(n);e?(t.L_.delete(2),await Qc(t)):e||(t.L_.add(2),await Bl(t),t.q_.set("Unknown"))}function zl(n){return n.K_||(n.K_=function(t,r,s){const i=Ee(t);return i.w_(),new xO(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:SO.bind(null,n),Ro:PO.bind(null,n),mo:RO.bind(null,n),d_:CO.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Qg(n)?Wg(n):n.q_.set("Unknown")):(await n.K_.stop(),zE(n))})),n.K_}function io(n){return n.U_||(n.U_=function(t,r,s){const i=Ee(t);return i.w_(),new IO(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:NO.bind(null,n),mo:MO.bind(null,n),f_:OO.bind(null,n),g_:VO.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await ql(n)):(await n.U_.stop(),n.O_.length>0&&(ce("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jg{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new qn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Jg(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new de(Q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Hl(n,e){if(In("AsyncQueue",`${e}: ${n}`),fo(n))return new de(Q.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ul{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Se.comparator(t.key,r.key):(t,r)=>Se.comparator(t.key,r.key),this.keyedMap=Mu(),this.sortedSet=new Qt(this.comparator)}static emptySet(e){return new ul(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ul)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new ul;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q_{constructor(){this.W_=new Qt(Se.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Ce():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Rl{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Rl(e,t,ul.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&qc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LO{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class $O{constructor(){this.queries=J_(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=Ee(t),i=s.queries;s.queries=J_(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new de(Q.ABORTED,"Firestore shutting down"))}}function J_(){return new hi(n=>BI(n),qc)}async function Yg(n,e){const t=Ee(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new LO,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Hl(o,`Initialization of query '${Ya(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Zg(t)}async function Xg(n,e){const t=Ee(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function FO(n,e){const t=Ee(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&Zg(t)}function UO(n,e,t){const r=Ee(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function Zg(n){n.Y_.forEach(e=>{e.next()})}var Pm,Y_;(Y_=Pm||(Pm={})).ea="default",Y_.Cache="cache";class ev{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Rl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Rl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Pm.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jO{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X_{constructor(e){this.serializer=e}Es(e){return Ds(this.serializer,e)}ds(e){return e.metadata.exists?fE(this.serializer,e.document,!1):Xt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return An(e)}}class BO{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=WE(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=bt.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new X_(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||it()).add(i);t.set(o,a)}}return t}async complete(){const e=await gO(this.localStore,new X_(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await vO(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function WE(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QE{constructor(e){this.key=e}}class JE{constructor(e){this.key=e}}class YE{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=it(),this.mutatedKeys=it(),this.Aa=zI(e),this.Ra=new ul(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new Q_,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const g=s.get(h),v=zc(this.query,f)?f:null,x=!!g&&this.mutatedKeys.has(g.key),w=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let I=!1;g&&v?g.data.isEqual(v.data)?x!==w&&(r.track({type:3,doc:v}),I=!0):this.ga(g,v)||(r.track({type:2,doc:v}),I=!0,(l&&this.Aa(v,l)>0||c&&this.Aa(v,c)<0)&&(a=!0)):!g&&v?(r.track({type:0,doc:v}),I=!0):g&&!v&&(r.track({type:1,doc:g}),I=!0,(l||c)&&(a=!0)),I&&(v?(o=o.add(v),i=w?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((h,f)=>function(v,x){const w=I=>{switch(I){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ce()}};return w(v)-w(x)}(h.type,f.type)||this.Aa(h.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new Rl(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Q_,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=it(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new JE(r))}),this.da.forEach(r=>{e.has(r)||t.push(new QE(r))}),t}ba(e){this.Ta=e.Ts,this.da=it();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Rl.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class qO{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class zO{constructor(e){this.key=e,this.va=!1}}class HO{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new hi(a=>BI(a),qc),this.Ma=new Map,this.xa=new Set,this.Oa=new Qt(Se.comparator),this.Na=new Map,this.La=new Ug,this.Ba={},this.ka=new Map,this.qa=aa.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function KO(n,e,t=!0){const r=vf(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await XE(r,e,t,!0),s}async function GO(n,e){const t=vf(n);await XE(t,e,!0,!1)}async function XE(n,e,t,r){const s=await Al(n.localStore,dr(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await tv(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&gf(n.remoteStore,s),a}async function tv(n,e,t,r,s){n.Ka=(f,g,v)=>async function(w,I,$,L){let U=I.view.ma($);U.ns&&(U=await Ah(w.localStore,I.query,!1).then(({documents:A})=>I.view.ma(A,U)));const q=L&&L.targetChanges.get(I.targetId),te=L&&L.targetMismatches.get(I.targetId)!=null,X=I.view.applyChanges(U,w.isPrimaryClient,q,te);return Rm(w,I.targetId,X.wa),X.snapshot}(n,f,g,v);const i=await Ah(n.localStore,e,!0),o=new YE(e,i.Ts),a=o.ma(i.documents),l=Gc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);Rm(n,t,c.wa);const h=new qO(e,t,o);return n.Fa.set(e,h),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function WO(n,e,t){const r=Ee(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!qc(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Sl(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Pl(r.remoteStore,s.targetId),Cl(r,s.targetId)}).catch(ho)):(Cl(r,s.targetId),await Sl(r.localStore,s.targetId,!0))}async function QO(n,e){const t=Ee(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Pl(t.remoteStore,r.targetId))}async function JO(n,e,t){const r=iv(n);try{const s=await function(o,a){const l=Ee(o),c=dn.now(),h=a.reduce((v,x)=>v.add(x.key),it());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",v=>{let x=Dr(),w=it();return l.cs.getEntries(v,h).next(I=>{x=I,x.forEach(($,L)=>{L.isValidDocument()||(w=w.add($))})}).next(()=>l.localDocuments.getOverlayedDocuments(v,x)).next(I=>{f=I;const $=[];for(const L of a){const U=xN(L,f.get(L.key).overlayedDocument);U!=null&&$.push(new fi(L.key,U,kI(U.value.mapValue),an.exists(!0)))}return l.mutationQueue.addMutationBatch(v,c,$,a)}).next(I=>{g=I;const $=I.applyToLocalDocumentSet(f,w);return l.documentOverlayCache.saveOverlays(v,I.batchId,$)})}).then(()=>({batchId:g.batchId,changes:KI(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new Qt(Xe)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await pi(r,s.changes),await ql(r.remoteStore)}catch(s){const i=Hl(s,"Failed to persist write");t.reject(i)}}async function ZE(n,e){const t=Ee(n);try{const r=await pO(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Oe(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Oe(o.va):s.removedDocuments.size>0&&(Oe(o.va),o.va=!1))}),await pi(t,r,e)}catch(r){await ho(r)}}function Z_(n,e,t){const r=Ee(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Ee(o);l.onlineState=a;let c=!1;l.queries.forEach((h,f)=>{for(const g of f.j_)g.Z_(a)&&(c=!0)}),c&&Zg(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function YO(n,e,t){const r=Ee(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Qt(Se.comparator);o=o.insert(i,Xt.newNoDocument(i,$e.min()));const a=it().add(i),l=new Kc($e.min(),new Map,new Qt(Xe),o,a);await ZE(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),sv(r)}else await Sl(r.localStore,e,!1).then(()=>Cl(r,e,t)).catch(ho)}async function XO(n,e){const t=Ee(n),r=e.batch.batchId;try{const s=await fO(t.localStore,e);rv(t,r,null),nv(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await pi(t,s)}catch(s){await ho(s)}}async function ZO(n,e,t){const r=Ee(n);try{const s=await function(o,a){const l=Ee(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let h;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(Oe(f!==null),h=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,h)).next(()=>l.localDocuments.getDocuments(c,h))})}(r.localStore,e);rv(r,e,t),nv(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await pi(r,s)}catch(s){await ho(s)}}async function eV(n,e){const t=Ee(n);mo(t.remoteStore)||ce("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=Ee(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Hl(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function nv(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function rv(n,e,t){const r=Ee(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Cl(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||eT(n,r)})}function eT(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Pl(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),sv(n))}function Rm(n,e,t){for(const r of t)r instanceof QE?(n.La.addReference(r.key,e),tV(n,r)):r instanceof JE?(ce("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||eT(n,r.key)):Ce()}function tV(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(ce("SyncEngine","New document in limbo: "+t),n.xa.add(r),sv(n))}function sv(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Se(bt.fromString(e)),r=n.qa.next();n.Na.set(r,new zO(t)),n.Oa=n.Oa.insert(t,r),gf(n.remoteStore,new Ks(dr(Fl(t.path)),r,"TargetPurposeLimboResolution",Cr.oe))}}async function pi(n,e,t){const r=Ee(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var h;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=zg.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const h=Ee(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>z.forEach(c,g=>z.forEach(g.$i,v=>h.persistence.referenceDelegate.addReference(f,g.targetId,v)).next(()=>z.forEach(g.Ui,v=>h.persistence.referenceDelegate.removeReference(f,g.targetId,v)))))}catch(f){if(!fo(f))throw f;ce("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const g=f.targetId;if(!f.fromCache){const v=h.os.get(g),x=v.snapshotVersion,w=v.withLastLimboFreeSnapshotVersion(x);h.os=h.os.insert(g,w)}}}(r.localStore,i))}async function nV(n,e){const t=Ee(n);if(!t.currentUser.isEqual(e)){ce("SyncEngine","User change. New user:",e.toKey());const r=await OE(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new de(Q.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await pi(t,r.hs)}}function rV(n,e){const t=Ee(n),r=t.Na.get(e);if(r&&r.va)return it().add(r.key);{let s=it();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function sV(n,e){const t=Ee(n),r=await Ah(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&Rm(t,e.targetId,s.wa),s}async function iV(n,e){const t=Ee(n);return $E(t.localStore,e).then(r=>pi(t,r))}async function oV(n,e,t,r){const s=Ee(n),i=await function(a,l){const c=Ee(a),h=Ee(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.Mn(f,l).next(g=>g?c.localDocuments.getDocuments(f,g):z.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await ql(s.remoteStore):t==="acknowledged"||t==="rejected"?(rv(s,e,r||null),nv(s,e),function(a,l){Ee(Ee(a).mutationQueue).On(l)}(s.localStore,e)):Ce(),await pi(s,i)):ce("SyncEngine","Cannot apply mutation batch with id: "+e)}async function aV(n,e){const t=Ee(n);if(vf(t),iv(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await eb(t,r.toArray());t.Qa=!0,await Sm(t.remoteStore,!0);for(const i of s)gf(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Cl(t,o),Sl(t.localStore,o,!0))),Pl(t.remoteStore,o)}),await s,await eb(t,r),function(o){const a=Ee(o);a.Na.forEach((l,c)=>{Pl(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Qt(Se.comparator)}(t),t.Qa=!1,await Sm(t.remoteStore,!1)}}async function eb(n,e,t){const r=Ee(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await Al(r.localStore,dr(l[0]));for(const c of l){const h=r.Fa.get(c),f=await sV(r,h);f.snapshot&&i.push(f.snapshot)}}else{const c=await LE(r.localStore,o);a=await Al(r.localStore,c),await tv(r,tT(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function tT(n){return FI(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function lV(n){return function(t){return Ee(Ee(t).persistence).Qi()}(Ee(n).localStore)}async function uV(n,e,t,r){const s=Ee(n);if(s.Qa)return void ce("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await $E(s.localStore,qI(i[0])),a=Kc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",mn.EMPTY_BYTE_STRING);await pi(s,o,a);break}case"rejected":await Sl(s.localStore,e,!0),Cl(s,e,r);break;default:Ce()}}async function cV(n,e,t){const r=vf(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){ce("SyncEngine","Adding an already active target "+s);continue}const i=await LE(r.localStore,s),o=await Al(r.localStore,i);await tv(r,tT(i),o.targetId,!1,o.resumeToken),gf(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await Sl(r.localStore,s,!1).then(()=>{Pl(r.remoteStore,s),Cl(r,s)}).catch(ho)}}function vf(n){const e=Ee(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=ZE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=rV.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=YO.bind(null,e),e.Ca.d_=FO.bind(null,e.eventManager),e.Ca.$a=UO.bind(null,e.eventManager),e}function iv(n){const e=Ee(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=XO.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ZO.bind(null,e),e}function dV(n,e,t){const r=Ee(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(v,x){const w=Ee(v),I=An(x.createTime);return w.persistence.runTransaction("hasNewerBundle","readonly",$=>w.Gr.getBundleMetadata($,x.id)).then($=>!!$&&$.createTime.compareTo(I)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(v){return{taskState:"Success",documentsLoaded:v.totalDocuments,bytesLoaded:v.totalBytes,totalDocuments:v.totalDocuments,totalBytes:v.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(WE(l));const c=new BO(l,i.localStore,o.serializer);let h=await o.Ua();for(;h;){const g=await c.la(h);g&&a._updateProgress(g),h=await o.Ua()}const f=await c.complete();return await pi(i,f.Ia,void 0),await function(v,x){const w=Ee(v);return w.persistence.runTransaction("Save bundle","readwrite",I=>w.Gr.saveBundleMetadata(I,x))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return es("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class oo{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Wc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return NE(this.persistence,new DE,e.initialUser,this.serializer)}Ga(e){return new jg(mf.Zr,this.serializer)}Wa(e){return new UE}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}oo.provider={build:()=>new oo};class hV extends oo{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Oe(this.persistence.referenceDelegate instanceof Th);const r=this.persistence.referenceDelegate.garbageCollector;return new SE(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?ir.withCacheSize(this.cacheSizeBytes):ir.DEFAULT;return new jg(r=>Th.Zr(r,t),this.serializer)}}class ov extends oo{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await iv(this.Ja.syncEngine),await ql(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return NE(this.persistence,new DE,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new SE(r,e.asyncQueue,t)}Ha(e,t){const r=new OD(t,this.persistence);return new ND(e.asyncQueue,r)}Ga(e){const t=qg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?ir.withCacheSize(this.cacheSizeBytes):ir.DEFAULT;return new Bg(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,jE(),Zd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new UE}}class nT extends ov{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Np&&(this.sharedClientState.syncEngine={no:oV.bind(null,t),ro:uV.bind(null,t),io:cV.bind(null,t),Qi:lV.bind(null,t),eo:iV.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await aV(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=jE();if(!Np.D(t))throw new de(Q.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=qg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Np(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class ao{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Z_(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=nV.bind(null,this.syncEngine),await Sm(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new $O}()}createDatastore(e){const t=Wc(e.databaseInfo.databaseId),r=function(i){return new wO(i)}(e.databaseInfo);return function(i,o,a,l){return new EO(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new AO(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>Z_(this.syncEngine,t,0),function(){return G_.D()?new G_:new yO}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,h){const f=new HO(s,i,o,a,l,c);return h&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Ee(s);ce("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Bl(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}ao.provider={build:()=>new ao};function tb(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yf{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):In("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fV{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new qn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new jO(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pV{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new de(Q.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=Ee(s),a={documents:i.map(f=>Tc(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,bt.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const g=kN(o.serializer,f);c.set(g.key.toString(),g)});const h=[];return i.forEach(f=>{const g=c.get(f.toString());Oe(!!g),h.push(g)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new jl(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=Se.fromPath(r);this.mutations.push(new kg(s,this.precondition(s)))}),await async function(r,s){const i=Ee(r),o={writes:s.map(a=>Ac(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,bt.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Ce();t=$e.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new de(Q.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual($e.min())?an.exists(!1):an.updateTime(t):an.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual($e.min()))throw new de(Q.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return an.updateTime(t)}return an.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mV{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Kg(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new pV(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!jc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!rE(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gV{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=jn.UNAUTHENTICATED,this.clientId=pI.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{ce("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(ce("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new qn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Hl(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Vp(n,e){n.asyncQueue.verifyOperationInProgress(),ce("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await OE(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function nb(n,e){n.asyncQueue.verifyOperationInProgress();const t=await av(n);ce("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>W_(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>W_(e.remoteStore,s)),n._onlineComponents=e}async function av(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){ce("FirestoreClient","Using user provided OfflineComponentProvider");try{await Vp(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===Q.FAILED_PRECONDITION||s.code===Q.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;es("Error using user provided cache. Falling back to memory cache: "+t),await Vp(n,new oo)}}else ce("FirestoreClient","Using default OfflineComponentProvider"),await Vp(n,new oo);return n._offlineComponents}async function _f(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(ce("FirestoreClient","Using user provided OnlineComponentProvider"),await nb(n,n._uninitializedComponentsProvider._online)):(ce("FirestoreClient","Using default OnlineComponentProvider"),await nb(n,new ao))),n._onlineComponents}function rT(n){return av(n).then(e=>e.persistence)}function Kl(n){return av(n).then(e=>e.localStore)}function sT(n){return _f(n).then(e=>e.remoteStore)}function lv(n){return _f(n).then(e=>e.syncEngine)}function iT(n){return _f(n).then(e=>e.datastore)}async function kl(n){const e=await _f(n),t=e.eventManager;return t.onListen=KO.bind(null,e.syncEngine),t.onUnlisten=WO.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=GO.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=QO.bind(null,e.syncEngine),t}function vV(n){return n.asyncQueue.enqueue(async()=>{const e=await rT(n),t=await sT(n);return e.setNetworkEnabled(!0),function(s){const i=Ee(s);return i.L_.delete(0),Qc(i)}(t)})}function yV(n){return n.asyncQueue.enqueue(async()=>{const e=await rT(n),t=await sT(n);return e.setNetworkEnabled(!1),async function(s){const i=Ee(s);i.L_.add(0),await Bl(i),i.q_.set("Offline")}(t)})}function _V(n,e){const t=new qn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,h){const f=Ee(c);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new de(Q.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Hl(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Kl(n),e,t)),t.promise}function oT(n,e,t={}){const r=new qn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const h=new yf({next:g=>{h.Za(),o.enqueueAndForget(()=>Xg(i,f));const v=g.docs.has(a);!v&&g.fromCache?c.reject(new de(Q.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&g.fromCache&&l&&l.source==="server"?c.reject(new de(Q.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new ev(Fl(a.path),h,{includeMetadataChanges:!0,_a:!0});return Yg(i,f)}(await kl(n),n.asyncQueue,e,t,r)),r.promise}function bV(n,e){const t=new qn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await Ah(s,i,!0),l=new YE(i,a.Ts),c=l.ma(a.documents),h=l.applyChanges(c,!1);o.resolve(h.snapshot)}catch(a){const l=Hl(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Kl(n),e,t)),t.promise}function aT(n,e,t={}){const r=new qn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const h=new yf({next:g=>{h.Za(),o.enqueueAndForget(()=>Xg(i,f)),g.fromCache&&l.source==="server"?c.reject(new de(Q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new ev(a,h,{includeMetadataChanges:!0,_a:!0});return Yg(i,f)}(await kl(n),n.asyncQueue,e,t,r)),r.promise}function wV(n,e,t){const r=new qn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await iT(n);r.resolve(async function(o,a,l){var c;const h=Ee(o),{request:f,ut:g,parent:v}=mE(h.serializer,UI(a),l);h.connection.Fo||delete f.parent;const x=(await h.Lo("RunAggregationQuery",h.serializer.databaseId,v,f,1)).filter(I=>!!I.result);Oe(x.length===1);const w=(c=x[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(w).reduce((I,$)=>(I[g[$]]=w[$],I),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function xV(n,e){const t=new yf(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){Ee(s).Y_.add(i),i.next()}(await kl(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){Ee(s).Y_.delete(i)}(await kl(n),t))}}function IV(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?iE().encode(o):o,function(h,f){return new fV(h,f)}(function(h,f){if(h instanceof Uint8Array)return tb(h,f);if(h instanceof ArrayBuffer)return tb(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,Wc(e));n.asyncQueue.enqueueAndForget(async()=>{dV(await lv(n),s,r)})}function EV(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=Ee(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await Kl(n),e))}function TV(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=Ee(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,g,v,x,w){f=[...f],g=[...g],f.sort(v),g.sort(v);const I=f.length,$=g.length;let L=0,U=0;for(;L<$&&U<I;){const q=v(f[U],g[L]);q<0?w(f[U++]):q>0?x(g[L++]):(L++,U++)}for(;L<$;)x(g[L++]);for(;U<I;)w(f[U++])}(c,s,RD,h=>{a.push(o.addFieldIndex(l,h))},h=>{a.push(o.deleteFieldIndex(l,h))})).next(()=>z.waitFor(a)))}(await Kl(n),e))}function AV(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){Ee(r).ss.zi=s}(await Kl(n),e))}function SV(n){return n.asyncQueue.enqueue(async()=>function(t){const r=Ee(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Kl(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lT(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rb=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uv(n,e,t){if(!t)throw new de(Q.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function PV(n,e,t,r){if(e===!0&&r===!0)throw new de(Q.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function sb(n){if(!Se.isDocumentKey(n))throw new de(Q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ib(n){if(Se.isDocumentKey(n))throw new de(Q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function bf(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ce()}function gt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new de(Q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=bf(n);throw new de(Q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function uT(n,e){if(e<=0)throw new de(Q.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ob{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new de(Q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new de(Q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}PV("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=lT((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new de(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new de(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new de(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Jc{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ob({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new de(Q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new de(Q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ob(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new wD;switch(r.type){case"firstParty":return new TD(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new de(Q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=rb.get(t);r&&(ce("ComponentProvider","Removing Datastore"),rb.delete(t),r.terminate())}(this),Promise.resolve()}}function RV(n,e,t,r={}){var s;const i=(n=gt(n,Jc))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&es("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=jn.MOCK_USER;else{a=Ax(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new de(Q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new jn(c)}n._authCredentials=new xD(new hI(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Jn(this.firestore,e,this._query)}}class Sn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ns(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Sn(this.firestore,e,this._key)}}class Ns extends Jn{constructor(e,t,r){super(e,t,Fl(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Sn(this.firestore,null,new Se(e))}withConverter(e){return new Ns(this.firestore,e,this._path)}}function tt(n,e,...t){if(n=De(n),uv("collection","path",e),n instanceof Jc){const r=bt.fromString(e,...t);return ib(r),new Ns(n,null,r)}{if(!(n instanceof Sn||n instanceof Ns))throw new de(Q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(bt.fromString(e,...t));return ib(r),new Ns(n.firestore,null,r)}}function FK(n,e){if(n=gt(n,Jc),uv("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new de(Q.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Jn(n,null,function(r){return new di(bt.emptyPath(),r)}(e))}function _e(n,e,...t){if(n=De(n),arguments.length===1&&(e=pI.newId()),uv("doc","path",e),n instanceof Jc){const r=bt.fromString(e,...t);return sb(r),new Sn(n,null,new Se(r))}{if(!(n instanceof Sn||n instanceof Ns))throw new de(Q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(bt.fromString(e,...t));return sb(r),new Sn(n.firestore,n instanceof Ns?n.converter:null,new Se(r))}}function UK(n,e){return n=De(n),e=De(e),(n instanceof Sn||n instanceof Ns)&&(e instanceof Sn||e instanceof Ns)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function cT(n,e){return n=De(n),e=De(e),n instanceof Jn&&e instanceof Jn&&n.firestore===e.firestore&&qc(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ab{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Kg(this,"async_queue_retry"),this.Vu=()=>{const r=Zd();r&&ce("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Zd();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Zd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new qn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!fo(e))throw e;ce("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw In("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Jg.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&Ce()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function Cm(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class CV{constructor(){this._progressObserver={},this._taskCompletionResolver=new qn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jK=-1;class Ht extends Jc{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new ab,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ab(e),this._firestoreClient=void 0,await e}}}function BK(n,e,t){t||(t="(default)");const r=ci(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(eo(i,e))return s;throw new de(Q.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new de(Q.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new de(Q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function kV(n,e){const t=typeof n=="object"?n:Ll(),r=typeof n=="string"?n:e||"(default)",s=ci(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=Ix("firestore");i&&RV(s,...i)}return s}function hn(n){if(n._terminated)throw new de(Q.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||dT(n),n._firestoreClient}function dT(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,h){return new tN(a,l,c,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,lT(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new gV(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function DV(n,e){es("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return hT(n,ao.provider,{build:r=>new ov(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function qK(n){es("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();hT(n,ao.provider,{build:t=>new nT(t,e.cacheSizeBytes)})}function hT(n,e,t){if((n=gt(n,Ht))._firestoreClient||n._terminated)throw new de(Q.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new de(Q.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},dT(n)}function zK(n){if(n._initialized&&!n._terminated)throw new de(Q.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new qn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!ks.D())return Promise.resolve();const s=r+"main";await ks.delete(s)}(qg(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function HK(n){return function(t){const r=new qn;return t.asyncQueue.enqueueAndForget(async()=>eV(await lv(t),r)),r.promise}(hn(n=gt(n,Ht)))}function KK(n){return vV(hn(n=gt(n,Ht)))}function GK(n){return yV(hn(n=gt(n,Ht)))}function WK(n){return $k(n.app,"firestore",n._databaseId.database),n._delete()}function QK(n,e){const t=hn(n=gt(n,Ht)),r=new CV;return IV(t,n._databaseId,e,r),r}function JK(n,e){return EV(hn(n=gt(n,Ht)),e).then(t=>t?new Jn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sc{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class NV{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(e){this._byteString=e}static fromBase64String(e){try{return new la(mn.fromBase64String(e))}catch(t){throw new de(Q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new la(mn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pa{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new de(Q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new on(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function YK(){return new pa("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ma{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cv{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new de(Q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new de(Q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Xe(this._lat,e._lat)||Xe(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wf{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OV=/^__.*__$/;class VV{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new fi(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ul(e,this.data,t,this.fieldTransforms)}}class fT{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new fi(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function pT(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ce()}}class xf{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new xf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Ch(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(pT(this.Cu)&&OV.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class MV{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Wc(e)}Qu(e,t,r,s=!1){return new xf({Cu:e,methodName:t,qu:r,path:on.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ga(n){const e=n._freezeSettings(),t=Wc(n._databaseId);return new MV(n._databaseId,!!e.ignoreUndefinedProperties,t)}function If(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);vv("Data must be an object, but it was:",o,r);const a=vT(r,o);let l,c;if(i.merge)l=new kr(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const g=Pc(e,f,t);if(!o.contains(g))throw new de(Q.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);_T(h,g)||h.push(g)}l=new kr(h),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new VV(new Qn(a),l,c)}class Yc extends ma{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Yc}}function mT(n,e,t){return new xf({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class dv extends ma{_toFieldTransform(e){return new Hc(e.path,new Il)}isEqual(e){return e instanceof dv}}class hv extends ma{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=mT(this,e,!0),r=this.Ku.map(i=>va(i,t)),s=new ra(r);return new Hc(e.path,s)}isEqual(e){return e instanceof hv&&eo(this.Ku,e.Ku)}}class fv extends ma{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=mT(this,e,!0),r=this.Ku.map(i=>va(i,t)),s=new sa(r);return new Hc(e.path,s)}isEqual(e){return e instanceof fv&&eo(this.Ku,e.Ku)}}class pv extends ma{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new El(e.serializer,QI(e.serializer,this.$u));return new Hc(e.path,t)}isEqual(e){return e instanceof pv&&this.$u===e.$u}}function mv(n,e,t,r){const s=n.Qu(1,e,t);vv("Data must be an object, but it was:",s,r);const i=[],o=Qn.empty();po(r,(l,c)=>{const h=Ef(e,l,t);c=De(c);const f=s.Nu(h);if(c instanceof Yc)i.push(h);else{const g=va(c,f);g!=null&&(i.push(h),o.set(h,g))}});const a=new kr(i);return new fT(o,a,s.fieldTransforms)}function gv(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[Pc(e,r,t)],l=[s];if(i.length%2!=0)throw new de(Q.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(Pc(e,i[g])),l.push(i[g+1]);const c=[],h=Qn.empty();for(let g=a.length-1;g>=0;--g)if(!_T(c,a[g])){const v=a[g];let x=l[g];x=De(x);const w=o.Nu(v);if(x instanceof Yc)c.push(v);else{const I=va(x,w);I!=null&&(c.push(v),h.set(v,I))}}const f=new kr(c);return new fT(h,f,o.fieldTransforms)}function gT(n,e,t,r=!1){return va(t,n.Qu(r?4:3,e))}function va(n,e){if(yT(n=De(n)))return vv("Unsupported field value:",e,n),vT(n,e);if(n instanceof ma)return function(r,s){if(!pT(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=va(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=De(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return QI(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=dn.fromDate(r);return{timestampValue:Tl(s.serializer,i)}}if(r instanceof dn){const i=new dn(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Tl(s.serializer,i)}}if(r instanceof cv)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof la)return{bytesValue:lE(s.serializer,r._byteString)};if(r instanceof Sn){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Mg(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof wf)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Cg(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${bf(r)}`)}(n,e)}function vT(n,e){const t={};return SI(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):po(n,(r,s)=>{const i=va(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function yT(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof dn||n instanceof cv||n instanceof la||n instanceof Sn||n instanceof ma||n instanceof wf)}function vv(n,e,t){if(!yT(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=bf(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function Pc(n,e,t){if((e=De(e))instanceof pa)return e._internalPath;if(typeof e=="string")return Ef(n,e);throw Ch("Field path arguments must be of type string or ",n,!1,void 0,t)}const LV=new RegExp("[~\\*/\\[\\]]");function Ef(n,e,t){if(e.search(LV)>=0)throw Ch(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new pa(...e.split("."))._internalPath}catch{throw Ch(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ch(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new de(Q.INVALID_ARGUMENT,a+n+l)}function _T(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rc{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Sn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new $V(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Tf("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class $V extends Rc{data(){return super.data()}}function Tf(n,e){return typeof e=="string"?Ef(n,e):e instanceof pa?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new de(Q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class yv{}class Xc extends yv{}function Cc(n,e,...t){let r=[];e instanceof yv&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Gl).length,a=i.filter(l=>l instanceof Zc).length;if(o>1||o>0&&a>0)throw new de(Q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Zc extends Xc{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Zc(e,t,r)}_apply(e){const t=this._parse(e);return xT(e._query,t),new Jn(e.firestore,e.converter,ym(e._query,t))}_parse(e){const t=ga(e.firestore);return function(i,o,a,l,c,h,f){let g;if(c.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new de(Q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){ub(f,h);const v=[];for(const x of f)v.push(lb(l,i,x));g={arrayValue:{values:v}}}else g=lb(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||ub(f,h),g=gT(a,o,f,h==="in"||h==="not-in");return wt.create(c,h,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function kh(n,e,t){const r=e,s=Tf("where",n);return Zc._create(s,r,t)}class Gl extends yv{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Gl(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Ft.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)xT(o,l),o=ym(o,l)}(e._query,t),new Jn(e.firestore,e.converter,ym(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function XK(...n){return n.forEach(e=>IT("or",e)),Gl._create("or",n)}function ZK(...n){return n.forEach(e=>IT("and",e)),Gl._create("and",n)}class _v extends Xc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new _v(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new de(Q.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new de(Q.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ec(i,o)}(e._query,this._field,this._direction);return new Jn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new di(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function FV(n,e="asc"){const t=e,r=Tf("orderBy",n);return _v._create(r,t)}class Af extends Xc{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Af(e,t,r)}_apply(e){return new Jn(e.firestore,e.converter,bh(e._query,this._limit,this._limitType))}}function eG(n){return uT("limit",n),Af._create("limit",n,"F")}function tG(n){return uT("limitToLast",n),Af._create("limitToLast",n,"L")}class Sf extends Xc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Sf(e,t,r)}_apply(e){const t=wT(e,this.type,this._docOrFields,this._inclusive);return new Jn(e.firestore,e.converter,function(s,i){return new di(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function nG(...n){return Sf._create("startAt",n,!0)}function rG(...n){return Sf._create("startAfter",n,!1)}class Pf extends Xc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Pf(e,t,r)}_apply(e){const t=wT(e,this.type,this._docOrFields,this._inclusive);return new Jn(e.firestore,e.converter,function(s,i){return new di(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function sG(...n){return Pf._create("endBefore",n,!1)}function iG(...n){return Pf._create("endAt",n,!0)}function wT(n,e,t,r){if(t[0]=De(t[0]),t[0]instanceof Rc)return function(i,o,a,l,c){if(!l)throw new de(Q.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of ll(i))if(f.field.isKeyField())h.push(ta(o,l.key));else{const g=l.data.field(f.field);if(af(g))throw new de(Q.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const v=f.field.canonicalString();throw new de(Q.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${v}' (used as the orderBy) does not exist.`)}h.push(g)}return new so(h,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=ga(n.firestore);return function(o,a,l,c,h,f){const g=o.explicitOrderBy;if(h.length>g.length)throw new de(Q.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const v=[];for(let x=0;x<h.length;x++){const w=h[x];if(g[x].field.isKeyField()){if(typeof w!="string")throw new de(Q.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof w}`);if(!Pg(o)&&w.indexOf("/")!==-1)throw new de(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${w}' contains a slash.`);const I=o.path.child(bt.fromString(w));if(!Se.isDocumentKey(I))throw new de(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${I}' is not because it contains an odd number of segments.`);const $=new Se(I);v.push(ta(a,$))}else{const I=gT(l,c,w);v.push(I)}}return new so(v,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function lb(n,e,t){if(typeof(t=De(t))=="string"){if(t==="")throw new de(Q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Pg(e)&&t.indexOf("/")!==-1)throw new de(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(bt.fromString(t));if(!Se.isDocumentKey(r))throw new de(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ta(n,new Se(r))}if(t instanceof Sn)return ta(n,t._key);throw new de(Q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${bf(t)}.`)}function ub(n,e){if(!Array.isArray(n)||n.length===0)throw new de(Q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function xT(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new de(Q.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new de(Q.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function IT(n,e){if(!(e instanceof Zc||e instanceof Gl))throw new de(Q.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class ET{convertValue(e,t="none"){switch(no(e)){case 0:return null;case 1:return e.booleanValue;case 2:return sn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ii(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ce()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return po(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>sn(o.doubleValue));return new wf(i)}convertGeoPoint(e){return new cv(sn(e.latitude),sn(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=lf(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(wc(e));default:return null}}convertTimestamp(e){const t=si(e);return new dn(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=bt.fromString(e);Oe(_E(r));const s=new ea(r.get(1),r.get(3)),i=new Se(r.popFirst(5));return s.isEqual(t)||In(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rf(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class UV extends ET{constructor(e){super(),this.firestore=e}convertBytes(e){return new la(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Sn(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oG(n){return new Sc("sum",Pc("sum",n))}function aG(n){return new Sc("avg",Pc("average",n))}function jV(){return new Sc("count")}function lG(n,e){var t,r;return n instanceof Sc&&e instanceof Sc&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function uG(n,e){return cT(n.query,e.query)&&eo(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zo{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Dl extends Rc{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new eh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Tf("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class eh extends Dl{data(e={}){return super.data(e)}}class Nl{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new zo(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new eh(this._firestore,this._userDataWriter,r.key,r,new zo(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new de(Q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new eh(s._firestore,s._userDataWriter,a.doc.key,a.doc,new zo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new eh(s._firestore,s._userDataWriter,a.doc.key,a.doc,new zo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,h=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:BV(a.type),doc:l,oldIndex:c,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function BV(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ce()}}function cG(n,e){return n instanceof Dl&&e instanceof Dl?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Nl&&e instanceof Nl&&n._firestore===e._firestore&&cT(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kt(n){n=gt(n,Sn);const e=gt(n.firestore,Ht);return oT(hn(e),n._key).then(t=>bv(e,n,t))}class go extends ET{constructor(e){super(),this.firestore=e}convertBytes(e){return new la(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Sn(this.firestore,null,t)}}function dG(n){n=gt(n,Sn);const e=gt(n.firestore,Ht),t=hn(e),r=new go(e);return _V(t,n._key).then(s=>new Dl(e,r,n._key,s,new zo(s!==null&&s.hasLocalMutations,!0),n.converter))}function hG(n){n=gt(n,Sn);const e=gt(n.firestore,Ht);return oT(hn(e),n._key,{source:"server"}).then(t=>bv(e,n,t))}function $t(n){n=gt(n,Jn);const e=gt(n.firestore,Ht),t=hn(e),r=new go(e);return bT(n._query),aT(t,n._query).then(s=>new Nl(e,r,n,s))}function fG(n){n=gt(n,Jn);const e=gt(n.firestore,Ht),t=hn(e),r=new go(e);return bV(t,n._query).then(s=>new Nl(e,r,n,s))}function pG(n){n=gt(n,Jn);const e=gt(n.firestore,Ht),t=hn(e),r=new go(e);return aT(t,n._query,{source:"server"}).then(s=>new Nl(e,r,n,s))}function Wt(n,e,t){n=gt(n,Sn);const r=gt(n.firestore,Ht),s=Rf(n.converter,e,t);return ed(r,[If(ga(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,an.none())])}function vo(n,e,t,...r){n=gt(n,Sn);const s=gt(n.firestore,Ht),i=ga(s);let o;return o=typeof(e=De(e))=="string"||e instanceof pa?gv(i,"updateDoc",n._key,e,t,r):mv(i,"updateDoc",n._key,e),ed(s,[o.toMutation(n._key,an.exists(!0))])}function Ol(n){return ed(gt(n.firestore,Ht),[new jl(n._key,an.none())])}function ya(n,e){const t=gt(n.firestore,Ht),r=_e(n),s=Rf(n.converter,e);return ed(t,[If(ga(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,an.exists(!1))]).then(()=>r)}function mG(n,...e){var t,r,s;n=De(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Cm(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Cm(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,h;if(n instanceof Sn)c=gt(n.firestore,Ht),h=Fl(n._key.path),l={next:f=>{e[o]&&e[o](bv(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=gt(n,Jn);c=gt(f.firestore,Ht),h=f._query;const g=new go(c);l={next:v=>{e[o]&&e[o](new Nl(c,g,f,v))},error:e[o+1],complete:e[o+2]},bT(n._query)}return function(g,v,x,w){const I=new yf(w),$=new ev(v,I,x);return g.asyncQueue.enqueueAndForget(async()=>Yg(await kl(g),$)),()=>{I.Za(),g.asyncQueue.enqueueAndForget(async()=>Xg(await kl(g),$))}}(hn(c),h,a,l)}function gG(n,e){return xV(hn(n=gt(n,Ht)),Cm(e)?e:{next:e})}function ed(n,e){return function(r,s){const i=new qn;return r.asyncQueue.enqueueAndForget(async()=>JO(await lv(r),s,i)),i.promise}(hn(n),e)}function bv(n,e,t){const r=t.docs.get(e._key),s=new go(n);return new Dl(n,s,e._key,r,new zo(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vG(n){return qV(n,{count:jV()})}function qV(n,e){const t=gt(n.firestore,Ht),r=hn(t),s=AI(e,(i,o)=>new nE(o,i.aggregateType,i._internalFieldPath));return wV(r,n._query,s).then(i=>function(a,l,c){const h=new go(a);return new NV(l,h,c)}(t,n,i))}class zV{constructor(e){this.kind="memory",this._onlineComponentProvider=ao.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=oo.provider}toJSON(){return{kind:this.kind}}}class HV{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=JV(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class KV{constructor(){this.kind="memoryEager",this._offlineComponentProvider=oo.provider}toJSON(){return{kind:this.kind}}}class GV{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new hV(e)}}toJSON(){return{kind:this.kind}}}function yG(){return new KV}function _G(n){return new GV(n==null?void 0:n.cacheSizeBytes)}function bG(n){return new zV(n)}function wG(n){return new HV(n)}class WV{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ao.provider,this._offlineComponentProvider={build:t=>new ov(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class QV{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ao.provider,this._offlineComponentProvider={build:t=>new nT(t,e==null?void 0:e.cacheSizeBytes)}}}function JV(n){return new WV(n==null?void 0:n.forceOwnership)}function xG(){return new QV}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YV={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XV{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ga(e)}set(e,t,r){this._verifyNotCommitted();const s=Fi(e,this._firestore),i=Rf(s.converter,t,r),o=If(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,an.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Fi(e,this._firestore);let o;return o=typeof(t=De(t))=="string"||t instanceof pa?gv(this._dataReader,"WriteBatch.update",i._key,t,r,s):mv(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,an.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Fi(e,this._firestore);return this._mutations=this._mutations.concat(new jl(t._key,an.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new de(Q.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Fi(n,e){if((n=De(n)).firestore!==e)throw new de(Q.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZV extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=ga(t)}get(t){const r=Fi(t,this._firestore),s=new UV(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return Ce();const o=i[0];if(o.isFoundDocument())return new Rc(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new Rc(this._firestore,s,r._key,null,r.converter);throw Ce()})}set(t,r,s){const i=Fi(t,this._firestore),o=Rf(i.converter,r,s),a=If(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=Fi(t,this._firestore);let a;return a=typeof(r=De(r))=="string"||r instanceof pa?gv(this._dataReader,"Transaction.update",o._key,r,s,i):mv(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=Fi(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Fi(e,this._firestore),r=new go(this._firestore);return super.get(e).then(s=>new Dl(this._firestore,r,t._key,s._document,new zo(!1,!1),t.converter))}}function EG(n,e,t){n=gt(n,Ht);const r=Object.assign(Object.assign({},YV),t);return function(i){if(i.maxAttempts<1)throw new de(Q.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new qn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await iT(i);new mV(i.asyncQueue,c,a,o,l).au()}),l.promise}(hn(n),s=>e(new ZV(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TG(){return new Yc("deleteField")}function Yn(){return new dv("serverTimestamp")}function eM(...n){return new hv("arrayUnion",n)}function AG(...n){return new fv("arrayRemove",n)}function SG(n){return new pv("increment",n)}function PG(n){return new wf(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wv(n){return hn(n=gt(n,Ht)),new XV(n,e=>ed(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RG(n,e){const t=hn(n=gt(n,Ht));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return es("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(h){throw new de(Q.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=cb(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=Ef("setIndexConfiguration",cb(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new Wo(g,2)):f.order==="ASCENDING"?h.push(new Wo(g,0)):f.order==="DESCENDING"&&h.push(new Wo(g,1))}a.push(new _l(_l.UNKNOWN_ID,c,h,bl.empty()))}return a}(e);return TV(t,r)}function cb(n,e){if(typeof n[e]!="string")throw new de(Q.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tM{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function CG(n){var e;n=gt(n,Ht);const t=db.get(n);if(t)return t;if(((e=hn(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new tM(n);return db.set(n,r),r}function kG(n){TT(n,!0)}function DG(n){TT(n,!1)}function NG(n){SV(hn(n._firestore)).then(e=>ce("deleting all persistent cache indexes succeeded")).catch(e=>es("deleting all persistent cache indexes failed",e))}function TT(n,e){AV(hn(n._firestore),e).then(t=>ce(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>es(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const db=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OG(n){var e;const t=(e=hn(gt(n.firestore,Ht))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:hf(t,dr(n._query))._t}function VG(n,e){var t;const r=AI(e,(i,o)=>new nE(o,i.aggregateType,i._internalFieldPath)),s=(t=hn(gt(n.firestore,Ht))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:mE(s,UI(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MG{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return xv.instance.onExistenceFilterMismatch(e)}}class xv{constructor(){this.Uu=new Map}static get instance(){return Nd||(Nd=new xv,function(t){if(wh)throw new Error("a TestingHooksSpi instance is already set");wh=t}(Nd)),Nd}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let Nd=null;(function(e,t=!0){(function(s){$l=s})(fa),fs(new Zr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Ht(new ID(r.getProvider("auth-internal")),new AD(r.getProvider("app-check-internal")),function(c,h){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new de(Q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ea(c.options.projectId,h)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Nr(e_,"4.7.3",e),Nr(e_,"4.7.3","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AT="firebasestorage.googleapis.com",ST="storageBucket",nM=2*60*1e3,rM=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vn extends ps{constructor(e,t,r=0){super(Mp(e),`Firebase Storage: ${t} (${Mp(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,vn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Mp(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var gn;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(gn||(gn={}));function Mp(n){return"storage/"+n}function Iv(){const n="An unknown error occurred, please check the error payload for server response.";return new vn(gn.UNKNOWN,n)}function sM(n){return new vn(gn.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function iM(n){return new vn(gn.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function oM(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new vn(gn.UNAUTHENTICATED,n)}function aM(){return new vn(gn.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function lM(n){return new vn(gn.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function uM(){return new vn(gn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function cM(){return new vn(gn.CANCELED,"User canceled the upload/download.")}function dM(n){return new vn(gn.INVALID_URL,"Invalid URL '"+n+"'.")}function hM(n){return new vn(gn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function fM(){return new vn(gn.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+ST+"' property when initializing the app?")}function pM(){return new vn(gn.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function mM(){return new vn(gn.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function gM(n){return new vn(gn.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function km(n){return new vn(gn.INVALID_ARGUMENT,n)}function PT(){return new vn(gn.APP_DELETED,"The Firebase app was deleted.")}function vM(n){return new vn(gn.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function ec(n,e){return new vn(gn.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Ru(n){throw new vn(gn.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zr{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=zr.makeFromUrl(e,t)}catch{return new zr(e,"")}if(r.path==="")return r;throw hM(e)}static makeFromUrl(e,t){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(q){q.path.charAt(q.path.length-1)==="/"&&(q.path_=q.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),l={bucket:1,path:3};function c(q){q.path_=decodeURIComponent(q.path)}const h="v[A-Za-z0-9_]+",f=t.replace(/[.]/g,"\\."),g="(/([^?#]*).*)?$",v=new RegExp(`^https?://${f}/${h}/b/${s}/o${g}`,"i"),x={bucket:1,path:3},w=t===AT?"(?:storage.googleapis.com|storage.cloud.google.com)":t,I="([^?#]*)",$=new RegExp(`^https?://${w}/${s}/${I}`,"i"),U=[{regex:a,indices:l,postModify:i},{regex:v,indices:x,postModify:c},{regex:$,indices:{bucket:1,path:2},postModify:c}];for(let q=0;q<U.length;q++){const te=U[q],X=te.regex.exec(e);if(X){const A=X[te.indices.bucket];let b=X[te.indices.path];b||(b=""),r=new zr(A,b),te.postModify(r);break}}if(r==null)throw dM(e);return r}}class yM{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _M(n,e,t){let r=1,s=null,i=null,o=!1,a=0;function l(){return a===2}let c=!1;function h(...I){c||(c=!0,e.apply(null,I))}function f(I){s=setTimeout(()=>{s=null,n(v,l())},I)}function g(){i&&clearTimeout(i)}function v(I,...$){if(c){g();return}if(I){g(),h.call(null,I,...$);return}if(l()||o){g(),h.call(null,I,...$);return}r<64&&(r*=2);let U;a===1?(a=2,U=0):U=(r+Math.random())*1e3,f(U)}let x=!1;function w(I){x||(x=!0,g(),!c&&(s!==null?(I||(a=2),clearTimeout(s),f(0)):I||(a=1)))}return f(0),i=setTimeout(()=>{o=!0,w(!0)},t),w}function bM(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wM(n){return n!==void 0}function xM(n){return typeof n=="object"&&!Array.isArray(n)}function Ev(n){return typeof n=="string"||n instanceof String}function hb(n){return Tv()&&n instanceof Blob}function Tv(){return typeof Blob<"u"}function fb(n,e,t,r){if(r<e)throw km(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw km(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cf(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function RT(n){const e=encodeURIComponent;let t="?";for(const r in n)if(n.hasOwnProperty(r)){const s=e(r)+"="+e(n[r]);t=t+s+"&"}return t=t.slice(0,-1),t}var Qo;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Qo||(Qo={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IM(n,e){const t=n>=500&&n<600,s=[408,429].indexOf(n)!==-1,i=e.indexOf(n)!==-1;return t||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EM{constructor(e,t,r,s,i,o,a,l,c,h,f,g=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=h,this.connectionFactory_=f,this.retry=g,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((v,x)=>{this.resolve_=v,this.reject_=x,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new Od(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=a=>{const l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const a=i.getErrorCode()===Qo.NO_ERROR,l=i.getStatus();if(!a||IM(l,this.additionalRetryCodes_)&&this.retry){const h=i.getErrorCode()===Qo.ABORT;r(!1,new Od(!1,null,h));return}const c=this.successCodes_.indexOf(l)!==-1;r(!0,new Od(c,i))})},t=(r,s)=>{const i=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const l=this.callback_(a,a.getResponse());wM(l)?i(l):i()}catch(l){o(l)}else if(a!==null){const l=Iv();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(s.canceled){const l=this.appDelete_?PT():cM();o(l)}else{const l=uM();o(l)}};this.canceled_?t(!1,new Od(!1,null,!0)):this.backoffId_=_M(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&bM(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Od{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function TM(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function AM(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function SM(n,e){e&&(n["X-Firebase-GMPID"]=e)}function PM(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function RM(n,e,t,r,s,i,o=!0){const a=RT(n.urlParams),l=n.url+a,c=Object.assign({},n.headers);return SM(c,e),TM(c,t),AM(c,i),PM(c,r),new EM(l,n.method,c,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CM(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function kM(...n){const e=CM();if(e!==void 0){const t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(Tv())return new Blob(n);throw new vn(gn.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function DM(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NM(n){if(typeof atob>"u")throw gM("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ps={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Lp{constructor(e,t){this.data=e,this.contentType=t||null}}function OM(n,e){switch(n){case Ps.RAW:return new Lp(CT(e));case Ps.BASE64:case Ps.BASE64URL:return new Lp(kT(n,e));case Ps.DATA_URL:return new Lp(MM(e),LM(e))}throw Iv()}function CT(n){const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const i=r,o=n.charCodeAt(++t);r=65536|(i&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function VM(n){let e;try{e=decodeURIComponent(n)}catch{throw ec(Ps.DATA_URL,"Malformed data URL.")}return CT(e)}function kT(n,e){switch(n){case Ps.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw ec(n,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Ps.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw ec(n,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=NM(e)}catch(s){throw s.message.includes("polyfill")?s:ec(n,"Invalid character found")}const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}class DT{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw ec(Ps.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;r!=null&&(this.base64=$M(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function MM(n){const e=new DT(n);return e.base64?kT(Ps.BASE64,e.rest):VM(e.rest)}function LM(n){return new DT(n).contentType}function $M(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ui{constructor(e,t){let r=0,s="";hb(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,t){if(hb(this.data_)){const r=this.data_,s=DM(r,e,t);return s===null?null:new Ui(s)}else{const r=new Uint8Array(this.data_.buffer,e,t-e);return new Ui(r,!0)}}static getBlob(...e){if(Tv()){const t=e.map(r=>r instanceof Ui?r.data_:r);return new Ui(kM.apply(null,t))}else{const t=e.map(o=>Ev(o)?OM(Ps.RAW,o).data:o.data_);let r=0;t.forEach(o=>{r+=o.byteLength});const s=new Uint8Array(r);let i=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)s[i++]=o[a]}),new Ui(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NT(n){let e;try{e=JSON.parse(n)}catch{return null}return xM(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FM(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function UM(n,e){const t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function OT(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jM(n,e){return e}class vr{constructor(e,t,r,s){this.server=e,this.local=t||e,this.writable=!!r,this.xform=s||jM}}let Vd=null;function BM(n){return!Ev(n)||n.length<2?n:OT(n)}function VT(){if(Vd)return Vd;const n=[];n.push(new vr("bucket")),n.push(new vr("generation")),n.push(new vr("metageneration")),n.push(new vr("name","fullPath",!0));function e(i,o){return BM(o)}const t=new vr("name");t.xform=e,n.push(t);function r(i,o){return o!==void 0?Number(o):o}const s=new vr("size");return s.xform=r,n.push(s),n.push(new vr("timeCreated")),n.push(new vr("updated")),n.push(new vr("md5Hash",null,!0)),n.push(new vr("cacheControl",null,!0)),n.push(new vr("contentDisposition",null,!0)),n.push(new vr("contentEncoding",null,!0)),n.push(new vr("contentLanguage",null,!0)),n.push(new vr("contentType",null,!0)),n.push(new vr("metadata","customMetadata",!0)),Vd=n,Vd}function qM(n,e){function t(){const r=n.bucket,s=n.fullPath,i=new zr(r,s);return e._makeStorageReference(i)}Object.defineProperty(n,"ref",{get:t})}function zM(n,e,t){const r={};r.type="file";const s=t.length;for(let i=0;i<s;i++){const o=t[i];r[o.local]=o.xform(r,e[o.server])}return qM(r,n),r}function MT(n,e,t){const r=NT(e);return r===null?null:zM(n,r,t)}function HM(n,e,t,r){const s=NT(e);if(s===null||!Ev(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(c=>{const h=n.bucket,f=n.fullPath,g="/b/"+o(h)+"/o/"+o(f),v=Cf(g,t,r),x=RT({alt:"media",token:c});return v+x})[0]}function KM(n,e){const t={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(t[i.server]=n[i.local])}return JSON.stringify(t)}class Av{constructor(e,t,r,s){this.url=e,this.method=t,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LT(n){if(!n)throw Iv()}function GM(n,e){function t(r,s){const i=MT(n,s,e);return LT(i!==null),i}return t}function WM(n,e){function t(r,s){const i=MT(n,s,e);return LT(i!==null),HM(i,s,n.host,n._protocol)}return t}function $T(n){function e(t,r){let s;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?s=aM():s=oM():t.getStatus()===402?s=iM(n.bucket):t.getStatus()===403?s=lM(n.path):s=r,s.status=t.getStatus(),s.serverResponse=r.serverResponse,s}return e}function FT(n){const e=$T(n);function t(r,s){let i=e(r,s);return r.getStatus()===404&&(i=sM(n.path)),i.serverResponse=s.serverResponse,i}return t}function QM(n,e,t){const r=e.fullServerUrl(),s=Cf(r,n.host,n._protocol),i="GET",o=n.maxOperationRetryTime,a=new Av(s,i,WM(n,t),o);return a.errorHandler=FT(e),a}function JM(n,e){const t=e.fullServerUrl(),r=Cf(t,n.host,n._protocol),s="DELETE",i=n.maxOperationRetryTime;function o(l,c){}const a=new Av(r,s,o,i);return a.successCodes=[200,204],a.errorHandler=FT(e),a}function YM(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function XM(n,e,t){const r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=YM(null,e)),r}function ZM(n,e,t,r,s){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let U="";for(let q=0;q<2;q++)U=U+Math.random().toString().slice(2);return U}const l=a();o["Content-Type"]="multipart/related; boundary="+l;const c=XM(e,r,s),h=KM(c,t),f="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+l+`\r
Content-Type: `+c.contentType+`\r
\r
`,g=`\r
--`+l+"--",v=Ui.getBlob(f,r,g);if(v===null)throw pM();const x={name:c.fullPath},w=Cf(i,n.host,n._protocol),I="POST",$=n.maxUploadRetryTime,L=new Av(w,I,GM(n,t),$);return L.urlParams=x,L.headers=o,L.body=v.uploadData(),L.errorHandler=$T(e),L}class eL{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Qo.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Qo.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Qo.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,s){if(this.sent_)throw Ru("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),s!==void 0)for(const i in s)s.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,s[i].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Ru("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Ru("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Ru("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Ru("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class tL extends eL{initXhr(){this.xhr_.responseType="text"}}function Sv(){return new tL}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua{constructor(e,t){this._service=e,t instanceof zr?this._location=t:this._location=zr.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new ua(e,t)}get root(){const e=new zr(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return OT(this._location.path)}get storage(){return this._service}get parent(){const e=FM(this._location.path);if(e===null)return null;const t=new zr(this._location.bucket,e);return new ua(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw vM(e)}}function nL(n,e,t){n._throwIfRoot("uploadBytes");const r=ZM(n.storage,n._location,VT(),new Ui(e,!0),t);return n.storage.makeRequestWithTokens(r,Sv).then(s=>({metadata:s,ref:n}))}function rL(n){n._throwIfRoot("getDownloadURL");const e=QM(n.storage,n._location,VT());return n.storage.makeRequestWithTokens(e,Sv).then(t=>{if(t===null)throw mM();return t})}function sL(n){n._throwIfRoot("deleteObject");const e=JM(n.storage,n._location);return n.storage.makeRequestWithTokens(e,Sv)}function iL(n,e){const t=UM(n._location.path,e),r=new zr(n._location.bucket,t);return new ua(n.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oL(n){return/^[A-Za-z]+:\/\//.test(n)}function aL(n,e){return new ua(n,e)}function UT(n,e){if(n instanceof Pv){const t=n;if(t._bucket==null)throw fM();const r=new ua(t,t._bucket);return e!=null?UT(r,e):r}else return e!==void 0?iL(n,e):n}function lL(n,e){if(e&&oL(e)){if(n instanceof Pv)return aL(n,e);throw km("To use ref(service, url), the first argument must be a Storage instance.")}else return UT(n,e)}function pb(n,e){const t=e==null?void 0:e[ST];return t==null?null:zr.makeFromBucketSpec(t,n)}function uL(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";const{mockUserToken:s}=r;s&&(n._overrideAuthToken=typeof s=="string"?s:Ax(s,n.app.options.projectId))}class Pv{constructor(e,t,r,s,i){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._bucket=null,this._host=AT,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=nM,this._maxUploadRetryTime=rM,this._requests=new Set,s!=null?this._bucket=zr.makeFromBucketSpec(s,this._host):this._bucket=pb(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=zr.makeFromBucketSpec(this._url,e):this._bucket=pb(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){fb("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){fb("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ua(this,e)}_makeRequest(e,t,r,s,i=!0){if(this._deleted)return new yM(PT());{const o=RM(e,this._appId,r,s,t,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,s).getPromise()}}const mb="@firebase/storage",gb="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jT="storage";function cL(n,e,t){return n=De(n),nL(n,e,t)}function dL(n){return n=De(n),rL(n)}function hL(n){return n=De(n),sL(n)}function BT(n,e){return n=De(n),lL(n,e)}function fL(n=Ll(),e){n=De(n);const r=ci(n,jT).getImmediate({identifier:e}),s=Ix("storage");return s&&pL(r,...s),r}function pL(n,e,t,r={}){uL(n,e,t,r)}function mL(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new Pv(t,r,s,e,fa)}function gL(){fs(new Zr(jT,mL,"PUBLIC").setMultipleInstances(!0)),Nr(mb,gb,""),Nr(mb,gb,"esm2017")}gL();function Rv(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LG={PHONE:"phone",TOTP:"totp"},$G={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},FG={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},UG={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},jG={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vL(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function qT(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const BG=vL,yL=qT,zT=new ha("auth","Firebase",qT()),qG={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dh=new fg("@firebase/auth");function _L(n,...e){Dh.logLevel<=_t.WARN&&Dh.warn(`Auth (${fa}): ${n}`,...e)}function th(n,...e){Dh.logLevel<=_t.ERROR&&Dh.error(`Auth (${fa}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Or(n,...e){throw kv(n,...e)}function xr(n,...e){return kv(n,...e)}function Cv(n,e,t){const r=Object.assign(Object.assign({},yL()),{[e]:t});return new ha("auth","Firebase",r).create(e,{appName:n.name})}function zn(n){return Cv(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Wl(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Or(n,"argument-error"),Cv(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function kv(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return zT.create(n,...e)}function we(n,e,...t){if(!n)throw kv(e,...t)}function Rs(n){const e="INTERNAL ASSERTION FAILED: "+n;throw th(e),new Error(e)}function oi(n,e){n||Rs(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kc(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Dv(){return vb()==="http:"||vb()==="https:"}function vb(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bL(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Dv()||DC()||"connection"in navigator)?navigator.onLine:!0}function wL(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class td{constructor(e,t){this.shortDelay=e,this.longDelay=t,oi(t>e,"Short delay should be less than long delay!"),this.isMobile=RC()||NC()}get(){return bL()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nv(n,e){oi(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HT{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Rs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Rs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Rs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xL={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IL=new td(3e4,6e4);function Zt(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function en(n,e,t,r,s={}){return KT(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Ml(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return kC()||(c.referrerPolicy="no-referrer"),HT.fetch()(GT(n,n.config.apiHost,t,a),c)})}async function KT(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},xL),e);try{const s=new TL(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Fu(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Fu(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Fu(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Fu(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw Cv(n,h,c);Or(n,h)}}catch(s){if(s instanceof ps)throw s;Or(n,"network-request-failed",{message:String(s)})}}async function mi(n,e,t,r,s={}){const i=await en(n,e,t,r,s);return"mfaPendingCredential"in i&&Or(n,"multi-factor-auth-required",{_serverResponse:i}),i}function GT(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Nv(n.config,s):`${n.config.apiScheme}://${s}`}function EL(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class TL{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(xr(this.auth,"network-request-failed")),IL.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Fu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=xr(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yb(n){return n!==void 0&&n.getResponse!==void 0}function _b(n){return n!==void 0&&n.enterprise!==void 0}class WT{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return EL(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AL(n){return(await en(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function QT(n,e){return en(n,"GET","/v2/recaptchaConfig",Zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SL(n,e){return en(n,"POST","/v1/accounts:delete",e)}async function PL(n,e){return en(n,"POST","/v1/accounts:update",e)}async function JT(n,e){return en(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tc(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zG(n,e=!1){return De(n).getIdToken(e)}async function RL(n,e=!1){const t=De(n),r=await t.getIdToken(e),s=kf(r);we(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:tc($p(s.auth_time)),issuedAtTime:tc($p(s.iat)),expirationTime:tc($p(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function $p(n){return Number(n)*1e3}function kf(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return th("JWT malformed, contained fewer than 3 sections"),null;try{const s=wx(t);return s?JSON.parse(s):(th("Failed to decode base64 JWT payload"),null)}catch(s){return th("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function bb(n){const e=kf(n);return we(e,"internal-error"),we(typeof e.exp<"u","internal-error"),we(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ai(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof ps&&CL(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function CL({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kL{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dm{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=tc(this.lastLoginAt),this.creationTime=tc(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dc(n){var e;const t=n.auth,r=await n.getIdToken(),s=await ai(n,JT(t,{idToken:r}));we(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?YT(i.providerUserInfo):[],a=NL(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),h=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Dm(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function DL(n){const e=De(n);await Dc(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function NL(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function YT(n){return n.map(e=>{var{providerId:t}=e,r=Rv(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OL(n,e){const t=await KT(n,{},async()=>{const r=Ml({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=GT(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",HT.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function VL(n,e){return en(n,"POST","/v2/accounts:revokeToken",Zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){we(e.idToken,"internal-error"),we(typeof e.idToken<"u","internal-error"),we(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):bb(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){we(e.length!==0,"internal-error");const t=bb(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(we(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await OL(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new cl;return r&&(we(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(we(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(we(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new cl,this.toJSON())}_performRefresh(){return Rs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ki(n,e){we(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Gs{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=Rv(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new kL(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Dm(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await ai(this,this.stsTokenManager.getToken(this.auth,e));return we(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return RL(this,e)}reload(){return DL(this)}_assign(e){this!==e&&(we(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Gs(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){we(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Dc(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(En(this.auth.app))return Promise.reject(zn(this.auth));const e=await this.getIdToken();return await ai(this,SL(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,h;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(s=t.email)!==null&&s!==void 0?s:void 0,v=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,x=(o=t.photoURL)!==null&&o!==void 0?o:void 0,w=(a=t.tenantId)!==null&&a!==void 0?a:void 0,I=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,$=(c=t.createdAt)!==null&&c!==void 0?c:void 0,L=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:U,emailVerified:q,isAnonymous:te,providerData:X,stsTokenManager:A}=t;we(U&&A,e,"internal-error");const b=cl.fromJSON(this.name,A);we(typeof U=="string",e,"internal-error"),ki(f,e.name),ki(g,e.name),we(typeof q=="boolean",e,"internal-error"),we(typeof te=="boolean",e,"internal-error"),ki(v,e.name),ki(x,e.name),ki(w,e.name),ki(I,e.name),ki($,e.name),ki(L,e.name);const T=new Gs({uid:U,auth:e,email:g,emailVerified:q,displayName:f,isAnonymous:te,photoURL:x,phoneNumber:v,tenantId:w,stsTokenManager:b,createdAt:$,lastLoginAt:L});return X&&Array.isArray(X)&&(T.providerData=X.map(k=>Object.assign({},k))),I&&(T._redirectEventId=I),T}static async _fromIdTokenResponse(e,t,r=!1){const s=new cl;s.updateFromServerResponse(t);const i=new Gs({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Dc(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];we(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?YT(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new cl;a.updateFromIdToken(r);const l=new Gs({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Dm(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wb=new Map;function Ws(n){oi(n instanceof Function,"Expected a class definition");let e=wb.get(n);return e?(oi(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,wb.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XT{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}XT.type="NONE";const xb=XT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nh(n,e,t){return`firebase:${n}:${e}:${t}`}class dl{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=nh(this.userKey,s.apiKey,i),this.fullPersistenceKey=nh("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Gs._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new dl(Ws(xb),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||Ws(xb);const o=nh(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const h=await c._get(o);if(h){const f=Gs._fromJSON(e,h);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new dl(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new dl(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ib(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(nA(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(ZT(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(sA(e))return"Blackberry";if(iA(e))return"Webos";if(eA(e))return"Safari";if((e.includes("chrome/")||tA(e))&&!e.includes("edge/"))return"Chrome";if(rA(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function ZT(n=Ln()){return/firefox\//i.test(n)}function eA(n=Ln()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function tA(n=Ln()){return/crios\//i.test(n)}function nA(n=Ln()){return/iemobile/i.test(n)}function rA(n=Ln()){return/android/i.test(n)}function sA(n=Ln()){return/blackberry/i.test(n)}function iA(n=Ln()){return/webos/i.test(n)}function Ov(n=Ln()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function ML(n=Ln()){var e;return Ov(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function LL(){return OC()&&document.documentMode===10}function oA(n=Ln()){return Ov(n)||rA(n)||iA(n)||sA(n)||/windows phone/i.test(n)||nA(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aA(n,e=[]){let t;switch(n){case"Browser":t=Ib(Ln());break;case"Worker":t=`${Ib(Ln())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${fa}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $L{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FL(n,e={}){return en(n,"GET","/v2/passwordPolicy",Zt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UL=6;class jL{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:UL,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BL{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Eb(this),this.idTokenSubscription=new Eb(this),this.beforeStateQueue=new $L(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=zT,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ws(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await dl.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await JT(this,{idToken:e}),r=await Gs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(En(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return we(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Dc(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=wL()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(En(this.app))return Promise.reject(zn(this));const t=e?De(e):null;return t&&we(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&we(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return En(this.app)?Promise.reject(zn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return En(this.app)?Promise.reject(zn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ws(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await FL(this),t=new jL(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ha("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await VL(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ws(e)||this._popupRedirectResolver;we(t,this,"argument-error"),this.redirectPersistenceManager=await dl.create(this,[Ws(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(we(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return we(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=aA(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&_L(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function yn(n){return De(n)}class Eb{constructor(e){this.auth=e,this.observer=null,this.addObserver=UC(t=>this.observer=t)}get next(){return we(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nd={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function qL(n){nd=n}function Vv(n){return nd.loadJS(n)}function zL(){return nd.recaptchaV2Script}function HL(){return nd.recaptchaEnterpriseScript}function KL(){return nd.gapiScript}function lA(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const GL="recaptcha-enterprise",WL="NO_RECAPTCHA";class uA{constructor(e){this.type=GL,this.auth=yn(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{QT(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new WT(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;_b(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(WL)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&_b(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=HL();l.length!==0&&(l+=a),Vv(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function Tb(n,e,t,r=!1){const s=new uA(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Nc(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Tb(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Tb(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function QL(n){const e=yn(n),t=await QT(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new WT(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new uA(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JL(n,e){const t=ci(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(eo(i,e??{}))return s;Or(s,"already-initialized")}return t.initialize({options:e})}function YL(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Ws);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function XL(n,e,t){const r=yn(n);we(r._canInitEmulator,r,"emulator-config-failed"),we(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=cA(e),{host:o,port:a}=ZL(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||e4()}function cA(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function ZL(n){const e=cA(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Ab(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:Ab(o)}}}function Ab(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function e4(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rd{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Rs("not implemented")}_getIdTokenResponse(e){return Rs("not implemented")}_linkToIdToken(e,t){return Rs("not implemented")}_getReauthenticationResolver(e){return Rs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dA(n,e){return en(n,"POST","/v1/accounts:resetPassword",Zt(n,e))}async function t4(n,e){return en(n,"POST","/v1/accounts:update",e)}async function n4(n,e){return en(n,"POST","/v1/accounts:signUp",e)}async function r4(n,e){return en(n,"POST","/v1/accounts:update",Zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s4(n,e){return mi(n,"POST","/v1/accounts:signInWithPassword",Zt(n,e))}async function Df(n,e){return en(n,"POST","/v1/accounts:sendOobCode",Zt(n,e))}async function i4(n,e){return Df(n,e)}async function o4(n,e){return Df(n,e)}async function a4(n,e){return Df(n,e)}async function l4(n,e){return Df(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function u4(n,e){return mi(n,"POST","/v1/accounts:signInWithEmailLink",Zt(n,e))}async function c4(n,e){return mi(n,"POST","/v1/accounts:signInWithEmailLink",Zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oc extends rd{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Oc(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Oc(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Nc(e,t,"signInWithPassword",s4);case"emailLink":return u4(e,{email:this._email,oobCode:this._password});default:Or(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Nc(e,r,"signUpPassword",n4);case"emailLink":return c4(e,{idToken:t,email:this._email,oobCode:this._password});default:Or(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ei(n,e){return mi(n,"POST","/v1/accounts:signInWithIdp",Zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d4="http://localhost";class li extends rd{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new li(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Or("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=Rv(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new li(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return ei(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ei(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ei(e,t)}buildRequest(){const e={requestUri:d4,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ml(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function h4(n,e){return en(n,"POST","/v1/accounts:sendVerificationCode",Zt(n,e))}async function f4(n,e){return mi(n,"POST","/v1/accounts:signInWithPhoneNumber",Zt(n,e))}async function p4(n,e){const t=await mi(n,"POST","/v1/accounts:signInWithPhoneNumber",Zt(n,e));if(t.temporaryProof)throw Fu(n,"account-exists-with-different-credential",t);return t}const m4={USER_NOT_FOUND:"user-not-found"};async function g4(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return mi(n,"POST","/v1/accounts:signInWithPhoneNumber",Zt(n,t),m4)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo extends rd{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Jo({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Jo({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return f4(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return p4(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return g4(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Jo({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v4(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function y4(n){const e=Nu(Ou(n)).link,t=e?Nu(Ou(e)).deep_link_id:null,r=Nu(Ou(n)).deep_link_id;return(r?Nu(Ou(r)).link:null)||r||t||e||n}class sd{constructor(e){var t,r,s,i,o,a;const l=Nu(Ou(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,h=(r=l.oobCode)!==null&&r!==void 0?r:null,f=v4((s=l.mode)!==null&&s!==void 0?s:null);we(c&&h&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=h,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=y4(e);try{return new sd(t)}catch{return null}}}function HG(n){return sd.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _a{constructor(){this.providerId=_a.PROVIDER_ID}static credential(e,t){return Oc._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=sd.parseLink(t);return we(r,"argument-error"),Oc._fromEmailAndCode(e,r.code,r.tenantId)}}_a.PROVIDER_ID="password";_a.EMAIL_PASSWORD_SIGN_IN_METHOD="password";_a.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ql extends gi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class rh extends Ql{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return we("providerId"in t&&"signInMethod"in t,"argument-error"),li._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return we(e.idToken||e.accessToken,"argument-error"),li._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return rh.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return rh.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new rh(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ji extends Ql{constructor(){super("facebook.com")}static credential(e){return li._fromParams({providerId:ji.PROVIDER_ID,signInMethod:ji.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ji.credentialFromTaggedObject(e)}static credentialFromError(e){return ji.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ji.credential(e.oauthAccessToken)}catch{return null}}}ji.FACEBOOK_SIGN_IN_METHOD="facebook.com";ji.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bi extends Ql{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return li._fromParams({providerId:Bi.PROVIDER_ID,signInMethod:Bi.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Bi.credentialFromTaggedObject(e)}static credentialFromError(e){return Bi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Bi.credential(t,r)}catch{return null}}}Bi.GOOGLE_SIGN_IN_METHOD="google.com";Bi.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi extends Ql{constructor(){super("github.com")}static credential(e){return li._fromParams({providerId:qi.PROVIDER_ID,signInMethod:qi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return qi.credentialFromTaggedObject(e)}static credentialFromError(e){return qi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return qi.credential(e.oauthAccessToken)}catch{return null}}}qi.GITHUB_SIGN_IN_METHOD="github.com";qi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _4="http://localhost";class Vc extends rd{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return ei(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ei(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ei(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Vc(r,i)}static _create(e,t){return new Vc(e,t)}buildRequest(){return{requestUri:_4,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b4="saml.";class Nm extends gi{constructor(e){we(e.startsWith(b4),"argument-error"),super(e)}static credentialFromResult(e){return Nm.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Nm.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Vc.fromJSON(e);return we(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Vc._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi extends Ql{constructor(){super("twitter.com")}static credential(e,t){return li._fromParams({providerId:zi.PROVIDER_ID,signInMethod:zi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return zi.credentialFromTaggedObject(e)}static credentialFromError(e){return zi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return zi.credential(t,r)}catch{return null}}}zi.TWITTER_SIGN_IN_METHOD="twitter.com";zi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hA(n,e){return mi(n,"POST","/v1/accounts:signUp",Zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Gs._fromIdTokenResponse(e,r,s),o=Sb(r);return new ts({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Sb(r);return new ts({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Sb(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fA(n){var e;if(En(n.app))return Promise.reject(zn(n));const t=yn(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new ts({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await hA(t,{returnSecureToken:!0}),s=await ts._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nh extends ps{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Nh.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Nh(e,t,r,s)}}function pA(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Nh._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mA(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KG(n,e){const t=De(n);await Nf(!0,t,e);const{providerUserInfo:r}=await PL(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=mA(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Mv(n,e,t=!1){const r=await ai(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ts._forOperation(n,"link",r)}async function Nf(n,e,t){await Dc(e);const r=mA(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";we(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gA(n,e,t=!1){const{auth:r}=n;if(En(r.app))return Promise.reject(zn(r));const s="reauthenticate";try{const i=await ai(n,pA(r,s,e,n),t);we(i.idToken,r,"internal-error");const o=kf(i.idToken);we(o,r,"internal-error");const{sub:a}=o;return we(n.uid===a,r,"user-mismatch"),ts._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Or(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vA(n,e,t=!1){if(En(n.app))return Promise.reject(zn(n));const r="signIn",s=await pA(n,r,e),i=await ts._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Lv(n,e){return vA(yn(n),e)}async function w4(n,e){const t=De(n);return await Nf(!1,t,e.providerId),Mv(t,e)}async function x4(n,e){return gA(De(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I4(n,e){return mi(n,"POST","/v1/accounts:signInWithCustomToken",Zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GG(n,e){if(En(n.app))return Promise.reject(zn(n));const t=yn(n),r=await I4(t,{token:e,returnSecureToken:!0}),s=await ts._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class id{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?$v._fromServerResponse(e,t):"totpInfo"in t?Fv._fromServerResponse(e,t):Or(e,"internal-error")}}class $v extends id{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new $v(t)}}class Fv extends id{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Fv(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Of(n,e,t){var r;we(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),we(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(we(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(we(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uv(n){const e=yn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function E4(n,e,t){const r=yn(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Of(r,s,t),await Nc(r,s,"getOobCode",o4)}async function T4(n,e,t){await dA(De(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Uv(n),r})}async function WG(n,e){await r4(De(n),{oobCode:e})}async function A4(n,e){const t=De(n),r=await dA(t,{oobCode:e}),s=r.requestType;switch(we(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":we(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":we(r.mfaInfo,t,"internal-error");default:we(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=id._fromServerResponse(yn(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function S4(n,e){const{data:t}=await A4(De(n),e);return t.email}async function P4(n,e,t){if(En(n.app))return Promise.reject(zn(n));const r=yn(n),o=await Nc(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",hA).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Uv(n),l}),a=await ts._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function yA(n,e,t){return En(n.app)?Promise.reject(zn(n)):Lv(De(n),_a.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Uv(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QG(n,e,t){const r=yn(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){we(a.handleCodeInApp,r,"argument-error"),a&&Of(r,o,a)}i(s,t),await Nc(r,s,"getOobCode",a4)}function JG(n,e){const t=sd.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function YG(n,e,t){if(En(n.app))return Promise.reject(zn(n));const r=De(n),s=_a.credentialWithLink(e,t||kc());return we(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Lv(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R4(n,e){return en(n,"POST","/v1/accounts:createAuthUri",Zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XG(n,e){const t=Dv()?kc():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await R4(De(n),r);return s||[]}async function ZG(n,e){const t=De(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Of(t.auth,s,e);const{email:i}=await i4(t.auth,s);i!==n.email&&await n.reload()}async function e7(n,e,t){const r=De(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Of(r.auth,i,t);const{email:o}=await l4(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C4(n,e){return en(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t7(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=De(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await ai(r,C4(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function k4(n,e){const t=De(n);return En(t.auth.app)?Promise.reject(zn(t.auth)):_A(t,e,null)}function D4(n,e){return _A(De(n),null,e)}async function _A(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await ai(n,t4(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N4(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=kf(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new hl(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new O4(i,s);case"github.com":return new V4(i,s);case"google.com":return new M4(i,s);case"twitter.com":return new L4(i,s,n.screenName||null);case"custom":case"anonymous":return new hl(i,null);default:return new hl(i,r,s)}}class hl{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class bA extends hl{constructor(e,t,r,s){super(e,t,r),this.username=s}}class O4 extends hl{constructor(e,t){super(e,"facebook.com",t)}}class V4 extends bA{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class M4 extends hl{constructor(e,t){super(e,"google.com",t)}}class L4 extends bA{constructor(e,t,r){super(e,"twitter.com",t,r)}}function n7(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:N4(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $4(n,e){return De(n).setPersistence(e)}function r7(n){return QL(n)}async function s7(n,e){return yn(n).validatePassword(e)}function F4(n,e,t,r){return De(n).onIdTokenChanged(e,t,r)}function U4(n,e,t){return De(n).beforeAuthStateChanged(e,t)}function j4(n,e,t,r){return De(n).onAuthStateChanged(e,t,r)}function i7(n){De(n).useDeviceLanguage()}function o7(n,e){return De(n).updateCurrentUser(e)}function B4(n){return De(n).signOut()}function a7(n,e){return yn(n).revokeAccessToken(e)}async function l7(n){return De(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new Ho("enroll",e,t)}static _fromMfaPendingCredential(e){return new Ho("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return Ho._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return Ho._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jv{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=yn(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>id._fromServerResponse(r,a));we(s.mfaPendingCredential,r,"internal-error");const o=Ho._fromMfaPendingCredential(s.mfaPendingCredential);return new jv(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const h=await ts._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return we(t.user,r,"internal-error"),ts._forOperation(t.user,t.operationType,c);default:Or(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function u7(n,e){var t;const r=De(n),s=e;return we(e.customData.operationType,r,"argument-error"),we((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),jv._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q4(n,e){return en(n,"POST","/v2/accounts/mfaEnrollment:start",Zt(n,e))}function z4(n,e){return en(n,"POST","/v2/accounts/mfaEnrollment:finalize",Zt(n,e))}function H4(n,e){return en(n,"POST","/v2/accounts/mfaEnrollment:start",Zt(n,e))}function K4(n,e){return en(n,"POST","/v2/accounts/mfaEnrollment:finalize",Zt(n,e))}function G4(n,e){return en(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Zt(n,e))}class Bv{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>id._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Bv(e)}async getSession(){return Ho._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await ai(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await ai(this.user,G4(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Fp=new WeakMap;function c7(n){const e=De(n);return Fp.has(e)||Fp.set(e,Bv._fromUser(e)),Fp.get(e)}const Oh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wA{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Oh,"1"),this.storage.removeItem(Oh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W4=1e3,Q4=10;class xA extends wA{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=oA(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);LL()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Q4):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},W4)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}xA.type="LOCAL";const IA=xA;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EA extends wA{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}EA.type="SESSION";const TA=EA;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J4(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Vf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await J4(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Vf.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mf(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y4{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=Mf("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===c)switch(g.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dn(){return window}function X4(n){Dn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qv(){return typeof Dn().WorkerGlobalScope<"u"&&typeof Dn().importScripts=="function"}async function Z4(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function e3(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function t3(){return qv()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AA="firebaseLocalStorageDb",n3=1,Vh="firebaseLocalStorage",SA="fbase_key";class od{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Lf(n,e){return n.transaction([Vh],e?"readwrite":"readonly").objectStore(Vh)}function r3(){const n=indexedDB.deleteDatabase(AA);return new od(n).toPromise()}function Om(){const n=indexedDB.open(AA,n3);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Vh,{keyPath:SA})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Vh)?e(r):(r.close(),await r3(),e(await Om()))})})}async function Pb(n,e,t){const r=Lf(n,!0).put({[SA]:e,value:t});return new od(r).toPromise()}async function s3(n,e){const t=Lf(n,!1).get(e),r=await new od(t).toPromise();return r===void 0?null:r.value}function Rb(n,e){const t=Lf(n,!0).delete(e);return new od(t).toPromise()}const i3=800,o3=3;class PA{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Om(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>o3)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return qv()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Vf._getInstance(t3()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await Z4(),!this.activeServiceWorker)return;this.sender=new Y4(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||e3()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Om();return await Pb(e,Oh,"1"),await Rb(e,Oh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Pb(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>s3(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Rb(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Lf(s,!1).getAll();return new od(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),i3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}PA.type="LOCAL";const a3=PA;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l3(n,e){return en(n,"POST","/v2/accounts/mfaSignIn:start",Zt(n,e))}function u3(n,e){return en(n,"POST","/v2/accounts/mfaSignIn:finalize",Zt(n,e))}function c3(n,e){return en(n,"POST","/v2/accounts/mfaSignIn:finalize",Zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d3=500,h3=6e4,Md=1e12;class f3{constructor(e){this.auth=e,this.counter=Md,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new p3(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Md;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Md;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Md;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class p3{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;we(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=m3(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},h3)},d3))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function m3(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Up=lA("rcb"),g3=new td(3e4,6e4);class v3{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Dn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return we(y3(t),e,"argument-error"),this.shouldResolveImmediately(t)&&yb(Dn().grecaptcha)?Promise.resolve(Dn().grecaptcha):new Promise((r,s)=>{const i=Dn().setTimeout(()=>{s(xr(e,"network-request-failed"))},g3.get());Dn()[Up]=()=>{Dn().clearTimeout(i),delete Dn()[Up];const a=Dn().grecaptcha;if(!a||!yb(a)){s(xr(e,"internal-error"));return}const l=a.render;a.render=(c,h)=>{const f=l(c,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${zL()}?${Ml({onload:Up,render:"explicit",hl:t})}`;Vv(o).catch(()=>{clearTimeout(i),s(xr(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Dn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function y3(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class _3{async load(e){return new f3(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RA="recaptcha",b3={theme:"light",type:"image"};class d7{constructor(e,t,r=Object.assign({},b3)){this.parameters=r,this.type=RA,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=yn(e),this.isInvisible=this.parameters.size==="invisible",we(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;we(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new _3:new v3,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){we(!this.parameters.sitekey,this.auth,"argument-error"),we(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),we(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Dn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){we(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){we(Dv()&&!qv(),this.auth,"internal-error"),await w3(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await AL(this.auth);we(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return we(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function w3(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zv{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Jo._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function h7(n,e,t){if(En(n.app))return Promise.reject(zn(n));const r=yn(n),s=await $f(r,e,De(t));return new zv(s,i=>Lv(r,i))}async function f7(n,e,t){const r=De(n);await Nf(!1,r,"phone");const s=await $f(r.auth,e,De(t));return new zv(s,i=>w4(r,i))}async function p7(n,e,t){const r=De(n);if(En(r.auth.app))return Promise.reject(zn(r.auth));const s=await $f(r.auth,e,De(t));return new zv(s,i=>x4(r,i))}async function $f(n,e,t){var r;const s=await t.verify();try{we(typeof s=="string",n,"argument-error"),we(t.type===RA,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return we(o.type==="enroll",n,"internal-error"),(await q4(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{we(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return we(a,n,"missing-multi-factor-info"),(await l3(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await h4(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function m7(n,e){const t=De(n);if(En(t.auth.app))return Promise.reject(zn(t.auth));await Mv(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fl{constructor(e){this.providerId=fl.PROVIDER_ID,this.auth=yn(e)}verifyPhoneNumber(e,t){return $f(this.auth,e,De(t))}static credential(e,t){return Jo._fromVerification(e,t)}static credentialFromResult(e){const t=e;return fl.credentialFromTaggedObject(t)}static credentialFromError(e){return fl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Jo._fromTokenResponse(t,r):null}}fl.PROVIDER_ID="phone";fl.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ba(n,e){return e?Ws(e):(we(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hv extends rd{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ei(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ei(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ei(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function x3(n){return vA(n.auth,new Hv(n),n.bypassAuthState)}function I3(n){const{auth:e,user:t}=n;return we(t,e,"internal-error"),gA(t,new Hv(n),n.bypassAuthState)}async function E3(n){const{auth:e,user:t}=n;return we(t,e,"internal-error"),Mv(t,new Hv(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CA{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return x3;case"linkViaPopup":case"linkViaRedirect":return E3;case"reauthViaPopup":case"reauthViaRedirect":return I3;default:Or(this.auth,"internal-error")}}resolve(e){oi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){oi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T3=new td(2e3,1e4);async function g7(n,e,t){if(En(n.app))return Promise.reject(xr(n,"operation-not-supported-in-this-environment"));const r=yn(n);Wl(n,e,gi);const s=ba(r,t);return new Qs(r,"signInViaPopup",e,s).executeNotNull()}async function v7(n,e,t){const r=De(n);if(En(r.auth.app))return Promise.reject(xr(r.auth,"operation-not-supported-in-this-environment"));Wl(r.auth,e,gi);const s=ba(r.auth,t);return new Qs(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function y7(n,e,t){const r=De(n);Wl(r.auth,e,gi);const s=ba(r.auth,t);return new Qs(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Qs extends CA{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Qs.currentPopupAction&&Qs.currentPopupAction.cancel(),Qs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return we(e,this.auth,"internal-error"),e}async onExecution(){oi(this.filter.length===1,"Popup operations only handle one event");const e=Mf();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(xr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(xr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Qs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(xr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,T3.get())};e()}}Qs.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A3="pendingRedirect",sh=new Map;class S3 extends CA{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=sh.get(this.auth._key());if(!e){try{const r=await P3(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}sh.set(this.auth._key(),e)}return this.bypassAuthState||sh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function P3(n,e){const t=DA(e),r=kA(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function Kv(n,e){return kA(n)._set(DA(e),"true")}function R3(n,e){sh.set(n._key(),e)}function kA(n){return Ws(n._redirectPersistence)}function DA(n){return nh(A3,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _7(n,e,t){return C3(n,e,t)}async function C3(n,e,t){if(En(n.app))return Promise.reject(zn(n));const r=yn(n);Wl(n,e,gi),await r._initializationPromise;const s=ba(r,t);return await Kv(s,r),s._openRedirect(r,e,"signInViaRedirect")}function b7(n,e,t){return k3(n,e,t)}async function k3(n,e,t){const r=De(n);if(Wl(r.auth,e,gi),En(r.auth.app))return Promise.reject(zn(r.auth));await r.auth._initializationPromise;const s=ba(r.auth,t);await Kv(s,r.auth);const i=await OA(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function w7(n,e,t){return D3(n,e,t)}async function D3(n,e,t){const r=De(n);Wl(r.auth,e,gi),await r.auth._initializationPromise;const s=ba(r.auth,t);await Nf(!1,r,e.providerId),await Kv(s,r.auth);const i=await OA(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function x7(n,e){return await yn(n)._initializationPromise,NA(n,e,!1)}async function NA(n,e,t=!1){if(En(n.app))return Promise.reject(zn(n));const r=yn(n),s=ba(r,e),o=await new S3(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function OA(n){const e=Mf(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N3=10*60*1e3;class O3{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!V3(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!VA(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(xr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=N3&&this.cachedEventUids.clear(),this.cachedEventUids.has(Cb(e))}saveEventToCache(e){this.cachedEventUids.add(Cb(e)),this.lastProcessedEventTime=Date.now()}}function Cb(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function VA({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function V3(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return VA(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M3(n,e={}){return en(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L3=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,$3=/^https?/;async function F3(n){if(n.config.emulator)return;const{authorizedDomains:e}=await M3(n);for(const t of e)try{if(U3(t))return}catch{}Or(n,"unauthorized-domain")}function U3(n){const e=kc(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!$3.test(t))return!1;if(L3.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j3=new td(3e4,6e4);function kb(){const n=Dn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function B3(n){return new Promise((e,t)=>{var r,s,i;function o(){kb(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{kb(),t(xr(n,"network-request-failed"))},timeout:j3.get()})}if(!((s=(r=Dn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Dn().gapi)===null||i===void 0)&&i.load)o();else{const a=lA("iframefcb");return Dn()[a]=()=>{gapi.load?o():t(xr(n,"network-request-failed"))},Vv(`${KL()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw ih=null,e})}let ih=null;function q3(n){return ih=ih||B3(n),ih}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z3=new td(5e3,15e3),H3="__/auth/iframe",K3="emulator/auth/iframe",G3={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},W3=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Q3(n){const e=n.config;we(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Nv(e,K3):`https://${n.config.authDomain}/${H3}`,r={apiKey:e.apiKey,appName:n.name,v:fa},s=W3.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Ml(r).slice(1)}`}async function J3(n){const e=await q3(n),t=Dn().gapi;return we(t,n,"internal-error"),e.open({where:document.body,url:Q3(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:G3,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=xr(n,"network-request-failed"),a=Dn().setTimeout(()=>{i(o)},z3.get());function l(){Dn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y3={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},X3=500,Z3=600,e$="_blank",t$="http://localhost";class Db{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function n$(n,e,t,r=X3,s=Z3){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},Y3),{width:r.toString(),height:s.toString(),top:i,left:o}),c=Ln().toLowerCase();t&&(a=tA(c)?e$:t),ZT(c)&&(e=e||t$,l.scrollbars="yes");const h=Object.entries(l).reduce((g,[v,x])=>`${g}${v}=${x},`,"");if(ML(c)&&a!=="_self")return r$(e||"",a),new Db(null);const f=window.open(e||"",a,h);we(f,n,"popup-blocked");try{f.focus()}catch{}return new Db(f)}function r$(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s$="__/auth/handler",i$="emulator/auth/handler",o$=encodeURIComponent("fac");async function Nb(n,e,t,r,s,i){we(n.config.authDomain,n,"auth-domain-config-required"),we(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:fa,eventId:s};if(e instanceof gi){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",FC(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof Ql){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),c=l?`#${o$}=${encodeURIComponent(l)}`:"";return`${a$(n)}?${Ml(a).slice(1)}${c}`}function a$({config:n}){return n.emulator?Nv(n,i$):`https://${n.authDomain}/${s$}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jp="webStorageSupport";class l${constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=TA,this._completeRedirectFn=NA,this._overrideRedirectResult=R3}async _openPopup(e,t,r,s){var i;oi((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await Nb(e,t,r,kc(),s);return n$(e,o,Mf())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Nb(e,t,r,kc(),s);return X4(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(oi(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await J3(e),r=new O3(e);return t.register("authEvent",s=>(we(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(jp,{type:jp},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[jp];o!==void 0&&t(!!o),Or(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=F3(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return oA()||eA()||Ov()}}const u$=l$;class MA{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Rs("unexpected MultiFactorSessionType")}}}class Gv extends MA{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Gv(e)}_finalizeEnroll(e,t,r){return z4(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return u3(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class c${constructor(){}static assertion(e){return Gv._fromCredential(e)}}c$.FACTOR_ID="phone";class d${static assertionForEnrollment(e,t){return Mc._fromSecret(e,t)}static assertionForSignIn(e,t){return Mc._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;we(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await H4(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return Wv._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}d$.FACTOR_ID="totp";class Mc extends MA{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Mc(t,void 0,e)}static _fromEnrollmentId(e,t){return new Mc(t,e)}async _finalizeEnroll(e,t,r){return we(typeof this.secret<"u",e,"argument-error"),K4(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){we(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return c3(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class Wv{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new Wv(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(Ld(e)||Ld(t))&&(s=!0),s&&(Ld(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),Ld(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Ld(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var Ob="@firebase/auth",Vb="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h${constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){we(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f$(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function p$(n){fs(new Zr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;we(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:aA(n)},c=new BL(r,s,i,l);return YL(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),fs(new Zr("auth-internal",e=>{const t=yn(e.getProvider("auth").getImmediate());return(r=>new h$(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Nr(Ob,Vb,f$(n)),Nr(Ob,Vb,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m$=5*60,g$=Tx("authIdTokenMaxAge")||m$;let Mb=null;const v$=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>g$)return;const s=t==null?void 0:t.token;Mb!==s&&(Mb=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function y$(n=Ll()){const e=ci(n,"auth");if(e.isInitialized())return e.getImmediate();const t=JL(n,{popupRedirectResolver:u$,persistence:[a3,IA,TA]}),r=Tx("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=v$(i.toString());U4(t,o,()=>o(t.currentUser)),F4(t,a=>o(a))}}const s=xx("auth");return s&&XL(t,`http://${s}`),t}function _$(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}qL({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=xr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",_$().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});p$("Browser");const b$={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},Qv=kx(b$),ne=kV(Qv),Jv=fL(Qv),je=y$(Qv);try{DV(ne)}catch{}try{$4(je,IA)}catch{}j4(je,n=>{n||fA(je)});async function w$(n,e){try{return(await P4(je,n,e)).user}catch(t){throw t}}async function LA(n,e){try{return(await yA(je,n,e)).user}catch(t){throw t}}async function Yv(n){try{await E4(je,n)}catch(e){throw e}}async function x$(n){try{const e=je.currentUser;if(e)await D4(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const us=Object.freeze(Object.defineProperty({__proto__:null,auth:je,createPlayerAccount:w$,db:ne,getMessaging:xg,resetPlayerPassword:Yv,signInPlayer:LA,storage:Jv,updatePlayerPassword:x$},Symbol.toStringTag,{value:"Module"})),Vm="BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8";async function Xv(){try{return await sI()}catch{return!1}}async function $A(){if(typeof navigator>"u"||!navigator.serviceWorker)return null;const n=await navigator.serviceWorker.getRegistration();if(n&&n.active)return n;const e=await navigator.serviceWorker.register("/service-worker.js");return new Promise(t=>{if(e.active){t(e);return}const r=()=>{e.active&&(e.removeEventListener("statechange",r),t(e))};e.addEventListener("statechange",r)})}async function FA(n){var i;if(!await Xv()||await Notification.requestPermission()!=="granted")return null;const t=xg(Ll());let r=n||await $A();const s=await iI(t,r?{vapidKey:Vm,serviceWorkerRegistration:r}:{vapidKey:Vm});try{const o=((i=je==null?void 0:je.currentUser)==null?void 0:i.email)||"anonymous";o&&s&&await Wt(_e(ne,"userPushTokens",o),{tokens:eM(s),lastToken:s,email:o,updatedAt:Yn(),userAgent:navigator.userAgent,lastActivation:Yn()},{merge:!0})}catch{}return s}async function nc(){try{const n=localStorage.getItem("fcmToken");if(n){const r=xg(Ll());try{const s=await iI(r,{vapidKey:Vm});if(s===n)return{active:!0,token:s}}catch{}}const e=await $A(),t=await FA(e);return t?(localStorage.setItem("fcmToken",t),{active:!0,token:t}):{active:!1,error:"Failed to get token"}}catch(n){return{active:!1,error:n.message}}}function I$(){setInterval(async()=>{try{const n=await nc();n.active||(console.log("Push notifications inactive, attempting to reactivate..."),window.dispatchEvent(new CustomEvent("push-status-changed",{detail:n})))}catch(n){console.warn("Push health check failed:",n)}},5*60*1e3)}const E$=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function T$(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function UA(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function A$(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function jA(n){if(!n)return!1;const e=String(n).toLowerCase();return E$.some(t=>e.includes(t.toLowerCase()))}function Mm(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?A$(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>Mm(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=jA(t)?"••••":Mm(r);return e}return n}function S$(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&jA(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(Mm(r))}return e}const P$=UA(T$());function $d(n,e){const t=UA(n);return(...r)=>{if(t<P$)return;const s=S$(r);console[e](...s)}}const N={debug:$d("debug","log"),info:$d("info","info"),warn:$d("warn","warn"),error:$d("error","error")},Zv="userNavigation";async function Bo(n,e,t={}){try{if(!n||!e){N.warn("Données manquantes pour tracker la navigation",{userId:n,path:e});return}if(["/reset-password","/magic","/join","/login","/signup"].some(o=>e.startsWith(o))){N.debug("Page exclue du tracking:",e);return}const s={userId:n,lastVisitedPage:e,lastVisitedAt:Yn(),deviceInfo:k$(),...t},i=n.includes("@")?`email_${n.replace(/[^a-zA-Z0-9]/g,"_")}`:n;await Wt(_e(ne,Zv,i),s,{merge:!0}),N.debug("Navigation trackée dans Firestore:",{userId:n,path:e,docId:i})}catch(r){N.error("Erreur lors du tracking de la navigation",r)}}async function R$(n){try{if(!n)return N.warn("Aucun userId fourni pour récupérer la navigation"),null;const e=n.includes("@")?`email_${n.replace(/[^a-zA-Z0-9]/g,"_")}`:n,t=_e(ne,Zv,e),r=await Kt(t);if(r.exists()){const s=r.data();return N.debug("Dernière page visitée récupérée:",s),s}else return N.debug("Aucune navigation trouvée pour:",n),null}catch(e){return N.error("Erreur lors de la récupération de la navigation",e),null}}async function C$(n){try{if(!n){N.warn("Aucun userId fourni pour effacer la navigation");return}const e=n.includes("@")?`email_${n.replace(/[^a-zA-Z0-9]/g,"_")}`:n,t=_e(ne,Zv,e);await Wt(t,{userId:n,lastVisitedPage:null,lastVisitedAt:Yn(),cleared:!0}),N.debug("Historique de navigation effacé pour:",n)}catch(e){N.error("Erreur lors de l'effacement de la navigation",e)}}function Lb(n){return!(!n||["/reset-password","/magic","/join","/login","/signup"].some(t=>n.startsWith(t))||n===window.location.pathname)}function k$(){try{return{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,timestamp:new Date().toISOString()}}catch{return{timestamp:new Date().toISOString()}}}function D$(){try{const n=localStorage.getItem("hatcast_current_user_id");if(n)return n;const t=new URLSearchParams(window.location.search).get("email");return t||null}catch(n){return N.error("Erreur lors de la récupération de l'ID utilisateur",n),null}}const N$={class:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between"},O$={class:"flex items-center space-x-3"},V$={class:"bg-white rounded-2xl shadow-2xl border border-gray-100 p-6 mx-4 max-w-sm w-full transform hover:scale-105 transition-all duration-300 cursor-pointer"},M$={class:"flex justify-center"},L$={key:0,class:"fixed inset-0 z-[200] flex items-center justify-center bg-black/50 backdrop-blur-sm"},$$={__name:"App",setup(n){const e=S(null),t=S(!1),r=S(!1),s=S(!1),i=S(!1),o=co();kt(()=>o.path,async(x,w)=>{if(x!==w){const I=D$();if(I){const $={};if(x.startsWith("/season/")){const L=x.split("/");L.length>=3&&($.seasonSlug=L[2])}if(x.includes("/event/")){const L=x.match(/\/event\/([^\/]+)/);L&&($.eventId=L[1])}await Bo(I,x,$)}}},{immediate:!0});function a(x){x.preventDefault(),e.value=x,t.value=!0;const w=localStorage.getItem("hatcast-pwa-banner-last-shown"),I=Date.now(),$=24*60*60*1e3;w&&I-parseInt(w)<$?t.value=!1:localStorage.setItem("hatcast-pwa-banner-last-shown",I.toString())}async function l(){if(e.value){try{e.value.prompt();const{outcome:x}=await e.value.userChoice;x==="accepted"?(console.log("PWA installée avec succès"),localStorage.setItem("hatcast-pwa-installed","true")):console.log("Installation PWA refusée par l'utilisateur")}catch(x){console.error("Erreur lors de l'installation PWA:",x)}t.value=!1,e.value=null,i.value=!0}}function c(){i.value=!0,localStorage.setItem("hatcast-pwa-banner-dismissed",Date.now().toString())}function h(){t.value=!1,e.value=null,i.value=!0,localStorage.setItem("hatcast-pwa-installed","true")}function f(){const x=localStorage.getItem("hatcast-pwa-installed"),w=localStorage.getItem("hatcast-pwa-banner-dismissed");if(x==="true"){t.value=!1;return}if(w){const I=Date.now(),$=60*60*1e3;I-parseInt(w)<$&&(i.value=!0)}}function g(){s.value=!0,console.log("🚀 Début de la mise à jour PWA..."),setTimeout(async()=>{try{if(console.log("📡 Vérification du service worker..."),"serviceWorker"in navigator){const x=await navigator.serviceWorker.getRegistration();console.log("🔍 Enregistrement SW trouvé:",x),x&&x.active?(console.log("✅ Service worker actif trouvé, envoi du message SKIP_WAITING..."),x.active.postMessage({type:"SKIP_WAITING"}),console.log("📤 Message SKIP_WAITING envoyé"),await new Promise(w=>setTimeout(w,500)),console.log("⏳ Attente de 500ms terminée"),x.waiting?(console.log("🔄 Service worker en attente détecté, attente de l'activation..."),await new Promise(w=>{const I=()=>{x.waiting?(console.log("⏳ Service worker toujours en attente, nouvelle vérification dans 100ms..."),setTimeout(I,100)):(console.log("✅ Service worker activé avec succès"),w())};I()})):console.log("ℹ️ Aucun service worker en attente")):console.warn("⚠️ Aucun service worker actif trouvé")}else console.warn("⚠️ Service Worker non supporté sur cet appareil");console.log("🔄 Rechargement de la page..."),window.location.reload()}catch(x){console.error("❌ Erreur lors de la mise à jour:",x),s.value=!1,alert(`Erreur lors de la mise à jour: ${x.message}

Veuillez rafraîchir manuellement la page.`)}},1e3)}function v(){r.value=!0}return Tn(()=>{f(),nc().then(x=>{x.active?console.log("Notifications push actives au démarrage"):console.log("Notifications push inactives au démarrage:",x.error)}),window.addEventListener("beforeinstallprompt",a),window.addEventListener("appinstalled",h),window.addEventListener("pwa-update-test",v),"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{s.value||(r.value=!0)}),navigator.serviceWorker.addEventListener("message",x=>{x.data&&x.data.type==="SW_UPDATING"&&console.log("Service worker en cours de mise à jour...")}),setInterval(()=>{navigator.serviceWorker.getRegistration().then(x=>{x&&x.update()})},60*60*1e3))}),rg(()=>{window.removeEventListener("beforeinstallprompt",a),window.removeEventListener("appinstalled",h),window.removeEventListener("pwa-update-test",v)}),(x,w)=>{const I=HS("router-view");return C(),D(mt,null,[Be(I),Be(dp,{name:"install-banner",appear:""},{default:Ud(()=>[t.value&&!i.value?(C(),D("div",{key:0,class:"fixed top-0 left-0 right-0 z-[99999] bg-black text-white shadow-lg border-b border-gray-800",onClick:l},[d("div",N$,[w[1]||(w[1]=d("div",{class:"flex items-center space-x-3 flex-1"},[d("img",{src:vR,alt:"HatCast",class:"w-8 h-8 rounded-lg"}),d("div",{class:"flex-1"},[d("div",{class:"flex items-center space-x-2"},[d("span",{class:"font-semibold text-lg text-white"},"HatCast")]),d("p",{class:"text-sm text-gray-300 leading-tight"}," Installez l'app pour une meilleure expérience ")])],-1)),d("div",O$,[d("button",{class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",onClick:ft(l,["stop"])}," Installer "),d("button",{class:"text-gray-400 hover:text-white p-2 rounded-full hover:bg-gray-800 transition-colors",onClick:ft(c,["stop"]),"aria-label":"Fermer la barre d'installation"},w[0]||(w[0]=[d("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])])):ie("",!0)]),_:1}),Be(dp,{name:"update-banner",appear:""},{default:Ud(()=>[r.value&&!s.value?(C(),D("div",{key:0,class:"fixed inset-0 z-[200] flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:g},[d("div",V$,[w[3]||(w[3]=d("div",{class:"flex justify-center mb-4"},[d("div",{class:"w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center shadow-lg"},[d("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})])])],-1)),w[4]||(w[4]=d("div",{class:"text-center mb-6"},[d("h3",{class:"text-xl font-bold text-gray-900 mb-2"}," 🎉 Nouvelle version disponible ! "),d("p",{class:"text-gray-600 leading-relaxed"}," HatCast a été amélioré avec de nouvelles fonctionnalités et corrections. Mettez à jour maintenant pour profiter des dernières améliorations. ")],-1)),d("div",M$,[d("button",{class:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 transition-all duration-200 flex items-center space-x-2",onClick:ft(g,["stop"])},w[2]||(w[2]=[d("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),d("span",null,"Mettre à jour maintenant",-1)]))]),w[5]||(w[5]=d("p",{class:"text-center text-xs text-gray-400 mt-4"}," Cliquez n'importe où pour fermer ",-1))])])):ie("",!0)]),_:1}),Be(dp,{name:"update-progress",appear:""},{default:Ud(()=>[s.value?(C(),D("div",L$,w[6]||(w[6]=[d("div",{class:"bg-white rounded-2xl shadow-2xl border border-gray-100 p-8 mx-4 max-w-sm w-full text-center"},[d("div",{class:"flex justify-center mb-6"},[d("div",{class:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[d("svg",{class:"w-10 h-10 text-white animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})])])]),d("h3",{class:"text-xl font-bold text-gray-900 mb-3"}," Mise à jour en cours... "),d("p",{class:"text-gray-600"}," Veuillez patienter pendant qu'HatCast se met à jour "),d("div",{class:"mt-6 bg-gray-200 rounded-full h-2 overflow-hidden"},[d("div",{class:"bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full animate-pulse"})])],-1)]))):ie("",!0)]),_:1})],64)}}},F$="modulepreload",U$=function(n){return"/"+n},$b={},xt=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=U$(i),i in $b)return;$b[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":F$,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((h,f)=>{c.addEventListener("load",h),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function j$(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=n;let a,l;const c=async(f=!0)=>{await l};async function h(){if("serviceWorker"in navigator){const{Workbox:f}=await xt(()=>import("./workbox-window.prod.es5-5ffdab76.js"),[]);a=new f("/service-worker.js",{scope:"/",type:"classic"}),a.addEventListener("activated",g=>{(g.isUpdate||g.isExternal)&&window.location.reload()}),a.addEventListener("installed",g=>{g.isUpdate||r==null||r()}),a.register({immediate:e}).then(g=>{i?i("/service-worker.js",g):s==null||s(g)}).catch(g=>{o==null||o(g)})}}return l=h(),c}const wa="seasons";async function B$(n,e,t,r="",s=""){return await ya(tt(ne,wa),{name:n,slug:e,pinCode:t,description:r,logoUrl:s,createdAt:Yn()})}async function q$(n){return await Ol(_e(ne,wa,n))}async function el(){const n=Cc(tt(ne,wa),FV("createdAt","desc"));return(await $t(n)).docs.map(t=>({id:t.id,...t.data()}))}async function Mh(n,e){const t=await Kt(_e(ne,wa,n));return t.exists()?t.data().pinCode===e:!1}async function Lm(n){const e=await Kt(_e(ne,wa,n));return e.exists()?e.data().pinCode:null}async function Cu(n,e){const t=_e(ne,wa,n);await vo(t,{sortOrder:e})}async function z$(n,e){const t=_e(ne,wa,n);await vo(t,e)}const ey="lastVisitedSeason",BA="lastVisitedSeasonTimestamp";async function H$(n){if(n)try{const e=je.currentUser,t=e==null?void 0:e.email;try{localStorage.setItem(ey,n),localStorage.setItem(BA,Date.now().toString())}catch(r){N.warn("Erreur lors de la sauvegarde localStorage",r)}if(t)try{const r=_e(ne,"userPreferences",t);await Wt(r,{lastVisitedSeason:n,lastVisitedSeasonTimestamp:Date.now()},{merge:!0}),N.debug("Préférence de saison sauvegardée dans Firebase",{seasonSlug:n,userEmail:t})}catch(r){N.warn("Erreur lors de la sauvegarde Firebase",r)}}catch(e){N.error("Erreur lors de la mémorisation de la saison",e)}}async function qA(){try{const n=je.currentUser,e=n==null?void 0:n.email;if(e)try{const t=_e(ne,"userPreferences",e),r=await Kt(t);if(r.exists()){const s=r.data();if(s.lastVisitedSeason)return N.debug("Préférence de saison récupérée depuis Firebase",{seasonSlug:s.lastVisitedSeason}),s.lastVisitedSeason}}catch(t){N.warn("Erreur lors de la récupération Firebase",t)}try{const t=localStorage.getItem(ey);if(t)return N.debug("Préférence de saison récupérée depuis localStorage",{seasonSlug:t}),t}catch(t){N.warn("Erreur lors de la lecture localStorage",t)}return null}catch(n){return N.error("Erreur lors de la récupération de la dernière saison",n),null}}async function K$(n=null){var e;try{const t=n||((e=je.currentUser)==null?void 0:e.email);try{localStorage.removeItem(ey),localStorage.removeItem(BA)}catch(r){N.warn("Erreur lors du nettoyage localStorage",r)}if(t)try{const r=_e(ne,"userPreferences",t);await Wt(r,{lastVisitedSeason:null,lastVisitedSeasonTimestamp:null},{merge:!0}),N.debug("Préférence de saison nettoyée dans Firebase",{userEmail:t})}catch(r){N.warn("Erreur lors du nettoyage Firebase",r)}}catch(t){N.error("Erreur lors du nettoyage des préférences",t)}}function G$(n,e){return!n||!e||!Array.isArray(e)?!1:e.some(t=>t.slug===n)}const Cs=S(null),Gi=S(!1),Hs=S(!1),W$=qe(()=>{var n;return!!Cs.value&&!((n=Cs.value)!=null&&n.isAnonymous)});qe(()=>!!Cs.value);function pl(){var n;try{const e=je.currentUser;e!==Cs.value&&(Cs.value=e,N.debug("Synchronisation forcée de l'état d'authentification",{user:((n=Cs.value)==null?void 0:n.email)||"non connecté"}))}catch(e){N.error("Erreur lors de la synchronisation forcée",e)}}function Q$(){var n;if(N.debug("Tentative d'initialisation du service d'authentification",{isInitialized:Gi.value,isInitializing:Hs.value}),Gi.value||Hs.value){N.debug("Service déjà initialisé ou en cours d'initialisation, sortie");return}Hs.value=!0,N.debug("Marquage du service comme en cours d'initialisation");try{Cs.value=je.currentUser,N.debug("État initial de l'utilisateur:",((n=Cs.value)==null?void 0:n.email)||"non connecté");const e=je.onAuthStateChanged(async t=>{const r=Cs.value;Cs.value=t,Gi.value=!0,Hs.value=!1,N.debug("État d'authentification changé",{isLoggedIn:!!t,email:(t==null?void 0:t.email)||"non connecté"});try{if(t&&!r){const s=window.location.pathname;s&&s!=="/"&&(await Bo(t.uid,s),N.debug("Navigation trackée pour nouvelle connexion:",s))}else!t&&r&&(await C$(r.uid),N.debug("Historique de navigation effacé pour déconnexion"))}catch(s){N.error("Erreur lors du tracking de navigation:",s)}});window._authStateUnsubscribe=e,N.info("Service d'état d'authentification initialisé avec succès")}catch(e){N.error("Erreur lors de l'initialisation du service d'authentification:",e),Hs.value=!1}}function zA(){return new Promise((n,e)=>{if(N.debug("waitForInitialization appelé",{isInitialized:Gi.value,isInitializing:Hs.value}),Gi.value){N.debug("Service déjà initialisé, résolution immédiate"),n();return}if(!Hs.value){N.warn("Service d'authentification non initialisé et non en cours d'initialisation"),e(new Error("Service d'authentification non initialisé"));return}const t=setInterval(()=>{N.debug("Vérification de l'initialisation...",{isInitialized:Gi.value,isInitializing:Hs.value}),Gi.value&&(clearInterval(t),N.debug("Service initialisé, résolution"),n())},100);setTimeout(()=>{clearInterval(t),N.warn("Timeout de waitForInitialization, rejet de la promesse"),e(new Error("Timeout d'initialisation du service d'authentification"))},5e3)})}function J$(){N.debug("Initialisation forcée demandée"),!Gi.value&&!Hs.value&&Lh()}function Lh(){if(N.debug("Tentative d'auto-initialisation du service d'authentification"),typeof je>"u"||!je){N.warn("Firebase auth non disponible, nouvelle tentative dans 500ms"),setTimeout(Lh,500);return}try{Q$()}catch(n){N.error("Erreur lors de l'auto-initialisation:",n),setTimeout(Lh,1e3)}}setTimeout(Lh,100);const Y$={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center"},X$={class:"text-center"},Z$={class:"text-white text-lg"},eF={__name:"SeasonResolver",setup(n){const e=da(),t=S("Chargement...");return Tn(async()=>{try{if(new URLSearchParams(window.location.search).get("p")==="reset-password"){N.info("Redirection vers la page de reset password"),e.replace("/reset-password");return}t.value="Vérification de votre session...",pl(),await zA();const i=await new Promise((l,c)=>{const h=setTimeout(()=>{c(new Error("Timeout Firebase Auth"))},3e3),f=je.onAuthStateChanged(g=>{clearTimeout(h),f(),l(g)});je.currentUser&&(clearTimeout(h),f(),l(je.currentUser))}),o=i==null?void 0:i.email;if(!o){N.info("Utilisateur non connecté, redirection vers /seasons"),e.replace("/seasons");return}t.value="Récupération de vos préférences...";const a=await qA();if(!a){N.info("Aucune saison mémorisée, redirection vers /seasons"),e.replace("/seasons");return}t.value="Vérification de la saison...";try{const l=await el();if(!G$(a,l)){N.info("Saison mémorisée n'existe plus, redirection vers /seasons"),await K$(o),e.replace("/seasons");return}}catch(l){N.error("Erreur lors de la vérification des saisons",l),e.replace("/seasons");return}N.info("Redirection vers la saison mémorisée",{seasonSlug:a}),e.replace(`/season/${a}`)}catch(r){N.error("Erreur lors de la résolution de la saison",r),e.replace("/seasons")}}),(r,s)=>(C(),D("div",Y$,[d("div",X$,[s[0]||(s[0]=d("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"},null,-1)),d("p",Z$,ee(t.value),1)])]))}},tF="/logos/hatcast-mask.png",$m="/logos/hatcast-logo-mobile.png";async function nF(n,e=800,t=800,r=.8){return new Promise((s,i)=>{const o=document.createElement("canvas"),a=o.getContext("2d"),l=new Image;l.onload=()=>{let{width:c,height:h}=l;c>e&&(h=h*e/c,c=e),h>t&&(c=c*t/h,h=t),o.width=c,o.height=h,a.drawImage(l,0,0,c,h),o.toBlob(f=>{if(f){const g=new File([f],n.name,{type:"image/jpeg",lastModified:Date.now()});s(g)}else i(new Error("Erreur lors du redimensionnement"))},"image/jpeg",r)},l.onerror=()=>i(new Error("Erreur lors du chargement de l'image")),l.src=URL.createObjectURL(n)})}async function HA(){if(!je.currentUser){N.info("Aucun utilisateur connecté, tentative de connexion anonyme...");try{await fA(je),N.info("Connexion anonyme réussie")}catch(n){throw N.error("Erreur lors de la connexion anonyme:",n),new Error("Impossible de s'authentifier: "+n.message)}}await new Promise(n=>setTimeout(n,1e3))}async function rF(n,e,t={}){var r;try{if(N.info("Début upload image",{fileName:n.name,path:e,originalSize:`${(n.size/1024/1024).toFixed(2)}MB`}),await HA(),!n.type.startsWith("image/"))throw new Error("Le fichier doit être une image");if(n.size>10*1024*1024)throw new Error("L'image est trop volumineuse (max 10MB)");let s=n;if(t.resize!==!1&&(n.size>1024*1024||t.forceResize)){N.info("Redimensionnement de l'image pour optimiser les performances...");try{s=await nF(n,t.maxWidth||800,t.maxHeight||800,t.quality||.8),N.info("Image redimensionnée",{newSize:`${(s.size/1024/1024).toFixed(2)}MB`,compression:`${((1-s.size/n.size)*100).toFixed(1)}%`})}catch(x){N.warn("Erreur lors du redimensionnement, utilisation du fichier original:",x),s=n}}const a=`${Date.now()}_${n.name}`,l=`${e}/${a}`,c=BT(Jv,l);N.info("Tentative d'upload vers Firebase Storage...",{fullPath:l,user:(r=je.currentUser)==null?void 0:r.uid,isAuthenticated:!!je.currentUser,finalSize:`${(s.size/1024/1024).toFixed(2)}MB`});const h=cL(c,s),f=new Promise((x,w)=>setTimeout(()=>w(new Error("Timeout: Upload trop long")),3e4)),g=await Promise.race([h,f]);N.info("Image uploadée avec succès",{fullPath:l});const v=await dL(g.ref);return N.info("URL de téléchargement récupérée",{downloadURL:v}),v}catch(s){if(N.error("Erreur lors de l'upload de l'image",s),s.message.includes("CORS")||s.message.includes("preflight")||s.message.includes("permission")||s.message.includes("unauthenticated")||s.message.includes("ERR_FAILED")||s.message.includes("Timeout"))return N.warn("Erreur d'accès détectée, utilisation du stockage local temporaire",s.message),await sF(n,e);throw s}}async function sF(n,e){return new Promise((t,r)=>{const s=new FileReader;s.onload=i=>{const o=i.target.result;N.info("Image stockée localement en base64",{path:e}),t(o)},s.onerror=()=>r(new Error("Erreur lors de la lecture du fichier")),s.readAsDataURL(n)})}async function iF(n){var e;try{if(N.info("Début suppression image",{imageUrl:n}),n.startsWith("data:image/")){N.info("Image locale (base64), suppression ignorée");return}await HA();const r=(e=new URL(n).pathname.split("/o/")[1])==null?void 0:e.split("?")[0];if(!r)throw new Error("Impossible d'extraire le chemin de l'image");const s=decodeURIComponent(r),i=BT(Jv,s);await hL(i),N.info("Image supprimée avec succès",{decodedPath:s})}catch(t){throw N.error("Erreur lors de la suppression de l'image",t),t}}function oF(n){return n&&n.includes("firebasestorage.googleapis.com")}const Bp=7*24*60*60*1e3,ku="hatcast_pin_session";class aF{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(ku);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<Bp){try{t.timestamp=Date.now(),localStorage.setItem(ku,JSON.stringify(t))}catch{}return t}else this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(ku,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){if(!this.sessionData)return!1;const t=this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<Bp;if(t)try{this.sessionData.timestamp=Date.now(),localStorage.setItem(ku,JSON.stringify(this.sessionData))}catch{}return t}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(ku),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=Bp-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const Hn=new aF,lF={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},uF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},cF={class:"text-center mb-6"},dF={class:"text-gray-300"},hF={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},fF={class:"text-sm text-green-400"},pF={class:"mb-6"},mF={class:"mb-4"},gF={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},vF={class:"flex justify-end space-x-3"},yF=["disabled"],KA={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(""),o=S(null);kt(()=>t.show,h=>{h&&(s.value="",i.value="",rn(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(h,f)=>n.show?(C(),D("div",lF,[d("div",uF,[d("div",cF,[f[1]||(f[1]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),d("p",dF,ee(n.message),1),n.sessionInfo?(C(),D("div",hF,[d("p",fF," Session active : "+ee(n.sessionInfo.timeRemaining)+" min restantes ",1)])):ie("",!0)]),d("div",pF,[d("div",mF,[f[3]||(f[3]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),st(d("input",{"onUpdate:modelValue":f[0]||(f[0]=g=>s.value=g),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[sr(l,["enter"]),sr(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[Lt,s.value]])]),f[4]||(f[4]=d("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(C(),D("div",gF,ee(i.value||t.error),1)):ie("",!0),d("div",vF,[d("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,yF)])])])):ie("",!0)}},Fb="hatcast_trusted_players",Ub=180*24*60*60*1e3;class _F{constructor(){this.trustedMap=this.load()}load(){try{const e=localStorage.getItem(Fb);if(!e)return{};const t=JSON.parse(e);return typeof t=="object"&&t!==null?t:{}}catch{return{}}}persist(){try{localStorage.setItem(Fb,JSON.stringify(this.trustedMap))}catch{}}isPasswordCached(e){if(!e)return!1;const t=this.trustedMap[e];if(!t)return!1;const r=Date.now(),s=r-t<Ub;return s?(this.trustedMap[e]=r,this.persist()):(delete this.trustedMap[e],this.persist()),s}getCachedPassword(e){return null}saveSession(e,t){e&&(this.trustedMap[e]=Date.now(),this.persist())}clearSession(e){e&&(delete this.trustedMap[e],this.persist())}clearExpiredSessions(){const e=Date.now();let t=!1;for(const[r,s]of Object.entries(this.trustedMap))e-s>Ub&&(delete this.trustedMap[r],t=!0);t&&this.persist()}clearAllSessions(){this.trustedMap={},this.persist()}}const lo=new _F,Ff=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},bF={};function wF(n,e){return C(),D(mt,null,[e[0]||(e[0]=d("div",{class:"text-gray-300"},"🎭 Ça marche déjà super bien sans, mais avec un compte, c'est encore plus cool :",-1)),e[1]||(e[1]=d("div",null,[ut("• "),d("span",{class:"text-blue-300"},"🔒 Tes dispos sont à l'abri :"),ut(" plus personne ne peut modifier tes choix à ta place")],-1)),e[2]||(e[2]=d("div",null,[ut("• "),d("span",{class:"text-blue-300"},"📧 Alertes VIP :"),ut(" sois le premier informé des nouveaux spectacles et sélections")],-1)),e[3]||(e[3]=d("div",null,[ut("• "),d("span",{class:"text-blue-300"},"⚡ Saisie express :"),ut(" ton nom reste en haut de la liste, plus besoin de le chercher")],-1))],64)}const jb=Ff(bF,[["render",wF]]),xF={key:0,class:"mt-4"},IF={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-2"},EF={key:1},TF={key:0,class:"mt-3 pt-3 border-t border-blue-500/20 text-sm text-gray-300 space-y-2"},ty={__name:"AccountBenefitsHint",props:{inline:{type:Boolean,default:!1}},setup(n){const e=S(!1);return(t,r)=>n.inline?(C(),D("div",EF,[d("button",{onClick:r[1]||(r[1]=s=>e.value=!e.value),class:"text-blue-300 hover:text-blue-200 text-sm font-medium flex items-center gap-2 transition-colors"},[r[3]||(r[3]=d("span",null,"À quoi sert un compte ?",-1)),d("span",{class:cn(["transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(C(),D("div",TF,[Be(jb)])):ie("",!0)])):(C(),D("div",xF,[d("button",{onClick:r[0]||(r[0]=s=>e.value=!e.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[r[2]||(r[2]=d("h3",{class:"text-sm font-semibold text-blue-300"},"💡 À quoi sert un compte ?",-1)),d("span",{class:cn(["text-blue-300 transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(C(),D("div",IF,[Be(jb)])):ie("",!0)]))}},AF={class:"space-y-4"},SF={class:"flex items-center justify-between"},PF={class:"flex items-center gap-2 text-gray-300 text-sm"},RF={key:0,class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},CF={key:1,class:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm"},kF={class:"flex justify-center gap-3 mt-2"},DF=["disabled"],NF={key:0,class:"animate-spin"},OF={key:1},GA={__name:"AccountLoginModal",props:{show:{type:Boolean,default:!1}},emits:["close","success"],setup(n,{emit:e}){const t=e,r=S(""),s=S(""),i=S(!1),o=S(""),a=S(""),l=S(!0),c=qe(()=>!!r.value&&r.value.includes("@")&&!!s.value);async function h(){if(c.value){i.value=!0,o.value="",a.value="";try{if(await LA(r.value.trim(),s.value),l.value)try{lo.saveSession(r.value.trim())}catch{}t("success")}catch{o.value="Email ou mot de passe incorrect"}finally{i.value=!1}}}async function f(){if(!r.value||!r.value.includes("@")){o.value="Saisissez votre email pour recevoir un lien de réinitialisation",setTimeout(()=>{o.value=""},2500);return}i.value=!0,o.value="",a.value="";try{await Yv(r.value.trim()),a.value="Email de réinitialisation envoyé"}catch{o.value="Impossible d'envoyer l'email de réinitialisation"}finally{i.value=!1}}return(g,v)=>n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:v[6]||(v[6]=x=>g.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:v[5]||(v[5]=ft(()=>{},["stop"]))},[d("button",{onClick:v[0]||(v[0]=x=>g.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),v[10]||(v[10]=or('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Se connecter</h2><p class="text-sm text-gray-300">Connectez-vous pour gérer votre compte et vos préférences</p></div>',1)),d("div",AF,[Be(ty),d("div",null,[v[7]||(v[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Email",-1)),st(d("input",{"onUpdate:modelValue":v[1]||(v[1]=x=>r.value=x),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Lt,r.value]])]),d("div",null,[v[8]||(v[8]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),st(d("input",{"onUpdate:modelValue":v[2]||(v[2]=x=>s.value=x),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe"},null,512),[[Lt,s.value]])]),d("div",SF,[d("label",PF,[st(d("input",{type:"checkbox","onUpdate:modelValue":v[3]||(v[3]=x=>l.value=x),class:"w-4 h-4"},null,512),[[Hi,l.value]]),v[9]||(v[9]=d("span",null,"Rester connecté sur cet appareil",-1))]),d("button",{onClick:f,class:"text-sm text-blue-400 hover:text-blue-300 underline"},"Mot de passe oublié ?")]),o.value?(C(),D("div",RF,ee(o.value),1)):ie("",!0),a.value?(C(),D("div",CF,ee(a.value),1)):ie("",!0),d("div",kF,[d("button",{onClick:h,disabled:!c.value||i.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(C(),D("span",NF,"⏳")):(C(),D("span",OF,"Se connecter"))],8,DF),d("button",{onClick:v[4]||(v[4]=x=>g.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])])):ie("",!0)}},Uf="magicLinks";function jf({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function ny(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function $h({seasonId:n,playerId:e,eventId:t,action:r,slug:s}){const i=jf({seasonId:n,playerId:e,eventId:t,action:r}),o=ny(40),a=_e(ne,Uf,i),l=Date.now()+1e3*60*60*24*7;await Wt(a,{seasonId:n,playerId:e,eventId:t,token:o,action:r,expiresAt:l});let h=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(r)}`;return s&&(h+=`&slug=${encodeURIComponent(s)}`),{id:i,token:o,url:h}}async function WA({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=jf({seasonId:n,playerId:e,eventId:r,action:s}),o=ny(40),a=_e(ne,Uf,i),l=Date.now()+1e3*60*60*24*7;await Wt(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const h=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:h}}async function QA({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=jf({seasonId:n,playerId:e,eventId:t,action:s}),o=_e(ne,Uf,i),a=await Kt(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function Fm({seasonId:n,playerId:e,eventId:t,action:r}){const s=jf({seasonId:n,playerId:e,eventId:t,action:r}),i=_e(ne,Uf,s);await Ol(i)}const ry="accountMagicLinks";function Bf(n){return`account__${n}`}async function JA({currentEmail:n,newEmail:e}){const t=ny(40),r=Bf(t),s=_e(ne,ry,r),i=Date.now()+1e3*60*60*24*7;await Wt(s,{token:t,currentEmail:n,newEmail:e,action:"account_email_update",expiresAt:i});const a=`${window.location.origin+"/"}magic?a=account_email_update&t=${encodeURIComponent(t)}`;return{id:r,token:t,url:a}}async function YA({token:n}){const e=Bf(n),t=_e(ne,ry,e),r=await Kt(t);if(!r.exists())return{valid:!1,reason:"not_found"};const s=r.data();return s.token!==n?{valid:!1,reason:"token_mismatch"}:typeof s.expiresAt=="number"&&Date.now()>s.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:s}}async function XA({token:n}){const e=Bf(n),t=_e(ne,ry,e);await Ol(t)}const ZA=Object.freeze(Object.defineProperty({__proto__:null,buildAccountId:Bf,consumeAccountEmailUpdateLink:XA,consumeMagicLink:Fm,createAccountEmailUpdateLink:JA,createEmailVerificationLink:WA,createMagicLink:$h,verifyAccountEmailUpdateLink:YA,verifyMagicLink:QA},Symbol.toStringTag,{value:"Module"}));async function ad({toEmail:n,title:e,body:t,data:r={},reason:s="generic"}){if(!n)return{success:!1,error:"missing_toEmail"};const i={to:n,title:e,body:t,data:r,reason:s,createdAt:Yn()};return await ya(tt(ne,"pushQueue"),i),{success:!0}}function VF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,yesUrl:s,noUrl:i}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>${n?`<strong>${n}</strong>`:"<strong>Hello</strong>"},</p>
      <p>🎯 <strong>Nouveau spectacle à l'horizon !</strong></p>
      <p>Es-tu dispo le ${t} pour <a href="${r}" style="color:#3b82f6;text-decoration:underline;font-weight:600;">${e}</a> ?</p>
      <p>🎭 <em>On a besoin de toi pour que ça brille ! ✨</em></p>
      <p style="margin-top: 12px; text-align: center;">
        <a href="${s}" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;">✅ Dispo</a>
        <a href="${i}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
      </p>
      <p style="margin-top: 16px; color:#6b7280;">Détails : <a href="${r}" style="color:#3b82f6;text-decoration:underline;">${r}</a></p>
    </div>
  `}function MF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`${n?`${n}`:"Hello"},

🎯 Nouveau spectacle à l'horizon ! 

Es-tu dispo le ${t} pour ${e} ?

🎭 On a besoin de toi pour que ça brille ! ✨

✅ Dispo ❌ Pas dispo

Lien direct : ${r}`}function LF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`${n?`Bonjour ${n}`:"Hello"},

Tu es sélectionné(e) pour ${e} le ${t}!

🕺 Prépares-toi à briller, toute l'équipe compte sur toi!

Un imprévu ?😬 
Pas de souci, signales vite ton indisponibilité ici pour qu'on relance la sélection du spectacle : ${r}`}function $F({playerName:n,eventTitle:e,eventUrl:t,activationUrl:r,seasonTitle:s}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>${n?`<strong>${n}</strong>`:"<strong>Hello</strong>"},</p>
      <p>🔔 <strong>Active tes notifications pour ne rien rater !</strong></p>
      <p>Tu veux être informé(e) en temps réel de <strong>tous tes événements</strong> de la saison <strong>${s}</strong> ?</p>
      <p>🎯 <em>Clique sur le bouton ci-dessous pour activer tes notifications et recevoir des alertes pour tes événements !</em></p>
      <p style="margin-top: 16px; text-align: center;">
        <a href="${r}" style="display:inline-block;padding:12px 24px;background:linear-gradient(135deg, #8b5cf6, #ec4899);color:white;border-radius:8px;text-decoration:none;font-weight:600;box-shadow:0 4px 12px rgba(139, 92, 246, 0.3);">🔔 Activer mes notifications</a>
      </p>
      <p style="margin-top: 16px; color:#6b7280; font-size: 14px;">
        <em>En activant tes notifications, tu recevras des alertes pour :</em><br>
        • Les demandes de disponibilité<br>
        • Les sélections de joueurs<br>
        • Les changements d'horaires<br>
        • Les annonces importantes
      </p>
      <p style="margin-top: 16px; color:#6b7280;">Détails de l'événement : <a href="${t}" style="color:#3b82f6;text-decoration:underline;">${t}</a></p>
    </div>
  `}const FF="HatCast <impropick@gmail.com>",UF="impropick@gmail.com";function ld(n=null){return{from:n||FF,replyTo:n||UF}}async function jF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,eventUrl:o=void 0,reason:a="new_event",fromEmail:l=void 0}){try{const v=_e(ne,"userPreferences",n),x=await Kt(v);if(x.exists()){const w=x.data();if((w==null?void 0:w.notifyAvailability)===!1)return{success:!0,skipped:!0}}}catch{}const c=VF({playerName:e,eventTitle:t,eventDate:r,eventUrl:o,yesUrl:s,noUrl:i}),h=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,f={to:n,message:{subject:h,html:c},createdAt:Yn(),meta:{reason:a,eventTitle:t,eventDate:r,playerName:e}},g=ld(l);f.from=g.from,f.replyTo=g.replyTo,await ya(tt(ne,"mail"),f);try{const v=_e(ne,"userPreferences",n),x=await Kt(v),w=x.exists()?x.data():{};if((w==null?void 0:w.notifyAvailabilityPush)!==!1){const I=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,$=`${e}, t'es dispo ?`;await ad({toEmail:n,title:I,body:$,data:{url:o||window.location.origin,yesUrl:s,noUrl:i,reason:a},reason:a==="reminder"?"availability_reminder":"availability_request"})}}catch{}return{success:!0}}async function e1({toEmail:n,verifyUrl:e,purpose:t="player_protection",displayName:r="utilisateur",fromEmail:s=void 0}){const i=t==="account_email_update",o=i?"Vérification de votre nouvelle adresse email":"Vérification de votre email",a=`Bonjour ${r},`,l=i?"Pour sécuriser votre compte, merci de confirmer que vous avez accès à cette nouvelle adresse email.":"Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.",c=i?"Confirmer mon adresse email":"Vérifier mon email",h=i?"Confirmez votre nouvelle adresse email":"Confirmez votre email pour activer la protection",f=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>${o}</h2>
      <p>${a}</p>
      <p>${l}</p>
      <p>
        <a href="${e}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">${c}</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,g={to:n,message:{subject:h,html:f},createdAt:Yn(),meta:{reason:t,displayName:r}},v=ld(s);g.from=v.from,g.replyTo=v.replyTo,await ya(tt(ne,"mail"),g)}async function BF({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){return e1({toEmail:n,verifyUrl:t,purpose:"player_protection",displayName:e,fromEmail:r})}async function qF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0,noUrl:l=void 0}){try{const v=_e(ne,"userPreferences",n),x=await Kt(v);if(x.exists()){const w=x.data();if((w==null?void 0:w.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}N.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const c=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,h=o||`🎭 Sélection confirmée · ${t}`;N.debug("queueSelectionEmail html/subject ready");const f={to:n,message:{subject:h,html:c},createdAt:Yn(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}},g=ld(a);f.from=g.from,f.replyTo=g.replyTo,N.debug("queueSelectionEmail firestore payload ready");try{await ya(tt(ne,"mail"),f);try{const v=_e(ne,"userPreferences",n),x=await Kt(v),w=x.exists()?x.data():{};console.log("Préférences utilisateur pour notifications push",{toEmail:n,prefs:w,notifySelectionPush:w==null?void 0:w.notifySelectionPush,shouldSendPush:(w==null?void 0:w.notifySelectionPush)!==!1}),(w==null?void 0:w.notifySelectionPush)!==!1?(console.log("Envoi notification push de sélection",{toEmail:n,playerName:e,eventTitle:t}),await ad({toEmail:n,title:"🎭 Sélection confirmée",body:`${e}, tu as été sélectionné(e) pour ${t} (${r}) 🎉`,data:{url:s||window.location.origin,noUrl:l},reason:"selection"}),console.log("Notification push de sélection envoyée avec succès")):console.log("Notification push de sélection désactivée par préférences utilisateur")}catch(v){console.error("Erreur lors de l'envoi de la notification push de sélection",v)}return N.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(v){throw N.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:v}),v}}async function zF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,newSelectedPlayers:i=[],html:o=void 0,subject:a=void 0,fromEmail:l=void 0}){try{const x=_e(ne,"userPreferences",n),w=await Kt(x);if(w.exists()){const I=w.data();if((I==null?void 0:I.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}const c=Array.isArray(i)?i.join(", "):"",h=o||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Sélection mise à jour</h2>
      <p>Bonjour ${e},</p>
      <p>La sélection pour <strong>${t}</strong> (${r}) a été mise à jour et tu n'en fais plus partie 😔.</p>
      ${c?`<p>Nouvelle sélection: <strong>${c}</strong>.</p>`:""}
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#6b7280;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: mise à jour de sélection (relance auto ou ajustement manuel).</p>
    </div>
  `,f=a||`🎭 Tu n'es plus dans la sélection · ${t}`,g={to:n,message:{subject:f,html:h},createdAt:Yn(),meta:{reason:"deselection",eventTitle:t,eventDate:r,playerName:e,newSelectedPlayers:i}},v=ld(l);g.from=v.from,g.replyTo=v.replyTo,await ya(tt(ne,"mail"),g);try{const x=_e(ne,"userPreferences",n),w=await Kt(x),I=w.exists()?w.data():{};(I==null?void 0:I.notifySelectionPush)!==!1&&await ad({toEmail:n,title:"🎭 Sélection mise à jour",body:`${e}, tu n'es plus sélectionné(e) pour ${t} (${r}) 😔`,data:{url:s||window.location.origin,noUrl:s&&s.includes("/event/")?s.replace("/event/","/magic?auto=no&event="):void 0},reason:"deselection"})}catch{}return{success:!0}}async function HF({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(N.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await xt(()=>Promise.resolve().then(()=>ud),void 0),{createMagicLink:a}=await xt(()=>Promise.resolve().then(()=>ZA),void 0),l=`${window.location.origin}/season/${s}/event/${n}`;t.join(", ");const c=`🎭 Sélection confirmée · ${e.title}`,h=[];for(const f of t){N.debug("Traitement du joueur",{playerName:f});try{const g=i==null?void 0:i.find(L=>L.name===f);if(!g){N.warn("Joueur non trouvé",{playerName:f});continue}N.debug("Joueur trouvé");const v=await o(g.id,r);if(!v){N.warn("Pas d'email pour le joueur",{playerName:f});continue}N.debug("Email trouvé pour joueur");const w=`${(await a({seasonId:r,playerId:g.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,I=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${Fh(e.date)}).</p>
          <p>Un imprévu ?</p>
          <p>
            <a href="${w}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;margin-right:8px;">❌ Plus dispo</a>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
          </p>
        </div>
      `;N.debug("HTML généré pour joueur");const $=qF({toEmail:v,playerName:f,eventTitle:e.title,eventDate:Fh(e.date),eventUrl:l,html:I,subject:c,noUrl:w});h.push($),N.info("Email ajouté à la queue",{playerName:f})}catch(g){N.error("Erreur lors de l'envoi de l'email de sélection",{playerName:f,error:g})}}return N.info("Nombre total d'emails à envoyer",{count:h.length}),await Promise.all(h),N.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:h.length}}async function KF({eventId:n,eventData:e,removedPlayers:t,newSelectedPlayers:r,seasonId:s,seasonSlug:i,players:o}){if(N.info("sendDeselectionEmailsForEvent",{eventId:n,seasonId:s,removedCount:t==null?void 0:t.length}),!e||!t||t.length===0)return{success:!0,count:0};const{getPlayerEmail:a}=await xt(()=>Promise.resolve().then(()=>ud),void 0),l=`${window.location.origin}/season/${i}/event/${n}`,c=[],h=Array.isArray(r)?r.join(", "):"";for(const f of t)try{const g=o==null?void 0:o.find(w=>w.name===f);if(!g){N.warn("Joueur retiré non trouvé",{playerName:f});continue}const v=await a(g.id,s);if(!v){N.warn("Pas d'email pour le joueur retiré",{playerName:f});continue}const x=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection mise à jour</h2>
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu n'es plus sélectionné(e) pour <strong>${e.title}</strong> (${Fh(e.date)}) 😔.</p>
          ${h?`<p>Nouvelle sélection: <strong>${h}</strong>.</p>`:""}
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #6b7280;color:#6b7280;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;c.push(zF({toEmail:v,playerName:f,eventTitle:e.title,eventDate:Fh(e.date),eventUrl:l,newSelectedPlayers:r,html:x}))}catch(g){N.error("Erreur lors de l'envoi de l'email de désélection",{playerName:f,error:g})}return await Promise.all(c),N.info("Emails de désélection envoyés",{count:c.length}),{success:!0,count:c.length}}function Fh(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}async function GF({toEmail:n,playerName:e,eventTitle:t,eventUrl:r,activationUrl:s,seasonTitle:i,fromEmail:o=void 0}){const a=$F({playerName:e,eventTitle:t,eventUrl:r,activationUrl:s,seasonTitle:i}),l=`🔔 Active tes notifications pour ${i}`,c={to:n,message:{subject:l,html:a},createdAt:Yn(),meta:{reason:"notification_activation",eventTitle:t,playerName:e}},h=ld(o);c.from=h.from,c.replyTo=h.replyTo;try{return await ya(tt(ne,"mail"),c),N.info("Email d'activation des notifications ajouté à la queue",{toEmail:n,playerName:e}),{success:!0}}catch(f){throw N.error("Erreur lors de l'ajout de l'email d'activation à la queue",f),f}}function sy(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function t1(n){return`seasonPreferredPlayer:${n||"global"}`}function Um(n,e){try{const t=t1(n),r=localStorage.getItem(t);if(!r){localStorage.setItem(t,JSON.stringify([e]));return}if(r.startsWith("[")){const s=JSON.parse(r);s.includes(e)||(s.push(e),localStorage.setItem(t,JSON.stringify(s)))}else r!==e&&localStorage.setItem(t,JSON.stringify([r,e]))}catch{}}function WF(n,e){try{const t=t1(n),r=localStorage.getItem(t);if(!r)return;if(r.startsWith("[")){const s=JSON.parse(r).filter(i=>i!==e);s.length===0?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(s))}else r===e&&localStorage.removeItem(t)}catch{}}async function n1(n,e,t,r=null){try{N.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await Jl(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await xt(()=>import("./index.esm-a5a77fae.js"),[]),{db:c}=await xt(()=>Promise.resolve().then(()=>us),void 0),h=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(h,a("email","==",e)),g=await l(f);if(!g.empty&&g.docs.find(U=>U.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");N.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:v}=await xt(()=>import("./index.esm-49aca4ca.js"),[]),{auth:x}=await xt(()=>Promise.resolve().then(()=>us),void 0),w=await v(x,e,t);N.info("Compte Firebase Auth créé",{uid:w.user.uid});const I=sy(t),$=r?_e(c,"seasons",r,"playerProtection",n):_e(c,"playerProtection",n);return await Wt($,{playerId:n,email:e,passwordHash:I,firebaseUid:w.user.uid,isProtected:!0,createdAt:new Date}),N.info("Protection sauvegardée dans Firestore"),r&&Um(r,n),{success:!0}}catch(s){throw N.error("Erreur lors de la protection du joueur",s),s}}async function r1({playerId:n,email:e,seasonId:t=null}){const r=t?_e(ne,"seasons",t,"playerProtection",n):_e(ne,"playerProtection",n);(await Kt(r)).exists()?await vo(r,{email:e,updatedAt:new Date}):await Wt(r,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:i}=await WA({seasonId:t,playerId:n,email:e});return{success:!0,url:i}}async function s1({playerId:n,seasonId:e=null}){const t=e?_e(ne,"seasons",e,"playerProtection",n):_e(ne,"playerProtection",n);if(!(await Kt(t)).exists())throw new Error("Protection introuvable");return await vo(t,{emailVerifiedAt:new Date}),{success:!0}}async function i1({playerId:n,seasonId:e=null}){const t=e?_e(ne,"seasons",e,"playerProtection",n):_e(ne,"playerProtection",n);return await vo(t,{emailVerifiedAt:null}),{success:!0}}async function o1(n,e=null){try{const t=e?_e(ne,"seasons",e,"playerProtection",n):_e(ne,"playerProtection",n);return await Wt(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date}),e&&WF(e,n),{success:!0,email:""}}catch(t){throw N.error("Erreur lors de la suppression de la protection",t),t}}async function Ji(n,e=null){try{const t=e?_e(ne,"seasons",e,"playerProtection",n):_e(ne,"playerProtection",n),r=await Kt(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return N.error("Erreur lors de la vérification de protection",t),!1}}async function Jl(n,e=null){try{const t=e?_e(ne,"seasons",e,"playerProtection",n):_e(ne,"playerProtection",n),r=await Kt(t);return r.exists()?r.data():null}catch(t){return N.error("Erreur lors de la récupération des données de protection",t),null}}async function a1(n,e=null){try{const t=await Jl(n,e);return(t==null?void 0:t.email)||""}catch(t){return N.error("Erreur lors de la récupération de l'email",t),""}}async function jm(n=null){try{const e=n?tt(ne,"seasons",n,"playerProtection"):tt(ne,"playerProtection");return(await $t(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return N.error("Erreur lors du chargement des protections",e),[]}}async function qf(n){try{const e=[],t=Cc(tt(ne,"playerProtection"),kh("email","==",n));(await $t(t)).forEach(i=>{const o=i.data();o!=null&&o.isProtected&&e.push({seasonId:null,playerId:i.id,...o})});const s=await $t(tt(ne,"seasons"));for(const i of s.docs){const o=i.id,a=Cc(tt(ne,"seasons",o,"playerProtection"),kh("email","==",n));(await $t(a)).forEach(c=>{var f;const h=c.data();h!=null&&h.isProtected&&e.push({seasonId:o,seasonName:(f=i.data())==null?void 0:f.name,playerId:c.id,...h})})}return e}catch(e){return N.error("Erreur listAssociationsForEmail",e),[]}}async function l1(n,e,t=null){try{const r=await Jl(n,t);if(!r||!r.isProtected)return!1;if(r.email){N.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await xt(()=>import("./index.esm-49aca4ca.js"),[]),{auth:i}=await xt(()=>Promise.resolve().then(()=>us),void 0);return await s(i,r.email,e),N.debug("Mot de passe Firebase Auth valide"),lo.saveSession(n),t&&Um(t,n),!0}catch(s){return N.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{N.debug("Vérification avec hash local");const s=sy(e),i=r.passwordHash===s;return i&&(lo.saveSession(n),t&&Um(t,n)),i}}catch(r){return N.error("Erreur lors de la vérification du mot de passe",r),!1}}async function u1({playerId:n,seasonId:e=null}){const t=e?_e(ne,"seasons",e,"playerProtection",n):_e(ne,"playerProtection",n),r=await Kt(t);if(!r.exists())throw new Error("Protection introuvable");const s=r.data();if(s!=null&&s.email)return await vo(t,{isProtected:!0,updatedAt:new Date}),{success:!0};throw new Error("Email non défini pour cette protection")}function Yo(n){return lo.isPasswordCached(n)}function QF(n){return null}async function c1(n,e=null){try{N.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await Jl(n,e);if(N.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(N.debug("Email à utiliser (masqué)"),t.firebaseUid){N.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await xt(()=>import("./index.esm-49aca4ca.js"),[]),{auth:s}=await xt(()=>Promise.resolve().then(()=>us),void 0);N.debug("Tentative d'envoi d'email"),await r(s,t.email),N.info("Email envoyé avec succès via Firebase Auth")}else{N.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await xt(()=>import("./index.esm-49aca4ca.js"),[]),{auth:i}=await xt(()=>Promise.resolve().then(()=>us),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);N.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),N.info("Email envoyé avec succès");const{updateDoc:l}=await xt(()=>import("./index.esm-a5a77fae.js"),[]),{db:c}=await xt(()=>Promise.resolve().then(()=>us),void 0),h=e?_e(c,"seasons",e,"playerProtection",n):_e(c,"playerProtection",n);await l(h,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")N.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),N.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw N.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function JF(n,e,t=null){try{const r=sy(e),s=t?_e(ne,"seasons",t,"playerProtection",n):_e(ne,"playerProtection",n);return await vo(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw N.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function YF(n){return new Promise((e,t)=>{N.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const ud=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:i1,finalizeProtectionAfterVerification:u1,getCachedPlayerPassword:QF,getPlayerEmail:a1,getPlayerProtectionData:Jl,isPlayerPasswordCached:Yo,isPlayerProtected:Ji,listAssociationsForEmail:qf,listProtectedPlayers:jm,markEmailVerifiedForProtection:s1,protectPlayer:n1,requirePlayerPasswordForAvailability:YF,sendPasswordResetEmail:c1,startEmailVerificationForProtection:r1,unprotectPlayer:o1,updatePlayerPasswordInFirestore:JF,verifyPlayerPassword:l1},Symbol.toStringTag,{value:"Module"})),XF={class:"mb-4 md:mb-6"},ZF={class:"flex items-start gap-4"},e6={class:"flex items-center gap-3"},t6={class:"space-y-2"},n6={class:"flex items-center gap-2"},r6={class:"text-gray-400 text-xs md:text-sm"},s6={key:0,class:"flex items-center gap-2"},i6=["title"],o6={class:"text-blue-200"},a6={class:"space-y-4 md:space-y-6"},l6={class:"space-y-2 md:space-y-3"},u6={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},c6=["disabled"],d6={key:0,class:"mt-2 text-xs text-red-300"},h6={key:1,class:"mt-2 text-xs text-green-300"},f6={class:"space-y-2 md:space-y-3"},p6={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},m6={class:"flex items-center justify-between mb-4"},g6={class:"space-y-4"},v6=["disabled"],y6={key:0,class:"text-xs text-red-300 text-center"},_6={key:1,class:"text-xs text-green-300 text-center"},b6={class:"flex items-center justify-between mb-4"},w6={class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},x6={class:"space-y-3"},I6={key:0,class:"text-sm text-gray-400 text-center py-4"},E6={key:1,class:"space-y-2"},T6={class:"flex items-center gap-2 min-w-0 flex-1"},A6={class:"truncate"},S6={class:"text-white font-medium text-sm"},P6={class:"text-gray-400 text-xs"},R6=["onClick"],d1={__name:"AccountMenu",props:{show:{type:Boolean,default:!1},seasonId:{type:String,default:null}},emits:["close","delete-account","open-player"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(""),o=S(!1),a=S(""),l=S(""),c=S(!1),h=S(!1),f=S(""),g=S(""),v=S([]),x=S(!1),w=S(!1);kt(s,A=>{i.value=A||""}),kt(i,A=>{c.value=!!A&&A.includes("@")&&A!==s.value});async function I(){if(c.value){o.value=!0,a.value="",l.value="";try{const A=await JA({currentEmail:s.value,newEmail:i.value.trim()});await e1({toEmail:i.value.trim(),verifyUrl:A.url,purpose:"account_email_update",displayName:"utilisateur"}),l.value=`Un email de vérification a été envoyé à ${i.value.trim()}. Cliquez sur le lien pour confirmer le changement.`}catch(A){a.value=(A==null?void 0:A.code)==="auth/requires-recent-login"?"Veuillez vous reconnecter pour modifier votre email":"Impossible de mettre à jour l'email"}finally{o.value=!1}}}async function $(){if(s.value){h.value=!0,f.value="",g.value="";try{await Yv(s.value),g.value="Email de réinitialisation envoyé. Vérifiez votre boîte de réception."}catch{f.value="Impossible d'envoyer l'email de réinitialisation. Veuillez réessayer."}finally{h.value=!1}}}function L(A){return`${A.seasonId||"global"}__${A.playerId}`}async function U(){try{const A=s.value?await qf(s.value):[],b=[];for(const T of A){let k=T.playerId,F=T.seasonId||"—";try{if(T.seasonId){const M=_e(ne,"seasons",T.seasonId,"players",T.playerId),R=await Kt(M);R.exists()&&(k=R.data().name||k);const Ke=_e(ne,"seasons",T.seasonId),ct=await Kt(Ke);ct.exists()&&(F=ct.data().name||F)}}catch{}b.push({...T,playerName:k,seasonName:F})}v.value=b}catch{v.value=[]}}async function q(A){if(confirm(`Êtes-vous sûr de vouloir dissocier le joueur "${A.playerName}" de votre compte ?`))try{const{deleteDoc:b}=await xt(()=>import("./index.esm-a5a77fae.js"),[]);if(A.seasonId){const k=_e(ne,"seasons",A.seasonId,"playerProtection",A.playerId);await b(k)}else{const k=_e(ne,"playerProtection",A.playerId);await b(k)}try{if(A.seasonId){const k=`seasonPreferredPlayer:${A.seasonId}`,F=localStorage.getItem(k);if(F)if(F.startsWith("[")){const R=(JSON.parse(F)||[]).filter(Ke=>Ke!==A.playerId);localStorage.setItem(k,JSON.stringify(R))}else F===A.playerId&&localStorage.removeItem(k)}}catch{}await U();const T=`Joueur "${A.playerName}" dissocié avec succès`}catch(b){console.error("Erreur lors de la dissociation:",b),alert(`Erreur lors de la dissociation: ${b.message||"Veuillez réessayer"}`)}}function te(A){r("open-player",A),X()}function X(){r("close")}return kt(()=>t.show,A=>{var b;if(A)try{s.value=((b=je==null?void 0:je.currentUser)==null?void 0:b.email)||"",U()}catch{}}),Tn(()=>{var A;if(t.show)try{s.value=((A=je==null?void 0:je.currentUser)==null?void 0:A.email)||"",U()}catch{}}),(A,b)=>n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-2 md:p-4",onClick:X},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg md:max-w-xl max-h-[90vh] overflow-y-auto",onClick:b[3]||(b[3]=ft(()=>{},["stop"]))},[d("button",{onClick:X,class:"absolute right-2 md:right-3 top-2 md:top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),d("div",XF,[d("div",ZF,[d("div",e6,[b[13]||(b[13]=d("div",{class:"w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0"},[d("span",{class:"text-lg md:text-xl"},"👤")],-1)),d("div",t6,[b[12]||(b[12]=d("h3",{class:"text-white font-semibold text-base md:text-lg"},"Mon compte",-1)),d("div",n6,[d("span",r6,ee(s.value||"Non défini"),1),d("button",{onClick:b[0]||(b[0]=T=>x.value=!0),class:"text-indigo-400 hover:text-indigo-300 transition-colors p-1 hover:bg-indigo-400/10 rounded flex-shrink-0",title:"Modifier l'email","aria-label":"Modifier l'email"}," ✏️ ")]),v.value.length>0?(C(),D("div",s6,[d("button",{onClick:b[1]||(b[1]=T=>v.value.length===1?te(v.value[0]):w.value=!0),class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-xs md:text-sm hover:bg-blue-500/30 transition-colors cursor-pointer",title:v.value.length===1?`Voir ${v.value[0].playerName}`:"Gérer mes joueurs"},[b[11]||(b[11]=d("span",{class:"text-blue-300"},"⭐",-1)),d("span",o6,ee(v.value.length===1?v.value[0].playerName:`${v.value.length} joueurs`),1)],8,i6)])):ie("",!0)])])])]),b[18]||(b[18]=d("div",{class:"border-t border-white/10 mb-4 md:mb-6"},null,-1)),d("div",a6,[d("div",l6,[b[15]||(b[15]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-green-400"},"🔑"),ut(" Mot de passe ")],-1)),d("div",u6,[b[14]||(b[14]=d("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Vous pouvez changer votre mot de passe pour sécuriser vos opérations sensibles.",-1)),d("button",{onClick:$,disabled:h.value,class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},ee(h.value?"⏳":"Changer de mot de passe"),9,c6),f.value?(C(),D("div",d6,ee(f.value),1)):ie("",!0),g.value?(C(),D("div",h6,ee(g.value),1)):ie("",!0)])]),d("div",f6,[b[17]||(b[17]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-red-400"},"⚠️"),ut(" Suppression de compte ")],-1)),d("div",p6,[b[16]||(b[16]=d("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Cette action est irréversible et supprimera définitivement votre compte.",-1)),d("button",{onClick:b[2]||(b[2]=T=>A.$emit("delete-account")),class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-red-600 text-white hover:bg-red-500 text-sm"},"Supprimer mon compte")])])]),d("div",{class:"mt-4 md:mt-6 text-center"},[d("button",{onClick:X,class:"px-4 md:px-6 py-2 md:py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 text-sm"},"Fermer")])]),x.value?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:b[7]||(b[7]=T=>x.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-md",onClick:b[6]||(b[6]=ft(()=>{},["stop"]))},[d("div",m6,[b[19]||(b[19]=d("h3",{class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},[d("span",{class:"text-blue-400"},"📧"),ut(" Modifier l'email ")],-1)),d("button",{onClick:b[4]||(b[4]=T=>x.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),d("div",g6,[d("div",null,[b[20]||(b[20]=d("label",{class:"block text-xs text-gray-400 mb-2"},"Nouvelle adresse email",-1)),st(d("input",{"onUpdate:modelValue":b[5]||(b[5]=T=>i.value=T),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400 text-sm",placeholder:"nouvel@email.com"},null,512),[[Lt,i.value]])]),d("button",{onClick:I,disabled:!c.value||o.value,class:"w-full px-4 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},ee(o.value?"⏳":"Mettre à jour"),9,v6),a.value?(C(),D("div",y6,ee(a.value),1)):ie("",!0),l.value?(C(),D("div",_6,ee(l.value),1)):ie("",!0)])])])):ie("",!0),w.value?(C(),D("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:b[10]||(b[10]=T=>w.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg",onClick:b[9]||(b[9]=ft(()=>{},["stop"]))},[d("div",b6,[d("h3",w6,[b[21]||(b[21]=d("span",{class:"text-yellow-400"},"⭐",-1)),ut(" "+ee(v.value.length<=1?"Mon joueur":"Mes joueurs"),1)]),d("button",{onClick:b[8]||(b[8]=T=>w.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),d("div",x6,[v.value.length===0?(C(),D("div",I6," Aucun joueur associé pour le moment. ")):(C(),D("div",E6,[(C(!0),D(mt,null,jr(v.value,T=>(C(),D("div",{key:L(T),class:"flex items-center justify-between p-3 bg-gray-800/30 rounded-lg"},[d("div",T6,[b[22]||(b[22]=d("span",{class:"text-yellow-400 text-sm"},"⭐",-1)),d("div",A6,[d("div",S6,ee(T.playerName||"—"),1),d("div",P6,ee(T.seasonName||T.seasonId||"—"),1)])]),d("button",{onClick:k=>q(T),class:"p-1.5 rounded bg-red-600/20 text-red-400 hover:bg-red-600/30 hover:text-red-300 transition-colors duration-200 flex-shrink-0",title:"Dissocier ce joueur","aria-label":"Dissocier ce joueur"}," 🗑️ ",8,R6)]))),128))]))])])])):ie("",!0)])):ie("",!0)}},Bb="/logos/hatcast-logo-desktop.png",C6={key:0,class:"w-10 h-10 bg-gray-600 animate-pulse rounded-full"},k6=["aria-expanded"],Bm={__name:"AccountDropdown",props:{isConnected:{type:Boolean,default:!1},buttonClass:{type:String,default:"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700"}},emits:["open-account-menu","open-help","open-notifications","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=S(!0),o=S(null),a=S({});kt(()=>t.isConnected,I=>{i.value=!1},{immediate:!0}),Tn(()=>{i.value=!1});function l(){r("open-login")}function c(){s.value=!s.value,s.value&&rn(()=>h())}function h(){if(o.value){const I=o.value.getBoundingClientRect();a.value={top:`${I.bottom+8}px`,right:`${window.innerWidth-I.right}px`}}}function f(){s.value=!1,r("open-account-menu")}function g(){s.value=!1,r("open-help")}function v(){s.value=!1,r("open-notifications")}async function x(){s.value=!1;try{await je.signOut(),r("logout")}catch(I){console.error("Erreur lors de la déconnexion:",I)}}function w(){s.value=!1}return Tn(()=>{document.addEventListener("click",w),window.addEventListener("resize",h),window.addEventListener("scroll",h,{passive:!0})}),Js(()=>{document.removeEventListener("click",w),window.removeEventListener("resize",h),window.removeEventListener("scroll",h)}),(I,$)=>(C(),D("div",{class:"relative",onClick:$[0]||($[0]=ft(()=>{},["stop"]))},[i.value?(C(),D("div",C6)):n.isConnected?(C(),D("button",{key:2,onClick:c,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte","aria-expanded":s.value,"aria-haspopup":"true",ref_key:"dropdownButton",ref:o},$[1]||($[1]=[d("span",{class:"text-2xl"},"👤",-1)]),8,k6)):(C(),D("button",{key:1,onClick:l,class:cn(["px-4 py-2 rounded-lg transition-all duration-300 border transition-colors",n.buttonClass])}," Connexion ",2)),(C(),Ys(ac,{to:"body"},[s.value&&n.isConnected?(C(),D("div",{key:0,class:"fixed w-auto min-w-[180px] max-w-[200px] md:min-w-[200px] md:max-w-[240px] bg-gray-900 border border-white/20 rounded-lg shadow-xl py-1 z-[9999]",style:Ur(a.value),role:"menu"},[d("button",{onClick:f,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},$[2]||($[2]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"👤",-1),d("span",{class:"truncate"},"Mon compte",-1)])),d("button",{onClick:v,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},$[3]||($[3]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"🔔",-1),d("span",{class:"truncate"},"Notifications",-1)])),d("button",{onClick:g,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},$[4]||($[4]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"❓",-1),d("span",{class:"truncate"},"Aide",-1)])),$[6]||($[6]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:x,class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},$[5]||($[5]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"🚪",-1),d("span",{class:"truncate"},"Se déconnecter",-1)]))],4)):ie("",!0)]))]))}},D6={class:"container mx-auto px-4 py-4"},N6={class:"flex items-center justify-between"},O6={class:"flex items-center"},V6={href:"/",class:"flex items-center"},M6={class:"relative w-48 h-12 md:w-56 md:h-14"},L6={class:"flex items-center gap-2"},$6={__name:"AppHeader",props:{isScrolled:{type:Boolean,default:!1}},emits:["open-account-menu","open-help","open-notifications","open-players","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=co(),i=qe(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");kt(()=>s.path,()=>{pl(),setTimeout(()=>{pl()},100)},{immediate:!0}),Js(()=>{window._appHeaderUnsubscribe&&(window._appHeaderUnsubscribe(),delete window._appHeaderUnsubscribe)});function o(){r("open-account-menu")}function a(){r("open-help")}function l(){r("open-notifications")}function c(){r("open-players")}function h(){r("logout")}function f(){r("open-login")}return(g,v)=>(C(),D("header",{class:cn(["fixed top-0 left-0 right-0 z-50 transition-all duration-300",n.isScrolled?"bg-white/95 backdrop-blur-md border-b border-gray-200/50 shadow-lg":"bg-transparent"])},[d("nav",D6,[d("div",N6,[d("div",O6,[d("a",V6,[d("div",M6,[n.isScrolled?(C(),D(mt,{key:1},[v[2]||(v[2]=d("img",{src:$m,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 md:hidden"},null,-1)),v[3]||(v[3]=d("img",{src:Bb,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 hidden md:block"},null,-1))],64)):(C(),D(mt,{key:0},[v[0]||(v[0]=d("img",{src:$m,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 md:hidden brightness-0 invert"},null,-1)),v[1]||(v[1]=d("img",{src:Bb,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 hidden md:block brightness-0 invert"},null,-1))],64))])])]),d("div",L6,[Be(Bm,{"is-connected":Br(W$),"button-class":i.value,onOpenAccountMenu:o,onOpenHelp:a,onOpenNotifications:l,onOpenPlayers:c,onLogout:h,onOpenLogin:f},null,8,["is-connected","button-class"]),WS(g.$slots,"actions")])])])],2))}},F6={class:"space-y-4 md:space-y-6"},U6={class:"space-y-2 md:space-y-3"},j6={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},B6={class:"flex items-center justify-between"},q6={class:"flex items-center gap-2"},z6={class:"flex items-center justify-between"},H6={class:"flex items-center gap-2"},K6={class:"space-y-2 md:space-y-3"},G6={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},W6={class:"flex items-center justify-between"},Q6={class:"flex items-center gap-2"},J6={class:"flex items-center justify-between"},Y6={class:"flex items-center gap-2"},X6={class:"flex items-center justify-between pt-2 border-t border-white/10"},Z6=["disabled"],eU={key:1,class:"inline-flex items-center text-xs text-gray-300"},tU={class:"flex items-center justify-between pt-2"},nU=["disabled"],rU={key:0,class:"text-xs text-green-300"},sU={key:1,class:"text-xs text-red-300"},iU={key:2,class:"text-[10px] text-gray-400 break-all"},oU={class:"text-[10px] text-gray-500"},aU={key:0,class:"text-xs text-red-300"},lU={key:1,class:"text-xs text-green-300"},uU={class:"mt-6 flex justify-between items-center"},cU=["disabled"],h1={__name:"NotificationsModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S({notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),o=S(!1),a=S(""),l=S(""),c=S(!1),h=S(""),f=S(""),g=S(!1),v=S(localStorage.getItem("fcmToken")||""),x=S(!1),w=function(b){try{return b?b.length>20?b.slice(0,8)+"…"+b.slice(-6):b:""}catch{return""}}("BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8");function I(A){const{active:b,token:T}=A.detail;b&&T?(v.value=T,x.value=!0,localStorage.setItem("fcmToken",T),console.log("Notifications push réactivées automatiquement")):(x.value=!1,v.value="",localStorage.removeItem("fcmToken"),console.log("Notifications push désactivées"))}async function $(){try{if(!s.value)return;const A=_e(ne,"userPreferences",s.value),b=await Kt(A);if(b.exists()){const T=b.data()||{};i.value.notifyAvailability=T.notifyAvailability!==!1,i.value.notifySelection=T.notifySelection!==!1,i.value.notifySelectionPush=T.notifySelectionPush!==!1,i.value.notifyAvailabilityPush=T.notifyAvailabilityPush!==!1}else i.value={notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}}catch{}}async function L(){if(s.value){c.value=!0,f.value="",h.value="";try{if(!(await nc()).active){f.value="Notifications push non actives sur cet appareil";return}await ad({toEmail:s.value,title:"Test HatCast",body:"Ceci est un test de notification",data:{url:"/"},reason:"manual_test"}),h.value="OK"}catch{f.value="Échec de l'envoi du test"}finally{c.value=!1}}}function U(){const A=new CustomEvent("pwa-update-test",{detail:{type:"test-update",timestamp:Date.now()}});window.dispatchEvent(A),alert(`🧪 Test de mise à jour PWA déclenché !

Vérifiez que la modal de mise à jour apparaît dans l'interface principale.`)}async function q(){try{if(g.value=!0,!await Xv()){f.value="Push non supporté sur cet appareil";return}const b=await nc();b.active?(v.value=b.token,x.value=!0,localStorage.setItem("fcmToken",b.token),console.log("Notifications push activées avec succès")):f.value=`Activation impossible: ${b.error}`}catch(A){const b=typeof Notification<"u"?Notification.permission:"unknown",T=A&&(A.message||A.code)?` (${A.message||A.code})`:"";f.value=`Activation impossible – permission: ${b}${T}`}finally{g.value=!1}}async function te(){if(s.value){o.value=!0,a.value="",l.value="";try{const A=_e(ne,"userPreferences",s.value);await Wt(A,{...i.value},{merge:!0}),l.value="Préférences sauvegardées"}catch{a.value="Impossible de sauvegarder vos préférences"}finally{o.value=!1}}}function X(){r("close")}return kt(()=>t.show,A=>{A&&$()}),Tn(()=>{var A;try{s.value=((A=je==null?void 0:je.currentUser)==null?void 0:A.email)||"",x.value=typeof Notification<"u"&&Notification.permission==="granted"&&!!localStorage.getItem("fcmToken"),I$(),window.addEventListener("push-status-changed",I),nc().then(b=>{b.active&&(v.value=b.token,x.value=!0,localStorage.setItem("fcmToken",b.token))})}catch{}t.show&&$()}),Js(()=>{window.removeEventListener("push-status-changed",I)}),(A,b)=>n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:X},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:b[4]||(b[4]=ft(()=>{},["stop"]))},[d("button",{onClick:X,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),b[16]||(b[16]=or('<div class="mb-4 md:mb-6"><div class="flex items-start gap-4"><div class="flex items-center gap-3"><div class="w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0"><span class="text-lg md:text-xl">🔔</span></div><div class="space-y-2"><h3 class="text-white font-semibold text-base md:text-lg">Notifications</h3><p class="text-gray-400 text-xs md:text-sm">Ne ratez rien, soyez le premier prévenu !</p></div></div></div></div><div class="border-t border-white/10 mb-4 md:mb-6"></div>',2)),d("div",F6,[d("div",U6,[b[7]||(b[7]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-blue-400"},"📧"),ut(" Emails ")],-1)),d("div",j6,[d("div",B6,[d("label",q6,[st(d("input",{type:"checkbox","onUpdate:modelValue":b[0]||(b[0]=T=>i.value.notifyAvailability=T),class:"w-4 h-4"},null,512),[[Hi,i.value.notifyAvailability]]),b[5]||(b[5]=d("span",{class:"text-sm text-white"},"M'envoyer un email lorsqu'un événement a besoin de joueurs",-1))])]),d("div",z6,[d("label",H6,[st(d("input",{type:"checkbox","onUpdate:modelValue":b[1]||(b[1]=T=>i.value.notifySelection=T),class:"w-4 h-4"},null,512),[[Hi,i.value.notifySelection]]),b[6]||(b[6]=d("span",{class:"text-sm text-white"},"M'envoyer un email lorsque je suis concerné par une sélection",-1))])])])]),d("div",K6,[b[15]||(b[15]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-emerald-400"},"📱"),ut(" Mobile (expérimental) ")],-1)),d("div",G6,[b[14]||(b[14]=d("div",{class:"text-xs text-emerald-200 mb-1"},"Fonctionnalité en test: activable uniquement ici.",-1)),d("div",W6,[d("label",Q6,[st(d("input",{type:"checkbox","onUpdate:modelValue":b[2]||(b[2]=T=>i.value.notifySelectionPush=T),class:"w-4 h-4"},null,512),[[Hi,i.value.notifySelectionPush]]),b[8]||(b[8]=d("span",{class:"text-sm text-white"},"Me notifier lorsque je suis concerné par une sélection",-1))])]),d("div",J6,[d("label",Y6,[st(d("input",{type:"checkbox","onUpdate:modelValue":b[3]||(b[3]=T=>i.value.notifyAvailabilityPush=T),class:"w-4 h-4"},null,512),[[Hi,i.value.notifyAvailabilityPush]]),b[9]||(b[9]=d("span",{class:"text-sm text-white"},"Me notifier lorsqu'un événement a besoin de joueurs",-1))])]),d("div",X6,[b[11]||(b[11]=d("div",{class:"text-xs text-gray-400"},"Notifications sur cet appareil",-1)),x.value?(C(),D("span",eU,b[10]||(b[10]=[d("span",{class:"mr-1 text-emerald-400"},"✓",-1),ut(" Actif ")]))):(C(),D("button",{key:0,onClick:q,disabled:g.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},ee(g.value?"...":"Activer"),9,Z6))]),d("div",tU,[b[12]||(b[12]=d("div",{class:"text-xs text-gray-400"},"Test de notification push",-1)),d("button",{onClick:L,disabled:c.value||!s.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},ee(c.value?"Envoi…":"Envoyer un test"),9,nU)]),d("div",{class:"flex items-center justify-between pt-2"},[b[13]||(b[13]=d("div",{class:"text-xs text-gray-400"},"Test de mise à jour PWA",-1)),d("button",{onClick:U,class:"px-3 py-1 rounded bg-blue-600 text-white text-xs hover:bg-blue-500 transition-colors"}," 🧪 Simuler maj ")]),h.value?(C(),D("div",rU,"Notification test envoyée (vérifiez votre appareil)")):ie("",!0),f.value?(C(),D("div",sU,ee(f.value),1)):ie("",!0),v.value?(C(),D("div",iU,"FCM token: "+ee(v.value),1)):ie("",!0),d("div",oU,"VAPID: "+ee(Br(w)||"indisponible"),1)])]),a.value?(C(),D("div",aU,ee(a.value),1)):ie("",!0),l.value?(C(),D("div",lU,ee(l.value),1)):ie("",!0)]),d("div",uU,[d("button",{onClick:te,disabled:o.value,class:"px-4 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-500 disabled:opacity-50"},ee(o.value?"⏳":"Sauvegarder"),9,cU),d("button",{onClick:X,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ie("",!0)}},dU={class:"space-y-3"},hU={key:0,class:"text-sm text-gray-400"},fU={key:1,class:"space-y-2"},pU={class:"flex items-center justify-between gap-3"},mU={class:"truncate"},gU={class:"text-white font-semibold"},vU={class:"text-gray-400 text-xs"},yU=["onClick"],f1={__name:"PlayersModal",props:{show:{type:Boolean,default:!1}},emits:["close","manage-player"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S([]);function o(h){return`${h.seasonId||"global"}__${h.playerId}`}async function a(){var h;try{s.value=((h=je==null?void 0:je.currentUser)==null?void 0:h.email)||""}catch{}try{const f=s.value?await qf(s.value):[],g=[];for(const v of f){let x=v.playerId;try{if(v.seasonId){const w=_e(ne,"seasons",v.seasonId,"players",v.playerId),I=await Kt(w);I.exists()&&(x=I.data().name||x)}}catch{}g.push({...v,playerName:x})}i.value=g}catch{i.value=[]}}function l(h){r("manage-player",h),c()}function c(){r("close")}return kt(()=>t.show,h=>{h&&a()}),Tn(()=>{t.show&&a()}),(h,f)=>n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:c},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:f[0]||(f[0]=ft(()=>{},["stop"]))},[d("button",{onClick:c,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),f[2]||(f[2]=or('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👥</span></div><h2 class="text-2xl font-bold text-white mb-1">Mes joueurs</h2><p class="text-sm text-gray-300">Gérez vos associations de joueurs</p></div>',1)),d("div",dU,[f[1]||(f[1]=d("h3",{class:"text-white font-semibold mb-2"},"Mes joueurs associés",-1)),i.value.length===0?(C(),D("div",hU,"Aucun joueur associé pour le moment.")):(C(),D("ul",fU,[(C(!0),D(mt,null,jr(i.value,g=>(C(),D("li",{key:o(g),class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},[d("div",pU,[d("div",mU,[d("div",gU,ee(g.seasonName||g.seasonId||"—"),1),d("div",vU,"Joueur : "+ee(g.playerName||"—"),1)]),d("button",{onClick:v=>l(g),class:"px-3 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-xs"},"Gérer",8,yU)])]))),128))]))]),d("div",{class:"mt-6 text-center"},[d("button",{onClick:c,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ie("",!0)}};let hr="mock",Yi=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],ca=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function iy(n){hr=n}async function _U(){if(hr!=="firebase"||!(await $t(tt(ne,"seasons"))).empty)return;const e=_e(tt(ne,"seasons"));await Wt(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:Yn()});const t=await $t(tt(ne,"players"));for(const o of t.docs)await Wt(_e(e,"players",o.id),o.data());const r=await $t(tt(ne,"events"));for(const o of r.docs)await Wt(_e(e,"events",o.id),o.data());const s=await $t(tt(ne,"availability"));for(const o of s.docs)await Wt(_e(e,"availability",o.id),o.data());const i=await $t(tt(ne,"selections"));for(const o of i.docs)await Wt(_e(e,"selections",o.id),o.data())}async function p1(){hr==="firebase"&&await _U()}async function Uh(n=null){let e;return hr==="firebase"?n?e=(await $t(tt(ne,"seasons",n,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=(await $t(tt(ne,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=ca,e.sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const h=new Date(c);return isNaN(h.getTime())?null:h},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function rc(n=null){let e;return hr==="firebase"?n?e=(await $t(tt(ne,"seasons",n,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=(await $t(tt(ne,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=Yi,e.sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function m1(n,e=null){if(hr==="firebase"){const t=_e(e?tt(ne,"seasons",e,"players"):tt(ne,"players"));return await Wt(t,{name:n}),t.id}else{const t=`p${Yi.length+1}`;return Yi.push({id:t,name:n}),t}}async function bU(n,e=null){if(hr==="firebase"){const t=e?_e(ne,"seasons",e,"players",n):_e(ne,"players",n);await Ol(t);const r=e?await $t(tt(ne,"seasons",e,"availability")):await $t(tt(ne,"availability")),s=wv(ne);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else Yi=Yi.filter(t=>t.id!==n)}async function wU(n,e,t=null){if(hr==="firebase"){const r=t?_e(ne,"seasons",t,"players",n):_e(ne,"players",n),s=await Kt(r),i=s.exists()&&s.data().name||null;if(await Wt(r,{name:e},{merge:!0}),i&&i!==e){const o=wv(ne);try{const a=t?_e(ne,"seasons",t,"availability",i):_e(ne,"availability",i),l=await Kt(a);if(l.exists()){const c=l.data()||{},h=t?_e(ne,"seasons",t,"availability",e):_e(ne,"availability",e);o.set(h,c,{merge:!0}),o.delete(a)}}catch{}try{const a=t?tt(ne,"seasons",t,"selections"):tt(ne,"selections");(await $t(a)).forEach(c=>{var f;const h=Array.isArray((f=c.data())==null?void 0:f.players)?c.data().players:[];if(h.includes(i)){const g=h.map(v=>v===i?e:v);o.update(c.ref,{players:g})}})}catch{}await o.commit()}}else{const r=Yi.findIndex(s=>s.id===n);r!==-1&&(Yi[r]={...Yi[r],name:e})}}async function Vo(n,e,t=null){if(hr==="firebase"){const r=t?await $t(tt(ne,"seasons",t,"availability")):await $t(tt(ne,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function Mo(n=null){if(hr==="firebase"){const e=n?await $t(tt(ne,"seasons",n,"selections")):await $t(tt(ne,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function qb(n,e,t=null){if(hr==="firebase"){const r=t?_e(ne,"seasons",t,"availability",n):_e(ne,"availability",n);await Wt(r,e)}}async function xU({seasonId:n,playerName:e,eventId:t,value:r}){if(hr!=="firebase")return;const s=n?_e(ne,"seasons",n,"availability",e):_e(ne,"availability",e),i=await Kt(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await Wt(s,a)}async function qm(n,e,t=null){if(hr==="firebase"){const r=t?_e(ne,"seasons",t,"selections",n):_e(ne,"selections",n);await Wt(r,{players:e})}}async function IU(n,e=null){if(N.info("Suppression de l'événement",{eventId:n}),hr==="firebase")try{N.debug("Suppression de l'événement dans Firestore");const t=e?_e(ne,"seasons",e,"events",n):_e(ne,"events",n);await Ol(t),N.debug("Suppression de la sélection associée");const r=e?_e(ne,"seasons",e,"selections",n):_e(ne,"selections",n);await Ol(r),N.debug("Suppression des disponibilités");const s=e?await $t(tt(ne,"seasons",e,"availability")):await $t(tt(ne,"availability")),i=wv(ne);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){N.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),N.info("Opérations de suppression terminées avec succès")}catch(t){throw N.error("Erreur lors de la suppression",t),t}else ca=ca.filter(t=>t.id!==n)}async function EU(n,e=null){if(hr==="firebase"){const t=_e(e?tt(ne,"seasons",e,"events"):tt(ne,"events"));return await Wt(t,n),t.id}else{const t=`event${ca.length+1}`;return ca.push({id:t,...n}),t}}async function zb(n,e,t=null){if(hr==="firebase"){const r=t?_e(ne,"seasons",t,"events",n):_e(ne,"events",n);await Wt(r,e,{merge:!0})}else{const r=ca.findIndex(s=>s.id===n);r!==-1&&(ca[r]={id:n,...e})}}const TU={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},AU={class:"hero-section relative overflow-hidden pt-24"},SU={class:"hero-content py-16 md:py-24 px-4 relative z-10"},PU={class:"container mx-auto"},RU={class:"grid grid-cols-1 lg:grid-cols-2 gap-16 lg:gap-24 items-center"},CU={class:"text-center lg:text-left order-1 lg:order-2"},kU={class:"hero-cta mb-10"},DU={class:"flex flex-col sm:flex-row gap-4 items-center justify-center"},NU={class:"seasons-section py-16"},OU={class:"container mx-auto px-4"},VU=["aria-busy"],MU={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center animate-pulse"},LU={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center"},$U=["onClick"],FU={class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg overflow-hidden"},UU=["src","alt"],jU={key:1,class:"text-2xl"},BU={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},qU={key:0,class:"text-gray-300 text-sm mb-4 line-clamp-2 leading-relaxed"},zU={class:"flex justify-center gap-6 text-sm"},HU={class:"text-center"},KU={class:"text-white font-semibold"},GU={class:"text-center"},WU={class:"text-white font-semibold"},QU={class:"absolute top-4 right-4"},JU=["onClick","aria-expanded"],YU={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},XU=["onClick"],ZU=["onClick"],e5=["onClick"],t5=["onClick"],n5=["onClick"],r5={class:"text-center mt-12"},s5={key:2,class:"text-center py-16"},i5={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},o5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},a5={class:"mb-6"},l5={class:"mb-6"},u5={class:"mb-6"},c5={class:"mb-6"},d5={class:"flex justify-end space-x-3"},h5=["disabled"],f5={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},p5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},m5={class:"text-center mb-6"},g5={class:"text-gray-300"},v5={key:2,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},y5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},_5={class:"text-center mb-6"},b5={class:"text-gray-300"},w5={class:"mb-6"},x5={class:"mb-6"},I5={class:"mb-6"},E5={key:0,class:"mb-4 text-center"},T5={class:"w-20 h-20 mx-auto mb-3 rounded-full overflow-hidden border-2 border-white/20"},A5=["src","alt"],S5=["disabled"],P5={key:0,class:"text-2xl mb-2 animate-spin"},R5={key:1,class:"text-2xl mb-2"},C5={class:"text-sm"},k5={key:0},D5={key:1},N5={key:2},O5={key:2,class:"text-xs text-gray-400 mt-1"},V5={class:"flex justify-end space-x-3"},M5=["disabled"],L5={key:0,class:"flex items-center gap-2"},$5={key:1},F5={__name:"Seasons",setup(n){const e=S([]),t=S(!0),r=da(),s=S(null),i=S(!1),o=S(!1),a=S(!1),l=S(""),c=S(""),h=S(""),f=S(""),g=S(""),v=S(""),x=S(null),w=S(""),I=S(null),$=S(null),L=S(!1),U=S(!1),q=S(null),te=S(""),X=S(!1),A=S(!1),b=S(!1),T=S(!1),k=S(!1);Tn(async()=>{var j,be;try{N.info("Début du chargement des saisons"),iy("firebase"),N.info("Mode de stockage défini sur Firebase"),await p1(),N.info("Stockage initialisé"),N.info("Attente de l'initialisation du service d'authentification...");try{J$(),await zA(),N.info("Service d'authentification initialisé")}catch(Le){N.warn("Service d'authentification non initialisé, continuation sans authentification:",Le.message||"Erreur inconnue")}try{pl(),N.info("Synchronisation forcée effectuée")}catch(Le){N.warn("Erreur lors de la synchronisation forcée:",Le)}N.info("Chargement des saisons...");try{e.value=await el(),N.info("Saisons chargées",{count:((j=e.value)==null?void 0:j.length)||0})}catch(Le){throw N.error("Erreur lors du chargement des saisons:",Le),Le}if(e.value.length>0){N.info("Chargement des données des saisons...");const Le=await Promise.all(e.value.map(async Je=>{try{N.debug(`Chargement des données pour la saison: ${Je.name} (ID: ${Je.id})`);let ze,It;try{ze=await Uh(Je.id),N.debug(`Événements chargés pour ${Je.name}:`,ze)}catch(yt){N.warn(`Erreur lors du chargement des événements pour ${Je.name}:`,yt),ze=[]}try{It=await rc(Je.id),N.debug(`Joueurs chargés pour ${Je.name}:`,It)}catch(yt){N.warn(`Erreur lors du chargement des joueurs pour ${Je.name}:`,yt),It=[]}return N.debug(`Saison ${Je.name}: ${(ze==null?void 0:ze.length)||0} événements, ${(It==null?void 0:It.length)||0} joueurs`),{...Je,events:ze||[],players:It||[]}}catch(ze){return N.warn(`Erreur lors du chargement des données pour la saison ${Je.id}:`,ze),{...Je,events:[],players:[]}}}));e.value=Le,N.info("Données des saisons chargées",{count:e.value.length}),e.value.forEach(Je=>{var ze,It;N.info(`Saison finale ${Je.name}: ${((ze=Je.events)==null?void 0:ze.length)||0} événements, ${((It=Je.players)==null?void 0:It.length)||0} joueurs`)})}Ne().catch(Le=>N.error("Migration sortOrder échouée",Le))}catch(Le){N.error("Erreur lors du chargement initial des saisons:",Le),N.error("Stack trace:",Le.stack);try{N.info("Tentative de fallback pour charger les saisons..."),e.value=await el(),N.info("Saisons chargées en fallback",{count:((be=e.value)==null?void 0:be.length)||0})}catch(Je){N.error("Échec du fallback pour charger les saisons:",Je)}}finally{t.value=!1,N.info("Chargement terminé, isLoading = false")}const se=()=>{k.value=window.scrollY>10};return window.addEventListener("scroll",se,{passive:!0}),()=>{window.removeEventListener("scroll",se)}});const F=qe(()=>[...e.value].sort((se,j)=>{var It,yt;const be=typeof se.sortOrder=="number"?se.sortOrder:Number.MAX_SAFE_INTEGER,Le=typeof j.sortOrder=="number"?j.sortOrder:Number.MAX_SAFE_INTEGER;if(be!==Le)return be-Le;const Je=(It=se.createdAt)!=null&&It.toMillis?se.createdAt.toMillis():0,ze=(yt=j.createdAt)!=null&&yt.toMillis?j.createdAt.toMillis():0;return Je!==ze?ze-Je:(se.name||"").localeCompare(j.name||"")}));function M(se){r.push(`/season/${se}`)}function R(se){s.value=s.value===se?null:se}function Ke(){s.value=null}function ct(se){$.value=se,g.value=se.name,v.value=se.description||"",x.value=null,w.value=se.logoUrl||"",a.value=!0,Ke()}function dt(){a.value=!1,$.value=null,g.value="",v.value="",x.value=null,w.value="",L.value=!1}async function Ge(){a.value=!1,await fe({type:"editSeason",data:{seasonId:$.value.id,seasonName:$.value.name,newName:g.value.trim(),newDescription:v.value.trim(),newLogo:x.value,newLogoPreview:w.value,oldName:$.value.name,oldDescription:$.value.description||"",oldLogoUrl:$.value.logoUrl||""}})}function Ae(){const se=document.querySelector(".help-section");se&&se.scrollIntoView({behavior:"smooth"})}function he(){const se=document.querySelector(".seasons-section");se&&se.scrollIntoView({behavior:"smooth"})}function Qe(se){const j=se.target.files[0];if(j){x.value=j,L.value=!0;const be=new FileReader;be.onload=Le=>{w.value=Le.target.result,L.value=!1},be.onerror=()=>{L.value=!1},be.readAsDataURL(j)}}function le(){console.log("removeLogo appelé"),x.value=null,w.value="",console.log("Logo supprimé")}function re(){const se=document.querySelector('input[type="file"][accept="image/*"]');se?se.click():console.error("Input file non trouvé pour triggerLogoUpload")}async function Ne(){if(!e.value.length)return;const se=e.value.map(be=>typeof be.sortOrder=="number"?be.sortOrder:null).filter(be=>be!==null);let j=se.length?Math.max(...se):0;for(const be of e.value)if(typeof be.sortOrder!="number"){j+=1;try{await Cu(be.id,j),be.sortOrder=j}catch(Le){N.error("Erreur migration sortOrder",{seasonName:be==null?void 0:be.name,error:Le})}}}async function ht(se){try{if(!(se!=null&&se.id)){alert("Saison introuvable");return}const[j,be]=await Promise.all([Uh(se.id),rc(se.id)]),[Le,Je]=await Promise.all([Vo(be,j,se.id),Mo(se.id)]),ze=["Joueur",...j.map(Zn=>tn(Zn))],It=[];for(const Zn of be){const er=(Zn==null?void 0:Zn.name)||"",bn=(Le==null?void 0:Le[er])||{},yo=[er,...j.map(ms=>nt(bn[ms.id],Je==null?void 0:Je[ms.id],er))];It.push(yo)}const yt=xe([ze,...It]),Ut=new Blob(["\uFEFF"+yt],{type:"text/csv;charset=utf-8;"}),Rn=(se==null?void 0:se.name)||(se==null?void 0:se.slug)||"saison",Xn=`${Pe(Rn)}-disponibilites.csv`,ot=URL.createObjectURL(Ut),Rt=document.createElement("a");Rt.href=ot,Rt.download=Xn,document.body.appendChild(Rt),Rt.click(),document.body.removeChild(Rt),URL.revokeObjectURL(ot),N.info("Export CSV saison",{seasonId:se.id,events:j.length,players:be.length})}catch(j){N.error("Erreur export CSV",j),alert("Erreur lors de l'export CSV. Veuillez réessayer.")}}function Pt(se){if(!se)return null;if(se instanceof Date)return se;if(typeof(se==null?void 0:se.toDate)=="function")return se.toDate();if(typeof se=="string"||typeof se=="number"){const j=new Date(se);return isNaN(j.getTime())?null:j}return null}function tn(se){const j=Pt(se==null?void 0:se.date),be=j?`${j.getFullYear()}-${String(j.getMonth()+1).padStart(2,"0")}-${String(j.getDate()).padStart(2,"0")}`:"",Le=(se==null?void 0:se.title)||"Sans titre";return`${be} · ${Le}`.trim()}function Y(se){return se===!0||se==="oui"?"disponible":se===!1||se==="non"?"non disponible":""}function xe(se){return se.map(j=>j.map(ve).join(",")).join(`
`)}function ve(se){const j=String(se??"");return/[",\n\r]/.test(j)?'"'+j.replace(/"/g,'""')+'"':j}function Pe(se){return String(se||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9\-_. ]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$|^\.+|\.+$/g,"")||"fichier"}function nt(se,j,be){return Array.isArray(j)&&j.includes(be)?se===!1||se==="non"?"non disponible":"sélectionné":Y(se)}async function vt(se){if(Ke(),se<=0)return;const j=[...F.value],be=j[se],Le=j[se-1],Je=be.sortOrder;be.sortOrder=Le.sortOrder,Le.sortOrder=Je;try{await Promise.all([Cu(be.id,be.sortOrder),Cu(Le.id,Le.sortOrder)])}catch(ze){N.error("Erreur lors du déplacement vers le haut",ze)}}async function P(se){Ke();const j=[...F.value];if(se>=j.length-1)return;const be=j[se],Le=j[se+1],Je=be.sortOrder;be.sortOrder=Le.sortOrder,Le.sortOrder=Je;try{await Promise.all([Cu(be.id,be.sortOrder),Cu(Le.id,Le.sortOrder)])}catch(ze){N.error("Erreur lors du déplacement vers le bas",ze)}}function V(){l.value&&(c.value=l.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function H(){f.value=f.value.replace(/[^0-9]/g,""),f.value.length>4&&(f.value=f.value.slice(0,4))}async function K(){if(!l.value.trim()||!c.value.trim()||!f.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(f.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await B$(l.value.trim(),c.value.trim(),f.value.trim(),h.value.trim(),""),e.value=await el(),await Ne(),Z()}catch(se){N.error("Erreur lors de la création de la saison",se),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function Z(){i.value=!1,l.value="",c.value="",h.value="",f.value=""}function ue(se){I.value=se,o.value=!0}async function ge(){o.value=!1,await fe({type:"deleteSeason",data:{seasonId:I.value.id,seasonName:I.value.name}})}function me(){o.value=!1,I.value=null}function ye(){return q.value?{deleteSeason:"Suppression de saison - Code PIN requis",editSeason:"Modification de saison - Code PIN requis"}[q.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function fe(se){const j=se.type==="editSeason"?se.data.seasonId:I.value.id;if(Hn.isPinCached(j)){const be=Hn.getCachedPin(j);if(N.debug("PIN en cache trouvé, utilisation automatique"),await Mh(j,be)){await Fe(se);return}else Hn.clearSession()}q.value=se,U.value=!0}async function Ve(se){var j,be,Le,Je;N.debug("PIN soumis pour l'opération",{operationType:(j=q.value)==null?void 0:j.type});try{const ze=((Le=(be=q.value)==null?void 0:be.data)==null?void 0:Le.seasonId)||((Je=I.value)==null?void 0:Je.id),It=await Mh(ze,se);if(N.debug("PIN validé",{valid:It}),It){Hn.saveSession(ze,se),N.debug("PIN correct, fermeture de la modal et exécution de l'opération"),U.value=!1;const yt=q.value;q.value=null,N.debug("Appel de executePendingOperation",{operationType:yt==null?void 0:yt.type}),await Fe(yt)}else te.value="Code PIN incorrect",setTimeout(()=>{te.value=""},3e3)}catch(ze){N.error("Erreur lors de la vérification du PIN",ze),te.value="Erreur lors de la vérification du code PIN"}}function Te(){U.value=!1,q.value=null,te.value=""}function ke(){return I.value&&Hn.isPinCached(I.value.id)?{timeRemaining:Hn.getTimeRemaining(),isExpiringSoon:Hn.isExpiringSoon()}:null}async function Fe(se){var Le;if(N.debug("executePendingOperation appelé",{hasOperation:!!se}),!se){N.warn("Aucune opération à exécuter");return}const{type:j,data:be}=se;N.info("Exécution de l'opération",{type:j});try{switch(j){case"deleteSeason":N.info("Suppression de la saison",{seasonId:be.seasonId}),await q$(be.seasonId),N.info("Saison supprimée, rechargement de la liste"),e.value=await el(),N.info("Liste des saisons rechargée",{count:((Le=e.value)==null?void 0:Le.length)||0});break;case"editSeason":N.info("Modification de la saison",{seasonId:be.seasonId});const Je=be.newName!==be.oldName,ze=be.newDescription!==be.oldDescription,It=be.newLogo!==null;if(!Je&&!ze&&!It){N.info("Aucun changement détecté, opération annulée");return}const yt={};if(be.newName!==be.oldName&&(yt.name=be.newName),be.newDescription!==be.oldDescription&&(yt.description=be.newDescription),be.newLogo)try{L.value=!0,N.info("Upload du nouveau logo...");const Rn=await rF(be.newLogo,`season-logos/${be.seasonId}`,{resize:!0,maxWidth:64,maxHeight:64,quality:.6});if(yt.logoUrl=Rn,be.oldLogoUrl&&oF(be.oldLogoUrl))try{await iF(be.oldLogoUrl),N.info("Ancien logo supprimé")}catch(Xn){N.warn("Erreur lors de la suppression de l'ancien logo:",Xn)}}catch(Rn){throw N.error("Erreur lors de l'upload du logo:",Rn),new Error("Erreur lors de l'upload du logo: "+Rn.message)}finally{L.value=!1}await z$(be.seasonId,yt);const Ut=e.value.findIndex(Rn=>Rn.id===be.seasonId);Ut!==-1&&(yt.name&&(e.value[Ut].name=be.newName),yt.description!==void 0&&(e.value[Ut].description=be.newDescription),yt.logoUrl&&(e.value[Ut].logoUrl=yt.logoUrl)),N.info("Saison modifiée avec succès",{seasonId:be.seasonId,oldName:be.oldName,newName:be.newName,oldDescription:be.oldDescription,newDescription:be.newDescription});break;default:N.warn("Type d'opération non reconnu",{type:j})}}catch(Je){N.error("Erreur lors de l'exécution de l'opération",Je),alert("Erreur lors de l'opération. Veuillez réessayer.")}}function Ue(){X.value=!0}function We(){X.value=!1}function rt(){X.value=!1,vi()}function nn(){A.value=!0}function Bt(){A.value=!1}function On(){b.value=!0}function Jt(){b.value=!1}function Kr(){T.value=!0}function Vs(){T.value=!1}function _n(){N.debug("Gestion de joueur demandée")}async function Pn(){try{await je.signOut(),A.value=!1,N.info("Utilisateur déconnecté avec succès")}catch(se){N.error("Erreur lors de la déconnexion",se),alert("Erreur lors de la déconnexion. Veuillez réessayer.")}}async function vi(){try{const se=await qA();if(se){r.push(`/season/${se}`);return}}catch(se){N.warn("Impossible de récupérer la saison préférée",se)}he()}return Tn(()=>(pl(),()=>{})),kt(()=>r.currentRoute.value.path,async se=>{var j;if(se==="/"&&(pl(),e.value.length===0&&!t.value)){t.value=!0;try{e.value=await el(),N.info("Saisons rechargées lors du changement de route",{count:((j=e.value)==null?void 0:j.length)||0})}catch(be){N.error("Erreur lors du rechargement des saisons",be)}finally{t.value=!1}}},{immediate:!0}),(se,j)=>{var be,Le,Je,ze,It,yt,Ut,Rn,Xn;return C(),D("div",TU,[Be($6,{"is-scrolled":k.value,onOpenAccountMenu:nn,onOpenHelp:Ae,onOpenNotifications:On,onOpenPlayers:Kr,onLogout:Pn,onOpenLogin:Ue},null,8,["is-scrolled"]),d("section",AU,[d("div",SU,[d("div",PU,[d("div",RU,[j[13]||(j[13]=or('<div class="text-center order-2 lg:order-1"><div class="hero-content-wrapper"><div class="hero-illustration relative hidden lg:block"><div class="relative mx-auto lg:mx-0 w-full max-w-lg"><div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-4 shadow-2xl border border-white/10 relative overflow-hidden"><div class="absolute inset-0 bg-gradient-to-br from-pink-500/10 via-purple-500/10 to-cyan-500/10 rounded-3xl blur-xl"></div><div class="relative z-10"><div class="flex items-center gap-3 mb-4"><div class="flex gap-2"><div class="w-3 h-3 bg-red-500 rounded-full"></div><div class="w-3 h-3 bg-yellow-500 rounded-full"></div><div class="w-3 h-3 bg-green-500 rounded-full"></div></div><div class="text-gray-400 text-sm">HatCast - Grille des disponibilités</div></div></div><div class="bg-gray-700 rounded-2xl p-4 min-h-[300px]"><div class="grid grid-cols-4 gap-2 mb-4"><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">15 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">22 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">29 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">5 Fév</div></div><div class="space-y-2"><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Marie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-gray-500/20 border border-gray-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Pierre</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Sophie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div></div></div></div></div><div class="absolute -top-4 -right-4 w-20 h-20 bg-gradient-to-r from-pink-400 to-purple-500 rounded-2xl shadow-xl transform rotate-12 z-30"></div><div class="absolute -bottom-4 -left-4 w-16 h-16 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-2xl shadow-xl transform -rotate-12 z-30 flex items-center justify-center"><img src="'+tF+'" alt="Masque HatCast" class="w-10 h-10 object-contain transform rotate-12"></div></div></div></div>',1)),d("div",CU,[j[12]||(j[12]=or('<div class="hero-title mb-8"><h1 class="text-4xl md:text-6xl font-bold text-white mb-6 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent leading-tight"> Faites vos équipes d&#39;impro…<br>en un clin d&#39;œil </h1></div><div class="hero-subtitle mb-10"><p class="text-xl md:text-2xl text-gray-300 leading-relaxed max-w-2xl"> Plus de casse-tête pour savoir qui joue quand. Chacun indique ses dispos, <strong class="text-white">HatCast compose l&#39;équipe pour vous</strong>, équitablement et sans tension. </p></div>',2)),d("div",kU,[d("div",DU,[d("button",{onClick:j[0]||(j[0]=ot=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-5 px-10 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105 text-lg md:text-xl"}," 🚀 Démarrez "),d("button",{onClick:Ae,class:"inline-flex items-center gap-2 text-cyan-300 hover:text-cyan-200 font-medium py-3 px-6 rounded-lg hover:bg-cyan-500/10 transition-all duration-300 border border-cyan-500/30 hover:border-cyan-400/50"},j[10]||(j[10]=[d("span",null,"ℹ️",-1),ut(" En savoir plus ")]))])]),d("div",{class:"hero-hint text-center"},[d("button",{onClick:he,class:"inline-flex items-center gap-2 text-gray-400 hover:text-cyan-300 transition-all duration-300 text-sm cursor-pointer group"},j[11]||(j[11]=[d("span",{class:"group-hover:animate-bounce"},"↓",-1),d("span",null,"Vos saisons ci-dessous",-1),d("span",{class:"group-hover:animate-bounce"},"↓",-1)]))])])])])]),j[14]||(j[14]=d("div",{class:"hero-background absolute inset-0 z-0"},[d("div",{class:"absolute top-20 left-10 w-32 h-32 bg-pink-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute bottom-20 right-10 w-40 h-40 bg-purple-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-cyan-500/5 rounded-full blur-3xl"})],-1))]),d("section",NU,[d("div",OU,[j[32]||(j[32]=d("div",{class:"text-center mb-12"},[d("h2",{class:"text-3xl md:text-4xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"}," Saisons en cours "),d("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto"}," Sélectionnez une saison pour gérer les disponibilités et équipes. ")],-1)),d("div",{class:"pb-16","aria-busy":t.value},[t.value?(C(),D("div",MU,[(C(),D(mt,null,jr(8,ot=>d("div",{key:"skeleton-"+ot,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8 w-full max-w-sm"},j[15]||(j[15]=[d("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),d("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),d("div",{class:"h-px bg-white/10 mb-4"},null,-1),d("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(C(),D("div",LU,[(C(!0),D(mt,null,jr(F.value,(ot,Rt)=>{var Zn,er;return C(),D("div",{key:ot.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20 w-full max-w-sm"},[d("div",{onClick:bn=>M(ot.slug),class:"text-center cursor-pointer"},[d("div",FU,[ot.logoUrl?(C(),D("img",{key:0,src:ot.logoUrl,alt:`Logo de ${ot.name}`,class:"w-full h-full object-cover"},null,8,UU)):(C(),D("span",jU,"🎭"))]),d("h2",BU,ee(ot.name),1),ot.description?(C(),D("p",qU,ee(ot.description),1)):ie("",!0),j[18]||(j[18]=d("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),d("div",zU,[d("div",HU,[d("div",KU,ee(((Zn=ot.events)==null?void 0:Zn.length)||0),1),j[16]||(j[16]=d("div",{class:"text-gray-400 text-xs"},"Événements",-1))]),d("div",GU,[d("div",WU,ee(((er=ot.players)==null?void 0:er.length)||0),1),j[17]||(j[17]=d("div",{class:"text-gray-400 text-xs"},"Joueurs",-1))])])],8,$U),d("div",QU,[d("div",{class:"relative",onClick:j[1]||(j[1]=ft(()=>{},["stop"]))},[d("button",{onClick:bn=>R(Rt),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===Rt,"aria-haspopup":"true",title:"Options"},j[19]||(j[19]=[d("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,JU),s.value===Rt?(C(),D("div",YU,[d("button",{onClick:bn=>{ht(ot),Ke()},class:"w-full text-left px-4 py-2 text-sm text-emerald-300 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},j[20]||(j[20]=[d("span",null,"📊",-1),ut(" Exporter CSV ")]),8,XU),j[25]||(j[25]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:bn=>vt(Rt),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},j[21]||(j[21]=[d("span",null,"⬆️",-1),ut(" Avancer ")]),8,ZU),d("button",{onClick:bn=>P(Rt),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},j[22]||(j[22]=[d("span",null,"⬇️",-1),ut(" Reculer ")]),8,e5),j[26]||(j[26]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:bn=>ct(ot),class:"w-full text-left px-4 py-2 text-sm text-blue-300 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},j[23]||(j[23]=[d("span",null,"✏️",-1),ut(" Modifier ")]),8,t5),j[27]||(j[27]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:bn=>ue(ot),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2",role:"menuitem"},j[24]||(j[24]=[d("span",null,"🗑️",-1),ut(" Supprimer ")]),8,n5)])):ie("",!0)])])])}),128))])):ie("",!0),d("div",r5,[d("button",{onClick:j[2]||(j[2]=ot=>i.value=!0),class:"inline-flex items-center gap-3 bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-semibold py-4 px-8 rounded-xl text-lg hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-pink-500/25"},j[28]||(j[28]=[d("span",null,"➕",-1),ut(" Nouvelle saison ")]))]),!t.value&&e.value.length===0?(C(),D("div",s5,[j[29]||(j[29]=d("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-4xl"},"🎪")],-1)),j[30]||(j[30]=d("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),j[31]||(j[31]=d("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),d("button",{onClick:j[3]||(j[3]=ot=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):ie("",!0)],8,VU)])]),i.value?(C(),D("div",i5,[d("div",o5,[j[39]||(j[39]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),d("div",a5,[j[33]||(j[33]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),st(d("input",{"onUpdate:modelValue":j[4]||(j[4]=ot=>l.value=ot),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:V},null,544),[[Lt,l.value]])]),d("div",l5,[j[34]||(j[34]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),st(d("input",{"onUpdate:modelValue":j[5]||(j[5]=ot=>c.value=ot),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[Lt,c.value]])]),d("div",u5,[j[35]||(j[35]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description (optionnel)",-1)),st(d("textarea",{"onUpdate:modelValue":j[6]||(j[6]=ot=>h.value=ot),rows:"3",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",placeholder:"Ex: Saison 2025-2026 de la troupe d'improvisation La Malice"},null,512),[[Lt,h.value]]),j[36]||(j[36]=d("p",{class:"text-xs text-gray-400 mt-1"},"Une brève description de votre saison",-1))]),d("div",c5,[j[37]||(j[37]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),st(d("input",{"onUpdate:modelValue":j[7]||(j[7]=ot=>f.value=ot),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:H},null,544),[[Lt,f.value]]),j[38]||(j[38]=d("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),d("div",d5,[d("button",{onClick:Z,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:K,disabled:!l.value.trim()||!c.value.trim()||!f.value.trim()||f.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,h5)])])])):ie("",!0),o.value?(C(),D("div",f5,[d("div",p5,[d("div",m5,[j[40]||(j[40]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"⚠️")],-1)),j[41]||(j[41]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",g5,'Êtes-vous sûr de vouloir supprimer la saison "'+ee((be=I.value)==null?void 0:be.name)+'" ?',1)]),j[42]||(j[42]=d("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:me,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:ge,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ie("",!0),a.value?(C(),D("div",v5,[d("div",y5,[d("div",_5,[j[43]||(j[43]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"✏️")],-1)),j[44]||(j[44]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Modifier la saison",-1)),d("p",b5,'Modifiez les informations de la saison "'+ee((Le=$.value)==null?void 0:Le.name)+'"',1)]),d("div",w5,[j[45]||(j[45]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),st(d("input",{"onUpdate:modelValue":j[8]||(j[8]=ot=>g.value=ot),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026"},null,512),[[Lt,g.value]])]),d("div",x5,[j[46]||(j[46]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description (optionnel)",-1)),st(d("textarea",{"onUpdate:modelValue":j[9]||(j[9]=ot=>v.value=ot),rows:"3",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400 resize-none",placeholder:"Ex: Saison 2025-2026 de la troupe d'improvisation La Malice"},null,512),[[Lt,v.value]])]),d("div",I5,[j[47]||(j[47]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Logo de la troupe (optionnel)",-1)),w.value||(Je=$.value)!=null&&Je.logoUrl?(C(),D("div",E5,[d("div",T5,[d("img",{src:w.value||((ze=$.value)==null?void 0:ze.logoUrl),alt:`Logo de ${(It=$.value)==null?void 0:It.name}`,class:"w-full h-full object-cover"},null,8,A5)]),w.value||(yt=$.value)!=null&&yt.logoUrl?(C(),D("button",{key:0,onClick:le,type:"button",class:"text-xs text-red-400 hover:text-red-300 transition-colors"}," Supprimer le logo ")):ie("",!0)])):ie("",!0),d("div",{class:cn(["border-2 border-dashed rounded-lg p-6 text-center transition-all duration-300",L.value?"border-blue-500 bg-blue-900/20 animate-pulse":"border-gray-600 hover:border-gray-500"])},[d("input",{ref:"logoFileInput",type:"file",accept:"image/*",onChange:Qe,class:"hidden"},null,544),d("button",{onClick:re,type:"button",disabled:L.value,class:"text-gray-300 hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[L.value?(C(),D("div",P5,"⏳")):(C(),D("div",R5,"📷")),d("div",C5,[L.value?(C(),D("span",k5," Upload en cours... ")):!w.value&&!((Ut=$.value)!=null&&Ut.logoUrl)?(C(),D("span",D5," Cliquez pour ajouter un logo ")):(C(),D("span",N5," Cliquez pour changer le logo "))]),L.value?ie("",!0):(C(),D("div",O5," PNG, JPG, GIF (max 5MB) "))],8,S5)],2)]),j[49]||(j[49]=d("p",{class:"mb-6 text-sm text-blue-400 bg-blue-900/20 p-3 rounded-lg border border-blue-500/20"}," ℹ️ Le slug de l'URL restera inchangé pour préserver les liens existants. ",-1)),d("div",V5,[d("button",{onClick:dt,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Ge,disabled:!g.value.trim()||g.value.trim()===((Rn=$.value)==null?void 0:Rn.name)&&v.value===(((Xn=$.value)==null?void 0:Xn.description)||"")&&!x.value||L.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"},[L.value?(C(),D("span",L5,j[48]||(j[48]=[d("span",{class:"animate-spin"},"⏳",-1),ut(" Upload en cours... ")]))):(C(),D("span",$5,"Modifier"))],8,M5)])])])):ie("",!0),Be(KA,{show:U.value,message:ye(),error:te.value,"session-info":ke(),onSubmit:Ve,onCancel:Te},null,8,["show","message","error","session-info"]),j[50]||(j[50]=or('<section class="help-section py-20 bg-gradient-to-br from-gray-900/50 to-gray-800/50 border-t border-white/10"><div class="container mx-auto px-4"><div class="max-w-6xl mx-auto"><div class="text-center mb-16"><h2 class="text-4xl md:text-5xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"> Qu&#39;est-ce que HatCast ? </h2><p class="text-xl text-purple-300 max-w-3xl mx-auto"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête </p></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16"><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-pink-500/20 to-purple-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-pink-500/30"><span class="text-4xl">🎭</span></div><h3 class="text-xl font-bold text-white mb-3">Gestion des saisons</h3><p class="text-gray-300 text-sm leading-relaxed"> Déclarez tous vos spectacles et indiquez combien de joueurs vous aurez besoin. Organisez votre saison d&#39;impro de A à Z. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-purple-500/20 to-cyan-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-purple-500/30"><span class="text-4xl">📅</span></div><h3 class="text-xl font-bold text-white mb-3">Sondage de disponibilités</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez des sondages pour vos événements. Chaque joueur indique ses disponibilités et HatCast optimise la composition des équipes. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-cyan-500/20 to-pink-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-cyan-500/30"><span class="text-4xl">🎲</span></div><h3 class="text-xl font-bold text-white mb-3">Sélection auto ou manuelle</h3><p class="text-gray-300 text-sm leading-relaxed"> Laissez le hasard pondéré décider ou reprenez la main à tout moment. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-green-500/20 to-blue-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-green-500/30"><span class="text-4xl">📱</span></div><h3 class="text-xl font-bold text-white mb-3">Pensé pour le mobile</h3><p class="text-gray-300 text-sm leading-relaxed"> Utilisez HatCast facilement sur smartphone ou tablette, où que vous soyez. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-blue-500/20 to-indigo-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-blue-500/30"><span class="text-4xl">🔐</span></div><h3 class="text-xl font-bold text-white mb-3">Comptes facultatifs</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez un compte pour recevoir des rappels et sécuriser vos infos. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-emerald-500/20 to-teal-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-emerald-500/30"><span class="text-4xl">🔔</span></div><h3 class="text-xl font-bold text-white mb-3">Notifications intelligentes</h3><p class="text-gray-300 text-sm leading-relaxed"> Recevez des alertes par email et push pour les événements et sélections. Restez informé sans être submergé. </p></div></div></div></div></section><footer class="border-t border-white/10 bg-gradient-to-br from-gray-950 to-black"><div class="container mx-auto px-4 py-12"><div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8"><div><div class="flex items-center gap-3 mb-4"><div class="relative w-32 h-8"><img src="'+$m+'" alt="Logo HatCast" class="w-full h-full brightness-0 invert"></div></div><p class="text-gray-300 text-sm leading-relaxed max-w-md"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête. </p></div><div><h4 class="text-white font-semibold mb-4 text-sm uppercase tracking-wider">Feedback</h4><div class="space-y-2"><a href="https://github.com/plamarque/hatcast/issues" target="_blank" rel="noopener noreferrer" class="block text-gray-300 hover:text-blue-300 transition-colors text-sm"> 🐛 Signaler un bug </a><a href="https://github.com/plamarque/hatcast" target="_blank" rel="noopener noreferrer" class="block text-gray-300 hover:text-blue-300 transition-colors text-sm"> 🔗 Code source </a></div></div></div><div class="text-center text-xs text-gray-500 pt-6"><span>© Patrice Lamarque 2025</span></div></div></footer>',2)),Be(GA,{show:X.value,onClose:We,onSuccess:rt},null,8,["show"]),Be(d1,{show:A.value,onClose:Bt,onLogoutDevice:Pn},null,8,["show"]),Be(h1,{show:b.value,onClose:Jt},null,8,["show"]),Be(f1,{show:T.value,onClose:Vs,onManagePlayer:_n},null,8,["show"])])}}};function U5({reason:n,recipientName:e,eventTitle:t,eventDate:r,urls:s={},prefs:i={},extra:o={}}){var l,c;const a={email:null,push:null};if(n==="availability_request"||n==="availability_reminder"){const h=(i==null?void 0:i.notifyAvailability)!==!1,f=(i==null?void 0:i.notifyAvailabilityPush)!==!1;a.email={enabled:h,subject:n==="availability_reminder"?`Rappel disponibilité · ${t} (${r})`:`Disponibilité demandée · ${t} (${r})`},a.push={enabled:f,title:n==="availability_reminder"?"⏰ Rappel disponibilité":"🎯 Nouveau spectacle !",body:n==="availability_reminder"?`${e}, ${t} (${r})`:`🎭 On a besoin de toi pour ${t} le ${r} !`,data:{url:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,reason:n}},console.log("URLs pour notifications de disponibilité:",{eventUrl:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,urls:s})}if(n==="selection"){const h=(i==null?void 0:i.notifySelection)!==!1,f=(i==null?void 0:i.notifySelectionPush)!==!1;a.email={enabled:h,subject:`🎭 Equipe pour ${t}`},a.push={enabled:f,title:"🎭 Tu es sélectionné(e) !",body:`🕺 Prépares-toi à briller pour ${t} le ${r}!`,data:{url:s.eventUrl,noUrl:s.noUrl,reason:n}},console.log("URLs pour notifications de sélection:",{eventUrl:s.eventUrl,noUrl:s.noUrl,urls:s})}return console.log("buildNotificationPayloads",{reason:n,recipientName:e,prefs:i,payloads:a,emailEnabled:(l=a.email)==null?void 0:l.enabled,pushEnabled:(c=a.push)==null?void 0:c.enabled}),a}async function j5({reason:n,recipientEmail:e,recipientName:t,eventTitle:r,eventDate:s,urls:i={},extra:o={}}){var g;if(!e)return{success:!1,skipped:!0,reason:"missing_email"};const a=await Kt(_e(ne,"userPreferences",e)).catch(()=>null),l=a!=null&&a.exists()?a.data():{},c=U5({reason:n,recipientName:t,eventTitle:r,eventDate:s,urls:i,prefs:l,extra:o}),h=[];return c.email&&c.email.enabled&&(n==="availability_request"||n==="availability_reminder"?await jF({toEmail:e,playerName:t,eventTitle:r,eventDate:s,yesUrl:i.yesUrl,noUrl:i.noUrl,eventUrl:i.eventUrl,reason:n==="availability_reminder"?"reminder":"new_event"}).then(()=>h.push({channel:"email",success:!0})).catch(v=>{N.error("notifyRecipientAcrossChannels email error",v),h.push({channel:"email",success:!1})}):n==="selection"&&h.push({channel:"email",success:!0,skipped:!0,note:"batch_handled_elsewhere"})),c.push&&c.push.enabled?(N.debug("Envoi notification push",{reason:n,recipientEmail:e,title:c.push.title,body:c.push.body}),await ad({toEmail:e,title:c.push.title,body:c.push.body,data:c.push.data||{},reason:n}).then(()=>{N.info("Notification push envoyée avec succès",{reason:n,recipientEmail:e}),h.push({channel:"push",success:!0})}).catch(v=>{N.error("notifyRecipientAcrossChannels push error",v),h.push({channel:"push",success:!1})})):N.debug("Notification push désactivée ou non configurée",{reason:n,recipientEmail:e,hasPayload:!!c.push,enabled:(g=c.push)==null?void 0:g.enabled,prefs:l}),{success:h.some(v=>v.success),results:h}}async function Hb({eventId:n,eventData:e,players:t,seasonId:r,seasonSlug:s,createMagicLink:i,reminder:o=!1,getAvailabilityForEvent:a=null}){const l=[],c=`${window.location.origin}/season/${s}/event/${n}`;for(const h of t)try{if(o&&typeof a=="function"){const v=await Promise.resolve(a(h.name,n));if(v===!0||v===!1)continue}const f={};if(typeof i=="function"){const v=await i({seasonId:r,playerId:h.id,eventId:n,action:"yes"}),x=await i({seasonId:r,playerId:h.id,eventId:n,action:"no"});f.yesUrl=`${v.url}&slug=${encodeURIComponent(s)}`,f.noUrl=`${x.url}&slug=${encodeURIComponent(s)}`}f.eventUrl=c,(await j5({reason:o?"availability_reminder":"availability_request",recipientEmail:h.email,recipientName:h.name,eventTitle:e.title,eventDate:B5(e.date),urls:f})).success||l.push(h.id)}catch{l.push(h.id)}return{success:!0,failures:l}}async function Kb(n){return HF(n)}function B5(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function q5(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//HatCast//Calendar Event//FR","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${n.id}@impropick.com`,`DTSTAMP:${new Date().toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTSTART:${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTEND:${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`SUMMARY:${n.title}`,`DESCRIPTION:${n.description||""}${e?`\\n\\nSaison : ${e}`:""}`,"STATUS:CONFIRMED","SEQUENCE:0","BEGIN:VALARM","TRIGGER:-PT1H","ACTION:DISPLAY",`DESCRIPTION:Rappel : ${n.title}`,"END:VALARM","END:VEVENT","END:VCALENDAR"].join(`\r
`)}function z5(n,e=""){const t=q5(n,e),r=new Blob([t],{type:"text/calendar;charset=utf-8"}),s=URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=`${n.title.replace(/[^a-z0-9]/gi,"_")}_${n.date}.ics`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}function H5(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://calendar.google.com/calendar/render?${new URLSearchParams({action:"TEMPLATE",text:n.title,dates:`${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z/${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,details:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"HatCast",sf:"true",output:"xml"}).toString()}`}function K5(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://outlook.live.com/calendar/0/deeplink/compose?${new URLSearchParams({subject:n.title,startdt:r.toISOString(),enddt:s.toISOString(),body:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"HatCast",allday:"false"}).toString()}`}function G5(n,e=""){const t=H5(n,e);window.open(t,"_blank")}function W5(n,e=""){const t=K5(n,e);window.open(t,"_blank")}function Q5(n,e,t=""){switch(n){case"ics":z5(e,t);break;case"google":G5(e,t);break;case"outlook":W5(e,t);break;default:console.warn("Type de calendrier non supporté:",n)}}function g1(){const n=!!localStorage.getItem("fcmToken")||!!localStorage.getItem("userEmail")||!!localStorage.getItem("authUser"),e=Notification.permission==="granted"&&!!localStorage.getItem("fcmToken");return!n&&!e}async function v1({seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i}){try{const o=await $h({seasonId:n,playerId:"notification_activation",eventId:e,action:"activate_notifications",slug:i}),a=`${n}_${e}_${r.replace(/[^a-zA-Z0-9]/g,"_")}`;return await Wt(_e(ne,"notificationActivations",a),{seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i,magicLinkId:o.id,magicLinkUrl:o.url,requestedAt:Yn(),status:"pending"}),await GF({toEmail:r,playerName:t,eventTitle:s,eventUrl:`${window.location.origin}/season/${i}/event/${e}`,activationUrl:o.url,seasonTitle:i}),N.info("Demande d'activation des notifications créée",{activationId:a,email:r,playerName:t,eventId:e}),{success:!0,activationId:a,magicLink:o}}catch(o){throw N.error("Erreur lors de la création de la demande d'activation",o),o}}async function J5(n){try{const e=await Y5(n);if(!e)throw new Error("Données d'activation introuvables");const{verifyMagicLink:t}=await xt(()=>Promise.resolve().then(()=>ZA),void 0);if(!(await t({seasonId:e.seasonId,playerId:"notification_activation",eventId:e.eventId,token:n,action:"activate_notifications"})).valid)throw new Error("Magic link invalide ou expiré");const s=await y1(),i=await ej(e.email);return await _1(e.email,{notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),await X5(e.activationId),await b1(e),N.info("Notifications activées avec succès",{email:e.email,playerName:e.playerName,pushStatus:s}),{success:!0,email:e.email,playerName:e.playerName,pushStatus:s,accountStatus:i}}catch(e){throw N.error("Erreur lors de l'activation des notifications",e),e}}async function Y5(n){try{const{collection:e,query:t,where:r,getDocs:s}=await xt(()=>import("./index.esm-a5a77fae.js"),[]),i=t(e(ne,"notificationActivations"),r("status","==","pending")),o=await s(i);for(const a of o.docs){const l=a.data();if(l.magicLinkUrl&&l.magicLinkUrl.includes(n))return{...l,activationId:a.id}}return null}catch(e){return N.error("Erreur lors de la récupération des données d'activation",e),null}}async function y1(){try{if(!await Xv())return{active:!1,reason:"not_supported"};if(await Notification.requestPermission()!=="granted")return{active:!1,reason:"permission_denied"};const e=await FA();return e?{active:!0,token:e}:{active:!1,reason:"token_failed"}}catch(n){return N.error("Erreur lors de l'activation des notifications push",n),{active:!1,reason:"error",error:n.message}}}async function _1(n,e){try{await Wt(_e(ne,"userPreferences",n),{...e,updatedAt:Yn(),notificationActivatedAt:Yn()},{merge:!0})}catch(t){throw N.error("Erreur lors de la mise à jour des préférences",t),t}}async function X5(n){try{await vo(_e(ne,"notificationActivations",n),{status:"completed",completedAt:Yn()})}catch(e){N.error("Erreur lors de la finalisation de l'activation",e)}}async function b1(n){try{const{collection:e,query:t,where:r,getDocs:s,setDoc:i}=await xt(()=>import("./index.esm-a5a77fae.js"),[]),o=t(e(ne,"playerAssociations"),r("email","==",n.email),r("seasonId","==",n.seasonId));if(!(await s(o)).empty){N.info("Association joueur-email déjà existante",{email:n.email,seasonId:n.seasonId});return}await i(_e(ne,"playerAssociations",`${n.seasonId}_${n.email}`),{email:n.email,seasonId:n.seasonId,playerName:n.playerName,associatedAt:Yn(),source:"notification_activation"}),N.info("Joueur associé à l'email",{email:n.email,playerName:n.playerName,seasonId:n.seasonId})}catch(e){N.error("Erreur lors de l'association du joueur",e)}}async function Z5({seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i}){try{console.log("🔔 Activation directe des notifications pour utilisateur connecté");const o=await y1();return await _1(r,{notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),await b1({seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i}),N.info("Notifications activées directement pour utilisateur connecté",{email:r,playerName:t,eventId:e,pushStatus:o}),{success:!0,email:r,playerName:t,pushStatus:o,directActivation:!0}}catch(o){throw N.error("Erreur lors de l'activation directe des notifications",o),o}}async function ej(n){try{const{auth:e}=await xt(()=>Promise.resolve().then(()=>us),void 0),{signInWithEmailAndPassword:t,createUserWithEmailAndPassword:r}=await xt(()=>import("./index.esm-49aca4ca.js"),[]);try{return await t(e,n,"temp_password_123"),N.info("Compte Firebase Auth existant trouvé",{email:n}),{created:!1,reason:"already_exists"}}catch(s){if(s.code==="auth/user-not-found")try{const i=await r(e,n,"temp_password_123"),{sendPasswordResetEmail:o}=await xt(()=>import("./index.esm-49aca4ca.js"),[]);return await o(e,n),N.info("Compte Firebase Auth créé avec succès",{email:n,uid:i.user.uid}),{created:!0,reason:"new_account_created",uid:i.user.uid,passwordResetSent:!0}}catch(i){return N.error("Erreur lors de la création du compte Firebase Auth",i),{created:!1,reason:"creation_failed",error:i.message}}else return N.warn("Erreur de connexion Firebase Auth",{email:n,error:s.code}),{created:!1,reason:"auth_error",error:s.code}}}catch(e){return N.error("Erreur lors de la vérification/création du compte Firebase Auth",e),{created:!1,reason:"general_error",error:e.message}}}const w1=Object.freeze(Object.defineProperty({__proto__:null,activateNotificationsForConnectedUser:Z5,createNotificationActivationRequest:v1,processNotificationActivation:J5,shouldPromptForNotifications:g1},Symbol.toStringTag,{value:"Module"}));const tj={class:"space-y-4"},nj={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},rj={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},sj={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},ij={key:0,class:"space-y-3"},oj={class:"text-gray-300 text-sm mb-3"},aj={class:"text-white font-medium"},lj={class:"text-green-400 font-medium"},uj={class:"text-yellow-400 font-medium"},cj={class:"flex flex-wrap gap-2"},dj=["title"],hj={key:0,class:"text-green-400 text-xs"},fj={key:1,class:"text-yellow-400 text-xs"},pj={key:1,class:"text-amber-400 text-sm"},mj={class:"space-y-3"},gj={key:0,class:"fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in"},vj={class:"whitespace-pre-wrap font-sans"},yj={__name:"MessagePreview",props:{mode:{type:String,required:!0,validator:n=>["event","selection"].includes(n)},event:{type:Object,required:!0},seasonId:{type:String,required:!0},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},selectedPlayers:{type:Array,default:()=>[]},availabilityByPlayer:{type:Object,default:()=>({})}},setup(n){const e=n,t=S(!1),r=S(!1),s=S([]),i=S([]),o=S([]),a=qe(()=>!e.event||!e.seasonSlug?"":`${window.location.origin}/season/${e.seasonSlug}/event/${e.event.id}`),l=qe(()=>{const x=i.value.map(I=>({...I,hasContact:I.id!=="ALL",missingReason:""})),w=o.value.map(I=>({...I,hasContact:!1,missingReason:"Aucun canal actif"}));return[{id:"ALL",name:"Tous",hasContact:!0},...x.filter(I=>I.id!=="ALL"),...w]}),c=qe(()=>{var $,L;if(!e.event)return"";const x=g(($=e.event)==null?void 0:$.date),w=(L=e.event)==null?void 0:L.title,I=a.value;return e.mode==="event"?MF({playerName:"",eventTitle:w,eventDate:x,eventUrl:I}):LF({playerName:"",eventTitle:w,eventDate:x,eventUrl:I})}),h=qe(()=>c.value);function f(){navigator.clipboard.writeText(h.value),r.value=!0,setTimeout(()=>{r.value=!1},2e3)}function g(x){if(!x)return"";const w=new Date(x),I={weekday:"long",day:"numeric",month:"long",year:"numeric"};return w.toLocaleDateString("fr-FR",I)}async function v(){if(!e.seasonId)return;let x=[];e.mode==="selection"?(x=e.players.filter(L=>e.selectedPlayers.includes(L.name)),console.log("Mode sélection - targetPlayers:",x)):(x=e.players,console.log("Mode événement - targetPlayers (tous):",x));const w=[];for(const L of x)try{const{getPlayerEmail:U}=await xt(()=>Promise.resolve().then(()=>ud),void 0),q=await U(L.id,e.seasonId);console.log(`Email pour ${L.name}:`,q),q&&w.push({...L,email:q})}catch(U){console.warn(`Impossible de charger l'email pour ${L.name}:`,U)}console.log("Players avec email:",w),s.value=w;const I={id:"ALL",name:"Tous"};i.value=[I,...w];const $=x.filter(L=>!w.find(U=>U.id===L.id)).map(L=>({id:L.id,name:L.name}));o.value=$,console.log("Recipients finaux:",{recipients:i.value,nonContactRecipients:o.value,allDisplayRecipients:l.value})}return Tn(()=>{v()}),kt(()=>[e.selectedPlayers,e.availabilityByPlayer],()=>{v()},{deep:!0}),(x,w)=>(C(),D("div",tj,[d("div",null,[d("label",nj,[w[1]||(w[1]=ut(" Personnes à Prévenir ")),d("button",{onClick:w[0]||(w[0]=I=>t.value=!t.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),t.value?(C(),D("div",rj,w[2]||(w[2]=[d("p",{class:"text-blue-200 text-sm"},[ut(" Cette liste montre tous les joueurs ciblés: "),d("span",{class:"text-gray-200"},"ceux notifiables (email/push actifs)"),ut(" et "),d("span",{class:"text-yellow-300"},"ceux en jaune sans canal actif"),ut(". Les joueurs en jaune ne peuvent pas être notifiés automatiquement. Utilise le message ci-dessous pour les contacter manuellement. ")],-1)]))):ie("",!0),d("div",sj,[l.value.length>0?(C(),D("div",ij,[d("div",oj,[d("span",aj,ee(l.value.length-1),1),w[3]||(w[3]=ut(" personnes à prévenir. ")),d("span",lj,ee(s.value.length),1),w[4]||(w[4]=ut(" seront notifiées, ")),d("span",uj,ee(o.value.length),1),w[5]||(w[5]=ut(" devront être prévenues manuellement. "))]),d("div",cj,[(C(!0),D(mt,null,jr(l.value.filter(I=>I.id!=="ALL"),I=>(C(),D("span",{key:I.id||I.name,class:cn(["px-3 py-1 rounded text-sm border flex items-center gap-1",I.hasContact?"bg-gray-700 border-gray-600 text-white":"bg-yellow-900/20 border-yellow-600/40 text-yellow-200 opacity-75"]),title:I.hasContact?"Peut être notifié automatiquement":"Aucun canal actif - notification manuelle requise"},[ut(ee(I.name)+" ",1),I.hasContact?(C(),D("span",hj,"✓")):(C(),D("span",fj,"⚠️"))],10,dj))),128))])])):(C(),D("div",pj," ⚠️ Aucun destinataire disponible. "))])]),d("div",null,[w[6]||(w[6]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Message à copier pour les contacts manuels :",-1)),d("div",mj,[r.value?(C(),D("div",gj," ✅ Copié ! ")):ie("",!0),d("div",{class:"w-full p-3 bg-gray-800 border border-gray-700 rounded-md text-white text-sm cursor-pointer hover:bg-gray-700 transition-colors",onClick:f,title:"Cliquer pour copier le texte"},[d("pre",vj,ee(h.value),1)])])])]))}},_j=Ff(yj,[["__scopeId","data-v-88cc77b7"]]);const bj={class:"relative p-5 pb-4 border-b border-white/10"},wj={class:"text-xl md:text-2xl font-bold text-white pr-10 flex items-center gap-2"},xj={class:"hidden sm:inline"},Ij={key:0,class:"text-sm text-purple-300 mt-1"},Ej={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},Tj={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},Aj={class:"flex items-center gap-2 w-full"},Sj=["disabled"],Pj={key:0},Rj={key:1,class:"inline-flex items-center gap-2"},Cj={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]},sending:{type:Boolean,default:!1},availabilityByPlayer:{type:Object,default:()=>({})}},emits:["close","notifications-sent","send-notifications"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=qe(()=>t.sending||s.value);function o(){r("close")}function a(c){var f;return c?(typeof c=="string"?new Date(c):((f=c.toDate)==null?void 0:f.call(c))||c).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}async function l(){if(t.event){s.value=!0;try{r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:t.mode==="selection"?"selection":"event",selectedPlayers:t.selectedPlayers,scope:"all"})}catch(c){console.error("Erreur lors de l'envoi des notifications:",c),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer."),s.value=!1}}}return kt(()=>t.sending,c=>{c||(s.value=!1)}),(c,h)=>n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:o},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:h[0]||(h[0]=ft(()=>{},["stop"]))},[d("div",bj,[d("button",{onClick:o,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("h2",wj,[d("span",xj,ee(n.mode==="selection"?"📣":"📢"),1),d("span",null,ee(n.mode==="selection"?"Confirmer la sélection":"Confirmer l'événement"),1)]),n.event?(C(),D("p",Ij,ee(n.event.title)+" — "+ee(a(n.event.date)),1)):ie("",!0)]),d("div",Ej,[Be(_j,{mode:n.mode,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,"selected-players":n.selectedPlayers,"availability-by-player":n.availabilityByPlayer},null,8,["mode","event","season-id","season-slug","players","selected-players","availability-by-player"])]),d("div",Tj,[d("div",Aj,[d("button",{onClick:l,disabled:i.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[i.value?(C(),D("span",Rj,h[2]||(h[2]=[d("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[d("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),d("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),ut(" Envoi en cours... ")]))):(C(),D("span",Pj,h[1]||(h[1]=[d("span",{class:"hidden sm:inline"},"🔔 Confirmer et notifier",-1),d("span",{class:"sm:hidden"},"🔔 Confirmer",-1)])))],8,Sj)]),d("button",{onClick:o,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):ie("",!0)}},x1=Ff(Cj,[["__scopeId","data-v-4b6a7b48"]]),kj={class:"relative p-6 pb-4 border-b border-white/10"},Dj={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},Nj={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=ft(()=>{},["stop"]))},[d("div",kj,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"❓"),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Kezako ?"),d("p",{class:"text-sm text-purple-300"},"L'appli pour organiser vos spectacles d'improvisation de manière simple et apaisée")])],-1))]),s[5]||(s[5]=or('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">C&#39;est quoi ?</h3><p> HatCast est une appli conçue pour faciliter <span class="text-white">la sélection des joueurs d&#39;impro</span> pour les spectacles. L&#39;idée est née au sein de <span class="text-purple-300">La Malice</span> pour <span class="text-white">dépersonnaliser une tâche délicate</span> qui créait des tensions depuis des années. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">Comment ça marche</h3><p> L&#39;asso déclare ses dates et le nombre de personnes nécessaires. Les joueurs indiquent leurs disponibilités. L&#39;appli propose des sélections. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Sélection auto ou manuelle</h3><p> Le <span class="text-white">mode sélection auto</span> s&#39;appuie sur le hasard (pondéré) pour simplifier la vie. Vous pouvez aussi repasser en mode <span class="text-white">manuel</span> si besoin. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Pensée mobile • Libre d&#39;utilisation</h3><p> L&#39;appli est <span class="text-white">pensée pour le mobile</span> et peut être utilisée librement par La Malice ou <span class="text-white">toute autre troupe</span>. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Comptes (facultatif)</h3><p> Les joueurs qui le souhaitent peuvent créer un compte via leur email pour <span class="text-white">recevoir des notifications</span>, <span class="text-white">protéger leurs saisies</span> et bénéficier d&#39;un meilleur confort d&#39;utilisation. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2 text-sm"><h3 class="text-white font-semibold">Statut &amp; licence</h3><p> Application <span class="text-white">en cours de développement</span>, <span class="text-white">sans garanties</span> à ce stade. Licence libre <span class="text-white">MIT</span>. </p><p>Contact &amp; retours : <a href="mailto:impropick@gmail.com" class="text-blue-300 underline">impropick@gmail.com</a></p></div></div>',1)),d("div",Dj,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ie("",!0)}},Oj={class:"text-center mb-6"},Vj={class:"text-lg text-gray-300"},Mj={class:"mb-6"},Lj={class:"space-y-4"},$j={class:"flex items-center gap-2 text-gray-300 text-sm"},Fj=["disabled"],Uj={key:0,class:"animate-spin"},jj={key:1},Bj={class:"mb-6 text-center"},qj={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},zj={class:"text-red-300 text-sm"},Hj={class:"text-center mb-6"},Kj={class:"text-lg text-gray-300"},Gj={class:"mb-6"},Wj=["disabled"],Qj={key:0,class:"animate-spin"},Jj={key:1},Yj={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Xj={class:"text-red-300 text-sm"},Zj={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},eB={class:"text-green-300 text-sm"},tB={class:"flex justify-center"},oy={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(!1),o=S(""),a=S(!1),l=S(""),c=S(""),h=S(null),f=S(!0);async function g(){if(s.value){i.value=!0,o.value="";try{const w=await Lm(t.seasonId);if(s.value===w){if(f.value)try{lo.saveSession(t.player.id)}catch{}r("verified",{type:"season_pin"}),x();return}if(await l1(t.player.id,s.value,t.seasonId)){if(f.value)try{lo.saveSession(t.player.id)}catch{}r("verified",{type:"player_password"}),x()}else o.value="Mot de passe incorrect. Veuillez réessayer."}catch(w){N.error("Erreur lors de la vérification",w),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function v(){i.value=!0,l.value="",c.value="";try{const w=await c1(t.player.id,t.seasonId);c.value=w.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(w){N.error("Erreur lors de l'envoi de l'email",w),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function x(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return kt(()=>t.show,w=>{w&&rn(()=>{h.value&&h.value.focus()})}),(w,I)=>{var $,L;return C(),D(mt,null,[n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:x},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:I[3]||(I[3]=ft(()=>{},["stop"]))},[d("div",Oj,[I[7]||(I[7]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔐")],-1)),I[8]||(I[8]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),d("p",Vj,ee(($=n.player)==null?void 0:$.name),1),I[9]||(I[9]=d("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),d("div",Mj,[d("div",Lj,[d("div",null,[I[10]||(I[10]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),st(d("input",{"onUpdate:modelValue":I[0]||(I[0]=U=>s.value=U),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:sr(g,["enter"]),ref_key:"passwordInput",ref:h},null,544),[[Lt,s.value]])]),d("div",$j,[st(d("input",{id:"staySignedIn",type:"checkbox","onUpdate:modelValue":I[1]||(I[1]=U=>f.value=U),class:"w-4 h-4"},null,512),[[Hi,f.value]]),I[11]||(I[11]=d("label",{for:"staySignedIn"},"Rester connecté sur cet appareil",-1))])]),d("button",{onClick:g,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(C(),D("span",Uj,"⏳")):(C(),D("span",jj,"🔓")),d("span",null,ee(i.value?"Vérification...":"Vérifier"),1)],8,Fj)]),d("div",Bj,[d("button",{onClick:I[2]||(I[2]=U=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(C(),D("div",qj,[d("div",zj,ee(o.value),1)])):ie("",!0),d("div",{class:"flex justify-center"},[d("button",{onClick:x,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ie("",!0),a.value?(C(),D("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:I[6]||(I[6]=U=>a.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:I[5]||(I[5]=ft(()=>{},["stop"]))},[d("div",Hj,[I[12]||(I[12]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"📧")],-1)),I[13]||(I[13]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),d("p",Kj,ee((L=n.player)==null?void 0:L.name),1)]),d("div",Gj,[I[14]||(I[14]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:v,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(C(),D("span",Qj,"⏳")):(C(),D("span",Jj,"📧")),d("span",null,ee(i.value?"Envoi...":"Envoyer l'email"),1)],8,Wj)]),l.value?(C(),D("div",Yj,[d("div",Xj,ee(l.value),1)])):ie("",!0),c.value?(C(),D("div",Zj,[d("div",eB,ee(c.value),1)])):ie("",!0),d("div",tB,[d("button",{onClick:I[4]||(I[4]=U=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ie("",!0)],64)}}},nB={class:"text-center mb-6"},rB={class:"text-sm text-gray-300"},sB={key:0,class:"space-y-4"},iB={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},oB={key:1,class:"space-y-4"},aB=["disabled"],lB={key:0,class:"animate-spin"},uB={key:1},cB={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},dB={class:"mt-6 flex justify-center gap-3"},hB=["disabled"],fB={key:0,class:"animate-spin"},pB={key:1},I1={__name:"AccountClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=S(1),i=S(""),o=S(""),a=S(""),l=S(!1),c=S(""),h=S(!1),f=co(),g=qe(()=>i.value&&i.value.includes("@")),v=qe(()=>o.value&&a.value&&o.value===a.value&&o.value.length>=6);async function x(){var L,U,q;if(!(!g.value||!((L=t.player)!=null&&L.id))){l.value=!0,c.value="";try{const te=await r1({playerId:t.player.id,email:i.value.trim(),seasonId:t.seasonId}),X=(U=f.params)==null?void 0:U.slug,A=`${te.url}${X?`&slug=${encodeURIComponent(X)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await BF({toEmail:i.value,playerName:((q=t.player)==null?void 0:q.name)||"joueur",verifyUrl:A}),h.value=!0}catch{c.value="Impossible d'envoyer l'email de vérification"}finally{l.value=!1}}}async function w(){try{await i1({playerId:t.player.id,seasonId:t.seasonId})}catch{}s.value=1,h.value=!1,i.value="",o.value="",a.value=""}async function I(){var L;try{const U=await Jl((L=t.player)==null?void 0:L.id,t.seasonId);U!=null&&U.email&&(U!=null&&U.emailVerifiedAt)?s.value=2:s.value=1}catch{s.value=1}}Tn(()=>{I()}),kt(()=>t.show,L=>{L&&I()});async function $(){if(v.value){l.value=!0,c.value="";try{await n1(t.player.id,i.value.trim(),o.value,t.seasonId),r("success")}catch(L){c.value=(L==null?void 0:L.message)||"Erreur lors de l'association"}finally{l.value=!1}}}return(L,U)=>{var q;return n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:U[6]||(U[6]=te=>L.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:U[5]||(U[5]=ft(()=>{},["stop"]))},[d("button",{onClick:U[0]||(U[0]=te=>L.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),d("div",nB,[U[7]||(U[7]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"👤")],-1)),U[8]||(U[8]=d("h2",{class:"text-2xl font-bold text-white mb-1"},"Associer un compte",-1)),d("p",rB,"Pour sécuriser les saisies de "+ee((q=n.player)==null?void 0:q.name),1),Be(ty)]),s.value===1?(C(),D("div",sB,[d("div",null,[U[9]||(U[9]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),st(d("input",{"onUpdate:modelValue":U[1]||(U[1]=te=>i.value=te),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Lt,i.value]])]),h.value?(C(),D("div",iB,[U[10]||(U[10]=d("span",null,"✅",-1)),d("span",null,"Un email a été envoyé à "+ee(i.value)+". Cliquez sur le lien contenu dans l'email pour continuer.",1)])):ie("",!0)])):s.value===2?(C(),D("div",oB,[d("div",{class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},[U[11]||(U[11]=d("span",null,"✅",-1)),U[12]||(U[12]=d("span",null,"Adresse email vérifiée",-1)),d("button",{type:"button",onClick:w,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")]),d("div",null,[U[13]||(U[13]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),st(d("input",{"onUpdate:modelValue":U[2]||(U[2]=te=>o.value=te),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[Lt,o.value]])]),d("div",null,[U[14]||(U[14]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),st(d("input",{"onUpdate:modelValue":U[3]||(U[3]=te=>a.value=te),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[Lt,a.value]])]),d("button",{onClick:$,disabled:!v.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(C(),D("span",lB,"⏳")):(C(),D("span",uB,"🔒")),d("span",null,ee(l.value?"Association...":"Associer ce joueur"),1)],8,aB)])):ie("",!0),c.value?(C(),D("div",cB,ee(c.value),1)):ie("",!0),d("div",dB,[s.value===1?(C(),D("button",{key:0,onClick:x,disabled:!g.value||l.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(C(),D("span",fB,"⏳")):(C(),D("span",pB,"✉️")),d("span",null,ee(l.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,hB)):ie("",!0),d("button",{onClick:U[4]||(U[4]=te=>L.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])):ie("",!0)}}},mB={class:"text-center mb-6"},gB={class:"text-2xl font-bold text-white mb-2"},vB={class:"text-lg text-gray-300"},yB={class:"mb-6"},_B={class:"flex items-center space-x-3"},bB={class:"text-2xl"},wB={class:"font-semibold text-white"},xB={class:"text-sm text-gray-300"},IB={key:0,class:"mb-6"},EB={key:1,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},TB={class:"text-red-300 text-sm"},AB={key:2,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},SB={class:"text-green-300 text-sm"},PB={class:"flex justify-center gap-3"},RB=["disabled"],CB={__name:"PlayerClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=S(!1),o=S(!1),a=S(""),l=S(""),c=S(!1);co();const h=S(!1);qe(()=>!1),qe(()=>!1);function f(){l.value="Compte créé et joueur associé !",s.value=!0,c.value=!1,r("update")}async function g(){var $;if(($=t.player)!=null&&$.id){s.value=await Ji(t.player.id,t.seasonId);try{const{isPlayerPasswordCached:L}=await xt(()=>Promise.resolve().then(()=>ud),void 0);i.value=L(t.player.id)}catch{i.value=!1}}}function v(){var $;a.value="";try{if(($=t.player)!=null&&$.id&&Yo(t.player.id)){x();return}}catch{}h.value=!0}async function x(){o.value=!0,a.value="",l.value="";try{const $=await o1(t.player.id,t.seasonId);l.value="Joueur déverrouillé!",s.value=!1,$.email&&(email.value=$.email),r("update")}catch($){logger.error("Erreur lors de la désactivation de la protection",$),a.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{o.value=!1}}function w(){h.value=!1,x()}function I(){r("close")}return kt(()=>t.player,()=>{t.show&&t.player&&g()},{immediate:!0}),kt(()=>t.show,$=>{$&&t.player&&(a.value="",l.value="",h.value=!1,g(),t.onboarding&&rn(()=>{}))}),($,L)=>{var U;return C(),D(mt,null,[n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:I},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:L[1]||(L[1]=ft(()=>{},["stop"]))},[d("button",{onClick:I,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),d("div",mB,[L[4]||(L[4]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔒")],-1)),d("h2",gB,ee(s.value?"Déverrouiller ce joueur":"Verrouiller ce joueur"),1),d("p",vB,ee((U=n.player)==null?void 0:U.name),1)]),d("div",yB,[d("div",{class:cn(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[d("div",_B,[d("span",bB,ee(s.value?"🔒":"🔓"),1),d("div",null,[d("div",wB,ee(s.value?i.value?"Joueur associé à votre compte":"Ce joueur est associé à un compte utilisateur":"Joueur sans compte"),1),d("div",xB,ee(s.value?i.value?"Seul vous pouvez modifier":"Seul le titulaire peut modifier les disponibilités":"Tout le monde peut modifier les disponibilités"),1)])])],2)]),s.value?ie("",!0):(C(),D("div",IB,L[5]||(L[5]=[d("div",{class:"text-sm text-gray-300"},"Vous pouvez protéger vos saisies de disponibilités avec un compte utilisateur.",-1)]))),a.value?(C(),D("div",EB,[d("div",TB,ee(a.value),1)])):ie("",!0),l.value?(C(),D("div",AB,[d("div",SB,ee(l.value),1)])):ie("",!0),d("div",PB,[s.value?(C(),D("button",{key:1,onClick:v,disabled:o.value,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," 🔓 Dissocier ",8,RB)):(C(),D("button",{key:0,onClick:L[0]||(L[0]=q=>c.value=!0),class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300"}," Associer un compte ")),d("button",{onClick:I,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ie("",!0),Be(I1,{show:c.value,player:n.player,"season-id":n.seasonId,onClose:L[2]||(L[2]=q=>c.value=!1),onSuccess:f},null,8,["show","player","season-id"]),Be(oy,{show:h.value,player:n.player,seasonId:n.seasonId,onClose:L[3]||(L[3]=q=>h.value=!1),onVerified:w},null,8,["show","player","seasonId"])],64)}}};const kB={class:"relative p-4 md:p-6 border-b border-white/10"},DB={class:"flex items-start gap-4 md:gap-6"},NB={class:"flex-1 min-w-0"},OB={class:"flex items-center gap-3 mb-2"},VB={class:"text-xl md:text-2xl font-bold text-white leading-tight"},MB={class:"flex items-center gap-2"},LB={key:0,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-full"},$B={key:1,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-full"},FB={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},UB={class:"grid grid-cols-3 gap-3 md:gap-4"},jB={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},BB={class:"text-xl md:text-2xl font-bold text-white"},qB={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},zB={class:"text-xl md:text-2xl font-bold text-white"},HB={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30 text-center"},KB={class:"text-xl md:text-2xl font-bold text-white"},GB={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},WB={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},QB={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},JB={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},YB={class:"mb-6"},XB={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null},isProtected:{type:Boolean,default:!1},isPreferred:{type:Boolean,default:!1}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=S(!1),o=S(""),a=S(null),l=S(!1),c=S(!1),h=S(null);S(!1);const f=S(!1),g=S(!1),v=S(null),x=S(null),w=S({position:"fixed",top:"0px",left:"0px"}),I=S(null),$=S({position:"fixed",top:"0px",left:"0px"}),L=S(!1),U=S(!1);function q(){s("close"),f.value=!1,g.value=!1,w.value={position:"fixed",top:"0px",left:"0px"},$.value={position:"fixed",top:"0px",left:"0px"}}function te(){var Ae;o.value=((Ae=r.player)==null?void 0:Ae.name)||"",i.value=!0,rn(()=>{a.value&&a.value.focus()})}function X(){i.value=!1,o.value=""}async function A(){var he,Qe;if(!o.value.trim())return;if(await Ji((he=r.player)==null?void 0:he.id,r.seasonId)){Yo((Qe=r.player)==null?void 0:Qe.id)?b():(h.value="update",c.value=!0);return}b()}function b(){var Ae;s("update",{playerId:(Ae=r.player)==null?void 0:Ae.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function T(){var he,Qe;if(await Ji((he=r.player)==null?void 0:he.id,r.seasonId)){Yo((Qe=r.player)==null?void 0:Qe.id)?k():(h.value="delete",c.value=!0);return}k()}function k(){var Ae;s("delete",(Ae=r.player)==null?void 0:Ae.id)}function F(){s("refresh")}function M(Ae){h.value==="update"?b():h.value==="delete"&&k(),h.value=null}function R(){try{const Ae=v.value;if(!Ae)return;const he=Ae.getBoundingClientRect(),Qe=8;if(window.innerWidth>768){const le=Math.max(Qe,Math.round(he.top-Qe)),re=Math.max(Qe,Math.round(he.left));w.value={position:"fixed",top:`${le}px`,left:`${re}px`,zIndex:400}}else{const le=Math.min(window.innerHeight-Qe,Math.round(he.bottom+Qe)),re=Math.max(Qe,Math.round(he.left));w.value={position:"fixed",top:`${le}px`,left:`${re}px`,zIndex:400}}}catch{}}function Ke(){try{const le=Math.max(8,window.innerHeight-8-48-120),re=Math.max(8,Math.round(window.innerWidth-200-8));$.value={position:"fixed",top:`${le}px`,left:`${re}px`,zIndex:400}}catch{}}function ct(){f.value=!f.value,f.value&&rn(()=>R())}function dt(){g.value=!g.value,g.value&&rn(()=>Ke())}kt(()=>r.show,Ae=>{var he;Ae||(i.value=!1,o.value="",h.value=null,l.value=!1,f.value=!1,g.value=!1),Ae&&((he=r.player)!=null&&he.id)&&(Ji(r.player.id,r.seasonId).then(Qe=>{L.value=!!Qe}),xt(()=>Promise.resolve().then(()=>ud),void 0).then(Qe=>{try{U.value=!!Qe.isPlayerPasswordCached(r.player.id)}catch{U.value=!1}}))}),Tn(()=>{document.addEventListener("click",Ae=>{if(f.value){const he=v.value,Qe=x.value,le=he&&he.contains(Ae.target),re=Qe&&Qe.contains(Ae.target);!le&&!re&&(f.value=!1)}if(g.value){const he=I.value;he&&he.contains(Ae.target)||(g.value=!1)}}),document.addEventListener("keydown",Ae=>{Ae.key==="Escape"&&(f.value&&(f.value=!1),g.value&&(g.value=!1))}),window.addEventListener("resize",()=>{f.value&&R(),g.value&&Ke()}),window.addEventListener("scroll",()=>{f.value&&R(),g.value&&Ke()},{passive:!0})}),e({openProtection(){l.value=!0}});const Ge=S({position:null});return kt(()=>r.show,Ae=>{Ae&&r.onboardingStep===4?rn(()=>{const he=document.querySelectorAll("button");let Qe=null;if(he.forEach(le=>{!Qe&&le.textContent&&le.textContent.includes("Protection")&&(Qe=le)}),Qe){const le=Qe.getBoundingClientRect();Ge.value.position={x:Math.round(le.right+8),y:Math.round(le.top+window.scrollY-4)}}}):Ae||(Ge.value.position=null)}),(Ae,he)=>{var Qe;return C(),D(mt,null,[n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:q},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-xl max-h-[92vh] flex flex-col",onClick:he[6]||(he[6]=ft(()=>{},["stop"]))},[d("div",kB,[d("button",{onClick:q,class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",DB,[he[15]||(he[15]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"👤")],-1)),d("div",NB,[d("div",OB,[d("h2",VB,ee((Qe=n.player)==null?void 0:Qe.name),1),d("div",MB,[n.isProtected?(C(),D("div",LB,he[13]||(he[13]=[d("span",{class:"text-yellow-400 text-sm"},"🔒",-1),d("span",{class:"text-yellow-300 text-xs font-medium"},"Protégé",-1)]))):ie("",!0),n.isPreferred?(C(),D("div",$B,he[14]||(he[14]=[d("span",{class:"text-purple-400 text-sm"},"⭐",-1),d("span",{class:"text-purple-300 text-xs font-medium"},"Favori",-1)]))):ie("",!0)])])])])]),d("div",FB,[d("div",null,[d("div",UB,[d("div",jB,[d("div",BB,ee(r.stats.availability),1),he[16]||(he[16]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibilités",-1))]),d("div",qB,[d("div",zB,ee(r.stats.selection),1),he[17]||(he[17]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélections",-1))]),d("div",HB,[d("div",KB,ee(r.stats.ratio),1),he[18]||(he[18]=d("div",{class:"text-xs md:text-sm text-gray-300"},"% de sélection",-1))])])]),d("div",GB,[d("button",{onClick:he[0]||(he[0]=le=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},[d("span",null,ee(L.value?"🔓":"🔒"),1),d("span",null,ee(L.value?"Déverrouiller":"Verrouiller"),1)]),d("div",{class:"relative",ref_key:"playerMoreActionsRef",ref:v},[d("button",{onClick:he[1]||(he[1]=le=>ct()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},he[19]||(he[19]=[d("span",null,"⋯",-1),d("span",null,"Plus",-1)]))],512),d("button",{onClick:q,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer "),(C(),Ys(ac,{to:"body"},[f.value?(C(),D("div",{key:0,ref_key:"playerMoreActionsDropdownRef",ref:x,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:Ur(w.value)},[d("button",{onClick:he[2]||(he[2]=le=>{te(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},he[20]||(he[20]=[d("span",null,"✏️",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:he[3]||(he[3]=le=>{T(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},he[21]||(he[21]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ie("",!0)]))])]),d("div",WB,[d("button",{onClick:he[4]||(he[4]=le=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},ee(L.value?"🔓 Déverrouiller":"🔒 Verrouiller"),1),d("button",{onClick:he[5]||(he[5]=le=>dt()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ "),d("button",{onClick:q,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer ")])])])):ie("",!0),(C(),Ys(ac,{to:"body"},[g.value?(C(),D("div",{key:0,ref_key:"playerMoreActionsMobileDropdownRef",ref:I,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:Ur($.value)},[d("button",{onClick:he[7]||(he[7]=le=>{te(),g.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},he[22]||(he[22]=[d("span",null,"✏️",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:he[8]||(he[8]=le=>{T(),g.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},he[23]||(he[23]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ie("",!0)])),i.value?(C(),D("div",QB,[d("div",JB,[he[25]||(he[25]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Renommer le joueur",-1)),d("div",YB,[he[24]||(he[24]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),st(d("input",{"onUpdate:modelValue":he[9]||(he[9]=le=>o.value=le),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[sr(X,["esc"]),sr(A,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[Lt,o.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:X,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:A,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ie("",!0),Be(CB,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:he[10]||(he[10]=le=>l.value=!1),onUpdate:F,onOnboardingFinished:he[11]||(he[11]=le=>Ae.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),Be(oy,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:he[12]||(he[12]=le=>c.value=!1),onVerified:M},null,8,["show","player","seasonId"])],64)}}},ZB=Ff(XB,[["__scopeId","data-v-8237d7ee"]]),eq={class:"relative p-6 pb-4 border-b border-white/10"},tq={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},nq={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=ft(()=>{},["stop"]))},[d("div",eq,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),d("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=or('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),d("div",tq,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ie("",!0)}},rq={class:"relative p-4 md:p-6 border-b border-white/10"},sq={class:"flex items-start gap-4 md:gap-6"},iq={class:"flex-1 min-w-0"},oq={class:"text-xl md:text-2xl font-bold text-white leading-tight mb-2"},aq={class:"flex items-center gap-3"},lq={class:"text-base md:text-lg text-purple-300"},uq={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},cq={class:"text-blue-200"},dq={key:0,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm flex items-center gap-1",title:"Prêt pour la sélection"},hq={key:1,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded text-sm flex items-center gap-1",title:"Sélection complète"},fq={key:2,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded text-sm flex items-center gap-1",title:"Sélection incomplète"},pq={key:3,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded text-sm flex items-center gap-1",title:"Pas assez de joueurs disponibles"},mq={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},gq={class:"grid grid-cols-3 gap-3 md:gap-4 mb-4"},vq={class:"bg-gradient-to-r from-yellow-500/20 to-orange-500/20 p-3 md:p-4 rounded-lg border border-yellow-500/30 text-center"},yq={class:"text-xl md:text-2xl font-bold text-yellow-300"},_q={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},bq={class:"text-xl md:text-2xl font-bold text-white"},wq={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},xq={class:"text-xl md:text-2xl font-bold text-white"},Iq={class:"mb-3"},Eq={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},Tq={key:0,class:"flex items-center justify-between gap-2"},Aq=["title"],Sq={key:0,class:"text-purple-400 mr-2"},Pq={key:1,class:"text-green-400 mr-2"},Rq={key:2,class:"text-red-400 mr-2"},Cq={key:3,class:"text-gray-400 mr-2"},kq=["onClick"],Dq={key:1,class:"flex items-center justify-center"},Nq=["onChange"],Oq=["value"],Vq=["onClick"],Mq={key:0,class:"mb-3"},Lq={key:1,class:"mb-3"},$q={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},Fq={class:"flex-1"},Uq={class:"text-blue-300 text-sm font-medium"},jq={class:"sticky bottom-0 w-full p-3 bg-gray-900/80 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},Bq=["disabled","title"],qq=["disabled"],zq={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-notifications","updateSelection"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=S(!1),o=S("Copier le message"),a=S(!1),l=S(!1),c=S(""),h=S(!1),f=S(!1),g=qe(()=>{var le;return((le=r.event)==null?void 0:le.playerCount)||6}),v=S([]),x=S(null),w=qe(()=>(r.players||[]).map(le=>le.name).filter(le=>{var re;return((re=r.playerAvailability)==null?void 0:re[le])===!0}).sort((le,re)=>le.localeCompare(re,"fr",{sensitivity:"base"})));function I(le){const re=new Set(v.value.filter(Boolean)),Ne=v.value[le];return Ne&&re.delete(Ne),w.value.filter(ht=>!re.has(ht))}function $(le){x.value=le}function L(){x.value=null}async function U(le,re){var ht;const Ne=((ht=le==null?void 0:le.target)==null?void 0:ht.value)||"";Ne&&(v.value[re]=Ne,await F()),x.value=null}async function q(le){v.value[le]=null,await F()}qe(()=>(I(-1).length<g.value,""));const te=qe(()=>r.currentSelection&&r.currentSelection.length>0);function X(){var ht;const le=r.currentSelection||[],re=((ht=r.event)==null?void 0:ht.playerCount)||6,Ne=r.availableCount||0;if(le.length>0){const Pt=le.some(Y=>!ct(Y)),tn=Ne<re;if(Pt||tn)return{type:"incomplete",hasUnavailablePlayers:Pt,hasInsufficientPlayers:tn,unavailablePlayers:le.filter(Y=>!ct(Y)),availableCount:Ne,requiredCount:re}}return Ne<re?{type:"insufficient",availableCount:Ne,requiredCount:re}:le.length===0?{type:"ready",availableCount:Ne,requiredCount:re}:{type:"complete",availableCount:Ne,requiredCount:re}}const A=qe(()=>{var ht;if(!te.value)return!1;const le=r.currentSelection.some(Pt=>!ct(Pt)),re=((ht=r.event)==null?void 0:ht.playerCount)||6,Ne=r.availableCount<re;return le||Ne});qe(()=>{var Ne;if(!A.value)return"";const le=r.currentSelection.filter(ht=>!ct(ht)),re=((Ne=r.event)==null?void 0:Ne.playerCount)||6;return le.length>0?le.length===1?`${le[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${le.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<re?`Seulement ${r.availableCount} joueurs disponibles pour ${re} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),qe(()=>{if(!r.event||!te.value)return"";const le=b(r.event.date),re=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${le} : ${re}`}),kt(()=>r.show,le=>{if(le){i.value=!1,o.value="Copier le message",l.value=!1,c.value="",h.value=!1,a.value=!1;const re=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Ne=g.value;v.value=Array.from({length:Ne},(ht,Pt)=>re[Pt]||null),x.value=null}}),kt([g,()=>r.currentSelection,()=>{var le;return(le=r.event)==null?void 0:le.id}],()=>{if(!r.show)return;const le=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],re=g.value,Ne=Array.from({length:re},(ht,Pt)=>le[Pt]||v.value[Pt]||null);v.value=Ne.slice(0,re)});function b(le){var Ne;return le?(typeof le=="string"?new Date(le):((Ne=le.toDate)==null?void 0:Ne.call(le))||le).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function T(){s("selection")}function k(){s("perfect")}async function F(){var le;if(!(!((le=r.event)!=null&&le.id)||!r.seasonId))try{const re=v.value.filter(Boolean);await qm(r.event.id,re,r.seasonId),console.debug("Sélection sauvegardée automatiquement")}catch(re){console.error("Erreur lors de la sauvegarde automatique:",re)}}function M(){s("close")}function R(){a.value=!0}function Ke(){f.value=!0}function ct(le){return r.playerAvailability[le]===!0}function dt(le){return r.playerAvailability[le]===!1}function Ge(le){return r.currentSelection.includes(le)&&ct(le)}function Ae(le=!1,re=!1){if(h.value=le,le){const Ne=b(r.event.date),ht=r.currentSelection.join(", ");re?c.value=`Sélection mise à jour pour ${r.event.title} du ${Ne} : ${ht}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`:c.value=`Nouvelle sélection pour ${r.event.title} du ${Ne} : ${ht}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`}else c.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function he(){l.value=!1}e({showSuccess:Ae});function Qe(le){s("send-notifications",le)}return(le,re)=>{var Ne,ht,Pt,tn;return C(),D(mt,null,[n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:M},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:re[1]||(re[1]=ft(()=>{},["stop"]))},[d("div",rq,[d("button",{onClick:M,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",sq,[re[9]||(re[9]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),d("div",iq,[d("h2",oq,"Sélection pour "+ee((Ne=n.event)==null?void 0:Ne.title),1),d("div",aq,[d("p",lq,ee(b((ht=n.event)==null?void 0:ht.date)),1),d("div",uq,[re[4]||(re[4]=d("span",{class:"text-blue-300"},"👥",-1)),d("span",cq,ee(((Pt=n.event)==null?void 0:Pt.playerCount)||6)+" joueurs",1)]),X().type==="ready"?(C(),D("div",dq,re[5]||(re[5]=[d("span",{class:"text-blue-300 text-xs"},"🆕",-1),d("span",{class:"text-blue-200 text-xs"},"Nouveau",-1)]))):X().type==="complete"?(C(),D("div",hq,re[6]||(re[6]=[d("span",{class:"text-green-300 text-xs"},"✅",-1),d("span",{class:"text-green-200 text-xs"},"Complet",-1)]))):X().type==="incomplete"?(C(),D("div",fq,re[7]||(re[7]=[d("span",{class:"text-orange-300 text-xs"},"⚠️",-1),d("span",{class:"text-orange-200 text-xs"},"À finaliser",-1)]))):X().type==="insufficient"?(C(),D("div",pq,re[8]||(re[8]=[d("span",{class:"text-red-300 text-xs"},"❌",-1),d("span",{class:"text-red-200 text-xs"},"Manque",-1)]))):ie("",!0)])])])]),d("div",mq,[d("div",gq,[d("div",vq,[d("div",yq,ee(Math.max((((tn=n.event)==null?void 0:tn.playerCount)||6)-n.selectedCount,0)),1),re[10]||(re[10]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))]),d("div",_q,[d("div",bq,ee(n.availableCount),1),re[11]||(re[11]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",wq,[d("div",xq,ee(n.selectedCount),1),re[12]||(re[12]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))])]),d("div",Iq,[d("div",{class:"flex items-center gap-2 mb-2"},[re[14]||(re[14]=d("h3",{class:"text-base md:text-lg font-semibold text-white"},"Joueurs sélectionnés",-1)),d("button",{onClick:Ke,class:"text-blue-300 hover:text-blue-200 p-1 rounded-full hover:bg-blue-500/10 transition-colors",title:"Comment fonctionne la sélection automatique ?"},re[13]||(re[13]=[d("span",{class:"text-sm"},"❓",-1)]))]),d("div",Eq,[(C(!0),D(mt,null,jr(v.value,(Y,xe)=>(C(),D("div",{key:"sel-slot-"+xe,class:cn(["relative p-3 rounded-lg border text-center transition-colors",Y?["bg-gradient-to-r",dt(Y)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":ct(Y)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[Y?(C(),D("div",Tq,[d("div",{class:"flex-1 text-white font-medium truncate",title:Y},[Ge(Y)?(C(),D("span",Sq,"🎭")):ct(Y)?(C(),D("span",Pq,"✅")):dt(Y)?(C(),D("span",Rq,"❌")):(C(),D("span",Cq,"–")),ut(" "+ee(Y),1)],8,Aq),d("button",{onClick:ve=>q(xe),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer ce joueur"}," × ",8,kq)])):(C(),D("div",Dq,[x.value===xe?(C(),D("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:ve=>U(ve,xe),onBlur:re[0]||(re[0]=ve=>L())},[re[15]||(re[15]=d("option",{value:""},"— Choisir —",-1)),(C(!0),D(mt,null,jr(I(xe),ve=>(C(),D("option",{key:ve,value:ve},ee(ve),9,Oq))),128))],40,Nq)):(C(),D("button",{key:1,onClick:ve=>$(xe),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter un joueur"},re[16]||(re[16]=[d("span",{class:"text-lg"},"＋",-1),d("span",{class:"text-sm"},"Ajouter",-1)]),8,Vq))]))],2))),128))])]),te.value?(C(),D("div",Mq,re[17]||(re[17]=[d("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[d("div",{class:"text-yellow-400"},"⚠️"),d("div",{class:"text-yellow-200 text-sm"},"Pensez à prévenir les gens de vos changements !")],-1)]))):ie("",!0),l.value?(C(),D("div",Lq,[d("div",$q,[re[19]||(re[19]=d("div",{class:"text-blue-400 text-xl"},"✨",-1)),d("div",Fq,[d("p",Uq,ee(c.value),1)]),d("button",{onClick:he,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},re[18]||(re[18]=[d("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):ie("",!0)]),d("div",jq,[d("button",{onClick:T,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":te.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},re[20]||(re[20]=[ut(" ✨ "),d("span",{class:"hidden sm:inline"},"Sélection Auto",-1),d("span",{class:"sm:hidden"},"Auto",-1)]),8,Bq),d("button",{onClick:R,disabled:!te.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},re[21]||(re[21]=[ut(" 📣 "),d("span",{class:"hidden sm:inline"},"Annoncer",-1),d("span",{class:"sm:hidden"},"Annoncer",-1)]),8,qq),d("button",{onClick:k,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 whitespace-nowrap"},re[22]||(re[22]=[d("span",{class:"hidden sm:inline"},"Fermer",-1),d("span",{class:"sm:hidden"},"Fermer",-1)]))])])])):ie("",!0),Be(x1,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:re[2]||(re[2]=Y=>a.value=!1),onSendNotifications:Qe},null,8,["show","event","season-id","season-slug","players","selected-players"]),Be(nq,{show:f.value,onClose:re[3]||(re[3]=Y=>f.value=!1)},null,8,["show"])],64)}}},Hq={class:"flex items-center justify-center"},Kq=["title"],Gq={key:0,class:"text-center"},Wq={key:1,class:"text-center"},Qq={key:2,class:"text-center"},Jq={key:3,class:"text-center text-gray-400"},Gb={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},compact:{type:Boolean,default:!1},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=qe(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=qe(()=>t.disabled?"Événement archivé — désarchivez pour modifier":t.isSelected&&t.isAvailable===!0?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){t.disabled||r("toggle",t.playerName,t.eventId)}return(l,c)=>(C(),D("div",{class:cn(["flex items-center justify-center transition-all duration-200 rounded font-medium text-white mx-0.5 my-0.25",[n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer hover:scale-105",n.compact?"min-h-0 p-1 md:p-2 text-xs":"min-h-20 p-2 md:p-3 text-sm",n.isSelected&&n.isAvailable===!0?"bg-gradient-to-br from-purple-500/60 to-pink-500/60":"",!n.isSelected&&n.isAvailable===!0?"bg-green-500/60":"",n.isAvailable===!1?"bg-red-500/60":"",n.isAvailable===null||n.isAvailable===void 0?"bg-gray-500/40":""]]),onClick:a,onMouseenter:c[0]||(c[0]=h=>s.value=!0),onMouseleave:c[1]||(c[1]=h=>s.value=!1)},[d("div",Hq,[i.value&&s.value?(C(),D("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},ee(n.chancePercent)+"% ",9,Kq)):(C(),D(mt,{key:1},[n.isSelected&&n.isAvailable===!0?(C(),D("span",Gq," Joue ")):n.isAvailable===!0?(C(),D("span",Wq," Disponible ")):n.isAvailable===!1?(C(),D("span",Qq," Pas disponible ")):(C(),D("span",Jq," – "))],64))])],34))}},Yq={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},Xq={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},Zq={class:"text-2xl md:text-3xl font-bold text-white mb-3"},e9={class:"text-gray-300 mb-6"},t9={class:"flex flex-col items-stretch justify-center gap-3"},n9=["value"],r9={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=qe(()=>`${s}/season/${t.seasonSlug}`),o=S(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=qe(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=qe(()=>a.value>0),c=S(l.value);kt(a,I=>{c.value=I>0});const h=qe(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=qe(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function g(){c.value=!1,r("create-event")}function v(){c.value=!1,r("add-player")}function x(){var I;try{(I=navigator.clipboard)==null||I.writeText(i.value)}catch{}r("copy-link")}async function w(){try{if(t.seasonId){const{db:I}=await xt(()=>Promise.resolve().then(()=>us),void 0),{doc:$,updateDoc:L}=await xt(()=>import("./index.esm-a5a77fae.js"),[]);await L($(I,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(I,$)=>l.value&&c.value?(C(),D("div",Yq,[d("div",Xq,[$[1]||($[1]=d("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-3xl"},"🎬")],-1)),d("h2",Zq,ee(h.value),1),d("p",e9,ee(f.value),1),d("div",t9,[a.value===1?(C(),D("button",{key:0,onClick:g,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(C(),D("button",{key:1,onClick:v,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(C(),D(mt,{key:2},[d("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:$[0]||($[0]=L=>L.target.select())},null,40,n9),d("div",{class:"flex gap-3 justify-center"},[d("button",{onClick:x,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),d("button",{onClick:w,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):ie("",!0)])])])):ie("",!0)}},s9={class:"sticky top-0 z-[60] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},i9={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},o9={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},a9={class:"hidden md:flex items-center gap-2"},l9={class:"md:hidden"},u9={__name:"SeasonHeader",props:{seasonName:{type:String,default:""},isScrolled:{type:Boolean,default:!1}},emits:["go-back","open-account-menu","open-help","open-notifications","open-players","logout","open-login","open-account"],setup(n,{emit:e}){const t=n,r=e,s=S(null),i=qe(()=>{var w;return!!s.value&&!((w=s.value)!=null&&w.isAnonymous)}),o=qe(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");function a(w){s.value=w}Tn(()=>{s.value=je.currentUser;const w=je.onAuthStateChanged(a);window._seasonHeaderUnsubscribe=w}),Js(()=>{window._seasonHeaderUnsubscribe&&(window._seasonHeaderUnsubscribe(),delete window._seasonHeaderUnsubscribe)});function l(){r("go-back")}function c(){r("open-account-menu")}function h(){r("open-login")}function f(){r("open-help")}function g(){r("open-notifications")}function v(){r("open-players")}function x(){r("logout")}return(w,I)=>(C(),D("div",s9,[d("button",{onClick:l,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour aux saisons"},I[0]||(I[0]=[d("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),d("h1",i9,ee(n.seasonName?n.seasonName:"Chargement..."),1),d("div",o9,[d("div",a9,[Be(Bm,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:c,onOpenHelp:f,onOpenNotifications:g,onOpenPlayers:v,onLogout:x,onOpenLogin:h},null,8,["is-connected","button-class"]),i.value?ie("",!0):(C(),D("button",{key:0,onClick:f,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},I[1]||(I[1]=[d("span",{class:"text-2xl"},"❓",-1)])))]),d("div",l9,[Be(Bm,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:c,onOpenHelp:f,onOpenNotifications:g,onOpenPlayers:v,onLogout:x,onOpenLogin:h},null,8,["is-connected","button-class"])])])]))}},c9={key:0,class:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/50"},d9={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-2xl shadow-2xl w-full max-w-md p-6 relative"},h9={class:"text-center mb-6"},f9={class:"text-gray-300 text-sm"},p9={class:"font-medium text-white"},m9={key:0,class:"space-y-4"},g9=["disabled"],v9={key:0,class:"mt-2 text-xs"},y9={key:0,class:"text-green-400"},_9={key:1,class:"text-red-400"},b9={class:"flex gap-3"},w9=["disabled"],x9={key:0,class:"animate-spin"},I9={key:1},E9={key:1,class:"text-center"},T9={class:"text-green-400 text-sm mb-4"},A9={class:"font-medium text-white"},S9={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg"},P9={class:"text-red-300 text-sm"},R9={__name:"NotificationPromptModal",props:{show:{type:Boolean,default:!1},playerName:{type:String,required:!0},eventTitle:{type:String,required:!0},seasonId:{type:String,required:!0},seasonSlug:{type:String,required:!0},eventId:{type:String,required:!0}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(!1),o=S(""),a=S(!1),l=qe(()=>{const h=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,f=s.value,g=h.test(f),v=i.value;return f&&g&&!v});async function c(){var h;if(l.value){i.value=!0,o.value="";try{console.log("🚀 Début de l'activation des notifications...");const{auth:f}=await xt(()=>Promise.resolve().then(()=>us),void 0),g=((h=f.currentUser)==null?void 0:h.email)===s.value;if(g){console.log("✅ Utilisateur déjà connecté, activation directe...");const{activateNotificationsForConnectedUser:v}=await xt(()=>Promise.resolve().then(()=>w1),void 0),x=await v({seasonId:t.seasonId,eventId:t.eventId,playerName:t.playerName,email:s.value,eventTitle:t.eventTitle,seasonSlug:t.seasonSlug});console.log("✅ Notifications activées directement:",x),a.value=!0,r("success",{email:s.value,playerName:t.playerName,directActivation:!0})}else{console.log("📧 Utilisateur non connecté, envoi de l'email d'activation...");const v=await v1({seasonId:t.seasonId,eventId:t.eventId,playerName:t.playerName,email:s.value,eventTitle:t.eventTitle,seasonSlug:t.seasonSlug});console.log("✅ Résultat de la création:",v),a.value=!0,r("success",{email:s.value,playerName:t.playerName,directActivation:!1})}N.info("Activation des notifications terminée",{email:s.value,playerName:t.playerName,eventId:t.eventId,directActivation:g})}catch(f){console.error("❌ Erreur lors de l'activation:",f),N.error("Erreur lors de l'activation des notifications",f),o.value="Impossible d'activer les notifications. Veuillez réessayer."}finally{i.value=!1}}}return(h,f)=>n.show?(C(),D("div",c9,[d("div",d9,[d("button",{onClick:f[0]||(f[0]=g=>h.$emit("close")),class:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors p-1 rounded-full hover:bg-white/10",title:"Fermer"},f[3]||(f[3]=[d("span",{class:"text-xl"},"✖️",-1)])),d("div",h9,[f[5]||(f[5]=d("div",{class:"w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center bg-gradient-to-r from-purple-500 to-pink-600"},[d("span",{class:"text-2xl"},"🔔")],-1)),f[6]||(f[6]=d("h2",{class:"text-xl font-bold text-white mb-2"},"Ne rates rien !",-1)),d("p",f9,[d("span",p9,ee(n.playerName),1),f[4]||(f[4]=ut(", active tes notifications pour recevoir des alertes en temps réel sur tes événements. "))])]),a.value?(C(),D("div",E9,[d("p",T9,[f[8]||(f[8]=ut(" Email envoyé à ")),d("span",A9,ee(s.value),1)]),f[9]||(f[9]=d("p",{class:"text-gray-300 text-xs"}," Clique sur le lien qu'il contient pour activer tes notifications ",-1))])):(C(),D("div",m9,[d("div",null,[f[7]||(f[7]=d("label",{for:"email",class:"block text-sm font-medium text-gray-300 mb-2"}," Ton adresse email ",-1)),st(d("input",{id:"email","onUpdate:modelValue":f[1]||(f[1]=g=>s.value=g),type:"email",placeholder:"votre@email.com",class:cn(["w-full px-4 py-3 bg-gray-800 border rounded-lg text-white placeholder-gray-400 focus:outline-none transition-colors",[s.value&&!l.value?"border-red-500 focus:border-red-500":s.value&&l.value?"border-green-500 focus:border-green-500":"border-white/20 focus:border-purple-500"]]),disabled:i.value},null,10,g9),[[Lt,s.value]]),s.value&&!i.value?(C(),D("div",v9,[l.value?(C(),D("span",y9,"✅ Email valide")):(C(),D("span",_9,"❌ Format d'email invalide"))])):ie("",!0)]),d("div",b9,[d("button",{onClick:c,disabled:!l.value||i.value,class:cn(["flex-1 px-6 py-3 rounded-lg transition-all duration-300 font-medium",[l.value&&!i.value?"bg-gradient-to-r from-purple-500 to-pink-600 text-white hover:from-purple-600 hover:to-pink-700":"bg-gray-600 text-gray-300 cursor-not-allowed"]])},[i.value?(C(),D("span",x9,"⏳")):(C(),D("span",I9,"Activer les notifications"))],10,w9),d("button",{onClick:f[2]||(f[2]=g=>h.$emit("close")),class:"flex-1 px-6 py-3 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition-all duration-300 font-medium"}," Fermer ")])])),o.value?(C(),D("div",S9,[d("div",P9,ee(o.value),1)])):ie("",!0)])])):ie("",!0)}},C9={key:0,class:"fixed inset-0 z-[300] flex items-center justify-center p-4 bg-black/60"},k9={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center relative"},D9={class:"text-gray-300 mb-6"},N9={class:"font-semibold text-white"},O9={class:"bg-blue-500/20 border border-blue-500/30 rounded-lg p-4 mb-6"},V9={class:"flex items-start gap-3"},M9={class:"text-left flex-1"},L9={key:0,class:"mb-6 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},$9={class:"flex items-start gap-3"},F9={class:"text-left"},U9={class:"text-green-200 text-sm"},j9={class:"font-mono"},B9={class:"flex gap-3"},q9=["disabled"],z9={key:0,class:"animate-spin"},H9={key:1},K9={__name:"NotificationSuccessModal",props:{show:{type:Boolean,default:!1},playerName:{type:String,required:!0},email:{type:String,required:!0},seasonSlug:{type:String,required:!0},eventId:{type:String,default:null}},emits:["close","createPassword"],setup(n,{emit:e}){const t=n;da();const r=S(!1),s=S(!1);async function i(){s.value=!0;try{const{createUserWithEmailAndPassword:o,sendPasswordResetEmail:a}=await xt(()=>import("./index.esm-49aca4ca.js"),[]),{auth:l}=await xt(()=>Promise.resolve().then(()=>us),void 0);console.log("🚀 Tentative de création de compte pour:",t.email);const c={lastVisitedPage:window.location.pathname+window.location.search,timestamp:Date.now(),email:t.email};localStorage.setItem("pendingPasswordResetNavigation",JSON.stringify(c)),console.log("💾 Navigation sauvegardée pour redirection après reset:",c);const h="TempPass123!",f=await o(l,t.email,h);console.log("✅ Compte créé avec succès, UID:",f.user.uid),console.log("📧 Envoi de l'email de réinitialisation..."),await a(l,t.email),console.log("✅ Email de réinitialisation envoyé avec succès à",t.email),await l.signOut(),r.value=!0}catch(o){if(console.error("❌ Erreur lors de la création du compte:",o),o.code==="auth/email-already-in-use")try{console.log("📧 Utilisateur existant, envoi direct de l'email de réinitialisation...");const{sendPasswordResetEmail:a}=await xt(()=>import("./index.esm-49aca4ca.js"),[]),l={lastVisitedPage:window.location.pathname+window.location.search,timestamp:Date.now(),email:t.email};localStorage.setItem("pendingPasswordResetNavigation",JSON.stringify(l)),console.log("💾 Navigation sauvegardée pour utilisateur existant:",l),await a(auth,t.email),console.log("✅ Email de réinitialisation envoyé avec succès à",t.email),r.value=!0}catch(a){console.error("❌ Erreur lors de l'envoi de l'email de réinitialisation:",a)}else o.code==="auth/weak-password"?console.error("❌ Mot de passe temporaire trop faible"):o.code==="auth/invalid-email"?console.error("❌ Email invalide"):console.error("❌ Erreur inconnue:",o.message)}finally{s.value=!1}}return(o,a)=>n.show?(C(),D("div",C9,[d("div",k9,[d("button",{onClick:a[0]||(a[0]=l=>o.$emit("close")),class:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors duration-200 text-xl font-bold",title:"Fermer"}," ✖️ "),a[9]||(a[9]=d("div",{class:"w-20 h-20 rounded-full mx-auto mb-6 flex items-center justify-center bg-green-500"},[d("span",{class:"text-3xl"},"✅")],-1)),a[10]||(a[10]=d("h1",{class:"text-2xl font-bold text-white mb-4"},"Notifications activées !",-1)),d("p",D9,[a[2]||(a[2]=ut(" Nous enverrons désormais les alertes spectacle à ")),d("span",N9,ee(n.email),1)]),d("div",O9,[d("div",V9,[a[4]||(a[4]=d("span",{class:"text-blue-400 text-lg"},"💡",-1)),d("div",M9,[a[3]||(a[3]=d("p",{class:"text-blue-300 text-sm font-medium mb-3"}," Psst... tant que tu y es : ajoute un mot de passe pour sécuriser ton compte ! ",-1)),Be(ty,{inline:!0})])])]),r.value?(C(),D("div",L9,[d("div",$9,[a[8]||(a[8]=d("span",{class:"text-green-400 text-lg"},"✅",-1)),d("div",F9,[a[7]||(a[7]=d("p",{class:"text-green-300 text-sm font-medium mb-1"},"Email envoyé !",-1)),d("p",U9,[a[5]||(a[5]=ut(" Vérifie ta boîte mail à ")),d("span",j9,ee(n.email),1),a[6]||(a[6]=ut(" et clique sur le lien pour créer ton mot de passe. "))])])])])):ie("",!0),d("div",B9,[d("button",{onClick:i,class:cn(["flex-1 px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 font-medium",{"opacity-50 cursor-not-allowed":r.value||s.value}]),disabled:r.value||s.value},[s.value?(C(),D("span",z9,"⏳")):(C(),D("span",H9,"🔐 Créer mon mot de passe"))],10,q9),d("button",{onClick:a[1]||(a[1]=l=>o.$emit("close")),class:"flex-1 px-6 py-3 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition-all duration-300 font-medium"},ee(r.value?"Fermer":"Plus tard"),1)])])])):ie("",!0)}};const G9={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},W9={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},Q9={class:"flex items-stretch relative"},J9={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},Y9={class:"flex-1 overflow-hidden"},X9=["data-event-id"],Z9=["title","onClick"],ez={class:"flex flex-col items-center flex-1 justify-center"},tz={class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2 group-hover:text-purple-300 transition-colors duration-200"},nz={key:0,class:"mt-1 text-xs text-gray-400"},rz={class:"relative"},sz=["onClick","title"],iz={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},oz={class:"p-2"},az=["onClick"],lz=["onClick"],uz=["onClick"],cz={class:"flex flex-col items-center mt-2"},dz={key:0,class:"px-2 py-1 bg-gray-500/20 border border-gray-400/30 rounded-md mx-auto flex items-center justify-center",title:"Événement archivé"},hz=["title","onClick"],fz=["title","onClick"],pz=["title","onClick"],mz=["title","onClick"],gz=["title","aria-label"],vz={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},yz={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},_z={key:0,class:"pointer-events-none"},bz={class:"flex items-center justify-between"},wz={key:1,class:"pointer-events-none"},xz={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},Iz={class:"flex items-center justify-between"},Ez={key:2,class:"pointer-events-none"},Tz={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},Az={class:"flex items-center justify-between"},Sz={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},Pz=["data-player-id"],Rz={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},Cz={class:"px-4 md:px-5 font-bold text-xl md:text-2xl flex items-center w-full min-w-0"},kz={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Mon joueur"},Dz={key:1,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},Nz=["onClick","title"],Oz={class:"group-hover:text-purple-300 transition-colors duration-200"},Vz=["data-event-id"],Mz={class:"border-t border-white/10"},Lz={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},$z={class:"px-4 md:px-5 flex items-center"},Fz=["data-event-id"],Uz={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},jz={class:"text-center"},Bz={class:"text-white text-lg"},qz={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},zz={class:"text-white/60 text-xs mt-2"},Hz={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},Kz={class:"flex items-center space-x-2"},Gz={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},Wz={class:"flex items-center space-x-2"},Qz={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},Jz={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},Yz={class:"mb-6"},Xz={class:"mb-6"},Zz={class:"mb-6"},e8={class:"mb-6 flex items-center gap-3"},t8={class:"mb-6"},n8={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},r8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},s8={class:"mb-6"},i8={class:"flex justify-end space-x-3"},o8={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},a8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},l8={class:"flex justify-end space-x-3"},u8={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},c8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},d8={class:"flex justify-end space-x-3"},h8={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},f8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},p8={class:"text-center mb-6"},m8={class:"text-gray-300"},g8={key:0},v8={key:1},y8={class:"relative p-4 md:p-6 border-b border-white/10"},_8={class:"flex items-start gap-4 md:gap-6"},b8={class:"flex-1 min-w-0"},w8={class:"flex items-center gap-3 mb-2"},x8={class:"text-xl md:text-2xl font-bold text-white leading-tight"},I8={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},E8={class:"text-blue-200"},T8={class:"flex items-center gap-3 mb-3"},A8={class:"text-base md:text-lg text-purple-300"},S8={class:"relative"},P8={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},R8={class:"p-2"},C8={key:0,class:"text-sm text-gray-300 bg-gray-800/30 p-3 rounded-lg border border-gray-600/30"},k8={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},D8={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},N8={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},O8={class:"text-xl md:text-2xl font-bold text-white"},V8={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},M8={class:"text-xl md:text-2xl font-bold text-white"},L8={class:"p-3 md:p-4 rounded-lg border border-yellow-500/30 bg-yellow-500/10 text-center"},$8={class:"text-xl md:text-2xl font-bold text-yellow-300"},F8={key:0,class:"mb-4 md:mb-6"},U8={class:"mb-3 flex items-center"},j8=["title"],B8={class:"truncate"},q8={class:"space-y-0.5"},z8={class:"flex items-center min-w-0 gap-1.5"},H8={key:0,class:"text-yellow-400 mr-1 text-xs",title:"Mon joueur"},K8={key:1,class:"text-yellow-400 mr-1 text-xs",title:"Joueur protégé par mot de passe"},G8=["title"],W8={class:"flex-0 p-0"},Q8={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},J8=["disabled","title"],Y8=["title"],X8={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},Z8=["disabled","title"],eH={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},tH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},nH={class:"mb-6"},rH={class:"mb-6"},sH={class:"mb-6"},iH={class:"mb-6 flex items-center gap-3"},oH={class:"mb-6"},aH={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},lH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},uH={class:"mb-6"},cH={class:"space-y-4"},dH=["disabled"],hH={key:0,class:"animate-spin"},fH={key:1},pH={class:"mb-6 text-center"},mH={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},gH={class:"text-red-300 text-sm"},vH={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},yH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},_H={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},bH={class:"space-y-4"},wH={class:"mt-2 text-center"},xH={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},IH={class:"text-red-300 text-sm"},EH={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},TH=["disabled"],AH={key:0,class:"animate-spin"},SH={key:1},PH={class:"mb-6"},RH=["disabled"],CH={key:0,class:"animate-spin"},kH={key:1},DH={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},NH={class:"text-red-300 text-sm"},OH={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},VH={class:"text-green-300 text-sm"},MH={class:"flex justify-center"},LH={class:"mb-6"},$H=["disabled"],FH={key:0,class:"animate-spin"},UH={key:1},jH={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},BH={class:"text-red-300 text-sm"},qH={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},zH={class:"text-green-300 text-sm"},HH={class:"flex justify-center"},KH={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},GH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},WH={class:"flex gap-3"},Wb={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=da(),r=co(),s=e.slug,i=S(""),o=S(""),a=S({}),l=S(!1),c=S(!1),h=S(null),f=S(null),g=S(""),v=S(""),x=S(6),w=S(!1),I=S(""),$=S(null),L=S(null),U=S(null),q=S({position:null,side:null}),te=S({position:null}),X=S({position:null}),A=S(!1),b=S(null),T=S(!1),k=S(null),F=S(null),M=S(!1),R=S(null),Ke=S(""),ct=S(!1),dt=S(null),Ge=S(""),Ae=S(""),he=S(!1),Qe=S(null),le=S(!1),re=S(null),Ne=S(""),ht=S(""),Pt=S(!1),tn=S(null),Y=S(!1),xe=S(!1),ve=S(""),Pe=S(""),nt=S(!1),vt=S(!1),P=S(""),V=S(""),H=S(!1),K=S(null),Z=S(""),ue=S(!1),ge=S(!1),me=S(!1),ye=S(null),fe=S(null),Ve=S({position:"fixed",top:"0px",left:"0px"}),Te=S(null),ke=S({position:"fixed",top:"0px",left:"0px"}),Fe=S(null),Ue=S(!1),We=S(!1),rt=S(null),nn=S(!1),Bt=S(null);function On(){try{const _=ye.value;if(!_)return;const m=_.getBoundingClientRect(),O=8;if(window.innerWidth>768){const W=Math.max(O,Math.round(m.top-O)),oe=Math.max(O,Math.round(m.left));Ve.value={position:"fixed",top:`${W}px`,left:`${oe}px`,zIndex:400}}else{const W=Math.min(window.innerHeight-O,Math.round(m.bottom+O)),oe=Math.max(O,Math.round(m.left));Ve.value={position:"fixed",top:`${W}px`,left:`${oe}px`,zIndex:400}}}catch{}}function Jt(){try{const W=Math.max(8,window.innerHeight-8-48-200),oe=Math.max(8,Math.round(window.innerWidth-200-8));ke.value={position:"fixed",top:`${W}px`,left:`${oe}px`,zIndex:400}}catch{}}function Kr(){me.value=!me.value,me.value&&rn(()=>On())}function Vs(){ge.value=!ge.value,ge.value&&rn(()=>Jt())}function _n(_){Fe.value===_?Fe.value=null:Fe.value=_}function Pn(){Fe.value=null}function vi(){Ue.value=!Ue.value}function se(){Ue.value=!1}const j=S(!1),be=S(null),Le=S(null),Je=S(null),ze=S(0);function It(){var _;try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||Ze.value.length===0)return;const m=localStorage.getItem(`playerTourCompleted:${o.value}`);try{const W=((_=je==null?void 0:je.currentUser)==null?void 0:_.email)||"";W&&qf(W).then(async oe=>{const pe=oe.filter(ae=>ae.seasonId===o.value);if(pe.length>0){const ae=`seasonPreferredPlayer:${o.value}`,Re=localStorage.getItem(ae);let Ye=[];if(Re)if(Re.startsWith("["))try{Ye=JSON.parse(Re)||[]}catch{}else Ye=[Re];const lt=new Set(Ye);pe.forEach(un=>lt.add(un.playerId));const Ct=Array.from(lt);localStorage.setItem(ae,JSON.stringify(Ct))}}).catch(()=>{})}catch{}const O=localStorage.getItem(`startPlayerTour:${o.value}`);!m&&O&&(ze.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`),rn(()=>{const W=document.querySelector('button[data-onboarding="add-player"]');if(W){W.scrollIntoView({behavior:"smooth",block:"end"});const oe=W.getBoundingClientRect(),pe=document.getElementById("coachmark-add"),ae=280,Re=100,Ye=(pe==null?void 0:pe.offsetWidth)||ae,lt=(pe==null?void 0:pe.offsetHeight)||Re,Ct=Math.round(oe.right+12);if(Ct+Ye<=window.innerWidth-12){const wn=oe.top+oe.height/2-lt/2,xn=-14,Ot=12,Fr=window.innerHeight-lt-12,is=Math.max(Ot,Math.min(Math.round(wn+xn),Fr));q.value={position:{x:Ct,y:is},side:"right"}}else{const wn=Math.round(oe.left+oe.width/2-Ye/2),xn=Math.round(oe.top-lt-8),Ot=8,Fr=window.innerWidth-Ye-8;q.value={position:{x:Math.max(Ot,Math.min(wn,Fr)),y:xn},side:null}}}}))}catch{}}const yt=S(!1),Ut=S(null),Rn=S(null),Xn=S(!1),ot=S(null),Rt=S(!1),Zn=S(null),er=S(!1),bn=S(!1),yo=S(!1),ms=S(!1),gs=S(!1),Yl=S(!1),cd=S(null);function xa(){bn.value=!0}function Ia(){bn.value=!1}function Xl(){gs.value=!0}function Ea(){gs.value=!1}function vs(){Yl.value=!0}function dd(){Yl.value=!1}function Zl(){try{const _=je==null?void 0:je.currentUser;if(!_||_.isAnonymous){let m=null;if(ws.value&&ws.value.size>0){const O=ws.value.values().next().value;m=pt.value.find(W=>W.id===O)||null}m||(m=pt.value[0]||null),ms.value=!0,m&&(cd.value=m);return}}catch{}bn.value=!0}async function eu(){var _;try{const m=(_=je==null?void 0:je.currentUser)==null?void 0:_.email;if(!m)return;const{resetPlayerPassword:O}=await xt(()=>Promise.resolve().then(()=>us),void 0);await O(m),Me.value=!0,at.value="Email de réinitialisation envoyé.",setTimeout(()=>{Me.value=!1},3e3)}catch{Cn.value=!0,Ls.value="Impossible d'envoyer l'email de réinitialisation.",setTimeout(()=>{Cn.value=!1},3e3)}}async function Ta(){try{await B4(je),Ia(),Me.value=!0,at.value="Déconnecté de cet appareil.",setTimeout(()=>{Me.value=!1},2500)}catch{Cn.value=!0,Ls.value="Déconnexion impossible.",setTimeout(()=>{Cn.value=!1},3e3)}}async function hd(){alert("Suppression de compte: contactez l'organisateur pour dissocier vos joueurs. Fonction complète à venir.")}async function tu(_){var m;Ia();try{if(_.seasonId&&_.seasonId!==o.value){const O=_e(ne,"seasons",_.seasonId),oe=(await $t(tt(ne,"seasons"))).docs.find(ae=>ae.id===_.seasonId),pe=(m=oe==null?void 0:oe.data())==null?void 0:m.slug;if(pe){t.push(`/season/${pe}?player=${encodeURIComponent(_.playerId)}&open=protection`);return}}else{const O=pt.value.find(W=>W.id===_.playerId);if(O){Xf(O);return}t.push(`?player=${encodeURIComponent(_.playerId)}&open=protection`)}}catch{}}Tn(async()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}try{const m=window.location.pathname;if(m&&m!=="/"){const W=new URLSearchParams(window.location.search).get("email")||localStorage.getItem("hatcast_last_email");W&&(await Bo(W,m,{seasonSlug:e.slug,source:"grid_board"}),N.debug("Navigation trackée pour utilisateur non connecté:",{email:W,path:m}))}}catch(m){N.error("Erreur lors du tracking de navigation:",m)}const _=()=>{l.value=window.scrollY>10};return window.addEventListener("scroll",_,{passive:!0}),document.addEventListener("click",m=>{if(me.value){const O=ye.value,W=fe.value,oe=O&&O.contains(m.target),pe=W&&W.contains(m.target);!oe&&!pe&&(me.value=!1)}if(ge.value){const O=Te.value;O&&O.contains(m.target)||(ge.value=!1)}}),document.addEventListener("keydown",m=>{m.key==="Escape"&&(me.value&&(me.value=!1),ge.value&&(ge.value=!1))}),window.addEventListener("resize",()=>{me.value&&On(),ge.value&&Jt()}),window.addEventListener("scroll",()=>{me.value&&On(),ge.value&&Jt()},{passive:!0}),()=>{window.removeEventListener("scroll",_)}});function zf(){rn(()=>{nu()})}const Vr=S(new Set),ys=S(!0),Gr=S(0),Wr=S("Préparation de la grille"),tr=S(e.eventId||null),Aa=S(!1),Sa=S(null);kt(()=>e.eventId,_=>{if(_)if(tr.value=_,Ze.value.length>0)py(_);else{const m=kt(Ze,O=>{O.length>0&&(py(_),m())},{immediate:!0})}});const yi=qe(()=>pt.value.map(_=>({..._,isProtected:Vr.value.has(_.id),email:null}))),fd=qe(()=>tr.value?Tr.value.findIndex(_=>_.id===tr.value):-1);qe(()=>{if(!tr.value||fd.value===-1)return!1;if(window.innerWidth<=768){const _=document.querySelector(`[data-event-id="${tr.value}"]`);if(_){const m=_.getBoundingClientRect();return m.left>=0&&m.right<=window.innerWidth}}return!0});const Mr=S(null),Pa=S(!1),Ra=S(!1),Ca=S(0),pd=S(null),fr=S(null),ka=S(null);function Lr(){const _=Mr.value;if(!_)return;const{scrollLeft:m,scrollWidth:O,clientWidth:W}=_;Pa.value=m>2,Ra.value=m<O-W-2}function nu(){var _;try{Lr(),Ca.value=((_=Mr.value)==null?void 0:_.scrollLeft)||0}catch{}}function md(_){const m=Mr.value;if(!m)return;let O=0;const W=m.querySelector("tbody tr td[data-event-id]");if(W)O=W.getBoundingClientRect().width;else if(fr!=null&&fr.value){const pe=fr.value.querySelector(".col-event");pe&&(O=pe.getBoundingClientRect().width)}(!O||!isFinite(O))&&(O=m.clientWidth*.6);const oe=m.scrollLeft+_*O;m.scrollTo({left:oe,behavior:"smooth"})}const $r=S(null);S(0);const pr=S(!1),Ms=S(!1),ns=S(0);function ru(_,m){m&&typeof m.preventDefault=="function"&&m.preventDefault(),Ir(),md(_)}function Nt(_,m){if(m&&typeof m.preventDefault=="function"&&m.preventDefault(),pr.value)return;pr.value=!0,ns.value=_,Ms.value=!1;const O=Mr.value;if(!O)return;let W=0;const oe=O.querySelector("tbody tr td[data-event-id]");if(oe)W=oe.getBoundingClientRect().width;else if(fr!=null&&fr.value){const Ye=fr.value.querySelector(".col-event");Ye&&(W=Ye.getBoundingClientRect().width)}(!W||!isFinite(W))&&(W=O.clientWidth*.6);const pe=W/6,ae=120,Re=()=>{if(!pr.value||ns.value===0)return;Ms.value||(Ms.value=!0);const Ye=O.scrollLeft+ns.value*pe;O.scrollTo({left:Ye,behavior:"auto"}),$r.value=window.setTimeout(Re,ae)};$r.value=window.setTimeout(Re,250)}function Ir(_){_&&typeof _.preventDefault=="function"&&_.preventDefault();const m=pr.value,O=Ms.value;if(pr.value=!1,$r.value&&(clearTimeout($r.value),$r.value=null),_&&typeof _.type=="string"&&_.type.startsWith("touch")&&!O){const W=ns.value||0;W!==0&&md(W),ns.value=0;return}ns.value=0,m&&O&&_o()}function _o(){const _=Mr.value;if(!_)return;let m=0;const O=_.querySelector("tbody tr td[data-event-id]");if(O)m=O.getBoundingClientRect().width;else if(fr!=null&&fr.value){const ae=fr.value.querySelector(".col-event");ae&&(m=ae.getBoundingClientRect().width)}if(!m||!isFinite(m)||m<=0)return;const W=_.scrollLeft,pe=Math.round(W/m)*m;_.scrollTo({left:pe,behavior:"smooth"})}function bo(_){$.value=_;const m=document.querySelector(`[data-player-id="${_}"]`);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),Me.value=!0,at.value="Nouveau joueur ajouté !",setTimeout(()=>{Me.value=!1},3e3)}function Hf(){if(ze.value!==1)return;const _=document.querySelector('button[data-onboarding="add-player"]');if(!_)return;const m=_.getBoundingClientRect(),O=document.getElementById("coachmark-add"),W=280,oe=100,pe=O!=null&&O.offsetWidth&&O.offsetWidth>0?O.offsetWidth:W,ae=O!=null&&O.offsetHeight&&O.offsetHeight>0?O.offsetHeight:oe,Re=Math.round(m.right+12);if(Re+pe<=window.innerWidth-12){const lt=m.top+m.height/2-ae/2,un=su(lt+-14,ae);q.value={position:{x:Re,y:un},side:"right"}}else{const lt=Math.round(m.left+m.width/2-pe/2),Ct=su(m.top-ae-8,ae),un=8,wn=window.innerWidth-pe-8;q.value={position:{x:Math.max(un,Math.min(lt,wn)),y:Ct},side:null}}}function su(_,m){const O=pageHeaderRef==null?void 0:pageHeaderRef.value,W=O?Math.max(0,Math.round(O.getBoundingClientRect().height||0)):0,oe=Math.max(12,W+8),pe=window.innerHeight-m-12;return Math.max(oe,Math.min(Math.round(_),pe))}function Da(){var _;ze.value===1&&((_=q.value)!=null&&_.position)&&Hf()}Tn(()=>{window.addEventListener("scroll",Da,{passive:!0}),window.addEventListener("resize",Da)}),Js(()=>{window.removeEventListener("scroll",Da),window.removeEventListener("resize",Da)});function Na(_){return Vr.value.has(_)}async function iu(){if(o.value)try{const _=await jm(o.value),m=new Set;_.forEach(O=>{O.isProtected&&m.add(O.playerId||O.id)}),Vr.value=m}catch{const m=new Set;for(const O of pt.value)await Ji(O.id,o.value)&&m.add(O.id);Vr.value=m}}const Me=S(!1),at=S(""),Cn=S(!1),Ls=S("");function gd(){try{const _=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(_),Me.value=!0,at.value="Lien copié dans le presse-papiers",setTimeout(()=>{Me.value=!1},2500)}catch{Cn.value=!0,Ls.value="Impossible de copier le lien",setTimeout(()=>{Cn.value=!1},2500)}}async function ou(_){await St({type:"deleteEvent",data:{eventId:_}})}async function _i(_=null){const m=_||h.value;if(!m){console.error("Aucun événement à supprimer");return}try{await IU(m,o.value),Ze.value=Ze.value.filter(O=>O.id!==m),await Promise.all([Uh(o.value),Vo(pt.value,Ze.value,o.value),Mo(o.value)]).then(([O,W,oe])=>{Ze.value=O,ln.value=W,At.value=oe}),c.value=!1,h.value=null,Me.value=!0,at.value="Événement supprimé avec succès !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function Kf(){c.value=!1,h.value=null}async function au(){if(!f.value||!g.value.trim()||!v.value)return;const _=parseInt(x.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const m={title:g.value.trim(),date:v.value,description:Z.value.trim()||"",playerCount:_,archived:!!ue.value};await zb(f.value,m,o.value),!m.archived&&pt.value.length>0&&Vr.value.size>0&&(Zn.value={id:f.value,...m},Rt.value=!0),await Promise.all([Uh(o.value),Vo(pt.value,Ze.value,o.value),Mo(o.value)]).then(([O,W,oe])=>{Ze.value=O,ln.value=W,At.value=oe}),f.value=null,g.value="",v.value="",Z.value="",x.value=6,ue.value=!1,Me.value=!0,at.value="Événement mis à jour avec succès !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function Gf(){if(I.value.trim())try{const _=I.value.trim(),m=await m1(_,o.value);await Promise.all([rc(o.value),Vo(pt.value,Ze.value,o.value),Mo(o.value)]).then(([O,W,oe])=>{pt.value=O,ln.value=W,At.value=oe,iu();const pe=pt.value.find(Re=>Re.id===m);bo(m),L.value=m,U.value=Tr.value&&Tr.value[0]&&Tr.value[0].id?Tr.value[0].id:null;try{o.value&&localStorage.setItem(`lastAddedPlayerId:${o.value}`,m)}catch{}try{typeof ze<"u"&&(ze.value=2)}catch{}const ae=document.querySelector(`[data-player-id="${m}"]`);ae&&ae.scrollIntoView({behavior:"smooth",block:"center"}),rn(()=>{const Re=`[data-player-id="${L.value}"] td[data-event-id="${U.value}"]`,Ye=document.querySelector(Re);if(Ye){const lt=Ye.getBoundingClientRect();te.value.position={x:Math.round(lt.left),y:Math.round(lt.top+window.scrollY-48)}}}),Me.value=!0,at.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Me.value=!1},3e3),setTimeout(()=>{Me.value=!1,at.value=""},5e3)}),w.value=!1,I.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function Er(){f.value=null,g.value="",v.value="",Z.value="",x.value=6}S(null);const Oa=S(!1),bi=S(""),rs=S(""),_s=S(""),wi=S(6),bs=S(!1);async function wo(){if(!bi.value.trim()||!rs.value){alert("Veuillez remplir le titre et la date de l'événement");return}const _=parseInt(wi.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const m={title:bi.value.trim(),date:rs.value,description:_s.value.trim()||"",playerCount:_,archived:!!bs.value};await vd(m)}async function vd(_){try{const m=await EU(_,o.value);Ze.value=[...Ze.value,{id:m,..._}];const O={};for(const W of pt.value)O[W.name]=ln.value[W.name]||{},O[W.name][m]=null,await qb(W.name,O[W.name],o.value);bi.value="",rs.value="",_s.value="",wi.value=6,bs.value=!1,Oa.value=!1,await Promise.resolve(),Me.value=!0,at.value="Événement créé avec succès !",!_.archived&&pt.value.length>0&&Vr.value.size>0&&(Zn.value={id:m,..._},Rt.value=!0),setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function lu(){bi.value="",rs.value="",_s.value="",wi.value=6,Oa.value=!1}async function Yt(){await St({type:"addEvent",data:{}})}const Ze=S([]),pt=S([]),ln=S({}),At=S({}),yd=S({}),xi=S({});kt([()=>Ze.value.length,()=>pt.value.length,ys],()=>{ys.value||rn(()=>{nu()})}),kt([()=>pt.value.length,()=>Ze.value.length,o],()=>{It()}),Tn(async()=>{try{iy("firebase"),await p1();const m=Cc(tt(ne,"seasons"),kh("slug","==",e.slug)),O=await $t(m);if(O.empty){t.push("/seasons");return}else{const ae=O.docs[0];o.value=ae.id;const Re=ae.data();i.value=Re.name,a.value=Re,document.title=`Saison : ${i.value}`,H$(e.slug)}if(o.value){Wr.value="Chargement des événements de la saison",Gr.value=20;const ae=await $t(tt(ne,"seasons",o.value,"events"));Ze.value=ae.docs.map(Ot=>({id:Ot.id,...Ot.data(),playerCount:Ot.data().playerCount||6})),Wr.value="Chargement des joueurs",Gr.value=45;const Re=await $t(tt(ne,"seasons",o.value,"players"));pt.value=Re.docs.map(Ot=>({id:Ot.id,...Ot.data()})),Wr.value="Chargement des disponibilités",Gr.value=70;const Ye=await $t(tt(ne,"seasons",o.value,"availability")),lt={};Ye.docs.forEach(Ot=>{const Fr=Ot.data(),is={};Object.keys(Fr).forEach(Ao=>{const Ba=Fr[Ao];is[Ao]=Ba==="oui"?!0:Ba==="non"?!1:Ba}),lt[Ot.id]=is}),ln.value=lt,Wr.value="Chargement des sélections",Gr.value=85;const Ct=await $t(tt(ne,"seasons",o.value,"selections")),un={};Ct.docs.forEach(Ot=>{un[Ot.id]=Ot.data().players||[]}),At.value=un;const wn=await jm(o.value),xn=new Set;Array.isArray(wn)&&wn.forEach(Ot=>{Ot.isProtected&&xn.add(Ot.playerId||Ot.id)}),Vr.value=xn}const W=ae=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>ae()):setTimeout(ae,0)};Wr.value="Préparation de l'interface",Gr.value=95,W(()=>{vu(),Fa()}),await rn(),Gr.value=100,ys.value=!1,rn(()=>{Lr(),requestAnimationFrame(()=>Lr()),setTimeout(()=>Lr(),250);const ae=Mr.value;ae&&(ae.addEventListener("scroll",Re=>{Lr(),Ca.value=ae.scrollLeft||0},{passive:!0}),window.addEventListener("resize",Lr),typeof ResizeObserver<"u"&&(ka.value=new ResizeObserver(()=>{Lr()}),ka.value.observe(ae)))});const oe=r.query.event;if(oe&&Ze.value.length>0){const ae=Ze.value.find(Re=>Re.id===oe);ae?(await tp(oe,ae),r.query.modal==="event_details"&&Jf(ae)):(console.warn("Événement non trouvé avec l'ID"),Cn.value=!0,Ls.value="Événement non trouvé",setTimeout(()=>{Cn.value=!1},3e3))}const pe=r.query.player;if(pe&&pt.value.length>0){const ae=pt.value.find(Re=>Re.id===pe);ae&&(Xf(ae),await rn(),r.query.verified==="1"&&(Me.value=!0,at.value="Joueur associé à votre compte.",setTimeout(()=>{Me.value=!1},2500)))}if(r.query.notificationSuccess==="1")console.debug("✅ Paramètres notificationSuccess détectés"),Bt.value={email:decodeURIComponent(r.query.email||""),playerName:decodeURIComponent(r.query.playerName||""),eventId:r.query.eventId||null},setTimeout(()=>{nn.value=!0},100),t.replace({query:{...r.query,notificationSuccess:void 0,email:void 0,playerName:void 0,eventId:void 0}});else{const ae=new URLSearchParams(window.location.search),Re=ae.get("notificationSuccess"),Ye=ae.get("email"),lt=ae.get("playerName"),Ct=ae.get("eventId");Re==="1"&&(console.debug("✅ Paramètres détectés via fallback"),Bt.value={email:decodeURIComponent(Ye||""),playerName:decodeURIComponent(lt||""),eventId:Ct||null},setTimeout(()=>{nn.value=!0},100),t.replace({query:{...r.query,notificationSuccess:void 0,email:void 0,playerName:void 0,eventId:void 0}}))}}catch(_){console.error("Erreur lors du chargement de la grille:",_),Cn.value=!0,Ls.value="Erreur lors du chargement des données",setTimeout(()=>{Cn.value=!1},5e3),ys.value=!1}}),kt(()=>r.params.eventId,_=>{if(_){const m=()=>{const O=Ze.value.find(W=>W.id===_);return O?(Jf(O),!0):!1};if(Ze.value.length>0)m();else{const O=kt(Ze,W=>{W.length>0&&m()&&O()},{immediate:!0})}}},{immediate:!0});function uu(_){if(!_)return null;if(_ instanceof Date)return _;if(typeof(_==null?void 0:_.toDate)=="function")return _.toDate();if(typeof _=="string"||typeof _=="number"){const m=new Date(_);return isNaN(m.getTime())?null:m}return null}const nr=qe(()=>{let _=null;try{o.value&&(_=localStorage.getItem(`seasonPreferredPlayer:${o.value}`))}catch{}const m=[...pt.value].sort((ae,Re)=>(ae.name||"").localeCompare(Re.name||"","fr",{sensitivity:"base"}));if(!_)return m;let O=[];try{_.startsWith("[")?O=JSON.parse(_):_&&(O=[_])}catch{O=[]}const W=new Set(O);if(W.size===0)return m;const oe=m.filter(ae=>W.has(ae.id)),pe=m.filter(ae=>!W.has(ae.id));return[...oe,...pe]}),ws=qe(()=>{try{if(o.value){const _=localStorage.getItem(`seasonPreferredPlayer:${o.value}`);if(!_)return new Set;if(_.startsWith("[")){const m=JSON.parse(_);return new Set(Array.isArray(m)?m:[])}return new Set([_])}}catch{}return new Set}),Wf=qe(()=>[...Ze.value].sort((_,m)=>{const O=uu(_.date),W=uu(m.date),oe=O?O.getTime():Number.POSITIVE_INFINITY,pe=W?W.getTime():Number.POSITIVE_INFINITY;return oe!==pe?oe-pe:(_.title||"").localeCompare(m.title||"","fr",{sensitivity:"base"})})),Qr=S(!1),Tr=qe(()=>{const _=Wf.value;return Qr.value?_:_.filter(m=>!m.archived)});function cu(){Qr.value=!Qr.value}const Ii=S("selected"),_d=qe(()=>{var O;if(!K.value)return nr.value;const _=K.value.id,m=new Set(((O=At.value)==null?void 0:O[_])||[]);return nr.value.filter(W=>{var Re;const oe=W.name,pe=(Re=ln.value[oe])==null?void 0:Re[_],ae=m.has(oe);switch(Ii.value){case"selected":return ae;case"available":return pe===!0&&!ae;case"unavailable":return pe===!1;case"unknown":return pe!==!0&&pe!==!1;case"all":default:return!0}})}),Va=qe(()=>K.value?Eo(K.value.id):null),Qf=qe(()=>{if(!K.value)return!1;const _=Eo(K.value.id);return _.type==="incomplete"||_.type==="insufficient"}),du=qe(()=>K.value?_u(K.value.id):"");async function xs(_,m){const O=pt.value.find(pe=>pe.name===_);if(!O){console.error("Joueur non trouvé");return}const W=Ze.value.find(pe=>pe.id===m);if(!W){console.error("Événement non trouvé");return}if(W.archived){Me.value=!0,at.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Me.value=!1},3e3);return}if(Na(O.id)){const pe=Yo(O.id),ae=Je.value===O.id;pe||ae?(ae&&(Je.value=null),Ma(O,m)):(Le.value={playerName:_,eventId:m},be.value=O,j.value=!0);return}Ma(O,m)}function Ma(_,m){var oe,pe,ae;const O=(oe=ln.value[_.name])==null?void 0:oe[m];let W;O===!0?W=!1:O===!1?W=void 0:W=!0,W===void 0?ln.value[_.name]&&delete ln.value[_.name][m]:(ln.value[_.name]||(ln.value[_.name]={}),ln.value[_.name][m]=W);try{typeof ze<"u"&&ze.value===1&&_.id===(L.value||((pe=nr.value[0])==null?void 0:pe.id))&&m===(U.value||((ae=Tr.value[0])==null?void 0:ae.id))&&(ze.value=3,rn(()=>{const Ye=document.querySelector(`[data-player-id="${_.id}"]`);if(Ye){const lt=Ye.querySelector(".player-name");if(lt){const Ct=lt.getBoundingClientRect();X.value.position={x:Math.round(Ct.right+8),y:Math.round(Ct.top+window.scrollY-4)}}}}),Js(()=>{try{window.removeEventListener("resize",Lr)}catch{}try{ka.value&&ka.value.disconnect()}catch{}}))}catch{}qb(_.name,ln.value[_.name],o.value).then(async()=>{await rn(),Fa(),Me.value=!0,at.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Me.value=!1},3e3)}).catch(Re=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function mr(_,m){var O;return(O=ln.value[_])==null?void 0:O[m]}function hu(_,m){var oe;const O=At.value[m]||[],W=(oe=ln.value[_])==null?void 0:oe[m];return O.includes(_)&&W===!0}async function fu(_,m=6){const O=Ze.value.find(ae=>ae.id===_),W=(O==null?void 0:O.playerCount)||6,oe=At.value[_]||[];if(oe.length>0&&oe.every(ae=>mr(ae,_))){const Re=pt.value.filter(Ct=>mr(Ct.name,_)).map(Ct=>{const un=Ar(Ct.name);return{name:Ct.name,weight:1/(1+un)}}),Ye=[],lt=[...Re];for(;Ye.length<W&&lt.length>0;){const Ct=lt.reduce((xn,Ot)=>xn+Ot.weight,0);let un=Math.random()*Ct;const wn=lt.findIndex(xn=>(un-=xn.weight,un<=0));wn>=0&&(Ye.push(lt[wn].name),lt.splice(wn,1))}At.value[_]=Ye}else{const ae=oe.filter(Ye=>mr(Ye,_)),Re=W-ae.length;if(Re<=0)At.value[_]=ae;else{const Ye=new Set(ae),Ct=pt.value.filter(xn=>mr(xn.name,_)&&!Ye.has(xn.name)).map(xn=>{const Ot=Ar(xn.name);return{name:xn.name,weight:1/(1+Ot)}}),un=[],wn=[...Ct];for(;un.length<Re&&wn.length>0;){const xn=wn.reduce((is,Ao)=>is+Ao.weight,0);let Ot=Math.random()*xn;const Fr=wn.findIndex(is=>(Ot-=is.weight,Ot<=0));Fr>=0&&(un.push(wn[Fr].name),wn.splice(Fr,1))}At.value[_]=[...ae,...un]}}await qm(_,At.value[_],o.value),vu(),Fa()}async function pu(_,m=6){var ae,Re;const O=yt.value,W=(ae=Ut.value)==null?void 0:ae.id,oe=At.value[_]&&At.value[_].length>0,pe=oe?[...At.value[_]]:[];if(await fu(_,m),O&&!yt.value&&(yt.value=!0,Ut.value=Ze.value.find(Ye=>Ye.id===W)),yt.value&&((Re=Ut.value)==null?void 0:Re.id)===_){if(await rn(),Rn.value&&Rn.value.showSuccess){const Ye=At.value[_]||[],lt=pe.filter(un=>Ye.includes(un)),Ct=lt.length>0&&lt.length<pe.length;Rn.value.showSuccess(oe,Ct)}}else Me.value=!0,Ze.value.find(Ye=>Ye.id===_),At.value[_],oe?at.value="Sélection mise à jour avec succès !":at.value="Sélection effectuée avec succès !",setTimeout(()=>{Me.value=!1},3e3)}function Ei(_){_===0?q.value.position=null:_===1?te.value.position=null:_===2&&(X.value.position=null)}function bd(_){var O;return _?(typeof _=="string"?new Date(_):((O=_.toDate)==null?void 0:O.call(_))||_).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function mu(_){var O;return _?(typeof _=="string"?new Date(_):((O=_.toDate)==null?void 0:O.call(_))||_).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Ar(_){return Object.values(At.value).filter(m=>m.includes(_)).length}function La(_){const m=ln.value[_]||{};return Object.values(m).filter(O=>O===!0).length}function xo(_){return _?Object.values(ln.value).filter(m=>m[_]===!0).length:0}function Io(_){return _?(At.value[_]||[]).length:0}function gu(_){const m=Ze.value.find(W=>W.id===_),O=(m==null?void 0:m.playerCount)||6;return Io(_)>=O}function $a(_){const m=La(_),O=Ar(_);return m===0?0:O/m}function gr(_){yd.value[_]={availability:La(_),selection:Ar(_),ratio:$a(_)}}function vu(){pt.value.forEach(_=>gr(_.name))}function Fa(){const _={};Ze.value.forEach(m=>{const O=m.playerCount||6,oe=pt.value.filter(ae=>mr(ae.name,m.id)===!0).map(ae=>{const Re=Ar(ae.name);return{name:ae.name,weight:1/(1+Re)}}),pe=oe.reduce((ae,Re)=>ae+Re.weight,0);oe.forEach(ae=>{const Re=Math.min(1,ae.weight/pe*O);_[ae.name]||(_[ae.name]={}),_[ae.name][m.id]=Math.round(Re*100)})}),xi.value=_}const ss=S(null),u=S(!1);async function p(_=null){const m=_||ss.value;if(!m){console.error("Aucun joueur à supprimer");return}try{await bU(m,o.value),pt.value=pt.value.filter(O=>O.id!==m),u.value=!1,ss.value=null,Me.value=!0,at.value="Joueur supprimé avec succès !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function y(){u.value=!1,ss.value=null}async function E(_){cy(),await Ji(_,o.value)?await Vn({type:"deletePlayer",data:{playerId:_}}):await St({type:"deletePlayer",data:{playerId:_}})}async function B(){if(b.value){const _=Ze.value.find(O=>O.id===b.value),m=(_==null?void 0:_.playerCount)||6;await pu(b.value,m),A.value=!1,b.value=null}}function J(){A.value=!1,b.value=null}function Ie(){return R.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis",updateSelection:"Mise à jour de sélection - Code PIN requis"}[R.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function St(_){if(Hn.isPinCached(o.value)){const m=Hn.getCachedPin(o.value);if(await Mh(o.value,m)){await Ai(_);return}else Hn.clearSession()}R.value=_,M.value=!0}async function Vn(_){const m=_.data.playerId;try{if(Hn.isPinCached(o.value)){await Ai(_);return}}catch{}if(Yo(m)){await Ai(_);return}dt.value=_,ct.value=!0}async function Et(_){try{if(await Mh(o.value,_)){Hn.saveSession(o.value,_),M.value=!1;const O=R.value;R.value=null,await Ai(O)}else Ke.value="Code PIN incorrect",setTimeout(()=>{Ke.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),Ke.value="Erreur lors de la vérification du code PIN"}}function Fn(){M.value=!1,R.value=null,Ke.value=""}async function Mn(_){if(_){he.value=!0,Ge.value="";try{const m=dt.value.data.playerId,O=await Lm(o.value);if(_===O){try{Hn.saveSession(o.value,_)}catch{}try{lo.saveSession(dt.value.data.playerId)}catch{}ct.value=!1;const oe=dt.value;dt.value=null,Ae.value="",await Ai(oe);return}if(await verifyPlayerPassword(m,_,o.value)){ct.value=!1;const oe=dt.value;dt.value=null,Ae.value="",await Ai(oe)}else Ge.value="Mot de passe incorrect",setTimeout(()=>{Ge.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),Ge.value="Erreur lors de la vérification du mot de passe"}finally{he.value=!1}}}function Ti(){ct.value=!1,dt.value=null,Ge.value="",Ae.value="",he.value=!1}async function Sr(_){if(_){Pt.value=!0,Ne.value="";try{const m=re.value.data.player,O=await Lm(o.value);if(_===O){try{Hn.saveSession(o.value,_)}catch{}try{lo.saveSession(re.value.data.player.id)}catch{}le.value=!1;const oe=re.value;re.value=null,ht.value="",await Ai(oe);return}if(await verifyPlayerPassword(m.id,_,o.value)){le.value=!1;const oe=re.value;re.value=null,ht.value="",await Ai(oe)}else Ne.value="Mot de passe incorrect",setTimeout(()=>{Ne.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),Ne.value="Erreur lors de la vérification du mot de passe"}finally{Pt.value=!1}}}function Ua(){le.value=!1,re.value=null,Ne.value="",ht.value="",Pt.value=!1}async function yu(){xe.value=!0,ve.value="",Pe.value="";try{const _=re.value.data.player,m=await sendPasswordResetEmail(_.id,o.value);Pe.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),ve.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{xe.value=!1}}async function T1(){vt.value=!0,P.value="",V.value="";try{const _=dt.value.data.playerId,m=await sendPasswordResetEmail(_,o.value);V.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),P.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{vt.value=!1}}function A1(){return Hn.isPinCached(o.value)?{timeRemaining:Hn.getTimeRemaining(),isExpiringSoon:Hn.isExpiringSoon()}:null}async function Ai(_){var W;if(!_)return;const{type:m,data:O}=_;try{switch(m){case"deleteEvent":h.value=O.eventId,c.value=!0;break;case"addEvent":Oa.value=!0;break;case"deletePlayer":ss.value=O.playerId,u.value=!0;break;case"launchSelection":At.value[O.eventId]&&At.value[O.eventId].length>0?(b.value=O.eventId,A.value=!0,H.value=!1):(await pu(O.eventId,O.count),H.value=!1);break;case"toggleAvailability":Ma(O.player,O.eventId);break;case"toggleArchive":await setEventArchived(O.eventId,O.archived,o.value);{const oe=Ze.value.findIndex(pe=>pe.id===O.eventId);oe!==-1&&(Ze.value[oe]={...Ze.value[oe],archived:!!O.archived}),ue.value=!!O.archived}break;case"updateSelection":{const{eventId:oe,players:pe}=O,ae=[...At.value[oe]||[]],Re=Array.isArray(pe)?pe:[];await qm(oe,Re,o.value),At.value[oe]=Re;try{const Ye=ae.filter(lt=>!Re.includes(lt));if(Ye.length>0){const lt=Ze.value.find(Ct=>Ct.id===oe);await KF({eventId:oe,eventData:lt,removedPlayers:Ye,newSelectedPlayers:Re,seasonId:o.value,seasonSlug:s,players:yi.value})}}catch{}try{(W=Rn.value)==null||W.showSuccess(!0,!0)}catch{}}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),Me.value=!0,at.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Me.value=!1},3e3)}}function S1(){t.push("/seasons")}Js(()=>{const _=Mr.value;_&&_.removeEventListener("scroll",Lr),window.removeEventListener("resize",Lr)});async function Jf(_){K.value=_,Z.value=_.description||"",ue.value=!!_.archived;const m=`/season/${e.slug}?event=${_.id}&modal=event_details`;t.push(m);try{const O=getCurrentUserId();O&&(await Bo(O,m,{seasonSlug:e.slug,eventId:_.id,eventTitle:_.title,navigationType:"event_details",context:{currentPage:m,timestamp:new Date().toISOString()}}),N.debug("État de navigation événement tracké:",{eventId:_.id,userId:O,url:m}))}catch(O){N.error("Erreur lors du tracking de l'état de navigation:",O)}try{const[O,W]=await Promise.all([Vo(pt.value,Ze.value,o.value),Mo(o.value)]);ln.value=O,At.value=W}catch(O){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",O)}H.value=!0}function Yf(){H.value=!1,K.value=null,Z.value="",ge.value=!1,me.value=!1,Pn(),se(),Ve.value={position:"fixed",top:"0px",left:"0px"},ke.value={position:"fixed",top:"0px",left:"0px"};const _=`/season/${e.slug}`;if(r.path!==_){t.push(_);try{const m=getCurrentUserId();m&&(Bo(m,_,{seasonSlug:e.slug,navigationType:"season_overview",context:{previousPage:r.path,timestamp:new Date().toISOString()}}),N.debug("Retour à la vue d'ensemble tracké:",{userId:m,url:_}))}catch(m){N.error("Erreur lors du tracking du retour à la vue d'ensemble:",m)}}}function ja(_,m=null){const O=m||K.value;if(O)try{Q5(_,O,i.value),Me.value=!0,_==="ics"?at.value="Fichier .ics téléchargé ! Importez-le dans votre agenda":_==="google"?at.value="Google Calendar ouvert dans un nouvel onglet":_==="outlook"&&(at.value="Outlook ouvert dans un nouvel onglet"),setTimeout(()=>{Me.value=!1},3e3)}catch(W){console.error("Erreur lors de l'ajout au calendrier:",W),Me.value=!0,at.value="Erreur lors de l'ajout au calendrier",setTimeout(()=>{Me.value=!1},3e3)}}function ay(){Yf(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function P1(_,m){var pe;const O=pt.value.find(ae=>ae.name===_);if(!O){console.error("Joueur non trouvé");return}const W=Ze.value.find(ae=>ae.id===m);if(W!=null&&W.archived){Me.value=!0,at.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Me.value=!1},3e3);return}if(!((pe=je.currentUser)!=null&&pe.email))if(g1()){rt.value={playerName:_,eventTitle:(W==null?void 0:W.title)||"cet événement",eventId:m},We.value=!0;return}else{ms.value=!0;return}if(Na(O.id)){Yo(O.id)?await xs(_,m):(Le.value={playerName:_,eventId:m},be.value=O,j.value=!0);return}await xs(_,m)}function R1(_,m){return(At.value[m]||[]).includes(_)}async function C1(_){if(be.value&&(Je.value=be.value.id),Le.value){const{playerName:m,eventId:O}=Le.value;await xs(m,O),Le.value=null}j.value=!1,be.value=null}function ly(){f.value=K.value.id,g.value=K.value.title,v.value=K.value.date,Z.value=K.value.description||"",x.value=K.value.playerCount||6,H.value=!1}async function uy(){if(K.value)try{const _=!K.value.archived,m={...K.value,archived:_};await zb(K.value.id,m,o.value),K.value.archived=_;const O=Ze.value.findIndex(W=>W.id===K.value.id);O!==-1&&(Ze.value[O].archived=_),Me.value=!0,at.value=_?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function Xf(_){k.value=_,T.value=!0;const m=`/season/${e.slug}?player=${_.id}&modal=player_details`;t.push(m);try{const O=getCurrentUserId();O&&(Bo(O,m,{seasonSlug:e.slug,playerId:_.id,playerName:_.name,navigationType:"player_details",context:{currentPage:m,timestamp:new Date().toISOString()}}),N.debug("État de navigation joueur tracké:",{playerId:_.id,userId:O,url:m}))}catch(O){N.error("Erreur lors du tracking de l'état de navigation joueur:",O)}try{typeof ze<"u"&&ze.value}catch{}}function cy(){T.value=!1,k.value=null;const _=`/season/${e.slug}`;if(r.path!==_){t.push(_);try{const m=getCurrentUserId();m&&(Bo(m,_,{seasonSlug:e.slug,navigationType:"season_overview",context:{previousPage:r.path,timestamp:new Date().toISOString()}}),N.debug("Retour à la vue d'ensemble tracké:",{userId:m,url:_}))}catch(m){N.error("Erreur lors du tracking du retour à la vue d'ensemble:",m)}}}async function k1({playerId:_,newName:m}){try{await wU(_,m,o.value),await Promise.all([rc(o.value),Vo(pt.value,Ze.value,o.value),Mo(o.value)]).then(([O,W,oe])=>{if(pt.value=O,ln.value=W,At.value=oe,iu(),k.value&&k.value.id===_){const pe=O.find(ae=>ae.id===_);pe&&(k.value=pe)}}),Me.value=!0,at.value="Joueur mis à jour avec succès !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function D1(){try{await Promise.all([rc(o.value),Vo(pt.value,Ze.value,o.value),Mo(o.value)]).then(([_,m,O])=>{if(pt.value=_,ln.value=m,At.value=O,iu(),k.value){const W=_.find(oe=>oe.id===k.value.id);W&&(k.value=W)}}),Me.value=!0,at.value="Données mises à jour !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function N1(_){if(!_)return{availability:0,selection:0,ratio:0};const m=La(_.name),O=Ar(_.name),W=m===0?0:Math.round(O/m*100);return{availability:m,selection:O,ratio:W}}function Eo(_){const m=At.value[_]||[],O=Ze.value.find(pe=>pe.id===_),W=(O==null?void 0:O.playerCount)||6,oe=xo(_);if(m.length>0){const pe=m.some(Re=>!mr(Re,_)),ae=oe<W;if(pe||ae)return{type:"incomplete",hasUnavailablePlayers:pe,hasInsufficientPlayers:ae,unavailablePlayers:m.filter(Re=>!mr(Re,_)),availableCount:oe,requiredCount:W}}return oe<W?{type:"insufficient",availableCount:oe,requiredCount:W}:m.length===0?{type:"ready",availableCount:oe,requiredCount:W}:{type:"complete",availableCount:oe,requiredCount:W}}function _u(_){const m=Eo(_);switch(m.type){case"incomplete":return m.hasUnavailablePlayers?m.unavailablePlayers.length===1?`Sélection incomplète : ${m.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${m.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${m.availableCount} joueurs disponibles pour ${m.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${m.availableCount} disponibles pour ${m.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${m.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${m.availableCount} joueurs disponibles`;default:return""}}async function O1(){const _=[];for(const m of pt.value){if(!await Ji(m.id,o.value))continue;const W=await a1(m.id,o.value);W&&_.push({...m,email:W})}return _}function wd(_){if(_!=null&&_.archived){Me.value=!0,at.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{Me.value=!1},3e3);return}dy(),ot.value=_,Xn.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","announce"),m.set("event",(_==null?void 0:_.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function V1(){Xn.value=!1,ot.value=null;try{const _=new URLSearchParams(window.location.search);_.get("modal")==="announce"&&(_.delete("modal"),_.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${_.toString()}`))}catch{}}function dy(){Rt.value=!1,Zn.value=null}const Zf=S(!1);async function hy({eventId:_,eventData:m,reason:O,selectedPlayers:W,scope:oe="all",recipient:pe=null}){Zf.value=!0;try{O==="selection"?(oe==="single"&&(pe!=null&&pe.email)?await Kb({eventId:_,eventData:m,selectedPlayers:[pe.name],seasonId:o.value,seasonSlug:s,players:yi.value}):await Kb({eventId:_,eventData:m,selectedPlayers:W,seasonId:o.value,seasonSlug:s,players:yi.value}),Me.value=!0,at.value=oe==="single"?`Notification envoyée à ${(pe==null?void 0:pe.name)||"1 joueur"}`:"Notifications de sélection envoyées à tous les joueurs sélectionnés !",setTimeout(()=>{Me.value=!1},3e3)):(oe==="single"&&(pe!=null&&pe.email)?await Hb({eventId:_,eventData:m,players:[pe],seasonId:o.value,seasonSlug:s,createMagicLink:$h,reminder:!1,getAvailabilityForEvent:(ae,Re)=>mr(ae,Re)}):await Hb({eventId:_,eventData:m,players:await O1(),seasonId:o.value,seasonSlug:s,createMagicLink:$h,reminder:!1,getAvailabilityForEvent:(ae,Re)=>mr(ae,Re)}),Me.value=!0,at.value=oe==="single"?`Notification envoyée à ${(pe==null?void 0:pe.name)||"1 joueur"}`:"Notifications envoyées à tous les joueurs protégés !",setTimeout(()=>{Me.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),Me.value=!0,at.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Me.value=!1},3e3)}Zf.value=!1}function ep(_){if(!_)return{};const m={};return pt.value.forEach(O=>{m[O.name]=mr(O.name,_)}),m}function To(_){if(_!=null&&_.archived){Me.value=!0,at.value="Impossible d'ouvrir la sélection sur un événement archivé",setTimeout(()=>{Me.value=!1},3e3);return}Ut.value=_,yt.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","selection"),m.set("event",(_==null?void 0:_.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function fy(){yt.value=!1,Ut.value=null;try{const _=new URLSearchParams(window.location.search);_.get("modal")==="selection"&&(_.delete("modal"),_.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${_.toString()}`))}catch{}}async function M1(){if(!Ut.value)return;const _=Ut.value.id,m=Ut.value.playerCount||6;if(xo(_)===0){Me.value=!0,at.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Me.value=!1},3e3);return}await St({type:"launchSelection",data:{eventId:_,count:m}})}function L1(){fy(),Me.value=!0,at.value="Sélection validée !",setTimeout(()=>{Me.value=!1},3e3)}async function $1(_){if(!_||!_.eventId)return;const{eventId:m,players:O}=_;await St({type:"updateSelection",data:{eventId:m,players:O}})}async function tp(_,m){if(!_||!m)return;my(),tr.value=_,Aa.value=!0,await rn();const O=document.querySelector(`[data-event-id="${_}"]`);if(!O){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(ae=>{ae.classList.remove("focused-event-highlight")});const W=document.querySelectorAll(`[data-event-id="${_}"]`);W.forEach(ae=>{ae.classList.add("focused-event-highlight")});const oe=W[0],pe=W[W.length-1];oe&&oe.classList.add("focused-event-column-start"),pe&&pe.classList.add("focused-event-column-end"),await F1(O),Me.value=!0,at.value=`Événement ciblé : ${m.title}`,setTimeout(()=>{Me.value=!1},4e3),Sa.value=setTimeout(()=>{my()},8e3)}function py(_){if(!_)return;const m=Ze.value.find(O=>O.id===_);if(!m){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const O=Ze.value.find(W=>W.id===_);O?tp(_,O):console.error("Événement toujours introuvable après retry")},500);return}tp(_,m)}kt(Ze,_=>{try{const m=new URLSearchParams(window.location.search),O=m.get("modal"),W=m.get("event");if(!O||!W)return;const oe=_.find(pe=>pe.id===W);if(!oe)return;O==="announce"&&wd(oe),O==="selection"&&To(oe)}catch{}},{immediate:!0});async function F1(_){if(!_)return;if(await new Promise(O=>setTimeout(O,100)),window.innerWidth<=768){const O=Mr.value;if(O){const W=_.offsetLeft,oe=_.offsetWidth,pe=O.clientWidth,ae=W-pe/2+oe/2,Re=O.scrollWidth-pe,Ye=Math.max(0,Math.min(ae,Re));O.scrollTo({left:Ye,behavior:"smooth"}),setTimeout(()=>{const lt=_.getBoundingClientRect();if(lt.left<0||lt.right>window.innerWidth){const Ct=W-20;O.scrollTo({left:Math.max(0,Ct),behavior:"smooth"})}},500)}}else _.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const m=Mr.value;m&&setTimeout(()=>{const O=document.querySelector(`[data-event-id="${tr.value}"]`);if(O&&O.closest("tbody")){const W=O.offsetLeft,oe=O.offsetWidth,pe=m.clientWidth,ae=W-pe/2+oe/2,Re=m.scrollWidth-pe,Ye=Math.max(0,Math.min(ae,Re));m.scrollTo({left:Ye,behavior:"smooth"})}},300)}function my(){Sa.value&&(clearTimeout(Sa.value),Sa.value=null),tr.value=null,Aa.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(_=>{_.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(_=>{_.classList.remove("focused-event-column-start","focused-event-column-end")})}function U1(_){We.value=!1,rt.value=null,Me.value=!0,_.directActivation?at.value=`Notifications activées directement pour ${_.playerName} !`:at.value=`Email envoyé à ${_.email} pour activer les notifications !`,setTimeout(()=>{Me.value=!1},4e3),N.info("Activation des notifications terminée avec succès",_)}return(_,m)=>{var O,W,oe,pe,ae,Re,Ye,lt,Ct,un,wn,xn,Ot,Fr,is,Ao,Ba,gy,vy,yy,_y,by,wy,xy,Iy,Ey,Ty,Ay,Sy,Py;return C(),D(mt,null,[d("div",G9,[Be(u9,{"season-name":i.value,"is-scrolled":l.value,onGoBack:S1,onOpenAccountMenu:xa,onOpenHelp:m[0]||(m[0]=G=>er.value=!0),onOpenNotifications:Xl,onOpenPlayers:vs,onLogout:Ta,onOpenLogin:Zl,onOpenAccount:Zl},null,8,["season-name","is-scrolled"]),d("div",W9,[d("div",{ref_key:"headerBarRef",ref:pd,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[d("div",Q9,[Ze.value.length===0&&pt.value.length===0?ie("",!0):(C(),D("div",J9,[d("div",{class:"flex items-center justify-center h-full gap-2"},[d("button",{onClick:Yt,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},m[76]||(m[76]=[d("span",{class:"text-lg"},"➕",-1),d("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),d("span",{class:"sm:hidden"},"Événement",-1)]))])])),d("div",Y9,[d("div",{ref_key:"headerEventsRef",ref:fr,class:"flex relative z-[60]",style:Ur({transform:`translateX(-${Ca.value}px)`})},[(C(!0),D(mt,null,jr(Tr.value,G=>(C(),D("div",{key:"h-"+G.id,"data-event-id":G.id,class:cn(["col-event flex-shrink-0 p-3 text-center flex flex-col justify-between",{"archived-header":G.archived}])},[d("div",{class:"flex flex-col items-center justify-between p-2 rounded-lg hover:bg-white/10 transition-colors duration-200 cursor-pointer group h-24",title:G.title+" - Cliquez pour voir les détails",onClick:ft(fn=>Jf(G),["stop"])},[d("div",ez,[d("div",tz,ee(G.title||"Sans titre"),1),G.archived?(C(),D("div",nz,"(Archivé)")):ie("",!0)]),d("div",rz,[d("div",{onClick:ft(fn=>_n(G.id),["stop"]),class:"header-date text-[16px] md:text-base text-gray-300 group-hover:text-purple-200 transition-colors duration-200 cursor-pointer hover:bg-white/10 px-2 py-1 rounded",title:mu(G.date)+" - Cliquez pour ajouter à votre agenda"},ee(bd(G.date)),9,sz),Fe.value===G.id?(C(),D("div",iz,[d("div",oz,[d("button",{onClick:ft(fn=>{ja("google",G),Pn()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},m[77]||(m[77]=[d("span",null,"🌐",-1),d("span",null,"Google Calendar",-1)]),8,az),d("button",{onClick:ft(fn=>{ja("outlook",G),Pn()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},m[78]||(m[78]=[d("span",null,"📧",-1),d("span",null,"Outlook",-1)]),8,lz),d("button",{onClick:ft(fn=>{ja("ics",G),Pn()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},m[79]||(m[79]=[d("span",null,"📥",-1),d("span",null,"Télécharger (.ics)",-1)]),8,uz)])])):ie("",!0)])],8,Z9),d("div",cz,[G.archived?(C(),D("div",dz,m[80]||(m[80]=[d("span",{class:"text-xs text-gray-300 font-medium"},"📁",-1),d("span",{class:"text-xs text-gray-200 font-medium ml-1"},"Archivé",-1)]))):Eo(G.id).type==="ready"?(C(),D("div",{key:1,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-blue-500/30 transition-colors duration-200 cursor-pointer group",title:_u(G.id)+" - Cliquez pour ouvrir la sélection",onClick:ft(fn=>To(G),["stop"])},m[81]||(m[81]=[d("span",{class:"text-xs text-blue-300 font-medium group-hover:text-blue-200"},"🆕",-1),d("span",{class:"text-xs text-blue-200 font-medium ml-1 group-hover:text-blue-100"},"Nouveau",-1)]),8,hz)):Eo(G.id).type==="complete"?(C(),D("div",{key:2,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-green-500/30 transition-colors duration-200 cursor-pointer group",title:_u(G.id)+" - Cliquez pour ouvrir la sélection",onClick:ft(fn=>To(G),["stop"])},m[82]||(m[82]=[d("span",{class:"text-xs text-green-300 font-medium group-hover:text-green-200"},"✅",-1),d("span",{class:"text-xs text-green-200 font-medium ml-1 group-hover:text-green-100"},"Complet",-1)]),8,fz)):Eo(G.id).type==="incomplete"?(C(),D("div",{key:3,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-orange-500/30 transition-colors duration-200 cursor-pointer group",title:_u(G.id)+" - Cliquez pour ouvrir la sélection",onClick:ft(fn=>To(G),["stop"])},m[83]||(m[83]=[d("span",{class:"text-xs text-orange-300 font-medium group-hover:text-orange-200"},"⚠️",-1),d("span",{class:"text-xs text-orange-200 font-medium ml-1 group-hover:text-orange-100"},"À finaliser",-1)]),8,pz)):Eo(G.id).type==="insufficient"?(C(),D("div",{key:4,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-red-500/30 transition-colors duration-200 cursor-pointer group",title:_u(G.id)+" - Cliquez pour ouvrir la sélection",onClick:ft(fn=>To(G),["stop"])},m[84]||(m[84]=[d("span",{class:"text-xs text-red-300 font-medium group-hover:text-red-200"},"❌",-1),d("span",{class:"text-xs text-red-200 font-medium ml-1 group-hover:text-red-100"},"Manque",-1)]),8,mz)):ie("",!0)])],10,X9))),128))],4)]),m[87]||(m[87]=d("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),d("button",{onClick:cu,class:"absolute right-2 top-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[86] backdrop-blur-sm",title:Qr.value?"Masquer les événements archivés":"Afficher les événements archivés","aria-label":Qr.value?"Masquer les événements archivés":"Afficher les événements archivés"},[(C(),D("svg",vz,[m[85]||(m[85]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),m[86]||(m[86]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),Qr.value?ie("",!0):(C(),D("path",yz))]))],8,gz),st(d("button",{onClick:m[1]||(m[1]=ft(G=>ru(-1,G),["prevent"])),onMousedown:m[2]||(m[2]=ft(G=>Nt(-1,G),["prevent"])),onMouseup:m[3]||(m[3]=G=>Ir(G)),onMouseleave:m[4]||(m[4]=G=>Ir(G)),onTouchstart:m[5]||(m[5]=ft(G=>Nt(-1,G),["prevent"])),onTouchend:m[6]||(m[6]=G=>Ir(G)),onTouchcancel:m[7]||(m[7]=G=>Ir(G)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[fp,Pa.value]]),st(d("button",{onClick:m[8]||(m[8]=ft(G=>ru(1,G),["prevent"])),onMousedown:m[9]||(m[9]=ft(G=>Nt(1,G),["prevent"])),onMouseup:m[10]||(m[10]=G=>Ir(G)),onMouseleave:m[11]||(m[11]=G=>Ir(G)),onTouchstart:m[12]||(m[12]=ft(G=>Nt(1,G),["prevent"])),onTouchend:m[13]||(m[13]=G=>Ir(G)),onTouchcancel:m[14]||(m[14]=G=>Ir(G)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[fp,Ra.value]])])],512),st(d("div",{ref_key:"gridboardRef",ref:Mr,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[ze.value===1?(C(),D("div",_z,[q.value.position?(C(),D("div",{key:0,class:"fixed z-[400]",style:Ur({left:q.value.position.x+"px",top:q.value.position.y+"px"})},[d("div",{id:"coachmark-add",class:cn(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":q.value.side==="right","coachmark-left":q.value.side==="left"}])},[m[89]||(m[89]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),m[90]||(m[90]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),d("div",bz,[m[88]||(m[88]=d("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),d("button",{onClick:m[15]||(m[15]=G=>Ei(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):ie("",!0)])):ie("",!0),ze.value===2&&L.value&&U.value?(C(),D("div",wz,[te.value.position?(C(),D("div",{key:0,class:"fixed z-[400]",style:Ur({position:"absolute",left:te.value.position.x+"px",top:te.value.position.y+"px"})},[d("div",xz,[m[92]||(m[92]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),m[93]||(m[93]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),d("div",Iz,[m[91]||(m[91]=d("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),d("button",{onClick:m[16]||(m[16]=G=>Ei(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ie("",!0)])):ie("",!0),ze.value===3&&L.value?(C(),D("div",Ez,[X.value.position?(C(),D("div",{key:0,class:"fixed z-[400]",style:Ur({position:"absolute",left:X.value.position.x+"px",top:X.value.position.y+"px"})},[d("div",Tz,[m[95]||(m[95]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),m[96]||(m[96]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),d("div",Az,[m[94]||(m[94]=d("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),d("button",{onClick:m[17]||(m[17]=G=>Ei(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ie("",!0)])):ie("",!0),d("table",Sz,[d("colgroup",null,[m[97]||(m[97]=d("col",{class:"col-left"},null,-1)),(C(!0),D(mt,null,jr(Tr.value,(G,fn)=>(C(),D("col",{key:"c"+fn,class:"col-event"}))),128)),m[98]||(m[98]=d("col",{class:"col-right"},null,-1))]),m[102]||(m[102]=d("thead",{class:"hidden"},null,-1)),d("tbody",null,[(C(!0),D(mt,null,jr(nr.value,G=>{var fn;return C(),D("tr",{key:G.id,class:cn(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":G.id===$.value,"preferred-player":ws.value.has(G.id)}]),"data-player-id":G.id},[d("td",Rz,[d("div",Cz,[ws.value.has(G.id)?(C(),D("span",kz," ⭐ ")):Na(G.id)?(C(),D("span",Dz," 🔒 ")):ie("",!0),d("div",{onClick:Pr=>Xf(G),class:cn(["player-name hover:bg-white/10 rounded-lg p-2 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight block truncate max-w-full flex-1 min-w-0 group",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":ze.value===3&&G.id===(L.value||((fn=nr.value[0])==null?void 0:fn.id))}]),title:"Cliquez pour voir les détails : "+G.name},[d("span",Oz,ee(G.name),1)],10,Nz)])]),(C(!0),D(mt,null,jr(Tr.value,Pr=>{var Ry,Cy,ky;return C(),D("td",{key:Pr.id,"data-event-id":Pr.id,class:cn(["p-0",Pr.archived?"archived-col":"",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":ze.value===2&&G.id===(L.value||((Ry=nr.value[0])==null?void 0:Ry.id))&&Pr.id===(U.value||((Cy=Tr.value[0])==null?void 0:Cy.id))}])},[Be(Gb,{"player-name":G.name,"event-id":Pr.id,"is-available":mr(G.name,Pr.id),"is-selected":hu(G.name,Pr.id),"chance-percent":((ky=xi.value[G.name])==null?void 0:ky[Pr.id])??null,"show-selected-chance":gu(Pr.id),disabled:Pr.archived===!0,onToggle:xs},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])],10,Vz)}),128)),m[99]||(m[99]=d("td",{class:"p-3 md:p-4"},null,-1))],10,Pz)}),128)),d("tr",Mz,[d("td",Lz,[d("div",$z,[d("button",{onClick:m[18]||(m[18]=G=>w.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},m[100]||(m[100]=[d("span",{class:"text-lg"},"➕",-1),d("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),d("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(C(!0),D(mt,null,jr(Tr.value,G=>(C(),D("td",{key:"add-row-"+G.id,"data-event-id":G.id,class:cn(["p-3 md:p-5",G.archived?"archived-col":""])},null,10,Fz))),128)),m[101]||(m[101]=d("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[fp,!ys.value]])])]),ys.value?(C(),D("div",Uz,[d("div",jz,[m[103]||(m[103]=d("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[d("span",{class:"text-3xl"},"🎭")],-1)),d("p",Bz,ee(Wr.value)+"…",1),d("div",qz,[d("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:Ur({width:Gr.value+"%"})},null,4)]),d("p",zz,ee(Gr.value)+"%",1)])])):ie("",!0),ys.value?ie("",!0):(C(),Ys(r9,{key:1,"season-id":o.value,"season-slug":Br(s),"players-count":pt.value.length,"events-count":Ze.value.length,"onboarding-done":((O=a.value)==null?void 0:O.onboardingCreatorDone)===!0,onCreateEvent:Yt,onAddPlayer:m[19]||(m[19]=()=>{w.value=!0}),onCopyLink:gd,onDismissed:zf},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),ie("",!0),Me.value?(C(),D("div",Hz,[d("div",Kz,[m[104]||(m[104]=d("span",{class:"text-xl"},"✨",-1)),d("span",null,ee(at.value),1)])])):ie("",!0),Cn.value?(C(),D("div",Gz,[d("div",Wz,[m[105]||(m[105]=d("span",{class:"text-xl"},"⚠️",-1)),d("span",null,ee(Ls.value),1)])])):ie("",!0),Oa.value?(C(),D("div",Qz,[d("div",Jz,[m[111]||(m[111]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),d("div",Yz,[m[106]||(m[106]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),st(d("input",{"onUpdate:modelValue":m[20]||(m[20]=G=>bi.value=G),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[Lt,bi.value]])]),d("div",Xz,[m[107]||(m[107]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),st(d("input",{"onUpdate:modelValue":m[21]||(m[21]=G=>rs.value=G),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[Lt,rs.value]])]),d("div",Zz,[m[108]||(m[108]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),st(d("textarea",{"onUpdate:modelValue":m[22]||(m[22]=G=>_s.value=G),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[Lt,_s.value]])]),d("div",e8,[st(d("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":m[23]||(m[23]=G=>bs.value=G),class:"w-4 h-4"},null,512),[[Hi,bs.value]]),m[109]||(m[109]=d("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),d("div",t8,[m[110]||(m[110]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),st(d("input",{"onUpdate:modelValue":m[24]||(m[24]=G=>wi.value=G),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[Lt,wi.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:lu,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:wo,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):ie("",!0),w.value?(C(),D("div",n8,[d("div",r8,[m[113]||(m[113]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),d("div",s8,[m[112]||(m[112]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),st(d("input",{"onUpdate:modelValue":m[25]||(m[25]=G=>I.value=G),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[Lt,I.value]])]),d("div",i8,[d("button",{onClick:m[26]||(m[26]=G=>w.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Gf,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):ie("",!0),c.value?(C(),D("div",o8,[d("div",a8,[m[114]||(m[114]=or('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),d("div",l8,[d("button",{onClick:Kf,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:m[27]||(m[27]=()=>_i()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ie("",!0),u.value?(C(),D("div",u8,[d("div",c8,[m[115]||(m[115]=or('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),d("div",d8,[d("button",{onClick:y,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:m[28]||(m[28]=()=>p()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):ie("",!0),A.value?(C(),D("div",h8,[d("div",f8,[d("div",p8,[m[116]||(m[116]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🎭")],-1)),m[117]||(m[117]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",m8,[b.value&&At.value[b.value]&&At.value[b.value].every(G=>mr(G,b.value))?(C(),D("span",g8,"Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.")):(C(),D("span",v8,"La sélection sera mise à jour : les joueurs disponibles seront conservés, les slots vides seront complétés."))])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:J,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:B,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):ie("",!0),H.value?(C(),D("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:Yf},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:m[42]||(m[42]=ft(()=>{},["stop"]))},[d("div",y8,[d("button",{onClick:Yf,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",_8,[m[123]||(m[123]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),d("div",b8,[d("div",w8,[d("h2",x8,ee((W=K.value)==null?void 0:W.title),1),d("div",I8,[m[118]||(m[118]=d("span",{class:"text-blue-300"},"👥",-1)),d("span",E8,ee(((oe=K.value)==null?void 0:oe.playerCount)||6)+" joueurs",1)])]),d("div",T8,[d("p",A8,ee(mu((pe=K.value)==null?void 0:pe.date)),1),d("div",S8,[d("button",{onClick:m[29]||(m[29]=G=>vi()),class:"px-3 py-1.5 hover:bg-white/20 rounded text-purple-300 hover:text-green-400 transition-colors duration-200 text-sm flex items-center gap-2 border border-purple-500/30",title:"Ajouter à votre agenda"},m[119]||(m[119]=[d("span",null,"📅",-1),d("span",null,"Agenda",-1)])),Ue.value?(C(),D("div",P8,[d("div",R8,[d("button",{onClick:m[30]||(m[30]=G=>{ja("google"),se()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},m[120]||(m[120]=[d("span",null,"🌐",-1),d("span",null,"Google Calendar",-1)])),d("button",{onClick:m[31]||(m[31]=G=>{ja("outlook"),se()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},m[121]||(m[121]=[d("span",null,"📧",-1),d("span",null,"Outlook",-1)])),d("button",{onClick:m[32]||(m[32]=G=>{ja("ics"),se()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},m[122]||(m[122]=[d("span",null,"📥",-1),d("span",null,"Télécharger (.ics)",-1)]))])])):ie("",!0)])]),(ae=K.value)!=null&&ae.description?(C(),D("div",C8,ee(K.value.description),1)):ie("",!0)])])]),d("div",k8,[d("div",D8,[d("div",N8,[d("div",O8,ee(xo((Re=K.value)==null?void 0:Re.id)),1),m[124]||(m[124]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",V8,[d("div",M8,ee(Io((Ye=K.value)==null?void 0:Ye.id)),1),m[125]||(m[125]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),d("div",L8,[d("div",$8,ee(Math.max((((lt=K.value)==null?void 0:lt.playerCount)||6)-Io((Ct=K.value)==null?void 0:Ct.id),0)),1),m[126]||(m[126]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))])]),K.value?(C(),D("div",F8,[d("div",U8,[Qf.value?(C(),D("div",{key:0,class:cn(["flex items-center gap-2 px-2 py-1 rounded-md border text-[11px] md:text-xs max-w-[70%] truncate",((un=Va.value)==null?void 0:un.type)==="incomplete"?"bg-yellow-500/10 border-yellow-500/30 text-yellow-200":"bg-orange-500/10 border-orange-500/30 text-orange-200"]),title:du.value},[m[127]||(m[127]=d("span",null,"⚠️",-1)),d("span",B8,ee(du.value),1)],10,j8)):ie("",!0),st(d("select",{"onUpdate:modelValue":m[33]||(m[33]=G=>Ii.value=G),class:"ml-auto bg-gray-800 text-white rounded-md px-3 py-2 border border-white/10 focus:outline-none text-sm",title:"Filtrer les joueurs par statut"},m[128]||(m[128]=[or('<option value="selected">Sélectionnés</option><option value="available">Disponibles</option><option value="unavailable">Non Disponibles</option><option value="unknown">Pas de réponse</option><option value="all">Tous</option>',5)]),512),[[lR,Ii.value]])]),d("div",q8,[(C(!0),D(mt,null,jr(_d.value,G=>{var fn,Pr;return C(),D("div",{key:G.id,class:"flex items-center justify-between px-2 py-1.5 rounded-md hover:bg-gray-800/40 transition-colors"},[d("div",z8,[ws.value.has(G.id)?(C(),D("span",H8," ⭐ ")):Na(G.id)?(C(),D("span",K8," 🔒 ")):ie("",!0),d("span",{class:"text-white text-sm md:text-base block truncate max-w-full flex-1 min-w-0",title:G.name},ee(G.name),9,G8)]),d("div",W8,[Be(Gb,{"player-name":G.name,"event-id":K.value.id,"is-available":ep(K.value.id)[G.name],"is-selected":R1(G.name,K.value.id),"chance-percent":((fn=xi.value[G.name])==null?void 0:fn[K.value.id])??null,"show-selected-chance":gu(K.value.id),disabled:((Pr=K.value)==null?void 0:Pr.archived)===!0,compact:!0,onToggle:P1},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])])])}),128))])])):ie("",!0),d("div",Q8,[d("button",{onClick:m[34]||(m[34]=G=>To(K.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},m[129]||(m[129]=[d("span",null,"🎭",-1),d("span",null,"Sélectionner",-1)])),d("button",{onClick:m[35]||(m[35]=G=>wd(K.value)),disabled:(wn=K.value)==null?void 0:wn.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(xn=K.value)!=null&&xn.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[130]||(m[130]=[d("span",null,"📢",-1),d("span",null,"Annoncer",-1)]),8,J8),d("div",{class:"relative",ref_key:"eventMoreActionsRef",ref:ye},[d("button",{onClick:m[36]||(m[36]=G=>Kr()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},m[131]||(m[131]=[d("span",null,"⋯",-1),d("span",null,"Plus",-1)]))],512),d("button",{onClick:ay,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),(C(),Ys(ac,{to:"body"},[me.value?(C(),D("div",{key:0,ref_key:"eventMoreActionsDropdownRef",ref:fe,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:Ur(Ve.value)},[d("button",{onClick:m[37]||(m[37]=G=>{ly(),me.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[132]||(m[132]=[d("span",null,"✏️",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:m[38]||(m[38]=G=>{uy(),me.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10",title:(Ot=K.value)!=null&&Ot.archived?"Désarchiver cet événement":"Archiver cet événement"},[d("span",null,ee((Fr=K.value)!=null&&Fr.archived?"📂":"📁"),1),d("span",null,ee((is=K.value)!=null&&is.archived?"Désarchiver":"Archiver"),1)],8,Y8),d("button",{onClick:m[39]||(m[39]=G=>{var fn;ou((fn=K.value)==null?void 0:fn.id),me.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[133]||(m[133]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ie("",!0)]))])]),d("div",X8,[d("button",{onClick:m[40]||(m[40]=G=>To(K.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),d("button",{onClick:ay,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),d("button",{onClick:m[41]||(m[41]=G=>Vs()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):ie("",!0),(C(),Ys(ac,{to:"body"},[ge.value?(C(),D("div",{key:0,ref_key:"eventMoreActionsMobileDropdownRef",ref:Te,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:Ur(ke.value)},[d("button",{onClick:m[43]||(m[43]=G=>{wd(K.value),ge.value=!1}),disabled:(Ao=K.value)==null?void 0:Ao.archived,class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10 disabled:opacity-50 disabled:cursor-not-allowed",title:(Ba=K.value)!=null&&Ba.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[134]||(m[134]=[d("span",null,"📢",-1),d("span",null,"Annoncer",-1)]),8,Z8),d("button",{onClick:m[44]||(m[44]=G=>{ly(),ge.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[135]||(m[135]=[d("span",null,"✏️",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:m[45]||(m[45]=G=>{uy(),ge.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},[d("span",null,ee((gy=K.value)!=null&&gy.archived?"📂":"📁"),1),d("span",null,ee((vy=K.value)!=null&&vy.archived?"Désarchiver":"Archiver"),1)]),d("button",{onClick:m[46]||(m[46]=G=>{var fn;ou((fn=K.value)==null?void 0:fn.id),ge.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[136]||(m[136]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ie("",!0)])),Be(oy,{show:j.value,player:be.value,seasonId:o.value,onClose:m[47]||(m[47]=G=>j.value=!1),onVerified:C1},null,8,["show","player","seasonId"]),f.value?(C(),D("div",eH,[d("div",tH,[m[142]||(m[142]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),d("div",nH,[m[137]||(m[137]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),st(d("input",{"onUpdate:modelValue":m[48]||(m[48]=G=>g.value=G),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[sr(Er,["esc"]),sr(au,["enter"])],ref:"editTitleInput"},null,544),[[Lt,g.value]])]),d("div",rH,[m[138]||(m[138]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),st(d("input",{"onUpdate:modelValue":m[49]||(m[49]=G=>v.value=G),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[sr(Er,["esc"]),sr(au,["enter"])]},null,544),[[Lt,v.value]])]),d("div",sH,[m[139]||(m[139]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),st(d("textarea",{"onUpdate:modelValue":m[50]||(m[50]=G=>Z.value=G),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:sr(Er,["esc"])},null,544),[[Lt,Z.value]])]),d("div",iH,[st(d("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":m[51]||(m[51]=G=>ue.value=G),class:"w-4 h-4"},null,512),[[Hi,ue.value]]),m[140]||(m[140]=d("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),d("div",oH,[m[141]||(m[141]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),st(d("input",{"onUpdate:modelValue":m[52]||(m[52]=G=>x.value=G),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:sr(Er,["esc"])},null,544),[[Lt,x.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:Er,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:au,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ie("",!0),Be(KA,{show:M.value,message:Ie(),error:Ke.value,"session-info":A1(),onSubmit:Et,onCancel:Fn},null,8,["show","message","error","session-info"]),ct.value?(C(),D("div",aH,[d("div",lH,[m[144]||(m[144]=or('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),d("div",uH,[d("div",cH,[d("div",null,[m[143]||(m[143]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),st(d("input",{"onUpdate:modelValue":m[53]||(m[53]=G=>Ae.value=G),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[54]||(m[54]=sr(G=>Mn(Ae.value),["enter"])),ref_key:"playerPasswordInputRef",ref:Qe},null,544),[[Lt,Ae.value]])])]),d("button",{onClick:m[55]||(m[55]=G=>Mn(Ae.value)),disabled:!Ae.value||he.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[he.value?(C(),D("span",hH,"⏳")):(C(),D("span",fH,"🔓")),d("span",null,ee(he.value?"Vérification...":"Vérifier et supprimer"),1)],8,dH)]),d("div",pH,[d("button",{onClick:m[56]||(m[56]=G=>nt.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),Ge.value?(C(),D("div",mH,[d("div",gH,ee(Ge.value),1)])):ie("",!0),d("div",{class:"flex justify-center"},[d("button",{onClick:Ti,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ie("",!0),le.value?(C(),D("div",vH,[d("div",yH,[m[147]||(m[147]=or('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),d("div",_H,[d("div",bH,[d("div",null,[m[145]||(m[145]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),st(d("input",{"onUpdate:modelValue":m[57]||(m[57]=G=>ht.value=G),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[58]||(m[58]=sr(G=>Sr(ht.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:tn},null,544),[[Lt,ht.value]])])]),d("div",wH,[d("button",{onClick:m[59]||(m[59]=G=>Y.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),Ne.value?(C(),D("div",xH,[d("div",IH,ee(Ne.value),1)])):ie("",!0)]),d("div",EH,[d("button",{onClick:Ua,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),d("button",{onClick:m[60]||(m[60]=G=>Sr(ht.value)),disabled:!ht.value||Pt.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[Pt.value?(C(),D("span",AH,"⏳")):(C(),D("span",SH,"🔓")),d("span",null,[ut(ee(Pt.value?"Vérification...":"Vérifier"),1),m[146]||(m[146]=d("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,TH)])])])):ie("",!0),Y.value?(C(),D("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[63]||(m[63]=G=>Y.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[62]||(m[62]=ft(()=>{},["stop"]))},[m[149]||(m[149]=or('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),d("div",PH,[m[148]||(m[148]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:yu,disabled:xe.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[xe.value?(C(),D("span",CH,"⏳")):(C(),D("span",kH,"📧")),d("span",null,ee(xe.value?"Envoi...":"Envoyer l'email"),1)],8,RH)]),ve.value?(C(),D("div",DH,[d("div",NH,ee(ve.value),1)])):ie("",!0),Pe.value?(C(),D("div",OH,[d("div",VH,ee(Pe.value),1)])):ie("",!0),d("div",MH,[d("button",{onClick:m[61]||(m[61]=G=>Y.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ie("",!0),nt.value?(C(),D("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[66]||(m[66]=G=>nt.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[65]||(m[65]=ft(()=>{},["stop"]))},[m[151]||(m[151]=or('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),d("div",LH,[m[150]||(m[150]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:T1,disabled:vt.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[vt.value?(C(),D("span",FH,"⏳")):(C(),D("span",UH,"📧")),d("span",null,ee(vt.value?"Envoi...":"Envoyer l'email"),1)],8,$H)]),P.value?(C(),D("div",jH,[d("div",BH,ee(P.value),1)])):ie("",!0),V.value?(C(),D("div",qH,[d("div",zH,ee(V.value),1)])):ie("",!0),d("div",HH,[d("button",{onClick:m[64]||(m[64]=G=>nt.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ie("",!0),Be(ZB,{ref_key:"playerModalRef",ref:F,show:T.value,player:k.value,stats:N1(k.value),seasonId:o.value,"onboarding-step":ze.value,"onboarding-player-id":L.value,"is-protected":k.value?Vr.value.has(k.value.id):!1,"is-preferred":k.value?ws.value.has(k.value.id):!1,onClose:cy,onUpdate:k1,onDelete:E,onRefresh:D1,onAdvanceOnboarding:m[67]||(m[67]=G=>{try{typeof ze.value<"u"&&(ze.value.value=G)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id","is-protected","is-preferred"]),Be(zq,{ref_key:"selectionModalRef",ref:Rn,show:yt.value,event:Ut.value,"current-selection":At.value[(yy=Ut.value)==null?void 0:yy.id]||[],"available-count":xo((_y=Ut.value)==null?void 0:_y.id),"selected-count":Io((by=Ut.value)==null?void 0:by.id),"player-availability":ep((wy=Ut.value)==null?void 0:wy.id),"season-id":o.value,"season-slug":Br(s),players:yi.value,onClose:fy,onSelection:M1,onPerfect:L1,onSendNotifications:hy,onUpdateSelection:$1},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),Be(x1,{show:Xn.value,event:ot.value,"season-id":o.value,"season-slug":Br(s),players:yi.value,sending:Zf.value,"availability-by-player":ep((xy=ot.value)==null?void 0:xy.id),onClose:V1,onSendNotifications:hy},null,8,["show","event","season-id","season-slug","players","sending","availability-by-player"]),Be(Nj,{show:er.value,onClose:m[68]||(m[68]=G=>er.value=!1)},null,8,["show"]),Be(d1,{show:bn.value,"season-id":o.value,onClose:Ia,onManagePlayer:tu,onChangePassword:eu,onLogoutDevice:Ta,onDeleteAccount:hd},null,8,["show","season-id"]),Be(h1,{show:gs.value,onClose:Ea},null,8,["show"]),Be(f1,{show:Yl.value,onClose:dd,onManagePlayer:tu},null,8,["show"]),Be(R9,{show:We.value,"player-name":((Iy=rt.value)==null?void 0:Iy.playerName)||"","event-title":((Ey=rt.value)==null?void 0:Ey.eventTitle)||"","season-id":o.value,"season-slug":Br(s),"event-id":((Ty=rt.value)==null?void 0:Ty.eventId)||"",onClose:m[69]||(m[69]=G=>We.value=!1),onSuccess:U1},null,8,["show","player-name","event-title","season-id","season-slug","event-id"]),Be(K9,{show:nn.value,"player-name":((Ay=Bt.value)==null?void 0:Ay.playerName)||"",email:((Sy=Bt.value)==null?void 0:Sy.email)||"","season-slug":Br(s),"event-id":((Py=Bt.value)==null?void 0:Py.eventId)||null,onClose:m[70]||(m[70]=G=>nn.value=!1)},null,8,["show","player-name","email","season-slug","event-id"]),Be(I1,{show:yo.value,player:cd.value,"season-id":o.value,onClose:m[71]||(m[71]=G=>yo.value=!1),onSuccess:m[72]||(m[72]=()=>{yo.value=!1,bn.value=!0})},null,8,["show","player","season-id"]),Be(GA,{show:ms.value,onClose:m[73]||(m[73]=G=>ms.value=!1),onSuccess:m[74]||(m[74]=()=>{ms.value=!1,bn.value=!0})},null,8,["show"]),Rt.value?(C(),D("div",KH,[d("div",GH,[m[152]||(m[152]=d("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),m[153]||(m[153]=d("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),d("div",WH,[d("button",{onClick:m[75]||(m[75]=G=>wd(Zn.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),d("button",{onClick:dy,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):ie("",!0)],64)}}},QH={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},JH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},YH={key:0,class:"text-center py-8"},XH={key:1,class:"text-center py-8"},ZH={class:"text-gray-300 mb-6"},eK={key:2,class:"space-y-6"},tK={class:"text-center"},nK={class:"text-gray-300 mb-4"},rK={class:"font-semibold text-white"},sK={class:"space-y-4"},iK=["disabled"],oK={key:0,class:"animate-spin"},aK={key:1},lK={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},uK={class:"text-red-300 text-sm"},cK={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},dK={class:"text-green-300 text-sm"},hK={__name:"PasswordReset",setup(n){const e=co(),t=da(),r=S(!0),s=S(""),i=S(""),o=S(""),a=S(""),l=S(""),c=S(!1),h=S(""),f=S(""),g=qe(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);Tn(async()=>{try{const{oobCode:w}=e.query;if(N.debug("Token reçu (masqué)"),!w){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=w;try{N.debug("Vérification du token et récupération de l'email...");const I=await S4(je,w);i.value=I,N.info("Email récupéré depuis le token:",I)}catch(I){N.error("Erreur lors de la vérification du token:",I),s.value="Lien de réinitialisation invalide ou expiré",r.value=!1;return}r.value=!1}catch(w){N.error("Erreur lors de la vérification du lien",w),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function v(){if(g.value){c.value=!0,h.value="",f.value="";try{N.debug("Début réinitialisation avec token (masqué)"),await T4(je,o.value,a.value),N.info("Mot de passe Firebase Auth mis à jour"),N.info("Réinitialisation terminée avec Firebase Auth");try{N.debug("Tentative de connexion automatique...");const w=await yA(je,i.value,a.value);N.info("Connexion automatique réussie après reset",{uid:w.user.uid}),f.value="Mot de passe réinitialisé et connexion réussie ! Redirection...",setTimeout(()=>{x()},2e3)}catch(w){N.error("Erreur lors de la connexion automatique",w),f.value="Mot de passe réinitialisé ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{x()},3e3)}}catch(w){N.error("Erreur lors de la réinitialisation",w),w.code==="auth/weak-password"?h.value="Le mot de passe doit contenir au moins 6 caractères":w.code==="auth/invalid-action-code"?h.value="Lien de réinitialisation invalide ou expiré":h.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}async function x(){try{const w=localStorage.getItem("pendingPasswordResetNavigation");if(w)try{const $=JSON.parse(w),{lastVisitedPage:L,timestamp:U,email:q}=$,te=Date.now()-U<36e5,X=q===i.value;if(te&&X&&Lb(L)){N.info("✅ Redirection vers la page sauvegardée:",L),localStorage.removeItem("pendingPasswordResetNavigation"),t.push(L);return}else N.info("⚠️ Navigation sauvegardée invalide ou expirée, nettoyage..."),localStorage.removeItem("pendingPasswordResetNavigation")}catch($){N.error("Erreur lors du parsing de la navigation sauvegardée:",$),localStorage.removeItem("pendingPasswordResetNavigation")}const I=await R$(i.value);I!=null&&I.lastVisitedPage&&Lb(I.lastVisitedPage)?(N.info("Redirection vers la dernière page visitée (Firestore):",I.lastVisitedPage),t.push(I.lastVisitedPage)):(N.info("Aucune page précédente valide, redirection vers les saisons"),t.push("/seasons"))}catch(w){N.error("Erreur lors de la récupération de la navigation, redirection vers les saisons",w),t.push("/seasons")}}return(w,I)=>(C(),D("div",QH,[d("div",JH,[I[8]||(I[8]=or('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(C(),D("div",YH,I[2]||(I[2]=[d("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),d("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(C(),D("div",XH,[I[3]||(I[3]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"❌")],-1)),I[4]||(I[4]=d("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),d("p",ZH,ee(s.value),1),d("button",{onClick:x,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):o.value?(C(),D("div",eK,[d("div",tK,[d("p",nK,[I[5]||(I[5]=ut(" Réinitialisation pour ")),d("span",rK,ee(i.value),1)])]),d("div",sK,[d("div",null,[I[6]||(I[6]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),st(d("input",{"onUpdate:modelValue":I[0]||(I[0]=$=>a.value=$),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:sr(v,["enter"])},null,544),[[Lt,a.value]])]),d("div",null,[I[7]||(I[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),st(d("input",{"onUpdate:modelValue":I[1]||(I[1]=$=>l.value=$),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:sr(v,["enter"])},null,544),[[Lt,l.value]])])]),d("button",{onClick:v,disabled:!g.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(C(),D("span",oK,"⏳")):(C(),D("span",aK,"🔑")),d("span",null,ee(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,iK),h.value?(C(),D("div",lK,[d("div",uK,ee(h.value),1)])):ie("",!0),f.value?(C(),D("div",cK,[d("div",dK,ee(f.value),1)])):ie("",!0)])):ie("",!0)])]))}},fK={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},pK={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},mK={class:"text-3xl"},gK={class:"text-2xl font-bold text-white mb-2"},vK={class:"text-gray-300 mb-6"},yK={__name:"MagicLink",setup(n){const e=co(),t=da(),r=S("loading"),s=S("Traitement en cours..."),i=S("Merci de patienter pendant la validation du lien."),o=qe(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/seasons")}return Tn(async()=>{var l,c;try{iy("firebase");const h=String(e.query.sid||""),f=String(e.query.pid||"");let g=String(e.query.eid||"");const v=String(e.query.t||""),x=String(e.query.a||""),w=String(e.query.slug||"");if(!v||!x){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(x==="account_email_update"){const te=await YA({token:v});if(!te.valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}try{await k4(je.currentUser,te.data.newEmail),await XA({token:v}),r.value="ok",s.value="Email mis à jour",i.value="Votre adresse email a été mise à jour avec succès."}catch{r.value="error",s.value="Action impossible",i.value="Veuillez vous reconnecter puis réessayer."}return}if(x==="verify_email"&&(g="protection"),!(await QA({seasonId:h,playerId:f,eventId:g,token:v,action:x})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(x==="verify_email"){await s1({playerId:f,seasonId:h});try{await u1({playerId:f,seasonId:h})}catch{}await Fm({seasonId:h,playerId:f,eventId:"protection",action:x}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(w?()=>t.push(`/season/${w}?player=${encodeURIComponent(f)}&verified=1`):()=>t.push("/seasons"),800);return}if(x==="activate_notifications"){try{const{processNotificationActivation:te}=await xt(()=>Promise.resolve().then(()=>w1),void 0),X=await te(v);if(X.success)r.value="ok",s.value="Notifications activées !",(l=X.accountStatus)!=null&&l.created?i.value=`Parfait ! Tes notifications sont maintenant actives pour ${X.playerName}. Un compte a été créé avec ton email et tu recevras un email pour définir ton mot de passe.`:i.value=`Parfait ! Tes notifications sont maintenant actives pour ${X.playerName}. Tu recevras des alertes pour tes événements.`,i.value+=`

💡 Conseil : Pour une meilleure expérience, tu peux créer un mot de passe pour ton compte et te connecter directement à l'avenir.`,w&&g?t.push(`/season/${w}?event=${g}&modal=event_details&notificationSuccess=1&email=${encodeURIComponent(X.email)}&playerName=${encodeURIComponent(X.playerName)}&eventId=${g}`):w?t.push(`/season/${w}?notificationSuccess=1&email=${encodeURIComponent(X.email)}&playerName=${encodeURIComponent(X.playerName)}`):t.push("/seasons");else throw new Error("Échec de l'activation des notifications")}catch(te){N.error("Erreur lors de l'activation des notifications",te),r.value="error",s.value="Erreur d'activation",i.value="Impossible d'activer tes notifications. Veuillez réessayer."}return}const $=_e(ne,"seasons",h,"players",f),L=await Kt($),U=L.exists()&&L.data().name||"";if(!U){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}if(await xU({seasonId:h,playerName:U,eventId:g,value:x==="yes"}),x==="no")try{const te=_e(ne,"seasons",h,"selections",g),X=await Kt(te);if(X.exists()){const A=Array.isArray((c=X.data())==null?void 0:c.players)?X.data().players:[],b=A.filter(T=>T!==U);b.length!==A.length&&await setDoc(te,{players:b},{merge:!0})}}catch{}await Fm({seasonId:h,playerId:f,eventId:g,action:x}),r.value="ok",s.value="Merci !",i.value=x==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible. (Si vous étiez sélectionné(e), vous avez été retiré(e) de la sélection.)",setTimeout(w?()=>t.push(`/season/${w}/event/${g}`):()=>t.push("/seasons"),1200)}catch(h){N.error("Magic link error",h),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(C(),D("div",fK,[d("div",pK,[d("div",{class:cn(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[d("span",mK,ee(o.value),1)],2),d("h1",gK,ee(s.value),1),d("p",vK,ee(i.value),1),d("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},_K={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},bK={class:"text-center py-12 px-4"},wK={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},xK={class:"container mx-auto px-4 pb-16"},IK={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},EK={class:"space-y-5"},TK=["onKeydown"],AK={class:"flex items-center justify-end gap-3 pt-2"},SK=["disabled"],PK={key:0,class:"mt-6 text-sm text-gray-200"},RK={__name:"JoinSeason",setup(n){const e=co(),t=da(),r=e.params.slug,s=S(""),i=S(""),o=S(""),a=S(!1),l=S("");Tn(async()=>{const f=Cc(tt(ne,"seasons"),kh("slug","==",r)),g=await $t(f);if(g.empty)l.value="Saison introuvable";else{const v=g.docs[0];s.value=v.id,i.value=v.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function h(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await m1(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){N.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,g)=>(C(),D("div",_K,[d("div",bK,[d("h1",wK,ee(i.value||"Rejoindre la saison"),1),g[1]||(g[1]=d("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),d("div",xK,[d("div",IK,[g[3]||(g[3]=d("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),d("div",EK,[d("div",null,[g[2]||(g[2]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),st(d("input",{"onUpdate:modelValue":g[0]||(g[0]=v=>o.value=v),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:sr(ft(h,["prevent"]),["enter"])},null,40,TK),[[Lt,o.value]])]),d("div",AK,[d("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{disabled:!o.value.trim()||a.value,onClick:h,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,SK)])]),l.value?(C(),D("div",PK,ee(l.value),1)):ie("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const CK=[{path:"/",component:eF},{path:"/seasons",component:F5},{path:"/season/:slug",component:Wb,props:!0},{path:"/season/:slug/event/:eventId",component:Wb,props:!0},{path:"/season/:slug/join",component:RK,props:!0},{path:"/reset-password",component:hK},{path:"/magic",component:yK}],kK=_C({history:WR("/"),routes:CK});let tl;window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),tl=n,console.log("Événement beforeinstallprompt capturé")});window.addEventListener("appinstalled",n=>{console.log("Application installée"),tl=null});window.triggerInstall=()=>{tl&&(tl.prompt(),tl.userChoice.then(n=>{n.outcome==="accepted"?console.log("Utilisateur a accepté l'installation"):console.log("Utilisateur a refusé l'installation"),tl=null}))};window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches&&console.log("Application déjà installée en mode standalone");const E1=pR($$);E1.use(kK);E1.mount("#app");j$({immediate:!0,onRegistered(n){window.__swReg=n}});export{tt as $,ET as A,la as B,Ns as C,Sn as D,VG as E,pa as F,cv as G,OG as H,MK as I,es as J,PV as K,CV as L,ya as M,lG as N,uG as O,tM as P,Jn as Q,ZK as R,jK as S,dn as T,AG as U,wf as V,XV as W,eM as X,aG as Y,zK as Z,pI as _,Sc as a,sd as a$,FK as a0,RV as a1,jV as a2,NG as a3,Ol as a4,TG as a5,GK as a6,DG as a7,_e as a8,YK as a9,JK as aA,mG as aB,gG as aC,XK as aD,FV as aE,wG as aF,xG as aG,JV as aH,Cc as aI,cT as aJ,UK as aK,EG as aL,Yn as aM,Wt as aN,RG as aO,DK as aP,cG as aQ,rG as aR,nG as aS,oG as aT,WK as aU,vo as aV,PG as aW,HK as aX,kh as aY,wv as aZ,jG as a_,DV as aa,qK as ab,KK as ac,kG as ad,iG as ae,sG as af,hn as ag,ed as ah,qV as ai,vG as aj,Kt as ak,dG as al,hG as am,$t as an,fG as ao,pG as ap,kV as aq,CG as ar,SG as as,BK as at,eG as au,tG as av,QK as aw,yG as ax,bG as ay,_G as az,NV as b,fA as b$,rd as b0,qG as b1,Oc as b2,_a as b3,ji as b4,LG as b5,qi as b6,Bi as b7,li as b8,rh as b9,RL as bA,u7 as bB,x7 as bC,xb as bD,a3 as bE,JL as bF,r7 as bG,JG as bH,w4 as bI,f7 as bJ,y7 as bK,w7 as bL,c7 as bM,j4 as bN,F4 as bO,HG as bP,yL as bQ,x4 as bR,p7 as bS,v7 as bT,b7 as bU,DL as bV,a7 as bW,ZG as bX,E4 as bY,QG as bZ,$4 as b_,UG as ba,Jo as bb,fl as bc,c$ as bd,$G as be,d7 as bf,Nm as bg,FG as bh,d$ as bi,Wv as bj,zi as bk,WG as bl,U4 as bm,IA as bn,u$ as bo,TA as bp,A4 as bq,T4 as br,XL as bs,P4 as bt,BG as bu,l7 as bv,XG as bw,n7 as bx,y$ as by,zG as bz,Dl as c,Lv as c0,GG as c1,yA as c2,YG as c3,h7 as c4,g7 as c5,_7 as c6,B4 as c7,KG as c8,o7 as c9,k4 as ca,D4 as cb,m7 as cc,t7 as cd,i7 as ce,s7 as cf,e7 as cg,S4 as ch,ma as d,Ht as e,de as f,Gl as g,Xc as h,eh as i,Pf as j,Zc as k,Af as l,_v as m,Nl as n,Sf as o,zo as p,ZV as q,mn as r,ea as s,Se as t,OK as u,wD as v,on as w,MG as x,gt as y,NK as z};
