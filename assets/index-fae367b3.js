(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Yh(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const ht={},ro=[],er=()=>{},Hb=()=>!1,Ic=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Xh=n=>n.startsWith("onUpdate:"),on=Object.assign,Zh=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},Wb=Object.prototype.hasOwnProperty,rt=(n,e)=>Wb.call(n,e),De=Array.isArray,so=n=>Ec(n)==="[object Map]",K_=n=>Ec(n)==="[object Set]",Le=n=>typeof n=="function",Kt=n=>typeof n=="string",Us=n=>typeof n=="symbol",Tt=n=>n!==null&&typeof n=="object",H_=n=>(Tt(n)||Le(n))&&Le(n.then)&&Le(n.catch),W_=Object.prototype.toString,Ec=n=>W_.call(n),Qb=n=>Ec(n).slice(8,-1),Q_=n=>Ec(n)==="[object Object]",ef=n=>Kt(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Va=Yh(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Tc=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},Jb=/-(\w)/g,Wn=Tc(n=>n.replace(Jb,(e,t)=>t?t.toUpperCase():"")),Yb=/\B([A-Z])/g,Bs=Tc(n=>n.replace(Yb,"-$1").toLowerCase()),Ac=Tc(n=>n.charAt(0).toUpperCase()+n.slice(1)),Sd=Tc(n=>n?`on${Ac(n)}`:""),As=(n,e)=>!Object.is(n,e),Su=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},oh=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},ah=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let am;const xc=()=>am||(am=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Sc(n){if(De(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=Kt(r)?tI(r):Sc(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(Kt(n)||Tt(n))return n}const Xb=/;(?![^(]*\))/g,Zb=/:([^]+)/,eI=/\/\*[^]*?\*\//g;function tI(n){const e={};return n.replace(eI,"").split(Xb).forEach(t=>{if(t){const r=t.split(Zb);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function tr(n){let e="";if(Kt(n))e=n;else if(De(n))for(let t=0;t<n.length;t++){const r=tr(n[t]);r&&(e+=r+" ")}else if(Tt(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const nI="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",rI=Yh(nI);function J_(n){return!!n||n===""}const Y_=n=>!!(n&&n.__v_isRef===!0),ve=n=>Kt(n)?n:n==null?"":De(n)||Tt(n)&&(n.toString===W_||!Le(n.toString))?Y_(n)?ve(n.value):JSON.stringify(n,X_,2):String(n),X_=(n,e)=>Y_(e)?X_(n,e.value):so(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[Pd(r,i)+" =>"]=s,t),{})}:K_(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>Pd(t))}:Us(e)?Pd(e):Tt(e)&&!De(e)&&!Q_(e)?String(e):e,Pd=(n,e="")=>{var t;return Us(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Vn;class sI{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Vn,!e&&Vn&&(this.index=(Vn.scopes||(Vn.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Vn;try{return Vn=this,e()}finally{Vn=t}}}on(){++this._on===1&&(this.prevScope=Vn,Vn=this)}off(){this._on>0&&--this._on===0&&(Vn=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function iI(){return Vn}let pt;const Rd=new WeakSet;class Z_{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Vn&&Vn.active&&Vn.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Rd.has(this)&&(Rd.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||tv(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,lm(this),nv(this);const e=pt,t=nr;pt=this,nr=!0;try{return this.fn()}finally{rv(this),pt=e,nr=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)rf(e);this.deps=this.depsTail=void 0,lm(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Rd.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){lh(this)&&this.run()}get dirty(){return lh(this)}}let ev=0,Na,Oa;function tv(n,e=!1){if(n.flags|=8,e){n.next=Oa,Oa=n;return}n.next=Na,Na=n}function tf(){ev++}function nf(){if(--ev>0)return;if(Oa){let e=Oa;for(Oa=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Na;){let e=Na;for(Na=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function nv(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function rv(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),rf(r),oI(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function lh(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(sv(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function sv(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Qa)||(n.globalVersion=Qa,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!lh(n))))return;n.flags|=2;const e=n.dep,t=pt,r=nr;pt=n,nr=!0;try{nv(n);const s=n.fn(n._value);(e.version===0||As(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{pt=t,nr=r,rv(n),n.flags&=-3}}function rf(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)rf(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function oI(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let nr=!0;const iv=[];function Br(){iv.push(nr),nr=!1}function $r(){const n=iv.pop();nr=n===void 0?!0:n}function lm(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=pt;pt=void 0;try{e()}finally{pt=t}}}let Qa=0;class aI{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class sf{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!pt||!nr||pt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==pt)t=this.activeLink=new aI(pt,this),pt.deps?(t.prevDep=pt.depsTail,pt.depsTail.nextDep=t,pt.depsTail=t):pt.deps=pt.depsTail=t,ov(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=pt.depsTail,t.nextDep=void 0,pt.depsTail.nextDep=t,pt.depsTail=t,pt.deps===t&&(pt.deps=r)}return t}trigger(e){this.version++,Qa++,this.notify(e)}notify(e){tf();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{nf()}}}function ov(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)ov(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const uh=new WeakMap,hi=Symbol(""),ch=Symbol(""),Ja=Symbol("");function vn(n,e,t){if(nr&&pt){let r=uh.get(n);r||uh.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new sf),s.map=r,s.key=t),s.track()}}function kr(n,e,t,r,s,i){const o=uh.get(n);if(!o){Qa++;return}const a=l=>{l&&l.trigger()};if(tf(),e==="clear")o.forEach(a);else{const l=De(n),c=l&&ef(t);if(l&&t==="length"){const d=Number(r);o.forEach((f,g)=>{(g==="length"||g===Ja||!Us(g)&&g>=d)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(Ja)),e){case"add":l?c&&a(o.get("length")):(a(o.get(hi)),so(n)&&a(o.get(ch)));break;case"delete":l||(a(o.get(hi)),so(n)&&a(o.get(ch)));break;case"set":so(n)&&a(o.get(hi));break}}nf()}function Gi(n){const e=nt(n);return e===n?e:(vn(e,"iterate",Ja),Hn(n)?e:e.map(cn))}function Pc(n){return vn(n=nt(n),"iterate",Ja),n}const lI={__proto__:null,[Symbol.iterator](){return Cd(this,Symbol.iterator,cn)},concat(...n){return Gi(this).concat(...n.map(e=>De(e)?Gi(e):e))},entries(){return Cd(this,"entries",n=>(n[1]=cn(n[1]),n))},every(n,e){return Pr(this,"every",n,e,void 0,arguments)},filter(n,e){return Pr(this,"filter",n,e,t=>t.map(cn),arguments)},find(n,e){return Pr(this,"find",n,e,cn,arguments)},findIndex(n,e){return Pr(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return Pr(this,"findLast",n,e,cn,arguments)},findLastIndex(n,e){return Pr(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return Pr(this,"forEach",n,e,void 0,arguments)},includes(...n){return kd(this,"includes",n)},indexOf(...n){return kd(this,"indexOf",n)},join(n){return Gi(this).join(n)},lastIndexOf(...n){return kd(this,"lastIndexOf",n)},map(n,e){return Pr(this,"map",n,e,void 0,arguments)},pop(){return fa(this,"pop")},push(...n){return fa(this,"push",n)},reduce(n,...e){return um(this,"reduce",n,e)},reduceRight(n,...e){return um(this,"reduceRight",n,e)},shift(){return fa(this,"shift")},some(n,e){return Pr(this,"some",n,e,void 0,arguments)},splice(...n){return fa(this,"splice",n)},toReversed(){return Gi(this).toReversed()},toSorted(n){return Gi(this).toSorted(n)},toSpliced(...n){return Gi(this).toSpliced(...n)},unshift(...n){return fa(this,"unshift",n)},values(){return Cd(this,"values",cn)}};function Cd(n,e,t){const r=Pc(n),s=r[e]();return r!==n&&!Hn(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const uI=Array.prototype;function Pr(n,e,t,r,s,i){const o=Pc(n),a=o!==n&&!Hn(n),l=o[e];if(l!==uI[e]){const f=l.apply(n,i);return a?cn(f):f}let c=t;o!==n&&(a?c=function(f,g){return t.call(this,cn(f),g,n)}:t.length>2&&(c=function(f,g){return t.call(this,f,g,n)}));const d=l.call(o,c,r);return a&&s?s(d):d}function um(n,e,t,r){const s=Pc(n);let i=t;return s!==n&&(Hn(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,cn(a),l,n)}),s[e](i,...r)}function kd(n,e,t){const r=nt(n);vn(r,"iterate",Ja);const s=r[e](...t);return(s===-1||s===!1)&&lf(t[0])?(t[0]=nt(t[0]),r[e](...t)):s}function fa(n,e,t=[]){Br(),tf();const r=nt(n)[e].apply(n,t);return nf(),$r(),r}const cI=Yh("__proto__,__v_isRef,__isVue"),av=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Us));function dI(n){Us(n)||(n=String(n));const e=nt(this);return vn(e,"has",n),e.hasOwnProperty(n)}class lv{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?bI:hv:i?dv:cv).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=De(e);if(!s){let l;if(o&&(l=lI[t]))return l;if(t==="hasOwnProperty")return dI}const a=Reflect.get(e,t,wn(e)?e:r);return(Us(t)?av.has(t):cI(t))||(s||vn(e,"get",t),i)?a:wn(a)?o&&ef(t)?a:a.value:Tt(a)?s?pv(a):Rc(a):a}}class uv extends lv{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=Rs(i);if(!Hn(r)&&!Rs(r)&&(i=nt(i),r=nt(r)),!De(e)&&wn(i)&&!wn(r))return l?!1:(i.value=r,!0)}const o=De(e)&&ef(t)?Number(t)<e.length:rt(e,t),a=Reflect.set(e,t,r,wn(e)?e:s);return e===nt(s)&&(o?As(r,i)&&kr(e,"set",t,r):kr(e,"add",t,r)),a}deleteProperty(e,t){const r=rt(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&kr(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!Us(t)||!av.has(t))&&vn(e,"has",t),r}ownKeys(e){return vn(e,"iterate",De(e)?"length":hi),Reflect.ownKeys(e)}}class hI extends lv{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const fI=new uv,pI=new hI,mI=new uv(!0);const dh=n=>n,mu=n=>Reflect.getPrototypeOf(n);function gI(n,e,t){return function(...r){const s=this.__v_raw,i=nt(s),o=so(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),d=t?dh:e?Ku:cn;return!e&&vn(i,"iterate",l?ch:hi),{next(){const{value:f,done:g}=c.next();return g?{value:f,done:g}:{value:a?[d(f[0]),d(f[1])]:d(f),done:g}},[Symbol.iterator](){return this}}}}function gu(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function _I(n,e){const t={get(s){const i=this.__v_raw,o=nt(i),a=nt(s);n||(As(s,a)&&vn(o,"get",s),vn(o,"get",a));const{has:l}=mu(o),c=e?dh:n?Ku:cn;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&vn(nt(s),"iterate",hi),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=nt(i),a=nt(s);return n||(As(s,a)&&vn(o,"has",s),vn(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=nt(a),c=e?dh:n?Ku:cn;return!n&&vn(l,"iterate",hi),a.forEach((d,f)=>s.call(i,c(d),c(f),o))}};return on(t,n?{add:gu("add"),set:gu("set"),delete:gu("delete"),clear:gu("clear")}:{add(s){!e&&!Hn(s)&&!Rs(s)&&(s=nt(s));const i=nt(this);return mu(i).has.call(i,s)||(i.add(s),kr(i,"add",s,s)),this},set(s,i){!e&&!Hn(i)&&!Rs(i)&&(i=nt(i));const o=nt(this),{has:a,get:l}=mu(o);let c=a.call(o,s);c||(s=nt(s),c=a.call(o,s));const d=l.call(o,s);return o.set(s,i),c?As(i,d)&&kr(o,"set",s,i):kr(o,"add",s,i),this},delete(s){const i=nt(this),{has:o,get:a}=mu(i);let l=o.call(i,s);l||(s=nt(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&kr(i,"delete",s,void 0),c},clear(){const s=nt(this),i=s.size!==0,o=s.clear();return i&&kr(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=gI(s,n,e)}),t}function of(n,e){const t=_I(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(rt(t,s)&&s in r?t:r,s,i)}const vI={get:of(!1,!1)},yI={get:of(!1,!0)},wI={get:of(!0,!1)};const cv=new WeakMap,dv=new WeakMap,hv=new WeakMap,bI=new WeakMap;function II(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function EI(n){return n.__v_skip||!Object.isExtensible(n)?0:II(Qb(n))}function Rc(n){return Rs(n)?n:af(n,!1,fI,vI,cv)}function fv(n){return af(n,!1,mI,yI,dv)}function pv(n){return af(n,!0,pI,wI,hv)}function af(n,e,t,r,s){if(!Tt(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=EI(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function io(n){return Rs(n)?io(n.__v_raw):!!(n&&n.__v_isReactive)}function Rs(n){return!!(n&&n.__v_isReadonly)}function Hn(n){return!!(n&&n.__v_isShallow)}function lf(n){return n?!!n.__v_raw:!1}function nt(n){const e=n&&n.__v_raw;return e?nt(e):n}function TI(n){return!rt(n,"__v_skip")&&Object.isExtensible(n)&&oh(n,"__v_skip",!0),n}const cn=n=>Tt(n)?Rc(n):n,Ku=n=>Tt(n)?pv(n):n;function wn(n){return n?n.__v_isRef===!0:!1}function q(n){return mv(n,!1)}function AI(n){return mv(n,!0)}function mv(n,e){return wn(n)?n:new xI(n,e)}class xI{constructor(e,t){this.dep=new sf,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:nt(e),this._value=t?e:cn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Hn(e)||Rs(e);e=r?e:nt(e),As(e,t)&&(this._rawValue=e,this._value=r?e:cn(e),this.dep.trigger())}}function oo(n){return wn(n)?n.value:n}const SI={get:(n,e,t)=>e==="__v_raw"?n:oo(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return wn(s)&&!wn(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function gv(n){return io(n)?n:new Proxy(n,SI)}class PI{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new sf(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Qa-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&pt!==this)return tv(this,!0),!0}get value(){const e=this.dep.track();return sv(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function RI(n,e,t=!1){let r,s;return Le(n)?r=n:(r=n.get,s=n.set),new PI(r,s,t)}const _u={},Hu=new WeakMap;let ni;function CI(n,e=!1,t=ni){if(t){let r=Hu.get(t);r||Hu.set(t,r=[]),r.push(n)}}function kI(n,e,t=ht){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=j=>s?j:Hn(j)||s===!1||s===0?Dr(j,1):Dr(j);let d,f,g,_,C=!1,x=!1;if(wn(n)?(f=()=>n.value,C=Hn(n)):io(n)?(f=()=>c(n),C=!0):De(n)?(x=!0,C=n.some(j=>io(j)||Hn(j)),f=()=>n.map(j=>{if(wn(j))return j.value;if(io(j))return c(j);if(Le(j))return l?l(j,2):j()})):Le(n)?e?f=l?()=>l(n,2):n:f=()=>{if(g){Br();try{g()}finally{$r()}}const j=ni;ni=d;try{return l?l(n,3,[_]):n(_)}finally{ni=j}}:f=er,e&&s){const j=f,O=s===!0?1/0:s;f=()=>Dr(j(),O)}const R=iI(),L=()=>{d.stop(),R&&R.active&&Zh(R.effects,d)};if(i&&e){const j=e;e=(...O)=>{j(...O),L()}}let B=x?new Array(n.length).fill(_u):_u;const $=j=>{if(!(!(d.flags&1)||!d.dirty&&!j))if(e){const O=d.run();if(s||C||(x?O.some((se,T)=>As(se,B[T])):As(O,B))){g&&g();const se=ni;ni=d;try{const T=[O,B===_u?void 0:x&&B[0]===_u?[]:B,_];B=O,l?l(e,3,T):e(...T)}finally{ni=se}}}else d.run()};return a&&a($),d=new Z_(f),d.scheduler=o?()=>o($,!1):$,_=j=>CI(j,!1,d),g=d.onStop=()=>{const j=Hu.get(d);if(j){if(l)l(j,4);else for(const O of j)O();Hu.delete(d)}},e?r?$(!0):B=d.run():o?o($.bind(null,!0),!0):d.run(),L.pause=d.pause.bind(d),L.resume=d.resume.bind(d),L.stop=L,L}function Dr(n,e=1/0,t){if(e<=0||!Tt(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,wn(n))Dr(n.value,e,t);else if(De(n))for(let r=0;r<n.length;r++)Dr(n[r],e,t);else if(K_(n)||so(n))n.forEach(r=>{Dr(r,e,t)});else if(Q_(n)){for(const r in n)Dr(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&Dr(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Il(n,e,t,r){try{return r?n(...r):n()}catch(s){Cc(s,e,t)}}function br(n,e,t,r){if(Le(n)){const s=Il(n,e,t,r);return s&&H_(s)&&s.catch(i=>{Cc(i,e,t)}),s}if(De(n)){const s=[];for(let i=0;i<n.length;i++)s.push(br(n[i],e,t,r));return s}}function Cc(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||ht;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const d=a.ec;if(d){for(let f=0;f<d.length;f++)if(d[f](n,l,c)===!1)return}a=a.parent}if(i){Br(),Il(i,null,10,[n,l,c]),$r();return}}DI(n,t,s,r,o)}function DI(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const Pn=[];let fr=-1;const ao=[];let ps=null,Ji=0;const _v=Promise.resolve();let Wu=null;function Fr(n){const e=Wu||_v;return n?e.then(this?n.bind(this):n):e}function VI(n){let e=fr+1,t=Pn.length;for(;e<t;){const r=e+t>>>1,s=Pn[r],i=Ya(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function uf(n){if(!(n.flags&1)){const e=Ya(n),t=Pn[Pn.length-1];!t||!(n.flags&2)&&e>=Ya(t)?Pn.push(n):Pn.splice(VI(e),0,n),n.flags|=1,vv()}}function vv(){Wu||(Wu=_v.then(wv))}function NI(n){De(n)?ao.push(...n):ps&&n.id===-1?ps.splice(Ji+1,0,n):n.flags&1||(ao.push(n),n.flags|=1),vv()}function cm(n,e,t=fr+1){for(;t<Pn.length;t++){const r=Pn[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;Pn.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function yv(n){if(ao.length){const e=[...new Set(ao)].sort((t,r)=>Ya(t)-Ya(r));if(ao.length=0,ps){ps.push(...e);return}for(ps=e,Ji=0;Ji<ps.length;Ji++){const t=ps[Ji];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}ps=null,Ji=0}}const Ya=n=>n.id==null?n.flags&2?-1:1/0:n.id;function wv(n){const e=er;try{for(fr=0;fr<Pn.length;fr++){const t=Pn[fr];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Il(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;fr<Pn.length;fr++){const t=Pn[fr];t&&(t.flags&=-2)}fr=-1,Pn.length=0,yv(),Wu=null,(Pn.length||ao.length)&&wv()}}let qn=null,bv=null;function Qu(n){const e=qn;return qn=n,bv=n&&n.type.__scopeId||null,e}function OI(n,e=qn,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&ym(-1);const i=Qu(e);let o;try{o=n(...s)}finally{Qu(i),r._d&&ym(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function gt(n,e){if(qn===null)return n;const t=Nc(qn),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=ht]=e[s];i&&(Le(i)&&(i={mounted:i,updated:i}),i.deep&&Dr(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function Zs(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(Br(),br(l,t,8,[n.el,a,n,e]),$r())}}const MI=Symbol("_vte"),LI=n=>n.__isTeleport;function cf(n,e){n.shapeFlag&6&&n.component?(n.transition=e,cf(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function Iv(n,e){return Le(n)?(()=>on({name:n.name},e,{setup:n}))():n}function Ev(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function Ma(n,e,t,r,s=!1){if(De(n)){n.forEach((C,x)=>Ma(C,e&&(De(e)?e[x]:e),t,r,s));return}if(La(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&Ma(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?Nc(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,d=a.refs===ht?a.refs={}:a.refs,f=a.setupState,g=nt(f),_=f===ht?()=>!1:C=>rt(g,C);if(c!=null&&c!==l&&(Kt(c)?(d[c]=null,_(c)&&(f[c]=null)):wn(c)&&(c.value=null)),Le(l))Il(l,a,12,[o,d]);else{const C=Kt(l),x=wn(l);if(C||x){const R=()=>{if(n.f){const L=C?_(l)?f[l]:d[l]:l.value;s?De(L)&&Zh(L,i):De(L)?L.includes(i)||L.push(i):C?(d[l]=[i],_(l)&&(f[l]=d[l])):(l.value=[i],n.k&&(d[n.k]=l.value))}else C?(d[l]=o,_(l)&&(f[l]=o)):x&&(l.value=o,n.k&&(d[n.k]=o))};o?(R.id=-1,$n(R,t)):R()}}}xc().requestIdleCallback;xc().cancelIdleCallback;const La=n=>!!n.type.__asyncLoader,Tv=n=>n.type.__isKeepAlive;function FI(n,e){Av(n,"a",e)}function UI(n,e){Av(n,"da",e)}function Av(n,e,t=yn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(kc(e,r,t),t){let s=t.parent;for(;s&&s.parent;)Tv(s.parent.vnode)&&BI(r,e,t,s),s=s.parent}}function BI(n,e,t,r){const s=kc(e,n,r,!0);df(()=>{Zh(r[e],s)},t)}function kc(n,e,t=yn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Br();const a=El(t),l=br(e,t,n,o);return a(),$r(),l});return r?s.unshift(i):s.push(i),i}}const Wr=n=>(e,t=yn)=>{(!Za||n==="sp")&&kc(n,(...r)=>e(...r),t)},$I=Wr("bm"),_o=Wr("m"),jI=Wr("bu"),qI=Wr("u"),xv=Wr("bum"),df=Wr("um"),zI=Wr("sp"),GI=Wr("rtg"),KI=Wr("rtc");function HI(n,e=yn){kc("ec",n,e)}const Sv="components";function WI(n,e){return JI(Sv,n,!0,e)||n}const QI=Symbol.for("v-ndc");function JI(n,e,t=!0,r=!1){const s=qn||yn;if(s){const i=s.type;if(n===Sv){const a=ME(i,!1);if(a&&(a===e||a===Wn(e)||a===Ac(Wn(e))))return i}const o=dm(s[n]||i[n],e)||dm(s.appContext[n],e);return!o&&r?i:o}}function dm(n,e){return n&&(n[e]||n[Wn(e)]||n[Ac(Wn(e))])}function Vr(n,e,t,r){let s;const i=t&&t[r],o=De(n);if(o||Kt(n)){const a=o&&io(n);let l=!1,c=!1;a&&(l=!Hn(n),c=Rs(n),n=Pc(n)),s=new Array(n.length);for(let d=0,f=n.length;d<f;d++)s[d]=e(l?c?Ku(cn(n[d])):cn(n[d]):n[d],d,void 0,i&&i[d])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(Tt(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const d=a[l];s[l]=e(n[d],d,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}const hh=n=>n?Hv(n)?Nc(n):hh(n.parent):null,Fa=on(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>hh(n.parent),$root:n=>hh(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>hf(n),$forceUpdate:n=>n.f||(n.f=()=>{uf(n.update)}),$nextTick:n=>n.n||(n.n=Fr.bind(n.proxy)),$watch:n=>_E.bind(n)}),Dd=(n,e)=>n!==ht&&!n.__isScriptSetup&&rt(n,e),YI={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const _=o[e];if(_!==void 0)switch(_){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(Dd(r,e))return o[e]=1,r[e];if(s!==ht&&rt(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&rt(c,e))return o[e]=3,i[e];if(t!==ht&&rt(t,e))return o[e]=4,t[e];fh&&(o[e]=0)}}const d=Fa[e];let f,g;if(d)return e==="$attrs"&&vn(n.attrs,"get",""),d(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==ht&&rt(t,e))return o[e]=4,t[e];if(g=l.config.globalProperties,rt(g,e))return g[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return Dd(s,e)?(s[e]=t,!0):r!==ht&&rt(r,e)?(r[e]=t,!0):rt(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==ht&&rt(n,o)||Dd(e,o)||(a=i[0])&&rt(a,o)||rt(r,o)||rt(Fa,o)||rt(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:rt(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function hm(n){return De(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let fh=!0;function XI(n){const e=hf(n),t=n.proxy,r=n.ctx;fh=!1,e.beforeCreate&&fm(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:d,beforeMount:f,mounted:g,beforeUpdate:_,updated:C,activated:x,deactivated:R,beforeDestroy:L,beforeUnmount:B,destroyed:$,unmounted:j,render:O,renderTracked:se,renderTriggered:T,errorCaptured:w,serverPrefetch:I,expose:P,inheritAttrs:k,components:D,directives:A,filters:Ht}=e;if(c&&ZI(c,r,null),o)for(const ue in o){const K=o[ue];Le(K)&&(r[ue]=K.bind(t))}if(s){const ue=s.call(t,t);Tt(ue)&&(n.data=Rc(ue))}if(fh=!0,i)for(const ue in i){const K=i[ue],Pe=Le(K)?K.bind(t,t):Le(K.get)?K.get.bind(t,t):er,ke=!Le(K)&&Le(K.set)?K.set.bind(t):er,We=Xt({get:Pe,set:ke});Object.defineProperty(r,ue,{enumerable:!0,configurable:!0,get:()=>We.value,set:Ve=>We.value=Ve})}if(a)for(const ue in a)Pv(a[ue],r,t,ue);if(l){const ue=Le(l)?l.call(t):l;Reflect.ownKeys(ue).forEach(K=>{Pu(K,ue[K])})}d&&fm(d,n,"c");function Ye(ue,K){De(K)?K.forEach(Pe=>ue(Pe.bind(t))):K&&ue(K.bind(t))}if(Ye($I,f),Ye(_o,g),Ye(jI,_),Ye(qI,C),Ye(FI,x),Ye(UI,R),Ye(HI,w),Ye(KI,se),Ye(GI,T),Ye(xv,B),Ye(df,j),Ye(zI,I),De(P))if(P.length){const ue=n.exposed||(n.exposed={});P.forEach(K=>{Object.defineProperty(ue,K,{get:()=>t[K],set:Pe=>t[K]=Pe})})}else n.exposed||(n.exposed={});O&&n.render===er&&(n.render=O),k!=null&&(n.inheritAttrs=k),D&&(n.components=D),A&&(n.directives=A),I&&Ev(n)}function ZI(n,e,t=er){De(n)&&(n=ph(n));for(const r in n){const s=n[r];let i;Tt(s)?"default"in s?i=rr(s.from||r,s.default,!0):i=rr(s.from||r):i=rr(s),wn(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function fm(n,e,t){br(De(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function Pv(n,e,t,r){let s=r.includes(".")?$v(t,r):()=>t[r];if(Kt(n)){const i=e[n];Le(i)&&sr(s,i)}else if(Le(n))sr(s,n.bind(t));else if(Tt(n))if(De(n))n.forEach(i=>Pv(i,e,t,r));else{const i=Le(n.handler)?n.handler.bind(t):e[n.handler];Le(i)&&sr(s,i,n)}}function hf(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>Ju(l,c,o,!0)),Ju(l,e,o)),Tt(e)&&i.set(e,l),l}function Ju(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&Ju(n,i,t,!0),s&&s.forEach(o=>Ju(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=eE[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const eE={data:pm,props:mm,emits:mm,methods:Aa,computed:Aa,beforeCreate:xn,created:xn,beforeMount:xn,mounted:xn,beforeUpdate:xn,updated:xn,beforeDestroy:xn,beforeUnmount:xn,destroyed:xn,unmounted:xn,activated:xn,deactivated:xn,errorCaptured:xn,serverPrefetch:xn,components:Aa,directives:Aa,watch:nE,provide:pm,inject:tE};function pm(n,e){return e?n?function(){return on(Le(n)?n.call(this,this):n,Le(e)?e.call(this,this):e)}:e:n}function tE(n,e){return Aa(ph(n),ph(e))}function ph(n){if(De(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function xn(n,e){return n?[...new Set([].concat(n,e))]:e}function Aa(n,e){return n?on(Object.create(null),n,e):e}function mm(n,e){return n?De(n)&&De(e)?[...new Set([...n,...e])]:on(Object.create(null),hm(n),hm(e??{})):e}function nE(n,e){if(!n)return e;if(!e)return n;const t=on(Object.create(null),n);for(const r in e)t[r]=xn(n[r],e[r]);return t}function Rv(){return{app:null,config:{isNativeTag:Hb,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let rE=0;function sE(n,e){return function(r,s=null){Le(r)||(r=on({},r)),s!=null&&!Tt(s)&&(s=null);const i=Rv(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:rE++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:FE,get config(){return i.config},set config(d){},use(d,...f){return o.has(d)||(d&&Le(d.install)?(o.add(d),d.install(c,...f)):Le(d)&&(o.add(d),d(c,...f))),c},mixin(d){return i.mixins.includes(d)||i.mixins.push(d),c},component(d,f){return f?(i.components[d]=f,c):i.components[d]},directive(d,f){return f?(i.directives[d]=f,c):i.directives[d]},mount(d,f,g){if(!l){const _=c._ceVNode||Ft(r,s);return _.appContext=i,g===!0?g="svg":g===!1&&(g=void 0),f&&e?e(_,d):n(_,d,g),l=!0,c._container=d,d.__vue_app__=c,Nc(_.component)}},onUnmount(d){a.push(d)},unmount(){l&&(br(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(d,f){return i.provides[d]=f,c},runWithContext(d){const f=lo;lo=c;try{return d()}finally{lo=f}}};return c}}let lo=null;function Pu(n,e){if(yn){let t=yn.provides;const r=yn.parent&&yn.parent.provides;r===t&&(t=yn.provides=Object.create(r)),t[n]=e}}function rr(n,e,t=!1){const r=yn||qn;if(r||lo){let s=lo?lo._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&Le(e)?e.call(r&&r.proxy):e}}const Cv={},kv=()=>Object.create(Cv),Dv=n=>Object.getPrototypeOf(n)===Cv;function iE(n,e,t,r=!1){const s={},i=kv();n.propsDefaults=Object.create(null),Vv(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:fv(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function oE(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=nt(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const d=n.vnode.dynamicProps;for(let f=0;f<d.length;f++){let g=d[f];if(Dc(n.emitsOptions,g))continue;const _=e[g];if(l)if(rt(i,g))_!==i[g]&&(i[g]=_,c=!0);else{const C=Wn(g);s[C]=mh(l,a,C,_,n,!1)}else _!==i[g]&&(i[g]=_,c=!0)}}}else{Vv(n,e,s,i)&&(c=!0);let d;for(const f in a)(!e||!rt(e,f)&&((d=Bs(f))===f||!rt(e,d)))&&(l?t&&(t[f]!==void 0||t[d]!==void 0)&&(s[f]=mh(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!rt(e,f))&&(delete i[f],c=!0)}c&&kr(n.attrs,"set","")}function Vv(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(Va(l))continue;const c=e[l];let d;s&&rt(s,d=Wn(l))?!i||!i.includes(d)?t[d]=c:(a||(a={}))[d]=c:Dc(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=nt(t),c=a||ht;for(let d=0;d<i.length;d++){const f=i[d];t[f]=mh(s,l,f,c[f],n,!rt(c,f))}}return o}function mh(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=rt(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&Le(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const d=El(s);r=c[t]=l.call(null,e),d()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===Bs(t))&&(r=!0))}return r}const aE=new WeakMap;function Nv(n,e,t=!1){const r=t?aE:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!Le(n)){const d=f=>{l=!0;const[g,_]=Nv(f,e,!0);on(o,g),_&&a.push(..._)};!t&&e.mixins.length&&e.mixins.forEach(d),n.extends&&d(n.extends),n.mixins&&n.mixins.forEach(d)}if(!i&&!l)return Tt(n)&&r.set(n,ro),ro;if(De(i))for(let d=0;d<i.length;d++){const f=Wn(i[d]);gm(f)&&(o[f]=ht)}else if(i)for(const d in i){const f=Wn(d);if(gm(f)){const g=i[d],_=o[f]=De(g)||Le(g)?{type:g}:on({},g),C=_.type;let x=!1,R=!0;if(De(C))for(let L=0;L<C.length;++L){const B=C[L],$=Le(B)&&B.name;if($==="Boolean"){x=!0;break}else $==="String"&&(R=!1)}else x=Le(C)&&C.name==="Boolean";_[0]=x,_[1]=R,(x||rt(_,"default"))&&a.push(f)}}const c=[o,a];return Tt(n)&&r.set(n,c),c}function gm(n){return n[0]!=="$"&&!Va(n)}const ff=n=>n[0]==="_"||n==="$stable",pf=n=>De(n)?n.map(pr):[pr(n)],lE=(n,e,t)=>{if(e._n)return e;const r=OI((...s)=>pf(e(...s)),t);return r._c=!1,r},Ov=(n,e,t)=>{const r=n._ctx;for(const s in n){if(ff(s))continue;const i=n[s];if(Le(i))e[s]=lE(s,i,r);else if(i!=null){const o=pf(i);e[s]=()=>o}}},Mv=(n,e)=>{const t=pf(e);n.slots.default=()=>t},Lv=(n,e,t)=>{for(const r in e)(t||!ff(r))&&(n[r]=e[r])},uE=(n,e,t)=>{const r=n.slots=kv();if(n.vnode.shapeFlag&32){const s=e.__;s&&oh(r,"__",s,!0);const i=e._;i?(Lv(r,e,t),t&&oh(r,"_",i,!0)):Ov(e,r)}else e&&Mv(n,e)},cE=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=ht;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:Lv(s,e,t):(i=!e.$stable,Ov(e,s)),o=e}else e&&(Mv(n,e),o={default:1});if(i)for(const a in s)!ff(a)&&o[a]==null&&delete s[a]},$n=TE;function dE(n){return hE(n)}function hE(n,e){const t=xc();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:d,parentNode:f,nextSibling:g,setScopeId:_=er,insertStaticContent:C}=n,x=(b,E,M,X=null,z=null,Z=null,he=void 0,oe=null,ne=!!E.dynamicChildren)=>{if(b===E)return;b&&!pa(b,E)&&(X=G(b),Ve(b,z,Z,!0),b=null),E.patchFlag===-2&&(ne=!1,E.dynamicChildren=null);const{type:ee,ref:Ie,shapeFlag:fe}=E;switch(ee){case Vc:R(b,E,M,X);break;case Cs:L(b,E,M,X);break;case Ru:b==null&&B(E,M,X,he);break;case Dt:D(b,E,M,X,z,Z,he,oe,ne);break;default:fe&1?O(b,E,M,X,z,Z,he,oe,ne):fe&6?A(b,E,M,X,z,Z,he,oe,ne):(fe&64||fe&128)&&ee.process(b,E,M,X,z,Z,he,oe,ne,ie)}Ie!=null&&z?Ma(Ie,b&&b.ref,Z,E||b,!E):Ie==null&&b&&b.ref!=null&&Ma(b.ref,null,Z,b,!0)},R=(b,E,M,X)=>{if(b==null)r(E.el=a(E.children),M,X);else{const z=E.el=b.el;E.children!==b.children&&c(z,E.children)}},L=(b,E,M,X)=>{b==null?r(E.el=l(E.children||""),M,X):E.el=b.el},B=(b,E,M,X)=>{[b.el,b.anchor]=C(b.children,E,M,X,b.el,b.anchor)},$=({el:b,anchor:E},M,X)=>{let z;for(;b&&b!==E;)z=g(b),r(b,M,X),b=z;r(E,M,X)},j=({el:b,anchor:E})=>{let M;for(;b&&b!==E;)M=g(b),s(b),b=M;s(E)},O=(b,E,M,X,z,Z,he,oe,ne)=>{E.type==="svg"?he="svg":E.type==="math"&&(he="mathml"),b==null?se(E,M,X,z,Z,he,oe,ne):I(b,E,z,Z,he,oe,ne)},se=(b,E,M,X,z,Z,he,oe)=>{let ne,ee;const{props:Ie,shapeFlag:fe,transition:we,dirs:Re}=b;if(ne=b.el=o(b.type,Z,Ie&&Ie.is,Ie),fe&8?d(ne,b.children):fe&16&&w(b.children,ne,null,X,z,Vd(b,Z),he,oe),Re&&Zs(b,null,X,"created"),T(ne,b,b.scopeId,he,X),Ie){for(const Ee in Ie)Ee!=="value"&&!Va(Ee)&&i(ne,Ee,null,Ie[Ee],Z,X);"value"in Ie&&i(ne,"value",null,Ie.value,Z),(ee=Ie.onVnodeBeforeMount)&&hr(ee,X,b)}Re&&Zs(b,null,X,"beforeMount");const ae=fE(z,we);ae&&we.beforeEnter(ne),r(ne,E,M),((ee=Ie&&Ie.onVnodeMounted)||ae||Re)&&$n(()=>{ee&&hr(ee,X,b),ae&&we.enter(ne),Re&&Zs(b,null,X,"mounted")},z)},T=(b,E,M,X,z)=>{if(M&&_(b,M),X)for(let Z=0;Z<X.length;Z++)_(b,X[Z]);if(z){let Z=z.subTree;if(E===Z||qv(Z.type)&&(Z.ssContent===E||Z.ssFallback===E)){const he=z.vnode;T(b,he,he.scopeId,he.slotScopeIds,z.parent)}}},w=(b,E,M,X,z,Z,he,oe,ne=0)=>{for(let ee=ne;ee<b.length;ee++){const Ie=b[ee]=oe?ms(b[ee]):pr(b[ee]);x(null,Ie,E,M,X,z,Z,he,oe)}},I=(b,E,M,X,z,Z,he)=>{const oe=E.el=b.el;let{patchFlag:ne,dynamicChildren:ee,dirs:Ie}=E;ne|=b.patchFlag&16;const fe=b.props||ht,we=E.props||ht;let Re;if(M&&ei(M,!1),(Re=we.onVnodeBeforeUpdate)&&hr(Re,M,E,b),Ie&&Zs(E,b,M,"beforeUpdate"),M&&ei(M,!0),(fe.innerHTML&&we.innerHTML==null||fe.textContent&&we.textContent==null)&&d(oe,""),ee?P(b.dynamicChildren,ee,oe,M,X,Vd(E,z),Z):he||K(b,E,oe,null,M,X,Vd(E,z),Z,!1),ne>0){if(ne&16)k(oe,fe,we,M,z);else if(ne&2&&fe.class!==we.class&&i(oe,"class",null,we.class,z),ne&4&&i(oe,"style",fe.style,we.style,z),ne&8){const ae=E.dynamicProps;for(let Ee=0;Ee<ae.length;Ee++){const je=ae[Ee],Wt=fe[je],Ot=we[je];(Ot!==Wt||je==="value")&&i(oe,je,Wt,Ot,z,M)}}ne&1&&b.children!==E.children&&d(oe,E.children)}else!he&&ee==null&&k(oe,fe,we,M,z);((Re=we.onVnodeUpdated)||Ie)&&$n(()=>{Re&&hr(Re,M,E,b),Ie&&Zs(E,b,M,"updated")},X)},P=(b,E,M,X,z,Z,he)=>{for(let oe=0;oe<E.length;oe++){const ne=b[oe],ee=E[oe],Ie=ne.el&&(ne.type===Dt||!pa(ne,ee)||ne.shapeFlag&198)?f(ne.el):M;x(ne,ee,Ie,null,X,z,Z,he,!0)}},k=(b,E,M,X,z)=>{if(E!==M){if(E!==ht)for(const Z in E)!Va(Z)&&!(Z in M)&&i(b,Z,E[Z],null,z,X);for(const Z in M){if(Va(Z))continue;const he=M[Z],oe=E[Z];he!==oe&&Z!=="value"&&i(b,Z,oe,he,z,X)}"value"in M&&i(b,"value",E.value,M.value,z)}},D=(b,E,M,X,z,Z,he,oe,ne)=>{const ee=E.el=b?b.el:a(""),Ie=E.anchor=b?b.anchor:a("");let{patchFlag:fe,dynamicChildren:we,slotScopeIds:Re}=E;Re&&(oe=oe?oe.concat(Re):Re),b==null?(r(ee,M,X),r(Ie,M,X),w(E.children||[],M,Ie,z,Z,he,oe,ne)):fe>0&&fe&64&&we&&b.dynamicChildren?(P(b.dynamicChildren,we,M,z,Z,he,oe),(E.key!=null||z&&E===z.subTree)&&Fv(b,E,!0)):K(b,E,M,Ie,z,Z,he,oe,ne)},A=(b,E,M,X,z,Z,he,oe,ne)=>{E.slotScopeIds=oe,b==null?E.shapeFlag&512?z.ctx.activate(E,M,X,he,ne):Ht(E,M,X,z,Z,he,ne):jt(b,E,ne)},Ht=(b,E,M,X,z,Z,he)=>{const oe=b.component=kE(b,X,z);if(Tv(b)&&(oe.ctx.renderer=ie),DE(oe,!1,he),oe.asyncDep){if(z&&z.registerDep(oe,Ye,he),!b.el){const ne=oe.subTree=Ft(Cs);L(null,ne,E,M)}}else Ye(oe,b,E,M,z,Z,he)},jt=(b,E,M)=>{const X=E.component=b.component;if(IE(b,E,M))if(X.asyncDep&&!X.asyncResolved){ue(X,E,M);return}else X.next=E,X.update();else E.el=b.el,X.vnode=E},Ye=(b,E,M,X,z,Z,he)=>{const oe=()=>{if(b.isMounted){let{next:fe,bu:we,u:Re,parent:ae,vnode:Ee}=b;{const Mt=Uv(b);if(Mt){fe&&(fe.el=Ee.el,ue(b,fe,he)),Mt.asyncDep.then(()=>{b.isUnmounted||oe()});return}}let je=fe,Wt;ei(b,!1),fe?(fe.el=Ee.el,ue(b,fe,he)):fe=Ee,we&&Su(we),(Wt=fe.props&&fe.props.onVnodeBeforeUpdate)&&hr(Wt,ae,fe,Ee),ei(b,!0);const Ot=Nd(b),an=b.subTree;b.subTree=Ot,x(an,Ot,f(an.el),G(an),b,z,Z),fe.el=Ot.el,je===null&&EE(b,Ot.el),Re&&$n(Re,z),(Wt=fe.props&&fe.props.onVnodeUpdated)&&$n(()=>hr(Wt,ae,fe,Ee),z)}else{let fe;const{el:we,props:Re}=E,{bm:ae,m:Ee,parent:je,root:Wt,type:Ot}=b,an=La(E);if(ei(b,!1),ae&&Su(ae),!an&&(fe=Re&&Re.onVnodeBeforeMount)&&hr(fe,je,E),ei(b,!0),we&&ze){const Mt=()=>{b.subTree=Nd(b),ze(we,b.subTree,b,z,null)};an&&Ot.__asyncHydrate?Ot.__asyncHydrate(we,b,Mt):Mt()}else{Wt.ce&&Wt.ce._def.shadowRoot!==!1&&Wt.ce._injectChildStyle(Ot);const Mt=b.subTree=Nd(b);x(null,Mt,M,X,b,z,Z),E.el=Mt.el}if(Ee&&$n(Ee,z),!an&&(fe=Re&&Re.onVnodeMounted)){const Mt=E;$n(()=>hr(fe,je,Mt),z)}(E.shapeFlag&256||je&&La(je.vnode)&&je.vnode.shapeFlag&256)&&b.a&&$n(b.a,z),b.isMounted=!0,E=M=X=null}};b.scope.on();const ne=b.effect=new Z_(oe);b.scope.off();const ee=b.update=ne.run.bind(ne),Ie=b.job=ne.runIfDirty.bind(ne);Ie.i=b,Ie.id=b.uid,ne.scheduler=()=>uf(Ie),ei(b,!0),ee()},ue=(b,E,M)=>{E.component=b;const X=b.vnode.props;b.vnode=E,b.next=null,oE(b,E.props,X,M),cE(b,E.children,M),Br(),cm(b),$r()},K=(b,E,M,X,z,Z,he,oe,ne=!1)=>{const ee=b&&b.children,Ie=b?b.shapeFlag:0,fe=E.children,{patchFlag:we,shapeFlag:Re}=E;if(we>0){if(we&128){ke(ee,fe,M,X,z,Z,he,oe,ne);return}else if(we&256){Pe(ee,fe,M,X,z,Z,he,oe,ne);return}}Re&8?(Ie&16&&qt(ee,z,Z),fe!==ee&&d(M,fe)):Ie&16?Re&16?ke(ee,fe,M,X,z,Z,he,oe,ne):qt(ee,z,Z,!0):(Ie&8&&d(M,""),Re&16&&w(fe,M,X,z,Z,he,oe,ne))},Pe=(b,E,M,X,z,Z,he,oe,ne)=>{b=b||ro,E=E||ro;const ee=b.length,Ie=E.length,fe=Math.min(ee,Ie);let we;for(we=0;we<fe;we++){const Re=E[we]=ne?ms(E[we]):pr(E[we]);x(b[we],Re,M,null,z,Z,he,oe,ne)}ee>Ie?qt(b,z,Z,!0,!1,fe):w(E,M,X,z,Z,he,oe,ne,fe)},ke=(b,E,M,X,z,Z,he,oe,ne)=>{let ee=0;const Ie=E.length;let fe=b.length-1,we=Ie-1;for(;ee<=fe&&ee<=we;){const Re=b[ee],ae=E[ee]=ne?ms(E[ee]):pr(E[ee]);if(pa(Re,ae))x(Re,ae,M,null,z,Z,he,oe,ne);else break;ee++}for(;ee<=fe&&ee<=we;){const Re=b[fe],ae=E[we]=ne?ms(E[we]):pr(E[we]);if(pa(Re,ae))x(Re,ae,M,null,z,Z,he,oe,ne);else break;fe--,we--}if(ee>fe){if(ee<=we){const Re=we+1,ae=Re<Ie?E[Re].el:X;for(;ee<=we;)x(null,E[ee]=ne?ms(E[ee]):pr(E[ee]),M,ae,z,Z,he,oe,ne),ee++}}else if(ee>we)for(;ee<=fe;)Ve(b[ee],z,Z,!0),ee++;else{const Re=ee,ae=ee,Ee=new Map;for(ee=ae;ee<=we;ee++){const wt=E[ee]=ne?ms(E[ee]):pr(E[ee]);wt.key!=null&&Ee.set(wt.key,ee)}let je,Wt=0;const Ot=we-ae+1;let an=!1,Mt=0;const kn=new Array(Ot);for(ee=0;ee<Ot;ee++)kn[ee]=0;for(ee=Re;ee<=fe;ee++){const wt=b[ee];if(Wt>=Ot){Ve(wt,z,Z,!0);continue}let Qt;if(wt.key!=null)Qt=Ee.get(wt.key);else for(je=ae;je<=we;je++)if(kn[je-ae]===0&&pa(wt,E[je])){Qt=je;break}Qt===void 0?Ve(wt,z,Z,!0):(kn[Qt-ae]=ee+1,Qt>=Mt?Mt=Qt:an=!0,x(wt,E[Qt],M,null,z,Z,he,oe,ne),Wt++)}const or=an?pE(kn):ro;for(je=or.length-1,ee=Ot-1;ee>=0;ee--){const wt=ae+ee,Qt=E[wt],ar=wt+1<Ie?E[wt+1].el:X;kn[ee]===0?x(null,Qt,M,ar,z,Z,he,oe,ne):an&&(je<0||ee!==or[je]?We(Qt,M,ar,2):je--)}}},We=(b,E,M,X,z=null)=>{const{el:Z,type:he,transition:oe,children:ne,shapeFlag:ee}=b;if(ee&6){We(b.component.subTree,E,M,X);return}if(ee&128){b.suspense.move(E,M,X);return}if(ee&64){he.move(b,E,M,ie);return}if(he===Dt){r(Z,E,M);for(let fe=0;fe<ne.length;fe++)We(ne[fe],E,M,X);r(b.anchor,E,M);return}if(he===Ru){$(b,E,M);return}if(X!==2&&ee&1&&oe)if(X===0)oe.beforeEnter(Z),r(Z,E,M),$n(()=>oe.enter(Z),z);else{const{leave:fe,delayLeave:we,afterLeave:Re}=oe,ae=()=>{b.ctx.isUnmounted?s(Z):r(Z,E,M)},Ee=()=>{fe(Z,()=>{ae(),Re&&Re()})};we?we(Z,ae,Ee):Ee()}else r(Z,E,M)},Ve=(b,E,M,X=!1,z=!1)=>{const{type:Z,props:he,ref:oe,children:ne,dynamicChildren:ee,shapeFlag:Ie,patchFlag:fe,dirs:we,cacheIndex:Re}=b;if(fe===-2&&(z=!1),oe!=null&&(Br(),Ma(oe,null,M,b,!0),$r()),Re!=null&&(E.renderCache[Re]=void 0),Ie&256){E.ctx.deactivate(b);return}const ae=Ie&1&&we,Ee=!La(b);let je;if(Ee&&(je=he&&he.onVnodeBeforeUnmount)&&hr(je,E,b),Ie&6)Tn(b.component,M,X);else{if(Ie&128){b.suspense.unmount(M,X);return}ae&&Zs(b,null,E,"beforeUnmount"),Ie&64?b.type.remove(b,E,M,ie,X):ee&&!ee.hasOnce&&(Z!==Dt||fe>0&&fe&64)?qt(ee,E,M,!1,!0):(Z===Dt&&fe&384||!z&&Ie&16)&&qt(ne,E,M),X&&Qe(b)}(Ee&&(je=he&&he.onVnodeUnmounted)||ae)&&$n(()=>{je&&hr(je,E,b),ae&&Zs(b,null,E,"unmounted")},M)},Qe=b=>{const{type:E,el:M,anchor:X,transition:z}=b;if(E===Dt){fn(M,X);return}if(E===Ru){j(b);return}const Z=()=>{s(M),z&&!z.persisted&&z.afterLeave&&z.afterLeave()};if(b.shapeFlag&1&&z&&!z.persisted){const{leave:he,delayLeave:oe}=z,ne=()=>he(M,Z);oe?oe(b.el,Z,ne):ne()}else Z()},fn=(b,E)=>{let M;for(;b!==E;)M=g(b),s(b),b=M;s(E)},Tn=(b,E,M)=>{const{bum:X,scope:z,job:Z,subTree:he,um:oe,m:ne,a:ee,parent:Ie,slots:{__:fe}}=b;_m(ne),_m(ee),X&&Su(X),Ie&&De(fe)&&fe.forEach(we=>{Ie.renderCache[we]=void 0}),z.stop(),Z&&(Z.flags|=8,Ve(he,b,E,M)),oe&&$n(oe,E),$n(()=>{b.isUnmounted=!0},E),E&&E.pendingBranch&&!E.isUnmounted&&b.asyncDep&&!b.asyncResolved&&b.suspenseId===E.pendingId&&(E.deps--,E.deps===0&&E.resolve())},qt=(b,E,M,X=!1,z=!1,Z=0)=>{for(let he=Z;he<b.length;he++)Ve(b[he],E,M,X,z)},G=b=>{if(b.shapeFlag&6)return G(b.component.subTree);if(b.shapeFlag&128)return b.suspense.next();const E=g(b.anchor||b.el),M=E&&E[MI];return M?g(M):E};let me=!1;const ce=(b,E,M)=>{b==null?E._vnode&&Ve(E._vnode,null,null,!0):x(E._vnode||null,b,E,null,null,null,M),E._vnode=b,me||(me=!0,cm(),yv(),me=!1)},ie={p:x,um:Ve,m:We,r:Qe,mt:Ht,mc:w,pc:K,pbc:P,n:G,o:n};let Ne,ze;return e&&([Ne,ze]=e(ie)),{render:ce,hydrate:Ne,createApp:sE(ce,Ne)}}function Vd({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function ei({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function fE(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function Fv(n,e,t=!1){const r=n.children,s=e.children;if(De(r)&&De(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=ms(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&Fv(o,a)),a.type===Vc&&(a.el=o.el),a.type===Cs&&!a.el&&(a.el=o.el)}}function pE(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function Uv(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Uv(e)}function _m(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const mE=Symbol.for("v-scx"),gE=()=>rr(mE);function sr(n,e,t){return Bv(n,e,t)}function Bv(n,e,t=ht){const{immediate:r,deep:s,flush:i,once:o}=t,a=on({},t),l=e&&r||!e&&i!=="post";let c;if(Za){if(i==="sync"){const _=gE();c=_.__watcherHandles||(_.__watcherHandles=[])}else if(!l){const _=()=>{};return _.stop=er,_.resume=er,_.pause=er,_}}const d=yn;a.call=(_,C,x)=>br(_,d,C,x);let f=!1;i==="post"?a.scheduler=_=>{$n(_,d&&d.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(_,C)=>{C?_():uf(_)}),a.augmentJob=_=>{e&&(_.flags|=4),f&&(_.flags|=2,d&&(_.id=d.uid,_.i=d))};const g=kI(n,e,a);return Za&&(c?c.push(g):l&&g()),g}function _E(n,e,t){const r=this.proxy,s=Kt(n)?n.includes(".")?$v(r,n):()=>r[n]:n.bind(r,r);let i;Le(e)?i=e:(i=e.handler,t=e);const o=El(this),a=Bv(s,i.bind(r),t);return o(),a}function $v(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const vE=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Wn(e)}Modifiers`]||n[`${Bs(e)}Modifiers`];function yE(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||ht;let s=t;const i=e.startsWith("update:"),o=i&&vE(r,e.slice(7));o&&(o.trim&&(s=t.map(d=>Kt(d)?d.trim():d)),o.number&&(s=t.map(ah)));let a,l=r[a=Sd(e)]||r[a=Sd(Wn(e))];!l&&i&&(l=r[a=Sd(Bs(e))]),l&&br(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,br(c,n,6,s)}}function jv(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!Le(n)){const l=c=>{const d=jv(c,e,!0);d&&(a=!0,on(o,d))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(Tt(n)&&r.set(n,null),null):(De(i)?i.forEach(l=>o[l]=null):on(o,i),Tt(n)&&r.set(n,o),o)}function Dc(n,e){return!n||!Ic(e)?!1:(e=e.slice(2).replace(/Once$/,""),rt(n,e[0].toLowerCase()+e.slice(1))||rt(n,Bs(e))||rt(n,e))}function Nd(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:d,props:f,data:g,setupState:_,ctx:C,inheritAttrs:x}=n,R=Qu(n);let L,B;try{if(t.shapeFlag&4){const j=s||r,O=j;L=pr(c.call(O,j,d,f,_,g,C)),B=a}else{const j=e;L=pr(j.length>1?j(f,{attrs:a,slots:o,emit:l}):j(f,null)),B=e.props?a:wE(a)}}catch(j){Ua.length=0,Cc(j,n,1),L=Ft(Cs)}let $=L;if(B&&x!==!1){const j=Object.keys(B),{shapeFlag:O}=$;j.length&&O&7&&(i&&j.some(Xh)&&(B=bE(B,i)),$=vo($,B,!1,!0))}return t.dirs&&($=vo($,null,!1,!0),$.dirs=$.dirs?$.dirs.concat(t.dirs):t.dirs),t.transition&&cf($,t.transition),L=$,Qu(R),L}const wE=n=>{let e;for(const t in n)(t==="class"||t==="style"||Ic(t))&&((e||(e={}))[t]=n[t]);return e},bE=(n,e)=>{const t={};for(const r in n)(!Xh(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function IE(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?vm(r,o,c):!!o;if(l&8){const d=e.dynamicProps;for(let f=0;f<d.length;f++){const g=d[f];if(o[g]!==r[g]&&!Dc(c,g))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?vm(r,o,c):!0:!!o;return!1}function vm(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!Dc(t,i))return!0}return!1}function EE({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const qv=n=>n.__isSuspense;function TE(n,e){e&&e.pendingBranch?De(n)?e.effects.push(...n):e.effects.push(n):NI(n)}const Dt=Symbol.for("v-fgt"),Vc=Symbol.for("v-txt"),Cs=Symbol.for("v-cmt"),Ru=Symbol.for("v-stc"),Ua=[];let zn=null;function W(n=!1){Ua.push(zn=n?null:[])}function AE(){Ua.pop(),zn=Ua[Ua.length-1]||null}let Xa=1;function ym(n,e=!1){Xa+=n,n<0&&zn&&e&&(zn.hasOnce=!0)}function zv(n){return n.dynamicChildren=Xa>0?zn||ro:null,AE(),Xa>0&&zn&&zn.push(n),n}function Q(n,e,t,r,s,i){return zv(m(n,e,t,r,s,i,!0))}function Gv(n,e,t,r,s){return zv(Ft(n,e,t,r,s,!0))}function Yu(n){return n?n.__v_isVNode===!0:!1}function pa(n,e){return n.type===e.type&&n.key===e.key}const Kv=({key:n})=>n??null,Cu=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?Kt(n)||wn(n)||Le(n)?{i:qn,r:n,k:e,f:!!t}:n:null);function m(n,e=null,t=null,r=0,s=null,i=n===Dt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&Kv(e),ref:e&&Cu(e),scopeId:bv,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:qn};return a?(mf(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=Kt(t)?8:16),Xa>0&&!o&&zn&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&zn.push(l),l}const Ft=xE;function xE(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===QI)&&(n=Cs),Yu(n)){const a=vo(n,e,!0);return t&&mf(a,t),Xa>0&&!i&&zn&&(a.shapeFlag&6?zn[zn.indexOf(n)]=a:zn.push(a)),a.patchFlag=-2,a}if(LE(n)&&(n=n.__vccOpts),e){e=SE(e);let{class:a,style:l}=e;a&&!Kt(a)&&(e.class=tr(a)),Tt(l)&&(lf(l)&&!De(l)&&(l=on({},l)),e.style=Sc(l))}const o=Kt(n)?1:qv(n)?128:LI(n)?64:Tt(n)?4:Le(n)?2:0;return m(n,e,t,r,s,o,i,!0)}function SE(n){return n?lf(n)||Dv(n)?on({},n):n:null}function vo(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?PE(s||{},e):s,d={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&Kv(c),ref:e&&e.ref?t&&i?De(i)?i.concat(Cu(e)):[i,Cu(e)]:Cu(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==Dt?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&vo(n.ssContent),ssFallback:n.ssFallback&&vo(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&cf(d,l.clone(d)),d}function jn(n=" ",e=0){return Ft(Vc,null,n,e)}function fs(n,e){const t=Ft(Ru,null,n);return t.staticCount=e,t}function Se(n="",e=!1){return e?(W(),Gv(Cs,null,n)):Ft(Cs,null,n)}function pr(n){return n==null||typeof n=="boolean"?Ft(Cs):De(n)?Ft(Dt,null,n.slice()):Yu(n)?ms(n):Ft(Vc,null,String(n))}function ms(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:vo(n)}function mf(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(De(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),mf(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!Dv(e)?e._ctx=qn:s===3&&qn&&(qn.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Le(e)?(e={default:e,_ctx:qn},t=32):(e=String(e),r&64?(t=16,e=[jn(e)]):t=8);n.children=e,n.shapeFlag|=t}function PE(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=tr([e.class,r.class]));else if(s==="style")e.style=Sc([e.style,r.style]);else if(Ic(s)){const i=e[s],o=r[s];o&&i!==o&&!(De(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function hr(n,e,t,r=null){br(n,e,7,[t,r])}const RE=Rv();let CE=0;function kE(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||RE,i={uid:CE++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new sI(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Nv(r,s),emitsOptions:jv(r,s),emit:null,emitted:null,propsDefaults:ht,inheritAttrs:r.inheritAttrs,ctx:ht,data:ht,props:ht,attrs:ht,slots:ht,refs:ht,setupState:ht,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=yE.bind(null,i),n.ce&&n.ce(i),i}let yn=null,Xu,gh;{const n=xc(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};Xu=e("__VUE_INSTANCE_SETTERS__",t=>yn=t),gh=e("__VUE_SSR_SETTERS__",t=>Za=t)}const El=n=>{const e=yn;return Xu(n),n.scope.on(),()=>{n.scope.off(),Xu(e)}},wm=()=>{yn&&yn.scope.off(),Xu(null)};function Hv(n){return n.vnode.shapeFlag&4}let Za=!1;function DE(n,e=!1,t=!1){e&&gh(e);const{props:r,children:s}=n.vnode,i=Hv(n);iE(n,r,i,e),uE(n,s,t||e);const o=i?VE(n,e):void 0;return e&&gh(!1),o}function VE(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,YI);const{setup:r}=t;if(r){Br();const s=n.setupContext=r.length>1?OE(n):null,i=El(n),o=Il(r,n,0,[n.props,s]),a=H_(o);if($r(),i(),(a||n.sp)&&!La(n)&&Ev(n),a){if(o.then(wm,wm),e)return o.then(l=>{bm(n,l,e)}).catch(l=>{Cc(l,n,0)});n.asyncDep=o}else bm(n,o,e)}else Wv(n,e)}function bm(n,e,t){Le(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Tt(e)&&(n.setupState=gv(e)),Wv(n,t)}let Im;function Wv(n,e,t){const r=n.type;if(!n.render){if(!e&&Im&&!r.render){const s=r.template||hf(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=on(on({isCustomElement:i,delimiters:a},o),l);r.render=Im(s,c)}}n.render=r.render||er}{const s=El(n);Br();try{XI(n)}finally{$r(),s()}}}const NE={get(n,e){return vn(n,"get",""),n[e]}};function OE(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,NE),slots:n.slots,emit:n.emit,expose:e}}function Nc(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(gv(TI(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in Fa)return Fa[t](n)},has(e,t){return t in e||t in Fa}})):n.proxy}function ME(n,e=!0){return Le(n)?n.displayName||n.name:n.name||e&&n.__name}function LE(n){return Le(n)&&"__vccOpts"in n}const Xt=(n,e)=>RI(n,e,Za);function Qv(n,e,t){const r=arguments.length;return r===2?Tt(e)&&!De(e)?Yu(e)?Ft(n,null,[e]):Ft(n,e):Ft(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&Yu(t)&&(t=[t]),Ft(n,e,t))}const FE="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let _h;const Em=typeof window<"u"&&window.trustedTypes;if(Em)try{_h=Em.createPolicy("vue",{createHTML:n=>n})}catch{}const Jv=_h?n=>_h.createHTML(n):n=>n,UE="http://www.w3.org/2000/svg",BE="http://www.w3.org/1998/Math/MathML",Cr=typeof document<"u"?document:null,Tm=Cr&&Cr.createElement("template"),$E={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?Cr.createElementNS(UE,n):e==="mathml"?Cr.createElementNS(BE,n):t?Cr.createElement(n,{is:t}):Cr.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>Cr.createTextNode(n),createComment:n=>Cr.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Cr.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{Tm.innerHTML=Jv(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=Tm.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},jE=Symbol("_vtc");function qE(n,e,t){const r=n[jE];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const Zu=Symbol("_vod"),Yv=Symbol("_vsh"),Am={beforeMount(n,{value:e},{transition:t}){n[Zu]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):ma(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),ma(n,!0),r.enter(n)):r.leave(n,()=>{ma(n,!1)}):ma(n,e))},beforeUnmount(n,{value:e}){ma(n,e)}};function ma(n,e){n.style.display=e?n[Zu]:"none",n[Yv]=!e}const zE=Symbol(""),GE=/(^|;)\s*display\s*:/;function KE(n,e,t){const r=n.style,s=Kt(t);let i=!1;if(t&&!s){if(e)if(Kt(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&ku(r,a,"")}else for(const o in e)t[o]==null&&ku(r,o,"");for(const o in t)o==="display"&&(i=!0),ku(r,o,t[o])}else if(s){if(e!==t){const o=r[zE];o&&(t+=";"+o),r.cssText=t,i=GE.test(t)}}else e&&n.removeAttribute("style");Zu in n&&(n[Zu]=i?r.display:"",n[Yv]&&(r.display="none"))}const xm=/\s*!important$/;function ku(n,e,t){if(De(t))t.forEach(r=>ku(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=HE(n,e);xm.test(t)?n.setProperty(Bs(r),t.replace(xm,""),"important"):n[r]=t}}const Sm=["Webkit","Moz","ms"],Od={};function HE(n,e){const t=Od[e];if(t)return t;let r=Wn(e);if(r!=="filter"&&r in n)return Od[e]=r;r=Ac(r);for(let s=0;s<Sm.length;s++){const i=Sm[s]+r;if(i in n)return Od[e]=i}return e}const Pm="http://www.w3.org/1999/xlink";function Rm(n,e,t,r,s,i=rI(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(Pm,e.slice(6,e.length)):n.setAttributeNS(Pm,e,t):t==null||i&&!J_(t)?n.removeAttribute(e):n.setAttribute(e,i?"":Us(t)?String(t):t)}function Cm(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?Jv(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=J_(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function Yi(n,e,t,r){n.addEventListener(e,t,r)}function WE(n,e,t,r){n.removeEventListener(e,t,r)}const km=Symbol("_vei");function QE(n,e,t,r,s=null){const i=n[km]||(n[km]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=JE(e);if(r){const c=i[e]=ZE(r,s);Yi(n,a,c,l)}else o&&(WE(n,a,o,l),i[e]=void 0)}}const Dm=/(?:Once|Passive|Capture)$/;function JE(n){let e;if(Dm.test(n)){e={};let r;for(;r=n.match(Dm);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Bs(n.slice(2)),e]}let Md=0;const YE=Promise.resolve(),XE=()=>Md||(YE.then(()=>Md=0),Md=Date.now());function ZE(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;br(eT(r,t.value),e,5,[r])};return t.value=n,t.attached=XE(),t}function eT(n,e){if(De(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const Vm=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,tT=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?qE(n,r,o):e==="style"?KE(n,t,r):Ic(e)?Xh(e)||QE(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):nT(n,e,r,o))?(Cm(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Rm(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!Kt(r))?Cm(n,Wn(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),Rm(n,e,r,o))};function nT(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&Vm(e)&&Le(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Vm(e)&&Kt(t)?!1:e in n}const Nm=n=>{const e=n.props["onUpdate:modelValue"]||!1;return De(e)?t=>Su(e,t):e};function rT(n){n.target.composing=!0}function Om(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Ld=Symbol("_assign"),xt={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[Ld]=Nm(s);const i=r||s.props&&s.props.type==="number";Yi(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=ah(a)),n[Ld](a)}),t&&Yi(n,"change",()=>{n.value=n.value.trim()}),e||(Yi(n,"compositionstart",rT),Yi(n,"compositionend",Om),Yi(n,"change",Om))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[Ld]=Nm(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?ah(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},sT=["ctrl","shift","alt","meta"],iT={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>sT.some(t=>n[`${t}Key`]&&!e.includes(t))},Nn=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=iT[e[o]];if(a&&a(s,e))return}return n(s,...i)})},oT={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Sn=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=Bs(s.key);if(e.some(o=>o===i||oT[o]===i))return n(s)})},aT=on({patchProp:tT},$E);let Mm;function lT(){return Mm||(Mm=dE(aT))}const uT=(...n)=>{const e=lT().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=dT(r);if(!s)return;const i=e._component;!Le(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,cT(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function cT(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function dT(n){return Kt(n)?document.querySelector(n):n}const hT={__name:"App",setup(n){return(e,t)=>{const r=WI("router-view");return W(),Gv(r)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const Xi=typeof document<"u";function Xv(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function fT(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&Xv(n.default)}const tt=Object.assign;function Fd(n,e){const t={};for(const r in e){const s=e[r];t[r]=ir(s)?s.map(n):n(s)}return t}const Ba=()=>{},ir=Array.isArray,Zv=/#/g,pT=/&/g,mT=/\//g,gT=/=/g,_T=/\?/g,ey=/\+/g,vT=/%5B/g,yT=/%5D/g,ty=/%5E/g,wT=/%60/g,ny=/%7B/g,bT=/%7C/g,ry=/%7D/g,IT=/%20/g;function gf(n){return encodeURI(""+n).replace(bT,"|").replace(vT,"[").replace(yT,"]")}function ET(n){return gf(n).replace(ny,"{").replace(ry,"}").replace(ty,"^")}function vh(n){return gf(n).replace(ey,"%2B").replace(IT,"+").replace(Zv,"%23").replace(pT,"%26").replace(wT,"`").replace(ny,"{").replace(ry,"}").replace(ty,"^")}function TT(n){return vh(n).replace(gT,"%3D")}function AT(n){return gf(n).replace(Zv,"%23").replace(_T,"%3F")}function xT(n){return n==null?"":AT(n).replace(mT,"%2F")}function el(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const ST=/\/$/,PT=n=>n.replace(ST,"");function Ud(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=DT(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:el(o)}}function RT(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function Lm(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function CT(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&yo(e.matched[r],t.matched[s])&&sy(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function yo(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function sy(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!kT(n[t],e[t]))return!1;return!0}function kT(n,e){return ir(n)?Fm(n,e):ir(e)?Fm(e,n):n===e}function Fm(n,e){return ir(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function DT(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const us={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var tl;(function(n){n.pop="pop",n.push="push"})(tl||(tl={}));var $a;(function(n){n.back="back",n.forward="forward",n.unknown=""})($a||($a={}));function VT(n){if(!n)if(Xi){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),PT(n)}const NT=/^[^#]+#/;function OT(n,e){return n.replace(NT,"#")+e}function MT(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const Oc=()=>({left:window.scrollX,top:window.scrollY});function LT(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=MT(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function Um(n,e){return(history.state?history.state.position-e:-1)+n}const yh=new Map;function FT(n,e){yh.set(n,e)}function UT(n){const e=yh.get(n);return yh.delete(n),e}let BT=()=>location.protocol+"//"+location.host;function iy(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),Lm(l,"")}return Lm(t,n)+r+s}function $T(n,e,t,r){let s=[],i=[],o=null;const a=({state:g})=>{const _=iy(n,location),C=t.value,x=e.value;let R=0;if(g){if(t.value=_,e.value=g,o&&o===C){o=null;return}R=x?g.position-x.position:0}else r(_);s.forEach(L=>{L(t.value,C,{delta:R,type:tl.pop,direction:R?R>0?$a.forward:$a.back:$a.unknown})})};function l(){o=t.value}function c(g){s.push(g);const _=()=>{const C=s.indexOf(g);C>-1&&s.splice(C,1)};return i.push(_),_}function d(){const{history:g}=window;g.state&&g.replaceState(tt({},g.state,{scroll:Oc()}),"")}function f(){for(const g of i)g();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",d)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",d,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function Bm(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?Oc():null}}function jT(n){const{history:e,location:t}=window,r={value:iy(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,d){const f=n.indexOf("#"),g=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:BT()+n+l;try{e[d?"replaceState":"pushState"](c,"",g),s.value=c}catch(_){console.error(_),t[d?"replace":"assign"](g)}}function o(l,c){const d=tt({},e.state,Bm(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,d,!0),r.value=l}function a(l,c){const d=tt({},s.value,e.state,{forward:l,scroll:Oc()});i(d.current,d,!0);const f=tt({},Bm(r.value,l,null),{position:d.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function qT(n){n=VT(n);const e=jT(n),t=$T(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=tt({location:"",base:n,go:r,createHref:OT.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function zT(n){return typeof n=="string"||n&&typeof n=="object"}function oy(n){return typeof n=="string"||typeof n=="symbol"}const ay=Symbol("");var $m;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})($m||($m={}));function wo(n,e){return tt(new Error,{type:n,[ay]:!0},e)}function Rr(n,e){return n instanceof Error&&ay in n&&(e==null||!!(n.type&e))}const jm="[^/]+?",GT={sensitive:!1,strict:!1,start:!0,end:!0},KT=/[.+*?^${}()[\]/\\]/g;function HT(n,e){const t=tt({},GT,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const d=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const g=c[f];let _=40+(t.sensitive?.25:0);if(g.type===0)f||(s+="/"),s+=g.value.replace(KT,"\\$&"),_+=40;else if(g.type===1){const{value:C,repeatable:x,optional:R,regexp:L}=g;i.push({name:C,repeatable:x,optional:R});const B=L||jm;if(B!==jm){_+=10;try{new RegExp(`(${B})`)}catch(j){throw new Error(`Invalid custom RegExp for param "${C}" (${B}): `+j.message)}}let $=x?`((?:${B})(?:/(?:${B}))*)`:`(${B})`;f||($=R&&c.length<2?`(?:/${$})`:"/"+$),R&&($+="?"),s+=$,_+=20,R&&(_+=-8),x&&(_+=-20),B===".*"&&(_+=-50)}d.push(_)}r.push(d)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const d=c.match(o),f={};if(!d)return null;for(let g=1;g<d.length;g++){const _=d[g]||"",C=i[g-1];f[C.name]=_&&C.repeatable?_.split("/"):_}return f}function l(c){let d="",f=!1;for(const g of n){(!f||!d.endsWith("/"))&&(d+="/"),f=!1;for(const _ of g)if(_.type===0)d+=_.value;else if(_.type===1){const{value:C,repeatable:x,optional:R}=_,L=C in c?c[C]:"";if(ir(L)&&!x)throw new Error(`Provided param "${C}" is an array but it is not repeatable (* or + modifiers)`);const B=ir(L)?L.join("/"):L;if(!B)if(R)g.length<2&&(d.endsWith("/")?d=d.slice(0,-1):f=!0);else throw new Error(`Missing required param "${C}"`);d+=B}}return d||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function WT(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function ly(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=WT(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(qm(r))return 1;if(qm(s))return-1}return s.length-r.length}function qm(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const QT={type:0,value:""},JT=/[a-zA-Z0-9_]/;function YT(n){if(!n)return[[]];if(n==="/")return[[QT]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(_){throw new Error(`ERR (${t})/"${c}": ${_}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",d="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:d,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function g(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):g();break;case 4:g(),t=r;break;case 1:l==="("?t=2:JT.test(l)?g():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?d[d.length-1]=="\\"?d=d.slice(0,-1)+l:t=3:d+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,d="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function XT(n,e,t){const r=HT(YT(n.path),t),s=tt(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function ZT(n,e){const t=[],r=new Map;e=Hm({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,g,_){const C=!_,x=Gm(f);x.aliasOf=_&&_.record;const R=Hm(e,f),L=[x];if("alias"in f){const j=typeof f.alias=="string"?[f.alias]:f.alias;for(const O of j)L.push(Gm(tt({},x,{components:_?_.record.components:x.components,path:O,aliasOf:_?_.record:x})))}let B,$;for(const j of L){const{path:O}=j;if(g&&O[0]!=="/"){const se=g.record.path,T=se[se.length-1]==="/"?"":"/";j.path=g.record.path+(O&&T+O)}if(B=XT(j,g,R),_?_.alias.push(B):($=$||B,$!==B&&$.alias.push(B),C&&f.name&&!Km(B)&&o(f.name)),uy(B)&&l(B),x.children){const se=x.children;for(let T=0;T<se.length;T++)i(se[T],B,_&&_.children[T])}_=_||B}return $?()=>{o($)}:Ba}function o(f){if(oy(f)){const g=r.get(f);g&&(r.delete(f),t.splice(t.indexOf(g),1),g.children.forEach(o),g.alias.forEach(o))}else{const g=t.indexOf(f);g>-1&&(t.splice(g,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const g=nA(f,t);t.splice(g,0,f),f.record.name&&!Km(f)&&r.set(f.record.name,f)}function c(f,g){let _,C={},x,R;if("name"in f&&f.name){if(_=r.get(f.name),!_)throw wo(1,{location:f});R=_.record.name,C=tt(zm(g.params,_.keys.filter($=>!$.optional).concat(_.parent?_.parent.keys.filter($=>$.optional):[]).map($=>$.name)),f.params&&zm(f.params,_.keys.map($=>$.name))),x=_.stringify(C)}else if(f.path!=null)x=f.path,_=t.find($=>$.re.test(x)),_&&(C=_.parse(x),R=_.record.name);else{if(_=g.name?r.get(g.name):t.find($=>$.re.test(g.path)),!_)throw wo(1,{location:f,currentLocation:g});R=_.record.name,C=tt({},g.params,f.params),x=_.stringify(C)}const L=[];let B=_;for(;B;)L.unshift(B.record),B=B.parent;return{name:R,path:x,params:C,matched:L,meta:tA(L)}}n.forEach(f=>i(f));function d(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:d,getRoutes:a,getRecordMatcher:s}}function zm(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function Gm(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:eA(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function eA(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function Km(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function tA(n){return n.reduce((e,t)=>tt(e,t.meta),{})}function Hm(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function nA(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;ly(n,e[i])<0?r=i:t=i+1}const s=rA(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function rA(n){let e=n;for(;e=e.parent;)if(uy(e)&&ly(n,e)===0)return e}function uy({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function sA(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(ey," "),o=i.indexOf("="),a=el(o<0?i:i.slice(0,o)),l=o<0?null:el(i.slice(o+1));if(a in e){let c=e[a];ir(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function Wm(n){let e="";for(let t in n){const r=n[t];if(t=TT(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(ir(r)?r.map(i=>i&&vh(i)):[r&&vh(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function iA(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=ir(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const oA=Symbol(""),Qm=Symbol(""),Mc=Symbol(""),_f=Symbol(""),wh=Symbol("");function ga(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function gs(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=g=>{g===!1?l(wo(4,{from:t,to:e})):g instanceof Error?l(g):zT(g)?l(wo(2,{from:e,to:g})):(o&&r.enterCallbacks[s]===o&&typeof g=="function"&&o.push(g),a())},d=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(d);n.length<3&&(f=f.then(c)),f.catch(g=>l(g))})}function Bd(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(Xv(l)){const d=(l.__vccOpts||l)[e];d&&i.push(gs(d,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(d=>{if(!d)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=fT(d)?d.default:d;o.mods[a]=d,o.components[a]=f;const _=(f.__vccOpts||f)[e];return _&&gs(_,t,r,o,a,s)()}))}}return i}function Jm(n){const e=rr(Mc),t=rr(_f),r=Xt(()=>{const l=oo(n.to);return e.resolve(l)}),s=Xt(()=>{const{matched:l}=r.value,{length:c}=l,d=l[c-1],f=t.matched;if(!d||!f.length)return-1;const g=f.findIndex(yo.bind(null,d));if(g>-1)return g;const _=Ym(l[c-2]);return c>1&&Ym(d)===_&&f[f.length-1].path!==_?f.findIndex(yo.bind(null,l[c-2])):g}),i=Xt(()=>s.value>-1&&dA(t.params,r.value.params)),o=Xt(()=>s.value>-1&&s.value===t.matched.length-1&&sy(t.params,r.value.params));function a(l={}){if(cA(l)){const c=e[oo(n.replace)?"replace":"push"](oo(n.to)).catch(Ba);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:Xt(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function aA(n){return n.length===1?n[0]:n}const lA=Iv({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:Jm,setup(n,{slots:e}){const t=Rc(Jm(n)),{options:r}=rr(Mc),s=Xt(()=>({[Xm(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[Xm(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&aA(e.default(t));return n.custom?i:Qv("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),uA=lA;function cA(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function dA(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!ir(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function Ym(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const Xm=(n,e,t)=>n??e??t,hA=Iv({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=rr(wh),s=Xt(()=>n.route||r.value),i=rr(Qm,0),o=Xt(()=>{let c=oo(i);const{matched:d}=s.value;let f;for(;(f=d[c])&&!f.components;)c++;return c}),a=Xt(()=>s.value.matched[o.value]);Pu(Qm,Xt(()=>o.value+1)),Pu(oA,a),Pu(wh,s);const l=q();return sr(()=>[l.value,a.value,n.name],([c,d,f],[g,_,C])=>{d&&(d.instances[f]=c,_&&_!==d&&c&&c===g&&(d.leaveGuards.size||(d.leaveGuards=_.leaveGuards),d.updateGuards.size||(d.updateGuards=_.updateGuards))),c&&d&&(!_||!yo(d,_)||!g)&&(d.enterCallbacks[f]||[]).forEach(x=>x(c))},{flush:"post"}),()=>{const c=s.value,d=n.name,f=a.value,g=f&&f.components[d];if(!g)return Zm(t.default,{Component:g,route:c});const _=f.props[d],C=_?_===!0?c.params:typeof _=="function"?_(c):_:null,R=Qv(g,tt({},C,e,{onVnodeUnmounted:L=>{L.component.isUnmounted&&(f.instances[d]=null)},ref:l}));return Zm(t.default,{Component:R,route:c})||R}}});function Zm(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const fA=hA;function pA(n){const e=ZT(n.routes,n),t=n.parseQuery||sA,r=n.stringifyQuery||Wm,s=n.history,i=ga(),o=ga(),a=ga(),l=AI(us);let c=us;Xi&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=Fd.bind(null,G=>""+G),f=Fd.bind(null,xT),g=Fd.bind(null,el);function _(G,me){let ce,ie;return oy(G)?(ce=e.getRecordMatcher(G),ie=me):ie=G,e.addRoute(ie,ce)}function C(G){const me=e.getRecordMatcher(G);me&&e.removeRoute(me)}function x(){return e.getRoutes().map(G=>G.record)}function R(G){return!!e.getRecordMatcher(G)}function L(G,me){if(me=tt({},me||l.value),typeof G=="string"){const E=Ud(t,G,me.path),M=e.resolve({path:E.path},me),X=s.createHref(E.fullPath);return tt(E,M,{params:g(M.params),hash:el(E.hash),redirectedFrom:void 0,href:X})}let ce;if(G.path!=null)ce=tt({},G,{path:Ud(t,G.path,me.path).path});else{const E=tt({},G.params);for(const M in E)E[M]==null&&delete E[M];ce=tt({},G,{params:f(E)}),me.params=f(me.params)}const ie=e.resolve(ce,me),Ne=G.hash||"";ie.params=d(g(ie.params));const ze=RT(r,tt({},G,{hash:ET(Ne),path:ie.path})),b=s.createHref(ze);return tt({fullPath:ze,hash:Ne,query:r===Wm?iA(G.query):G.query||{}},ie,{redirectedFrom:void 0,href:b})}function B(G){return typeof G=="string"?Ud(t,G,l.value.path):tt({},G)}function $(G,me){if(c!==G)return wo(8,{from:me,to:G})}function j(G){return T(G)}function O(G){return j(tt(B(G),{replace:!0}))}function se(G){const me=G.matched[G.matched.length-1];if(me&&me.redirect){const{redirect:ce}=me;let ie=typeof ce=="function"?ce(G):ce;return typeof ie=="string"&&(ie=ie.includes("?")||ie.includes("#")?ie=B(ie):{path:ie},ie.params={}),tt({query:G.query,hash:G.hash,params:ie.path!=null?{}:G.params},ie)}}function T(G,me){const ce=c=L(G),ie=l.value,Ne=G.state,ze=G.force,b=G.replace===!0,E=se(ce);if(E)return T(tt(B(E),{state:typeof E=="object"?tt({},Ne,E.state):Ne,force:ze,replace:b}),me||ce);const M=ce;M.redirectedFrom=me;let X;return!ze&&CT(r,ie,ce)&&(X=wo(16,{to:M,from:ie}),We(ie,ie,!0,!1)),(X?Promise.resolve(X):P(M,ie)).catch(z=>Rr(z)?Rr(z,2)?z:ke(z):K(z,M,ie)).then(z=>{if(z){if(Rr(z,2))return T(tt({replace:b},B(z.to),{state:typeof z.to=="object"?tt({},Ne,z.to.state):Ne,force:ze}),me||M)}else z=D(M,ie,!0,b,Ne);return k(M,ie,z),z})}function w(G,me){const ce=$(G,me);return ce?Promise.reject(ce):Promise.resolve()}function I(G){const me=fn.values().next().value;return me&&typeof me.runWithContext=="function"?me.runWithContext(G):G()}function P(G,me){let ce;const[ie,Ne,ze]=mA(G,me);ce=Bd(ie.reverse(),"beforeRouteLeave",G,me);for(const E of ie)E.leaveGuards.forEach(M=>{ce.push(gs(M,G,me))});const b=w.bind(null,G,me);return ce.push(b),qt(ce).then(()=>{ce=[];for(const E of i.list())ce.push(gs(E,G,me));return ce.push(b),qt(ce)}).then(()=>{ce=Bd(Ne,"beforeRouteUpdate",G,me);for(const E of Ne)E.updateGuards.forEach(M=>{ce.push(gs(M,G,me))});return ce.push(b),qt(ce)}).then(()=>{ce=[];for(const E of ze)if(E.beforeEnter)if(ir(E.beforeEnter))for(const M of E.beforeEnter)ce.push(gs(M,G,me));else ce.push(gs(E.beforeEnter,G,me));return ce.push(b),qt(ce)}).then(()=>(G.matched.forEach(E=>E.enterCallbacks={}),ce=Bd(ze,"beforeRouteEnter",G,me,I),ce.push(b),qt(ce))).then(()=>{ce=[];for(const E of o.list())ce.push(gs(E,G,me));return ce.push(b),qt(ce)}).catch(E=>Rr(E,8)?E:Promise.reject(E))}function k(G,me,ce){a.list().forEach(ie=>I(()=>ie(G,me,ce)))}function D(G,me,ce,ie,Ne){const ze=$(G,me);if(ze)return ze;const b=me===us,E=Xi?history.state:{};ce&&(ie||b?s.replace(G.fullPath,tt({scroll:b&&E&&E.scroll},Ne)):s.push(G.fullPath,Ne)),l.value=G,We(G,me,ce,b),ke()}let A;function Ht(){A||(A=s.listen((G,me,ce)=>{if(!Tn.listening)return;const ie=L(G),Ne=se(ie);if(Ne){T(tt(Ne,{replace:!0,force:!0}),ie).catch(Ba);return}c=ie;const ze=l.value;Xi&&FT(Um(ze.fullPath,ce.delta),Oc()),P(ie,ze).catch(b=>Rr(b,12)?b:Rr(b,2)?(T(tt(B(b.to),{force:!0}),ie).then(E=>{Rr(E,20)&&!ce.delta&&ce.type===tl.pop&&s.go(-1,!1)}).catch(Ba),Promise.reject()):(ce.delta&&s.go(-ce.delta,!1),K(b,ie,ze))).then(b=>{b=b||D(ie,ze,!1),b&&(ce.delta&&!Rr(b,8)?s.go(-ce.delta,!1):ce.type===tl.pop&&Rr(b,20)&&s.go(-1,!1)),k(ie,ze,b)}).catch(Ba)}))}let jt=ga(),Ye=ga(),ue;function K(G,me,ce){ke(G);const ie=Ye.list();return ie.length?ie.forEach(Ne=>Ne(G,me,ce)):console.error(G),Promise.reject(G)}function Pe(){return ue&&l.value!==us?Promise.resolve():new Promise((G,me)=>{jt.add([G,me])})}function ke(G){return ue||(ue=!G,Ht(),jt.list().forEach(([me,ce])=>G?ce(G):me()),jt.reset()),G}function We(G,me,ce,ie){const{scrollBehavior:Ne}=n;if(!Xi||!Ne)return Promise.resolve();const ze=!ce&&UT(Um(G.fullPath,0))||(ie||!ce)&&history.state&&history.state.scroll||null;return Fr().then(()=>Ne(G,me,ze)).then(b=>b&&LT(b)).catch(b=>K(b,G,me))}const Ve=G=>s.go(G);let Qe;const fn=new Set,Tn={currentRoute:l,listening:!0,addRoute:_,removeRoute:C,clearRoutes:e.clearRoutes,hasRoute:R,getRoutes:x,resolve:L,options:n,push:j,replace:O,go:Ve,back:()=>Ve(-1),forward:()=>Ve(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:Ye.add,isReady:Pe,install(G){const me=this;G.component("RouterLink",uA),G.component("RouterView",fA),G.config.globalProperties.$router=me,Object.defineProperty(G.config.globalProperties,"$route",{enumerable:!0,get:()=>oo(l)}),Xi&&!Qe&&l.value===us&&(Qe=!0,j(s.location).catch(Ne=>{}));const ce={};for(const Ne in us)Object.defineProperty(ce,Ne,{get:()=>l.value[Ne],enumerable:!0});G.provide(Mc,me),G.provide(_f,fv(ce)),G.provide(wh,l);const ie=G.unmount;fn.add(G),G.unmount=function(){fn.delete(G),fn.size<1&&(c=us,A&&A(),A=null,l.value=us,Qe=!1,ue=!1),ie()}}};function qt(G){return G.reduce((me,ce)=>me.then(()=>I(ce)),Promise.resolve())}return Tn}function mA(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>yo(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>yo(c,l))||s.push(l))}return[t,r,s]}function Lc(){return rr(Mc)}function cy(n){return rr(_f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dy=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},gA=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},hy={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,d=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|c>>6,_=c&63;l||(_=64,o||(g=64)),r.push(t[d],t[f],t[g],t[_])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(dy(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):gA(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new _A;const g=i<<2|a>>4;if(r.push(g),c!==64){const _=a<<4&240|c>>2;if(r.push(_),f!==64){const C=c<<6&192|f;r.push(C)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class _A extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const vA=function(n){const e=dy(n);return hy.encodeByteArray(e,!0)},ec=function(n){return vA(n).replace(/\./g,"")},fy=function(n){try{return hy.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wA=()=>yA().__FIREBASE_DEFAULTS__,bA=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},IA=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&fy(n[1]);return e&&JSON.parse(e)},Fc=()=>{try{return wA()||bA()||IA()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},py=n=>{var e,t;return(t=(e=Fc())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},EA=n=>{const e=py(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},my=()=>{var n;return(n=Fc())===null||n===void 0?void 0:n.config},gy=n=>{var e;return(e=Fc())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TA{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AA(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[ec(JSON.stringify(t)),ec(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function xA(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Zt())}function SA(){var n;const e=(n=Fc())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function PA(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function RA(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function CA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function kA(){const n=Zt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function _y(){return!SA()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function vy(){try{return typeof indexedDB=="object"}catch{return!1}}function DA(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VA="FirebaseError";class Qr extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=VA,Object.setPrototypeOf(this,Qr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Tl.prototype.create)}}class Tl{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?NA(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Qr(s,a,r)}}function NA(n,e){return n.replace(OA,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const OA=/\{\$([^}]+)}/g;function MA(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function ks(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(eg(i)&&eg(o)){if(!ks(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function eg(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fo(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function xa(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Sa(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function LA(n,e){const t=new FA(n,e);return t.subscribe.bind(t)}class FA{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");UA(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=$d),s.error===void 0&&(s.error=$d),s.complete===void 0&&(s.complete=$d);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function UA(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function $d(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xe(n){return n&&n._delegate?n._delegate:n}class gi{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ri="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BA{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new TA;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(jA(e))try{this.getOrInitializeService({instanceIdentifier:ri})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ri){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ri){return this.instances.has(e)}getOptions(e=ri){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:$A(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ri){return this.component?this.component.multipleInstances?e:ri:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function $A(n){return n===ri?void 0:n}function jA(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qA{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new BA(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ge;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Ge||(Ge={}));const zA={debug:Ge.DEBUG,verbose:Ge.VERBOSE,info:Ge.INFO,warn:Ge.WARN,error:Ge.ERROR,silent:Ge.SILENT},GA=Ge.INFO,KA={[Ge.DEBUG]:"log",[Ge.VERBOSE]:"log",[Ge.INFO]:"info",[Ge.WARN]:"warn",[Ge.ERROR]:"error"},HA=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=KA[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class vf{constructor(e){this.name=e,this._logLevel=GA,this._logHandler=HA,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ge))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?zA[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ge.DEBUG,...e),this._logHandler(this,Ge.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ge.VERBOSE,...e),this._logHandler(this,Ge.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ge.INFO,...e),this._logHandler(this,Ge.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ge.WARN,...e),this._logHandler(this,Ge.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ge.ERROR,...e),this._logHandler(this,Ge.ERROR,...e)}}const WA=(n,e)=>e.some(t=>n instanceof t);let tg,ng;function QA(){return tg||(tg=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function JA(){return ng||(ng=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const yy=new WeakMap,bh=new WeakMap,wy=new WeakMap,jd=new WeakMap,yf=new WeakMap;function YA(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(xs(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&yy.set(t,n)}).catch(()=>{}),yf.set(e,n),e}function XA(n){if(bh.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});bh.set(n,e)}let Ih={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return bh.get(n);if(e==="objectStoreNames")return n.objectStoreNames||wy.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return xs(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function ZA(n){Ih=n(Ih)}function ex(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(qd(this),e,...t);return wy.set(r,e.sort?e.sort():[e]),xs(r)}:JA().includes(n)?function(...e){return n.apply(qd(this),e),xs(yy.get(this))}:function(...e){return xs(n.apply(qd(this),e))}}function tx(n){return typeof n=="function"?ex(n):(n instanceof IDBTransaction&&XA(n),WA(n,QA())?new Proxy(n,Ih):n)}function xs(n){if(n instanceof IDBRequest)return YA(n);if(jd.has(n))return jd.get(n);const e=tx(n);return e!==n&&(jd.set(n,e),yf.set(e,n)),e}const qd=n=>yf.get(n);function nx(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=xs(o);return r&&o.addEventListener("upgradeneeded",l=>{r(xs(o.result),l.oldVersion,l.newVersion,xs(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const rx=["get","getKey","getAll","getAllKeys","count"],sx=["put","add","delete","clear"],zd=new Map;function rg(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(zd.get(e))return zd.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=sx.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||rx.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return zd.set(e,i),i}ZA(n=>({...n,get:(e,t,r)=>rg(e,t)||n.get(e,t,r),has:(e,t)=>!!rg(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ix{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(ox(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function ox(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Eh="@firebase/app",sg="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jr=new vf("@firebase/app"),ax="@firebase/app-compat",lx="@firebase/analytics-compat",ux="@firebase/analytics",cx="@firebase/app-check-compat",dx="@firebase/app-check",hx="@firebase/auth",fx="@firebase/auth-compat",px="@firebase/database",mx="@firebase/data-connect",gx="@firebase/database-compat",_x="@firebase/functions",vx="@firebase/functions-compat",yx="@firebase/installations",wx="@firebase/installations-compat",bx="@firebase/messaging",Ix="@firebase/messaging-compat",Ex="@firebase/performance",Tx="@firebase/performance-compat",Ax="@firebase/remote-config",xx="@firebase/remote-config-compat",Sx="@firebase/storage",Px="@firebase/storage-compat",Rx="@firebase/firestore",Cx="@firebase/vertexai-preview",kx="@firebase/firestore-compat",Dx="firebase",Vx="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tc="[DEFAULT]",Nx={[Eh]:"fire-core",[ax]:"fire-core-compat",[ux]:"fire-analytics",[lx]:"fire-analytics-compat",[dx]:"fire-app-check",[cx]:"fire-app-check-compat",[hx]:"fire-auth",[fx]:"fire-auth-compat",[px]:"fire-rtdb",[mx]:"fire-data-connect",[gx]:"fire-rtdb-compat",[_x]:"fire-fn",[vx]:"fire-fn-compat",[yx]:"fire-iid",[wx]:"fire-iid-compat",[bx]:"fire-fcm",[Ix]:"fire-fcm-compat",[Ex]:"fire-perf",[Tx]:"fire-perf-compat",[Ax]:"fire-rc",[xx]:"fire-rc-compat",[Sx]:"fire-gcs",[Px]:"fire-gcs-compat",[Rx]:"fire-fst",[kx]:"fire-fst-compat",[Cx]:"fire-vertex","fire-js":"fire-js",[Dx]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nc=new Map,Ox=new Map,Th=new Map;function ig(n,e){try{n.container.addComponent(e)}catch(t){jr.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function bo(n){const e=n.name;if(Th.has(e))return jr.debug(`There were multiple attempts to register component ${e}.`),!1;Th.set(e,n);for(const t of nc.values())ig(t,n);for(const t of Ox.values())ig(t,n);return!0}function Al(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Mx(n,e,t=tc){Al(n,e).clearInstance(t)}function Ut(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lx={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ss=new Tl("app","Firebase",Lx);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fx{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new gi("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ss.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uo=Vx;function by(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:tc,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Ss.create("bad-app-name",{appName:String(s)});if(t||(t=my()),!t)throw Ss.create("no-options");const i=nc.get(s);if(i){if(ks(t,i.options)&&ks(r,i.config))return i;throw Ss.create("duplicate-app",{appName:s})}const o=new qA(s);for(const l of Th.values())o.addComponent(l);const a=new Fx(t,r,o);return nc.set(s,a),a}function Iy(n=tc){const e=nc.get(n);if(!e&&n===tc&&my())return by();if(!e)throw Ss.create("no-app",{appName:n});return e}function Ps(n,e,t){var r;let s=(r=Nx[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),jr.warn(a.join(" "));return}bo(new gi(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ux="firebase-heartbeat-database",Bx=1,nl="firebase-heartbeat-store";let Gd=null;function Ey(){return Gd||(Gd=nx(Ux,Bx,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(nl)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ss.create("idb-open",{originalErrorMessage:n.message})})),Gd}async function $x(n){try{const t=(await Ey()).transaction(nl),r=await t.objectStore(nl).get(Ty(n));return await t.done,r}catch(e){if(e instanceof Qr)jr.warn(e.message);else{const t=Ss.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});jr.warn(t.message)}}}async function og(n,e){try{const r=(await Ey()).transaction(nl,"readwrite");await r.objectStore(nl).put(e,Ty(n)),await r.done}catch(t){if(t instanceof Qr)jr.warn(t.message);else{const r=Ss.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});jr.warn(r.message)}}}function Ty(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jx=1024,qx=30*24*60*60*1e3;class zx{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Kx(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=ag();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=qx}),this._storage.overwrite(this._heartbeatsCache))}catch(r){jr.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=ag(),{heartbeatsToSend:r,unsentEntries:s}=Gx(this._heartbeatsCache.heartbeats),i=ec(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return jr.warn(t),""}}}function ag(){return new Date().toISOString().substring(0,10)}function Gx(n,e=jx){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),lg(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),lg(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Kx{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return vy()?DA().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await $x(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return og(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return og(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function lg(n){return ec(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hx(n){bo(new gi("platform-logger",e=>new ix(e),"PRIVATE")),bo(new gi("heartbeat",e=>new zx(e),"PRIVATE")),Ps(Eh,sg,n),Ps(Eh,sg,"esm2017"),Ps("fire-js","")}Hx("");var Wx="firebase",Qx="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ps(Wx,Qx,"app");var ug=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var fi,Ay;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(T,w){function I(){}I.prototype=w.prototype,T.D=w.prototype,T.prototype=new I,T.prototype.constructor=T,T.C=function(P,k,D){for(var A=Array(arguments.length-2),Ht=2;Ht<arguments.length;Ht++)A[Ht-2]=arguments[Ht];return w.prototype[k].apply(P,A)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,w,I){I||(I=0);var P=Array(16);if(typeof w=="string")for(var k=0;16>k;++k)P[k]=w.charCodeAt(I++)|w.charCodeAt(I++)<<8|w.charCodeAt(I++)<<16|w.charCodeAt(I++)<<24;else for(k=0;16>k;++k)P[k]=w[I++]|w[I++]<<8|w[I++]<<16|w[I++]<<24;w=T.g[0],I=T.g[1],k=T.g[2];var D=T.g[3],A=w+(D^I&(k^D))+P[0]+3614090360&4294967295;w=I+(A<<7&4294967295|A>>>25),A=D+(k^w&(I^k))+P[1]+3905402710&4294967295,D=w+(A<<12&4294967295|A>>>20),A=k+(I^D&(w^I))+P[2]+606105819&4294967295,k=D+(A<<17&4294967295|A>>>15),A=I+(w^k&(D^w))+P[3]+3250441966&4294967295,I=k+(A<<22&4294967295|A>>>10),A=w+(D^I&(k^D))+P[4]+4118548399&4294967295,w=I+(A<<7&4294967295|A>>>25),A=D+(k^w&(I^k))+P[5]+1200080426&4294967295,D=w+(A<<12&4294967295|A>>>20),A=k+(I^D&(w^I))+P[6]+2821735955&4294967295,k=D+(A<<17&4294967295|A>>>15),A=I+(w^k&(D^w))+P[7]+4249261313&4294967295,I=k+(A<<22&4294967295|A>>>10),A=w+(D^I&(k^D))+P[8]+1770035416&4294967295,w=I+(A<<7&4294967295|A>>>25),A=D+(k^w&(I^k))+P[9]+2336552879&4294967295,D=w+(A<<12&4294967295|A>>>20),A=k+(I^D&(w^I))+P[10]+4294925233&4294967295,k=D+(A<<17&4294967295|A>>>15),A=I+(w^k&(D^w))+P[11]+2304563134&4294967295,I=k+(A<<22&4294967295|A>>>10),A=w+(D^I&(k^D))+P[12]+1804603682&4294967295,w=I+(A<<7&4294967295|A>>>25),A=D+(k^w&(I^k))+P[13]+4254626195&4294967295,D=w+(A<<12&4294967295|A>>>20),A=k+(I^D&(w^I))+P[14]+2792965006&4294967295,k=D+(A<<17&4294967295|A>>>15),A=I+(w^k&(D^w))+P[15]+1236535329&4294967295,I=k+(A<<22&4294967295|A>>>10),A=w+(k^D&(I^k))+P[1]+4129170786&4294967295,w=I+(A<<5&4294967295|A>>>27),A=D+(I^k&(w^I))+P[6]+3225465664&4294967295,D=w+(A<<9&4294967295|A>>>23),A=k+(w^I&(D^w))+P[11]+643717713&4294967295,k=D+(A<<14&4294967295|A>>>18),A=I+(D^w&(k^D))+P[0]+3921069994&4294967295,I=k+(A<<20&4294967295|A>>>12),A=w+(k^D&(I^k))+P[5]+3593408605&4294967295,w=I+(A<<5&4294967295|A>>>27),A=D+(I^k&(w^I))+P[10]+38016083&4294967295,D=w+(A<<9&4294967295|A>>>23),A=k+(w^I&(D^w))+P[15]+3634488961&4294967295,k=D+(A<<14&4294967295|A>>>18),A=I+(D^w&(k^D))+P[4]+3889429448&4294967295,I=k+(A<<20&4294967295|A>>>12),A=w+(k^D&(I^k))+P[9]+568446438&4294967295,w=I+(A<<5&4294967295|A>>>27),A=D+(I^k&(w^I))+P[14]+3275163606&4294967295,D=w+(A<<9&4294967295|A>>>23),A=k+(w^I&(D^w))+P[3]+4107603335&4294967295,k=D+(A<<14&4294967295|A>>>18),A=I+(D^w&(k^D))+P[8]+1163531501&4294967295,I=k+(A<<20&4294967295|A>>>12),A=w+(k^D&(I^k))+P[13]+2850285829&4294967295,w=I+(A<<5&4294967295|A>>>27),A=D+(I^k&(w^I))+P[2]+4243563512&4294967295,D=w+(A<<9&4294967295|A>>>23),A=k+(w^I&(D^w))+P[7]+1735328473&4294967295,k=D+(A<<14&4294967295|A>>>18),A=I+(D^w&(k^D))+P[12]+2368359562&4294967295,I=k+(A<<20&4294967295|A>>>12),A=w+(I^k^D)+P[5]+4294588738&4294967295,w=I+(A<<4&4294967295|A>>>28),A=D+(w^I^k)+P[8]+2272392833&4294967295,D=w+(A<<11&4294967295|A>>>21),A=k+(D^w^I)+P[11]+1839030562&4294967295,k=D+(A<<16&4294967295|A>>>16),A=I+(k^D^w)+P[14]+4259657740&4294967295,I=k+(A<<23&4294967295|A>>>9),A=w+(I^k^D)+P[1]+2763975236&4294967295,w=I+(A<<4&4294967295|A>>>28),A=D+(w^I^k)+P[4]+1272893353&4294967295,D=w+(A<<11&4294967295|A>>>21),A=k+(D^w^I)+P[7]+4139469664&4294967295,k=D+(A<<16&4294967295|A>>>16),A=I+(k^D^w)+P[10]+3200236656&4294967295,I=k+(A<<23&4294967295|A>>>9),A=w+(I^k^D)+P[13]+681279174&4294967295,w=I+(A<<4&4294967295|A>>>28),A=D+(w^I^k)+P[0]+3936430074&4294967295,D=w+(A<<11&4294967295|A>>>21),A=k+(D^w^I)+P[3]+3572445317&4294967295,k=D+(A<<16&4294967295|A>>>16),A=I+(k^D^w)+P[6]+76029189&4294967295,I=k+(A<<23&4294967295|A>>>9),A=w+(I^k^D)+P[9]+3654602809&4294967295,w=I+(A<<4&4294967295|A>>>28),A=D+(w^I^k)+P[12]+3873151461&4294967295,D=w+(A<<11&4294967295|A>>>21),A=k+(D^w^I)+P[15]+530742520&4294967295,k=D+(A<<16&4294967295|A>>>16),A=I+(k^D^w)+P[2]+3299628645&4294967295,I=k+(A<<23&4294967295|A>>>9),A=w+(k^(I|~D))+P[0]+4096336452&4294967295,w=I+(A<<6&4294967295|A>>>26),A=D+(I^(w|~k))+P[7]+1126891415&4294967295,D=w+(A<<10&4294967295|A>>>22),A=k+(w^(D|~I))+P[14]+2878612391&4294967295,k=D+(A<<15&4294967295|A>>>17),A=I+(D^(k|~w))+P[5]+4237533241&4294967295,I=k+(A<<21&4294967295|A>>>11),A=w+(k^(I|~D))+P[12]+1700485571&4294967295,w=I+(A<<6&4294967295|A>>>26),A=D+(I^(w|~k))+P[3]+2399980690&4294967295,D=w+(A<<10&4294967295|A>>>22),A=k+(w^(D|~I))+P[10]+4293915773&4294967295,k=D+(A<<15&4294967295|A>>>17),A=I+(D^(k|~w))+P[1]+2240044497&4294967295,I=k+(A<<21&4294967295|A>>>11),A=w+(k^(I|~D))+P[8]+1873313359&4294967295,w=I+(A<<6&4294967295|A>>>26),A=D+(I^(w|~k))+P[15]+4264355552&4294967295,D=w+(A<<10&4294967295|A>>>22),A=k+(w^(D|~I))+P[6]+2734768916&4294967295,k=D+(A<<15&4294967295|A>>>17),A=I+(D^(k|~w))+P[13]+1309151649&4294967295,I=k+(A<<21&4294967295|A>>>11),A=w+(k^(I|~D))+P[4]+4149444226&4294967295,w=I+(A<<6&4294967295|A>>>26),A=D+(I^(w|~k))+P[11]+3174756917&4294967295,D=w+(A<<10&4294967295|A>>>22),A=k+(w^(D|~I))+P[2]+718787259&4294967295,k=D+(A<<15&4294967295|A>>>17),A=I+(D^(k|~w))+P[9]+3951481745&4294967295,T.g[0]=T.g[0]+w&4294967295,T.g[1]=T.g[1]+(k+(A<<21&4294967295|A>>>11))&4294967295,T.g[2]=T.g[2]+k&4294967295,T.g[3]=T.g[3]+D&4294967295}r.prototype.u=function(T,w){w===void 0&&(w=T.length);for(var I=w-this.blockSize,P=this.B,k=this.h,D=0;D<w;){if(k==0)for(;D<=I;)s(this,T,D),D+=this.blockSize;if(typeof T=="string"){for(;D<w;)if(P[k++]=T.charCodeAt(D++),k==this.blockSize){s(this,P),k=0;break}}else for(;D<w;)if(P[k++]=T[D++],k==this.blockSize){s(this,P),k=0;break}}this.h=k,this.o+=w},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var w=1;w<T.length-8;++w)T[w]=0;var I=8*this.o;for(w=T.length-8;w<T.length;++w)T[w]=I&255,I/=256;for(this.u(T),T=Array(16),w=I=0;4>w;++w)for(var P=0;32>P;P+=8)T[I++]=this.g[w]>>>P&255;return T};function i(T,w){var I=a;return Object.prototype.hasOwnProperty.call(I,T)?I[T]:I[T]=w(T)}function o(T,w){this.h=w;for(var I=[],P=!0,k=T.length-1;0<=k;k--){var D=T[k]|0;P&&D==w||(I[k]=D,P=!1)}this.g=I}var a={};function l(T){return-128<=T&&128>T?i(T,function(w){return new o([w|0],0>w?-1:0)}):new o([T|0],0>T?-1:0)}function c(T){if(isNaN(T)||!isFinite(T))return f;if(0>T)return R(c(-T));for(var w=[],I=1,P=0;T>=I;P++)w[P]=T/I|0,I*=4294967296;return new o(w,0)}function d(T,w){if(T.length==0)throw Error("number format error: empty string");if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(T.charAt(0)=="-")return R(d(T.substring(1),w));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=c(Math.pow(w,8)),P=f,k=0;k<T.length;k+=8){var D=Math.min(8,T.length-k),A=parseInt(T.substring(k,k+D),w);8>D?(D=c(Math.pow(w,D)),P=P.j(D).add(c(A))):(P=P.j(I),P=P.add(c(A)))}return P}var f=l(0),g=l(1),_=l(16777216);n=o.prototype,n.m=function(){if(x(this))return-R(this).m();for(var T=0,w=1,I=0;I<this.g.length;I++){var P=this.i(I);T+=(0<=P?P:4294967296+P)*w,w*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(C(this))return"0";if(x(this))return"-"+R(this).toString(T);for(var w=c(Math.pow(T,6)),I=this,P="";;){var k=j(I,w).g;I=L(I,k.j(w));var D=((0<I.g.length?I.g[0]:I.h)>>>0).toString(T);if(I=k,C(I))return D+P;for(;6>D.length;)D="0"+D;P=D+P}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function C(T){if(T.h!=0)return!1;for(var w=0;w<T.g.length;w++)if(T.g[w]!=0)return!1;return!0}function x(T){return T.h==-1}n.l=function(T){return T=L(this,T),x(T)?-1:C(T)?0:1};function R(T){for(var w=T.g.length,I=[],P=0;P<w;P++)I[P]=~T.g[P];return new o(I,~T.h).add(g)}n.abs=function(){return x(this)?R(this):this},n.add=function(T){for(var w=Math.max(this.g.length,T.g.length),I=[],P=0,k=0;k<=w;k++){var D=P+(this.i(k)&65535)+(T.i(k)&65535),A=(D>>>16)+(this.i(k)>>>16)+(T.i(k)>>>16);P=A>>>16,D&=65535,A&=65535,I[k]=A<<16|D}return new o(I,I[I.length-1]&-2147483648?-1:0)};function L(T,w){return T.add(R(w))}n.j=function(T){if(C(this)||C(T))return f;if(x(this))return x(T)?R(this).j(R(T)):R(R(this).j(T));if(x(T))return R(this.j(R(T)));if(0>this.l(_)&&0>T.l(_))return c(this.m()*T.m());for(var w=this.g.length+T.g.length,I=[],P=0;P<2*w;P++)I[P]=0;for(P=0;P<this.g.length;P++)for(var k=0;k<T.g.length;k++){var D=this.i(P)>>>16,A=this.i(P)&65535,Ht=T.i(k)>>>16,jt=T.i(k)&65535;I[2*P+2*k]+=A*jt,B(I,2*P+2*k),I[2*P+2*k+1]+=D*jt,B(I,2*P+2*k+1),I[2*P+2*k+1]+=A*Ht,B(I,2*P+2*k+1),I[2*P+2*k+2]+=D*Ht,B(I,2*P+2*k+2)}for(P=0;P<w;P++)I[P]=I[2*P+1]<<16|I[2*P];for(P=w;P<2*w;P++)I[P]=0;return new o(I,0)};function B(T,w){for(;(T[w]&65535)!=T[w];)T[w+1]+=T[w]>>>16,T[w]&=65535,w++}function $(T,w){this.g=T,this.h=w}function j(T,w){if(C(w))throw Error("division by zero");if(C(T))return new $(f,f);if(x(T))return w=j(R(T),w),new $(R(w.g),R(w.h));if(x(w))return w=j(T,R(w)),new $(R(w.g),w.h);if(30<T.g.length){if(x(T)||x(w))throw Error("slowDivide_ only works with positive integers.");for(var I=g,P=w;0>=P.l(T);)I=O(I),P=O(P);var k=se(I,1),D=se(P,1);for(P=se(P,2),I=se(I,2);!C(P);){var A=D.add(P);0>=A.l(T)&&(k=k.add(I),D=A),P=se(P,1),I=se(I,1)}return w=L(T,k.j(w)),new $(k,w)}for(k=f;0<=T.l(w);){for(I=Math.max(1,Math.floor(T.m()/w.m())),P=Math.ceil(Math.log(I)/Math.LN2),P=48>=P?1:Math.pow(2,P-48),D=c(I),A=D.j(w);x(A)||0<A.l(T);)I-=P,D=c(I),A=D.j(w);C(D)&&(D=g),k=k.add(D),T=L(T,A)}return new $(k,T)}n.A=function(T){return j(this,T).h},n.and=function(T){for(var w=Math.max(this.g.length,T.g.length),I=[],P=0;P<w;P++)I[P]=this.i(P)&T.i(P);return new o(I,this.h&T.h)},n.or=function(T){for(var w=Math.max(this.g.length,T.g.length),I=[],P=0;P<w;P++)I[P]=this.i(P)|T.i(P);return new o(I,this.h|T.h)},n.xor=function(T){for(var w=Math.max(this.g.length,T.g.length),I=[],P=0;P<w;P++)I[P]=this.i(P)^T.i(P);return new o(I,this.h^T.h)};function O(T){for(var w=T.g.length+1,I=[],P=0;P<w;P++)I[P]=T.i(P)<<1|T.i(P-1)>>>31;return new o(I,T.h)}function se(T,w){var I=w>>5;w%=32;for(var P=T.g.length-I,k=[],D=0;D<P;D++)k[D]=0<w?T.i(D+I)>>>w|T.i(D+I+1)<<32-w:T.i(D+I);return new o(k,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Ay=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,fi=o}).apply(typeof ug<"u"?ug:typeof self<"u"?self:typeof window<"u"?window:{});var vu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var xy,Pa,Sy,Du,Ah,Py,Ry,Cy;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,h,p){return u==Array.prototype||u==Object.prototype||(u[h]=p.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof vu=="object"&&vu];for(var h=0;h<u.length;++h){var p=u[h];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var r=t(this);function s(u,h){if(h)e:{var p=r;u=u.split(".");for(var v=0;v<u.length-1;v++){var V=u[v];if(!(V in p))break e;p=p[V]}u=u[u.length-1],v=p[u],h=h(v),h!=v&&h!=null&&e(p,u,{configurable:!0,writable:!0,value:h})}}function i(u,h){u instanceof String&&(u+="");var p=0,v=!1,V={next:function(){if(!v&&p<u.length){var U=p++;return{value:h(U,u[U]),done:!1}}return v=!0,{done:!0,value:void 0}}};return V[Symbol.iterator]=function(){return V},V}s("Array.prototype.values",function(u){return u||function(){return i(this,function(h,p){return p})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var h=typeof u;return h=h!="object"?h:u?Array.isArray(u)?"array":h:"null",h=="array"||h=="object"&&typeof u.length=="number"}function c(u){var h=typeof u;return h=="object"&&u!=null||h=="function"}function d(u,h,p){return u.call.apply(u.bind,arguments)}function f(u,h,p){if(!u)throw Error();if(2<arguments.length){var v=Array.prototype.slice.call(arguments,2);return function(){var V=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(V,v),u.apply(h,V)}}return function(){return u.apply(h,arguments)}}function g(u,h,p){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,g.apply(null,arguments)}function _(u,h){var p=Array.prototype.slice.call(arguments,1);return function(){var v=p.slice();return v.push.apply(v,arguments),u.apply(this,v)}}function C(u,h){function p(){}p.prototype=h.prototype,u.aa=h.prototype,u.prototype=new p,u.prototype.constructor=u,u.Qb=function(v,V,U){for(var de=Array(arguments.length-2),dt=2;dt<arguments.length;dt++)de[dt-2]=arguments[dt];return h.prototype[V].apply(v,de)}}function x(u){const h=u.length;if(0<h){const p=Array(h);for(let v=0;v<h;v++)p[v]=u[v];return p}return[]}function R(u,h){for(let p=1;p<arguments.length;p++){const v=arguments[p];if(l(v)){const V=u.length||0,U=v.length||0;u.length=V+U;for(let de=0;de<U;de++)u[V+de]=v[de]}else u.push(v)}}class L{constructor(h,p){this.i=h,this.j=p,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function B(u){return/^[\s\xa0]*$/.test(u)}function $(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function j(u){return j[" "](u),u}j[" "]=function(){};var O=$().indexOf("Gecko")!=-1&&!($().toLowerCase().indexOf("webkit")!=-1&&$().indexOf("Edge")==-1)&&!($().indexOf("Trident")!=-1||$().indexOf("MSIE")!=-1)&&$().indexOf("Edge")==-1;function se(u,h,p){for(const v in u)h.call(p,u[v],v,u)}function T(u,h){for(const p in u)h.call(void 0,u[p],p,u)}function w(u){const h={};for(const p in u)h[p]=u[p];return h}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function P(u,h){let p,v;for(let V=1;V<arguments.length;V++){v=arguments[V];for(p in v)u[p]=v[p];for(let U=0;U<I.length;U++)p=I[U],Object.prototype.hasOwnProperty.call(v,p)&&(u[p]=v[p])}}function k(u){var h=1;u=u.split(":");const p=[];for(;0<h&&u.length;)p.push(u.shift()),h--;return u.length&&p.push(u.join(":")),p}function D(u){a.setTimeout(()=>{throw u},0)}function A(){var u=Pe;let h=null;return u.g&&(h=u.g,u.g=u.g.next,u.g||(u.h=null),h.next=null),h}class Ht{constructor(){this.h=this.g=null}add(h,p){const v=jt.get();v.set(h,p),this.h?this.h.next=v:this.g=v,this.h=v}}var jt=new L(()=>new Ye,u=>u.reset());class Ye{constructor(){this.next=this.g=this.h=null}set(h,p){this.h=h,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let ue,K=!1,Pe=new Ht,ke=()=>{const u=a.Promise.resolve(void 0);ue=()=>{u.then(We)}};var We=()=>{for(var u;u=A();){try{u.h.call(u.g)}catch(p){D(p)}var h=jt;h.j(u),100>h.h&&(h.h++,u.next=h.g,h.g=u)}K=!1};function Ve(){this.s=this.s,this.C=this.C}Ve.prototype.s=!1,Ve.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ve.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Qe(u,h){this.type=u,this.g=this.target=h,this.defaultPrevented=!1}Qe.prototype.h=function(){this.defaultPrevented=!0};var fn=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,h=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const p=()=>{};a.addEventListener("test",p,h),a.removeEventListener("test",p,h)}catch{}return u}();function Tn(u,h){if(Qe.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var p=this.type=u.type,v=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=h,h=u.relatedTarget){if(O){e:{try{j(h.nodeName);var V=!0;break e}catch{}V=!1}V||(h=null)}}else p=="mouseover"?h=u.fromElement:p=="mouseout"&&(h=u.toElement);this.relatedTarget=h,v?(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:qt[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&Tn.aa.h.call(this)}}C(Tn,Qe);var qt={2:"touch",3:"pen",4:"mouse"};Tn.prototype.h=function(){Tn.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var G="closure_listenable_"+(1e6*Math.random()|0),me=0;function ce(u,h,p,v,V){this.listener=u,this.proxy=null,this.src=h,this.type=p,this.capture=!!v,this.ha=V,this.key=++me,this.da=this.fa=!1}function ie(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function Ne(u){this.src=u,this.g={},this.h=0}Ne.prototype.add=function(u,h,p,v,V){var U=u.toString();u=this.g[U],u||(u=this.g[U]=[],this.h++);var de=b(u,h,v,V);return-1<de?(h=u[de],p||(h.fa=!1)):(h=new ce(h,this.src,U,!!v,V),h.fa=p,u.push(h)),h};function ze(u,h){var p=h.type;if(p in u.g){var v=u.g[p],V=Array.prototype.indexOf.call(v,h,void 0),U;(U=0<=V)&&Array.prototype.splice.call(v,V,1),U&&(ie(h),u.g[p].length==0&&(delete u.g[p],u.h--))}}function b(u,h,p,v){for(var V=0;V<u.length;++V){var U=u[V];if(!U.da&&U.listener==h&&U.capture==!!p&&U.ha==v)return V}return-1}var E="closure_lm_"+(1e6*Math.random()|0),M={};function X(u,h,p,v,V){if(v&&v.once)return he(u,h,p,v,V);if(Array.isArray(h)){for(var U=0;U<h.length;U++)X(u,h[U],p,v,V);return null}return p=Re(p),u&&u[G]?u.K(h,p,c(v)?!!v.capture:!!v,V):z(u,h,p,!1,v,V)}function z(u,h,p,v,V,U){if(!h)throw Error("Invalid event type");var de=c(V)?!!V.capture:!!V,dt=fe(u);if(dt||(u[E]=dt=new Ne(u)),p=dt.add(h,p,v,de,U),p.proxy)return p;if(v=Z(),p.proxy=v,v.src=u,v.listener=p,u.addEventListener)fn||(V=de),V===void 0&&(V=!1),u.addEventListener(h.toString(),v,V);else if(u.attachEvent)u.attachEvent(ee(h.toString()),v);else if(u.addListener&&u.removeListener)u.addListener(v);else throw Error("addEventListener and attachEvent are unavailable.");return p}function Z(){function u(p){return h.call(u.src,u.listener,p)}const h=Ie;return u}function he(u,h,p,v,V){if(Array.isArray(h)){for(var U=0;U<h.length;U++)he(u,h[U],p,v,V);return null}return p=Re(p),u&&u[G]?u.L(h,p,c(v)?!!v.capture:!!v,V):z(u,h,p,!0,v,V)}function oe(u,h,p,v,V){if(Array.isArray(h))for(var U=0;U<h.length;U++)oe(u,h[U],p,v,V);else v=c(v)?!!v.capture:!!v,p=Re(p),u&&u[G]?(u=u.i,h=String(h).toString(),h in u.g&&(U=u.g[h],p=b(U,p,v,V),-1<p&&(ie(U[p]),Array.prototype.splice.call(U,p,1),U.length==0&&(delete u.g[h],u.h--)))):u&&(u=fe(u))&&(h=u.g[h.toString()],u=-1,h&&(u=b(h,p,v,V)),(p=-1<u?h[u]:null)&&ne(p))}function ne(u){if(typeof u!="number"&&u&&!u.da){var h=u.src;if(h&&h[G])ze(h.i,u);else{var p=u.type,v=u.proxy;h.removeEventListener?h.removeEventListener(p,v,u.capture):h.detachEvent?h.detachEvent(ee(p),v):h.addListener&&h.removeListener&&h.removeListener(v),(p=fe(h))?(ze(p,u),p.h==0&&(p.src=null,h[E]=null)):ie(u)}}}function ee(u){return u in M?M[u]:M[u]="on"+u}function Ie(u,h){if(u.da)u=!0;else{h=new Tn(h,this);var p=u.listener,v=u.ha||u.src;u.fa&&ne(u),u=p.call(v,h)}return u}function fe(u){return u=u[E],u instanceof Ne?u:null}var we="__closure_events_fn_"+(1e9*Math.random()>>>0);function Re(u){return typeof u=="function"?u:(u[we]||(u[we]=function(h){return u.handleEvent(h)}),u[we])}function ae(){Ve.call(this),this.i=new Ne(this),this.M=this,this.F=null}C(ae,Ve),ae.prototype[G]=!0,ae.prototype.removeEventListener=function(u,h,p,v){oe(this,u,h,p,v)};function Ee(u,h){var p,v=u.F;if(v)for(p=[];v;v=v.F)p.push(v);if(u=u.M,v=h.type||h,typeof h=="string")h=new Qe(h,u);else if(h instanceof Qe)h.target=h.target||u;else{var V=h;h=new Qe(v,u),P(h,V)}if(V=!0,p)for(var U=p.length-1;0<=U;U--){var de=h.g=p[U];V=je(de,v,!0,h)&&V}if(de=h.g=u,V=je(de,v,!0,h)&&V,V=je(de,v,!1,h)&&V,p)for(U=0;U<p.length;U++)de=h.g=p[U],V=je(de,v,!1,h)&&V}ae.prototype.N=function(){if(ae.aa.N.call(this),this.i){var u=this.i,h;for(h in u.g){for(var p=u.g[h],v=0;v<p.length;v++)ie(p[v]);delete u.g[h],u.h--}}this.F=null},ae.prototype.K=function(u,h,p,v){return this.i.add(String(u),h,!1,p,v)},ae.prototype.L=function(u,h,p,v){return this.i.add(String(u),h,!0,p,v)};function je(u,h,p,v){if(h=u.i.g[String(h)],!h)return!0;h=h.concat();for(var V=!0,U=0;U<h.length;++U){var de=h[U];if(de&&!de.da&&de.capture==p){var dt=de.listener,ln=de.ha||de.src;de.fa&&ze(u.i,de),V=dt.call(ln,v)!==!1&&V}}return V&&!v.defaultPrevented}function Wt(u,h,p){if(typeof u=="function")p&&(u=g(u,p));else if(u&&typeof u.handleEvent=="function")u=g(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(u,h||0)}function Ot(u){u.g=Wt(()=>{u.g=null,u.i&&(u.i=!1,Ot(u))},u.l);const h=u.h;u.h=null,u.m.apply(null,h)}class an extends Ve{constructor(h,p){super(),this.m=h,this.l=p,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:Ot(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Mt(u){Ve.call(this),this.h=u,this.g={}}C(Mt,Ve);var kn=[];function or(u){se(u.g,function(h,p){this.g.hasOwnProperty(p)&&ne(h)},u),u.g={}}Mt.prototype.N=function(){Mt.aa.N.call(this),or(this)},Mt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var wt=a.JSON.stringify,Qt=a.JSON.parse,ar=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function Er(){}Er.prototype.h=null;function Hl(u){return u.h||(u.h=u.i())}function Wl(){}var Ks={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Zo(){Qe.call(this,"d")}C(Zo,Qe);function ut(){Qe.call(this,"c")}C(ut,Qe);var et={},Ct=null;function at(){return Ct=Ct||new ae}et.La="serverreachability";function Ql(u){Qe.call(this,et.La,u)}C(Ql,Qe);function ns(u){const h=at();Ee(h,new Ql(h))}et.STAT_EVENT="statevent";function Jl(u,h){Qe.call(this,et.STAT_EVENT,u),this.stat=h}C(Jl,Qe);function Jt(u){const h=at();Ee(h,new Jl(h,u))}et.Ma="timingevent";function Dn(u,h){Qe.call(this,et.Ma,u),this.size=h}C(Dn,Qe);function rs(u,h){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},h)}function Hs(){this.g=!0}Hs.prototype.xa=function(){this.g=!1};function Yl(u,h,p,v,V,U){u.info(function(){if(u.g)if(U)for(var de="",dt=U.split("&"),ln=0;ln<dt.length;ln++){var Ze=dt[ln].split("=");if(1<Ze.length){var pn=Ze[0];Ze=Ze[1];var mn=pn.split("_");de=2<=mn.length&&mn[1]=="type"?de+(pn+"="+Ze+"&"):de+(pn+"=redacted&")}}else de=null;else de=U;return"XMLHTTP REQ ("+v+") [attempt "+V+"]: "+h+`
`+p+`
`+de})}function _d(u,h,p,v,V,U,de){u.info(function(){return"XMLHTTP RESP ("+v+") [ attempt "+V+"]: "+h+`
`+p+`
`+U+" "+de})}function lr(u,h,p,v){u.info(function(){return"XMLHTTP TEXT ("+h+"): "+ea(u,p)+(v?" "+v:"")})}function ss(u,h){u.info(function(){return"TIMEOUT: "+h})}Hs.prototype.info=function(){};function ea(u,h){if(!u.g)return h;if(!h)return null;try{var p=JSON.parse(h);if(p){for(u=0;u<p.length;u++)if(Array.isArray(p[u])){var v=p[u];if(!(2>v.length)){var V=v[1];if(Array.isArray(V)&&!(1>V.length)){var U=V[0];if(U!="noop"&&U!="stop"&&U!="close")for(var de=1;de<V.length;de++)V[de]=""}}}}return wt(p)}catch{return h}}var Tr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ta={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},na;function Mi(){}C(Mi,Er),Mi.prototype.g=function(){return new XMLHttpRequest},Mi.prototype.i=function(){return{}},na=new Mi;function Yn(u,h,p,v){this.j=u,this.i=h,this.l=p,this.R=v||1,this.U=new Mt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ra}function ra(){this.i=null,this.g="",this.h=!1}var Ws={},is={};function os(u,h,p){u.L=1,u.v=as(Xn(h)),u.m=p,u.P=!0,Xl(u,null)}function Xl(u,h){u.F=Date.now(),Li(u),u.A=Xn(u.v);var p=u.A,v=u.R;Array.isArray(v)||(v=[String(v)]),_e(p.i,"t",v),u.C=0,p=u.j.J,u.h=new ra,u.g=rm(u.j,p?h:null,!u.m),0<u.O&&(u.M=new an(g(u.Y,u,u.g),u.O)),h=u.U,p=u.g,v=u.ca;var V="readystatechange";Array.isArray(V)||(V&&(kn[0]=V.toString()),V=kn);for(var U=0;U<V.length;U++){var de=X(p,V[U],v||h.handleEvent,!1,h.h||h);if(!de)break;h.g[de.key]=de}h=u.H?w(u.H):{},u.m?(u.u||(u.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,h)):(u.u="GET",u.g.ea(u.A,u.u,null,h)),ns(),Yl(u.i,u.u,u.A,u.l,u.R,u.m)}Yn.prototype.ca=function(u){u=u.target;const h=this.M;h&&Sr(u)==3?h.j():this.Y(u)},Yn.prototype.Y=function(u){try{if(u==this.g)e:{const mn=Sr(this.g);var h=this.g.Ba();const zi=this.g.Z();if(!(3>mn)&&(mn!=3||this.g&&(this.h.h||this.g.oa()||Kp(this.g)))){this.J||mn!=4||h==7||(h==8||0>=zi?ns(3):ns(2)),sa(this);var p=this.g.Z();this.X=p;t:if(Zl(this)){var v=Kp(this.g);u="";var V=v.length,U=Sr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ar(this),ur(this);var de="";break t}this.h.i=new a.TextDecoder}for(h=0;h<V;h++)this.h.h=!0,u+=this.h.i.decode(v[h],{stream:!(U&&h==V-1)});v.length=0,this.h.g+=u,this.C=0,de=this.h.g}else de=this.g.oa();if(this.o=p==200,_d(this.i,this.u,this.A,this.l,this.R,mn,p),this.o){if(this.T&&!this.K){t:{if(this.g){var dt,ln=this.g;if((dt=ln.g?ln.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(dt)){var Ze=dt;break t}}Ze=null}if(p=Ze)lr(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ia(this,p);else{this.o=!1,this.s=3,Jt(12),Ar(this),ur(this);break e}}if(this.P){p=!0;let Zn;for(;!this.J&&this.C<de.length;)if(Zn=vd(this,de),Zn==is){mn==4&&(this.s=4,Jt(14),p=!1),lr(this.i,this.l,null,"[Incomplete Response]");break}else if(Zn==Ws){this.s=4,Jt(15),lr(this.i,this.l,de,"[Invalid Chunk]"),p=!1;break}else lr(this.i,this.l,Zn,null),ia(this,Zn);if(Zl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),mn!=4||de.length!=0||this.h.h||(this.s=1,Jt(16),p=!1),this.o=this.o&&p,!p)lr(this.i,this.l,de,"[Invalid Chunked Response]"),Ar(this),ur(this);else if(0<de.length&&!this.W){this.W=!0;var pn=this.j;pn.g==this&&pn.ba&&!pn.M&&(pn.j.info("Great, no buffering proxy detected. Bytes received: "+de.length),Ad(pn),pn.M=!0,Jt(11))}}else lr(this.i,this.l,de,null),ia(this,de);mn==4&&Ar(this),this.o&&!this.J&&(mn==4?Zp(this.j,this):(this.o=!1,Li(this)))}else Gb(this.g),p==400&&0<de.indexOf("Unknown SID")?(this.s=3,Jt(12)):(this.s=0,Jt(13)),Ar(this),ur(this)}}}catch{}finally{}};function Zl(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function vd(u,h){var p=u.C,v=h.indexOf(`
`,p);return v==-1?is:(p=Number(h.substring(p,v)),isNaN(p)?Ws:(v+=1,v+p>h.length?is:(h=h.slice(v,v+p),u.C=v+p,h)))}Yn.prototype.cancel=function(){this.J=!0,Ar(this)};function Li(u){u.S=Date.now()+u.I,eu(u,u.I)}function eu(u,h){if(u.B!=null)throw Error("WatchDog timer not null");u.B=rs(g(u.ba,u),h)}function sa(u){u.B&&(a.clearTimeout(u.B),u.B=null)}Yn.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(ss(this.i,this.A),this.L!=2&&(ns(),Jt(17)),Ar(this),this.s=2,ur(this)):eu(this,this.S-u)};function ur(u){u.j.G==0||u.J||Zp(u.j,u)}function Ar(u){sa(u);var h=u.M;h&&typeof h.ma=="function"&&h.ma(),u.M=null,or(u.U),u.g&&(h=u.g,u.g=null,h.abort(),h.ma())}function ia(u,h){try{var p=u.j;if(p.G!=0&&(p.g==u||Fi(p.h,u))){if(!u.K&&Fi(p.h,u)&&p.G==3){try{var v=p.Da.g.parse(h)}catch{v=null}if(Array.isArray(v)&&v.length==3){var V=v;if(V[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<u.F)hu(p),cu(p);else break e;Td(p),Jt(18)}}else p.za=V[1],0<p.za-p.T&&37500>V[2]&&p.F&&p.v==0&&!p.C&&(p.C=rs(g(p.Za,p),6e3));if(1>=nu(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else Xs(p,11)}else if((u.K||p.g==u)&&hu(p),!B(h))for(V=p.Da.g.parse(h),h=0;h<V.length;h++){let Ze=V[h];if(p.T=Ze[0],Ze=Ze[1],p.G==2)if(Ze[0]=="c"){p.K=Ze[1],p.ia=Ze[2];const pn=Ze[3];pn!=null&&(p.la=pn,p.j.info("VER="+p.la));const mn=Ze[4];mn!=null&&(p.Aa=mn,p.j.info("SVER="+p.Aa));const zi=Ze[5];zi!=null&&typeof zi=="number"&&0<zi&&(v=1.5*zi,p.L=v,p.j.info("backChannelRequestTimeoutMs_="+v)),v=p;const Zn=u.g;if(Zn){const pu=Zn.g?Zn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(pu){var U=v.h;U.g||pu.indexOf("spdy")==-1&&pu.indexOf("quic")==-1&&pu.indexOf("h2")==-1||(U.j=U.l,U.g=new Set,U.h&&(aa(U,U.h),U.h=null))}if(v.D){const xd=Zn.g?Zn.g.getResponseHeader("X-HTTP-Session-Id"):null;xd&&(v.ya=xd,ct(v.I,v.D,xd))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-u.F,p.j.info("Handshake RTT: "+p.R+"ms")),v=p;var de=u;if(v.qa=nm(v,v.J?v.ia:null,v.W),de.K){ru(v.h,de);var dt=de,ln=v.L;ln&&(dt.I=ln),dt.B&&(sa(dt),Li(dt)),v.g=de}else Yp(v);0<p.i.length&&du(p)}else Ze[0]!="stop"&&Ze[0]!="close"||Xs(p,7);else p.G==3&&(Ze[0]=="stop"||Ze[0]=="close"?Ze[0]=="stop"?Xs(p,7):Ed(p):Ze[0]!="noop"&&p.l&&p.l.ta(Ze),p.v=0)}}ns(4)}catch{}}var yd=class{constructor(u,h){this.g=u,this.map=h}};function tu(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function oa(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function nu(u){return u.h?1:u.g?u.g.size:0}function Fi(u,h){return u.h?u.h==h:u.g?u.g.has(h):!1}function aa(u,h){u.g?u.g.add(h):u.h=h}function ru(u,h){u.h&&u.h==h?u.h=null:u.g&&u.g.has(h)&&u.g.delete(h)}tu.prototype.cancel=function(){if(this.i=su(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function su(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let h=u.i;for(const p of u.g.values())h=h.concat(p.D);return h}return x(u.i)}function wd(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var h=[],p=u.length,v=0;v<p;v++)h.push(u[v]);return h}h=[],p=0;for(v in u)h[p++]=u[v];return h}function cr(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var h=[];u=u.length;for(var p=0;p<u;p++)h.push(p);return h}h=[],p=0;for(const v in u)h[p++]=v;return h}}}function iu(u,h){if(u.forEach&&typeof u.forEach=="function")u.forEach(h,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,h,void 0);else for(var p=cr(u),v=wd(u),V=v.length,U=0;U<V;U++)h.call(void 0,v[U],p&&p[U],u)}var ou=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ui(u,h){if(u){u=u.split("&");for(var p=0;p<u.length;p++){var v=u[p].indexOf("="),V=null;if(0<=v){var U=u[p].substring(0,v);V=u[p].substring(v+1)}else U=u[p];h(U,V?decodeURIComponent(V.replace(/\+/g," ")):"")}}}function dr(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof dr){this.h=u.h,Qs(this,u.j),this.o=u.o,this.g=u.g,Bi(this,u.s),this.l=u.l;var h=u.i,p=new Ys;p.i=h.i,h.g&&(p.g=new Map(h.g),p.h=h.h),au(this,p),this.m=u.m}else u&&(h=String(u).match(ou))?(this.h=!1,Qs(this,h[1]||"",!0),this.o=Js(h[2]||""),this.g=Js(h[3]||"",!0),Bi(this,h[4]),this.l=Js(h[5]||"",!0),au(this,h[6]||"",!0),this.m=Js(h[7]||"")):(this.h=!1,this.i=new Ys(null,this.h))}dr.prototype.toString=function(){var u=[],h=this.j;h&&u.push(ls(h,ua,!0),":");var p=this.g;return(p||h=="file")&&(u.push("//"),(h=this.o)&&u.push(ls(h,ua,!0),"@"),u.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&u.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&u.push("/"),u.push(ls(p,p.charAt(0)=="/"?$i:bd,!0))),(p=this.i.toString())&&u.push("?",p),(p=this.m)&&u.push("#",ls(p,Id)),u.join("")};function Xn(u){return new dr(u)}function Qs(u,h,p){u.j=p?Js(h,!0):h,u.j&&(u.j=u.j.replace(/:$/,""))}function Bi(u,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);u.s=h}else u.s=null}function au(u,h,p){h instanceof Ys?(u.i=h,Be(u.i,u.h)):(p||(h=ls(h,lu)),u.i=new Ys(h,u.h))}function ct(u,h,p){u.i.set(h,p)}function as(u){return ct(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Js(u,h){return u?h?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function ls(u,h,p){return typeof u=="string"?(u=encodeURI(u).replace(h,la),p&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function la(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var ua=/[#\/\?@]/g,bd=/[#\?:]/g,$i=/[#\?]/g,lu=/[#\?@]/g,Id=/#/g;function Ys(u,h){this.h=this.g=null,this.i=u||null,this.j=!!h}function S(u){u.g||(u.g=new Map,u.h=0,u.i&&Ui(u.i,function(h,p){u.add(decodeURIComponent(h.replace(/\+/g," ")),p)}))}n=Ys.prototype,n.add=function(u,h){S(this),this.i=null,u=Te(this,u);var p=this.g.get(u);return p||this.g.set(u,p=[]),p.push(h),this.h+=1,this};function y(u,h){S(u),h=Te(u,h),u.g.has(h)&&(u.i=null,u.h-=u.g.get(h).length,u.g.delete(h))}function H(u,h){return S(u),h=Te(u,h),u.g.has(h)}n.forEach=function(u,h){S(this),this.g.forEach(function(p,v){p.forEach(function(V){u.call(h,V,v,this)},this)},this)},n.na=function(){S(this);const u=Array.from(this.g.values()),h=Array.from(this.g.keys()),p=[];for(let v=0;v<h.length;v++){const V=u[v];for(let U=0;U<V.length;U++)p.push(h[v])}return p},n.V=function(u){S(this);let h=[];if(typeof u=="string")H(this,u)&&(h=h.concat(this.g.get(Te(this,u))));else{u=Array.from(this.g.values());for(let p=0;p<u.length;p++)h=h.concat(u[p])}return h},n.set=function(u,h){return S(this),this.i=null,u=Te(this,u),H(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[h]),this.h+=1,this},n.get=function(u,h){return u?(u=this.V(u),0<u.length?String(u[0]):h):h};function _e(u,h,p){y(u,h),0<p.length&&(u.i=null,u.g.set(Te(u,h),x(p)),u.h+=p.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],h=Array.from(this.g.keys());for(var p=0;p<h.length;p++){var v=h[p];const U=encodeURIComponent(String(v)),de=this.V(v);for(v=0;v<de.length;v++){var V=U;de[v]!==""&&(V+="="+encodeURIComponent(String(de[v]))),u.push(V)}}return this.i=u.join("&")};function Te(u,h){return h=String(h),u.j&&(h=h.toLowerCase()),h}function Be(u,h){h&&!u.j&&(S(u),u.i=null,u.g.forEach(function(p,v){var V=v.toLowerCase();v!=V&&(y(this,v),_e(this,V,p))},u)),u.j=h}function Me(u,h){const p=new Hs;if(a.Image){const v=new Image;v.onload=_(Fe,p,"TestLoadImage: loaded",!0,h,v),v.onerror=_(Fe,p,"TestLoadImage: error",!1,h,v),v.onabort=_(Fe,p,"TestLoadImage: abort",!1,h,v),v.ontimeout=_(Fe,p,"TestLoadImage: timeout",!1,h,v),a.setTimeout(function(){v.ontimeout&&v.ontimeout()},1e4),v.src=u}else h(!1)}function Xe(u,h){const p=new Hs,v=new AbortController,V=setTimeout(()=>{v.abort(),Fe(p,"TestPingServer: timeout",!1,h)},1e4);fetch(u,{signal:v.signal}).then(U=>{clearTimeout(V),U.ok?Fe(p,"TestPingServer: ok",!0,h):Fe(p,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(V),Fe(p,"TestPingServer: error",!1,h)})}function Fe(u,h,p,v,V){try{V&&(V.onload=null,V.onerror=null,V.onabort=null,V.ontimeout=null),v(p)}catch{}}function Yt(){this.g=new ar}function At(u,h,p){const v=p||"";try{iu(u,function(V,U){let de=V;c(V)&&(de=wt(V)),h.push(v+U+"="+encodeURIComponent(de))})}catch(V){throw h.push(v+"type="+encodeURIComponent("_badmap")),V}}function it(u){this.l=u.Ub||null,this.j=u.eb||!1}C(it,Er),it.prototype.g=function(){return new te(this.l,this.j)},it.prototype.i=function(u){return function(){return u}}({});function te(u,h){ae.call(this),this.D=u,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(te,ae),n=te.prototype,n.open=function(u,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=h,this.readyState=1,xr(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(h.body=u),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,An(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,xr(this)),this.g&&(this.readyState=3,xr(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;$e(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function $e(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var h=u.value?u.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!u.done}))&&(this.response=this.responseText+=h)}u.done?An(this):xr(this),this.readyState==3&&$e(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,An(this))},n.Qa=function(u){this.g&&(this.response=u,An(this))},n.ga=function(){this.g&&An(this)};function An(u){u.readyState=4,u.l=null,u.j=null,u.v=null,xr(u)}n.setRequestHeader=function(u,h){this.u.append(u,h)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],h=this.h.entries();for(var p=h.next();!p.done;)p=p.value,u.push(p[0]+": "+p[1]),p=h.next();return u.join(`\r
`)};function xr(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(te.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function ji(u){let h="";return se(u,function(p,v){h+=v,h+=":",h+=p,h+=`\r
`}),h}function ca(u,h,p){e:{for(v in p){var v=!1;break e}v=!0}v||(p=ji(p),typeof u=="string"?p!=null&&encodeURIComponent(String(p)):ct(u,h,p))}function kt(u){ae.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(kt,ae);var qb=/^https?$/i,zb=["POST","PUT"];n=kt.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,h,p,v){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);h=h?h.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():na.g(),this.v=this.o?Hl(this.o):Hl(na),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(h,String(u),!0),this.B=!1}catch(U){jp(this,U);return}if(u=p||"",p=new Map(this.headers),v)if(Object.getPrototypeOf(v)===Object.prototype)for(var V in v)p.set(V,v[V]);else if(typeof v.keys=="function"&&typeof v.get=="function")for(const U of v.keys())p.set(U,v.get(U));else throw Error("Unknown input type for opt_headers: "+String(v));v=Array.from(p.keys()).find(U=>U.toLowerCase()=="content-type"),V=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(zb,h,void 0))||v||V||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[U,de]of p)this.g.setRequestHeader(U,de);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Gp(this),this.u=!0,this.g.send(u),this.u=!1}catch(U){jp(this,U)}};function jp(u,h){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=h,u.m=5,qp(u),uu(u)}function qp(u){u.A||(u.A=!0,Ee(u,"complete"),Ee(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,Ee(this,"complete"),Ee(this,"abort"),uu(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),uu(this,!0)),kt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?zp(this):this.bb())},n.bb=function(){zp(this)};function zp(u){if(u.h&&typeof o<"u"&&(!u.v[1]||Sr(u)!=4||u.Z()!=2)){if(u.u&&Sr(u)==4)Wt(u.Ea,0,u);else if(Ee(u,"readystatechange"),Sr(u)==4){u.h=!1;try{const de=u.Z();e:switch(de){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var p;if(!(p=h)){var v;if(v=de===0){var V=String(u.D).match(ou)[1]||null;!V&&a.self&&a.self.location&&(V=a.self.location.protocol.slice(0,-1)),v=!qb.test(V?V.toLowerCase():"")}p=v}if(p)Ee(u,"complete"),Ee(u,"success");else{u.m=6;try{var U=2<Sr(u)?u.g.statusText:""}catch{U=""}u.l=U+" ["+u.Z()+"]",qp(u)}}finally{uu(u)}}}}function uu(u,h){if(u.g){Gp(u);const p=u.g,v=u.v[0]?()=>{}:null;u.g=null,u.v=null,h||Ee(u,"ready");try{p.onreadystatechange=v}catch{}}}function Gp(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function Sr(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<Sr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var h=this.g.responseText;return u&&h.indexOf(u)==0&&(h=h.substring(u.length)),Qt(h)}};function Kp(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Gb(u){const h={};u=(u.g&&2<=Sr(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let v=0;v<u.length;v++){if(B(u[v]))continue;var p=k(u[v]);const V=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();const U=h[V]||[];h[V]=U,U.push(p)}T(h,function(v){return v.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function da(u,h,p){return p&&p.internalChannelParams&&p.internalChannelParams[u]||h}function Hp(u){this.Aa=0,this.i=[],this.j=new Hs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=da("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=da("baseRetryDelayMs",5e3,u),this.cb=da("retryDelaySeedMs",1e4,u),this.Wa=da("forwardChannelMaxRetries",2,u),this.wa=da("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new tu(u&&u.concurrentRequestLimit),this.Da=new Yt,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Hp.prototype,n.la=8,n.G=1,n.connect=function(u,h,p,v){Jt(0),this.W=u,this.H=h||{},p&&v!==void 0&&(this.H.OSID=p,this.H.OAID=v),this.F=this.X,this.I=nm(this,null,this.W),du(this)};function Ed(u){if(Wp(u),u.G==3){var h=u.U++,p=Xn(u.I);if(ct(p,"SID",u.K),ct(p,"RID",h),ct(p,"TYPE","terminate"),ha(u,p),h=new Yn(u,u.j,h),h.L=2,h.v=as(Xn(p)),p=!1,a.navigator&&a.navigator.sendBeacon)try{p=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!p&&a.Image&&(new Image().src=h.v,p=!0),p||(h.g=rm(h.j,null),h.g.ea(h.v)),h.F=Date.now(),Li(h)}tm(u)}function cu(u){u.g&&(Ad(u),u.g.cancel(),u.g=null)}function Wp(u){cu(u),u.u&&(a.clearTimeout(u.u),u.u=null),hu(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function du(u){if(!oa(u.h)&&!u.s){u.s=!0;var h=u.Ga;ue||ke(),K||(ue(),K=!0),Pe.add(h,u),u.B=0}}function Kb(u,h){return nu(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=h.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=rs(g(u.Ga,u,h),em(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const V=new Yn(this,this.j,u);let U=this.o;if(this.S&&(U?(U=w(U),P(U,this.S)):U=this.S),this.m!==null||this.O||(V.H=U,U=null),this.P)e:{for(var h=0,p=0;p<this.i.length;p++){t:{var v=this.i[p];if("__data__"in v.map&&(v=v.map.__data__,typeof v=="string")){v=v.length;break t}v=void 0}if(v===void 0)break;if(h+=v,4096<h){h=p;break e}if(h===4096||p===this.i.length-1){h=p+1;break e}}h=1e3}else h=1e3;h=Jp(this,V,h),p=Xn(this.I),ct(p,"RID",u),ct(p,"CVER",22),this.D&&ct(p,"X-HTTP-Session-Id",this.D),ha(this,p),U&&(this.O?h="headers="+encodeURIComponent(String(ji(U)))+"&"+h:this.m&&ca(p,this.m,U)),aa(this.h,V),this.Ua&&ct(p,"TYPE","init"),this.P?(ct(p,"$req",h),ct(p,"SID","null"),V.T=!0,os(V,p,null)):os(V,p,h),this.G=2}}else this.G==3&&(u?Qp(this,u):this.i.length==0||oa(this.h)||Qp(this))};function Qp(u,h){var p;h?p=h.l:p=u.U++;const v=Xn(u.I);ct(v,"SID",u.K),ct(v,"RID",p),ct(v,"AID",u.T),ha(u,v),u.m&&u.o&&ca(v,u.m,u.o),p=new Yn(u,u.j,p,u.B+1),u.m===null&&(p.H=u.o),h&&(u.i=h.D.concat(u.i)),h=Jp(u,p,1e3),p.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),aa(u.h,p),os(p,v,h)}function ha(u,h){u.H&&se(u.H,function(p,v){ct(h,v,p)}),u.l&&iu({},function(p,v){ct(h,v,p)})}function Jp(u,h,p){p=Math.min(u.i.length,p);var v=u.l?g(u.l.Na,u.l,u):null;e:{var V=u.i;let U=-1;for(;;){const de=["count="+p];U==-1?0<p?(U=V[0].g,de.push("ofs="+U)):U=0:de.push("ofs="+U);let dt=!0;for(let ln=0;ln<p;ln++){let Ze=V[ln].g;const pn=V[ln].map;if(Ze-=U,0>Ze)U=Math.max(0,V[ln].g-100),dt=!1;else try{At(pn,de,"req"+Ze+"_")}catch{v&&v(pn)}}if(dt){v=de.join("&");break e}}}return u=u.i.splice(0,p),h.D=u,v}function Yp(u){if(!u.g&&!u.u){u.Y=1;var h=u.Fa;ue||ke(),K||(ue(),K=!0),Pe.add(h,u),u.v=0}}function Td(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=rs(g(u.Fa,u),em(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,Xp(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=rs(g(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Jt(10),cu(this),Xp(this))};function Ad(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function Xp(u){u.g=new Yn(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var h=Xn(u.qa);ct(h,"RID","rpc"),ct(h,"SID",u.K),ct(h,"AID",u.T),ct(h,"CI",u.F?"0":"1"),!u.F&&u.ja&&ct(h,"TO",u.ja),ct(h,"TYPE","xmlhttp"),ha(u,h),u.m&&u.o&&ca(h,u.m,u.o),u.L&&(u.g.I=u.L);var p=u.g;u=u.ia,p.L=1,p.v=as(Xn(h)),p.m=null,p.P=!0,Xl(p,u)}n.Za=function(){this.C!=null&&(this.C=null,cu(this),Td(this),Jt(19))};function hu(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function Zp(u,h){var p=null;if(u.g==h){hu(u),Ad(u),u.g=null;var v=2}else if(Fi(u.h,h))p=h.D,ru(u.h,h),v=1;else return;if(u.G!=0){if(h.o)if(v==1){p=h.m?h.m.length:0,h=Date.now()-h.F;var V=u.B;v=at(),Ee(v,new Dn(v,p)),du(u)}else Yp(u);else if(V=h.s,V==3||V==0&&0<h.X||!(v==1&&Kb(u,h)||v==2&&Td(u)))switch(p&&0<p.length&&(h=u.h,h.i=h.i.concat(p)),V){case 1:Xs(u,5);break;case 4:Xs(u,10);break;case 3:Xs(u,6);break;default:Xs(u,2)}}}function em(u,h){let p=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(p*=2),p*h}function Xs(u,h){if(u.j.info("Error code "+h),h==2){var p=g(u.fb,u),v=u.Xa;const V=!v;v=new dr(v||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Qs(v,"https"),as(v),V?Me(v.toString(),p):Xe(v.toString(),p)}else Jt(2);u.G=0,u.l&&u.l.sa(h),tm(u),Wp(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),Jt(2)):(this.j.info("Failed to ping google.com"),Jt(1))};function tm(u){if(u.G=0,u.ka=[],u.l){const h=su(u.h);(h.length!=0||u.i.length!=0)&&(R(u.ka,h),R(u.ka,u.i),u.h.i.length=0,x(u.i),u.i.length=0),u.l.ra()}}function nm(u,h,p){var v=p instanceof dr?Xn(p):new dr(p);if(v.g!="")h&&(v.g=h+"."+v.g),Bi(v,v.s);else{var V=a.location;v=V.protocol,h=h?h+"."+V.hostname:V.hostname,V=+V.port;var U=new dr(null);v&&Qs(U,v),h&&(U.g=h),V&&Bi(U,V),p&&(U.l=p),v=U}return p=u.D,h=u.ya,p&&h&&ct(v,p,h),ct(v,"VER",u.la),ha(u,v),v}function rm(u,h,p){if(h&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=u.Ca&&!u.pa?new kt(new it({eb:p})):new kt(u.pa),h.Ha(u.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function sm(){}n=sm.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function fu(){}fu.prototype.g=function(u,h){return new Bn(u,h)};function Bn(u,h){ae.call(this),this.g=new Hp(h),this.l=u,this.h=h&&h.messageUrlParams||null,u=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(u?u["X-WebChannel-Content-Type"]=h.messageContentType:u={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(u?u["X-WebChannel-Client-Profile"]=h.va:u={"X-WebChannel-Client-Profile":h.va}),this.g.S=u,(u=h&&h.Sb)&&!B(u)&&(this.g.m=u),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!B(h)&&(this.g.D=h,u=this.h,u!==null&&h in u&&(u=this.h,h in u&&delete u[h])),this.j=new qi(this)}C(Bn,ae),Bn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Bn.prototype.close=function(){Ed(this.g)},Bn.prototype.o=function(u){var h=this.g;if(typeof u=="string"){var p={};p.__data__=u,u=p}else this.u&&(p={},p.__data__=wt(u),u=p);h.i.push(new yd(h.Ya++,u)),h.G==3&&du(h)},Bn.prototype.N=function(){this.g.l=null,delete this.j,Ed(this.g),delete this.g,Bn.aa.N.call(this)};function im(u){Zo.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var h=u.__sm__;if(h){e:{for(const p in h){u=p;break e}u=void 0}(this.i=u)&&(u=this.i,h=h!==null&&u in h?h[u]:void 0),this.data=h}else this.data=u}C(im,Zo);function om(){ut.call(this),this.status=1}C(om,ut);function qi(u){this.g=u}C(qi,sm),qi.prototype.ua=function(){Ee(this.g,"a")},qi.prototype.ta=function(u){Ee(this.g,new im(u))},qi.prototype.sa=function(u){Ee(this.g,new om)},qi.prototype.ra=function(){Ee(this.g,"b")},fu.prototype.createWebChannel=fu.prototype.g,Bn.prototype.send=Bn.prototype.o,Bn.prototype.open=Bn.prototype.m,Bn.prototype.close=Bn.prototype.close,Cy=function(){return new fu},Ry=function(){return at()},Py=et,Ah={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Tr.NO_ERROR=0,Tr.TIMEOUT=8,Tr.HTTP_ERROR=6,Du=Tr,ta.COMPLETE="complete",Sy=ta,Wl.EventType=Ks,Ks.OPEN="a",Ks.CLOSE="b",Ks.ERROR="c",Ks.MESSAGE="d",ae.prototype.listen=ae.prototype.K,Pa=Wl,kt.prototype.listenOnce=kt.prototype.L,kt.prototype.getLastError=kt.prototype.Ka,kt.prototype.getLastErrorCode=kt.prototype.Ba,kt.prototype.getStatus=kt.prototype.Z,kt.prototype.getResponseJson=kt.prototype.Oa,kt.prototype.getResponseText=kt.prototype.oa,kt.prototype.send=kt.prototype.ea,kt.prototype.setWithCredentials=kt.prototype.Ha,xy=kt}).apply(typeof vu<"u"?vu:typeof self<"u"?self:typeof window<"u"?window:{});const cg="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}nn.UNAUTHENTICATED=new nn(null),nn.GOOGLE_CREDENTIALS=new nn("google-credentials-uid"),nn.FIRST_PARTY=new nn("first-party-uid"),nn.MOCK_USER=new nn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bo="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ds=new vf("@firebase/firestore");function Zi(){return Ds.logLevel}function fL(n){Ds.setLogLevel(n)}function J(n,...e){if(Ds.logLevel<=Ge.DEBUG){const t=e.map(wf);Ds.debug(`Firestore (${Bo}): ${n}`,...t)}}function Lt(n,...e){if(Ds.logLevel<=Ge.ERROR){const t=e.map(wf);Ds.error(`Firestore (${Bo}): ${n}`,...t)}}function Qn(n,...e){if(Ds.logLevel<=Ge.WARN){const t=e.map(wf);Ds.warn(`Firestore (${Bo}): ${n}`,...t)}}function wf(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ge(n="Unexpected state"){const e=`FIRESTORE (${Bo}) INTERNAL ASSERTION FAILED: `+n;throw Lt(e),new Error(e)}function ye(n,e){n||ge()}function pL(n,e){n||ge()}function le(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Y extends Qr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ky{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Jx{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(nn.UNAUTHENTICATED))}shutdown(){}}class Yx{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Xx{constructor(e){this.t=e,this.currentUser=nn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ye(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new rn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new rn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{J("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(J("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new rn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(J("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ye(typeof r.accessToken=="string"),new ky(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ye(e===null||typeof e=="string"),new nn(e)}}class Zx{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=nn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class eS{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Zx(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(nn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Dy{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class tS{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){ye(this.o===void 0);const r=i=>{i.error!=null&&J("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,J("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{J("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):J("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ye(typeof t.token=="string"),this.R=t.token,new Dy(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class mL{getToken(){return Promise.resolve(new Dy(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nS(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vy{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=nS(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Ce(n,e){return n<e?-1:n>e?1:0}function Io(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function Ny(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Y(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Y(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Y(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Y(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Pt.fromMillis(Date.now())}static fromDate(e){return Pt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Pt(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ce(this.nanoseconds,e.nanoseconds):Ce(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ae{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ae(e)}static min(){return new Ae(new Pt(0,0))}static max(){return new Ae(new Pt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rl{constructor(e,t,r){t===void 0?t=0:t>e.length&&ge(),r===void 0?r=e.length-t:r>e.length-t&&ge(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return rl.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof rl?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ke extends rl{construct(e,t,r){return new Ke(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Y(F.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new Ke(t)}static emptyPath(){return new Ke([])}}const rS=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class It extends rl{construct(e,t,r){return new It(e,t,r)}static isValidIdentifier(e){return rS.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),It.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new It(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new Y(F.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new Y(F.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Y(F.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new Y(F.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new It(t)}static emptyPath(){return new It([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pe{constructor(e){this.path=e}static fromPath(e){return new pe(Ke.fromString(e))}static fromName(e){return new pe(Ke.fromString(e).popFirst(5))}static empty(){return new pe(Ke.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ke.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ke.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new pe(new Ke(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eo{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function xh(n){return n.fields.find(e=>e.kind===2)}function si(n){return n.fields.filter(e=>e.kind!==2)}function sS(n,e){let t=Ce(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=iS(n.fields[r],e.fields[r]),t!==0)return t;return Ce(n.fields.length,e.fields.length)}Eo.UNKNOWN_ID=-1;class pi{constructor(e,t){this.fieldPath=e,this.kind=t}}function iS(n,e){const t=It.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Ce(n.kind,e.kind)}class To{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new To(0,Gn.min())}}function Oy(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Ae.fromTimestamp(r===1e9?new Pt(t+1,0):new Pt(t,r));return new Gn(s,pe.empty(),e)}function My(n){return new Gn(n.readTime,n.key,-1)}class Gn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Gn(Ae.min(),pe.empty(),-1)}static max(){return new Gn(Ae.max(),pe.empty(),-1)}}function bf(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=pe.comparator(n.documentKey,e.documentKey),t!==0?t:Ce(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ly="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Fy{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $s(n){if(n.code!==F.FAILED_PRECONDITION||n.message!==Ly)throw n;J("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ge(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new N((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof N?t:N.resolve(t)}catch(t){return N.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):N.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):N.reject(t)}static resolve(e){return new N((t,r)=>{t(e)})}static reject(e){return new N((t,r)=>{r(e)})}static waitFor(e){return new N((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=N.resolve(!1);for(const r of e)t=t.next(s=>s?N.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new N((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(d=>{o[c]=d,++a,a===i&&r(o)},d=>s(d))}})}static doWhile(e,t){return new N((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new rn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new ja(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=If(r.target.error);this.V.reject(new ja(e,s))}}static open(e,t,r,s){try{return new Uc(t,e.transaction(s,r))}catch(i){throw new ja(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(J("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new aS(t)}}class vr{constructor(e,t,r){this.name=e,this.version=t,this.p=r,vr.S(Zt())===12.2&&Lt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return J("SimpleDb","Removing database:",e),ii(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!vy())return!1;if(vr.v())return!0;const e=Zt(),t=vr.S(e),r=0<t&&t<10,s=Uy(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(J("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new ja(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new Y(F.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new Y(F.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new ja(e,o))},s.onupgradeneeded=i=>{J("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{J("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=Uc.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),N.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(J("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Uy(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class oS{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return ii(this.B.delete())}}class ja extends Y{constructor(e,t){super(F.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function js(n){return n.name==="IndexedDbTransactionError"}class aS{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(J("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(J("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ii(r)}add(e){return J("SimpleDb","ADD",this.store.name,e,e),ii(this.store.add(e))}get(e){return ii(this.store.get(e)).next(t=>(t===void 0&&(t=null),J("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return J("SimpleDb","DELETE",this.store.name,e),ii(this.store.delete(e))}count(){return J("SimpleDb","COUNT",this.store.name),ii(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new N((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new N((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){J("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new N((r,s)=>{t.onerror=i=>{const o=If(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new N((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new oS(a),c=t(a.primaryKey,a.value,l);if(c instanceof N){const d=c.catch(f=>(l.done(),N.reject(f)));r.push(d)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>N.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ii(n){return new N((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=If(r.target.error);t(s)}})}let dg=!1;function If(n){const e=vr.S(Zt());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new Y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return dg||(dg=!0,setTimeout(()=>{throw r},0)),r}}return n}class lS{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){J("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{J("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){js(t)?J("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await $s(t)}await this.X(6e4)})}}class uS{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return N.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return J("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(J("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=My(i);bf(o,r)>0&&(r=o)}),new Gn(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Mn.oe=-1;function xl(n){return n==null}function sl(n){return n===0&&1/n==-1/0}function By(n){return typeof n=="number"&&Number.isInteger(n)&&!sl(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=hg(e)),e=cS(n.get(t),e);return hg(e)}function cS(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function hg(n){return n+""}function mr(n){const e=n.length;if(ye(e>=2),e===2)return ye(n.charAt(0)===""&&n.charAt(1)===""),Ke.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&ge(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:ge()}i=o+2}return new Ke(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fg=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vu(n,e){return[n,bn(e)]}function $y(n,e,t){return[n,bn(e),t]}const dS={},hS=["prefixPath","collectionGroup","readTime","documentId"],fS=["prefixPath","collectionGroup","documentId"],pS=["collectionGroup","readTime","prefixPath","documentId"],mS=["canonicalId","targetId"],gS=["targetId","path"],_S=["path","targetId"],vS=["collectionId","parent"],yS=["indexId","uid"],wS=["uid","sequenceNumber"],bS=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],IS=["indexId","uid","orderedDocumentKey"],ES=["userId","collectionPath","documentId"],TS=["userId","collectionPath","largestBatchId"],AS=["userId","collectionGroup","largestBatchId"],jy=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],xS=[...jy,"documentOverlays"],qy=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],zy=qy,Ef=[...zy,"indexConfiguration","indexState","indexEntries"],SS=Ef,PS=[...Ef,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sh extends Fy{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function en(n,e){const t=le(n);return vr.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pg(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function qs(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Gy(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function Ky(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{constructor(e,t){this.comparator=e,this.root=t||un.EMPTY}insert(e,t){return new mt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,un.BLACK,null,null))}remove(e){return new mt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,un.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new yu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new yu(this.root,e,this.comparator,!1)}getReverseIterator(){return new yu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new yu(this.root,e,this.comparator,!0)}}class yu{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class un{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??un.RED,this.left=s??un.EMPTY,this.right=i??un.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new un(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return un.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return un.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,un.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,un.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ge();const e=this.left.check();if(e!==this.right.check())throw ge();return e+(this.isRed()?0:1)}}un.EMPTY=null,un.RED=!0,un.BLACK=!1;un.EMPTY=new class{constructor(){this.size=0}get key(){throw ge()}get value(){throw ge()}get color(){throw ge()}get left(){throw ge()}get right(){throw ge()}copy(e,t,r,s,i){return this}insert(e,t,r){return new un(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lt{constructor(e){this.comparator=e,this.data=new mt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new mg(this.data.getIterator())}getIteratorFrom(e){return new mg(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof lt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new lt(this.comparator);return t.data=e,t}}class mg{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ki(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(e){this.fields=e,e.sort(It.comparator)}static empty(){return new Ln([])}unionWith(e){let t=new lt(It.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ln(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Io(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hy extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _L(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Hy("Invalid base64 string: "+i):i}}(e);return new Vt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Vt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ce(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Vt.EMPTY_BYTE_STRING=new Vt("");const RS=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qr(n){if(ye(!!n),typeof n=="string"){let e=0;const t=RS.exec(n);if(ye(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:bt(n.seconds),nanos:bt(n.nanos)}}function bt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function zr(n){return typeof n=="string"?Vt.fromBase64String(n):Vt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bc(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function $c(n){const e=n.mapValue.fields.__previous_value__;return Bc(e)?$c(e):e}function il(n){const e=qr(n.mapValue.fields.__local_write_time__.timestampValue);return new Pt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CS{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class _i{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new _i("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof _i&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ts={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Nu={nullValue:"NULL_VALUE"};function Vs(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Bc(n)?4:Wy(n)?9007199254740991:jc(n)?10:11:ge()}function Ir(n,e){if(n===e)return!0;const t=Vs(n);if(t!==Vs(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return il(n).isEqual(il(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=qr(s.timestampValue),a=qr(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return zr(s.bytesValue).isEqual(zr(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return bt(s.geoPointValue.latitude)===bt(i.geoPointValue.latitude)&&bt(s.geoPointValue.longitude)===bt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return bt(s.integerValue)===bt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=bt(s.doubleValue),a=bt(i.doubleValue);return o===a?sl(o)===sl(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Io(n.arrayValue.values||[],e.arrayValue.values||[],Ir);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(pg(o)!==pg(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ir(o[l],a[l])))return!1;return!0}(n,e);default:return ge()}}function ol(n,e){return(n.values||[]).find(t=>Ir(t,e))!==void 0}function Ns(n,e){if(n===e)return 0;const t=Vs(n),r=Vs(e);if(t!==r)return Ce(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ce(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=bt(i.integerValue||i.doubleValue),l=bt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return gg(n.timestampValue,e.timestampValue);case 4:return gg(il(n),il(e));case 5:return Ce(n.stringValue,e.stringValue);case 6:return function(i,o){const a=zr(i),l=zr(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const d=Ce(a[c],l[c]);if(d!==0)return d}return Ce(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Ce(bt(i.latitude),bt(o.latitude));return a!==0?a:Ce(bt(i.longitude),bt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return _g(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,d;const f=i.fields||{},g=o.fields||{},_=(a=f.value)===null||a===void 0?void 0:a.arrayValue,C=(l=g.value)===null||l===void 0?void 0:l.arrayValue,x=Ce(((c=_==null?void 0:_.values)===null||c===void 0?void 0:c.length)||0,((d=C==null?void 0:C.values)===null||d===void 0?void 0:d.length)||0);return x!==0?x:_g(_,C)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Ts.mapValue&&o===Ts.mapValue)return 0;if(i===Ts.mapValue)return 1;if(o===Ts.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},d=Object.keys(c);l.sort(),d.sort();for(let f=0;f<l.length&&f<d.length;++f){const g=Ce(l[f],d[f]);if(g!==0)return g;const _=Ns(a[l[f]],c[d[f]]);if(_!==0)return _}return Ce(l.length,d.length)}(n.mapValue,e.mapValue);default:throw ge()}}function gg(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ce(n,e);const t=qr(n),r=qr(e),s=Ce(t.seconds,r.seconds);return s!==0?s:Ce(t.nanos,r.nanos)}function _g(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Ns(t[s],r[s]);if(i)return i}return Ce(t.length,r.length)}function Ao(n){return Ph(n)}function Ph(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=qr(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return zr(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return pe.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=Ph(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${Ph(t.fields[o])}`;return s+"}"}(n.mapValue):ge()}function Ou(n){switch(Vs(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=$c(n);return e?16+Ou(e):16;case 5:return 2*n.stringValue.length;case 6:return zr(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Ou(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return qs(r.fields,(i,o)=>{s+=i.length+Ou(o)}),s}(n.mapValue);default:throw ge()}}function vi(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Rh(n){return!!n&&"integerValue"in n}function al(n){return!!n&&"arrayValue"in n}function vg(n){return!!n&&"nullValue"in n}function yg(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Mu(n){return!!n&&"mapValue"in n}function jc(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function qa(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return qs(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=qa(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=qa(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Wy(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const Qy={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function kS(n){return"nullValue"in n?Nu:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?vi(_i.empty(),pe.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?jc(n)?Qy:{mapValue:{}}:ge()}function DS(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?vi(_i.empty(),pe.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Qy:"mapValue"in n?jc(n)?{mapValue:{}}:Ts:ge()}function wg(n,e){const t=Ns(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function bg(n,e){const t=Ns(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e){this.value=e}static empty(){return new dn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Mu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=qa(t)}setAll(e){let t=It.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=qa(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Mu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ir(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Mu(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){qs(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new dn(qa(this.value))}}function Jy(n){const e=[];return qs(n.fields,(t,r)=>{const s=new It([t]);if(Mu(r)){const i=Jy(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Ln(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _t{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new _t(e,0,Ae.min(),Ae.min(),Ae.min(),dn.empty(),0)}static newFoundDocument(e,t,r,s){return new _t(e,1,t,Ae.min(),r,s,0)}static newNoDocument(e,t){return new _t(e,2,t,Ae.min(),Ae.min(),dn.empty(),0)}static newUnknownDocument(e,t){return new _t(e,3,t,Ae.min(),Ae.min(),dn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ae.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=dn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=dn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ae.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof _t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new _t(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Os{constructor(e,t){this.position=e,this.inclusive=t}}function Ig(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=pe.comparator(pe.fromName(o.referenceValue),t.key):r=Ns(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Eg(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ir(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{constructor(e,t="asc"){this.field=e,this.dir=t}}function VS(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yy{}class He extends Yy{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new NS(e,t,r):t==="array-contains"?new LS(e,r):t==="in"?new r0(e,r):t==="not-in"?new FS(e,r):t==="array-contains-any"?new US(e,r):new He(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new OS(e,r):new MS(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ns(t,this.value)):t!==null&&Vs(this.value)===Vs(t)&&this.matchesComparison(Ns(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ge()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ot extends Yy{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new ot(e,t)}matches(e){return xo(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function xo(n){return n.op==="and"}function Ch(n){return n.op==="or"}function Tf(n){return Xy(n)&&xo(n)}function Xy(n){for(const e of n.filters)if(e instanceof ot)return!1;return!0}function kh(n){if(n instanceof He)return n.field.canonicalString()+n.op.toString()+Ao(n.value);if(Tf(n))return n.filters.map(e=>kh(e)).join(",");{const e=n.filters.map(t=>kh(t)).join(",");return`${n.op}(${e})`}}function Zy(n,e){return n instanceof He?function(r,s){return s instanceof He&&r.op===s.op&&r.field.isEqual(s.field)&&Ir(r.value,s.value)}(n,e):n instanceof ot?function(r,s){return s instanceof ot&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&Zy(o,s.filters[a]),!0):!1}(n,e):void ge()}function e0(n,e){const t=n.filters.concat(e);return ot.create(t,n.op)}function t0(n){return n instanceof He?function(t){return`${t.field.canonicalString()} ${t.op} ${Ao(t.value)}`}(n):n instanceof ot?function(t){return t.op.toString()+" {"+t.getFilters().map(t0).join(" ,")+"}"}(n):"Filter"}class NS extends He{constructor(e,t,r){super(e,t,r),this.key=pe.fromName(r.referenceValue)}matches(e){const t=pe.comparator(e.key,this.key);return this.matchesComparison(t)}}class OS extends He{constructor(e,t){super(e,"in",t),this.keys=n0("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class MS extends He{constructor(e,t){super(e,"not-in",t),this.keys=n0("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function n0(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>pe.fromName(r.referenceValue))}class LS extends He{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return al(t)&&ol(t.arrayValue,this.value)}}class r0 extends He{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&ol(this.value.arrayValue,t)}}class FS extends He{constructor(e,t){super(e,"not-in",t)}matches(e){if(ol(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!ol(this.value.arrayValue,t)}}class US extends He{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!al(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>ol(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BS{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function Dh(n,e=null,t=[],r=[],s=null,i=null,o=null){return new BS(n,e,t,r,s,i,o)}function yi(n){const e=le(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>kh(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),xl(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ao(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ao(r)).join(",")),e.ue=t}return e.ue}function Sl(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!VS(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Zy(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Eg(n.startAt,e.startAt)&&Eg(n.endAt,e.endAt)}function rc(n){return pe.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function sc(n,e){return n.filters.filter(t=>t instanceof He&&t.field.isEqual(e))}function Tg(n,e,t){let r=Nu,s=!0;for(const i of sc(n,e)){let o=Nu,a=!0;switch(i.op){case"<":case"<=":o=kS(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Nu}wg({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];wg({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function Ag(n,e,t){let r=Ts,s=!0;for(const i of sc(n,e)){let o=Ts,a=!0;switch(i.op){case">=":case">":o=DS(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Ts}bg({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];bg({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function s0(n,e,t,r,s,i,o,a){return new Jr(n,e,t,r,s,i,o,a)}function $o(n){return new Jr(n)}function xg(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Af(n){return n.collectionGroup!==null}function uo(n){const e=le(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new lt(It.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new ll(i,r))}),t.has(It.keyField().canonicalString())||e.ce.push(new ll(It.keyField(),r))}return e.ce}function In(n){const e=le(n);return e.le||(e.le=o0(e,uo(n))),e.le}function i0(n){const e=le(n);return e.he||(e.he=o0(e,n.explicitOrderBy)),e.he}function o0(n,e){if(n.limitType==="F")return Dh(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new ll(s.field,i)});const t=n.endAt?new Os(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Os(n.startAt.position,n.startAt.inclusive):null;return Dh(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Vh(n,e){const t=n.filters.concat([e]);return new Jr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function ic(n,e,t){return new Jr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Pl(n,e){return Sl(In(n),In(e))&&n.limitType===e.limitType}function a0(n){return`${yi(In(n))}|lt:${n.limitType}`}function eo(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>t0(s)).join(", ")}]`),xl(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Ao(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Ao(s)).join(",")),`Target(${r})`}(In(n))}; limitType=${n.limitType})`}function Rl(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):pe.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of uo(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=Ig(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,uo(r),s)||r.endAt&&!function(o,a,l){const c=Ig(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,uo(r),s))}(n,e)}function l0(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function u0(n){return(e,t)=>{let r=!1;for(const s of uo(n)){const i=$S(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function $S(n,e,t){const r=n.field.isKeyField()?pe.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?Ns(l,c):ge()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ge()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yr{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){qs(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Ky(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jS=new mt(pe.comparator);function Fn(){return jS}const c0=new mt(pe.comparator);function Ra(...n){let e=c0;for(const t of n)e=e.insert(t.key,t);return e}function d0(n){let e=c0;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function gr(){return za()}function h0(){return za()}function za(){return new Yr(n=>n.toString(),(n,e)=>n.isEqual(e))}const qS=new mt(pe.comparator),zS=new lt(pe.comparator);function Ue(...n){let e=zS;for(const t of n)e=e.add(t);return e}const GS=new lt(Ce);function xf(){return GS}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sf(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:sl(e)?"-0":e}}function f0(n){return{integerValue:""+n}}function p0(n,e){return By(e)?f0(e):Sf(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qc{constructor(){this._=void 0}}function KS(n,e,t){return n instanceof So?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Bc(i)&&(i=$c(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof wi?g0(n,e):n instanceof bi?_0(n,e):function(s,i){const o=m0(s,i),a=Sg(o)+Sg(s.Pe);return Rh(o)&&Rh(s.Pe)?f0(a):Sf(s.serializer,a)}(n,e)}function HS(n,e,t){return n instanceof wi?g0(n,e):n instanceof bi?_0(n,e):t}function m0(n,e){return n instanceof Po?function(r){return Rh(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class So extends qc{}class wi extends qc{constructor(e){super(),this.elements=e}}function g0(n,e){const t=v0(e);for(const r of n.elements)t.some(s=>Ir(s,r))||t.push(r);return{arrayValue:{values:t}}}class bi extends qc{constructor(e){super(),this.elements=e}}function _0(n,e){let t=v0(e);for(const r of n.elements)t=t.filter(s=>!Ir(s,r));return{arrayValue:{values:t}}}class Po extends qc{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Sg(n){return bt(n.integerValue||n.doubleValue)}function v0(n){return al(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cl{constructor(e,t){this.field=e,this.transform=t}}function WS(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof wi&&s instanceof wi||r instanceof bi&&s instanceof bi?Io(r.elements,s.elements,Ir):r instanceof Po&&s instanceof Po?Ir(r.Pe,s.Pe):r instanceof So&&s instanceof So}(n.transform,e.transform)}class QS{constructor(e,t){this.version=e,this.transformResults=t}}class Et{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Et}static exists(e){return new Et(void 0,e)}static updateTime(e){return new Et(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Lu(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class zc{}function y0(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new qo(n.key,Et.none()):new jo(n.key,n.data,Et.none());{const t=n.data,r=dn.empty();let s=new lt(It.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Xr(n.key,r,new Ln(s.toArray()),Et.none())}}function JS(n,e,t){n instanceof jo?function(s,i,o){const a=s.value.clone(),l=Rg(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Xr?function(s,i,o){if(!Lu(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=Rg(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(w0(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Ga(n,e,t,r){return n instanceof jo?function(i,o,a,l){if(!Lu(i.precondition,o))return a;const c=i.value.clone(),d=Cg(i.fieldTransforms,l,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof Xr?function(i,o,a,l){if(!Lu(i.precondition,o))return a;const c=Cg(i.fieldTransforms,l,o),d=o.data;return d.setAll(w0(i)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Lu(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function YS(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=m0(r.transform,s||null);i!=null&&(t===null&&(t=dn.empty()),t.set(r.field,i))}return t||null}function Pg(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Io(r,s,(i,o)=>WS(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class jo extends zc{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Xr extends zc{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function w0(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Rg(n,e,t){const r=new Map;ye(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,HS(o,a,t[s]))}return r}function Cg(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,KS(i,o,e))}return r}class qo extends zc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Pf extends zc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rf{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&JS(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ga(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Ga(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=h0();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=y0(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Ae.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ue())}isEqual(e){return this.batchId===e.batchId&&Io(this.mutations,e.mutations,(t,r)=>Pg(t,r))&&Io(this.baseMutations,e.baseMutations,(t,r)=>Pg(t,r))}}class Cf{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){ye(e.mutations.length===r.length);let s=function(){return qS}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Cf(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kf{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b0{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XS{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var zt,Je;function I0(n){switch(n){default:return ge();case F.CANCELLED:case F.UNKNOWN:case F.DEADLINE_EXCEEDED:case F.RESOURCE_EXHAUSTED:case F.INTERNAL:case F.UNAVAILABLE:case F.UNAUTHENTICATED:return!1;case F.INVALID_ARGUMENT:case F.NOT_FOUND:case F.ALREADY_EXISTS:case F.PERMISSION_DENIED:case F.FAILED_PRECONDITION:case F.ABORTED:case F.OUT_OF_RANGE:case F.UNIMPLEMENTED:case F.DATA_LOSS:return!0}}function E0(n){if(n===void 0)return Lt("GRPC error has no .code"),F.UNKNOWN;switch(n){case zt.OK:return F.OK;case zt.CANCELLED:return F.CANCELLED;case zt.UNKNOWN:return F.UNKNOWN;case zt.DEADLINE_EXCEEDED:return F.DEADLINE_EXCEEDED;case zt.RESOURCE_EXHAUSTED:return F.RESOURCE_EXHAUSTED;case zt.INTERNAL:return F.INTERNAL;case zt.UNAVAILABLE:return F.UNAVAILABLE;case zt.UNAUTHENTICATED:return F.UNAUTHENTICATED;case zt.INVALID_ARGUMENT:return F.INVALID_ARGUMENT;case zt.NOT_FOUND:return F.NOT_FOUND;case zt.ALREADY_EXISTS:return F.ALREADY_EXISTS;case zt.PERMISSION_DENIED:return F.PERMISSION_DENIED;case zt.FAILED_PRECONDITION:return F.FAILED_PRECONDITION;case zt.ABORTED:return F.ABORTED;case zt.OUT_OF_RANGE:return F.OUT_OF_RANGE;case zt.UNIMPLEMENTED:return F.UNIMPLEMENTED;case zt.DATA_LOSS:return F.DATA_LOSS;default:return ge()}}(Je=zt||(zt={}))[Je.OK=0]="OK",Je[Je.CANCELLED=1]="CANCELLED",Je[Je.UNKNOWN=2]="UNKNOWN",Je[Je.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Je[Je.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Je[Je.NOT_FOUND=5]="NOT_FOUND",Je[Je.ALREADY_EXISTS=6]="ALREADY_EXISTS",Je[Je.PERMISSION_DENIED=7]="PERMISSION_DENIED",Je[Je.UNAUTHENTICATED=16]="UNAUTHENTICATED",Je[Je.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Je[Je.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Je[Je.ABORTED=10]="ABORTED",Je[Je.OUT_OF_RANGE=11]="OUT_OF_RANGE",Je[Je.UNIMPLEMENTED=12]="UNIMPLEMENTED",Je[Je.INTERNAL=13]="INTERNAL",Je[Je.UNAVAILABLE=14]="UNAVAILABLE",Je[Je.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oc=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T0(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZS=new fi([4294967295,4294967295],0);function kg(n){const e=T0().encode(n),t=new Ay;return t.update(e),new Uint8Array(t.digest())}function Dg(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new fi([t,r],0),new fi([s,i],0)]}class Df{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ca(`Invalid padding: ${t}`);if(r<0)throw new Ca(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ca(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ca(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=fi.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(fi.fromNumber(r)));return s.compare(ZS)===1&&(s=new fi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=kg(e),[r,s]=Dg(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Df(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=kg(e),[r,s]=Dg(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Ca extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kl{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Dl.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new kl(Ae.min(),s,new mt(Ce),Fn(),Ue())}}class Dl{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Dl(r,t,Ue(),Ue(),Ue())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fu{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class A0{constructor(e,t){this.targetId=e,this.me=t}}class x0{constructor(e,t,r=Vt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Vg{constructor(){this.fe=0,this.ge=Og(),this.pe=Vt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Ue(),t=Ue(),r=Ue();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:ge()}}),new Dl(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=Og()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,ye(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class eP{constructor(e){this.Le=e,this.Be=new Map,this.ke=Fn(),this.qe=Ng(),this.Qe=new mt(Ce)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:ge()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(rc(i))if(r===0){const o=new pe(i.path);this.Ue(t,o,_t.newNoDocument(o,Ae.min()))}else ye(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}oc==null||oc.et(function(d,f,g,_,C){var x,R,L,B,$,j;const O={localCacheCount:d,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},se=f.unchangedNames;return se&&(O.bloomFilter={applied:C===0,hashCount:(x=se==null?void 0:se.hashCount)!==null&&x!==void 0?x:0,bitmapLength:(B=(L=(R=se==null?void 0:se.bits)===null||R===void 0?void 0:R.bitmap)===null||L===void 0?void 0:L.length)!==null&&B!==void 0?B:0,padding:(j=($=se==null?void 0:se.bits)===null||$===void 0?void 0:$.padding)!==null&&j!==void 0?j:0,mightContain:T=>{var w;return(w=_==null?void 0:_.mightContain(T))!==null&&w!==void 0&&w}}),O}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=zr(r).toUint8Array()}catch(l){if(l instanceof Hy)return Qn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Df(o,s,i)}catch(l){return Qn(l instanceof Ca?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&rc(a.target)){const l=new pe(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,_t.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=Ue();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new kl(e,t,this.Qe,this.ke,r);return this.ke=Fn(),this.qe=Ng(),this.Qe=new mt(Ce),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Vg,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new lt(Ce),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||J("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Vg),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Ng(){return new mt(pe.comparator)}function Og(){return new mt(pe.comparator)}const tP=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),nP=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),rP=(()=>({and:"AND",or:"OR"}))();class sP{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Nh(n,e){return n.useProto3Json||xl(e)?e:{value:e}}function Ro(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function S0(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function iP(n,e){return Ro(n,e.toTimestamp())}function Bt(n){return ye(!!n),Ae.fromTimestamp(function(t){const r=qr(t);return new Pt(r.seconds,r.nanos)}(n))}function Vf(n,e){return Oh(n,e).canonicalString()}function Oh(n,e){const t=function(s){return new Ke(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function P0(n){const e=Ke.fromString(n);return ye(F0(e)),e}function ul(n,e){return Vf(n.databaseId,e.path)}function yr(n,e){const t=P0(e);if(t.get(1)!==n.databaseId.projectId)throw new Y(F.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Y(F.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new pe(k0(t))}function R0(n,e){return Vf(n.databaseId,e)}function C0(n){const e=P0(n);return e.length===4?Ke.emptyPath():k0(e)}function Mh(n){return new Ke(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function k0(n){return ye(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Mg(n,e,t){return{name:ul(n,e),fields:t.value.mapValue.fields}}function D0(n,e,t){const r=yr(n,e.name),s=Bt(e.updateTime),i=e.createTime?Bt(e.createTime):Ae.min(),o=new dn({mapValue:{fields:e.fields}}),a=_t.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function oP(n,e){return"found"in e?function(r,s){ye(!!s.found),s.found.name,s.found.updateTime;const i=yr(r,s.found.name),o=Bt(s.found.updateTime),a=s.found.createTime?Bt(s.found.createTime):Ae.min(),l=new dn({mapValue:{fields:s.found.fields}});return _t.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){ye(!!s.missing),ye(!!s.readTime);const i=yr(r,s.missing),o=Bt(s.readTime);return _t.newNoDocument(i,o)}(n,e):ge()}function aP(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:ge()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,d){return c.useProto3Json?(ye(d===void 0||typeof d=="string"),Vt.fromBase64String(d||"")):(ye(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Vt.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const d=c.code===void 0?F.UNKNOWN:E0(c.code);return new Y(d,c.message||"")}(o);t=new x0(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=yr(n,r.document.name),i=Bt(r.document.updateTime),o=r.document.createTime?Bt(r.document.createTime):Ae.min(),a=new dn({mapValue:{fields:r.document.fields}}),l=_t.newFoundDocument(s,i,o,a),c=r.targetIds||[],d=r.removedTargetIds||[];t=new Fu(c,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=yr(n,r.document),i=r.readTime?Bt(r.readTime):Ae.min(),o=_t.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Fu([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=yr(n,r.document),i=r.removedTargetIds||[];t=new Fu([],i,s,null)}else{if(!("filter"in e))return ge();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new XS(s,i),a=r.targetId;t=new A0(a,o)}}return t}function cl(n,e){let t;if(e instanceof jo)t={update:Mg(n,e.key,e.value)};else if(e instanceof qo)t={delete:ul(n,e.key)};else if(e instanceof Xr)t={update:Mg(n,e.key,e.data),updateMask:fP(e.fieldMask)};else{if(!(e instanceof Pf))return ge();t={verify:ul(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof So)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof wi)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof bi)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Po)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw ge()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:iP(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ge()}(n,e.precondition)),t}function Lh(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Et.updateTime(Bt(i.updateTime)):i.exists!==void 0?Et.exists(i.exists):Et.none()}(e.currentDocument):Et.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)ye(a.setToServerValue==="REQUEST_TIME"),l=new So;else if("appendMissingElements"in a){const d=a.appendMissingElements.values||[];l=new wi(d)}else if("removeAllFromArray"in a){const d=a.removeAllFromArray.values||[];l=new bi(d)}else"increment"in a?l=new Po(o,a.increment):ge();const c=It.fromServerFormat(a.fieldPath);return new Cl(c,l)}(n,s)):[];if(e.update){e.update.name;const s=yr(n,e.update.name),i=new dn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new Ln(c.map(d=>It.fromServerFormat(d)))}(e.updateMask);return new Xr(s,i,o,t,r)}return new jo(s,i,t,r)}if(e.delete){const s=yr(n,e.delete);return new qo(s,t)}if(e.verify){const s=yr(n,e.verify);return new Pf(s,t)}return ge()}function lP(n,e){return n&&n.length>0?(ye(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?Bt(s.updateTime):Bt(i);return o.isEqual(Ae.min())&&(o=Bt(i)),new QS(o,s.transformResults||[])}(t,e))):[]}function V0(n,e){return{documents:[R0(n,e.path)]}}function Gc(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=R0(n,s);const i=function(c){if(c.length!==0)return L0(ot.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(d=>function(g){return{field:_s(g.field),direction:cP(g.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Nh(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function N0(n,e,t,r){const{_t:s,parent:i}=Gc(n,e),o={},a=[];let l=0;return t.forEach(c=>{const d=r?c.alias:"aggregate_"+l++;o[d]=c.alias,c.aggregateType==="count"?a.push({alias:d,count:{}}):c.aggregateType==="avg"?a.push({alias:d,avg:{field:_s(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:d,sum:{field:_s(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function O0(n){let e=C0(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){ye(r===1);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(f){const g=M0(f);return g instanceof ot&&Tf(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(C){return new ll(to(C.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,xl(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,_=f.values||[];return new Os(_,g)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const g=!f.before,_=f.values||[];return new Os(_,g)}(t.endAt)),s0(e,s,o,i,a,"F",l,c)}function uP(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ge()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function M0(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=to(t.unaryFilter.field);return He.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=to(t.unaryFilter.field);return He.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=to(t.unaryFilter.field);return He.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=to(t.unaryFilter.field);return He.create(o,"!=",{nullValue:"NULL_VALUE"});default:return ge()}}(n):n.fieldFilter!==void 0?function(t){return He.create(to(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ge()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ot.create(t.compositeFilter.filters.map(r=>M0(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ge()}}(t.compositeFilter.op))}(n):ge()}function cP(n){return tP[n]}function dP(n){return nP[n]}function hP(n){return rP[n]}function _s(n){return{fieldPath:n.canonicalString()}}function to(n){return It.fromServerFormat(n.fieldPath)}function L0(n){return n instanceof He?function(t){if(t.op==="=="){if(yg(t.value))return{unaryFilter:{field:_s(t.field),op:"IS_NAN"}};if(vg(t.value))return{unaryFilter:{field:_s(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(yg(t.value))return{unaryFilter:{field:_s(t.field),op:"IS_NOT_NAN"}};if(vg(t.value))return{unaryFilter:{field:_s(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:_s(t.field),op:dP(t.op),value:t.value}}}(n):n instanceof ot?function(t){const r=t.getFilters().map(s=>L0(s));return r.length===1?r[0]:{compositeFilter:{op:hP(t.op),filters:r}}}(n):ge()}function fP(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function F0(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nr{constructor(e,t,r,s,i=Ae.min(),o=Ae.min(),a=Vt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Nr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Nr(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Nr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Nr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U0{constructor(e){this.ct=e}}function pP(n,e){let t;if(e.document)t=D0(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=pe.fromSegments(e.noDocument.path),s=Ei(e.noDocument.readTime);t=_t.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ge();{const r=pe.fromSegments(e.unknownDocument.path),s=Ei(e.unknownDocument.version);t=_t.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Pt(s[0],s[1]);return Ae.fromTimestamp(i)}(e.readTime)),t}function Lg(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:ac(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:ul(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Ro(i,o.version.toTimestamp()),createTime:Ro(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ii(e.version)};else{if(!e.isUnknownDocument())return ge();r.unknownDocument={path:t.path.toArray(),version:Ii(e.version)}}return r}function ac(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ii(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ei(n){const e=new Pt(n.seconds,n.nanoseconds);return Ae.fromTimestamp(e)}function oi(n,e){const t=(e.baseMutations||[]).map(i=>Lh(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Lh(n.ct,i)),s=Pt.fromMillis(e.localWriteTimeMs);return new Rf(e.batchId,s,t,r)}function ka(n){const e=Ei(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Ei(n.lastLimboFreeSnapshotVersion):Ae.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return ye(i.documents.length===1),In($o(C0(i.documents[0])))}(n.query):function(i){return In(O0(i))}(n.query),new Nr(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Vt.fromBase64String(n.resumeToken))}function B0(n,e){const t=Ii(e.snapshotVersion),r=Ii(e.lastLimboFreeSnapshotVersion);let s;s=rc(e.target)?V0(n.ct,e.target):Gc(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:yi(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Nf(n){const e=O0({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ic(e,e.limit,"L"):e}function Kd(n,e){return new kf(e.largestBatchId,Lh(n.ct,e.overlayMutation))}function Fg(n,e){const t=e.path.lastSegment();return[n,bn(e.path.popLast()),t]}function Ug(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ii(r.readTime),documentKey:bn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mP{getBundleMetadata(e,t){return Bg(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Ei(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return Bg(e).put(function(s){return{bundleId:s.id,createTime:Ii(Bt(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return $g(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Nf(i.bundledQuery),readTime:Ei(i.readTime)}}(r)})}saveNamedQuery(e,t){return $g(e).put(function(s){return{name:s.name,readTime:Ii(Bt(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function Bg(n){return en(n,"bundles")}function $g(n){return en(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new Kc(e,r)}getOverlay(e,t){return _a(e).get(Fg(this.userId,t)).next(r=>r?Kd(this.serializer,r):null)}getOverlays(e,t){const r=gr();return N.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new kf(t,o);s.push(this.ht(e,a))}),N.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(bn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(_a(e).j("collectionPathOverlayIndex",a))}),N.waitFor(i)}getOverlaysForCollection(e,t,r){const s=gr(),i=bn(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return _a(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=Kd(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=gr();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return _a(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,d)=>{const f=Kd(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>i)}ht(e,t){return _a(e).put(function(s,i,o){const[a,l,c]=Fg(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:cl(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function _a(n){return en(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gP{Pt(e){return en(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?Vt.fromUint8Array(r):Vt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(bt(e.integerValue));else if("doubleValue"in e){const r=bt(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),sl(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=qr(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(zr(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?Wy(e)?this.dt(t,Number.MAX_SAFE_INTEGER):jc(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):ge()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(bt(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),pe.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}ai.vt=new ai;function _P(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function jg(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=_P(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class vP{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=jg(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=jg(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class yP{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class wP{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class va{constructor(){this.jt=new vP,this.Ht=new yP(this.jt),this.Jt=new wP(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class li{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new li(this.indexId,this.documentKey,this.arrayValue,r)}}function cs(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=qg(n.arrayValue,e.arrayValue),t!==0?t:(t=qg(n.directionalValue,e.directionalValue),t!==0?t:pe.comparator(n.documentKey,e.documentKey)))}function qg(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zg{constructor(e){this.Xt=new lt((t,r)=>It.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(ye(e.collectionGroup===this.collectionId),this.nn)return!1;const t=xh(e);if(t!==void 0&&!this.sn(t))return!1;const r=si(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new lt(It.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new pi(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new pi(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new pi(r.field,r.dir==="asc"?0:1)));return new Eo(Eo.UNKNOWN_ID,this.collectionId,t,To.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $0(n){var e,t;if(ye(n instanceof He||n instanceof ot),n instanceof He){if(n instanceof r0){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>He.create(n.field,"==",i)))||[];return ot.create(s,"or")}return n}const r=n.filters.map(s=>$0(s));return ot.create(r,n.op)}function bP(n){if(n.getFilters().length===0)return[];const e=Bh($0(n));return ye(j0(e)),Fh(e)||Uh(e)?[e]:e.getFilters()}function Fh(n){return n instanceof He}function Uh(n){return n instanceof ot&&Tf(n)}function j0(n){return Fh(n)||Uh(n)||function(t){if(t instanceof ot&&Ch(t)){for(const r of t.getFilters())if(!Fh(r)&&!Uh(r))return!1;return!0}return!1}(n)}function Bh(n){if(ye(n instanceof He||n instanceof ot),n instanceof He)return n;if(n.filters.length===1)return Bh(n.filters[0]);const e=n.filters.map(r=>Bh(r));let t=ot.create(e,n.op);return t=lc(t),j0(t)?t:(ye(t instanceof ot),ye(xo(t)),ye(t.filters.length>1),t.filters.reduce((r,s)=>Of(r,s)))}function Of(n,e){let t;return ye(n instanceof He||n instanceof ot),ye(e instanceof He||e instanceof ot),t=n instanceof He?e instanceof He?function(s,i){return ot.create([s,i],"and")}(n,e):Gg(n,e):e instanceof He?Gg(e,n):function(s,i){if(ye(s.filters.length>0&&i.filters.length>0),xo(s)&&xo(i))return e0(s,i.getFilters());const o=Ch(s)?s:i,a=Ch(s)?i:s,l=o.filters.map(c=>Of(c,a));return ot.create(l,"or")}(n,e),lc(t)}function Gg(n,e){if(xo(e))return e0(e,n.getFilters());{const t=e.filters.map(r=>Of(n,r));return ot.create(t,"or")}}function lc(n){if(ye(n instanceof He||n instanceof ot),n instanceof He)return n;const e=n.getFilters();if(e.length===1)return lc(e[0]);if(Xy(n))return n;const t=e.map(s=>lc(s)),r=[];return t.forEach(s=>{s instanceof He?r.push(s):s instanceof ot&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:ot.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IP{constructor(){this.un=new Mf}addToCollectionParentIndex(e,t){return this.un.add(t),N.resolve()}getCollectionParents(e,t){return N.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return N.resolve()}deleteFieldIndex(e,t){return N.resolve()}deleteAllFieldIndexes(e){return N.resolve()}createTargetIndexes(e,t){return N.resolve()}getDocumentsMatchingTarget(e,t){return N.resolve(null)}getIndexType(e,t){return N.resolve(0)}getFieldIndexes(e,t){return N.resolve([])}getNextCollectionGroupToUpdate(e){return N.resolve(null)}getMinOffset(e,t){return N.resolve(Gn.min())}getMinOffsetFromCollectionGroup(e,t){return N.resolve(Gn.min())}updateCollectionGroup(e,t,r){return N.resolve()}updateIndexEntries(e,t){return N.resolve()}}class Mf{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new lt(Ke.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new lt(Ke.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wu=new Uint8Array(0);class EP{constructor(e,t){this.databaseId=t,this.cn=new Mf,this.ln=new Yr(r=>yi(r),(r,s)=>Sl(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:bn(s)};return Kg(e).put(i)}return N.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[Ny(t),""],!1,!0);return Kg(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(mr(o.parent))}return r})}addFieldIndex(e,t){const r=ya(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Wi(e);return i.next(a=>{o.put(Ug(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=ya(e),s=Wi(e),i=Hi(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=ya(e),r=Hi(e),s=Wi(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return N.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new zg(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Hi(e);let s=!0;const i=new Map;return N.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Ue();const a=[];return N.forEach(i,(l,c)=>{J("IndexedDbIndexManager",`Using index ${function($){return`id=${$.indexId}|cg=${$.collectionGroup}|f=${$.fields.map(j=>`${j.fieldPath}:${j.kind}`).join(",")}`}(l)} to execute ${yi(t)}`);const d=function($,j){const O=xh(j);if(O===void 0)return null;for(const se of sc($,O.fieldPath))switch(se.op){case"array-contains-any":return se.value.arrayValue.values||[];case"array-contains":return[se.value]}return null}(c,l),f=function($,j){const O=new Map;for(const se of si(j))for(const T of sc($,se.fieldPath))switch(T.op){case"==":case"in":O.set(se.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return O.set(se.fieldPath.canonicalString(),T.value),Array.from(O.values())}return null}(c,l),g=function($,j){const O=[];let se=!0;for(const T of si(j)){const w=T.kind===0?Tg($,T.fieldPath,$.startAt):Ag($,T.fieldPath,$.startAt);O.push(w.value),se&&(se=w.inclusive)}return new Os(O,se)}(c,l),_=function($,j){const O=[];let se=!0;for(const T of si(j)){const w=T.kind===0?Ag($,T.fieldPath,$.endAt):Tg($,T.fieldPath,$.endAt);O.push(w.value),se&&(se=w.inclusive)}return new Os(O,se)}(c,l),C=this.In(l,c,g),x=this.In(l,c,_),R=this.Tn(l,c,f),L=this.En(l.indexId,d,C,g.inclusive,x,_.inclusive,R);return N.forEach(L,B=>r.G(B,t.limit).next($=>{$.forEach(j=>{const O=pe.fromSegments(j.documentKey);o.has(O)||(o=o.add(O),a.push(O))})}))}).next(()=>a)}return N.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=bP(ot.create(e.filters,"and")).map(r=>Dh(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),d=[];for(let f=0;f<l;++f){const g=t?this.dn(t[f/c]):wu,_=this.An(e,g,r[f%c],s),C=this.Rn(e,g,i[f%c],o),x=a.map(R=>this.An(e,g,R,!0));d.push(...this.createRange(_,C,x))}return d}An(e,t,r,s){const i=new li(e,pe.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new li(e,pe.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new zg(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return N.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new lt(It.comparator),d=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?d=!0:c=c.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(d?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new va;for(const s of si(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);ai.vt.It(i,o)}return r.zt()}dn(e){const t=new va;return ai.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new va;return ai.vt.It(vi(this.databaseId,t),r.Yt(function(i){const o=si(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new va);let i=0;for(const o of si(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&al(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);ai.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new va;l.seed(a.zt()),ai.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof He&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=ya(e),s=Wi(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return N.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(d,f){const g=f?new To(f.sequenceNumber,new Gn(Ei(f.readTime),new pe(mr(f.documentKey)),f.largestBatchId)):To.empty(),_=d.fields.map(([C,x])=>new pi(It.fromServerFormat(C),x));return new Eo(d.indexId,d.collectionGroup,_,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Ce(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=ya(e),i=Wi(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>N.forEach(a,l=>i.put(Ug(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return N.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?N.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),N.forEach(a,l=>this.wn(e,s,l).next(c=>{const d=this.Sn(i,l);return c.isEqual(d)?N.resolve():this.bn(e,i,l,c,d)}))))})}Dn(e,t,r,s){return Hi(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return Hi(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=Hi(e);let i=new lt(cs);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new li(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new lt(cs);const s=this.Vn(t,e);if(s==null)return r;const i=xh(t);if(i!=null){const o=e.data.field(i.fieldPath);if(al(o))for(const a of o.arrayValue.values||[])r=r.add(new li(t.indexId,e.key,this.dn(a),s))}else r=r.add(new li(t.indexId,e.key,wu,s));return r}bn(e,t,r,s,i){J("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,d,f,g){const _=l.getIterator(),C=c.getIterator();let x=Ki(_),R=Ki(C);for(;x||R;){let L=!1,B=!1;if(x&&R){const $=d(x,R);$<0?B=!0:$>0&&(L=!0)}else x!=null?B=!0:L=!0;L?(f(R),R=Ki(C)):B?(g(x),x=Ki(_)):(x=Ki(_),R=Ki(C))}}(s,i,cs,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),N.waitFor(o)}yn(e){let t=1;return Wi(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>cs(o,a)).filter((o,a,l)=>!a||cs(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=cs(o,e),l=cs(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,wu,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,wu,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return cs(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Hg)}getMinOffset(e,t){return N.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||ge())).next(Hg)}}function Kg(n){return en(n,"collectionParents")}function Hi(n){return en(n,"indexEntries")}function ya(n){return en(n,"indexConfiguration")}function Wi(n){return en(n,"indexState")}function Hg(n){ye(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;bf(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Gn(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wg={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class _n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new _n(e,_n.DEFAULT_COLLECTION_PERCENTILE,_n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q0(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(d,f,g)=>(a++,g.delete()));i.push(l.next(()=>{ye(a===1)}));const c=[];for(const d of t.mutations){const f=$y(e,d.key.path,t.batchId);i.push(s.delete(f)),c.push(d.key)}return N.waitFor(i).next(()=>c)}function uc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw ge();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_n.DEFAULT_COLLECTION_PERCENTILE=10,_n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,_n.DEFAULT=new _n(41943040,_n.DEFAULT_COLLECTION_PERCENTILE,_n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),_n.DISABLED=new _n(-1,0,0);class Hc{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){ye(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new Hc(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ds(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=no(e),o=ds(e);return o.add({}).next(a=>{ye(typeof a=="number");const l=new Rf(a,t,r,s),c=function(_,C,x){const R=x.baseMutations.map(B=>cl(_.ct,B)),L=x.mutations.map(B=>cl(_.ct,B));return{userId:C,batchId:x.batchId,localWriteTimeMs:x.localWriteTime.toMillis(),baseMutations:R,mutations:L}}(this.serializer,this.userId,l),d=[];let f=new lt((g,_)=>Ce(g.canonicalString(),_.canonicalString()));for(const g of s){const _=$y(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),d.push(o.put(c)),d.push(i.put(_,dS))}return f.forEach(g=>{d.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),N.waitFor(d).next(()=>l)})}lookupMutationBatch(e,t){return ds(e).get(t).next(r=>r?(ye(r.userId===this.userId),oi(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?N.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ds(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(ye(a.batchId>=r),i=oi(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ds(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ds(e).U("userMutationsIndex",t).next(r=>r.map(s=>oi(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Vu(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return no(e).J({range:s},(o,a,l)=>{const[c,d,f]=o,g=mr(d);if(c===this.userId&&t.path.isEqual(g))return ds(e).get(f).next(_=>{if(!_)throw ge();ye(_.userId===this.userId),i.push(oi(this.serializer,_))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new lt(Ce);const s=[];return t.forEach(i=>{const o=Vu(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=no(e).J({range:a},(c,d,f)=>{const[g,_,C]=c,x=mr(_);g===this.userId&&i.path.isEqual(x)?r=r.add(C):f.done()});s.push(l)}),N.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Vu(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new lt(Ce);return no(e).J({range:o},(l,c,d)=>{const[f,g,_]=l,C=mr(g);f===this.userId&&r.isPrefixOf(C)?C.length===s&&(a=a.add(_)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ds(e).get(i).next(o=>{if(o===null)throw ge();ye(o.userId===this.userId),r.push(oi(this.serializer,o))}))}),N.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return q0(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),N.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return N.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return no(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=mr(i[1]);s.push(l)}else a.done()}).next(()=>{ye(s.length===0)})})}containsKey(e,t){return z0(e,this.userId,t)}Nn(e){return G0(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function z0(n,e,t){const r=Vu(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return no(n).J({range:i,H:!0},(a,l,c)=>{const[d,f,g]=a;d===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function ds(n){return en(n,"mutations")}function no(n){return en(n,"documentMutations")}function G0(n){return en(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ti{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Ti(0)}static kn(){return new Ti(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TP{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new Ti(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Ae.fromTimestamp(new Pt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Qi(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(ye(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Qi(e).J((o,a)=>{const l=ka(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>N.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Qi(e).J((r,s)=>{const i=ka(s);t(i)})}qn(e){return Qg(e).get("targetGlobalKey").next(t=>(ye(t!==null),t))}Qn(e,t){return Qg(e).put("targetGlobalKey",t)}Kn(e,t){return Qi(e).put(B0(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=yi(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Qi(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=ka(a);Sl(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=vs(e);return t.forEach(o=>{const a=bn(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),N.waitFor(s)}removeMatchingKeys(e,t,r){const s=vs(e);return N.forEach(t,i=>{const o=bn(i.path);return N.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=vs(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=vs(e);let i=Ue();return s.J({range:r,H:!0},(o,a,l)=>{const c=mr(o[1]),d=new pe(c);i=i.add(d)}).next(()=>i)}containsKey(e,t){const r=bn(t.path),s=IDBKeyRange.bound([r],[Ny(r)],!1,!0);let i=0;return vs(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return Qi(e).get(t).next(r=>r?ka(r):null)}}function Qi(n){return en(n,"targets")}function Qg(n){return en(n,"targetGlobal")}function vs(n){return en(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jg([n,e],[t,r]){const s=Ce(n,t);return s===0?Ce(e,r):s}class AP{constructor(e){this.Un=e,this.buffer=new lt(Jg),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Jg(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class K0{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){J("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){js(t)?J("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await $s(t)}await this.Hn(3e5)})}}class xP{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return N.resolve(Mn.oe);const r=new AP(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(J("LruGarbageCollector","Garbage collection skipped; disabled"),N.resolve(Wg)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(J("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Wg):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(J("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),Zi()<=Ge.DEBUG&&J("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-d}ms`),N.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function H0(n,e){return new xP(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SP{constructor(e,t){this.db=e,this.garbageCollector=H0(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return bu(e,r)}removeReference(e,t,r){return bu(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return bu(e,t)}nr(e,t){return function(s,i){let o=!1;return G0(s).Y(a=>z0(s,a,i).next(l=>(l&&(o=!0),N.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Ae.min()),vs(e).delete(function(f){return[0,bn(f.path)]}(o))))});s.push(l)}}).next(()=>N.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return bu(e,t)}tr(e,t){const r=vs(e);let s,i=Mn.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==Mn.oe&&t(new pe(mr(s)),i),i=c,s=l):i=Mn.oe}).next(()=>{i!==Mn.oe&&t(new pe(mr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function bu(n,e){return vs(n).put(function(r,s){return{targetId:0,path:bn(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W0{constructor(){this.changes=new Yr(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,_t.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?N.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return ti(e).put(r)}removeEntry(e,t,r){return ti(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],ac(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=_t.newInvalidDocument(t);return ti(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(wa(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:_t.newInvalidDocument(t)};return ti(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(wa(t))},(s,i)=>{r={document:this.ir(t,i),size:uc(i)}}).next(()=>r)}getEntries(e,t){let r=Fn();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=Fn(),s=new mt(pe.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,uc(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return N.resolve();let s=new lt(Zg);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(wa(s.first()),wa(s.last())),o=s.getIterator();let a=o.getNext();return ti(e).J({index:"documentKeyIndex",range:i},(l,c,d)=>{const f=pe.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&Zg(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?d.$(wa(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),ac(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ti(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let d=Fn();for(const f of c){const g=this.ir(pe.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(Rl(t,g)||s.has(g.key))&&(d=d.insert(g.key,g))}return d})}getAllFromCollectionGroup(e,t,r,s){let i=Fn();const o=Xg(t,r),a=Xg(t,Gn.max());return ti(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,d)=>{const f=this.ir(pe.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&d.done()}).next(()=>i)}newChangeBuffer(e){return new RP(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Yg(e).get("remoteDocumentGlobalKey").next(t=>(ye(!!t),t))}rr(e,t){return Yg(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=pP(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Ae.min())))return r}return _t.newInvalidDocument(e)}}function Q0(n){return new PP(n)}class RP extends W0{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Yr(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new lt((i,o)=>Ce(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=Lg(this.cr.serializer,o);s=s.add(i.path.popLast());const c=uc(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=Lg(this.cr.serializer,o.convertToNoDocument(Ae.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),N.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function Yg(n){return en(n,"remoteDocumentGlobal")}function ti(n){return en(n,"remoteDocumentsV14")}function wa(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Xg(n,e){const t=e.documentKey.path.toArray();return[n,ac(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Zg(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Ce(t[i],r[i]),s)return s;return s=Ce(t.length,r.length),s||(s=Ce(t[t.length-2],r[r.length-2]),s||Ce(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CP{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J0{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Ga(r.mutation,s,Ln.empty(),Pt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Ue()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Ue()){const s=gr();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Ra();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=gr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Ue()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Fn();const o=za(),a=function(){return za()}();return t.forEach((l,c)=>{const d=r.get(c.key);s.has(c.key)&&(d===void 0||d.mutation instanceof Xr)?i=i.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),Ga(d.mutation,c,d.mutation.getFieldMask(),Pt.now())):o.set(c.key,Ln.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var f;return a.set(c,new CP(d,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=za();let s=new mt((o,a)=>o-a),i=Ue();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let d=r.get(l)||Ln.empty();d=a.applyToLocalView(c,d),r.set(l,d);const f=(s.get(a.batchId)||Ue()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,d=l.value,f=h0();d.forEach(g=>{if(!i.has(g)){const _=y0(t.get(g),r.get(g));_!==null&&f.set(g,_),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return N.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return pe.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Af(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):N.resolve(gr());let a=-1,l=i;return o.next(c=>N.forEach(c,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(d)?N.resolve():this.remoteDocumentCache.getEntry(e,d).next(g=>{l=l.insert(d,g)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,Ue())).next(d=>({batchId:a,changes:d0(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new pe(t)).next(r=>{let s=Ra();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Ra();return this.indexManager.getCollectionParents(e,i).next(a=>N.forEach(a,l=>{const c=function(f,g){return new Jr(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(d=>{d.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const d=c.getKey();o.get(d)===null&&(o=o.insert(d,_t.newInvalidDocument(d)))});let a=Ra();return o.forEach((l,c)=>{const d=i.get(l);d!==void 0&&Ga(d.mutation,c,Ln.empty(),Pt.now()),Rl(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kP{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return N.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Bt(s.createTime)}}(t)),N.resolve()}getNamedQuery(e,t){return N.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Nf(s.bundledQuery),readTime:Bt(s.readTime)}}(t)),N.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DP{constructor(){this.overlays=new mt(pe.comparator),this.Ir=new Map}getOverlay(e,t){return N.resolve(this.overlays.get(t))}getOverlays(e,t){const r=gr();return N.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),N.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),N.resolve()}getOverlaysForCollection(e,t,r){const s=gr(),i=t.length+1,o=new pe(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return N.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new mt((c,d)=>c-d);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let d=i.get(c.largestBatchId);d===null&&(d=gr(),i=i.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}const a=gr(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=s)););return N.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new kf(t,r));let i=this.Ir.get(t);i===void 0&&(i=Ue(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VP{constructor(){this.sessionToken=Vt.EMPTY_BYTE_STRING}getSessionToken(e){return N.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,N.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lf{constructor(){this.Tr=new lt(tn.Er),this.dr=new lt(tn.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new tn(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new tn(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new pe(new Ke([])),r=new tn(t,e),s=new tn(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new pe(new Ke([])),r=new tn(t,e),s=new tn(t,e+1);let i=Ue();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new tn(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class tn{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return pe.comparator(e.key,t.key)||Ce(e.wr,t.wr)}static Ar(e,t){return Ce(e.wr,t.wr)||pe.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NP{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new lt(tn.Er)}checkEmpty(e){return N.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Rf(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new tn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return N.resolve(o)}lookupMutationBatch(e,t){return N.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return N.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return N.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return N.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new tn(t,0),s=new tn(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),N.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new lt(Ce);return t.forEach(s=>{const i=new tn(s,0),o=new tn(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),N.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;pe.isDocumentKey(i)||(i=i.child(""));const o=new tn(new pe(i),0);let a=new lt(Ce);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),N.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){ye(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return N.forEach(t.mutations,s=>{const i=new tn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new tn(t,0),s=this.br.firstAfterOrEqual(r);return N.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,N.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OP{constructor(e){this.Mr=e,this.docs=function(){return new mt(pe.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return N.resolve(r?r.document.mutableCopy():_t.newInvalidDocument(t))}getEntries(e,t){let r=Fn();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():_t.newInvalidDocument(s))}),N.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Fn();const o=t.path,a=new pe(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:d}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||bf(My(d),r)<=0||(s.has(d.key)||Rl(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return N.resolve(i)}getAllFromCollectionGroup(e,t,r,s){ge()}Or(e,t){return N.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new MP(this)}getSize(e){return N.resolve(this.size)}}class MP extends W0{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),N.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LP{constructor(e){this.persistence=e,this.Nr=new Yr(t=>yi(t),Sl),this.lastRemoteSnapshotVersion=Ae.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Lf,this.targetCount=0,this.kr=Ti.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),N.resolve()}getLastRemoteSnapshotVersion(e){return N.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return N.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),N.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),N.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Ti(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,N.resolve()}updateTargetData(e,t){return this.Kn(t),N.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,N.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),N.waitFor(i).next(()=>s)}getTargetCount(e){return N.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return N.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),N.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),N.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),N.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return N.resolve(r)}containsKey(e,t){return N.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Mn(0),this.Kr=!1,this.Kr=!0,this.$r=new VP,this.referenceDelegate=e(this),this.Ur=new LP(this),this.indexManager=new IP,this.remoteDocumentCache=function(s){return new OP(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new U0(t),this.Gr=new kP(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new DP,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new NP(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){J("MemoryPersistence","Starting transaction:",e);const s=new FP(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return N.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class FP extends Fy{constructor(e){super(),this.currentSequenceNumber=e}}class Wc{constructor(e){this.persistence=e,this.Jr=new Lf,this.Yr=null}static Zr(e){return new Wc(e)}get Xr(){if(this.Yr)return this.Yr;throw ge()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),N.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),N.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),N.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return N.forEach(this.Xr,r=>{const s=pe.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Ae.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return N.or([()=>N.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class cc{constructor(e,t){this.persistence=e,this.ti=new Yr(r=>bn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=H0(this,t)}static Zr(e,t){return new cc(e,t)}zr(){}jr(e){return N.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return N.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?N.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Ae.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),N.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),N.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),N.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),N.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ou(e.data.value)),t}nr(e,t,r){return N.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return N.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UP{constructor(e){this.serializer=e}O(e,t,r,s){const i=new Uc("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",fg,{unique:!0}),l.createObjectStore("documentMutations")}(e),e_(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=N.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),e_(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Ae.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(d=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",fg,{unique:!0});const f=c.store("mutations"),g=d.map(_=>f.put(_));return N.waitFor(g)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:ES});c.createIndex("collectionPathOverlayIndex",TS,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",AS,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:hS});c.createIndex("documentKeyIndex",fS),c.createIndex("collectionGroupIndex",pS)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:yS}).createIndex("sequenceNumberIndex",wS,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:bS}).createIndex("documentKeyIndex",IS,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=uc(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>N.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>N.forEach(a,l=>{ye(l.userId===i.userId);const c=oi(this.serializer,l);return q0(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new Ke(o),c=function(f){return[0,bn(f)]}(l);i.push(t.get(c).next(d=>d?N.resolve():(f=>t.put({targetId:0,path:bn(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>N.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:vS});const r=t.store("collectionParents"),s=new Mf,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:bn(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new Ke(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const d=mr(a);return i(d.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=ka(s),o=B0(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new pe(Ke.fromString(f.document.name).popFirst(5)):f.noDocument?pe.fromSegments(f.noDocument.path):f.unknownDocument?pe.fromSegments(f.unknownDocument.path):ge()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>N.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=Q0(this.serializer),i=new Ff(Wc.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let d=(c=a.get(l.userId))!==null&&c!==void 0?c:Ue();oi(this.serializer,l).keys().forEach(f=>d=d.add(f)),a.set(l.userId,d)}),N.forEach(a,(l,c)=>{const d=new nn(c),f=Kc.lt(this.serializer,d),g=i.getIndexManager(d),_=Hc.lt(d,this.serializer,g,i.referenceDelegate);return new J0(s,_,f,g).recalculateAndSaveOverlaysForDocumentKeys(new Sh(t,Mn.oe),l).next()})})}}function e_(n){n.createObjectStore("targetDocuments",{keyPath:gS}).createIndex("documentTargetsIndex",_S,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",mS,{unique:!0}),n.createObjectStore("targetGlobal")}const Hd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Uf{constructor(e,t,r,s,i,o,a,l,c,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!Uf.D())throw new Y(F.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new SP(this,s),this.Ai=t+"main",this.serializer=new U0(l),this.Ri=new vr(this.Ai,this.hi,new UP(this.serializer)),this.$r=new gP,this.Ur=new TP(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Q0(this.serializer),this.Gr=new mP,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&Lt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Y(F.FAILED_PRECONDITION,Hd);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Mn(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Iu(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(js(e))return J("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return J("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return ba(e).get("owner").next(t=>N.resolve(this.vi(t)))}Ci(e){return Iu(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=en(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return N.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?N.resolve(!0):ba(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new Y(F.FAILED_PRECONDITION,Hd);return!1}}return!(!this.networkEnabled||!this.inForeground)||Iu(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&J("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Sh(e,Mn.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Iu(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Hc.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new EP(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Kc.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){J("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?PS:l===16?SS:l===15?Ef:l===14?zy:l===13?qy:l===12?xS:l===11?jy:void ge()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new Sh(a,this.Qr?this.Qr.next():Mn.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw Lt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new Y(F.FAILED_PRECONDITION,Ly);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return ba(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Y(F.FAILED_PRECONDITION,Hd)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ba(e).put("owner",t)}static D(){return vr.D()}bi(e){const t=ba(e);return t.get("owner").next(r=>this.vi(r)?(J("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):N.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Lt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;_y()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return J("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Lt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Lt("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function ba(n){return en(n,"owner")}function Iu(n){return en(n,"clientMetadata")}function Bf(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $f{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=Ue(),s=Ue();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new $f(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BP{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y0{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return _y()?8:Uy(Zt())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new BP;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(Zi()<=Ge.DEBUG&&J("QueryEngine","SDK will not create cache indexes for query:",eo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),N.resolve()):(Zi()<=Ge.DEBUG&&J("QueryEngine","Query:",eo(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Zi()<=Ge.DEBUG&&J("QueryEngine","The SDK decides to create cache indexes for query:",eo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,In(t))):N.resolve())}Yi(e,t){if(xg(t))return N.resolve(null);let r=In(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=ic(t,null,"F"),r=In(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Ue(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,ic(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return xg(t)||s.isEqual(Ae.min())?N.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?N.resolve(null):(Zi()<=Ge.DEBUG&&J("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),eo(t)),this.rs(e,o,t,Oy(s,-1)).next(a=>a))})}ts(e,t){let r=new lt(u0(e));return t.forEach((s,i)=>{Rl(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return Zi()<=Ge.DEBUG&&J("QueryEngine","Using full collection scan to execute query:",eo(t)),this.Ji.getDocumentsMatchingQuery(e,t,Gn.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $P{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new mt(Ce),this._s=new Yr(i=>yi(i),Sl),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new J0(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function X0(n,e,t,r){return new $P(n,e,t,r)}async function Z0(n,e){const t=le(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=Ue();for(const c of s){o.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}for(const c of i){a.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function jP(n,e){const t=le(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,d){const f=c.batch,g=f.keys();let _=N.resolve();return g.forEach(C=>{_=_.next(()=>d.getEntry(l,C)).next(x=>{const R=c.docVersions.get(C);ye(R!==null),x.version.compareTo(R)<0&&(f.applyToRemoteDocument(x,c),x.isValidDocument()&&(x.setReadTime(c.commitVersion),d.addEntry(x)))})}),_.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=Ue();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function ew(n){const e=le(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function qP(n,e){const t=le(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((d,f)=>{const g=s.get(f);if(!g)return;a.push(t.Ur.removeMatchingKeys(i,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,d.addedDocuments,f)));let _=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?_=_.withResumeToken(Vt.EMPTY_BYTE_STRING,Ae.min()).withLastLimboFreeSnapshotVersion(Ae.min()):d.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(d.resumeToken,r)),s=s.insert(f,_),function(x,R,L){return x.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=3e8?!0:L.addedDocuments.size+L.modifiedDocuments.size+L.removedDocuments.size>0}(g,_,d)&&a.push(t.Ur.updateTargetData(i,_))});let l=Fn(),c=Ue();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),a.push(tw(i,o,e.documentUpdates).next(d=>{l=d.Ps,c=d.Is})),!r.isEqual(Ae.min())){const d=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(d)}return N.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function tw(n,e,t){let r=Ue(),s=Ue();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Fn();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(Ae.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):J("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function zP(n,e){const t=le(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Co(n,e){const t=le(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,N.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new Nr(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function ko(n,e,t){const r=le(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!js(o))throw o;J("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function dc(n,e,t){const r=le(n);let s=Ae.min(),i=Ue();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,d){const f=le(l),g=f._s.get(d);return g!==void 0?N.resolve(f.os.get(g)):f.Ur.getTargetData(c,d)}(r,o,In(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:Ae.min(),t?i:Ue())).next(a=>(sw(r,l0(e),a),{documents:a,Ts:i})))}function nw(n,e){const t=le(n),r=le(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function rw(n,e){const t=le(n),r=t.us.get(e)||Ae.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,Oy(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(sw(t,e,s),s))}function sw(n,e,t){let r=n.us.get(e)||Ae.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function GP(n,e,t,r){const s=le(n);let i=Ue(),o=Fn();for(const c of t){const d=e.Es(c.metadata.name);c.document&&(i=i.add(d));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(d,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await Co(s,function(d){return In($o(Ke.fromString(`__bundle__/docs/${d}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>tw(c,a,o).next(d=>(a.apply(c),d)).next(d=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,d.Ps,d.Is)).next(()=>d.Ps)))}async function KP(n,e,t=Ue()){const r=await Co(n,In(Nf(e.bundledQuery))),s=le(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=Bt(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(Vt.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function t_(n,e){return`firestore_clients_${n}_${e}`}function n_(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Wd(n,e){return`firestore_targets_${n}_${e}`}class hc{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new Y(s.error.code,s.error.message))),o?new hc(e,t,s.state,i):(Lt("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ka{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new Y(r.error.code,r.error.message))),i?new Ka(e,r.state,s):(Lt("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class fc{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=xf();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=By(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new fc(e,i):(Lt("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class jf{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new jf(t.clientId,t.onlineState):(Lt("SharedClientState",`Failed to parse online state: ${e}`),null)}}class $h{constructor(){this.activeTargetIds=xf()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Qd{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new mt(Ce),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=t_(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new $h),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(t_(this.persistenceKey,r));if(s){const i=fc.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Wd(this.persistenceKey,e));if(s){const i=Ka.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Wd(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return J("SharedClientState","READ",e,t),t}setItem(e,t){J("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){J("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(J("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Lt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=Mn.oe;if(i!=null)try{const a=JSON.parse(i);ye(typeof a=="number"),o=a}catch(a){Lt("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Mn.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new hc(this.currentUser,e,t,r),i=n_(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=n_(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Wd(this.persistenceKey,e),i=new Ka(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return fc.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return hc.Rs(new nn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return Ka.Rs(s,t)}Ls(e){return jf.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);J("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=xf();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class iw{constructor(){this.so=new $h,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new $h,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HP{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r_{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){J("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){J("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Eu=null;function Jd(){return Eu===null?Eu=function(){return 268435456+Math.round(2147483648*Math.random())}():Eu++,"0x"+Eu.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WP={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QP{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gn="WebChannelConnection";class JP extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=Jd(),l=this.xo(t,r.toUriEncodedString());J("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(d=>(J("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw Qn("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",l,"request:",s),d})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Bo}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=WP[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Jd();return new Promise((o,a)=>{const l=new xy;l.setWithCredentials(!0),l.listenOnce(Sy.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Du.NO_ERROR:const d=l.getResponseJson();J(gn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(d)),o(d);break;case Du.TIMEOUT:J(gn,`RPC '${e}' ${i} timed out`),a(new Y(F.DEADLINE_EXCEEDED,"Request time out"));break;case Du.HTTP_ERROR:const f=l.getStatus();if(J(gn,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const _=g==null?void 0:g.error;if(_&&_.status&&_.message){const C=function(R){const L=R.toLowerCase().replace(/_/g,"-");return Object.values(F).indexOf(L)>=0?L:F.UNKNOWN}(_.status);a(new Y(C,_.message))}else a(new Y(F.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new Y(F.UNAVAILABLE,"Connection failed."));break;default:ge()}}finally{J(gn,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);J(gn,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=Jd(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Cy(),a=Ry(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=i.join("");J(gn,`Creating RPC '${e}' stream ${s}: ${d}`,l);const f=o.createWebChannel(d,l);let g=!1,_=!1;const C=new QP({Io:R=>{_?J(gn,`Not sending because RPC '${e}' stream ${s} is closed:`,R):(g||(J(gn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),J(gn,`RPC '${e}' stream ${s} sending:`,R),f.send(R))},To:()=>f.close()}),x=(R,L,B)=>{R.listen(L,$=>{try{B($)}catch(j){setTimeout(()=>{throw j},0)}})};return x(f,Pa.EventType.OPEN,()=>{_||(J(gn,`RPC '${e}' stream ${s} transport opened.`),C.yo())}),x(f,Pa.EventType.CLOSE,()=>{_||(_=!0,J(gn,`RPC '${e}' stream ${s} transport closed`),C.So())}),x(f,Pa.EventType.ERROR,R=>{_||(_=!0,Qn(gn,`RPC '${e}' stream ${s} transport errored:`,R),C.So(new Y(F.UNAVAILABLE,"The operation could not be completed")))}),x(f,Pa.EventType.MESSAGE,R=>{var L;if(!_){const B=R.data[0];ye(!!B);const $=B,j=$.error||((L=$[0])===null||L===void 0?void 0:L.error);if(j){J(gn,`RPC '${e}' stream ${s} received error:`,j);const O=j.status;let se=function(I){const P=zt[I];if(P!==void 0)return E0(P)}(O),T=j.message;se===void 0&&(se=F.INTERNAL,T="Unknown error status: "+O+" with message "+j.message),_=!0,C.So(new Y(se,T)),f.close()}else J(gn,`RPC '${e}' stream ${s} received:`,B),C.bo(B)}}),x(a,Py.STAT_EVENT,R=>{R.stat===Ah.PROXY?J(gn,`RPC '${e}' stream ${s} detected buffering proxy`):R.stat===Ah.NOPROXY&&J(gn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{C.wo()},0),C}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ow(){return typeof window<"u"?window:null}function Uu(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vl(n){return new sP(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qf{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&J("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aw{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new qf(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===F.RESOURCE_EXHAUSTED?(Lt(t.toString()),Lt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===F.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new Y(F.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return J("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(J("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class YP extends aw{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=aP(this.serializer,e),r=function(i){if(!("targetChange"in i))return Ae.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Ae.min():o.readTime?Bt(o.readTime):Ae.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=Mh(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=rc(l)?{documents:V0(i,l)}:{query:Gc(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=S0(i,o.resumeToken);const c=Nh(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(Ae.min())>0){a.readTime=Ro(i,o.snapshotVersion.toTimestamp());const c=Nh(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=uP(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=Mh(this.serializer),t.removeTarget=e,this.a_(t)}}class XP extends aw{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return ye(!!e.streamToken),this.lastStreamToken=e.streamToken,ye(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){ye(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=lP(e.writeResults,e.commitTime),r=Bt(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=Mh(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>cl(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZP extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new Y(F.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Oh(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Y(F.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Oh(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Y(F.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class eR{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Lt(t),this.D_=!1):J("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tR{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{zs(this)&&(J("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=le(l);c.L_.add(4),await zo(c),c.q_.set("Unknown"),c.L_.delete(4),await Nl(c)}(this))})}),this.q_=new eR(r,s)}}async function Nl(n){if(zs(n))for(const e of n.B_)await e(!0)}async function zo(n){for(const e of n.B_)await e(!1)}function Qc(n,e){const t=le(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Kf(t)?Gf(t):Ko(t).r_()&&zf(t,e))}function Do(n,e){const t=le(n),r=Ko(t);t.N_.delete(e),r.r_()&&lw(t,e),t.N_.size===0&&(r.r_()?r.o_():zs(t)&&t.q_.set("Unknown"))}function zf(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ae.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ko(n).A_(e)}function lw(n,e){n.Q_.xe(e),Ko(n).R_(e)}function Gf(n){n.Q_=new eP({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Ko(n).start(),n.q_.v_()}function Kf(n){return zs(n)&&!Ko(n).n_()&&n.N_.size>0}function zs(n){return le(n).L_.size===0}function uw(n){n.Q_=void 0}async function nR(n){n.q_.set("Online")}async function rR(n){n.N_.forEach((e,t)=>{zf(n,e)})}async function sR(n,e){uw(n),Kf(n)?(n.q_.M_(e),Gf(n)):n.q_.set("Unknown")}async function iR(n,e,t){if(n.q_.set("Online"),e instanceof x0&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){J("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await pc(n,r)}else if(e instanceof Fu?n.Q_.Ke(e):e instanceof A0?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Ae.min()))try{const r=await ew(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.N_.get(c);d&&i.N_.set(c,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const d=i.N_.get(l);if(!d)return;i.N_.set(l,d.withResumeToken(Vt.EMPTY_BYTE_STRING,d.snapshotVersion)),lw(i,l);const f=new Nr(d.target,l,c,d.sequenceNumber);zf(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){J("RemoteStore","Failed to raise snapshot:",r),await pc(n,r)}}async function pc(n,e,t){if(!js(e))throw e;n.L_.add(1),await zo(n),n.q_.set("Offline"),t||(t=()=>ew(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{J("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Nl(n)})}function cw(n,e){return e().catch(t=>pc(n,t,e))}async function Go(n){const e=le(n),t=Ms(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;oR(e);)try{const s=await zP(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,aR(e,s)}catch(s){await pc(e,s)}dw(e)&&hw(e)}function oR(n){return zs(n)&&n.O_.length<10}function aR(n,e){n.O_.push(e);const t=Ms(n);t.r_()&&t.V_&&t.m_(e.mutations)}function dw(n){return zs(n)&&!Ms(n).n_()&&n.O_.length>0}function hw(n){Ms(n).start()}async function lR(n){Ms(n).p_()}async function uR(n){const e=Ms(n);for(const t of n.O_)e.m_(t.mutations)}async function cR(n,e,t){const r=n.O_.shift(),s=Cf.from(r,e,t);await cw(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Go(n)}async function dR(n,e){e&&Ms(n).V_&&await async function(r,s){if(function(o){return I0(o)&&o!==F.ABORTED}(s.code)){const i=r.O_.shift();Ms(r).s_(),await cw(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Go(r)}}(n,e),dw(n)&&hw(n)}async function s_(n,e){const t=le(n);t.asyncQueue.verifyOperationInProgress(),J("RemoteStore","RemoteStore received new credentials");const r=zs(t);t.L_.add(3),await zo(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Nl(t)}async function jh(n,e){const t=le(n);e?(t.L_.delete(2),await Nl(t)):e||(t.L_.add(2),await zo(t),t.q_.set("Unknown"))}function Ko(n){return n.K_||(n.K_=function(t,r,s){const i=le(t);return i.w_(),new YP(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:nR.bind(null,n),Ro:rR.bind(null,n),mo:sR.bind(null,n),d_:iR.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Kf(n)?Gf(n):n.q_.set("Unknown")):(await n.K_.stop(),uw(n))})),n.K_}function Ms(n){return n.U_||(n.U_=function(t,r,s){const i=le(t);return i.w_(),new XP(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:lR.bind(null,n),mo:dR.bind(null,n),f_:uR.bind(null,n),g_:cR.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await Go(n)):(await n.U_.stop(),n.O_.length>0&&(J("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new rn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Hf(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Y(F.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ho(n,e){if(Lt("AsyncQueue",`${e}: ${n}`),js(n))return new Y(F.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(e){this.comparator=e?(t,r)=>e(t,r)||pe.comparator(t.key,r.key):(t,r)=>pe.comparator(t.key,r.key),this.keyedMap=Ra(),this.sortedSet=new mt(this.comparator)}static emptySet(e){return new co(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof co)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new co;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i_{constructor(){this.W_=new mt(pe.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):ge():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Vo{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Vo(e,t,co.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Pl(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hR{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class fR{constructor(){this.queries=o_(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=le(t),i=s.queries;s.queries=o_(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new Y(F.ABORTED,"Firestore shutting down"))}}function o_(){return new Yr(n=>a0(n),Pl)}async function Wf(n,e){const t=le(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new hR,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Ho(o,`Initialization of query '${eo(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Jf(t)}async function Qf(n,e){const t=le(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function pR(n,e){const t=le(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&Jf(t)}function mR(n,e,t){const r=le(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function Jf(n){n.Y_.forEach(e=>{e.next()})}var qh,a_;(a_=qh||(qh={})).ea="default",a_.Cache="cache";class Yf{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Vo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Vo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==qh.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l_{constructor(e){this.serializer=e}Es(e){return yr(this.serializer,e)}ds(e){return e.metadata.exists?D0(this.serializer,e.document,!1):_t.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Bt(e)}}class _R{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=fw(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=Ke.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new l_(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Ue()).add(i);t.set(o,a)}}return t}async complete(){const e=await GP(this.localStore,new l_(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await KP(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function fw(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pw{constructor(e){this.key=e}}class mw{constructor(e){this.key=e}}class gw{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Ue(),this.mutatedKeys=Ue(),this.Aa=u0(e),this.Ra=new co(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new i_,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,f)=>{const g=s.get(d),_=Rl(this.query,f)?f:null,C=!!g&&this.mutatedKeys.has(g.key),x=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let R=!1;g&&_?g.data.isEqual(_.data)?C!==x&&(r.track({type:3,doc:_}),R=!0):this.ga(g,_)||(r.track({type:2,doc:_}),R=!0,(l&&this.Aa(_,l)>0||c&&this.Aa(_,c)<0)&&(a=!0)):!g&&_?(r.track({type:0,doc:_}),R=!0):g&&!_&&(r.track({type:1,doc:g}),R=!0,(l||c)&&(a=!0)),R&&(_?(o=o.add(_),i=x?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((d,f)=>function(_,C){const x=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ge()}};return x(_)-x(C)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new Vo(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new i_,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Ue(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new mw(r))}),this.da.forEach(r=>{e.has(r)||t.push(new pw(r))}),t}ba(e){this.Ta=e.Ts,this.da=Ue();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Vo.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class vR{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class yR{constructor(e){this.key=e,this.va=!1}}class wR{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Yr(a=>a0(a),Pl),this.Ma=new Map,this.xa=new Set,this.Oa=new mt(pe.comparator),this.Na=new Map,this.La=new Lf,this.Ba={},this.ka=new Map,this.qa=Ti.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function bR(n,e,t=!0){const r=Jc(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await _w(r,e,t,!0),s}async function IR(n,e){const t=Jc(n);await _w(t,e,!0,!1)}async function _w(n,e,t,r){const s=await Co(n.localStore,In(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await Xf(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&Qc(n.remoteStore,s),a}async function Xf(n,e,t,r,s){n.Ka=(f,g,_)=>async function(x,R,L,B){let $=R.view.ma(L);$.ns&&($=await dc(x.localStore,R.query,!1).then(({documents:T})=>R.view.ma(T,$)));const j=B&&B.targetChanges.get(R.targetId),O=B&&B.targetMismatches.get(R.targetId)!=null,se=R.view.applyChanges($,x.isPrimaryClient,j,O);return zh(x,R.targetId,se.wa),se.snapshot}(n,f,g,_);const i=await dc(n.localStore,e,!0),o=new gw(e,i.Ts),a=o.ma(i.documents),l=Dl.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);zh(n,t,c.wa);const d=new vR(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function ER(n,e,t){const r=le(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Pl(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await ko(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Do(r.remoteStore,s.targetId),No(r,s.targetId)}).catch($s)):(No(r,s.targetId),await ko(r.localStore,s.targetId,!0))}async function TR(n,e){const t=le(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Do(t.remoteStore,r.targetId))}async function AR(n,e,t){const r=np(n);try{const s=await function(o,a){const l=le(o),c=Pt.now(),d=a.reduce((_,C)=>_.add(C.key),Ue());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",_=>{let C=Fn(),x=Ue();return l.cs.getEntries(_,d).next(R=>{C=R,C.forEach((L,B)=>{B.isValidDocument()||(x=x.add(L))})}).next(()=>l.localDocuments.getOverlayedDocuments(_,C)).next(R=>{f=R;const L=[];for(const B of a){const $=YS(B,f.get(B.key).overlayedDocument);$!=null&&L.push(new Xr(B.key,$,Jy($.value.mapValue),Et.exists(!0)))}return l.mutationQueue.addMutationBatch(_,c,L,a)}).next(R=>{g=R;const L=R.applyToLocalDocumentSet(f,x);return l.documentOverlayCache.saveOverlays(_,R.batchId,L)})}).then(()=>({batchId:g.batchId,changes:d0(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new mt(Ce)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await Zr(r,s.changes),await Go(r.remoteStore)}catch(s){const i=Ho(s,"Failed to persist write");t.reject(i)}}async function vw(n,e){const t=le(n);try{const r=await qP(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(ye(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?ye(o.va):s.removedDocuments.size>0&&(ye(o.va),o.va=!1))}),await Zr(t,r,e)}catch(r){await $s(r)}}function u_(n,e,t){const r=le(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=le(o);l.onlineState=a;let c=!1;l.queries.forEach((d,f)=>{for(const g of f.j_)g.Z_(a)&&(c=!0)}),c&&Jf(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function xR(n,e,t){const r=le(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new mt(pe.comparator);o=o.insert(i,_t.newNoDocument(i,Ae.min()));const a=Ue().add(i),l=new kl(Ae.min(),new Map,new mt(Ce),o,a);await vw(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),tp(r)}else await ko(r.localStore,e,!1).then(()=>No(r,e,t)).catch($s)}async function SR(n,e){const t=le(n),r=e.batch.batchId;try{const s=await jP(t.localStore,e);ep(t,r,null),Zf(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Zr(t,s)}catch(s){await $s(s)}}async function PR(n,e,t){const r=le(n);try{const s=await function(o,a){const l=le(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(ye(f!==null),d=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>l.localDocuments.getDocuments(c,d))})}(r.localStore,e);ep(r,e,t),Zf(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Zr(r,s)}catch(s){await $s(s)}}async function RR(n,e){const t=le(n);zs(t.remoteStore)||J("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=le(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Ho(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function Zf(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function ep(n,e,t){const r=le(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function No(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||yw(n,r)})}function yw(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Do(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),tp(n))}function zh(n,e,t){for(const r of t)r instanceof pw?(n.La.addReference(r.key,e),CR(n,r)):r instanceof mw?(J("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||yw(n,r.key)):ge()}function CR(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(J("SyncEngine","New document in limbo: "+t),n.xa.add(r),tp(n))}function tp(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new pe(Ke.fromString(e)),r=n.qa.next();n.Na.set(r,new yR(t)),n.Oa=n.Oa.insert(t,r),Qc(n.remoteStore,new Nr(In($o(t.path)),r,"TargetPurposeLimboResolution",Mn.oe))}}async function Zr(n,e,t){const r=le(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var d;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(d=t==null?void 0:t.targetChanges.get(l.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=$f.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const d=le(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>N.forEach(c,g=>N.forEach(g.$i,_=>d.persistence.referenceDelegate.addReference(f,g.targetId,_)).next(()=>N.forEach(g.Ui,_=>d.persistence.referenceDelegate.removeReference(f,g.targetId,_)))))}catch(f){if(!js(f))throw f;J("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const g=f.targetId;if(!f.fromCache){const _=d.os.get(g),C=_.snapshotVersion,x=_.withLastLimboFreeSnapshotVersion(C);d.os=d.os.insert(g,x)}}}(r.localStore,i))}async function kR(n,e){const t=le(n);if(!t.currentUser.isEqual(e)){J("SyncEngine","User change. New user:",e.toKey());const r=await Z0(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new Y(F.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Zr(t,r.hs)}}function DR(n,e){const t=le(n),r=t.Na.get(e);if(r&&r.va)return Ue().add(r.key);{let s=Ue();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function VR(n,e){const t=le(n),r=await dc(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&zh(t,e.targetId,s.wa),s}async function NR(n,e){const t=le(n);return rw(t.localStore,e).then(r=>Zr(t,r))}async function OR(n,e,t,r){const s=le(n),i=await function(a,l){const c=le(a),d=le(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,l).next(g=>g?c.localDocuments.getDocuments(f,g):N.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Go(s.remoteStore):t==="acknowledged"||t==="rejected"?(ep(s,e,r||null),Zf(s,e),function(a,l){le(le(a).mutationQueue).On(l)}(s.localStore,e)):ge(),await Zr(s,i)):J("SyncEngine","Cannot apply mutation batch with id: "+e)}async function MR(n,e){const t=le(n);if(Jc(t),np(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await c_(t,r.toArray());t.Qa=!0,await jh(t.remoteStore,!0);for(const i of s)Qc(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(No(t,o),ko(t.localStore,o,!0))),Do(t.remoteStore,o)}),await s,await c_(t,r),function(o){const a=le(o);a.Na.forEach((l,c)=>{Do(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new mt(pe.comparator)}(t),t.Qa=!1,await jh(t.remoteStore,!1)}}async function c_(n,e,t){const r=le(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await Co(r.localStore,In(l[0]));for(const c of l){const d=r.Fa.get(c),f=await VR(r,d);f.snapshot&&i.push(f.snapshot)}}else{const c=await nw(r.localStore,o);a=await Co(r.localStore,c),await Xf(r,ww(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function ww(n){return s0(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function LR(n){return function(t){return le(le(t).persistence).Qi()}(le(n).localStore)}async function FR(n,e,t,r){const s=le(n);if(s.Qa)return void J("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await rw(s.localStore,l0(i[0])),a=kl.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Vt.EMPTY_BYTE_STRING);await Zr(s,o,a);break}case"rejected":await ko(s.localStore,e,!0),No(s,e,r);break;default:ge()}}async function UR(n,e,t){const r=Jc(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){J("SyncEngine","Adding an already active target "+s);continue}const i=await nw(r.localStore,s),o=await Co(r.localStore,i);await Xf(r,ww(i),o.targetId,!1,o.resumeToken),Qc(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await ko(r.localStore,s,!1).then(()=>{Do(r.remoteStore,s),No(r,s)}).catch($s)}}function Jc(n){const e=le(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=vw.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=DR.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=xR.bind(null,e),e.Ca.d_=pR.bind(null,e.eventManager),e.Ca.$a=mR.bind(null,e.eventManager),e}function np(n){const e=le(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=SR.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=PR.bind(null,e),e}function BR(n,e,t){const r=le(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(_,C){const x=le(_),R=Bt(C.createTime);return x.persistence.runTransaction("hasNewerBundle","readonly",L=>x.Gr.getBundleMetadata(L,C.id)).then(L=>!!L&&L.createTime.compareTo(R)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(_){return{taskState:"Success",documentsLoaded:_.totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(fw(l));const c=new _R(l,i.localStore,o.serializer);let d=await o.Ua();for(;d;){const g=await c.la(d);g&&a._updateProgress(g),d=await o.Ua()}const f=await c.complete();return await Zr(i,f.Ia,void 0),await function(_,C){const x=le(_);return x.persistence.runTransaction("Save bundle","readwrite",R=>x.Gr.saveBundleMetadata(R,C))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return Qn("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Ls{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Vl(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return X0(this.persistence,new Y0,e.initialUser,this.serializer)}Ga(e){return new Ff(Wc.Zr,this.serializer)}Wa(e){return new iw}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ls.provider={build:()=>new Ls};class $R extends Ls{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){ye(this.persistence.referenceDelegate instanceof cc);const r=this.persistence.referenceDelegate.garbageCollector;return new K0(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?_n.withCacheSize(this.cacheSizeBytes):_n.DEFAULT;return new Ff(r=>cc.Zr(r,t),this.serializer)}}class rp extends Ls{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await np(this.Ja.syncEngine),await Go(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return X0(this.persistence,new Y0,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new K0(r,e.asyncQueue,t)}Ha(e,t){const r=new uS(t,this.persistence);return new lS(e.asyncQueue,r)}Ga(e){const t=Bf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?_n.withCacheSize(this.cacheSizeBytes):_n.DEFAULT;return new Uf(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,ow(),Uu(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new iw}}class bw extends rp{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Qd&&(this.sharedClientState.syncEngine={no:OR.bind(null,t),ro:FR.bind(null,t),io:UR.bind(null,t),Qi:LR.bind(null,t),eo:NR.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await MR(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=ow();if(!Qd.D(t))throw new Y(F.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Bf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Qd(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Fs{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>u_(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=kR.bind(null,this.syncEngine),await jh(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new fR}()}createDatastore(e){const t=Vl(e.databaseInfo.databaseId),r=function(i){return new JP(i)}(e.databaseInfo);return function(i,o,a,l){return new ZP(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new tR(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>u_(this.syncEngine,t,0),function(){return r_.D()?new r_:new HP}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,d){const f=new wR(s,i,o,a,l,c);return d&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=le(s);J("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await zo(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Fs.provider={build:()=>new Fs};function d_(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yc{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Lt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jR{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new rn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new gR(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qR{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new Y(F.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=le(s),a={documents:i.map(f=>ul(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,Ke.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const g=oP(o.serializer,f);c.set(g.key.toString(),g)});const d=[];return i.forEach(f=>{const g=c.get(f.toString());ye(!!g),d.push(g)}),d}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new qo(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=pe.fromPath(r);this.mutations.push(new Pf(s,this.precondition(s)))}),await async function(r,s){const i=le(r),o={writes:s.map(a=>cl(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,Ke.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ge();t=Ae.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new Y(F.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Ae.min())?Et.exists(!1):Et.updateTime(t):Et.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Ae.min()))throw new Y(F.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Et.updateTime(t)}return Et.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zR{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new qf(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new qR(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!xl(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!I0(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GR{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=nn.UNAUTHENTICATED,this.clientId=Vy.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{J("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(J("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new rn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Ho(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Yd(n,e){n.asyncQueue.verifyOperationInProgress(),J("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await Z0(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function h_(n,e){n.asyncQueue.verifyOperationInProgress();const t=await sp(n);J("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>s_(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>s_(e.remoteStore,s)),n._onlineComponents=e}async function sp(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){J("FirestoreClient","Using user provided OfflineComponentProvider");try{await Yd(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===F.FAILED_PRECONDITION||s.code===F.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Qn("Error using user provided cache. Falling back to memory cache: "+t),await Yd(n,new Ls)}}else J("FirestoreClient","Using default OfflineComponentProvider"),await Yd(n,new Ls);return n._offlineComponents}async function Xc(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(J("FirestoreClient","Using user provided OnlineComponentProvider"),await h_(n,n._uninitializedComponentsProvider._online)):(J("FirestoreClient","Using default OnlineComponentProvider"),await h_(n,new Fs))),n._onlineComponents}function Iw(n){return sp(n).then(e=>e.persistence)}function Wo(n){return sp(n).then(e=>e.localStore)}function Ew(n){return Xc(n).then(e=>e.remoteStore)}function ip(n){return Xc(n).then(e=>e.syncEngine)}function Tw(n){return Xc(n).then(e=>e.datastore)}async function Oo(n){const e=await Xc(n),t=e.eventManager;return t.onListen=bR.bind(null,e.syncEngine),t.onUnlisten=ER.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=IR.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=TR.bind(null,e.syncEngine),t}function KR(n){return n.asyncQueue.enqueue(async()=>{const e=await Iw(n),t=await Ew(n);return e.setNetworkEnabled(!0),function(s){const i=le(s);return i.L_.delete(0),Nl(i)}(t)})}function HR(n){return n.asyncQueue.enqueue(async()=>{const e=await Iw(n),t=await Ew(n);return e.setNetworkEnabled(!1),async function(s){const i=le(s);i.L_.add(0),await zo(i),i.q_.set("Offline")}(t)})}function WR(n,e){const t=new rn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,d){const f=le(c);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,d))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new Y(F.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Ho(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Wo(n),e,t)),t.promise}function Aw(n,e,t={}){const r=new rn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new Yc({next:g=>{d.Za(),o.enqueueAndForget(()=>Qf(i,f));const _=g.docs.has(a);!_&&g.fromCache?c.reject(new Y(F.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&g.fromCache&&l&&l.source==="server"?c.reject(new Y(F.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new Yf($o(a.path),d,{includeMetadataChanges:!0,_a:!0});return Wf(i,f)}(await Oo(n),n.asyncQueue,e,t,r)),r.promise}function QR(n,e){const t=new rn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await dc(s,i,!0),l=new gw(i,a.Ts),c=l.ma(a.documents),d=l.applyChanges(c,!1);o.resolve(d.snapshot)}catch(a){const l=Ho(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Wo(n),e,t)),t.promise}function xw(n,e,t={}){const r=new rn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new Yc({next:g=>{d.Za(),o.enqueueAndForget(()=>Qf(i,f)),g.fromCache&&l.source==="server"?c.reject(new Y(F.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new Yf(a,d,{includeMetadataChanges:!0,_a:!0});return Wf(i,f)}(await Oo(n),n.asyncQueue,e,t,r)),r.promise}function JR(n,e,t){const r=new rn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await Tw(n);r.resolve(async function(o,a,l){var c;const d=le(o),{request:f,ut:g,parent:_}=N0(d.serializer,i0(a),l);d.connection.Fo||delete f.parent;const C=(await d.Lo("RunAggregationQuery",d.serializer.databaseId,_,f,1)).filter(R=>!!R.result);ye(C.length===1);const x=(c=C[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(x).reduce((R,L)=>(R[g[L]]=x[L],R),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function YR(n,e){const t=new Yc(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){le(s).Y_.add(i),i.next()}(await Oo(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){le(s).Y_.delete(i)}(await Oo(n),t))}}function XR(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?T0().encode(o):o,function(d,f){return new jR(d,f)}(function(d,f){if(d instanceof Uint8Array)return d_(d,f);if(d instanceof ArrayBuffer)return d_(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,Vl(e));n.asyncQueue.enqueueAndForget(async()=>{BR(await ip(n),s,r)})}function ZR(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=le(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await Wo(n),e))}function eC(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=le(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,g,_,C,x){f=[...f],g=[...g],f.sort(_),g.sort(_);const R=f.length,L=g.length;let B=0,$=0;for(;B<L&&$<R;){const j=_(f[$],g[B]);j<0?x(f[$++]):j>0?C(g[B++]):(B++,$++)}for(;B<L;)C(g[B++]);for(;$<R;)x(f[$++])}(c,s,sS,d=>{a.push(o.addFieldIndex(l,d))},d=>{a.push(o.deleteFieldIndex(l,d))})).next(()=>N.waitFor(a)))}(await Wo(n),e))}function tC(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){le(r).ss.zi=s}(await Wo(n),e))}function nC(n){return n.asyncQueue.enqueue(async()=>function(t){const r=le(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Wo(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sw(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f_=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function op(n,e,t){if(!t)throw new Y(F.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function rC(n,e,t,r){if(e===!0&&r===!0)throw new Y(F.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function p_(n){if(!pe.isDocumentKey(n))throw new Y(F.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function m_(n){if(pe.isDocumentKey(n))throw new Y(F.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Zc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ge()}function qe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Y(F.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Zc(n);throw new Y(F.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Pw(n,e){if(e<=0)throw new Y(F.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g_{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Y(F.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Y(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}rC("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Sw((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Y(F.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Y(F.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Y(F.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ol{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new g_({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Y(F.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Y(F.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new g_(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Jx;switch(r.type){case"firstParty":return new eS(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Y(F.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=f_.get(t);r&&(J("ComponentProvider","Removing Datastore"),f_.delete(t),r.terminate())}(this),Promise.resolve()}}function sC(n,e,t,r={}){var s;const i=(n=qe(n,Ol))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Qn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=nn.MOCK_USER;else{a=AA(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new Y(F.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new nn(c)}n._authCredentials=new Yx(new ky(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new hn(this.firestore,e,this._query)}}class $t{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new wr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new $t(this.firestore,e,this._key)}}class wr extends hn{constructor(e,t,r){super(e,t,$o(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new $t(this.firestore,null,new pe(e))}withConverter(e){return new wr(this.firestore,e,this._path)}}function st(n,e,...t){if(n=xe(n),op("collection","path",e),n instanceof Ol){const r=Ke.fromString(e,...t);return m_(r),new wr(n,null,r)}{if(!(n instanceof $t||n instanceof wr))throw new Y(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ke.fromString(e,...t));return m_(r),new wr(n.firestore,null,r)}}function wL(n,e){if(n=qe(n,Ol),op("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Y(F.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new hn(n,null,function(r){return new Jr(Ke.emptyPath(),r)}(e))}function Oe(n,e,...t){if(n=xe(n),arguments.length===1&&(e=Vy.newId()),op("doc","path",e),n instanceof Ol){const r=Ke.fromString(e,...t);return p_(r),new $t(n,null,new pe(r))}{if(!(n instanceof $t||n instanceof wr))throw new Y(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ke.fromString(e,...t));return p_(r),new $t(n.firestore,n instanceof wr?n.converter:null,new pe(r))}}function bL(n,e){return n=xe(n),e=xe(e),(n instanceof $t||n instanceof wr)&&(e instanceof $t||e instanceof wr)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Rw(n,e){return n=xe(n),e=xe(e),n instanceof hn&&e instanceof hn&&n.firestore===e.firestore&&Pl(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new qf(this,"async_queue_retry"),this.Vu=()=>{const r=Uu();r&&J("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Uu();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Uu();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new rn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!js(e))throw e;J("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Lt("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Hf.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&ge()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function Gh(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class iC{constructor(){this._progressObserver={},this._taskCompletionResolver=new rn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IL=-1;class ft extends Ol{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new __,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new __(e),this._firestoreClient=void 0,await e}}}function EL(n,e,t){t||(t="(default)");const r=Al(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(ks(i,e))return s;throw new Y(F.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new Y(F.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Y(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function oC(n,e){const t=typeof n=="object"?n:Iy(),r=typeof n=="string"?n:e||"(default)",s=Al(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=EA("firestore");i&&sC(s,...i)}return s}function Rt(n){if(n._terminated)throw new Y(F.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Cw(n),n._firestoreClient}function Cw(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,d){return new CS(a,l,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,Sw(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new GR(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function TL(n,e){Qn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return kw(n,Fs.provider,{build:r=>new rp(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function AL(n){Qn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();kw(n,Fs.provider,{build:t=>new bw(t,e.cacheSizeBytes)})}function kw(n,e,t){if((n=qe(n,ft))._firestoreClient||n._terminated)throw new Y(F.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new Y(F.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},Cw(n)}function xL(n){if(n._initialized&&!n._terminated)throw new Y(F.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new rn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!vr.D())return Promise.resolve();const s=r+"main";await vr.delete(s)}(Bf(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function SL(n){return function(t){const r=new rn;return t.asyncQueue.enqueueAndForget(async()=>RR(await ip(t),r)),r.promise}(Rt(n=qe(n,ft)))}function PL(n){return KR(Rt(n=qe(n,ft)))}function RL(n){return HR(Rt(n=qe(n,ft)))}function CL(n){return Mx(n.app,"firestore",n._databaseId.database),n._delete()}function kL(n,e){const t=Rt(n=qe(n,ft)),r=new iC;return XR(t,n._databaseId,e,r),r}function DL(n,e){return ZR(Rt(n=qe(n,ft)),e).then(t=>t?new hn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dl{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class aC{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ai{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ai(Vt.fromBase64String(e))}catch(t){throw new Y(F.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ai(Vt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pi{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Y(F.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new It(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function VL(){return new Pi("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ap{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Y(F.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Y(F.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ce(this._lat,e._lat)||Ce(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ed{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lC=/^__.*__$/;class uC{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Xr(e,this.data,this.fieldMask,t,this.fieldTransforms):new jo(e,this.data,t,this.fieldTransforms)}}class Dw{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Xr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Vw(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ge()}}class td{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new td(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return mc(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Vw(this.Cu)&&lC.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class cC{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Vl(e)}Qu(e,t,r,s=!1){return new td({Cu:e,methodName:t,qu:r,path:It.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ci(n){const e=n._freezeSettings(),t=Vl(n._databaseId);return new cC(n._databaseId,!!e.ignoreUndefinedProperties,t)}function nd(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);pp("Data must be an object, but it was:",o,r);const a=Mw(r,o);let l,c;if(i.merge)l=new Ln(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const f of i.mergeFields){const g=hl(e,f,t);if(!o.contains(g))throw new Y(F.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);Fw(d,g)||d.push(g)}l=new Ln(d),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new uC(new dn(a),l,c)}class Ml extends Ri{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ml}}function Nw(n,e,t){return new td({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class lp extends Ri{_toFieldTransform(e){return new Cl(e.path,new So)}isEqual(e){return e instanceof lp}}class up extends Ri{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=Nw(this,e,!0),r=this.Ku.map(i=>ki(i,t)),s=new wi(r);return new Cl(e.path,s)}isEqual(e){return e instanceof up&&ks(this.Ku,e.Ku)}}class cp extends Ri{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=Nw(this,e,!0),r=this.Ku.map(i=>ki(i,t)),s=new bi(r);return new Cl(e.path,s)}isEqual(e){return e instanceof cp&&ks(this.Ku,e.Ku)}}class dp extends Ri{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new Po(e.serializer,p0(e.serializer,this.$u));return new Cl(e.path,t)}isEqual(e){return e instanceof dp&&this.$u===e.$u}}function hp(n,e,t,r){const s=n.Qu(1,e,t);pp("Data must be an object, but it was:",s,r);const i=[],o=dn.empty();qs(r,(l,c)=>{const d=rd(e,l,t);c=xe(c);const f=s.Nu(d);if(c instanceof Ml)i.push(d);else{const g=ki(c,f);g!=null&&(i.push(d),o.set(d,g))}});const a=new Ln(i);return new Dw(o,a,s.fieldTransforms)}function fp(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[hl(e,r,t)],l=[s];if(i.length%2!=0)throw new Y(F.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(hl(e,i[g])),l.push(i[g+1]);const c=[],d=dn.empty();for(let g=a.length-1;g>=0;--g)if(!Fw(c,a[g])){const _=a[g];let C=l[g];C=xe(C);const x=o.Nu(_);if(C instanceof Ml)c.push(_);else{const R=ki(C,x);R!=null&&(c.push(_),d.set(_,R))}}const f=new Ln(c);return new Dw(d,f,o.fieldTransforms)}function Ow(n,e,t,r=!1){return ki(t,n.Qu(r?4:3,e))}function ki(n,e){if(Lw(n=xe(n)))return pp("Unsupported field value:",e,n),Mw(n,e);if(n instanceof Ri)return function(r,s){if(!Vw(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=ki(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=xe(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return p0(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Pt.fromDate(r);return{timestampValue:Ro(s.serializer,i)}}if(r instanceof Pt){const i=new Pt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ro(s.serializer,i)}}if(r instanceof ap)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ai)return{bytesValue:S0(s.serializer,r._byteString)};if(r instanceof $t){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Vf(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof ed)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Sf(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Zc(r)}`)}(n,e)}function Mw(n,e){const t={};return Ky(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):qs(n,(r,s)=>{const i=ki(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function Lw(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Pt||n instanceof ap||n instanceof Ai||n instanceof $t||n instanceof Ri||n instanceof ed)}function pp(n,e,t){if(!Lw(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=Zc(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function hl(n,e,t){if((e=xe(e))instanceof Pi)return e._internalPath;if(typeof e=="string")return rd(n,e);throw mc("Field path arguments must be of type string or ",n,!1,void 0,t)}const dC=new RegExp("[~\\*/\\[\\]]");function rd(n,e,t){if(e.search(dC)>=0)throw mc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Pi(...e.split("."))._internalPath}catch{throw mc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function mc(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new Y(F.INVALID_ARGUMENT,a+n+l)}function Fw(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fl{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new $t(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new hC(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(sd("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class hC extends fl{data(){return super.data()}}function sd(n,e){return typeof e=="string"?rd(n,e):e instanceof Pi?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Y(F.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class mp{}class Ll extends mp{}function Bw(n,e,...t){let r=[];e instanceof mp&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Qo).length,a=i.filter(l=>l instanceof Fl).length;if(o>1||o>0&&a>0)throw new Y(F.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Fl extends Ll{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Fl(e,t,r)}_apply(e){const t=this._parse(e);return jw(e._query,t),new hn(e.firestore,e.converter,Vh(e._query,t))}_parse(e){const t=Ci(e.firestore);return function(i,o,a,l,c,d,f){let g;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new Y(F.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){y_(f,d);const _=[];for(const C of f)_.push(v_(l,i,C));g={arrayValue:{values:_}}}else g=v_(l,i,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||y_(f,d),g=Ow(a,o,f,d==="in"||d==="not-in");return He.create(c,d,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function fC(n,e,t){const r=e,s=sd("where",n);return Fl._create(s,r,t)}class Qo extends mp{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Qo(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ot.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)jw(o,l),o=Vh(o,l)}(e._query,t),new hn(e.firestore,e.converter,Vh(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function NL(...n){return n.forEach(e=>qw("or",e)),Qo._create("or",n)}function OL(...n){return n.forEach(e=>qw("and",e)),Qo._create("and",n)}class gp extends Ll{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new gp(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new Y(F.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new Y(F.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ll(i,o)}(e._query,this._field,this._direction);return new hn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Jr(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function pC(n,e="asc"){const t=e,r=sd("orderBy",n);return gp._create(r,t)}class id extends Ll{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new id(e,t,r)}_apply(e){return new hn(e.firestore,e.converter,ic(e._query,this._limit,this._limitType))}}function ML(n){return Pw("limit",n),id._create("limit",n,"F")}function LL(n){return Pw("limitToLast",n),id._create("limitToLast",n,"L")}class od extends Ll{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new od(e,t,r)}_apply(e){const t=$w(e,this.type,this._docOrFields,this._inclusive);return new hn(e.firestore,e.converter,function(s,i){return new Jr(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function FL(...n){return od._create("startAt",n,!0)}function UL(...n){return od._create("startAfter",n,!1)}class ad extends Ll{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ad(e,t,r)}_apply(e){const t=$w(e,this.type,this._docOrFields,this._inclusive);return new hn(e.firestore,e.converter,function(s,i){return new Jr(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function BL(...n){return ad._create("endBefore",n,!1)}function $L(...n){return ad._create("endAt",n,!0)}function $w(n,e,t,r){if(t[0]=xe(t[0]),t[0]instanceof fl)return function(i,o,a,l,c){if(!l)throw new Y(F.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const d=[];for(const f of uo(i))if(f.field.isKeyField())d.push(vi(o,l.key));else{const g=l.data.field(f.field);if(Bc(g))throw new Y(F.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const _=f.field.canonicalString();throw new Y(F.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}d.push(g)}return new Os(d,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Ci(n.firestore);return function(o,a,l,c,d,f){const g=o.explicitOrderBy;if(d.length>g.length)throw new Y(F.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const _=[];for(let C=0;C<d.length;C++){const x=d[C];if(g[C].field.isKeyField()){if(typeof x!="string")throw new Y(F.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof x}`);if(!Af(o)&&x.indexOf("/")!==-1)throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${x}' contains a slash.`);const R=o.path.child(Ke.fromString(x));if(!pe.isDocumentKey(R))throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);const L=new pe(R);_.push(vi(a,L))}else{const R=Ow(l,c,x);_.push(R)}}return new Os(_,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function v_(n,e,t){if(typeof(t=xe(t))=="string"){if(t==="")throw new Y(F.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Af(e)&&t.indexOf("/")!==-1)throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Ke.fromString(t));if(!pe.isDocumentKey(r))throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return vi(n,new pe(r))}if(t instanceof $t)return vi(n,t._key);throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zc(t)}.`)}function y_(n,e){if(!Array.isArray(n)||n.length===0)throw new Y(F.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function jw(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Y(F.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Y(F.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function qw(n,e){if(!(e instanceof Fl||e instanceof Qo))throw new Y(F.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class zw{convertValue(e,t="none"){switch(Vs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return bt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(zr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ge()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return qs(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>bt(o.doubleValue));return new ed(i)}convertGeoPoint(e){return new ap(bt(e.latitude),bt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=$c(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(il(e));default:return null}}convertTimestamp(e){const t=qr(e);return new Pt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Ke.fromString(e);ye(F0(r));const s=new _i(r.get(1),r.get(3)),i=new pe(r.popFirst(5));return s.isEqual(t)||Lt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ld(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class mC extends zw{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ai(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new $t(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jL(n){return new dl("sum",hl("sum",n))}function qL(n){return new dl("avg",hl("average",n))}function gC(){return new dl("count")}function zL(n,e){var t,r;return n instanceof dl&&e instanceof dl&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function GL(n,e){return Rw(n.query,e.query)&&ks(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Mo extends fl{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Bu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(sd("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Bu extends Mo{data(e={}){return super.data(e)}}class Lo{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new ui(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Bu(this._firestore,this._userDataWriter,r.key,r,new ui(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Y(F.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Bu(s._firestore,s._userDataWriter,a.doc.key,a.doc,new ui(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Bu(s._firestore,s._userDataWriter,a.doc.key,a.doc,new ui(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,d=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:_C(a.type),doc:l,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function _C(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ge()}}function KL(n,e){return n instanceof Mo&&e instanceof Mo?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Lo&&e instanceof Lo&&n._firestore===e._firestore&&Rw(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Di(n){n=qe(n,$t);const e=qe(n.firestore,ft);return Aw(Rt(e),n._key).then(t=>_p(e,n,t))}class Gs extends zw{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ai(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new $t(this.firestore,null,t)}}function HL(n){n=qe(n,$t);const e=qe(n.firestore,ft),t=Rt(e),r=new Gs(e);return WR(t,n._key).then(s=>new Mo(e,r,n._key,s,new ui(s!==null&&s.hasLocalMutations,!0),n.converter))}function WL(n){n=qe(n,$t);const e=qe(n.firestore,ft);return Aw(Rt(e),n._key,{source:"server"}).then(t=>_p(e,n,t))}function St(n){n=qe(n,hn);const e=qe(n.firestore,ft),t=Rt(e),r=new Gs(e);return Uw(n._query),xw(t,n._query).then(s=>new Lo(e,r,n,s))}function QL(n){n=qe(n,hn);const e=qe(n.firestore,ft),t=Rt(e),r=new Gs(e);return QR(t,n._query).then(s=>new Lo(e,r,n,s))}function JL(n){n=qe(n,hn);const e=qe(n.firestore,ft),t=Rt(e),r=new Gs(e);return xw(t,n._query,{source:"server"}).then(s=>new Lo(e,r,n,s))}function Rn(n,e,t){n=qe(n,$t);const r=qe(n.firestore,ft),s=ld(n.converter,e,t);return Ul(r,[nd(Ci(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Et.none())])}function vC(n,e,t,...r){n=qe(n,$t);const s=qe(n.firestore,ft),i=Ci(s);let o;return o=typeof(e=xe(e))=="string"||e instanceof Pi?fp(i,"updateDoc",n._key,e,t,r):hp(i,"updateDoc",n._key,e),Ul(s,[o.toMutation(n._key,Et.exists(!0))])}function pl(n){return Ul(qe(n.firestore,ft),[new qo(n._key,Et.none())])}function Gw(n,e){const t=qe(n.firestore,ft),r=Oe(n),s=ld(n.converter,e);return Ul(t,[nd(Ci(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Et.exists(!1))]).then(()=>r)}function YL(n,...e){var t,r,s;n=xe(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Gh(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Gh(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,d;if(n instanceof $t)c=qe(n.firestore,ft),d=$o(n._key.path),l={next:f=>{e[o]&&e[o](_p(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=qe(n,hn);c=qe(f.firestore,ft),d=f._query;const g=new Gs(c);l={next:_=>{e[o]&&e[o](new Lo(c,g,f,_))},error:e[o+1],complete:e[o+2]},Uw(n._query)}return function(g,_,C,x){const R=new Yc(x),L=new Yf(_,R,C);return g.asyncQueue.enqueueAndForget(async()=>Wf(await Oo(g),L)),()=>{R.Za(),g.asyncQueue.enqueueAndForget(async()=>Qf(await Oo(g),L))}}(Rt(c),d,a,l)}function XL(n,e){return YR(Rt(n=qe(n,ft)),Gh(e)?e:{next:e})}function Ul(n,e){return function(r,s){const i=new rn;return r.asyncQueue.enqueueAndForget(async()=>AR(await ip(r),s,i)),i.promise}(Rt(n),e)}function _p(n,e,t){const r=t.docs.get(e._key),s=new Gs(n);return new Mo(n,s,e._key,r,new ui(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZL(n){return yC(n,{count:gC()})}function yC(n,e){const t=qe(n.firestore,ft),r=Rt(t),s=Gy(e,(i,o)=>new b0(o,i.aggregateType,i._internalFieldPath));return JR(r,n._query,s).then(i=>function(a,l,c){const d=new Gs(a);return new aC(l,d,c)}(t,n,i))}class wC{constructor(e){this.kind="memory",this._onlineComponentProvider=Fs.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=Ls.provider}toJSON(){return{kind:this.kind}}}class bC{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=xC(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class IC{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Ls.provider}toJSON(){return{kind:this.kind}}}class EC{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new $R(e)}}toJSON(){return{kind:this.kind}}}function eF(){return new IC}function tF(n){return new EC(n==null?void 0:n.cacheSizeBytes)}function nF(n){return new wC(n)}function rF(n){return new bC(n)}class TC{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Fs.provider,this._offlineComponentProvider={build:t=>new rp(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class AC{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Fs.provider,this._offlineComponentProvider={build:t=>new bw(t,e==null?void 0:e.cacheSizeBytes)}}}function xC(n){return new TC(n==null?void 0:n.forceOwnership)}function sF(){return new AC}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SC={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ci(e)}set(e,t,r){this._verifyNotCommitted();const s=ys(e,this._firestore),i=ld(s.converter,t,r),o=nd(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Et.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=ys(e,this._firestore);let o;return o=typeof(t=xe(t))=="string"||t instanceof Pi?fp(this._dataReader,"WriteBatch.update",i._key,t,r,s):hp(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Et.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ys(e,this._firestore);return this._mutations=this._mutations.concat(new qo(t._key,Et.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Y(F.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ys(n,e){if((n=xe(n)).firestore!==e)throw new Y(F.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RC extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Ci(t)}get(t){const r=ys(t,this._firestore),s=new mC(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return ge();const o=i[0];if(o.isFoundDocument())return new fl(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new fl(this._firestore,s,r._key,null,r.converter);throw ge()})}set(t,r,s){const i=ys(t,this._firestore),o=ld(i.converter,r,s),a=nd(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=ys(t,this._firestore);let a;return a=typeof(r=xe(r))=="string"||r instanceof Pi?fp(this._dataReader,"Transaction.update",o._key,r,s,i):hp(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=ys(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ys(e,this._firestore),r=new Gs(this._firestore);return super.get(e).then(s=>new Mo(this._firestore,r,t._key,s._document,new ui(!1,!1),t.converter))}}function oF(n,e,t){n=qe(n,ft);const r=Object.assign(Object.assign({},SC),t);return function(i){if(i.maxAttempts<1)throw new Y(F.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new rn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await Tw(i);new zR(i.asyncQueue,c,a,o,l).au()}),l.promise}(Rt(n),s=>e(new RC(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aF(){return new Ml("deleteField")}function vp(){return new lp("serverTimestamp")}function lF(...n){return new up("arrayUnion",n)}function uF(...n){return new cp("arrayRemove",n)}function cF(n){return new dp("increment",n)}function dF(n){return new ed(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kw(n){return Rt(n=qe(n,ft)),new PC(n,e=>Ul(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hF(n,e){const t=Rt(n=qe(n,ft));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Qn("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(d){throw new Y(F.INVALID_ARGUMENT,"Failed to parse JSON: "+(d==null?void 0:d.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=w_(l,"collectionGroup"),d=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=rd("setIndexConfiguration",w_(f,"fieldPath"));f.arrayConfig==="CONTAINS"?d.push(new pi(g,2)):f.order==="ASCENDING"?d.push(new pi(g,0)):f.order==="DESCENDING"&&d.push(new pi(g,1))}a.push(new Eo(Eo.UNKNOWN_ID,c,d,To.empty()))}return a}(e);return eC(t,r)}function w_(n,e){if(typeof n[e]!="string")throw new Y(F.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CC{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function fF(n){var e;n=qe(n,ft);const t=b_.get(n);if(t)return t;if(((e=Rt(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new CC(n);return b_.set(n,r),r}function pF(n){Hw(n,!0)}function mF(n){Hw(n,!1)}function gF(n){nC(Rt(n._firestore)).then(e=>J("deleting all persistent cache indexes succeeded")).catch(e=>Qn("deleting all persistent cache indexes failed",e))}function Hw(n,e){tC(Rt(n._firestore),e).then(t=>J(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>Qn(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const b_=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _F(n){var e;const t=(e=Rt(qe(n.firestore,ft))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Gc(t,In(n._query))._t}function vF(n,e){var t;const r=Gy(e,(i,o)=>new b0(o,i.aggregateType,i._internalFieldPath)),s=(t=Rt(qe(n.firestore,ft))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:N0(s,i0(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yF{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return yp.instance.onExistenceFilterMismatch(e)}}class yp{constructor(){this.Uu=new Map}static get instance(){return Tu||(Tu=new yp,function(t){if(oc)throw new Error("a TestingHooksSpi instance is already set");oc=t}(Tu)),Tu}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let Tu=null;(function(e,t=!0){(function(s){Bo=s})(Uo),bo(new gi("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new ft(new Xx(r.getProvider("auth-internal")),new tS(r.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new Y(F.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new _i(c.options.projectId,d)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Ps(cg,"4.7.3",e),Ps(cg,"4.7.3","esm2017")})();function wp(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wF={PHONE:"phone",TOTP:"totp"},bF={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},IF={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},EF={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},TF={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kC(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function Ww(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const AF=kC,DC=Ww,Qw=new Tl("auth","Firebase",Ww()),xF={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gc=new vf("@firebase/auth");function VC(n,...e){gc.logLevel<=Ge.WARN&&gc.warn(`Auth (${Uo}): ${n}`,...e)}function $u(n,...e){gc.logLevel<=Ge.ERROR&&gc.error(`Auth (${Uo}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Un(n,...e){throw Ip(n,...e)}function Cn(n,...e){return Ip(n,...e)}function bp(n,e,t){const r=Object.assign(Object.assign({},DC()),{[e]:t});return new Tl("auth","Firebase",r).create(e,{appName:n.name})}function sn(n){return bp(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Jo(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Un(n,"argument-error"),bp(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Ip(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Qw.create(n,...e)}function re(n,e,...t){if(!n)throw Ip(e,...t)}function _r(n){const e="INTERNAL ASSERTION FAILED: "+n;throw $u(e),new Error(e)}function Gr(n,e){n||_r(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ml(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Ep(){return I_()==="http:"||I_()==="https:"}function I_(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NC(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Ep()||RA()||"connection"in navigator)?navigator.onLine:!0}function OC(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bl{constructor(e,t){this.shortDelay=e,this.longDelay=t,Gr(t>e,"Short delay should be less than long delay!"),this.isMobile=xA()||CA()}get(){return NC()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tp(n,e){Gr(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jw{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;_r("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;_r("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;_r("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MC={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LC=new Bl(3e4,6e4);function vt(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function yt(n,e,t,r,s={}){return Yw(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Fo(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return PA()||(c.referrerPolicy="no-referrer"),Jw.fetch()(Xw(n,n.config.apiHost,t,a),c)})}async function Yw(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},MC),e);try{const s=new UC(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Da(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Da(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Da(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Da(n,"user-disabled",o);const d=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw bp(n,d,c);Un(n,d)}}catch(s){if(s instanceof Qr)throw s;Un(n,"network-request-failed",{message:String(s)})}}async function es(n,e,t,r,s={}){const i=await yt(n,e,t,r,s);return"mfaPendingCredential"in i&&Un(n,"multi-factor-auth-required",{_serverResponse:i}),i}function Xw(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Tp(n.config,s):`${n.config.apiScheme}://${s}`}function FC(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class UC{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Cn(this.auth,"network-request-failed")),LC.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Da(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Cn(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E_(n){return n!==void 0&&n.getResponse!==void 0}function T_(n){return n!==void 0&&n.enterprise!==void 0}class Zw{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return FC(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BC(n){return(await yt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function eb(n,e){return yt(n,"GET","/v2/recaptchaConfig",vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $C(n,e){return yt(n,"POST","/v1/accounts:delete",e)}async function jC(n,e){return yt(n,"POST","/v1/accounts:update",e)}async function tb(n,e){return yt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ha(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SF(n,e=!1){return xe(n).getIdToken(e)}async function qC(n,e=!1){const t=xe(n),r=await t.getIdToken(e),s=ud(r);re(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Ha(Xd(s.auth_time)),issuedAtTime:Ha(Xd(s.iat)),expirationTime:Ha(Xd(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Xd(n){return Number(n)*1e3}function ud(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return $u("JWT malformed, contained fewer than 3 sections"),null;try{const s=fy(t);return s?JSON.parse(s):($u("Failed to decode base64 JWT payload"),null)}catch(s){return $u("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function A_(n){const e=ud(n);return re(e,"internal-error"),re(typeof e.exp<"u","internal-error"),re(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kr(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Qr&&zC(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function zC({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GC{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kh{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ha(this.lastLoginAt),this.creationTime=Ha(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gl(n){var e;const t=n.auth,r=await n.getIdToken(),s=await Kr(n,tb(t,{idToken:r}));re(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?nb(i.providerUserInfo):[],a=HC(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Kh(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function KC(n){const e=xe(n);await gl(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function HC(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function nb(n){return n.map(e=>{var{providerId:t}=e,r=wp(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WC(n,e){const t=await Yw(n,{},async()=>{const r=Fo({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=Xw(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Jw.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function QC(n,e){return yt(n,"POST","/v2/accounts:revokeToken",vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ho{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){re(e.idToken,"internal-error"),re(typeof e.idToken<"u","internal-error"),re(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):A_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){re(e.length!==0,"internal-error");const t=A_(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(re(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await WC(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new ho;return r&&(re(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(re(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(re(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ho,this.toJSON())}_performRefresh(){return _r("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hs(n,e){re(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Or{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=wp(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new GC(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Kh(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Kr(this,this.stsTokenManager.getToken(this.auth,e));return re(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return qC(this,e)}reload(){return KC(this)}_assign(e){this!==e&&(re(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Or(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){re(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await gl(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ut(this.auth.app))return Promise.reject(sn(this.auth));const e=await this.getIdToken();return await Kr(this,$C(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,d;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(s=t.email)!==null&&s!==void 0?s:void 0,_=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,C=(o=t.photoURL)!==null&&o!==void 0?o:void 0,x=(a=t.tenantId)!==null&&a!==void 0?a:void 0,R=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,L=(c=t.createdAt)!==null&&c!==void 0?c:void 0,B=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:$,emailVerified:j,isAnonymous:O,providerData:se,stsTokenManager:T}=t;re($&&T,e,"internal-error");const w=ho.fromJSON(this.name,T);re(typeof $=="string",e,"internal-error"),hs(f,e.name),hs(g,e.name),re(typeof j=="boolean",e,"internal-error"),re(typeof O=="boolean",e,"internal-error"),hs(_,e.name),hs(C,e.name),hs(x,e.name),hs(R,e.name),hs(L,e.name),hs(B,e.name);const I=new Or({uid:$,auth:e,email:g,emailVerified:j,displayName:f,isAnonymous:O,photoURL:C,phoneNumber:_,tenantId:x,stsTokenManager:w,createdAt:L,lastLoginAt:B});return se&&Array.isArray(se)&&(I.providerData=se.map(P=>Object.assign({},P))),R&&(I._redirectEventId=R),I}static async _fromIdTokenResponse(e,t,r=!1){const s=new ho;s.updateFromServerResponse(t);const i=new Or({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await gl(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];re(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?nb(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new ho;a.updateFromIdToken(r);const l=new Or({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Kh(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x_=new Map;function Mr(n){Gr(n instanceof Function,"Expected a class definition");let e=x_.get(n);return e?(Gr(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,x_.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rb{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}rb.type="NONE";const S_=rb;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ju(n,e,t){return`firebase:${n}:${e}:${t}`}class fo{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=ju(this.userKey,s.apiKey,i),this.fullPersistenceKey=ju("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Or._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new fo(Mr(S_),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||Mr(S_);const o=ju(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const d=await c._get(o);if(d){const f=Or._fromJSON(e,d);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new fo(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new fo(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P_(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(ab(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(sb(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(ub(e))return"Blackberry";if(cb(e))return"Webos";if(ib(e))return"Safari";if((e.includes("chrome/")||ob(e))&&!e.includes("edge/"))return"Chrome";if(lb(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function sb(n=Zt()){return/firefox\//i.test(n)}function ib(n=Zt()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function ob(n=Zt()){return/crios\//i.test(n)}function ab(n=Zt()){return/iemobile/i.test(n)}function lb(n=Zt()){return/android/i.test(n)}function ub(n=Zt()){return/blackberry/i.test(n)}function cb(n=Zt()){return/webos/i.test(n)}function Ap(n=Zt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function JC(n=Zt()){var e;return Ap(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function YC(){return kA()&&document.documentMode===10}function db(n=Zt()){return Ap(n)||lb(n)||cb(n)||ub(n)||/windows phone/i.test(n)||ab(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hb(n,e=[]){let t;switch(n){case"Browser":t=P_(Zt());break;case"Worker":t=`${P_(Zt())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Uo}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XC{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZC(n,e={}){return yt(n,"GET","/v2/passwordPolicy",vt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e1=6;class t1{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:e1,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n1{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new R_(this),this.idTokenSubscription=new R_(this),this.beforeStateQueue=new XC(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Qw,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Mr(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await fo.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await tb(this,{idToken:e}),r=await Or._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Ut(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return re(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await gl(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=OC()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ut(this.app))return Promise.reject(sn(this));const t=e?xe(e):null;return t&&re(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&re(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ut(this.app)?Promise.reject(sn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ut(this.app)?Promise.reject(sn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Mr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await ZC(this),t=new t1(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Tl("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await QC(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Mr(e)||this._popupRedirectResolver;re(t,this,"argument-error"),this.redirectPersistenceManager=await fo.create(this,[Mr(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(re(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return re(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=hb(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&VC(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Nt(n){return xe(n)}class R_{constructor(e){this.auth=e,this.observer=null,this.addObserver=LA(t=>this.observer=t)}get next(){return re(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $l={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function r1(n){$l=n}function xp(n){return $l.loadJS(n)}function s1(){return $l.recaptchaV2Script}function i1(){return $l.recaptchaEnterpriseScript}function o1(){return $l.gapiScript}function fb(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const a1="recaptcha-enterprise",l1="NO_RECAPTCHA";class pb{constructor(e){this.type=a1,this.auth=Nt(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{eb(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new Zw(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;T_(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(l1)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&T_(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=i1();l.length!==0&&(l+=a),xp(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function C_(n,e,t,r=!1){const s=new pb(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function _l(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await C_(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await C_(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function u1(n){const e=Nt(n),t=await eb(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new Zw(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new pb(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c1(n,e){const t=Al(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(ks(i,e??{}))return s;Un(s,"already-initialized")}return t.initialize({options:e})}function d1(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Mr);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function h1(n,e,t){const r=Nt(n);re(r._canInitEmulator,r,"emulator-config-failed"),re(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=mb(e),{host:o,port:a}=f1(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||p1()}function mb(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function f1(n){const e=mb(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:k_(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:k_(o)}}}function k_(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function p1(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jl{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return _r("not implemented")}_getIdTokenResponse(e){return _r("not implemented")}_linkToIdToken(e,t){return _r("not implemented")}_getReauthenticationResolver(e){return _r("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gb(n,e){return yt(n,"POST","/v1/accounts:resetPassword",vt(n,e))}async function m1(n,e){return yt(n,"POST","/v1/accounts:update",e)}async function g1(n,e){return yt(n,"POST","/v1/accounts:signUp",e)}async function _1(n,e){return yt(n,"POST","/v1/accounts:update",vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function v1(n,e){return es(n,"POST","/v1/accounts:signInWithPassword",vt(n,e))}async function cd(n,e){return yt(n,"POST","/v1/accounts:sendOobCode",vt(n,e))}async function y1(n,e){return cd(n,e)}async function w1(n,e){return cd(n,e)}async function b1(n,e){return cd(n,e)}async function I1(n,e){return cd(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function E1(n,e){return es(n,"POST","/v1/accounts:signInWithEmailLink",vt(n,e))}async function T1(n,e){return es(n,"POST","/v1/accounts:signInWithEmailLink",vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vl extends jl{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new vl(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new vl(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return _l(e,t,"signInWithPassword",v1);case"emailLink":return E1(e,{email:this._email,oobCode:this._password});default:Un(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return _l(e,r,"signUpPassword",g1);case"emailLink":return T1(e,{idToken:t,email:this._email,oobCode:this._password});default:Un(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ur(n,e){return es(n,"POST","/v1/accounts:signInWithIdp",vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A1="http://localhost";class Hr extends jl{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Hr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Un("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=wp(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new Hr(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Ur(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ur(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ur(e,t)}buildRequest(){const e={requestUri:A1,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Fo(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function x1(n,e){return yt(n,"POST","/v1/accounts:sendVerificationCode",vt(n,e))}async function S1(n,e){return es(n,"POST","/v1/accounts:signInWithPhoneNumber",vt(n,e))}async function P1(n,e){const t=await es(n,"POST","/v1/accounts:signInWithPhoneNumber",vt(n,e));if(t.temporaryProof)throw Da(n,"account-exists-with-different-credential",t);return t}const R1={USER_NOT_FOUND:"user-not-found"};async function C1(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return es(n,"POST","/v1/accounts:signInWithPhoneNumber",vt(n,t),R1)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi extends jl{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new mi({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new mi({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return S1(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return P1(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return C1(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new mi({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k1(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function D1(n){const e=xa(Sa(n)).link,t=e?xa(Sa(e)).deep_link_id:null,r=xa(Sa(n)).deep_link_id;return(r?xa(Sa(r)).link:null)||r||t||e||n}class ql{constructor(e){var t,r,s,i,o,a;const l=xa(Sa(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,d=(r=l.oobCode)!==null&&r!==void 0?r:null,f=k1((s=l.mode)!==null&&s!==void 0?s:null);re(c&&d&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=d,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=D1(e);try{return new ql(t)}catch{return null}}}function PF(n){return ql.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{constructor(){this.providerId=Vi.PROVIDER_ID}static credential(e,t){return vl._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=ql.parseLink(t);return re(r,"argument-error"),vl._fromEmailAndCode(e,r.code,r.tenantId)}}Vi.PROVIDER_ID="password";Vi.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Vi.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yo extends ts{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class qu extends Yo{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return re("providerId"in t&&"signInMethod"in t,"argument-error"),Hr._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return re(e.idToken||e.accessToken,"argument-error"),Hr._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return qu.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return qu.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new qu(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends Yo{constructor(){super("facebook.com")}static credential(e){return Hr._fromParams({providerId:ws.PROVIDER_ID,signInMethod:ws.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ws.credentialFromTaggedObject(e)}static credentialFromError(e){return ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ws.credential(e.oauthAccessToken)}catch{return null}}}ws.FACEBOOK_SIGN_IN_METHOD="facebook.com";ws.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs extends Yo{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Hr._fromParams({providerId:bs.PROVIDER_ID,signInMethod:bs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return bs.credentialFromTaggedObject(e)}static credentialFromError(e){return bs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return bs.credential(t,r)}catch{return null}}}bs.GOOGLE_SIGN_IN_METHOD="google.com";bs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is extends Yo{constructor(){super("github.com")}static credential(e){return Hr._fromParams({providerId:Is.PROVIDER_ID,signInMethod:Is.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Is.credentialFromTaggedObject(e)}static credentialFromError(e){return Is.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Is.credential(e.oauthAccessToken)}catch{return null}}}Is.GITHUB_SIGN_IN_METHOD="github.com";Is.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V1="http://localhost";class yl extends jl{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Ur(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ur(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ur(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new yl(r,i)}static _create(e,t){return new yl(e,t)}buildRequest(){return{requestUri:V1,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N1="saml.";class Hh extends ts{constructor(e){re(e.startsWith(N1),"argument-error"),super(e)}static credentialFromResult(e){return Hh.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Hh.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=yl.fromJSON(e);return re(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return yl._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es extends Yo{constructor(){super("twitter.com")}static credential(e,t){return Hr._fromParams({providerId:Es.PROVIDER_ID,signInMethod:Es.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Es.credentialFromTaggedObject(e)}static credentialFromError(e){return Es.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Es.credential(t,r)}catch{return null}}}Es.TWITTER_SIGN_IN_METHOD="twitter.com";Es.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _b(n,e){return es(n,"POST","/v1/accounts:signUp",vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Or._fromIdTokenResponse(e,r,s),o=D_(r);return new Jn({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=D_(r);return new Jn({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function D_(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function O1(n){var e;if(Ut(n.app))return Promise.reject(sn(n));const t=Nt(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Jn({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await _b(t,{returnSecureToken:!0}),s=await Jn._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _c extends Qr{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,_c.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new _c(e,t,r,s)}}function vb(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?_c._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yb(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RF(n,e){const t=xe(n);await dd(!0,t,e);const{providerUserInfo:r}=await jC(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=yb(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Sp(n,e,t=!1){const r=await Kr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Jn._forOperation(n,"link",r)}async function dd(n,e,t){await gl(e);const r=yb(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";re(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wb(n,e,t=!1){const{auth:r}=n;if(Ut(r.app))return Promise.reject(sn(r));const s="reauthenticate";try{const i=await Kr(n,vb(r,s,e,n),t);re(i.idToken,r,"internal-error");const o=ud(i.idToken);re(o,r,"internal-error");const{sub:a}=o;return re(n.uid===a,r,"user-mismatch"),Jn._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Un(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bb(n,e,t=!1){if(Ut(n.app))return Promise.reject(sn(n));const r="signIn",s=await vb(n,r,e),i=await Jn._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Pp(n,e){return bb(Nt(n),e)}async function M1(n,e){const t=xe(n);return await dd(!1,t,e.providerId),Sp(t,e)}async function L1(n,e){return wb(xe(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function F1(n,e){return es(n,"POST","/v1/accounts:signInWithCustomToken",vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CF(n,e){if(Ut(n.app))return Promise.reject(sn(n));const t=Nt(n),r=await F1(t,{token:e,returnSecureToken:!0}),s=await Jn._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zl{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Rp._fromServerResponse(e,t):"totpInfo"in t?Cp._fromServerResponse(e,t):Un(e,"internal-error")}}class Rp extends zl{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Rp(t)}}class Cp extends zl{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Cp(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hd(n,e,t){var r;re(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),re(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(re(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(re(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kp(n){const e=Nt(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function U1(n,e,t){const r=Nt(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&hd(r,s,t),await _l(r,s,"getOobCode",w1)}async function B1(n,e,t){await gb(xe(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&kp(n),r})}async function kF(n,e){await _1(xe(n),{oobCode:e})}async function $1(n,e){const t=xe(n),r=await gb(t,{oobCode:e}),s=r.requestType;switch(re(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":re(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":re(r.mfaInfo,t,"internal-error");default:re(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=zl._fromServerResponse(Nt(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function DF(n,e){const{data:t}=await $1(xe(n),e);return t.email}async function j1(n,e,t){if(Ut(n.app))return Promise.reject(sn(n));const r=Nt(n),o=await _l(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",_b).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&kp(n),l}),a=await Jn._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function q1(n,e,t){return Ut(n.app)?Promise.reject(sn(n)):Pp(xe(n),Vi.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&kp(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VF(n,e,t){const r=Nt(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){re(a.handleCodeInApp,r,"argument-error"),a&&hd(r,o,a)}i(s,t),await _l(r,s,"getOobCode",b1)}function NF(n,e){const t=ql.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function OF(n,e,t){if(Ut(n.app))return Promise.reject(sn(n));const r=xe(n),s=Vi.credentialWithLink(e,t||ml());return re(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Pp(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function z1(n,e){return yt(n,"POST","/v1/accounts:createAuthUri",vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MF(n,e){const t=Ep()?ml():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await z1(xe(n),r);return s||[]}async function LF(n,e){const t=xe(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&hd(t.auth,s,e);const{email:i}=await y1(t.auth,s);i!==n.email&&await n.reload()}async function FF(n,e,t){const r=xe(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&hd(r.auth,i,t);const{email:o}=await I1(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function G1(n,e){return yt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UF(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=xe(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Kr(r,G1(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function BF(n,e){const t=xe(n);return Ut(t.auth.app)?Promise.reject(sn(t.auth)):Ib(t,e,null)}function K1(n,e){return Ib(xe(n),null,e)}async function Ib(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Kr(n,m1(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H1(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=ud(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new po(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new W1(i,s);case"github.com":return new Q1(i,s);case"google.com":return new J1(i,s);case"twitter.com":return new Y1(i,s,n.screenName||null);case"custom":case"anonymous":return new po(i,null);default:return new po(i,r,s)}}class po{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class Eb extends po{constructor(e,t,r,s){super(e,t,r),this.username=s}}class W1 extends po{constructor(e,t){super(e,"facebook.com",t)}}class Q1 extends Eb{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class J1 extends po{constructor(e,t){super(e,"google.com",t)}}class Y1 extends Eb{constructor(e,t,r){super(e,"twitter.com",t,r)}}function $F(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:H1(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jF(n,e){return xe(n).setPersistence(e)}function qF(n){return u1(n)}async function zF(n,e){return Nt(n).validatePassword(e)}function X1(n,e,t,r){return xe(n).onIdTokenChanged(e,t,r)}function Z1(n,e,t){return xe(n).beforeAuthStateChanged(e,t)}function GF(n,e,t,r){return xe(n).onAuthStateChanged(e,t,r)}function KF(n){xe(n).useDeviceLanguage()}function HF(n,e){return xe(n).updateCurrentUser(e)}function WF(n){return xe(n).signOut()}function QF(n,e){return Nt(n).revokeAccessToken(e)}async function JF(n){return xe(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ci{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new ci("enroll",e,t)}static _fromMfaPendingCredential(e){return new ci("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return ci._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return ci._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=Nt(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>zl._fromServerResponse(r,a));re(s.mfaPendingCredential,r,"internal-error");const o=ci._fromMfaPendingCredential(s.mfaPendingCredential);return new Dp(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const d=await Jn._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(d.user),d;case"reauthenticate":return re(t.user,r,"internal-error"),Jn._forOperation(t.user,t.operationType,c);default:Un(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function YF(n,e){var t;const r=xe(n),s=e;return re(e.customData.operationType,r,"argument-error"),re((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Dp._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ek(n,e){return yt(n,"POST","/v2/accounts/mfaEnrollment:start",vt(n,e))}function tk(n,e){return yt(n,"POST","/v2/accounts/mfaEnrollment:finalize",vt(n,e))}function nk(n,e){return yt(n,"POST","/v2/accounts/mfaEnrollment:start",vt(n,e))}function rk(n,e){return yt(n,"POST","/v2/accounts/mfaEnrollment:finalize",vt(n,e))}function sk(n,e){return yt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",vt(n,e))}class Vp{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>zl._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Vp(e)}async getSession(){return ci._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Kr(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Kr(this.user,sk(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Zd=new WeakMap;function XF(n){const e=xe(n);return Zd.has(e)||Zd.set(e,Vp._fromUser(e)),Zd.get(e)}const vc="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tb{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(vc,"1"),this.storage.removeItem(vc),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ik=1e3,ok=10;class Ab extends Tb{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=db(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);YC()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,ok):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},ik)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Ab.type="LOCAL";const ak=Ab;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xb extends Tb{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}xb.type="SESSION";const Sb=xb;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lk(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fd{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new fd(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await lk(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}fd.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pd(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uk{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=pd("",20);s.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===c)switch(g.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gt(){return window}function ck(n){Gt().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Np(){return typeof Gt().WorkerGlobalScope<"u"&&typeof Gt().importScripts=="function"}async function dk(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function hk(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function fk(){return Np()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pb="firebaseLocalStorageDb",pk=1,yc="firebaseLocalStorage",Rb="fbase_key";class Gl{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function md(n,e){return n.transaction([yc],e?"readwrite":"readonly").objectStore(yc)}function mk(){const n=indexedDB.deleteDatabase(Pb);return new Gl(n).toPromise()}function Wh(){const n=indexedDB.open(Pb,pk);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(yc,{keyPath:Rb})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(yc)?e(r):(r.close(),await mk(),e(await Wh()))})})}async function V_(n,e,t){const r=md(n,!0).put({[Rb]:e,value:t});return new Gl(r).toPromise()}async function gk(n,e){const t=md(n,!1).get(e),r=await new Gl(t).toPromise();return r===void 0?null:r.value}function N_(n,e){const t=md(n,!0).delete(e);return new Gl(t).toPromise()}const _k=800,vk=3;class Cb{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Wh(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>vk)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Np()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=fd._getInstance(fk()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await dk(),!this.activeServiceWorker)return;this.sender=new uk(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||hk()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Wh();return await V_(e,vc,"1"),await N_(e,vc),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>V_(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>gk(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>N_(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=md(s,!1).getAll();return new Gl(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),_k)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Cb.type="LOCAL";const yk=Cb;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wk(n,e){return yt(n,"POST","/v2/accounts/mfaSignIn:start",vt(n,e))}function bk(n,e){return yt(n,"POST","/v2/accounts/mfaSignIn:finalize",vt(n,e))}function Ik(n,e){return yt(n,"POST","/v2/accounts/mfaSignIn:finalize",vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ek=500,Tk=6e4,Au=1e12;class Ak{constructor(e){this.auth=e,this.counter=Au,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new xk(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Au;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Au;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Au;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class xk{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;re(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=Sk(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},Tk)},Ek))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function Sk(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eh=fb("rcb"),Pk=new Bl(3e4,6e4);class Rk{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Gt().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return re(Ck(t),e,"argument-error"),this.shouldResolveImmediately(t)&&E_(Gt().grecaptcha)?Promise.resolve(Gt().grecaptcha):new Promise((r,s)=>{const i=Gt().setTimeout(()=>{s(Cn(e,"network-request-failed"))},Pk.get());Gt()[eh]=()=>{Gt().clearTimeout(i),delete Gt()[eh];const a=Gt().grecaptcha;if(!a||!E_(a)){s(Cn(e,"internal-error"));return}const l=a.render;a.render=(c,d)=>{const f=l(c,d);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${s1()}?${Fo({onload:eh,render:"explicit",hl:t})}`;xp(o).catch(()=>{clearTimeout(i),s(Cn(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Gt().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function Ck(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class kk{async load(e){return new Ak(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kb="recaptcha",Dk={theme:"light",type:"image"};class ZF{constructor(e,t,r=Object.assign({},Dk)){this.parameters=r,this.type=kb,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Nt(e),this.isInvisible=this.parameters.size==="invisible",re(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;re(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new kk:new Rk,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){re(!this.parameters.sitekey,this.auth,"argument-error"),re(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),re(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Gt()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){re(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){re(Ep()&&!Np(),this.auth,"internal-error"),await Vk(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await BC(this.auth);re(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return re(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function Vk(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Op{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=mi._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function e4(n,e,t){if(Ut(n.app))return Promise.reject(sn(n));const r=Nt(n),s=await gd(r,e,xe(t));return new Op(s,i=>Pp(r,i))}async function t4(n,e,t){const r=xe(n);await dd(!1,r,"phone");const s=await gd(r.auth,e,xe(t));return new Op(s,i=>M1(r,i))}async function n4(n,e,t){const r=xe(n);if(Ut(r.auth.app))return Promise.reject(sn(r.auth));const s=await gd(r.auth,e,xe(t));return new Op(s,i=>L1(r,i))}async function gd(n,e,t){var r;const s=await t.verify();try{re(typeof s=="string",n,"argument-error"),re(t.type===kb,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return re(o.type==="enroll",n,"internal-error"),(await ek(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{re(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return re(a,n,"missing-multi-factor-info"),(await wk(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await x1(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function r4(n,e){const t=xe(n);if(Ut(t.auth.app))return Promise.reject(sn(t.auth));await Sp(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo{constructor(e){this.providerId=mo.PROVIDER_ID,this.auth=Nt(e)}verifyPhoneNumber(e,t){return gd(this.auth,e,xe(t))}static credential(e,t){return mi._fromVerification(e,t)}static credentialFromResult(e){const t=e;return mo.credentialFromTaggedObject(t)}static credentialFromError(e){return mo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?mi._fromTokenResponse(t,r):null}}mo.PROVIDER_ID="phone";mo.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ni(n,e){return e?Mr(e):(re(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mp extends jl{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ur(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ur(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ur(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Nk(n){return bb(n.auth,new Mp(n),n.bypassAuthState)}function Ok(n){const{auth:e,user:t}=n;return re(t,e,"internal-error"),wb(t,new Mp(n),n.bypassAuthState)}async function Mk(n){const{auth:e,user:t}=n;return re(t,e,"internal-error"),Sp(t,new Mp(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Db{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Nk;case"linkViaPopup":case"linkViaRedirect":return Mk;case"reauthViaPopup":case"reauthViaRedirect":return Ok;default:Un(this.auth,"internal-error")}}resolve(e){Gr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Gr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lk=new Bl(2e3,1e4);async function s4(n,e,t){if(Ut(n.app))return Promise.reject(Cn(n,"operation-not-supported-in-this-environment"));const r=Nt(n);Jo(n,e,ts);const s=Ni(r,t);return new Lr(r,"signInViaPopup",e,s).executeNotNull()}async function i4(n,e,t){const r=xe(n);if(Ut(r.auth.app))return Promise.reject(Cn(r.auth,"operation-not-supported-in-this-environment"));Jo(r.auth,e,ts);const s=Ni(r.auth,t);return new Lr(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function o4(n,e,t){const r=xe(n);Jo(r.auth,e,ts);const s=Ni(r.auth,t);return new Lr(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Lr extends Db{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Lr.currentPopupAction&&Lr.currentPopupAction.cancel(),Lr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return re(e,this.auth,"internal-error"),e}async onExecution(){Gr(this.filter.length===1,"Popup operations only handle one event");const e=pd();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Cn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Cn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Lr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Cn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Lk.get())};e()}}Lr.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fk="pendingRedirect",zu=new Map;class Uk extends Db{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=zu.get(this.auth._key());if(!e){try{const r=await Bk(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}zu.set(this.auth._key(),e)}return this.bypassAuthState||zu.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Bk(n,e){const t=Nb(e),r=Vb(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function Lp(n,e){return Vb(n)._set(Nb(e),"true")}function $k(n,e){zu.set(n._key(),e)}function Vb(n){return Mr(n._redirectPersistence)}function Nb(n){return ju(Fk,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a4(n,e,t){return jk(n,e,t)}async function jk(n,e,t){if(Ut(n.app))return Promise.reject(sn(n));const r=Nt(n);Jo(n,e,ts),await r._initializationPromise;const s=Ni(r,t);return await Lp(s,r),s._openRedirect(r,e,"signInViaRedirect")}function l4(n,e,t){return qk(n,e,t)}async function qk(n,e,t){const r=xe(n);if(Jo(r.auth,e,ts),Ut(r.auth.app))return Promise.reject(sn(r.auth));await r.auth._initializationPromise;const s=Ni(r.auth,t);await Lp(s,r.auth);const i=await Mb(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function u4(n,e,t){return zk(n,e,t)}async function zk(n,e,t){const r=xe(n);Jo(r.auth,e,ts),await r.auth._initializationPromise;const s=Ni(r.auth,t);await dd(!1,r,e.providerId),await Lp(s,r.auth);const i=await Mb(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function c4(n,e){return await Nt(n)._initializationPromise,Ob(n,e,!1)}async function Ob(n,e,t=!1){if(Ut(n.app))return Promise.reject(sn(n));const r=Nt(n),s=Ni(r,e),o=await new Uk(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function Mb(n){const e=pd(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gk=10*60*1e3;class Kk{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Hk(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!Lb(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Cn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Gk&&this.cachedEventUids.clear(),this.cachedEventUids.has(O_(e))}saveEventToCache(e){this.cachedEventUids.add(O_(e)),this.lastProcessedEventTime=Date.now()}}function O_(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Lb({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Hk(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Lb(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wk(n,e={}){return yt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qk=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Jk=/^https?/;async function Yk(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Wk(n);for(const t of e)try{if(Xk(t))return}catch{}Un(n,"unauthorized-domain")}function Xk(n){const e=ml(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!Jk.test(t))return!1;if(Qk.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zk=new Bl(3e4,6e4);function M_(){const n=Gt().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function eD(n){return new Promise((e,t)=>{var r,s,i;function o(){M_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{M_(),t(Cn(n,"network-request-failed"))},timeout:Zk.get()})}if(!((s=(r=Gt().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Gt().gapi)===null||i===void 0)&&i.load)o();else{const a=fb("iframefcb");return Gt()[a]=()=>{gapi.load?o():t(Cn(n,"network-request-failed"))},xp(`${o1()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw Gu=null,e})}let Gu=null;function tD(n){return Gu=Gu||eD(n),Gu}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nD=new Bl(5e3,15e3),rD="__/auth/iframe",sD="emulator/auth/iframe",iD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},oD=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function aD(n){const e=n.config;re(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Tp(e,sD):`https://${n.config.authDomain}/${rD}`,r={apiKey:e.apiKey,appName:n.name,v:Uo},s=oD.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Fo(r).slice(1)}`}async function lD(n){const e=await tD(n),t=Gt().gapi;return re(t,n,"internal-error"),e.open({where:document.body,url:aD(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:iD,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Cn(n,"network-request-failed"),a=Gt().setTimeout(()=>{i(o)},nD.get());function l(){Gt().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uD={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},cD=500,dD=600,hD="_blank",fD="http://localhost";class L_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function pD(n,e,t,r=cD,s=dD){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},uD),{width:r.toString(),height:s.toString(),top:i,left:o}),c=Zt().toLowerCase();t&&(a=ob(c)?hD:t),sb(c)&&(e=e||fD,l.scrollbars="yes");const d=Object.entries(l).reduce((g,[_,C])=>`${g}${_}=${C},`,"");if(JC(c)&&a!=="_self")return mD(e||"",a),new L_(null);const f=window.open(e||"",a,d);re(f,n,"popup-blocked");try{f.focus()}catch{}return new L_(f)}function mD(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gD="__/auth/handler",_D="emulator/auth/handler",vD=encodeURIComponent("fac");async function F_(n,e,t,r,s,i){re(n.config.authDomain,n,"auth-domain-config-required"),re(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Uo,eventId:s};if(e instanceof ts){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",MA(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,f]of Object.entries(i||{}))o[d]=f}if(e instanceof Yo){const d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const l=await n._getAppCheckToken(),c=l?`#${vD}=${encodeURIComponent(l)}`:"";return`${yD(n)}?${Fo(a).slice(1)}${c}`}function yD({config:n}){return n.emulator?Tp(n,_D):`https://${n.authDomain}/${gD}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const th="webStorageSupport";class wD{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Sb,this._completeRedirectFn=Ob,this._overrideRedirectResult=$k}async _openPopup(e,t,r,s){var i;Gr((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await F_(e,t,r,ml(),s);return pD(e,o,pd())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await F_(e,t,r,ml(),s);return ck(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Gr(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await lD(e),r=new Kk(e);return t.register("authEvent",s=>(re(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(th,{type:th},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[th];o!==void 0&&t(!!o),Un(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Yk(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return db()||ib()||Ap()}}const bD=wD;class Fb{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return _r("unexpected MultiFactorSessionType")}}}class Fp extends Fb{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Fp(e)}_finalizeEnroll(e,t,r){return tk(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return bk(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class ID{constructor(){}static assertion(e){return Fp._fromCredential(e)}}ID.FACTOR_ID="phone";class ED{static assertionForEnrollment(e,t){return wl._fromSecret(e,t)}static assertionForSignIn(e,t){return wl._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;re(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await nk(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return Up._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}ED.FACTOR_ID="totp";class wl extends Fb{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new wl(t,void 0,e)}static _fromEnrollmentId(e,t){return new wl(t,e)}async _finalizeEnroll(e,t,r){return re(typeof this.secret<"u",e,"argument-error"),rk(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){re(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return Ik(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class Up{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new Up(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(xu(e)||xu(t))&&(s=!0),s&&(xu(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),xu(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function xu(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var U_="@firebase/auth",B_="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TD{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){re(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AD(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function xD(n){bo(new gi("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;re(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:hb(n)},c=new n1(r,s,i,l);return d1(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),bo(new gi("auth-internal",e=>{const t=Nt(e.getProvider("auth").getImmediate());return(r=>new TD(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ps(U_,B_,AD(n)),Ps(U_,B_,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SD=5*60,PD=gy("authIdTokenMaxAge")||SD;let $_=null;const RD=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>PD)return;const s=t==null?void 0:t.token;$_!==s&&($_=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function CD(n=Iy()){const e=Al(n,"auth");if(e.isInitialized())return e.getImmediate();const t=c1(n,{popupRedirectResolver:bD,persistence:[yk,ak,Sb]}),r=gy("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=RD(i.toString());Z1(t,o,()=>o(t.currentUser)),X1(t,a=>o(a))}}const s=py("auth");return s&&h1(t,`http://${s}`),t}function kD(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}r1({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Cn("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",kD().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});xD("Browser");const DD={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},Ub=by(DD),be=oC(Ub),Oi=CD(Ub);O1(Oi);async function VD(n,e){try{return(await j1(Oi,n,e)).user}catch(t){throw t}}async function ND(n,e){try{return(await q1(Oi,n,e)).user}catch(t){throw t}}async function OD(n){try{await U1(Oi,n)}catch(e){throw e}}async function MD(n){try{const e=Oi.currentUser;if(e)await K1(e,n);else throw new Error("Aucun utilisateur connect")}catch(e){throw e}}const go=Object.freeze(Object.defineProperty({__proto__:null,auth:Oi,createPlayerAccount:VD,db:be,resetPlayerPassword:OD,signInPlayer:ND,updatePlayerPassword:MD},Symbol.toStringTag,{value:"Module"})),Xo="seasons";async function LD(n,e,t){return await Gw(st(be,Xo),{name:n,slug:e,pinCode:t,createdAt:vp()})}async function FD(n){return await pl(Oe(be,Xo,n))}async function nh(){const n=Bw(st(be,Xo),pC("createdAt","desc"));return(await St(n)).docs.map(t=>({id:t.id,...t.data()}))}async function wc(n,e){const t=await Di(Oe(be,Xo,n));return t.exists()?t.data().pinCode===e:!1}async function Qh(n){const e=await Di(Oe(be,Xo,n));return e.exists()?e.data().pinCode:null}async function Ia(n,e){const t=Oe(be,Xo,n);await vC(t,{sortOrder:e})}const rh=10*60*1e3,sh="impro_selector_pin_session";class UD{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(sh);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<rh)return t;this.clearSession()}}catch(e){console.error("Erreur lors du chargement de la session PIN:",e)}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(sh,JSON.stringify(r)),this.sessionData=r}catch(r){console.error("Erreur lors de la sauvegarde de la session PIN:",r)}}isPinCached(e){return this.sessionData?this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<rh:!1}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(sh),this.sessionData=null}catch(e){console.error("Erreur lors de la suppression de la session PIN:",e)}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=rh-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const On=new UD,BD={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},$D={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},jD={class:"text-center mb-6"},qD={class:"text-gray-300"},zD={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},GD={class:"text-sm text-green-400"},KD={class:"mb-4 flex justify-center"},HD={class:"flex bg-gray-800 rounded-lg p-1"},WD={key:0,class:"mb-6"},QD={class:"mb-4"},JD={key:1,class:"mb-6"},YD={class:"flex justify-center space-x-3 mb-4"},XD={class:"grid grid-cols-3 gap-3 mb-4"},ZD=["onClick"],eV={key:2,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},tV={class:"flex justify-end space-x-3"},nV=["disabled"],Bb={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN  4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=q(""),i=q(""),o=q("direct"),a=q(null);sr(()=>t.show,x=>{x&&(s.value="",i.value="",o.value==="direct"&&Fr(()=>{var R;(R=a.value)==null||R.focus()}))}),sr(o,x=>{x==="direct"&&t.show&&Fr(()=>{var R;(R=a.value)==null||R.focus()})});function l(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function c(x){s.value.length<4&&(s.value+=x.toString())}function d(){s.value=s.value.slice(0,-1)}function f(){s.value="",i.value=""}function g(){s.value.length===4&&r("submit",s.value)}function _(){r("cancel")}const C=x=>{t.show&&(x.key>="0"&&x.key<="9"?o.value==="keypad"&&c(parseInt(x.key)):x.key==="Backspace"?o.value==="keypad"&&d():x.key==="Enter"?g():x.key==="Escape"&&_())};return typeof window<"u"&&window.addEventListener("keydown",C),(x,R)=>n.show?(W(),Q("div",BD,[m("div",$D,[m("div",jD,[R[4]||(R[4]=m("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[m("span",{class:"text-2xl"},"")],-1)),R[5]||(R[5]=m("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accs requis",-1)),m("p",qD,ve(n.message),1),n.sessionInfo?(W(),Q("div",zD,[m("p",GD," Session active : "+ve(n.sessionInfo.timeRemaining)+" min restantes ",1)])):Se("",!0)]),m("div",KD,[m("div",HD,[m("button",{onClick:R[0]||(R[0]=L=>o.value="direct"),class:tr(["px-4 py-2 rounded-md text-sm font-medium transition-all duration-200",o.value==="direct"?"bg-purple-600 text-white":"text-gray-400 hover:text-white"])}," Saisie directe ",2),m("button",{onClick:R[1]||(R[1]=L=>o.value="keypad"),class:tr(["px-4 py-2 rounded-md text-sm font-medium transition-all duration-200",o.value==="keypad"?"bg-purple-600 text-white":"text-gray-400 hover:text-white"])}," Pav numrique ",2)])]),o.value==="direct"?(W(),Q("div",WD,[m("div",QD,[R[6]||(R[6]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),gt(m("input",{"onUpdate:modelValue":R[2]||(R[2]=L=>s.value=L),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"",onInput:l,onKeydown:[Sn(g,["enter"]),Sn(_,["escape"])],ref_key:"pinInput",ref:a},null,544),[[xt,s.value]])]),R[7]||(R[7]=m("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN  4 chiffres",-1))])):(W(),Q("div",JD,[m("div",YD,[(W(),Q(Dt,null,Vr(4,(L,B)=>m("div",{key:B,class:tr(["w-12 h-12 border-2 border-gray-600 rounded-lg flex items-center justify-center text-2xl font-bold text-white bg-gray-800",{"border-purple-500 bg-purple-900/20":s.value.length>B}])},ve(s.value[B]||""),3)),64))]),m("div",XD,[(W(),Q(Dt,null,Vr([1,2,3,4,5,6,7,8,9],L=>m("button",{key:L,onClick:B=>c(L),class:"w-12 h-12 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-bold text-xl transition-all duration-200 hover:scale-105"},ve(L),9,ZD)),64)),m("button",{onClick:f,class:"w-12 h-12 bg-red-600 hover:bg-red-500 text-white rounded-lg font-bold text-lg transition-all duration-200 hover:scale-105"}," C "),m("button",{onClick:R[3]||(R[3]=L=>c(0)),class:"w-12 h-12 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-bold text-xl transition-all duration-200 hover:scale-105"}," 0 "),m("button",{onClick:d,class:"w-12 h-12 bg-gray-600 hover:bg-gray-500 text-white rounded-lg font-bold text-lg transition-all duration-200 hover:scale-105"},"  ")])])),i.value||t.error?(W(),Q("div",eV,ve(i.value||t.error),1)):Se("",!0),m("div",tV,[m("button",{onClick:_,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),m("button",{onClick:g,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,nV)])])])):Se("",!0)}},rV={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},sV={class:"container mx-auto px-4 pb-16"},iV={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto"},oV=["onClick"],aV={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},lV={class:"absolute top-4 right-4"},uV=["onClick","aria-expanded"],cV={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},dV=["onClick"],hV=["onClick"],fV=["onClick"],pV={key:0,class:"flex justify-center mt-12"},mV={key:1,class:"text-center py-16"},gV={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},_V={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},vV={class:"mb-6"},yV={class:"mb-6"},wV={class:"mb-6"},bV={class:"flex justify-end space-x-3"},IV=["disabled"],EV={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},TV={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},AV={class:"text-center mb-6"},xV={class:"text-gray-300"},SV={__name:"Home",setup(n){const e=q([]),t=Lc(),r=q(null),s=q(!1),i=q(!1),o=q(""),a=q(""),l=q(""),c=q(null),d=q(!1),f=q(null),g=q("");_o(async()=>{e.value=await nh(),console.log("Saisons charges:",e.value),await L()});const _=Xt(()=>[...e.value].sort((ue,K)=>{var Qe,fn;const Pe=typeof ue.sortOrder=="number"?ue.sortOrder:Number.MAX_SAFE_INTEGER,ke=typeof K.sortOrder=="number"?K.sortOrder:Number.MAX_SAFE_INTEGER;if(Pe!==ke)return Pe-ke;const We=(Qe=ue.createdAt)!=null&&Qe.toMillis?ue.createdAt.toMillis():0,Ve=(fn=K.createdAt)!=null&&fn.toMillis?K.createdAt.toMillis():0;return We!==Ve?Ve-We:(ue.name||"").localeCompare(K.name||"")}));function C(ue){t.push(`/season/${ue}`)}function x(ue){r.value=r.value===ue?null:ue}function R(){r.value=null}async function L(){if(!e.value.length)return;const ue=e.value.map(Pe=>typeof Pe.sortOrder=="number"?Pe.sortOrder:null).filter(Pe=>Pe!==null);let K=ue.length?Math.max(...ue):0;for(const Pe of e.value)if(typeof Pe.sortOrder!="number"){K+=1;try{await Ia(Pe.id,K),Pe.sortOrder=K}catch(ke){console.error("Erreur migration sortOrder pour",Pe.name,ke)}}}async function B(ue){if(R(),ue<=0)return;const K=[..._.value],Pe=K[ue],ke=K[ue-1],We=Pe.sortOrder;Pe.sortOrder=ke.sortOrder,ke.sortOrder=We;try{await Promise.all([Ia(Pe.id,Pe.sortOrder),Ia(ke.id,ke.sortOrder)])}catch(Ve){console.error("Erreur lors du dplacement vers le haut",Ve)}}async function $(ue){R();const K=[..._.value];if(ue>=K.length-1)return;const Pe=K[ue],ke=K[ue+1],We=Pe.sortOrder;Pe.sortOrder=ke.sortOrder,ke.sortOrder=We;try{await Promise.all([Ia(Pe.id,Pe.sortOrder),Ia(ke.id,ke.sortOrder)])}catch(Ve){console.error("Erreur lors du dplacement vers le bas",Ve)}}function j(){o.value&&(a.value=o.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function O(){l.value=l.value.replace(/[^0-9]/g,""),l.value.length>4&&(l.value=l.value.slice(0,4))}async function se(){if(!o.value.trim()||!a.value.trim()||!l.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN  4 chiffres");return}if(l.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await LD(o.value.trim(),a.value.trim(),l.value.trim()),e.value=await nh(),await L(),T()}catch(ue){console.error("Erreur lors de la cration de la saison:",ue),alert("Erreur lors de la cration de la saison. Veuillez ressayer.")}}function T(){s.value=!1,o.value="",a.value="",l.value=""}function w(ue){c.value=ue,i.value=!0}async function I(){i.value=!1,await D({type:"deleteSeason",data:{seasonId:c.value.id,seasonName:c.value.name}})}function P(){i.value=!1,c.value=null}function k(){return f.value?{deleteSeason:"Suppression de saison - Code PIN requis"}[f.value.type]||"Code PIN requis":"Veuillez saisir le code PIN  4 chiffres"}async function D(ue){if(On.isPinCached(c.value.id)){const K=On.getCachedPin(c.value.id);if(console.log("PIN en cache trouv, utilisation automatique"),await wc(c.value.id,K)){await Ye(ue);return}else On.clearSession()}f.value=ue,d.value=!0}async function A(ue){var K,Pe,ke;console.log("PIN soumis:",ue,"pour l'opration:",f.value);try{const We=((Pe=(K=f.value)==null?void 0:K.data)==null?void 0:Pe.seasonId)||((ke=c.value)==null?void 0:ke.id),Ve=await wc(We,ue);if(console.log("PIN valide:",Ve),Ve){On.saveSession(We,ue),console.log("PIN correct, fermeture de la modal et excution de l'opration"),d.value=!1;const Qe=f.value;f.value=null,console.log("Appel de executePendingOperation avec:",Qe),await Ye(Qe)}else g.value="Code PIN incorrect",setTimeout(()=>{g.value=""},3e3)}catch(We){console.error("Erreur lors de la vrification du PIN:",We),g.value="Erreur lors de la vrification du code PIN"}}function Ht(){d.value=!1,f.value=null,g.value=""}function jt(){return c.value&&On.isPinCached(c.value.id)?{timeRemaining:On.getTimeRemaining(),isExpiringSoon:On.isExpiringSoon()}:null}async function Ye(ue){if(console.log("executePendingOperation appel avec:",ue),!ue){console.log("Aucune opration  excuter");return}const{type:K,data:Pe}=ue;console.log("Excution de l'opration:",K,"avec donnes:",Pe);try{switch(K){case"deleteSeason":console.log("Suppression de la saison ID:",Pe.seasonId),await FD(Pe.seasonId),console.log("Saison supprime, rechargement de la liste..."),e.value=await nh(),console.log("Nouvelle liste des saisons:",e.value);break;default:console.log("Type d'opration non reconnu:",K)}}catch(ke){console.error("Erreur lors de l'excution de l'opration:",ke),alert("Erreur lors de l'opration. Veuillez ressayer.")}}return(ue,K)=>{var Pe;return W(),Q("div",rV,[K[22]||(K[22]=m("div",{class:"text-center py-16 px-4"},[m("h1",{class:"text-6xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent animate-pulse"}," Slections Spectacle "),m("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto leading-relaxed"}," Grez facilement les slections pour vos spectacles. ")],-1)),m("div",sV,[m("div",iV,[(W(!0),Q(Dt,null,Vr(_.value,(ke,We)=>(W(),Q("div",{key:ke.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20"},[m("div",{onClick:Ve=>C(ke.slug),class:"text-center cursor-pointer"},[K[6]||(K[6]=m("div",{class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg"},[m("span",{class:"text-2xl"},"")],-1)),m("h2",aV,ve(ke.name),1),K[7]||(K[7]=m("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),K[8]||(K[8]=m("p",{class:"text-gray-300 text-sm"}," Cliquez pour accder ",-1))],8,oV),m("div",lV,[m("div",{class:"relative",onClick:K[0]||(K[0]=Nn(()=>{},["stop"]))},[m("button",{onClick:Ve=>x(We),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":r.value===We,"aria-haspopup":"true",title:"Options"},K[9]||(K[9]=[m("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,uV),r.value===We?(W(),Q("div",cV,[m("button",{onClick:Ve=>B(We),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Monter ",8,dV),m("button",{onClick:Ve=>$(We),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Descendre ",8,hV),K[10]||(K[10]=m("div",{class:"border-t border-white/10 my-1"},null,-1)),m("button",{onClick:Ve=>w(ke),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10",role:"menuitem"}," Supprimer ",8,fV)])):Se("",!0)])])]))),128))]),e.value.length>0?(W(),Q("div",pV,[m("button",{onClick:K[1]||(K[1]=ke=>s.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105"},"  Nouvelle saison ")])):Se("",!0),e.value.length===0?(W(),Q("div",mV,[K[11]||(K[11]=m("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[m("span",{class:"text-4xl"},"")],-1)),K[12]||(K[12]=m("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison cre",-1)),K[13]||(K[13]=m("p",{class:"text-gray-300 mb-8"},"Commencez par crer votre premire saison de spectacles !",-1)),m("button",{onClick:K[2]||(K[2]=ke=>s.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Crer ma premire saison ")])):Se("",!0)]),s.value?(W(),Q("div",gV,[m("div",_V,[K[18]||(K[18]=m("h2",{class:"text-2xl font-bold mb-6 text-white text-center"}," Nouvelle saison",-1)),m("div",vV,[K[14]||(K[14]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),gt(m("input",{"onUpdate:modelValue":K[3]||(K[3]=ke=>o.value=ke),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:j},null,544),[[xt,o.value]])]),m("div",yV,[K[15]||(K[15]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),gt(m("input",{"onUpdate:modelValue":K[4]||(K[4]=ke=>a.value=ke),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[xt,a.value]])]),m("div",wV,[K[16]||(K[16]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),gt(m("input",{"onUpdate:modelValue":K[5]||(K[5]=ke=>l.value=ke),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:O},null,544),[[xt,l.value]]),K[17]||(K[17]=m("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protgera les oprations sensibles (suppressions, slections)",-1))]),m("div",bV,[m("button",{onClick:T,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),m("button",{onClick:se,disabled:!o.value.trim()||!a.value.trim()||!l.value.trim()||l.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Crer ",8,IV)])])])):Se("",!0),i.value?(W(),Q("div",EV,[m("div",TV,[m("div",AV,[K[19]||(K[19]=m("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[m("span",{class:"text-2xl"},"")],-1)),K[20]||(K[20]=m("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),m("p",xV,'tes-vous sr de vouloir supprimer la saison "'+ve((Pe=c.value)==null?void 0:Pe.name)+'" ?',1)]),K[21]||(K[21]=m("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"},"  Cette action est irrversible et supprimera toutes les donnes de cette saison. ",-1)),m("div",{class:"flex justify-end space-x-3"},[m("button",{onClick:P,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),m("button",{onClick:I,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):Se("",!0),Ft(Bb,{show:d.value,message:k(),error:g.value,"session-info":jt(),onSubmit:A,onCancel:Ht},null,8,["show","message","error","session-info"])])}}};let En="mock",xi=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hlne"},{id:"p9",name:"Ismal"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"La"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],Si=[{id:"event1",title:"Aprock Septembre",date:"2025-09-08",description:"Soire apro-rock avec ambiance festive"},{id:"event2",title:"Match  Cambo",date:"2025-11-25",description:"Match d'improvisation comptitif  Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function PV(n){En=n}async function RV(){if(En!=="firebase"||!(await St(st(be,"seasons"))).empty)return;const e=Oe(st(be,"seasons"));await Rn(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:vp()});const t=await St(st(be,"players"));for(const o of t.docs)await Rn(Oe(e,"players",o.id),o.data());const r=await St(st(be,"events"));for(const o of r.docs)await Rn(Oe(e,"events",o.id),o.data());const s=await St(st(be,"availability"));for(const o of s.docs)await Rn(Oe(e,"availability",o.id),o.data());const i=await St(st(be,"selections"));for(const o of i.docs)await Rn(Oe(e,"selections",o.id),o.data())}async function CV(){En==="firebase"&&await RV()}async function j_(n=null){return(En==="firebase"?n?(await St(st(be,"seasons",n,"events"))).docs.map(t=>({id:t.id,...t.data()})):(await St(st(be,"events"))).docs.map(t=>({id:t.id,...t.data()})):Si).sort((t,r)=>{const s=new Date(t.date),i=new Date(r.date);return s<i?-1:s>i?1:t.title.localeCompare(r.title)})}async function ih(n=null){return(En==="firebase"?n?(await St(st(be,"seasons",n,"players"))).docs.map(t=>({id:t.id,...t.data()})):(await St(st(be,"players"))).docs.map(t=>({id:t.id,...t.data()})):xi).sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function kV(n,e=null){if(En==="firebase"){const t=Oe(e?st(be,"seasons",e,"players"):st(be,"players"));return await Rn(t,{name:n}),t.id}else{const t=`p${xi.length+1}`;return xi.push({id:t,name:n}),t}}async function DV(n,e=null){if(En==="firebase"){const t=e?Oe(be,"seasons",e,"players",n):Oe(be,"players",n);await pl(t);const r=e?await St(st(be,"seasons",e,"availability")):await St(st(be,"availability")),s=Kw(be);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else xi=xi.filter(t=>t.id!==n)}async function VV(n,e,t=null){if(En==="firebase"){const r=t?Oe(be,"seasons",t,"players",n):Oe(be,"players",n);await Rn(r,{name:e})}else{const r=xi.findIndex(s=>s.id===n);r!==-1&&(xi[r]=e)}}async function Ea(n,e,t=null){if(En==="firebase"){const r=t?await St(st(be,"seasons",t,"availability")):await St(st(be,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function Ta(n=null){if(En==="firebase"){const e=n?await St(st(be,"seasons",n,"selections")):await St(st(be,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function q_(n,e,t=null){if(En==="firebase"){const r=t?Oe(be,"seasons",t,"availability",n):Oe(be,"availability",n);await Rn(r,e)}}async function NV({seasonId:n,playerName:e,eventId:t,value:r}){if(En!=="firebase")return;const s=n?Oe(be,"seasons",n,"availability",e):Oe(be,"availability",e),i=await Di(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await Rn(s,a)}async function OV(n,e,t=null){if(En==="firebase"){const r=t?Oe(be,"seasons",t,"selections",n):Oe(be,"selections",n);await Rn(r,{players:e})}}async function MV(n,e=null){if(console.log("Suppression de l'vnement:",n),En==="firebase")try{console.log("Suppression de l'vnement dans Firestore");const t=e?Oe(be,"seasons",e,"events",n):Oe(be,"events",n);await pl(t),console.log("Suppression de la slection associe");const r=e?Oe(be,"seasons",e,"selections",n):Oe(be,"selections",n);await pl(r),console.log("Suppression des disponibilits");const s=e?await St(st(be,"seasons",e,"availability")):await St(st(be,"availability")),i=Kw(be);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){console.log("Mise  jour de la disponibilit pour:",o.id);const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),console.log("Oprations de suppression termines avec succs")}catch(t){throw console.error("Erreur lors de la suppression:",t),t}else Si=Si.filter(t=>t.id!==n)}async function LV(n,e=null){if(En==="firebase"){const t=Oe(e?st(be,"seasons",e,"events"):st(be,"events"));return await Rn(t,n),t.id}else{const t=`event${Si.length+1}`;return Si.push({id:t,...n}),t}}async function FV(n,e,t=null){if(En==="firebase"){const r=t?Oe(be,"seasons",t,"events",n):Oe(be,"events",n);await Rn(r,e)}else{const r=Si.findIndex(s=>s.id===n);r!==-1&&(Si[r]={id:n,...e})}}class UV{constructor(){this.sessions=new Map,this.sessionDuration=10*60*1e3}isPasswordCached(e){const t=this.sessions.get(e);return t?Date.now()-t.timestamp>this.sessionDuration?(this.sessions.delete(e),!1):!0:!1}getCachedPassword(e){const t=this.sessions.get(e);return t?Date.now()-t.timestamp>this.sessionDuration?(this.sessions.delete(e),null):t.password:null}saveSession(e,t){this.sessions.set(e,{password:t,timestamp:Date.now()})}clearSession(e){this.sessions.delete(e)}clearExpiredSessions(){const e=Date.now();for(const[t,r]of this.sessions.entries())e-r.timestamp>this.sessionDuration&&this.sessions.delete(t)}clearAllSessions(){this.sessions.clear()}}const bl=new UV,BV="modulepreload",$V=function(n){return"/impro-selector/"+n},z_={},Kn=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=$V(i),i in z_)return;z_[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":BV,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((d,f)=>{c.addEventListener("load",d),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function $b(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}async function jV(n,e,t,r=null){try{console.log(" [DEBUG] Dbut protectPlayer:",{playerId:n,email:e,seasonId:r});const s=await Kl(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est dj protg");const{collection:i,query:o,where:a,getDocs:l}=await Kn(()=>import("./index.esm-5f6892a5.js"),[]),{db:c}=await Kn(()=>Promise.resolve().then(()=>go),void 0),d=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(d,a("email","==",e)),g=await l(f);if(!g.empty&&g.docs.find($=>$.id!==n))throw new Error("Cette adresse email est dj utilise par un autre joueur");console.log(" [DEBUG] Cration du compte Firebase Auth...");const{createUserWithEmailAndPassword:_}=await Kn(()=>import("./index.esm-de81a525.js"),[]),{auth:C}=await Kn(()=>Promise.resolve().then(()=>go),void 0),x=await _(C,e,t);console.log(" [DEBUG] Compte Firebase Auth cr:",x.user.uid);const R=$b(t),L=r?Oe(c,"seasons",r,"playerProtection",n):Oe(c,"playerProtection",n);return await Rn(L,{playerId:n,email:e,passwordHash:R,firebaseUid:x.user.uid,isProtected:!0,createdAt:new Date}),console.log(" [DEBUG] Protection sauvegarde dans Firestore"),{success:!0}}catch(s){throw console.error(" [ERROR] Erreur lors de la protection du joueur:",s),s}}async function qV(n,e=null){try{const t=e?Oe(be,"seasons",e,"playerProtection",n):Oe(be,"playerProtection",n),r=await Kl(n,e),s=(r==null?void 0:r.email)||"";return await Rn(t,{playerId:n,email:s,isProtected:!1,updatedAt:new Date}),{success:!0,email:s}}catch(t){throw console.error("Erreur lors de la suppression de la protection:",t),t}}async function di(n,e=null){try{const t=e?Oe(be,"seasons",e,"playerProtection",n):Oe(be,"playerProtection",n),r=await Di(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return console.error("Erreur lors de la vrification de protection:",t),!1}}async function Kl(n,e=null){try{const t=e?Oe(be,"seasons",e,"playerProtection",n):Oe(be,"playerProtection",n),r=await Di(t);return r.exists()?r.data():null}catch(t){return console.error("Erreur lors de la rcupration des donnes de protection:",t),null}}async function jb(n,e=null){try{const t=await Kl(n,e);return(t==null?void 0:t.email)||""}catch(t){return console.error("Erreur lors de la rcupration de l'email:",t),""}}async function bc(n,e,t=null){try{const r=await Kl(n,t);if(!r||!r.isProtected)return!1;if(r.firebaseUid){console.log(" [DEBUG] Vrification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await Kn(()=>import("./index.esm-de81a525.js"),[]),{auth:i}=await Kn(()=>Promise.resolve().then(()=>go),void 0);return await s(i,r.email,e),console.log(" [DEBUG] Mot de passe Firebase Auth valide"),bl.saveSession(n,e),!0}catch(s){return console.log(" [DEBUG] Mot de passe Firebase Auth invalide:",s.code),!1}}else{console.log(" [DEBUG] Vrification avec hash local");const s=$b(e),i=r.passwordHash===s;return i&&bl.saveSession(n,e),i}}catch(r){return console.error("Erreur lors de la vrification du mot de passe:",r),!1}}function Wa(n){return bl.isPasswordCached(n)}async function Jh(n,e=null){try{console.log(" [DEBUG] Dbut sendPasswordResetEmail:",{playerId:n,seasonId:e});const t=await Kl(n,e);if(console.log(" [DEBUG] Protection data:",t),!t||!t.isProtected)throw new Error("Joueur non protg");if(console.log(" [DEBUG] Email  utiliser:",t.email),t.firebaseUid){console.log(" [DEBUG] Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await Kn(()=>import("./index.esm-de81a525.js"),[]),{auth:s}=await Kn(()=>Promise.resolve().then(()=>go),void 0);console.log(" [DEBUG] Tentative d'envoi d'email :",t.email),await r(s,t.email),console.log(" [DEBUG] Email envoy avec succs via Firebase Auth!"),console.log(" [DEBUG] Vrifiez votre bote mail:",t.email)}else{console.log(" [DEBUG] Pas de compte Firebase Auth, cration temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await Kn(()=>import("./index.esm-de81a525.js"),[]),{auth:i}=await Kn(()=>Promise.resolve().then(()=>go),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);console.log(" [DEBUG] Compte temporaire cr:",a.user.uid),await s(i,t.email),console.log(" [DEBUG] Email envoy avec succs!");const{updateDoc:l}=await Kn(()=>import("./index.esm-5f6892a5.js"),[]),{db:c}=await Kn(()=>Promise.resolve().then(()=>go),void 0),d=e?Oe(c,"seasons",e,"playerProtection",n):Oe(c,"playerProtection",n);await l(d,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")console.log(" [DEBUG] Email dj utilis, tentative d'envoi direct..."),await s(i,t.email),console.log(" [DEBUG] Email envoy avec succs!");else throw a}}return{success:!0,message:"Email de rinitialisation envoy ! Vrifiez votre bote de rception."}}catch(t){throw console.error(" [ERROR] Erreur lors de l'envoi de l'email de rinitialisation:",t),console.error(" [ERROR] Code d'erreur:",t.code),console.error(" [ERROR] Message d'erreur:",t.message),t.code==="auth/user-not-found"?new Error("Aucun compte trouv avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez ressayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}const Bp="magicLinks";function $p({seasonId:n,playerId:e,eventId:t}){return`${n}__${e}__${t}`}function zV(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function G_({seasonId:n,playerId:e,eventId:t,action:r}){const s=$p({seasonId:n,playerId:e,eventId:t}),i=zV(40),o=Oe(be,Bp,s),a=Date.now()+1e3*60*60*24*7;await Rn(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const c=`${window.location.origin+"/impro-selector/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:c}}async function GV({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=$p({seasonId:n,playerId:e,eventId:t}),o=Oe(be,Bp,i),a=await Di(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function KV({seasonId:n,playerId:e,eventId:t}){const r=$p({seasonId:n,playerId:e,eventId:t}),s=Oe(be,Bp,r);await pl(s)}async function HV({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,reason:o="new_event",fromEmail:a=void 0}){const l=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>Disponibilit demande</h2>
      <p>Bonjour ${e},</p>
      <p>Peux-tu indiquer ta disponibilit pour <strong>${t}</strong> (${r}) ?</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;margin-right:8px;background:#16a34a;color:#fff;border-radius:8px;text-decoration:none;">Je suis dispo </a>
        <a href="${i}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Pas dispo </a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: ${o}</p>
    </div>
  `,c=`Disponibilit demande  ${t}`,d={to:n,message:{subject:c,html:l},createdAt:vp(),meta:{reason:o,eventTitle:t,eventDate:r,playerName:e}};return a&&(d.from=a,d.replyTo=a),await Gw(st(be,"mail"),d),{success:!0}}const WV={class:"text-center mb-6"},QV={class:"text-lg text-gray-300"},JV={class:"mb-6"},YV={class:"flex items-center space-x-3"},XV={class:"text-2xl"},ZV={class:"font-semibold text-white"},eN={class:"text-sm text-gray-300"},tN={class:"mb-6"},nN={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-1"},rN={key:0,class:"mb-6"},sN={class:"space-y-4"},iN=["disabled"],oN={key:0,class:"animate-spin"},aN={key:1},lN={key:1,class:"mb-6"},uN={key:0,class:"space-y-4 mb-4"},cN=["disabled"],dN={key:0,class:"animate-spin"},hN={key:1},fN=["disabled"],pN={key:2,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},mN={class:"text-red-300 text-sm"},gN={key:3,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},_N={class:"text-green-300 text-sm"},vN={__name:"PlayerProtectionModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","update"],setup(n,{emit:e}){const t=n,r=e,s=q(!1),i=q(""),o=q(""),a=q(""),l=q(!1),c=q(""),d=q(""),f=q(!1),g=q(!1),_=q(""),C=Xt(()=>i.value&&o.value&&a.value&&o.value===a.value&&o.value.length>=6&&i.value.includes("@"));async function x(){var j;if((j=t.player)!=null&&j.id&&(s.value=await di(t.player.id,t.seasonId),!s.value)){const O=await jb(t.player.id,t.seasonId);O&&(i.value=O)}}async function R(){if(C.value){l.value=!0,c.value="",d.value="";try{await jV(t.player.id,i.value,o.value,t.seasonId),d.value="Protection active avec succs !",s.value=!0,i.value="",o.value="",a.value="",r("update")}catch(j){console.error("Erreur lors de l'activation de la protection:",j),j.message&&j.message.includes("email")?c.value="Cette adresse email est dj utilise par un autre joueur.":c.value="Erreur lors de l'activation de la protection. Veuillez ressayer."}finally{l.value=!1}}}function L(){g.value=!0,_.value="",c.value=""}async function B(){if(_.value){l.value=!0,c.value="",d.value="";try{if(!await bc(t.player.id,_.value,t.seasonId)){c.value="Mot de passe incorrect. Veuillez ressayer.";return}const O=await qV(t.player.id,t.seasonId);d.value="Protection dsactive avec succs !",s.value=!1,g.value=!1,_.value="",O.email&&(i.value=O.email),r("update")}catch(j){console.error("Erreur lors de la dsactivation de la protection:",j),c.value="Erreur lors de la dsactivation de la protection. Veuillez ressayer."}finally{l.value=!1}}}function $(){r("close")}return sr(()=>t.player,()=>{t.show&&t.player&&x()},{immediate:!0}),sr(()=>t.show,j=>{j&&t.player&&(o.value="",a.value="",c.value="",d.value="",f.value=!1,g.value=!1,_.value="",x())}),(j,O)=>{var se;return n.show?(W(),Q("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:$},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:O[6]||(O[6]=Nn(()=>{},["stop"]))},[m("div",WV,[O[7]||(O[7]=m("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[m("span",{class:"text-2xl"},"")],-1)),O[8]||(O[8]=m("h2",{class:"text-2xl font-bold text-white mb-2"},"Protection du joueur",-1)),m("p",QV,ve((se=n.player)==null?void 0:se.name),1)]),m("div",JV,[m("div",{class:tr(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[m("div",YV,[m("span",XV,ve(s.value?"":""),1),m("div",null,[m("div",ZV,ve(s.value?"Protg":"Non protg"),1),m("div",eN,ve(s.value?"Modifications scurises":"Modifications libres"),1)])])],2)]),m("div",tN,[m("button",{onClick:O[0]||(O[0]=T=>f.value=!f.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[O[9]||(O[9]=m("h3",{class:"text-sm font-semibold text-blue-300"}," Pourquoi protger son joueur ?",-1)),m("span",{class:tr(["text-blue-300 transition-transform duration-200",{"rotate-180":f.value}])},"",2)]),f.value?(W(),Q("div",nN,O[10]||(O[10]=[m("div",null,[jn(" "),m("span",{class:"text-blue-300"},"Protection des disponibilits :"),jn(" Seul vous pouvez modifier vos disponibilits")],-1),m("div",null,[jn(" "),m("span",{class:"text-blue-300"},"Protection du nom :"),jn(" Seul vous pouvez changer votre nom de joueur")],-1),m("div",null,[jn(" "),m("span",{class:"text-blue-300"},"Email requis :"),jn(" Permet de rinitialiser le mot de passe en cas d'oubli")],-1)]))):Se("",!0)]),s.value?Se("",!0):(W(),Q("div",rN,[O[14]||(O[14]=m("h3",{class:"text-lg font-semibold text-white mb-4"}," Activer la protection",-1)),m("div",sN,[m("div",null,[O[11]||(O[11]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),gt(m("input",{"onUpdate:modelValue":O[1]||(O[1]=T=>i.value=T),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[xt,i.value]])]),m("div",null,[O[12]||(O[12]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),gt(m("input",{"onUpdate:modelValue":O[2]||(O[2]=T=>o.value=T),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe scuris"},null,512),[[xt,o.value]])]),m("div",null,[O[13]||(O[13]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),gt(m("input",{"onUpdate:modelValue":O[3]||(O[3]=T=>a.value=T),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[xt,a.value]])])]),m("button",{onClick:R,disabled:!C.value||l.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[l.value?(W(),Q("span",oN,"")):(W(),Q("span",aN,"")),m("span",null,ve(l.value?"Activation...":"Activer la protection"),1)],8,iN)])),s.value?(W(),Q("div",lN,[O[17]||(O[17]=m("h3",{class:"text-lg font-semibold text-white mb-4"}," Dsactiver la protection",-1)),O[18]||(O[18]=m("p",{class:"text-sm text-gray-300 mb-4"}," Attention : dsactiver la protection supprimera dfinitivement le mot de passe et l'email associs. ",-1)),g.value?(W(),Q("div",uN,[m("div",null,[O[15]||(O[15]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe de confirmation",-1)),gt(m("input",{"onUpdate:modelValue":O[4]||(O[4]=T=>_.value=T),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe pour confirmer"},null,512),[[xt,_.value]])]),m("button",{onClick:B,disabled:!_.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[l.value?(W(),Q("span",dN,"")):(W(),Q("span",hN,"")),m("span",null,ve(l.value?"Dsactivation...":"Confirmer la dsactivation"),1)],8,cN),m("button",{onClick:O[5]||(O[5]=T=>g.value=!1),class:"w-full px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])):Se("",!0),g.value?Se("",!0):(W(),Q("button",{key:1,onClick:L,disabled:l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},O[16]||(O[16]=[m("span",null,"",-1),m("span",null,"Dsactiver la protection",-1)]),8,fN))])):Se("",!0),c.value?(W(),Q("div",pN,[m("div",mN,ve(c.value),1)])):Se("",!0),d.value?(W(),Q("div",gN,[m("div",_N,ve(d.value),1)])):Se("",!0),m("div",{class:"flex justify-center"},[m("button",{onClick:$,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):Se("",!0)}}},yN={class:"text-center mb-6"},wN={class:"text-lg text-gray-300"},bN={class:"mb-6"},IN={class:"space-y-4"},EN=["disabled"],TN={key:0,class:"animate-spin"},AN={key:1},xN={class:"mb-6 text-center"},SN={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},PN={class:"text-red-300 text-sm"},RN={class:"text-center mb-6"},CN={class:"text-lg text-gray-300"},kN={class:"mb-6"},DN=["disabled"],VN={key:0,class:"animate-spin"},NN={key:1},ON={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},MN={class:"text-red-300 text-sm"},LN={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},FN={class:"text-green-300 text-sm"},UN={class:"flex justify-center"},BN={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=q(""),i=q(!1),o=q(""),a=q(!1),l=q(""),c=q(""),d=q(null);async function f(){if(s.value){i.value=!0,o.value="";try{const C=await Qh(t.seasonId);if(s.value===C){r("verified",{type:"season_pin"}),_();return}await bc(t.player.id,s.value,t.seasonId)?(r("verified",{type:"player_password"}),_()):o.value="Mot de passe incorrect. Veuillez ressayer."}catch(C){console.error("Erreur lors de la vrification:",C),o.value="Erreur lors de la vrification. Veuillez ressayer."}finally{i.value=!1}}}async function g(){i.value=!0,l.value="",c.value="";try{const C=await Jh(t.player.id,t.seasonId);c.value=C.message||"Email de rinitialisation envoy ! Vrifiez votre bote de rception."}catch(C){console.error("Erreur lors de l'envoi de l'email:",C),l.value="Erreur lors de l'envoi de l'email. Veuillez ressayer."}finally{i.value=!1}}function _(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return sr(()=>t.show,C=>{C&&Fr(()=>{d.value&&d.value.focus()})}),(C,x)=>{var R,L;return W(),Q(Dt,null,[n.show?(W(),Q("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:_},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:x[2]||(x[2]=Nn(()=>{},["stop"]))},[m("div",yN,[x[6]||(x[6]=m("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[m("span",{class:"text-2xl"},"")],-1)),x[7]||(x[7]=m("h2",{class:"text-2xl font-bold text-white mb-2"},"Vrification requise",-1)),m("p",wN,ve((R=n.player)==null?void 0:R.name),1),x[8]||(x[8]=m("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protg par mot de passe",-1))]),m("div",bN,[m("div",IN,[m("div",null,[x[9]||(x[9]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),gt(m("input",{"onUpdate:modelValue":x[0]||(x[0]=B=>s.value=B),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:Sn(f,["enter"]),ref_key:"passwordInput",ref:d},null,544),[[xt,s.value]])])]),m("button",{onClick:f,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(W(),Q("span",TN,"")):(W(),Q("span",AN,"")),m("span",null,ve(i.value?"Vrification...":"Vrifier"),1)],8,EN)]),m("div",xN,[m("button",{onClick:x[1]||(x[1]=B=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oubli ? ")]),o.value?(W(),Q("div",SN,[m("div",PN,ve(o.value),1)])):Se("",!0),m("div",{class:"flex justify-center"},[m("button",{onClick:_,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):Se("",!0),a.value?(W(),Q("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:x[5]||(x[5]=B=>a.value=!1)},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:x[4]||(x[4]=Nn(()=>{},["stop"]))},[m("div",RN,[x[10]||(x[10]=m("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[m("span",{class:"text-2xl"},"")],-1)),x[11]||(x[11]=m("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oubli",-1)),m("p",CN,ve((L=n.player)==null?void 0:L.name),1)]),m("div",kN,[x[12]||(x[12]=m("p",{class:"text-sm text-gray-300 mb-4"}," Un email de rinitialisation sera envoy  l'adresse associe  ce joueur. ",-1)),m("button",{onClick:g,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(W(),Q("span",VN,"")):(W(),Q("span",NN,"")),m("span",null,ve(i.value?"Envoi...":"Envoyer l'email"),1)],8,DN)]),l.value?(W(),Q("div",ON,[m("div",MN,ve(l.value),1)])):Se("",!0),c.value?(W(),Q("div",LN,[m("div",FN,ve(c.value),1)])):Se("",!0),m("div",UN,[m("button",{onClick:x[3]||(x[3]=B=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):Se("",!0)],64)}}},$N={class:"relative text-center p-6 pb-4 border-b border-white/10"},jN={class:"text-2xl md:text-3xl font-bold text-white mb-1"},qN={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},zN={class:"grid grid-cols-3 gap-3 md:gap-4"},GN={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},KN={class:"text-xl md:text-2xl font-bold text-white"},HN={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},WN={class:"text-xl md:text-2xl font-bold text-white"},QN={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},JN={class:"text-xl md:text-2xl font-bold text-white"},YN={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},XN={key:0,class:"md:hidden mt-3 space-y-2"},ZN={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},eO={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},tO={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},nO={class:"mb-6"},rO={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null}},emits:["close","update","delete","refresh"],setup(n,{emit:e}){const t=n,r=e,s=q(!1),i=q(""),o=q(null),a=q(!1),l=q(!1),c=q(null),d=q(!1);function f(){r("close")}function g(){var j;i.value=((j=t.player)==null?void 0:j.name)||"",s.value=!0,Fr(()=>{o.value&&o.value.focus()})}function _(){s.value=!1,i.value=""}async function C(){var O,se;if(!i.value.trim())return;if(await di((O=t.player)==null?void 0:O.id,t.seasonId)){Wa((se=t.player)==null?void 0:se.id)?x():(c.value="update",l.value=!0);return}x()}function x(){var j;r("update",{playerId:(j=t.player)==null?void 0:j.id,newName:i.value.trim()}),s.value=!1,i.value=""}async function R(){var O,se;if(await di((O=t.player)==null?void 0:O.id,t.seasonId)){Wa((se=t.player)==null?void 0:se.id)?L():(c.value="delete",l.value=!0);return}L()}function L(){var j;r("delete",(j=t.player)==null?void 0:j.id)}function B(){r("refresh")}function $(j){c.value==="update"?x():c.value==="delete"&&L(),c.value=null}return sr(()=>t.show,j=>{j||(s.value=!1,i.value="",c.value=null)}),(j,O)=>{var se;return W(),Q(Dt,null,[n.show?(W(),Q("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:f},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:O[5]||(O[5]=Nn(()=>{},["stop"]))},[m("div",$N,[m("button",{onClick:f,class:"absolute right-3 top-3 text-white/80 hover:text-white"},""),O[9]||(O[9]=m("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[m("span",{class:"text-2xl md:text-3xl"},"")],-1)),m("h2",jN,ve((se=n.player)==null?void 0:se.name),1)]),m("div",qN,[m("div",null,[m("div",zN,[m("div",GN,[m("div",KN,ve(t.stats.availability),1),O[10]||(O[10]=m("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),m("div",HN,[m("div",WN,ve(t.stats.selection),1),O[11]||(O[11]=m("div",{class:"text-xs md:text-sm text-gray-300"},"Slectionns",-1))]),m("div",QN,[m("div",JN,ve(t.stats.ratio)+"%",1),O[12]||(O[12]=m("div",{class:"text-xs md:text-sm text-gray-300"},"Taux",-1))])])]),m("div",YN,[m("button",{onClick:g,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},O[13]||(O[13]=[m("span",null,"",-1),m("span",null,"Modifier",-1)])),m("button",{onClick:O[0]||(O[0]=T=>a.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},O[14]||(O[14]=[m("span",null,"",-1),m("span",null,"Protection",-1)])),m("button",{onClick:R,class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},O[15]||(O[15]=[m("span",null,"",-1),m("span",null,"Supprimer",-1)])),m("button",{onClick:f,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")]),d.value?(W(),Q("div",XN,[m("button",{onClick:O[1]||(O[1]=T=>{g(),d.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"},"  Modifier "),m("button",{onClick:O[2]||(O[2]=T=>{R(),d.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"},"  Supprimer ")])):Se("",!0)]),m("div",ZN,[m("button",{onClick:O[3]||(O[3]=T=>a.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},"  Protection "),m("button",{onClick:f,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer "),m("button",{onClick:O[4]||(O[4]=T=>d.value=!d.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"  ")])])])):Se("",!0),s.value?(W(),Q("div",eO,[m("div",tO,[O[17]||(O[17]=m("h2",{class:"text-2xl font-bold mb-6 text-white text-center"}," Modifier le joueur",-1)),m("div",nO,[O[16]||(O[16]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),gt(m("input",{"onUpdate:modelValue":O[6]||(O[6]=T=>i.value=T),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Sn(_,["esc"]),Sn(C,["enter"])],ref_key:"editNameInput",ref:o},null,544),[[xt,i.value]])]),m("div",{class:"flex justify-end space-x-3"},[m("button",{onClick:_,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),m("button",{onClick:C,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):Se("",!0),Ft(vN,{show:a.value,player:n.player,seasonId:n.seasonId,onClose:O[7]||(O[7]=T=>a.value=!1),onUpdate:B},null,8,["show","player","seasonId"]),Ft(BN,{show:l.value,player:n.player,seasonId:n.seasonId,onClose:O[8]||(O[8]=T=>l.value=!1),onVerified:$},null,8,["show","player","seasonId"])],64)}}},sO={class:"relative p-5 pb-4 border-b border-white/10"},iO={key:0,class:"text-sm text-purple-300 mt-1"},oO={class:"px-4 md:px-6 py-4 md:py-6 space-y-4 overflow-y-auto"},aO={class:"relative"},lO=["value"],uO=["title"],cO={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},dO={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},hO={class:"text-sm text-gray-300"},fO={key:0,class:"mb-1"},pO={key:1},mO={__name:"AnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},message:{type:String,default:""},isPartial:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=n,r=e,s=q(!1),i=q("Copier le message");function o(){r("close")}function a(c){var f;return c?(typeof c=="string"?new Date(c):((f=c.toDate)==null?void 0:f.call(c))||c).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function l(){const c=t.message||"";navigator.clipboard.writeText(c).then(()=>{s.value=!0,i.value="Copi !",setTimeout(()=>{s.value=!1,i.value="Copier le message"},2e3)}).catch(d=>{console.error("Erreur lors de la copie du texte:",d),alert("Impossible de copier le message.")})}return(c,d)=>n.show?(W(),Q("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:o},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:d[0]||(d[0]=Nn(()=>{},["stop"]))},[m("div",sO,[m("button",{onClick:o,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},""),d[1]||(d[1]=m("h2",{class:"text-xl md:text-2xl font-bold text-white pr-10"},"Annoncer la slection",-1)),n.event?(W(),Q("p",iO,ve(n.event.title)+"  "+ve(a(n.event.date)),1)):Se("",!0)]),m("div",oO,[d[4]||(d[4]=m("div",{class:"bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20 p-3"},[m("p",{class:"text-blue-200 text-sm"},"Le message ci-dessous est prt  tre copi/coll dans WhatsApp, Messenger, email, etc.")],-1)),m("div",aO,[m("textarea",{value:n.message,class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",rows:"6",readonly:""},null,8,lO),m("button",{onClick:l,class:"absolute top-2 right-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg p-2 hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:i.value},[s.value?(W(),Q("svg",dO,d[3]||(d[3]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(W(),Q("svg",cO,d[2]||(d[2]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2z"},null,-1)])))],8,uO)]),m("div",hO,[n.isPartial?(W(),Q("p",fO,"Note: cette annonce concerne une mise  jour partielle de la slection.")):(W(),Q("p",pO,"Vrifie le message si besoin avant de l'envoyer."))])]),m("div",{class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},[m("button",{onClick:l,class:"h-12 px-4 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 flex-1"},"  Copier "),m("button",{onClick:o,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer ")])])])):Se("",!0)}},gO={class:"relative text-center p-6 pb-4 border-b border-white/10"},_O={class:"text-2xl md:text-3xl font-bold text-white mb-1"},vO={class:"text-sm md:text-base text-purple-300"},yO={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},wO={key:0,class:"mb-3"},bO={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},IO={class:"text-white font-medium"},EO={key:0,class:"text-purple-400 mr-2"},TO={key:1,class:"text-green-400 mr-2"},AO={key:2,class:"text-red-400 mr-2"},xO={key:3,class:"text-gray-400 mr-2"},SO={key:1,class:"mb-3"},PO={class:"grid grid-cols-3 gap-2 md:gap-3 mb-3"},RO={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},CO={class:"text-cyan-300 text-lg md:text-xl font-semibold"},kO={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},DO={class:"text-green-400 text-lg md:text-xl font-semibold"},VO={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},NO={class:"text-purple-400 text-lg md:text-xl font-semibold"},OO={key:2,class:"mb-3"},MO={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},LO={class:"flex-1"},FO={class:"text-blue-300 text-sm font-medium"},UO={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},BO=["disabled","title"],$O=["disabled"],jO={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})}},emits:["close","selection","perfect"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=q(!1),o=q("Copier le message"),a=q(!1),l=q(!1),c=q(""),d=q(!1),f=Xt(()=>r.currentSelection&&r.currentSelection.length>0),g=Xt(()=>{var k;if(!f.value)return!1;const w=r.currentSelection.some(D=>!$(D)),I=((k=r.event)==null?void 0:k.playerCount)||6,P=r.availableCount<I;return w||P});Xt(()=>{var P;if(!g.value)return"";const w=r.currentSelection.filter(k=>!$(k)),I=((P=r.event)==null?void 0:P.playerCount)||6;return w.length>0?w.length===1?`${w[0]} n'est plus disponible. Veuillez relancer la slection.`:`${w.length} joueurs ne sont plus disponibles. Veuillez relancer la slection.`:r.availableCount<I?`Seulement ${r.availableCount} joueurs disponibles pour ${I} requis. Veuillez attendre plus de disponibilits ou ajuster le nombre de joueurs  slectionner.`:"Slection incomplte"});const _=Xt(()=>{if(!r.event||!f.value)return"";const w=C(r.event.date),I=r.currentSelection.join(", ");return`Slection pour ${r.event.title} du ${w} : ${I}`});sr(()=>r.show,w=>{w&&(i.value=!1,o.value="Copier le message",l.value=!1,c.value="",d.value=!1,a.value=!1)});function C(w){var P;return w?(typeof w=="string"?new Date(w):((P=w.toDate)==null?void 0:P.call(w))||w).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function x(){s("selection")}function R(){s("perfect")}function L(){s("close")}function B(){a.value=!0}function $(w){return r.playerAvailability[w]===!0}function j(w){return r.playerAvailability[w]===!1}function O(w){return r.currentSelection.includes(w)&&$(w)}function se(w=!1,I=!1){if(d.value=w,w){const P=C(r.event.date),k=r.currentSelection.join(", ");I?c.value=`Slection mise  jour pour ${r.event.title} du ${P} : ${k}`:c.value=`Nouvelle slection pour ${r.event.title} du ${P} : ${k}`}else c.value="Slection effectue avec succs !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function T(){l.value=!1}return e({showSuccess:se}),(w,I)=>{var P,k,D;return W(),Q(Dt,null,[n.show?(W(),Q("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:L},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:I[0]||(I[0]=Nn(()=>{},["stop"]))},[m("div",gO,[m("button",{onClick:L,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},""),I[2]||(I[2]=m("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[m("span",{class:"text-3xl"},"")],-1)),m("h2",_O,"Slection pour "+ve((P=n.event)==null?void 0:P.title),1),m("p",vO,ve(C((k=n.event)==null?void 0:k.date)),1)]),m("div",yO,[f.value?(W(),Q("div",wO,[I[3]||(I[3]=m("h3",{class:"text-base md:text-lg font-semibold text-white mb-2"},"Joueurs slectionns",-1)),m("div",bO,[(W(!0),Q(Dt,null,Vr(n.currentSelection,A=>(W(),Q("div",{key:A,class:tr(["bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 rounded-lg border border-green-500/30 text-center",{"from-red-500/20 to-red-600/20 border-red-500/30":!$(A),"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":j(A)}])},[m("span",IO,[O(A)?(W(),Q("span",EO,"")):$(A)?(W(),Q("span",TO,"")):j(A)?(W(),Q("span",AO,"")):(W(),Q("span",xO,"")),jn(" "+ve(A),1)])],2))),128))])])):Se("",!0),g.value?(W(),Q("div",SO,I[4]||(I[4]=[m("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[m("div",{class:"text-yellow-400"},""),m("div",{class:"text-yellow-200 text-sm"},"Slection incomplte. Vrifie ci-dessous.")],-1)]))):Se("",!0),m("div",PO,[m("div",RO,[m("div",CO,ve(((D=n.event)==null?void 0:D.playerCount)||6),1),I[5]||(I[5]=m("div",{class:"text-xs md:text-sm text-gray-400"}," slectionner",-1))]),m("div",kO,[m("div",DO,ve(n.availableCount),1),I[6]||(I[6]=m("div",{class:"text-xs md:text-sm text-gray-400"},"Disponibles",-1))]),m("div",VO,[m("div",NO,ve(n.selectedCount),1),I[7]||(I[7]=m("div",{class:"text-xs md:text-sm text-gray-400"},"Slectionns",-1))])]),l.value?(W(),Q("div",OO,[m("div",MO,[I[9]||(I[9]=m("div",{class:"text-blue-400 text-xl"},"",-1)),m("div",LO,[m("p",FO,ve(c.value),1)]),m("button",{onClick:T,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},I[8]||(I[8]=[m("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):Se("",!0)]),m("div",UO,[m("button",{onClick:x,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":f.value?"Relancer la slection automatique":"Lancer la slection automatique"},I[10]||(I[10]=[jn("  "),m("span",{class:"hidden sm:inline"},"Slection Auto",-1),m("span",{class:"sm:hidden"},"Auto",-1)]),8,BO),f.value?(W(),Q("button",{key:0,onClick:R,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap"},I[11]||(I[11]=[jn("  "),m("span",{class:"hidden sm:inline"},"Parfait",-1)]))):Se("",!0),m("button",{onClick:B,disabled:!f.value,class:"h-12 px-3 md:px-4 bg-gray-700 text-white rounded-lg flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},I[12]||(I[12]=[jn("  "),m("span",{class:"hidden sm:inline"},"Annoncer",-1)]),8,$O)])])])):Se("",!0),Ft(mO,{show:a.value,event:n.event,message:_.value,"is-partial":d.value,onClose:I[1]||(I[1]=A=>a.value=!1)},null,8,["show","event","message","is-partial"])],64)}}};const qO={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},zO={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},GO={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},KO={class:"flex items-stretch relative"},HO={class:"flex-1 overflow-hidden"},WO=["onClick"],QO=["title"],JO=["title"],YO=["title","onClick"],XO=["title","onClick"],ZO={class:"table-auto border-separate border-spacing-0 table-fixed w-full min-w-max"},e2=["data-player-id"],t2={class:"p-4 md:p-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900"},n2={class:"font-bold text-xl md:text-2xl whitespace-pre-wrap flex items-center"},r2={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protg par mot de passe"},s2=["onClick","title"],i2=["onClick"],o2={class:"flex items-center justify-center"},a2=["title"],l2=["title"],u2=["title"],c2=["title"],d2={class:"border-t border-white/10"},h2={class:"p-4 md:p-5 sticky left-0 z-40 bg-gray-900"},f2={class:"flex items-center"},p2={key:0,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-50"},m2={class:"flex items-center space-x-2"},g2={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},_2={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},v2={class:"mb-6"},y2={class:"mb-6"},w2={class:"mb-6"},b2={class:"mb-6"},I2={key:2,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},E2={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},T2={class:"mb-6"},A2={class:"flex justify-end space-x-3"},x2={key:3,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},S2={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},P2={class:"flex justify-end space-x-3"},R2={key:4,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},C2={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},k2={class:"flex justify-end space-x-3"},D2={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},V2={class:"relative text-center p-6 pb-4 border-b border-white/10"},N2={class:"text-2xl md:text-3xl font-bold text-white mb-1"},O2={class:"text-sm md:text-base text-purple-300"},M2={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},L2={key:0,class:"mb-4 md:mb-6"},F2={class:"text-gray-300 bg-gray-800/50 p-4 rounded-lg border border-gray-600/50"},U2={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},B2={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},$2={class:"text-xl md:text-2xl font-bold text-white"},j2={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},q2={class:"text-xl md:text-2xl font-bold text-white"},z2={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},G2={class:"text-xl md:text-2xl font-bold text-white"},K2={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},H2={key:1,class:"md:hidden mt-3 space-y-2"},W2={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},Q2={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},J2={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},Y2={class:"mb-6"},X2={class:"mb-6"},Z2={class:"mb-6"},eM={class:"mb-6"},tM={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},nM={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},rM={class:"mb-6"},sM={class:"space-y-4"},iM=["disabled"],oM={key:0,class:"animate-spin"},aM={key:1},lM={class:"mb-6 text-center"},uM={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},cM={class:"text-red-300 text-sm"},dM={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},hM={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},fM={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},pM={class:"space-y-4"},mM={class:"mt-2 text-center"},gM={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},_M={class:"text-red-300 text-sm"},vM={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},yM=["disabled"],wM={key:0,class:"animate-spin"},bM={key:1},IM={class:"mb-6"},EM=["disabled"],TM={key:0,class:"animate-spin"},AM={key:1},xM={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},SM={class:"text-red-300 text-sm"},PM={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},RM={class:"text-green-300 text-sm"},CM={class:"flex justify-center"},kM={class:"mb-6"},DM=["disabled"],VM={key:0,class:"animate-spin"},NM={key:1},OM={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},MM={class:"text-red-300 text-sm"},LM={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},FM={class:"text-green-300 text-sm"},UM={class:"flex justify-center"},BM={__name:"GridBoard",props:{slug:{type:String,required:!0}},setup(n){const e=q(null),t=q(64);_o(async()=>{await Fr();const S=e.value;t.value=S?S.offsetHeight:64,window.addEventListener("resize",r)}),xv(()=>{window.removeEventListener("resize",r)});function r(){const S=e.value;t.value=S?S.offsetHeight:64}const s=n,i=Lc(),o=s.slug,a=q(""),l=q(""),c=q(!1),d=q(null),f=q(null),g=q(""),_=q(""),C=q(6),x=q(!1),R=q(""),L=q(null),B=q(!1),$=q(null),j=q(!1),O=q(null),se=q(!1),T=q(null),w=q(""),I=q(!1),P=q(null),k=q(""),D=q(""),A=q(!1),Ht=q(null),jt=q(!1),Ye=q(null),ue=q(""),K=q(""),Pe=q(!1),ke=q(null),We=q(!1),Ve=q(!1),Qe=q(""),fn=q(""),Tn=q(!1),qt=q(!1),G=q(""),me=q(""),ce=q(!1),ie=q(null),Ne=q(""),ze=q(!1),b=q(!1),E=q(null),M=q(null),X=q(new Set),z=q(null),Z=q(!1),he=q(!1),oe=q(0),ne=q(null),ee=q(null);function Ie(){const S=z.value;if(!S)return;const{scrollLeft:y,scrollWidth:H,clientWidth:_e}=S;Z.value=y>2,he.value=y<H-_e-2}function fe(S){L.value=S;const y=document.querySelector(`[data-player-id="${S}"]`);y&&y.scrollIntoView({behavior:"smooth",block:"center"}),ae.value=!0,Ee.value="Nouveau joueur ajout !",setTimeout(()=>{ae.value=!1},3e3)}function we(S){return X.value.has(S)}async function Re(){if(!l.value)return;const S=new Set;for(const y of et.value)await di(y.id,l.value)&&S.add(y.id);X.value=S}const ae=q(!1),Ee=q("");async function je(S){await ur({type:"deleteEvent",data:{eventId:S}})}async function Wt(S=null){const y=S||d.value;if(console.log("deleteEventConfirmed - eventId param:",S),console.log("deleteEventConfirmed - eventToDelete.value:",d.value),console.log("deleteEventConfirmed - eventIdToDelete:",y),console.log("deleteEventConfirmed - type de eventIdToDelete:",typeof y),!y){console.error("Aucun vnement  supprimer");return}try{await MV(y,l.value),ut.value=ut.value.filter(H=>H.id!==y),await Promise.all([j_(l.value),Ea(et.value,ut.value,l.value),Ta(l.value)]).then(([H,_e,Te])=>{ut.value=H,Ct.value=_e,at.value=Te}),c.value=!1,d.value=null,ae.value=!0,Ee.value="vnement supprim avec succs !",setTimeout(()=>{ae.value=!1},3e3)}catch(H){console.error("Erreur lors de la suppression de l'vnement:",H),alert("Erreur lors de la suppression de l'vnement. Veuillez ressayer.")}}function Ot(){c.value=!1,d.value=null}async function an(){if(!f.value||!g.value.trim()||!_.value)return;const S=parseInt(C.value);if(isNaN(S)||S<1||S>20){alert("Le nombre de joueurs doit tre un nombre entier entre 1 et 20");return}try{const y={title:g.value.trim(),date:_.value,description:Ne.value.trim()||"",playerCount:S};await FV(f.value,y,l.value),await la({eventId:f.value,eventData:y,reason:"updated"}),await Promise.all([j_(l.value),Ea(et.value,ut.value,l.value),Ta(l.value)]).then(([H,_e,Te])=>{ut.value=H,Ct.value=_e,at.value=Te}),f.value=null,g.value="",_.value="",Ne.value="",C.value=6,ae.value=!0,Ee.value="vnement mis  jour avec succs !",setTimeout(()=>{ae.value=!1},3e3)}catch(y){console.error("Erreur lors de l'dition de l'vnement:",y),alert("Erreur lors de l'dition de l'vnement. Veuillez ressayer.")}}async function Mt(){if(R.value.trim())try{const S=R.value.trim(),y=await kV(S,l.value);await Promise.all([ih(l.value),Ea(et.value,ut.value,l.value),Ta(l.value)]).then(([H,_e,Te])=>{et.value=H,Ct.value=_e,at.value=Te,Re();const Be=et.value.find(Xe=>Xe.id===y);fe(y);const Me=document.querySelector(`[data-player-id="${y}"]`);Me&&Me.scrollIntoView({behavior:"smooth",block:"center"}),ae.value=!0,Ee.value="Joueur ajout avec succs ! Vous pouvez maintenant indiquer sa disponibilit.",setTimeout(()=>{ae.value=!1},3e3),setTimeout(()=>{ae.value=!1,Ee.value=""},5e3)}),x.value=!1,R.value=""}catch(S){console.error("Erreur lors de l'ajout du joueur:",S),alert("Erreur lors de l'ajout du joueur. Veuillez ressayer.")}}function kn(){f.value=null,g.value="",_.value="",Ne.value="",C.value=6}q(null);const or=q(!1),wt=q(""),Qt=q(""),ar=q(""),Er=q(6);async function Hl(){if(!wt.value.trim()||!Qt.value){alert("Veuillez remplir le titre et la date de l'vnement");return}const S=parseInt(Er.value);if(isNaN(S)||S<1||S>20){alert("Le nombre de joueurs doit tre un nombre entier entre 1 et 20");return}const y={title:wt.value.trim(),date:Qt.value,description:ar.value.trim()||"",playerCount:S};await Wl(y)}async function Wl(S){try{const y=await LV(S,l.value);ut.value=[...ut.value,{id:y,...S}];const H={};for(const _e of et.value)H[_e.name]=Ct.value[_e.name]||{},H[_e.name][y]=null,await q_(_e.name,H[_e.name],l.value);wt.value="",Qt.value="",ar.value="",Er.value=6,or.value=!1,await Promise.resolve(),ae.value=!0,Ee.value="vnement cr avec succs !";try{await la({eventId:y,eventData:S,reason:"created"})}catch(_e){console.warn("Envoi des emails partiellement en chec:",_e)}setTimeout(()=>{ae.value=!1},3e3)}catch(y){console.error("Erreur lors de la cration de l'vnement:",(y==null?void 0:y.message)||y),alert("Erreur lors de la cration de l'vnement. Veuillez ressayer.")}}function Ks(){wt.value="",Qt.value="",ar.value="",Er.value=6,or.value=!1}async function Zo(){await ur({type:"addEvent",data:{}})}const ut=q([]),et=q([]),Ct=q({}),at=q({}),Ql=q({}),ns=q({});_o(async()=>{PV("firebase"),await CV();const S=Bw(st(be,"seasons"),fC("slug","==",s.slug)),y=await St(S);if(!y.empty){const H=y.docs[0];l.value=H.id,a.value=H.data().name,document.title=`Saison : ${a.value}`}if(l.value){const H=await St(st(be,"seasons",l.value,"players"));et.value=H.docs.map(Fe=>({id:Fe.id,...Fe.data()})),await Re();const _e=await St(st(be,"seasons",l.value,"events"));ut.value=_e.docs.map(Fe=>({id:Fe.id,...Fe.data(),playerCount:Fe.data().playerCount||6}));const Te=await St(st(be,"seasons",l.value,"availability")),Be={};Te.docs.forEach(Fe=>{const Yt=Fe.data(),At={};Object.keys(Yt).forEach(it=>{const te=Yt[it];te==="oui"?At[it]=!0:te==="non"?At[it]=!1:At[it]=te}),Be[Fe.id]=At}),Ct.value=Be;const Me=await St(st(be,"seasons",l.value,"selections")),Xe={};Me.docs.forEach(Fe=>{Xe[Fe.id]=Fe.data().players||[]}),at.value=Xe}Yn(),ra(),console.log("players (deduplicated):",et.value.map(H=>({id:H.id,name:H.name}))),console.log("availability loaded:",Ct.value),Fr(()=>{Ie();const H=z.value;H&&(H.addEventListener("scroll",_e=>{Ie(),oe.value=H.scrollLeft||0},{passive:!0}),window.addEventListener("resize",Ie))})});async function Jl(S,y){const H=et.value.find(Be=>Be.name===S);if(!H){console.error("Joueur non trouv:",S);return}if(!ut.value.find(Be=>Be.id===y)){console.error("vnement non trouv:",y);return}if(await di(H.id,l.value)){Wa(H.id)?Jt(H,y):await ia({type:"toggleAvailability",data:{player:H,eventId:y}});return}Jt(H,y)}function Jt(S,y){var Te;const H=(Te=Ct.value[S.name])==null?void 0:Te[y];console.log(`toggleAvailability - ${S.name} pour ${y}:`,H);let _e;H===!0?_e=!1:H===!1?_e=void 0:_e=!0,_e===void 0?Ct.value[S.name]&&delete Ct.value[S.name][y]:(Ct.value[S.name]||(Ct.value[S.name]={}),Ct.value[S.name][y]=_e),q_(S.name,Ct.value[S.name],l.value).then(()=>{ae.value=!0,Ee.value="Disponibilit mise  jour avec succs !",setTimeout(()=>{ae.value=!1},3e3)}).catch(Be=>{console.error("Erreur lors de la mise  jour de la disponibilit:",Be),alert("Erreur lors de la mise  jour de la disponibilit. Veuillez ressayer.")})}function Dn(S,y){var H;return(H=Ct.value[S])==null?void 0:H[y]}function rs(S,y){var Te;const H=at.value[y]||[],_e=(Te=Ct.value[S])==null?void 0:Te[y];return H.includes(S)&&_e===!0}async function Hs(S,y=6){const H=ut.value.find(Me=>Me.id===S),_e=(H==null?void 0:H.playerCount)||6,Te=at.value[S]||[];if(Te.length>0&&Te.every(Me=>Dn(Me,S))){console.log("Tous les joueurs slectionns sont disponibles, nouveau tirage complet");const Xe=et.value.filter(At=>Dn(At.name,S)).map(At=>{const it=ss(At.name);return{name:At.name,weight:1/(1+it)}}),Fe=[],Yt=[...Xe];for(;Fe.length<_e&&Yt.length>0;){const At=Yt.reduce(($e,An)=>$e+An.weight,0);let it=Math.random()*At;const te=Yt.findIndex($e=>(it-=$e.weight,it<=0));te>=0&&(Fe.push(Yt[te].name),Yt.splice(te,1))}at.value[S]=Fe}else{const Me=Te.filter(Fe=>Dn(Fe,S)),Xe=_e-Me.length;if(Xe<=0)at.value[S]=Me;else{const Fe=new Set(Me),At=et.value.filter($e=>Dn($e.name,S)&&!Fe.has($e.name)).map($e=>{const An=ss($e.name);return{name:$e.name,weight:1/(1+An)}}),it=[],te=[...At];for(;it.length<Xe&&te.length>0;){const $e=te.reduce((ji,ca)=>ji+ca.weight,0);let An=Math.random()*$e;const xr=te.findIndex(ji=>(An-=ji.weight,An<=0));xr>=0&&(it.push(te[xr].name),te.splice(xr,1))}at.value[S]=[...Me,...it]}}await OV(S,at.value[S],l.value),Yn(),ra()}async function Yl(S,y=6){var Me,Xe,Fe,Yt,At;console.log("tirerProtected appel avec eventId:",S),console.log("showSelectionModal.value AVANT:",b.value),console.log("selectionModalEvent.value?.id AVANT:",(Me=E.value)==null?void 0:Me.id);const H=b.value,_e=(Xe=E.value)==null?void 0:Xe.id,Te=at.value[S]&&at.value[S].length>0,Be=Te?[...at.value[S]]:[];if(await Hs(S,y),console.log("showSelectionModal.value APRS tirage:",b.value),console.log("selectionModalEvent.value?.id APRS tirage:",(Fe=E.value)==null?void 0:Fe.id),H&&!b.value&&(console.log("Restauration de la popin de slection..."),b.value=!0,E.value=ut.value.find(it=>it.id===_e)),b.value&&((Yt=E.value)==null?void 0:Yt.id)===S)if(console.log("Popin de slection ouverte, mise  jour..."),await Fr(),M.value&&M.value.showSuccess){console.log("Appel de showSuccess sur la popin de slection");const it=at.value[S]||[],te=Be.filter(An=>it.includes(An)),$e=te.length>0&&te.length<Be.length;M.value.showSuccess(Te,$e)}else console.log("selectionModalRef.value:",M.value),console.log("showSuccess disponible:",(At=M.value)==null?void 0:At.showSuccess);else console.log("Popin de slection ferme, affichage message global"),ae.value=!0,ut.value.find(it=>it.id===S),at.value[S],Te?Ee.value="Slection mise  jour avec succs !":Ee.value="Slection effectue avec succs !",setTimeout(()=>{ae.value=!1},3e3)}function _d(S){var H;return S?(typeof S=="string"?new Date(S):((H=S.toDate)==null?void 0:H.call(S))||S).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function lr(S){var H;return S?(typeof S=="string"?new Date(S):((H=S.toDate)==null?void 0:H.call(S))||S).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function ss(S){return Object.values(at.value).filter(y=>y.includes(S)).length}function ea(S){const y=Ct.value[S]||{};return Object.values(y).filter(H=>H===!0).length}function Tr(S){return S?Object.values(Ct.value).filter(y=>y[S]===!0).length:0}function ta(S){return S?(at.value[S]||[]).length:0}function na(S){const y=ea(S),H=ss(S);return y===0?0:H/y}function Mi(S){Ql.value[S]={availability:ea(S),selection:ss(S),ratio:na(S)}}function Yn(){et.value.forEach(S=>Mi(S.name))}function ra(){const S={};ut.value.forEach(y=>{const H=y.playerCount||6,Te=et.value.filter(Me=>Dn(Me.name,y.id)===!0).map(Me=>{const Xe=ss(Me.name);return{name:Me.name,weight:1/(1+Xe)}}),Be=Te.reduce((Me,Xe)=>Me+Xe.weight,0);Te.forEach(Me=>{const Xe=Math.min(1,Me.weight/Be*H);S[Me.name]||(S[Me.name]={}),S[Me.name][y.id]=Math.round(Xe*100)})}),ns.value=S}function Ws(S,y){var Me,Xe;const H=S.name,_e=Dn(H,y),Te=rs(H,y),Be=((Xe=(Me=ns.value)==null?void 0:Me[H])==null?void 0:Xe[y])??0;return _e===!1?"Non disponible  cliquez pour changer":Te?`Slectionn  Chance estime : ${Be}%`:_e===!0?`Disponible  Chance estime : ${Be}%`:"Cliquez pour indiquer votre disponibilit"}const is=q(null),os=q(!1);async function Xl(S=null){const y=S||is.value;if(!y){console.error("Aucun joueur  supprimer");return}try{await DV(y,l.value),et.value=et.value.filter(H=>H.id!==y),os.value=!1,is.value=null,ae.value=!0,Ee.value="Joueur supprim avec succs !",setTimeout(()=>{ae.value=!1},3e3)}catch(H){console.error("Erreur lors de la suppression du joueur :",H),alert("Erreur lors de la suppression du joueur. Veuillez ressayer.")}}function Zl(){os.value=!1,is.value=null}async function vd(S){Qs(),await di(S,l.value)?await Ar({type:"deletePlayer",data:{playerId:S}}):await ur({type:"deletePlayer",data:{playerId:S}})}async function Li(){if($.value){const S=ut.value.find(H=>H.id===$.value),y=(S==null?void 0:S.playerCount)||6;await Yl($.value,y),B.value=!1,$.value=null}}function eu(){B.value=!1,$.value=null}function sa(){return T.value?{deleteEvent:"Suppression d'vnement - Code PIN requis",addEvent:"Ajout d'vnement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de slection - Code PIN requis"}[T.value.type]||"Code PIN requis":"Veuillez saisir le code PIN  4 chiffres"}async function ur(S){if(On.isPinCached(l.value)){const y=On.getCachedPin(l.value);if(console.log("PIN en cache trouv, utilisation automatique"),await wc(l.value,y)){await cr(S);return}else On.clearSession()}T.value=S,se.value=!0}async function Ar(S){const y=S.data.playerId;if(Wa(y)){console.log("Mot de passe du joueur en cache trouv, utilisation automatique"),await cr(S);return}P.value=S,I.value=!0}async function ia(S){const y=S.data.player.id;if(Wa(y)){console.log("Mot de passe du joueur en cache trouv, utilisation automatique"),await cr(S);return}Ye.value=S,jt.value=!0}async function yd(S){try{if(await wc(l.value,S)){On.saveSession(l.value,S),se.value=!1;const H=T.value;T.value=null,await cr(H)}else w.value="Code PIN incorrect",setTimeout(()=>{w.value=""},3e3)}catch(y){console.error("Erreur lors de la vrification du PIN:",y),w.value="Erreur lors de la vrification du code PIN"}}function tu(){se.value=!1,T.value=null,w.value=""}async function oa(S){if(S){A.value=!0,k.value="";try{const y=P.value.data.playerId,H=await Qh(l.value);if(S===H){try{bl.saveSession(P.value.data.playerId,S)}catch{}I.value=!1;const Te=P.value;P.value=null,D.value="",await cr(Te);return}if(await bc(y,S,l.value)){I.value=!1;const Te=P.value;P.value=null,D.value="",await cr(Te)}else k.value="Mot de passe incorrect",setTimeout(()=>{k.value=""},3e3)}catch(y){console.error("Erreur lors de la vrification du mot de passe:",y),k.value="Erreur lors de la vrification du mot de passe"}finally{A.value=!1}}}function nu(){I.value=!1,P.value=null,k.value="",D.value="",A.value=!1}async function Fi(S){if(S){Pe.value=!0,ue.value="";try{const y=Ye.value.data.player,H=await Qh(l.value);if(S===H){try{bl.saveSession(Ye.value.data.player.id,S)}catch{}jt.value=!1;const Te=Ye.value;Ye.value=null,K.value="",await cr(Te);return}if(await bc(y.id,S,l.value)){jt.value=!1;const Te=Ye.value;Ye.value=null,K.value="",await cr(Te)}else ue.value="Mot de passe incorrect",setTimeout(()=>{ue.value=""},3e3)}catch(y){console.error("Erreur lors de la vrification du mot de passe:",y),ue.value="Erreur lors de la vrification du mot de passe"}finally{Pe.value=!1}}}function aa(){jt.value=!1,Ye.value=null,ue.value="",K.value="",Pe.value=!1}async function ru(){Ve.value=!0,Qe.value="",fn.value="";try{const S=Ye.value.data.player,y=await Jh(S.id,l.value);fn.value=y.message||"Email de rinitialisation envoy ! Vrifiez votre bote de rception."}catch(S){console.error("Erreur lors de l'envoi de l'email:",S),Qe.value="Erreur lors de l'envoi de l'email. Veuillez ressayer."}finally{Ve.value=!1}}async function su(){qt.value=!0,G.value="",me.value="";try{const S=P.value.data.playerId,y=await Jh(S,l.value);me.value=y.message||"Email de rinitialisation envoy ! Vrifiez votre bote de rception."}catch(S){console.error("Erreur lors de l'envoi de l'email:",S),G.value="Erreur lors de l'envoi de l'email. Veuillez ressayer."}finally{qt.value=!1}}function wd(){return On.isPinCached(l.value)?{timeRemaining:On.getTimeRemaining(),isExpiringSoon:On.isExpiringSoon()}:null}async function cr(S){if(!S)return;const{type:y,data:H}=S;try{switch(y){case"deleteEvent":console.log("executePendingOperation - data.eventId:",H.eventId),console.log("executePendingOperation - type de data.eventId:",typeof H.eventId),d.value=H.eventId,c.value=!0;break;case"addEvent":or.value=!0;break;case"deletePlayer":is.value=H.playerId,os.value=!0;break;case"launchSelection":at.value[H.eventId]&&at.value[H.eventId].length>0?($.value=H.eventId,B.value=!0,ce.value=!1):(await Yl(H.eventId,H.count),ce.value=!1);break;case"toggleAvailability":Jt(H.player,H.eventId);break}}catch(_e){console.error("Erreur lors de l'excution de l'opration:",_e),ae.value=!0,Ee.value="Erreur lors de l'opration. Veuillez ressayer.",setTimeout(()=>{ae.value=!1},3e3)}}function iu(){i.push("/")}df(()=>{const S=z.value;S&&S.removeEventListener("scroll",Ie),window.removeEventListener("resize",Ie)});function ou(S){ie.value=S,Ne.value=S.description||"",ce.value=!0}function Ui(){ce.value=!1,ie.value=null,Ne.value="",ze.value=!1}function dr(){f.value=ie.value.id,g.value=ie.value.title,_.value=ie.value.date,Ne.value=ie.value.description||"",C.value=ie.value.playerCount||6,ce.value=!1}function Xn(S){O.value=S,j.value=!0}function Qs(){j.value=!1,O.value=null}async function Bi({playerId:S,newName:y}){try{await VV(S,y,l.value),await Promise.all([ih(l.value),Ea(et.value,ut.value,l.value),Ta(l.value)]).then(([H,_e,Te])=>{if(et.value=H,Ct.value=_e,at.value=Te,Re(),O.value&&O.value.id===S){const Be=H.find(Me=>Me.id===S);Be&&(O.value=Be)}}),ae.value=!0,Ee.value="Joueur mis  jour avec succs !",setTimeout(()=>{ae.value=!1},3e3)}catch(H){console.error("Erreur lors de l'dition du joueur:",H),alert("Erreur lors de l'dition du joueur. Veuillez ressayer.")}}async function au(){try{await Promise.all([ih(l.value),Ea(et.value,ut.value,l.value),Ta(l.value)]).then(([S,y,H])=>{if(et.value=S,Ct.value=y,at.value=H,Re(),O.value){const _e=S.find(Te=>Te.id===O.value.id);_e&&(O.value=_e)}}),ae.value=!0,Ee.value="Donnes mises  jour !",setTimeout(()=>{ae.value=!1},3e3)}catch(S){console.error("Erreur lors du rafrachissement:",S)}}function ct(S){if(!S)return{availability:0,selection:0,ratio:0};const y=ea(S.name),H=ss(S.name),_e=y===0?0:Math.round(H/y*100);return{availability:y,selection:H,ratio:_e}}function as(S){const y=at.value[S]||[],H=ut.value.find(Be=>Be.id===S),_e=(H==null?void 0:H.playerCount)||6,Te=Tr(S);if(y.length>0){const Be=y.some(Xe=>!Dn(Xe,S)),Me=Te<_e;if(Be||Me)return{type:"incomplete",hasUnavailablePlayers:Be,hasInsufficientPlayers:Me,unavailablePlayers:y.filter(Xe=>!Dn(Xe,S)),availableCount:Te,requiredCount:_e}}return Te<_e?{type:"insufficient",availableCount:Te,requiredCount:_e}:y.length===0?{type:"ready",availableCount:Te,requiredCount:_e}:{type:"complete",availableCount:Te,requiredCount:_e}}function Js(S){const y=as(S);return y.type==="incomplete"||y.type==="insufficient"}function ls(S){const y=as(S);switch(y.type){case"incomplete":return y.hasUnavailablePlayers?y.unavailablePlayers.length===1?`Slection incomplte : ${y.unavailablePlayers[0]} n'est plus disponible`:`Slection incomplte : ${y.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Slection incomplte : ${y.availableCount} joueurs disponibles pour ${y.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${y.availableCount} disponibles pour ${y.requiredCount} requis`;case"ready":return`Prt pour la slection : ${y.availableCount} joueurs disponibles`;case"complete":return`Slection complte : ${y.availableCount} joueurs disponibles`;default:return""}}async function la({eventId:S,eventData:y,reason:H}){if(!l.value)return;const _e={id:S,...y},Te=[];for(const Be of et.value){if(!await di(Be.id,l.value))continue;const Xe=await jb(Be.id,l.value);if(Xe)try{const Fe=await G_({seasonId:l.value,playerId:Be.id,eventId:_e.id,action:"yes"}),Yt=await G_({seasonId:l.value,playerId:Be.id,eventId:_e.id,action:"no"}),At=`${Fe.url}&slug=${encodeURIComponent(o)}`,it=`${Yt.url}&slug=${encodeURIComponent(o)}`;await HV({toEmail:Xe,playerName:Be.name,eventTitle:_e.title,eventDate:lr(_e.date),yesUrl:At,noUrl:it,reason:H})}catch(Fe){console.error("Email non envoy pour",Be.name,(Fe==null?void 0:Fe.message)||Fe),Te.push(Be.id)}}ae.value=!0,Ee.value=Te.length>0?`Emails envoys (avec ${Te.length} chec(s))`:"Emails envoys aux joueurs protgs.",setTimeout(()=>{ae.value=!1},3e3)}async function ua(S){await la({eventId:S.id,eventData:S,reason:"manual"})}function bd(S){if(!S)return{};const y={};return et.value.forEach(H=>{y[H.name]=Dn(H.name,S)}),y}function $i(S){E.value=S,b.value=!0}function lu(){b.value=!1,E.value=null}async function Id(){if(!E.value)return;const S=E.value.id,y=E.value.playerCount||6;if(Tr(S)===0){ae.value=!0,Ee.value="Aucun joueur disponible pour cet vnement",setTimeout(()=>{ae.value=!1},3e3);return}await ur({type:"launchSelection",data:{eventId:S,count:y}})}function Ys(){lu(),ae.value=!0,Ee.value="Slection valide !",setTimeout(()=>{ae.value=!1},3e3)}return(S,y)=>{var H,_e,Te,Be,Me,Xe,Fe,Yt,At,it;return W(),Q(Dt,null,[m("div",qO,[m("div",{ref_key:"pageHeaderRef",ref:e,class:"sticky top-0 z-[70] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},[m("button",{onClick:iu,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour  l'accueil"},y[38]||(y[38]=[m("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),m("h1",zO,ve(a.value?a.value:"Chargement..."),1)],512),m("div",GO,[m("div",{ref_key:"headerBarRef",ref:ne,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[m("div",KO,[m("div",{class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},[m("div",{class:"flex items-center justify-center h-full"},[m("button",{onClick:Zo,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel vnement"},y[39]||(y[39]=[m("span",{class:"text-lg"},"",-1),m("span",{class:"hidden sm:inline"},"Ajouter un vnement",-1),m("span",{class:"sm:hidden"},"vnement",-1)]))])]),m("div",HO,[m("div",{ref_key:"headerEventsRef",ref:ee,class:"flex relative z-[60]",style:Sc({transform:`translateX(-${oe.value}px)`})},[(W(!0),Q(Dt,null,Vr(ut.value,te=>(W(),Q("div",{key:"h-"+te.id,class:"col-event flex-shrink-0 p-3 text-center cursor-pointer",onClick:$e=>ou(te)},[m("div",{class:"header-date text-[16px] md:text-base text-gray-300",title:lr(te.date)},ve(_d(te.date)),9,QO),m("div",{class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2",title:te.title},ve(te.title||"Sans titre"),9,JO),Js(te.id)?(W(),Q("div",{key:0,class:"mt-1 w-4 h-4 bg-yellow-500 rounded-full mx-auto flex items-center justify-center hover:bg-yellow-400 transition-colors duration-200",title:ls(te.id)+" - Cliquez pour ouvrir la slection",onClick:Nn($e=>$i(te),["stop"])},y[40]||(y[40]=[m("span",{class:"text-xs text-white font-bold"},"",-1)]),8,YO)):as(te.id).type==="ready"?(W(),Q("div",{key:1,class:"mt-1 w-4 h-4 bg-green-500 rounded-full mx-auto flex items-center justify-center hover:bg-green-400 transition-colors duration-200",title:ls(te.id)+" - Cliquez pour ouvrir la slection",onClick:Nn($e=>$i(te),["stop"])},y[41]||(y[41]=[m("span",{class:"text-xs text-white font-bold"},"",-1)]),8,XO)):Se("",!0)],8,WO))),128))],4)]),y[42]||(y[42]=m("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),gt(m("button",{onClick:y[0]||(y[0]=Nn(te=>S.scrollHeaderBy(-1),["prevent"])),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"vnements prcdents  cliquez pour dfiler"},"  ",512),[[Am,Z.value]]),gt(m("button",{onClick:y[1]||(y[1]=Nn(te=>S.scrollHeaderBy(1),["prevent"])),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"vnements suivants  cliquez pour dfiler"},"  ",512),[[Am,he.value]])])],512),m("div",{ref_key:"gridboardRef",ref:z,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[m("table",ZO,[m("colgroup",null,[y[43]||(y[43]=m("col",{class:"col-left"},null,-1)),(W(!0),Q(Dt,null,Vr(ut.value,(te,$e)=>(W(),Q("col",{key:"c"+$e,class:"col-event"}))),128)),y[44]||(y[44]=m("col",{class:"col-right"},null,-1))]),y[48]||(y[48]=m("thead",{class:"hidden"},null,-1)),m("tbody",null,[(W(!0),Q(Dt,null,Vr(et.value,te=>(W(),Q("tr",{key:te.id,class:tr(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":te.id===L.value}]),"data-player-id":te.id},[m("td",t2,[m("div",n2,[we(te.id)?(W(),Q("span",r2,"  ")):Se("",!0),m("span",{onClick:$e=>Xn(te),class:"player-name hover:border-b-2 hover:border-dashed hover:border-purple-400 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight",title:"Cliquez pour voir les dtails : "+te.name},ve(te.name),9,s2)])]),(W(!0),Q(Dt,null,Vr(ut.value,$e=>(W(),Q("td",{key:$e.id,class:"p-3 md:p-5 text-center cursor-pointer hover:bg-white/10 transition-all duration-200 min-h-20",onClick:An=>Jl(te.name,$e.id)},[m("div",o2,[rs(te.name,$e.id)?(W(),Q("span",{key:0,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:Ws(te,$e.id)},"  ",8,a2)):Dn(te.name,$e.id)?(W(),Q("span",{key:1,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:Ws(te,$e.id)},"  ",8,l2)):Dn(te.name,$e.id)===!1?(W(),Q("span",{key:2,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:Ws(te,$e.id)},"  ",8,u2)):(W(),Q("span",{key:3,class:"text-gray-500 hover:text-white transition-colors duration-200 text-xl",title:Ws(te,$e.id)},"  ",8,c2))])],8,i2))),128)),y[45]||(y[45]=m("td",{class:"p-3 md:p-4"},null,-1))],10,e2))),128)),m("tr",d2,[m("td",h2,[m("div",f2,[m("button",{onClick:y[2]||(y[2]=te=>x.value=!0),class:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur"},y[46]||(y[46]=[m("span",{class:"text-lg"},"",-1),m("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),m("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(W(!0),Q(Dt,null,Vr(ut.value,te=>(W(),Q("td",{key:"add-row-"+te.id,class:"p-3 md:p-5"}))),128)),y[47]||(y[47]=m("td",{class:"p-3 md:p-4"},null,-1))])])])],512)])]),ae.value?(W(),Q("div",p2,[m("div",m2,[y[49]||(y[49]=m("span",{class:"text-xl"},"",-1)),m("span",null,ve(Ee.value),1)])])):Se("",!0),or.value?(W(),Q("div",g2,[m("div",_2,[y[54]||(y[54]=m("h2",{class:"text-2xl font-bold mb-6 text-white text-center"}," Nouvel vnement",-1)),m("div",v2,[y[50]||(y[50]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),gt(m("input",{"onUpdate:modelValue":y[3]||(y[3]=te=>wt.value=te),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'vnement"},null,512),[[xt,wt.value]])]),m("div",y2,[y[51]||(y[51]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),gt(m("input",{"onUpdate:modelValue":y[4]||(y[4]=te=>Qt.value=te),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[xt,Qt.value]])]),m("div",w2,[y[52]||(y[52]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),gt(m("textarea",{"onUpdate:modelValue":y[5]||(y[5]=te=>ar.value=te),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'vnement (optionnel)"},null,512),[[xt,ar.value]])]),m("div",b2,[y[53]||(y[53]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs  slectionner",-1)),gt(m("input",{"onUpdate:modelValue":y[6]||(y[6]=te=>Er.value=te),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[xt,Er.value]])]),m("div",{class:"flex justify-end space-x-3"},[m("button",{onClick:Ks,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),m("button",{onClick:Hl,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Crer ")])])])):Se("",!0),x.value?(W(),Q("div",I2,[m("div",E2,[y[56]||(y[56]=m("h2",{class:"text-2xl font-bold mb-6 text-white text-center"}," Nouveau joueur",-1)),m("div",T2,[y[55]||(y[55]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),gt(m("input",{"onUpdate:modelValue":y[7]||(y[7]=te=>R.value=te),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[xt,R.value]])]),m("div",A2,[m("button",{onClick:y[8]||(y[8]=te=>x.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),m("button",{onClick:Mt,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):Se("",!0),c.value?(W(),Q("div",x2,[m("div",S2,[y[57]||(y[57]=fs('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl"></span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">tes-vous sr de vouloir supprimer cet vnement ?</p></div>',1)),m("div",P2,[m("button",{onClick:Ot,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),m("button",{onClick:y[9]||(y[9]=()=>Wt()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):Se("",!0),os.value?(W(),Q("div",R2,[m("div",C2,[y[58]||(y[58]=fs('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl"></span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">tes-vous sr de vouloir supprimer ce joueur ?</p></div>',1)),m("div",k2,[m("button",{onClick:Zl,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),m("button",{onClick:y[10]||(y[10]=()=>Xl()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):Se("",!0),B.value?(W(),Q("div",D2,[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},[y[59]||(y[59]=fs('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl"></span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Attention, toute la slection sera refaite en fonction des disponibilits actuelles.</p></div><p class="mb-6 text-sm text-yellow-400 bg-yellow-900/20 p-3 rounded-lg border border-yellow-500/20">  Pensez  prvenir les gens du changement ! </p>',2)),m("div",{class:"flex justify-end space-x-3"},[m("button",{onClick:eu,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),m("button",{onClick:Li,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):Se("",!0),ce.value?(W(),Q("div",{key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:Ui},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:y[19]||(y[19]=Nn(()=>{},["stop"]))},[m("div",V2,[m("button",{onClick:Ui,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},""),y[60]||(y[60]=m("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[m("span",{class:"text-2xl md:text-3xl"},"")],-1)),m("h2",N2,ve((H=ie.value)==null?void 0:H.title),1),m("p",O2,ve(lr((_e=ie.value)==null?void 0:_e.date)),1)]),m("div",M2,[(Te=ie.value)!=null&&Te.description?(W(),Q("div",L2,[m("p",F2,ve(ie.value.description),1)])):Se("",!0),m("div",U2,[m("div",B2,[m("div",$2,ve(Tr((Be=ie.value)==null?void 0:Be.id)),1),y[61]||(y[61]=m("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),m("div",j2,[m("div",q2,ve(ta((Me=ie.value)==null?void 0:Me.id)),1),y[62]||(y[62]=m("div",{class:"text-xs md:text-sm text-gray-300"},"Slectionns",-1))]),m("div",z2,[m("div",G2,ve(((Xe=ie.value)==null?void 0:Xe.playerCount)||6),1),y[63]||(y[63]=m("div",{class:"text-xs md:text-sm text-gray-300"}," slectionner",-1))])]),m("div",K2,[m("button",{onClick:dr,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},y[64]||(y[64]=[m("span",null,"",-1),m("span",null,"Modifier",-1)])),m("button",{onClick:y[11]||(y[11]=te=>ua(ie.value)),class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2",title:"Envoyer un email aux joueurs protgs pour indiquer leur disponibilit"},y[65]||(y[65]=[m("span",null,"",-1),m("span",null,"Relancer",-1)])),m("button",{onClick:y[12]||(y[12]=te=>$i(ie.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Grer la slection"},y[66]||(y[66]=[m("span",null,"",-1),m("span",null,"Slection",-1)])),m("button",{onClick:y[13]||(y[13]=te=>{var $e;return je(($e=ie.value)==null?void 0:$e.id)}),class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},y[67]||(y[67]=[m("span",null,"",-1),m("span",null,"Supprimer",-1)])),m("button",{onClick:Ui,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")]),ze.value?(W(),Q("div",H2,[m("button",{onClick:y[14]||(y[14]=te=>{dr(),ze.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"}," Modifier"),m("button",{onClick:y[15]||(y[15]=te=>{ua(ie.value),ze.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-amber-600/20 text-amber-200 border border-amber-500/30"}," Relancer"),m("button",{onClick:y[16]||(y[16]=te=>{var $e;je(($e=ie.value)==null?void 0:$e.id),ze.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"}," Supprimer")])):Se("",!0)]),m("div",W2,[m("button",{onClick:y[17]||(y[17]=te=>$i(ie.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"}," Slection"),m("button",{onClick:Ui,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),m("button",{onClick:y[18]||(y[18]=te=>ze.value=!ze.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"")])])])):Se("",!0),f.value?(W(),Q("div",Q2,[m("div",J2,[y[72]||(y[72]=m("h2",{class:"text-2xl font-bold mb-6 text-white text-center"}," Modifier l'vnement",-1)),m("div",Y2,[y[68]||(y[68]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),gt(m("input",{"onUpdate:modelValue":y[20]||(y[20]=te=>g.value=te),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Sn(kn,["esc"]),Sn(an,["enter"])],ref:"editTitleInput"},null,544),[[xt,g.value]])]),m("div",X2,[y[69]||(y[69]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),gt(m("input",{"onUpdate:modelValue":y[21]||(y[21]=te=>_.value=te),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[Sn(kn,["esc"]),Sn(an,["enter"])]},null,544),[[xt,_.value]])]),m("div",Z2,[y[70]||(y[70]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),gt(m("textarea",{"onUpdate:modelValue":y[22]||(y[22]=te=>Ne.value=te),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'vnement (optionnel)",onKeydown:Sn(kn,["esc"])},null,544),[[xt,Ne.value]])]),m("div",eM,[y[71]||(y[71]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs  slectionner",-1)),gt(m("input",{"onUpdate:modelValue":y[23]||(y[23]=te=>C.value=te),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:Sn(kn,["esc"])},null,544),[[xt,C.value]])]),m("div",{class:"flex justify-end space-x-3"},[m("button",{onClick:kn,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),m("button",{onClick:an,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):Se("",!0),Ft(Bb,{show:se.value,message:sa(),error:w.value,"session-info":wd(),onSubmit:yd,onCancel:tu},null,8,["show","message","error","session-info"]),I.value?(W(),Q("div",tM,[m("div",nM,[y[74]||(y[74]=fs('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl"></span></div><h2 class="text-2xl font-bold text-white mb-2">Vrification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protg</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protg par mot de passe</p></div>',1)),m("div",rM,[m("div",sM,[m("div",null,[y[73]||(y[73]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),gt(m("input",{"onUpdate:modelValue":y[24]||(y[24]=te=>D.value=te),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:y[25]||(y[25]=Sn(te=>oa(D.value),["enter"])),ref_key:"playerPasswordInputRef",ref:Ht},null,544),[[xt,D.value]])])]),m("button",{onClick:y[26]||(y[26]=te=>oa(D.value)),disabled:!D.value||A.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[A.value?(W(),Q("span",oM,"")):(W(),Q("span",aM,"")),m("span",null,ve(A.value?"Vrification...":"Vrifier et supprimer"),1)],8,iM)]),m("div",lM,[m("button",{onClick:y[27]||(y[27]=te=>Tn.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oubli ? ")]),k.value?(W(),Q("div",uM,[m("div",cM,ve(k.value),1)])):Se("",!0),m("div",{class:"flex justify-center"},[m("button",{onClick:nu,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):Se("",!0),jt.value?(W(),Q("div",dM,[m("div",hM,[y[77]||(y[77]=fs('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl"></span></div><h2 class="text-2xl font-bold text-white mb-1">Vrification requise</h2><p class="text-base text-gray-300">Modification de disponibilit</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protg par mot de passe</p></div>',1)),m("div",fM,[m("div",pM,[m("div",null,[y[75]||(y[75]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),gt(m("input",{"onUpdate:modelValue":y[28]||(y[28]=te=>K.value=te),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:y[29]||(y[29]=Sn(te=>Fi(K.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:ke},null,544),[[xt,K.value]])])]),m("div",mM,[m("button",{onClick:y[30]||(y[30]=te=>We.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oubli ? ")]),ue.value?(W(),Q("div",gM,[m("div",_M,ve(ue.value),1)])):Se("",!0)]),m("div",vM,[m("button",{onClick:aa,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),m("button",{onClick:y[31]||(y[31]=te=>Fi(K.value)),disabled:!K.value||Pe.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[Pe.value?(W(),Q("span",wM,"")):(W(),Q("span",bM,"")),m("span",null,[jn(ve(Pe.value?"Vrification...":"Vrifier"),1),y[76]||(y[76]=m("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,yM)])])])):Se("",!0),We.value?(W(),Q("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:y[34]||(y[34]=te=>We.value=!1)},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:y[33]||(y[33]=Nn(()=>{},["stop"]))},[y[79]||(y[79]=fs('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl"></span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oubli</h2><p class="text-lg text-gray-300">Modification de disponibilit</p></div>',1)),m("div",IM,[y[78]||(y[78]=m("p",{class:"text-sm text-gray-300 mb-4"}," Un email de rinitialisation sera envoy  l'adresse associe  ce joueur. ",-1)),m("button",{onClick:ru,disabled:Ve.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Ve.value?(W(),Q("span",TM,"")):(W(),Q("span",AM,"")),m("span",null,ve(Ve.value?"Envoi...":"Envoyer l'email"),1)],8,EM)]),Qe.value?(W(),Q("div",xM,[m("div",SM,ve(Qe.value),1)])):Se("",!0),fn.value?(W(),Q("div",PM,[m("div",RM,ve(fn.value),1)])):Se("",!0),m("div",CM,[m("button",{onClick:y[32]||(y[32]=te=>We.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):Se("",!0),Tn.value?(W(),Q("div",{key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:y[37]||(y[37]=te=>Tn.value=!1)},[m("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:y[36]||(y[36]=Nn(()=>{},["stop"]))},[y[81]||(y[81]=fs('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl"></span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oubli</h2><p class="text-lg text-gray-300">Suppression de joueur protg</p></div>',1)),m("div",kM,[y[80]||(y[80]=m("p",{class:"text-sm text-gray-300 mb-4"}," Un email de rinitialisation sera envoy  l'adresse associe  ce joueur. ",-1)),m("button",{onClick:su,disabled:qt.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[qt.value?(W(),Q("span",VM,"")):(W(),Q("span",NM,"")),m("span",null,ve(qt.value?"Envoi...":"Envoyer l'email"),1)],8,DM)]),G.value?(W(),Q("div",OM,[m("div",MM,ve(G.value),1)])):Se("",!0),me.value?(W(),Q("div",LM,[m("div",FM,ve(me.value),1)])):Se("",!0),m("div",UM,[m("button",{onClick:y[35]||(y[35]=te=>Tn.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):Se("",!0),Ft(rO,{show:j.value,player:O.value,stats:ct(O.value),seasonId:l.value,onClose:Qs,onUpdate:Bi,onDelete:vd,onRefresh:au},null,8,["show","player","stats","seasonId"]),Ft(jO,{ref_key:"selectionModalRef",ref:M,show:b.value,event:E.value,"current-selection":at.value[(Fe=E.value)==null?void 0:Fe.id]||[],"available-count":Tr((Yt=E.value)==null?void 0:Yt.id),"selected-count":ta((At=E.value)==null?void 0:At.id),"player-availability":bd((it=E.value)==null?void 0:it.id),onClose:lu,onSelection:Id,onPerfect:Ys},null,8,["show","event","current-selection","available-count","selected-count","player-availability"])],64)}}},$M={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},jM={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},qM={key:0,class:"text-center py-8"},zM={key:1,class:"text-center py-8"},GM={class:"text-gray-300 mb-6"},KM={key:2,class:"space-y-6"},HM={class:"text-center"},WM={class:"text-gray-300"},QM={class:"font-semibold text-white"},JM={class:"space-y-4"},YM=["disabled"],XM={key:0,class:"animate-spin"},ZM={key:1},eL={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},tL={class:"text-red-300 text-sm"},nL={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},rL={class:"text-green-300 text-sm"},sL={__name:"PasswordReset",setup(n){const e=cy(),t=Lc(),r=q(!0),s=q(""),i=q(""),o=q(""),a=q(""),l=q(""),c=q(!1),d=q(""),f=q(""),g=Xt(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);_o(async()=>{try{const{oobCode:x}=e.query;if(console.log(" [DEBUG] Token reu:",x),!x){s.value="Lien de rinitialisation incomplet",r.value=!1;return}o.value=x,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(x){console.error("Erreur lors de la vrification du lien:",x),s.value="Erreur lors de la vrification du lien",r.value=!1}});async function _(){if(g.value){c.value=!0,d.value="",f.value="";try{console.log(" [DEBUG] Dbut rinitialisation avec token:",o.value),await B1(Oi,o.value,a.value),console.log(" [DEBUG] Mot de passe Firebase Auth mis  jour"),console.log(" [DEBUG] Rinitialisation termine avec Firebase Auth"),f.value="Mot de passe rinitialis avec succs ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{C()},3e3)}catch(x){console.error(" [ERROR] Erreur lors de la rinitialisation:",x),x.code==="auth/weak-password"?d.value="Le mot de passe doit contenir au moins 6 caractres":x.code==="auth/invalid-action-code"?d.value="Lien de rinitialisation invalide ou expir":d.value="Erreur lors de la rinitialisation. Veuillez ressayer."}finally{c.value=!1}}}function C(){t.push("/")}return(x,R)=>(W(),Q("div",$M,[m("div",jM,[R[8]||(R[8]=fs('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl"></span></div><h1 class="text-3xl font-bold text-white mb-2">Rinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(W(),Q("div",qM,R[2]||(R[2]=[m("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),m("p",{class:"text-gray-300"},"Vrification du lien...",-1)]))):s.value?(W(),Q("div",zM,[R[3]||(R[3]=m("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[m("span",{class:"text-2xl"},"")],-1)),R[4]||(R[4]=m("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),m("p",GM,ve(s.value),1),m("button",{onClick:C,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour  l'accueil ")])):i.value?(W(),Q("div",KM,[m("div",HM,[m("p",WM,[R[5]||(R[5]=jn("Email : ")),m("span",QM,ve(i.value),1)])]),m("div",JM,[m("div",null,[R[6]||(R[6]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),gt(m("input",{"onUpdate:modelValue":R[0]||(R[0]=L=>a.value=L),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:Sn(_,["enter"])},null,544),[[xt,a.value]])]),m("div",null,[R[7]||(R[7]=m("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),gt(m("input",{"onUpdate:modelValue":R[1]||(R[1]=L=>l.value=L),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:Sn(_,["enter"])},null,544),[[xt,l.value]])])]),m("button",{onClick:_,disabled:!g.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(W(),Q("span",XM,"")):(W(),Q("span",ZM,"")),m("span",null,ve(c.value?"Rinitialisation...":"Rinitialiser le mot de passe"),1)],8,YM),d.value?(W(),Q("div",eL,[m("div",tL,ve(d.value),1)])):Se("",!0),f.value?(W(),Q("div",nL,[m("div",rL,ve(f.value),1)])):Se("",!0)])):Se("",!0)])]))}},iL={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},oL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},aL={class:"text-3xl"},lL={class:"text-2xl font-bold text-white mb-2"},uL={class:"text-gray-300 mb-6"},cL={__name:"MagicLink",setup(n){const e=cy(),t=Lc(),r=q("loading"),s=q("Traitement en cours..."),i=q("Merci de patienter pendant la validation du lien."),o=Xt(()=>r.value==="loading"?"":r.value==="ok"?"":"");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/")}return _o(async()=>{try{const l=String(e.query.sid||""),c=String(e.query.pid||""),d=String(e.query.eid||""),f=String(e.query.t||""),g=String(e.query.a||""),_=String(e.query.slug||"");if(!l||!c||!d||!f||!g){r.value="error",s.value="Lien invalide",i.value="Paramtres manquants.";return}if(!(await GV({seasonId:l,playerId:c,eventId:d,token:f,action:g})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expir.";return}const x=Oe(be,"seasons",l,"players",c),R=await Di(x),L=R.exists()&&R.data().name||"";if(!L){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}await NV({seasonId:l,playerName:L,eventId:d,value:g==="yes"}),await KV({seasonId:l,playerId:c,eventId:d}),r.value="ok",s.value="Merci !",i.value=g==="yes"?"Votre disponibilit a t enregistre: Disponible.":"Votre disponibilit a t enregistre: Non disponible.",setTimeout(()=>a(),2e3)}catch(l){console.error("Magic link error:",l),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(W(),Q("div",iL,[m("div",oL,[m("div",{class:tr(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[m("span",aL,ve(o.value),1)],2),m("h1",lL,ve(s.value),1),m("p",uL,ve(i.value),1),m("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},dL=[{path:"/",component:SV},{path:"/season/:slug",component:BM,props:!0},{path:"/reset-password",component:sL},{path:"/magic",component:cL}],hL=pA({history:qT("/impro-selector/"),routes:dL});uT(hT).use(hL).mount("#app");export{st as $,zw as A,Ai as B,wr as C,$t as D,vF as E,Pi as F,ap as G,_F as H,_L as I,Qn as J,rC as K,iC as L,Gw as M,zL as N,GL as O,CC as P,hn as Q,OL as R,IL as S,Pt as T,uF as U,ed as V,PC as W,lF as X,qL as Y,xL as Z,Vy as _,dl as a,ql as a$,wL as a0,sC as a1,gC as a2,gF as a3,pl as a4,aF as a5,RL as a6,mF as a7,Oe as a8,VL as a9,DL as aA,YL as aB,XL as aC,NL as aD,pC as aE,rF as aF,sF as aG,xC as aH,Bw as aI,Rw as aJ,bL as aK,oF as aL,vp as aM,Rn as aN,hF as aO,fL as aP,KL as aQ,UL as aR,FL as aS,jL as aT,CL as aU,vC as aV,dF as aW,SL as aX,fC as aY,Kw as aZ,TF as a_,TL as aa,AL as ab,PL as ac,pF as ad,$L as ae,BL as af,Rt as ag,Ul as ah,yC as ai,ZL as aj,Di as ak,HL as al,WL as am,St as an,QL as ao,JL as ap,oC as aq,fF as ar,cF as as,EL as at,ML as au,LL as av,kL as aw,eF as ax,nF as ay,tF as az,aC as b,O1 as b$,jl as b0,xF as b1,vl as b2,Vi as b3,ws as b4,wF as b5,Is as b6,bs as b7,Hr as b8,qu as b9,qC as bA,YF as bB,c4 as bC,S_ as bD,yk as bE,c1 as bF,qF as bG,NF as bH,M1 as bI,t4 as bJ,o4 as bK,u4 as bL,XF as bM,GF as bN,X1 as bO,PF as bP,DC as bQ,L1 as bR,n4 as bS,i4 as bT,l4 as bU,KC as bV,QF as bW,LF as bX,U1 as bY,VF as bZ,jF as b_,EF as ba,mi as bb,mo as bc,ID as bd,bF as be,ZF as bf,Hh as bg,IF as bh,ED as bi,Up as bj,Es as bk,kF as bl,Z1 as bm,ak as bn,bD as bo,Sb as bp,$1 as bq,B1 as br,h1 as bs,j1 as bt,AF as bu,JF as bv,MF as bw,$F as bx,CD as by,SF as bz,Mo as c,Pp as c0,CF as c1,q1 as c2,OF as c3,e4 as c4,s4 as c5,a4 as c6,WF as c7,RF as c8,HF as c9,BF as ca,K1 as cb,r4 as cc,UF as cd,KF as ce,zF as cf,FF as cg,DF as ch,Ri as d,ft as e,Y as f,Qo as g,Ll as h,Bu as i,ad as j,Fl as k,id as l,gp as m,Lo as n,od as o,ui as p,RC as q,Vt as r,_i as s,pe as t,mL as u,Jx as v,It as w,yF as x,qe as y,pL as z};
