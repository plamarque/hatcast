(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function $m(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const Ut={},nl=[],ts=()=>{},_1=()=>!1,Lh=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Fm=n=>n.startsWith("onUpdate:"),Rn=Object.assign,Um=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},b1=Object.prototype.hasOwnProperty,Ot=(n,e)=>b1.call(n,e),Ge=Array.isArray,rl=n=>Cc(n)==="[object Map]",Vl=n=>Cc(n)==="[object Set]",yy=n=>Cc(n)==="[object Date]",nt=n=>typeof n=="function",fn=n=>typeof n=="string",is=n=>typeof n=="symbol",jt=n=>n!==null&&typeof n=="object",Mb=n=>(jt(n)||nt(n))&&nt(n.then)&&nt(n.catch),Lb=Object.prototype.toString,Cc=n=>Lb.call(n),w1=n=>Cc(n).slice(8,-1),$b=n=>Cc(n)==="[object Object]",jm=n=>fn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Nu=$m(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),$h=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},x1=/-(\w)/g,Gr=$h(n=>n.replace(x1,(e,t)=>t?t.toUpperCase():"")),I1=/\B([A-Z])/g,fo=$h(n=>n.replace(I1,"-$1").toLowerCase()),Fh=$h(n=>n.charAt(0).toUpperCase()+n.slice(1)),Jf=$h(n=>n?`on${Fh(n)}`:""),Ji=(n,e)=>!Object.is(n,e),Md=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},Lp=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},rh=n=>{const e=parseFloat(n);return isNaN(e)?n:e},E1=n=>{const e=fn(n)?Number(n):NaN;return isNaN(e)?n:e};let _y;const Uh=()=>_y||(_y=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Vr(n){if(Ge(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=fn(r)?P1(r):Vr(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(fn(n)||jt(n))return n}const T1=/;(?![^(]*\))/g,A1=/:([^]+)/,S1=/\/\*[^]*?\*\//g;function P1(n){const e={};return n.replace(S1,"").split(T1).forEach(t=>{if(t){const r=t.split(A1);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function Qt(n){let e="";if(fn(n))e=n;else if(Ge(n))for(let t=0;t<n.length;t++){const r=Qt(n[t]);r&&(e+=r+" ")}else if(jt(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const R1="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",C1=$m(R1);function Fb(n){return!!n||n===""}function k1(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=kc(n[r],e[r]);return t}function kc(n,e){if(n===e)return!0;let t=yy(n),r=yy(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=is(n),r=is(e),t||r)return n===e;if(t=Ge(n),r=Ge(e),t||r)return t&&r?k1(n,e):!1;if(t=jt(n),r=jt(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!kc(n[o],e[o]))return!1}}return String(n)===String(e)}function Bm(n,e){return n.findIndex(t=>kc(t,e))}const Ub=n=>!!(n&&n.__v_isRef===!0),re=n=>fn(n)?n:n==null?"":Ge(n)||jt(n)&&(n.toString===Lb||!nt(n.toString))?Ub(n)?re(n.value):JSON.stringify(n,jb,2):String(n),jb=(n,e)=>Ub(e)?jb(n,e.value):rl(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[Yf(r,i)+" =>"]=s,t),{})}:Vl(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>Yf(t))}:is(e)?Yf(e):jt(e)&&!Ge(e)&&!$b(e)?String(e):e,Yf=(n,e="")=>{var t;return is(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ir;class D1{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Ir,!e&&Ir&&(this.index=(Ir.scopes||(Ir.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Ir;try{return Ir=this,e()}finally{Ir=t}}}on(){++this._on===1&&(this.prevScope=Ir,Ir=this)}off(){this._on>0&&--this._on===0&&(Ir=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function N1(){return Ir}let Ht;const Xf=new WeakSet;class Bb{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Ir&&Ir.active&&Ir.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Xf.has(this)&&(Xf.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||zb(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,by(this),Hb(this);const e=Ht,t=ns;Ht=this,ns=!0;try{return this.fn()}finally{Kb(this),Ht=e,ns=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Hm(e);this.deps=this.depsTail=void 0,by(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Xf.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){$p(this)&&this.run()}get dirty(){return $p(this)}}let qb=0,Ou,Vu;function zb(n,e=!1){if(n.flags|=8,e){n.next=Vu,Vu=n;return}n.next=Ou,Ou=n}function qm(){qb++}function zm(){if(--qb>0)return;if(Vu){let e=Vu;for(Vu=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Ou;){let e=Ou;for(Ou=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function Hb(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Kb(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),Hm(r),O1(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function $p(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Gb(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function Gb(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Yu)||(n.globalVersion=Yu,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!$p(n))))return;n.flags|=2;const e=n.dep,t=Ht,r=ns;Ht=n,ns=!0;try{Hb(n);const s=n.fn(n._value);(e.version===0||Ji(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{Ht=t,ns=r,Kb(n),n.flags&=-3}}function Hm(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)Hm(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function O1(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let ns=!0;const Wb=[];function Xs(){Wb.push(ns),ns=!1}function Zs(){const n=Wb.pop();ns=n===void 0?!0:n}function by(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Ht;Ht=void 0;try{e()}finally{Ht=t}}}let Yu=0;class V1{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Km{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Ht||!ns||Ht===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Ht)t=this.activeLink=new V1(Ht,this),Ht.deps?(t.prevDep=Ht.depsTail,Ht.depsTail.nextDep=t,Ht.depsTail=t):Ht.deps=Ht.depsTail=t,Qb(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=Ht.depsTail,t.nextDep=void 0,Ht.depsTail.nextDep=t,Ht.depsTail=t,Ht.deps===t&&(Ht.deps=r)}return t}trigger(e){this.version++,Yu++,this.notify(e)}notify(e){qm();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{zm()}}}function Qb(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)Qb(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const Fp=new WeakMap,Jo=Symbol(""),Up=Symbol(""),Xu=Symbol("");function ir(n,e,t){if(ns&&Ht){let r=Fp.get(n);r||Fp.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new Km),s.map=r,s.key=t),s.track()}}function Fs(n,e,t,r,s,i){const o=Fp.get(n);if(!o){Yu++;return}const a=l=>{l&&l.trigger()};if(qm(),e==="clear")o.forEach(a);else{const l=Ge(n),c=l&&jm(t);if(l&&t==="length"){const h=Number(r);o.forEach((f,m)=>{(m==="length"||m===Xu||!is(m)&&m>=h)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(Xu)),e){case"add":l?c&&a(o.get("length")):(a(o.get(Jo)),rl(n)&&a(o.get(Up)));break;case"delete":l||(a(o.get(Jo)),rl(n)&&a(o.get(Up)));break;case"set":rl(n)&&a(o.get(Jo));break}}zm()}function za(n){const e=Rt(n);return e===n?e:(ir(e,"iterate",Xu),Kr(n)?e:e.map(Qn))}function jh(n){return ir(n=Rt(n),"iterate",Xu),n}const M1={__proto__:null,[Symbol.iterator](){return Zf(this,Symbol.iterator,Qn)},concat(...n){return za(this).concat(...n.map(e=>Ge(e)?za(e):e))},entries(){return Zf(this,"entries",n=>(n[1]=Qn(n[1]),n))},every(n,e){return Os(this,"every",n,e,void 0,arguments)},filter(n,e){return Os(this,"filter",n,e,t=>t.map(Qn),arguments)},find(n,e){return Os(this,"find",n,e,Qn,arguments)},findIndex(n,e){return Os(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return Os(this,"findLast",n,e,Qn,arguments)},findLastIndex(n,e){return Os(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return Os(this,"forEach",n,e,void 0,arguments)},includes(...n){return ep(this,"includes",n)},indexOf(...n){return ep(this,"indexOf",n)},join(n){return za(this).join(n)},lastIndexOf(...n){return ep(this,"lastIndexOf",n)},map(n,e){return Os(this,"map",n,e,void 0,arguments)},pop(){return fu(this,"pop")},push(...n){return fu(this,"push",n)},reduce(n,...e){return wy(this,"reduce",n,e)},reduceRight(n,...e){return wy(this,"reduceRight",n,e)},shift(){return fu(this,"shift")},some(n,e){return Os(this,"some",n,e,void 0,arguments)},splice(...n){return fu(this,"splice",n)},toReversed(){return za(this).toReversed()},toSorted(n){return za(this).toSorted(n)},toSpliced(...n){return za(this).toSpliced(...n)},unshift(...n){return fu(this,"unshift",n)},values(){return Zf(this,"values",Qn)}};function Zf(n,e,t){const r=jh(n),s=r[e]();return r!==n&&!Kr(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const L1=Array.prototype;function Os(n,e,t,r,s,i){const o=jh(n),a=o!==n&&!Kr(n),l=o[e];if(l!==L1[e]){const f=l.apply(n,i);return a?Qn(f):f}let c=t;o!==n&&(a?c=function(f,m){return t.call(this,Qn(f),m,n)}:t.length>2&&(c=function(f,m){return t.call(this,f,m,n)}));const h=l.call(o,c,r);return a&&s?s(h):h}function wy(n,e,t,r){const s=jh(n);let i=t;return s!==n&&(Kr(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,Qn(a),l,n)}),s[e](i,...r)}function ep(n,e,t){const r=Rt(n);ir(r,"iterate",Xu);const s=r[e](...t);return(s===-1||s===!1)&&Qm(t[0])?(t[0]=Rt(t[0]),r[e](...t)):s}function fu(n,e,t=[]){Xs(),qm();const r=Rt(n)[e].apply(n,t);return zm(),Zs(),r}const $1=$m("__proto__,__v_isRef,__isVue"),Jb=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(is));function F1(n){is(n)||(n=String(n));const e=Rt(this);return ir(e,"has",n),e.hasOwnProperty(n)}class Yb{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?Q1:tw:i?ew:Zb).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=Ge(e);if(!s){let l;if(o&&(l=M1[t]))return l;if(t==="hasOwnProperty")return F1}const a=Reflect.get(e,t,ar(e)?e:r);return(is(t)?Jb.has(t):$1(t))||(s||ir(e,"get",t),i)?a:ar(a)?o&&jm(t)?a:a.value:jt(a)?s?rw(a):Bh(a):a}}class Xb extends Yb{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=to(i);if(!Kr(r)&&!to(r)&&(i=Rt(i),r=Rt(r)),!Ge(e)&&ar(i)&&!ar(r))return l?!1:(i.value=r,!0)}const o=Ge(e)&&jm(t)?Number(t)<e.length:Ot(e,t),a=Reflect.set(e,t,r,ar(e)?e:s);return e===Rt(s)&&(o?Ji(r,i)&&Fs(e,"set",t,r):Fs(e,"add",t,r)),a}deleteProperty(e,t){const r=Ot(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&Fs(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!is(t)||!Jb.has(t))&&ir(e,"has",t),r}ownKeys(e){return ir(e,"iterate",Ge(e)?"length":Jo),Reflect.ownKeys(e)}}class U1 extends Yb{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const j1=new Xb,B1=new U1,q1=new Xb(!0);const jp=n=>n,_d=n=>Reflect.getPrototypeOf(n);function z1(n,e,t){return function(...r){const s=this.__v_raw,i=Rt(s),o=rl(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),h=t?jp:e?sh:Qn;return!e&&ir(i,"iterate",l?Up:Jo),{next(){const{value:f,done:m}=c.next();return m?{value:f,done:m}:{value:a?[h(f[0]),h(f[1])]:h(f),done:m}},[Symbol.iterator](){return this}}}}function bd(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function H1(n,e){const t={get(s){const i=this.__v_raw,o=Rt(i),a=Rt(s);n||(Ji(s,a)&&ir(o,"get",s),ir(o,"get",a));const{has:l}=_d(o),c=e?jp:n?sh:Qn;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&ir(Rt(s),"iterate",Jo),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=Rt(i),a=Rt(s);return n||(Ji(s,a)&&ir(o,"has",s),ir(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=Rt(a),c=e?jp:n?sh:Qn;return!n&&ir(l,"iterate",Jo),a.forEach((h,f)=>s.call(i,c(h),c(f),o))}};return Rn(t,n?{add:bd("add"),set:bd("set"),delete:bd("delete"),clear:bd("clear")}:{add(s){!e&&!Kr(s)&&!to(s)&&(s=Rt(s));const i=Rt(this);return _d(i).has.call(i,s)||(i.add(s),Fs(i,"add",s,s)),this},set(s,i){!e&&!Kr(i)&&!to(i)&&(i=Rt(i));const o=Rt(this),{has:a,get:l}=_d(o);let c=a.call(o,s);c||(s=Rt(s),c=a.call(o,s));const h=l.call(o,s);return o.set(s,i),c?Ji(i,h)&&Fs(o,"set",s,i):Fs(o,"add",s,i),this},delete(s){const i=Rt(this),{has:o,get:a}=_d(i);let l=o.call(i,s);l||(s=Rt(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&Fs(i,"delete",s,void 0),c},clear(){const s=Rt(this),i=s.size!==0,o=s.clear();return i&&Fs(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=z1(s,n,e)}),t}function Gm(n,e){const t=H1(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(Ot(t,s)&&s in r?t:r,s,i)}const K1={get:Gm(!1,!1)},G1={get:Gm(!1,!0)},W1={get:Gm(!0,!1)};const Zb=new WeakMap,ew=new WeakMap,tw=new WeakMap,Q1=new WeakMap;function J1(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Y1(n){return n.__v_skip||!Object.isExtensible(n)?0:J1(w1(n))}function Bh(n){return to(n)?n:Wm(n,!1,j1,K1,Zb)}function nw(n){return Wm(n,!1,q1,G1,ew)}function rw(n){return Wm(n,!0,B1,W1,tw)}function Wm(n,e,t,r,s){if(!jt(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=Y1(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function sl(n){return to(n)?sl(n.__v_raw):!!(n&&n.__v_isReactive)}function to(n){return!!(n&&n.__v_isReadonly)}function Kr(n){return!!(n&&n.__v_isShallow)}function Qm(n){return n?!!n.__v_raw:!1}function Rt(n){const e=n&&n.__v_raw;return e?Rt(e):n}function X1(n){return!Ot(n,"__v_skip")&&Object.isExtensible(n)&&Lp(n,"__v_skip",!0),n}const Qn=n=>jt(n)?Bh(n):n,sh=n=>jt(n)?rw(n):n;function ar(n){return n?n.__v_isRef===!0:!1}function P(n){return sw(n,!1)}function Z1(n){return sw(n,!0)}function sw(n,e){return ar(n)?n:new eS(n,e)}class eS{constructor(e,t){this.dep=new Km,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Rt(e),this._value=t?e:Qn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Kr(e)||to(e);e=r?e:Rt(e),Ji(e,t)&&(this._rawValue=e,this._value=r?e:Qn(e),this.dep.trigger())}}function rs(n){return ar(n)?n.value:n}const tS={get:(n,e,t)=>e==="__v_raw"?n:rs(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return ar(s)&&!ar(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function iw(n){return sl(n)?n:new Proxy(n,tS)}class nS{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Km(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Yu-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Ht!==this)return zb(this,!0),!0}get value(){const e=this.dep.track();return Gb(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function rS(n,e,t=!1){let r,s;return nt(n)?r=n:(r=n.get,s=n.set),new nS(r,s,t)}const wd={},ih=new WeakMap;let Lo;function sS(n,e=!1,t=Lo){if(t){let r=ih.get(t);r||ih.set(t,r=[]),r.push(n)}}function iS(n,e,t=Ut){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=L=>s?L:Kr(L)||s===!1||s===0?Us(L,1):Us(L);let h,f,m,v,w=!1,E=!1;if(ar(n)?(f=()=>n.value,w=Kr(n)):sl(n)?(f=()=>c(n),w=!0):Ge(n)?(E=!0,w=n.some(L=>sl(L)||Kr(L)),f=()=>n.map(L=>{if(ar(L))return L.value;if(sl(L))return c(L);if(nt(L))return l?l(L,2):L()})):nt(n)?e?f=l?()=>l(n,2):n:f=()=>{if(m){Xs();try{m()}finally{Zs()}}const L=Lo;Lo=h;try{return l?l(n,3,[v]):n(v)}finally{Lo=L}}:f=ts,e&&s){const L=f,se=s===!0?1/0:s;f=()=>Us(L(),se)}const A=N1(),F=()=>{h.stop(),A&&A.active&&Um(A.effects,h)};if(i&&e){const L=e;e=(...se)=>{L(...se),F()}}let U=E?new Array(n.length).fill(wd):wd;const $=L=>{if(!(!(h.flags&1)||!h.dirty&&!L))if(e){const se=h.run();if(s||w||(E?se.some((te,T)=>Ji(te,U[T])):Ji(se,U))){m&&m();const te=Lo;Lo=h;try{const T=[se,U===wd?void 0:E&&U[0]===wd?[]:U,v];U=se,l?l(e,3,T):e(...T)}finally{Lo=te}}}else h.run()};return a&&a($),h=new Bb(f),h.scheduler=o?()=>o($,!1):$,v=L=>sS(L,!1,h),m=h.onStop=()=>{const L=ih.get(h);if(L){if(l)l(L,4);else for(const se of L)se();ih.delete(h)}},e?r?$(!0):U=h.run():o?o($.bind(null,!0),!0):h.run(),F.pause=h.pause.bind(h),F.resume=h.resume.bind(h),F.stop=F,F}function Us(n,e=1/0,t){if(e<=0||!jt(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,ar(n))Us(n.value,e,t);else if(Ge(n))for(let r=0;r<n.length;r++)Us(n[r],e,t);else if(Vl(n)||rl(n))n.forEach(r=>{Us(r,e,t)});else if($b(n)){for(const r in n)Us(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&Us(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Dc(n,e,t,r){try{return r?n(...r):n()}catch(s){qh(s,e,t)}}function os(n,e,t,r){if(nt(n)){const s=Dc(n,e,t,r);return s&&Mb(s)&&s.catch(i=>{qh(i,e,t)}),s}if(Ge(n)){const s=[];for(let i=0;i<n.length;i++)s.push(os(n[i],e,t,r));return s}}function qh(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||Ut;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const h=a.ec;if(h){for(let f=0;f<h.length;f++)if(h[f](n,l,c)===!1)return}a=a.parent}if(i){Xs(),Dc(i,null,10,[n,l,c]),Zs();return}}oS(n,t,s,r,o)}function oS(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const pr=[];let _s=-1;const il=[];let Oi=null,Qa=0;const ow=Promise.resolve();let oh=null;function en(n){const e=oh||ow;return n?e.then(this?n.bind(this):n):e}function aS(n){let e=_s+1,t=pr.length;for(;e<t;){const r=e+t>>>1,s=pr[r],i=Zu(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function Jm(n){if(!(n.flags&1)){const e=Zu(n),t=pr[pr.length-1];!t||!(n.flags&2)&&e>=Zu(t)?pr.push(n):pr.splice(aS(e),0,n),n.flags|=1,aw()}}function aw(){oh||(oh=ow.then(uw))}function lS(n){Ge(n)?il.push(...n):Oi&&n.id===-1?Oi.splice(Qa+1,0,n):n.flags&1||(il.push(n),n.flags|=1),aw()}function xy(n,e,t=_s+1){for(;t<pr.length;t++){const r=pr[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;pr.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function lw(n){if(il.length){const e=[...new Set(il)].sort((t,r)=>Zu(t)-Zu(r));if(il.length=0,Oi){Oi.push(...e);return}for(Oi=e,Qa=0;Qa<Oi.length;Qa++){const t=Oi[Qa];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Oi=null,Qa=0}}const Zu=n=>n.id==null?n.flags&2?-1:1/0:n.id;function uw(n){const e=ts;try{for(_s=0;_s<pr.length;_s++){const t=pr[_s];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Dc(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;_s<pr.length;_s++){const t=pr[_s];t&&(t.flags&=-2)}_s=-1,pr.length=0,lw(),oh=null,(pr.length||il.length)&&uw()}}let Bn=null,cw=null;function ah(n){const e=Bn;return Bn=n,cw=n&&n.type.__scopeId||null,e}function Ld(n,e=Bn,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&Vy(-1);const i=ah(e);let o;try{o=n(...s)}finally{ah(i),r._d&&Vy(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function ut(n,e){if(Bn===null)return n;const t=Wh(Bn),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=Ut]=e[s];i&&(nt(i)&&(i={mounted:i,updated:i}),i.deep&&Us(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function Do(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(Xs(),os(l,t,8,[n.el,a,n,e]),Zs())}}const dw=Symbol("_vte"),hw=n=>n.__isTeleport,Mu=n=>n&&(n.disabled||n.disabled===""),Iy=n=>n&&(n.defer||n.defer===""),Ey=n=>typeof SVGElement<"u"&&n instanceof SVGElement,Ty=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,Bp=(n,e)=>{const t=n&&n.to;return fn(t)?e?e(t):null:t},fw={name:"Teleport",__isTeleport:!0,process(n,e,t,r,s,i,o,a,l,c){const{mc:h,pc:f,pbc:m,o:{insert:v,querySelector:w,createText:E,createComment:A}}=c,F=Mu(e.props);let{shapeFlag:U,children:$,dynamicChildren:L}=e;if(n==null){const se=e.el=E(""),te=e.anchor=E("");v(se,t,r),v(te,t,r);const T=(I,C)=>{U&16&&(s&&s.isCE&&(s.ce._teleportTarget=I),h($,I,C,s,i,o,a,l))},_=()=>{const I=e.target=Bp(e.props,w),C=pw(I,e,E,v);I&&(o!=="svg"&&Ey(I)?o="svg":o!=="mathml"&&Ty(I)&&(o="mathml"),F||(T(I,C),$d(e,!1)))};F&&(T(t,te),$d(e,!0)),Iy(e.props)?(e.el.__isMounted=!1,fr(()=>{_(),delete e.el.__isMounted},i)):_()}else{if(Iy(e.props)&&n.el.__isMounted===!1){fr(()=>{fw.process(n,e,t,r,s,i,o,a,l,c)},i);return}e.el=n.el,e.targetStart=n.targetStart;const se=e.anchor=n.anchor,te=e.target=n.target,T=e.targetAnchor=n.targetAnchor,_=Mu(n.props),I=_?t:te,C=_?se:T;if(o==="svg"||Ey(te)?o="svg":(o==="mathml"||Ty(te))&&(o="mathml"),L?(m(n.dynamicChildren,L,I,s,i,o,a),tg(n,e,!0)):l||f(n,e,I,C,s,i,o,a,!1),F)_?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):xd(e,t,se,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const M=e.target=Bp(e.props,w);M&&xd(e,M,null,c,0)}else _&&xd(e,te,T,c,1);$d(e,F)}},remove(n,e,t,{um:r,o:{remove:s}},i){const{shapeFlag:o,children:a,anchor:l,targetStart:c,targetAnchor:h,target:f,props:m}=n;if(f&&(s(c),s(h)),i&&s(l),o&16){const v=i||!Mu(m);for(let w=0;w<a.length;w++){const E=a[w];r(E,e,t,v,!!E.dynamicChildren)}}},move:xd,hydrate:uS};function xd(n,e,t,{o:{insert:r},m:s},i=2){i===0&&r(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:h}=n,f=i===2;if(f&&r(o,e,t),(!f||Mu(h))&&l&16)for(let m=0;m<c.length;m++)s(c[m],e,t,2);f&&r(a,e,t)}function uS(n,e,t,r,s,i,{o:{nextSibling:o,parentNode:a,querySelector:l,insert:c,createText:h}},f){const m=e.target=Bp(e.props,l);if(m){const v=Mu(e.props),w=m._lpa||m.firstChild;if(e.shapeFlag&16)if(v)e.anchor=f(o(n),e,a(n),t,r,s,i),e.targetStart=w,e.targetAnchor=w&&o(w);else{e.anchor=o(n);let E=w;for(;E;){if(E&&E.nodeType===8){if(E.data==="teleport start anchor")e.targetStart=E;else if(E.data==="teleport anchor"){e.targetAnchor=E,m._lpa=e.targetAnchor&&o(e.targetAnchor);break}}E=o(E)}e.targetAnchor||pw(m,e,h,c),f(w&&o(w),e,m,t,r,s,i)}$d(e,v)}return e.anchor&&o(e.anchor)}const ec=fw;function $d(n,e){const t=n.ctx;if(t&&t.ut){let r,s;for(e?(r=n.el,s=n.anchor):(r=n.targetStart,s=n.targetAnchor);r&&r!==s;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function pw(n,e,t,r){const s=e.targetStart=t(""),i=e.targetAnchor=t("");return s[dw]=i,n&&(r(s,n),r(i,n)),i}const Vi=Symbol("_leaveCb"),Id=Symbol("_enterCb");function cS(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return En(()=>{n.isMounted=!0}),Ym(()=>{n.isUnmounting=!0}),n}const Hr=[Function,Array],mw={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Hr,onEnter:Hr,onAfterEnter:Hr,onEnterCancelled:Hr,onBeforeLeave:Hr,onLeave:Hr,onAfterLeave:Hr,onLeaveCancelled:Hr,onBeforeAppear:Hr,onAppear:Hr,onAfterAppear:Hr,onAppearCancelled:Hr},gw=n=>{const e=n.subTree;return e.component?gw(e.component):e},dS={name:"BaseTransition",props:mw,setup(n,{slots:e}){const t=lP(),r=cS();return()=>{const s=e.default&&_w(e.default(),!0);if(!s||!s.length)return;const i=vw(s),o=Rt(n),{mode:a}=o;if(r.isLeaving)return tp(i);const l=Ay(i);if(!l)return tp(i);let c=qp(l,o,r,t,f=>c=f);l.type!==or&&tc(l,c);let h=t.subTree&&Ay(t.subTree);if(h&&h.type!==or&&!Bo(l,h)&&gw(t).type!==or){let f=qp(h,o,r,t);if(tc(h,f),a==="out-in"&&l.type!==or)return r.isLeaving=!0,f.afterLeave=()=>{r.isLeaving=!1,t.job.flags&8||t.update(),delete f.afterLeave,h=void 0},tp(i);a==="in-out"&&l.type!==or?f.delayLeave=(m,v,w)=>{const E=yw(r,h);E[String(h.key)]=h,m[Vi]=()=>{v(),m[Vi]=void 0,delete c.delayedLeave,h=void 0},c.delayedLeave=()=>{w(),delete c.delayedLeave,h=void 0}}:h=void 0}else h&&(h=void 0);return i}}};function vw(n){let e=n[0];if(n.length>1){for(const t of n)if(t.type!==or){e=t;break}}return e}const hS=dS;function yw(n,e){const{leavingVNodes:t}=n;let r=t.get(e.type);return r||(r=Object.create(null),t.set(e.type,r)),r}function qp(n,e,t,r,s){const{appear:i,mode:o,persisted:a=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:h,onEnterCancelled:f,onBeforeLeave:m,onLeave:v,onAfterLeave:w,onLeaveCancelled:E,onBeforeAppear:A,onAppear:F,onAfterAppear:U,onAppearCancelled:$}=e,L=String(n.key),se=yw(t,n),te=(I,C)=>{I&&os(I,r,9,C)},T=(I,C)=>{const M=C[1];te(I,C),Ge(I)?I.every(N=>N.length<=1)&&M():I.length<=1&&M()},_={mode:o,persisted:a,beforeEnter(I){let C=l;if(!t.isMounted)if(i)C=A||l;else return;I[Vi]&&I[Vi](!0);const M=se[L];M&&Bo(n,M)&&M.el[Vi]&&M.el[Vi](),te(C,[I])},enter(I){let C=c,M=h,N=f;if(!t.isMounted)if(i)C=F||c,M=U||h,N=$||f;else return;let R=!1;const Qe=I[Id]=it=>{R||(R=!0,it?te(N,[I]):te(M,[I]),_.delayedLeave&&_.delayedLeave(),I[Id]=void 0)};C?T(C,[I,Qe]):Qe()},leave(I,C){const M=String(n.key);if(I[Id]&&I[Id](!0),t.isUnmounting)return C();te(m,[I]);let N=!1;const R=I[Vi]=Qe=>{N||(N=!0,C(),Qe?te(E,[I]):te(w,[I]),I[Vi]=void 0,se[M]===n&&delete se[M])};se[M]=n,v?T(v,[I,R]):R()},clone(I){const C=qp(I,e,t,r,s);return s&&s(C),C}};return _}function tp(n){if(zh(n))return n=no(n),n.children=null,n}function Ay(n){if(!zh(n))return hw(n.type)&&n.children?vw(n.children):n;if(n.component)return n.component.subTree;const{shapeFlag:e,children:t}=n;if(t){if(e&16)return t[0];if(e&32&&nt(t.default))return t.default()}}function tc(n,e){n.shapeFlag&6&&n.component?(n.transition=e,tc(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function _w(n,e=!1,t){let r=[],s=0;for(let i=0;i<n.length;i++){let o=n[i];const a=t==null?o.key:String(t)+String(o.key!=null?o.key:i);o.type===dt?(o.patchFlag&128&&s++,r=r.concat(_w(o.children,e,a))):(e||o.type!==or)&&r.push(a!=null?no(o,{key:a}):o)}if(s>1)for(let i=0;i<r.length;i++)r[i].patchFlag=-2;return r}/*! #__NO_SIDE_EFFECTS__ */function bw(n,e){return nt(n)?(()=>Rn({name:n.name},e,{setup:n}))():n}function ww(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function Lu(n,e,t,r,s=!1){if(Ge(n)){n.forEach((w,E)=>Lu(w,e&&(Ge(e)?e[E]:e),t,r,s));return}if(ol(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&Lu(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?Wh(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,h=a.refs===Ut?a.refs={}:a.refs,f=a.setupState,m=Rt(f),v=f===Ut?()=>!1:w=>Ot(m,w);if(c!=null&&c!==l&&(fn(c)?(h[c]=null,v(c)&&(f[c]=null)):ar(c)&&(c.value=null)),nt(l))Dc(l,a,12,[o,h]);else{const w=fn(l),E=ar(l);if(w||E){const A=()=>{if(n.f){const F=w?v(l)?f[l]:h[l]:l.value;s?Ge(F)&&Um(F,i):Ge(F)?F.includes(i)||F.push(i):w?(h[l]=[i],v(l)&&(f[l]=h[l])):(l.value=[i],n.k&&(h[n.k]=l.value))}else w?(h[l]=o,v(l)&&(f[l]=o)):E&&(l.value=o,n.k&&(h[n.k]=o))};o?(A.id=-1,fr(A,t)):A()}}}Uh().requestIdleCallback;Uh().cancelIdleCallback;const ol=n=>!!n.type.__asyncLoader,zh=n=>n.type.__isKeepAlive;function fS(n,e){xw(n,"a",e)}function pS(n,e){xw(n,"da",e)}function xw(n,e,t=Jn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(Hh(e,r,t),t){let s=t.parent;for(;s&&s.parent;)zh(s.parent.vnode)&&mS(r,e,t,s),s=s.parent}}function mS(n,e,t,r){const s=Hh(e,n,r,!0);Ks(()=>{Um(r[e],s)},t)}function Hh(n,e,t=Jn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Xs();const a=Nc(t),l=os(e,t,n,o);return a(),Zs(),l});return r?s.unshift(i):s.push(i),i}}const ai=n=>(e,t=Jn)=>{(!sc||n==="sp")&&Hh(n,(...r)=>e(...r),t)},gS=ai("bm"),En=ai("m"),vS=ai("bu"),yS=ai("u"),Ym=ai("bum"),Ks=ai("um"),_S=ai("sp"),bS=ai("rtg"),wS=ai("rtc");function xS(n,e=Jn){Hh("ec",n,e)}const Iw="components";function IS(n,e){return TS(Iw,n,!0,e)||n}const ES=Symbol.for("v-ndc");function TS(n,e,t=!0,r=!1){const s=Bn||Jn;if(s){const i=s.type;if(n===Iw){const a=fP(i,!1);if(a&&(a===e||a===Gr(e)||a===Fh(Gr(e))))return i}const o=Sy(s[n]||i[n],e)||Sy(s.appContext[n],e);return!o&&r?i:o}}function Sy(n,e){return n&&(n[e]||n[Gr(e)]||n[Fh(Gr(e))])}function Mr(n,e,t,r){let s;const i=t&&t[r],o=Ge(n);if(o||fn(n)){const a=o&&sl(n);let l=!1,c=!1;a&&(l=!Kr(n),c=to(n),n=jh(n)),s=new Array(n.length);for(let h=0,f=n.length;h<f;h++)s[h]=e(l?c?sh(Qn(n[h])):Qn(n[h]):n[h],h,void 0,i&&i[h])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(jt(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const h=a[l];s[l]=e(n[h],h,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}function AS(n,e,t={},r,s){if(Bn.ce||Bn.parent&&ol(Bn.parent)&&Bn.parent.ce)return e!=="default"&&(t.name=e),k(),Gs(dt,null,[Ye("slot",t,r&&r())],64);let i=n[e];i&&i._c&&(i._d=!1),k();const o=i&&Ew(i(t)),a=t.key||o&&o.key,l=Gs(dt,{key:(a&&!is(a)?a:`_${e}`)+(!o&&r?"_fb":"")},o||(r?r():[]),o&&n._===1?64:-2);return!s&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),i&&i._c&&(i._d=!0),l}function Ew(n){return n.some(e=>rc(e)?!(e.type===or||e.type===dt&&!Ew(e.children)):!0)?n:null}const zp=n=>n?Bw(n)?Wh(n):zp(n.parent):null,$u=Rn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>zp(n.parent),$root:n=>zp(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>Xm(n),$forceUpdate:n=>n.f||(n.f=()=>{Jm(n.update)}),$nextTick:n=>n.n||(n.n=en.bind(n.proxy)),$watch:n=>GS.bind(n)}),np=(n,e)=>n!==Ut&&!n.__isScriptSetup&&Ot(n,e),SS={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const v=o[e];if(v!==void 0)switch(v){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(np(r,e))return o[e]=1,r[e];if(s!==Ut&&Ot(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&Ot(c,e))return o[e]=3,i[e];if(t!==Ut&&Ot(t,e))return o[e]=4,t[e];Hp&&(o[e]=0)}}const h=$u[e];let f,m;if(h)return e==="$attrs"&&ir(n.attrs,"get",""),h(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==Ut&&Ot(t,e))return o[e]=4,t[e];if(m=l.config.globalProperties,Ot(m,e))return m[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return np(s,e)?(s[e]=t,!0):r!==Ut&&Ot(r,e)?(r[e]=t,!0):Ot(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==Ut&&Ot(n,o)||np(e,o)||(a=i[0])&&Ot(a,o)||Ot(r,o)||Ot($u,o)||Ot(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:Ot(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function Py(n){return Ge(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let Hp=!0;function PS(n){const e=Xm(n),t=n.proxy,r=n.ctx;Hp=!1,e.beforeCreate&&Ry(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:h,beforeMount:f,mounted:m,beforeUpdate:v,updated:w,activated:E,deactivated:A,beforeDestroy:F,beforeUnmount:U,destroyed:$,unmounted:L,render:se,renderTracked:te,renderTriggered:T,errorCaptured:_,serverPrefetch:I,expose:C,inheritAttrs:M,components:N,directives:R,filters:Qe}=e;if(c&&RS(c,r,null),o)for(const ne in o){const le=o[ne];nt(le)&&(r[ne]=le.bind(t))}if(s){const ne=s.call(t,t);jt(ne)&&(n.data=Bh(ne))}if(Hp=!0,i)for(const ne in i){const le=i[ne],oe=nt(le)?le.bind(t,t):nt(le.get)?le.get.bind(t,t):ts,Ce=!nt(le)&&nt(le.set)?le.set.bind(t):ts,X=$e({get:oe,set:Ce});Object.defineProperty(r,ne,{enumerable:!0,configurable:!0,get:()=>X.value,set:W=>X.value=W})}if(a)for(const ne in a)Tw(a[ne],r,t,ne);if(l){const ne=nt(l)?l.call(t):l;Reflect.ownKeys(ne).forEach(le=>{Fd(le,ne[le])})}h&&Ry(h,n,"c");function ye(ne,le){Ge(le)?le.forEach(oe=>ne(oe.bind(t))):le&&ne(le.bind(t))}if(ye(gS,f),ye(En,m),ye(vS,v),ye(yS,w),ye(fS,E),ye(pS,A),ye(xS,_),ye(wS,te),ye(bS,T),ye(Ym,U),ye(Ks,L),ye(_S,I),Ge(C))if(C.length){const ne=n.exposed||(n.exposed={});C.forEach(le=>{Object.defineProperty(ne,le,{get:()=>t[le],set:oe=>t[le]=oe})})}else n.exposed||(n.exposed={});se&&n.render===ts&&(n.render=se),M!=null&&(n.inheritAttrs=M),N&&(n.components=N),R&&(n.directives=R),I&&ww(n)}function RS(n,e,t=ts){Ge(n)&&(n=Kp(n));for(const r in n){const s=n[r];let i;jt(s)?"default"in s?i=ss(s.from||r,s.default,!0):i=ss(s.from||r):i=ss(s),ar(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function Ry(n,e,t){os(Ge(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function Tw(n,e,t,r){let s=r.includes(".")?Lw(t,r):()=>t[r];if(fn(n)){const i=e[n];nt(i)&&St(s,i)}else if(nt(n))St(s,n.bind(t));else if(jt(n))if(Ge(n))n.forEach(i=>Tw(i,e,t,r));else{const i=nt(n.handler)?n.handler.bind(t):e[n.handler];nt(i)&&St(s,i,n)}}function Xm(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>lh(l,c,o,!0)),lh(l,e,o)),jt(e)&&i.set(e,l),l}function lh(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&lh(n,i,t,!0),s&&s.forEach(o=>lh(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=CS[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const CS={data:Cy,props:ky,emits:ky,methods:Tu,computed:Tu,beforeCreate:hr,created:hr,beforeMount:hr,mounted:hr,beforeUpdate:hr,updated:hr,beforeDestroy:hr,beforeUnmount:hr,destroyed:hr,unmounted:hr,activated:hr,deactivated:hr,errorCaptured:hr,serverPrefetch:hr,components:Tu,directives:Tu,watch:DS,provide:Cy,inject:kS};function Cy(n,e){return e?n?function(){return Rn(nt(n)?n.call(this,this):n,nt(e)?e.call(this,this):e)}:e:n}function kS(n,e){return Tu(Kp(n),Kp(e))}function Kp(n){if(Ge(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function hr(n,e){return n?[...new Set([].concat(n,e))]:e}function Tu(n,e){return n?Rn(Object.create(null),n,e):e}function ky(n,e){return n?Ge(n)&&Ge(e)?[...new Set([...n,...e])]:Rn(Object.create(null),Py(n),Py(e??{})):e}function DS(n,e){if(!n)return e;if(!e)return n;const t=Rn(Object.create(null),n);for(const r in e)t[r]=hr(n[r],e[r]);return t}function Aw(){return{app:null,config:{isNativeTag:_1,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let NS=0;function OS(n,e){return function(r,s=null){nt(r)||(r=Rn({},r)),s!=null&&!jt(s)&&(s=null);const i=Aw(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:NS++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:mP,get config(){return i.config},set config(h){},use(h,...f){return o.has(h)||(h&&nt(h.install)?(o.add(h),h.install(c,...f)):nt(h)&&(o.add(h),h(c,...f))),c},mixin(h){return i.mixins.includes(h)||i.mixins.push(h),c},component(h,f){return f?(i.components[h]=f,c):i.components[h]},directive(h,f){return f?(i.directives[h]=f,c):i.directives[h]},mount(h,f,m){if(!l){const v=c._ceVNode||Ye(r,s);return v.appContext=i,m===!0?m="svg":m===!1&&(m=void 0),f&&e?e(v,h):n(v,h,m),l=!0,c._container=h,h.__vue_app__=c,Wh(v.component)}},onUnmount(h){a.push(h)},unmount(){l&&(os(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(h,f){return i.provides[h]=f,c},runWithContext(h){const f=al;al=c;try{return h()}finally{al=f}}};return c}}let al=null;function Fd(n,e){if(Jn){let t=Jn.provides;const r=Jn.parent&&Jn.parent.provides;r===t&&(t=Jn.provides=Object.create(r)),t[n]=e}}function ss(n,e,t=!1){const r=Jn||Bn;if(r||al){let s=al?al._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&nt(e)?e.call(r&&r.proxy):e}}const Sw={},Pw=()=>Object.create(Sw),Rw=n=>Object.getPrototypeOf(n)===Sw;function VS(n,e,t,r=!1){const s={},i=Pw();n.propsDefaults=Object.create(null),Cw(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:nw(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function MS(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=Rt(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let f=0;f<h.length;f++){let m=h[f];if(Kh(n.emitsOptions,m))continue;const v=e[m];if(l)if(Ot(i,m))v!==i[m]&&(i[m]=v,c=!0);else{const w=Gr(m);s[w]=Gp(l,a,w,v,n,!1)}else v!==i[m]&&(i[m]=v,c=!0)}}}else{Cw(n,e,s,i)&&(c=!0);let h;for(const f in a)(!e||!Ot(e,f)&&((h=fo(f))===f||!Ot(e,h)))&&(l?t&&(t[f]!==void 0||t[h]!==void 0)&&(s[f]=Gp(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!Ot(e,f))&&(delete i[f],c=!0)}c&&Fs(n.attrs,"set","")}function Cw(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(Nu(l))continue;const c=e[l];let h;s&&Ot(s,h=Gr(l))?!i||!i.includes(h)?t[h]=c:(a||(a={}))[h]=c:Kh(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=Rt(t),c=a||Ut;for(let h=0;h<i.length;h++){const f=i[h];t[f]=Gp(s,l,f,c[f],n,!Ot(c,f))}}return o}function Gp(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=Ot(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&nt(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const h=Nc(s);r=c[t]=l.call(null,e),h()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===fo(t))&&(r=!0))}return r}const LS=new WeakMap;function kw(n,e,t=!1){const r=t?LS:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!nt(n)){const h=f=>{l=!0;const[m,v]=kw(f,e,!0);Rn(o,m),v&&a.push(...v)};!t&&e.mixins.length&&e.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!i&&!l)return jt(n)&&r.set(n,nl),nl;if(Ge(i))for(let h=0;h<i.length;h++){const f=Gr(i[h]);Dy(f)&&(o[f]=Ut)}else if(i)for(const h in i){const f=Gr(h);if(Dy(f)){const m=i[h],v=o[f]=Ge(m)||nt(m)?{type:m}:Rn({},m),w=v.type;let E=!1,A=!0;if(Ge(w))for(let F=0;F<w.length;++F){const U=w[F],$=nt(U)&&U.name;if($==="Boolean"){E=!0;break}else $==="String"&&(A=!1)}else E=nt(w)&&w.name==="Boolean";v[0]=E,v[1]=A,(E||Ot(v,"default"))&&a.push(f)}}const c=[o,a];return jt(n)&&r.set(n,c),c}function Dy(n){return n[0]!=="$"&&!Nu(n)}const Zm=n=>n[0]==="_"||n==="$stable",eg=n=>Ge(n)?n.map(bs):[bs(n)],$S=(n,e,t)=>{if(e._n)return e;const r=Ld((...s)=>eg(e(...s)),t);return r._c=!1,r},Dw=(n,e,t)=>{const r=n._ctx;for(const s in n){if(Zm(s))continue;const i=n[s];if(nt(i))e[s]=$S(s,i,r);else if(i!=null){const o=eg(i);e[s]=()=>o}}},Nw=(n,e)=>{const t=eg(e);n.slots.default=()=>t},Ow=(n,e,t)=>{for(const r in e)(t||!Zm(r))&&(n[r]=e[r])},FS=(n,e,t)=>{const r=n.slots=Pw();if(n.vnode.shapeFlag&32){const s=e.__;s&&Lp(r,"__",s,!0);const i=e._;i?(Ow(r,e,t),t&&Lp(r,"_",i,!0)):Dw(e,r)}else e&&Nw(n,e)},US=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=Ut;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:Ow(s,e,t):(i=!e.$stable,Dw(e,s)),o=e}else e&&(Nw(n,e),o={default:1});if(i)for(const a in s)!Zm(a)&&o[a]==null&&delete s[a]},fr=eP;function jS(n){return BS(n)}function BS(n,e){const t=Uh();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:h,parentNode:f,nextSibling:m,setScopeId:v=ts,insertStaticContent:w}=n,E=(S,O,H,K=null,ee=null,de=null,_e=void 0,ve=null,we=!!O.dynamicChildren)=>{if(S===O)return;S&&!Bo(S,O)&&(K=Y(S),W(S,ee,de,!0),S=null),O.patchFlag===-2&&(we=!1,O.dynamicChildren=null);const{type:ge,ref:Fe,shapeFlag:Re}=O;switch(ge){case Gh:A(S,O,H,K);break;case or:F(S,O,H,K);break;case Ud:S==null&&U(O,H,K,_e);break;case dt:N(S,O,H,K,ee,de,_e,ve,we);break;default:Re&1?se(S,O,H,K,ee,de,_e,ve,we):Re&6?R(S,O,H,K,ee,de,_e,ve,we):(Re&64||Re&128)&&ge.process(S,O,H,K,ee,de,_e,ve,we,De)}Fe!=null&&ee?Lu(Fe,S&&S.ref,de,O||S,!O):Fe==null&&S&&S.ref!=null&&Lu(S.ref,null,de,S,!0)},A=(S,O,H,K)=>{if(S==null)r(O.el=a(O.children),H,K);else{const ee=O.el=S.el;O.children!==S.children&&c(ee,O.children)}},F=(S,O,H,K)=>{S==null?r(O.el=l(O.children||""),H,K):O.el=S.el},U=(S,O,H,K)=>{[S.el,S.anchor]=w(S.children,O,H,K,S.el,S.anchor)},$=({el:S,anchor:O},H,K)=>{let ee;for(;S&&S!==O;)ee=m(S),r(S,H,K),S=ee;r(O,H,K)},L=({el:S,anchor:O})=>{let H;for(;S&&S!==O;)H=m(S),s(S),S=H;s(O)},se=(S,O,H,K,ee,de,_e,ve,we)=>{O.type==="svg"?_e="svg":O.type==="math"&&(_e="mathml"),S==null?te(O,H,K,ee,de,_e,ve,we):I(S,O,ee,de,_e,ve,we)},te=(S,O,H,K,ee,de,_e,ve)=>{let we,ge;const{props:Fe,shapeFlag:Re,transition:Oe,dirs:qe}=S;if(we=S.el=o(S.type,de,Fe&&Fe.is,Fe),Re&8?h(we,S.children):Re&16&&_(S.children,we,null,K,ee,rp(S,de),_e,ve),qe&&Do(S,null,K,"created"),T(we,S,S.scopeId,_e,K),Fe){for(const Xe in Fe)Xe!=="value"&&!Nu(Xe)&&i(we,Xe,null,Fe[Xe],de,K);"value"in Fe&&i(we,"value",null,Fe.value,de),(ge=Fe.onVnodeBeforeMount)&&ys(ge,K,S)}qe&&Do(S,null,K,"beforeMount");const ze=qS(ee,Oe);ze&&Oe.beforeEnter(we),r(we,O,H),((ge=Fe&&Fe.onVnodeMounted)||ze||qe)&&fr(()=>{ge&&ys(ge,K,S),ze&&Oe.enter(we),qe&&Do(S,null,K,"mounted")},ee)},T=(S,O,H,K,ee)=>{if(H&&v(S,H),K)for(let de=0;de<K.length;de++)v(S,K[de]);if(ee){let de=ee.subTree;if(O===de||Fw(de.type)&&(de.ssContent===O||de.ssFallback===O)){const _e=ee.vnode;T(S,_e,_e.scopeId,_e.slotScopeIds,ee.parent)}}},_=(S,O,H,K,ee,de,_e,ve,we=0)=>{for(let ge=we;ge<S.length;ge++){const Fe=S[ge]=ve?Mi(S[ge]):bs(S[ge]);E(null,Fe,O,H,K,ee,de,_e,ve)}},I=(S,O,H,K,ee,de,_e)=>{const ve=O.el=S.el;let{patchFlag:we,dynamicChildren:ge,dirs:Fe}=O;we|=S.patchFlag&16;const Re=S.props||Ut,Oe=O.props||Ut;let qe;if(H&&No(H,!1),(qe=Oe.onVnodeBeforeUpdate)&&ys(qe,H,O,S),Fe&&Do(O,S,H,"beforeUpdate"),H&&No(H,!0),(Re.innerHTML&&Oe.innerHTML==null||Re.textContent&&Oe.textContent==null)&&h(ve,""),ge?C(S.dynamicChildren,ge,ve,H,K,rp(O,ee),de):_e||le(S,O,ve,null,H,K,rp(O,ee),de,!1),we>0){if(we&16)M(ve,Re,Oe,H,ee);else if(we&2&&Re.class!==Oe.class&&i(ve,"class",null,Oe.class,ee),we&4&&i(ve,"style",Re.style,Oe.style,ee),we&8){const ze=O.dynamicProps;for(let Xe=0;Xe<ze.length;Xe++){const ct=ze[Xe],yn=Re[ct],sn=Oe[ct];(sn!==yn||ct==="value")&&i(ve,ct,yn,sn,ee,H)}}we&1&&S.children!==O.children&&h(ve,O.children)}else!_e&&ge==null&&M(ve,Re,Oe,H,ee);((qe=Oe.onVnodeUpdated)||Fe)&&fr(()=>{qe&&ys(qe,H,O,S),Fe&&Do(O,S,H,"updated")},K)},C=(S,O,H,K,ee,de,_e)=>{for(let ve=0;ve<O.length;ve++){const we=S[ve],ge=O[ve],Fe=we.el&&(we.type===dt||!Bo(we,ge)||we.shapeFlag&198)?f(we.el):H;E(we,ge,Fe,null,K,ee,de,_e,!0)}},M=(S,O,H,K,ee)=>{if(O!==H){if(O!==Ut)for(const de in O)!Nu(de)&&!(de in H)&&i(S,de,O[de],null,ee,K);for(const de in H){if(Nu(de))continue;const _e=H[de],ve=O[de];_e!==ve&&de!=="value"&&i(S,de,ve,_e,ee,K)}"value"in H&&i(S,"value",O.value,H.value,ee)}},N=(S,O,H,K,ee,de,_e,ve,we)=>{const ge=O.el=S?S.el:a(""),Fe=O.anchor=S?S.anchor:a("");let{patchFlag:Re,dynamicChildren:Oe,slotScopeIds:qe}=O;qe&&(ve=ve?ve.concat(qe):qe),S==null?(r(ge,H,K),r(Fe,H,K),_(O.children||[],H,Fe,ee,de,_e,ve,we)):Re>0&&Re&64&&Oe&&S.dynamicChildren?(C(S.dynamicChildren,Oe,H,ee,de,_e,ve),(O.key!=null||ee&&O===ee.subTree)&&tg(S,O,!0)):le(S,O,H,Fe,ee,de,_e,ve,we)},R=(S,O,H,K,ee,de,_e,ve,we)=>{O.slotScopeIds=ve,S==null?O.shapeFlag&512?ee.ctx.activate(O,H,K,_e,we):Qe(O,H,K,ee,de,_e,we):it(S,O,we)},Qe=(S,O,H,K,ee,de,_e)=>{const ve=S.component=aP(S,K,ee);if(zh(S)&&(ve.ctx.renderer=De),uP(ve,!1,_e),ve.asyncDep){if(ee&&ee.registerDep(ve,ye,_e),!S.el){const we=ve.subTree=Ye(or);F(null,we,O,H)}}else ye(ve,S,O,H,ee,de,_e)},it=(S,O,H)=>{const K=O.component=S.component;if(XS(S,O,H))if(K.asyncDep&&!K.asyncResolved){ne(K,O,H);return}else K.next=O,K.update();else O.el=S.el,K.vnode=O},ye=(S,O,H,K,ee,de,_e)=>{const ve=()=>{if(S.isMounted){let{next:Re,bu:Oe,u:qe,parent:ze,vnode:Xe}=S;{const zt=Vw(S);if(zt){Re&&(Re.el=Xe.el,ne(S,Re,_e)),zt.asyncDep.then(()=>{S.isUnmounted||ve()});return}}let ct=Re,yn;No(S,!1),Re?(Re.el=Xe.el,ne(S,Re,_e)):Re=Xe,Oe&&Md(Oe),(yn=Re.props&&Re.props.onVnodeBeforeUpdate)&&ys(yn,ze,Re,Xe),No(S,!0);const sn=sp(S),Hn=S.subTree;S.subTree=sn,E(Hn,sn,f(Hn.el),Y(Hn),S,ee,de),Re.el=sn.el,ct===null&&ZS(S,sn.el),qe&&fr(qe,ee),(yn=Re.props&&Re.props.onVnodeUpdated)&&fr(()=>ys(yn,ze,Re,Xe),ee)}else{let Re;const{el:Oe,props:qe}=O,{bm:ze,m:Xe,parent:ct,root:yn,type:sn}=S,Hn=ol(O);if(No(S,!1),ze&&Md(ze),!Hn&&(Re=qe&&qe.onVnodeBeforeMount)&&ys(Re,ct,O),No(S,!0),Oe&&vt){const zt=()=>{S.subTree=sp(S),vt(Oe,S.subTree,S,ee,null)};Hn&&sn.__asyncHydrate?sn.__asyncHydrate(Oe,S,zt):zt()}else{yn.ce&&yn.ce._def.shadowRoot!==!1&&yn.ce._injectChildStyle(sn);const zt=S.subTree=sp(S);E(null,zt,H,K,S,ee,de),O.el=zt.el}if(Xe&&fr(Xe,ee),!Hn&&(Re=qe&&qe.onVnodeMounted)){const zt=O;fr(()=>ys(Re,ct,zt),ee)}(O.shapeFlag&256||ct&&ol(ct.vnode)&&ct.vnode.shapeFlag&256)&&S.a&&fr(S.a,ee),S.isMounted=!0,O=H=K=null}};S.scope.on();const we=S.effect=new Bb(ve);S.scope.off();const ge=S.update=we.run.bind(we),Fe=S.job=we.runIfDirty.bind(we);Fe.i=S,Fe.id=S.uid,we.scheduler=()=>Jm(Fe),No(S,!0),ge()},ne=(S,O,H)=>{O.component=S;const K=S.vnode.props;S.vnode=O,S.next=null,MS(S,O.props,K,H),US(S,O.children,H),Xs(),xy(S),Zs()},le=(S,O,H,K,ee,de,_e,ve,we=!1)=>{const ge=S&&S.children,Fe=S?S.shapeFlag:0,Re=O.children,{patchFlag:Oe,shapeFlag:qe}=O;if(Oe>0){if(Oe&128){Ce(ge,Re,H,K,ee,de,_e,ve,we);return}else if(Oe&256){oe(ge,Re,H,K,ee,de,_e,ve,we);return}}qe&8?(Fe&16&&qt(ge,ee,de),Re!==ge&&h(H,Re)):Fe&16?qe&16?Ce(ge,Re,H,K,ee,de,_e,ve,we):qt(ge,ee,de,!0):(Fe&8&&h(H,""),qe&16&&_(Re,H,K,ee,de,_e,ve,we))},oe=(S,O,H,K,ee,de,_e,ve,we)=>{S=S||nl,O=O||nl;const ge=S.length,Fe=O.length,Re=Math.min(ge,Fe);let Oe;for(Oe=0;Oe<Re;Oe++){const qe=O[Oe]=we?Mi(O[Oe]):bs(O[Oe]);E(S[Oe],qe,H,null,ee,de,_e,ve,we)}ge>Fe?qt(S,ee,de,!0,!1,Re):_(O,H,K,ee,de,_e,ve,we,Re)},Ce=(S,O,H,K,ee,de,_e,ve,we)=>{let ge=0;const Fe=O.length;let Re=S.length-1,Oe=Fe-1;for(;ge<=Re&&ge<=Oe;){const qe=S[ge],ze=O[ge]=we?Mi(O[ge]):bs(O[ge]);if(Bo(qe,ze))E(qe,ze,H,null,ee,de,_e,ve,we);else break;ge++}for(;ge<=Re&&ge<=Oe;){const qe=S[Re],ze=O[Oe]=we?Mi(O[Oe]):bs(O[Oe]);if(Bo(qe,ze))E(qe,ze,H,null,ee,de,_e,ve,we);else break;Re--,Oe--}if(ge>Re){if(ge<=Oe){const qe=Oe+1,ze=qe<Fe?O[qe].el:K;for(;ge<=Oe;)E(null,O[ge]=we?Mi(O[ge]):bs(O[ge]),H,ze,ee,de,_e,ve,we),ge++}}else if(ge>Oe)for(;ge<=Re;)W(S[ge],ee,de,!0),ge++;else{const qe=ge,ze=ge,Xe=new Map;for(ge=ze;ge<=Oe;ge++){const Wt=O[ge]=we?Mi(O[ge]):bs(O[ge]);Wt.key!=null&&Xe.set(Wt.key,ge)}let ct,yn=0;const sn=Oe-ze+1;let Hn=!1,zt=0;const Ur=new Array(sn);for(ge=0;ge<sn;ge++)Ur[ge]=0;for(ge=qe;ge<=Re;ge++){const Wt=S[ge];if(yn>=sn){W(Wt,ee,de,!0);continue}let cn;if(Wt.key!=null)cn=Xe.get(Wt.key);else for(ct=ze;ct<=Oe;ct++)if(Ur[ct-ze]===0&&Bo(Wt,O[ct])){cn=ct;break}cn===void 0?W(Wt,ee,de,!0):(Ur[cn-ze]=ge+1,cn>=zt?zt=cn:Hn=!0,E(Wt,O[cn],H,null,ee,de,_e,ve,we),yn++)}const jr=Hn?zS(Ur):nl;for(ct=jr.length-1,ge=sn-1;ge>=0;ge--){const Wt=ze+ge,cn=O[Wt],Br=Wt+1<Fe?O[Wt+1].el:K;Ur[ge]===0?E(null,cn,H,Br,ee,de,_e,ve,we):Hn&&(ct<0||ge!==jr[ct]?X(cn,H,Br,2):ct--)}}},X=(S,O,H,K,ee=null)=>{const{el:de,type:_e,transition:ve,children:we,shapeFlag:ge}=S;if(ge&6){X(S.component.subTree,O,H,K);return}if(ge&128){S.suspense.move(O,H,K);return}if(ge&64){_e.move(S,O,H,De);return}if(_e===dt){r(de,O,H);for(let Re=0;Re<we.length;Re++)X(we[Re],O,H,K);r(S.anchor,O,H);return}if(_e===Ud){$(S,O,H);return}if(K!==2&&ge&1&&ve)if(K===0)ve.beforeEnter(de),r(de,O,H),fr(()=>ve.enter(de),ee);else{const{leave:Re,delayLeave:Oe,afterLeave:qe}=ve,ze=()=>{S.ctx.isUnmounted?s(de):r(de,O,H)},Xe=()=>{Re(de,()=>{ze(),qe&&qe()})};Oe?Oe(de,ze,Xe):Xe()}else r(de,O,H)},W=(S,O,H,K=!1,ee=!1)=>{const{type:de,props:_e,ref:ve,children:we,dynamicChildren:ge,shapeFlag:Fe,patchFlag:Re,dirs:Oe,cacheIndex:qe}=S;if(Re===-2&&(ee=!1),ve!=null&&(Xs(),Lu(ve,null,H,S,!0),Zs()),qe!=null&&(O.renderCache[qe]=void 0),Fe&256){O.ctx.deactivate(S);return}const ze=Fe&1&&Oe,Xe=!ol(S);let ct;if(Xe&&(ct=_e&&_e.onVnodeBeforeUnmount)&&ys(ct,O,S),Fe&6)mt(S.component,H,K);else{if(Fe&128){S.suspense.unmount(H,K);return}ze&&Do(S,null,O,"beforeUnmount"),Fe&64?S.type.remove(S,O,H,De,K):ge&&!ge.hasOnce&&(de!==dt||Re>0&&Re&64)?qt(ge,O,H,!1,!0):(de===dt&&Re&384||!ee&&Fe&16)&&qt(we,O,H),K&&xe(S)}(Xe&&(ct=_e&&_e.onVnodeUnmounted)||ze)&&fr(()=>{ct&&ys(ct,O,S),ze&&Do(S,null,O,"unmounted")},H)},xe=S=>{const{type:O,el:H,anchor:K,transition:ee}=S;if(O===dt){Ze(H,K);return}if(O===Ud){L(S);return}const de=()=>{s(H),ee&&!ee.persisted&&ee.afterLeave&&ee.afterLeave()};if(S.shapeFlag&1&&ee&&!ee.persisted){const{leave:_e,delayLeave:ve}=ee,we=()=>_e(H,de);ve?ve(S.el,de,we):we()}else de()},Ze=(S,O)=>{let H;for(;S!==O;)H=m(S),s(S),S=H;s(O)},mt=(S,O,H)=>{const{bum:K,scope:ee,job:de,subTree:_e,um:ve,m:we,a:ge,parent:Fe,slots:{__:Re}}=S;Ny(we),Ny(ge),K&&Md(K),Fe&&Ge(Re)&&Re.forEach(Oe=>{Fe.renderCache[Oe]=void 0}),ee.stop(),de&&(de.flags|=8,W(_e,S,O,H)),ve&&fr(ve,O),fr(()=>{S.isUnmounted=!0},O),O&&O.pendingBranch&&!O.isUnmounted&&S.asyncDep&&!S.asyncResolved&&S.suspenseId===O.pendingId&&(O.deps--,O.deps===0&&O.resolve())},qt=(S,O,H,K=!1,ee=!1,de=0)=>{for(let _e=de;_e<S.length;_e++)W(S[_e],O,H,K,ee)},Y=S=>{if(S.shapeFlag&6)return Y(S.component.subTree);if(S.shapeFlag&128)return S.suspense.next();const O=m(S.anchor||S.el),H=O&&O[dw];return H?m(H):O};let Te=!1;const be=(S,O,H)=>{S==null?O._vnode&&W(O._vnode,null,null,!0):E(O._vnode||null,S,O,null,null,null,H),O._vnode=S,Te||(Te=!0,xy(),lw(),Te=!1)},De={p:E,um:W,m:X,r:xe,mt:Qe,mc:_,pc:le,pbc:C,n:Y,o:n};let ot,vt;return e&&([ot,vt]=e(De)),{render:be,hydrate:ot,createApp:OS(be,ot)}}function rp({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function No({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function qS(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function tg(n,e,t=!1){const r=n.children,s=e.children;if(Ge(r)&&Ge(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=Mi(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&tg(o,a)),a.type===Gh&&(a.el=o.el),a.type===or&&!a.el&&(a.el=o.el)}}function zS(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function Vw(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Vw(e)}function Ny(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const HS=Symbol.for("v-scx"),KS=()=>ss(HS);function St(n,e,t){return Mw(n,e,t)}function Mw(n,e,t=Ut){const{immediate:r,deep:s,flush:i,once:o}=t,a=Rn({},t),l=e&&r||!e&&i!=="post";let c;if(sc){if(i==="sync"){const v=KS();c=v.__watcherHandles||(v.__watcherHandles=[])}else if(!l){const v=()=>{};return v.stop=ts,v.resume=ts,v.pause=ts,v}}const h=Jn;a.call=(v,w,E)=>os(v,h,w,E);let f=!1;i==="post"?a.scheduler=v=>{fr(v,h&&h.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(v,w)=>{w?v():Jm(v)}),a.augmentJob=v=>{e&&(v.flags|=4),f&&(v.flags|=2,h&&(v.id=h.uid,v.i=h))};const m=iS(n,e,a);return sc&&(c?c.push(m):l&&m()),m}function GS(n,e,t){const r=this.proxy,s=fn(n)?n.includes(".")?Lw(r,n):()=>r[n]:n.bind(r,r);let i;nt(e)?i=e:(i=e.handler,t=e);const o=Nc(this),a=Mw(s,i.bind(r),t);return o(),a}function Lw(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const WS=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Gr(e)}Modifiers`]||n[`${fo(e)}Modifiers`];function QS(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||Ut;let s=t;const i=e.startsWith("update:"),o=i&&WS(r,e.slice(7));o&&(o.trim&&(s=t.map(h=>fn(h)?h.trim():h)),o.number&&(s=t.map(rh)));let a,l=r[a=Jf(e)]||r[a=Jf(Gr(e))];!l&&i&&(l=r[a=Jf(fo(e))]),l&&os(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,os(c,n,6,s)}}function $w(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!nt(n)){const l=c=>{const h=$w(c,e,!0);h&&(a=!0,Rn(o,h))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(jt(n)&&r.set(n,null),null):(Ge(i)?i.forEach(l=>o[l]=null):Rn(o,i),jt(n)&&r.set(n,o),o)}function Kh(n,e){return!n||!Lh(e)?!1:(e=e.slice(2).replace(/Once$/,""),Ot(n,e[0].toLowerCase()+e.slice(1))||Ot(n,fo(e))||Ot(n,e))}function sp(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:h,props:f,data:m,setupState:v,ctx:w,inheritAttrs:E}=n,A=ah(n);let F,U;try{if(t.shapeFlag&4){const L=s||r,se=L;F=bs(c.call(se,L,h,f,v,m,w)),U=a}else{const L=e;F=bs(L.length>1?L(f,{attrs:a,slots:o,emit:l}):L(f,null)),U=e.props?a:JS(a)}}catch(L){Fu.length=0,qh(L,n,1),F=Ye(or)}let $=F;if(U&&E!==!1){const L=Object.keys(U),{shapeFlag:se}=$;L.length&&se&7&&(i&&L.some(Fm)&&(U=YS(U,i)),$=no($,U,!1,!0))}return t.dirs&&($=no($,null,!1,!0),$.dirs=$.dirs?$.dirs.concat(t.dirs):t.dirs),t.transition&&tc($,t.transition),F=$,ah(A),F}const JS=n=>{let e;for(const t in n)(t==="class"||t==="style"||Lh(t))&&((e||(e={}))[t]=n[t]);return e},YS=(n,e)=>{const t={};for(const r in n)(!Fm(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function XS(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?Oy(r,o,c):!!o;if(l&8){const h=e.dynamicProps;for(let f=0;f<h.length;f++){const m=h[f];if(o[m]!==r[m]&&!Kh(c,m))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Oy(r,o,c):!0:!!o;return!1}function Oy(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!Kh(t,i))return!0}return!1}function ZS({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const Fw=n=>n.__isSuspense;function eP(n,e){e&&e.pendingBranch?Ge(n)?e.effects.push(...n):e.effects.push(n):lS(n)}const dt=Symbol.for("v-fgt"),Gh=Symbol.for("v-txt"),or=Symbol.for("v-cmt"),Ud=Symbol.for("v-stc"),Fu=[];let Lr=null;function k(n=!1){Fu.push(Lr=n?null:[])}function tP(){Fu.pop(),Lr=Fu[Fu.length-1]||null}let nc=1;function Vy(n,e=!1){nc+=n,n<0&&Lr&&e&&(Lr.hasOnce=!0)}function Uw(n){return n.dynamicChildren=nc>0?Lr||nl:null,tP(),nc>0&&Lr&&Lr.push(n),n}function D(n,e,t,r,s,i){return Uw(d(n,e,t,r,s,i,!0))}function Gs(n,e,t,r,s){return Uw(Ye(n,e,t,r,s,!0))}function rc(n){return n?n.__v_isVNode===!0:!1}function Bo(n,e){return n.type===e.type&&n.key===e.key}const jw=({key:n})=>n??null,jd=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?fn(n)||ar(n)||nt(n)?{i:Bn,r:n,k:e,f:!!t}:n:null);function d(n,e=null,t=null,r=0,s=null,i=n===dt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&jw(e),ref:e&&jd(e),scopeId:cw,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Bn};return a?(ng(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=fn(t)?8:16),nc>0&&!o&&Lr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&Lr.push(l),l}const Ye=nP;function nP(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===ES)&&(n=or),rc(n)){const a=no(n,e,!0);return t&&ng(a,t),nc>0&&!i&&Lr&&(a.shapeFlag&6?Lr[Lr.indexOf(n)]=a:Lr.push(a)),a.patchFlag=-2,a}if(pP(n)&&(n=n.__vccOpts),e){e=rP(e);let{class:a,style:l}=e;a&&!fn(a)&&(e.class=Qt(a)),jt(l)&&(Qm(l)&&!Ge(l)&&(l=Rn({},l)),e.style=Vr(l))}const o=fn(n)?1:Fw(n)?128:hw(n)?64:jt(n)?4:nt(n)?2:0;return d(n,e,t,r,s,o,i,!0)}function rP(n){return n?Qm(n)||Rw(n)?Rn({},n):n:null}function no(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?sP(s||{},e):s,h={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&jw(c),ref:e&&e.ref?t&&i?Ge(i)?i.concat(jd(e)):[i,jd(e)]:jd(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==dt?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&no(n.ssContent),ssFallback:n.ssFallback&&no(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&tc(h,l.clone(h)),h}function bt(n=" ",e=0){return Ye(Gh,null,n,e)}function jn(n,e){const t=Ye(Ud,null,n);return t.staticCount=e,t}function ce(n="",e=!1){return e?(k(),Gs(or,null,n)):Ye(or,null,n)}function bs(n){return n==null||typeof n=="boolean"?Ye(or):Ge(n)?Ye(dt,null,n.slice()):rc(n)?Mi(n):Ye(Gh,null,String(n))}function Mi(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:no(n)}function ng(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(Ge(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),ng(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!Rw(e)?e._ctx=Bn:s===3&&Bn&&(Bn.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else nt(e)?(e={default:e,_ctx:Bn},t=32):(e=String(e),r&64?(t=16,e=[bt(e)]):t=8);n.children=e,n.shapeFlag|=t}function sP(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=Qt([e.class,r.class]));else if(s==="style")e.style=Vr([e.style,r.style]);else if(Lh(s)){const i=e[s],o=r[s];o&&i!==o&&!(Ge(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function ys(n,e,t,r=null){os(n,e,7,[t,r])}const iP=Aw();let oP=0;function aP(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||iP,i={uid:oP++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new D1(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:kw(r,s),emitsOptions:$w(r,s),emit:null,emitted:null,propsDefaults:Ut,inheritAttrs:r.inheritAttrs,ctx:Ut,data:Ut,props:Ut,attrs:Ut,slots:Ut,refs:Ut,setupState:Ut,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=QS.bind(null,i),n.ce&&n.ce(i),i}let Jn=null;const lP=()=>Jn||Bn;let uh,Wp;{const n=Uh(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};uh=e("__VUE_INSTANCE_SETTERS__",t=>Jn=t),Wp=e("__VUE_SSR_SETTERS__",t=>sc=t)}const Nc=n=>{const e=Jn;return uh(n),n.scope.on(),()=>{n.scope.off(),uh(e)}},My=()=>{Jn&&Jn.scope.off(),uh(null)};function Bw(n){return n.vnode.shapeFlag&4}let sc=!1;function uP(n,e=!1,t=!1){e&&Wp(e);const{props:r,children:s}=n.vnode,i=Bw(n);VS(n,r,i,e),FS(n,s,t||e);const o=i?cP(n,e):void 0;return e&&Wp(!1),o}function cP(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,SS);const{setup:r}=t;if(r){Xs();const s=n.setupContext=r.length>1?hP(n):null,i=Nc(n),o=Dc(r,n,0,[n.props,s]),a=Mb(o);if(Zs(),i(),(a||n.sp)&&!ol(n)&&ww(n),a){if(o.then(My,My),e)return o.then(l=>{Ly(n,l,e)}).catch(l=>{qh(l,n,0)});n.asyncDep=o}else Ly(n,o,e)}else qw(n,e)}function Ly(n,e,t){nt(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:jt(e)&&(n.setupState=iw(e)),qw(n,t)}let $y;function qw(n,e,t){const r=n.type;if(!n.render){if(!e&&$y&&!r.render){const s=r.template||Xm(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=Rn(Rn({isCustomElement:i,delimiters:a},o),l);r.render=$y(s,c)}}n.render=r.render||ts}{const s=Nc(n);Xs();try{PS(n)}finally{Zs(),s()}}}const dP={get(n,e){return ir(n,"get",""),n[e]}};function hP(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,dP),slots:n.slots,emit:n.emit,expose:e}}function Wh(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(iw(X1(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in $u)return $u[t](n)},has(e,t){return t in e||t in $u}})):n.proxy}function fP(n,e=!0){return nt(n)?n.displayName||n.name:n.name||e&&n.__name}function pP(n){return nt(n)&&"__vccOpts"in n}const $e=(n,e)=>rS(n,e,sc);function rg(n,e,t){const r=arguments.length;return r===2?jt(e)&&!Ge(e)?rc(e)?Ye(n,null,[e]):Ye(n,e):Ye(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&rc(t)&&(t=[t]),Ye(n,e,t))}const mP="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Qp;const Fy=typeof window<"u"&&window.trustedTypes;if(Fy)try{Qp=Fy.createPolicy("vue",{createHTML:n=>n})}catch{}const zw=Qp?n=>Qp.createHTML(n):n=>n,gP="http://www.w3.org/2000/svg",vP="http://www.w3.org/1998/Math/MathML",Ls=typeof document<"u"?document:null,Uy=Ls&&Ls.createElement("template"),yP={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?Ls.createElementNS(gP,n):e==="mathml"?Ls.createElementNS(vP,n):t?Ls.createElement(n,{is:t}):Ls.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>Ls.createTextNode(n),createComment:n=>Ls.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Ls.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{Uy.innerHTML=zw(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=Uy.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Ri="transition",pu="animation",ic=Symbol("_vtc"),Hw={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},_P=Rn({},mw,Hw),bP=n=>(n.displayName="Transition",n.props=_P,n),ip=bP((n,{slots:e})=>rg(hS,wP(n),e)),Oo=(n,e=[])=>{Ge(n)?n.forEach(t=>t(...e)):n&&n(...e)},jy=n=>n?Ge(n)?n.some(e=>e.length>1):n.length>1:!1;function wP(n){const e={};for(const N in n)N in Hw||(e[N]=n[N]);if(n.css===!1)return e;const{name:t="v",type:r,duration:s,enterFromClass:i=`${t}-enter-from`,enterActiveClass:o=`${t}-enter-active`,enterToClass:a=`${t}-enter-to`,appearFromClass:l=i,appearActiveClass:c=o,appearToClass:h=a,leaveFromClass:f=`${t}-leave-from`,leaveActiveClass:m=`${t}-leave-active`,leaveToClass:v=`${t}-leave-to`}=n,w=xP(s),E=w&&w[0],A=w&&w[1],{onBeforeEnter:F,onEnter:U,onEnterCancelled:$,onLeave:L,onLeaveCancelled:se,onBeforeAppear:te=F,onAppear:T=U,onAppearCancelled:_=$}=e,I=(N,R,Qe,it)=>{N._enterCancelled=it,Vo(N,R?h:a),Vo(N,R?c:o),Qe&&Qe()},C=(N,R)=>{N._isLeaving=!1,Vo(N,f),Vo(N,v),Vo(N,m),R&&R()},M=N=>(R,Qe)=>{const it=N?T:U,ye=()=>I(R,N,Qe);Oo(it,[R,ye]),By(()=>{Vo(R,N?l:i),Vs(R,N?h:a),jy(it)||qy(R,r,E,ye)})};return Rn(e,{onBeforeEnter(N){Oo(F,[N]),Vs(N,i),Vs(N,o)},onBeforeAppear(N){Oo(te,[N]),Vs(N,l),Vs(N,c)},onEnter:M(!1),onAppear:M(!0),onLeave(N,R){N._isLeaving=!0;const Qe=()=>C(N,R);Vs(N,f),N._enterCancelled?(Vs(N,m),Ky()):(Ky(),Vs(N,m)),By(()=>{N._isLeaving&&(Vo(N,f),Vs(N,v),jy(L)||qy(N,r,A,Qe))}),Oo(L,[N,Qe])},onEnterCancelled(N){I(N,!1,void 0,!0),Oo($,[N])},onAppearCancelled(N){I(N,!0,void 0,!0),Oo(_,[N])},onLeaveCancelled(N){C(N),Oo(se,[N])}})}function xP(n){if(n==null)return null;if(jt(n))return[op(n.enter),op(n.leave)];{const e=op(n);return[e,e]}}function op(n){return E1(n)}function Vs(n,e){e.split(/\s+/).forEach(t=>t&&n.classList.add(t)),(n[ic]||(n[ic]=new Set)).add(e)}function Vo(n,e){e.split(/\s+/).forEach(r=>r&&n.classList.remove(r));const t=n[ic];t&&(t.delete(e),t.size||(n[ic]=void 0))}function By(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let IP=0;function qy(n,e,t,r){const s=n._endId=++IP,i=()=>{s===n._endId&&r()};if(t!=null)return setTimeout(i,t);const{type:o,timeout:a,propCount:l}=EP(n,e);if(!o)return r();const c=o+"end";let h=0;const f=()=>{n.removeEventListener(c,m),i()},m=v=>{v.target===n&&++h>=l&&f()};setTimeout(()=>{h<l&&f()},a+1),n.addEventListener(c,m)}function EP(n,e){const t=window.getComputedStyle(n),r=w=>(t[w]||"").split(", "),s=r(`${Ri}Delay`),i=r(`${Ri}Duration`),o=zy(s,i),a=r(`${pu}Delay`),l=r(`${pu}Duration`),c=zy(a,l);let h=null,f=0,m=0;e===Ri?o>0&&(h=Ri,f=o,m=i.length):e===pu?c>0&&(h=pu,f=c,m=l.length):(f=Math.max(o,c),h=f>0?o>c?Ri:pu:null,m=h?h===Ri?i.length:l.length:0);const v=h===Ri&&/\b(transform|all)(,|$)/.test(r(`${Ri}Property`).toString());return{type:h,timeout:f,propCount:m,hasTransform:v}}function zy(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max(...e.map((t,r)=>Hy(t)+Hy(n[r])))}function Hy(n){return n==="auto"?0:Number(n.slice(0,-1).replace(",","."))*1e3}function Ky(){return document.body.offsetHeight}function TP(n,e,t){const r=n[ic];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const ch=Symbol("_vod"),Kw=Symbol("_vsh"),ap={beforeMount(n,{value:e},{transition:t}){n[ch]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):mu(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),mu(n,!0),r.enter(n)):r.leave(n,()=>{mu(n,!1)}):mu(n,e))},beforeUnmount(n,{value:e}){mu(n,e)}};function mu(n,e){n.style.display=e?n[ch]:"none",n[Kw]=!e}const AP=Symbol(""),SP=/(^|;)\s*display\s*:/;function PP(n,e,t){const r=n.style,s=fn(t);let i=!1;if(t&&!s){if(e)if(fn(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&Bd(r,a,"")}else for(const o in e)t[o]==null&&Bd(r,o,"");for(const o in t)o==="display"&&(i=!0),Bd(r,o,t[o])}else if(s){if(e!==t){const o=r[AP];o&&(t+=";"+o),r.cssText=t,i=SP.test(t)}}else e&&n.removeAttribute("style");ch in n&&(n[ch]=i?r.display:"",n[Kw]&&(r.display="none"))}const Gy=/\s*!important$/;function Bd(n,e,t){if(Ge(t))t.forEach(r=>Bd(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=RP(n,e);Gy.test(t)?n.setProperty(fo(r),t.replace(Gy,""),"important"):n[r]=t}}const Wy=["Webkit","Moz","ms"],lp={};function RP(n,e){const t=lp[e];if(t)return t;let r=Gr(e);if(r!=="filter"&&r in n)return lp[e]=r;r=Fh(r);for(let s=0;s<Wy.length;s++){const i=Wy[s]+r;if(i in n)return lp[e]=i}return e}const Qy="http://www.w3.org/1999/xlink";function Jy(n,e,t,r,s,i=C1(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(Qy,e.slice(6,e.length)):n.setAttributeNS(Qy,e,t):t==null||i&&!Fb(t)?n.removeAttribute(e):n.setAttribute(e,i?"":is(t)?String(t):t)}function Yy(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?zw(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=Fb(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function $i(n,e,t,r){n.addEventListener(e,t,r)}function CP(n,e,t,r){n.removeEventListener(e,t,r)}const Xy=Symbol("_vei");function kP(n,e,t,r,s=null){const i=n[Xy]||(n[Xy]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=DP(e);if(r){const c=i[e]=VP(r,s);$i(n,a,c,l)}else o&&(CP(n,a,o,l),i[e]=void 0)}}const Zy=/(?:Once|Passive|Capture)$/;function DP(n){let e;if(Zy.test(n)){e={};let r;for(;r=n.match(Zy);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):fo(n.slice(2)),e]}let up=0;const NP=Promise.resolve(),OP=()=>up||(NP.then(()=>up=0),up=Date.now());function VP(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;os(MP(r,t.value),e,5,[r])};return t.value=n,t.attached=OP(),t}function MP(n,e){if(Ge(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const e0=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,LP=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?TP(n,r,o):e==="style"?PP(n,t,r):Lh(e)?Fm(e)||kP(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):$P(n,e,r,o))?(Yy(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Jy(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!fn(r))?Yy(n,Gr(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),Jy(n,e,r,o))};function $P(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&e0(e)&&nt(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return e0(e)&&fn(t)?!1:e in n}const ml=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Ge(e)?t=>Md(e,t):e};function FP(n){n.target.composing=!0}function t0(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Ws=Symbol("_assign"),Mt={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[Ws]=ml(s);const i=r||s.props&&s.props.type==="number";$i(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=rh(a)),n[Ws](a)}),t&&$i(n,"change",()=>{n.value=n.value.trim()}),e||($i(n,"compositionstart",FP),$i(n,"compositionend",t0),$i(n,"change",t0))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[Ws]=ml(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?rh(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},Gi={deep:!0,created(n,e,t){n[Ws]=ml(t),$i(n,"change",()=>{const r=n._modelValue,s=oc(n),i=n.checked,o=n[Ws];if(Ge(r)){const a=Bm(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(Vl(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(Gw(n,i))})},mounted:n0,beforeUpdate(n,e,t){n[Ws]=ml(t),n0(n,e,t)}};function n0(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(Ge(e))s=Bm(e,r.props.value)>-1;else if(Vl(e))s=e.has(r.props.value);else{if(e===t)return;s=kc(e,Gw(n,!0))}n.checked!==s&&(n.checked=s)}const UP={deep:!0,created(n,{value:e,modifiers:{number:t}},r){const s=Vl(e);$i(n,"change",()=>{const i=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>t?rh(oc(o)):oc(o));n[Ws](n.multiple?s?new Set(i):i:i[0]),n._assigning=!0,en(()=>{n._assigning=!1})}),n[Ws]=ml(r)},mounted(n,{value:e}){r0(n,e)},beforeUpdate(n,e,t){n[Ws]=ml(t)},updated(n,{value:e}){n._assigning||r0(n,e)}};function r0(n,e){const t=n.multiple,r=Ge(e);if(!(t&&!r&&!Vl(e))){for(let s=0,i=n.options.length;s<i;s++){const o=n.options[s],a=oc(o);if(t)if(r){const l=typeof a;l==="string"||l==="number"?o.selected=e.some(c=>String(c)===String(a)):o.selected=Bm(e,a)>-1}else o.selected=e.has(a);else if(kc(oc(o),e)){n.selectedIndex!==s&&(n.selectedIndex=s);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function oc(n){return"_value"in n?n._value:n.value}function Gw(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const jP=["ctrl","shift","alt","meta"],BP={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>jP.some(t=>n[`${t}Key`]&&!e.includes(t))},pt=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=BP[e[o]];if(a&&a(s,e))return}return n(s,...i)})},qP={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},rr=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=fo(s.key);if(e.some(o=>o===i||qP[o]===i))return n(s)})},zP=Rn({patchProp:LP},yP);let s0;function HP(){return s0||(s0=jS(zP))}const KP=(...n)=>{const e=HP().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=WP(r);if(!s)return;const i=e._component;!nt(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,GP(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function GP(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function WP(n){return fn(n)?document.querySelector(n):n}const QP="/icons/icon-48x48.png";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ww=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},JP=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Qw={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let m=(a&15)<<2|c>>6,v=c&63;l||(v=64,o||(m=64)),r.push(t[h],t[f],t[m],t[v])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Ww(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):JP(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new YP;const m=i<<2|a>>4;if(r.push(m),c!==64){const v=a<<4&240|c>>2;if(r.push(v),f!==64){const w=c<<6&192|f;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class YP extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const XP=function(n){const e=Ww(n);return Qw.encodeByteArray(e,!0)},dh=function(n){return XP(n).replace(/\./g,"")},Jw=function(n){try{return Qw.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZP(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eR=()=>ZP().__FIREBASE_DEFAULTS__,tR=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},nR=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Jw(n[1]);return e&&JSON.parse(e)},Qh=()=>{try{return eR()||tR()||nR()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Yw=n=>{var e,t;return(t=(e=Qh())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Xw=n=>{const e=Yw(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Zw=()=>{var n;return(n=Qh())===null||n===void 0?void 0:n.config},ex=n=>{var e;return(e=Qh())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tx(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[dh(JSON.stringify(t)),dh(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function sR(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Nn())}function iR(){var n;const e=(n=Qh())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function oR(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function aR(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function lR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function uR(){const n=Nn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function nx(){return!iR()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function sg(){try{return typeof indexedDB=="object"}catch{return!1}}function rx(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}function cR(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dR="FirebaseError";class us extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=dR,Object.setPrototypeOf(this,us.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ma.prototype.create)}}class ma{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?hR(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new us(s,a,r)}}function hR(n,e){return n.replace(fR,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const fR=/\{\$([^}]+)}/g;function pR(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function ro(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(i0(i)&&i0(o)){if(!ro(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function i0(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ml(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Au(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Su(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function mR(n,e){const t=new gR(n,e);return t.subscribe.bind(t)}class gR{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");vR(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=cp),s.error===void 0&&(s.error=cp),s.complete===void 0&&(s.complete=cp);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function vR(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function cp(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Me(n){return n&&n._delegate?n._delegate:n}class Wr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $o="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yR{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new rR;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(bR(e))try{this.getOrInitializeService({instanceIdentifier:$o})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=$o){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=$o){return this.instances.has(e)}getOptions(e=$o){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:_R(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=$o){return this.component?this.component.multipleInstances?e:$o:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function _R(n){return n===$o?void 0:n}function bR(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new yR(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _t;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(_t||(_t={}));const xR={debug:_t.DEBUG,verbose:_t.VERBOSE,info:_t.INFO,warn:_t.WARN,error:_t.ERROR,silent:_t.SILENT},IR=_t.INFO,ER={[_t.DEBUG]:"log",[_t.VERBOSE]:"log",[_t.INFO]:"info",[_t.WARN]:"warn",[_t.ERROR]:"error"},TR=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=ER[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ig{constructor(e){this.name=e,this._logLevel=IR,this._logHandler=TR,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in _t))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?xR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,_t.DEBUG,...e),this._logHandler(this,_t.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,_t.VERBOSE,...e),this._logHandler(this,_t.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,_t.INFO,...e),this._logHandler(this,_t.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,_t.WARN,...e),this._logHandler(this,_t.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,_t.ERROR,...e),this._logHandler(this,_t.ERROR,...e)}}const AR=(n,e)=>e.some(t=>n instanceof t);let o0,a0;function SR(){return o0||(o0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function PR(){return a0||(a0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const sx=new WeakMap,Jp=new WeakMap,ix=new WeakMap,dp=new WeakMap,og=new WeakMap;function RR(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Qs(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&sx.set(t,n)}).catch(()=>{}),og.set(e,n),e}function CR(n){if(Jp.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});Jp.set(n,e)}let Yp={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Jp.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ix.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Qs(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function kR(n){Yp=n(Yp)}function DR(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(hp(this),e,...t);return ix.set(r,e.sort?e.sort():[e]),Qs(r)}:PR().includes(n)?function(...e){return n.apply(hp(this),e),Qs(sx.get(this))}:function(...e){return Qs(n.apply(hp(this),e))}}function NR(n){return typeof n=="function"?DR(n):(n instanceof IDBTransaction&&CR(n),AR(n,SR())?new Proxy(n,Yp):n)}function Qs(n){if(n instanceof IDBRequest)return RR(n);if(dp.has(n))return dp.get(n);const e=NR(n);return e!==n&&(dp.set(n,e),og.set(e,n)),e}const hp=n=>og.get(n);function Jh(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Qs(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Qs(o.result),l.oldVersion,l.newVersion,Qs(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function fp(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),Qs(t).then(()=>{})}const OR=["get","getKey","getAll","getAllKeys","count"],VR=["put","add","delete","clear"],pp=new Map;function l0(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(pp.get(e))return pp.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=VR.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||OR.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return pp.set(e,i),i}kR(n=>({...n,get:(e,t,r)=>l0(e,t)||n.get(e,t,r),has:(e,t)=>!!l0(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MR{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(LR(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function LR(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Xp="@firebase/app",u0="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ei=new ig("@firebase/app"),$R="@firebase/app-compat",FR="@firebase/analytics-compat",UR="@firebase/analytics",jR="@firebase/app-check-compat",BR="@firebase/app-check",qR="@firebase/auth",zR="@firebase/auth-compat",HR="@firebase/database",KR="@firebase/data-connect",GR="@firebase/database-compat",WR="@firebase/functions",QR="@firebase/functions-compat",JR="@firebase/installations",YR="@firebase/installations-compat",XR="@firebase/messaging",ZR="@firebase/messaging-compat",eC="@firebase/performance",tC="@firebase/performance-compat",nC="@firebase/remote-config",rC="@firebase/remote-config-compat",sC="@firebase/storage",iC="@firebase/storage-compat",oC="@firebase/firestore",aC="@firebase/vertexai-preview",lC="@firebase/firestore-compat",uC="firebase",cC="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hh="[DEFAULT]",dC={[Xp]:"fire-core",[$R]:"fire-core-compat",[UR]:"fire-analytics",[FR]:"fire-analytics-compat",[BR]:"fire-app-check",[jR]:"fire-app-check-compat",[qR]:"fire-auth",[zR]:"fire-auth-compat",[HR]:"fire-rtdb",[KR]:"fire-data-connect",[GR]:"fire-rtdb-compat",[WR]:"fire-fn",[QR]:"fire-fn-compat",[JR]:"fire-iid",[YR]:"fire-iid-compat",[XR]:"fire-fcm",[ZR]:"fire-fcm-compat",[eC]:"fire-perf",[tC]:"fire-perf-compat",[nC]:"fire-rc",[rC]:"fire-rc-compat",[sC]:"fire-gcs",[iC]:"fire-gcs-compat",[oC]:"fire-fst",[lC]:"fire-fst-compat",[aC]:"fire-vertex","fire-js":"fire-js",[uC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fh=new Map,hC=new Map,Zp=new Map;function c0(n,e){try{n.container.addComponent(e)}catch(t){ei.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function as(n){const e=n.name;if(Zp.has(e))return ei.debug(`There were multiple attempts to register component ${e}.`),!1;Zp.set(e,n);for(const t of fh.values())c0(t,n);for(const t of hC.values())c0(t,n);return!0}function li(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function fC(n,e,t=hh){li(n,e).clearInstance(t)}function In(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Yi=new ma("app","Firebase",pC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mC{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Wr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Yi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ga=cC;function ox(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:hh,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Yi.create("bad-app-name",{appName:String(s)});if(t||(t=Zw()),!t)throw Yi.create("no-options");const i=fh.get(s);if(i){if(ro(t,i.options)&&ro(r,i.config))return i;throw Yi.create("duplicate-app",{appName:s})}const o=new wR(s);for(const l of Zp.values())o.addComponent(l);const a=new mC(t,r,o);return fh.set(s,a),a}function Yh(n=hh){const e=fh.get(n);if(!e&&n===hh&&Zw())return ox();if(!e)throw Yi.create("no-app",{appName:n});return e}function Sr(n,e,t){var r;let s=(r=dC[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ei.warn(a.join(" "));return}as(new Wr(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gC="firebase-heartbeat-database",vC=1,ac="firebase-heartbeat-store";let mp=null;function ax(){return mp||(mp=Jh(gC,vC,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(ac)}catch(t){console.warn(t)}}}}).catch(n=>{throw Yi.create("idb-open",{originalErrorMessage:n.message})})),mp}async function yC(n){try{const t=(await ax()).transaction(ac),r=await t.objectStore(ac).get(lx(n));return await t.done,r}catch(e){if(e instanceof us)ei.warn(e.message);else{const t=Yi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ei.warn(t.message)}}}async function d0(n,e){try{const r=(await ax()).transaction(ac,"readwrite");await r.objectStore(ac).put(e,lx(n)),await r.done}catch(t){if(t instanceof us)ei.warn(t.message);else{const r=Yi.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});ei.warn(r.message)}}}function lx(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _C=1024,bC=30*24*60*60*1e3;class wC{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new IC(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=h0();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=bC}),this._storage.overwrite(this._heartbeatsCache))}catch(r){ei.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=h0(),{heartbeatsToSend:r,unsentEntries:s}=xC(this._heartbeatsCache.heartbeats),i=dh(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return ei.warn(t),""}}}function h0(){return new Date().toISOString().substring(0,10)}function xC(n,e=_C){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),f0(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),f0(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class IC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return sg()?rx().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await yC(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return d0(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return d0(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function f0(n){return dh(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EC(n){as(new Wr("platform-logger",e=>new MR(e),"PRIVATE")),as(new Wr("heartbeat",e=>new wC(e),"PRIVATE")),Sr(Xp,u0,n),Sr(Xp,u0,"esm2017"),Sr("fire-js","")}EC("");const ux="@firebase/installations",ag="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cx=1e4,dx=`w:${ag}`,hx="FIS_v2",TC="https://firebaseinstallations.googleapis.com/v1",AC=60*60*1e3,SC="installations",PC="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RC={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},na=new ma(SC,PC,RC);function fx(n){return n instanceof us&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function px({projectId:n}){return`${TC}/projects/${n}/installations`}function mx(n){return{token:n.token,requestStatus:2,expiresIn:kC(n.expiresIn),creationTime:Date.now()}}async function gx(n,e){const r=(await e.json()).error;return na.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function vx({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function CC(n,{refreshToken:e}){const t=vx(n);return t.append("Authorization",DC(e)),t}async function yx(n){const e=await n();return e.status>=500&&e.status<600?n():e}function kC(n){return Number(n.replace("s","000"))}function DC(n){return`${hx} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NC({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=px(n),s=vx(n),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={fid:t,authVersion:hx,appId:n.appId,sdkVersion:dx},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await yx(()=>fetch(r,a));if(l.ok){const c=await l.json();return{fid:c.fid||t,registrationStatus:2,refreshToken:c.refreshToken,authToken:mx(c.authToken)}}else throw await gx("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _x(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OC(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VC=/^[cdef][\w-]{21}$/,em="";function MC(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=LC(n);return VC.test(t)?t:em}catch{return em}}function LC(n){return OC(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xh(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bx=new Map;function wx(n,e){const t=Xh(n);xx(t,e),$C(t,e)}function xx(n,e){const t=bx.get(n);if(t)for(const r of t)r(e)}function $C(n,e){const t=FC();t&&t.postMessage({key:n,fid:e}),UC()}let Go=null;function FC(){return!Go&&"BroadcastChannel"in self&&(Go=new BroadcastChannel("[Firebase] FID Change"),Go.onmessage=n=>{xx(n.data.key,n.data.fid)}),Go}function UC(){bx.size===0&&Go&&(Go.close(),Go=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jC="firebase-installations-database",BC=1,ra="firebase-installations-store";let gp=null;function lg(){return gp||(gp=Jh(jC,BC,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(ra)}}})),gp}async function ph(n,e){const t=Xh(n),s=(await lg()).transaction(ra,"readwrite"),i=s.objectStore(ra),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&wx(n,e.fid),e}async function Ix(n){const e=Xh(n),r=(await lg()).transaction(ra,"readwrite");await r.objectStore(ra).delete(e),await r.done}async function Zh(n,e){const t=Xh(n),s=(await lg()).transaction(ra,"readwrite"),i=s.objectStore(ra),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&wx(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ug(n){let e;const t=await Zh(n.appConfig,r=>{const s=qC(r),i=zC(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===em?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function qC(n){const e=n||{fid:MC(),registrationStatus:0};return Ex(e)}function zC(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(na.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=HC(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:KC(n)}:{installationEntry:e}}async function HC(n,e){try{const t=await NC(n,e);return ph(n.appConfig,t)}catch(t){throw fx(t)&&t.customData.serverCode===409?await Ix(n.appConfig):await ph(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function KC(n){let e=await p0(n.appConfig);for(;e.registrationStatus===1;)await _x(100),e=await p0(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await ug(n);return r||t}return e}function p0(n){return Zh(n,e=>{if(!e)throw na.create("installation-not-found");return Ex(e)})}function Ex(n){return GC(n)?{fid:n.fid,registrationStatus:0}:n}function GC(n){return n.registrationStatus===1&&n.registrationTime+cx<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WC({appConfig:n,heartbeatServiceProvider:e},t){const r=QC(n,t),s=CC(n,t),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={installation:{sdkVersion:dx,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await yx(()=>fetch(r,a));if(l.ok){const c=await l.json();return mx(c)}else throw await gx("Generate Auth Token",l)}function QC(n,{fid:e}){return`${px(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cg(n,e=!1){let t;const r=await Zh(n.appConfig,i=>{if(!Tx(i))throw na.create("not-registered");const o=i.authToken;if(!e&&XC(o))return i;if(o.requestStatus===1)return t=JC(n,e),i;{if(!navigator.onLine)throw na.create("app-offline");const a=ek(i);return t=YC(n,a),a}});return t?await t:r.authToken}async function JC(n,e){let t=await m0(n.appConfig);for(;t.authToken.requestStatus===1;)await _x(100),t=await m0(n.appConfig);const r=t.authToken;return r.requestStatus===0?cg(n,e):r}function m0(n){return Zh(n,e=>{if(!Tx(e))throw na.create("not-registered");const t=e.authToken;return tk(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function YC(n,e){try{const t=await WC(n,e),r=Object.assign(Object.assign({},e),{authToken:t});return await ph(n.appConfig,r),t}catch(t){if(fx(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await Ix(n.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await ph(n.appConfig,r)}throw t}}function Tx(n){return n!==void 0&&n.registrationStatus===2}function XC(n){return n.requestStatus===2&&!ZC(n)}function ZC(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+AC}function ek(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function tk(n){return n.requestStatus===1&&n.requestTime+cx<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nk(n){const e=n,{installationEntry:t,registrationPromise:r}=await ug(e);return r?r.catch(console.error):cg(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rk(n,e=!1){const t=n;return await sk(t),(await cg(t,e)).token}async function sk(n){const{registrationPromise:e}=await ug(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ik(n){if(!n||!n.options)throw vp("App Configuration");if(!n.name)throw vp("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw vp(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function vp(n){return na.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ax="installations",ok="installations-internal",ak=n=>{const e=n.getProvider("app").getImmediate(),t=ik(e),r=li(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},lk=n=>{const e=n.getProvider("app").getImmediate(),t=li(e,Ax).getImmediate();return{getId:()=>nk(t),getToken:s=>rk(t,s)}};function uk(){as(new Wr(Ax,ak,"PUBLIC")),as(new Wr(ok,lk,"PRIVATE"))}uk();Sr(ux,ag);Sr(ux,ag,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ck="/firebase-messaging-sw.js",dk="/firebase-cloud-messaging-push-scope",Sx="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",hk="https://fcmregistrations.googleapis.com/v1",Px="google.c.a.c_id",fk="google.c.a.c_l",pk="google.c.a.ts",mk="google.c.a.e";var g0;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(g0||(g0={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var lc;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(lc||(lc={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $s(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function gk(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),s=new Uint8Array(r.length);for(let i=0;i<r.length;++i)s[i]=r.charCodeAt(i);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yp="fcm_token_details_db",vk=5,v0="fcm_token_object_Store";async function yk(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(i=>i.name).includes(yp))return null;let e=null;return(await Jh(yp,vk,{upgrade:async(r,s,i,o)=>{var a;if(s<2||!r.objectStoreNames.contains(v0))return;const l=o.objectStore(v0),c=await l.index("fcmSenderId").get(n);if(await l.clear(),!!c){if(s===2){const h=c;if(!h.auth||!h.p256dh||!h.endpoint)return;e={token:h.fcmToken,createTime:(a=h.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:h.auth,p256dh:h.p256dh,endpoint:h.endpoint,swScope:h.swScope,vapidKey:typeof h.vapidKey=="string"?h.vapidKey:$s(h.vapidKey)}}}else if(s===3){const h=c;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:$s(h.auth),p256dh:$s(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:$s(h.vapidKey)}}}else if(s===4){const h=c;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:$s(h.auth),p256dh:$s(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:$s(h.vapidKey)}}}}}})).close(),await fp(yp),await fp("fcm_vapid_details_db"),await fp("undefined"),_k(e)?e:null}function _k(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bk="firebase-messaging-database",wk=1,uc="firebase-messaging-store";let _p=null;function Rx(){return _p||(_p=Jh(bk,wk,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(uc)}}})),_p}async function xk(n){const e=Cx(n),r=await(await Rx()).transaction(uc).objectStore(uc).get(e);if(r)return r;{const s=await yk(n.appConfig.senderId);if(s)return await dg(n,s),s}}async function dg(n,e){const t=Cx(n),s=(await Rx()).transaction(uc,"readwrite");return await s.objectStore(uc).put(e,t),await s.done,e}function Cx({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ik={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},mr=new ma("messaging","Messaging",Ik);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ek(n,e){const t=await fg(n),r=kx(e),s={method:"POST",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(hg(n.appConfig),s)).json()}catch(o){throw mr.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw mr.create("token-subscribe-failed",{errorInfo:o})}if(!i.token)throw mr.create("token-subscribe-no-token");return i.token}async function Tk(n,e){const t=await fg(n),r=kx(e.subscriptionOptions),s={method:"PATCH",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(`${hg(n.appConfig)}/${e.token}`,s)).json()}catch(o){throw mr.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw mr.create("token-update-failed",{errorInfo:o})}if(!i.token)throw mr.create("token-update-no-token");return i.token}async function Ak(n,e){const r={method:"DELETE",headers:await fg(n)};try{const i=await(await fetch(`${hg(n.appConfig)}/${e}`,r)).json();if(i.error){const o=i.error.message;throw mr.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw mr.create("token-unsubscribe-failed",{errorInfo:s==null?void 0:s.toString()})}}function hg({projectId:n}){return`${hk}/projects/${n}/registrations`}async function fg({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function kx({p256dh:n,auth:e,endpoint:t,vapidKey:r}){const s={web:{endpoint:t,auth:e,p256dh:n}};return r!==Sx&&(s.web.applicationPubKey=r),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sk=7*24*60*60*1e3;async function Pk(n){const e=await Ck(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:$s(e.getKey("auth")),p256dh:$s(e.getKey("p256dh"))},r=await xk(n.firebaseDependencies);if(r){if(kk(r.subscriptionOptions,t))return Date.now()>=r.createTime+Sk?Rk(n,{token:r.token,createTime:Date.now(),subscriptionOptions:t}):r.token;try{await Ak(n.firebaseDependencies,r.token)}catch(s){console.warn(s)}return y0(n.firebaseDependencies,t)}else return y0(n.firebaseDependencies,t)}async function Rk(n,e){try{const t=await Tk(n.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await dg(n.firebaseDependencies,r),t}catch(t){throw t}}async function y0(n,e){const r={token:await Ek(n,e),createTime:Date.now(),subscriptionOptions:e};return await dg(n,r),r.token}async function Ck(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:gk(e)})}function kk(n,e){const t=e.vapidKey===n.vapidKey,r=e.endpoint===n.endpoint,s=e.auth===n.auth,i=e.p256dh===n.p256dh;return t&&r&&s&&i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _0(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return Dk(e,n),Nk(e,n),Ok(e,n),e}function Dk(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const r=e.notification.body;r&&(n.notification.body=r);const s=e.notification.image;s&&(n.notification.image=s);const i=e.notification.icon;i&&(n.notification.icon=i)}function Nk(n,e){e.data&&(n.data=e.data)}function Ok(n,e){var t,r,s,i,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(s=(r=e.fcmOptions)===null||r===void 0?void 0:r.link)!==null&&s!==void 0?s:(i=e.notification)===null||i===void 0?void 0:i.click_action;a&&(n.fcmOptions.link=a);const l=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;l&&(n.fcmOptions.analyticsLabel=l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vk(n){return typeof n=="object"&&!!n&&Px in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Mk("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function Mk(n,e){const t=[];for(let r=0;r<n.length;r++)t.push(n.charAt(r)),r<e.length&&t.push(e.charAt(r));return t.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lk(n){if(!n||!n.options)throw bp("App Configuration Object");if(!n.name)throw bp("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const r of e)if(!t[r])throw bp(r);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function bp(n){return mr.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=Lk(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fk(n){try{n.swRegistration=await navigator.serviceWorker.register(ck,{scope:dk}),n.swRegistration.update().catch(()=>{})}catch(e){throw mr.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uk(n,e){if(!e&&!n.swRegistration&&await Fk(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw mr.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jk(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=Sx)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dx(n,e){if(!navigator)throw mr.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw mr.create("permission-blocked");return await jk(n,e==null?void 0:e.vapidKey),await Uk(n,e==null?void 0:e.serviceWorkerRegistration),Pk(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bk(n,e,t){const r=qk(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:t[Px],message_name:t[fk],message_time:t[pk],message_device_time:Math.floor(Date.now()/1e3)})}function qk(n){switch(n){case lc.NOTIFICATION_CLICKED:return"notification_open";case lc.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zk(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===lc.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(_0(t)):n.onMessageHandler.next(_0(t)));const r=t.data;Vk(r)&&r[mk]==="1"&&await Bk(n,t.messageType,r)}const b0="@firebase/messaging",w0="0.12.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hk=n=>{const e=new $k(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>zk(e,t)),e},Kk=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:r=>Dx(e,r)}};function Gk(){as(new Wr("messaging",Hk,"PUBLIC")),as(new Wr("messaging-internal",Kk,"PRIVATE")),Sr(b0,w0),Sr(b0,w0,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nx(){try{await rx()}catch{return!1}return typeof window<"u"&&sg()&&cR()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pg(n=Yh()){return Nx().then(e=>{if(!e)throw mr.create("unsupported-browser")},e=>{throw mr.create("indexed-db-unsupported")}),li(Me(n),"messaging").getImmediate()}async function Ox(n,e){return n=Me(n),Dx(n,e)}Gk();var Wk="firebase",Qk="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Sr(Wk,Qk,"app");var x0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Yo,Vx;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(T,_){function I(){}I.prototype=_.prototype,T.D=_.prototype,T.prototype=new I,T.prototype.constructor=T,T.C=function(C,M,N){for(var R=Array(arguments.length-2),Qe=2;Qe<arguments.length;Qe++)R[Qe-2]=arguments[Qe];return _.prototype[M].apply(C,R)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,_,I){I||(I=0);var C=Array(16);if(typeof _=="string")for(var M=0;16>M;++M)C[M]=_.charCodeAt(I++)|_.charCodeAt(I++)<<8|_.charCodeAt(I++)<<16|_.charCodeAt(I++)<<24;else for(M=0;16>M;++M)C[M]=_[I++]|_[I++]<<8|_[I++]<<16|_[I++]<<24;_=T.g[0],I=T.g[1],M=T.g[2];var N=T.g[3],R=_+(N^I&(M^N))+C[0]+3614090360&4294967295;_=I+(R<<7&4294967295|R>>>25),R=N+(M^_&(I^M))+C[1]+3905402710&4294967295,N=_+(R<<12&4294967295|R>>>20),R=M+(I^N&(_^I))+C[2]+606105819&4294967295,M=N+(R<<17&4294967295|R>>>15),R=I+(_^M&(N^_))+C[3]+3250441966&4294967295,I=M+(R<<22&4294967295|R>>>10),R=_+(N^I&(M^N))+C[4]+4118548399&4294967295,_=I+(R<<7&4294967295|R>>>25),R=N+(M^_&(I^M))+C[5]+1200080426&4294967295,N=_+(R<<12&4294967295|R>>>20),R=M+(I^N&(_^I))+C[6]+2821735955&4294967295,M=N+(R<<17&4294967295|R>>>15),R=I+(_^M&(N^_))+C[7]+4249261313&4294967295,I=M+(R<<22&4294967295|R>>>10),R=_+(N^I&(M^N))+C[8]+1770035416&4294967295,_=I+(R<<7&4294967295|R>>>25),R=N+(M^_&(I^M))+C[9]+2336552879&4294967295,N=_+(R<<12&4294967295|R>>>20),R=M+(I^N&(_^I))+C[10]+4294925233&4294967295,M=N+(R<<17&4294967295|R>>>15),R=I+(_^M&(N^_))+C[11]+2304563134&4294967295,I=M+(R<<22&4294967295|R>>>10),R=_+(N^I&(M^N))+C[12]+1804603682&4294967295,_=I+(R<<7&4294967295|R>>>25),R=N+(M^_&(I^M))+C[13]+4254626195&4294967295,N=_+(R<<12&4294967295|R>>>20),R=M+(I^N&(_^I))+C[14]+2792965006&4294967295,M=N+(R<<17&4294967295|R>>>15),R=I+(_^M&(N^_))+C[15]+1236535329&4294967295,I=M+(R<<22&4294967295|R>>>10),R=_+(M^N&(I^M))+C[1]+4129170786&4294967295,_=I+(R<<5&4294967295|R>>>27),R=N+(I^M&(_^I))+C[6]+3225465664&4294967295,N=_+(R<<9&4294967295|R>>>23),R=M+(_^I&(N^_))+C[11]+643717713&4294967295,M=N+(R<<14&4294967295|R>>>18),R=I+(N^_&(M^N))+C[0]+3921069994&4294967295,I=M+(R<<20&4294967295|R>>>12),R=_+(M^N&(I^M))+C[5]+3593408605&4294967295,_=I+(R<<5&4294967295|R>>>27),R=N+(I^M&(_^I))+C[10]+38016083&4294967295,N=_+(R<<9&4294967295|R>>>23),R=M+(_^I&(N^_))+C[15]+3634488961&4294967295,M=N+(R<<14&4294967295|R>>>18),R=I+(N^_&(M^N))+C[4]+3889429448&4294967295,I=M+(R<<20&4294967295|R>>>12),R=_+(M^N&(I^M))+C[9]+568446438&4294967295,_=I+(R<<5&4294967295|R>>>27),R=N+(I^M&(_^I))+C[14]+3275163606&4294967295,N=_+(R<<9&4294967295|R>>>23),R=M+(_^I&(N^_))+C[3]+4107603335&4294967295,M=N+(R<<14&4294967295|R>>>18),R=I+(N^_&(M^N))+C[8]+1163531501&4294967295,I=M+(R<<20&4294967295|R>>>12),R=_+(M^N&(I^M))+C[13]+2850285829&4294967295,_=I+(R<<5&4294967295|R>>>27),R=N+(I^M&(_^I))+C[2]+4243563512&4294967295,N=_+(R<<9&4294967295|R>>>23),R=M+(_^I&(N^_))+C[7]+1735328473&4294967295,M=N+(R<<14&4294967295|R>>>18),R=I+(N^_&(M^N))+C[12]+2368359562&4294967295,I=M+(R<<20&4294967295|R>>>12),R=_+(I^M^N)+C[5]+4294588738&4294967295,_=I+(R<<4&4294967295|R>>>28),R=N+(_^I^M)+C[8]+2272392833&4294967295,N=_+(R<<11&4294967295|R>>>21),R=M+(N^_^I)+C[11]+1839030562&4294967295,M=N+(R<<16&4294967295|R>>>16),R=I+(M^N^_)+C[14]+4259657740&4294967295,I=M+(R<<23&4294967295|R>>>9),R=_+(I^M^N)+C[1]+2763975236&4294967295,_=I+(R<<4&4294967295|R>>>28),R=N+(_^I^M)+C[4]+1272893353&4294967295,N=_+(R<<11&4294967295|R>>>21),R=M+(N^_^I)+C[7]+4139469664&4294967295,M=N+(R<<16&4294967295|R>>>16),R=I+(M^N^_)+C[10]+3200236656&4294967295,I=M+(R<<23&4294967295|R>>>9),R=_+(I^M^N)+C[13]+681279174&4294967295,_=I+(R<<4&4294967295|R>>>28),R=N+(_^I^M)+C[0]+3936430074&4294967295,N=_+(R<<11&4294967295|R>>>21),R=M+(N^_^I)+C[3]+3572445317&4294967295,M=N+(R<<16&4294967295|R>>>16),R=I+(M^N^_)+C[6]+76029189&4294967295,I=M+(R<<23&4294967295|R>>>9),R=_+(I^M^N)+C[9]+3654602809&4294967295,_=I+(R<<4&4294967295|R>>>28),R=N+(_^I^M)+C[12]+3873151461&4294967295,N=_+(R<<11&4294967295|R>>>21),R=M+(N^_^I)+C[15]+530742520&4294967295,M=N+(R<<16&4294967295|R>>>16),R=I+(M^N^_)+C[2]+3299628645&4294967295,I=M+(R<<23&4294967295|R>>>9),R=_+(M^(I|~N))+C[0]+4096336452&4294967295,_=I+(R<<6&4294967295|R>>>26),R=N+(I^(_|~M))+C[7]+1126891415&4294967295,N=_+(R<<10&4294967295|R>>>22),R=M+(_^(N|~I))+C[14]+2878612391&4294967295,M=N+(R<<15&4294967295|R>>>17),R=I+(N^(M|~_))+C[5]+4237533241&4294967295,I=M+(R<<21&4294967295|R>>>11),R=_+(M^(I|~N))+C[12]+1700485571&4294967295,_=I+(R<<6&4294967295|R>>>26),R=N+(I^(_|~M))+C[3]+2399980690&4294967295,N=_+(R<<10&4294967295|R>>>22),R=M+(_^(N|~I))+C[10]+4293915773&4294967295,M=N+(R<<15&4294967295|R>>>17),R=I+(N^(M|~_))+C[1]+2240044497&4294967295,I=M+(R<<21&4294967295|R>>>11),R=_+(M^(I|~N))+C[8]+1873313359&4294967295,_=I+(R<<6&4294967295|R>>>26),R=N+(I^(_|~M))+C[15]+4264355552&4294967295,N=_+(R<<10&4294967295|R>>>22),R=M+(_^(N|~I))+C[6]+2734768916&4294967295,M=N+(R<<15&4294967295|R>>>17),R=I+(N^(M|~_))+C[13]+1309151649&4294967295,I=M+(R<<21&4294967295|R>>>11),R=_+(M^(I|~N))+C[4]+4149444226&4294967295,_=I+(R<<6&4294967295|R>>>26),R=N+(I^(_|~M))+C[11]+3174756917&4294967295,N=_+(R<<10&4294967295|R>>>22),R=M+(_^(N|~I))+C[2]+718787259&4294967295,M=N+(R<<15&4294967295|R>>>17),R=I+(N^(M|~_))+C[9]+3951481745&4294967295,T.g[0]=T.g[0]+_&4294967295,T.g[1]=T.g[1]+(M+(R<<21&4294967295|R>>>11))&4294967295,T.g[2]=T.g[2]+M&4294967295,T.g[3]=T.g[3]+N&4294967295}r.prototype.u=function(T,_){_===void 0&&(_=T.length);for(var I=_-this.blockSize,C=this.B,M=this.h,N=0;N<_;){if(M==0)for(;N<=I;)s(this,T,N),N+=this.blockSize;if(typeof T=="string"){for(;N<_;)if(C[M++]=T.charCodeAt(N++),M==this.blockSize){s(this,C),M=0;break}}else for(;N<_;)if(C[M++]=T[N++],M==this.blockSize){s(this,C),M=0;break}}this.h=M,this.o+=_},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var _=1;_<T.length-8;++_)T[_]=0;var I=8*this.o;for(_=T.length-8;_<T.length;++_)T[_]=I&255,I/=256;for(this.u(T),T=Array(16),_=I=0;4>_;++_)for(var C=0;32>C;C+=8)T[I++]=this.g[_]>>>C&255;return T};function i(T,_){var I=a;return Object.prototype.hasOwnProperty.call(I,T)?I[T]:I[T]=_(T)}function o(T,_){this.h=_;for(var I=[],C=!0,M=T.length-1;0<=M;M--){var N=T[M]|0;C&&N==_||(I[M]=N,C=!1)}this.g=I}var a={};function l(T){return-128<=T&&128>T?i(T,function(_){return new o([_|0],0>_?-1:0)}):new o([T|0],0>T?-1:0)}function c(T){if(isNaN(T)||!isFinite(T))return f;if(0>T)return A(c(-T));for(var _=[],I=1,C=0;T>=I;C++)_[C]=T/I|0,I*=4294967296;return new o(_,0)}function h(T,_){if(T.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(T.charAt(0)=="-")return A(h(T.substring(1),_));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=c(Math.pow(_,8)),C=f,M=0;M<T.length;M+=8){var N=Math.min(8,T.length-M),R=parseInt(T.substring(M,M+N),_);8>N?(N=c(Math.pow(_,N)),C=C.j(N).add(c(R))):(C=C.j(I),C=C.add(c(R)))}return C}var f=l(0),m=l(1),v=l(16777216);n=o.prototype,n.m=function(){if(E(this))return-A(this).m();for(var T=0,_=1,I=0;I<this.g.length;I++){var C=this.i(I);T+=(0<=C?C:4294967296+C)*_,_*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(w(this))return"0";if(E(this))return"-"+A(this).toString(T);for(var _=c(Math.pow(T,6)),I=this,C="";;){var M=L(I,_).g;I=F(I,M.j(_));var N=((0<I.g.length?I.g[0]:I.h)>>>0).toString(T);if(I=M,w(I))return N+C;for(;6>N.length;)N="0"+N;C=N+C}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function w(T){if(T.h!=0)return!1;for(var _=0;_<T.g.length;_++)if(T.g[_]!=0)return!1;return!0}function E(T){return T.h==-1}n.l=function(T){return T=F(this,T),E(T)?-1:w(T)?0:1};function A(T){for(var _=T.g.length,I=[],C=0;C<_;C++)I[C]=~T.g[C];return new o(I,~T.h).add(m)}n.abs=function(){return E(this)?A(this):this},n.add=function(T){for(var _=Math.max(this.g.length,T.g.length),I=[],C=0,M=0;M<=_;M++){var N=C+(this.i(M)&65535)+(T.i(M)&65535),R=(N>>>16)+(this.i(M)>>>16)+(T.i(M)>>>16);C=R>>>16,N&=65535,R&=65535,I[M]=R<<16|N}return new o(I,I[I.length-1]&-2147483648?-1:0)};function F(T,_){return T.add(A(_))}n.j=function(T){if(w(this)||w(T))return f;if(E(this))return E(T)?A(this).j(A(T)):A(A(this).j(T));if(E(T))return A(this.j(A(T)));if(0>this.l(v)&&0>T.l(v))return c(this.m()*T.m());for(var _=this.g.length+T.g.length,I=[],C=0;C<2*_;C++)I[C]=0;for(C=0;C<this.g.length;C++)for(var M=0;M<T.g.length;M++){var N=this.i(C)>>>16,R=this.i(C)&65535,Qe=T.i(M)>>>16,it=T.i(M)&65535;I[2*C+2*M]+=R*it,U(I,2*C+2*M),I[2*C+2*M+1]+=N*it,U(I,2*C+2*M+1),I[2*C+2*M+1]+=R*Qe,U(I,2*C+2*M+1),I[2*C+2*M+2]+=N*Qe,U(I,2*C+2*M+2)}for(C=0;C<_;C++)I[C]=I[2*C+1]<<16|I[2*C];for(C=_;C<2*_;C++)I[C]=0;return new o(I,0)};function U(T,_){for(;(T[_]&65535)!=T[_];)T[_+1]+=T[_]>>>16,T[_]&=65535,_++}function $(T,_){this.g=T,this.h=_}function L(T,_){if(w(_))throw Error("division by zero");if(w(T))return new $(f,f);if(E(T))return _=L(A(T),_),new $(A(_.g),A(_.h));if(E(_))return _=L(T,A(_)),new $(A(_.g),_.h);if(30<T.g.length){if(E(T)||E(_))throw Error("slowDivide_ only works with positive integers.");for(var I=m,C=_;0>=C.l(T);)I=se(I),C=se(C);var M=te(I,1),N=te(C,1);for(C=te(C,2),I=te(I,2);!w(C);){var R=N.add(C);0>=R.l(T)&&(M=M.add(I),N=R),C=te(C,1),I=te(I,1)}return _=F(T,M.j(_)),new $(M,_)}for(M=f;0<=T.l(_);){for(I=Math.max(1,Math.floor(T.m()/_.m())),C=Math.ceil(Math.log(I)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),N=c(I),R=N.j(_);E(R)||0<R.l(T);)I-=C,N=c(I),R=N.j(_);w(N)&&(N=m),M=M.add(N),T=F(T,R)}return new $(M,T)}n.A=function(T){return L(this,T).h},n.and=function(T){for(var _=Math.max(this.g.length,T.g.length),I=[],C=0;C<_;C++)I[C]=this.i(C)&T.i(C);return new o(I,this.h&T.h)},n.or=function(T){for(var _=Math.max(this.g.length,T.g.length),I=[],C=0;C<_;C++)I[C]=this.i(C)|T.i(C);return new o(I,this.h|T.h)},n.xor=function(T){for(var _=Math.max(this.g.length,T.g.length),I=[],C=0;C<_;C++)I[C]=this.i(C)^T.i(C);return new o(I,this.h^T.h)};function se(T){for(var _=T.g.length+1,I=[],C=0;C<_;C++)I[C]=T.i(C)<<1|T.i(C-1)>>>31;return new o(I,T.h)}function te(T,_){var I=_>>5;_%=32;for(var C=T.g.length-I,M=[],N=0;N<C;N++)M[N]=0<_?T.i(N+I)>>>_|T.i(N+I+1)<<32-_:T.i(N+I);return new o(M,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Vx=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=h,Yo=o}).apply(typeof x0<"u"?x0:typeof self<"u"?self:typeof window<"u"?window:{});var Ed=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Mx,Pu,Lx,qd,tm,$x,Fx,Ux;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,y){return u==Array.prototype||u==Object.prototype||(u[p]=y.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ed=="object"&&Ed];for(var p=0;p<u.length;++p){var y=u[p];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var y=r;u=u.split(".");for(var x=0;x<u.length-1;x++){var q=u[x];if(!(q in y))break e;y=y[q]}u=u[u.length-1],x=y[u],p=p(x),p!=x&&p!=null&&e(y,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var y=0,x=!1,q={next:function(){if(!x&&y<u.length){var J=y++;return{value:p(J,u[J]),done:!1}}return x=!0,{done:!0,value:void 0}}};return q[Symbol.iterator]=function(){return q},q}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,y){return y})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function c(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function h(u,p,y){return u.call.apply(u.bind,arguments)}function f(u,p,y){if(!u)throw Error();if(2<arguments.length){var x=Array.prototype.slice.call(arguments,2);return function(){var q=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(q,x),u.apply(p,q)}}return function(){return u.apply(p,arguments)}}function m(u,p,y){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,m.apply(null,arguments)}function v(u,p){var y=Array.prototype.slice.call(arguments,1);return function(){var x=y.slice();return x.push.apply(x,arguments),u.apply(this,x)}}function w(u,p){function y(){}y.prototype=p.prototype,u.aa=p.prototype,u.prototype=new y,u.prototype.constructor=u,u.Qb=function(x,q,J){for(var Ae=Array(arguments.length-2),Ct=2;Ct<arguments.length;Ct++)Ae[Ct-2]=arguments[Ct];return p.prototype[q].apply(x,Ae)}}function E(u){const p=u.length;if(0<p){const y=Array(p);for(let x=0;x<p;x++)y[x]=u[x];return y}return[]}function A(u,p){for(let y=1;y<arguments.length;y++){const x=arguments[y];if(l(x)){const q=u.length||0,J=x.length||0;u.length=q+J;for(let Ae=0;Ae<J;Ae++)u[q+Ae]=x[Ae]}else u.push(x)}}class F{constructor(p,y){this.i=p,this.j=y,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function U(u){return/^[\s\xa0]*$/.test(u)}function $(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function L(u){return L[" "](u),u}L[" "]=function(){};var se=$().indexOf("Gecko")!=-1&&!($().toLowerCase().indexOf("webkit")!=-1&&$().indexOf("Edge")==-1)&&!($().indexOf("Trident")!=-1||$().indexOf("MSIE")!=-1)&&$().indexOf("Edge")==-1;function te(u,p,y){for(const x in u)p.call(y,u[x],x,u)}function T(u,p){for(const y in u)p.call(void 0,u[y],y,u)}function _(u){const p={};for(const y in u)p[y]=u[y];return p}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(u,p){let y,x;for(let q=1;q<arguments.length;q++){x=arguments[q];for(y in x)u[y]=x[y];for(let J=0;J<I.length;J++)y=I[J],Object.prototype.hasOwnProperty.call(x,y)&&(u[y]=x[y])}}function M(u){var p=1;u=u.split(":");const y=[];for(;0<p&&u.length;)y.push(u.shift()),p--;return u.length&&y.push(u.join(":")),y}function N(u){a.setTimeout(()=>{throw u},0)}function R(){var u=oe;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class Qe{constructor(){this.h=this.g=null}add(p,y){const x=it.get();x.set(p,y),this.h?this.h.next=x:this.g=x,this.h=x}}var it=new F(()=>new ye,u=>u.reset());class ye{constructor(){this.next=this.g=this.h=null}set(p,y){this.h=p,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let ne,le=!1,oe=new Qe,Ce=()=>{const u=a.Promise.resolve(void 0);ne=()=>{u.then(X)}};var X=()=>{for(var u;u=R();){try{u.h.call(u.g)}catch(y){N(y)}var p=it;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}le=!1};function W(){this.s=this.s,this.C=this.C}W.prototype.s=!1,W.prototype.ma=function(){this.s||(this.s=!0,this.N())},W.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function xe(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}xe.prototype.h=function(){this.defaultPrevented=!0};var Ze=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const y=()=>{};a.addEventListener("test",y,p),a.removeEventListener("test",y,p)}catch{}return u}();function mt(u,p){if(xe.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var y=this.type=u.type,x=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(se){e:{try{L(p.nodeName);var q=!0;break e}catch{}q=!1}q||(p=null)}}else y=="mouseover"?p=u.fromElement:y=="mouseout"&&(p=u.toElement);this.relatedTarget=p,x?(this.clientX=x.clientX!==void 0?x.clientX:x.pageX,this.clientY=x.clientY!==void 0?x.clientY:x.pageY,this.screenX=x.screenX||0,this.screenY=x.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:qt[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&mt.aa.h.call(this)}}w(mt,xe);var qt={2:"touch",3:"pen",4:"mouse"};mt.prototype.h=function(){mt.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var Y="closure_listenable_"+(1e6*Math.random()|0),Te=0;function be(u,p,y,x,q){this.listener=u,this.proxy=null,this.src=p,this.type=y,this.capture=!!x,this.ha=q,this.key=++Te,this.da=this.fa=!1}function De(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function ot(u){this.src=u,this.g={},this.h=0}ot.prototype.add=function(u,p,y,x,q){var J=u.toString();u=this.g[J],u||(u=this.g[J]=[],this.h++);var Ae=S(u,p,x,q);return-1<Ae?(p=u[Ae],y||(p.fa=!1)):(p=new be(p,this.src,J,!!x,q),p.fa=y,u.push(p)),p};function vt(u,p){var y=p.type;if(y in u.g){var x=u.g[y],q=Array.prototype.indexOf.call(x,p,void 0),J;(J=0<=q)&&Array.prototype.splice.call(x,q,1),J&&(De(p),u.g[y].length==0&&(delete u.g[y],u.h--))}}function S(u,p,y,x){for(var q=0;q<u.length;++q){var J=u[q];if(!J.da&&J.listener==p&&J.capture==!!y&&J.ha==x)return q}return-1}var O="closure_lm_"+(1e6*Math.random()|0),H={};function K(u,p,y,x,q){if(x&&x.once)return _e(u,p,y,x,q);if(Array.isArray(p)){for(var J=0;J<p.length;J++)K(u,p[J],y,x,q);return null}return y=qe(y),u&&u[Y]?u.K(p,y,c(x)?!!x.capture:!!x,q):ee(u,p,y,!1,x,q)}function ee(u,p,y,x,q,J){if(!p)throw Error("Invalid event type");var Ae=c(q)?!!q.capture:!!q,Ct=Re(u);if(Ct||(u[O]=Ct=new ot(u)),y=Ct.add(p,y,x,Ae,J),y.proxy)return y;if(x=de(),y.proxy=x,x.src=u,x.listener=y,u.addEventListener)Ze||(q=Ae),q===void 0&&(q=!1),u.addEventListener(p.toString(),x,q);else if(u.attachEvent)u.attachEvent(ge(p.toString()),x);else if(u.addListener&&u.removeListener)u.addListener(x);else throw Error("addEventListener and attachEvent are unavailable.");return y}function de(){function u(y){return p.call(u.src,u.listener,y)}const p=Fe;return u}function _e(u,p,y,x,q){if(Array.isArray(p)){for(var J=0;J<p.length;J++)_e(u,p[J],y,x,q);return null}return y=qe(y),u&&u[Y]?u.L(p,y,c(x)?!!x.capture:!!x,q):ee(u,p,y,!0,x,q)}function ve(u,p,y,x,q){if(Array.isArray(p))for(var J=0;J<p.length;J++)ve(u,p[J],y,x,q);else x=c(x)?!!x.capture:!!x,y=qe(y),u&&u[Y]?(u=u.i,p=String(p).toString(),p in u.g&&(J=u.g[p],y=S(J,y,x,q),-1<y&&(De(J[y]),Array.prototype.splice.call(J,y,1),J.length==0&&(delete u.g[p],u.h--)))):u&&(u=Re(u))&&(p=u.g[p.toString()],u=-1,p&&(u=S(p,y,x,q)),(y=-1<u?p[u]:null)&&we(y))}function we(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[Y])vt(p.i,u);else{var y=u.type,x=u.proxy;p.removeEventListener?p.removeEventListener(y,x,u.capture):p.detachEvent?p.detachEvent(ge(y),x):p.addListener&&p.removeListener&&p.removeListener(x),(y=Re(p))?(vt(y,u),y.h==0&&(y.src=null,p[O]=null)):De(u)}}}function ge(u){return u in H?H[u]:H[u]="on"+u}function Fe(u,p){if(u.da)u=!0;else{p=new mt(p,this);var y=u.listener,x=u.ha||u.src;u.fa&&we(u),u=y.call(x,p)}return u}function Re(u){return u=u[O],u instanceof ot?u:null}var Oe="__closure_events_fn_"+(1e9*Math.random()>>>0);function qe(u){return typeof u=="function"?u:(u[Oe]||(u[Oe]=function(p){return u.handleEvent(p)}),u[Oe])}function ze(){W.call(this),this.i=new ot(this),this.M=this,this.F=null}w(ze,W),ze.prototype[Y]=!0,ze.prototype.removeEventListener=function(u,p,y,x){ve(this,u,p,y,x)};function Xe(u,p){var y,x=u.F;if(x)for(y=[];x;x=x.F)y.push(x);if(u=u.M,x=p.type||p,typeof p=="string")p=new xe(p,u);else if(p instanceof xe)p.target=p.target||u;else{var q=p;p=new xe(x,u),C(p,q)}if(q=!0,y)for(var J=y.length-1;0<=J;J--){var Ae=p.g=y[J];q=ct(Ae,x,!0,p)&&q}if(Ae=p.g=u,q=ct(Ae,x,!0,p)&&q,q=ct(Ae,x,!1,p)&&q,y)for(J=0;J<y.length;J++)Ae=p.g=y[J],q=ct(Ae,x,!1,p)&&q}ze.prototype.N=function(){if(ze.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var y=u.g[p],x=0;x<y.length;x++)De(y[x]);delete u.g[p],u.h--}}this.F=null},ze.prototype.K=function(u,p,y,x){return this.i.add(String(u),p,!1,y,x)},ze.prototype.L=function(u,p,y,x){return this.i.add(String(u),p,!0,y,x)};function ct(u,p,y,x){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var q=!0,J=0;J<p.length;++J){var Ae=p[J];if(Ae&&!Ae.da&&Ae.capture==y){var Ct=Ae.listener,Dn=Ae.ha||Ae.src;Ae.fa&&vt(u.i,Ae),q=Ct.call(Dn,x)!==!1&&q}}return q&&!x.defaultPrevented}function yn(u,p,y){if(typeof u=="function")y&&(u=m(u,y));else if(u&&typeof u.handleEvent=="function")u=m(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(u,p||0)}function sn(u){u.g=yn(()=>{u.g=null,u.i&&(u.i=!1,sn(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class Hn extends W{constructor(p,y){super(),this.m=p,this.l=y,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:sn(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function zt(u){W.call(this),this.h=u,this.g={}}w(zt,W);var Ur=[];function jr(u){te(u.g,function(p,y){this.g.hasOwnProperty(y)&&we(p)},u),u.g={}}zt.prototype.N=function(){zt.aa.N.call(this),jr(this)},zt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Wt=a.JSON.stringify,cn=a.JSON.parse,Br=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function ie(){}ie.prototype.h=null;function B(u){return u.h||(u.h=u.i())}function Ee(){}var Ue={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function He(){xe.call(this,"d")}w(He,xe);function lt(){xe.call(this,"c")}w(lt,xe);var yt={},At=null;function Cn(){return At=At||new ze}yt.La="serverreachability";function kn(u){xe.call(this,yt.La,u)}w(kn,xe);function Zn(u){const p=Cn();Xe(p,new kn(p))}yt.STAT_EVENT="statevent";function rt(u,p){xe.call(this,yt.STAT_EVENT,u),this.stat=p}w(rt,xe);function Pt(u){const p=Cn();Xe(p,new rt(p,u))}yt.Ma="timingevent";function er(u,p){xe.call(this,yt.Ma,u),this.size=p}w(er,xe);function tr(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function Vn(){this.g=!0}Vn.prototype.xa=function(){this.g=!1};function Aa(u,p,y,x,q,J){u.info(function(){if(u.g)if(J)for(var Ae="",Ct=J.split("&"),Dn=0;Dn<Ct.length;Dn++){var Et=Ct[Dn].split("=");if(1<Et.length){var Ln=Et[0];Et=Et[1];var $n=Ln.split("_");Ae=2<=$n.length&&$n[1]=="type"?Ae+(Ln+"="+Et+"&"):Ae+(Ln+"=redacted&")}}else Ae=null;else Ae=J;return"XMLHTTP REQ ("+x+") [attempt "+q+"]: "+p+`
`+y+`
`+Ae})}function Sa(u,p,y,x,q,J,Ae){u.info(function(){return"XMLHTTP RESP ("+x+") [ attempt "+q+"]: "+p+`
`+y+`
`+J+" "+Ae})}function cs(u,p,y,x){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+Bf(u,y)+(x?" "+x:"")})}function jf(u,p){u.info(function(){return"TIMEOUT: "+p})}Vn.prototype.info=function(){};function Bf(u,p){if(!u.g)return p;if(!p)return null;try{var y=JSON.parse(p);if(y){for(u=0;u<y.length;u++)if(Array.isArray(y[u])){var x=y[u];if(!(2>x.length)){var q=x[1];if(Array.isArray(q)&&!(1>q.length)){var J=q[0];if(J!="noop"&&J!="stop"&&J!="close")for(var Ae=1;Ae<q.length;Ae++)q[Ae]=""}}}}return Wt(y)}catch{return p}}var Pa={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},nd={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ra;function Ca(){}w(Ca,ie),Ca.prototype.g=function(){return new XMLHttpRequest},Ca.prototype.i=function(){return{}},Ra=new Ca;function Yr(u,p,y,x){this.j=u,this.i=p,this.l=y,this.R=x||1,this.U=new zt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new rd}function rd(){this.i=null,this.g="",this.h=!1}var Xl={},Zl={};function qr(u,p,y){u.L=1,u.v=wo(yr(p)),u.m=y,u.P=!0,ds(u,null)}function ds(u,p){u.F=Date.now(),Rr(u),u.A=yr(u.v);var y=u.A,x=u.R;Array.isArray(x)||(x=[String(x)]),ud(y.i,"t",x),u.C=0,y=u.j.J,u.h=new rd,u.g=cu(u.j,y?p:null,!u.m),0<u.O&&(u.M=new Hn(m(u.Y,u,u.g),u.O)),p=u.U,y=u.g,x=u.ca;var q="readystatechange";Array.isArray(q)||(q&&(Ur[0]=q.toString()),q=Ur);for(var J=0;J<q.length;J++){var Ae=K(y,q[J],x||p.handleEvent,!1,p.h||p);if(!Ae)break;p.g[Ae.key]=Ae}p=u.H?_(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),Zn(),Aa(u.i,u.u,u.A,u.l,u.R,u.m)}Yr.prototype.ca=function(u){u=u.target;const p=this.M;p&&_n(u)==3?p.j():this.Y(u)},Yr.prototype.Y=function(u){try{if(u==this.g)e:{const $n=_n(this.g);var p=this.g.Ba();const Pi=this.g.Z();if(!(3>$n)&&($n!=3||this.g&&(this.h.h||this.g.oa()||dd(this.g)))){this.J||$n!=4||p==7||(p==8||0>=Pi?Zn(3):Zn(2)),gi(this);var y=this.g.Z();this.X=y;t:if(Xr(this)){var x=dd(this.g);u="";var q=x.length,J=_n(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Rs(this),Zr(this);var Ae="";break t}this.h.i=new a.TextDecoder}for(p=0;p<q;p++)this.h.h=!0,u+=this.h.i.decode(x[p],{stream:!(J&&p==q-1)});x.length=0,this.h.g+=u,this.C=0,Ae=this.h.g}else Ae=this.g.oa();if(this.o=y==200,Sa(this.i,this.u,this.A,this.l,this.R,$n,y),this.o){if(this.T&&!this.K){t:{if(this.g){var Ct,Dn=this.g;if((Ct=Dn.g?Dn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(Ct)){var Et=Ct;break t}}Et=null}if(y=Et)cs(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,vr(this,y);else{this.o=!1,this.s=3,Pt(12),Rs(this),Zr(this);break e}}if(this.P){y=!0;let Dr;for(;!this.J&&this.C<Ae.length;)if(Dr=mi(this,Ae),Dr==Zl){$n==4&&(this.s=4,Pt(14),y=!1),cs(this.i,this.l,null,"[Incomplete Response]");break}else if(Dr==Xl){this.s=4,Pt(15),cs(this.i,this.l,Ae,"[Invalid Chunk]"),y=!1;break}else cs(this.i,this.l,Dr,null),vr(this,Dr);if(Xr(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),$n!=4||Ae.length!=0||this.h.h||(this.s=1,Pt(16),y=!1),this.o=this.o&&y,!y)cs(this.i,this.l,Ae,"[Invalid Chunked Response]"),Rs(this),Zr(this);else if(0<Ae.length&&!this.W){this.W=!0;var Ln=this.j;Ln.g==this&&Ln.ba&&!Ln.M&&(Ln.j.info("Great, no buffering proxy detected. Bytes received: "+Ae.length),Ua(Ln),Ln.M=!0,Pt(11))}}else cs(this.i,this.l,Ae,null),vr(this,Ae);$n==4&&Rs(this),this.o&&!this.J&&($n==4?So(this.j,this):(this.o=!1,Rr(this)))}else ou(this.g),y==400&&0<Ae.indexOf("Unknown SID")?(this.s=3,Pt(12)):(this.s=0,Pt(13)),Rs(this),Zr(this)}}}catch{}finally{}};function Xr(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function mi(u,p){var y=u.C,x=p.indexOf(`
`,y);return x==-1?Zl:(y=Number(p.substring(y,x)),isNaN(y)?Xl:(x+=1,x+y>p.length?Zl:(p=p.slice(x,x+y),u.C=x+y,p)))}Yr.prototype.cancel=function(){this.J=!0,Rs(this)};function Rr(u){u.S=Date.now()+u.I,eu(u,u.I)}function eu(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=tr(m(u.ba,u),p)}function gi(u){u.B&&(a.clearTimeout(u.B),u.B=null)}Yr.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(jf(this.i,this.A),this.L!=2&&(Zn(),Pt(17)),Rs(this),this.s=2,Zr(this)):eu(this,this.S-u)};function Zr(u){u.j.G==0||u.J||So(u.j,u)}function Rs(u){gi(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,jr(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function vr(u,p){try{var y=u.j;if(y.G!=0&&(y.g==u||Kn(y.h,u))){if(!u.K&&Kn(y.h,u)&&y.G==3){try{var x=y.Da.g.parse(p)}catch{x=null}if(Array.isArray(x)&&x.length==3){var q=x;if(q[0]==0){e:if(!y.u){if(y.g)if(y.g.F+3e3<u.F)Ai(y),Eo(y);else break e;uu(y),Pt(18)}}else y.za=q[1],0<y.za-y.T&&37500>q[2]&&y.F&&y.v==0&&!y.C&&(y.C=tr(m(y.Za,y),6e3));if(1>=id(y.h)&&y.ca){try{y.ca()}catch{}y.ca=void 0}}else vs(y,11)}else if((u.K||y.g==u)&&Ai(y),!U(p))for(q=y.Da.g.parse(p),p=0;p<q.length;p++){let Et=q[p];if(y.T=Et[0],Et=Et[1],y.G==2)if(Et[0]=="c"){y.K=Et[1],y.ia=Et[2];const Ln=Et[3];Ln!=null&&(y.la=Ln,y.j.info("VER="+y.la));const $n=Et[4];$n!=null&&(y.Aa=$n,y.j.info("SVER="+y.Aa));const Pi=Et[5];Pi!=null&&typeof Pi=="number"&&0<Pi&&(x=1.5*Pi,y.L=x,y.j.info("backChannelRequestTimeoutMs_="+x)),x=y;const Dr=u.g;if(Dr){const Nr=Dr.g?Dr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Nr){var J=x.h;J.g||Nr.indexOf("spdy")==-1&&Nr.indexOf("quic")==-1&&Nr.indexOf("h2")==-1||(J.j=J.l,J.g=new Set,J.h&&(vi(J,J.h),J.h=null))}if(x.D){const du=Dr.g?Dr.g.getResponseHeader("X-HTTP-Session-Id"):null;du&&(x.ya=du,Ft(x.I,x.D,du))}}y.G=3,y.l&&y.l.ua(),y.ba&&(y.R=Date.now()-u.F,y.j.info("Handshake RTT: "+y.R+"ms")),x=y;var Ae=u;if(x.qa=md(x,x.J?x.ia:null,x.W),Ae.K){Cr(x.h,Ae);var Ct=Ae,Dn=x.L;Dn&&(Ct.I=Dn),Ct.B&&(gi(Ct),Rr(Ct)),x.g=Ae}else Fa(x);0<y.i.length&&Ti(y)}else Et[0]!="stop"&&Et[0]!="close"||vs(y,7);else y.G==3&&(Et[0]=="stop"||Et[0]=="close"?Et[0]=="stop"?vs(y,7):au(y):Et[0]!="noop"&&y.l&&y.l.ta(Et),y.v=0)}}Zn(4)}catch{}}var sd=class{constructor(u,p){this.g=u,this.map=p}};function tu(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ka(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function id(u){return u.h?1:u.g?u.g.size:0}function Kn(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function vi(u,p){u.g?u.g.add(p):u.h=p}function Cr(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}tu.prototype.cancel=function(){if(this.i=nu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function nu(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const y of u.g.values())p=p.concat(y.D);return p}return E(u.i)}function od(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],y=u.length,x=0;x<y;x++)p.push(u[x]);return p}p=[],y=0;for(x in u)p[y++]=u[x];return p}function _o(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var y=0;y<u;y++)p.push(y);return p}p=[],y=0;for(const x in u)p[y++]=x;return p}}}function yi(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var y=_o(u),x=od(u),q=x.length,J=0;J<q;J++)p.call(void 0,x[J],y&&y[J],u)}var bo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function _i(u,p){if(u){u=u.split("&");for(var y=0;y<u.length;y++){var x=u[y].indexOf("="),q=null;if(0<=x){var J=u[y].substring(0,x);q=u[y].substring(x+1)}else J=u[y];p(J,q?decodeURIComponent(q.replace(/\+/g," ")):"")}}}function hs(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof hs){this.h=u.h,_r(this,u.j),this.o=u.o,this.g=u.g,Da(this,u.s),this.l=u.l;var p=u.i,y=new wi;y.i=p.i,p.g&&(y.g=new Map(p.g),y.h=p.h),ad(this,y),this.m=u.m}else u&&(p=String(u).match(bo))?(this.h=!1,_r(this,p[1]||"",!0),this.o=fs(p[2]||""),this.g=fs(p[3]||"",!0),Da(this,p[4]),this.l=fs(p[5]||"",!0),ad(this,p[6]||"",!0),this.m=fs(p[7]||"")):(this.h=!1,this.i=new wi(null,this.h))}hs.prototype.toString=function(){var u=[],p=this.j;p&&u.push(ps(p,je,!0),":");var y=this.g;return(y||p=="file")&&(u.push("//"),(p=this.o)&&u.push(ps(p,je,!0),"@"),u.push(encodeURIComponent(String(y)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.s,y!=null&&u.push(":",String(y))),(y=this.l)&&(this.g&&y.charAt(0)!="/"&&u.push("/"),u.push(ps(y,y.charAt(0)=="/"?kr:It,!0))),(y=this.i.toString())&&u.push("?",y),(y=this.m)&&u.push("#",ps(y,qf)),u.join("")};function yr(u){return new hs(u)}function _r(u,p,y){u.j=y?fs(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function Da(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function ad(u,p,y){p instanceof wi?(u.i=p,Oa(u.i,u.h)):(y||(p=ps(p,bi)),u.i=new wi(p,u.h))}function Ft(u,p,y){u.i.set(p,y)}function wo(u){return Ft(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function fs(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function ps(u,p,y){return typeof u=="string"?(u=encodeURI(u).replace(p,ru),y&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function ru(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var je=/[#\/\?@]/g,It=/[#\?:]/g,kr=/[#\?]/g,bi=/[#\?@]/g,qf=/#/g;function wi(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function ms(u){u.g||(u.g=new Map,u.h=0,u.i&&_i(u.i,function(p,y){u.add(decodeURIComponent(p.replace(/\+/g," ")),y)}))}n=wi.prototype,n.add=function(u,p){ms(this),this.i=null,u=zr(this,u);var y=this.g.get(u);return y||this.g.set(u,y=[]),y.push(p),this.h+=1,this};function ld(u,p){ms(u),p=zr(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function Na(u,p){return ms(u),p=zr(u,p),u.g.has(p)}n.forEach=function(u,p){ms(this),this.g.forEach(function(y,x){y.forEach(function(q){u.call(p,q,x,this)},this)},this)},n.na=function(){ms(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),y=[];for(let x=0;x<p.length;x++){const q=u[x];for(let J=0;J<q.length;J++)y.push(p[x])}return y},n.V=function(u){ms(this);let p=[];if(typeof u=="string")Na(this,u)&&(p=p.concat(this.g.get(zr(this,u))));else{u=Array.from(this.g.values());for(let y=0;y<u.length;y++)p=p.concat(u[y])}return p},n.set=function(u,p){return ms(this),this.i=null,u=zr(this,u),Na(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function ud(u,p,y){ld(u,p),0<y.length&&(u.i=null,u.g.set(zr(u,p),E(y)),u.h+=y.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var y=0;y<p.length;y++){var x=p[y];const J=encodeURIComponent(String(x)),Ae=this.V(x);for(x=0;x<Ae.length;x++){var q=J;Ae[x]!==""&&(q+="="+encodeURIComponent(String(Ae[x]))),u.push(q)}}return this.i=u.join("&")};function zr(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function Oa(u,p){p&&!u.j&&(ms(u),u.i=null,u.g.forEach(function(y,x){var q=x.toLowerCase();x!=q&&(ld(this,x),ud(this,q,y))},u)),u.j=p}function xi(u,p){const y=new Vn;if(a.Image){const x=new Image;x.onload=v(br,y,"TestLoadImage: loaded",!0,p,x),x.onerror=v(br,y,"TestLoadImage: error",!1,p,x),x.onabort=v(br,y,"TestLoadImage: abort",!1,p,x),x.ontimeout=v(br,y,"TestLoadImage: timeout",!1,p,x),a.setTimeout(function(){x.ontimeout&&x.ontimeout()},1e4),x.src=u}else p(!1)}function Ii(u,p){const y=new Vn,x=new AbortController,q=setTimeout(()=>{x.abort(),br(y,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:x.signal}).then(J=>{clearTimeout(q),J.ok?br(y,"TestPingServer: ok",!0,p):br(y,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(q),br(y,"TestPingServer: error",!1,p)})}function br(u,p,y,x,q){try{q&&(q.onload=null,q.onerror=null,q.onabort=null,q.ontimeout=null),x(y)}catch{}}function xo(){this.g=new Br}function Va(u,p,y){const x=y||"";try{yi(u,function(q,J){let Ae=q;c(q)&&(Ae=Wt(q)),p.push(x+J+"="+encodeURIComponent(Ae))})}catch(q){throw p.push(x+"type="+encodeURIComponent("_badmap")),q}}function Ma(u){this.l=u.Ub||null,this.j=u.eb||!1}w(Ma,ie),Ma.prototype.g=function(){return new La(this.l,this.j)},Ma.prototype.i=function(u){return function(){return u}}({});function La(u,p){ze.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}w(La,ze),n=La.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,Je(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ei(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Je(this)),this.g&&(this.readyState=3,Je(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;cd(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function cd(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?Ei(this):Je(this),this.readyState==3&&cd(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,Ei(this))},n.Qa=function(u){this.g&&(this.response=u,Ei(this))},n.ga=function(){this.g&&Ei(this)};function Ei(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Je(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var y=p.next();!y.done;)y=y.value,u.push(y[0]+": "+y[1]),y=p.next();return u.join(`\r
`)};function Je(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(La.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function ht(u){let p="";return te(u,function(y,x){p+=x,p+=":",p+=y,p+=`\r
`}),p}function Zt(u,p,y){e:{for(x in y){var x=!1;break e}x=!0}x||(y=ht(y),typeof u=="string"?y!=null&&encodeURIComponent(String(y)):Ft(u,p,y))}function We(u){ze.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}w(We,ze);var zf=/^https?$/i,su=["POST","PUT"];n=We.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,y,x){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ra.g(),this.v=this.o?B(this.o):B(Ra),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(J){iu(this,J);return}if(u=y||"",y=new Map(this.headers),x)if(Object.getPrototypeOf(x)===Object.prototype)for(var q in x)y.set(q,x[q]);else if(typeof x.keys=="function"&&typeof x.get=="function")for(const J of x.keys())y.set(J,x.get(J));else throw Error("Unknown input type for opt_headers: "+String(x));x=Array.from(y.keys()).find(J=>J.toLowerCase()=="content-type"),q=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(su,p,void 0))||x||q||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[J,Ae]of y)this.g.setRequestHeader(J,Ae);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ks(this),this.u=!0,this.g.send(u),this.u=!1}catch(J){iu(this,J)}};function iu(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,Cs(u),$a(u)}function Cs(u){u.A||(u.A=!0,Xe(u,"complete"),Xe(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,Xe(this,"complete"),Xe(this,"abort"),$a(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),$a(this,!0)),We.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?gs(this):this.bb())},n.bb=function(){gs(this)};function gs(u){if(u.h&&typeof o<"u"&&(!u.v[1]||_n(u)!=4||u.Z()!=2)){if(u.u&&_n(u)==4)yn(u.Ea,0,u);else if(Xe(u,"readystatechange"),_n(u)==4){u.h=!1;try{const Ae=u.Z();e:switch(Ae){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var y;if(!(y=p)){var x;if(x=Ae===0){var q=String(u.D).match(bo)[1]||null;!q&&a.self&&a.self.location&&(q=a.self.location.protocol.slice(0,-1)),x=!zf.test(q?q.toLowerCase():"")}y=x}if(y)Xe(u,"complete"),Xe(u,"success");else{u.m=6;try{var J=2<_n(u)?u.g.statusText:""}catch{J=""}u.l=J+" ["+u.Z()+"]",Cs(u)}}finally{$a(u)}}}}function $a(u,p){if(u.g){ks(u);const y=u.g,x=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||Xe(u,"ready");try{y.onreadystatechange=x}catch{}}}function ks(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function _n(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<_n(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),cn(p)}};function dd(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function ou(u){const p={};u=(u.g&&2<=_n(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let x=0;x<u.length;x++){if(U(u[x]))continue;var y=M(u[x]);const q=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const J=p[q]||[];p[q]=J,J.push(y)}T(p,function(x){return x.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Io(u,p,y){return y&&y.internalChannelParams&&y.internalChannelParams[u]||p}function hd(u){this.Aa=0,this.i=[],this.j=new Vn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Io("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Io("baseRetryDelayMs",5e3,u),this.cb=Io("retryDelaySeedMs",1e4,u),this.Wa=Io("forwardChannelMaxRetries",2,u),this.wa=Io("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new tu(u&&u.concurrentRequestLimit),this.Da=new xo,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=hd.prototype,n.la=8,n.G=1,n.connect=function(u,p,y,x){Pt(0),this.W=u,this.H=p||{},y&&x!==void 0&&(this.H.OSID=y,this.H.OAID=x),this.F=this.X,this.I=md(this,null,this.W),Ti(this)};function au(u){if(To(u),u.G==3){var p=u.U++,y=yr(u.I);if(Ft(y,"SID",u.K),Ft(y,"RID",p),Ft(y,"TYPE","terminate"),Ao(u,y),p=new Yr(u,u.j,p),p.L=2,p.v=wo(yr(y)),y=!1,a.navigator&&a.navigator.sendBeacon)try{y=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!y&&a.Image&&(new Image().src=p.v,y=!0),y||(p.g=cu(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Rr(p)}pd(u)}function Eo(u){u.g&&(Ua(u),u.g.cancel(),u.g=null)}function To(u){Eo(u),u.u&&(a.clearTimeout(u.u),u.u=null),Ai(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function Ti(u){if(!ka(u.h)&&!u.s){u.s=!0;var p=u.Ga;ne||Ce(),le||(ne(),le=!0),oe.add(p,u),u.B=0}}function wr(u,p){return id(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=tr(m(u.Ga,u,p),Po(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const q=new Yr(this,this.j,u);let J=this.o;if(this.S&&(J?(J=_(J),C(J,this.S)):J=this.S),this.m!==null||this.O||(q.H=J,J=null),this.P)e:{for(var p=0,y=0;y<this.i.length;y++){t:{var x=this.i[y];if("__data__"in x.map&&(x=x.map.__data__,typeof x=="string")){x=x.length;break t}x=void 0}if(x===void 0)break;if(p+=x,4096<p){p=y;break e}if(p===4096||y===this.i.length-1){p=y+1;break e}}p=1e3}else p=1e3;p=lu(this,q,p),y=yr(this.I),Ft(y,"RID",u),Ft(y,"CVER",22),this.D&&Ft(y,"X-HTTP-Session-Id",this.D),Ao(this,y),J&&(this.O?p="headers="+encodeURIComponent(String(ht(J)))+"&"+p:this.m&&Zt(y,this.m,J)),vi(this.h,q),this.Ua&&Ft(y,"TYPE","init"),this.P?(Ft(y,"$req",p),Ft(y,"SID","null"),q.T=!0,qr(q,y,null)):qr(q,y,p),this.G=2}}else this.G==3&&(u?fd(this,u):this.i.length==0||ka(this.h)||fd(this))};function fd(u,p){var y;p?y=p.l:y=u.U++;const x=yr(u.I);Ft(x,"SID",u.K),Ft(x,"RID",y),Ft(x,"AID",u.T),Ao(u,x),u.m&&u.o&&Zt(x,u.m,u.o),y=new Yr(u,u.j,y,u.B+1),u.m===null&&(y.H=u.o),p&&(u.i=p.D.concat(u.i)),p=lu(u,y,1e3),y.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),vi(u.h,y),qr(y,x,p)}function Ao(u,p){u.H&&te(u.H,function(y,x){Ft(p,x,y)}),u.l&&yi({},function(y,x){Ft(p,x,y)})}function lu(u,p,y){y=Math.min(u.i.length,y);var x=u.l?m(u.l.Na,u.l,u):null;e:{var q=u.i;let J=-1;for(;;){const Ae=["count="+y];J==-1?0<y?(J=q[0].g,Ae.push("ofs="+J)):J=0:Ae.push("ofs="+J);let Ct=!0;for(let Dn=0;Dn<y;Dn++){let Et=q[Dn].g;const Ln=q[Dn].map;if(Et-=J,0>Et)J=Math.max(0,q[Dn].g-100),Ct=!1;else try{Va(Ln,Ae,"req"+Et+"_")}catch{x&&x(Ln)}}if(Ct){x=Ae.join("&");break e}}}return u=u.i.splice(0,y),p.D=u,x}function Fa(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;ne||Ce(),le||(ne(),le=!0),oe.add(p,u),u.v=0}}function uu(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=tr(m(u.Fa,u),Po(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,Ds(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=tr(m(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Pt(10),Eo(this),Ds(this))};function Ua(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function Ds(u){u.g=new Yr(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=yr(u.qa);Ft(p,"RID","rpc"),Ft(p,"SID",u.K),Ft(p,"AID",u.T),Ft(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&Ft(p,"TO",u.ja),Ft(p,"TYPE","xmlhttp"),Ao(u,p),u.m&&u.o&&Zt(p,u.m,u.o),u.L&&(u.g.I=u.L);var y=u.g;u=u.ia,y.L=1,y.v=wo(yr(p)),y.m=null,y.P=!0,ds(y,u)}n.Za=function(){this.C!=null&&(this.C=null,Eo(this),uu(this),Pt(19))};function Ai(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function So(u,p){var y=null;if(u.g==p){Ai(u),Ua(u),u.g=null;var x=2}else if(Kn(u.h,p))y=p.D,Cr(u.h,p),x=1;else return;if(u.G!=0){if(p.o)if(x==1){y=p.m?p.m.length:0,p=Date.now()-p.F;var q=u.B;x=Cn(),Xe(x,new er(x,y)),Ti(u)}else Fa(u);else if(q=p.s,q==3||q==0&&0<p.X||!(x==1&&wr(u,p)||x==2&&uu(u)))switch(y&&0<y.length&&(p=u.h,p.i=p.i.concat(y)),q){case 1:vs(u,5);break;case 4:vs(u,10);break;case 3:vs(u,6);break;default:vs(u,2)}}}function Po(u,p){let y=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(y*=2),y*p}function vs(u,p){if(u.j.info("Error code "+p),p==2){var y=m(u.fb,u),x=u.Xa;const q=!x;x=new hs(x||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||_r(x,"https"),wo(x),q?xi(x.toString(),y):Ii(x.toString(),y)}else Pt(2);u.G=0,u.l&&u.l.sa(p),pd(u),To(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),Pt(2)):(this.j.info("Failed to ping google.com"),Pt(1))};function pd(u){if(u.G=0,u.ka=[],u.l){const p=nu(u.h);(p.length!=0||u.i.length!=0)&&(A(u.ka,p),A(u.ka,u.i),u.h.i.length=0,E(u.i),u.i.length=0),u.l.ra()}}function md(u,p,y){var x=y instanceof hs?yr(y):new hs(y);if(x.g!="")p&&(x.g=p+"."+x.g),Da(x,x.s);else{var q=a.location;x=q.protocol,p=p?p+"."+q.hostname:q.hostname,q=+q.port;var J=new hs(null);x&&_r(J,x),p&&(J.g=p),q&&Da(J,q),y&&(J.l=y),x=J}return y=u.D,p=u.ya,y&&p&&Ft(x,y,p),Ft(x,"VER",u.la),Ao(u,x),x}function cu(u,p,y){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new We(new Ma({eb:y})):new We(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ja(){}n=ja.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Ns(){}Ns.prototype.g=function(u,p){return new Mn(u,p)};function Mn(u,p){ze.call(this),this.g=new hd(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!U(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!U(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new Si(this)}w(Mn,ze),Mn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Mn.prototype.close=function(){au(this.g)},Mn.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var y={};y.__data__=u,u=y}else this.u&&(y={},y.__data__=Wt(u),u=y);p.i.push(new sd(p.Ya++,u)),p.G==3&&Ti(p)},Mn.prototype.N=function(){this.g.l=null,delete this.j,au(this.g),delete this.g,Mn.aa.N.call(this)};function gd(u){He.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const y in p){u=y;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}w(gd,He);function vd(){lt.call(this),this.status=1}w(vd,lt);function Si(u){this.g=u}w(Si,ja),Si.prototype.ua=function(){Xe(this.g,"a")},Si.prototype.ta=function(u){Xe(this.g,new gd(u))},Si.prototype.sa=function(u){Xe(this.g,new vd)},Si.prototype.ra=function(){Xe(this.g,"b")},Ns.prototype.createWebChannel=Ns.prototype.g,Mn.prototype.send=Mn.prototype.o,Mn.prototype.open=Mn.prototype.m,Mn.prototype.close=Mn.prototype.close,Ux=function(){return new Ns},Fx=function(){return Cn()},$x=yt,tm={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Pa.NO_ERROR=0,Pa.TIMEOUT=8,Pa.HTTP_ERROR=6,qd=Pa,nd.COMPLETE="complete",Lx=nd,Ee.EventType=Ue,Ue.OPEN="a",Ue.CLOSE="b",Ue.ERROR="c",Ue.MESSAGE="d",ze.prototype.listen=ze.prototype.K,Pu=Ee,We.prototype.listenOnce=We.prototype.L,We.prototype.getLastError=We.prototype.Ka,We.prototype.getLastErrorCode=We.prototype.Ba,We.prototype.getStatus=We.prototype.Z,We.prototype.getResponseJson=We.prototype.Oa,We.prototype.getResponseText=We.prototype.oa,We.prototype.send=We.prototype.ea,We.prototype.setWithCredentials=We.prototype.Ha,Mx=We}).apply(typeof Ed<"u"?Ed:typeof self<"u"?self:typeof window<"u"?window:{});const I0="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Un{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Un.UNAUTHENTICATED=new Un(null),Un.GOOGLE_CREDENTIALS=new Un("google-credentials-uid"),Un.FIRST_PARTY=new Un("first-party-uid"),Un.MOCK_USER=new Un("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ll="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const so=new ig("@firebase/firestore");function Ja(){return so.logLevel}function SH(n){so.setLogLevel(n)}function fe(n,...e){if(so.logLevel<=_t.DEBUG){const t=e.map(mg);so.debug(`Firestore (${Ll}): ${n}`,...t)}}function xn(n,...e){if(so.logLevel<=_t.ERROR){const t=e.map(mg);so.error(`Firestore (${Ll}): ${n}`,...t)}}function Qr(n,...e){if(so.logLevel<=_t.WARN){const t=e.map(mg);so.warn(`Firestore (${Ll}): ${n}`,...t)}}function mg(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ne(n="Unexpected state"){const e=`FIRESTORE (${Ll}) INTERNAL ASSERTION FAILED: `+n;throw xn(e),new Error(e)}function Le(n,e){n||Ne()}function PH(n,e){n||Ne()}function Pe(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class pe extends us{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jx{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Jk{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Un.UNAUTHENTICATED))}shutdown(){}}class Yk{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Xk{constructor(e){this.t=e,this.currentUser=Un.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Le(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new qn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new qn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{fe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(fe("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new qn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(fe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Le(typeof r.accessToken=="string"),new jx(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Le(e===null||typeof e=="string"),new Un(e)}}class Zk{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Un.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class e2{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Zk(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Un.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Bx{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class t2{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Le(this.o===void 0);const r=i=>{i.error!=null&&fe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,fe("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{fe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):fe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Le(typeof t.token=="string"),this.R=t.token,new Bx(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class RH{getToken(){return Promise.resolve(new Bx(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n2(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qx{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=n2(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function et(n,e){return n<e?-1:n>e?1:0}function gl(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function zx(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new pe(Q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new pe(Q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new pe(Q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new pe(Q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ln.fromMillis(Date.now())}static fromDate(e){return ln.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new ln(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?et(this.nanoseconds,e.nanoseconds):et(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Be{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Be(e)}static min(){return new Be(new ln(0,0))}static max(){return new Be(new ln(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cc{constructor(e,t,r){t===void 0?t=0:t>e.length&&Ne(),r===void 0?r=e.length-t:r>e.length-t&&Ne(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return cc.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof cc?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class wt extends cc{construct(e,t,r){return new wt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new pe(Q.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new wt(t)}static emptyPath(){return new wt([])}}const r2=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class nn extends cc{construct(e,t,r){return new nn(e,t,r)}static isValidIdentifier(e){return r2.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),nn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new nn(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new pe(Q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new pe(Q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new pe(Q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new pe(Q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new nn(t)}static emptyPath(){return new nn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ke{constructor(e){this.path=e}static fromPath(e){return new ke(wt.fromString(e))}static fromName(e){return new ke(wt.fromString(e).popFirst(5))}static empty(){return new ke(wt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&wt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return wt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ke(new wt(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vl{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function nm(n){return n.fields.find(e=>e.kind===2)}function Fo(n){return n.fields.filter(e=>e.kind!==2)}function s2(n,e){let t=et(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=i2(n.fields[r],e.fields[r]),t!==0)return t;return et(n.fields.length,e.fields.length)}vl.UNKNOWN_ID=-1;class Xo{constructor(e,t){this.fieldPath=e,this.kind=t}}function i2(n,e){const t=nn.comparator(n.fieldPath,e.fieldPath);return t!==0?t:et(n.kind,e.kind)}class yl{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new yl(0,Fr.min())}}function Hx(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Be.fromTimestamp(r===1e9?new ln(t+1,0):new ln(t,r));return new Fr(s,ke.empty(),e)}function Kx(n){return new Fr(n.readTime,n.key,-1)}class Fr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Fr(Be.min(),ke.empty(),-1)}static max(){return new Fr(Be.max(),ke.empty(),-1)}}function gg(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=ke.comparator(n.documentKey,e.documentKey),t!==0?t:et(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gx="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Wx{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function po(n){if(n.code!==Q.FAILED_PRECONDITION||n.message!==Gx)throw n;fe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ne(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new z((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof z?t:z.resolve(t)}catch(t){return z.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):z.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):z.reject(t)}static resolve(e){return new z((t,r)=>{t(e)})}static reject(e){return new z((t,r)=>{r(e)})}static waitFor(e){return new z((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=z.resolve(!1);for(const r of e)t=t.next(s=>s?z.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new z((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(h=>{o[c]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new z((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ef{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new qn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Uu(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=vg(r.target.error);this.V.reject(new Uu(e,s))}}static open(e,t,r,s){try{return new ef(t,e.transaction(s,r))}catch(i){throw new Uu(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(fe("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new a2(t)}}class Ts{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Ts.S(Nn())===12.2&&xn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return fe("SimpleDb","Removing database:",e),qo(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!sg())return!1;if(Ts.v())return!0;const e=Nn(),t=Ts.S(e),r=0<t&&t<10,s=Qx(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(fe("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Uu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new pe(Q.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new pe(Q.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Uu(e,o))},s.onupgradeneeded=i=>{fe("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{fe("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=ef.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),z.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(fe("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Qx(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class o2{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return qo(this.B.delete())}}class Uu extends pe{constructor(e,t){super(Q.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function mo(n){return n.name==="IndexedDbTransactionError"}class a2{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(fe("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(fe("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),qo(r)}add(e){return fe("SimpleDb","ADD",this.store.name,e,e),qo(this.store.add(e))}get(e){return qo(this.store.get(e)).next(t=>(t===void 0&&(t=null),fe("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return fe("SimpleDb","DELETE",this.store.name,e),qo(this.store.delete(e))}count(){return fe("SimpleDb","COUNT",this.store.name),qo(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new z((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new z((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){fe("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new z((r,s)=>{t.onerror=i=>{const o=vg(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new z((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new o2(a),c=t(a.primaryKey,a.value,l);if(c instanceof z){const h=c.catch(f=>(l.done(),z.reject(f)));r.push(h)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>z.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function qo(n){return new z((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=vg(r.target.error);t(s)}})}let E0=!1;function vg(n){const e=Ts.S(Nn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new pe("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return E0||(E0=!0,setTimeout(()=>{throw r},0)),r}}return n}class l2{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){fe("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{fe("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){mo(t)?fe("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await po(t)}await this.X(6e4)})}}class u2{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return z.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return fe("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(fe("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=Kx(i);gg(o,r)>0&&(r=o)}),new Fr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Er{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Er.oe=-1;function Oc(n){return n==null}function dc(n){return n===0&&1/n==-1/0}function Jx(n){return typeof n=="number"&&Number.isInteger(n)&&!dc(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lr(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=T0(e)),e=c2(n.get(t),e);return T0(e)}function c2(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function T0(n){return n+""}function ws(n){const e=n.length;if(Le(e>=2),e===2)return Le(n.charAt(0)===""&&n.charAt(1)===""),wt.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&Ne(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:Ne()}i=o+2}return new wt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A0=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zd(n,e){return[n,lr(e)]}function Yx(n,e,t){return[n,lr(e),t]}const d2={},h2=["prefixPath","collectionGroup","readTime","documentId"],f2=["prefixPath","collectionGroup","documentId"],p2=["collectionGroup","readTime","prefixPath","documentId"],m2=["canonicalId","targetId"],g2=["targetId","path"],v2=["path","targetId"],y2=["collectionId","parent"],_2=["indexId","uid"],b2=["uid","sequenceNumber"],w2=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],x2=["indexId","uid","orderedDocumentKey"],I2=["userId","collectionPath","documentId"],E2=["userId","collectionPath","largestBatchId"],T2=["userId","collectionGroup","largestBatchId"],Xx=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],A2=[...Xx,"documentOverlays"],Zx=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],eI=Zx,yg=[...eI,"indexConfiguration","indexState","indexEntries"],S2=yg,P2=[...yg,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm extends Wx{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function On(n,e){const t=Pe(n);return Ts.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S0(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function go(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function tI(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function nI(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(e,t){this.comparator=e,this.root=t||Wn.EMPTY}insert(e,t){return new Kt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Wn.BLACK,null,null))}remove(e){return new Kt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Wn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Td(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Td(this.root,e,this.comparator,!1)}getReverseIterator(){return new Td(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Td(this.root,e,this.comparator,!0)}}class Td{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Wn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Wn.RED,this.left=s??Wn.EMPTY,this.right=i??Wn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Wn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Wn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Wn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Wn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Wn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ne();const e=this.left.check();if(e!==this.right.check())throw Ne();return e+(this.isRed()?0:1)}}Wn.EMPTY=null,Wn.RED=!0,Wn.BLACK=!1;Wn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ne()}get value(){throw Ne()}get color(){throw Ne()}get left(){throw Ne()}get right(){throw Ne()}copy(e,t,r,s,i){return this}insert(e,t,r){return new Wn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{constructor(e){this.comparator=e,this.data=new Kt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new P0(this.data.getIterator())}getIteratorFrom(e){return new P0(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof $t)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new $t(this.comparator);return t.data=e,t}}class P0{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ha(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr{constructor(e){this.fields=e,e.sort(nn.comparator)}static empty(){return new Tr([])}unionWith(e){let t=new $t(nn.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Tr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return gl(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rI extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kH(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new rI("Invalid base64 string: "+i):i}}(e);return new pn(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new pn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return et(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}pn.EMPTY_BYTE_STRING=new pn("");const R2=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ti(n){if(Le(!!n),typeof n=="string"){let e=0;const t=R2.exec(n);if(Le(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:tn(n.seconds),nanos:tn(n.nanos)}}function tn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ni(n){return typeof n=="string"?pn.fromBase64String(n):pn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tf(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function nf(n){const e=n.mapValue.fields.__previous_value__;return tf(e)?nf(e):e}function hc(n){const e=ti(n.mapValue.fields.__local_write_time__.timestampValue);return new ln(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C2{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class sa{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new sa("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof sa&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wi={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Hd={nullValue:"NULL_VALUE"};function io(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?tf(n)?4:sI(n)?9007199254740991:rf(n)?10:11:Ne()}function Ps(n,e){if(n===e)return!0;const t=io(n);if(t!==io(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return hc(n).isEqual(hc(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=ti(s.timestampValue),a=ti(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return ni(s.bytesValue).isEqual(ni(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return tn(s.geoPointValue.latitude)===tn(i.geoPointValue.latitude)&&tn(s.geoPointValue.longitude)===tn(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return tn(s.integerValue)===tn(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=tn(s.doubleValue),a=tn(i.doubleValue);return o===a?dc(o)===dc(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return gl(n.arrayValue.values||[],e.arrayValue.values||[],Ps);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(S0(o)!==S0(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ps(o[l],a[l])))return!1;return!0}(n,e);default:return Ne()}}function fc(n,e){return(n.values||[]).find(t=>Ps(t,e))!==void 0}function oo(n,e){if(n===e)return 0;const t=io(n),r=io(e);if(t!==r)return et(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return et(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=tn(i.integerValue||i.doubleValue),l=tn(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return R0(n.timestampValue,e.timestampValue);case 4:return R0(hc(n),hc(e));case 5:return et(n.stringValue,e.stringValue);case 6:return function(i,o){const a=ni(i),l=ni(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const h=et(a[c],l[c]);if(h!==0)return h}return et(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=et(tn(i.latitude),tn(o.latitude));return a!==0?a:et(tn(i.longitude),tn(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return C0(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,h;const f=i.fields||{},m=o.fields||{},v=(a=f.value)===null||a===void 0?void 0:a.arrayValue,w=(l=m.value)===null||l===void 0?void 0:l.arrayValue,E=et(((c=v==null?void 0:v.values)===null||c===void 0?void 0:c.length)||0,((h=w==null?void 0:w.values)===null||h===void 0?void 0:h.length)||0);return E!==0?E:C0(v,w)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Wi.mapValue&&o===Wi.mapValue)return 0;if(i===Wi.mapValue)return 1;if(o===Wi.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},h=Object.keys(c);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const m=et(l[f],h[f]);if(m!==0)return m;const v=oo(a[l[f]],c[h[f]]);if(v!==0)return v}return et(l.length,h.length)}(n.mapValue,e.mapValue);default:throw Ne()}}function R0(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return et(n,e);const t=ti(n),r=ti(e),s=et(t.seconds,r.seconds);return s!==0?s:et(t.nanos,r.nanos)}function C0(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=oo(t[s],r[s]);if(i)return i}return et(t.length,r.length)}function _l(n){return sm(n)}function sm(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=ti(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ni(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return ke.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=sm(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${sm(t.fields[o])}`;return s+"}"}(n.mapValue):Ne()}function Kd(n){switch(io(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=nf(n);return e?16+Kd(e):16;case 5:return 2*n.stringValue.length;case 6:return ni(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Kd(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return go(r.fields,(i,o)=>{s+=i.length+Kd(o)}),s}(n.mapValue);default:throw Ne()}}function ia(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function im(n){return!!n&&"integerValue"in n}function pc(n){return!!n&&"arrayValue"in n}function k0(n){return!!n&&"nullValue"in n}function D0(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Gd(n){return!!n&&"mapValue"in n}function rf(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function ju(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return go(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=ju(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ju(n.arrayValue.values[t]);return e}return Object.assign({},n)}function sI(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const iI={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function k2(n){return"nullValue"in n?Hd:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?ia(sa.empty(),ke.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?rf(n)?iI:{mapValue:{}}:Ne()}function D2(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?ia(sa.empty(),ke.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?iI:"mapValue"in n?rf(n)?{mapValue:{}}:Wi:Ne()}function N0(n,e){const t=oo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function O0(n,e){const t=oo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{constructor(e){this.value=e}static empty(){return new Yn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Gd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ju(t)}setAll(e){let t=nn.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=ju(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Gd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ps(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Gd(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){go(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Yn(ju(this.value))}}function oI(n){const e=[];return go(n.fields,(t,r)=>{const s=new nn([t]);if(Gd(r)){const i=oI(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Tr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Jt(e,0,Be.min(),Be.min(),Be.min(),Yn.empty(),0)}static newFoundDocument(e,t,r,s){return new Jt(e,1,t,Be.min(),r,s,0)}static newNoDocument(e,t){return new Jt(e,2,t,Be.min(),Be.min(),Yn.empty(),0)}static newUnknownDocument(e,t){return new Jt(e,3,t,Be.min(),Be.min(),Yn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Be.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Yn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Yn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Be.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Jt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Jt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(e,t){this.position=e,this.inclusive=t}}function V0(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=ke.comparator(ke.fromName(o.referenceValue),t.key):r=oo(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function M0(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ps(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mc{constructor(e,t="asc"){this.field=e,this.dir=t}}function N2(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aI{}class xt extends aI{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new O2(e,t,r):t==="array-contains"?new L2(e,r):t==="in"?new fI(e,r):t==="not-in"?new $2(e,r):t==="array-contains-any"?new F2(e,r):new xt(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new V2(e,r):new M2(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(oo(t,this.value)):t!==null&&io(this.value)===io(t)&&this.matchesComparison(oo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ne()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Lt extends aI{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Lt(e,t)}matches(e){return bl(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function bl(n){return n.op==="and"}function om(n){return n.op==="or"}function _g(n){return lI(n)&&bl(n)}function lI(n){for(const e of n.filters)if(e instanceof Lt)return!1;return!0}function am(n){if(n instanceof xt)return n.field.canonicalString()+n.op.toString()+_l(n.value);if(_g(n))return n.filters.map(e=>am(e)).join(",");{const e=n.filters.map(t=>am(t)).join(",");return`${n.op}(${e})`}}function uI(n,e){return n instanceof xt?function(r,s){return s instanceof xt&&r.op===s.op&&r.field.isEqual(s.field)&&Ps(r.value,s.value)}(n,e):n instanceof Lt?function(r,s){return s instanceof Lt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&uI(o,s.filters[a]),!0):!1}(n,e):void Ne()}function cI(n,e){const t=n.filters.concat(e);return Lt.create(t,n.op)}function dI(n){return n instanceof xt?function(t){return`${t.field.canonicalString()} ${t.op} ${_l(t.value)}`}(n):n instanceof Lt?function(t){return t.op.toString()+" {"+t.getFilters().map(dI).join(" ,")+"}"}(n):"Filter"}class O2 extends xt{constructor(e,t,r){super(e,t,r),this.key=ke.fromName(r.referenceValue)}matches(e){const t=ke.comparator(e.key,this.key);return this.matchesComparison(t)}}class V2 extends xt{constructor(e,t){super(e,"in",t),this.keys=hI("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class M2 extends xt{constructor(e,t){super(e,"not-in",t),this.keys=hI("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function hI(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>ke.fromName(r.referenceValue))}class L2 extends xt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return pc(t)&&fc(t.arrayValue,this.value)}}class fI extends xt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&fc(this.value.arrayValue,t)}}class $2 extends xt{constructor(e,t){super(e,"not-in",t)}matches(e){if(fc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!fc(this.value.arrayValue,t)}}class F2 extends xt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!pc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>fc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U2{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function lm(n,e=null,t=[],r=[],s=null,i=null,o=null){return new U2(n,e,t,r,s,i,o)}function oa(n){const e=Pe(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>am(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Oc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>_l(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>_l(r)).join(",")),e.ue=t}return e.ue}function Vc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!N2(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!uI(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!M0(n.startAt,e.startAt)&&M0(n.endAt,e.endAt)}function mh(n){return ke.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function gh(n,e){return n.filters.filter(t=>t instanceof xt&&t.field.isEqual(e))}function L0(n,e,t){let r=Hd,s=!0;for(const i of gh(n,e)){let o=Hd,a=!0;switch(i.op){case"<":case"<=":o=k2(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Hd}N0({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];N0({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function $0(n,e,t){let r=Wi,s=!0;for(const i of gh(n,e)){let o=Wi,a=!0;switch(i.op){case">=":case">":o=D2(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Wi}O0({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];O0({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function pI(n,e,t,r,s,i,o,a){return new ui(n,e,t,r,s,i,o,a)}function $l(n){return new ui(n)}function F0(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function bg(n){return n.collectionGroup!==null}function ll(n){const e=Pe(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new $t(nn.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new mc(i,r))}),t.has(nn.keyField().canonicalString())||e.ce.push(new mc(nn.keyField(),r))}return e.ce}function ur(n){const e=Pe(n);return e.le||(e.le=gI(e,ll(n))),e.le}function mI(n){const e=Pe(n);return e.he||(e.he=gI(e,n.explicitOrderBy)),e.he}function gI(n,e){if(n.limitType==="F")return lm(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new mc(s.field,i)});const t=n.endAt?new ao(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ao(n.startAt.position,n.startAt.inclusive):null;return lm(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function um(n,e){const t=n.filters.concat([e]);return new ui(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function vh(n,e,t){return new ui(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Mc(n,e){return Vc(ur(n),ur(e))&&n.limitType===e.limitType}function vI(n){return`${oa(ur(n))}|lt:${n.limitType}`}function Ya(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>dI(s)).join(", ")}]`),Oc(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>_l(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>_l(s)).join(",")),`Target(${r})`}(ur(n))}; limitType=${n.limitType})`}function Lc(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):ke.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of ll(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=V0(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,ll(r),s)||r.endAt&&!function(o,a,l){const c=V0(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,ll(r),s))}(n,e)}function yI(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function _I(n){return(e,t)=>{let r=!1;for(const s of ll(n)){const i=j2(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function j2(n,e,t){const r=n.field.isKeyField()?ke.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?oo(l,c):Ne()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Ne()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ci{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){go(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return nI(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B2=new Kt(ke.comparator);function Ar(){return B2}const bI=new Kt(ke.comparator);function Ru(...n){let e=bI;for(const t of n)e=e.insert(t.key,t);return e}function wI(n){let e=bI;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function xs(){return Bu()}function xI(){return Bu()}function Bu(){return new ci(n=>n.toString(),(n,e)=>n.isEqual(e))}const q2=new Kt(ke.comparator),z2=new $t(ke.comparator);function at(...n){let e=z2;for(const t of n)e=e.add(t);return e}const H2=new $t(et);function wg(){return H2}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xg(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:dc(e)?"-0":e}}function II(n){return{integerValue:""+n}}function EI(n,e){return Jx(e)?II(e):xg(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sf{constructor(){this._=void 0}}function K2(n,e,t){return n instanceof wl?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&tf(i)&&(i=nf(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof aa?AI(n,e):n instanceof la?SI(n,e):function(s,i){const o=TI(s,i),a=U0(o)+U0(s.Pe);return im(o)&&im(s.Pe)?II(a):xg(s.serializer,a)}(n,e)}function G2(n,e,t){return n instanceof aa?AI(n,e):n instanceof la?SI(n,e):t}function TI(n,e){return n instanceof xl?function(r){return im(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class wl extends sf{}class aa extends sf{constructor(e){super(),this.elements=e}}function AI(n,e){const t=PI(e);for(const r of n.elements)t.some(s=>Ps(s,r))||t.push(r);return{arrayValue:{values:t}}}class la extends sf{constructor(e){super(),this.elements=e}}function SI(n,e){let t=PI(e);for(const r of n.elements)t=t.filter(s=>!Ps(s,r));return{arrayValue:{values:t}}}class xl extends sf{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function U0(n){return tn(n.integerValue||n.doubleValue)}function PI(n){return pc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $c{constructor(e,t){this.field=e,this.transform=t}}function W2(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof aa&&s instanceof aa||r instanceof la&&s instanceof la?gl(r.elements,s.elements,Ps):r instanceof xl&&s instanceof xl?Ps(r.Pe,s.Pe):r instanceof wl&&s instanceof wl}(n.transform,e.transform)}class Q2{constructor(e,t){this.version=e,this.transformResults=t}}class rn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new rn}static exists(e){return new rn(void 0,e)}static updateTime(e){return new rn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Wd(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class of{}function RI(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ul(n.key,rn.none()):new Fl(n.key,n.data,rn.none());{const t=n.data,r=Yn.empty();let s=new $t(nn.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new di(n.key,r,new Tr(s.toArray()),rn.none())}}function J2(n,e,t){n instanceof Fl?function(s,i,o){const a=s.value.clone(),l=B0(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof di?function(s,i,o){if(!Wd(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=B0(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(CI(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function qu(n,e,t,r){return n instanceof Fl?function(i,o,a,l){if(!Wd(i.precondition,o))return a;const c=i.value.clone(),h=q0(i.fieldTransforms,l,o);return c.setAll(h),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof di?function(i,o,a,l){if(!Wd(i.precondition,o))return a;const c=q0(i.fieldTransforms,l,o),h=o.data;return h.setAll(CI(i)),h.setAll(c),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Wd(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function Y2(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=TI(r.transform,s||null);i!=null&&(t===null&&(t=Yn.empty()),t.set(r.field,i))}return t||null}function j0(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&gl(r,s,(i,o)=>W2(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Fl extends of{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class di extends of{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function CI(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function B0(n,e,t){const r=new Map;Le(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,G2(o,a,t[s]))}return r}function q0(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,K2(i,o,e))}return r}class Ul extends of{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ig extends of{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&J2(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=qu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=qu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=xI();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=RI(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Be.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),at())}isEqual(e){return this.batchId===e.batchId&&gl(this.mutations,e.mutations,(t,r)=>j0(t,r))&&gl(this.baseMutations,e.baseMutations,(t,r)=>j0(t,r))}}class Tg{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Le(e.mutations.length===r.length);let s=function(){return q2}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Tg(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ag{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kI{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X2{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Sn,Tt;function DI(n){switch(n){default:return Ne();case Q.CANCELLED:case Q.UNKNOWN:case Q.DEADLINE_EXCEEDED:case Q.RESOURCE_EXHAUSTED:case Q.INTERNAL:case Q.UNAVAILABLE:case Q.UNAUTHENTICATED:return!1;case Q.INVALID_ARGUMENT:case Q.NOT_FOUND:case Q.ALREADY_EXISTS:case Q.PERMISSION_DENIED:case Q.FAILED_PRECONDITION:case Q.ABORTED:case Q.OUT_OF_RANGE:case Q.UNIMPLEMENTED:case Q.DATA_LOSS:return!0}}function NI(n){if(n===void 0)return xn("GRPC error has no .code"),Q.UNKNOWN;switch(n){case Sn.OK:return Q.OK;case Sn.CANCELLED:return Q.CANCELLED;case Sn.UNKNOWN:return Q.UNKNOWN;case Sn.DEADLINE_EXCEEDED:return Q.DEADLINE_EXCEEDED;case Sn.RESOURCE_EXHAUSTED:return Q.RESOURCE_EXHAUSTED;case Sn.INTERNAL:return Q.INTERNAL;case Sn.UNAVAILABLE:return Q.UNAVAILABLE;case Sn.UNAUTHENTICATED:return Q.UNAUTHENTICATED;case Sn.INVALID_ARGUMENT:return Q.INVALID_ARGUMENT;case Sn.NOT_FOUND:return Q.NOT_FOUND;case Sn.ALREADY_EXISTS:return Q.ALREADY_EXISTS;case Sn.PERMISSION_DENIED:return Q.PERMISSION_DENIED;case Sn.FAILED_PRECONDITION:return Q.FAILED_PRECONDITION;case Sn.ABORTED:return Q.ABORTED;case Sn.OUT_OF_RANGE:return Q.OUT_OF_RANGE;case Sn.UNIMPLEMENTED:return Q.UNIMPLEMENTED;case Sn.DATA_LOSS:return Q.DATA_LOSS;default:return Ne()}}(Tt=Sn||(Sn={}))[Tt.OK=0]="OK",Tt[Tt.CANCELLED=1]="CANCELLED",Tt[Tt.UNKNOWN=2]="UNKNOWN",Tt[Tt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Tt[Tt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Tt[Tt.NOT_FOUND=5]="NOT_FOUND",Tt[Tt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Tt[Tt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Tt[Tt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Tt[Tt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Tt[Tt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Tt[Tt.ABORTED=10]="ABORTED",Tt[Tt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Tt[Tt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Tt[Tt.INTERNAL=13]="INTERNAL",Tt[Tt.UNAVAILABLE=14]="UNAVAILABLE",Tt[Tt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yh=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OI(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z2=new Yo([4294967295,4294967295],0);function z0(n){const e=OI().encode(n),t=new Vx;return t.update(e),new Uint8Array(t.digest())}function H0(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Yo([t,r],0),new Yo([s,i],0)]}class Sg{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Cu(`Invalid padding: ${t}`);if(r<0)throw new Cu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Cu(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Cu(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Yo.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Yo.fromNumber(r)));return s.compare(Z2)===1&&(s=new Yo([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=z0(e),[r,s]=H0(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Sg(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=z0(e),[r,s]=H0(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Cu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Uc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Fc(Be.min(),s,new Kt(et),Ar(),at())}}class Uc{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Uc(r,t,at(),at(),at())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qd{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class VI{constructor(e,t){this.targetId=e,this.me=t}}class MI{constructor(e,t,r=pn.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class K0{constructor(){this.fe=0,this.ge=W0(),this.pe=pn.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=at(),t=at(),r=at();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:Ne()}}),new Uc(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=W0()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Le(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class eD{constructor(e){this.Le=e,this.Be=new Map,this.ke=Ar(),this.qe=G0(),this.Qe=new Kt(et)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Ne()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(mh(i))if(r===0){const o=new ke(i.path);this.Ue(t,o,Jt.newNoDocument(o,Be.min()))}else Le(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}yh==null||yh.et(function(h,f,m,v,w){var E,A,F,U,$,L;const se={localCacheCount:h,existenceFilterCount:f.count,databaseId:m.database,projectId:m.projectId},te=f.unchangedNames;return te&&(se.bloomFilter={applied:w===0,hashCount:(E=te==null?void 0:te.hashCount)!==null&&E!==void 0?E:0,bitmapLength:(U=(F=(A=te==null?void 0:te.bits)===null||A===void 0?void 0:A.bitmap)===null||F===void 0?void 0:F.length)!==null&&U!==void 0?U:0,padding:(L=($=te==null?void 0:te.bits)===null||$===void 0?void 0:$.padding)!==null&&L!==void 0?L:0,mightContain:T=>{var _;return(_=v==null?void 0:v.mightContain(T))!==null&&_!==void 0&&_}}),se}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=ni(r).toUint8Array()}catch(l){if(l instanceof rI)return Qr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Sg(o,s,i)}catch(l){return Qr(l instanceof Cu?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&mh(a.target)){const l=new ke(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,Jt.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=at();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new Fc(e,t,this.Qe,this.ke,r);return this.ke=Ar(),this.qe=G0(),this.Qe=new Kt(et),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new K0,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new $t(et),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||fe("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new K0),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function G0(){return new Kt(ke.comparator)}function W0(){return new Kt(ke.comparator)}const tD=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),nD=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),rD=(()=>({and:"AND",or:"OR"}))();class sD{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function cm(n,e){return n.useProto3Json||Oc(e)?e:{value:e}}function Il(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function LI(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function iD(n,e){return Il(n,e.toTimestamp())}function Tn(n){return Le(!!n),Be.fromTimestamp(function(t){const r=ti(t);return new ln(r.seconds,r.nanos)}(n))}function Pg(n,e){return dm(n,e).canonicalString()}function dm(n,e){const t=function(s){return new wt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function $I(n){const e=wt.fromString(n);return Le(WI(e)),e}function gc(n,e){return Pg(n.databaseId,e.path)}function As(n,e){const t=$I(e);if(t.get(1)!==n.databaseId.projectId)throw new pe(Q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new pe(Q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new ke(jI(t))}function FI(n,e){return Pg(n.databaseId,e)}function UI(n){const e=$I(n);return e.length===4?wt.emptyPath():jI(e)}function hm(n){return new wt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function jI(n){return Le(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Q0(n,e,t){return{name:gc(n,e),fields:t.value.mapValue.fields}}function BI(n,e,t){const r=As(n,e.name),s=Tn(e.updateTime),i=e.createTime?Tn(e.createTime):Be.min(),o=new Yn({mapValue:{fields:e.fields}}),a=Jt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function oD(n,e){return"found"in e?function(r,s){Le(!!s.found),s.found.name,s.found.updateTime;const i=As(r,s.found.name),o=Tn(s.found.updateTime),a=s.found.createTime?Tn(s.found.createTime):Be.min(),l=new Yn({mapValue:{fields:s.found.fields}});return Jt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Le(!!s.missing),Le(!!s.readTime);const i=As(r,s.missing),o=Tn(s.readTime);return Jt.newNoDocument(i,o)}(n,e):Ne()}function aD(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Ne()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,h){return c.useProto3Json?(Le(h===void 0||typeof h=="string"),pn.fromBase64String(h||"")):(Le(h===void 0||h instanceof Buffer||h instanceof Uint8Array),pn.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const h=c.code===void 0?Q.UNKNOWN:NI(c.code);return new pe(h,c.message||"")}(o);t=new MI(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=As(n,r.document.name),i=Tn(r.document.updateTime),o=r.document.createTime?Tn(r.document.createTime):Be.min(),a=new Yn({mapValue:{fields:r.document.fields}}),l=Jt.newFoundDocument(s,i,o,a),c=r.targetIds||[],h=r.removedTargetIds||[];t=new Qd(c,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=As(n,r.document),i=r.readTime?Tn(r.readTime):Be.min(),o=Jt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Qd([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=As(n,r.document),i=r.removedTargetIds||[];t=new Qd([],i,s,null)}else{if(!("filter"in e))return Ne();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new X2(s,i),a=r.targetId;t=new VI(a,o)}}return t}function vc(n,e){let t;if(e instanceof Fl)t={update:Q0(n,e.key,e.value)};else if(e instanceof Ul)t={delete:gc(n,e.key)};else if(e instanceof di)t={update:Q0(n,e.key,e.data),updateMask:fD(e.fieldMask)};else{if(!(e instanceof Ig))return Ne();t={verify:gc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof wl)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof aa)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof la)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof xl)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Ne()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:iD(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Ne()}(n,e.precondition)),t}function fm(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?rn.updateTime(Tn(i.updateTime)):i.exists!==void 0?rn.exists(i.exists):rn.none()}(e.currentDocument):rn.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Le(a.setToServerValue==="REQUEST_TIME"),l=new wl;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new aa(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new la(h)}else"increment"in a?l=new xl(o,a.increment):Ne();const c=nn.fromServerFormat(a.fieldPath);return new $c(c,l)}(n,s)):[];if(e.update){e.update.name;const s=As(n,e.update.name),i=new Yn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new Tr(c.map(h=>nn.fromServerFormat(h)))}(e.updateMask);return new di(s,i,o,t,r)}return new Fl(s,i,t,r)}if(e.delete){const s=As(n,e.delete);return new Ul(s,t)}if(e.verify){const s=As(n,e.verify);return new Ig(s,t)}return Ne()}function lD(n,e){return n&&n.length>0?(Le(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?Tn(s.updateTime):Tn(i);return o.isEqual(Be.min())&&(o=Tn(i)),new Q2(o,s.transformResults||[])}(t,e))):[]}function qI(n,e){return{documents:[FI(n,e.path)]}}function af(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=FI(n,s);const i=function(c){if(c.length!==0)return GI(Lt.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(h=>function(m){return{field:Fi(m.field),direction:cD(m.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=cm(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function zI(n,e,t,r){const{_t:s,parent:i}=af(n,e),o={},a=[];let l=0;return t.forEach(c=>{const h=r?c.alias:"aggregate_"+l++;o[h]=c.alias,c.aggregateType==="count"?a.push({alias:h,count:{}}):c.aggregateType==="avg"?a.push({alias:h,avg:{field:Fi(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:h,sum:{field:Fi(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function HI(n){let e=UI(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Le(r===1);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const m=KI(f);return m instanceof Lt&&_g(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(m=>function(w){return new mc(Xa(w.field),function(A){switch(A){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(w.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(f){let m;return m=typeof f=="object"?f.value:f,Oc(m)?null:m}(t.limit));let l=null;t.startAt&&(l=function(f){const m=!!f.before,v=f.values||[];return new ao(v,m)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const m=!f.before,v=f.values||[];return new ao(v,m)}(t.endAt)),pI(e,s,o,i,a,"F",l,c)}function uD(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ne()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function KI(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Xa(t.unaryFilter.field);return xt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Xa(t.unaryFilter.field);return xt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Xa(t.unaryFilter.field);return xt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Xa(t.unaryFilter.field);return xt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Ne()}}(n):n.fieldFilter!==void 0?function(t){return xt.create(Xa(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ne()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Lt.create(t.compositeFilter.filters.map(r=>KI(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Ne()}}(t.compositeFilter.op))}(n):Ne()}function cD(n){return tD[n]}function dD(n){return nD[n]}function hD(n){return rD[n]}function Fi(n){return{fieldPath:n.canonicalString()}}function Xa(n){return nn.fromServerFormat(n.fieldPath)}function GI(n){return n instanceof xt?function(t){if(t.op==="=="){if(D0(t.value))return{unaryFilter:{field:Fi(t.field),op:"IS_NAN"}};if(k0(t.value))return{unaryFilter:{field:Fi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(D0(t.value))return{unaryFilter:{field:Fi(t.field),op:"IS_NOT_NAN"}};if(k0(t.value))return{unaryFilter:{field:Fi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Fi(t.field),op:dD(t.op),value:t.value}}}(n):n instanceof Lt?function(t){const r=t.getFilters().map(s=>GI(s));return r.length===1?r[0]:{compositeFilter:{op:hD(t.op),filters:r}}}(n):Ne()}function fD(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function WI(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bs{constructor(e,t,r,s,i=Be.min(),o=Be.min(),a=pn.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Bs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Bs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Bs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Bs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QI{constructor(e){this.ct=e}}function pD(n,e){let t;if(e.document)t=BI(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=ke.fromSegments(e.noDocument.path),s=ca(e.noDocument.readTime);t=Jt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Ne();{const r=ke.fromSegments(e.unknownDocument.path),s=ca(e.unknownDocument.version);t=Jt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new ln(s[0],s[1]);return Be.fromTimestamp(i)}(e.readTime)),t}function J0(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:_h(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:gc(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Il(i,o.version.toTimestamp()),createTime:Il(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:ua(e.version)};else{if(!e.isUnknownDocument())return Ne();r.unknownDocument={path:t.path.toArray(),version:ua(e.version)}}return r}function _h(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function ua(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ca(n){const e=new ln(n.seconds,n.nanoseconds);return Be.fromTimestamp(e)}function zo(n,e){const t=(e.baseMutations||[]).map(i=>fm(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>fm(n.ct,i)),s=ln.fromMillis(e.localWriteTimeMs);return new Eg(e.batchId,s,t,r)}function ku(n){const e=ca(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?ca(n.lastLimboFreeSnapshotVersion):Be.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Le(i.documents.length===1),ur($l(UI(i.documents[0])))}(n.query):function(i){return ur(HI(i))}(n.query),new Bs(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,pn.fromBase64String(n.resumeToken))}function JI(n,e){const t=ua(e.snapshotVersion),r=ua(e.lastLimboFreeSnapshotVersion);let s;s=mh(e.target)?qI(n.ct,e.target):af(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:oa(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Rg(n){const e=HI({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?vh(e,e.limit,"L"):e}function wp(n,e){return new Ag(e.largestBatchId,fm(n.ct,e.overlayMutation))}function Y0(n,e){const t=e.path.lastSegment();return[n,lr(e.path.popLast()),t]}function X0(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:ua(r.readTime),documentKey:lr(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mD{getBundleMetadata(e,t){return Z0(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:ca(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return Z0(e).put(function(s){return{bundleId:s.id,createTime:ua(Tn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return e_(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Rg(i.bundledQuery),readTime:ca(i.readTime)}}(r)})}saveNamedQuery(e,t){return e_(e).put(function(s){return{name:s.name,readTime:ua(Tn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function Z0(n){return On(n,"bundles")}function e_(n){return On(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lf{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new lf(e,r)}getOverlay(e,t){return gu(e).get(Y0(this.userId,t)).next(r=>r?wp(this.serializer,r):null)}getOverlays(e,t){const r=xs();return z.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Ag(t,o);s.push(this.ht(e,a))}),z.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(lr(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(gu(e).j("collectionPathOverlayIndex",a))}),z.waitFor(i)}getOverlaysForCollection(e,t,r){const s=xs(),i=lr(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return gu(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=wp(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=xs();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return gu(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,h)=>{const f=wp(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}ht(e,t){return gu(e).put(function(s,i,o){const[a,l,c]=Y0(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:vc(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function gu(n){return On(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gD{Pt(e){return On(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?pn.fromUint8Array(r):pn.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(tn(e.integerValue));else if("doubleValue"in e){const r=tn(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),dc(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=ti(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(ni(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?sI(e)?this.dt(t,Number.MAX_SAFE_INTEGER):rf(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Ne()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(tn(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),ke.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Ho.vt=new Ho;function vD(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function t_(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=vD(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class yD{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=t_(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=t_(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class _D{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class bD{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class vu{constructor(){this.jt=new yD,this.Ht=new _D(this.jt),this.Jt=new bD(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ko{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Ko(this.indexId,this.documentKey,this.arrayValue,r)}}function Ci(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=n_(n.arrayValue,e.arrayValue),t!==0?t:(t=n_(n.directionalValue,e.directionalValue),t!==0?t:ke.comparator(n.documentKey,e.documentKey)))}function n_(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r_{constructor(e){this.Xt=new $t((t,r)=>nn.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Le(e.collectionGroup===this.collectionId),this.nn)return!1;const t=nm(e);if(t!==void 0&&!this.sn(t))return!1;const r=Fo(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new $t(nn.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Xo(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Xo(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Xo(r.field,r.dir==="asc"?0:1)));return new vl(vl.UNKNOWN_ID,this.collectionId,t,yl.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YI(n){var e,t;if(Le(n instanceof xt||n instanceof Lt),n instanceof xt){if(n instanceof fI){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>xt.create(n.field,"==",i)))||[];return Lt.create(s,"or")}return n}const r=n.filters.map(s=>YI(s));return Lt.create(r,n.op)}function wD(n){if(n.getFilters().length===0)return[];const e=gm(YI(n));return Le(XI(e)),pm(e)||mm(e)?[e]:e.getFilters()}function pm(n){return n instanceof xt}function mm(n){return n instanceof Lt&&_g(n)}function XI(n){return pm(n)||mm(n)||function(t){if(t instanceof Lt&&om(t)){for(const r of t.getFilters())if(!pm(r)&&!mm(r))return!1;return!0}return!1}(n)}function gm(n){if(Le(n instanceof xt||n instanceof Lt),n instanceof xt)return n;if(n.filters.length===1)return gm(n.filters[0]);const e=n.filters.map(r=>gm(r));let t=Lt.create(e,n.op);return t=bh(t),XI(t)?t:(Le(t instanceof Lt),Le(bl(t)),Le(t.filters.length>1),t.filters.reduce((r,s)=>Cg(r,s)))}function Cg(n,e){let t;return Le(n instanceof xt||n instanceof Lt),Le(e instanceof xt||e instanceof Lt),t=n instanceof xt?e instanceof xt?function(s,i){return Lt.create([s,i],"and")}(n,e):s_(n,e):e instanceof xt?s_(e,n):function(s,i){if(Le(s.filters.length>0&&i.filters.length>0),bl(s)&&bl(i))return cI(s,i.getFilters());const o=om(s)?s:i,a=om(s)?i:s,l=o.filters.map(c=>Cg(c,a));return Lt.create(l,"or")}(n,e),bh(t)}function s_(n,e){if(bl(e))return cI(e,n.getFilters());{const t=e.filters.map(r=>Cg(n,r));return Lt.create(t,"or")}}function bh(n){if(Le(n instanceof xt||n instanceof Lt),n instanceof xt)return n;const e=n.getFilters();if(e.length===1)return bh(e[0]);if(lI(n))return n;const t=e.map(s=>bh(s)),r=[];return t.forEach(s=>{s instanceof xt?r.push(s):s instanceof Lt&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Lt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xD{constructor(){this.un=new kg}addToCollectionParentIndex(e,t){return this.un.add(t),z.resolve()}getCollectionParents(e,t){return z.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return z.resolve()}deleteFieldIndex(e,t){return z.resolve()}deleteAllFieldIndexes(e){return z.resolve()}createTargetIndexes(e,t){return z.resolve()}getDocumentsMatchingTarget(e,t){return z.resolve(null)}getIndexType(e,t){return z.resolve(0)}getFieldIndexes(e,t){return z.resolve([])}getNextCollectionGroupToUpdate(e){return z.resolve(null)}getMinOffset(e,t){return z.resolve(Fr.min())}getMinOffsetFromCollectionGroup(e,t){return z.resolve(Fr.min())}updateCollectionGroup(e,t,r){return z.resolve()}updateIndexEntries(e,t){return z.resolve()}}class kg{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new $t(wt.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new $t(wt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ad=new Uint8Array(0);class ID{constructor(e,t){this.databaseId=t,this.cn=new kg,this.ln=new ci(r=>oa(r),(r,s)=>Vc(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:lr(s)};return i_(e).put(i)}return z.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[zx(t),""],!1,!0);return i_(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(ws(o.parent))}return r})}addFieldIndex(e,t){const r=yu(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Ga(e);return i.next(a=>{o.put(X0(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=yu(e),s=Ga(e),i=Ka(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=yu(e),r=Ka(e),s=Ga(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return z.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new r_(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Ka(e);let s=!0;const i=new Map;return z.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=at();const a=[];return z.forEach(i,(l,c)=>{fe("IndexedDbIndexManager",`Using index ${function($){return`id=${$.indexId}|cg=${$.collectionGroup}|f=${$.fields.map(L=>`${L.fieldPath}:${L.kind}`).join(",")}`}(l)} to execute ${oa(t)}`);const h=function($,L){const se=nm(L);if(se===void 0)return null;for(const te of gh($,se.fieldPath))switch(te.op){case"array-contains-any":return te.value.arrayValue.values||[];case"array-contains":return[te.value]}return null}(c,l),f=function($,L){const se=new Map;for(const te of Fo(L))for(const T of gh($,te.fieldPath))switch(T.op){case"==":case"in":se.set(te.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return se.set(te.fieldPath.canonicalString(),T.value),Array.from(se.values())}return null}(c,l),m=function($,L){const se=[];let te=!0;for(const T of Fo(L)){const _=T.kind===0?L0($,T.fieldPath,$.startAt):$0($,T.fieldPath,$.startAt);se.push(_.value),te&&(te=_.inclusive)}return new ao(se,te)}(c,l),v=function($,L){const se=[];let te=!0;for(const T of Fo(L)){const _=T.kind===0?$0($,T.fieldPath,$.endAt):L0($,T.fieldPath,$.endAt);se.push(_.value),te&&(te=_.inclusive)}return new ao(se,te)}(c,l),w=this.In(l,c,m),E=this.In(l,c,v),A=this.Tn(l,c,f),F=this.En(l.indexId,h,w,m.inclusive,E,v.inclusive,A);return z.forEach(F,U=>r.G(U,t.limit).next($=>{$.forEach(L=>{const se=ke.fromSegments(L.documentKey);o.has(se)||(o=o.add(se),a.push(se))})}))}).next(()=>a)}return z.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=wD(Lt.create(e.filters,"and")).map(r=>lm(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const m=t?this.dn(t[f/c]):Ad,v=this.An(e,m,r[f%c],s),w=this.Rn(e,m,i[f%c],o),E=a.map(A=>this.An(e,m,A,!0));h.push(...this.createRange(v,w,E))}return h}An(e,t,r,s){const i=new Ko(e,ke.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new Ko(e,ke.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new r_(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return z.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new $t(nn.comparator),h=!1;for(const f of l.filters)for(const m of f.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?h=!0:c=c.add(m.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new vu;for(const s of Fo(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);Ho.vt.It(i,o)}return r.zt()}dn(e){const t=new vu;return Ho.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new vu;return Ho.vt.It(ia(this.databaseId,t),r.Yt(function(i){const o=Fo(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new vu);let i=0;for(const o of Fo(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&pc(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);Ho.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new vu;l.seed(a.zt()),Ho.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof xt&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=yu(e),s=Ga(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return z.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const m=f?new yl(f.sequenceNumber,new Fr(ca(f.readTime),new ke(ws(f.documentKey)),f.largestBatchId)):yl.empty(),v=h.fields.map(([w,E])=>new Xo(nn.fromServerFormat(w),E));return new vl(h.indexId,h.collectionGroup,v,m)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:et(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=yu(e),i=Ga(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>z.forEach(a,l=>i.put(X0(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return z.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?z.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),z.forEach(a,l=>this.wn(e,s,l).next(c=>{const h=this.Sn(i,l);return c.isEqual(h)?z.resolve():this.bn(e,i,l,c,h)}))))})}Dn(e,t,r,s){return Ka(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return Ka(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=Ka(e);let i=new $t(Ci);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new Ko(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new $t(Ci);const s=this.Vn(t,e);if(s==null)return r;const i=nm(t);if(i!=null){const o=e.data.field(i.fieldPath);if(pc(o))for(const a of o.arrayValue.values||[])r=r.add(new Ko(t.indexId,e.key,this.dn(a),s))}else r=r.add(new Ko(t.indexId,e.key,Ad,s));return r}bn(e,t,r,s,i){fe("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,h,f,m){const v=l.getIterator(),w=c.getIterator();let E=Ha(v),A=Ha(w);for(;E||A;){let F=!1,U=!1;if(E&&A){const $=h(E,A);$<0?U=!0:$>0&&(F=!0)}else E!=null?U=!0:F=!0;F?(f(A),A=Ha(w)):U?(m(E),E=Ha(v)):(E=Ha(v),A=Ha(w))}}(s,i,Ci,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),z.waitFor(o)}yn(e){let t=1;return Ga(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Ci(o,a)).filter((o,a,l)=>!a||Ci(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Ci(o,e),l=Ci(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Ad,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Ad,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return Ci(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(o_)}getMinOffset(e,t){return z.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||Ne())).next(o_)}}function i_(n){return On(n,"collectionParents")}function Ka(n){return On(n,"indexEntries")}function yu(n){return On(n,"indexConfiguration")}function Ga(n){return On(n,"indexState")}function o_(n){Le(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;gg(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Fr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class sr{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new sr(e,sr.DEFAULT_COLLECTION_PERCENTILE,sr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZI(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(h,f,m)=>(a++,m.delete()));i.push(l.next(()=>{Le(a===1)}));const c=[];for(const h of t.mutations){const f=Yx(e,h.key.path,t.batchId);i.push(s.delete(f)),c.push(h.key)}return z.waitFor(i).next(()=>c)}function wh(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Ne();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */sr.DEFAULT_COLLECTION_PERCENTILE=10,sr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sr.DEFAULT=new sr(41943040,sr.DEFAULT_COLLECTION_PERCENTILE,sr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sr.DISABLED=new sr(-1,0,0);class uf{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Le(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new uf(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ki(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Za(e),o=ki(e);return o.add({}).next(a=>{Le(typeof a=="number");const l=new Eg(a,t,r,s),c=function(v,w,E){const A=E.baseMutations.map(U=>vc(v.ct,U)),F=E.mutations.map(U=>vc(v.ct,U));return{userId:w,batchId:E.batchId,localWriteTimeMs:E.localWriteTime.toMillis(),baseMutations:A,mutations:F}}(this.serializer,this.userId,l),h=[];let f=new $t((m,v)=>et(m.canonicalString(),v.canonicalString()));for(const m of s){const v=Yx(this.userId,m.key.path,a);f=f.add(m.key.path.popLast()),h.push(o.put(c)),h.push(i.put(v,d2))}return f.forEach(m=>{h.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),z.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return ki(e).get(t).next(r=>r?(Le(r.userId===this.userId),zo(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?z.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ki(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Le(a.batchId>=r),i=zo(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ki(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ki(e).U("userMutationsIndex",t).next(r=>r.map(s=>zo(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=zd(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Za(e).J({range:s},(o,a,l)=>{const[c,h,f]=o,m=ws(h);if(c===this.userId&&t.path.isEqual(m))return ki(e).get(f).next(v=>{if(!v)throw Ne();Le(v.userId===this.userId),i.push(zo(this.serializer,v))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new $t(et);const s=[];return t.forEach(i=>{const o=zd(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Za(e).J({range:a},(c,h,f)=>{const[m,v,w]=c,E=ws(v);m===this.userId&&i.path.isEqual(E)?r=r.add(w):f.done()});s.push(l)}),z.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=zd(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new $t(et);return Za(e).J({range:o},(l,c,h)=>{const[f,m,v]=l,w=ws(m);f===this.userId&&r.isPrefixOf(w)?w.length===s&&(a=a.add(v)):h.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ki(e).get(i).next(o=>{if(o===null)throw Ne();Le(o.userId===this.userId),r.push(zo(this.serializer,o))}))}),z.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return ZI(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),z.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return z.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Za(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=ws(i[1]);s.push(l)}else a.done()}).next(()=>{Le(s.length===0)})})}containsKey(e,t){return eE(e,this.userId,t)}Nn(e){return tE(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function eE(n,e,t){const r=zd(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Za(n).J({range:i,H:!0},(a,l,c)=>{const[h,f,m]=a;h===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function ki(n){return On(n,"mutations")}function Za(n){return On(n,"documentMutations")}function tE(n){return On(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new da(0)}static kn(){return new da(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ED{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new da(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Be.fromTimestamp(new ln(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Wa(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Le(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Wa(e).J((o,a)=>{const l=ku(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>z.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Wa(e).J((r,s)=>{const i=ku(s);t(i)})}qn(e){return l_(e).get("targetGlobalKey").next(t=>(Le(t!==null),t))}Qn(e,t){return l_(e).put("targetGlobalKey",t)}Kn(e,t){return Wa(e).put(JI(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=oa(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Wa(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=ku(a);Vc(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Ui(e);return t.forEach(o=>{const a=lr(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),z.waitFor(s)}removeMatchingKeys(e,t,r){const s=Ui(e);return z.forEach(t,i=>{const o=lr(i.path);return z.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Ui(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Ui(e);let i=at();return s.J({range:r,H:!0},(o,a,l)=>{const c=ws(o[1]),h=new ke(c);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=lr(t.path),s=IDBKeyRange.bound([r],[zx(r)],!1,!0);let i=0;return Ui(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return Wa(e).get(t).next(r=>r?ku(r):null)}}function Wa(n){return On(n,"targets")}function l_(n){return On(n,"targetGlobal")}function Ui(n){return On(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u_([n,e],[t,r]){const s=et(n,t);return s===0?et(e,r):s}class TD{constructor(e){this.Un=e,this.buffer=new $t(u_),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();u_(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class nE{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){fe("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){mo(t)?fe("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await po(t)}await this.Hn(3e5)})}}class AD{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return z.resolve(Er.oe);const r=new TD(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(fe("LruGarbageCollector","Garbage collection skipped; disabled"),z.resolve(a_)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(fe("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),a_):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(fe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),Ja()<=_t.DEBUG&&fe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-h}ms`),z.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function rE(n,e){return new AD(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SD{constructor(e,t){this.db=e,this.garbageCollector=rE(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return Sd(e,r)}removeReference(e,t,r){return Sd(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Sd(e,t)}nr(e,t){return function(s,i){let o=!1;return tE(s).Y(a=>eE(s,a,i).next(l=>(l&&(o=!0),z.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Be.min()),Ui(e).delete(function(f){return[0,lr(f.path)]}(o))))});s.push(l)}}).next(()=>z.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Sd(e,t)}tr(e,t){const r=Ui(e);let s,i=Er.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==Er.oe&&t(new ke(ws(s)),i),i=c,s=l):i=Er.oe}).next(()=>{i!==Er.oe&&t(new ke(ws(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Sd(n,e){return Ui(n).put(function(r,s){return{targetId:0,path:lr(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sE{constructor(){this.changes=new ci(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Jt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?z.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PD{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Mo(e).put(r)}removeEntry(e,t,r){return Mo(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],_h(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Jt.newInvalidDocument(t);return Mo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(_u(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:Jt.newInvalidDocument(t)};return Mo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(_u(t))},(s,i)=>{r={document:this.ir(t,i),size:wh(i)}}).next(()=>r)}getEntries(e,t){let r=Ar();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=Ar(),s=new Kt(ke.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,wh(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return z.resolve();let s=new $t(h_);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(_u(s.first()),_u(s.last())),o=s.getIterator();let a=o.getNext();return Mo(e).J({index:"documentKeyIndex",range:i},(l,c,h)=>{const f=ke.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&h_(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?h.$(_u(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),_h(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Mo(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let h=Ar();for(const f of c){const m=this.ir(ke.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);m.isFoundDocument()&&(Lc(t,m)||s.has(m.key))&&(h=h.insert(m.key,m))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=Ar();const o=d_(t,r),a=d_(t,Fr.max());return Mo(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,h)=>{const f=this.ir(ke.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new RD(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return c_(e).get("remoteDocumentGlobalKey").next(t=>(Le(!!t),t))}rr(e,t){return c_(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=pD(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Be.min())))return r}return Jt.newInvalidDocument(e)}}function iE(n){return new PD(n)}class RD extends sE{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new ci(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new $t((i,o)=>et(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=J0(this.cr.serializer,o);s=s.add(i.path.popLast());const c=wh(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=J0(this.cr.serializer,o.convertToNoDocument(Be.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),z.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function c_(n){return On(n,"remoteDocumentGlobal")}function Mo(n){return On(n,"remoteDocumentsV14")}function _u(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function d_(n,e){const t=e.documentKey.path.toArray();return[n,_h(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function h_(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=et(t[i],r[i]),s)return s;return s=et(t.length,r.length),s||(s=et(t[t.length-2],r[r.length-2]),s||et(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CD{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oE{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&qu(r.mutation,s,Tr.empty(),ln.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,at()).next(()=>r))}getLocalViewOfDocuments(e,t,r=at()){const s=xs();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Ru();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=xs();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,at()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Ar();const o=Bu(),a=function(){return Bu()}();return t.forEach((l,c)=>{const h=r.get(c.key);s.has(c.key)&&(h===void 0||h.mutation instanceof di)?i=i.insert(c.key,c):h!==void 0?(o.set(c.key,h.mutation.getFieldMask()),qu(h.mutation,c,h.mutation.getFieldMask(),ln.now())):o.set(c.key,Tr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,h)=>o.set(c,h)),t.forEach((c,h)=>{var f;return a.set(c,new CD(h,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Bu();let s=new Kt((o,a)=>o-a),i=at();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let h=r.get(l)||Tr.empty();h=a.applyToLocalView(c,h),r.set(l,h);const f=(s.get(a.batchId)||at()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,h=l.value,f=xI();h.forEach(m=>{if(!i.has(m)){const v=RI(t.get(m),r.get(m));v!==null&&f.set(m,v),i=i.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return z.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return ke.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):bg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):z.resolve(xs());let a=-1,l=i;return o.next(c=>z.forEach(c,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?z.resolve():this.remoteDocumentCache.getEntry(e,h).next(m=>{l=l.insert(h,m)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,at())).next(h=>({batchId:a,changes:wI(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ke(t)).next(r=>{let s=Ru();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Ru();return this.indexManager.getCollectionParents(e,i).next(a=>z.forEach(a,l=>{const c=function(f,m){return new ui(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(h=>{h.forEach((f,m)=>{o=o.insert(f,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const h=c.getKey();o.get(h)===null&&(o=o.insert(h,Jt.newInvalidDocument(h)))});let a=Ru();return o.forEach((l,c)=>{const h=i.get(l);h!==void 0&&qu(h.mutation,c,Tr.empty(),ln.now()),Lc(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kD{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return z.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Tn(s.createTime)}}(t)),z.resolve()}getNamedQuery(e,t){return z.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Rg(s.bundledQuery),readTime:Tn(s.readTime)}}(t)),z.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DD{constructor(){this.overlays=new Kt(ke.comparator),this.Ir=new Map}getOverlay(e,t){return z.resolve(this.overlays.get(t))}getOverlays(e,t){const r=xs();return z.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),z.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),z.resolve()}getOverlaysForCollection(e,t,r){const s=xs(),i=t.length+1,o=new ke(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return z.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Kt((c,h)=>c-h);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let h=i.get(c.largestBatchId);h===null&&(h=xs(),i=i.insert(c.largestBatchId,h)),h.set(c.getKey(),c)}}const a=xs(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,h)=>a.set(c,h)),!(a.size()>=s)););return z.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Ag(t,r));let i=this.Ir.get(t);i===void 0&&(i=at(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ND{constructor(){this.sessionToken=pn.EMPTY_BYTE_STRING}getSessionToken(e){return z.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,z.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dg{constructor(){this.Tr=new $t(Fn.Er),this.dr=new $t(Fn.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new Fn(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Fn(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new ke(new wt([])),r=new Fn(t,e),s=new Fn(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new ke(new wt([])),r=new Fn(t,e),s=new Fn(t,e+1);let i=at();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Fn(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Fn{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return ke.comparator(e.key,t.key)||et(e.wr,t.wr)}static Ar(e,t){return et(e.wr,t.wr)||ke.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new $t(Fn.Er)}checkEmpty(e){return z.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Eg(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new Fn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return z.resolve(o)}lookupMutationBatch(e,t){return z.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return z.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return z.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return z.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Fn(t,0),s=new Fn(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),z.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new $t(et);return t.forEach(s=>{const i=new Fn(s,0),o=new Fn(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),z.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;ke.isDocumentKey(i)||(i=i.child(""));const o=new Fn(new ke(i),0);let a=new $t(et);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),z.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Le(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return z.forEach(t.mutations,s=>{const i=new Fn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new Fn(t,0),s=this.br.firstAfterOrEqual(r);return z.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,z.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VD{constructor(e){this.Mr=e,this.docs=function(){return new Kt(ke.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return z.resolve(r?r.document.mutableCopy():Jt.newInvalidDocument(t))}getEntries(e,t){let r=Ar();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Jt.newInvalidDocument(s))}),z.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Ar();const o=t.path,a=new ke(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:h}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||gg(Kx(h),r)<=0||(s.has(h.key)||Lc(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return z.resolve(i)}getAllFromCollectionGroup(e,t,r,s){Ne()}Or(e,t){return z.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new MD(this)}getSize(e){return z.resolve(this.size)}}class MD extends sE{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),z.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LD{constructor(e){this.persistence=e,this.Nr=new ci(t=>oa(t),Vc),this.lastRemoteSnapshotVersion=Be.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Dg,this.targetCount=0,this.kr=da.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),z.resolve()}getLastRemoteSnapshotVersion(e){return z.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return z.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),z.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),z.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new da(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,z.resolve()}updateTargetData(e,t){return this.Kn(t),z.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,z.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),z.waitFor(i).next(()=>s)}getTargetCount(e){return z.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return z.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),z.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),z.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),z.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return z.resolve(r)}containsKey(e,t){return z.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ng{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Er(0),this.Kr=!1,this.Kr=!0,this.$r=new ND,this.referenceDelegate=e(this),this.Ur=new LD(this),this.indexManager=new xD,this.remoteDocumentCache=function(s){return new VD(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new QI(t),this.Gr=new kD(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new DD,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new OD(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){fe("MemoryPersistence","Starting transaction:",e);const s=new $D(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return z.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class $D extends Wx{constructor(e){super(),this.currentSequenceNumber=e}}class cf{constructor(e){this.persistence=e,this.Jr=new Dg,this.Yr=null}static Zr(e){return new cf(e)}get Xr(){if(this.Yr)return this.Yr;throw Ne()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),z.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),z.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),z.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return z.forEach(this.Xr,r=>{const s=ke.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Be.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return z.or([()=>z.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class xh{constructor(e,t){this.persistence=e,this.ti=new ci(r=>lr(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=rE(this,t)}static Zr(e,t){return new xh(e,t)}zr(){}jr(e){return z.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return z.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?z.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Be.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),z.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),z.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),z.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),z.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Kd(e.data.value)),t}nr(e,t,r){return z.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return z.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FD{constructor(e){this.serializer=e}O(e,t,r,s){const i=new ef("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",A0,{unique:!0}),l.createObjectStore("documentMutations")}(e),f_(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=z.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),f_(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Be.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(h=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",A0,{unique:!0});const f=c.store("mutations"),m=h.map(v=>f.put(v));return z.waitFor(m)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:I2});c.createIndex("collectionPathOverlayIndex",E2,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",T2,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:h2});c.createIndex("documentKeyIndex",f2),c.createIndex("collectionGroupIndex",p2)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:_2}).createIndex("sequenceNumberIndex",b2,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:w2}).createIndex("documentKeyIndex",x2,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=wh(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>z.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>z.forEach(a,l=>{Le(l.userId===i.userId);const c=zo(this.serializer,l);return ZI(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new wt(o),c=function(f){return[0,lr(f)]}(l);i.push(t.get(c).next(h=>h?z.resolve():(f=>t.put({targetId:0,path:lr(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>z.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:y2});const r=t.store("collectionParents"),s=new kg,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:lr(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new wt(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const h=ws(a);return i(h.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=ku(s),o=JI(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new ke(wt.fromString(f.document.name).popFirst(5)):f.noDocument?ke.fromSegments(f.noDocument.path):f.unknownDocument?ke.fromSegments(f.unknownDocument.path):Ne()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>z.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=iE(this.serializer),i=new Ng(cf.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let h=(c=a.get(l.userId))!==null&&c!==void 0?c:at();zo(this.serializer,l).keys().forEach(f=>h=h.add(f)),a.set(l.userId,h)}),z.forEach(a,(l,c)=>{const h=new Un(c),f=lf.lt(this.serializer,h),m=i.getIndexManager(h),v=uf.lt(h,this.serializer,m,i.referenceDelegate);return new oE(s,v,f,m).recalculateAndSaveOverlaysForDocumentKeys(new rm(t,Er.oe),l).next()})})}}function f_(n){n.createObjectStore("targetDocuments",{keyPath:g2}).createIndex("documentTargetsIndex",v2,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",m2,{unique:!0}),n.createObjectStore("targetGlobal")}const xp="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Og{constructor(e,t,r,s,i,o,a,l,c,h,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=h,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=m=>Promise.resolve(),!Og.D())throw new pe(Q.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new SD(this,s),this.Ai=t+"main",this.serializer=new QI(l),this.Ri=new Ts(this.Ai,this.hi,new FD(this.serializer)),this.$r=new gD,this.Ur=new ED(this.referenceDelegate,this.serializer),this.remoteDocumentCache=iE(this.serializer),this.Gr=new mD,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,h===!1&&xn("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new pe(Q.FAILED_PRECONDITION,xp);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Er(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Pd(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(mo(e))return fe("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return fe("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return bu(e).get("owner").next(t=>z.resolve(this.vi(t)))}Ci(e){return Pd(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=On(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return z.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?z.resolve(!0):bu(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new pe(Q.FAILED_PRECONDITION,xp);return!1}}return!(!this.networkEnabled||!this.inForeground)||Pd(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&fe("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new rm(e,Er.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Pd(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return uf.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new ID(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return lf.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){fe("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?P2:l===16?S2:l===15?yg:l===14?eI:l===13?Zx:l===12?A2:l===11?Xx:void Ne()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new rm(a,this.Qr?this.Qr.next():Er.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw xn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new pe(Q.FAILED_PRECONDITION,Gx);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return bu(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new pe(Q.FAILED_PRECONDITION,xp)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return bu(e).put("owner",t)}static D(){return Ts.D()}bi(e){const t=bu(e);return t.get("owner").next(r=>this.vi(r)?(fe("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):z.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(xn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;nx()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return fe("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return xn("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){xn("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function bu(n){return On(n,"owner")}function Pd(n){return On(n,"clientMetadata")}function Vg(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mg{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=at(),s=at();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Mg(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UD{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aE{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return nx()?8:Qx(Nn())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new UD;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(Ja()<=_t.DEBUG&&fe("QueryEngine","SDK will not create cache indexes for query:",Ya(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),z.resolve()):(Ja()<=_t.DEBUG&&fe("QueryEngine","Query:",Ya(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Ja()<=_t.DEBUG&&fe("QueryEngine","The SDK decides to create cache indexes for query:",Ya(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ur(t))):z.resolve())}Yi(e,t){if(F0(t))return z.resolve(null);let r=ur(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=vh(t,null,"F"),r=ur(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=at(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,vh(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return F0(t)||s.isEqual(Be.min())?z.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?z.resolve(null):(Ja()<=_t.DEBUG&&fe("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ya(t)),this.rs(e,o,t,Hx(s,-1)).next(a=>a))})}ts(e,t){let r=new $t(_I(e));return t.forEach((s,i)=>{Lc(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return Ja()<=_t.DEBUG&&fe("QueryEngine","Using full collection scan to execute query:",Ya(t)),this.Ji.getDocumentsMatchingQuery(e,t,Fr.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jD{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Kt(et),this._s=new ci(i=>oa(i),Vc),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new oE(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function lE(n,e,t,r){return new jD(n,e,t,r)}async function uE(n,e){const t=Pe(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=at();for(const c of s){o.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}for(const c of i){a.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function BD(n,e){const t=Pe(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,h){const f=c.batch,m=f.keys();let v=z.resolve();return m.forEach(w=>{v=v.next(()=>h.getEntry(l,w)).next(E=>{const A=c.docVersions.get(w);Le(A!==null),E.version.compareTo(A)<0&&(f.applyToRemoteDocument(E,c),E.isValidDocument()&&(E.setReadTime(c.commitVersion),h.addEntry(E)))})}),v.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=at();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function cE(n){const e=Pe(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function qD(n,e){const t=Pe(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((h,f)=>{const m=s.get(f);if(!m)return;a.push(t.Ur.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,h.addedDocuments,f)));let v=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?v=v.withResumeToken(pn.EMPTY_BYTE_STRING,Be.min()).withLastLimboFreeSnapshotVersion(Be.min()):h.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(h.resumeToken,r)),s=s.insert(f,v),function(E,A,F){return E.resumeToken.approximateByteSize()===0||A.snapshotVersion.toMicroseconds()-E.snapshotVersion.toMicroseconds()>=3e8?!0:F.addedDocuments.size+F.modifiedDocuments.size+F.removedDocuments.size>0}(m,v,h)&&a.push(t.Ur.updateTargetData(i,v))});let l=Ar(),c=at();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(dE(i,o,e.documentUpdates).next(h=>{l=h.Ps,c=h.Is})),!r.isEqual(Be.min())){const h=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return z.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function dE(n,e,t){let r=at(),s=at();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Ar();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(Be.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):fe("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function zD(n,e){const t=Pe(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function El(n,e){const t=Pe(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,z.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new Bs(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function Tl(n,e,t){const r=Pe(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!mo(o))throw o;fe("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Ih(n,e,t){const r=Pe(n);let s=Be.min(),i=at();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,h){const f=Pe(l),m=f._s.get(h);return m!==void 0?z.resolve(f.os.get(m)):f.Ur.getTargetData(c,h)}(r,o,ur(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:Be.min(),t?i:at())).next(a=>(pE(r,yI(e),a),{documents:a,Ts:i})))}function hE(n,e){const t=Pe(n),r=Pe(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function fE(n,e){const t=Pe(n),r=t.us.get(e)||Be.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,Hx(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(pE(t,e,s),s))}function pE(n,e,t){let r=n.us.get(e)||Be.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function HD(n,e,t,r){const s=Pe(n);let i=at(),o=Ar();for(const c of t){const h=e.Es(c.metadata.name);c.document&&(i=i.add(h));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(h,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await El(s,function(h){return ur($l(wt.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>dE(c,a,o).next(h=>(a.apply(c),h)).next(h=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,h.Ps,h.Is)).next(()=>h.Ps)))}async function KD(n,e,t=at()){const r=await El(n,ur(Rg(e.bundledQuery))),s=Pe(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=Tn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(pn.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function p_(n,e){return`firestore_clients_${n}_${e}`}function m_(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Ip(n,e){return`firestore_targets_${n}_${e}`}class Eh{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new pe(s.error.code,s.error.message))),o?new Eh(e,t,s.state,i):(xn("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class zu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new pe(r.error.code,r.error.message))),i?new zu(e,r.state,s):(xn("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Th{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=wg();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=Jx(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Th(e,i):(xn("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Lg{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Lg(t.clientId,t.onlineState):(xn("SharedClientState",`Failed to parse online state: ${e}`),null)}}class vm{constructor(){this.activeTargetIds=wg()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ep{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Kt(et),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=p_(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new vm),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(p_(this.persistenceKey,r));if(s){const i=Th.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Ip(this.persistenceKey,e));if(s){const i=zu.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Ip(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return fe("SharedClientState","READ",e,t),t}setItem(e,t){fe("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){fe("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(fe("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void xn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=Er.oe;if(i!=null)try{const a=JSON.parse(i);Le(typeof a=="number"),o=a}catch(a){xn("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Er.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new Eh(this.currentUser,e,t,r),i=m_(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=m_(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Ip(this.persistenceKey,e),i=new zu(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Th.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Eh.Rs(new Un(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return zu.Rs(s,t)}Ls(e){return Lg.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);fe("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=wg();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class mE{constructor(){this.so=new vm,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new vm,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GD{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g_{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){fe("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){fe("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Rd=null;function Tp(){return Rd===null?Rd=function(){return 268435456+Math.round(2147483648*Math.random())}():Rd++,"0x"+Rd.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WD={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QD{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nr="WebChannelConnection";class JD extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=Tp(),l=this.xo(t,r.toUriEncodedString());fe("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(h=>(fe("RestConnection",`Received RPC '${t}' ${a}: `,h),h),h=>{throw Qr("RestConnection",`RPC '${t}' ${a} failed with error: `,h,"url: ",l,"request:",s),h})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ll}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=WD[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Tp();return new Promise((o,a)=>{const l=new Mx;l.setWithCredentials(!0),l.listenOnce(Lx.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case qd.NO_ERROR:const h=l.getResponseJson();fe(nr,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),o(h);break;case qd.TIMEOUT:fe(nr,`RPC '${e}' ${i} timed out`),a(new pe(Q.DEADLINE_EXCEEDED,"Request time out"));break;case qd.HTTP_ERROR:const f=l.getStatus();if(fe(nr,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let m=l.getResponseJson();Array.isArray(m)&&(m=m[0]);const v=m==null?void 0:m.error;if(v&&v.status&&v.message){const w=function(A){const F=A.toLowerCase().replace(/_/g,"-");return Object.values(Q).indexOf(F)>=0?F:Q.UNKNOWN}(v.status);a(new pe(w,v.message))}else a(new pe(Q.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new pe(Q.UNAVAILABLE,"Connection failed."));break;default:Ne()}}finally{fe(nr,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);fe(nr,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=Tp(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Ux(),a=Fx(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");fe(nr,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=o.createWebChannel(h,l);let m=!1,v=!1;const w=new QD({Io:A=>{v?fe(nr,`Not sending because RPC '${e}' stream ${s} is closed:`,A):(m||(fe(nr,`Opening RPC '${e}' stream ${s} transport.`),f.open(),m=!0),fe(nr,`RPC '${e}' stream ${s} sending:`,A),f.send(A))},To:()=>f.close()}),E=(A,F,U)=>{A.listen(F,$=>{try{U($)}catch(L){setTimeout(()=>{throw L},0)}})};return E(f,Pu.EventType.OPEN,()=>{v||(fe(nr,`RPC '${e}' stream ${s} transport opened.`),w.yo())}),E(f,Pu.EventType.CLOSE,()=>{v||(v=!0,fe(nr,`RPC '${e}' stream ${s} transport closed`),w.So())}),E(f,Pu.EventType.ERROR,A=>{v||(v=!0,Qr(nr,`RPC '${e}' stream ${s} transport errored:`,A),w.So(new pe(Q.UNAVAILABLE,"The operation could not be completed")))}),E(f,Pu.EventType.MESSAGE,A=>{var F;if(!v){const U=A.data[0];Le(!!U);const $=U,L=$.error||((F=$[0])===null||F===void 0?void 0:F.error);if(L){fe(nr,`RPC '${e}' stream ${s} received error:`,L);const se=L.status;let te=function(I){const C=Sn[I];if(C!==void 0)return NI(C)}(se),T=L.message;te===void 0&&(te=Q.INTERNAL,T="Unknown error status: "+se+" with message "+L.message),v=!0,w.So(new pe(te,T)),f.close()}else fe(nr,`RPC '${e}' stream ${s} received:`,U),w.bo(U)}}),E(a,$x.STAT_EVENT,A=>{A.stat===tm.PROXY?fe(nr,`RPC '${e}' stream ${s} detected buffering proxy`):A.stat===tm.NOPROXY&&fe(nr,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{w.wo()},0),w}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gE(){return typeof window<"u"?window:null}function Jd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jc(n){return new sD(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $g{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&fe("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vE{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new $g(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===Q.RESOURCE_EXHAUSTED?(xn(t.toString()),xn("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===Q.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new pe(Q.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return fe("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(fe("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class YD extends vE{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=aD(this.serializer,e),r=function(i){if(!("targetChange"in i))return Be.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Be.min():o.readTime?Tn(o.readTime):Be.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=hm(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=mh(l)?{documents:qI(i,l)}:{query:af(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=LI(i,o.resumeToken);const c=cm(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(Be.min())>0){a.readTime=Il(i,o.snapshotVersion.toTimestamp());const c=cm(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=uD(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=hm(this.serializer),t.removeTarget=e,this.a_(t)}}class XD extends vE{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Le(!!e.streamToken),this.lastStreamToken=e.streamToken,Le(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Le(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=lD(e.writeResults,e.commitTime),r=Tn(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=hm(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>vc(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZD extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new pe(Q.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,dm(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===Q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new pe(Q.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,dm(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new pe(Q.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class eN{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(xn(t),this.D_=!1):fe("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tN{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{vo(this)&&(fe("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=Pe(l);c.L_.add(4),await jl(c),c.q_.set("Unknown"),c.L_.delete(4),await Bc(c)}(this))})}),this.q_=new eN(r,s)}}async function Bc(n){if(vo(n))for(const e of n.B_)await e(!0)}async function jl(n){for(const e of n.B_)await e(!1)}function df(n,e){const t=Pe(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),jg(t)?Ug(t):ql(t).r_()&&Fg(t,e))}function Al(n,e){const t=Pe(n),r=ql(t);t.N_.delete(e),r.r_()&&yE(t,e),t.N_.size===0&&(r.r_()?r.o_():vo(t)&&t.q_.set("Unknown"))}function Fg(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Be.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ql(n).A_(e)}function yE(n,e){n.Q_.xe(e),ql(n).R_(e)}function Ug(n){n.Q_=new eD({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),ql(n).start(),n.q_.v_()}function jg(n){return vo(n)&&!ql(n).n_()&&n.N_.size>0}function vo(n){return Pe(n).L_.size===0}function _E(n){n.Q_=void 0}async function nN(n){n.q_.set("Online")}async function rN(n){n.N_.forEach((e,t)=>{Fg(n,e)})}async function sN(n,e){_E(n),jg(n)?(n.q_.M_(e),Ug(n)):n.q_.set("Unknown")}async function iN(n,e,t){if(n.q_.set("Online"),e instanceof MI&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){fe("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Ah(n,r)}else if(e instanceof Qd?n.Q_.Ke(e):e instanceof VI?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Be.min()))try{const r=await cE(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.N_.get(c);h&&i.N_.set(c,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const h=i.N_.get(l);if(!h)return;i.N_.set(l,h.withResumeToken(pn.EMPTY_BYTE_STRING,h.snapshotVersion)),yE(i,l);const f=new Bs(h.target,l,c,h.sequenceNumber);Fg(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){fe("RemoteStore","Failed to raise snapshot:",r),await Ah(n,r)}}async function Ah(n,e,t){if(!mo(e))throw e;n.L_.add(1),await jl(n),n.q_.set("Offline"),t||(t=()=>cE(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{fe("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Bc(n)})}function bE(n,e){return e().catch(t=>Ah(n,t,e))}async function Bl(n){const e=Pe(n),t=lo(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;oN(e);)try{const s=await zD(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,aN(e,s)}catch(s){await Ah(e,s)}wE(e)&&xE(e)}function oN(n){return vo(n)&&n.O_.length<10}function aN(n,e){n.O_.push(e);const t=lo(n);t.r_()&&t.V_&&t.m_(e.mutations)}function wE(n){return vo(n)&&!lo(n).n_()&&n.O_.length>0}function xE(n){lo(n).start()}async function lN(n){lo(n).p_()}async function uN(n){const e=lo(n);for(const t of n.O_)e.m_(t.mutations)}async function cN(n,e,t){const r=n.O_.shift(),s=Tg.from(r,e,t);await bE(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Bl(n)}async function dN(n,e){e&&lo(n).V_&&await async function(r,s){if(function(o){return DI(o)&&o!==Q.ABORTED}(s.code)){const i=r.O_.shift();lo(r).s_(),await bE(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Bl(r)}}(n,e),wE(n)&&xE(n)}async function v_(n,e){const t=Pe(n);t.asyncQueue.verifyOperationInProgress(),fe("RemoteStore","RemoteStore received new credentials");const r=vo(t);t.L_.add(3),await jl(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Bc(t)}async function ym(n,e){const t=Pe(n);e?(t.L_.delete(2),await Bc(t)):e||(t.L_.add(2),await jl(t),t.q_.set("Unknown"))}function ql(n){return n.K_||(n.K_=function(t,r,s){const i=Pe(t);return i.w_(),new YD(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:nN.bind(null,n),Ro:rN.bind(null,n),mo:sN.bind(null,n),d_:iN.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),jg(n)?Ug(n):n.q_.set("Unknown")):(await n.K_.stop(),_E(n))})),n.K_}function lo(n){return n.U_||(n.U_=function(t,r,s){const i=Pe(t);return i.w_(),new XD(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:lN.bind(null,n),mo:dN.bind(null,n),f_:uN.bind(null,n),g_:cN.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await Bl(n)):(await n.U_.stop(),n.O_.length>0&&(fe("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bg{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new qn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Bg(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new pe(Q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function zl(n,e){if(xn("AsyncQueue",`${e}: ${n}`),mo(n))return new pe(Q.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ul{constructor(e){this.comparator=e?(t,r)=>e(t,r)||ke.comparator(t.key,r.key):(t,r)=>ke.comparator(t.key,r.key),this.keyedMap=Ru(),this.sortedSet=new Kt(this.comparator)}static emptySet(e){return new ul(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ul)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new ul;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y_{constructor(){this.W_=new Kt(ke.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Ne():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Sl{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Sl(e,t,ul.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Mc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hN{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class fN{constructor(){this.queries=__(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=Pe(t),i=s.queries;s.queries=__(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new pe(Q.ABORTED,"Firestore shutting down"))}}function __(){return new ci(n=>vI(n),Mc)}async function qg(n,e){const t=Pe(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new hN,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=zl(o,`Initialization of query '${Ya(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Hg(t)}async function zg(n,e){const t=Pe(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function pN(n,e){const t=Pe(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&Hg(t)}function mN(n,e,t){const r=Pe(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function Hg(n){n.Y_.forEach(e=>{e.next()})}var _m,b_;(b_=_m||(_m={})).ea="default",b_.Cache="cache";class Kg{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Sl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Sl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==_m.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gN{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w_{constructor(e){this.serializer=e}Es(e){return As(this.serializer,e)}ds(e){return e.metadata.exists?BI(this.serializer,e.document,!1):Jt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Tn(e)}}class vN{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=IE(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=wt.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new w_(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||at()).add(i);t.set(o,a)}}return t}async complete(){const e=await HD(this.localStore,new w_(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await KD(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function IE(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EE{constructor(e){this.key=e}}class TE{constructor(e){this.key=e}}class AE{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=at(),this.mutatedKeys=at(),this.Aa=_I(e),this.Ra=new ul(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new y_,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const m=s.get(h),v=Lc(this.query,f)?f:null,w=!!m&&this.mutatedKeys.has(m.key),E=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let A=!1;m&&v?m.data.isEqual(v.data)?w!==E&&(r.track({type:3,doc:v}),A=!0):this.ga(m,v)||(r.track({type:2,doc:v}),A=!0,(l&&this.Aa(v,l)>0||c&&this.Aa(v,c)<0)&&(a=!0)):!m&&v?(r.track({type:0,doc:v}),A=!0):m&&!v&&(r.track({type:1,doc:m}),A=!0,(l||c)&&(a=!0)),A&&(v?(o=o.add(v),i=E?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((h,f)=>function(v,w){const E=A=>{switch(A){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ne()}};return E(v)-E(w)}(h.type,f.type)||this.Aa(h.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new Sl(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new y_,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=at(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new TE(r))}),this.da.forEach(r=>{e.has(r)||t.push(new EE(r))}),t}ba(e){this.Ta=e.Ts,this.da=at();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Sl.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class yN{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class _N{constructor(e){this.key=e,this.va=!1}}class bN{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new ci(a=>vI(a),Mc),this.Ma=new Map,this.xa=new Set,this.Oa=new Kt(ke.comparator),this.Na=new Map,this.La=new Dg,this.Ba={},this.ka=new Map,this.qa=da.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function wN(n,e,t=!0){const r=hf(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await SE(r,e,t,!0),s}async function xN(n,e){const t=hf(n);await SE(t,e,!0,!1)}async function SE(n,e,t,r){const s=await El(n.localStore,ur(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await Gg(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&df(n.remoteStore,s),a}async function Gg(n,e,t,r,s){n.Ka=(f,m,v)=>async function(E,A,F,U){let $=A.view.ma(F);$.ns&&($=await Ih(E.localStore,A.query,!1).then(({documents:T})=>A.view.ma(T,$)));const L=U&&U.targetChanges.get(A.targetId),se=U&&U.targetMismatches.get(A.targetId)!=null,te=A.view.applyChanges($,E.isPrimaryClient,L,se);return bm(E,A.targetId,te.wa),te.snapshot}(n,f,m,v);const i=await Ih(n.localStore,e,!0),o=new AE(e,i.Ts),a=o.ma(i.documents),l=Uc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);bm(n,t,c.wa);const h=new yN(e,t,o);return n.Fa.set(e,h),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function IN(n,e,t){const r=Pe(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Mc(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Tl(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Al(r.remoteStore,s.targetId),Pl(r,s.targetId)}).catch(po)):(Pl(r,s.targetId),await Tl(r.localStore,s.targetId,!0))}async function EN(n,e){const t=Pe(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Al(t.remoteStore,r.targetId))}async function TN(n,e,t){const r=Yg(n);try{const s=await function(o,a){const l=Pe(o),c=ln.now(),h=a.reduce((v,w)=>v.add(w.key),at());let f,m;return l.persistence.runTransaction("Locally write mutations","readwrite",v=>{let w=Ar(),E=at();return l.cs.getEntries(v,h).next(A=>{w=A,w.forEach((F,U)=>{U.isValidDocument()||(E=E.add(F))})}).next(()=>l.localDocuments.getOverlayedDocuments(v,w)).next(A=>{f=A;const F=[];for(const U of a){const $=Y2(U,f.get(U.key).overlayedDocument);$!=null&&F.push(new di(U.key,$,oI($.value.mapValue),rn.exists(!0)))}return l.mutationQueue.addMutationBatch(v,c,F,a)}).next(A=>{m=A;const F=A.applyToLocalDocumentSet(f,E);return l.documentOverlayCache.saveOverlays(v,A.batchId,F)})}).then(()=>({batchId:m.batchId,changes:wI(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new Kt(et)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await hi(r,s.changes),await Bl(r.remoteStore)}catch(s){const i=zl(s,"Failed to persist write");t.reject(i)}}async function PE(n,e){const t=Pe(n);try{const r=await qD(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Le(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Le(o.va):s.removedDocuments.size>0&&(Le(o.va),o.va=!1))}),await hi(t,r,e)}catch(r){await po(r)}}function x_(n,e,t){const r=Pe(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Pe(o);l.onlineState=a;let c=!1;l.queries.forEach((h,f)=>{for(const m of f.j_)m.Z_(a)&&(c=!0)}),c&&Hg(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function AN(n,e,t){const r=Pe(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Kt(ke.comparator);o=o.insert(i,Jt.newNoDocument(i,Be.min()));const a=at().add(i),l=new Fc(Be.min(),new Map,new Kt(et),o,a);await PE(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),Jg(r)}else await Tl(r.localStore,e,!1).then(()=>Pl(r,e,t)).catch(po)}async function SN(n,e){const t=Pe(n),r=e.batch.batchId;try{const s=await BD(t.localStore,e);Qg(t,r,null),Wg(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await hi(t,s)}catch(s){await po(s)}}async function PN(n,e,t){const r=Pe(n);try{const s=await function(o,a){const l=Pe(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let h;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(Le(f!==null),h=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,h)).next(()=>l.localDocuments.getDocuments(c,h))})}(r.localStore,e);Qg(r,e,t),Wg(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await hi(r,s)}catch(s){await po(s)}}async function RN(n,e){const t=Pe(n);vo(t.remoteStore)||fe("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=Pe(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=zl(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function Wg(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function Qg(n,e,t){const r=Pe(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Pl(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||RE(n,r)})}function RE(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Al(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Jg(n))}function bm(n,e,t){for(const r of t)r instanceof EE?(n.La.addReference(r.key,e),CN(n,r)):r instanceof TE?(fe("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||RE(n,r.key)):Ne()}function CN(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(fe("SyncEngine","New document in limbo: "+t),n.xa.add(r),Jg(n))}function Jg(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new ke(wt.fromString(e)),r=n.qa.next();n.Na.set(r,new _N(t)),n.Oa=n.Oa.insert(t,r),df(n.remoteStore,new Bs(ur($l(t.path)),r,"TargetPurposeLimboResolution",Er.oe))}}async function hi(n,e,t){const r=Pe(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var h;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=Mg.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const h=Pe(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>z.forEach(c,m=>z.forEach(m.$i,v=>h.persistence.referenceDelegate.addReference(f,m.targetId,v)).next(()=>z.forEach(m.Ui,v=>h.persistence.referenceDelegate.removeReference(f,m.targetId,v)))))}catch(f){if(!mo(f))throw f;fe("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const m=f.targetId;if(!f.fromCache){const v=h.os.get(m),w=v.snapshotVersion,E=v.withLastLimboFreeSnapshotVersion(w);h.os=h.os.insert(m,E)}}}(r.localStore,i))}async function kN(n,e){const t=Pe(n);if(!t.currentUser.isEqual(e)){fe("SyncEngine","User change. New user:",e.toKey());const r=await uE(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new pe(Q.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await hi(t,r.hs)}}function DN(n,e){const t=Pe(n),r=t.Na.get(e);if(r&&r.va)return at().add(r.key);{let s=at();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function NN(n,e){const t=Pe(n),r=await Ih(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&bm(t,e.targetId,s.wa),s}async function ON(n,e){const t=Pe(n);return fE(t.localStore,e).then(r=>hi(t,r))}async function VN(n,e,t,r){const s=Pe(n),i=await function(a,l){const c=Pe(a),h=Pe(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.Mn(f,l).next(m=>m?c.localDocuments.getDocuments(f,m):z.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Bl(s.remoteStore):t==="acknowledged"||t==="rejected"?(Qg(s,e,r||null),Wg(s,e),function(a,l){Pe(Pe(a).mutationQueue).On(l)}(s.localStore,e)):Ne(),await hi(s,i)):fe("SyncEngine","Cannot apply mutation batch with id: "+e)}async function MN(n,e){const t=Pe(n);if(hf(t),Yg(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await I_(t,r.toArray());t.Qa=!0,await ym(t.remoteStore,!0);for(const i of s)df(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Pl(t,o),Tl(t.localStore,o,!0))),Al(t.remoteStore,o)}),await s,await I_(t,r),function(o){const a=Pe(o);a.Na.forEach((l,c)=>{Al(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Kt(ke.comparator)}(t),t.Qa=!1,await ym(t.remoteStore,!1)}}async function I_(n,e,t){const r=Pe(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await El(r.localStore,ur(l[0]));for(const c of l){const h=r.Fa.get(c),f=await NN(r,h);f.snapshot&&i.push(f.snapshot)}}else{const c=await hE(r.localStore,o);a=await El(r.localStore,c),await Gg(r,CE(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function CE(n){return pI(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function LN(n){return function(t){return Pe(Pe(t).persistence).Qi()}(Pe(n).localStore)}async function $N(n,e,t,r){const s=Pe(n);if(s.Qa)return void fe("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await fE(s.localStore,yI(i[0])),a=Fc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",pn.EMPTY_BYTE_STRING);await hi(s,o,a);break}case"rejected":await Tl(s.localStore,e,!0),Pl(s,e,r);break;default:Ne()}}async function FN(n,e,t){const r=hf(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){fe("SyncEngine","Adding an already active target "+s);continue}const i=await hE(r.localStore,s),o=await El(r.localStore,i);await Gg(r,CE(i),o.targetId,!1,o.resumeToken),df(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await Tl(r.localStore,s,!1).then(()=>{Al(r.remoteStore,s),Pl(r,s)}).catch(po)}}function hf(n){const e=Pe(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=PE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=DN.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=AN.bind(null,e),e.Ca.d_=pN.bind(null,e.eventManager),e.Ca.$a=mN.bind(null,e.eventManager),e}function Yg(n){const e=Pe(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=SN.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=PN.bind(null,e),e}function UN(n,e,t){const r=Pe(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(v,w){const E=Pe(v),A=Tn(w.createTime);return E.persistence.runTransaction("hasNewerBundle","readonly",F=>E.Gr.getBundleMetadata(F,w.id)).then(F=>!!F&&F.createTime.compareTo(A)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(v){return{taskState:"Success",documentsLoaded:v.totalDocuments,bytesLoaded:v.totalBytes,totalDocuments:v.totalDocuments,totalBytes:v.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(IE(l));const c=new vN(l,i.localStore,o.serializer);let h=await o.Ua();for(;h;){const m=await c.la(h);m&&a._updateProgress(m),h=await o.Ua()}const f=await c.complete();return await hi(i,f.Ia,void 0),await function(v,w){const E=Pe(v);return E.persistence.runTransaction("Save bundle","readwrite",A=>E.Gr.saveBundleMetadata(A,w))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return Qr("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class uo{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=jc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return lE(this.persistence,new aE,e.initialUser,this.serializer)}Ga(e){return new Ng(cf.Zr,this.serializer)}Wa(e){return new mE}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}uo.provider={build:()=>new uo};class jN extends uo{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Le(this.persistence.referenceDelegate instanceof xh);const r=this.persistence.referenceDelegate.garbageCollector;return new nE(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?sr.withCacheSize(this.cacheSizeBytes):sr.DEFAULT;return new Ng(r=>xh.Zr(r,t),this.serializer)}}class Xg extends uo{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await Yg(this.Ja.syncEngine),await Bl(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return lE(this.persistence,new aE,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new nE(r,e.asyncQueue,t)}Ha(e,t){const r=new u2(t,this.persistence);return new l2(e.asyncQueue,r)}Ga(e){const t=Vg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?sr.withCacheSize(this.cacheSizeBytes):sr.DEFAULT;return new Og(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,gE(),Jd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new mE}}class kE extends Xg{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Ep&&(this.sharedClientState.syncEngine={no:VN.bind(null,t),ro:$N.bind(null,t),io:FN.bind(null,t),Qi:LN.bind(null,t),eo:ON.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await MN(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=gE();if(!Ep.D(t))throw new pe(Q.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Vg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ep(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class co{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>x_(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=kN.bind(null,this.syncEngine),await ym(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new fN}()}createDatastore(e){const t=jc(e.databaseInfo.databaseId),r=function(i){return new JD(i)}(e.databaseInfo);return function(i,o,a,l){return new ZD(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new tN(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>x_(this.syncEngine,t,0),function(){return g_.D()?new g_:new GD}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,h){const f=new bN(s,i,o,a,l,c);return h&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Pe(s);fe("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await jl(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}co.provider={build:()=>new co};function E_(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ff{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):xn("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BN{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new qn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new gN(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qN{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new pe(Q.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=Pe(s),a={documents:i.map(f=>gc(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,wt.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const m=oD(o.serializer,f);c.set(m.key.toString(),m)});const h=[];return i.forEach(f=>{const m=c.get(f.toString());Le(!!m),h.push(m)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ul(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=ke.fromPath(r);this.mutations.push(new Ig(s,this.precondition(s)))}),await async function(r,s){const i=Pe(r),o={writes:s.map(a=>vc(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,wt.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Ne();t=Be.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new pe(Q.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Be.min())?rn.exists(!1):rn.updateTime(t):rn.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Be.min()))throw new pe(Q.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return rn.updateTime(t)}return rn.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zN{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new $g(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new qN(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!Oc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!DI(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HN{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Un.UNAUTHENTICATED,this.clientId=qx.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{fe("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(fe("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new qn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=zl(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Ap(n,e){n.asyncQueue.verifyOperationInProgress(),fe("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await uE(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function T_(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Zg(n);fe("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>v_(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>v_(e.remoteStore,s)),n._onlineComponents=e}async function Zg(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){fe("FirestoreClient","Using user provided OfflineComponentProvider");try{await Ap(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===Q.FAILED_PRECONDITION||s.code===Q.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Qr("Error using user provided cache. Falling back to memory cache: "+t),await Ap(n,new uo)}}else fe("FirestoreClient","Using default OfflineComponentProvider"),await Ap(n,new uo);return n._offlineComponents}async function pf(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(fe("FirestoreClient","Using user provided OnlineComponentProvider"),await T_(n,n._uninitializedComponentsProvider._online)):(fe("FirestoreClient","Using default OnlineComponentProvider"),await T_(n,new co))),n._onlineComponents}function DE(n){return Zg(n).then(e=>e.persistence)}function Hl(n){return Zg(n).then(e=>e.localStore)}function NE(n){return pf(n).then(e=>e.remoteStore)}function ev(n){return pf(n).then(e=>e.syncEngine)}function OE(n){return pf(n).then(e=>e.datastore)}async function Rl(n){const e=await pf(n),t=e.eventManager;return t.onListen=wN.bind(null,e.syncEngine),t.onUnlisten=IN.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=xN.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=EN.bind(null,e.syncEngine),t}function KN(n){return n.asyncQueue.enqueue(async()=>{const e=await DE(n),t=await NE(n);return e.setNetworkEnabled(!0),function(s){const i=Pe(s);return i.L_.delete(0),Bc(i)}(t)})}function GN(n){return n.asyncQueue.enqueue(async()=>{const e=await DE(n),t=await NE(n);return e.setNetworkEnabled(!1),async function(s){const i=Pe(s);i.L_.add(0),await jl(i),i.q_.set("Offline")}(t)})}function WN(n,e){const t=new qn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,h){const f=Pe(c);return f.persistence.runTransaction("read document","readonly",m=>f.localDocuments.getDocument(m,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new pe(Q.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=zl(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Hl(n),e,t)),t.promise}function VE(n,e,t={}){const r=new qn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const h=new ff({next:m=>{h.Za(),o.enqueueAndForget(()=>zg(i,f));const v=m.docs.has(a);!v&&m.fromCache?c.reject(new pe(Q.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&m.fromCache&&l&&l.source==="server"?c.reject(new pe(Q.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(m)},error:m=>c.reject(m)}),f=new Kg($l(a.path),h,{includeMetadataChanges:!0,_a:!0});return qg(i,f)}(await Rl(n),n.asyncQueue,e,t,r)),r.promise}function QN(n,e){const t=new qn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await Ih(s,i,!0),l=new AE(i,a.Ts),c=l.ma(a.documents),h=l.applyChanges(c,!1);o.resolve(h.snapshot)}catch(a){const l=zl(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Hl(n),e,t)),t.promise}function ME(n,e,t={}){const r=new qn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const h=new ff({next:m=>{h.Za(),o.enqueueAndForget(()=>zg(i,f)),m.fromCache&&l.source==="server"?c.reject(new pe(Q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(m)},error:m=>c.reject(m)}),f=new Kg(a,h,{includeMetadataChanges:!0,_a:!0});return qg(i,f)}(await Rl(n),n.asyncQueue,e,t,r)),r.promise}function JN(n,e,t){const r=new qn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await OE(n);r.resolve(async function(o,a,l){var c;const h=Pe(o),{request:f,ut:m,parent:v}=zI(h.serializer,mI(a),l);h.connection.Fo||delete f.parent;const w=(await h.Lo("RunAggregationQuery",h.serializer.databaseId,v,f,1)).filter(A=>!!A.result);Le(w.length===1);const E=(c=w[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(E).reduce((A,F)=>(A[m[F]]=E[F],A),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function YN(n,e){const t=new ff(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){Pe(s).Y_.add(i),i.next()}(await Rl(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){Pe(s).Y_.delete(i)}(await Rl(n),t))}}function XN(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?OI().encode(o):o,function(h,f){return new BN(h,f)}(function(h,f){if(h instanceof Uint8Array)return E_(h,f);if(h instanceof ArrayBuffer)return E_(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,jc(e));n.asyncQueue.enqueueAndForget(async()=>{UN(await ev(n),s,r)})}function ZN(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=Pe(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await Hl(n),e))}function eO(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=Pe(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,m,v,w,E){f=[...f],m=[...m],f.sort(v),m.sort(v);const A=f.length,F=m.length;let U=0,$=0;for(;U<F&&$<A;){const L=v(f[$],m[U]);L<0?E(f[$++]):L>0?w(m[U++]):(U++,$++)}for(;U<F;)w(m[U++]);for(;$<A;)E(f[$++])}(c,s,s2,h=>{a.push(o.addFieldIndex(l,h))},h=>{a.push(o.deleteFieldIndex(l,h))})).next(()=>z.waitFor(a)))}(await Hl(n),e))}function tO(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){Pe(r).ss.zi=s}(await Hl(n),e))}function nO(n){return n.asyncQueue.enqueue(async()=>function(t){const r=Pe(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Hl(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LE(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A_=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tv(n,e,t){if(!t)throw new pe(Q.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function rO(n,e,t,r){if(e===!0&&r===!0)throw new pe(Q.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function S_(n){if(!ke.isDocumentKey(n))throw new pe(Q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function P_(n){if(ke.isDocumentKey(n))throw new pe(Q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function mf(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ne()}function gt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new pe(Q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=mf(n);throw new pe(Q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function $E(n,e){if(e<=0)throw new pe(Q.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R_{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new pe(Q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new pe(Q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}rO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=LE((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new pe(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new pe(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new pe(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class qc{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new R_({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new pe(Q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new pe(Q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new R_(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Jk;switch(r.type){case"firstParty":return new e2(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new pe(Q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=A_.get(t);r&&(fe("ComponentProvider","Removing Datastore"),A_.delete(t),r.terminate())}(this),Promise.resolve()}}function sO(n,e,t,r={}){var s;const i=(n=gt(n,qc))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Qr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=Un.MOCK_USER;else{a=tx(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new pe(Q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Un(c)}n._authCredentials=new Yk(new jx(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Xn(this.firestore,e,this._query)}}class An{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ss(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new An(this.firestore,e,this._key)}}class Ss extends Xn{constructor(e,t,r){super(e,t,$l(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new An(this.firestore,null,new ke(e))}withConverter(e){return new Ss(this.firestore,e,this._path)}}function st(n,e,...t){if(n=Me(n),tv("collection","path",e),n instanceof qc){const r=wt.fromString(e,...t);return P_(r),new Ss(n,null,r)}{if(!(n instanceof An||n instanceof Ss))throw new pe(Q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(wt.fromString(e,...t));return P_(r),new Ss(n.firestore,null,r)}}function OH(n,e){if(n=gt(n,qc),tv("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new pe(Q.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Xn(n,null,function(r){return new ui(wt.emptyPath(),r)}(e))}function Se(n,e,...t){if(n=Me(n),arguments.length===1&&(e=qx.newId()),tv("doc","path",e),n instanceof qc){const r=wt.fromString(e,...t);return S_(r),new An(n,null,new ke(r))}{if(!(n instanceof An||n instanceof Ss))throw new pe(Q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(wt.fromString(e,...t));return S_(r),new An(n.firestore,n instanceof Ss?n.converter:null,new ke(r))}}function VH(n,e){return n=Me(n),e=Me(e),(n instanceof An||n instanceof Ss)&&(e instanceof An||e instanceof Ss)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function FE(n,e){return n=Me(n),e=Me(e),n instanceof Xn&&e instanceof Xn&&n.firestore===e.firestore&&Mc(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C_{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new $g(this,"async_queue_retry"),this.Vu=()=>{const r=Jd();r&&fe("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Jd();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Jd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new qn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!mo(e))throw e;fe("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw xn("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Bg.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&Ne()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function wm(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class iO{constructor(){this._progressObserver={},this._taskCompletionResolver=new qn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MH=-1;class Bt extends qc{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new C_,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new C_(e),this._firestoreClient=void 0,await e}}}function LH(n,e,t){t||(t="(default)");const r=li(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(ro(i,e))return s;throw new pe(Q.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new pe(Q.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new pe(Q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function oO(n,e){const t=typeof n=="object"?n:Yh(),r=typeof n=="string"?n:e||"(default)",s=li(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=Xw("firestore");i&&sO(s,...i)}return s}function un(n){if(n._terminated)throw new pe(Q.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||UE(n),n._firestoreClient}function UE(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,h){return new C2(a,l,c,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,LE(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new HN(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function aO(n,e){Qr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return jE(n,co.provider,{build:r=>new Xg(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function $H(n){Qr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();jE(n,co.provider,{build:t=>new kE(t,e.cacheSizeBytes)})}function jE(n,e,t){if((n=gt(n,Bt))._firestoreClient||n._terminated)throw new pe(Q.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new pe(Q.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},UE(n)}function FH(n){if(n._initialized&&!n._terminated)throw new pe(Q.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new qn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Ts.D())return Promise.resolve();const s=r+"main";await Ts.delete(s)}(Vg(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function UH(n){return function(t){const r=new qn;return t.asyncQueue.enqueueAndForget(async()=>RN(await ev(t),r)),r.promise}(un(n=gt(n,Bt)))}function jH(n){return KN(un(n=gt(n,Bt)))}function BH(n){return GN(un(n=gt(n,Bt)))}function qH(n){return fC(n.app,"firestore",n._databaseId.database),n._delete()}function zH(n,e){const t=un(n=gt(n,Bt)),r=new iO;return XN(t,n._databaseId,e,r),r}function HH(n,e){return ZN(un(n=gt(n,Bt)),e).then(t=>t?new Xn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yc{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class lO{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ha(pn.fromBase64String(e))}catch(t){throw new pe(Q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ha(pn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new pe(Q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new nn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function KH(){return new va("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ya{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nv{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new pe(Q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new pe(Q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return et(this._lat,e._lat)||et(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gf{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uO=/^__.*__$/;class cO{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new di(e,this.data,this.fieldMask,t,this.fieldTransforms):new Fl(e,this.data,t,this.fieldTransforms)}}class BE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new di(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function qE(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ne()}}class vf{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new vf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Sh(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(qE(this.Cu)&&uO.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class dO{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||jc(e)}Qu(e,t,r,s=!1){return new vf({Cu:e,methodName:t,qu:r,path:nn.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function _a(n){const e=n._freezeSettings(),t=jc(n._databaseId);return new dO(n._databaseId,!!e.ignoreUndefinedProperties,t)}function yf(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);uv("Data must be an object, but it was:",o,r);const a=KE(r,o);let l,c;if(i.merge)l=new Tr(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const m=_c(e,f,t);if(!o.contains(m))throw new pe(Q.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);WE(h,m)||h.push(m)}l=new Tr(h),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new cO(new Yn(a),l,c)}class zc extends ya{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof zc}}function zE(n,e,t){return new vf({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class rv extends ya{_toFieldTransform(e){return new $c(e.path,new wl)}isEqual(e){return e instanceof rv}}class sv extends ya{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=zE(this,e,!0),r=this.Ku.map(i=>ba(i,t)),s=new aa(r);return new $c(e.path,s)}isEqual(e){return e instanceof sv&&ro(this.Ku,e.Ku)}}class iv extends ya{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=zE(this,e,!0),r=this.Ku.map(i=>ba(i,t)),s=new la(r);return new $c(e.path,s)}isEqual(e){return e instanceof iv&&ro(this.Ku,e.Ku)}}class ov extends ya{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new xl(e.serializer,EI(e.serializer,this.$u));return new $c(e.path,t)}isEqual(e){return e instanceof ov&&this.$u===e.$u}}function av(n,e,t,r){const s=n.Qu(1,e,t);uv("Data must be an object, but it was:",s,r);const i=[],o=Yn.empty();go(r,(l,c)=>{const h=_f(e,l,t);c=Me(c);const f=s.Nu(h);if(c instanceof zc)i.push(h);else{const m=ba(c,f);m!=null&&(i.push(h),o.set(h,m))}});const a=new Tr(i);return new BE(o,a,s.fieldTransforms)}function lv(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[_c(e,r,t)],l=[s];if(i.length%2!=0)throw new pe(Q.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)a.push(_c(e,i[m])),l.push(i[m+1]);const c=[],h=Yn.empty();for(let m=a.length-1;m>=0;--m)if(!WE(c,a[m])){const v=a[m];let w=l[m];w=Me(w);const E=o.Nu(v);if(w instanceof zc)c.push(v);else{const A=ba(w,E);A!=null&&(c.push(v),h.set(v,A))}}const f=new Tr(c);return new BE(h,f,o.fieldTransforms)}function HE(n,e,t,r=!1){return ba(t,n.Qu(r?4:3,e))}function ba(n,e){if(GE(n=Me(n)))return uv("Unsupported field value:",e,n),KE(n,e);if(n instanceof ya)return function(r,s){if(!qE(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=ba(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Me(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return EI(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=ln.fromDate(r);return{timestampValue:Il(s.serializer,i)}}if(r instanceof ln){const i=new ln(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Il(s.serializer,i)}}if(r instanceof nv)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ha)return{bytesValue:LI(s.serializer,r._byteString)};if(r instanceof An){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Pg(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof gf)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return xg(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${mf(r)}`)}(n,e)}function KE(n,e){const t={};return nI(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):go(n,(r,s)=>{const i=ba(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function GE(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ln||n instanceof nv||n instanceof ha||n instanceof An||n instanceof ya||n instanceof gf)}function uv(n,e,t){if(!GE(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=mf(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function _c(n,e,t){if((e=Me(e))instanceof va)return e._internalPath;if(typeof e=="string")return _f(n,e);throw Sh("Field path arguments must be of type string or ",n,!1,void 0,t)}const hO=new RegExp("[~\\*/\\[\\]]");function _f(n,e,t){if(e.search(hO)>=0)throw Sh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new va(...e.split("."))._internalPath}catch{throw Sh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Sh(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new pe(Q.INVALID_ARGUMENT,a+n+l)}function WE(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bc{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new An(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new fO(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(bf("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class fO extends bc{data(){return super.data()}}function bf(n,e){return typeof e=="string"?_f(n,e):e instanceof va?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QE(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new pe(Q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class cv{}class Hc extends cv{}function wc(n,e,...t){let r=[];e instanceof cv&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Kl).length,a=i.filter(l=>l instanceof Kc).length;if(o>1||o>0&&a>0)throw new pe(Q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Kc extends Hc{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Kc(e,t,r)}_apply(e){const t=this._parse(e);return YE(e._query,t),new Xn(e.firestore,e.converter,um(e._query,t))}_parse(e){const t=_a(e.firestore);return function(i,o,a,l,c,h,f){let m;if(c.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new pe(Q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){D_(f,h);const v=[];for(const w of f)v.push(k_(l,i,w));m={arrayValue:{values:v}}}else m=k_(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||D_(f,h),m=HE(a,o,f,h==="in"||h==="not-in");return xt.create(c,h,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Ph(n,e,t){const r=e,s=bf("where",n);return Kc._create(s,r,t)}class Kl extends cv{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Kl(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Lt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)YE(o,l),o=um(o,l)}(e._query,t),new Xn(e.firestore,e.converter,um(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function GH(...n){return n.forEach(e=>XE("or",e)),Kl._create("or",n)}function WH(...n){return n.forEach(e=>XE("and",e)),Kl._create("and",n)}class dv extends Hc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new dv(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new pe(Q.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new pe(Q.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new mc(i,o)}(e._query,this._field,this._direction);return new Xn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new ui(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function pO(n,e="asc"){const t=e,r=bf("orderBy",n);return dv._create(r,t)}class wf extends Hc{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new wf(e,t,r)}_apply(e){return new Xn(e.firestore,e.converter,vh(e._query,this._limit,this._limitType))}}function QH(n){return $E("limit",n),wf._create("limit",n,"F")}function JH(n){return $E("limitToLast",n),wf._create("limitToLast",n,"L")}class xf extends Hc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new xf(e,t,r)}_apply(e){const t=JE(e,this.type,this._docOrFields,this._inclusive);return new Xn(e.firestore,e.converter,function(s,i){return new ui(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function YH(...n){return xf._create("startAt",n,!0)}function XH(...n){return xf._create("startAfter",n,!1)}class If extends Hc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new If(e,t,r)}_apply(e){const t=JE(e,this.type,this._docOrFields,this._inclusive);return new Xn(e.firestore,e.converter,function(s,i){return new ui(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function ZH(...n){return If._create("endBefore",n,!1)}function eK(...n){return If._create("endAt",n,!0)}function JE(n,e,t,r){if(t[0]=Me(t[0]),t[0]instanceof bc)return function(i,o,a,l,c){if(!l)throw new pe(Q.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of ll(i))if(f.field.isKeyField())h.push(ia(o,l.key));else{const m=l.data.field(f.field);if(tf(m))throw new pe(Q.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){const v=f.field.canonicalString();throw new pe(Q.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${v}' (used as the orderBy) does not exist.`)}h.push(m)}return new ao(h,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=_a(n.firestore);return function(o,a,l,c,h,f){const m=o.explicitOrderBy;if(h.length>m.length)throw new pe(Q.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const v=[];for(let w=0;w<h.length;w++){const E=h[w];if(m[w].field.isKeyField()){if(typeof E!="string")throw new pe(Q.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof E}`);if(!bg(o)&&E.indexOf("/")!==-1)throw new pe(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${E}' contains a slash.`);const A=o.path.child(wt.fromString(E));if(!ke.isDocumentKey(A))throw new pe(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${A}' is not because it contains an odd number of segments.`);const F=new ke(A);v.push(ia(a,F))}else{const A=HE(l,c,E);v.push(A)}}return new ao(v,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function k_(n,e,t){if(typeof(t=Me(t))=="string"){if(t==="")throw new pe(Q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!bg(e)&&t.indexOf("/")!==-1)throw new pe(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(wt.fromString(t));if(!ke.isDocumentKey(r))throw new pe(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ia(n,new ke(r))}if(t instanceof An)return ia(n,t._key);throw new pe(Q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${mf(t)}.`)}function D_(n,e){if(!Array.isArray(n)||n.length===0)throw new pe(Q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function YE(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new pe(Q.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new pe(Q.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function XE(n,e){if(!(e instanceof Kc||e instanceof Kl))throw new pe(Q.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class ZE{convertValue(e,t="none"){switch(io(e)){case 0:return null;case 1:return e.booleanValue;case 2:return tn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ni(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ne()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return go(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>tn(o.doubleValue));return new gf(i)}convertGeoPoint(e){return new nv(tn(e.latitude),tn(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=nf(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(hc(e));default:return null}}convertTimestamp(e){const t=ti(e);return new ln(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=wt.fromString(e);Le(WI(r));const s=new sa(r.get(1),r.get(3)),i=new ke(r.popFirst(5));return s.isEqual(t)||xn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ef(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class mO extends ZE{constructor(e){super(),this.firestore=e}convertBytes(e){return new ha(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new An(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tK(n){return new yc("sum",_c("sum",n))}function nK(n){return new yc("avg",_c("average",n))}function gO(){return new yc("count")}function rK(n,e){var t,r;return n instanceof yc&&e instanceof yc&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function sK(n,e){return FE(n.query,e.query)&&ro(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Cl extends bc{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Yd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(bf("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Yd extends Cl{data(e={}){return super.data(e)}}class kl{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Wo(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Yd(this._firestore,this._userDataWriter,r.key,r,new Wo(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new pe(Q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Yd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Wo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Yd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Wo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,h=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:vO(a.type),doc:l,oldIndex:c,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function vO(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ne()}}function iK(n,e){return n instanceof Cl&&e instanceof Cl?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof kl&&e instanceof kl&&n._firestore===e._firestore&&FE(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gt(n){n=gt(n,An);const e=gt(n.firestore,Bt);return VE(un(e),n._key).then(t=>hv(e,n,t))}class yo extends ZE{constructor(e){super(),this.firestore=e}convertBytes(e){return new ha(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new An(this.firestore,null,t)}}function oK(n){n=gt(n,An);const e=gt(n.firestore,Bt),t=un(e),r=new yo(e);return WN(t,n._key).then(s=>new Cl(e,r,n._key,s,new Wo(s!==null&&s.hasLocalMutations,!0),n.converter))}function aK(n){n=gt(n,An);const e=gt(n.firestore,Bt);return VE(un(e),n._key,{source:"server"}).then(t=>hv(e,n,t))}function Vt(n){n=gt(n,Xn);const e=gt(n.firestore,Bt),t=un(e),r=new yo(e);return QE(n._query),ME(t,n._query).then(s=>new kl(e,r,n,s))}function lK(n){n=gt(n,Xn);const e=gt(n.firestore,Bt),t=un(e),r=new yo(e);return QN(t,n._query).then(s=>new kl(e,r,n,s))}function uK(n){n=gt(n,Xn);const e=gt(n.firestore,Bt),t=un(e),r=new yo(e);return ME(t,n._query,{source:"server"}).then(s=>new kl(e,r,n,s))}function hn(n,e,t){n=gt(n,An);const r=gt(n.firestore,Bt),s=Ef(n.converter,e,t);return Gc(r,[yf(_a(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,rn.none())])}function wa(n,e,t,...r){n=gt(n,An);const s=gt(n.firestore,Bt),i=_a(s);let o;return o=typeof(e=Me(e))=="string"||e instanceof va?lv(i,"updateDoc",n._key,e,t,r):av(i,"updateDoc",n._key,e),Gc(s,[o.toMutation(n._key,rn.exists(!0))])}function Dl(n){return Gc(gt(n.firestore,Bt),[new Ul(n._key,rn.none())])}function Gl(n,e){const t=gt(n.firestore,Bt),r=Se(n),s=Ef(n.converter,e);return Gc(t,[yf(_a(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,rn.exists(!1))]).then(()=>r)}function cK(n,...e){var t,r,s;n=Me(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||wm(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(wm(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,h;if(n instanceof An)c=gt(n.firestore,Bt),h=$l(n._key.path),l={next:f=>{e[o]&&e[o](hv(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=gt(n,Xn);c=gt(f.firestore,Bt),h=f._query;const m=new yo(c);l={next:v=>{e[o]&&e[o](new kl(c,m,f,v))},error:e[o+1],complete:e[o+2]},QE(n._query)}return function(m,v,w,E){const A=new ff(E),F=new Kg(v,A,w);return m.asyncQueue.enqueueAndForget(async()=>qg(await Rl(m),F)),()=>{A.Za(),m.asyncQueue.enqueueAndForget(async()=>zg(await Rl(m),F))}}(un(c),h,a,l)}function dK(n,e){return YN(un(n=gt(n,Bt)),wm(e)?e:{next:e})}function Gc(n,e){return function(r,s){const i=new qn;return r.asyncQueue.enqueueAndForget(async()=>TN(await ev(r),s,i)),i.promise}(un(n),e)}function hv(n,e,t){const r=t.docs.get(e._key),s=new yo(n);return new Cl(n,s,e._key,r,new Wo(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hK(n){return yO(n,{count:gO()})}function yO(n,e){const t=gt(n.firestore,Bt),r=un(t),s=tI(e,(i,o)=>new kI(o,i.aggregateType,i._internalFieldPath));return JN(r,n._query,s).then(i=>function(a,l,c){const h=new yo(a);return new lO(l,h,c)}(t,n,i))}class _O{constructor(e){this.kind="memory",this._onlineComponentProvider=co.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=uo.provider}toJSON(){return{kind:this.kind}}}class bO{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=TO(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class wO{constructor(){this.kind="memoryEager",this._offlineComponentProvider=uo.provider}toJSON(){return{kind:this.kind}}}class xO{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new jN(e)}}toJSON(){return{kind:this.kind}}}function fK(){return new wO}function pK(n){return new xO(n==null?void 0:n.cacheSizeBytes)}function mK(n){return new _O(n)}function gK(n){return new bO(n)}class IO{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=co.provider,this._offlineComponentProvider={build:t=>new Xg(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class EO{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=co.provider,this._offlineComponentProvider={build:t=>new kE(t,e==null?void 0:e.cacheSizeBytes)}}}function TO(n){return new IO(n==null?void 0:n.forceOwnership)}function vK(){return new EO}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AO={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SO{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=_a(e)}set(e,t,r){this._verifyNotCommitted();const s=ji(e,this._firestore),i=Ef(s.converter,t,r),o=yf(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,rn.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=ji(e,this._firestore);let o;return o=typeof(t=Me(t))=="string"||t instanceof va?lv(this._dataReader,"WriteBatch.update",i._key,t,r,s):av(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,rn.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ji(e,this._firestore);return this._mutations=this._mutations.concat(new Ul(t._key,rn.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new pe(Q.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ji(n,e){if((n=Me(n)).firestore!==e)throw new pe(Q.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PO extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=_a(t)}get(t){const r=ji(t,this._firestore),s=new mO(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return Ne();const o=i[0];if(o.isFoundDocument())return new bc(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new bc(this._firestore,s,r._key,null,r.converter);throw Ne()})}set(t,r,s){const i=ji(t,this._firestore),o=Ef(i.converter,r,s),a=yf(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=ji(t,this._firestore);let a;return a=typeof(r=Me(r))=="string"||r instanceof va?lv(this._dataReader,"Transaction.update",o._key,r,s,i):av(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=ji(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ji(e,this._firestore),r=new yo(this._firestore);return super.get(e).then(s=>new Cl(this._firestore,r,t._key,s._document,new Wo(!1,!1),t.converter))}}function _K(n,e,t){n=gt(n,Bt);const r=Object.assign(Object.assign({},AO),t);return function(i){if(i.maxAttempts<1)throw new pe(Q.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new qn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await OE(i);new zN(i.asyncQueue,c,a,o,l).au()}),l.promise}(un(n),s=>e(new PO(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bK(){return new zc("deleteField")}function ri(){return new rv("serverTimestamp")}function RO(...n){return new sv("arrayUnion",n)}function wK(...n){return new iv("arrayRemove",n)}function xK(n){return new ov("increment",n)}function IK(n){return new gf(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fv(n){return un(n=gt(n,Bt)),new SO(n,e=>Gc(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EK(n,e){const t=un(n=gt(n,Bt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Qr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(h){throw new pe(Q.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=N_(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const f of l.fields){const m=_f("setIndexConfiguration",N_(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new Xo(m,2)):f.order==="ASCENDING"?h.push(new Xo(m,0)):f.order==="DESCENDING"&&h.push(new Xo(m,1))}a.push(new vl(vl.UNKNOWN_ID,c,h,yl.empty()))}return a}(e);return eO(t,r)}function N_(n,e){if(typeof n[e]!="string")throw new pe(Q.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CO{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function TK(n){var e;n=gt(n,Bt);const t=O_.get(n);if(t)return t;if(((e=un(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new CO(n);return O_.set(n,r),r}function AK(n){eT(n,!0)}function SK(n){eT(n,!1)}function PK(n){nO(un(n._firestore)).then(e=>fe("deleting all persistent cache indexes succeeded")).catch(e=>Qr("deleting all persistent cache indexes failed",e))}function eT(n,e){tO(un(n._firestore),e).then(t=>fe(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>Qr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const O_=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RK(n){var e;const t=(e=un(gt(n.firestore,Bt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:af(t,ur(n._query))._t}function CK(n,e){var t;const r=tI(e,(i,o)=>new kI(o,i.aggregateType,i._internalFieldPath)),s=(t=un(gt(n.firestore,Bt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:zI(s,mI(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kK{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return pv.instance.onExistenceFilterMismatch(e)}}class pv{constructor(){this.Uu=new Map}static get instance(){return Cd||(Cd=new pv,function(t){if(yh)throw new Error("a TestingHooksSpi instance is already set");yh=t}(Cd)),Cd}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let Cd=null;(function(e,t=!0){(function(s){Ll=s})(ga),as(new Wr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Bt(new Xk(r.getProvider("auth-internal")),new t2(r.getProvider("app-check-internal")),function(c,h){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new pe(Q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new sa(c.options.projectId,h)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Sr(I0,"4.7.3",e),Sr(I0,"4.7.3","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tT="firebasestorage.googleapis.com",nT="storageBucket",kO=2*60*1e3,DO=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn extends us{constructor(e,t,r=0){super(Sp(e),`Firebase Storage: ${t} (${Sp(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,gn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Sp(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var mn;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(mn||(mn={}));function Sp(n){return"storage/"+n}function mv(){const n="An unknown error occurred, please check the error payload for server response.";return new gn(mn.UNKNOWN,n)}function NO(n){return new gn(mn.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function OO(n){return new gn(mn.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function VO(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new gn(mn.UNAUTHENTICATED,n)}function MO(){return new gn(mn.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function LO(n){return new gn(mn.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function $O(){return new gn(mn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function FO(){return new gn(mn.CANCELED,"User canceled the upload/download.")}function UO(n){return new gn(mn.INVALID_URL,"Invalid URL '"+n+"'.")}function jO(n){return new gn(mn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function BO(){return new gn(mn.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+nT+"' property when initializing the app?")}function qO(){return new gn(mn.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function zO(){return new gn(mn.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function HO(n){return new gn(mn.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function xm(n){return new gn(mn.INVALID_ARGUMENT,n)}function rT(){return new gn(mn.APP_DELETED,"The Firebase app was deleted.")}function KO(n){return new gn(mn.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Hu(n,e){return new gn(mn.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function wu(n){throw new gn(mn.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $r{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=$r.makeFromUrl(e,t)}catch{return new $r(e,"")}if(r.path==="")return r;throw jO(e)}static makeFromUrl(e,t){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(L){L.path.charAt(L.path.length-1)==="/"&&(L.path_=L.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),l={bucket:1,path:3};function c(L){L.path_=decodeURIComponent(L.path)}const h="v[A-Za-z0-9_]+",f=t.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",v=new RegExp(`^https?://${f}/${h}/b/${s}/o${m}`,"i"),w={bucket:1,path:3},E=t===tT?"(?:storage.googleapis.com|storage.cloud.google.com)":t,A="([^?#]*)",F=new RegExp(`^https?://${E}/${s}/${A}`,"i"),$=[{regex:a,indices:l,postModify:i},{regex:v,indices:w,postModify:c},{regex:F,indices:{bucket:1,path:2},postModify:c}];for(let L=0;L<$.length;L++){const se=$[L],te=se.regex.exec(e);if(te){const T=te[se.indices.bucket];let _=te[se.indices.path];_||(_=""),r=new $r(T,_),se.postModify(r);break}}if(r==null)throw UO(e);return r}}class GO{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WO(n,e,t){let r=1,s=null,i=null,o=!1,a=0;function l(){return a===2}let c=!1;function h(...A){c||(c=!0,e.apply(null,A))}function f(A){s=setTimeout(()=>{s=null,n(v,l())},A)}function m(){i&&clearTimeout(i)}function v(A,...F){if(c){m();return}if(A){m(),h.call(null,A,...F);return}if(l()||o){m(),h.call(null,A,...F);return}r<64&&(r*=2);let $;a===1?(a=2,$=0):$=(r+Math.random())*1e3,f($)}let w=!1;function E(A){w||(w=!0,m(),!c&&(s!==null?(A||(a=2),clearTimeout(s),f(0)):A||(a=1)))}return f(0),i=setTimeout(()=>{o=!0,E(!0)},t),E}function QO(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JO(n){return n!==void 0}function YO(n){return typeof n=="object"&&!Array.isArray(n)}function gv(n){return typeof n=="string"||n instanceof String}function V_(n){return vv()&&n instanceof Blob}function vv(){return typeof Blob<"u"}function M_(n,e,t,r){if(r<e)throw xm(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw xm(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tf(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function sT(n){const e=encodeURIComponent;let t="?";for(const r in n)if(n.hasOwnProperty(r)){const s=e(r)+"="+e(n[r]);t=t+s+"&"}return t=t.slice(0,-1),t}var Zo;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Zo||(Zo={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XO(n,e){const t=n>=500&&n<600,s=[408,429].indexOf(n)!==-1,i=e.indexOf(n)!==-1;return t||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZO{constructor(e,t,r,s,i,o,a,l,c,h,f,m=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=h,this.connectionFactory_=f,this.retry=m,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((v,w)=>{this.resolve_=v,this.reject_=w,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new kd(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=a=>{const l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const a=i.getErrorCode()===Zo.NO_ERROR,l=i.getStatus();if(!a||XO(l,this.additionalRetryCodes_)&&this.retry){const h=i.getErrorCode()===Zo.ABORT;r(!1,new kd(!1,null,h));return}const c=this.successCodes_.indexOf(l)!==-1;r(!0,new kd(c,i))})},t=(r,s)=>{const i=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const l=this.callback_(a,a.getResponse());JO(l)?i(l):i()}catch(l){o(l)}else if(a!==null){const l=mv();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(s.canceled){const l=this.appDelete_?rT():FO();o(l)}else{const l=$O();o(l)}};this.canceled_?t(!1,new kd(!1,null,!0)):this.backoffId_=WO(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&QO(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class kd{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function eV(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function tV(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function nV(n,e){e&&(n["X-Firebase-GMPID"]=e)}function rV(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function sV(n,e,t,r,s,i,o=!0){const a=sT(n.urlParams),l=n.url+a,c=Object.assign({},n.headers);return nV(c,e),eV(c,t),tV(c,i),rV(c,r),new ZO(l,n.method,c,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iV(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function oV(...n){const e=iV();if(e!==void 0){const t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(vv())return new Blob(n);throw new gn(mn.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function aV(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lV(n){if(typeof atob>"u")throw HO("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Is={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Pp{constructor(e,t){this.data=e,this.contentType=t||null}}function uV(n,e){switch(n){case Is.RAW:return new Pp(iT(e));case Is.BASE64:case Is.BASE64URL:return new Pp(oT(n,e));case Is.DATA_URL:return new Pp(dV(e),hV(e))}throw mv()}function iT(n){const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const i=r,o=n.charCodeAt(++t);r=65536|(i&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function cV(n){let e;try{e=decodeURIComponent(n)}catch{throw Hu(Is.DATA_URL,"Malformed data URL.")}return iT(e)}function oT(n,e){switch(n){case Is.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw Hu(n,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Is.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw Hu(n,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=lV(e)}catch(s){throw s.message.includes("polyfill")?s:Hu(n,"Invalid character found")}const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}class aT{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw Hu(Is.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;r!=null&&(this.base64=fV(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function dV(n){const e=new aT(n);return e.base64?oT(Is.BASE64,e.rest):cV(e.rest)}function hV(n){return new aT(n).contentType}function fV(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bi{constructor(e,t){let r=0,s="";V_(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,t){if(V_(this.data_)){const r=this.data_,s=aV(r,e,t);return s===null?null:new Bi(s)}else{const r=new Uint8Array(this.data_.buffer,e,t-e);return new Bi(r,!0)}}static getBlob(...e){if(vv()){const t=e.map(r=>r instanceof Bi?r.data_:r);return new Bi(oV.apply(null,t))}else{const t=e.map(o=>gv(o)?uV(Is.RAW,o).data:o.data_);let r=0;t.forEach(o=>{r+=o.byteLength});const s=new Uint8Array(r);let i=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)s[i++]=o[a]}),new Bi(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lT(n){let e;try{e=JSON.parse(n)}catch{return null}return YO(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pV(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function mV(n,e){const t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function uT(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gV(n,e){return e}class dr{constructor(e,t,r,s){this.server=e,this.local=t||e,this.writable=!!r,this.xform=s||gV}}let Dd=null;function vV(n){return!gv(n)||n.length<2?n:uT(n)}function cT(){if(Dd)return Dd;const n=[];n.push(new dr("bucket")),n.push(new dr("generation")),n.push(new dr("metageneration")),n.push(new dr("name","fullPath",!0));function e(i,o){return vV(o)}const t=new dr("name");t.xform=e,n.push(t);function r(i,o){return o!==void 0?Number(o):o}const s=new dr("size");return s.xform=r,n.push(s),n.push(new dr("timeCreated")),n.push(new dr("updated")),n.push(new dr("md5Hash",null,!0)),n.push(new dr("cacheControl",null,!0)),n.push(new dr("contentDisposition",null,!0)),n.push(new dr("contentEncoding",null,!0)),n.push(new dr("contentLanguage",null,!0)),n.push(new dr("contentType",null,!0)),n.push(new dr("metadata","customMetadata",!0)),Dd=n,Dd}function yV(n,e){function t(){const r=n.bucket,s=n.fullPath,i=new $r(r,s);return e._makeStorageReference(i)}Object.defineProperty(n,"ref",{get:t})}function _V(n,e,t){const r={};r.type="file";const s=t.length;for(let i=0;i<s;i++){const o=t[i];r[o.local]=o.xform(r,e[o.server])}return yV(r,n),r}function dT(n,e,t){const r=lT(e);return r===null?null:_V(n,r,t)}function bV(n,e,t,r){const s=lT(e);if(s===null||!gv(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(c=>{const h=n.bucket,f=n.fullPath,m="/b/"+o(h)+"/o/"+o(f),v=Tf(m,t,r),w=sT({alt:"media",token:c});return v+w})[0]}function wV(n,e){const t={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(t[i.server]=n[i.local])}return JSON.stringify(t)}class yv{constructor(e,t,r,s){this.url=e,this.method=t,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hT(n){if(!n)throw mv()}function xV(n,e){function t(r,s){const i=dT(n,s,e);return hT(i!==null),i}return t}function IV(n,e){function t(r,s){const i=dT(n,s,e);return hT(i!==null),bV(i,s,n.host,n._protocol)}return t}function fT(n){function e(t,r){let s;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?s=MO():s=VO():t.getStatus()===402?s=OO(n.bucket):t.getStatus()===403?s=LO(n.path):s=r,s.status=t.getStatus(),s.serverResponse=r.serverResponse,s}return e}function pT(n){const e=fT(n);function t(r,s){let i=e(r,s);return r.getStatus()===404&&(i=NO(n.path)),i.serverResponse=s.serverResponse,i}return t}function EV(n,e,t){const r=e.fullServerUrl(),s=Tf(r,n.host,n._protocol),i="GET",o=n.maxOperationRetryTime,a=new yv(s,i,IV(n,t),o);return a.errorHandler=pT(e),a}function TV(n,e){const t=e.fullServerUrl(),r=Tf(t,n.host,n._protocol),s="DELETE",i=n.maxOperationRetryTime;function o(l,c){}const a=new yv(r,s,o,i);return a.successCodes=[200,204],a.errorHandler=pT(e),a}function AV(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function SV(n,e,t){const r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=AV(null,e)),r}function PV(n,e,t,r,s){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let $="";for(let L=0;L<2;L++)$=$+Math.random().toString().slice(2);return $}const l=a();o["Content-Type"]="multipart/related; boundary="+l;const c=SV(e,r,s),h=wV(c,t),f="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+l+`\r
Content-Type: `+c.contentType+`\r
\r
`,m=`\r
--`+l+"--",v=Bi.getBlob(f,r,m);if(v===null)throw qO();const w={name:c.fullPath},E=Tf(i,n.host,n._protocol),A="POST",F=n.maxUploadRetryTime,U=new yv(E,A,xV(n,t),F);return U.urlParams=w,U.headers=o,U.body=v.uploadData(),U.errorHandler=fT(e),U}class RV{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Zo.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Zo.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Zo.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,s){if(this.sent_)throw wu("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),s!==void 0)for(const i in s)s.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,s[i].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw wu("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw wu("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw wu("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw wu("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class CV extends RV{initXhr(){this.xhr_.responseType="text"}}function _v(){return new CV}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fa{constructor(e,t){this._service=e,t instanceof $r?this._location=t:this._location=$r.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new fa(e,t)}get root(){const e=new $r(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return uT(this._location.path)}get storage(){return this._service}get parent(){const e=pV(this._location.path);if(e===null)return null;const t=new $r(this._location.bucket,e);return new fa(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw KO(e)}}function kV(n,e,t){n._throwIfRoot("uploadBytes");const r=PV(n.storage,n._location,cT(),new Bi(e,!0),t);return n.storage.makeRequestWithTokens(r,_v).then(s=>({metadata:s,ref:n}))}function DV(n){n._throwIfRoot("getDownloadURL");const e=EV(n.storage,n._location,cT());return n.storage.makeRequestWithTokens(e,_v).then(t=>{if(t===null)throw zO();return t})}function NV(n){n._throwIfRoot("deleteObject");const e=TV(n.storage,n._location);return n.storage.makeRequestWithTokens(e,_v)}function OV(n,e){const t=mV(n._location.path,e),r=new $r(n._location.bucket,t);return new fa(n.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VV(n){return/^[A-Za-z]+:\/\//.test(n)}function MV(n,e){return new fa(n,e)}function mT(n,e){if(n instanceof bv){const t=n;if(t._bucket==null)throw BO();const r=new fa(t,t._bucket);return e!=null?mT(r,e):r}else return e!==void 0?OV(n,e):n}function LV(n,e){if(e&&VV(e)){if(n instanceof bv)return MV(n,e);throw xm("To use ref(service, url), the first argument must be a Storage instance.")}else return mT(n,e)}function L_(n,e){const t=e==null?void 0:e[nT];return t==null?null:$r.makeFromBucketSpec(t,n)}function $V(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";const{mockUserToken:s}=r;s&&(n._overrideAuthToken=typeof s=="string"?s:tx(s,n.app.options.projectId))}class bv{constructor(e,t,r,s,i){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._bucket=null,this._host=tT,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=kO,this._maxUploadRetryTime=DO,this._requests=new Set,s!=null?this._bucket=$r.makeFromBucketSpec(s,this._host):this._bucket=L_(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=$r.makeFromBucketSpec(this._url,e):this._bucket=L_(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){M_("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){M_("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new fa(this,e)}_makeRequest(e,t,r,s,i=!0){if(this._deleted)return new GO(rT());{const o=sV(e,this._appId,r,s,t,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,s).getPromise()}}const $_="@firebase/storage",F_="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gT="storage";function FV(n,e,t){return n=Me(n),kV(n,e,t)}function UV(n){return n=Me(n),DV(n)}function jV(n){return n=Me(n),NV(n)}function vT(n,e){return n=Me(n),LV(n,e)}function BV(n=Yh(),e){n=Me(n);const r=li(n,gT).getImmediate({identifier:e}),s=Xw("storage");return s&&qV(r,...s),r}function qV(n,e,t,r={}){$V(n,e,t,r)}function zV(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new bv(t,r,s,e,ga)}function HV(){as(new Wr(gT,zV,"PUBLIC").setMultipleInstances(!0)),Sr($_,F_,""),Sr($_,F_,"esm2017")}HV();function wv(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DK={PHONE:"phone",TOTP:"totp"},NK={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},OK={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},VK={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},MK={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KV(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function yT(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const LK=KV,GV=yT,_T=new ma("auth","Firebase",yT()),$K={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rh=new ig("@firebase/auth");function WV(n,...e){Rh.logLevel<=_t.WARN&&Rh.warn(`Auth (${ga}): ${n}`,...e)}function Xd(n,...e){Rh.logLevel<=_t.ERROR&&Rh.error(`Auth (${ga}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pr(n,...e){throw Iv(n,...e)}function gr(n,...e){return Iv(n,...e)}function xv(n,e,t){const r=Object.assign(Object.assign({},GV()),{[e]:t});return new ma("auth","Firebase",r).create(e,{appName:n.name})}function zn(n){return xv(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Wl(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Pr(n,"argument-error"),xv(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Iv(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return _T.create(n,...e)}function Ie(n,e,...t){if(!n)throw Iv(e,...t)}function Es(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Xd(e),new Error(e)}function si(n,e){n||Es(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xc(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Ev(){return U_()==="http:"||U_()==="https:"}function U_(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QV(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Ev()||aR()||"connection"in navigator)?navigator.onLine:!0}function JV(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc{constructor(e,t){this.shortDelay=e,this.longDelay=t,si(t>e,"Short delay should be less than long delay!"),this.isMobile=sR()||lR()}get(){return QV()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tv(n,e){si(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bT{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Es("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Es("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Es("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YV={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XV=new Wc(3e4,6e4);function Yt(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Xt(n,e,t,r,s={}){return wT(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Ml(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return oR()||(c.referrerPolicy="no-referrer"),bT.fetch()(xT(n,n.config.apiHost,t,a),c)})}async function wT(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},YV),e);try{const s=new eM(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Du(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Du(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Du(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Du(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw xv(n,h,c);Pr(n,h)}}catch(s){if(s instanceof us)throw s;Pr(n,"network-request-failed",{message:String(s)})}}async function fi(n,e,t,r,s={}){const i=await Xt(n,e,t,r,s);return"mfaPendingCredential"in i&&Pr(n,"multi-factor-auth-required",{_serverResponse:i}),i}function xT(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Tv(n.config,s):`${n.config.apiScheme}://${s}`}function ZV(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class eM{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(gr(this.auth,"network-request-failed")),XV.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Du(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=gr(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j_(n){return n!==void 0&&n.getResponse!==void 0}function B_(n){return n!==void 0&&n.enterprise!==void 0}class IT{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return ZV(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tM(n){return(await Xt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function ET(n,e){return Xt(n,"GET","/v2/recaptchaConfig",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nM(n,e){return Xt(n,"POST","/v1/accounts:delete",e)}async function rM(n,e){return Xt(n,"POST","/v1/accounts:update",e)}async function TT(n,e){return Xt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ku(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FK(n,e=!1){return Me(n).getIdToken(e)}async function sM(n,e=!1){const t=Me(n),r=await t.getIdToken(e),s=Af(r);Ie(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Ku(Rp(s.auth_time)),issuedAtTime:Ku(Rp(s.iat)),expirationTime:Ku(Rp(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Rp(n){return Number(n)*1e3}function Af(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Xd("JWT malformed, contained fewer than 3 sections"),null;try{const s=Jw(t);return s?JSON.parse(s):(Xd("Failed to decode base64 JWT payload"),null)}catch(s){return Xd("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function q_(n){const e=Af(n);return Ie(e,"internal-error"),Ie(typeof e.exp<"u","internal-error"),Ie(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ii(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof us&&iM(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function iM({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oM{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Im{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ku(this.lastLoginAt),this.creationTime=Ku(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ic(n){var e;const t=n.auth,r=await n.getIdToken(),s=await ii(n,TT(t,{idToken:r}));Ie(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?AT(i.providerUserInfo):[],a=lM(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),h=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Im(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function aM(n){const e=Me(n);await Ic(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function lM(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function AT(n){return n.map(e=>{var{providerId:t}=e,r=wv(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uM(n,e){const t=await wT(n,{},async()=>{const r=Ml({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=xT(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",bT.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function cM(n,e){return Xt(n,"POST","/v2/accounts:revokeToken",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ie(e.idToken,"internal-error"),Ie(typeof e.idToken<"u","internal-error"),Ie(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):q_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ie(e.length!==0,"internal-error");const t=q_(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ie(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await uM(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new cl;return r&&(Ie(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Ie(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Ie(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new cl,this.toJSON())}_performRefresh(){return Es("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Di(n,e){Ie(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class qs{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=wv(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new oM(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Im(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await ii(this,this.stsTokenManager.getToken(this.auth,e));return Ie(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return sM(this,e)}reload(){return aM(this)}_assign(e){this!==e&&(Ie(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new qs(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ie(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Ic(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(In(this.auth.app))return Promise.reject(zn(this.auth));const e=await this.getIdToken();return await ii(this,nM(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,h;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,m=(s=t.email)!==null&&s!==void 0?s:void 0,v=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,w=(o=t.photoURL)!==null&&o!==void 0?o:void 0,E=(a=t.tenantId)!==null&&a!==void 0?a:void 0,A=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,F=(c=t.createdAt)!==null&&c!==void 0?c:void 0,U=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:$,emailVerified:L,isAnonymous:se,providerData:te,stsTokenManager:T}=t;Ie($&&T,e,"internal-error");const _=cl.fromJSON(this.name,T);Ie(typeof $=="string",e,"internal-error"),Di(f,e.name),Di(m,e.name),Ie(typeof L=="boolean",e,"internal-error"),Ie(typeof se=="boolean",e,"internal-error"),Di(v,e.name),Di(w,e.name),Di(E,e.name),Di(A,e.name),Di(F,e.name),Di(U,e.name);const I=new qs({uid:$,auth:e,email:m,emailVerified:L,displayName:f,isAnonymous:se,photoURL:w,phoneNumber:v,tenantId:E,stsTokenManager:_,createdAt:F,lastLoginAt:U});return te&&Array.isArray(te)&&(I.providerData=te.map(C=>Object.assign({},C))),A&&(I._redirectEventId=A),I}static async _fromIdTokenResponse(e,t,r=!1){const s=new cl;s.updateFromServerResponse(t);const i=new qs({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Ic(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];Ie(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?AT(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new cl;a.updateFromIdToken(r);const l=new qs({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Im(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z_=new Map;function zs(n){si(n instanceof Function,"Expected a class definition");let e=z_.get(n);return e?(si(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,z_.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ST{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ST.type="NONE";const H_=ST;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zd(n,e,t){return`firebase:${n}:${e}:${t}`}class dl{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Zd(this.userKey,s.apiKey,i),this.fullPersistenceKey=Zd("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?qs._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new dl(zs(H_),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||zs(H_);const o=Zd(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const h=await c._get(o);if(h){const f=qs._fromJSON(e,h);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new dl(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new dl(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K_(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(kT(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(PT(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(NT(e))return"Blackberry";if(OT(e))return"Webos";if(RT(e))return"Safari";if((e.includes("chrome/")||CT(e))&&!e.includes("edge/"))return"Chrome";if(DT(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function PT(n=Nn()){return/firefox\//i.test(n)}function RT(n=Nn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function CT(n=Nn()){return/crios\//i.test(n)}function kT(n=Nn()){return/iemobile/i.test(n)}function DT(n=Nn()){return/android/i.test(n)}function NT(n=Nn()){return/blackberry/i.test(n)}function OT(n=Nn()){return/webos/i.test(n)}function Av(n=Nn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function dM(n=Nn()){var e;return Av(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function hM(){return uR()&&document.documentMode===10}function VT(n=Nn()){return Av(n)||DT(n)||OT(n)||NT(n)||/windows phone/i.test(n)||kT(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MT(n,e=[]){let t;switch(n){case"Browser":t=K_(Nn());break;case"Worker":t=`${K_(Nn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ga}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fM{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pM(n,e={}){return Xt(n,"GET","/v2/passwordPolicy",Yt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mM=6;class gM{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:mM,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vM{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new G_(this),this.idTokenSubscription=new G_(this),this.beforeStateQueue=new fM(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=_T,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=zs(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await dl.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await TT(this,{idToken:e}),r=await qs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(In(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Ie(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ic(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=JV()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(In(this.app))return Promise.reject(zn(this));const t=e?Me(e):null;return t&&Ie(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ie(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return In(this.app)?Promise.reject(zn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return In(this.app)?Promise.reject(zn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(zs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await pM(this),t=new gM(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ma("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await cM(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&zs(e)||this._popupRedirectResolver;Ie(t,this,"argument-error"),this.redirectPersistenceManager=await dl.create(this,[zs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ie(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ie(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=MT(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&WV(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function vn(n){return Me(n)}class G_{constructor(e){this.auth=e,this.observer=null,this.addObserver=mR(t=>this.observer=t)}get next(){return Ie(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function yM(n){Qc=n}function Sv(n){return Qc.loadJS(n)}function _M(){return Qc.recaptchaV2Script}function bM(){return Qc.recaptchaEnterpriseScript}function wM(){return Qc.gapiScript}function LT(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const xM="recaptcha-enterprise",IM="NO_RECAPTCHA";class $T{constructor(e){this.type=xM,this.auth=vn(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{ET(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new IT(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;B_(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(IM)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&B_(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=bM();l.length!==0&&(l+=a),Sv(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function W_(n,e,t,r=!1){const s=new $T(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Ec(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await W_(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await W_(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function EM(n){const e=vn(n),t=await ET(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new IT(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new $T(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TM(n,e){const t=li(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(ro(i,e??{}))return s;Pr(s,"already-initialized")}return t.initialize({options:e})}function AM(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(zs);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function SM(n,e,t){const r=vn(n);Ie(r._canInitEmulator,r,"emulator-config-failed"),Ie(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=FT(e),{host:o,port:a}=PM(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||RM()}function FT(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function PM(n){const e=FT(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Q_(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:Q_(o)}}}function Q_(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function RM(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Es("not implemented")}_getIdTokenResponse(e){return Es("not implemented")}_linkToIdToken(e,t){return Es("not implemented")}_getReauthenticationResolver(e){return Es("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UT(n,e){return Xt(n,"POST","/v1/accounts:resetPassword",Yt(n,e))}async function CM(n,e){return Xt(n,"POST","/v1/accounts:update",e)}async function kM(n,e){return Xt(n,"POST","/v1/accounts:signUp",e)}async function DM(n,e){return Xt(n,"POST","/v1/accounts:update",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NM(n,e){return fi(n,"POST","/v1/accounts:signInWithPassword",Yt(n,e))}async function Sf(n,e){return Xt(n,"POST","/v1/accounts:sendOobCode",Yt(n,e))}async function OM(n,e){return Sf(n,e)}async function VM(n,e){return Sf(n,e)}async function MM(n,e){return Sf(n,e)}async function LM(n,e){return Sf(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $M(n,e){return fi(n,"POST","/v1/accounts:signInWithEmailLink",Yt(n,e))}async function FM(n,e){return fi(n,"POST","/v1/accounts:signInWithEmailLink",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tc extends Jc{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Tc(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Tc(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ec(e,t,"signInWithPassword",NM);case"emailLink":return $M(e,{email:this._email,oobCode:this._password});default:Pr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ec(e,r,"signUpPassword",kM);case"emailLink":return FM(e,{idToken:t,email:this._email,oobCode:this._password});default:Pr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Js(n,e){return fi(n,"POST","/v1/accounts:signInWithIdp",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UM="http://localhost";class oi extends Jc{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new oi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Pr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=wv(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new oi(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Js(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Js(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Js(e,t)}buildRequest(){const e={requestUri:UM,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ml(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jM(n,e){return Xt(n,"POST","/v1/accounts:sendVerificationCode",Yt(n,e))}async function BM(n,e){return fi(n,"POST","/v1/accounts:signInWithPhoneNumber",Yt(n,e))}async function qM(n,e){const t=await fi(n,"POST","/v1/accounts:signInWithPhoneNumber",Yt(n,e));if(t.temporaryProof)throw Du(n,"account-exists-with-different-credential",t);return t}const zM={USER_NOT_FOUND:"user-not-found"};async function HM(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return fi(n,"POST","/v1/accounts:signInWithPhoneNumber",Yt(n,t),zM)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea extends Jc{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ea({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ea({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return BM(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return qM(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return HM(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new ea({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KM(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function GM(n){const e=Au(Su(n)).link,t=e?Au(Su(e)).deep_link_id:null,r=Au(Su(n)).deep_link_id;return(r?Au(Su(r)).link:null)||r||t||e||n}class Yc{constructor(e){var t,r,s,i,o,a;const l=Au(Su(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,h=(r=l.oobCode)!==null&&r!==void 0?r:null,f=KM((s=l.mode)!==null&&s!==void 0?s:null);Ie(c&&h&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=h,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=GM(e);try{return new Yc(t)}catch{return null}}}function UK(n){return Yc.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(){this.providerId=xa.PROVIDER_ID}static credential(e,t){return Tc._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Yc.parseLink(t);return Ie(r,"argument-error"),Tc._fromEmailAndCode(e,r.code,r.tenantId)}}xa.PROVIDER_ID="password";xa.EMAIL_PASSWORD_SIGN_IN_METHOD="password";xa.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pi{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ql extends pi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class eh extends Ql{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return Ie("providerId"in t&&"signInMethod"in t,"argument-error"),oi._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return Ie(e.idToken||e.accessToken,"argument-error"),oi._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return eh.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return eh.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new eh(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi extends Ql{constructor(){super("facebook.com")}static credential(e){return oi._fromParams({providerId:qi.PROVIDER_ID,signInMethod:qi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return qi.credentialFromTaggedObject(e)}static credentialFromError(e){return qi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return qi.credential(e.oauthAccessToken)}catch{return null}}}qi.FACEBOOK_SIGN_IN_METHOD="facebook.com";qi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi extends Ql{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return oi._fromParams({providerId:zi.PROVIDER_ID,signInMethod:zi.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return zi.credentialFromTaggedObject(e)}static credentialFromError(e){return zi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return zi.credential(t,r)}catch{return null}}}zi.GOOGLE_SIGN_IN_METHOD="google.com";zi.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hi extends Ql{constructor(){super("github.com")}static credential(e){return oi._fromParams({providerId:Hi.PROVIDER_ID,signInMethod:Hi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Hi.credentialFromTaggedObject(e)}static credentialFromError(e){return Hi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Hi.credential(e.oauthAccessToken)}catch{return null}}}Hi.GITHUB_SIGN_IN_METHOD="github.com";Hi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WM="http://localhost";class Ac extends Jc{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Js(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Js(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Js(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Ac(r,i)}static _create(e,t){return new Ac(e,t)}buildRequest(){return{requestUri:WM,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QM="saml.";class Em extends pi{constructor(e){Ie(e.startsWith(QM),"argument-error"),super(e)}static credentialFromResult(e){return Em.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Em.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Ac.fromJSON(e);return Ie(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Ac._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ki extends Ql{constructor(){super("twitter.com")}static credential(e,t){return oi._fromParams({providerId:Ki.PROVIDER_ID,signInMethod:Ki.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ki.credentialFromTaggedObject(e)}static credentialFromError(e){return Ki.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Ki.credential(t,r)}catch{return null}}}Ki.TWITTER_SIGN_IN_METHOD="twitter.com";Ki.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jT(n,e){return fi(n,"POST","/v1/accounts:signUp",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await qs._fromIdTokenResponse(e,r,s),o=J_(r);return new Jr({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=J_(r);return new Jr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function J_(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BT(n){var e;if(In(n.app))return Promise.reject(zn(n));const t=vn(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Jr({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await jT(t,{returnSecureToken:!0}),s=await Jr._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ch extends us{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Ch.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Ch(e,t,r,s)}}function qT(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Ch._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zT(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jK(n,e){const t=Me(n);await Pf(!0,t,e);const{providerUserInfo:r}=await rM(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=zT(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Pv(n,e,t=!1){const r=await ii(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Jr._forOperation(n,"link",r)}async function Pf(n,e,t){await Ic(e);const r=zT(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";Ie(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HT(n,e,t=!1){const{auth:r}=n;if(In(r.app))return Promise.reject(zn(r));const s="reauthenticate";try{const i=await ii(n,qT(r,s,e,n),t);Ie(i.idToken,r,"internal-error");const o=Af(i.idToken);Ie(o,r,"internal-error");const{sub:a}=o;return Ie(n.uid===a,r,"user-mismatch"),Jr._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Pr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KT(n,e,t=!1){if(In(n.app))return Promise.reject(zn(n));const r="signIn",s=await qT(n,r,e),i=await Jr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Rv(n,e){return KT(vn(n),e)}async function JM(n,e){const t=Me(n);return await Pf(!1,t,e.providerId),Pv(t,e)}async function YM(n,e){return HT(Me(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XM(n,e){return fi(n,"POST","/v1/accounts:signInWithCustomToken",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BK(n,e){if(In(n.app))return Promise.reject(zn(n));const t=vn(n),r=await XM(t,{token:e,returnSecureToken:!0}),s=await Jr._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xc{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Cv._fromServerResponse(e,t):"totpInfo"in t?kv._fromServerResponse(e,t):Pr(e,"internal-error")}}class Cv extends Xc{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Cv(t)}}class kv extends Xc{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new kv(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rf(n,e,t){var r;Ie(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),Ie(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(Ie(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(Ie(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dv(n){const e=vn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function ZM(n,e,t){const r=vn(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Rf(r,s,t),await Ec(r,s,"getOobCode",VM)}async function eL(n,e,t){await UT(Me(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Dv(n),r})}async function qK(n,e){await DM(Me(n),{oobCode:e})}async function tL(n,e){const t=Me(n),r=await UT(t,{oobCode:e}),s=r.requestType;switch(Ie(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Ie(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Ie(r.mfaInfo,t,"internal-error");default:Ie(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Xc._fromServerResponse(vn(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function zK(n,e){const{data:t}=await tL(Me(n),e);return t.email}async function nL(n,e,t){if(In(n.app))return Promise.reject(zn(n));const r=vn(n),o=await Ec(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",jT).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Dv(n),l}),a=await Jr._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function rL(n,e,t){return In(n.app)?Promise.reject(zn(n)):Rv(Me(n),xa.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Dv(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HK(n,e,t){const r=vn(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){Ie(a.handleCodeInApp,r,"argument-error"),a&&Rf(r,o,a)}i(s,t),await Ec(r,s,"getOobCode",MM)}function KK(n,e){const t=Yc.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function GK(n,e,t){if(In(n.app))return Promise.reject(zn(n));const r=Me(n),s=xa.credentialWithLink(e,t||xc());return Ie(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Rv(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sL(n,e){return Xt(n,"POST","/v1/accounts:createAuthUri",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WK(n,e){const t=Ev()?xc():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await sL(Me(n),r);return s||[]}async function QK(n,e){const t=Me(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Rf(t.auth,s,e);const{email:i}=await OM(t.auth,s);i!==n.email&&await n.reload()}async function JK(n,e,t){const r=Me(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Rf(r.auth,i,t);const{email:o}=await LM(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iL(n,e){return Xt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YK(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Me(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await ii(r,iL(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function oL(n,e){const t=Me(n);return In(t.auth.app)?Promise.reject(zn(t.auth)):GT(t,e,null)}function aL(n,e){return GT(Me(n),null,e)}async function GT(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await ii(n,CM(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lL(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=Af(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new hl(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new uL(i,s);case"github.com":return new cL(i,s);case"google.com":return new dL(i,s);case"twitter.com":return new hL(i,s,n.screenName||null);case"custom":case"anonymous":return new hl(i,null);default:return new hl(i,r,s)}}class hl{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class WT extends hl{constructor(e,t,r,s){super(e,t,r),this.username=s}}class uL extends hl{constructor(e,t){super(e,"facebook.com",t)}}class cL extends WT{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class dL extends hl{constructor(e,t){super(e,"google.com",t)}}class hL extends WT{constructor(e,t,r){super(e,"twitter.com",t,r)}}function XK(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:lL(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fL(n,e){return Me(n).setPersistence(e)}function ZK(n){return EM(n)}async function eG(n,e){return vn(n).validatePassword(e)}function pL(n,e,t,r){return Me(n).onIdTokenChanged(e,t,r)}function mL(n,e,t){return Me(n).beforeAuthStateChanged(e,t)}function gL(n,e,t,r){return Me(n).onAuthStateChanged(e,t,r)}function tG(n){Me(n).useDeviceLanguage()}function nG(n,e){return Me(n).updateCurrentUser(e)}function vL(n){return Me(n).signOut()}function rG(n,e){return vn(n).revokeAccessToken(e)}async function sG(n){return Me(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qo{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new Qo("enroll",e,t)}static _fromMfaPendingCredential(e){return new Qo("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return Qo._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return Qo._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nv{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=vn(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Xc._fromServerResponse(r,a));Ie(s.mfaPendingCredential,r,"internal-error");const o=Qo._fromMfaPendingCredential(s.mfaPendingCredential);return new Nv(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const h=await Jr._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return Ie(t.user,r,"internal-error"),Jr._forOperation(t.user,t.operationType,c);default:Pr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function iG(n,e){var t;const r=Me(n),s=e;return Ie(e.customData.operationType,r,"argument-error"),Ie((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Nv._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yL(n,e){return Xt(n,"POST","/v2/accounts/mfaEnrollment:start",Yt(n,e))}function _L(n,e){return Xt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Yt(n,e))}function bL(n,e){return Xt(n,"POST","/v2/accounts/mfaEnrollment:start",Yt(n,e))}function wL(n,e){return Xt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Yt(n,e))}function xL(n,e){return Xt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Yt(n,e))}class Ov{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Xc._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Ov(e)}async getSession(){return Qo._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await ii(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await ii(this.user,xL(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Cp=new WeakMap;function oG(n){const e=Me(n);return Cp.has(e)||Cp.set(e,Ov._fromUser(e)),Cp.get(e)}const kh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QT{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(kh,"1"),this.storage.removeItem(kh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IL=1e3,EL=10;class JT extends QT{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=VT(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);hM()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,EL):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},IL)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}JT.type="LOCAL";const YT=JT;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XT extends QT{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}XT.type="SESSION";const ZT=XT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TL(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Cf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await TL(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Cf.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kf(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AL{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=kf("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const m=f;if(m.data.eventId===c)switch(m.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(m.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pn(){return window}function SL(n){Pn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vv(){return typeof Pn().WorkerGlobalScope<"u"&&typeof Pn().importScripts=="function"}async function PL(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function RL(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function CL(){return Vv()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eA="firebaseLocalStorageDb",kL=1,Dh="firebaseLocalStorage",tA="fbase_key";class Zc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Df(n,e){return n.transaction([Dh],e?"readwrite":"readonly").objectStore(Dh)}function DL(){const n=indexedDB.deleteDatabase(eA);return new Zc(n).toPromise()}function Tm(){const n=indexedDB.open(eA,kL);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Dh,{keyPath:tA})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Dh)?e(r):(r.close(),await DL(),e(await Tm()))})})}async function Y_(n,e,t){const r=Df(n,!0).put({[tA]:e,value:t});return new Zc(r).toPromise()}async function NL(n,e){const t=Df(n,!1).get(e),r=await new Zc(t).toPromise();return r===void 0?null:r.value}function X_(n,e){const t=Df(n,!0).delete(e);return new Zc(t).toPromise()}const OL=800,VL=3;class nA{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Tm(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>VL)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Vv()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Cf._getInstance(CL()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await PL(),!this.activeServiceWorker)return;this.sender=new AL(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||RL()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Tm();return await Y_(e,kh,"1"),await X_(e,kh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Y_(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>NL(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>X_(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Df(s,!1).getAll();return new Zc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),OL)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}nA.type="LOCAL";const ML=nA;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LL(n,e){return Xt(n,"POST","/v2/accounts/mfaSignIn:start",Yt(n,e))}function $L(n,e){return Xt(n,"POST","/v2/accounts/mfaSignIn:finalize",Yt(n,e))}function FL(n,e){return Xt(n,"POST","/v2/accounts/mfaSignIn:finalize",Yt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UL=500,jL=6e4,Nd=1e12;class BL{constructor(e){this.auth=e,this.counter=Nd,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new qL(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Nd;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Nd;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Nd;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class qL{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;Ie(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=zL(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},jL)},UL))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function zL(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kp=LT("rcb"),HL=new Wc(3e4,6e4);class KL{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Pn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return Ie(GL(t),e,"argument-error"),this.shouldResolveImmediately(t)&&j_(Pn().grecaptcha)?Promise.resolve(Pn().grecaptcha):new Promise((r,s)=>{const i=Pn().setTimeout(()=>{s(gr(e,"network-request-failed"))},HL.get());Pn()[kp]=()=>{Pn().clearTimeout(i),delete Pn()[kp];const a=Pn().grecaptcha;if(!a||!j_(a)){s(gr(e,"internal-error"));return}const l=a.render;a.render=(c,h)=>{const f=l(c,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${_M()}?${Ml({onload:kp,render:"explicit",hl:t})}`;Sv(o).catch(()=>{clearTimeout(i),s(gr(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Pn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function GL(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class WL{async load(e){return new BL(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rA="recaptcha",QL={theme:"light",type:"image"};class aG{constructor(e,t,r=Object.assign({},QL)){this.parameters=r,this.type=rA,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=vn(e),this.isInvisible=this.parameters.size==="invisible",Ie(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;Ie(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new WL:new KL,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Ie(!this.parameters.sitekey,this.auth,"argument-error"),Ie(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Ie(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Pn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){Ie(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Ie(Ev()&&!Vv(),this.auth,"internal-error"),await JL(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await tM(this.auth);Ie(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Ie(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function JL(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mv{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=ea._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function lG(n,e,t){if(In(n.app))return Promise.reject(zn(n));const r=vn(n),s=await Nf(r,e,Me(t));return new Mv(s,i=>Rv(r,i))}async function uG(n,e,t){const r=Me(n);await Pf(!1,r,"phone");const s=await Nf(r.auth,e,Me(t));return new Mv(s,i=>JM(r,i))}async function cG(n,e,t){const r=Me(n);if(In(r.auth.app))return Promise.reject(zn(r.auth));const s=await Nf(r.auth,e,Me(t));return new Mv(s,i=>YM(r,i))}async function Nf(n,e,t){var r;const s=await t.verify();try{Ie(typeof s=="string",n,"argument-error"),Ie(t.type===rA,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return Ie(o.type==="enroll",n,"internal-error"),(await yL(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{Ie(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return Ie(a,n,"missing-multi-factor-info"),(await LL(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await jM(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function dG(n,e){const t=Me(n);if(In(t.auth.app))return Promise.reject(zn(t.auth));await Pv(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fl{constructor(e){this.providerId=fl.PROVIDER_ID,this.auth=vn(e)}verifyPhoneNumber(e,t){return Nf(this.auth,e,Me(t))}static credential(e,t){return ea._fromVerification(e,t)}static credentialFromResult(e){const t=e;return fl.credentialFromTaggedObject(t)}static credentialFromError(e){return fl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?ea._fromTokenResponse(t,r):null}}fl.PROVIDER_ID="phone";fl.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ia(n,e){return e?zs(e):(Ie(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lv extends Jc{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Js(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Js(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Js(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function YL(n){return KT(n.auth,new Lv(n),n.bypassAuthState)}function XL(n){const{auth:e,user:t}=n;return Ie(t,e,"internal-error"),HT(t,new Lv(n),n.bypassAuthState)}async function ZL(n){const{auth:e,user:t}=n;return Ie(t,e,"internal-error"),Pv(t,new Lv(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sA{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return YL;case"linkViaPopup":case"linkViaRedirect":return ZL;case"reauthViaPopup":case"reauthViaRedirect":return XL;default:Pr(this.auth,"internal-error")}}resolve(e){si(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){si(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e4=new Wc(2e3,1e4);async function hG(n,e,t){if(In(n.app))return Promise.reject(gr(n,"operation-not-supported-in-this-environment"));const r=vn(n);Wl(n,e,pi);const s=Ia(r,t);return new Hs(r,"signInViaPopup",e,s).executeNotNull()}async function fG(n,e,t){const r=Me(n);if(In(r.auth.app))return Promise.reject(gr(r.auth,"operation-not-supported-in-this-environment"));Wl(r.auth,e,pi);const s=Ia(r.auth,t);return new Hs(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function pG(n,e,t){const r=Me(n);Wl(r.auth,e,pi);const s=Ia(r.auth,t);return new Hs(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Hs extends sA{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Hs.currentPopupAction&&Hs.currentPopupAction.cancel(),Hs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ie(e,this.auth,"internal-error"),e}async onExecution(){si(this.filter.length===1,"Popup operations only handle one event");const e=kf();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(gr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(gr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Hs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(gr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,e4.get())};e()}}Hs.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t4="pendingRedirect",th=new Map;class n4 extends sA{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=th.get(this.auth._key());if(!e){try{const r=await r4(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}th.set(this.auth._key(),e)}return this.bypassAuthState||th.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function r4(n,e){const t=oA(e),r=iA(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function $v(n,e){return iA(n)._set(oA(e),"true")}function s4(n,e){th.set(n._key(),e)}function iA(n){return zs(n._redirectPersistence)}function oA(n){return Zd(t4,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mG(n,e,t){return i4(n,e,t)}async function i4(n,e,t){if(In(n.app))return Promise.reject(zn(n));const r=vn(n);Wl(n,e,pi),await r._initializationPromise;const s=Ia(r,t);return await $v(s,r),s._openRedirect(r,e,"signInViaRedirect")}function gG(n,e,t){return o4(n,e,t)}async function o4(n,e,t){const r=Me(n);if(Wl(r.auth,e,pi),In(r.auth.app))return Promise.reject(zn(r.auth));await r.auth._initializationPromise;const s=Ia(r.auth,t);await $v(s,r.auth);const i=await lA(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function vG(n,e,t){return a4(n,e,t)}async function a4(n,e,t){const r=Me(n);Wl(r.auth,e,pi),await r.auth._initializationPromise;const s=Ia(r.auth,t);await Pf(!1,r,e.providerId),await $v(s,r.auth);const i=await lA(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function yG(n,e){return await vn(n)._initializationPromise,aA(n,e,!1)}async function aA(n,e,t=!1){if(In(n.app))return Promise.reject(zn(n));const r=vn(n),s=Ia(r,e),o=await new n4(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function lA(n){const e=kf(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l4=10*60*1e3;class u4{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!c4(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!uA(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(gr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=l4&&this.cachedEventUids.clear(),this.cachedEventUids.has(Z_(e))}saveEventToCache(e){this.cachedEventUids.add(Z_(e)),this.lastProcessedEventTime=Date.now()}}function Z_(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function uA({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function c4(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return uA(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function d4(n,e={}){return Xt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h4=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,f4=/^https?/;async function p4(n){if(n.config.emulator)return;const{authorizedDomains:e}=await d4(n);for(const t of e)try{if(m4(t))return}catch{}Pr(n,"unauthorized-domain")}function m4(n){const e=xc(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!f4.test(t))return!1;if(h4.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g4=new Wc(3e4,6e4);function eb(){const n=Pn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function v4(n){return new Promise((e,t)=>{var r,s,i;function o(){eb(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{eb(),t(gr(n,"network-request-failed"))},timeout:g4.get()})}if(!((s=(r=Pn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Pn().gapi)===null||i===void 0)&&i.load)o();else{const a=LT("iframefcb");return Pn()[a]=()=>{gapi.load?o():t(gr(n,"network-request-failed"))},Sv(`${wM()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw nh=null,e})}let nh=null;function y4(n){return nh=nh||v4(n),nh}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _4=new Wc(5e3,15e3),b4="__/auth/iframe",w4="emulator/auth/iframe",x4={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},I4=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function E4(n){const e=n.config;Ie(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Tv(e,w4):`https://${n.config.authDomain}/${b4}`,r={apiKey:e.apiKey,appName:n.name,v:ga},s=I4.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Ml(r).slice(1)}`}async function T4(n){const e=await y4(n),t=Pn().gapi;return Ie(t,n,"internal-error"),e.open({where:document.body,url:E4(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:x4,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=gr(n,"network-request-failed"),a=Pn().setTimeout(()=>{i(o)},_4.get());function l(){Pn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A4={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},S4=500,P4=600,R4="_blank",C4="http://localhost";class tb{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function k4(n,e,t,r=S4,s=P4){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},A4),{width:r.toString(),height:s.toString(),top:i,left:o}),c=Nn().toLowerCase();t&&(a=CT(c)?R4:t),PT(c)&&(e=e||C4,l.scrollbars="yes");const h=Object.entries(l).reduce((m,[v,w])=>`${m}${v}=${w},`,"");if(dM(c)&&a!=="_self")return D4(e||"",a),new tb(null);const f=window.open(e||"",a,h);Ie(f,n,"popup-blocked");try{f.focus()}catch{}return new tb(f)}function D4(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N4="__/auth/handler",O4="emulator/auth/handler",V4=encodeURIComponent("fac");async function nb(n,e,t,r,s,i){Ie(n.config.authDomain,n,"auth-domain-config-required"),Ie(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:ga,eventId:s};if(e instanceof pi){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",pR(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof Ql){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),c=l?`#${V4}=${encodeURIComponent(l)}`:"";return`${M4(n)}?${Ml(a).slice(1)}${c}`}function M4({config:n}){return n.emulator?Tv(n,O4):`https://${n.authDomain}/${N4}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dp="webStorageSupport";class L4{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ZT,this._completeRedirectFn=aA,this._overrideRedirectResult=s4}async _openPopup(e,t,r,s){var i;si((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await nb(e,t,r,xc(),s);return k4(e,o,kf())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await nb(e,t,r,xc(),s);return SL(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(si(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await T4(e),r=new u4(e);return t.register("authEvent",s=>(Ie(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Dp,{type:Dp},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Dp];o!==void 0&&t(!!o),Pr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=p4(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return VT()||RT()||Av()}}const $4=L4;class cA{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Es("unexpected MultiFactorSessionType")}}}class Fv extends cA{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Fv(e)}_finalizeEnroll(e,t,r){return _L(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return $L(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class F4{constructor(){}static assertion(e){return Fv._fromCredential(e)}}F4.FACTOR_ID="phone";class U4{static assertionForEnrollment(e,t){return Sc._fromSecret(e,t)}static assertionForSignIn(e,t){return Sc._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;Ie(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await bL(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return Uv._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}U4.FACTOR_ID="totp";class Sc extends cA{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Sc(t,void 0,e)}static _fromEnrollmentId(e,t){return new Sc(t,e)}async _finalizeEnroll(e,t,r){return Ie(typeof this.secret<"u",e,"argument-error"),wL(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){Ie(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return FL(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class Uv{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new Uv(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(Od(e)||Od(t))&&(s=!0),s&&(Od(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),Od(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Od(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var rb="@firebase/auth",sb="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j4{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ie(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B4(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function q4(n){as(new Wr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;Ie(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:MT(n)},c=new vM(r,s,i,l);return AM(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),as(new Wr("auth-internal",e=>{const t=vn(e.getProvider("auth").getImmediate());return(r=>new j4(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Sr(rb,sb,B4(n)),Sr(rb,sb,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z4=5*60,H4=ex("authIdTokenMaxAge")||z4;let ib=null;const K4=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>H4)return;const s=t==null?void 0:t.token;ib!==s&&(ib=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function G4(n=Yh()){const e=li(n,"auth");if(e.isInitialized())return e.getImmediate();const t=TM(n,{popupRedirectResolver:$4,persistence:[ML,YT,ZT]}),r=ex("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=K4(i.toString());mL(t,o,()=>o(t.currentUser)),pL(t,a=>o(a))}}const s=Yw("auth");return s&&SM(t,`http://${s}`),t}function W4(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}yM({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=gr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",W4().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});q4("Browser");const Q4={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},jv=ox(Q4),ue=oO(jv),Bv=BV(jv),Ke=G4(jv);try{aO(ue)}catch{}try{fL(Ke,YT)}catch{}gL(Ke,n=>{n||BT(Ke)});async function J4(n,e){try{return(await nL(Ke,n,e)).user}catch(t){throw t}}async function dA(n,e){try{return(await rL(Ke,n,e)).user}catch(t){throw t}}async function qv(n){try{await ZM(Ke,n)}catch(e){throw e}}async function Y4(n){try{const e=Ke.currentUser;if(e)await aL(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const Xi=Object.freeze(Object.defineProperty({__proto__:null,auth:Ke,createPlayerAccount:J4,db:ue,getMessaging:pg,resetPlayerPassword:qv,signInPlayer:dA,storage:Bv,updatePlayerPassword:Y4},Symbol.toStringTag,{value:"Module"})),Am="BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8";async function hA(){try{return await Nx()}catch{return!1}}async function fA(){if(typeof navigator>"u"||!navigator.serviceWorker)return null;const n=await navigator.serviceWorker.getRegistration();if(n&&n.active)return n;const e=await navigator.serviceWorker.register("/service-worker.js");return new Promise(t=>{if(e.active){t(e);return}const r=()=>{e.active&&(e.removeEventListener("statechange",r),t(e))};e.addEventListener("statechange",r)})}async function X4(n){var i;if(!await hA()||await Notification.requestPermission()!=="granted")return null;const t=pg(app);let r=n||await fA();const s=await Ox(t,r?{vapidKey:Am,serviceWorkerRegistration:r}:{vapidKey:Am});try{const o=((i=Ke==null?void 0:Ke.currentUser)==null?void 0:i.email)||"anonymous";o&&s&&await hn(Se(ue,"userPushTokens",o),{tokens:RO(s),lastToken:s,email:o,updatedAt:ri(),userAgent:navigator.userAgent,lastActivation:ri()},{merge:!0})}catch{}return s}async function Gu(){try{const n=localStorage.getItem("fcmToken");if(n){const r=pg(app);try{const s=await Ox(r,{vapidKey:Am});if(s===n)return{active:!0,token:s}}catch{}}const e=await fA(),t=await X4(e);return t?(localStorage.setItem("fcmToken",t),{active:!0,token:t}):{active:!1,error:"Failed to get token"}}catch(n){return{active:!1,error:n.message}}}function Z4(){setInterval(async()=>{try{const n=await Gu();n.active||(console.log("Push notifications inactive, attempting to reactivate..."),window.dispatchEvent(new CustomEvent("push-status-changed",{detail:n})))}catch(n){console.warn("Push health check failed:",n)}},5*60*1e3)}const e3={class:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between"},t3={class:"flex items-center space-x-3"},n3={class:"bg-white rounded-2xl shadow-2xl border border-gray-100 p-6 mx-4 max-w-sm w-full transform hover:scale-105 transition-all duration-300 cursor-pointer"},r3={class:"flex justify-center"},s3={key:0,class:"fixed inset-0 z-[200] flex items-center justify-center bg-black/50 backdrop-blur-sm"},i3={__name:"App",setup(n){const e=P(null),t=P(!1),r=P(!1),s=P(!1),i=P(!1);function o(v){v.preventDefault(),e.value=v,t.value=!0;const w=localStorage.getItem("hatcast-pwa-banner-last-shown"),E=Date.now(),A=24*60*60*1e3;w&&E-parseInt(w)<A?t.value=!1:localStorage.setItem("hatcast-pwa-banner-last-shown",E.toString())}async function a(){if(e.value){try{e.value.prompt();const{outcome:v}=await e.value.userChoice;v==="accepted"?(console.log("PWA installée avec succès"),localStorage.setItem("hatcast-pwa-installed","true")):console.log("Installation PWA refusée par l'utilisateur")}catch(v){console.error("Erreur lors de l'installation PWA:",v)}t.value=!1,e.value=null,i.value=!0}}function l(){i.value=!0,localStorage.setItem("hatcast-pwa-banner-dismissed",Date.now().toString())}function c(){t.value=!1,e.value=null,i.value=!0,localStorage.setItem("hatcast-pwa-installed","true")}function h(){const v=localStorage.getItem("hatcast-pwa-installed"),w=localStorage.getItem("hatcast-pwa-banner-dismissed");if(v==="true"){t.value=!1;return}if(w){const E=Date.now(),A=60*60*1e3;E-parseInt(w)<A&&(i.value=!0)}}function f(){s.value=!0,console.log("🚀 Début de la mise à jour PWA..."),setTimeout(async()=>{try{if(console.log("📡 Vérification du service worker..."),"serviceWorker"in navigator){const v=await navigator.serviceWorker.getRegistration();console.log("🔍 Enregistrement SW trouvé:",v),v&&v.active?(console.log("✅ Service worker actif trouvé, envoi du message SKIP_WAITING..."),v.active.postMessage({type:"SKIP_WAITING"}),console.log("📤 Message SKIP_WAITING envoyé"),await new Promise(w=>setTimeout(w,500)),console.log("⏳ Attente de 500ms terminée"),v.waiting?(console.log("🔄 Service worker en attente détecté, attente de l'activation..."),await new Promise(w=>{const E=()=>{v.waiting?(console.log("⏳ Service worker toujours en attente, nouvelle vérification dans 100ms..."),setTimeout(E,100)):(console.log("✅ Service worker activé avec succès"),w())};E()})):console.log("ℹ️ Aucun service worker en attente")):console.warn("⚠️ Aucun service worker actif trouvé")}else console.warn("⚠️ Service Worker non supporté sur cet appareil");console.log("🔄 Rechargement de la page..."),window.location.reload()}catch(v){console.error("❌ Erreur lors de la mise à jour:",v),s.value=!1,alert(`Erreur lors de la mise à jour: ${v.message}

Veuillez rafraîchir manuellement la page.`)}},1e3)}function m(){r.value=!0}return En(()=>{h(),Gu().then(v=>{v.active?console.log("Notifications push actives au démarrage"):console.log("Notifications push inactives au démarrage:",v.error)}),window.addEventListener("beforeinstallprompt",o),window.addEventListener("appinstalled",c),window.addEventListener("pwa-update-test",m),"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{s.value||(r.value=!0)}),navigator.serviceWorker.addEventListener("message",v=>{v.data&&v.data.type==="SW_UPDATING"&&console.log("Service worker en cours de mise à jour...")}),setInterval(()=>{navigator.serviceWorker.getRegistration().then(v=>{v&&v.update()})},60*60*1e3))}),Ym(()=>{window.removeEventListener("beforeinstallprompt",o),window.removeEventListener("appinstalled",c),window.removeEventListener("pwa-update-test",m)}),(v,w)=>{const E=IS("router-view");return k(),D(dt,null,[Ye(E),Ye(ip,{name:"install-banner",appear:""},{default:Ld(()=>[t.value&&!i.value?(k(),D("div",{key:0,class:"fixed top-0 left-0 right-0 z-50 bg-black text-white shadow-lg border-b border-gray-800",onClick:a},[d("div",e3,[w[1]||(w[1]=d("div",{class:"flex items-center space-x-3 flex-1"},[d("img",{src:QP,alt:"HatCast",class:"w-8 h-8 rounded-lg"}),d("div",{class:"flex-1"},[d("div",{class:"flex items-center space-x-2"},[d("span",{class:"font-semibold text-lg text-white"},"HatCast")]),d("p",{class:"text-sm text-gray-300 leading-tight"}," Installez l'app pour une meilleure expérience ")])],-1)),d("div",t3,[d("button",{class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",onClick:pt(a,["stop"])}," Installer "),d("button",{class:"text-gray-400 hover:text-white p-2 rounded-full hover:bg-gray-800 transition-colors",onClick:pt(l,["stop"]),"aria-label":"Fermer la barre d'installation"},w[0]||(w[0]=[d("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])])):ce("",!0)]),_:1}),Ye(ip,{name:"update-banner",appear:""},{default:Ld(()=>[r.value&&!s.value?(k(),D("div",{key:0,class:"fixed inset-0 z-[200] flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:f},[d("div",n3,[w[3]||(w[3]=d("div",{class:"flex justify-center mb-4"},[d("div",{class:"w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center shadow-lg"},[d("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})])])],-1)),w[4]||(w[4]=d("div",{class:"text-center mb-6"},[d("h3",{class:"text-xl font-bold text-gray-900 mb-2"}," 🎉 Nouvelle version disponible ! "),d("p",{class:"text-gray-600 leading-relaxed"}," HatCast a été amélioré avec de nouvelles fonctionnalités et corrections. Mettez à jour maintenant pour profiter des dernières améliorations. ")],-1)),d("div",r3,[d("button",{class:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 transition-all duration-200 flex items-center space-x-2",onClick:pt(f,["stop"])},w[2]||(w[2]=[d("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),d("span",null,"Mettre à jour maintenant",-1)]))]),w[5]||(w[5]=d("p",{class:"text-center text-xs text-gray-400 mt-4"}," Cliquez n'importe où pour fermer ",-1))])])):ce("",!0)]),_:1}),Ye(ip,{name:"update-progress",appear:""},{default:Ld(()=>[s.value?(k(),D("div",s3,w[6]||(w[6]=[d("div",{class:"bg-white rounded-2xl shadow-2xl border border-gray-100 p-8 mx-4 max-w-sm w-full text-center"},[d("div",{class:"flex justify-center mb-6"},[d("div",{class:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[d("svg",{class:"w-10 h-10 text-white animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})])])]),d("h3",{class:"text-xl font-bold text-gray-900 mb-3"}," Mise à jour en cours... "),d("p",{class:"text-gray-600"}," Veuillez patienter pendant qu'HatCast se met à jour "),d("div",{class:"mt-6 bg-gray-200 rounded-full h-2 overflow-hidden"},[d("div",{class:"bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full animate-pulse"})])],-1)]))):ce("",!0)]),_:1})],64)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const el=typeof document<"u";function pA(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function o3(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&pA(n.default)}const Nt=Object.assign;function Np(n,e){const t={};for(const r in e){const s=e[r];t[r]=ls(s)?s.map(n):n(s)}return t}const Wu=()=>{},ls=Array.isArray,mA=/#/g,a3=/&/g,l3=/\//g,u3=/=/g,c3=/\?/g,gA=/\+/g,d3=/%5B/g,h3=/%5D/g,vA=/%5E/g,f3=/%60/g,yA=/%7B/g,p3=/%7C/g,_A=/%7D/g,m3=/%20/g;function zv(n){return encodeURI(""+n).replace(p3,"|").replace(d3,"[").replace(h3,"]")}function g3(n){return zv(n).replace(yA,"{").replace(_A,"}").replace(vA,"^")}function Sm(n){return zv(n).replace(gA,"%2B").replace(m3,"+").replace(mA,"%23").replace(a3,"%26").replace(f3,"`").replace(yA,"{").replace(_A,"}").replace(vA,"^")}function v3(n){return Sm(n).replace(u3,"%3D")}function y3(n){return zv(n).replace(mA,"%23").replace(c3,"%3F")}function _3(n){return n==null?"":y3(n).replace(l3,"%2F")}function Pc(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const b3=/\/$/,w3=n=>n.replace(b3,"");function Op(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=T3(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:Pc(o)}}function x3(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function ob(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function I3(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&Nl(e.matched[r],t.matched[s])&&bA(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Nl(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function bA(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!E3(n[t],e[t]))return!1;return!0}function E3(n,e){return ls(n)?ab(n,e):ls(e)?ab(e,n):n===e}function ab(n,e){return ls(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function T3(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const Ni={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Rc;(function(n){n.pop="pop",n.push="push"})(Rc||(Rc={}));var Qu;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Qu||(Qu={}));function A3(n){if(!n)if(el){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),w3(n)}const S3=/^[^#]+#/;function P3(n,e){return n.replace(S3,"#")+e}function R3(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const Of=()=>({left:window.scrollX,top:window.scrollY});function C3(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=R3(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function lb(n,e){return(history.state?history.state.position-e:-1)+n}const Pm=new Map;function k3(n,e){Pm.set(n,e)}function D3(n){const e=Pm.get(n);return Pm.delete(n),e}let N3=()=>location.protocol+"//"+location.host;function wA(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),ob(l,"")}return ob(t,n)+r+s}function O3(n,e,t,r){let s=[],i=[],o=null;const a=({state:m})=>{const v=wA(n,location),w=t.value,E=e.value;let A=0;if(m){if(t.value=v,e.value=m,o&&o===w){o=null;return}A=E?m.position-E.position:0}else r(v);s.forEach(F=>{F(t.value,w,{delta:A,type:Rc.pop,direction:A?A>0?Qu.forward:Qu.back:Qu.unknown})})};function l(){o=t.value}function c(m){s.push(m);const v=()=>{const w=s.indexOf(m);w>-1&&s.splice(w,1)};return i.push(v),v}function h(){const{history:m}=window;m.state&&m.replaceState(Nt({},m.state,{scroll:Of()}),"")}function f(){for(const m of i)m();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",h)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",h,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function ub(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?Of():null}}function V3(n){const{history:e,location:t}=window,r={value:wA(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,h){const f=n.indexOf("#"),m=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:N3()+n+l;try{e[h?"replaceState":"pushState"](c,"",m),s.value=c}catch(v){console.error(v),t[h?"replace":"assign"](m)}}function o(l,c){const h=Nt({},e.state,ub(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,h,!0),r.value=l}function a(l,c){const h=Nt({},s.value,e.state,{forward:l,scroll:Of()});i(h.current,h,!0);const f=Nt({},ub(r.value,l,null),{position:h.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function M3(n){n=A3(n);const e=V3(n),t=O3(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=Nt({location:"",base:n,go:r,createHref:P3.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function L3(n){return typeof n=="string"||n&&typeof n=="object"}function xA(n){return typeof n=="string"||typeof n=="symbol"}const IA=Symbol("");var cb;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(cb||(cb={}));function Ol(n,e){return Nt(new Error,{type:n,[IA]:!0},e)}function Ms(n,e){return n instanceof Error&&IA in n&&(e==null||!!(n.type&e))}const db="[^/]+?",$3={sensitive:!1,strict:!1,start:!0,end:!0},F3=/[.+*?^${}()[\]/\\]/g;function U3(n,e){const t=Nt({},$3,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const h=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const m=c[f];let v=40+(t.sensitive?.25:0);if(m.type===0)f||(s+="/"),s+=m.value.replace(F3,"\\$&"),v+=40;else if(m.type===1){const{value:w,repeatable:E,optional:A,regexp:F}=m;i.push({name:w,repeatable:E,optional:A});const U=F||db;if(U!==db){v+=10;try{new RegExp(`(${U})`)}catch(L){throw new Error(`Invalid custom RegExp for param "${w}" (${U}): `+L.message)}}let $=E?`((?:${U})(?:/(?:${U}))*)`:`(${U})`;f||($=A&&c.length<2?`(?:/${$})`:"/"+$),A&&($+="?"),s+=$,v+=20,A&&(v+=-8),E&&(v+=-20),U===".*"&&(v+=-50)}h.push(v)}r.push(h)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const h=c.match(o),f={};if(!h)return null;for(let m=1;m<h.length;m++){const v=h[m]||"",w=i[m-1];f[w.name]=v&&w.repeatable?v.split("/"):v}return f}function l(c){let h="",f=!1;for(const m of n){(!f||!h.endsWith("/"))&&(h+="/"),f=!1;for(const v of m)if(v.type===0)h+=v.value;else if(v.type===1){const{value:w,repeatable:E,optional:A}=v,F=w in c?c[w]:"";if(ls(F)&&!E)throw new Error(`Provided param "${w}" is an array but it is not repeatable (* or + modifiers)`);const U=ls(F)?F.join("/"):F;if(!U)if(A)m.length<2&&(h.endsWith("/")?h=h.slice(0,-1):f=!0);else throw new Error(`Missing required param "${w}"`);h+=U}}return h||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function j3(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function EA(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=j3(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(hb(r))return 1;if(hb(s))return-1}return s.length-r.length}function hb(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const B3={type:0,value:""},q3=/[a-zA-Z0-9_]/;function z3(n){if(!n)return[[]];if(n==="/")return[[B3]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(v){throw new Error(`ERR (${t})/"${c}": ${v}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",h="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:h,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function m(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):m();break;case 4:m(),t=r;break;case 1:l==="("?t=2:q3.test(l)?m():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?h[h.length-1]=="\\"?h=h.slice(0,-1)+l:t=3:h+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,h="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function H3(n,e,t){const r=U3(z3(n.path),t),s=Nt(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function K3(n,e){const t=[],r=new Map;e=gb({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,m,v){const w=!v,E=pb(f);E.aliasOf=v&&v.record;const A=gb(e,f),F=[E];if("alias"in f){const L=typeof f.alias=="string"?[f.alias]:f.alias;for(const se of L)F.push(pb(Nt({},E,{components:v?v.record.components:E.components,path:se,aliasOf:v?v.record:E})))}let U,$;for(const L of F){const{path:se}=L;if(m&&se[0]!=="/"){const te=m.record.path,T=te[te.length-1]==="/"?"":"/";L.path=m.record.path+(se&&T+se)}if(U=H3(L,m,A),v?v.alias.push(U):($=$||U,$!==U&&$.alias.push(U),w&&f.name&&!mb(U)&&o(f.name)),TA(U)&&l(U),E.children){const te=E.children;for(let T=0;T<te.length;T++)i(te[T],U,v&&v.children[T])}v=v||U}return $?()=>{o($)}:Wu}function o(f){if(xA(f)){const m=r.get(f);m&&(r.delete(f),t.splice(t.indexOf(m),1),m.children.forEach(o),m.alias.forEach(o))}else{const m=t.indexOf(f);m>-1&&(t.splice(m,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const m=Q3(f,t);t.splice(m,0,f),f.record.name&&!mb(f)&&r.set(f.record.name,f)}function c(f,m){let v,w={},E,A;if("name"in f&&f.name){if(v=r.get(f.name),!v)throw Ol(1,{location:f});A=v.record.name,w=Nt(fb(m.params,v.keys.filter($=>!$.optional).concat(v.parent?v.parent.keys.filter($=>$.optional):[]).map($=>$.name)),f.params&&fb(f.params,v.keys.map($=>$.name))),E=v.stringify(w)}else if(f.path!=null)E=f.path,v=t.find($=>$.re.test(E)),v&&(w=v.parse(E),A=v.record.name);else{if(v=m.name?r.get(m.name):t.find($=>$.re.test(m.path)),!v)throw Ol(1,{location:f,currentLocation:m});A=v.record.name,w=Nt({},m.params,f.params),E=v.stringify(w)}const F=[];let U=v;for(;U;)F.unshift(U.record),U=U.parent;return{name:A,path:E,params:w,matched:F,meta:W3(F)}}n.forEach(f=>i(f));function h(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:h,getRoutes:a,getRecordMatcher:s}}function fb(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function pb(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:G3(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function G3(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function mb(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function W3(n){return n.reduce((e,t)=>Nt(e,t.meta),{})}function gb(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function Q3(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;EA(n,e[i])<0?r=i:t=i+1}const s=J3(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function J3(n){let e=n;for(;e=e.parent;)if(TA(e)&&EA(n,e)===0)return e}function TA({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function Y3(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(gA," "),o=i.indexOf("="),a=Pc(o<0?i:i.slice(0,o)),l=o<0?null:Pc(i.slice(o+1));if(a in e){let c=e[a];ls(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function vb(n){let e="";for(let t in n){const r=n[t];if(t=v3(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(ls(r)?r.map(i=>i&&Sm(i)):[r&&Sm(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function X3(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=ls(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const Z3=Symbol(""),yb=Symbol(""),Vf=Symbol(""),Hv=Symbol(""),Rm=Symbol("");function xu(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function Li(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=m=>{m===!1?l(Ol(4,{from:t,to:e})):m instanceof Error?l(m):L3(m)?l(Ol(2,{from:e,to:m})):(o&&r.enterCallbacks[s]===o&&typeof m=="function"&&o.push(m),a())},h=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(h);n.length<3&&(f=f.then(c)),f.catch(m=>l(m))})}function Vp(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(pA(l)){const h=(l.__vccOpts||l)[e];h&&i.push(Li(h,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(h=>{if(!h)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=o3(h)?h.default:h;o.mods[a]=h,o.components[a]=f;const v=(f.__vccOpts||f)[e];return v&&Li(v,t,r,o,a,s)()}))}}return i}function _b(n){const e=ss(Vf),t=ss(Hv),r=$e(()=>{const l=rs(n.to);return e.resolve(l)}),s=$e(()=>{const{matched:l}=r.value,{length:c}=l,h=l[c-1],f=t.matched;if(!h||!f.length)return-1;const m=f.findIndex(Nl.bind(null,h));if(m>-1)return m;const v=bb(l[c-2]);return c>1&&bb(h)===v&&f[f.length-1].path!==v?f.findIndex(Nl.bind(null,l[c-2])):m}),i=$e(()=>s.value>-1&&s$(t.params,r.value.params)),o=$e(()=>s.value>-1&&s.value===t.matched.length-1&&bA(t.params,r.value.params));function a(l={}){if(r$(l)){const c=e[rs(n.replace)?"replace":"push"](rs(n.to)).catch(Wu);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:$e(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function e$(n){return n.length===1?n[0]:n}const t$=bw({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:_b,setup(n,{slots:e}){const t=Bh(_b(n)),{options:r}=ss(Vf),s=$e(()=>({[wb(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[wb(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&e$(e.default(t));return n.custom?i:rg("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),n$=t$;function r$(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function s$(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!ls(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function bb(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const wb=(n,e,t)=>n??e??t,i$=bw({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=ss(Rm),s=$e(()=>n.route||r.value),i=ss(yb,0),o=$e(()=>{let c=rs(i);const{matched:h}=s.value;let f;for(;(f=h[c])&&!f.components;)c++;return c}),a=$e(()=>s.value.matched[o.value]);Fd(yb,$e(()=>o.value+1)),Fd(Z3,a),Fd(Rm,s);const l=P();return St(()=>[l.value,a.value,n.name],([c,h,f],[m,v,w])=>{h&&(h.instances[f]=c,v&&v!==h&&c&&c===m&&(h.leaveGuards.size||(h.leaveGuards=v.leaveGuards),h.updateGuards.size||(h.updateGuards=v.updateGuards))),c&&h&&(!v||!Nl(h,v)||!m)&&(h.enterCallbacks[f]||[]).forEach(E=>E(c))},{flush:"post"}),()=>{const c=s.value,h=n.name,f=a.value,m=f&&f.components[h];if(!m)return xb(t.default,{Component:m,route:c});const v=f.props[h],w=v?v===!0?c.params:typeof v=="function"?v(c):v:null,A=rg(m,Nt({},w,e,{onVnodeUnmounted:F=>{F.component.isUnmounted&&(f.instances[h]=null)},ref:l}));return xb(t.default,{Component:A,route:c})||A}}});function xb(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const o$=i$;function a$(n){const e=K3(n.routes,n),t=n.parseQuery||Y3,r=n.stringifyQuery||vb,s=n.history,i=xu(),o=xu(),a=xu(),l=Z1(Ni);let c=Ni;el&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=Np.bind(null,Y=>""+Y),f=Np.bind(null,_3),m=Np.bind(null,Pc);function v(Y,Te){let be,De;return xA(Y)?(be=e.getRecordMatcher(Y),De=Te):De=Y,e.addRoute(De,be)}function w(Y){const Te=e.getRecordMatcher(Y);Te&&e.removeRoute(Te)}function E(){return e.getRoutes().map(Y=>Y.record)}function A(Y){return!!e.getRecordMatcher(Y)}function F(Y,Te){if(Te=Nt({},Te||l.value),typeof Y=="string"){const O=Op(t,Y,Te.path),H=e.resolve({path:O.path},Te),K=s.createHref(O.fullPath);return Nt(O,H,{params:m(H.params),hash:Pc(O.hash),redirectedFrom:void 0,href:K})}let be;if(Y.path!=null)be=Nt({},Y,{path:Op(t,Y.path,Te.path).path});else{const O=Nt({},Y.params);for(const H in O)O[H]==null&&delete O[H];be=Nt({},Y,{params:f(O)}),Te.params=f(Te.params)}const De=e.resolve(be,Te),ot=Y.hash||"";De.params=h(m(De.params));const vt=x3(r,Nt({},Y,{hash:g3(ot),path:De.path})),S=s.createHref(vt);return Nt({fullPath:vt,hash:ot,query:r===vb?X3(Y.query):Y.query||{}},De,{redirectedFrom:void 0,href:S})}function U(Y){return typeof Y=="string"?Op(t,Y,l.value.path):Nt({},Y)}function $(Y,Te){if(c!==Y)return Ol(8,{from:Te,to:Y})}function L(Y){return T(Y)}function se(Y){return L(Nt(U(Y),{replace:!0}))}function te(Y){const Te=Y.matched[Y.matched.length-1];if(Te&&Te.redirect){const{redirect:be}=Te;let De=typeof be=="function"?be(Y):be;return typeof De=="string"&&(De=De.includes("?")||De.includes("#")?De=U(De):{path:De},De.params={}),Nt({query:Y.query,hash:Y.hash,params:De.path!=null?{}:Y.params},De)}}function T(Y,Te){const be=c=F(Y),De=l.value,ot=Y.state,vt=Y.force,S=Y.replace===!0,O=te(be);if(O)return T(Nt(U(O),{state:typeof O=="object"?Nt({},ot,O.state):ot,force:vt,replace:S}),Te||be);const H=be;H.redirectedFrom=Te;let K;return!vt&&I3(r,De,be)&&(K=Ol(16,{to:H,from:De}),X(De,De,!0,!1)),(K?Promise.resolve(K):C(H,De)).catch(ee=>Ms(ee)?Ms(ee,2)?ee:Ce(ee):le(ee,H,De)).then(ee=>{if(ee){if(Ms(ee,2))return T(Nt({replace:S},U(ee.to),{state:typeof ee.to=="object"?Nt({},ot,ee.to.state):ot,force:vt}),Te||H)}else ee=N(H,De,!0,S,ot);return M(H,De,ee),ee})}function _(Y,Te){const be=$(Y,Te);return be?Promise.reject(be):Promise.resolve()}function I(Y){const Te=Ze.values().next().value;return Te&&typeof Te.runWithContext=="function"?Te.runWithContext(Y):Y()}function C(Y,Te){let be;const[De,ot,vt]=l$(Y,Te);be=Vp(De.reverse(),"beforeRouteLeave",Y,Te);for(const O of De)O.leaveGuards.forEach(H=>{be.push(Li(H,Y,Te))});const S=_.bind(null,Y,Te);return be.push(S),qt(be).then(()=>{be=[];for(const O of i.list())be.push(Li(O,Y,Te));return be.push(S),qt(be)}).then(()=>{be=Vp(ot,"beforeRouteUpdate",Y,Te);for(const O of ot)O.updateGuards.forEach(H=>{be.push(Li(H,Y,Te))});return be.push(S),qt(be)}).then(()=>{be=[];for(const O of vt)if(O.beforeEnter)if(ls(O.beforeEnter))for(const H of O.beforeEnter)be.push(Li(H,Y,Te));else be.push(Li(O.beforeEnter,Y,Te));return be.push(S),qt(be)}).then(()=>(Y.matched.forEach(O=>O.enterCallbacks={}),be=Vp(vt,"beforeRouteEnter",Y,Te,I),be.push(S),qt(be))).then(()=>{be=[];for(const O of o.list())be.push(Li(O,Y,Te));return be.push(S),qt(be)}).catch(O=>Ms(O,8)?O:Promise.reject(O))}function M(Y,Te,be){a.list().forEach(De=>I(()=>De(Y,Te,be)))}function N(Y,Te,be,De,ot){const vt=$(Y,Te);if(vt)return vt;const S=Te===Ni,O=el?history.state:{};be&&(De||S?s.replace(Y.fullPath,Nt({scroll:S&&O&&O.scroll},ot)):s.push(Y.fullPath,ot)),l.value=Y,X(Y,Te,be,S),Ce()}let R;function Qe(){R||(R=s.listen((Y,Te,be)=>{if(!mt.listening)return;const De=F(Y),ot=te(De);if(ot){T(Nt(ot,{replace:!0,force:!0}),De).catch(Wu);return}c=De;const vt=l.value;el&&k3(lb(vt.fullPath,be.delta),Of()),C(De,vt).catch(S=>Ms(S,12)?S:Ms(S,2)?(T(Nt(U(S.to),{force:!0}),De).then(O=>{Ms(O,20)&&!be.delta&&be.type===Rc.pop&&s.go(-1,!1)}).catch(Wu),Promise.reject()):(be.delta&&s.go(-be.delta,!1),le(S,De,vt))).then(S=>{S=S||N(De,vt,!1),S&&(be.delta&&!Ms(S,8)?s.go(-be.delta,!1):be.type===Rc.pop&&Ms(S,20)&&s.go(-1,!1)),M(De,vt,S)}).catch(Wu)}))}let it=xu(),ye=xu(),ne;function le(Y,Te,be){Ce(Y);const De=ye.list();return De.length?De.forEach(ot=>ot(Y,Te,be)):console.error(Y),Promise.reject(Y)}function oe(){return ne&&l.value!==Ni?Promise.resolve():new Promise((Y,Te)=>{it.add([Y,Te])})}function Ce(Y){return ne||(ne=!Y,Qe(),it.list().forEach(([Te,be])=>Y?be(Y):Te()),it.reset()),Y}function X(Y,Te,be,De){const{scrollBehavior:ot}=n;if(!el||!ot)return Promise.resolve();const vt=!be&&D3(lb(Y.fullPath,0))||(De||!be)&&history.state&&history.state.scroll||null;return en().then(()=>ot(Y,Te,vt)).then(S=>S&&C3(S)).catch(S=>le(S,Y,Te))}const W=Y=>s.go(Y);let xe;const Ze=new Set,mt={currentRoute:l,listening:!0,addRoute:v,removeRoute:w,clearRoutes:e.clearRoutes,hasRoute:A,getRoutes:E,resolve:F,options:n,push:L,replace:se,go:W,back:()=>W(-1),forward:()=>W(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:ye.add,isReady:oe,install(Y){const Te=this;Y.component("RouterLink",n$),Y.component("RouterView",o$),Y.config.globalProperties.$router=Te,Object.defineProperty(Y.config.globalProperties,"$route",{enumerable:!0,get:()=>rs(l)}),el&&!xe&&l.value===Ni&&(xe=!0,L(s.location).catch(ot=>{}));const be={};for(const ot in Ni)Object.defineProperty(be,ot,{get:()=>l.value[ot],enumerable:!0});Y.provide(Vf,Te),Y.provide(Hv,nw(be)),Y.provide(Rm,l);const De=Y.unmount;Ze.add(Y),Y.unmount=function(){Ze.delete(Y),Ze.size<1&&(c=Ni,R&&R(),R=null,l.value=Ni,xe=!1,ne=!1),De()}}};function qt(Y){return Y.reduce((Te,be)=>Te.then(()=>I(be)),Promise.resolve())}return mt}function l$(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>Nl(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>Nl(c,l))||s.push(l))}return[t,r,s]}function Jl(){return ss(Vf)}function Ea(n){return ss(Hv)}const u$="modulepreload",c$=function(n){return"/"+n},Ib={},an=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=c$(i),i in Ib)return;Ib[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":u$,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((h,f)=>{c.addEventListener("load",h),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function d$(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=n;let a,l;const c=async(f=!0)=>{await l};async function h(){if("serviceWorker"in navigator){const{Workbox:f}=await an(()=>import("./workbox-window.prod.es5-5ffdab76.js"),[]);a=new f("/service-worker.js",{scope:"/",type:"classic"}),a.addEventListener("activated",m=>{(m.isUpdate||m.isExternal)&&window.location.reload()}),a.addEventListener("installed",m=>{m.isUpdate||r==null||r()}),a.register({immediate:e}).then(m=>{i?i("/service-worker.js",m):s==null||s(m)}).catch(m=>{o==null||o(m)})}}return l=h(),c}const Ta="seasons";async function h$(n,e,t,r="",s=""){return await Gl(st(ue,Ta),{name:n,slug:e,pinCode:t,description:r,logoUrl:s,createdAt:ri()})}async function f$(n){return await Dl(Se(ue,Ta,n))}async function tl(){const n=wc(st(ue,Ta),pO("createdAt","desc"));return(await Vt(n)).docs.map(t=>({id:t.id,...t.data()}))}async function Nh(n,e){const t=await Gt(Se(ue,Ta,n));return t.exists()?t.data().pinCode===e:!1}async function Cm(n){const e=await Gt(Se(ue,Ta,n));return e.exists()?e.data().pinCode:null}async function Iu(n,e){const t=Se(ue,Ta,n);await wa(t,{sortOrder:e})}async function p$(n,e){const t=Se(ue,Ta,n);await wa(t,e)}const m$=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function g$(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function AA(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function v$(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function SA(n){if(!n)return!1;const e=String(n).toLowerCase();return m$.some(t=>e.includes(t.toLowerCase()))}function km(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?v$(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>km(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=SA(t)?"••••":km(r);return e}return n}function y$(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&SA(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(km(r))}return e}const _$=AA(g$());function Vd(n,e){const t=AA(n);return(...r)=>{if(t<_$)return;const s=y$(r);console[e](...s)}}const j={debug:Vd("debug","log"),info:Vd("info","info"),warn:Vd("warn","warn"),error:Vd("error","error")},Kv="lastVisitedSeason",PA="lastVisitedSeasonTimestamp";async function b$(n){if(n)try{const e=Ke.currentUser,t=e==null?void 0:e.email;try{localStorage.setItem(Kv,n),localStorage.setItem(PA,Date.now().toString())}catch(r){j.warn("Erreur lors de la sauvegarde localStorage",r)}if(t)try{const r=Se(ue,"userPreferences",t);await hn(r,{lastVisitedSeason:n,lastVisitedSeasonTimestamp:Date.now()},{merge:!0}),j.debug("Préférence de saison sauvegardée dans Firebase",{seasonSlug:n,userEmail:t})}catch(r){j.warn("Erreur lors de la sauvegarde Firebase",r)}}catch(e){j.error("Erreur lors de la mémorisation de la saison",e)}}async function RA(){try{const n=Ke.currentUser,e=n==null?void 0:n.email;if(e)try{const t=Se(ue,"userPreferences",e),r=await Gt(t);if(r.exists()){const s=r.data();if(s.lastVisitedSeason)return j.debug("Préférence de saison récupérée depuis Firebase",{seasonSlug:s.lastVisitedSeason}),s.lastVisitedSeason}}catch(t){j.warn("Erreur lors de la récupération Firebase",t)}try{const t=localStorage.getItem(Kv);if(t)return j.debug("Préférence de saison récupérée depuis localStorage",{seasonSlug:t}),t}catch(t){j.warn("Erreur lors de la lecture localStorage",t)}return null}catch(n){return j.error("Erreur lors de la récupération de la dernière saison",n),null}}async function w$(n=null){var e;try{const t=n||((e=Ke.currentUser)==null?void 0:e.email);try{localStorage.removeItem(Kv),localStorage.removeItem(PA)}catch(r){j.warn("Erreur lors du nettoyage localStorage",r)}if(t)try{const r=Se(ue,"userPreferences",t);await hn(r,{lastVisitedSeason:null,lastVisitedSeasonTimestamp:null},{merge:!0}),j.debug("Préférence de saison nettoyée dans Firebase",{userEmail:t})}catch(r){j.warn("Erreur lors du nettoyage Firebase",r)}}catch(t){j.error("Erreur lors du nettoyage des préférences",t)}}function x$(n,e){return!n||!e||!Array.isArray(e)?!1:e.some(t=>t.slug===n)}const Ys=P(null),Qi=P(!1),js=P(!1),I$=$e(()=>{var n;return!!Ys.value&&!((n=Ys.value)!=null&&n.isAnonymous)});$e(()=>!!Ys.value);function pl(){var n;try{const e=Ke.currentUser;e!==Ys.value&&(Ys.value=e,j.debug("Synchronisation forcée de l'état d'authentification",{user:((n=Ys.value)==null?void 0:n.email)||"non connecté"}))}catch(e){j.error("Erreur lors de la synchronisation forcée",e)}}function E$(){var n;if(j.debug("Tentative d'initialisation du service d'authentification",{isInitialized:Qi.value,isInitializing:js.value}),Qi.value||js.value){j.debug("Service déjà initialisé ou en cours d'initialisation, sortie");return}js.value=!0,j.debug("Marquage du service comme en cours d'initialisation");try{Ys.value=Ke.currentUser,j.debug("État initial de l'utilisateur:",((n=Ys.value)==null?void 0:n.email)||"non connecté");const e=Ke.onAuthStateChanged(t=>{Ys.value=t,Qi.value=!0,js.value=!1,j.debug("État d'authentification changé",{isLoggedIn:!!t,email:(t==null?void 0:t.email)||"non connecté"})});window._authStateUnsubscribe=e,j.info("Service d'état d'authentification initialisé avec succès")}catch(e){j.error("Erreur lors de l'initialisation du service d'authentification:",e),js.value=!1}}function CA(){return new Promise((n,e)=>{if(j.debug("waitForInitialization appelé",{isInitialized:Qi.value,isInitializing:js.value}),Qi.value){j.debug("Service déjà initialisé, résolution immédiate"),n();return}if(!js.value){j.warn("Service d'authentification non initialisé et non en cours d'initialisation"),e(new Error("Service d'authentification non initialisé"));return}const t=setInterval(()=>{j.debug("Vérification de l'initialisation...",{isInitialized:Qi.value,isInitializing:js.value}),Qi.value&&(clearInterval(t),j.debug("Service initialisé, résolution"),n())},100);setTimeout(()=>{clearInterval(t),j.warn("Timeout de waitForInitialization, rejet de la promesse"),e(new Error("Timeout d'initialisation du service d'authentification"))},5e3)})}function T$(){j.debug("Initialisation forcée demandée"),!Qi.value&&!js.value&&Oh()}function Oh(){if(j.debug("Tentative d'auto-initialisation du service d'authentification"),typeof Ke>"u"||!Ke){j.warn("Firebase auth non disponible, nouvelle tentative dans 500ms"),setTimeout(Oh,500);return}try{E$()}catch(n){j.error("Erreur lors de l'auto-initialisation:",n),setTimeout(Oh,1e3)}}setTimeout(Oh,100);const A$={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center"},S$={class:"text-center"},P$={class:"text-white text-lg"},R$={__name:"SeasonResolver",setup(n){const e=Jl(),t=P("Chargement...");return En(async()=>{try{t.value="Vérification de votre session...",pl(),await CA();const r=await new Promise((o,a)=>{const l=setTimeout(()=>{a(new Error("Timeout Firebase Auth"))},3e3),c=Ke.onAuthStateChanged(h=>{clearTimeout(l),c(),o(h)});Ke.currentUser&&(clearTimeout(l),c(),o(Ke.currentUser))}),s=r==null?void 0:r.email;if(!s){j.info("Utilisateur non connecté, redirection vers /seasons"),e.replace("/seasons");return}t.value="Récupération de vos préférences...";const i=await RA();if(!i){j.info("Aucune saison mémorisée, redirection vers /seasons"),e.replace("/seasons");return}t.value="Vérification de la saison...";try{const o=await tl();if(!x$(i,o)){j.info("Saison mémorisée n'existe plus, redirection vers /seasons"),await w$(s),e.replace("/seasons");return}}catch(o){j.error("Erreur lors de la vérification des saisons",o),e.replace("/seasons");return}j.info("Redirection vers la saison mémorisée",{seasonSlug:i}),e.replace(`/season/${i}`)}catch(r){j.error("Erreur lors de la résolution de la saison",r),e.replace("/seasons")}}),(r,s)=>(k(),D("div",A$,[d("div",S$,[s[0]||(s[0]=d("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"},null,-1)),d("p",P$,re(t.value),1)])]))}},C$="/logos/hatcast-mask.png",kA="/logos/hatcast-logo-mobile.png";async function k$(n,e=800,t=800,r=.8){return new Promise((s,i)=>{const o=document.createElement("canvas"),a=o.getContext("2d"),l=new Image;l.onload=()=>{let{width:c,height:h}=l;c>e&&(h=h*e/c,c=e),h>t&&(c=c*t/h,h=t),o.width=c,o.height=h,a.drawImage(l,0,0,c,h),o.toBlob(f=>{if(f){const m=new File([f],n.name,{type:"image/jpeg",lastModified:Date.now()});s(m)}else i(new Error("Erreur lors du redimensionnement"))},"image/jpeg",r)},l.onerror=()=>i(new Error("Erreur lors du chargement de l'image")),l.src=URL.createObjectURL(n)})}async function DA(){if(!Ke.currentUser){j.info("Aucun utilisateur connecté, tentative de connexion anonyme...");try{await BT(Ke),j.info("Connexion anonyme réussie")}catch(n){throw j.error("Erreur lors de la connexion anonyme:",n),new Error("Impossible de s'authentifier: "+n.message)}}await new Promise(n=>setTimeout(n,1e3))}async function D$(n,e,t={}){var r;try{if(j.info("Début upload image",{fileName:n.name,path:e,originalSize:`${(n.size/1024/1024).toFixed(2)}MB`}),await DA(),!n.type.startsWith("image/"))throw new Error("Le fichier doit être une image");if(n.size>10*1024*1024)throw new Error("L'image est trop volumineuse (max 10MB)");let s=n;if(t.resize!==!1&&(n.size>1024*1024||t.forceResize)){j.info("Redimensionnement de l'image pour optimiser les performances...");try{s=await k$(n,t.maxWidth||800,t.maxHeight||800,t.quality||.8),j.info("Image redimensionnée",{newSize:`${(s.size/1024/1024).toFixed(2)}MB`,compression:`${((1-s.size/n.size)*100).toFixed(1)}%`})}catch(w){j.warn("Erreur lors du redimensionnement, utilisation du fichier original:",w),s=n}}const a=`${Date.now()}_${n.name}`,l=`${e}/${a}`,c=vT(Bv,l);j.info("Tentative d'upload vers Firebase Storage...",{fullPath:l,user:(r=Ke.currentUser)==null?void 0:r.uid,isAuthenticated:!!Ke.currentUser,finalSize:`${(s.size/1024/1024).toFixed(2)}MB`});const h=FV(c,s),f=new Promise((w,E)=>setTimeout(()=>E(new Error("Timeout: Upload trop long")),3e4)),m=await Promise.race([h,f]);j.info("Image uploadée avec succès",{fullPath:l});const v=await UV(m.ref);return j.info("URL de téléchargement récupérée",{downloadURL:v}),v}catch(s){if(j.error("Erreur lors de l'upload de l'image",s),s.message.includes("CORS")||s.message.includes("preflight")||s.message.includes("permission")||s.message.includes("unauthenticated")||s.message.includes("ERR_FAILED")||s.message.includes("Timeout"))return j.warn("Erreur d'accès détectée, utilisation du stockage local temporaire",s.message),await N$(n,e);throw s}}async function N$(n,e){return new Promise((t,r)=>{const s=new FileReader;s.onload=i=>{const o=i.target.result;j.info("Image stockée localement en base64",{path:e}),t(o)},s.onerror=()=>r(new Error("Erreur lors de la lecture du fichier")),s.readAsDataURL(n)})}async function O$(n){var e;try{if(j.info("Début suppression image",{imageUrl:n}),n.startsWith("data:image/")){j.info("Image locale (base64), suppression ignorée");return}await DA();const r=(e=new URL(n).pathname.split("/o/")[1])==null?void 0:e.split("?")[0];if(!r)throw new Error("Impossible d'extraire le chemin de l'image");const s=decodeURIComponent(r),i=vT(Bv,s);await jV(i),j.info("Image supprimée avec succès",{decodedPath:s})}catch(t){throw j.error("Erreur lors de la suppression de l'image",t),t}}function V$(n){return n&&n.includes("firebasestorage.googleapis.com")}const Mp=7*24*60*60*1e3,Eu="hatcast_pin_session";class M${constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(Eu);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<Mp){try{t.timestamp=Date.now(),localStorage.setItem(Eu,JSON.stringify(t))}catch{}return t}else this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(Eu,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){if(!this.sessionData)return!1;const t=this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<Mp;if(t)try{this.sessionData.timestamp=Date.now(),localStorage.setItem(Eu,JSON.stringify(this.sessionData))}catch{}return t}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(Eu),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=Mp-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const Gn=new M$,L$={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},$$={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},F$={class:"text-center mb-6"},U$={class:"text-gray-300"},j$={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},B$={class:"text-sm text-green-400"},q$={class:"mb-6"},z$={class:"mb-4"},H$={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},K$={class:"flex justify-end space-x-3"},G$=["disabled"],NA={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P(""),o=P(null);St(()=>t.show,h=>{h&&(s.value="",i.value="",en(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(h,f)=>n.show?(k(),D("div",L$,[d("div",$$,[d("div",F$,[f[1]||(f[1]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),d("p",U$,re(n.message),1),n.sessionInfo?(k(),D("div",j$,[d("p",B$," Session active : "+re(n.sessionInfo.timeRemaining)+" min restantes ",1)])):ce("",!0)]),d("div",q$,[d("div",z$,[f[3]||(f[3]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),ut(d("input",{"onUpdate:modelValue":f[0]||(f[0]=m=>s.value=m),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[rr(l,["enter"]),rr(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[Mt,s.value]])]),f[4]||(f[4]=d("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(k(),D("div",H$,re(i.value||t.error),1)):ce("",!0),d("div",K$,[d("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,G$)])])])):ce("",!0)}},Eb="hatcast_trusted_players",Tb=180*24*60*60*1e3;class W${constructor(){this.trustedMap=this.load()}load(){try{const e=localStorage.getItem(Eb);if(!e)return{};const t=JSON.parse(e);return typeof t=="object"&&t!==null?t:{}}catch{return{}}}persist(){try{localStorage.setItem(Eb,JSON.stringify(this.trustedMap))}catch{}}isPasswordCached(e){if(!e)return!1;const t=this.trustedMap[e];if(!t)return!1;const r=Date.now(),s=r-t<Tb;return s?(this.trustedMap[e]=r,this.persist()):(delete this.trustedMap[e],this.persist()),s}getCachedPassword(e){return null}saveSession(e,t){e&&(this.trustedMap[e]=Date.now(),this.persist())}clearSession(e){e&&(delete this.trustedMap[e],this.persist())}clearExpiredSessions(){const e=Date.now();let t=!1;for(const[r,s]of Object.entries(this.trustedMap))e-s>Tb&&(delete this.trustedMap[r],t=!0);t&&this.persist()}clearAllSessions(){this.trustedMap={},this.persist()}}const ho=new W$,Q$={class:"mt-4"},J$={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-2"},OA={__name:"AccountBenefitsHint",setup(n){const e=P(!1);return(t,r)=>(k(),D("div",Q$,[d("button",{onClick:r[0]||(r[0]=s=>e.value=!e.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[r[1]||(r[1]=d("h3",{class:"text-sm font-semibold text-blue-300"},"💡 A quoi sert un compte ?",-1)),d("span",{class:Qt(["text-blue-300 transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(k(),D("div",J$,r[2]||(r[2]=[d("div",{class:"text-gray-300"},"Ça fonctionne très bien sans compte. Mais si vous en créez un, vous aurez quelques trucs sympas en plus :",-1),d("div",null,[bt("• "),d("span",{class:"text-blue-300"},"Protégez vos saisies :"),bt(" vous êtes sûr que personne n'a changé vos dispos car vous êtes le seul à pouvoir les modifier")],-1),d("div",null,[bt("• "),d("span",{class:"text-blue-300"},"Notifications :"),bt(" nouveaux spectacles, disponibilités et sélections dans votre boite mail")],-1),d("div",null,[bt("• "),d("span",{class:"text-blue-300"},"Saisie simplifiée :"),bt(" votre joueur reste toujours en haut de la liste")],-1)]))):ce("",!0)]))}},Y$={class:"space-y-4"},X$={class:"flex items-center justify-between"},Z$={class:"flex items-center gap-2 text-gray-300 text-sm"},eF={key:0,class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},tF={key:1,class:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm"},nF={class:"flex justify-center gap-3 mt-2"},rF=["disabled"],sF={key:0,class:"animate-spin"},iF={key:1},VA={__name:"AccountLoginModal",props:{show:{type:Boolean,default:!1}},emits:["close","success"],setup(n,{emit:e}){const t=e,r=P(""),s=P(""),i=P(!1),o=P(""),a=P(""),l=P(!0),c=$e(()=>!!r.value&&r.value.includes("@")&&!!s.value);async function h(){if(c.value){i.value=!0,o.value="",a.value="";try{if(await dA(r.value.trim(),s.value),l.value)try{ho.saveSession(r.value.trim())}catch{}t("success")}catch{o.value="Email ou mot de passe incorrect"}finally{i.value=!1}}}async function f(){if(!r.value||!r.value.includes("@")){o.value="Saisissez votre email pour recevoir un lien de réinitialisation",setTimeout(()=>{o.value=""},2500);return}i.value=!0,o.value="",a.value="";try{await qv(r.value.trim()),a.value="Email de réinitialisation envoyé"}catch{o.value="Impossible d'envoyer l'email de réinitialisation"}finally{i.value=!1}}return(m,v)=>n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:v[6]||(v[6]=w=>m.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:v[5]||(v[5]=pt(()=>{},["stop"]))},[d("button",{onClick:v[0]||(v[0]=w=>m.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),v[10]||(v[10]=jn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Se connecter</h2><p class="text-sm text-gray-300">Connectez-vous pour gérer votre compte et vos préférences</p></div>',1)),d("div",Y$,[Ye(OA),d("div",null,[v[7]||(v[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Email",-1)),ut(d("input",{"onUpdate:modelValue":v[1]||(v[1]=w=>r.value=w),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Mt,r.value]])]),d("div",null,[v[8]||(v[8]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),ut(d("input",{"onUpdate:modelValue":v[2]||(v[2]=w=>s.value=w),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe"},null,512),[[Mt,s.value]])]),d("div",X$,[d("label",Z$,[ut(d("input",{type:"checkbox","onUpdate:modelValue":v[3]||(v[3]=w=>l.value=w),class:"w-4 h-4"},null,512),[[Gi,l.value]]),v[9]||(v[9]=d("span",null,"Rester connecté sur cet appareil",-1))]),d("button",{onClick:f,class:"text-sm text-blue-400 hover:text-blue-300 underline"},"Mot de passe oublié ?")]),o.value?(k(),D("div",eF,re(o.value),1)):ce("",!0),a.value?(k(),D("div",tF,re(a.value),1)):ce("",!0),d("div",nF,[d("button",{onClick:h,disabled:!c.value||i.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(k(),D("span",sF,"⏳")):(k(),D("span",iF,"Se connecter"))],8,rF),d("button",{onClick:v[4]||(v[4]=w=>m.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])])):ce("",!0)}},Mf="magicLinks";function Lf({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function Gv(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function Dm({seasonId:n,playerId:e,eventId:t,action:r}){const s=Lf({seasonId:n,playerId:e,eventId:t,action:r}),i=Gv(40),o=Se(ue,Mf,s),a=Date.now()+1e3*60*60*24*7;await hn(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const c=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:c}}async function MA({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=Lf({seasonId:n,playerId:e,eventId:r,action:s}),o=Gv(40),a=Se(ue,Mf,i),l=Date.now()+1e3*60*60*24*7;await hn(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const h=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:h}}async function LA({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=Lf({seasonId:n,playerId:e,eventId:t,action:s}),o=Se(ue,Mf,i),a=await Gt(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function Nm({seasonId:n,playerId:e,eventId:t,action:r}){const s=Lf({seasonId:n,playerId:e,eventId:t,action:r}),i=Se(ue,Mf,s);await Dl(i)}const Wv="accountMagicLinks";function $f(n){return`account__${n}`}async function $A({currentEmail:n,newEmail:e}){const t=Gv(40),r=$f(t),s=Se(ue,Wv,r),i=Date.now()+1e3*60*60*24*7;await hn(s,{token:t,currentEmail:n,newEmail:e,action:"account_email_update",expiresAt:i});const a=`${window.location.origin+"/"}magic?a=account_email_update&t=${encodeURIComponent(t)}`;return{id:r,token:t,url:a}}async function FA({token:n}){const e=$f(n),t=Se(ue,Wv,e),r=await Gt(t);if(!r.exists())return{valid:!1,reason:"not_found"};const s=r.data();return s.token!==n?{valid:!1,reason:"token_mismatch"}:typeof s.expiresAt=="number"&&Date.now()>s.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:s}}async function UA({token:n}){const e=$f(n),t=Se(ue,Wv,e);await Dl(t)}const oF=Object.freeze(Object.defineProperty({__proto__:null,buildAccountId:$f,consumeAccountEmailUpdateLink:UA,consumeMagicLink:Nm,createAccountEmailUpdateLink:$A,createEmailVerificationLink:MA,createMagicLink:Dm,verifyAccountEmailUpdateLink:FA,verifyMagicLink:LA},Symbol.toStringTag,{value:"Module"}));async function ed({toEmail:n,title:e,body:t,data:r={},reason:s="generic"}){if(!n)return{success:!1,error:"missing_toEmail"};const i={to:n,title:e,body:t,data:r,reason:s,createdAt:ri()};return await Gl(st(ue,"pushQueue"),i),{success:!0}}function jA({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,yesUrl:s,noUrl:i}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p><strong>Bonjour ${n}</strong>, un nouvel événement est programmé :</p>
      <p style="margin: 12px 0 2px 0;">
        <a href="${r}" style="color:#3b82f6;text-decoration:underline;font-weight:600;">${e}</a>
      </p>
      <p style="margin: 0 0 16px 0; color:#374151;">${t}</p>
      <p>Nous avons besoin de savoir si tu es disponible.</p>
      <p style="margin-top: 12px;">
        <a href="${s}" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;">✅ Dispo</a>
        <a href="${i}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
      </p>
      <p style="margin-top: 16px;">Merci!!</p>
    </div>
  `}function aF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,noUrl:s}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>Bonjour <strong>${n}</strong>,</p>
      <p>Tu fais partie de l'équipe pour <a href="${r}" style="color:#8b5cf6;text-decoration:underline;font-weight:600;">${e}</a> (${t}).</p>
      <p>Un imprévu ?</p>
      <p style="margin-top: 8px;">
        <a href="${s}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Plus dispo</a>
      </p>
    </div>
  `}function lF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p><strong>Bonjour ${n}</strong>, tu n'as pas configuré d'email. Utilise la fonction « Copier le message » et envoie-lui ces informations par un autre canal.</p>
      <p style="margin-top: 8px; font-weight: 600;">${e}</p>
      <p style="color:#374151;">${t}</p>
      <p style="margin-top: 8px;">Lien direct : ${r}</p>
    </div>
  `}function uF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`Bonjour ${n}, un nouvel événement est programmé :

${e}        
${t}

Nous avons besoin de savoir si tu es disponible.
          ✅ Dispo
          ❌ Pas dispo
        
Merci!!

Lien direct: ${r}`}function cF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`Bonjour ${n},

Tu fais partie de l'équipe pour ${e} (${t}).

Un imprévu ?

❌ Plus dispo

Lien direct: ${r}`}const dF="HatCast <impropick@gmail.com>",hF="impropick@gmail.com";function Ff(n=null){return{from:n||dF,replyTo:n||hF}}async function fF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,eventUrl:o=void 0,reason:a="new_event",fromEmail:l=void 0}){try{const v=Se(ue,"userPreferences",n),w=await Gt(v);if(w.exists()){const E=w.data();if((E==null?void 0:E.notifyAvailability)===!1)return{success:!0,skipped:!0}}}catch{}const c=jA({playerName:e,eventTitle:t,eventDate:r,eventUrl:o,yesUrl:s,noUrl:i}),h=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,f={to:n,message:{subject:h,html:c},createdAt:ri(),meta:{reason:a,eventTitle:t,eventDate:r,playerName:e}},m=Ff(l);f.from=m.from,f.replyTo=m.replyTo,await Gl(st(ue,"mail"),f);try{const v=Se(ue,"userPreferences",n),w=await Gt(v),E=w.exists()?w.data():{};if((E==null?void 0:E.notifyAvailabilityPush)!==!1){const A=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,F=`${e}, t'es dispo ?`;await ed({toEmail:n,title:A,body:F,data:{url:o||window.location.origin,yesUrl:s,noUrl:i,reason:a},reason:a==="reminder"?"availability_reminder":"availability_request"})}}catch{}return{success:!0}}async function BA({toEmail:n,verifyUrl:e,purpose:t="player_protection",displayName:r="utilisateur",fromEmail:s=void 0}){const i=t==="account_email_update",o=i?"Vérification de votre nouvelle adresse email":"Vérification de votre email",a=`Bonjour ${r},`,l=i?"Pour sécuriser votre compte, merci de confirmer que vous avez accès à cette nouvelle adresse email.":"Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.",c=i?"Confirmer mon adresse email":"Vérifier mon email",h=i?"Confirmez votre nouvelle adresse email":"Confirmez votre email pour activer la protection",f=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>${o}</h2>
      <p>${a}</p>
      <p>${l}</p>
      <p>
        <a href="${e}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">${c}</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,m={to:n,message:{subject:h,html:f},createdAt:ri(),meta:{reason:t,displayName:r}},v=Ff(s);m.from=v.from,m.replyTo=v.replyTo,await Gl(st(ue,"mail"),m)}async function pF({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){return BA({toEmail:n,verifyUrl:t,purpose:"player_protection",displayName:e,fromEmail:r})}async function mF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0,noUrl:l=void 0}){try{const v=Se(ue,"userPreferences",n),w=await Gt(v);if(w.exists()){const E=w.data();if((E==null?void 0:E.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}j.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const c=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,h=o||`🎭 Sélection confirmée · ${t}`;j.debug("queueSelectionEmail html/subject ready");const f={to:n,message:{subject:h,html:c},createdAt:ri(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}},m=Ff(a);f.from=m.from,f.replyTo=m.replyTo,j.debug("queueSelectionEmail firestore payload ready");try{await Gl(st(ue,"mail"),f);try{const v=Se(ue,"userPreferences",n),w=await Gt(v),E=w.exists()?w.data():{};console.log("Préférences utilisateur pour notifications push",{toEmail:n,prefs:E,notifySelectionPush:E==null?void 0:E.notifySelectionPush,shouldSendPush:(E==null?void 0:E.notifySelectionPush)!==!1}),(E==null?void 0:E.notifySelectionPush)!==!1?(console.log("Envoi notification push de sélection",{toEmail:n,playerName:e,eventTitle:t}),await ed({toEmail:n,title:"🎭 Sélection confirmée",body:`${e}, tu as été sélectionné(e) pour ${t} (${r}) 🎉`,data:{url:s||window.location.origin,noUrl:l},reason:"selection"}),console.log("Notification push de sélection envoyée avec succès")):console.log("Notification push de sélection désactivée par préférences utilisateur")}catch(v){console.error("Erreur lors de l'envoi de la notification push de sélection",v)}return j.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(v){throw j.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:v}),v}}async function gF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,newSelectedPlayers:i=[],html:o=void 0,subject:a=void 0,fromEmail:l=void 0}){try{const w=Se(ue,"userPreferences",n),E=await Gt(w);if(E.exists()){const A=E.data();if((A==null?void 0:A.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}const c=Array.isArray(i)?i.join(", "):"",h=o||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Sélection mise à jour</h2>
      <p>Bonjour ${e},</p>
      <p>La sélection pour <strong>${t}</strong> (${r}) a été mise à jour et tu n'en fais plus partie 😔.</p>
      ${c?`<p>Nouvelle sélection: <strong>${c}</strong>.</p>`:""}
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#6b7280;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: mise à jour de sélection (relance auto ou ajustement manuel).</p>
    </div>
  `,f=a||`🎭 Tu n'es plus dans la sélection · ${t}`,m={to:n,message:{subject:f,html:h},createdAt:ri(),meta:{reason:"deselection",eventTitle:t,eventDate:r,playerName:e,newSelectedPlayers:i}},v=Ff(l);m.from=v.from,m.replyTo=v.replyTo,await Gl(st(ue,"mail"),m);try{const w=Se(ue,"userPreferences",n),E=await Gt(w),A=E.exists()?E.data():{};(A==null?void 0:A.notifySelectionPush)!==!1&&await ed({toEmail:n,title:"🎭 Sélection mise à jour",body:`${e}, tu n'es plus sélectionné(e) pour ${t} (${r}) 😔`,data:{url:s||window.location.origin,noUrl:s&&s.includes("/event/")?s.replace("/event/","/magic?auto=no&event="):void 0},reason:"deselection"})}catch{}return{success:!0}}async function vF({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(j.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await an(()=>Promise.resolve().then(()=>td),void 0),{createMagicLink:a}=await an(()=>Promise.resolve().then(()=>oF),void 0),l=`${window.location.origin}/season/${s}/event/${n}`;t.join(", ");const c=`🎭 Sélection confirmée · ${e.title}`,h=[];for(const f of t){j.debug("Traitement du joueur",{playerName:f});try{const m=i==null?void 0:i.find(U=>U.name===f);if(!m){j.warn("Joueur non trouvé",{playerName:f});continue}j.debug("Joueur trouvé");const v=await o(m.id,r);if(!v){j.warn("Pas d'email pour le joueur",{playerName:f});continue}j.debug("Email trouvé pour joueur");const E=`${(await a({seasonId:r,playerId:m.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,A=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${Vh(e.date)}).</p>
          <p>Un imprévu ?</p>
          <p>
            <a href="${E}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;margin-right:8px;">❌ Plus dispo</a>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
          </p>
        </div>
      `;j.debug("HTML généré pour joueur");const F=mF({toEmail:v,playerName:f,eventTitle:e.title,eventDate:Vh(e.date),eventUrl:l,html:A,subject:c,noUrl:E});h.push(F),j.info("Email ajouté à la queue",{playerName:f})}catch(m){j.error("Erreur lors de l'envoi de l'email de sélection",{playerName:f,error:m})}}return j.info("Nombre total d'emails à envoyer",{count:h.length}),await Promise.all(h),j.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:h.length}}async function yF({eventId:n,eventData:e,removedPlayers:t,newSelectedPlayers:r,seasonId:s,seasonSlug:i,players:o}){if(j.info("sendDeselectionEmailsForEvent",{eventId:n,seasonId:s,removedCount:t==null?void 0:t.length}),!e||!t||t.length===0)return{success:!0,count:0};const{getPlayerEmail:a}=await an(()=>Promise.resolve().then(()=>td),void 0),l=`${window.location.origin}/season/${i}/event/${n}`,c=[],h=Array.isArray(r)?r.join(", "):"";for(const f of t)try{const m=o==null?void 0:o.find(E=>E.name===f);if(!m){j.warn("Joueur retiré non trouvé",{playerName:f});continue}const v=await a(m.id,s);if(!v){j.warn("Pas d'email pour le joueur retiré",{playerName:f});continue}const w=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection mise à jour</h2>
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu n'es plus sélectionné(e) pour <strong>${e.title}</strong> (${Vh(e.date)}) 😔.</p>
          ${h?`<p>Nouvelle sélection: <strong>${h}</strong>.</p>`:""}
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #6b7280;color:#6b7280;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;c.push(gF({toEmail:v,playerName:f,eventTitle:e.title,eventDate:Vh(e.date),eventUrl:l,newSelectedPlayers:r,html:w}))}catch(m){j.error("Erreur lors de l'envoi de l'email de désélection",{playerName:f,error:m})}return await Promise.all(c),j.info("Emails de désélection envoyés",{count:c.length}),{success:!0,count:c.length}}function Vh(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Qv(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function qA(n){return`seasonPreferredPlayer:${n||"global"}`}function Om(n,e){try{const t=qA(n),r=localStorage.getItem(t);if(!r){localStorage.setItem(t,JSON.stringify([e]));return}if(r.startsWith("[")){const s=JSON.parse(r);s.includes(e)||(s.push(e),localStorage.setItem(t,JSON.stringify(s)))}else r!==e&&localStorage.setItem(t,JSON.stringify([r,e]))}catch{}}function _F(n,e){try{const t=qA(n),r=localStorage.getItem(t);if(!r)return;if(r.startsWith("[")){const s=JSON.parse(r).filter(i=>i!==e);s.length===0?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(s))}else r===e&&localStorage.removeItem(t)}catch{}}async function zA(n,e,t,r=null){try{j.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await Yl(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await an(()=>import("./index.esm-040c1c4b.js"),[]),{db:c}=await an(()=>Promise.resolve().then(()=>Xi),void 0),h=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(h,a("email","==",e)),m=await l(f);if(!m.empty&&m.docs.find($=>$.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");j.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:v}=await an(()=>import("./index.esm-08a539c5.js"),[]),{auth:w}=await an(()=>Promise.resolve().then(()=>Xi),void 0),E=await v(w,e,t);j.info("Compte Firebase Auth créé",{uid:E.user.uid});const A=Qv(t),F=r?Se(c,"seasons",r,"playerProtection",n):Se(c,"playerProtection",n);return await hn(F,{playerId:n,email:e,passwordHash:A,firebaseUid:E.user.uid,isProtected:!0,createdAt:new Date}),j.info("Protection sauvegardée dans Firestore"),r&&Om(r,n),{success:!0}}catch(s){throw j.error("Erreur lors de la protection du joueur",s),s}}async function HA({playerId:n,email:e,seasonId:t=null}){const r=t?Se(ue,"seasons",t,"playerProtection",n):Se(ue,"playerProtection",n);(await Gt(r)).exists()?await wa(r,{email:e,updatedAt:new Date}):await hn(r,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:i}=await MA({seasonId:t,playerId:n,email:e});return{success:!0,url:i}}async function KA({playerId:n,seasonId:e=null}){const t=e?Se(ue,"seasons",e,"playerProtection",n):Se(ue,"playerProtection",n);if(!(await Gt(t)).exists())throw new Error("Protection introuvable");return await wa(t,{emailVerifiedAt:new Date}),{success:!0}}async function GA({playerId:n,seasonId:e=null}){const t=e?Se(ue,"seasons",e,"playerProtection",n):Se(ue,"playerProtection",n);return await wa(t,{emailVerifiedAt:null}),{success:!0}}async function WA(n,e=null){try{const t=e?Se(ue,"seasons",e,"playerProtection",n):Se(ue,"playerProtection",n);return await hn(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date}),e&&_F(e,n),{success:!0,email:""}}catch(t){throw j.error("Erreur lors de la suppression de la protection",t),t}}async function Zi(n,e=null){try{const t=e?Se(ue,"seasons",e,"playerProtection",n):Se(ue,"playerProtection",n),r=await Gt(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return j.error("Erreur lors de la vérification de protection",t),!1}}async function Yl(n,e=null){try{const t=e?Se(ue,"seasons",e,"playerProtection",n):Se(ue,"playerProtection",n),r=await Gt(t);return r.exists()?r.data():null}catch(t){return j.error("Erreur lors de la récupération des données de protection",t),null}}async function QA(n,e=null){try{const t=await Yl(n,e);return(t==null?void 0:t.email)||""}catch(t){return j.error("Erreur lors de la récupération de l'email",t),""}}async function Vm(n=null){try{const e=n?st(ue,"seasons",n,"playerProtection"):st(ue,"playerProtection");return(await Vt(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return j.error("Erreur lors du chargement des protections",e),[]}}async function Uf(n){try{const e=[],t=wc(st(ue,"playerProtection"),Ph("email","==",n));(await Vt(t)).forEach(i=>{const o=i.data();o!=null&&o.isProtected&&e.push({seasonId:null,playerId:i.id,...o})});const s=await Vt(st(ue,"seasons"));for(const i of s.docs){const o=i.id,a=wc(st(ue,"seasons",o,"playerProtection"),Ph("email","==",n));(await Vt(a)).forEach(c=>{var f;const h=c.data();h!=null&&h.isProtected&&e.push({seasonId:o,seasonName:(f=i.data())==null?void 0:f.name,playerId:c.id,...h})})}return e}catch(e){return j.error("Erreur listAssociationsForEmail",e),[]}}async function JA(n,e,t=null){try{const r=await Yl(n,t);if(!r||!r.isProtected)return!1;if(r.email){j.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await an(()=>import("./index.esm-08a539c5.js"),[]),{auth:i}=await an(()=>Promise.resolve().then(()=>Xi),void 0);return await s(i,r.email,e),j.debug("Mot de passe Firebase Auth valide"),ho.saveSession(n),t&&Om(t,n),!0}catch(s){return j.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{j.debug("Vérification avec hash local");const s=Qv(e),i=r.passwordHash===s;return i&&(ho.saveSession(n),t&&Om(t,n)),i}}catch(r){return j.error("Erreur lors de la vérification du mot de passe",r),!1}}async function YA({playerId:n,seasonId:e=null}){const t=e?Se(ue,"seasons",e,"playerProtection",n):Se(ue,"playerProtection",n),r=await Gt(t);if(!r.exists())throw new Error("Protection introuvable");const s=r.data();if(s!=null&&s.email)return await wa(t,{isProtected:!0,updatedAt:new Date}),{success:!0};throw new Error("Email non défini pour cette protection")}function ta(n){return ho.isPasswordCached(n)}function bF(n){return null}async function XA(n,e=null){try{j.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await Yl(n,e);if(j.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(j.debug("Email à utiliser (masqué)"),t.firebaseUid){j.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await an(()=>import("./index.esm-08a539c5.js"),[]),{auth:s}=await an(()=>Promise.resolve().then(()=>Xi),void 0);j.debug("Tentative d'envoi d'email"),await r(s,t.email),j.info("Email envoyé avec succès via Firebase Auth")}else{j.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await an(()=>import("./index.esm-08a539c5.js"),[]),{auth:i}=await an(()=>Promise.resolve().then(()=>Xi),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);j.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),j.info("Email envoyé avec succès");const{updateDoc:l}=await an(()=>import("./index.esm-040c1c4b.js"),[]),{db:c}=await an(()=>Promise.resolve().then(()=>Xi),void 0),h=e?Se(c,"seasons",e,"playerProtection",n):Se(c,"playerProtection",n);await l(h,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")j.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),j.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw j.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function wF(n,e,t=null){try{const r=Qv(e),s=t?Se(ue,"seasons",t,"playerProtection",n):Se(ue,"playerProtection",n);return await wa(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw j.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function xF(n){return new Promise((e,t)=>{j.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const td=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:GA,finalizeProtectionAfterVerification:YA,getCachedPlayerPassword:bF,getPlayerEmail:QA,getPlayerProtectionData:Yl,isPlayerPasswordCached:ta,isPlayerProtected:Zi,listAssociationsForEmail:Uf,listProtectedPlayers:Vm,markEmailVerifiedForProtection:KA,protectPlayer:zA,requirePlayerPasswordForAvailability:xF,sendPasswordResetEmail:XA,startEmailVerificationForProtection:HA,unprotectPlayer:WA,updatePlayerPasswordInFirestore:wF,verifyPlayerPassword:JA},Symbol.toStringTag,{value:"Module"})),IF={class:"mb-4 md:mb-6"},EF={class:"flex items-start gap-4"},TF={class:"flex items-center gap-3"},AF={class:"space-y-2"},SF={class:"flex items-center gap-2"},PF={class:"text-gray-400 text-xs md:text-sm"},RF={key:0,class:"flex items-center gap-2"},CF=["title"],kF={class:"text-blue-200"},DF={class:"space-y-4 md:space-y-6"},NF={class:"space-y-2 md:space-y-3"},OF={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},VF=["disabled"],MF={key:0,class:"mt-2 text-xs text-red-300"},LF={key:1,class:"mt-2 text-xs text-green-300"},$F={class:"space-y-2 md:space-y-3"},FF={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},UF={class:"flex items-center justify-between mb-4"},jF={class:"space-y-4"},BF=["disabled"],qF={key:0,class:"text-xs text-red-300 text-center"},zF={key:1,class:"text-xs text-green-300 text-center"},HF={class:"flex items-center justify-between mb-4"},KF={class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},GF={class:"space-y-3"},WF={key:0,class:"text-sm text-gray-400 text-center py-4"},QF={key:1,class:"space-y-2"},JF={class:"flex items-center gap-2 min-w-0 flex-1"},YF={class:"truncate"},XF={class:"text-white font-medium text-sm"},ZF={class:"text-gray-400 text-xs"},e6=["onClick"],ZA={__name:"AccountMenu",props:{show:{type:Boolean,default:!1},seasonId:{type:String,default:null}},emits:["close","delete-account","open-player"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P(""),o=P(!1),a=P(""),l=P(""),c=P(!1),h=P(!1),f=P(""),m=P(""),v=P([]),w=P(!1),E=P(!1);St(s,T=>{i.value=T||""}),St(i,T=>{c.value=!!T&&T.includes("@")&&T!==s.value});async function A(){if(c.value){o.value=!0,a.value="",l.value="";try{const T=await $A({currentEmail:s.value,newEmail:i.value.trim()});await BA({toEmail:i.value.trim(),verifyUrl:T.url,purpose:"account_email_update",displayName:"utilisateur"}),l.value=`Un email de vérification a été envoyé à ${i.value.trim()}. Cliquez sur le lien pour confirmer le changement.`}catch(T){a.value=(T==null?void 0:T.code)==="auth/requires-recent-login"?"Veuillez vous reconnecter pour modifier votre email":"Impossible de mettre à jour l'email"}finally{o.value=!1}}}async function F(){if(s.value){h.value=!0,f.value="",m.value="";try{await qv(s.value),m.value="Email de réinitialisation envoyé. Vérifiez votre boîte de réception."}catch{f.value="Impossible d'envoyer l'email de réinitialisation. Veuillez réessayer."}finally{h.value=!1}}}function U(T){return`${T.seasonId||"global"}__${T.playerId}`}async function $(){try{const T=s.value?await Uf(s.value):[],_=[];for(const I of T){let C=I.playerId,M=I.seasonId||"—";try{if(I.seasonId){const N=Se(ue,"seasons",I.seasonId,"players",I.playerId),R=await Gt(N);R.exists()&&(C=R.data().name||C);const Qe=Se(ue,"seasons",I.seasonId),it=await Gt(Qe);it.exists()&&(M=it.data().name||M)}}catch{}_.push({...I,playerName:C,seasonName:M})}v.value=_}catch{v.value=[]}}async function L(T){if(confirm(`Êtes-vous sûr de vouloir dissocier le joueur "${T.playerName}" de votre compte ?`))try{const{deleteDoc:_}=await an(()=>import("./index.esm-040c1c4b.js"),[]);if(T.seasonId){const C=Se(ue,"seasons",T.seasonId,"playerProtection",T.playerId);await _(C)}else{const C=Se(ue,"playerProtection",T.playerId);await _(C)}try{if(T.seasonId){const C=`seasonPreferredPlayer:${T.seasonId}`,M=localStorage.getItem(C);if(M)if(M.startsWith("[")){const R=(JSON.parse(M)||[]).filter(Qe=>Qe!==T.playerId);localStorage.setItem(C,JSON.stringify(R))}else M===T.playerId&&localStorage.removeItem(C)}}catch{}await $();const I=`Joueur "${T.playerName}" dissocié avec succès`}catch(_){console.error("Erreur lors de la dissociation:",_),alert(`Erreur lors de la dissociation: ${_.message||"Veuillez réessayer"}`)}}function se(T){r("open-player",T),te()}function te(){r("close")}return St(()=>t.show,T=>{var _;if(T)try{s.value=((_=Ke==null?void 0:Ke.currentUser)==null?void 0:_.email)||"",$()}catch{}}),En(()=>{var T;if(t.show)try{s.value=((T=Ke==null?void 0:Ke.currentUser)==null?void 0:T.email)||"",$()}catch{}}),(T,_)=>n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-2 md:p-4",onClick:te},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg md:max-w-xl max-h-[90vh] overflow-y-auto",onClick:_[3]||(_[3]=pt(()=>{},["stop"]))},[d("button",{onClick:te,class:"absolute right-2 md:right-3 top-2 md:top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),d("div",IF,[d("div",EF,[d("div",TF,[_[13]||(_[13]=d("div",{class:"w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0"},[d("span",{class:"text-lg md:text-xl"},"👤")],-1)),d("div",AF,[_[12]||(_[12]=d("h3",{class:"text-white font-semibold text-base md:text-lg"},"Mon compte",-1)),d("div",SF,[d("span",PF,re(s.value||"Non défini"),1),d("button",{onClick:_[0]||(_[0]=I=>w.value=!0),class:"text-indigo-400 hover:text-indigo-300 transition-colors p-1 hover:bg-indigo-400/10 rounded flex-shrink-0",title:"Modifier l'email","aria-label":"Modifier l'email"}," ✏️ ")]),v.value.length>0?(k(),D("div",RF,[d("button",{onClick:_[1]||(_[1]=I=>v.value.length===1?se(v.value[0]):E.value=!0),class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-xs md:text-sm hover:bg-blue-500/30 transition-colors cursor-pointer",title:v.value.length===1?`Voir ${v.value[0].playerName}`:"Gérer mes joueurs"},[_[11]||(_[11]=d("span",{class:"text-blue-300"},"⭐",-1)),d("span",kF,re(v.value.length===1?v.value[0].playerName:`${v.value.length} joueurs`),1)],8,CF)])):ce("",!0)])])])]),_[18]||(_[18]=d("div",{class:"border-t border-white/10 mb-4 md:mb-6"},null,-1)),d("div",DF,[d("div",NF,[_[15]||(_[15]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-green-400"},"🔑"),bt(" Mot de passe ")],-1)),d("div",OF,[_[14]||(_[14]=d("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Vous pouvez changer votre mot de passe pour sécuriser vos opérations sensibles.",-1)),d("button",{onClick:F,disabled:h.value,class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},re(h.value?"⏳":"Changer de mot de passe"),9,VF),f.value?(k(),D("div",MF,re(f.value),1)):ce("",!0),m.value?(k(),D("div",LF,re(m.value),1)):ce("",!0)])]),d("div",$F,[_[17]||(_[17]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-red-400"},"⚠️"),bt(" Suppression de compte ")],-1)),d("div",FF,[_[16]||(_[16]=d("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Cette action est irréversible et supprimera définitivement votre compte.",-1)),d("button",{onClick:_[2]||(_[2]=I=>T.$emit("delete-account")),class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-red-600 text-white hover:bg-red-500 text-sm"},"Supprimer mon compte")])])]),d("div",{class:"mt-4 md:mt-6 text-center"},[d("button",{onClick:te,class:"px-4 md:px-6 py-2 md:py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 text-sm"},"Fermer")])]),w.value?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:_[7]||(_[7]=I=>w.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-md",onClick:_[6]||(_[6]=pt(()=>{},["stop"]))},[d("div",UF,[_[19]||(_[19]=d("h3",{class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},[d("span",{class:"text-blue-400"},"📧"),bt(" Modifier l'email ")],-1)),d("button",{onClick:_[4]||(_[4]=I=>w.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),d("div",jF,[d("div",null,[_[20]||(_[20]=d("label",{class:"block text-xs text-gray-400 mb-2"},"Nouvelle adresse email",-1)),ut(d("input",{"onUpdate:modelValue":_[5]||(_[5]=I=>i.value=I),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400 text-sm",placeholder:"nouvel@email.com"},null,512),[[Mt,i.value]])]),d("button",{onClick:A,disabled:!c.value||o.value,class:"w-full px-4 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},re(o.value?"⏳":"Mettre à jour"),9,BF),a.value?(k(),D("div",qF,re(a.value),1)):ce("",!0),l.value?(k(),D("div",zF,re(l.value),1)):ce("",!0)])])])):ce("",!0),E.value?(k(),D("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:_[10]||(_[10]=I=>E.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg",onClick:_[9]||(_[9]=pt(()=>{},["stop"]))},[d("div",HF,[d("h3",KF,[_[21]||(_[21]=d("span",{class:"text-yellow-400"},"⭐",-1)),bt(" "+re(v.value.length<=1?"Mon joueur":"Mes joueurs"),1)]),d("button",{onClick:_[8]||(_[8]=I=>E.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),d("div",GF,[v.value.length===0?(k(),D("div",WF," Aucun joueur associé pour le moment. ")):(k(),D("div",QF,[(k(!0),D(dt,null,Mr(v.value,I=>(k(),D("div",{key:U(I),class:"flex items-center justify-between p-3 bg-gray-800/30 rounded-lg"},[d("div",JF,[_[22]||(_[22]=d("span",{class:"text-yellow-400 text-sm"},"⭐",-1)),d("div",YF,[d("div",XF,re(I.playerName||"—"),1),d("div",ZF,re(I.seasonName||I.seasonId||"—"),1)])]),d("button",{onClick:C=>L(I),class:"p-1.5 rounded bg-red-600/20 text-red-400 hover:bg-red-600/30 hover:text-red-300 transition-colors duration-200 flex-shrink-0",title:"Dissocier ce joueur","aria-label":"Dissocier ce joueur"}," 🗑️ ",8,e6)]))),128))]))])])])):ce("",!0)])):ce("",!0)}},t6="/logos/hatcast-logo-desktop.png",n6={key:0,class:"w-10 h-10 bg-gray-600 animate-pulse rounded-full"},r6=["aria-expanded"],Mm={__name:"AccountDropdown",props:{isConnected:{type:Boolean,default:!1},buttonClass:{type:String,default:"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700"}},emits:["open-account-menu","open-help","open-notifications","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=P(!1),i=P(!0),o=P(null),a=P({});St(()=>t.isConnected,A=>{i.value=!1},{immediate:!0}),En(()=>{i.value=!1});function l(){r("open-login")}function c(){s.value=!s.value,s.value&&en(()=>h())}function h(){if(o.value){const A=o.value.getBoundingClientRect();a.value={top:`${A.bottom+8}px`,right:`${window.innerWidth-A.right}px`}}}function f(){s.value=!1,r("open-account-menu")}function m(){s.value=!1,r("open-help")}function v(){s.value=!1,r("open-notifications")}async function w(){s.value=!1;try{await Ke.signOut(),r("logout")}catch(A){console.error("Erreur lors de la déconnexion:",A)}}function E(){s.value=!1}return En(()=>{document.addEventListener("click",E),window.addEventListener("resize",h),window.addEventListener("scroll",h,{passive:!0})}),Ks(()=>{document.removeEventListener("click",E),window.removeEventListener("resize",h),window.removeEventListener("scroll",h)}),(A,F)=>(k(),D("div",{class:"relative",onClick:F[0]||(F[0]=pt(()=>{},["stop"]))},[i.value?(k(),D("div",n6)):n.isConnected?(k(),D("button",{key:2,onClick:c,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte","aria-expanded":s.value,"aria-haspopup":"true",ref_key:"dropdownButton",ref:o},F[1]||(F[1]=[d("span",{class:"text-2xl"},"👤",-1)]),8,r6)):(k(),D("button",{key:1,onClick:l,class:Qt(["px-4 py-2 rounded-lg transition-all duration-300 border transition-colors",n.buttonClass])}," Connexion ",2)),(k(),Gs(ec,{to:"body"},[s.value&&n.isConnected?(k(),D("div",{key:0,class:"fixed w-auto min-w-[180px] max-w-[200px] md:min-w-[200px] md:max-w-[240px] bg-gray-900 border border-white/20 rounded-lg shadow-xl py-1 z-[9999]",style:Vr(a.value),role:"menu"},[d("button",{onClick:f,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},F[2]||(F[2]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"👤",-1),d("span",{class:"truncate"},"Mon compte",-1)])),d("button",{onClick:v,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},F[3]||(F[3]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"🔔",-1),d("span",{class:"truncate"},"Notifications",-1)])),d("button",{onClick:m,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},F[4]||(F[4]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"❓",-1),d("span",{class:"truncate"},"Aide",-1)])),F[6]||(F[6]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:w,class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},F[5]||(F[5]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"🚪",-1),d("span",{class:"truncate"},"Se déconnecter",-1)]))],4)):ce("",!0)]))]))}},s6={class:"container mx-auto px-4 py-4"},i6={class:"flex items-center justify-between"},o6={class:"flex items-center gap-2"},a6={__name:"AppHeader",props:{isScrolled:{type:Boolean,default:!1}},emits:["open-account-menu","open-help","open-notifications","open-players","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=Ea(),i=$e(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");St(()=>s.path,()=>{pl(),setTimeout(()=>{pl()},100)},{immediate:!0}),Ks(()=>{window._appHeaderUnsubscribe&&(window._appHeaderUnsubscribe(),delete window._appHeaderUnsubscribe)});function o(){r("open-account-menu")}function a(){r("open-help")}function l(){r("open-notifications")}function c(){r("open-players")}function h(){r("logout")}function f(){r("open-login")}return(m,v)=>(k(),D("header",{class:Qt(["fixed top-0 left-0 right-0 z-50 transition-all duration-300",n.isScrolled?"bg-white/95 backdrop-blur-md border-b border-gray-200/50 shadow-lg":"bg-gray-900/20 backdrop-blur-sm"])},[d("nav",s6,[d("div",i6,[v[0]||(v[0]=jn('<div class="flex items-center"><a href="/" class="flex items-center"><div class="relative w-48 h-12 md:w-56 md:h-14"><img src="'+kA+'" alt="Logo HatCast - Retour à l&#39;accueil" class="w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 md:hidden"><img src="'+t6+'" alt="Logo HatCast - Retour à l&#39;accueil" class="w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 hidden md:block"></div></a></div>',1)),d("div",o6,[Ye(Mm,{"is-connected":rs(I$),"button-class":i.value,onOpenAccountMenu:o,onOpenHelp:a,onOpenNotifications:l,onOpenPlayers:c,onLogout:h,onOpenLogin:f},null,8,["is-connected","button-class"]),AS(m.$slots,"actions")])])])],2))}},l6={class:"space-y-4 md:space-y-6"},u6={class:"space-y-2 md:space-y-3"},c6={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},d6={class:"flex items-center justify-between"},h6={class:"flex items-center gap-2"},f6={class:"flex items-center justify-between"},p6={class:"flex items-center gap-2"},m6={class:"space-y-2 md:space-y-3"},g6={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},v6={class:"flex items-center justify-between"},y6={class:"flex items-center gap-2"},_6={class:"flex items-center justify-between"},b6={class:"flex items-center gap-2"},w6={class:"flex items-center justify-between pt-2 border-t border-white/10"},x6=["disabled"],I6={key:1,class:"inline-flex items-center text-xs text-gray-300"},E6={class:"flex items-center justify-between pt-2"},T6=["disabled"],A6={key:0,class:"text-xs text-green-300"},S6={key:1,class:"text-xs text-red-300"},P6={key:2,class:"text-[10px] text-gray-400 break-all"},R6={class:"text-[10px] text-gray-500"},C6={key:0,class:"text-xs text-red-300"},k6={key:1,class:"text-xs text-green-300"},D6={class:"mt-6 flex justify-between items-center"},N6=["disabled"],e1={__name:"NotificationsModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P({notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),o=P(!1),a=P(""),l=P(""),c=P(!1),h=P(""),f=P(""),m=P(!1),v=P(localStorage.getItem("fcmToken")||""),w=P(!1),E=function(_){try{return _?_.length>20?_.slice(0,8)+"…"+_.slice(-6):_:""}catch{return""}}("BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8");function A(T){const{active:_,token:I}=T.detail;_&&I?(v.value=I,w.value=!0,localStorage.setItem("fcmToken",I),console.log("Notifications push réactivées automatiquement")):(w.value=!1,v.value="",localStorage.removeItem("fcmToken"),console.log("Notifications push désactivées"))}async function F(){try{if(!s.value)return;const T=Se(ue,"userPreferences",s.value),_=await Gt(T);if(_.exists()){const I=_.data()||{};i.value.notifyAvailability=I.notifyAvailability!==!1,i.value.notifySelection=I.notifySelection!==!1,i.value.notifySelectionPush=I.notifySelectionPush!==!1,i.value.notifyAvailabilityPush=I.notifyAvailabilityPush!==!1}else i.value={notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}}catch{}}async function U(){if(s.value){c.value=!0,f.value="",h.value="";try{if(!(await Gu()).active){f.value="Notifications push non actives sur cet appareil";return}await ed({toEmail:s.value,title:"Test HatCast",body:"Ceci est un test de notification",data:{url:"/"},reason:"manual_test"}),h.value="OK"}catch{f.value="Échec de l'envoi du test"}finally{c.value=!1}}}function $(){const T=new CustomEvent("pwa-update-test",{detail:{type:"test-update",timestamp:Date.now()}});window.dispatchEvent(T),alert(`🧪 Test de mise à jour PWA déclenché !

Vérifiez que la modal de mise à jour apparaît dans l'interface principale.`)}async function L(){try{if(m.value=!0,!await hA()){f.value="Push non supporté sur cet appareil";return}const _=await Gu();_.active?(v.value=_.token,w.value=!0,localStorage.setItem("fcmToken",_.token),console.log("Notifications push activées avec succès")):f.value=`Activation impossible: ${_.error}`}catch(T){const _=typeof Notification<"u"?Notification.permission:"unknown",I=T&&(T.message||T.code)?` (${T.message||T.code})`:"";f.value=`Activation impossible – permission: ${_}${I}`}finally{m.value=!1}}async function se(){if(s.value){o.value=!0,a.value="",l.value="";try{const T=Se(ue,"userPreferences",s.value);await hn(T,{...i.value},{merge:!0}),l.value="Préférences sauvegardées"}catch{a.value="Impossible de sauvegarder vos préférences"}finally{o.value=!1}}}function te(){r("close")}return St(()=>t.show,T=>{T&&F()}),En(()=>{var T;try{s.value=((T=Ke==null?void 0:Ke.currentUser)==null?void 0:T.email)||"",w.value=typeof Notification<"u"&&Notification.permission==="granted"&&!!localStorage.getItem("fcmToken"),Z4(),window.addEventListener("push-status-changed",A),Gu().then(_=>{_.active&&(v.value=_.token,w.value=!0,localStorage.setItem("fcmToken",_.token))})}catch{}t.show&&F()}),Ks(()=>{window.removeEventListener("push-status-changed",A)}),(T,_)=>n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:te},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:_[4]||(_[4]=pt(()=>{},["stop"]))},[d("button",{onClick:te,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),_[16]||(_[16]=jn('<div class="mb-4 md:mb-6"><div class="flex items-start gap-4"><div class="flex items-center gap-3"><div class="w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0"><span class="text-lg md:text-xl">🔔</span></div><div class="space-y-2"><h3 class="text-white font-semibold text-base md:text-lg">Notifications</h3><p class="text-gray-400 text-xs md:text-sm">Ne ratez rien, soyez le premier prévenu !</p></div></div></div></div><div class="border-t border-white/10 mb-4 md:mb-6"></div>',2)),d("div",l6,[d("div",u6,[_[7]||(_[7]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-blue-400"},"📧"),bt(" Emails ")],-1)),d("div",c6,[d("div",d6,[d("label",h6,[ut(d("input",{type:"checkbox","onUpdate:modelValue":_[0]||(_[0]=I=>i.value.notifyAvailability=I),class:"w-4 h-4"},null,512),[[Gi,i.value.notifyAvailability]]),_[5]||(_[5]=d("span",{class:"text-sm text-white"},"M'envoyer un email lorsqu'un événement a besoin de joueurs",-1))])]),d("div",f6,[d("label",p6,[ut(d("input",{type:"checkbox","onUpdate:modelValue":_[1]||(_[1]=I=>i.value.notifySelection=I),class:"w-4 h-4"},null,512),[[Gi,i.value.notifySelection]]),_[6]||(_[6]=d("span",{class:"text-sm text-white"},"M'envoyer un email lorsque je suis concerné par une sélection",-1))])])])]),d("div",m6,[_[15]||(_[15]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-emerald-400"},"📱"),bt(" Mobile (expérimental) ")],-1)),d("div",g6,[_[14]||(_[14]=d("div",{class:"text-xs text-emerald-200 mb-1"},"Fonctionnalité en test: activable uniquement ici.",-1)),d("div",v6,[d("label",y6,[ut(d("input",{type:"checkbox","onUpdate:modelValue":_[2]||(_[2]=I=>i.value.notifySelectionPush=I),class:"w-4 h-4"},null,512),[[Gi,i.value.notifySelectionPush]]),_[8]||(_[8]=d("span",{class:"text-sm text-white"},"Me notifier lorsque je suis concerné par une sélection",-1))])]),d("div",_6,[d("label",b6,[ut(d("input",{type:"checkbox","onUpdate:modelValue":_[3]||(_[3]=I=>i.value.notifyAvailabilityPush=I),class:"w-4 h-4"},null,512),[[Gi,i.value.notifyAvailabilityPush]]),_[9]||(_[9]=d("span",{class:"text-sm text-white"},"Me notifier lorsqu'un événement a besoin de joueurs",-1))])]),d("div",w6,[_[11]||(_[11]=d("div",{class:"text-xs text-gray-400"},"Notifications sur cet appareil",-1)),w.value?(k(),D("span",I6,_[10]||(_[10]=[d("span",{class:"mr-1 text-emerald-400"},"✓",-1),bt(" Actif ")]))):(k(),D("button",{key:0,onClick:L,disabled:m.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},re(m.value?"...":"Activer"),9,x6))]),d("div",E6,[_[12]||(_[12]=d("div",{class:"text-xs text-gray-400"},"Test de notification push",-1)),d("button",{onClick:U,disabled:c.value||!s.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},re(c.value?"Envoi…":"Envoyer un test"),9,T6)]),d("div",{class:"flex items-center justify-between pt-2"},[_[13]||(_[13]=d("div",{class:"text-xs text-gray-400"},"Test de mise à jour PWA",-1)),d("button",{onClick:$,class:"px-3 py-1 rounded bg-blue-600 text-white text-xs hover:bg-blue-500 transition-colors"}," 🧪 Simuler maj ")]),h.value?(k(),D("div",A6,"Notification test envoyée (vérifiez votre appareil)")):ce("",!0),f.value?(k(),D("div",S6,re(f.value),1)):ce("",!0),v.value?(k(),D("div",P6,"FCM token: "+re(v.value),1)):ce("",!0),d("div",R6,"VAPID: "+re(rs(E)||"indisponible"),1)])]),a.value?(k(),D("div",C6,re(a.value),1)):ce("",!0),l.value?(k(),D("div",k6,re(l.value),1)):ce("",!0)]),d("div",D6,[d("button",{onClick:se,disabled:o.value,class:"px-4 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-500 disabled:opacity-50"},re(o.value?"⏳":"Sauvegarder"),9,N6),d("button",{onClick:te,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ce("",!0)}},O6={class:"space-y-3"},V6={key:0,class:"text-sm text-gray-400"},M6={key:1,class:"space-y-2"},L6={class:"flex items-center justify-between gap-3"},$6={class:"truncate"},F6={class:"text-white font-semibold"},U6={class:"text-gray-400 text-xs"},j6=["onClick"],t1={__name:"PlayersModal",props:{show:{type:Boolean,default:!1}},emits:["close","manage-player"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P([]);function o(h){return`${h.seasonId||"global"}__${h.playerId}`}async function a(){var h;try{s.value=((h=Ke==null?void 0:Ke.currentUser)==null?void 0:h.email)||""}catch{}try{const f=s.value?await Uf(s.value):[],m=[];for(const v of f){let w=v.playerId;try{if(v.seasonId){const E=Se(ue,"seasons",v.seasonId,"players",v.playerId),A=await Gt(E);A.exists()&&(w=A.data().name||w)}}catch{}m.push({...v,playerName:w})}i.value=m}catch{i.value=[]}}function l(h){r("manage-player",h),c()}function c(){r("close")}return St(()=>t.show,h=>{h&&a()}),En(()=>{t.show&&a()}),(h,f)=>n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:c},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:f[0]||(f[0]=pt(()=>{},["stop"]))},[d("button",{onClick:c,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),f[2]||(f[2]=jn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👥</span></div><h2 class="text-2xl font-bold text-white mb-1">Mes joueurs</h2><p class="text-sm text-gray-300">Gérez vos associations de joueurs</p></div>',1)),d("div",O6,[f[1]||(f[1]=d("h3",{class:"text-white font-semibold mb-2"},"Mes joueurs associés",-1)),i.value.length===0?(k(),D("div",V6,"Aucun joueur associé pour le moment.")):(k(),D("ul",M6,[(k(!0),D(dt,null,Mr(i.value,m=>(k(),D("li",{key:o(m),class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},[d("div",L6,[d("div",$6,[d("div",F6,re(m.seasonName||m.seasonId||"—"),1),d("div",U6,"Joueur : "+re(m.playerName||"—"),1)]),d("button",{onClick:v=>l(m),class:"px-3 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-xs"},"Gérer",8,j6)])]))),128))]))]),d("div",{class:"mt-6 text-center"},[d("button",{onClick:c,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ce("",!0)}};let cr="mock",eo=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],pa=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function Jv(n){cr=n}async function B6(){if(cr!=="firebase"||!(await Vt(st(ue,"seasons"))).empty)return;const e=Se(st(ue,"seasons"));await hn(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:ri()});const t=await Vt(st(ue,"players"));for(const o of t.docs)await hn(Se(e,"players",o.id),o.data());const r=await Vt(st(ue,"events"));for(const o of r.docs)await hn(Se(e,"events",o.id),o.data());const s=await Vt(st(ue,"availability"));for(const o of s.docs)await hn(Se(e,"availability",o.id),o.data());const i=await Vt(st(ue,"selections"));for(const o of i.docs)await hn(Se(e,"selections",o.id),o.data())}async function n1(){cr==="firebase"&&await B6()}async function Mh(n=null){let e;return cr==="firebase"?n?e=(await Vt(st(ue,"seasons",n,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=(await Vt(st(ue,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=pa,e.sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const h=new Date(c);return isNaN(h.getTime())?null:h},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function Ju(n=null){let e;return cr==="firebase"?n?e=(await Vt(st(ue,"seasons",n,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=(await Vt(st(ue,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=eo,e.sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function r1(n,e=null){if(cr==="firebase"){const t=Se(e?st(ue,"seasons",e,"players"):st(ue,"players"));return await hn(t,{name:n}),t.id}else{const t=`p${eo.length+1}`;return eo.push({id:t,name:n}),t}}async function q6(n,e=null){if(cr==="firebase"){const t=e?Se(ue,"seasons",e,"players",n):Se(ue,"players",n);await Dl(t);const r=e?await Vt(st(ue,"seasons",e,"availability")):await Vt(st(ue,"availability")),s=fv(ue);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else eo=eo.filter(t=>t.id!==n)}async function z6(n,e,t=null){if(cr==="firebase"){const r=t?Se(ue,"seasons",t,"players",n):Se(ue,"players",n),s=await Gt(r),i=s.exists()&&s.data().name||null;if(await hn(r,{name:e},{merge:!0}),i&&i!==e){const o=fv(ue);try{const a=t?Se(ue,"seasons",t,"availability",i):Se(ue,"availability",i),l=await Gt(a);if(l.exists()){const c=l.data()||{},h=t?Se(ue,"seasons",t,"availability",e):Se(ue,"availability",e);o.set(h,c,{merge:!0}),o.delete(a)}}catch{}try{const a=t?st(ue,"seasons",t,"selections"):st(ue,"selections");(await Vt(a)).forEach(c=>{var f;const h=Array.isArray((f=c.data())==null?void 0:f.players)?c.data().players:[];if(h.includes(i)){const m=h.map(v=>v===i?e:v);o.update(c.ref,{players:m})}})}catch{}await o.commit()}}else{const r=eo.findIndex(s=>s.id===n);r!==-1&&(eo[r]={...eo[r],name:e})}}async function Uo(n,e,t=null){if(cr==="firebase"){const r=t?await Vt(st(ue,"seasons",t,"availability")):await Vt(st(ue,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function jo(n=null){if(cr==="firebase"){const e=n?await Vt(st(ue,"seasons",n,"selections")):await Vt(st(ue,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function Ab(n,e,t=null){if(cr==="firebase"){const r=t?Se(ue,"seasons",t,"availability",n):Se(ue,"availability",n);await hn(r,e)}}async function H6({seasonId:n,playerName:e,eventId:t,value:r}){if(cr!=="firebase")return;const s=n?Se(ue,"seasons",n,"availability",e):Se(ue,"availability",e),i=await Gt(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await hn(s,a)}async function Lm(n,e,t=null){if(cr==="firebase"){const r=t?Se(ue,"seasons",t,"selections",n):Se(ue,"selections",n);await hn(r,{players:e})}}async function K6(n,e=null){if(j.info("Suppression de l'événement",{eventId:n}),cr==="firebase")try{j.debug("Suppression de l'événement dans Firestore");const t=e?Se(ue,"seasons",e,"events",n):Se(ue,"events",n);await Dl(t),j.debug("Suppression de la sélection associée");const r=e?Se(ue,"seasons",e,"selections",n):Se(ue,"selections",n);await Dl(r),j.debug("Suppression des disponibilités");const s=e?await Vt(st(ue,"seasons",e,"availability")):await Vt(st(ue,"availability")),i=fv(ue);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){j.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),j.info("Opérations de suppression terminées avec succès")}catch(t){throw j.error("Erreur lors de la suppression",t),t}else pa=pa.filter(t=>t.id!==n)}async function G6(n,e=null){if(cr==="firebase"){const t=Se(e?st(ue,"seasons",e,"events"):st(ue,"events"));return await hn(t,n),t.id}else{const t=`event${pa.length+1}`;return pa.push({id:t,...n}),t}}async function Sb(n,e,t=null){if(cr==="firebase"){const r=t?Se(ue,"seasons",t,"events",n):Se(ue,"events",n);await hn(r,e,{merge:!0})}else{const r=pa.findIndex(s=>s.id===n);r!==-1&&(pa[r]={id:n,...e})}}const W6={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},Q6={class:"hero-section relative overflow-hidden pt-24"},J6={class:"hero-content py-16 md:py-24 px-4 relative z-10"},Y6={class:"container mx-auto"},X6={class:"grid grid-cols-1 lg:grid-cols-2 gap-16 lg:gap-24 items-center"},Z6={class:"text-center lg:text-left order-1 lg:order-2"},eU={class:"hero-cta mb-10"},tU={class:"flex flex-col sm:flex-row gap-4 items-center justify-center"},nU={class:"seasons-section py-16"},rU={class:"container mx-auto px-4"},sU=["aria-busy"],iU={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center animate-pulse"},oU={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center"},aU=["onClick"],lU={class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg overflow-hidden"},uU=["src","alt"],cU={key:1,class:"text-2xl"},dU={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},hU={key:0,class:"text-gray-300 text-sm mb-4 line-clamp-2 leading-relaxed"},fU={class:"flex justify-center gap-6 text-sm"},pU={class:"text-center"},mU={class:"text-white font-semibold"},gU={class:"text-center"},vU={class:"text-white font-semibold"},yU={class:"absolute top-4 right-4"},_U=["onClick","aria-expanded"],bU={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},wU=["onClick"],xU=["onClick"],IU=["onClick"],EU=["onClick"],TU=["onClick"],AU={class:"text-center mt-12"},SU={key:2,class:"text-center py-16"},PU={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},RU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},CU={class:"mb-6"},kU={class:"mb-6"},DU={class:"mb-6"},NU={class:"mb-6"},OU={class:"flex justify-end space-x-3"},VU=["disabled"],MU={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},LU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},$U={class:"text-center mb-6"},FU={class:"text-gray-300"},UU={key:2,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},jU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},BU={class:"text-center mb-6"},qU={class:"text-gray-300"},zU={class:"mb-6"},HU={class:"mb-6"},KU={class:"mb-6"},GU={key:0,class:"mb-4 text-center"},WU={class:"w-20 h-20 mx-auto mb-3 rounded-full overflow-hidden border-2 border-white/20"},QU=["src","alt"],JU=["disabled"],YU={key:0,class:"text-2xl mb-2 animate-spin"},XU={key:1,class:"text-2xl mb-2"},ZU={class:"text-sm"},e5={key:0},t5={key:1},n5={key:2},r5={key:2,class:"text-xs text-gray-400 mt-1"},s5={class:"flex justify-end space-x-3"},i5=["disabled"],o5={key:0,class:"flex items-center gap-2"},a5={key:1},l5={__name:"Seasons",setup(n){const e=P([]),t=P(!0),r=Jl(),s=P(null),i=P(!1),o=P(!1),a=P(!1),l=P(""),c=P(""),h=P(""),f=P(""),m=P(""),v=P(""),w=P(null),E=P(""),A=P(null),F=P(null),U=P(!1),$=P(!1),L=P(null),se=P(""),te=P(!1),T=P(!1),_=P(!1),I=P(!1),C=P(!1);En(async()=>{var B,Ee;try{j.info("Début du chargement des saisons"),Jv("firebase"),j.info("Mode de stockage défini sur Firebase"),await n1(),j.info("Stockage initialisé"),j.info("Attente de l'initialisation du service d'authentification...");try{T$(),await CA(),j.info("Service d'authentification initialisé")}catch(Ue){j.warn("Service d'authentification non initialisé, continuation sans authentification:",Ue.message||"Erreur inconnue")}try{pl(),j.info("Synchronisation forcée effectuée")}catch(Ue){j.warn("Erreur lors de la synchronisation forcée:",Ue)}j.info("Chargement des saisons...");try{e.value=await tl(),j.info("Saisons chargées",{count:((B=e.value)==null?void 0:B.length)||0})}catch(Ue){throw j.error("Erreur lors du chargement des saisons:",Ue),Ue}if(e.value.length>0){j.info("Chargement des données des saisons...");const Ue=await Promise.all(e.value.map(async He=>{try{j.debug(`Chargement des données pour la saison: ${He.name} (ID: ${He.id})`);let lt,yt;try{lt=await Mh(He.id),j.debug(`Événements chargés pour ${He.name}:`,lt)}catch(At){j.warn(`Erreur lors du chargement des événements pour ${He.name}:`,At),lt=[]}try{yt=await Ju(He.id),j.debug(`Joueurs chargés pour ${He.name}:`,yt)}catch(At){j.warn(`Erreur lors du chargement des joueurs pour ${He.name}:`,At),yt=[]}return j.debug(`Saison ${He.name}: ${(lt==null?void 0:lt.length)||0} événements, ${(yt==null?void 0:yt.length)||0} joueurs`),{...He,events:lt||[],players:yt||[]}}catch(lt){return j.warn(`Erreur lors du chargement des données pour la saison ${He.id}:`,lt),{...He,events:[],players:[]}}}));e.value=Ue,j.info("Données des saisons chargées",{count:e.value.length}),e.value.forEach(He=>{var lt,yt;j.info(`Saison finale ${He.name}: ${((lt=He.events)==null?void 0:lt.length)||0} événements, ${((yt=He.players)==null?void 0:yt.length)||0} joueurs`)})}xe().catch(Ue=>j.error("Migration sortOrder échouée",Ue))}catch(Ue){j.error("Erreur lors du chargement initial des saisons:",Ue),j.error("Stack trace:",Ue.stack);try{j.info("Tentative de fallback pour charger les saisons..."),e.value=await tl(),j.info("Saisons chargées en fallback",{count:((Ee=e.value)==null?void 0:Ee.length)||0})}catch(He){j.error("Échec du fallback pour charger les saisons:",He)}}finally{t.value=!1,j.info("Chargement terminé, isLoading = false")}const ie=()=>{C.value=window.scrollY>10};return window.addEventListener("scroll",ie,{passive:!0}),()=>{window.removeEventListener("scroll",ie)}});const M=$e(()=>[...e.value].sort((ie,B)=>{var yt,At;const Ee=typeof ie.sortOrder=="number"?ie.sortOrder:Number.MAX_SAFE_INTEGER,Ue=typeof B.sortOrder=="number"?B.sortOrder:Number.MAX_SAFE_INTEGER;if(Ee!==Ue)return Ee-Ue;const He=(yt=ie.createdAt)!=null&&yt.toMillis?ie.createdAt.toMillis():0,lt=(At=B.createdAt)!=null&&At.toMillis?B.createdAt.toMillis():0;return He!==lt?lt-He:(ie.name||"").localeCompare(B.name||"")}));function N(ie){r.push(`/season/${ie}`)}function R(ie){s.value=s.value===ie?null:ie}function Qe(){s.value=null}function it(ie){F.value=ie,m.value=ie.name,v.value=ie.description||"",w.value=null,E.value=ie.logoUrl||"",a.value=!0,Qe()}function ye(){a.value=!1,F.value=null,m.value="",v.value="",w.value=null,E.value="",U.value=!1}async function ne(){a.value=!1,await ge({type:"editSeason",data:{seasonId:F.value.id,seasonName:F.value.name,newName:m.value.trim(),newDescription:v.value.trim(),newLogo:w.value,newLogoPreview:E.value,oldName:F.value.name,oldDescription:F.value.description||"",oldLogoUrl:F.value.logoUrl||""}})}function le(){const ie=document.querySelector(".help-section");ie&&ie.scrollIntoView({behavior:"smooth"})}function oe(){const ie=document.querySelector(".seasons-section");ie&&ie.scrollIntoView({behavior:"smooth"})}function Ce(ie){const B=ie.target.files[0];if(B){w.value=B,U.value=!0;const Ee=new FileReader;Ee.onload=Ue=>{E.value=Ue.target.result,U.value=!1},Ee.onerror=()=>{U.value=!1},Ee.readAsDataURL(B)}}function X(){console.log("removeLogo appelé"),w.value=null,E.value="",console.log("Logo supprimé")}function W(){const ie=document.querySelector('input[type="file"][accept="image/*"]');ie?ie.click():console.error("Input file non trouvé pour triggerLogoUpload")}async function xe(){if(!e.value.length)return;const ie=e.value.map(Ee=>typeof Ee.sortOrder=="number"?Ee.sortOrder:null).filter(Ee=>Ee!==null);let B=ie.length?Math.max(...ie):0;for(const Ee of e.value)if(typeof Ee.sortOrder!="number"){B+=1;try{await Iu(Ee.id,B),Ee.sortOrder=B}catch(Ue){j.error("Erreur migration sortOrder",{seasonName:Ee==null?void 0:Ee.name,error:Ue})}}}async function Ze(ie){try{if(!(ie!=null&&ie.id)){alert("Saison introuvable");return}const[B,Ee]=await Promise.all([Mh(ie.id),Ju(ie.id)]),[Ue,He]=await Promise.all([Uo(Ee,B,ie.id),jo(ie.id)]),lt=["Joueur",...B.map(er=>qt(er))],yt=[];for(const er of Ee){const tr=(er==null?void 0:er.name)||"",Vn=(Ue==null?void 0:Ue[tr])||{},Aa=[tr,...B.map(Sa=>ot(Vn[Sa.id],He==null?void 0:He[Sa.id],tr))];yt.push(Aa)}const At=Te([lt,...yt]),Cn=new Blob(["\uFEFF"+At],{type:"text/csv;charset=utf-8;"}),kn=(ie==null?void 0:ie.name)||(ie==null?void 0:ie.slug)||"saison",Zn=`${De(kn)}-disponibilites.csv`,rt=URL.createObjectURL(Cn),Pt=document.createElement("a");Pt.href=rt,Pt.download=Zn,document.body.appendChild(Pt),Pt.click(),document.body.removeChild(Pt),URL.revokeObjectURL(rt),j.info("Export CSV saison",{seasonId:ie.id,events:B.length,players:Ee.length})}catch(B){j.error("Erreur export CSV",B),alert("Erreur lors de l'export CSV. Veuillez réessayer.")}}function mt(ie){if(!ie)return null;if(ie instanceof Date)return ie;if(typeof(ie==null?void 0:ie.toDate)=="function")return ie.toDate();if(typeof ie=="string"||typeof ie=="number"){const B=new Date(ie);return isNaN(B.getTime())?null:B}return null}function qt(ie){const B=mt(ie==null?void 0:ie.date),Ee=B?`${B.getFullYear()}-${String(B.getMonth()+1).padStart(2,"0")}-${String(B.getDate()).padStart(2,"0")}`:"",Ue=(ie==null?void 0:ie.title)||"Sans titre";return`${Ee} · ${Ue}`.trim()}function Y(ie){return ie===!0||ie==="oui"?"disponible":ie===!1||ie==="non"?"non disponible":""}function Te(ie){return ie.map(B=>B.map(be).join(",")).join(`
`)}function be(ie){const B=String(ie??"");return/[",\n\r]/.test(B)?'"'+B.replace(/"/g,'""')+'"':B}function De(ie){return String(ie||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9\-_. ]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$|^\.+|\.+$/g,"")||"fichier"}function ot(ie,B,Ee){return Array.isArray(B)&&B.includes(Ee)?ie===!1||ie==="non"?"non disponible":"sélectionné":Y(ie)}async function vt(ie){if(Qe(),ie<=0)return;const B=[...M.value],Ee=B[ie],Ue=B[ie-1],He=Ee.sortOrder;Ee.sortOrder=Ue.sortOrder,Ue.sortOrder=He;try{await Promise.all([Iu(Ee.id,Ee.sortOrder),Iu(Ue.id,Ue.sortOrder)])}catch(lt){j.error("Erreur lors du déplacement vers le haut",lt)}}async function S(ie){Qe();const B=[...M.value];if(ie>=B.length-1)return;const Ee=B[ie],Ue=B[ie+1],He=Ee.sortOrder;Ee.sortOrder=Ue.sortOrder,Ue.sortOrder=He;try{await Promise.all([Iu(Ee.id,Ee.sortOrder),Iu(Ue.id,Ue.sortOrder)])}catch(lt){j.error("Erreur lors du déplacement vers le bas",lt)}}function O(){l.value&&(c.value=l.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function H(){f.value=f.value.replace(/[^0-9]/g,""),f.value.length>4&&(f.value=f.value.slice(0,4))}async function K(){if(!l.value.trim()||!c.value.trim()||!f.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(f.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await h$(l.value.trim(),c.value.trim(),f.value.trim(),h.value.trim(),""),e.value=await tl(),await xe(),ee()}catch(ie){j.error("Erreur lors de la création de la saison",ie),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function ee(){i.value=!1,l.value="",c.value="",h.value="",f.value=""}function de(ie){A.value=ie,o.value=!0}async function _e(){o.value=!1,await ge({type:"deleteSeason",data:{seasonId:A.value.id,seasonName:A.value.name}})}function ve(){o.value=!1,A.value=null}function we(){return L.value?{deleteSeason:"Suppression de saison - Code PIN requis",editSeason:"Modification de saison - Code PIN requis"}[L.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function ge(ie){const B=ie.type==="editSeason"?ie.data.seasonId:A.value.id;if(Gn.isPinCached(B)){const Ee=Gn.getCachedPin(B);if(j.debug("PIN en cache trouvé, utilisation automatique"),await Nh(B,Ee)){await qe(ie);return}else Gn.clearSession()}L.value=ie,$.value=!0}async function Fe(ie){var B,Ee,Ue,He;j.debug("PIN soumis pour l'opération",{operationType:(B=L.value)==null?void 0:B.type});try{const lt=((Ue=(Ee=L.value)==null?void 0:Ee.data)==null?void 0:Ue.seasonId)||((He=A.value)==null?void 0:He.id),yt=await Nh(lt,ie);if(j.debug("PIN validé",{valid:yt}),yt){Gn.saveSession(lt,ie),j.debug("PIN correct, fermeture de la modal et exécution de l'opération"),$.value=!1;const At=L.value;L.value=null,j.debug("Appel de executePendingOperation",{operationType:At==null?void 0:At.type}),await qe(At)}else se.value="Code PIN incorrect",setTimeout(()=>{se.value=""},3e3)}catch(lt){j.error("Erreur lors de la vérification du PIN",lt),se.value="Erreur lors de la vérification du code PIN"}}function Re(){$.value=!1,L.value=null,se.value=""}function Oe(){return A.value&&Gn.isPinCached(A.value.id)?{timeRemaining:Gn.getTimeRemaining(),isExpiringSoon:Gn.isExpiringSoon()}:null}async function qe(ie){var Ue;if(j.debug("executePendingOperation appelé",{hasOperation:!!ie}),!ie){j.warn("Aucune opération à exécuter");return}const{type:B,data:Ee}=ie;j.info("Exécution de l'opération",{type:B});try{switch(B){case"deleteSeason":j.info("Suppression de la saison",{seasonId:Ee.seasonId}),await f$(Ee.seasonId),j.info("Saison supprimée, rechargement de la liste"),e.value=await tl(),j.info("Liste des saisons rechargée",{count:((Ue=e.value)==null?void 0:Ue.length)||0});break;case"editSeason":j.info("Modification de la saison",{seasonId:Ee.seasonId});const He=Ee.newName!==Ee.oldName,lt=Ee.newDescription!==Ee.oldDescription,yt=Ee.newLogo!==null;if(!He&&!lt&&!yt){j.info("Aucun changement détecté, opération annulée");return}const At={};if(Ee.newName!==Ee.oldName&&(At.name=Ee.newName),Ee.newDescription!==Ee.oldDescription&&(At.description=Ee.newDescription),Ee.newLogo)try{U.value=!0,j.info("Upload du nouveau logo...");const kn=await D$(Ee.newLogo,`season-logos/${Ee.seasonId}`,{resize:!0,maxWidth:64,maxHeight:64,quality:.6});if(At.logoUrl=kn,Ee.oldLogoUrl&&V$(Ee.oldLogoUrl))try{await O$(Ee.oldLogoUrl),j.info("Ancien logo supprimé")}catch(Zn){j.warn("Erreur lors de la suppression de l'ancien logo:",Zn)}}catch(kn){throw j.error("Erreur lors de l'upload du logo:",kn),new Error("Erreur lors de l'upload du logo: "+kn.message)}finally{U.value=!1}await p$(Ee.seasonId,At);const Cn=e.value.findIndex(kn=>kn.id===Ee.seasonId);Cn!==-1&&(At.name&&(e.value[Cn].name=Ee.newName),At.description!==void 0&&(e.value[Cn].description=Ee.newDescription),At.logoUrl&&(e.value[Cn].logoUrl=At.logoUrl)),j.info("Saison modifiée avec succès",{seasonId:Ee.seasonId,oldName:Ee.oldName,newName:Ee.newName,oldDescription:Ee.oldDescription,newDescription:Ee.newDescription});break;default:j.warn("Type d'opération non reconnu",{type:B})}}catch(He){j.error("Erreur lors de l'exécution de l'opération",He),alert("Erreur lors de l'opération. Veuillez réessayer.")}}function ze(){te.value=!0}function Xe(){te.value=!1}function ct(){te.value=!1,Br()}function yn(){T.value=!0}function sn(){T.value=!1}function Hn(){_.value=!0}function zt(){_.value=!1}function Ur(){I.value=!0}function jr(){I.value=!1}function Wt(){j.debug("Gestion de joueur demandée")}async function cn(){try{await Ke.signOut(),T.value=!1,j.info("Utilisateur déconnecté avec succès")}catch(ie){j.error("Erreur lors de la déconnexion",ie),alert("Erreur lors de la déconnexion. Veuillez réessayer.")}}async function Br(){try{const ie=await RA();if(ie){r.push(`/season/${ie}`);return}}catch(ie){j.warn("Impossible de récupérer la saison préférée",ie)}oe()}return En(()=>(pl(),()=>{})),St(()=>r.currentRoute.value.path,async ie=>{var B;if(ie==="/"&&(pl(),e.value.length===0&&!t.value)){t.value=!0;try{e.value=await tl(),j.info("Saisons rechargées lors du changement de route",{count:((B=e.value)==null?void 0:B.length)||0})}catch(Ee){j.error("Erreur lors du rechargement des saisons",Ee)}finally{t.value=!1}}},{immediate:!0}),(ie,B)=>{var Ee,Ue,He,lt,yt,At,Cn,kn,Zn;return k(),D("div",W6,[Ye(a6,{"is-scrolled":C.value,onOpenAccountMenu:yn,onOpenHelp:le,onOpenNotifications:Hn,onOpenPlayers:Ur,onLogout:cn,onOpenLogin:ze},null,8,["is-scrolled"]),d("section",Q6,[d("div",J6,[d("div",Y6,[d("div",X6,[B[13]||(B[13]=jn('<div class="text-center order-2 lg:order-1"><div class="hero-content-wrapper"><div class="hero-illustration relative hidden lg:block"><div class="relative mx-auto lg:mx-0 w-full max-w-lg"><div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-4 shadow-2xl border border-white/10 relative overflow-hidden"><div class="absolute inset-0 bg-gradient-to-br from-pink-500/10 via-purple-500/10 to-cyan-500/10 rounded-3xl blur-xl"></div><div class="relative z-10"><div class="flex items-center gap-3 mb-4"><div class="flex gap-2"><div class="w-3 h-3 bg-red-500 rounded-full"></div><div class="w-3 h-3 bg-yellow-500 rounded-full"></div><div class="w-3 h-3 bg-green-500 rounded-full"></div></div><div class="text-gray-400 text-sm">HatCast - Grille des disponibilités</div></div></div><div class="bg-gray-700 rounded-2xl p-4 min-h-[300px]"><div class="grid grid-cols-4 gap-2 mb-4"><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">15 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">22 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">29 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">5 Fév</div></div><div class="space-y-2"><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Marie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-gray-500/20 border border-gray-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Pierre</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Sophie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div></div></div></div></div><div class="absolute -top-4 -right-4 w-20 h-20 bg-gradient-to-r from-pink-400 to-purple-500 rounded-2xl shadow-xl transform rotate-12 z-30"></div><div class="absolute -bottom-4 -left-4 w-16 h-16 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-2xl shadow-xl transform -rotate-12 z-30 flex items-center justify-center"><img src="'+C$+'" alt="Masque HatCast" class="w-10 h-10 object-contain transform rotate-12"></div></div></div></div>',1)),d("div",Z6,[B[12]||(B[12]=jn('<div class="hero-title mb-8"><h1 class="text-4xl md:text-6xl font-bold text-white mb-6 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent leading-tight"> Faites vos équipes d&#39;impro…<br>en un clin d&#39;œil </h1></div><div class="hero-subtitle mb-10"><p class="text-xl md:text-2xl text-gray-300 leading-relaxed max-w-2xl"> Plus de casse-tête pour savoir qui joue quand. Chacun indique ses dispos, <strong class="text-white">HatCast compose l&#39;équipe pour vous</strong>, équitablement et sans tension. </p></div>',2)),d("div",eU,[d("div",tU,[d("button",{onClick:B[0]||(B[0]=rt=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-5 px-10 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105 text-lg md:text-xl"}," 🚀 Démarrez "),d("button",{onClick:le,class:"inline-flex items-center gap-2 text-cyan-300 hover:text-cyan-200 font-medium py-3 px-6 rounded-lg hover:bg-cyan-500/10 transition-all duration-300 border border-cyan-500/30 hover:border-cyan-400/50"},B[10]||(B[10]=[d("span",null,"ℹ️",-1),bt(" En savoir plus ")]))])]),d("div",{class:"hero-hint text-center"},[d("button",{onClick:oe,class:"inline-flex items-center gap-2 text-gray-400 hover:text-cyan-300 transition-all duration-300 text-sm cursor-pointer group"},B[11]||(B[11]=[d("span",{class:"group-hover:animate-bounce"},"↓",-1),d("span",null,"Vos saisons ci-dessous",-1),d("span",{class:"group-hover:animate-bounce"},"↓",-1)]))])])])])]),B[14]||(B[14]=d("div",{class:"hero-background absolute inset-0 z-0"},[d("div",{class:"absolute top-20 left-10 w-32 h-32 bg-pink-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute bottom-20 right-10 w-40 h-40 bg-purple-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-cyan-500/5 rounded-full blur-3xl"})],-1))]),d("section",nU,[d("div",rU,[B[32]||(B[32]=d("div",{class:"text-center mb-12"},[d("h2",{class:"text-3xl md:text-4xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"}," Saisons en cours "),d("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto"}," Sélectionnez une saison pour gérer les disponibilités et équipes. ")],-1)),d("div",{class:"pb-16","aria-busy":t.value},[t.value?(k(),D("div",iU,[(k(),D(dt,null,Mr(8,rt=>d("div",{key:"skeleton-"+rt,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8 w-full max-w-sm"},B[15]||(B[15]=[d("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),d("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),d("div",{class:"h-px bg-white/10 mb-4"},null,-1),d("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(k(),D("div",oU,[(k(!0),D(dt,null,Mr(M.value,(rt,Pt)=>{var er,tr;return k(),D("div",{key:rt.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20 w-full max-w-sm"},[d("div",{onClick:Vn=>N(rt.slug),class:"text-center cursor-pointer"},[d("div",lU,[rt.logoUrl?(k(),D("img",{key:0,src:rt.logoUrl,alt:`Logo de ${rt.name}`,class:"w-full h-full object-cover"},null,8,uU)):(k(),D("span",cU,"🎭"))]),d("h2",dU,re(rt.name),1),rt.description?(k(),D("p",hU,re(rt.description),1)):ce("",!0),B[18]||(B[18]=d("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),d("div",fU,[d("div",pU,[d("div",mU,re(((er=rt.events)==null?void 0:er.length)||0),1),B[16]||(B[16]=d("div",{class:"text-gray-400 text-xs"},"Événements",-1))]),d("div",gU,[d("div",vU,re(((tr=rt.players)==null?void 0:tr.length)||0),1),B[17]||(B[17]=d("div",{class:"text-gray-400 text-xs"},"Joueurs",-1))])])],8,aU),d("div",yU,[d("div",{class:"relative",onClick:B[1]||(B[1]=pt(()=>{},["stop"]))},[d("button",{onClick:Vn=>R(Pt),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===Pt,"aria-haspopup":"true",title:"Options"},B[19]||(B[19]=[d("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,_U),s.value===Pt?(k(),D("div",bU,[d("button",{onClick:Vn=>{Ze(rt),Qe()},class:"w-full text-left px-4 py-2 text-sm text-emerald-300 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},B[20]||(B[20]=[d("span",null,"📊",-1),bt(" Exporter CSV ")]),8,wU),B[25]||(B[25]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:Vn=>vt(Pt),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},B[21]||(B[21]=[d("span",null,"⬆️",-1),bt(" Avancer ")]),8,xU),d("button",{onClick:Vn=>S(Pt),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},B[22]||(B[22]=[d("span",null,"⬇️",-1),bt(" Reculer ")]),8,IU),B[26]||(B[26]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:Vn=>it(rt),class:"w-full text-left px-4 py-2 text-sm text-blue-300 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},B[23]||(B[23]=[d("span",null,"✏️",-1),bt(" Modifier ")]),8,EU),B[27]||(B[27]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:Vn=>de(rt),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2",role:"menuitem"},B[24]||(B[24]=[d("span",null,"🗑️",-1),bt(" Supprimer ")]),8,TU)])):ce("",!0)])])])}),128))])):ce("",!0),d("div",AU,[d("button",{onClick:B[2]||(B[2]=rt=>i.value=!0),class:"inline-flex items-center gap-3 bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-semibold py-4 px-8 rounded-xl text-lg hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-pink-500/25"},B[28]||(B[28]=[d("span",null,"➕",-1),bt(" Nouvelle saison ")]))]),!t.value&&e.value.length===0?(k(),D("div",SU,[B[29]||(B[29]=d("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-4xl"},"🎪")],-1)),B[30]||(B[30]=d("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),B[31]||(B[31]=d("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),d("button",{onClick:B[3]||(B[3]=rt=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):ce("",!0)],8,sU)])]),i.value?(k(),D("div",PU,[d("div",RU,[B[39]||(B[39]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),d("div",CU,[B[33]||(B[33]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),ut(d("input",{"onUpdate:modelValue":B[4]||(B[4]=rt=>l.value=rt),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:O},null,544),[[Mt,l.value]])]),d("div",kU,[B[34]||(B[34]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),ut(d("input",{"onUpdate:modelValue":B[5]||(B[5]=rt=>c.value=rt),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[Mt,c.value]])]),d("div",DU,[B[35]||(B[35]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description (optionnel)",-1)),ut(d("textarea",{"onUpdate:modelValue":B[6]||(B[6]=rt=>h.value=rt),rows:"3",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",placeholder:"Ex: Saison 2025-2026 de la troupe d'improvisation La Malice"},null,512),[[Mt,h.value]]),B[36]||(B[36]=d("p",{class:"text-xs text-gray-400 mt-1"},"Une brève description de votre saison",-1))]),d("div",NU,[B[37]||(B[37]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),ut(d("input",{"onUpdate:modelValue":B[7]||(B[7]=rt=>f.value=rt),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:H},null,544),[[Mt,f.value]]),B[38]||(B[38]=d("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),d("div",OU,[d("button",{onClick:ee,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:K,disabled:!l.value.trim()||!c.value.trim()||!f.value.trim()||f.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,VU)])])])):ce("",!0),o.value?(k(),D("div",MU,[d("div",LU,[d("div",$U,[B[40]||(B[40]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"⚠️")],-1)),B[41]||(B[41]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",FU,'Êtes-vous sûr de vouloir supprimer la saison "'+re((Ee=A.value)==null?void 0:Ee.name)+'" ?',1)]),B[42]||(B[42]=d("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:ve,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:_e,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ce("",!0),a.value?(k(),D("div",UU,[d("div",jU,[d("div",BU,[B[43]||(B[43]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"✏️")],-1)),B[44]||(B[44]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Modifier la saison",-1)),d("p",qU,'Modifiez les informations de la saison "'+re((Ue=F.value)==null?void 0:Ue.name)+'"',1)]),d("div",zU,[B[45]||(B[45]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),ut(d("input",{"onUpdate:modelValue":B[8]||(B[8]=rt=>m.value=rt),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026"},null,512),[[Mt,m.value]])]),d("div",HU,[B[46]||(B[46]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description (optionnel)",-1)),ut(d("textarea",{"onUpdate:modelValue":B[9]||(B[9]=rt=>v.value=rt),rows:"3",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400 resize-none",placeholder:"Ex: Saison 2025-2026 de la troupe d'improvisation La Malice"},null,512),[[Mt,v.value]])]),d("div",KU,[B[47]||(B[47]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Logo de la troupe (optionnel)",-1)),E.value||(He=F.value)!=null&&He.logoUrl?(k(),D("div",GU,[d("div",WU,[d("img",{src:E.value||((lt=F.value)==null?void 0:lt.logoUrl),alt:`Logo de ${(yt=F.value)==null?void 0:yt.name}`,class:"w-full h-full object-cover"},null,8,QU)]),E.value||(At=F.value)!=null&&At.logoUrl?(k(),D("button",{key:0,onClick:X,type:"button",class:"text-xs text-red-400 hover:text-red-300 transition-colors"}," Supprimer le logo ")):ce("",!0)])):ce("",!0),d("div",{class:Qt(["border-2 border-dashed rounded-lg p-6 text-center transition-all duration-300",U.value?"border-blue-500 bg-blue-900/20 animate-pulse":"border-gray-600 hover:border-gray-500"])},[d("input",{ref:"logoFileInput",type:"file",accept:"image/*",onChange:Ce,class:"hidden"},null,544),d("button",{onClick:W,type:"button",disabled:U.value,class:"text-gray-300 hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[U.value?(k(),D("div",YU,"⏳")):(k(),D("div",XU,"📷")),d("div",ZU,[U.value?(k(),D("span",e5," Upload en cours... ")):!E.value&&!((Cn=F.value)!=null&&Cn.logoUrl)?(k(),D("span",t5," Cliquez pour ajouter un logo ")):(k(),D("span",n5," Cliquez pour changer le logo "))]),U.value?ce("",!0):(k(),D("div",r5," PNG, JPG, GIF (max 5MB) "))],8,JU)],2)]),B[49]||(B[49]=d("p",{class:"mb-6 text-sm text-blue-400 bg-blue-900/20 p-3 rounded-lg border border-blue-500/20"}," ℹ️ Le slug de l'URL restera inchangé pour préserver les liens existants. ",-1)),d("div",s5,[d("button",{onClick:ye,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:ne,disabled:!m.value.trim()||m.value.trim()===((kn=F.value)==null?void 0:kn.name)&&v.value===(((Zn=F.value)==null?void 0:Zn.description)||"")&&!w.value||U.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"},[U.value?(k(),D("span",o5,B[48]||(B[48]=[d("span",{class:"animate-spin"},"⏳",-1),bt(" Upload en cours... ")]))):(k(),D("span",a5,"Modifier"))],8,i5)])])])):ce("",!0),Ye(NA,{show:$.value,message:we(),error:se.value,"session-info":Oe(),onSubmit:Fe,onCancel:Re},null,8,["show","message","error","session-info"]),B[50]||(B[50]=jn('<section class="help-section py-20 bg-gradient-to-br from-gray-900/50 to-gray-800/50 border-t border-white/10"><div class="container mx-auto px-4"><div class="max-w-6xl mx-auto"><div class="text-center mb-16"><h2 class="text-4xl md:text-5xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"> Qu&#39;est-ce que HatCast ? </h2><p class="text-xl text-purple-300 max-w-3xl mx-auto"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête </p></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16"><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-pink-500/20 to-purple-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-pink-500/30"><span class="text-4xl">🎭</span></div><h3 class="text-xl font-bold text-white mb-3">Gestion des saisons</h3><p class="text-gray-300 text-sm leading-relaxed"> Déclarez tous vos spectacles et indiquez combien de joueurs vous aurez besoin. Organisez votre saison d&#39;impro de A à Z. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-purple-500/20 to-cyan-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-purple-500/30"><span class="text-4xl">📅</span></div><h3 class="text-xl font-bold text-white mb-3">Sondage de disponibilités</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez des sondages pour vos événements. Chaque joueur indique ses disponibilités et HatCast optimise la composition des équipes. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-cyan-500/20 to-pink-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-cyan-500/30"><span class="text-4xl">🎲</span></div><h3 class="text-xl font-bold text-white mb-3">Sélection auto ou manuelle</h3><p class="text-gray-300 text-sm leading-relaxed"> Laissez le hasard pondéré décider ou reprenez la main à tout moment. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-green-500/20 to-blue-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-green-500/30"><span class="text-4xl">📱</span></div><h3 class="text-xl font-bold text-white mb-3">Pensé pour le mobile</h3><p class="text-gray-300 text-sm leading-relaxed"> Utilisez HatCast facilement sur smartphone ou tablette, où que vous soyez. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-blue-500/20 to-indigo-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-blue-500/30"><span class="text-4xl">🔐</span></div><h3 class="text-xl font-bold text-white mb-3">Comptes facultatifs</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez un compte pour recevoir des rappels et sécuriser vos infos. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-emerald-500/20 to-teal-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-emerald-500/30"><span class="text-4xl">🔔</span></div><h3 class="text-xl font-bold text-white mb-3">Notifications intelligentes</h3><p class="text-gray-300 text-sm leading-relaxed"> Recevez des alertes par email et push pour les événements et sélections. Restez informé sans être submergé. </p></div></div></div></div></section><footer class="border-t border-white/10 bg-gradient-to-br from-gray-900/50 to-gray-800/50"><div class="container mx-auto px-4 py-12"><div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8"><div class="col-span-1 md:col-span-2"><div class="flex items-center gap-3 mb-4"><div class="relative w-32 h-8"><img src="'+kA+'" alt="Logo HatCast" class="w-full h-full opacity-80"></div></div><p class="text-gray-400 text-sm leading-relaxed max-w-md"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête. </p></div><div><h4 class="text-white font-semibold mb-4 text-sm uppercase tracking-wider">Contact</h4><div class="space-y-2"><a href="mailto:impropick@gmail.com" class="block text-gray-400 hover:text-blue-300 transition-colors text-sm"> 📧 impropick@gmail.com </a><p class="text-gray-500 text-xs">Retours et suggestions bienvenus</p></div></div><div><h4 class="text-white font-semibold mb-4 text-sm uppercase tracking-wider">Ressources</h4><div class="space-y-2"><a href="#" class="block text-gray-400 hover:text-blue-300 transition-colors text-sm"> 📚 Guide utilisateur </a><a href="https://github.com/plamarque/hatcast" target="_blank" rel="noopener noreferrer" class="block text-gray-400 hover:text-blue-300 transition-colors text-sm"> 🔗 Code source </a><p class="text-gray-500 text-xs">Documentation en cours</p></div></div></div><div class="border-t border-white/10 mb-6"></div><div class="flex flex-col sm:flex-row items-center justify-between text-xs text-gray-500"><div class="flex items-center gap-4 mb-4 sm:mb-0"><span>© Patrice Lamarque 2025</span><span class="hidden sm:inline">•</span><span>Licence MIT</span></div><div class="flex items-center gap-4"><span class="text-gray-600">En cours de développement</span><a href="https://github.com/plamarque/hatcast" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-blue-300 transition-colors underline decoration-gray-600 hover:decoration-blue-300"> GitHub </a></div></div></div></footer>',2)),Ye(VA,{show:te.value,onClose:Xe,onSuccess:ct},null,8,["show"]),Ye(ZA,{show:T.value,onClose:sn,onLogoutDevice:cn},null,8,["show"]),Ye(e1,{show:_.value,onClose:zt},null,8,["show"]),Ye(t1,{show:I.value,onClose:jr,onManagePlayer:Wt},null,8,["show"])])}}};function u5({reason:n,recipientName:e,eventTitle:t,eventDate:r,urls:s={},prefs:i={},extra:o={}}){var l,c;const a={email:null,push:null};if(n==="availability_request"||n==="availability_reminder"){const h=(i==null?void 0:i.notifyAvailability)!==!1,f=(i==null?void 0:i.notifyAvailabilityPush)!==!1;a.email={enabled:h,subject:n==="availability_reminder"?`Rappel disponibilité · ${t} (${r})`:`Disponibilité demandée · ${t} (${r})`},a.push={enabled:f,title:n==="availability_reminder"?"⏰ Rappel disponibilité":`${t} (${r})`,body:n==="availability_reminder"?`${e}, ${t} (${r})`:`${e}, t'es dispo ?`,data:{url:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,reason:n}},console.log("URLs pour notifications de disponibilité:",{eventUrl:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,urls:s})}if(n==="selection"){const h=(i==null?void 0:i.notifySelection)!==!1,f=(i==null?void 0:i.notifySelectionPush)!==!1;a.email={enabled:h,subject:`🎭 Equipe pour ${t}`},a.push={enabled:f,title:`🎭 Equipe pour ${t}`,body:`${e}, tu fais partie de l'équipe pour ${t} le ${r}!`,data:{url:s.eventUrl,noUrl:s.noUrl,reason:n}},console.log("URLs pour notifications de sélection:",{eventUrl:s.eventUrl,noUrl:s.noUrl,urls:s})}return console.log("buildNotificationPayloads",{reason:n,recipientName:e,prefs:i,payloads:a,emailEnabled:(l=a.email)==null?void 0:l.enabled,pushEnabled:(c=a.push)==null?void 0:c.enabled}),a}function Pb({recipientName:n,eventTitle:e,eventDate:t}){return{title:`${e} (${t})`,body:`${n}, t'es dispo ?`}}function Rb({recipientName:n,eventTitle:e,eventDate:t}){return{title:`🎭 Equipe pour ${e}`,body:`${n}, tu fais partie de l'équipe pour ${e} le ${t}!`}}function Cb({recipientName:n,eventTitle:e,eventDate:t,eventUrl:r,yesUrl:s,noUrl:i}){return{subject:`Disponibilité demandée · ${e} (${t})`,from:"HatCast",to:n,html:jA({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,yesUrl:s,noUrl:i})}}function kb({recipientName:n,eventTitle:e,eventDate:t,eventUrl:r,noUrl:s}){return{subject:`🎭 Equipe pour ${e}`,from:"HatCast",to:n,html:aF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,noUrl:s})}}async function c5({reason:n,recipientEmail:e,recipientName:t,eventTitle:r,eventDate:s,urls:i={},extra:o={}}){var m;if(!e)return{success:!1,skipped:!0,reason:"missing_email"};const a=await Gt(Se(ue,"userPreferences",e)).catch(()=>null),l=a!=null&&a.exists()?a.data():{},c=u5({reason:n,recipientName:t,eventTitle:r,eventDate:s,urls:i,prefs:l,extra:o}),h=[];return c.email&&c.email.enabled&&(n==="availability_request"||n==="availability_reminder"?await fF({toEmail:e,playerName:t,eventTitle:r,eventDate:s,yesUrl:i.yesUrl,noUrl:i.noUrl,eventUrl:i.eventUrl,reason:n==="availability_reminder"?"reminder":"new_event"}).then(()=>h.push({channel:"email",success:!0})).catch(v=>{j.error("notifyRecipientAcrossChannels email error",v),h.push({channel:"email",success:!1})}):n==="selection"&&h.push({channel:"email",success:!0,skipped:!0,note:"batch_handled_elsewhere"})),c.push&&c.push.enabled?(j.debug("Envoi notification push",{reason:n,recipientEmail:e,title:c.push.title,body:c.push.body}),await ed({toEmail:e,title:c.push.title,body:c.push.body,data:c.push.data||{},reason:n}).then(()=>{j.info("Notification push envoyée avec succès",{reason:n,recipientEmail:e}),h.push({channel:"push",success:!0})}).catch(v=>{j.error("notifyRecipientAcrossChannels push error",v),h.push({channel:"push",success:!1})})):j.debug("Notification push désactivée ou non configurée",{reason:n,recipientEmail:e,hasPayload:!!c.push,enabled:(m=c.push)==null?void 0:m.enabled,prefs:l}),{success:h.some(v=>v.success),results:h}}async function Db({eventId:n,eventData:e,players:t,seasonId:r,seasonSlug:s,createMagicLink:i,reminder:o=!1,getAvailabilityForEvent:a=null}){const l=[],c=`${window.location.origin}/season/${s}/event/${n}`;for(const h of t)try{if(o&&typeof a=="function"){const v=await Promise.resolve(a(h.name,n));if(v===!0||v===!1)continue}const f={};if(typeof i=="function"){const v=await i({seasonId:r,playerId:h.id,eventId:n,action:"yes"}),w=await i({seasonId:r,playerId:h.id,eventId:n,action:"no"});f.yesUrl=`${v.url}&slug=${encodeURIComponent(s)}`,f.noUrl=`${w.url}&slug=${encodeURIComponent(s)}`}f.eventUrl=c,(await c5({reason:o?"availability_reminder":"availability_request",recipientEmail:h.email,recipientName:h.name,eventTitle:e.title,eventDate:d5(e.date),urls:f})).success||l.push(h.id)}catch{l.push(h.id)}return{success:!0,failures:l}}async function Nb(n){return vF(n)}function d5(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function h5(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//HatCast//Calendar Event//FR","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${n.id}@impropick.com`,`DTSTAMP:${new Date().toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTSTART:${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTEND:${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`SUMMARY:${n.title}`,`DESCRIPTION:${n.description||""}${e?`\\n\\nSaison : ${e}`:""}`,"STATUS:CONFIRMED","SEQUENCE:0","BEGIN:VALARM","TRIGGER:-PT1H","ACTION:DISPLAY",`DESCRIPTION:Rappel : ${n.title}`,"END:VALARM","END:VEVENT","END:VCALENDAR"].join(`\r
`)}function f5(n,e=""){const t=h5(n,e),r=new Blob([t],{type:"text/calendar;charset=utf-8"}),s=URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=`${n.title.replace(/[^a-z0-9]/gi,"_")}_${n.date}.ics`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}function p5(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://calendar.google.com/calendar/render?${new URLSearchParams({action:"TEMPLATE",text:n.title,dates:`${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z/${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,details:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"HatCast",sf:"true",output:"xml"}).toString()}`}function m5(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://outlook.live.com/calendar/0/deeplink/compose?${new URLSearchParams({subject:n.title,startdt:r.toISOString(),enddt:s.toISOString(),body:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"HatCast",allday:"false"}).toString()}`}function g5(n,e=""){const t=p5(n,e);window.open(t,"_blank")}function v5(n,e=""){const t=m5(n,e);window.open(t,"_blank")}function y5(n,e,t=""){switch(n){case"ics":f5(e,t);break;case"google":g5(e,t);break;case"outlook":v5(e,t);break;default:console.warn("Type de calendrier non supporté:",n)}}const _5="/icons/manifest-icon-192.maskable.png",b5={class:"relative p-5 pb-4 border-b border-white/10"},w5={class:"text-xl md:text-2xl font-bold text-white pr-10 flex items-center gap-2"},x5={class:"hidden sm:inline"},I5={key:0,class:"text-sm text-purple-300 mt-1"},E5={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},T5={class:"space-y-4"},A5={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},S5={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},P5={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},R5={key:0,class:"space-y-2"},C5={class:"flex flex-wrap gap-2"},k5=["onClick","title"],D5={key:1,class:"text-amber-400 text-sm"},N5={class:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4 mb-3"},O5={class:"inline-flex bg-gray-800 rounded-lg overflow-hidden border border-gray-700 self-start"},V5={class:"text-sm text-gray-400"},M5={key:0},L5={key:1},$5={key:2},F5={class:"text-sm text-gray-300"},U5={class:"text-sm text-gray-300"},j5={class:"text-sm text-gray-300"},B5=["innerHTML"],q5=["value"],z5={class:"mt-3"},H5={class:"text-lg font-semibold leading-snug"},K5={class:"mt-2 text-base whitespace-pre-line text-white/90"},G5={class:"mt-4 flex items-center gap-4 text-base"},W5={key:1,class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-red-600/20 text-red-300 border border-red-600/40"},Q5={class:"bg-yellow-500/10 border border-yellow-500/30 text-yellow-200 rounded-md p-3 text-sm mb-2"},J5=["value"],Y5={key:2,class:"space-y-3"},X5=["value"],Z5={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},ej={class:"flex items-center gap-2 w-full"},tj=["disabled"],nj={key:0},rj={class:"hidden sm:inline"},sj={key:1,class:"inline-flex items-center gap-2"},ij=["title"],oj={key:0},aj={key:1},s1={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]},sending:{type:Boolean,default:!1},availabilityByPlayer:{type:Object,default:()=>({})}},emits:["close","notifications-sent","send-notifications"],setup(n,{emit:e}){const t=n,r=e;P("notify");const s=P(!1),i=P("Copier le message"),o=P(!1),a=$e(()=>t.sending||o.value),l=P(!1),c=P("email"),h=$e(()=>!t.event||!t.seasonSlug?"":`${window.location.origin}/season/${t.seasonSlug}/event/${t.event.id}`),f=$e(()=>{var Ce,X,W,xe;if(!t.event)return"";const ye=((Ce=L.value)==null?void 0:Ce.id)==="ALL"?"<joueur>":((X=L.value)==null?void 0:X.name)||"[Nom du joueur]",ne=N((W=t.event)==null?void 0:W.date),le=(xe=t.event)==null?void 0:xe.title,oe=h.value;return t.mode==="event"?uF({playerName:ye,eventTitle:le,eventDate:ne,eventUrl:oe}):cF({playerName:ye,eventTitle:le,eventDate:ne,eventUrl:oe})}),m=$e(()=>t.event?(c.value==="push"||c.value==="copy",f.value):""),v=$e(()=>{var le,oe,Ce,X,W;if(!t.event)return"";const ye=N((le=t.event)==null?void 0:le.date),ne=((oe=L.value)==null?void 0:oe.id)==="ALL"?"<joueur>":((Ce=L.value)==null?void 0:Ce.name)||"[Nom du joueur]";return t.mode==="event"?Cb({recipientName:ne,eventTitle:(X=t.event)==null?void 0:X.title,eventDate:ye,eventUrl:h.value,yesUrl:`${h.value}?action=available`,noUrl:`${h.value}?action=unavailable`}).subject:kb({recipientName:ne,eventTitle:(W=t.event)==null?void 0:W.title,eventDate:ye,eventUrl:h.value,noUrl:I.value}).subject}),w=$e(()=>"HatCast"),E=$e(()=>{var le,oe,Ce,X,W,xe,Ze;if(!t.event)return"";const ye=N((le=t.event)==null?void 0:le.date),ne=((oe=L.value)==null?void 0:oe.id)==="ALL"?"<joueur>":((Ce=L.value)==null?void 0:Ce.name)||"[Nom du joueur]";return L.value&&L.value.id&&L.value.id!=="ALL"&&!((X=te.value.find(mt=>mt.id===L.value.id))!=null&&X.hasContact)?lF({playerName:ne,eventTitle:(W=t.event)==null?void 0:W.title,eventDate:ye,eventUrl:h.value}):t.mode==="event"?Cb({recipientName:ne,eventTitle:(xe=t.event)==null?void 0:xe.title,eventDate:ye,eventUrl:h.value,yesUrl:`${h.value}?action=available`,noUrl:`${h.value}?action=unavailable`}).html:kb({recipientName:ne,eventTitle:(Ze=t.event)==null?void 0:Ze.title,eventDate:ye,eventUrl:h.value,noUrl:I.value}).html});$e(()=>E.value.replace(/<\/?div[^>]*>/g,`
`).replace(/<\/?p[^>]*>/g,`
`).replace(/<br\s*\/?>(\n)?/g,`
`).replace(/<[^>]+>/g,"").replace(/\n{3,}/g,`

`).trim());const A=$e(()=>{var le,oe,Ce,X,W;if(!t.event)return"";const ye=N((le=t.event)==null?void 0:le.date),ne=((oe=L.value)==null?void 0:oe.id)==="ALL"?"<joueur>":((Ce=L.value)==null?void 0:Ce.name)||"[Nom du joueur]";return t.mode==="event"?Pb({recipientName:ne,eventTitle:(X=t.event)==null?void 0:X.title,eventDate:ye}).title:Rb({recipientName:ne,eventTitle:(W=t.event)==null?void 0:W.title,eventDate:ye}).title}),F=$e(()=>{var Ce,X,W,xe,Ze,mt;if(!t.event)return"";const ye=N((Ce=t.event)==null?void 0:Ce.date),ne=((X=L.value)==null?void 0:X.id)==="ALL"?"<joueur>":((W=L.value)==null?void 0:W.name)||"[Nom du joueur]",le=L.value&&L.value.id&&L.value.id!=="ALL",oe=le?!!((xe=te.value.find(qt=>qt.id===L.value.id))!=null&&xe.hasContact):!0;return le&&!oe?f.value:t.mode==="event"?Pb({recipientName:ne,eventTitle:(Ze=t.event)==null?void 0:Ze.title,eventDate:ye}).body:Rb({recipientName:ne,eventTitle:(mt=t.event)==null?void 0:mt.title,eventDate:ye}).body}),U=P([]),$=P([]),L=P(null),se=P([]),te=$e(()=>{const ye=$.value.map(le=>({...le,hasContact:le.id!=="ALL",missingReason:""})),ne=se.value.map(le=>({...le,hasContact:!1,missingReason:"Aucun canal actif"}));return[{id:"ALL",name:"Tous",hasContact:!0},...ye.filter(le=>le.id!=="ALL"),...ne]}),T=$e(()=>{if(!L.value||L.value.id==="ALL")return!0;const ye=te.value.find(le=>(le.id||le.name)===(L.value.id||L.value.name)),ne=!!(ye!=null&&ye.hasContact);return console.log("hasSelectedRecipientContact debug:",{selectedRecipient:L.value,allDisplayRecipients:te.value,foundRecipient:ye,hasContact:ne,recipients:$.value,nonContactRecipients:se.value}),ne}),_=$e(()=>f.value),I=$e(()=>{var ye,ne;try{const le=(ye=L.value)!=null&&ye.id&&L.value.id!=="ALL"?t.players.find(oe=>oe.id===L.value.id):null;return!le||!((ne=t.event)!=null&&ne.id)||!t.seasonId?"[lien désistement]":`${window.location.origin}/magic?auto=no&season=${encodeURIComponent(t.seasonId)}&player=${encodeURIComponent(le.id)}&event=${encodeURIComponent(t.event.id)}&slug=${encodeURIComponent(t.seasonSlug||"")}`}catch{return"[lien désistement]"}});async function C(){if(!t.seasonId)return;let ye=[];t.mode==="selection"?(ye=t.players.filter(Ce=>t.selectedPlayers.includes(Ce.name)),console.log("Mode sélection - targetPlayers:",ye)):(ye=t.players.filter(Ce=>{var W;return typeof((W=t.availabilityByPlayer)==null?void 0:W[Ce.name])>"u"}),console.log("Mode événement - targetPlayers:",ye));const ne=[];for(const Ce of ye)try{const{getPlayerEmail:X}=await an(()=>Promise.resolve().then(()=>td),void 0),W=await X(Ce.id,t.seasonId);console.log(`Email pour ${Ce.name}:`,W),W&&ne.push({...Ce,email:W})}catch(X){console.warn(`Impossible de charger l'email pour ${Ce.name}:`,X)}console.log("Players avec email:",ne),U.value=ne;const le={id:"ALL",name:"Tous"};$.value=[le,...ne];const oe=ye.filter(Ce=>!ne.find(X=>X.id===Ce.id)).map(Ce=>({id:Ce.id,name:Ce.name}));se.value=oe,console.log("Recipients finaux:",{recipients:$.value,nonContactRecipients:se.value,allDisplayRecipients:te.value}),L.value||(L.value=le)}function M(){r("close")}function N(ye){var le;return ye?(typeof ye=="string"?new Date(ye):((le=ye.toDate)==null?void 0:le.call(ye))||ye).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function R(){const ye=m.value;navigator.clipboard.writeText(ye).then(()=>{s.value=!0,i.value="Copié !",setTimeout(()=>{s.value=!1,i.value="Copier le message"},2e3)}).catch(ne=>{console.warn("Erreur lors de la copie du texte"),alert("Impossible de copier le message.")})}function Qe(ye){L.value=ye}async function it(){if(!(!t.event||$.value.length===0)){o.value=!0;try{const ye=L.value&&L.value.id!=="ALL"?"single":"all",ne=ye==="single"?{id:L.value.id,name:L.value.name,email:L.value.email}:null;t.mode==="selection"?r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:"selection",selectedPlayers:t.selectedPlayers,scope:ye,recipient:ne}):r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:"manual",scope:ye,recipient:ne})}catch{console.error("Erreur lors de l'envoi des notifications"),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer.")}finally{setTimeout(()=>{o.value=!1},1e3)}}}return En(()=>{t.show&&C()}),St(()=>t.show,ye=>{ye&&C()}),St(()=>t.selectedPlayers,()=>{t.show&&t.mode==="selection"&&C()}),St(()=>t.availabilityByPlayer,()=>{t.show&&t.mode==="event"&&C()},{deep:!0}),St(()=>t.sending,ye=>{ye||(o.value=!1)}),(ye,ne)=>{var le,oe,Ce,X,W;return n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:M},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:ne[4]||(ne[4]=pt(()=>{},["stop"]))},[d("div",b5,[d("button",{onClick:M,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("h2",w5,[d("span",x5,re(n.mode==="selection"?"📣":"📢"),1),d("span",null,re(n.mode==="selection"?"Annoncer la sélection":"Annoncer l'événement"),1)]),n.event?(k(),D("p",I5,re(n.event.title)+" — "+re(N(n.event.date)),1)):ce("",!0)]),d("div",E5,[d("div",T5,[d("div",null,[d("label",A5,[ne[5]||(ne[5]=bt(" Personnes à Prévenir ")),d("button",{onClick:ne[0]||(ne[0]=xe=>l.value=!l.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),l.value?(k(),D("div",S5,ne[6]||(ne[6]=[d("p",{class:"text-blue-200 text-sm"},[bt(" Cette liste montre tous les joueurs ciblés: "),d("span",{class:"text-purple-300"},"« Tous »"),bt(", "),d("span",{class:"text-gray-200"},"ceux notifiables (email/push actifs)"),bt(" et "),d("span",{class:"text-yellow-300"},"ceux en jaune sans canal actif"),bt(". Les joueurs en jaune ne peuvent pas être notifiés automatiquement. Utilise « Copier le message » pour leur écrire via un autre moyen (l'URL de l'événement est incluse). ")],-1)]))):ce("",!0),d("div",P5,[te.value.length>0?(k(),D("div",R5,[d("div",C5,[(k(!0),D(dt,null,Mr(te.value,xe=>(k(),D("button",{key:xe.id||xe.name,type:"button",onClick:Ze=>Qe(xe),class:Qt(["px-3 py-1 rounded text-sm border transition-colors",L.value&&L.value.id===xe.id?"bg-purple-600 border-purple-500 text-white":xe.hasContact?"bg-gray-700 border-gray-600 text-white hover:bg-gray-600":"bg-yellow-900/20 border-yellow-600/40 text-yellow-200 hover:bg-yellow-900/30 opacity-75 cursor-not-allowed"]),title:xe.hasContact?"Prévisualiser pour "+xe.name:xe.missingReason||"Aucun canal actif"},re(xe.name),11,k5))),128))])])):(k(),D("div",D5," ⚠️ Aucun destinataire disponible. "))])]),d("div",null,[ne[14]||(ne[14]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Aperçu du message :",-1)),d("div",N5,[d("div",O5,[d("button",{class:Qt(["px-3 py-1.5 text-sm transition-colors",c.value==="email"?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-700"]),onClick:ne[1]||(ne[1]=xe=>c.value="email"),title:"Prévisualiser l'email"},"📧",2),d("button",{class:Qt(["px-3 py-1.5 text-sm transition-colors",c.value==="push"?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-700"]),onClick:ne[2]||(ne[2]=xe=>c.value="push"),title:"Prévisualiser la notification push"},"🔔",2),d("button",{class:Qt(["px-3 py-1.5 text-sm transition-colors",c.value==="copy"?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-700"]),onClick:ne[3]||(ne[3]=xe=>c.value="copy"),title:"Texte à copier pour les joueurs sans canal actif"},"📋",2)]),d("div",V5,[c.value==="email"?(k(),D("span",M5,"Voici le message que ceux qui ont configuré un email recevront")):c.value==="push"?(k(),D("span",L5,"Voici la notification que ceux qui ont installé l'app mobile recevront")):(k(),D("span",$5,"Voici un texte simple que vous pouvez copier-coller pour annoncer cet événement vous-même où vous voulez (WhatsApp, Email, etc...)"))])]),c.value==="email"?(k(),D("div",{key:0,class:Qt(T.value||((le=L.value)==null?void 0:le.id)==="ALL"?"bg-gray-800 border border-gray-600 rounded-lg p-4 text-white space-y-3":"space-y-3")},[T.value||((oe=L.value)==null?void 0:oe.id)==="ALL"?(k(),D(dt,{key:0},[d("div",F5,[ne[7]||(ne[7]=d("span",{class:"font-semibold"},"De:",-1)),bt(" "+re(w.value),1)]),d("div",U5,[ne[8]||(ne[8]=d("span",{class:"font-semibold"},"À:",-1)),bt(" "+re(((Ce=L.value)==null?void 0:Ce.id)==="ALL"?"<joueur>":((X=L.value)==null?void 0:X.name)||"[Nom du joueur]"),1)]),d("div",j5,[ne[9]||(ne[9]=d("span",{class:"font-semibold"},"Objet:",-1)),bt(" "+re(v.value),1)]),d("div",{class:"bg-gray-700 border border-gray-600 text-gray-100 rounded-md p-4 shadow-inner",innerHTML:E.value},null,8,B5)],64)):(k(),D(dt,{key:1},[ne[10]||(ne[10]=d("div",{class:"bg-yellow-500/10 border border-yellow-500/30 text-yellow-200 rounded-md p-3 text-sm"}," Ce joueur n'a pas configuré d'email. Utilise la fonction « Copier le message » et envoie-lui ces informations par un autre canal. ",-1)),d("textarea",{class:"w-full mt-2 p-3 bg-gray-900 border border-gray-700 rounded-md text-white text-sm",value:_.value,rows:"5",readonly:""},null,8,q5)],64))],2)):c.value==="push"?(k(),D("div",{key:1,class:Qt(L.value&&L.value.id!=="ALL"&&!T.value?"text-white":"bg-gray-900 border border-gray-700 rounded-xl p-4 text-white")},[L.value&&L.value.id!=="ALL"&&!T.value?(k(),D(dt,{key:1},[d("div",Q5,re((W=L.value)==null?void 0:W.name)+" n'a pas installé l'appli. Envoie-lui ce message manuellement. ",1),d("textarea",{class:"w-full p-3 bg-gray-800 border border-gray-700 rounded-md text-white text-sm",value:_.value,rows:"5",readonly:""},null,8,J5)],64)):(k(),D(dt,{key:0},[ne[13]||(ne[13]=jn('<div class="flex items-center justify-between text-xs text-white/70"><div class="flex items-center gap-2 min-w-0"><div class="w-6 h-6 rounded-full bg-white/10 flex items-center justify-center">🔔</div><div class="truncate">HatCast</div><span class="opacity-60">•</span><span>il y a 1 min</span></div><img src="'+_5+'" alt="App icon" class="w-10 h-10 rounded-full shadow"></div>',1)),d("div",z5,[d("div",H5,re(A.value),1),d("div",K5,re(F.value),1)]),d("div",G5,[t.mode==="event"?(k(),D(dt,{key:0},[ne[11]||(ne[11]=d("span",{class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-green-600/20 text-green-300 border border-green-600/40"},"✅ Dispo",-1)),ne[12]||(ne[12]=d("span",{class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-red-600/20 text-red-300 border border-red-600/40"},"❌ Pas dispo",-1))],64)):(k(),D("span",W5,"❌ Plus dispo"))])],64))],2)):c.value==="copy"?(k(),D("div",Y5,[d("textarea",{class:"w-full p-3 bg-gray-800 border border-gray-700 rounded-md text-white text-sm resize-none",value:m.value,rows:"6",readonly:""},null,8,X5)])):ce("",!0)])])]),d("div",Z5,[d("div",ej,[d("button",{onClick:it,disabled:$.value.length===0||a.value||L.value&&L.value.id!=="ALL"&&!T.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[a.value?(k(),D("span",sj,ne[18]||(ne[18]=[d("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[d("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),d("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),bt(" Envoi en cours... ")]))):(k(),D("span",nj,[L.value&&L.value.id!=="ALL"?(k(),D("span",{key:0,class:Qt(T.value?"":"opacity-60")},[d("span",rj,"🔔 Notifier "+re(L.value.name),1),ne[15]||(ne[15]=d("span",{class:"sm:hidden"},"🔔 Notifier",-1))],2)):(k(),D(dt,{key:1},[ne[16]||(ne[16]=d("span",{class:"hidden sm:inline"},"🔔 Envoyer les notifications",-1)),ne[17]||(ne[17]=d("span",{class:"sm:hidden"},"🔔 Envoyer",-1))],64))]))],8,tj),d("button",{onClick:R,class:"h-12 px-6 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:i.value},[s.value?(k(),D("span",aj,"✅ Copié")):(k(),D("span",oj,ne[19]||(ne[19]=[d("span",{class:"hidden sm:inline"},"📋 Copier le message",-1),d("span",{class:"sm:hidden"},"📋 Copier",-1)])))],8,ij)]),d("button",{onClick:M,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):ce("",!0)}}},lj={class:"relative p-6 pb-4 border-b border-white/10"},uj={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},cj={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=pt(()=>{},["stop"]))},[d("div",lj,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"❓"),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Kezako ?"),d("p",{class:"text-sm text-purple-300"},"L'appli pour organiser vos spectacles d'improvisation de manière simple et apaisée")])],-1))]),s[5]||(s[5]=jn('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">C&#39;est quoi ?</h3><p> HatCast est une appli conçue pour faciliter <span class="text-white">la sélection des joueurs d&#39;impro</span> pour les spectacles. L&#39;idée est née au sein de <span class="text-purple-300">La Malice</span> pour <span class="text-white">dépersonnaliser une tâche délicate</span> qui créait des tensions depuis des années. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">Comment ça marche</h3><p> L&#39;asso déclare ses dates et le nombre de personnes nécessaires. Les joueurs indiquent leurs disponibilités. L&#39;appli propose des sélections. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Sélection auto ou manuelle</h3><p> Le <span class="text-white">mode sélection auto</span> s&#39;appuie sur le hasard (pondéré) pour simplifier la vie. Vous pouvez aussi repasser en mode <span class="text-white">manuel</span> si besoin. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Pensée mobile • Libre d&#39;utilisation</h3><p> L&#39;appli est <span class="text-white">pensée pour le mobile</span> et peut être utilisée librement par La Malice ou <span class="text-white">toute autre troupe</span>. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Comptes (facultatif)</h3><p> Les joueurs qui le souhaitent peuvent créer un compte via leur email pour <span class="text-white">recevoir des notifications</span>, <span class="text-white">protéger leurs saisies</span> et bénéficier d&#39;un meilleur confort d&#39;utilisation. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2 text-sm"><h3 class="text-white font-semibold">Statut &amp; licence</h3><p> Application <span class="text-white">en cours de développement</span>, <span class="text-white">sans garanties</span> à ce stade. Licence libre <span class="text-white">MIT</span>. </p><p>Contact &amp; retours : <a href="mailto:impropick@gmail.com" class="text-blue-300 underline">impropick@gmail.com</a></p></div></div>',1)),d("div",uj,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ce("",!0)}},dj={class:"text-center mb-6"},hj={class:"text-lg text-gray-300"},fj={class:"mb-6"},pj={class:"space-y-4"},mj={class:"flex items-center gap-2 text-gray-300 text-sm"},gj=["disabled"],vj={key:0,class:"animate-spin"},yj={key:1},_j={class:"mb-6 text-center"},bj={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},wj={class:"text-red-300 text-sm"},xj={class:"text-center mb-6"},Ij={class:"text-lg text-gray-300"},Ej={class:"mb-6"},Tj=["disabled"],Aj={key:0,class:"animate-spin"},Sj={key:1},Pj={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Rj={class:"text-red-300 text-sm"},Cj={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},kj={class:"text-green-300 text-sm"},Dj={class:"flex justify-center"},Yv={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P(!1),o=P(""),a=P(!1),l=P(""),c=P(""),h=P(null),f=P(!0);async function m(){if(s.value){i.value=!0,o.value="";try{const E=await Cm(t.seasonId);if(s.value===E){if(f.value)try{ho.saveSession(t.player.id)}catch{}r("verified",{type:"season_pin"}),w();return}if(await JA(t.player.id,s.value,t.seasonId)){if(f.value)try{ho.saveSession(t.player.id)}catch{}r("verified",{type:"player_password"}),w()}else o.value="Mot de passe incorrect. Veuillez réessayer."}catch(E){j.error("Erreur lors de la vérification",E),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function v(){i.value=!0,l.value="",c.value="";try{const E=await XA(t.player.id,t.seasonId);c.value=E.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(E){j.error("Erreur lors de l'envoi de l'email",E),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function w(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return St(()=>t.show,E=>{E&&en(()=>{h.value&&h.value.focus()})}),(E,A)=>{var F,U;return k(),D(dt,null,[n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:w},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:A[3]||(A[3]=pt(()=>{},["stop"]))},[d("div",dj,[A[7]||(A[7]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔐")],-1)),A[8]||(A[8]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),d("p",hj,re((F=n.player)==null?void 0:F.name),1),A[9]||(A[9]=d("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),d("div",fj,[d("div",pj,[d("div",null,[A[10]||(A[10]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),ut(d("input",{"onUpdate:modelValue":A[0]||(A[0]=$=>s.value=$),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:rr(m,["enter"]),ref_key:"passwordInput",ref:h},null,544),[[Mt,s.value]])]),d("div",mj,[ut(d("input",{id:"staySignedIn",type:"checkbox","onUpdate:modelValue":A[1]||(A[1]=$=>f.value=$),class:"w-4 h-4"},null,512),[[Gi,f.value]]),A[11]||(A[11]=d("label",{for:"staySignedIn"},"Rester connecté sur cet appareil",-1))])]),d("button",{onClick:m,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(k(),D("span",vj,"⏳")):(k(),D("span",yj,"🔓")),d("span",null,re(i.value?"Vérification...":"Vérifier"),1)],8,gj)]),d("div",_j,[d("button",{onClick:A[2]||(A[2]=$=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(k(),D("div",bj,[d("div",wj,re(o.value),1)])):ce("",!0),d("div",{class:"flex justify-center"},[d("button",{onClick:w,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ce("",!0),a.value?(k(),D("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:A[6]||(A[6]=$=>a.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:A[5]||(A[5]=pt(()=>{},["stop"]))},[d("div",xj,[A[12]||(A[12]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"📧")],-1)),A[13]||(A[13]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),d("p",Ij,re((U=n.player)==null?void 0:U.name),1)]),d("div",Ej,[A[14]||(A[14]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:v,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(k(),D("span",Aj,"⏳")):(k(),D("span",Sj,"📧")),d("span",null,re(i.value?"Envoi...":"Envoyer l'email"),1)],8,Tj)]),l.value?(k(),D("div",Pj,[d("div",Rj,re(l.value),1)])):ce("",!0),c.value?(k(),D("div",Cj,[d("div",kj,re(c.value),1)])):ce("",!0),d("div",Dj,[d("button",{onClick:A[4]||(A[4]=$=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0)],64)}}},Nj={class:"text-center mb-6"},Oj={class:"text-sm text-gray-300"},Vj={key:0,class:"space-y-4"},Mj={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},Lj={key:1,class:"space-y-4"},$j=["disabled"],Fj={key:0,class:"animate-spin"},Uj={key:1},jj={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},Bj={class:"mt-6 flex justify-center gap-3"},qj=["disabled"],zj={key:0,class:"animate-spin"},Hj={key:1},i1={__name:"AccountClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=P(1),i=P(""),o=P(""),a=P(""),l=P(!1),c=P(""),h=P(!1),f=Ea(),m=$e(()=>i.value&&i.value.includes("@")),v=$e(()=>o.value&&a.value&&o.value===a.value&&o.value.length>=6);async function w(){var U,$,L;if(!(!m.value||!((U=t.player)!=null&&U.id))){l.value=!0,c.value="";try{const se=await HA({playerId:t.player.id,email:i.value.trim(),seasonId:t.seasonId}),te=($=f.params)==null?void 0:$.slug,T=`${se.url}${te?`&slug=${encodeURIComponent(te)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await pF({toEmail:i.value,playerName:((L=t.player)==null?void 0:L.name)||"joueur",verifyUrl:T}),h.value=!0}catch{c.value="Impossible d'envoyer l'email de vérification"}finally{l.value=!1}}}async function E(){try{await GA({playerId:t.player.id,seasonId:t.seasonId})}catch{}s.value=1,h.value=!1,i.value="",o.value="",a.value=""}async function A(){var U;try{const $=await Yl((U=t.player)==null?void 0:U.id,t.seasonId);$!=null&&$.email&&($!=null&&$.emailVerifiedAt)?s.value=2:s.value=1}catch{s.value=1}}En(()=>{A()}),St(()=>t.show,U=>{U&&A()});async function F(){if(v.value){l.value=!0,c.value="";try{await zA(t.player.id,i.value.trim(),o.value,t.seasonId),r("success")}catch(U){c.value=(U==null?void 0:U.message)||"Erreur lors de l'association"}finally{l.value=!1}}}return(U,$)=>{var L;return n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:$[6]||($[6]=se=>U.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:$[5]||($[5]=pt(()=>{},["stop"]))},[d("button",{onClick:$[0]||($[0]=se=>U.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),d("div",Nj,[$[7]||($[7]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"👤")],-1)),$[8]||($[8]=d("h2",{class:"text-2xl font-bold text-white mb-1"},"Associer un compte",-1)),d("p",Oj,"Pour sécuriser les saisies de "+re((L=n.player)==null?void 0:L.name),1),Ye(OA)]),s.value===1?(k(),D("div",Vj,[d("div",null,[$[9]||($[9]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),ut(d("input",{"onUpdate:modelValue":$[1]||($[1]=se=>i.value=se),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Mt,i.value]])]),h.value?(k(),D("div",Mj,[$[10]||($[10]=d("span",null,"✅",-1)),d("span",null,"Un email a été envoyé à "+re(i.value)+". Cliquez sur le lien contenu dans l'email pour continuer.",1)])):ce("",!0)])):s.value===2?(k(),D("div",Lj,[d("div",{class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},[$[11]||($[11]=d("span",null,"✅",-1)),$[12]||($[12]=d("span",null,"Adresse email vérifiée",-1)),d("button",{type:"button",onClick:E,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")]),d("div",null,[$[13]||($[13]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),ut(d("input",{"onUpdate:modelValue":$[2]||($[2]=se=>o.value=se),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[Mt,o.value]])]),d("div",null,[$[14]||($[14]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),ut(d("input",{"onUpdate:modelValue":$[3]||($[3]=se=>a.value=se),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[Mt,a.value]])]),d("button",{onClick:F,disabled:!v.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(k(),D("span",Fj,"⏳")):(k(),D("span",Uj,"🔒")),d("span",null,re(l.value?"Association...":"Associer ce joueur"),1)],8,$j)])):ce("",!0),c.value?(k(),D("div",jj,re(c.value),1)):ce("",!0),d("div",Bj,[s.value===1?(k(),D("button",{key:0,onClick:w,disabled:!m.value||l.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(k(),D("span",zj,"⏳")):(k(),D("span",Hj,"✉️")),d("span",null,re(l.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,qj)):ce("",!0),d("button",{onClick:$[4]||($[4]=se=>U.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])):ce("",!0)}}},Kj={class:"text-center mb-6"},Gj={class:"text-2xl font-bold text-white mb-2"},Wj={class:"text-lg text-gray-300"},Qj={class:"mb-6"},Jj={class:"flex items-center space-x-3"},Yj={class:"text-2xl"},Xj={class:"font-semibold text-white"},Zj={class:"text-sm text-gray-300"},eB={key:0,class:"mb-6"},tB={key:1,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},nB={class:"text-red-300 text-sm"},rB={key:2,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},sB={class:"text-green-300 text-sm"},iB={class:"flex justify-center gap-3"},oB=["disabled"],aB={__name:"PlayerClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=P(!1),i=P(!1),o=P(!1),a=P(""),l=P(""),c=P(!1);Ea();const h=P(!1);$e(()=>!1),$e(()=>!1);function f(){l.value="Compte créé et joueur associé !",s.value=!0,c.value=!1,r("update")}async function m(){var F;if((F=t.player)!=null&&F.id){s.value=await Zi(t.player.id,t.seasonId);try{const{isPlayerPasswordCached:U}=await an(()=>Promise.resolve().then(()=>td),void 0);i.value=U(t.player.id)}catch{i.value=!1}}}function v(){var F;a.value="";try{if((F=t.player)!=null&&F.id&&ta(t.player.id)){w();return}}catch{}h.value=!0}async function w(){o.value=!0,a.value="",l.value="";try{const F=await WA(t.player.id,t.seasonId);l.value="Joueur déverrouillé!",s.value=!1,F.email&&(email.value=F.email),r("update")}catch(F){logger.error("Erreur lors de la désactivation de la protection",F),a.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{o.value=!1}}function E(){h.value=!1,w()}function A(){r("close")}return St(()=>t.player,()=>{t.show&&t.player&&m()},{immediate:!0}),St(()=>t.show,F=>{F&&t.player&&(a.value="",l.value="",h.value=!1,m(),t.onboarding&&en(()=>{}))}),(F,U)=>{var $;return k(),D(dt,null,[n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:A},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:U[1]||(U[1]=pt(()=>{},["stop"]))},[d("button",{onClick:A,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),d("div",Kj,[U[4]||(U[4]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔒")],-1)),d("h2",Gj,re(s.value?"Déverrouiller ce joueur":"Verrouiller ce joueur"),1),d("p",Wj,re(($=n.player)==null?void 0:$.name),1)]),d("div",Qj,[d("div",{class:Qt(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[d("div",Jj,[d("span",Yj,re(s.value?"🔒":"🔓"),1),d("div",null,[d("div",Xj,re(s.value?i.value?"Joueur associé à votre compte":"Ce joueur est associé à un compte utilisateur":"Joueur sans compte"),1),d("div",Zj,re(s.value?i.value?"Seul vous pouvez modifier":"Seul le titulaire peut modifier les disponibilités":"Tout le monde peut modifier les disponibilités"),1)])])],2)]),s.value?ce("",!0):(k(),D("div",eB,U[5]||(U[5]=[d("div",{class:"text-sm text-gray-300"},"Vous pouvez protéger vos saisies de disponibilités avec un compte utilisateur.",-1)]))),a.value?(k(),D("div",tB,[d("div",nB,re(a.value),1)])):ce("",!0),l.value?(k(),D("div",rB,[d("div",sB,re(l.value),1)])):ce("",!0),d("div",iB,[s.value?(k(),D("button",{key:1,onClick:v,disabled:o.value,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," 🔓 Dissocier ",8,oB)):(k(),D("button",{key:0,onClick:U[0]||(U[0]=L=>c.value=!0),class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300"}," Associer un compte ")),d("button",{onClick:A,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0),Ye(i1,{show:c.value,player:n.player,"season-id":n.seasonId,onClose:U[2]||(U[2]=L=>c.value=!1),onSuccess:f},null,8,["show","player","season-id"]),Ye(Yv,{show:h.value,player:n.player,seasonId:n.seasonId,onClose:U[3]||(U[3]=L=>h.value=!1),onVerified:E},null,8,["show","player","seasonId"])],64)}}};const lB=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},uB={class:"relative p-4 md:p-6 border-b border-white/10"},cB={class:"flex items-start gap-4 md:gap-6"},dB={class:"flex-1 min-w-0"},hB={class:"flex items-center gap-3 mb-2"},fB={class:"text-xl md:text-2xl font-bold text-white leading-tight"},pB={class:"flex items-center gap-2"},mB={key:0,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-full"},gB={key:1,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-full"},vB={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},yB={class:"grid grid-cols-3 gap-3 md:gap-4"},_B={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},bB={class:"text-xl md:text-2xl font-bold text-white"},wB={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},xB={class:"text-xl md:text-2xl font-bold text-white"},IB={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30 text-center"},EB={class:"text-xl md:text-2xl font-bold text-white"},TB={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},AB={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},SB={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},PB={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},RB={class:"mb-6"},CB={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null},isProtected:{type:Boolean,default:!1},isPreferred:{type:Boolean,default:!1}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=P(!1),o=P(""),a=P(null),l=P(!1),c=P(!1),h=P(null);P(!1);const f=P(!1),m=P(!1),v=P(null),w=P(null),E=P({position:"fixed",top:"0px",left:"0px"}),A=P(null),F=P({position:"fixed",top:"0px",left:"0px"}),U=P(!1),$=P(!1);function L(){s("close"),f.value=!1,m.value=!1,E.value={position:"fixed",top:"0px",left:"0px"},F.value={position:"fixed",top:"0px",left:"0px"}}function se(){var le;o.value=((le=r.player)==null?void 0:le.name)||"",i.value=!0,en(()=>{a.value&&a.value.focus()})}function te(){i.value=!1,o.value=""}async function T(){var oe,Ce;if(!o.value.trim())return;if(await Zi((oe=r.player)==null?void 0:oe.id,r.seasonId)){ta((Ce=r.player)==null?void 0:Ce.id)?_():(h.value="update",c.value=!0);return}_()}function _(){var le;s("update",{playerId:(le=r.player)==null?void 0:le.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function I(){var oe,Ce;if(await Zi((oe=r.player)==null?void 0:oe.id,r.seasonId)){ta((Ce=r.player)==null?void 0:Ce.id)?C():(h.value="delete",c.value=!0);return}C()}function C(){var le;s("delete",(le=r.player)==null?void 0:le.id)}function M(){s("refresh")}function N(le){h.value==="update"?_():h.value==="delete"&&C(),h.value=null}function R(){try{const le=v.value;if(!le)return;const oe=le.getBoundingClientRect(),Ce=8;if(window.innerWidth>768){const X=Math.max(Ce,Math.round(oe.top-Ce)),W=Math.max(Ce,Math.round(oe.left));E.value={position:"fixed",top:`${X}px`,left:`${W}px`,zIndex:400}}else{const X=Math.min(window.innerHeight-Ce,Math.round(oe.bottom+Ce)),W=Math.max(Ce,Math.round(oe.left));E.value={position:"fixed",top:`${X}px`,left:`${W}px`,zIndex:400}}}catch{}}function Qe(){try{const X=Math.max(8,window.innerHeight-8-48-120),W=Math.max(8,Math.round(window.innerWidth-200-8));F.value={position:"fixed",top:`${X}px`,left:`${W}px`,zIndex:400}}catch{}}function it(){f.value=!f.value,f.value&&en(()=>R())}function ye(){m.value=!m.value,m.value&&en(()=>Qe())}St(()=>r.show,le=>{var oe;le||(i.value=!1,o.value="",h.value=null,l.value=!1,f.value=!1,m.value=!1),le&&((oe=r.player)!=null&&oe.id)&&(Zi(r.player.id,r.seasonId).then(Ce=>{U.value=!!Ce}),an(()=>Promise.resolve().then(()=>td),void 0).then(Ce=>{try{$.value=!!Ce.isPlayerPasswordCached(r.player.id)}catch{$.value=!1}}))}),En(()=>{document.addEventListener("click",le=>{if(f.value){const oe=v.value,Ce=w.value,X=oe&&oe.contains(le.target),W=Ce&&Ce.contains(le.target);!X&&!W&&(f.value=!1)}if(m.value){const oe=A.value;oe&&oe.contains(le.target)||(m.value=!1)}}),document.addEventListener("keydown",le=>{le.key==="Escape"&&(f.value&&(f.value=!1),m.value&&(m.value=!1))}),window.addEventListener("resize",()=>{f.value&&R(),m.value&&Qe()}),window.addEventListener("scroll",()=>{f.value&&R(),m.value&&Qe()},{passive:!0})}),e({openProtection(){l.value=!0}});const ne=P({position:null});return St(()=>r.show,le=>{le&&r.onboardingStep===4?en(()=>{const oe=document.querySelectorAll("button");let Ce=null;if(oe.forEach(X=>{!Ce&&X.textContent&&X.textContent.includes("Protection")&&(Ce=X)}),Ce){const X=Ce.getBoundingClientRect();ne.value.position={x:Math.round(X.right+8),y:Math.round(X.top+window.scrollY-4)}}}):le||(ne.value.position=null)}),(le,oe)=>{var Ce;return k(),D(dt,null,[n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:L},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-xl max-h-[92vh] flex flex-col",onClick:oe[6]||(oe[6]=pt(()=>{},["stop"]))},[d("div",uB,[d("button",{onClick:L,class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",cB,[oe[15]||(oe[15]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"👤")],-1)),d("div",dB,[d("div",hB,[d("h2",fB,re((Ce=n.player)==null?void 0:Ce.name),1),d("div",pB,[n.isProtected?(k(),D("div",mB,oe[13]||(oe[13]=[d("span",{class:"text-yellow-400 text-sm"},"🔒",-1),d("span",{class:"text-yellow-300 text-xs font-medium"},"Protégé",-1)]))):ce("",!0),n.isPreferred?(k(),D("div",gB,oe[14]||(oe[14]=[d("span",{class:"text-purple-400 text-sm"},"⭐",-1),d("span",{class:"text-purple-300 text-xs font-medium"},"Favori",-1)]))):ce("",!0)])])])])]),d("div",vB,[d("div",null,[d("div",yB,[d("div",_B,[d("div",bB,re(r.stats.availability),1),oe[16]||(oe[16]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibilités",-1))]),d("div",wB,[d("div",xB,re(r.stats.selection),1),oe[17]||(oe[17]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélections",-1))]),d("div",IB,[d("div",EB,re(r.stats.ratio),1),oe[18]||(oe[18]=d("div",{class:"text-xs md:text-sm text-gray-300"},"% de sélection",-1))])])]),d("div",TB,[d("button",{onClick:oe[0]||(oe[0]=X=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},[d("span",null,re(U.value?"🔓":"🔒"),1),d("span",null,re(U.value?"Déverrouiller":"Verrouiller"),1)]),d("div",{class:"relative",ref_key:"playerMoreActionsRef",ref:v},[d("button",{onClick:oe[1]||(oe[1]=X=>it()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},oe[19]||(oe[19]=[d("span",null,"⋯",-1),d("span",null,"Plus",-1)]))],512),d("button",{onClick:L,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer "),(k(),Gs(ec,{to:"body"},[f.value?(k(),D("div",{key:0,ref_key:"playerMoreActionsDropdownRef",ref:w,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:Vr(E.value)},[d("button",{onClick:oe[2]||(oe[2]=X=>{se(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},oe[20]||(oe[20]=[d("span",null,"✏️",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:oe[3]||(oe[3]=X=>{I(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},oe[21]||(oe[21]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ce("",!0)]))])]),d("div",AB,[d("button",{onClick:oe[4]||(oe[4]=X=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},re(U.value?"🔓 Déverrouiller":"🔒 Verrouiller"),1),d("button",{onClick:oe[5]||(oe[5]=X=>ye()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ "),d("button",{onClick:L,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer ")])])])):ce("",!0),(k(),Gs(ec,{to:"body"},[m.value?(k(),D("div",{key:0,ref_key:"playerMoreActionsMobileDropdownRef",ref:A,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:Vr(F.value)},[d("button",{onClick:oe[7]||(oe[7]=X=>{se(),m.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},oe[22]||(oe[22]=[d("span",null,"✏️",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:oe[8]||(oe[8]=X=>{I(),m.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},oe[23]||(oe[23]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ce("",!0)])),i.value?(k(),D("div",SB,[d("div",PB,[oe[25]||(oe[25]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Renommer le joueur",-1)),d("div",RB,[oe[24]||(oe[24]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),ut(d("input",{"onUpdate:modelValue":oe[9]||(oe[9]=X=>o.value=X),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[rr(te,["esc"]),rr(T,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[Mt,o.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:te,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:T,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ce("",!0),Ye(aB,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:oe[10]||(oe[10]=X=>l.value=!1),onUpdate:M,onOnboardingFinished:oe[11]||(oe[11]=X=>le.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),Ye(Yv,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:oe[12]||(oe[12]=X=>c.value=!1),onVerified:N},null,8,["show","player","seasonId"])],64)}}},kB=lB(CB,[["__scopeId","data-v-8237d7ee"]]),DB={class:"relative p-6 pb-4 border-b border-white/10"},NB={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},OB={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=pt(()=>{},["stop"]))},[d("div",DB,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),d("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=jn('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),d("div",NB,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ce("",!0)}},VB={class:"relative p-4 md:p-6 border-b border-white/10"},MB={class:"flex items-start gap-4 md:gap-6"},LB={class:"flex-1 min-w-0"},$B={class:"text-xl md:text-2xl font-bold text-white leading-tight mb-2"},FB={class:"flex items-center gap-3"},UB={class:"text-base md:text-lg text-purple-300"},jB={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},BB={class:"text-blue-200"},qB={key:0,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm flex items-center gap-1",title:"Prêt pour la sélection"},zB={key:1,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded text-sm flex items-center gap-1",title:"Sélection complète"},HB={key:2,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded text-sm flex items-center gap-1",title:"Sélection incomplète"},KB={key:3,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded text-sm flex items-center gap-1",title:"Pas assez de joueurs disponibles"},GB={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},WB={class:"grid grid-cols-3 gap-3 md:gap-4 mb-4"},QB={class:"bg-gradient-to-r from-yellow-500/20 to-orange-500/20 p-3 md:p-4 rounded-lg border border-yellow-500/30 text-center"},JB={class:"text-xl md:text-2xl font-bold text-yellow-300"},YB={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},XB={class:"text-xl md:text-2xl font-bold text-white"},ZB={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},eq={class:"text-xl md:text-2xl font-bold text-white"},tq={class:"mb-3"},nq={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},rq={key:0,class:"flex items-center justify-between gap-2"},sq=["title"],iq={key:0,class:"text-purple-400 mr-2"},oq={key:1,class:"text-green-400 mr-2"},aq={key:2,class:"text-red-400 mr-2"},lq={key:3,class:"text-gray-400 mr-2"},uq=["onClick"],cq={key:1,class:"flex items-center justify-center"},dq=["onChange"],hq=["value"],fq=["onClick"],pq={key:0,class:"mb-3"},mq={key:1,class:"mb-3"},gq={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},vq={class:"flex-1"},yq={class:"text-blue-300 text-sm font-medium"},_q={class:"sticky bottom-0 w-full p-3 bg-gray-900/80 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},bq=["disabled","title"],wq=["disabled"],xq={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-notifications","updateSelection"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=P(!1),o=P("Copier le message"),a=P(!1),l=P(!1),c=P(""),h=P(!1),f=P(!1),m=$e(()=>{var X;return((X=r.event)==null?void 0:X.playerCount)||6}),v=P([]),w=P(null),E=$e(()=>(r.players||[]).map(X=>X.name).filter(X=>{var W;return((W=r.playerAvailability)==null?void 0:W[X])===!0}).sort((X,W)=>X.localeCompare(W,"fr",{sensitivity:"base"})));function A(X){const W=new Set(v.value.filter(Boolean)),xe=v.value[X];return xe&&W.delete(xe),E.value.filter(Ze=>!W.has(Ze))}function F(X){w.value=X}function U(){w.value=null}async function $(X,W){var Ze;const xe=((Ze=X==null?void 0:X.target)==null?void 0:Ze.value)||"";xe&&(v.value[W]=xe,await M()),w.value=null}async function L(X){v.value[X]=null,await M()}$e(()=>(A(-1).length<m.value,""));const se=$e(()=>r.currentSelection&&r.currentSelection.length>0);function te(){var Ze;const X=r.currentSelection||[],W=((Ze=r.event)==null?void 0:Ze.playerCount)||6,xe=r.availableCount||0;if(X.length>0){const mt=X.some(Y=>!it(Y)),qt=xe<W;if(mt||qt)return{type:"incomplete",hasUnavailablePlayers:mt,hasInsufficientPlayers:qt,unavailablePlayers:X.filter(Y=>!it(Y)),availableCount:xe,requiredCount:W}}return xe<W?{type:"insufficient",availableCount:xe,requiredCount:W}:X.length===0?{type:"ready",availableCount:xe,requiredCount:W}:{type:"complete",availableCount:xe,requiredCount:W}}const T=$e(()=>{var Ze;if(!se.value)return!1;const X=r.currentSelection.some(mt=>!it(mt)),W=((Ze=r.event)==null?void 0:Ze.playerCount)||6,xe=r.availableCount<W;return X||xe});$e(()=>{var xe;if(!T.value)return"";const X=r.currentSelection.filter(Ze=>!it(Ze)),W=((xe=r.event)==null?void 0:xe.playerCount)||6;return X.length>0?X.length===1?`${X[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${X.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<W?`Seulement ${r.availableCount} joueurs disponibles pour ${W} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),$e(()=>{if(!r.event||!se.value)return"";const X=_(r.event.date),W=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${X} : ${W}`}),St(()=>r.show,X=>{if(X){i.value=!1,o.value="Copier le message",l.value=!1,c.value="",h.value=!1,a.value=!1;const W=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],xe=m.value;v.value=Array.from({length:xe},(Ze,mt)=>W[mt]||null),w.value=null}}),St([m,()=>r.currentSelection,()=>{var X;return(X=r.event)==null?void 0:X.id}],()=>{if(!r.show)return;const X=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],W=m.value,xe=Array.from({length:W},(Ze,mt)=>X[mt]||v.value[mt]||null);v.value=xe.slice(0,W)});function _(X){var xe;return X?(typeof X=="string"?new Date(X):((xe=X.toDate)==null?void 0:xe.call(X))||X).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function I(){s("selection")}function C(){s("perfect")}async function M(){var X;if(!(!((X=r.event)!=null&&X.id)||!r.seasonId))try{const W=v.value.filter(Boolean);await Lm(r.event.id,W,r.seasonId),console.debug("Sélection sauvegardée automatiquement")}catch(W){console.error("Erreur lors de la sauvegarde automatique:",W)}}function N(){s("close")}function R(){a.value=!0}function Qe(){f.value=!0}function it(X){return r.playerAvailability[X]===!0}function ye(X){return r.playerAvailability[X]===!1}function ne(X){return r.currentSelection.includes(X)&&it(X)}function le(X=!1,W=!1){if(h.value=X,X){const xe=_(r.event.date),Ze=r.currentSelection.join(", ");W?c.value=`Sélection mise à jour pour ${r.event.title} du ${xe} : ${Ze}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`:c.value=`Nouvelle sélection pour ${r.event.title} du ${xe} : ${Ze}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`}else c.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function oe(){l.value=!1}e({showSuccess:le});function Ce(X){s("send-notifications",X)}return(X,W)=>{var xe,Ze,mt,qt;return k(),D(dt,null,[n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:N},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:W[1]||(W[1]=pt(()=>{},["stop"]))},[d("div",VB,[d("button",{onClick:N,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",MB,[W[9]||(W[9]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),d("div",LB,[d("h2",$B,"Sélection pour "+re((xe=n.event)==null?void 0:xe.title),1),d("div",FB,[d("p",UB,re(_((Ze=n.event)==null?void 0:Ze.date)),1),d("div",jB,[W[4]||(W[4]=d("span",{class:"text-blue-300"},"👥",-1)),d("span",BB,re(((mt=n.event)==null?void 0:mt.playerCount)||6)+" joueurs",1)]),te().type==="ready"?(k(),D("div",qB,W[5]||(W[5]=[d("span",{class:"text-blue-300 text-xs"},"🆕",-1),d("span",{class:"text-blue-200 text-xs"},"Nouveau",-1)]))):te().type==="complete"?(k(),D("div",zB,W[6]||(W[6]=[d("span",{class:"text-green-300 text-xs"},"✅",-1),d("span",{class:"text-green-200 text-xs"},"Complet",-1)]))):te().type==="incomplete"?(k(),D("div",HB,W[7]||(W[7]=[d("span",{class:"text-orange-300 text-xs"},"⚠️",-1),d("span",{class:"text-orange-200 text-xs"},"À finaliser",-1)]))):te().type==="insufficient"?(k(),D("div",KB,W[8]||(W[8]=[d("span",{class:"text-red-300 text-xs"},"❌",-1),d("span",{class:"text-red-200 text-xs"},"Manque",-1)]))):ce("",!0)])])])]),d("div",GB,[d("div",WB,[d("div",QB,[d("div",JB,re(Math.max((((qt=n.event)==null?void 0:qt.playerCount)||6)-n.selectedCount,0)),1),W[10]||(W[10]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))]),d("div",YB,[d("div",XB,re(n.availableCount),1),W[11]||(W[11]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",ZB,[d("div",eq,re(n.selectedCount),1),W[12]||(W[12]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))])]),d("div",tq,[d("div",{class:"flex items-center gap-2 mb-2"},[W[14]||(W[14]=d("h3",{class:"text-base md:text-lg font-semibold text-white"},"Joueurs sélectionnés",-1)),d("button",{onClick:Qe,class:"text-blue-300 hover:text-blue-200 p-1 rounded-full hover:bg-blue-500/10 transition-colors",title:"Comment fonctionne la sélection automatique ?"},W[13]||(W[13]=[d("span",{class:"text-sm"},"❓",-1)]))]),d("div",nq,[(k(!0),D(dt,null,Mr(v.value,(Y,Te)=>(k(),D("div",{key:"sel-slot-"+Te,class:Qt(["relative p-3 rounded-lg border text-center transition-colors",Y?["bg-gradient-to-r",ye(Y)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":it(Y)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[Y?(k(),D("div",rq,[d("div",{class:"flex-1 text-white font-medium truncate",title:Y},[ne(Y)?(k(),D("span",iq,"🎭")):it(Y)?(k(),D("span",oq,"✅")):ye(Y)?(k(),D("span",aq,"❌")):(k(),D("span",lq,"–")),bt(" "+re(Y),1)],8,sq),d("button",{onClick:be=>L(Te),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer ce joueur"}," × ",8,uq)])):(k(),D("div",cq,[w.value===Te?(k(),D("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:be=>$(be,Te),onBlur:W[0]||(W[0]=be=>U())},[W[15]||(W[15]=d("option",{value:""},"— Choisir —",-1)),(k(!0),D(dt,null,Mr(A(Te),be=>(k(),D("option",{key:be,value:be},re(be),9,hq))),128))],40,dq)):(k(),D("button",{key:1,onClick:be=>F(Te),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter un joueur"},W[16]||(W[16]=[d("span",{class:"text-lg"},"＋",-1),d("span",{class:"text-sm"},"Ajouter",-1)]),8,fq))]))],2))),128))])]),se.value?(k(),D("div",pq,W[17]||(W[17]=[d("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[d("div",{class:"text-yellow-400"},"⚠️"),d("div",{class:"text-yellow-200 text-sm"},"Pensez à prévenir les gens de vos changements !")],-1)]))):ce("",!0),l.value?(k(),D("div",mq,[d("div",gq,[W[19]||(W[19]=d("div",{class:"text-blue-400 text-xl"},"✨",-1)),d("div",vq,[d("p",yq,re(c.value),1)]),d("button",{onClick:oe,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},W[18]||(W[18]=[d("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):ce("",!0)]),d("div",_q,[d("button",{onClick:I,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":se.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},W[20]||(W[20]=[bt(" ✨ "),d("span",{class:"hidden sm:inline"},"Sélection Auto",-1),d("span",{class:"sm:hidden"},"Auto",-1)]),8,bq),d("button",{onClick:R,disabled:!se.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},W[21]||(W[21]=[bt(" 📣 "),d("span",{class:"hidden sm:inline"},"Annoncer",-1),d("span",{class:"sm:hidden"},"Annoncer",-1)]),8,wq),d("button",{onClick:C,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 whitespace-nowrap"},W[22]||(W[22]=[d("span",{class:"hidden sm:inline"},"Fermer",-1),d("span",{class:"sm:hidden"},"Fermer",-1)]))])])])):ce("",!0),Ye(s1,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:W[2]||(W[2]=Y=>a.value=!1),onSendNotifications:Ce},null,8,["show","event","season-id","season-slug","players","selected-players"]),Ye(OB,{show:f.value,onClose:W[3]||(W[3]=Y=>f.value=!1)},null,8,["show"])],64)}}},Iq={class:"flex items-center justify-center"},Eq=["title"],Tq={key:0,class:"text-center"},Aq={key:1,class:"text-center"},Sq={key:2,class:"text-center"},Pq={key:3,class:"text-center text-gray-400"},Ob={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},compact:{type:Boolean,default:!1},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=P(!1),i=$e(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=$e(()=>t.disabled?"Événement archivé — désarchivez pour modifier":t.isSelected&&t.isAvailable===!0?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){t.disabled||r("toggle",t.playerName,t.eventId)}return(l,c)=>(k(),D("div",{class:Qt(["flex items-center justify-center transition-all duration-200 rounded font-medium text-white mx-0.5 my-0.25",[n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer hover:scale-105",n.compact?"min-h-0 p-1 md:p-2 text-xs":"min-h-20 p-2 md:p-3 text-sm",n.isSelected&&n.isAvailable===!0?"bg-gradient-to-br from-purple-500/60 to-pink-500/60":"",!n.isSelected&&n.isAvailable===!0?"bg-green-500/60":"",n.isAvailable===!1?"bg-red-500/60":"",n.isAvailable===null||n.isAvailable===void 0?"bg-gray-500/40":""]]),onClick:a,onMouseenter:c[0]||(c[0]=h=>s.value=!0),onMouseleave:c[1]||(c[1]=h=>s.value=!1)},[d("div",Iq,[i.value&&s.value?(k(),D("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},re(n.chancePercent)+"% ",9,Eq)):(k(),D(dt,{key:1},[n.isSelected&&n.isAvailable===!0?(k(),D("span",Tq," Joue ")):n.isAvailable===!0?(k(),D("span",Aq," Disponible ")):n.isAvailable===!1?(k(),D("span",Sq," Pas disponible ")):(k(),D("span",Pq," – "))],64))])],34))}},Rq={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},Cq={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},kq={class:"text-2xl md:text-3xl font-bold text-white mb-3"},Dq={class:"text-gray-300 mb-6"},Nq={class:"flex flex-col items-stretch justify-center gap-3"},Oq=["value"],Vq={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=$e(()=>`${s}/season/${t.seasonSlug}`),o=P(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=$e(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=$e(()=>a.value>0),c=P(l.value);St(a,A=>{c.value=A>0});const h=$e(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=$e(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function m(){c.value=!1,r("create-event")}function v(){c.value=!1,r("add-player")}function w(){var A;try{(A=navigator.clipboard)==null||A.writeText(i.value)}catch{}r("copy-link")}async function E(){try{if(t.seasonId){const{db:A}=await an(()=>Promise.resolve().then(()=>Xi),void 0),{doc:F,updateDoc:U}=await an(()=>import("./index.esm-040c1c4b.js"),[]);await U(F(A,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(A,F)=>l.value&&c.value?(k(),D("div",Rq,[d("div",Cq,[F[1]||(F[1]=d("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-3xl"},"🎬")],-1)),d("h2",kq,re(h.value),1),d("p",Dq,re(f.value),1),d("div",Nq,[a.value===1?(k(),D("button",{key:0,onClick:m,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(k(),D("button",{key:1,onClick:v,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(k(),D(dt,{key:2},[d("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:F[0]||(F[0]=U=>U.target.select())},null,40,Oq),d("div",{class:"flex gap-3 justify-center"},[d("button",{onClick:w,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),d("button",{onClick:E,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):ce("",!0)])])])):ce("",!0)}},Mq={class:"sticky top-0 z-[60] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},Lq={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},$q={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},Fq={class:"hidden md:flex items-center gap-2"},Uq={class:"md:hidden"},jq={__name:"SeasonHeader",props:{seasonName:{type:String,default:""},isScrolled:{type:Boolean,default:!1}},emits:["go-back","open-account-menu","open-help","open-notifications","open-players","logout","open-login","open-account"],setup(n,{emit:e}){const t=n,r=e,s=P(null),i=$e(()=>{var E;return!!s.value&&!((E=s.value)!=null&&E.isAnonymous)}),o=$e(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");function a(E){s.value=E}En(()=>{s.value=Ke.currentUser;const E=Ke.onAuthStateChanged(a);window._seasonHeaderUnsubscribe=E}),Ks(()=>{window._seasonHeaderUnsubscribe&&(window._seasonHeaderUnsubscribe(),delete window._seasonHeaderUnsubscribe)});function l(){r("go-back")}function c(){r("open-account-menu")}function h(){r("open-login")}function f(){r("open-help")}function m(){r("open-notifications")}function v(){r("open-players")}function w(){r("logout")}return(E,A)=>(k(),D("div",Mq,[d("button",{onClick:l,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour aux saisons"},A[0]||(A[0]=[d("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),d("h1",Lq,re(n.seasonName?n.seasonName:"Chargement..."),1),d("div",$q,[d("div",Fq,[Ye(Mm,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:c,onOpenHelp:f,onOpenNotifications:m,onOpenPlayers:v,onLogout:w,onOpenLogin:h},null,8,["is-connected","button-class"]),i.value?ce("",!0):(k(),D("button",{key:0,onClick:f,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},A[1]||(A[1]=[d("span",{class:"text-2xl"},"❓",-1)])))]),d("div",Uq,[Ye(Mm,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:c,onOpenHelp:f,onOpenNotifications:m,onOpenPlayers:v,onLogout:w,onOpenLogin:h},null,8,["is-connected","button-class"])])])]))}};const Bq={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},qq={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},zq={class:"flex items-stretch relative"},Hq={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},Kq={class:"flex-1 overflow-hidden"},Gq=["data-event-id"],Wq=["title","onClick"],Qq={class:"flex flex-col items-center flex-1 justify-center"},Jq={class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2 group-hover:text-purple-300 transition-colors duration-200"},Yq={key:0,class:"mt-1 text-xs text-gray-400"},Xq={class:"relative"},Zq=["onClick","title"],e9={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},t9={class:"p-2"},n9=["onClick"],r9=["onClick"],s9=["onClick"],i9={class:"flex flex-col items-center mt-2"},o9={key:0,class:"px-2 py-1 bg-gray-500/20 border border-gray-400/30 rounded-md mx-auto flex items-center justify-center",title:"Événement archivé"},a9=["title","onClick"],l9=["title","onClick"],u9=["title","onClick"],c9=["title","onClick"],d9=["title","aria-label"],h9={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},f9={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},p9={key:0,class:"pointer-events-none"},m9={class:"flex items-center justify-between"},g9={key:1,class:"pointer-events-none"},v9={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},y9={class:"flex items-center justify-between"},_9={key:2,class:"pointer-events-none"},b9={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},w9={class:"flex items-center justify-between"},x9={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},I9=["data-player-id"],E9={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},T9={class:"px-4 md:px-5 font-bold text-xl md:text-2xl flex items-center w-full min-w-0"},A9={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Mon joueur"},S9={key:1,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},P9=["onClick","title"],R9={class:"group-hover:text-purple-300 transition-colors duration-200"},C9=["data-event-id"],k9={class:"border-t border-white/10"},D9={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},N9={class:"px-4 md:px-5 flex items-center"},O9=["data-event-id"],V9={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},M9={class:"text-center"},L9={class:"text-white text-lg"},$9={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},F9={class:"text-white/60 text-xs mt-2"},U9={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},j9={class:"flex items-center space-x-2"},B9={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},q9={class:"flex items-center space-x-2"},z9={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},H9={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},K9={class:"mb-6"},G9={class:"mb-6"},W9={class:"mb-6"},Q9={class:"mb-6 flex items-center gap-3"},J9={class:"mb-6"},Y9={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},X9={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},Z9={class:"mb-6"},ez={class:"flex justify-end space-x-3"},tz={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},nz={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},rz={class:"flex justify-end space-x-3"},sz={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},iz={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},oz={class:"flex justify-end space-x-3"},az={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},lz={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},uz={class:"text-center mb-6"},cz={class:"text-gray-300"},dz={key:0},hz={key:1},fz={class:"relative p-4 md:p-6 border-b border-white/10"},pz={class:"flex items-start gap-4 md:gap-6"},mz={class:"flex-1 min-w-0"},gz={class:"flex items-center gap-3 mb-2"},vz={class:"text-xl md:text-2xl font-bold text-white leading-tight"},yz={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},_z={class:"text-blue-200"},bz={class:"flex items-center gap-3 mb-3"},wz={class:"text-base md:text-lg text-purple-300"},xz={class:"relative"},Iz={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},Ez={class:"p-2"},Tz={key:0,class:"text-sm text-gray-300 bg-gray-800/30 p-3 rounded-lg border border-gray-600/30"},Az={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},Sz={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},Pz={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},Rz={class:"text-xl md:text-2xl font-bold text-white"},Cz={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},kz={class:"text-xl md:text-2xl font-bold text-white"},Dz={class:"p-3 md:p-4 rounded-lg border border-yellow-500/30 bg-yellow-500/10 text-center"},Nz={class:"text-xl md:text-2xl font-bold text-yellow-300"},Oz={key:0,class:"mb-4 md:mb-6"},Vz={class:"mb-3 flex items-center"},Mz=["title"],Lz={class:"truncate"},$z={class:"space-y-0.5"},Fz={class:"flex items-center min-w-0 gap-1.5"},Uz={key:0,class:"text-yellow-400 mr-1 text-xs",title:"Mon joueur"},jz={key:1,class:"text-yellow-400 mr-1 text-xs",title:"Joueur protégé par mot de passe"},Bz=["title"],qz={class:"flex-0 p-0"},zz={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},Hz=["disabled","title"],Kz=["title"],Gz={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},Wz=["disabled","title"],Qz={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},Jz={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},Yz={class:"mb-6"},Xz={class:"mb-6"},Zz={class:"mb-6"},e8={class:"mb-6 flex items-center gap-3"},t8={class:"mb-6"},n8={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},r8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},s8={class:"mb-6"},i8={class:"space-y-4"},o8=["disabled"],a8={key:0,class:"animate-spin"},l8={key:1},u8={class:"mb-6 text-center"},c8={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},d8={class:"text-red-300 text-sm"},h8={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},f8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},p8={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},m8={class:"space-y-4"},g8={class:"mt-2 text-center"},v8={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},y8={class:"text-red-300 text-sm"},_8={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},b8=["disabled"],w8={key:0,class:"animate-spin"},x8={key:1},I8={class:"mb-6"},E8=["disabled"],T8={key:0,class:"animate-spin"},A8={key:1},S8={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},P8={class:"text-red-300 text-sm"},R8={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},C8={class:"text-green-300 text-sm"},k8={class:"flex justify-center"},D8={class:"mb-6"},N8=["disabled"],O8={key:0,class:"animate-spin"},V8={key:1},M8={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},L8={class:"text-red-300 text-sm"},$8={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},F8={class:"text-green-300 text-sm"},U8={class:"flex justify-center"},j8={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},B8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},q8={class:"flex gap-3"},Vb={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=Jl(),r=Ea(),s=e.slug,i=P(""),o=P(""),a=P({}),l=P(!1),c=P(!1),h=P(null),f=P(null),m=P(""),v=P(""),w=P(6),E=P(!1),A=P(""),F=P(null),U=P(null),$=P(null),L=P({position:null,side:null}),se=P({position:null}),te=P({position:null}),T=P(!1),_=P(null),I=P(!1),C=P(null),M=P(null),N=P(!1),R=P(null),Qe=P(""),it=P(!1),ye=P(null),ne=P(""),le=P(""),oe=P(!1),Ce=P(null),X=P(!1),W=P(null),xe=P(""),Ze=P(""),mt=P(!1),qt=P(null),Y=P(!1),Te=P(!1),be=P(""),De=P(""),ot=P(!1),vt=P(!1),S=P(""),O=P(""),H=P(!1),K=P(null),ee=P(""),de=P(!1),_e=P(!1),ve=P(!1),we=P(null),ge=P(null),Fe=P({position:"fixed",top:"0px",left:"0px"}),Re=P(null),Oe=P({position:"fixed",top:"0px",left:"0px"}),qe=P(null),ze=P(!1);function Xe(){try{const b=we.value;if(!b)return;const g=b.getBoundingClientRect(),V=8;if(window.innerWidth>768){const Z=Math.max(V,Math.round(g.top-V)),ae=Math.max(V,Math.round(g.left));Fe.value={position:"fixed",top:`${Z}px`,left:`${ae}px`,zIndex:400}}else{const Z=Math.min(window.innerHeight-V,Math.round(g.bottom+V)),ae=Math.max(V,Math.round(g.left));Fe.value={position:"fixed",top:`${Z}px`,left:`${ae}px`,zIndex:400}}}catch{}}function ct(){try{const Z=Math.max(8,window.innerHeight-8-48-200),ae=Math.max(8,Math.round(window.innerWidth-200-8));Oe.value={position:"fixed",top:`${Z}px`,left:`${ae}px`,zIndex:400}}catch{}}function yn(){ve.value=!ve.value,ve.value&&en(()=>Xe())}function sn(){_e.value=!_e.value,_e.value&&en(()=>ct())}function Hn(b){qe.value===b?qe.value=null:qe.value=b}function zt(){qe.value=null}function Ur(){ze.value=!ze.value}function jr(){ze.value=!1}const Wt=P(!1),cn=P(null),Br=P(null),ie=P(null),B=P(0);function Ee(){var b;try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||Je.value.length===0)return;const g=localStorage.getItem(`playerTourCompleted:${o.value}`);try{const Z=((b=Ke==null?void 0:Ke.currentUser)==null?void 0:b.email)||"";Z&&Uf(Z).then(async ae=>{const me=ae.filter(he=>he.seasonId===o.value);if(me.length>0){const he=`seasonPreferredPlayer:${o.value}`,Ve=localStorage.getItem(he);let tt=[];if(Ve)if(Ve.startsWith("["))try{tt=JSON.parse(Ve)||[]}catch{}else tt=[Ve];const ft=new Set(tt);me.forEach(on=>ft.add(on.playerId));const kt=Array.from(ft);localStorage.setItem(he,JSON.stringify(kt))}}).catch(()=>{})}catch{}const V=localStorage.getItem(`startPlayerTour:${o.value}`);!g&&V&&(B.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`),en(()=>{const Z=document.querySelector('button[data-onboarding="add-player"]');if(Z){Z.scrollIntoView({behavior:"smooth",block:"end"});const ae=Z.getBoundingClientRect(),me=document.getElementById("coachmark-add"),he=280,Ve=100,tt=(me==null?void 0:me.offsetWidth)||he,ft=(me==null?void 0:me.offsetHeight)||Ve,kt=Math.round(ae.right+12);if(kt+tt<=window.innerWidth-12){const bn=ae.top+ae.height/2-ft/2,wn=-14,Dt=12,Or=window.innerHeight-ft-12,es=Math.max(Dt,Math.min(Math.round(bn+wn),Or));L.value={position:{x:kt,y:es},side:"right"}}else{const bn=Math.round(ae.left+ae.width/2-tt/2),wn=Math.round(ae.top-ft-8),Dt=8,Or=window.innerWidth-tt-8;L.value={position:{x:Math.max(Dt,Math.min(bn,Or)),y:wn},side:null}}}}))}catch{}}const Ue=P(!1),He=P(null),lt=P(null),yt=P(!1),At=P(null),Cn=P(!1),kn=P(null),Zn=P(!1),rt=P(!1),Pt=P(!1),er=P(!1),tr=P(!1),Vn=P(!1),Aa=P(null);function Sa(){rt.value=!0}function cs(){rt.value=!1}function jf(){tr.value=!0}function Bf(){tr.value=!1}function Pa(){Vn.value=!0}function nd(){Vn.value=!1}function Ra(){try{const b=Ke==null?void 0:Ke.currentUser;if(!b||b.isAnonymous){let g=null;if(gs.value&&gs.value.size>0){const V=gs.value.values().next().value;g=ht.value.find(Z=>Z.id===V)||null}g||(g=ht.value[0]||null),er.value=!0,g&&(Aa.value=g);return}}catch{}rt.value=!0}async function Ca(){var b;try{const g=(b=Ke==null?void 0:Ke.currentUser)==null?void 0:b.email;if(!g)return;const{resetPlayerPassword:V}=await an(()=>Promise.resolve().then(()=>Xi),void 0);await V(g),je.value=!0,It.value="Email de réinitialisation envoyé.",setTimeout(()=>{je.value=!1},3e3)}catch{kr.value=!0,bi.value="Impossible d'envoyer l'email de réinitialisation.",setTimeout(()=>{kr.value=!1},3e3)}}async function Yr(){try{await vL(Ke),cs(),je.value=!0,It.value="Déconnecté de cet appareil.",setTimeout(()=>{je.value=!1},2500)}catch{kr.value=!0,bi.value="Déconnexion impossible.",setTimeout(()=>{kr.value=!1},3e3)}}async function rd(){alert("Suppression de compte: contactez l'organisateur pour dissocier vos joueurs. Fonction complète à venir.")}async function Xl(b){var g;cs();try{if(b.seasonId&&b.seasonId!==o.value){const V=Se(ue,"seasons",b.seasonId),ae=(await Vt(st(ue,"seasons"))).docs.find(he=>he.id===b.seasonId),me=(g=ae==null?void 0:ae.data())==null?void 0:g.slug;if(me){t.push(`/season/${me}?player=${encodeURIComponent(b.playerId)}&open=protection`);return}}else{const V=ht.value.find(Z=>Z.id===b.playerId);if(V){Kf(V);return}t.push(`?player=${encodeURIComponent(b.playerId)}&open=protection`)}}catch{}}En(()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}const b=()=>{l.value=window.scrollY>10};return window.addEventListener("scroll",b,{passive:!0}),document.addEventListener("click",g=>{if(ve.value){const V=we.value,Z=ge.value,ae=V&&V.contains(g.target),me=Z&&Z.contains(g.target);!ae&&!me&&(ve.value=!1)}if(_e.value){const V=Re.value;V&&V.contains(g.target)||(_e.value=!1)}}),document.addEventListener("keydown",g=>{g.key==="Escape"&&(ve.value&&(ve.value=!1),_e.value&&(_e.value=!1))}),window.addEventListener("resize",()=>{ve.value&&Xe(),_e.value&&ct()}),window.addEventListener("scroll",()=>{ve.value&&Xe(),_e.value&&ct()},{passive:!0}),()=>{window.removeEventListener("scroll",b)}});function Zl(){en(()=>{nu()})}const qr=P(new Set),ds=P(!0),Xr=P(0),mi=P("Préparation de la grille"),Rr=P(e.eventId||null),eu=P(!1),gi=P(null);St(()=>e.eventId,b=>{if(b)if(Rr.value=b,Je.value.length>0)oy(b);else{const g=St(Je,V=>{V.length>0&&(oy(b),g())},{immediate:!0})}});const Zr=$e(()=>ht.value.map(b=>({...b,isProtected:qr.value.has(b.id),email:null}))),Rs=$e(()=>Rr.value?_n.value.findIndex(b=>b.id===Rr.value):-1);$e(()=>{if(!Rr.value||Rs.value===-1)return!1;if(window.innerWidth<=768){const b=document.querySelector(`[data-event-id="${Rr.value}"]`);if(b){const g=b.getBoundingClientRect();return g.left>=0&&g.right<=window.innerWidth}}return!0});const vr=P(null),sd=P(!1),tu=P(!1),ka=P(0),id=P(null),Kn=P(null),vi=P(null);function Cr(){const b=vr.value;if(!b)return;const{scrollLeft:g,scrollWidth:V,clientWidth:Z}=b;sd.value=g>2,tu.value=g<V-Z-2}function nu(){var b;try{Cr(),ka.value=((b=vr.value)==null?void 0:b.scrollLeft)||0}catch{}}function od(b){const g=vr.value;if(!g)return;let V=0;const Z=g.querySelector("tbody tr td[data-event-id]");if(Z)V=Z.getBoundingClientRect().width;else if(Kn!=null&&Kn.value){const me=Kn.value.querySelector(".col-event");me&&(V=me.getBoundingClientRect().width)}(!V||!isFinite(V))&&(V=g.clientWidth*.6);const ae=g.scrollLeft+b*V;g.scrollTo({left:ae,behavior:"smooth"})}const _o=P(null);P(0);const yi=P(!1),bo=P(!1),_i=P(0);function hs(b,g){g&&typeof g.preventDefault=="function"&&g.preventDefault(),_r(),od(b)}function yr(b,g){if(g&&typeof g.preventDefault=="function"&&g.preventDefault(),yi.value)return;yi.value=!0,_i.value=b,bo.value=!1;const V=vr.value;if(!V)return;let Z=0;const ae=V.querySelector("tbody tr td[data-event-id]");if(ae)Z=ae.getBoundingClientRect().width;else if(Kn!=null&&Kn.value){const tt=Kn.value.querySelector(".col-event");tt&&(Z=tt.getBoundingClientRect().width)}(!Z||!isFinite(Z))&&(Z=V.clientWidth*.6);const me=Z/6,he=120,Ve=()=>{if(!yi.value||_i.value===0)return;bo.value||(bo.value=!0);const tt=V.scrollLeft+_i.value*me;V.scrollTo({left:tt,behavior:"auto"}),_o.value=window.setTimeout(Ve,he)};_o.value=window.setTimeout(Ve,250)}function _r(b){b&&typeof b.preventDefault=="function"&&b.preventDefault();const g=yi.value,V=bo.value;if(yi.value=!1,_o.value&&(clearTimeout(_o.value),_o.value=null),b&&typeof b.type=="string"&&b.type.startsWith("touch")&&!V){const Z=_i.value||0;Z!==0&&od(Z),_i.value=0;return}_i.value=0,g&&V&&Da()}function Da(){const b=vr.value;if(!b)return;let g=0;const V=b.querySelector("tbody tr td[data-event-id]");if(V)g=V.getBoundingClientRect().width;else if(Kn!=null&&Kn.value){const he=Kn.value.querySelector(".col-event");he&&(g=he.getBoundingClientRect().width)}if(!g||!isFinite(g)||g<=0)return;const Z=b.scrollLeft,me=Math.round(Z/g)*g;b.scrollTo({left:me,behavior:"smooth"})}function ad(b){F.value=b;const g=document.querySelector(`[data-player-id="${b}"]`);g&&g.scrollIntoView({behavior:"smooth",block:"center"}),je.value=!0,It.value="Nouveau joueur ajouté !",setTimeout(()=>{je.value=!1},3e3)}function Ft(){if(B.value!==1)return;const b=document.querySelector('button[data-onboarding="add-player"]');if(!b)return;const g=b.getBoundingClientRect(),V=document.getElementById("coachmark-add"),Z=280,ae=100,me=V!=null&&V.offsetWidth&&V.offsetWidth>0?V.offsetWidth:Z,he=V!=null&&V.offsetHeight&&V.offsetHeight>0?V.offsetHeight:ae,Ve=Math.round(g.right+12);if(Ve+me<=window.innerWidth-12){const ft=g.top+g.height/2-he/2,on=wo(ft+-14,he);L.value={position:{x:Ve,y:on},side:"right"}}else{const ft=Math.round(g.left+g.width/2-me/2),kt=wo(g.top-he-8,he),on=8,bn=window.innerWidth-me-8;L.value={position:{x:Math.max(on,Math.min(ft,bn)),y:kt},side:null}}}function wo(b,g){const V=pageHeaderRef==null?void 0:pageHeaderRef.value,Z=V?Math.max(0,Math.round(V.getBoundingClientRect().height||0)):0,ae=Math.max(12,Z+8),me=window.innerHeight-g-12;return Math.max(ae,Math.min(Math.round(b),me))}function fs(){var b;B.value===1&&((b=L.value)!=null&&b.position)&&Ft()}En(()=>{window.addEventListener("scroll",fs,{passive:!0}),window.addEventListener("resize",fs)}),Ks(()=>{window.removeEventListener("scroll",fs),window.removeEventListener("resize",fs)});function ps(b){return qr.value.has(b)}async function ru(){if(o.value)try{const b=await Vm(o.value),g=new Set;b.forEach(V=>{V.isProtected&&g.add(V.playerId||V.id)}),qr.value=g}catch{const g=new Set;for(const V of ht.value)await Zi(V.id,o.value)&&g.add(V.id);qr.value=g}}const je=P(!1),It=P(""),kr=P(!1),bi=P("");function qf(){try{const b=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(b),je.value=!0,It.value="Lien copié dans le presse-papiers",setTimeout(()=>{je.value=!1},2500)}catch{kr.value=!0,bi.value="Impossible de copier le lien",setTimeout(()=>{kr.value=!1},2500)}}async function wi(b){await x({type:"deleteEvent",data:{eventId:b}})}async function ms(b=null){const g=b||h.value;if(console.debug("deleteEventConfirmed"),!g){console.error("Aucun événement à supprimer");return}try{await K6(g,o.value),Je.value=Je.value.filter(V=>V.id!==g),await Promise.all([Mh(o.value),Uo(ht.value,Je.value,o.value),jo(o.value)]).then(([V,Z,ae])=>{Je.value=V,Zt.value=Z,We.value=ae}),c.value=!1,h.value=null,je.value=!0,It.value="Événement supprimé avec succès !",setTimeout(()=>{je.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function ld(){c.value=!1,h.value=null}async function Na(){if(!f.value||!m.value.trim()||!v.value)return;const b=parseInt(w.value);if(isNaN(b)||b<1||b>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const g={title:m.value.trim(),date:v.value,description:ee.value.trim()||"",playerCount:b,archived:!!de.value};await Sb(f.value,g,o.value),!g.archived&&ht.value.length>0&&qr.value.size>0&&(kn.value={id:f.value,...g},Cn.value=!0),await Promise.all([Mh(o.value),Uo(ht.value,Je.value,o.value),jo(o.value)]).then(([V,Z,ae])=>{Je.value=V,Zt.value=Z,We.value=ae}),f.value=null,m.value="",v.value="",ee.value="",w.value=6,de.value=!1,je.value=!0,It.value="Événement mis à jour avec succès !",setTimeout(()=>{je.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function ud(){if(A.value.trim())try{const b=A.value.trim(),g=await r1(b,o.value);await Promise.all([Ju(o.value),Uo(ht.value,Je.value,o.value),jo(o.value)]).then(([V,Z,ae])=>{ht.value=V,Zt.value=Z,We.value=ae,ru();const me=ht.value.find(Ve=>Ve.id===g);ad(g),U.value=g,$.value=_n.value&&_n.value[0]&&_n.value[0].id?_n.value[0].id:null;try{o.value&&localStorage.setItem(`lastAddedPlayerId:${o.value}`,g)}catch{}try{typeof B<"u"&&(B.value=2)}catch{}const he=document.querySelector(`[data-player-id="${g}"]`);he&&he.scrollIntoView({behavior:"smooth",block:"center"}),en(()=>{const Ve=`[data-player-id="${U.value}"] td[data-event-id="${$.value}"]`,tt=document.querySelector(Ve);if(tt){const ft=tt.getBoundingClientRect();se.value.position={x:Math.round(ft.left),y:Math.round(ft.top+window.scrollY-48)}}}),je.value=!0,It.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{je.value=!1},3e3),setTimeout(()=>{je.value=!1,It.value=""},5e3)}),E.value=!1,A.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function zr(){f.value=null,m.value="",v.value="",ee.value="",w.value=6}P(null);const Oa=P(!1),xi=P(""),Ii=P(""),br=P(""),xo=P(6),Va=P(!1);async function Ma(){if(!xi.value.trim()||!Ii.value){alert("Veuillez remplir le titre et la date de l'événement");return}const b=parseInt(xo.value);if(isNaN(b)||b<1||b>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const g={title:xi.value.trim(),date:Ii.value,description:br.value.trim()||"",playerCount:b,archived:!!Va.value};await La(g)}async function La(b){try{const g=await G6(b,o.value);Je.value=[...Je.value,{id:g,...b}];const V={};for(const Z of ht.value)V[Z.name]=Zt.value[Z.name]||{},V[Z.name][g]=null,await Ab(Z.name,V[Z.name],o.value);xi.value="",Ii.value="",br.value="",xo.value=6,Va.value=!1,Oa.value=!1,await Promise.resolve(),je.value=!0,It.value="Événement créé avec succès !",!b.archived&&ht.value.length>0&&qr.value.size>0&&(kn.value={id:g,...b},Cn.value=!0),setTimeout(()=>{je.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function cd(){xi.value="",Ii.value="",br.value="",xo.value=6,Oa.value=!1}async function Ei(){await x({type:"addEvent",data:{}})}const Je=P([]),ht=P([]),Zt=P({}),We=P({}),zf=P({}),su=P({});St([()=>Je.value.length,()=>ht.value.length,ds],()=>{ds.value||en(()=>{nu()})}),St([()=>ht.value.length,()=>Je.value.length,o],()=>{Ee()}),En(async()=>{try{Jv("firebase"),await n1();const g=wc(st(ue,"seasons"),Ph("slug","==",e.slug)),V=await Vt(g);if(V.empty){t.push("/seasons");return}else{const he=V.docs[0];o.value=he.id;const Ve=he.data();i.value=Ve.name,a.value=Ve,document.title=`Saison : ${i.value}`,b$(e.slug)}if(o.value){mi.value="Chargement des événements de la saison",Xr.value=20;const he=await Vt(st(ue,"seasons",o.value,"events"));Je.value=he.docs.map(Dt=>({id:Dt.id,...Dt.data(),playerCount:Dt.data().playerCount||6})),mi.value="Chargement des joueurs",Xr.value=45;const Ve=await Vt(st(ue,"seasons",o.value,"players"));ht.value=Ve.docs.map(Dt=>({id:Dt.id,...Dt.data()})),mi.value="Chargement des disponibilités",Xr.value=70;const tt=await Vt(st(ue,"seasons",o.value,"availability")),ft={};tt.docs.forEach(Dt=>{const Or=Dt.data(),es={};Object.keys(Or).forEach(ko=>{const qa=Or[ko];es[ko]=qa==="oui"?!0:qa==="non"?!1:qa}),ft[Dt.id]=es}),Zt.value=ft,mi.value="Chargement des sélections",Xr.value=85;const kt=await Vt(st(ue,"seasons",o.value,"selections")),on={};kt.docs.forEach(Dt=>{on[Dt.id]=Dt.data().players||[]}),We.value=on;const bn=await Vm(o.value),wn=new Set;Array.isArray(bn)&&bn.forEach(Dt=>{Dt.isProtected&&wn.add(Dt.playerId||Dt.id)}),qr.value=wn}const Z=he=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>he()):setTimeout(he,0)};mi.value="Préparation de l'interface",Xr.value=95,Z(()=>{cu(),ja()}),console.debug("players (deduplicated)"),console.debug("availability loaded"),await en(),Xr.value=100,ds.value=!1,en(()=>{Cr(),requestAnimationFrame(()=>Cr()),setTimeout(()=>Cr(),250);const he=vr.value;he&&(he.addEventListener("scroll",Ve=>{Cr(),ka.value=he.scrollLeft||0},{passive:!0}),window.addEventListener("resize",Cr),typeof ResizeObserver<"u"&&(vi.value=new ResizeObserver(()=>{Cr()}),vi.value.observe(he)))});const ae=r.query.event;if(ae&&Je.value.length>0){const he=Je.value.find(Ve=>Ve.id===ae);he?(console.debug("Événement trouvé depuis l'URL"),await Qf(ae,he)):(console.warn("Événement non trouvé avec l'ID"),kr.value=!0,bi.value="Événement non trouvé",setTimeout(()=>{kr.value=!1},3e3))}const me=r.query.player;if(me&&ht.value.length>0){const he=ht.value.find(Ve=>Ve.id===me);he&&(Kf(he),await en(),r.query.verified==="1"&&(je.value=!0,It.value="Joueur associé à votre compte.",setTimeout(()=>{je.value=!1},2500)))}}catch(b){console.error("Erreur lors du chargement de la grille:",b),kr.value=!0,bi.value="Erreur lors du chargement des données",setTimeout(()=>{kr.value=!1},5e3),ds.value=!1}}),St(()=>r.params.eventId,b=>{if(b){const g=()=>{const V=Je.value.find(Z=>Z.id===b);return V?(Xv(V),!0):!1};if(Je.value.length>0)g();else{const V=St(Je,Z=>{Z.length>0&&g()&&V()},{immediate:!0})}}},{immediate:!0});function iu(b){if(!b)return null;if(b instanceof Date)return b;if(typeof(b==null?void 0:b.toDate)=="function")return b.toDate();if(typeof b=="string"||typeof b=="number"){const g=new Date(b);return isNaN(g.getTime())?null:g}return null}const Cs=$e(()=>{let b=null;try{o.value&&(b=localStorage.getItem(`seasonPreferredPlayer:${o.value}`))}catch{}const g=[...ht.value].sort((he,Ve)=>(he.name||"").localeCompare(Ve.name||"","fr",{sensitivity:"base"}));if(!b)return g;let V=[];try{b.startsWith("[")?V=JSON.parse(b):b&&(V=[b])}catch{V=[]}const Z=new Set(V);if(Z.size===0)return g;const ae=g.filter(he=>Z.has(he.id)),me=g.filter(he=>!Z.has(he.id));return[...ae,...me]}),gs=$e(()=>{try{if(o.value){const b=localStorage.getItem(`seasonPreferredPlayer:${o.value}`);if(!b)return new Set;if(b.startsWith("[")){const g=JSON.parse(b);return new Set(Array.isArray(g)?g:[])}return new Set([b])}}catch{}return new Set}),$a=$e(()=>[...Je.value].sort((b,g)=>{const V=iu(b.date),Z=iu(g.date),ae=V?V.getTime():Number.POSITIVE_INFINITY,me=Z?Z.getTime():Number.POSITIVE_INFINITY;return ae!==me?ae-me:(b.title||"").localeCompare(g.title||"","fr",{sensitivity:"base"})})),ks=P(!1),_n=$e(()=>{const b=$a.value;return ks.value?b:b.filter(g=>!g.archived)});function dd(){ks.value=!ks.value}const ou=P("selected"),Io=$e(()=>{var V;if(!K.value)return Cs.value;const b=K.value.id,g=new Set(((V=We.value)==null?void 0:V[b])||[]);return Cs.value.filter(Z=>{var Ve;const ae=Z.name,me=(Ve=Zt.value[ae])==null?void 0:Ve[b],he=g.has(ae);switch(ou.value){case"selected":return he;case"available":return me===!0&&!he;case"unavailable":return me===!1;case"unknown":return me!==!0&&me!==!1;case"all":default:return!0}})}),hd=$e(()=>K.value?Ro(K.value.id):null),au=$e(()=>{if(!K.value)return!1;const b=Ro(K.value.id);return b.type==="incomplete"||b.type==="insufficient"}),Eo=$e(()=>K.value?hu(K.value.id):"");async function To(b,g){const V=ht.value.find(me=>me.name===b);if(!V){console.error("Joueur non trouvé");return}const Z=Je.value.find(me=>me.id===g);if(!Z){console.error("Événement non trouvé");return}if(Z.archived){je.value=!0,It.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{je.value=!1},3e3);return}if(ps(V.id)){const me=ta(V.id),he=ie.value===V.id;console.debug("Joueur protégé:",{playerId:V.id,hasCachedPassword:me,wasRecentlyVerified:he,recentlyVerifiedPlayer:ie.value}),me||he?(console.debug("Session active ou joueur récemment vérifié, procéder au toggle"),he&&(console.debug("Nettoyage du flag recentlyVerifiedPlayer"),ie.value=null),Ti(V,g)):(console.debug("Pas de session, affichage de la modal de vérification"),Br.value={playerName:b,eventId:g},cn.value=V,Wt.value=!0);return}Ti(V,g)}function Ti(b,g){var ae,me,he;const V=(ae=Zt.value[b.name])==null?void 0:ae[g];console.debug("toggleAvailability");let Z;V===!0?Z=!1:V===!1?Z=void 0:Z=!0,Z===void 0?Zt.value[b.name]&&delete Zt.value[b.name][g]:(Zt.value[b.name]||(Zt.value[b.name]={}),Zt.value[b.name][g]=Z);try{typeof B<"u"&&B.value===1&&b.id===(U.value||((me=Cs.value[0])==null?void 0:me.id))&&g===($.value||((he=_n.value[0])==null?void 0:he.id))&&(B.value=3,en(()=>{const tt=document.querySelector(`[data-player-id="${b.id}"]`);if(tt){const ft=tt.querySelector(".player-name");if(ft){const kt=ft.getBoundingClientRect();te.value.position={x:Math.round(kt.right+8),y:Math.round(kt.top+window.scrollY-4)}}}}),Ks(()=>{try{window.removeEventListener("resize",Cr)}catch{}try{vi.value&&vi.value.disconnect()}catch{}}))}catch{}Ab(b.name,Zt.value[b.name],o.value).then(async()=>{await en(),ja(),je.value=!0,It.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{je.value=!1},3e3)}).catch(Ve=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function wr(b,g){var V;return(V=Zt.value[b])==null?void 0:V[g]}function fd(b,g){var ae;const V=We.value[g]||[],Z=(ae=Zt.value[b])==null?void 0:ae[g];return V.includes(b)&&Z===!0}async function Ao(b,g=6){const V=Je.value.find(he=>he.id===b),Z=(V==null?void 0:V.playerCount)||6,ae=We.value[b]||[];if(ae.length>0&&ae.every(he=>wr(he,b))){console.debug("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const Ve=ht.value.filter(kt=>wr(kt.name,b)).map(kt=>{const on=Ds(kt.name);return{name:kt.name,weight:1/(1+on)}}),tt=[],ft=[...Ve];for(;tt.length<Z&&ft.length>0;){const kt=ft.reduce((wn,Dt)=>wn+Dt.weight,0);let on=Math.random()*kt;const bn=ft.findIndex(wn=>(on-=wn.weight,on<=0));bn>=0&&(tt.push(ft[bn].name),ft.splice(bn,1))}We.value[b]=tt}else{const he=ae.filter(tt=>wr(tt,b)),Ve=Z-he.length;if(Ve<=0)We.value[b]=he;else{const tt=new Set(he),kt=ht.value.filter(wn=>wr(wn.name,b)&&!tt.has(wn.name)).map(wn=>{const Dt=Ds(wn.name);return{name:wn.name,weight:1/(1+Dt)}}),on=[],bn=[...kt];for(;on.length<Ve&&bn.length>0;){const wn=bn.reduce((es,ko)=>es+ko.weight,0);let Dt=Math.random()*wn;const Or=bn.findIndex(es=>(Dt-=es.weight,Dt<=0));Or>=0&&(on.push(bn[Or].name),bn.splice(Or,1))}We.value[b]=[...he,...on]}}await Lm(b,We.value[b],o.value),cu(),ja()}async function lu(b,g=6){var he,Ve;console.debug("tirerProtected appelé"),console.debug("etat modal selection avant");const V=Ue.value,Z=(he=He.value)==null?void 0:he.id,ae=We.value[b]&&We.value[b].length>0,me=ae?[...We.value[b]]:[];if(await Ao(b,g),console.debug("etat modal selection apres"),V&&!Ue.value&&(console.debug("Restauration de la popin de sélection..."),Ue.value=!0,He.value=Je.value.find(tt=>tt.id===Z)),Ue.value&&((Ve=He.value)==null?void 0:Ve.id)===b)if(console.debug("Popin de sélection ouverte, mise à jour..."),await en(),lt.value&&lt.value.showSuccess){console.debug("Appel de showSuccess sur la popin de sélection");const tt=We.value[b]||[],ft=me.filter(on=>tt.includes(on)),kt=ft.length>0&&ft.length<me.length;lt.value.showSuccess(ae,kt)}else console.debug("showSuccess indisponible");else console.debug("Popin de sélection fermée, affichage message global"),je.value=!0,Je.value.find(tt=>tt.id===b),We.value[b],ae?It.value="Sélection mise à jour avec succès !":It.value="Sélection effectuée avec succès !",setTimeout(()=>{je.value=!1},3e3)}function Fa(b){b===0?L.value.position=null:b===1?se.value.position=null:b===2&&(te.value.position=null)}function uu(b){var V;return b?(typeof b=="string"?new Date(b):((V=b.toDate)==null?void 0:V.call(b))||b).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function Ua(b){var V;return b?(typeof b=="string"?new Date(b):((V=b.toDate)==null?void 0:V.call(b))||b).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Ds(b){return Object.values(We.value).filter(g=>g.includes(b)).length}function Ai(b){const g=Zt.value[b]||{};return Object.values(g).filter(V=>V===!0).length}function So(b){return b?Object.values(Zt.value).filter(g=>g[b]===!0).length:0}function Po(b){return b?(We.value[b]||[]).length:0}function vs(b){const g=Je.value.find(Z=>Z.id===b),V=(g==null?void 0:g.playerCount)||6;return Po(b)>=V}function pd(b){const g=Ai(b),V=Ds(b);return g===0?0:V/g}function md(b){zf.value[b]={availability:Ai(b),selection:Ds(b),ratio:pd(b)}}function cu(){ht.value.forEach(b=>md(b.name))}function ja(){const b={};Je.value.forEach(g=>{const V=g.playerCount||6,ae=ht.value.filter(he=>wr(he.name,g.id)===!0).map(he=>{const Ve=Ds(he.name);return{name:he.name,weight:1/(1+Ve)}}),me=ae.reduce((he,Ve)=>he+Ve.weight,0);ae.forEach(he=>{const Ve=Math.min(1,he.weight/me*V);b[he.name]||(b[he.name]={}),b[he.name][g.id]=Math.round(Ve*100)})}),su.value=b}const Ns=P(null),Mn=P(!1);async function gd(b=null){const g=b||Ns.value;if(!g){console.error("Aucun joueur à supprimer");return}try{await q6(g,o.value),ht.value=ht.value.filter(V=>V.id!==g),Mn.value=!1,Ns.value=null,je.value=!0,It.value="Joueur supprimé avec succès !",setTimeout(()=>{je.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function vd(){Mn.value=!1,Ns.value=null}async function Si(b){ny(),await Zi(b,o.value)?await q({type:"deletePlayer",data:{playerId:b}}):await x({type:"deletePlayer",data:{playerId:b}})}async function u(){if(_.value){const b=Je.value.find(V=>V.id===_.value),g=(b==null?void 0:b.playerCount)||6;await lu(_.value,g),T.value=!1,_.value=null}}function p(){T.value=!1,_.value=null}function y(){return R.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis",updateSelection:"Mise à jour de sélection - Code PIN requis"}[R.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function x(b){if(Gn.isPinCached(o.value)){const g=Gn.getCachedPin(o.value);if(console.debug("PIN en cache trouvé, utilisation automatique"),await Nh(o.value,g)){await Nr(b);return}else Gn.clearSession()}R.value=b,N.value=!0}async function q(b){const g=b.data.playerId;try{if(Gn.isPinCached(o.value)){console.debug("PIN de saison en cache — saut de la demande de mot de passe joueur"),await Nr(b);return}}catch{}if(ta(g)){console.debug("Mot de passe du joueur en cache trouvé, utilisation automatique"),await Nr(b);return}ye.value=b,it.value=!0}async function J(b){try{if(await Nh(o.value,b)){Gn.saveSession(o.value,b),N.value=!1;const V=R.value;R.value=null,await Nr(V)}else Qe.value="Code PIN incorrect",setTimeout(()=>{Qe.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),Qe.value="Erreur lors de la vérification du code PIN"}}function Ae(){N.value=!1,R.value=null,Qe.value=""}async function Ct(b){if(b){oe.value=!0,ne.value="";try{const g=ye.value.data.playerId,V=await Cm(o.value);if(b===V){try{Gn.saveSession(o.value,b)}catch{}try{ho.saveSession(ye.value.data.playerId)}catch{}it.value=!1;const ae=ye.value;ye.value=null,le.value="",await Nr(ae);return}if(await verifyPlayerPassword(g,b,o.value)){it.value=!1;const ae=ye.value;ye.value=null,le.value="",await Nr(ae)}else ne.value="Mot de passe incorrect",setTimeout(()=>{ne.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),ne.value="Erreur lors de la vérification du mot de passe"}finally{oe.value=!1}}}function Dn(){it.value=!1,ye.value=null,ne.value="",le.value="",oe.value=!1}async function Et(b){if(b){mt.value=!0,xe.value="";try{const g=W.value.data.player,V=await Cm(o.value);if(b===V){try{Gn.saveSession(o.value,b)}catch{}try{ho.saveSession(W.value.data.player.id)}catch{}X.value=!1;const ae=W.value;W.value=null,Ze.value="",await Nr(ae);return}if(await verifyPlayerPassword(g.id,b,o.value)){X.value=!1;const ae=W.value;W.value=null,Ze.value="",await Nr(ae)}else xe.value="Mot de passe incorrect",setTimeout(()=>{xe.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),xe.value="Erreur lors de la vérification du mot de passe"}finally{mt.value=!1}}}function Ln(){X.value=!1,W.value=null,xe.value="",Ze.value="",mt.value=!1}async function $n(){Te.value=!0,be.value="",De.value="";try{const b=W.value.data.player,g=await sendPasswordResetEmail(b.id,o.value);De.value=g.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),be.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{Te.value=!1}}async function Pi(){vt.value=!0,S.value="",O.value="";try{const b=ye.value.data.playerId,g=await sendPasswordResetEmail(b,o.value);O.value=g.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),S.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{vt.value=!1}}function Dr(){return Gn.isPinCached(o.value)?{timeRemaining:Gn.getTimeRemaining(),isExpiringSoon:Gn.isExpiringSoon()}:null}async function Nr(b){var Z;if(!b)return;const{type:g,data:V}=b;try{switch(g){case"deleteEvent":console.debug("executePendingOperation - data.eventId reçu"),h.value=V.eventId,c.value=!0;break;case"addEvent":Oa.value=!0;break;case"deletePlayer":Ns.value=V.playerId,Mn.value=!0;break;case"launchSelection":We.value[V.eventId]&&We.value[V.eventId].length>0?(_.value=V.eventId,T.value=!0,H.value=!1):(await lu(V.eventId,V.count),H.value=!1);break;case"toggleAvailability":Ti(V.player,V.eventId);break;case"toggleArchive":await setEventArchived(V.eventId,V.archived,o.value);{const ae=Je.value.findIndex(me=>me.id===V.eventId);ae!==-1&&(Je.value[ae]={...Je.value[ae],archived:!!V.archived}),de.value=!!V.archived}break;case"updateSelection":{const{eventId:ae,players:me}=V,he=[...We.value[ae]||[]],Ve=Array.isArray(me)?me:[];await Lm(ae,Ve,o.value),We.value[ae]=Ve;try{const tt=he.filter(ft=>!Ve.includes(ft));if(tt.length>0){const ft=Je.value.find(kt=>kt.id===ae);await yF({eventId:ae,eventData:ft,removedPlayers:tt,newSelectedPlayers:Ve,seasonId:o.value,seasonSlug:s,players:Zr.value})}}catch{}try{(Z=lt.value)==null||Z.showSuccess(!0,!0)}catch{}}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),je.value=!0,It.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{je.value=!1},3e3)}}function du(){t.push("/seasons")}Ks(()=>{const b=vr.value;b&&b.removeEventListener("scroll",Cr),window.removeEventListener("resize",Cr)});async function Xv(b){K.value=b,ee.value=b.description||"",de.value=!!b.archived;try{const[g,V]=await Promise.all([Uo(ht.value,Je.value,o.value),jo(o.value)]);Zt.value=g,We.value=V}catch(g){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",g)}H.value=!0}function Hf(){H.value=!1,K.value=null,ee.value="",_e.value=!1,ve.value=!1,zt(),jr(),Fe.value={position:"fixed",top:"0px",left:"0px"},Oe.value={position:"fixed",top:"0px",left:"0px"}}function Ba(b,g=null){const V=g||K.value;if(V)try{y5(b,V,i.value),je.value=!0,b==="ics"?It.value="Fichier .ics téléchargé ! Importez-le dans votre agenda":b==="google"?It.value="Google Calendar ouvert dans un nouvel onglet":b==="outlook"&&(It.value="Outlook ouvert dans un nouvel onglet"),setTimeout(()=>{je.value=!1},3e3)}catch(Z){console.error("Erreur lors de l'ajout au calendrier:",Z),je.value=!0,It.value="Erreur lors de l'ajout au calendrier",setTimeout(()=>{je.value=!1},3e3)}}function Zv(){Hf(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function a1(b,g){console.debug("handleAvailabilityToggle appelé");const V=ht.value.find(me=>me.name===b);if(!V){console.error("Joueur non trouvé");return}const Z=Je.value.find(me=>me.id===g);if(Z!=null&&Z.archived){je.value=!0,It.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{je.value=!1},3e3);return}console.debug("Joueur trouvé");const ae=ps(V.id);if(console.debug("Joueur protégé"),ae){ta(V.id)?(console.debug("Session active, procéder au toggle"),await To(b,g)):(console.debug("Demande du mot de passe pour joueur protégé"),Br.value={playerName:b,eventId:g},cn.value=V,Wt.value=!0);return}console.debug("Joueur non protégé, procéder au toggle"),await To(b,g)}function l1(b,g){return(We.value[g]||[]).includes(b)}async function u1(b){if(console.debug("Mot de passe vérifié"),cn.value&&(ie.value=cn.value.id,console.debug("Joueur marqué comme récemment vérifié")),Br.value){const{playerName:g,eventId:V}=Br.value;console.debug("Exécution de l'action en attente"),await To(g,V),Br.value=null}else console.debug("Aucune action en attente trouvée");Wt.value=!1,cn.value=null}function ey(){f.value=K.value.id,m.value=K.value.title,v.value=K.value.date,ee.value=K.value.description||"",w.value=K.value.playerCount||6,H.value=!1}async function ty(){if(K.value)try{const b=!K.value.archived,g={...K.value,archived:b};await Sb(K.value.id,g,o.value),K.value.archived=b;const V=Je.value.findIndex(Z=>Z.id===K.value.id);V!==-1&&(Je.value[V].archived=b),je.value=!0,It.value=b?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{je.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function Kf(b){C.value=b,I.value=!0;try{typeof B<"u"&&B.value}catch{}}function ny(){I.value=!1,C.value=null}async function c1({playerId:b,newName:g}){try{await z6(b,g,o.value),await Promise.all([Ju(o.value),Uo(ht.value,Je.value,o.value),jo(o.value)]).then(([V,Z,ae])=>{if(ht.value=V,Zt.value=Z,We.value=ae,ru(),C.value&&C.value.id===b){const me=V.find(he=>he.id===b);me&&(C.value=me)}}),je.value=!0,It.value="Joueur mis à jour avec succès !",setTimeout(()=>{je.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function d1(){try{await Promise.all([Ju(o.value),Uo(ht.value,Je.value,o.value),jo(o.value)]).then(([b,g,V])=>{if(ht.value=b,Zt.value=g,We.value=V,ru(),C.value){const Z=b.find(ae=>ae.id===C.value.id);Z&&(C.value=Z)}}),je.value=!0,It.value="Données mises à jour !",setTimeout(()=>{je.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function h1(b){if(!b)return{availability:0,selection:0,ratio:0};const g=Ai(b.name),V=Ds(b.name),Z=g===0?0:Math.round(V/g*100);return{availability:g,selection:V,ratio:Z}}function Ro(b){const g=We.value[b]||[],V=Je.value.find(me=>me.id===b),Z=(V==null?void 0:V.playerCount)||6,ae=So(b);if(g.length>0){const me=g.some(Ve=>!wr(Ve,b)),he=ae<Z;if(me||he)return{type:"incomplete",hasUnavailablePlayers:me,hasInsufficientPlayers:he,unavailablePlayers:g.filter(Ve=>!wr(Ve,b)),availableCount:ae,requiredCount:Z}}return ae<Z?{type:"insufficient",availableCount:ae,requiredCount:Z}:g.length===0?{type:"ready",availableCount:ae,requiredCount:Z}:{type:"complete",availableCount:ae,requiredCount:Z}}function hu(b){const g=Ro(b);switch(g.type){case"incomplete":return g.hasUnavailablePlayers?g.unavailablePlayers.length===1?`Sélection incomplète : ${g.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${g.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${g.availableCount} joueurs disponibles pour ${g.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${g.availableCount} disponibles pour ${g.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${g.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${g.availableCount} joueurs disponibles`;default:return""}}async function f1(){const b=[];for(const g of ht.value){if(!await Zi(g.id,o.value))continue;const Z=await QA(g.id,o.value);Z&&b.push({...g,email:Z})}return b}function yd(b){if(b!=null&&b.archived){je.value=!0,It.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{je.value=!1},3e3);return}ry(),At.value=b,yt.value=!0;try{const g=new URLSearchParams(window.location.search);g.set("modal","announce"),g.set("event",(b==null?void 0:b.id)||""),history.replaceState(null,"",`${window.location.pathname}?${g.toString()}`)}catch{}}function p1(){yt.value=!1,At.value=null;try{const b=new URLSearchParams(window.location.search);b.get("modal")==="announce"&&(b.delete("modal"),b.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${b.toString()}`))}catch{}}function ry(){Cn.value=!1,kn.value=null}const Gf=P(!1);async function sy({eventId:b,eventData:g,reason:V,selectedPlayers:Z,scope:ae="all",recipient:me=null}){Gf.value=!0;try{V==="selection"?(ae==="single"&&(me!=null&&me.email)?await Nb({eventId:b,eventData:g,selectedPlayers:[me.name],seasonId:o.value,seasonSlug:s,players:Zr.value}):await Nb({eventId:b,eventData:g,selectedPlayers:Z,seasonId:o.value,seasonSlug:s,players:Zr.value}),je.value=!0,It.value=ae==="single"?`Notification envoyée à ${(me==null?void 0:me.name)||"1 joueur"}`:"Notifications de sélection envoyées à tous les joueurs sélectionnés !",setTimeout(()=>{je.value=!1},3e3)):(ae==="single"&&(me!=null&&me.email)?await Db({eventId:b,eventData:g,players:[me],seasonId:o.value,seasonSlug:s,createMagicLink:Dm,reminder:!1,getAvailabilityForEvent:(he,Ve)=>wr(he,Ve)}):await Db({eventId:b,eventData:g,players:await f1(),seasonId:o.value,seasonSlug:s,createMagicLink:Dm,reminder:!1,getAvailabilityForEvent:(he,Ve)=>wr(he,Ve)}),je.value=!0,It.value=ae==="single"?`Notification envoyée à ${(me==null?void 0:me.name)||"1 joueur"}`:"Notifications envoyées à tous les joueurs protégés !",setTimeout(()=>{je.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),je.value=!0,It.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{je.value=!1},3e3)}Gf.value=!1}function Wf(b){if(!b)return{};const g={};return ht.value.forEach(V=>{g[V.name]=wr(V.name,b)}),g}function Co(b){if(b!=null&&b.archived){je.value=!0,It.value="Impossible d'ouvrir la sélection sur un événement archivé",setTimeout(()=>{je.value=!1},3e3);return}He.value=b,Ue.value=!0;try{const g=new URLSearchParams(window.location.search);g.set("modal","selection"),g.set("event",(b==null?void 0:b.id)||""),history.replaceState(null,"",`${window.location.pathname}?${g.toString()}`)}catch{}}function iy(){Ue.value=!1,He.value=null;try{const b=new URLSearchParams(window.location.search);b.get("modal")==="selection"&&(b.delete("modal"),b.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${b.toString()}`))}catch{}}async function m1(){if(!He.value)return;const b=He.value.id,g=He.value.playerCount||6;if(So(b)===0){je.value=!0,It.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{je.value=!1},3e3);return}await x({type:"launchSelection",data:{eventId:b,count:g}})}function g1(){iy(),je.value=!0,It.value="Sélection validée !",setTimeout(()=>{je.value=!1},3e3)}async function v1(b){if(!b||!b.eventId)return;const{eventId:g,players:V}=b;await x({type:"updateSelection",data:{eventId:g,players:V}})}async function Qf(b,g){if(!b||!g)return;ay(),Rr.value=b,eu.value=!0,await en();const V=document.querySelector(`[data-event-id="${b}"]`);if(!V){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(he=>{he.classList.remove("focused-event-highlight")});const Z=document.querySelectorAll(`[data-event-id="${b}"]`);Z.forEach(he=>{he.classList.add("focused-event-highlight")});const ae=Z[0],me=Z[Z.length-1];ae&&ae.classList.add("focused-event-column-start"),me&&me.classList.add("focused-event-column-end"),await y1(V),je.value=!0,It.value=`Événement ciblé : ${g.title}`,setTimeout(()=>{je.value=!1},4e3),gi.value=setTimeout(()=>{ay()},8e3)}function oy(b){if(!b)return;const g=Je.value.find(V=>V.id===b);if(!g){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const V=Je.value.find(Z=>Z.id===b);V?Qf(b,V):console.error("Événement toujours introuvable après retry")},500);return}Qf(b,g)}St(Je,b=>{try{const g=new URLSearchParams(window.location.search),V=g.get("modal"),Z=g.get("event");if(!V||!Z)return;const ae=b.find(me=>me.id===Z);if(!ae)return;V==="announce"&&yd(ae),V==="selection"&&Co(ae)}catch{}},{immediate:!0});async function y1(b){if(!b)return;if(await new Promise(V=>setTimeout(V,100)),window.innerWidth<=768){const V=vr.value;if(V){const Z=b.offsetLeft,ae=b.offsetWidth,me=V.clientWidth,he=Z-me/2+ae/2,Ve=V.scrollWidth-me,tt=Math.max(0,Math.min(he,Ve));V.scrollTo({left:tt,behavior:"smooth"}),setTimeout(()=>{const ft=b.getBoundingClientRect();if(ft.left<0||ft.right>window.innerWidth){const kt=Z-20;V.scrollTo({left:Math.max(0,kt),behavior:"smooth"})}},500)}}else b.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const g=vr.value;g&&setTimeout(()=>{const V=document.querySelector(`[data-event-id="${Rr.value}"]`);if(V&&V.closest("tbody")){const Z=V.offsetLeft,ae=V.offsetWidth,me=g.clientWidth,he=Z-me/2+ae/2,Ve=g.scrollWidth-me,tt=Math.max(0,Math.min(he,Ve));g.scrollTo({left:tt,behavior:"smooth"})}},300)}function ay(){gi.value&&(clearTimeout(gi.value),gi.value=null),Rr.value=null,eu.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(b=>{b.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(b=>{b.classList.remove("focused-event-column-start","focused-event-column-end")})}return(b,g)=>{var V,Z,ae,me,he,Ve,tt,ft,kt,on,bn,wn,Dt,Or,es,ko,qa,ly,uy,cy,dy,hy,fy,py;return k(),D(dt,null,[d("div",Bq,[Ye(jq,{"season-name":i.value,"is-scrolled":l.value,onGoBack:du,onOpenAccountMenu:Sa,onOpenHelp:g[0]||(g[0]=G=>Zn.value=!0),onOpenNotifications:jf,onOpenPlayers:Pa,onLogout:Yr,onOpenLogin:Ra,onOpenAccount:Ra},null,8,["season-name","is-scrolled"]),d("div",qq,[d("div",{ref_key:"headerBarRef",ref:id,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[d("div",zq,[Je.value.length===0&&ht.value.length===0?ce("",!0):(k(),D("div",Hq,[d("div",{class:"flex items-center justify-center h-full gap-2"},[d("button",{onClick:Ei,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},g[74]||(g[74]=[d("span",{class:"text-lg"},"➕",-1),d("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),d("span",{class:"sm:hidden"},"Événement",-1)]))])])),d("div",Kq,[d("div",{ref_key:"headerEventsRef",ref:Kn,class:"flex relative z-[60]",style:Vr({transform:`translateX(-${ka.value}px)`})},[(k(!0),D(dt,null,Mr(_n.value,G=>(k(),D("div",{key:"h-"+G.id,"data-event-id":G.id,class:Qt(["col-event flex-shrink-0 p-3 text-center flex flex-col justify-between",{"archived-header":G.archived}])},[d("div",{class:"flex flex-col items-center justify-between p-2 rounded-lg hover:bg-white/10 transition-colors duration-200 cursor-pointer group h-24",title:G.title+" - Cliquez pour voir les détails",onClick:pt(dn=>Xv(G),["stop"])},[d("div",Qq,[d("div",Jq,re(G.title||"Sans titre"),1),G.archived?(k(),D("div",Yq,"(Archivé)")):ce("",!0)]),d("div",Xq,[d("div",{onClick:pt(dn=>Hn(G.id),["stop"]),class:"header-date text-[16px] md:text-base text-gray-300 group-hover:text-purple-200 transition-colors duration-200 cursor-pointer hover:bg-white/10 px-2 py-1 rounded",title:Ua(G.date)+" - Cliquez pour ajouter à votre agenda"},re(uu(G.date)),9,Zq),qe.value===G.id?(k(),D("div",e9,[d("div",t9,[d("button",{onClick:pt(dn=>{Ba("google",G),zt()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},g[75]||(g[75]=[d("span",null,"🌐",-1),d("span",null,"Google Calendar",-1)]),8,n9),d("button",{onClick:pt(dn=>{Ba("outlook",G),zt()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},g[76]||(g[76]=[d("span",null,"📧",-1),d("span",null,"Outlook",-1)]),8,r9),d("button",{onClick:pt(dn=>{Ba("ics",G),zt()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},g[77]||(g[77]=[d("span",null,"📥",-1),d("span",null,"Télécharger (.ics)",-1)]),8,s9)])])):ce("",!0)])],8,Wq),d("div",i9,[G.archived?(k(),D("div",o9,g[78]||(g[78]=[d("span",{class:"text-xs text-gray-300 font-medium"},"📁",-1),d("span",{class:"text-xs text-gray-200 font-medium ml-1"},"Archivé",-1)]))):Ro(G.id).type==="ready"?(k(),D("div",{key:1,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-blue-500/30 transition-colors duration-200 cursor-pointer group",title:hu(G.id)+" - Cliquez pour ouvrir la sélection",onClick:pt(dn=>Co(G),["stop"])},g[79]||(g[79]=[d("span",{class:"text-xs text-blue-300 font-medium group-hover:text-blue-200"},"🆕",-1),d("span",{class:"text-xs text-blue-200 font-medium ml-1 group-hover:text-blue-100"},"Nouveau",-1)]),8,a9)):Ro(G.id).type==="complete"?(k(),D("div",{key:2,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-green-500/30 transition-colors duration-200 cursor-pointer group",title:hu(G.id)+" - Cliquez pour ouvrir la sélection",onClick:pt(dn=>Co(G),["stop"])},g[80]||(g[80]=[d("span",{class:"text-xs text-green-300 font-medium group-hover:text-green-200"},"✅",-1),d("span",{class:"text-xs text-green-200 font-medium ml-1 group-hover:text-green-100"},"Complet",-1)]),8,l9)):Ro(G.id).type==="incomplete"?(k(),D("div",{key:3,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-orange-500/30 transition-colors duration-200 cursor-pointer group",title:hu(G.id)+" - Cliquez pour ouvrir la sélection",onClick:pt(dn=>Co(G),["stop"])},g[81]||(g[81]=[d("span",{class:"text-xs text-orange-300 font-medium group-hover:text-orange-200"},"⚠️",-1),d("span",{class:"text-xs text-orange-200 font-medium ml-1 group-hover:text-orange-100"},"À finaliser",-1)]),8,u9)):Ro(G.id).type==="insufficient"?(k(),D("div",{key:4,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-red-500/30 transition-colors duration-200 cursor-pointer group",title:hu(G.id)+" - Cliquez pour ouvrir la sélection",onClick:pt(dn=>Co(G),["stop"])},g[82]||(g[82]=[d("span",{class:"text-xs text-red-300 font-medium group-hover:text-red-200"},"❌",-1),d("span",{class:"text-xs text-red-200 font-medium ml-1 group-hover:text-red-100"},"Manque",-1)]),8,c9)):ce("",!0)])],10,Gq))),128))],4)]),g[85]||(g[85]=d("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),d("button",{onClick:dd,class:"absolute right-2 top-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[86] backdrop-blur-sm",title:ks.value?"Masquer les événements archivés":"Afficher les événements archivés","aria-label":ks.value?"Masquer les événements archivés":"Afficher les événements archivés"},[(k(),D("svg",h9,[g[83]||(g[83]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),g[84]||(g[84]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),ks.value?ce("",!0):(k(),D("path",f9))]))],8,d9),ut(d("button",{onClick:g[1]||(g[1]=pt(G=>hs(-1,G),["prevent"])),onMousedown:g[2]||(g[2]=pt(G=>yr(-1,G),["prevent"])),onMouseup:g[3]||(g[3]=G=>_r(G)),onMouseleave:g[4]||(g[4]=G=>_r(G)),onTouchstart:g[5]||(g[5]=pt(G=>yr(-1,G),["prevent"])),onTouchend:g[6]||(g[6]=G=>_r(G)),onTouchcancel:g[7]||(g[7]=G=>_r(G)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[ap,sd.value]]),ut(d("button",{onClick:g[8]||(g[8]=pt(G=>hs(1,G),["prevent"])),onMousedown:g[9]||(g[9]=pt(G=>yr(1,G),["prevent"])),onMouseup:g[10]||(g[10]=G=>_r(G)),onMouseleave:g[11]||(g[11]=G=>_r(G)),onTouchstart:g[12]||(g[12]=pt(G=>yr(1,G),["prevent"])),onTouchend:g[13]||(g[13]=G=>_r(G)),onTouchcancel:g[14]||(g[14]=G=>_r(G)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[ap,tu.value]])])],512),ut(d("div",{ref_key:"gridboardRef",ref:vr,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[B.value===1?(k(),D("div",p9,[L.value.position?(k(),D("div",{key:0,class:"fixed z-[400]",style:Vr({left:L.value.position.x+"px",top:L.value.position.y+"px"})},[d("div",{id:"coachmark-add",class:Qt(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":L.value.side==="right","coachmark-left":L.value.side==="left"}])},[g[87]||(g[87]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),g[88]||(g[88]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),d("div",m9,[g[86]||(g[86]=d("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),d("button",{onClick:g[15]||(g[15]=G=>Fa(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):ce("",!0)])):ce("",!0),B.value===2&&U.value&&$.value?(k(),D("div",g9,[se.value.position?(k(),D("div",{key:0,class:"fixed z-[400]",style:Vr({position:"absolute",left:se.value.position.x+"px",top:se.value.position.y+"px"})},[d("div",v9,[g[90]||(g[90]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),g[91]||(g[91]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),d("div",y9,[g[89]||(g[89]=d("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),d("button",{onClick:g[16]||(g[16]=G=>Fa(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ce("",!0)])):ce("",!0),B.value===3&&U.value?(k(),D("div",_9,[te.value.position?(k(),D("div",{key:0,class:"fixed z-[400]",style:Vr({position:"absolute",left:te.value.position.x+"px",top:te.value.position.y+"px"})},[d("div",b9,[g[93]||(g[93]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),g[94]||(g[94]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),d("div",w9,[g[92]||(g[92]=d("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),d("button",{onClick:g[17]||(g[17]=G=>Fa(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ce("",!0)])):ce("",!0),d("table",x9,[d("colgroup",null,[g[95]||(g[95]=d("col",{class:"col-left"},null,-1)),(k(!0),D(dt,null,Mr(_n.value,(G,dn)=>(k(),D("col",{key:"c"+dn,class:"col-event"}))),128)),g[96]||(g[96]=d("col",{class:"col-right"},null,-1))]),g[100]||(g[100]=d("thead",{class:"hidden"},null,-1)),d("tbody",null,[(k(!0),D(dt,null,Mr(Cs.value,G=>{var dn;return k(),D("tr",{key:G.id,class:Qt(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":G.id===F.value,"preferred-player":gs.value.has(G.id)}]),"data-player-id":G.id},[d("td",E9,[d("div",T9,[gs.value.has(G.id)?(k(),D("span",A9," ⭐ ")):ps(G.id)?(k(),D("span",S9," 🔒 ")):ce("",!0),d("div",{onClick:xr=>Kf(G),class:Qt(["player-name hover:bg-white/10 rounded-lg p-2 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight block truncate max-w-full flex-1 min-w-0 group",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":B.value===3&&G.id===(U.value||((dn=Cs.value[0])==null?void 0:dn.id))}]),title:"Cliquez pour voir les détails : "+G.name},[d("span",R9,re(G.name),1)],10,P9)])]),(k(!0),D(dt,null,Mr(_n.value,xr=>{var my,gy,vy;return k(),D("td",{key:xr.id,"data-event-id":xr.id,class:Qt(["p-0",xr.archived?"archived-col":"",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":B.value===2&&G.id===(U.value||((my=Cs.value[0])==null?void 0:my.id))&&xr.id===($.value||((gy=_n.value[0])==null?void 0:gy.id))}])},[Ye(Ob,{"player-name":G.name,"event-id":xr.id,"is-available":wr(G.name,xr.id),"is-selected":fd(G.name,xr.id),"chance-percent":((vy=su.value[G.name])==null?void 0:vy[xr.id])??null,"show-selected-chance":vs(xr.id),disabled:xr.archived===!0,onToggle:To},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])],10,C9)}),128)),g[97]||(g[97]=d("td",{class:"p-3 md:p-4"},null,-1))],10,I9)}),128)),d("tr",k9,[d("td",D9,[d("div",N9,[d("button",{onClick:g[18]||(g[18]=G=>E.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},g[98]||(g[98]=[d("span",{class:"text-lg"},"➕",-1),d("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),d("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(k(!0),D(dt,null,Mr(_n.value,G=>(k(),D("td",{key:"add-row-"+G.id,"data-event-id":G.id,class:Qt(["p-3 md:p-5",G.archived?"archived-col":""])},null,10,O9))),128)),g[99]||(g[99]=d("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[ap,!ds.value]])])]),ds.value?(k(),D("div",V9,[d("div",M9,[g[101]||(g[101]=d("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[d("span",{class:"text-3xl"},"🎭")],-1)),d("p",L9,re(mi.value)+"…",1),d("div",$9,[d("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:Vr({width:Xr.value+"%"})},null,4)]),d("p",F9,re(Xr.value)+"%",1)])])):ce("",!0),ds.value?ce("",!0):(k(),Gs(Vq,{key:1,"season-id":o.value,"season-slug":rs(s),"players-count":ht.value.length,"events-count":Je.value.length,"onboarding-done":((V=a.value)==null?void 0:V.onboardingCreatorDone)===!0,onCreateEvent:Ei,onAddPlayer:g[19]||(g[19]=()=>{E.value=!0}),onCopyLink:qf,onDismissed:Zl},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),ce("",!0),je.value?(k(),D("div",U9,[d("div",j9,[g[102]||(g[102]=d("span",{class:"text-xl"},"✨",-1)),d("span",null,re(It.value),1)])])):ce("",!0),kr.value?(k(),D("div",B9,[d("div",q9,[g[103]||(g[103]=d("span",{class:"text-xl"},"⚠️",-1)),d("span",null,re(bi.value),1)])])):ce("",!0),Oa.value?(k(),D("div",z9,[d("div",H9,[g[109]||(g[109]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),d("div",K9,[g[104]||(g[104]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),ut(d("input",{"onUpdate:modelValue":g[20]||(g[20]=G=>xi.value=G),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[Mt,xi.value]])]),d("div",G9,[g[105]||(g[105]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),ut(d("input",{"onUpdate:modelValue":g[21]||(g[21]=G=>Ii.value=G),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[Mt,Ii.value]])]),d("div",W9,[g[106]||(g[106]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),ut(d("textarea",{"onUpdate:modelValue":g[22]||(g[22]=G=>br.value=G),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[Mt,br.value]])]),d("div",Q9,[ut(d("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":g[23]||(g[23]=G=>Va.value=G),class:"w-4 h-4"},null,512),[[Gi,Va.value]]),g[107]||(g[107]=d("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),d("div",J9,[g[108]||(g[108]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),ut(d("input",{"onUpdate:modelValue":g[24]||(g[24]=G=>xo.value=G),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[Mt,xo.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:cd,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Ma,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):ce("",!0),E.value?(k(),D("div",Y9,[d("div",X9,[g[111]||(g[111]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),d("div",Z9,[g[110]||(g[110]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),ut(d("input",{"onUpdate:modelValue":g[25]||(g[25]=G=>A.value=G),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[Mt,A.value]])]),d("div",ez,[d("button",{onClick:g[26]||(g[26]=G=>E.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:ud,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):ce("",!0),c.value?(k(),D("div",tz,[d("div",nz,[g[112]||(g[112]=jn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),d("div",rz,[d("button",{onClick:ld,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:g[27]||(g[27]=()=>ms()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ce("",!0),Mn.value?(k(),D("div",sz,[d("div",iz,[g[113]||(g[113]=jn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),d("div",oz,[d("button",{onClick:vd,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:g[28]||(g[28]=()=>gd()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):ce("",!0),T.value?(k(),D("div",az,[d("div",lz,[d("div",uz,[g[114]||(g[114]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🎭")],-1)),g[115]||(g[115]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",cz,[_.value&&We.value[_.value]&&We.value[_.value].every(G=>wr(G,_.value))?(k(),D("span",dz,"Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.")):(k(),D("span",hz,"La sélection sera mise à jour : les joueurs disponibles seront conservés, les slots vides seront complétés."))])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:p,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:u,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):ce("",!0),H.value?(k(),D("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:Hf},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:g[42]||(g[42]=pt(()=>{},["stop"]))},[d("div",fz,[d("button",{onClick:Hf,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",pz,[g[121]||(g[121]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),d("div",mz,[d("div",gz,[d("h2",vz,re((Z=K.value)==null?void 0:Z.title),1),d("div",yz,[g[116]||(g[116]=d("span",{class:"text-blue-300"},"👥",-1)),d("span",_z,re(((ae=K.value)==null?void 0:ae.playerCount)||6)+" joueurs",1)])]),d("div",bz,[d("p",wz,re(Ua((me=K.value)==null?void 0:me.date)),1),d("div",xz,[d("button",{onClick:g[29]||(g[29]=G=>Ur()),class:"px-3 py-1.5 hover:bg-white/20 rounded text-purple-300 hover:text-green-400 transition-colors duration-200 text-sm flex items-center gap-2 border border-purple-500/30",title:"Ajouter à votre agenda"},g[117]||(g[117]=[d("span",null,"📅",-1),d("span",null,"Agenda",-1)])),ze.value?(k(),D("div",Iz,[d("div",Ez,[d("button",{onClick:g[30]||(g[30]=G=>{Ba("google"),jr()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},g[118]||(g[118]=[d("span",null,"🌐",-1),d("span",null,"Google Calendar",-1)])),d("button",{onClick:g[31]||(g[31]=G=>{Ba("outlook"),jr()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},g[119]||(g[119]=[d("span",null,"📧",-1),d("span",null,"Outlook",-1)])),d("button",{onClick:g[32]||(g[32]=G=>{Ba("ics"),jr()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},g[120]||(g[120]=[d("span",null,"📥",-1),d("span",null,"Télécharger (.ics)",-1)]))])])):ce("",!0)])]),(he=K.value)!=null&&he.description?(k(),D("div",Tz,re(K.value.description),1)):ce("",!0)])])]),d("div",Az,[d("div",Sz,[d("div",Pz,[d("div",Rz,re(So((Ve=K.value)==null?void 0:Ve.id)),1),g[122]||(g[122]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",Cz,[d("div",kz,re(Po((tt=K.value)==null?void 0:tt.id)),1),g[123]||(g[123]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),d("div",Dz,[d("div",Nz,re(Math.max((((ft=K.value)==null?void 0:ft.playerCount)||6)-Po((kt=K.value)==null?void 0:kt.id),0)),1),g[124]||(g[124]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))])]),K.value?(k(),D("div",Oz,[d("div",Vz,[au.value?(k(),D("div",{key:0,class:Qt(["flex items-center gap-2 px-2 py-1 rounded-md border text-[11px] md:text-xs max-w-[70%] truncate",((on=hd.value)==null?void 0:on.type)==="incomplete"?"bg-yellow-500/10 border-yellow-500/30 text-yellow-200":"bg-orange-500/10 border-orange-500/30 text-orange-200"]),title:Eo.value},[g[125]||(g[125]=d("span",null,"⚠️",-1)),d("span",Lz,re(Eo.value),1)],10,Mz)):ce("",!0),ut(d("select",{"onUpdate:modelValue":g[33]||(g[33]=G=>ou.value=G),class:"ml-auto bg-gray-800 text-white rounded-md px-3 py-2 border border-white/10 focus:outline-none text-sm",title:"Filtrer les joueurs par statut"},g[126]||(g[126]=[jn('<option value="selected">Sélectionnés</option><option value="available">Disponibles</option><option value="unavailable">Non Disponibles</option><option value="unknown">Pas de réponse</option><option value="all">Tous</option>',5)]),512),[[UP,ou.value]])]),d("div",$z,[(k(!0),D(dt,null,Mr(Io.value,G=>{var dn,xr;return k(),D("div",{key:G.id,class:"flex items-center justify-between px-2 py-1.5 rounded-md hover:bg-gray-800/40 transition-colors"},[d("div",Fz,[gs.value.has(G.id)?(k(),D("span",Uz," ⭐ ")):ps(G.id)?(k(),D("span",jz," 🔒 ")):ce("",!0),d("span",{class:"text-white text-sm md:text-base block truncate max-w-full flex-1 min-w-0",title:G.name},re(G.name),9,Bz)]),d("div",qz,[Ye(Ob,{"player-name":G.name,"event-id":K.value.id,"is-available":Wf(K.value.id)[G.name],"is-selected":l1(G.name,K.value.id),"chance-percent":((dn=su.value[G.name])==null?void 0:dn[K.value.id])??null,"show-selected-chance":vs(K.value.id),disabled:((xr=K.value)==null?void 0:xr.archived)===!0,compact:!0,onToggle:a1},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])])])}),128))])])):ce("",!0),d("div",zz,[d("button",{onClick:g[34]||(g[34]=G=>Co(K.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},g[127]||(g[127]=[d("span",null,"🎭",-1),d("span",null,"Sélectionner",-1)])),d("button",{onClick:g[35]||(g[35]=G=>yd(K.value)),disabled:(bn=K.value)==null?void 0:bn.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(wn=K.value)!=null&&wn.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},g[128]||(g[128]=[d("span",null,"📢",-1),d("span",null,"Annoncer",-1)]),8,Hz),d("div",{class:"relative",ref_key:"eventMoreActionsRef",ref:we},[d("button",{onClick:g[36]||(g[36]=G=>yn()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},g[129]||(g[129]=[d("span",null,"⋯",-1),d("span",null,"Plus",-1)]))],512),d("button",{onClick:Zv,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),(k(),Gs(ec,{to:"body"},[ve.value?(k(),D("div",{key:0,ref_key:"eventMoreActionsDropdownRef",ref:ge,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:Vr(Fe.value)},[d("button",{onClick:g[37]||(g[37]=G=>{ey(),ve.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},g[130]||(g[130]=[d("span",null,"✏️",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:g[38]||(g[38]=G=>{ty(),ve.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10",title:(Dt=K.value)!=null&&Dt.archived?"Désarchiver cet événement":"Archiver cet événement"},[d("span",null,re((Or=K.value)!=null&&Or.archived?"📂":"📁"),1),d("span",null,re((es=K.value)!=null&&es.archived?"Désarchiver":"Archiver"),1)],8,Kz),d("button",{onClick:g[39]||(g[39]=G=>{var dn;wi((dn=K.value)==null?void 0:dn.id),ve.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},g[131]||(g[131]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ce("",!0)]))])]),d("div",Gz,[d("button",{onClick:g[40]||(g[40]=G=>Co(K.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),d("button",{onClick:Zv,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),d("button",{onClick:g[41]||(g[41]=G=>sn()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):ce("",!0),(k(),Gs(ec,{to:"body"},[_e.value?(k(),D("div",{key:0,ref_key:"eventMoreActionsMobileDropdownRef",ref:Re,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:Vr(Oe.value)},[d("button",{onClick:g[43]||(g[43]=G=>{yd(K.value),_e.value=!1}),disabled:(ko=K.value)==null?void 0:ko.archived,class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10 disabled:opacity-50 disabled:cursor-not-allowed",title:(qa=K.value)!=null&&qa.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},g[132]||(g[132]=[d("span",null,"📢",-1),d("span",null,"Annoncer",-1)]),8,Wz),d("button",{onClick:g[44]||(g[44]=G=>{ey(),_e.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},g[133]||(g[133]=[d("span",null,"✏️",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:g[45]||(g[45]=G=>{ty(),_e.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},[d("span",null,re((ly=K.value)!=null&&ly.archived?"📂":"📁"),1),d("span",null,re((uy=K.value)!=null&&uy.archived?"Désarchiver":"Archiver"),1)]),d("button",{onClick:g[46]||(g[46]=G=>{var dn;wi((dn=K.value)==null?void 0:dn.id),_e.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},g[134]||(g[134]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ce("",!0)])),Ye(Yv,{show:Wt.value,player:cn.value,seasonId:o.value,onClose:g[47]||(g[47]=G=>Wt.value=!1),onVerified:u1},null,8,["show","player","seasonId"]),f.value?(k(),D("div",Qz,[d("div",Jz,[g[140]||(g[140]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),d("div",Yz,[g[135]||(g[135]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),ut(d("input",{"onUpdate:modelValue":g[48]||(g[48]=G=>m.value=G),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[rr(zr,["esc"]),rr(Na,["enter"])],ref:"editTitleInput"},null,544),[[Mt,m.value]])]),d("div",Xz,[g[136]||(g[136]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),ut(d("input",{"onUpdate:modelValue":g[49]||(g[49]=G=>v.value=G),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[rr(zr,["esc"]),rr(Na,["enter"])]},null,544),[[Mt,v.value]])]),d("div",Zz,[g[137]||(g[137]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),ut(d("textarea",{"onUpdate:modelValue":g[50]||(g[50]=G=>ee.value=G),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:rr(zr,["esc"])},null,544),[[Mt,ee.value]])]),d("div",e8,[ut(d("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":g[51]||(g[51]=G=>de.value=G),class:"w-4 h-4"},null,512),[[Gi,de.value]]),g[138]||(g[138]=d("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),d("div",t8,[g[139]||(g[139]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),ut(d("input",{"onUpdate:modelValue":g[52]||(g[52]=G=>w.value=G),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:rr(zr,["esc"])},null,544),[[Mt,w.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:zr,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Na,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ce("",!0),Ye(NA,{show:N.value,message:y(),error:Qe.value,"session-info":Dr(),onSubmit:J,onCancel:Ae},null,8,["show","message","error","session-info"]),it.value?(k(),D("div",n8,[d("div",r8,[g[142]||(g[142]=jn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),d("div",s8,[d("div",i8,[d("div",null,[g[141]||(g[141]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),ut(d("input",{"onUpdate:modelValue":g[53]||(g[53]=G=>le.value=G),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:g[54]||(g[54]=rr(G=>Ct(le.value),["enter"])),ref_key:"playerPasswordInputRef",ref:Ce},null,544),[[Mt,le.value]])])]),d("button",{onClick:g[55]||(g[55]=G=>Ct(le.value)),disabled:!le.value||oe.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[oe.value?(k(),D("span",a8,"⏳")):(k(),D("span",l8,"🔓")),d("span",null,re(oe.value?"Vérification...":"Vérifier et supprimer"),1)],8,o8)]),d("div",u8,[d("button",{onClick:g[56]||(g[56]=G=>ot.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),ne.value?(k(),D("div",c8,[d("div",d8,re(ne.value),1)])):ce("",!0),d("div",{class:"flex justify-center"},[d("button",{onClick:Dn,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ce("",!0),X.value?(k(),D("div",h8,[d("div",f8,[g[145]||(g[145]=jn('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),d("div",p8,[d("div",m8,[d("div",null,[g[143]||(g[143]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),ut(d("input",{"onUpdate:modelValue":g[57]||(g[57]=G=>Ze.value=G),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:g[58]||(g[58]=rr(G=>Et(Ze.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:qt},null,544),[[Mt,Ze.value]])])]),d("div",g8,[d("button",{onClick:g[59]||(g[59]=G=>Y.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),xe.value?(k(),D("div",v8,[d("div",y8,re(xe.value),1)])):ce("",!0)]),d("div",_8,[d("button",{onClick:Ln,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),d("button",{onClick:g[60]||(g[60]=G=>Et(Ze.value)),disabled:!Ze.value||mt.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[mt.value?(k(),D("span",w8,"⏳")):(k(),D("span",x8,"🔓")),d("span",null,[bt(re(mt.value?"Vérification...":"Vérifier"),1),g[144]||(g[144]=d("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,b8)])])])):ce("",!0),Y.value?(k(),D("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:g[63]||(g[63]=G=>Y.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:g[62]||(g[62]=pt(()=>{},["stop"]))},[g[147]||(g[147]=jn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),d("div",I8,[g[146]||(g[146]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:$n,disabled:Te.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Te.value?(k(),D("span",T8,"⏳")):(k(),D("span",A8,"📧")),d("span",null,re(Te.value?"Envoi...":"Envoyer l'email"),1)],8,E8)]),be.value?(k(),D("div",S8,[d("div",P8,re(be.value),1)])):ce("",!0),De.value?(k(),D("div",R8,[d("div",C8,re(De.value),1)])):ce("",!0),d("div",k8,[d("button",{onClick:g[61]||(g[61]=G=>Y.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0),ot.value?(k(),D("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:g[66]||(g[66]=G=>ot.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:g[65]||(g[65]=pt(()=>{},["stop"]))},[g[149]||(g[149]=jn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),d("div",D8,[g[148]||(g[148]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:Pi,disabled:vt.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[vt.value?(k(),D("span",O8,"⏳")):(k(),D("span",V8,"📧")),d("span",null,re(vt.value?"Envoi...":"Envoyer l'email"),1)],8,N8)]),S.value?(k(),D("div",M8,[d("div",L8,re(S.value),1)])):ce("",!0),O.value?(k(),D("div",$8,[d("div",F8,re(O.value),1)])):ce("",!0),d("div",U8,[d("button",{onClick:g[64]||(g[64]=G=>ot.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0),Ye(kB,{ref_key:"playerModalRef",ref:M,show:I.value,player:C.value,stats:h1(C.value),seasonId:o.value,"onboarding-step":B.value,"onboarding-player-id":U.value,"is-protected":C.value?qr.value.has(C.value.id):!1,"is-preferred":C.value?gs.value.has(C.value.id):!1,onClose:ny,onUpdate:c1,onDelete:Si,onRefresh:d1,onAdvanceOnboarding:g[67]||(g[67]=G=>{try{typeof B.value<"u"&&(B.value.value=G)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id","is-protected","is-preferred"]),Ye(xq,{ref_key:"selectionModalRef",ref:lt,show:Ue.value,event:He.value,"current-selection":We.value[(cy=He.value)==null?void 0:cy.id]||[],"available-count":So((dy=He.value)==null?void 0:dy.id),"selected-count":Po((hy=He.value)==null?void 0:hy.id),"player-availability":Wf((fy=He.value)==null?void 0:fy.id),"season-id":o.value,"season-slug":rs(s),players:Zr.value,onClose:iy,onSelection:m1,onPerfect:g1,onSendNotifications:sy,onUpdateSelection:v1},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),Ye(s1,{show:yt.value,event:At.value,"season-id":o.value,"season-slug":rs(s),players:Zr.value,sending:Gf.value,"availability-by-player":Wf((py=At.value)==null?void 0:py.id),onClose:p1,onSendNotifications:sy},null,8,["show","event","season-id","season-slug","players","sending","availability-by-player"]),Ye(cj,{show:Zn.value,onClose:g[68]||(g[68]=G=>Zn.value=!1)},null,8,["show"]),Ye(ZA,{show:rt.value,"season-id":o.value,onClose:cs,onManagePlayer:Xl,onChangePassword:Ca,onLogoutDevice:Yr,onDeleteAccount:rd},null,8,["show","season-id"]),Ye(e1,{show:tr.value,onClose:Bf},null,8,["show"]),Ye(t1,{show:Vn.value,onClose:nd,onManagePlayer:Xl},null,8,["show"]),Ye(i1,{show:Pt.value,player:Aa.value,"season-id":o.value,onClose:g[69]||(g[69]=G=>Pt.value=!1),onSuccess:g[70]||(g[70]=()=>{Pt.value=!1,rt.value=!0})},null,8,["show","player","season-id"]),Ye(VA,{show:er.value,onClose:g[71]||(g[71]=G=>er.value=!1),onSuccess:g[72]||(g[72]=()=>{er.value=!1,rt.value=!0})},null,8,["show"]),Cn.value?(k(),D("div",j8,[d("div",B8,[g[150]||(g[150]=d("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),g[151]||(g[151]=d("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),d("div",q8,[d("button",{onClick:g[73]||(g[73]=G=>yd(kn.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),d("button",{onClick:ry,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):ce("",!0)],64)}}},z8={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},H8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},K8={key:0,class:"text-center py-8"},G8={key:1,class:"text-center py-8"},W8={class:"text-gray-300 mb-6"},Q8={key:2,class:"space-y-6"},J8={class:"text-center"},Y8={class:"text-gray-300"},X8={class:"font-semibold text-white"},Z8={class:"space-y-4"},eH=["disabled"],tH={key:0,class:"animate-spin"},nH={key:1},rH={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},sH={class:"text-red-300 text-sm"},iH={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},oH={class:"text-green-300 text-sm"},aH={__name:"PasswordReset",setup(n){const e=Ea(),t=Jl(),r=P(!0),s=P(""),i=P(""),o=P(""),a=P(""),l=P(""),c=P(!1),h=P(""),f=P(""),m=$e(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);En(async()=>{try{const{oobCode:E}=e.query;if(j.debug("Token reçu (masqué)"),!E){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=E,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(E){j.error("Erreur lors de la vérification du lien",E),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function v(){if(m.value){c.value=!0,h.value="",f.value="";try{j.debug("Début réinitialisation avec token (masqué)"),await eL(Ke,o.value,a.value),j.info("Mot de passe Firebase Auth mis à jour"),j.info("Réinitialisation terminée avec Firebase Auth"),f.value="Mot de passe réinitialisé avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{w()},3e3)}catch(E){j.error("Erreur lors de la réinitialisation",E),E.code==="auth/weak-password"?h.value="Le mot de passe doit contenir au moins 6 caractères":E.code==="auth/invalid-action-code"?h.value="Lien de réinitialisation invalide ou expiré":h.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}function w(){t.push("/seasons")}return(E,A)=>(k(),D("div",z8,[d("div",H8,[A[8]||(A[8]=jn('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(k(),D("div",K8,A[2]||(A[2]=[d("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),d("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(k(),D("div",G8,[A[3]||(A[3]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"❌")],-1)),A[4]||(A[4]=d("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),d("p",W8,re(s.value),1),d("button",{onClick:w,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):i.value?(k(),D("div",Q8,[d("div",J8,[d("p",Y8,[A[5]||(A[5]=bt("Email : ")),d("span",X8,re(i.value),1)])]),d("div",Z8,[d("div",null,[A[6]||(A[6]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),ut(d("input",{"onUpdate:modelValue":A[0]||(A[0]=F=>a.value=F),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:rr(v,["enter"])},null,544),[[Mt,a.value]])]),d("div",null,[A[7]||(A[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),ut(d("input",{"onUpdate:modelValue":A[1]||(A[1]=F=>l.value=F),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:rr(v,["enter"])},null,544),[[Mt,l.value]])])]),d("button",{onClick:v,disabled:!m.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(k(),D("span",tH,"⏳")):(k(),D("span",nH,"🔑")),d("span",null,re(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,eH),h.value?(k(),D("div",rH,[d("div",sH,re(h.value),1)])):ce("",!0),f.value?(k(),D("div",iH,[d("div",oH,re(f.value),1)])):ce("",!0)])):ce("",!0)])]))}},lH={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},uH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},cH={class:"text-3xl"},dH={class:"text-2xl font-bold text-white mb-2"},hH={class:"text-gray-300 mb-6"},fH={__name:"MagicLink",setup(n){const e=Ea(),t=Jl(),r=P("loading"),s=P("Traitement en cours..."),i=P("Merci de patienter pendant la validation du lien."),o=$e(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/seasons")}return En(async()=>{var l;try{Jv("firebase");const c=String(e.query.sid||""),h=String(e.query.pid||"");let f=String(e.query.eid||"");const m=String(e.query.t||""),v=String(e.query.a||""),w=String(e.query.slug||"");if(!m||!v){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(v==="account_email_update"){const L=await FA({token:m});if(!L.valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}try{await oL(Ke.currentUser,L.data.newEmail),await UA({token:m}),r.value="ok",s.value="Email mis à jour",i.value="Votre adresse email a été mise à jour avec succès."}catch{r.value="error",s.value="Action impossible",i.value="Veuillez vous reconnecter puis réessayer."}return}if(v==="verify_email"&&(f="protection"),!(await LA({seasonId:c,playerId:h,eventId:f,token:m,action:v})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(v==="verify_email"){await KA({playerId:h,seasonId:c});try{await YA({playerId:h,seasonId:c})}catch{}await Nm({seasonId:c,playerId:h,eventId:"protection",action:v}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(w?()=>t.push(`/season/${w}?player=${encodeURIComponent(h)}&verified=1`):()=>t.push("/seasons"),800);return}const A=Se(ue,"seasons",c,"players",h),F=await Gt(A),U=F.exists()&&F.data().name||"";if(!U){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}if(await H6({seasonId:c,playerName:U,eventId:f,value:v==="yes"}),v==="no")try{const L=Se(ue,"seasons",c,"selections",f),se=await Gt(L);if(se.exists()){const te=Array.isArray((l=se.data())==null?void 0:l.players)?se.data().players:[],T=te.filter(_=>_!==U);T.length!==te.length&&await setDoc(L,{players:T},{merge:!0})}}catch{}await Nm({seasonId:c,playerId:h,eventId:f,action:v}),r.value="ok",s.value="Merci !",i.value=v==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible. (Si vous étiez sélectionné(e), vous avez été retiré(e) de la sélection.)",setTimeout(w?()=>t.push(`/season/${w}/event/${f}`):()=>t.push("/seasons"),1200)}catch(c){j.error("Magic link error",c),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(k(),D("div",lH,[d("div",uH,[d("div",{class:Qt(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[d("span",cH,re(o.value),1)],2),d("h1",dH,re(s.value),1),d("p",hH,re(i.value),1),d("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},pH={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},mH={class:"text-center py-12 px-4"},gH={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},vH={class:"container mx-auto px-4 pb-16"},yH={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},_H={class:"space-y-5"},bH=["onKeydown"],wH={class:"flex items-center justify-end gap-3 pt-2"},xH=["disabled"],IH={key:0,class:"mt-6 text-sm text-gray-200"},EH={__name:"JoinSeason",setup(n){const e=Ea(),t=Jl(),r=e.params.slug,s=P(""),i=P(""),o=P(""),a=P(!1),l=P("");En(async()=>{const f=wc(st(ue,"seasons"),Ph("slug","==",r)),m=await Vt(f);if(m.empty)l.value="Saison introuvable";else{const v=m.docs[0];s.value=v.id,i.value=v.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function h(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await r1(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){j.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,m)=>(k(),D("div",pH,[d("div",mH,[d("h1",gH,re(i.value||"Rejoindre la saison"),1),m[1]||(m[1]=d("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),d("div",vH,[d("div",yH,[m[3]||(m[3]=d("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),d("div",_H,[d("div",null,[m[2]||(m[2]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),ut(d("input",{"onUpdate:modelValue":m[0]||(m[0]=v=>o.value=v),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:rr(pt(h,["prevent"]),["enter"])},null,40,bH),[[Mt,o.value]])]),d("div",wH,[d("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{disabled:!o.value.trim()||a.value,onClick:h,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,xH)])]),l.value?(k(),D("div",IH,re(l.value),1)):ce("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const TH=[{path:"/",component:R$},{path:"/seasons",component:l5},{path:"/season/:slug",component:Vb,props:!0},{path:"/season/:slug/event/:eventId",component:Vb,props:!0},{path:"/season/:slug/join",component:EH,props:!0},{path:"/reset-password",component:aH},{path:"/magic",component:fH}],AH=a$({history:M3("/"),routes:TH}),o1=KP(i3);o1.use(AH);o1.mount("#app");d$({immediate:!0,onRegistered(n){window.__swReg=n}});export{st as $,ZE as A,ha as B,Ss as C,An as D,CK as E,va as F,nv as G,RK as H,kH as I,Qr as J,rO as K,iO as L,Gl as M,rK as N,sK as O,CO as P,Xn as Q,WH as R,MH as S,ln as T,wK as U,gf as V,SO as W,RO as X,nK as Y,FH as Z,qx as _,yc as a,Yc as a$,OH as a0,sO as a1,gO as a2,PK as a3,Dl as a4,bK as a5,BH as a6,SK as a7,Se as a8,KH as a9,HH as aA,cK as aB,dK as aC,GH as aD,pO as aE,gK as aF,vK as aG,TO as aH,wc as aI,FE as aJ,VH as aK,_K as aL,ri as aM,hn as aN,EK as aO,SH as aP,iK as aQ,XH as aR,YH as aS,tK as aT,qH as aU,wa as aV,IK as aW,UH as aX,Ph as aY,fv as aZ,MK as a_,aO as aa,$H as ab,jH as ac,AK as ad,eK as ae,ZH as af,un as ag,Gc as ah,yO as ai,hK as aj,Gt as ak,oK as al,aK as am,Vt as an,lK as ao,uK as ap,oO as aq,TK as ar,xK as as,LH as at,QH as au,JH as av,zH as aw,fK as ax,mK as ay,pK as az,lO as b,BT as b$,Jc as b0,$K as b1,Tc as b2,xa as b3,qi as b4,DK as b5,Hi as b6,zi as b7,oi as b8,eh as b9,sM as bA,iG as bB,yG as bC,H_ as bD,ML as bE,TM as bF,ZK as bG,KK as bH,JM as bI,uG as bJ,pG as bK,vG as bL,oG as bM,gL as bN,pL as bO,UK as bP,GV as bQ,YM as bR,cG as bS,fG as bT,gG as bU,aM as bV,rG as bW,QK as bX,ZM as bY,HK as bZ,fL as b_,VK as ba,ea as bb,fl as bc,F4 as bd,NK as be,aG as bf,Em as bg,OK as bh,U4 as bi,Uv as bj,Ki as bk,qK as bl,mL as bm,YT as bn,$4 as bo,ZT as bp,tL as bq,eL as br,SM as bs,nL as bt,LK as bu,sG as bv,WK as bw,XK as bx,G4 as by,FK as bz,Cl as c,Rv as c0,BK as c1,rL as c2,GK as c3,lG as c4,hG as c5,mG as c6,vL as c7,jK as c8,nG as c9,oL as ca,aL as cb,dG as cc,YK as cd,tG as ce,eG as cf,JK as cg,zK as ch,ya as d,Bt as e,pe as f,Kl as g,Hc as h,Yd as i,If as j,Kc as k,wf as l,dv as m,kl as n,xf as o,Wo as p,PO as q,pn as r,sa as s,ke as t,RH as u,Jk as v,nn as w,kK as x,gt as y,PH as z};
