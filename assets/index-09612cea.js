(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function yp(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const wt={},aa=[],Vr=()=>{},LE=()=>!1,Md=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),_p=n=>n.startsWith("onUpdate:"),In=Object.assign,bp=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},FE=Object.prototype.hasOwnProperty,ft=(n,e)=>FE.call(n,e),Oe=Array.isArray,la=n=>Cu(n)==="[object Map]",Ld=n=>Cu(n)==="[object Set]",wg=n=>Cu(n)==="[object Date]",ze=n=>typeof n=="function",Zt=n=>typeof n=="string",Zr=n=>typeof n=="symbol",St=n=>n!==null&&typeof n=="object",p_=n=>(St(n)||ze(n))&&ze(n.then)&&ze(n.catch),m_=Object.prototype.toString,Cu=n=>m_.call(n),$E=n=>Cu(n).slice(8,-1),g_=n=>Cu(n)==="[object Object]",wp=n=>Zt(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,jl=yp(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Fd=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},UE=/-(\w)/g,Er=Fd(n=>n.replace(UE,(e,t)=>t?t.toUpperCase():"")),jE=/\B([A-Z])/g,Ri=Fd(n=>n.replace(jE,"-$1").toLowerCase()),$d=Fd(n=>n.charAt(0).toUpperCase()+n.slice(1)),zh=Fd(n=>n?`on${$d(n)}`:""),di=(n,e)=>!Object.is(n,e),Lc=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},If=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},Ef=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let Ig;const Ud=()=>Ig||(Ig=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function ms(n){if(Oe(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=Zt(r)?GE(r):ms(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(Zt(n)||St(n))return n}const BE=/;(?![^(]*\))/g,qE=/:([^]+)/,zE=/\/\*[^]*?\*\//g;function GE(n){const e={};return n.replace(zE,"").split(BE).forEach(t=>{if(t){const r=t.split(qE);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function hn(n){let e="";if(Zt(n))e=n;else if(Oe(n))for(let t=0;t<n.length;t++){const r=hn(n[t]);r&&(e+=r+" ")}else if(St(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const KE="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",HE=yp(KE);function v_(n){return!!n||n===""}function WE(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=jd(n[r],e[r]);return t}function jd(n,e){if(n===e)return!0;let t=wg(n),r=wg(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=Zr(n),r=Zr(e),t||r)return n===e;if(t=Oe(n),r=Oe(e),t||r)return t&&r?WE(n,e):!1;if(t=St(n),r=St(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!jd(n[o],e[o]))return!1}}return String(n)===String(e)}function y_(n,e){return n.findIndex(t=>jd(t,e))}const __=n=>!!(n&&n.__v_isRef===!0),le=n=>Zt(n)?n:n==null?"":Oe(n)||St(n)&&(n.toString===m_||!ze(n.toString))?__(n)?le(n.value):JSON.stringify(n,b_,2):String(n),b_=(n,e)=>__(e)?b_(n,e.value):la(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[Gh(r,i)+" =>"]=s,t),{})}:Ld(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>Gh(t))}:Zr(e)?Gh(e):St(e)&&!Oe(e)&&!g_(e)?String(e):e,Gh=(n,e="")=>{var t;return Zr(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let er;class QE{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=er,!e&&er&&(this.index=(er.scopes||(er.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=er;try{return er=this,e()}finally{er=t}}}on(){++this._on===1&&(this.prevScope=er,er=this)}off(){this._on>0&&--this._on===0&&(er=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function JE(){return er}let xt;const Kh=new WeakSet;class w_{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,er&&er.active&&er.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Kh.has(this)&&(Kh.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||E_(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Eg(this),T_(this);const e=xt,t=Nr;xt=this,Nr=!0;try{return this.fn()}finally{x_(this),xt=e,Nr=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Tp(e);this.deps=this.depsTail=void 0,Eg(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Kh.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Tf(this)&&this.run()}get dirty(){return Tf(this)}}let I_=0,Bl,ql;function E_(n,e=!1){if(n.flags|=8,e){n.next=ql,ql=n;return}n.next=Bl,Bl=n}function Ip(){I_++}function Ep(){if(--I_>0)return;if(ql){let e=ql;for(ql=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Bl;){let e=Bl;for(Bl=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function T_(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function x_(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),Tp(r),YE(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function Tf(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(A_(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function A_(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===ru)||(n.globalVersion=ru,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!Tf(n))))return;n.flags|=2;const e=n.dep,t=xt,r=Nr;xt=n,Nr=!0;try{T_(n);const s=n.fn(n._value);(e.version===0||di(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{xt=t,Nr=r,x_(n),n.flags&=-3}}function Tp(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)Tp(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function YE(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let Nr=!0;const S_=[];function Ts(){S_.push(Nr),Nr=!1}function xs(){const n=S_.pop();Nr=n===void 0?!0:n}function Eg(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=xt;xt=void 0;try{e()}finally{xt=t}}}let ru=0;class XE{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class xp{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!xt||!Nr||xt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==xt)t=this.activeLink=new XE(xt,this),xt.deps?(t.prevDep=xt.depsTail,xt.depsTail.nextDep=t,xt.depsTail=t):xt.deps=xt.depsTail=t,P_(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=xt.depsTail,t.nextDep=void 0,xt.depsTail.nextDep=t,xt.depsTail=t,xt.deps===t&&(xt.deps=r)}return t}trigger(e){this.version++,ru++,this.notify(e)}notify(e){Ip();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Ep()}}}function P_(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)P_(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const xf=new WeakMap,co=Symbol(""),Af=Symbol(""),su=Symbol("");function Mn(n,e,t){if(Nr&&xt){let r=xf.get(n);r||xf.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new xp),s.map=r,s.key=t),s.track()}}function gs(n,e,t,r,s,i){const o=xf.get(n);if(!o){ru++;return}const a=l=>{l&&l.trigger()};if(Ip(),e==="clear")o.forEach(a);else{const l=Oe(n),c=l&&wp(t);if(l&&t==="length"){const d=Number(r);o.forEach((f,g)=>{(g==="length"||g===su||!Zr(g)&&g>=d)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(su)),e){case"add":l?c&&a(o.get("length")):(a(o.get(co)),la(n)&&a(o.get(Af)));break;case"delete":l||(a(o.get(co)),la(n)&&a(o.get(Af)));break;case"set":la(n)&&a(o.get(co));break}}Ep()}function Qo(n){const e=ht(n);return e===n?e:(Mn(e,"iterate",su),Ir(n)?e:e.map(Tn))}function Bd(n){return Mn(n=ht(n),"iterate",su),n}const ZE={__proto__:null,[Symbol.iterator](){return Hh(this,Symbol.iterator,Tn)},concat(...n){return Qo(this).concat(...n.map(e=>Oe(e)?Qo(e):e))},entries(){return Hh(this,"entries",n=>(n[1]=Tn(n[1]),n))},every(n,e){return hs(this,"every",n,e,void 0,arguments)},filter(n,e){return hs(this,"filter",n,e,t=>t.map(Tn),arguments)},find(n,e){return hs(this,"find",n,e,Tn,arguments)},findIndex(n,e){return hs(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return hs(this,"findLast",n,e,Tn,arguments)},findLastIndex(n,e){return hs(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return hs(this,"forEach",n,e,void 0,arguments)},includes(...n){return Wh(this,"includes",n)},indexOf(...n){return Wh(this,"indexOf",n)},join(n){return Qo(this).join(n)},lastIndexOf(...n){return Wh(this,"lastIndexOf",n)},map(n,e){return hs(this,"map",n,e,void 0,arguments)},pop(){return Il(this,"pop")},push(...n){return Il(this,"push",n)},reduce(n,...e){return Tg(this,"reduce",n,e)},reduceRight(n,...e){return Tg(this,"reduceRight",n,e)},shift(){return Il(this,"shift")},some(n,e){return hs(this,"some",n,e,void 0,arguments)},splice(...n){return Il(this,"splice",n)},toReversed(){return Qo(this).toReversed()},toSorted(n){return Qo(this).toSorted(n)},toSpliced(...n){return Qo(this).toSpliced(...n)},unshift(...n){return Il(this,"unshift",n)},values(){return Hh(this,"values",Tn)}};function Hh(n,e,t){const r=Bd(n),s=r[e]();return r!==n&&!Ir(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const eT=Array.prototype;function hs(n,e,t,r,s,i){const o=Bd(n),a=o!==n&&!Ir(n),l=o[e];if(l!==eT[e]){const f=l.apply(n,i);return a?Tn(f):f}let c=t;o!==n&&(a?c=function(f,g){return t.call(this,Tn(f),g,n)}:t.length>2&&(c=function(f,g){return t.call(this,f,g,n)}));const d=l.call(o,c,r);return a&&s?s(d):d}function Tg(n,e,t,r){const s=Bd(n);let i=t;return s!==n&&(Ir(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,Tn(a),l,n)}),s[e](i,...r)}function Wh(n,e,t){const r=ht(n);Mn(r,"iterate",su);const s=r[e](...t);return(s===-1||s===!1)&&Pp(t[0])?(t[0]=ht(t[0]),r[e](...t)):s}function Il(n,e,t=[]){Ts(),Ip();const r=ht(n)[e].apply(n,t);return Ep(),xs(),r}const tT=yp("__proto__,__v_isRef,__isVue"),R_=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Zr));function nT(n){Zr(n)||(n=String(n));const e=ht(this);return Mn(e,"has",n),e.hasOwnProperty(n)}class C_{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?hT:N_:i?V_:D_).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=Oe(e);if(!s){let l;if(o&&(l=ZE[t]))return l;if(t==="hasOwnProperty")return nT}const a=Reflect.get(e,t,$n(e)?e:r);return(Zr(t)?R_.has(t):tT(t))||(s||Mn(e,"get",t),i)?a:$n(a)?o&&wp(t)?a:a.value:St(a)?s?M_(a):qd(a):a}}class k_ extends C_{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=yi(i);if(!Ir(r)&&!yi(r)&&(i=ht(i),r=ht(r)),!Oe(e)&&$n(i)&&!$n(r))return l?!1:(i.value=r,!0)}const o=Oe(e)&&wp(t)?Number(t)<e.length:ft(e,t),a=Reflect.set(e,t,r,$n(e)?e:s);return e===ht(s)&&(o?di(r,i)&&gs(e,"set",t,r):gs(e,"add",t,r)),a}deleteProperty(e,t){const r=ft(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&gs(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!Zr(t)||!R_.has(t))&&Mn(e,"has",t),r}ownKeys(e){return Mn(e,"iterate",Oe(e)?"length":co),Reflect.ownKeys(e)}}class rT extends C_{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const sT=new k_,iT=new rT,oT=new k_(!0);const Sf=n=>n,Ec=n=>Reflect.getPrototypeOf(n);function aT(n,e,t){return function(...r){const s=this.__v_raw,i=ht(s),o=la(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),d=t?Sf:e?sd:Tn;return!e&&Mn(i,"iterate",l?Af:co),{next(){const{value:f,done:g}=c.next();return g?{value:f,done:g}:{value:a?[d(f[0]),d(f[1])]:d(f),done:g}},[Symbol.iterator](){return this}}}}function Tc(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function lT(n,e){const t={get(s){const i=this.__v_raw,o=ht(i),a=ht(s);n||(di(s,a)&&Mn(o,"get",s),Mn(o,"get",a));const{has:l}=Ec(o),c=e?Sf:n?sd:Tn;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&Mn(ht(s),"iterate",co),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=ht(i),a=ht(s);return n||(di(s,a)&&Mn(o,"has",s),Mn(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=ht(a),c=e?Sf:n?sd:Tn;return!n&&Mn(l,"iterate",co),a.forEach((d,f)=>s.call(i,c(d),c(f),o))}};return In(t,n?{add:Tc("add"),set:Tc("set"),delete:Tc("delete"),clear:Tc("clear")}:{add(s){!e&&!Ir(s)&&!yi(s)&&(s=ht(s));const i=ht(this);return Ec(i).has.call(i,s)||(i.add(s),gs(i,"add",s,s)),this},set(s,i){!e&&!Ir(i)&&!yi(i)&&(i=ht(i));const o=ht(this),{has:a,get:l}=Ec(o);let c=a.call(o,s);c||(s=ht(s),c=a.call(o,s));const d=l.call(o,s);return o.set(s,i),c?di(i,d)&&gs(o,"set",s,i):gs(o,"add",s,i),this},delete(s){const i=ht(this),{has:o,get:a}=Ec(i);let l=o.call(i,s);l||(s=ht(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&gs(i,"delete",s,void 0),c},clear(){const s=ht(this),i=s.size!==0,o=s.clear();return i&&gs(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=aT(s,n,e)}),t}function Ap(n,e){const t=lT(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(ft(t,s)&&s in r?t:r,s,i)}const uT={get:Ap(!1,!1)},cT={get:Ap(!1,!0)},dT={get:Ap(!0,!1)};const D_=new WeakMap,V_=new WeakMap,N_=new WeakMap,hT=new WeakMap;function fT(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function pT(n){return n.__v_skip||!Object.isExtensible(n)?0:fT($E(n))}function qd(n){return yi(n)?n:Sp(n,!1,sT,uT,D_)}function O_(n){return Sp(n,!1,oT,cT,V_)}function M_(n){return Sp(n,!0,iT,dT,N_)}function Sp(n,e,t,r,s){if(!St(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=pT(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function ua(n){return yi(n)?ua(n.__v_raw):!!(n&&n.__v_isReactive)}function yi(n){return!!(n&&n.__v_isReadonly)}function Ir(n){return!!(n&&n.__v_isShallow)}function Pp(n){return n?!!n.__v_raw:!1}function ht(n){const e=n&&n.__v_raw;return e?ht(e):n}function mT(n){return!ft(n,"__v_skip")&&Object.isExtensible(n)&&If(n,"__v_skip",!0),n}const Tn=n=>St(n)?qd(n):n,sd=n=>St(n)?M_(n):n;function $n(n){return n?n.__v_isRef===!0:!1}function O(n){return L_(n,!1)}function gT(n){return L_(n,!0)}function L_(n,e){return $n(n)?n:new vT(n,e)}class vT{constructor(e,t){this.dep=new xp,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:ht(e),this._value=t?e:Tn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Ir(e)||yi(e);e=r?e:ht(e),di(e,t)&&(this._rawValue=e,this._value=r?e:Tn(e),this.dep.trigger())}}function Is(n){return $n(n)?n.value:n}const yT={get:(n,e,t)=>e==="__v_raw"?n:Is(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return $n(s)&&!$n(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function F_(n){return ua(n)?n:new Proxy(n,yT)}class _T{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new xp(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=ru-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&xt!==this)return E_(this,!0),!0}get value(){const e=this.dep.track();return A_(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function bT(n,e,t=!1){let r,s;return ze(n)?r=n:(r=n.get,s=n.set),new _T(r,s,t)}const xc={},id=new WeakMap;let Xi;function wT(n,e=!1,t=Xi){if(t){let r=id.get(t);r||id.set(t,r=[]),r.push(n)}}function IT(n,e,t=wt){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=G=>s?G:Ir(G)||s===!1||s===0?vs(G,1):vs(G);let d,f,g,y,x=!1,P=!1;if($n(n)?(f=()=>n.value,x=Ir(n)):ua(n)?(f=()=>c(n),x=!0):Oe(n)?(P=!0,x=n.some(G=>ua(G)||Ir(G)),f=()=>n.map(G=>{if($n(G))return G.value;if(ua(G))return c(G);if(ze(G))return l?l(G,2):G()})):ze(n)?e?f=l?()=>l(n,2):n:f=()=>{if(g){Ts();try{g()}finally{xs()}}const G=Xi;Xi=d;try{return l?l(n,3,[y]):n(y)}finally{Xi=G}}:f=Vr,e&&s){const G=f,Z=s===!0?1/0:s;f=()=>vs(G(),Z)}const S=JE(),j=()=>{d.stop(),S&&S.active&&bp(S.effects,d)};if(i&&e){const G=e;e=(...Z)=>{G(...Z),j()}}let $=P?new Array(n.length).fill(xc):xc;const D=G=>{if(!(!(d.flags&1)||!d.dirty&&!G))if(e){const Z=d.run();if(s||x||(P?Z.some((pe,T)=>di(pe,$[T])):di(Z,$))){g&&g();const pe=Xi;Xi=d;try{const T=[Z,$===xc?void 0:P&&$[0]===xc?[]:$,y];$=Z,l?l(e,3,T):e(...T)}finally{Xi=pe}}}else d.run()};return a&&a(D),d=new w_(f),d.scheduler=o?()=>o(D,!1):D,y=G=>wT(G,!1,d),g=d.onStop=()=>{const G=id.get(d);if(G){if(l)l(G,4);else for(const Z of G)Z();id.delete(d)}},e?r?D(!0):$=d.run():o?o(D.bind(null,!0),!0):d.run(),j.pause=d.pause.bind(d),j.resume=d.resume.bind(d),j.stop=j,j}function vs(n,e=1/0,t){if(e<=0||!St(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,$n(n))vs(n.value,e,t);else if(Oe(n))for(let r=0;r<n.length;r++)vs(n[r],e,t);else if(Ld(n)||la(n))n.forEach(r=>{vs(r,e,t)});else if(g_(n)){for(const r in n)vs(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&vs(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ku(n,e,t,r){try{return r?n(...r):n()}catch(s){zd(s,e,t)}}function es(n,e,t,r){if(ze(n)){const s=ku(n,e,t,r);return s&&p_(s)&&s.catch(i=>{zd(i,e,t)}),s}if(Oe(n)){const s=[];for(let i=0;i<n.length;i++)s.push(es(n[i],e,t,r));return s}}function zd(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||wt;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const d=a.ec;if(d){for(let f=0;f<d.length;f++)if(d[f](n,l,c)===!1)return}a=a.parent}if(i){Ts(),ku(i,null,10,[n,l,c]),xs();return}}ET(n,t,s,r,o)}function ET(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const Wn=[];let Gr=-1;const ca=[];let ei=null,ea=0;const $_=Promise.resolve();let od=null;function dn(n){const e=od||$_;return n?e.then(this?n.bind(this):n):e}function TT(n){let e=Gr+1,t=Wn.length;for(;e<t;){const r=e+t>>>1,s=Wn[r],i=iu(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function Rp(n){if(!(n.flags&1)){const e=iu(n),t=Wn[Wn.length-1];!t||!(n.flags&2)&&e>=iu(t)?Wn.push(n):Wn.splice(TT(e),0,n),n.flags|=1,U_()}}function U_(){od||(od=$_.then(B_))}function xT(n){Oe(n)?ca.push(...n):ei&&n.id===-1?ei.splice(ea+1,0,n):n.flags&1||(ca.push(n),n.flags|=1),U_()}function xg(n,e,t=Gr+1){for(;t<Wn.length;t++){const r=Wn[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;Wn.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function j_(n){if(ca.length){const e=[...new Set(ca)].sort((t,r)=>iu(t)-iu(r));if(ca.length=0,ei){ei.push(...e);return}for(ei=e,ea=0;ea<ei.length;ea++){const t=ei[ea];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}ei=null,ea=0}}const iu=n=>n.id==null?n.flags&2?-1:1/0:n.id;function B_(n){const e=Vr;try{for(Gr=0;Gr<Wn.length;Gr++){const t=Wn[Gr];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),ku(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;Gr<Wn.length;Gr++){const t=Wn[Gr];t&&(t.flags&=-2)}Gr=-1,Wn.length=0,j_(),od=null,(Wn.length||ca.length)&&B_()}}let cr=null,q_=null;function ad(n){const e=cr;return cr=n,q_=n&&n.type.__scopeId||null,e}function AT(n,e=cr,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&Lg(-1);const i=ad(e);let o;try{o=n(...s)}finally{ad(i),r._d&&Lg(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function rt(n,e){if(cr===null)return n;const t=Wd(cr),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=wt]=e[s];i&&(ze(i)&&(i={mounted:i,updated:i}),i.deep&&vs(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function Qi(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(Ts(),es(l,t,8,[n.el,a,n,e]),xs())}}const z_=Symbol("_vte"),ST=n=>n.__isTeleport,zl=n=>n&&(n.disabled||n.disabled===""),Ag=n=>n&&(n.defer||n.defer===""),Sg=n=>typeof SVGElement<"u"&&n instanceof SVGElement,Pg=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,Pf=(n,e)=>{const t=n&&n.to;return Zt(t)?e?e(t):null:t},G_={name:"Teleport",__isTeleport:!0,process(n,e,t,r,s,i,o,a,l,c){const{mc:d,pc:f,pbc:g,o:{insert:y,querySelector:x,createText:P,createComment:S}}=c,j=zl(e.props);let{shapeFlag:$,children:D,dynamicChildren:G}=e;if(n==null){const Z=e.el=P(""),pe=e.anchor=P("");y(Z,t,r),y(pe,t,r);const T=(I,C)=>{$&16&&(s&&s.isCE&&(s.ce._teleportTarget=I),d(D,I,C,s,i,o,a,l))},w=()=>{const I=e.target=Pf(e.props,x),C=K_(I,e,P,y);I&&(o!=="svg"&&Sg(I)?o="svg":o!=="mathml"&&Pg(I)&&(o="mathml"),j||(T(I,C),Fc(e,!1)))};j&&(T(t,pe),Fc(e,!0)),Ag(e.props)?(e.el.__isMounted=!1,Hn(()=>{w(),delete e.el.__isMounted},i)):w()}else{if(Ag(e.props)&&n.el.__isMounted===!1){Hn(()=>{G_.process(n,e,t,r,s,i,o,a,l,c)},i);return}e.el=n.el,e.targetStart=n.targetStart;const Z=e.anchor=n.anchor,pe=e.target=n.target,T=e.targetAnchor=n.targetAnchor,w=zl(n.props),I=w?t:pe,C=w?Z:T;if(o==="svg"||Sg(pe)?o="svg":(o==="mathml"||Pg(pe))&&(o="mathml"),G?(g(n.dynamicChildren,G,I,s,i,o,a),Np(n,e,!0)):l||f(n,e,I,C,s,i,o,a,!1),j)w?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):Ac(e,t,Z,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const V=e.target=Pf(e.props,x);V&&Ac(e,V,null,c,0)}else w&&Ac(e,pe,T,c,1);Fc(e,j)}},remove(n,e,t,{um:r,o:{remove:s}},i){const{shapeFlag:o,children:a,anchor:l,targetStart:c,targetAnchor:d,target:f,props:g}=n;if(f&&(s(c),s(d)),i&&s(l),o&16){const y=i||!zl(g);for(let x=0;x<a.length;x++){const P=a[x];r(P,e,t,y,!!P.dynamicChildren)}}},move:Ac,hydrate:PT};function Ac(n,e,t,{o:{insert:r},m:s},i=2){i===0&&r(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:d}=n,f=i===2;if(f&&r(o,e,t),(!f||zl(d))&&l&16)for(let g=0;g<c.length;g++)s(c[g],e,t,2);f&&r(a,e,t)}function PT(n,e,t,r,s,i,{o:{nextSibling:o,parentNode:a,querySelector:l,insert:c,createText:d}},f){const g=e.target=Pf(e.props,l);if(g){const y=zl(e.props),x=g._lpa||g.firstChild;if(e.shapeFlag&16)if(y)e.anchor=f(o(n),e,a(n),t,r,s,i),e.targetStart=x,e.targetAnchor=x&&o(x);else{e.anchor=o(n);let P=x;for(;P;){if(P&&P.nodeType===8){if(P.data==="teleport start anchor")e.targetStart=P;else if(P.data==="teleport anchor"){e.targetAnchor=P,g._lpa=e.targetAnchor&&o(e.targetAnchor);break}}P=o(P)}e.targetAnchor||K_(g,e,d,c),f(x&&o(x),e,g,t,r,s,i)}Fc(e,y)}return e.anchor&&o(e.anchor)}const RT=G_;function Fc(n,e){const t=n.ctx;if(t&&t.ut){let r,s;for(e?(r=n.el,s=n.anchor):(r=n.targetStart,s=n.targetAnchor);r&&r!==s;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function K_(n,e,t,r){const s=e.targetStart=t(""),i=e.targetAnchor=t("");return s[z_]=i,n&&(r(s,n),r(i,n)),i}function Cp(n,e){n.shapeFlag&6&&n.component?(n.transition=e,Cp(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function H_(n,e){return ze(n)?(()=>In({name:n.name},e,{setup:n}))():n}function W_(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function Gl(n,e,t,r,s=!1){if(Oe(n)){n.forEach((x,P)=>Gl(x,e&&(Oe(e)?e[P]:e),t,r,s));return}if(Kl(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&Gl(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?Wd(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,d=a.refs===wt?a.refs={}:a.refs,f=a.setupState,g=ht(f),y=f===wt?()=>!1:x=>ft(g,x);if(c!=null&&c!==l&&(Zt(c)?(d[c]=null,y(c)&&(f[c]=null)):$n(c)&&(c.value=null)),ze(l))ku(l,a,12,[o,d]);else{const x=Zt(l),P=$n(l);if(x||P){const S=()=>{if(n.f){const j=x?y(l)?f[l]:d[l]:l.value;s?Oe(j)&&bp(j,i):Oe(j)?j.includes(i)||j.push(i):x?(d[l]=[i],y(l)&&(f[l]=d[l])):(l.value=[i],n.k&&(d[n.k]=l.value))}else x?(d[l]=o,y(l)&&(f[l]=o)):P&&(l.value=o,n.k&&(d[n.k]=o))};o?(S.id=-1,Hn(S,t)):S()}}}Ud().requestIdleCallback;Ud().cancelIdleCallback;const Kl=n=>!!n.type.__asyncLoader,Q_=n=>n.type.__isKeepAlive;function CT(n,e){J_(n,"a",e)}function kT(n,e){J_(n,"da",e)}function J_(n,e,t=Fn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(Gd(e,r,t),t){let s=t.parent;for(;s&&s.parent;)Q_(s.parent.vnode)&&DT(r,e,t,s),s=s.parent}}function DT(n,e,t,r){const s=Gd(e,n,r,!0);oa(()=>{bp(r[e],s)},t)}function Gd(n,e,t=Fn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Ts();const a=Du(t),l=es(e,t,n,o);return a(),xs(),l});return r?s.unshift(i):s.push(i),i}}const Ds=n=>(e,t=Fn)=>{(!lu||n==="sp")&&Gd(n,(...r)=>e(...r),t)},VT=Ds("bm"),wr=Ds("m"),NT=Ds("bu"),OT=Ds("u"),MT=Ds("bum"),oa=Ds("um"),LT=Ds("sp"),FT=Ds("rtg"),$T=Ds("rtc");function UT(n,e=Fn){Gd("ec",n,e)}const Y_="components";function jT(n,e){return qT(Y_,n,!0,e)||n}const BT=Symbol.for("v-ndc");function qT(n,e,t=!0,r=!1){const s=cr||Fn;if(s){const i=s.type;if(n===Y_){const a=Rx(i,!1);if(a&&(a===e||a===Er(e)||a===$d(Er(e))))return i}const o=Rg(s[n]||i[n],e)||Rg(s.appContext[n],e);return!o&&r?i:o}}function Rg(n,e){return n&&(n[e]||n[Er(e)]||n[$d(Er(e))])}function ur(n,e,t,r){let s;const i=t&&t[r],o=Oe(n);if(o||Zt(n)){const a=o&&ua(n);let l=!1,c=!1;a&&(l=!Ir(n),c=yi(n),n=Bd(n)),s=new Array(n.length);for(let d=0,f=n.length;d<f;d++)s[d]=e(l?c?sd(Tn(n[d])):Tn(n[d]):n[d],d,void 0,i&&i[d])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(St(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const d=a[l];s[l]=e(n[d],d,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}const Rf=n=>n?m0(n)?Wd(n):Rf(n.parent):null,Hl=In(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Rf(n.parent),$root:n=>Rf(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>kp(n),$forceUpdate:n=>n.f||(n.f=()=>{Rp(n.update)}),$nextTick:n=>n.n||(n.n=dn.bind(n.proxy)),$watch:n=>cx.bind(n)}),Qh=(n,e)=>n!==wt&&!n.__isScriptSetup&&ft(n,e),zT={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const y=o[e];if(y!==void 0)switch(y){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(Qh(r,e))return o[e]=1,r[e];if(s!==wt&&ft(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&ft(c,e))return o[e]=3,i[e];if(t!==wt&&ft(t,e))return o[e]=4,t[e];Cf&&(o[e]=0)}}const d=Hl[e];let f,g;if(d)return e==="$attrs"&&Mn(n.attrs,"get",""),d(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==wt&&ft(t,e))return o[e]=4,t[e];if(g=l.config.globalProperties,ft(g,e))return g[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return Qh(s,e)?(s[e]=t,!0):r!==wt&&ft(r,e)?(r[e]=t,!0):ft(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==wt&&ft(n,o)||Qh(e,o)||(a=i[0])&&ft(a,o)||ft(r,o)||ft(Hl,o)||ft(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:ft(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function Cg(n){return Oe(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let Cf=!0;function GT(n){const e=kp(n),t=n.proxy,r=n.ctx;Cf=!1,e.beforeCreate&&kg(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:d,beforeMount:f,mounted:g,beforeUpdate:y,updated:x,activated:P,deactivated:S,beforeDestroy:j,beforeUnmount:$,destroyed:D,unmounted:G,render:Z,renderTracked:pe,renderTriggered:T,errorCaptured:w,serverPrefetch:I,expose:C,inheritAttrs:V,components:B,directives:R,filters:Rt}=e;if(c&&KT(c,r,null),o)for(const Me in o){const Le=o[Me];ze(Le)&&(r[Me]=Le.bind(t))}if(s){const Me=s.call(t,t);St(Me)&&(n.data=qd(Me))}if(Cf=!0,i)for(const Me in i){const Le=i[Me],ln=ze(Le)?Le.bind(t,t):ze(Le.get)?Le.get.bind(t,t):Vr,en=!ze(Le)&&ze(Le.set)?Le.set.bind(t):Vr,Ct=Be({get:ln,set:en});Object.defineProperty(r,Me,{enumerable:!0,configurable:!0,get:()=>Ct.value,set:fe=>Ct.value=fe})}if(a)for(const Me in a)X_(a[Me],r,t,Me);if(l){const Me=ze(l)?l.call(t):l;Reflect.ownKeys(Me).forEach(Le=>{$c(Le,Me[Le])})}d&&kg(d,n,"c");function Ye(Me,Le){Oe(Le)?Le.forEach(ln=>Me(ln.bind(t))):Le&&Me(Le.bind(t))}if(Ye(VT,f),Ye(wr,g),Ye(NT,y),Ye(OT,x),Ye(CT,P),Ye(kT,S),Ye(UT,w),Ye($T,pe),Ye(FT,T),Ye(MT,$),Ye(oa,G),Ye(LT,I),Oe(C))if(C.length){const Me=n.exposed||(n.exposed={});C.forEach(Le=>{Object.defineProperty(Me,Le,{get:()=>t[Le],set:ln=>t[Le]=ln})})}else n.exposed||(n.exposed={});Z&&n.render===Vr&&(n.render=Z),V!=null&&(n.inheritAttrs=V),B&&(n.components=B),R&&(n.directives=R),I&&W_(n)}function KT(n,e,t=Vr){Oe(n)&&(n=kf(n));for(const r in n){const s=n[r];let i;St(s)?"default"in s?i=Or(s.from||r,s.default,!0):i=Or(s.from||r):i=Or(s),$n(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function kg(n,e,t){es(Oe(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function X_(n,e,t,r){let s=r.includes(".")?c0(t,r):()=>t[r];if(Zt(n)){const i=e[n];ze(i)&&Vt(s,i)}else if(ze(n))Vt(s,n.bind(t));else if(St(n))if(Oe(n))n.forEach(i=>X_(i,e,t,r));else{const i=ze(n.handler)?n.handler.bind(t):e[n.handler];ze(i)&&Vt(s,i,n)}}function kp(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>ld(l,c,o,!0)),ld(l,e,o)),St(e)&&i.set(e,l),l}function ld(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&ld(n,i,t,!0),s&&s.forEach(o=>ld(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=HT[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const HT={data:Dg,props:Vg,emits:Vg,methods:Vl,computed:Vl,beforeCreate:Kn,created:Kn,beforeMount:Kn,mounted:Kn,beforeUpdate:Kn,updated:Kn,beforeDestroy:Kn,beforeUnmount:Kn,destroyed:Kn,unmounted:Kn,activated:Kn,deactivated:Kn,errorCaptured:Kn,serverPrefetch:Kn,components:Vl,directives:Vl,watch:QT,provide:Dg,inject:WT};function Dg(n,e){return e?n?function(){return In(ze(n)?n.call(this,this):n,ze(e)?e.call(this,this):e)}:e:n}function WT(n,e){return Vl(kf(n),kf(e))}function kf(n){if(Oe(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Kn(n,e){return n?[...new Set([].concat(n,e))]:e}function Vl(n,e){return n?In(Object.create(null),n,e):e}function Vg(n,e){return n?Oe(n)&&Oe(e)?[...new Set([...n,...e])]:In(Object.create(null),Cg(n),Cg(e??{})):e}function QT(n,e){if(!n)return e;if(!e)return n;const t=In(Object.create(null),n);for(const r in e)t[r]=Kn(n[r],e[r]);return t}function Z_(){return{app:null,config:{isNativeTag:LE,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let JT=0;function YT(n,e){return function(r,s=null){ze(r)||(r=In({},r)),s!=null&&!St(s)&&(s=null);const i=Z_(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:JT++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:kx,get config(){return i.config},set config(d){},use(d,...f){return o.has(d)||(d&&ze(d.install)?(o.add(d),d.install(c,...f)):ze(d)&&(o.add(d),d(c,...f))),c},mixin(d){return i.mixins.includes(d)||i.mixins.push(d),c},component(d,f){return f?(i.components[d]=f,c):i.components[d]},directive(d,f){return f?(i.directives[d]=f,c):i.directives[d]},mount(d,f,g){if(!l){const y=c._ceVNode||at(r,s);return y.appContext=i,g===!0?g="svg":g===!1&&(g=void 0),f&&e?e(y,d):n(y,d,g),l=!0,c._container=d,d.__vue_app__=c,Wd(y.component)}},onUnmount(d){a.push(d)},unmount(){l&&(es(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(d,f){return i.provides[d]=f,c},runWithContext(d){const f=da;da=c;try{return d()}finally{da=f}}};return c}}let da=null;function $c(n,e){if(Fn){let t=Fn.provides;const r=Fn.parent&&Fn.parent.provides;r===t&&(t=Fn.provides=Object.create(r)),t[n]=e}}function Or(n,e,t=!1){const r=Fn||cr;if(r||da){let s=da?da._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&ze(e)?e.call(r&&r.proxy):e}}const e0={},t0=()=>Object.create(e0),n0=n=>Object.getPrototypeOf(n)===e0;function XT(n,e,t,r=!1){const s={},i=t0();n.propsDefaults=Object.create(null),r0(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:O_(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function ZT(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=ht(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const d=n.vnode.dynamicProps;for(let f=0;f<d.length;f++){let g=d[f];if(Kd(n.emitsOptions,g))continue;const y=e[g];if(l)if(ft(i,g))y!==i[g]&&(i[g]=y,c=!0);else{const x=Er(g);s[x]=Df(l,a,x,y,n,!1)}else y!==i[g]&&(i[g]=y,c=!0)}}}else{r0(n,e,s,i)&&(c=!0);let d;for(const f in a)(!e||!ft(e,f)&&((d=Ri(f))===f||!ft(e,d)))&&(l?t&&(t[f]!==void 0||t[d]!==void 0)&&(s[f]=Df(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!ft(e,f))&&(delete i[f],c=!0)}c&&gs(n.attrs,"set","")}function r0(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(jl(l))continue;const c=e[l];let d;s&&ft(s,d=Er(l))?!i||!i.includes(d)?t[d]=c:(a||(a={}))[d]=c:Kd(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=ht(t),c=a||wt;for(let d=0;d<i.length;d++){const f=i[d];t[f]=Df(s,l,f,c[f],n,!ft(c,f))}}return o}function Df(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=ft(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&ze(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const d=Du(s);r=c[t]=l.call(null,e),d()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===Ri(t))&&(r=!0))}return r}const ex=new WeakMap;function s0(n,e,t=!1){const r=t?ex:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!ze(n)){const d=f=>{l=!0;const[g,y]=s0(f,e,!0);In(o,g),y&&a.push(...y)};!t&&e.mixins.length&&e.mixins.forEach(d),n.extends&&d(n.extends),n.mixins&&n.mixins.forEach(d)}if(!i&&!l)return St(n)&&r.set(n,aa),aa;if(Oe(i))for(let d=0;d<i.length;d++){const f=Er(i[d]);Ng(f)&&(o[f]=wt)}else if(i)for(const d in i){const f=Er(d);if(Ng(f)){const g=i[d],y=o[f]=Oe(g)||ze(g)?{type:g}:In({},g),x=y.type;let P=!1,S=!0;if(Oe(x))for(let j=0;j<x.length;++j){const $=x[j],D=ze($)&&$.name;if(D==="Boolean"){P=!0;break}else D==="String"&&(S=!1)}else P=ze(x)&&x.name==="Boolean";y[0]=P,y[1]=S,(P||ft(y,"default"))&&a.push(f)}}const c=[o,a];return St(n)&&r.set(n,c),c}function Ng(n){return n[0]!=="$"&&!jl(n)}const Dp=n=>n[0]==="_"||n==="$stable",Vp=n=>Oe(n)?n.map(Kr):[Kr(n)],tx=(n,e,t)=>{if(e._n)return e;const r=AT((...s)=>Vp(e(...s)),t);return r._c=!1,r},i0=(n,e,t)=>{const r=n._ctx;for(const s in n){if(Dp(s))continue;const i=n[s];if(ze(i))e[s]=tx(s,i,r);else if(i!=null){const o=Vp(i);e[s]=()=>o}}},o0=(n,e)=>{const t=Vp(e);n.slots.default=()=>t},a0=(n,e,t)=>{for(const r in e)(t||!Dp(r))&&(n[r]=e[r])},nx=(n,e,t)=>{const r=n.slots=t0();if(n.vnode.shapeFlag&32){const s=e.__;s&&If(r,"__",s,!0);const i=e._;i?(a0(r,e,t),t&&If(r,"_",i,!0)):i0(e,r)}else e&&o0(n,e)},rx=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=wt;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:a0(s,e,t):(i=!e.$stable,i0(e,s)),o=e}else e&&(o0(n,e),o={default:1});if(i)for(const a in s)!Dp(a)&&o[a]==null&&delete s[a]},Hn=vx;function sx(n){return ix(n)}function ix(n,e){const t=Ud();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:d,parentNode:f,nextSibling:g,setScopeId:y=Vr,insertStaticContent:x}=n,P=(E,A,L,ee=null,J=null,te=null,me=void 0,ce=null,de=!!A.dynamicChildren)=>{if(E===A)return;E&&!El(E,A)&&(ee=k(E),fe(E,J,te,!0),E=null),A.patchFlag===-2&&(de=!1,A.dynamicChildren=null);const{type:ie,ref:Ee,shapeFlag:be}=A;switch(ie){case Hd:S(E,A,L,ee);break;case _i:j(E,A,L,ee);break;case Uc:E==null&&$(A,L,ee,me);break;case gt:B(E,A,L,ee,J,te,me,ce,de);break;default:be&1?Z(E,A,L,ee,J,te,me,ce,de):be&6?R(E,A,L,ee,J,te,me,ce,de):(be&64||be&128)&&ie.process(E,A,L,ee,J,te,me,ce,de,X)}Ee!=null&&J?Gl(Ee,E&&E.ref,te,A||E,!A):Ee==null&&E&&E.ref!=null&&Gl(E.ref,null,te,E,!0)},S=(E,A,L,ee)=>{if(E==null)r(A.el=a(A.children),L,ee);else{const J=A.el=E.el;A.children!==E.children&&c(J,A.children)}},j=(E,A,L,ee)=>{E==null?r(A.el=l(A.children||""),L,ee):A.el=E.el},$=(E,A,L,ee)=>{[E.el,E.anchor]=x(E.children,A,L,ee,E.el,E.anchor)},D=({el:E,anchor:A},L,ee)=>{let J;for(;E&&E!==A;)J=g(E),r(E,L,ee),E=J;r(A,L,ee)},G=({el:E,anchor:A})=>{let L;for(;E&&E!==A;)L=g(E),s(E),E=L;s(A)},Z=(E,A,L,ee,J,te,me,ce,de)=>{A.type==="svg"?me="svg":A.type==="math"&&(me="mathml"),E==null?pe(A,L,ee,J,te,me,ce,de):I(E,A,J,te,me,ce,de)},pe=(E,A,L,ee,J,te,me,ce)=>{let de,ie;const{props:Ee,shapeFlag:be,transition:Te,dirs:Re}=E;if(de=E.el=o(E.type,te,Ee&&Ee.is,Ee),be&8?d(de,E.children):be&16&&w(E.children,de,null,ee,J,Jh(E,te),me,ce),Re&&Qi(E,null,ee,"created"),T(de,E,E.scopeId,me,ee),Ee){for(const $e in Ee)$e!=="value"&&!jl($e)&&i(de,$e,null,Ee[$e],te,ee);"value"in Ee&&i(de,"value",null,Ee.value,te),(ie=Ee.onVnodeBeforeMount)&&zr(ie,ee,E)}Re&&Qi(E,null,ee,"beforeMount");const Ve=ox(J,Te);Ve&&Te.beforeEnter(de),r(de,A,L),((ie=Ee&&Ee.onVnodeMounted)||Ve||Re)&&Hn(()=>{ie&&zr(ie,ee,E),Ve&&Te.enter(de),Re&&Qi(E,null,ee,"mounted")},J)},T=(E,A,L,ee,J)=>{if(L&&y(E,L),ee)for(let te=0;te<ee.length;te++)y(E,ee[te]);if(J){let te=J.subTree;if(A===te||h0(te.type)&&(te.ssContent===A||te.ssFallback===A)){const me=J.vnode;T(E,me,me.scopeId,me.slotScopeIds,J.parent)}}},w=(E,A,L,ee,J,te,me,ce,de=0)=>{for(let ie=de;ie<E.length;ie++){const Ee=E[ie]=ce?ti(E[ie]):Kr(E[ie]);P(null,Ee,A,L,ee,J,te,me,ce)}},I=(E,A,L,ee,J,te,me)=>{const ce=A.el=E.el;let{patchFlag:de,dynamicChildren:ie,dirs:Ee}=A;de|=E.patchFlag&16;const be=E.props||wt,Te=A.props||wt;let Re;if(L&&Ji(L,!1),(Re=Te.onVnodeBeforeUpdate)&&zr(Re,L,A,E),Ee&&Qi(A,E,L,"beforeUpdate"),L&&Ji(L,!0),(be.innerHTML&&Te.innerHTML==null||be.textContent&&Te.textContent==null)&&d(ce,""),ie?C(E.dynamicChildren,ie,ce,L,ee,Jh(A,J),te):me||Le(E,A,ce,null,L,ee,Jh(A,J),te,!1),de>0){if(de&16)V(ce,be,Te,L,J);else if(de&2&&be.class!==Te.class&&i(ce,"class",null,Te.class,J),de&4&&i(ce,"style",be.style,Te.style,J),de&8){const Ve=A.dynamicProps;for(let $e=0;$e<Ve.length;$e++){const Qe=Ve[$e],zt=be[Qe],Lt=Te[Qe];(Lt!==zt||Qe==="value")&&i(ce,Qe,zt,Lt,J,L)}}de&1&&E.children!==A.children&&d(ce,A.children)}else!me&&ie==null&&V(ce,be,Te,L,J);((Re=Te.onVnodeUpdated)||Ee)&&Hn(()=>{Re&&zr(Re,L,A,E),Ee&&Qi(A,E,L,"updated")},ee)},C=(E,A,L,ee,J,te,me)=>{for(let ce=0;ce<A.length;ce++){const de=E[ce],ie=A[ce],Ee=de.el&&(de.type===gt||!El(de,ie)||de.shapeFlag&198)?f(de.el):L;P(de,ie,Ee,null,ee,J,te,me,!0)}},V=(E,A,L,ee,J)=>{if(A!==L){if(A!==wt)for(const te in A)!jl(te)&&!(te in L)&&i(E,te,A[te],null,J,ee);for(const te in L){if(jl(te))continue;const me=L[te],ce=A[te];me!==ce&&te!=="value"&&i(E,te,ce,me,J,ee)}"value"in L&&i(E,"value",A.value,L.value,J)}},B=(E,A,L,ee,J,te,me,ce,de)=>{const ie=A.el=E?E.el:a(""),Ee=A.anchor=E?E.anchor:a("");let{patchFlag:be,dynamicChildren:Te,slotScopeIds:Re}=A;Re&&(ce=ce?ce.concat(Re):Re),E==null?(r(ie,L,ee),r(Ee,L,ee),w(A.children||[],L,Ee,J,te,me,ce,de)):be>0&&be&64&&Te&&E.dynamicChildren?(C(E.dynamicChildren,Te,L,J,te,me,ce),(A.key!=null||J&&A===J.subTree)&&Np(E,A,!0)):Le(E,A,L,Ee,J,te,me,ce,de)},R=(E,A,L,ee,J,te,me,ce,de)=>{A.slotScopeIds=ce,E==null?A.shapeFlag&512?J.ctx.activate(A,L,ee,me,de):Rt(A,L,ee,J,te,me,de):Et(E,A,de)},Rt=(E,A,L,ee,J,te,me)=>{const ce=E.component=Tx(E,ee,J);if(Q_(E)&&(ce.ctx.renderer=X),xx(ce,!1,me),ce.asyncDep){if(J&&J.registerDep(ce,Ye,me),!E.el){const de=ce.subTree=at(_i);j(null,de,A,L)}}else Ye(ce,E,A,L,J,te,me)},Et=(E,A,L)=>{const ee=A.component=E.component;if(mx(E,A,L))if(ee.asyncDep&&!ee.asyncResolved){Me(ee,A,L);return}else ee.next=A,ee.update();else A.el=E.el,ee.vnode=A},Ye=(E,A,L,ee,J,te,me)=>{const ce=()=>{if(E.isMounted){let{next:be,bu:Te,u:Re,parent:Ve,vnode:$e}=E;{const kt=l0(E);if(kt){be&&(be.el=$e.el,Me(E,be,me)),kt.asyncDep.then(()=>{E.isUnmounted||ce()});return}}let Qe=be,zt;Ji(E,!1),be?(be.el=$e.el,Me(E,be,me)):be=$e,Te&&Lc(Te),(zt=be.props&&be.props.onVnodeBeforeUpdate)&&zr(zt,Ve,be,$e),Ji(E,!0);const Lt=Yh(E),gn=E.subTree;E.subTree=Lt,P(gn,Lt,f(gn.el),k(gn),E,J,te),be.el=Lt.el,Qe===null&&gx(E,Lt.el),Re&&Hn(Re,J),(zt=be.props&&be.props.onVnodeUpdated)&&Hn(()=>zr(zt,Ve,be,$e),J)}else{let be;const{el:Te,props:Re}=A,{bm:Ve,m:$e,parent:Qe,root:zt,type:Lt}=E,gn=Kl(A);if(Ji(E,!1),Ve&&Lc(Ve),!gn&&(be=Re&&Re.onVnodeBeforeMount)&&zr(be,Qe,A),Ji(E,!0),Te&&Ne){const kt=()=>{E.subTree=Yh(E),Ne(Te,E.subTree,E,J,null)};gn&&Lt.__asyncHydrate?Lt.__asyncHydrate(Te,E,kt):kt()}else{zt.ce&&zt.ce._def.shadowRoot!==!1&&zt.ce._injectChildStyle(Lt);const kt=E.subTree=Yh(E);P(null,kt,L,ee,E,J,te),A.el=kt.el}if($e&&Hn($e,J),!gn&&(be=Re&&Re.onVnodeMounted)){const kt=A;Hn(()=>zr(be,Qe,kt),J)}(A.shapeFlag&256||Qe&&Kl(Qe.vnode)&&Qe.vnode.shapeFlag&256)&&E.a&&Hn(E.a,J),E.isMounted=!0,A=L=ee=null}};E.scope.on();const de=E.effect=new w_(ce);E.scope.off();const ie=E.update=de.run.bind(de),Ee=E.job=de.runIfDirty.bind(de);Ee.i=E,Ee.id=E.uid,de.scheduler=()=>Rp(Ee),Ji(E,!0),ie()},Me=(E,A,L)=>{A.component=E;const ee=E.vnode.props;E.vnode=A,E.next=null,ZT(E,A.props,ee,L),rx(E,A.children,L),Ts(),xg(E),xs()},Le=(E,A,L,ee,J,te,me,ce,de=!1)=>{const ie=E&&E.children,Ee=E?E.shapeFlag:0,be=A.children,{patchFlag:Te,shapeFlag:Re}=A;if(Te>0){if(Te&128){en(ie,be,L,ee,J,te,me,ce,de);return}else if(Te&256){ln(ie,be,L,ee,J,te,me,ce,de);return}}Re&8?(Ee&16&&ut(ie,J,te),be!==ie&&d(L,be)):Ee&16?Re&16?en(ie,be,L,ee,J,te,me,ce,de):ut(ie,J,te,!0):(Ee&8&&d(L,""),Re&16&&w(be,L,ee,J,te,me,ce,de))},ln=(E,A,L,ee,J,te,me,ce,de)=>{E=E||aa,A=A||aa;const ie=E.length,Ee=A.length,be=Math.min(ie,Ee);let Te;for(Te=0;Te<be;Te++){const Re=A[Te]=de?ti(A[Te]):Kr(A[Te]);P(E[Te],Re,L,null,J,te,me,ce,de)}ie>Ee?ut(E,J,te,!0,!1,be):w(A,L,ee,J,te,me,ce,de,be)},en=(E,A,L,ee,J,te,me,ce,de)=>{let ie=0;const Ee=A.length;let be=E.length-1,Te=Ee-1;for(;ie<=be&&ie<=Te;){const Re=E[ie],Ve=A[ie]=de?ti(A[ie]):Kr(A[ie]);if(El(Re,Ve))P(Re,Ve,L,null,J,te,me,ce,de);else break;ie++}for(;ie<=be&&ie<=Te;){const Re=E[be],Ve=A[Te]=de?ti(A[Te]):Kr(A[Te]);if(El(Re,Ve))P(Re,Ve,L,null,J,te,me,ce,de);else break;be--,Te--}if(ie>be){if(ie<=Te){const Re=Te+1,Ve=Re<Ee?A[Re].el:ee;for(;ie<=Te;)P(null,A[ie]=de?ti(A[ie]):Kr(A[ie]),L,Ve,J,te,me,ce,de),ie++}}else if(ie>Te)for(;ie<=be;)fe(E[ie],J,te,!0),ie++;else{const Re=ie,Ve=ie,$e=new Map;for(ie=Ve;ie<=Te;ie++){const tn=A[ie]=de?ti(A[ie]):Kr(A[ie]);tn.key!=null&&$e.set(tn.key,ie)}let Qe,zt=0;const Lt=Te-Ve+1;let gn=!1,kt=0;const fr=new Array(Lt);for(ie=0;ie<Lt;ie++)fr[ie]=0;for(ie=Re;ie<=be;ie++){const tn=E[ie];if(zt>=Lt){fe(tn,J,te,!0);continue}let Pn;if(tn.key!=null)Pn=$e.get(tn.key);else for(Qe=Ve;Qe<=Te;Qe++)if(fr[Qe-Ve]===0&&El(tn,A[Qe])){Pn=Qe;break}Pn===void 0?fe(tn,J,te,!0):(fr[Pn-Ve]=ie+1,Pn>=kt?kt=Pn:gn=!0,P(tn,A[Pn],L,null,J,te,me,ce,de),zt++)}const Lr=gn?ax(fr):aa;for(Qe=Lr.length-1,ie=Lt-1;ie>=0;ie--){const tn=Ve+ie,Pn=A[tn],Oi=tn+1<Ee?A[tn+1].el:ee;fr[ie]===0?P(null,Pn,L,Oi,J,te,me,ce,de):gn&&(Qe<0||ie!==Lr[Qe]?Ct(Pn,L,Oi,2):Qe--)}}},Ct=(E,A,L,ee,J=null)=>{const{el:te,type:me,transition:ce,children:de,shapeFlag:ie}=E;if(ie&6){Ct(E.component.subTree,A,L,ee);return}if(ie&128){E.suspense.move(A,L,ee);return}if(ie&64){me.move(E,A,L,X);return}if(me===gt){r(te,A,L);for(let be=0;be<de.length;be++)Ct(de[be],A,L,ee);r(E.anchor,A,L);return}if(me===Uc){D(E,A,L);return}if(ee!==2&&ie&1&&ce)if(ee===0)ce.beforeEnter(te),r(te,A,L),Hn(()=>ce.enter(te),J);else{const{leave:be,delayLeave:Te,afterLeave:Re}=ce,Ve=()=>{E.ctx.isUnmounted?s(te):r(te,A,L)},$e=()=>{be(te,()=>{Ve(),Re&&Re()})};Te?Te(te,Ve,$e):$e()}else r(te,A,L)},fe=(E,A,L,ee=!1,J=!1)=>{const{type:te,props:me,ref:ce,children:de,dynamicChildren:ie,shapeFlag:Ee,patchFlag:be,dirs:Te,cacheIndex:Re}=E;if(be===-2&&(J=!1),ce!=null&&(Ts(),Gl(ce,null,L,E,!0),xs()),Re!=null&&(A.renderCache[Re]=void 0),Ee&256){A.ctx.deactivate(E);return}const Ve=Ee&1&&Te,$e=!Kl(E);let Qe;if($e&&(Qe=me&&me.onVnodeBeforeUnmount)&&zr(Qe,A,E),Ee&6)tt(E.component,L,ee);else{if(Ee&128){E.suspense.unmount(L,ee);return}Ve&&Qi(E,null,A,"beforeUnmount"),Ee&64?E.type.remove(E,A,L,X,ee):ie&&!ie.hasOnce&&(te!==gt||be>0&&be&64)?ut(ie,A,L,!1,!0):(te===gt&&be&384||!J&&Ee&16)&&ut(de,A,L),ee&&se(E)}($e&&(Qe=me&&me.onVnodeUnmounted)||Ve)&&Hn(()=>{Qe&&zr(Qe,A,E),Ve&&Qi(E,null,A,"unmounted")},L)},se=E=>{const{type:A,el:L,anchor:ee,transition:J}=E;if(A===gt){qe(L,ee);return}if(A===Uc){G(E);return}const te=()=>{s(L),J&&!J.persisted&&J.afterLeave&&J.afterLeave()};if(E.shapeFlag&1&&J&&!J.persisted){const{leave:me,delayLeave:ce}=J,de=()=>me(L,te);ce?ce(E.el,te,de):de()}else te()},qe=(E,A)=>{let L;for(;E!==A;)L=g(E),s(E),E=L;s(A)},tt=(E,A,L)=>{const{bum:ee,scope:J,job:te,subTree:me,um:ce,m:de,a:ie,parent:Ee,slots:{__:be}}=E;Og(de),Og(ie),ee&&Lc(ee),Ee&&Oe(be)&&be.forEach(Te=>{Ee.renderCache[Te]=void 0}),J.stop(),te&&(te.flags|=8,fe(me,E,A,L)),ce&&Hn(ce,A),Hn(()=>{E.isUnmounted=!0},A),A&&A.pendingBranch&&!A.isUnmounted&&E.asyncDep&&!E.asyncResolved&&E.suspenseId===A.pendingId&&(A.deps--,A.deps===0&&A.resolve())},ut=(E,A,L,ee=!1,J=!1,te=0)=>{for(let me=te;me<E.length;me++)fe(E[me],A,L,ee,J)},k=E=>{if(E.shapeFlag&6)return k(E.component.subTree);if(E.shapeFlag&128)return E.suspense.next();const A=g(E.anchor||E.el),L=A&&A[z_];return L?g(L):A};let M=!1;const Q=(E,A,L)=>{E==null?A._vnode&&fe(A._vnode,null,null,!0):P(A._vnode||null,E,A,null,null,null,L),A._vnode=E,M||(M=!0,xg(),j_(),M=!1)},X={p:P,um:fe,m:Ct,r:se,mt:Rt,mc:w,pc:Le,pbc:C,n:k,o:n};let Pe,Ne;return e&&([Pe,Ne]=e(X)),{render:Q,hydrate:Pe,createApp:YT(Q,Pe)}}function Jh({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Ji({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function ox(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function Np(n,e,t=!1){const r=n.children,s=e.children;if(Oe(r)&&Oe(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=ti(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&Np(o,a)),a.type===Hd&&(a.el=o.el),a.type===_i&&!a.el&&(a.el=o.el)}}function ax(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function l0(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:l0(e)}function Og(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const lx=Symbol.for("v-scx"),ux=()=>Or(lx);function Vt(n,e,t){return u0(n,e,t)}function u0(n,e,t=wt){const{immediate:r,deep:s,flush:i,once:o}=t,a=In({},t),l=e&&r||!e&&i!=="post";let c;if(lu){if(i==="sync"){const y=ux();c=y.__watcherHandles||(y.__watcherHandles=[])}else if(!l){const y=()=>{};return y.stop=Vr,y.resume=Vr,y.pause=Vr,y}}const d=Fn;a.call=(y,x,P)=>es(y,d,x,P);let f=!1;i==="post"?a.scheduler=y=>{Hn(y,d&&d.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(y,x)=>{x?y():Rp(y)}),a.augmentJob=y=>{e&&(y.flags|=4),f&&(y.flags|=2,d&&(y.id=d.uid,y.i=d))};const g=IT(n,e,a);return lu&&(c?c.push(g):l&&g()),g}function cx(n,e,t){const r=this.proxy,s=Zt(n)?n.includes(".")?c0(r,n):()=>r[n]:n.bind(r,r);let i;ze(e)?i=e:(i=e.handler,t=e);const o=Du(this),a=u0(s,i.bind(r),t);return o(),a}function c0(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const dx=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Er(e)}Modifiers`]||n[`${Ri(e)}Modifiers`];function hx(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||wt;let s=t;const i=e.startsWith("update:"),o=i&&dx(r,e.slice(7));o&&(o.trim&&(s=t.map(d=>Zt(d)?d.trim():d)),o.number&&(s=t.map(Ef)));let a,l=r[a=zh(e)]||r[a=zh(Er(e))];!l&&i&&(l=r[a=zh(Ri(e))]),l&&es(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,es(c,n,6,s)}}function d0(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!ze(n)){const l=c=>{const d=d0(c,e,!0);d&&(a=!0,In(o,d))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(St(n)&&r.set(n,null),null):(Oe(i)?i.forEach(l=>o[l]=null):In(o,i),St(n)&&r.set(n,o),o)}function Kd(n,e){return!n||!Md(e)?!1:(e=e.slice(2).replace(/Once$/,""),ft(n,e[0].toLowerCase()+e.slice(1))||ft(n,Ri(e))||ft(n,e))}function Yh(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:d,props:f,data:g,setupState:y,ctx:x,inheritAttrs:P}=n,S=ad(n);let j,$;try{if(t.shapeFlag&4){const G=s||r,Z=G;j=Kr(c.call(Z,G,d,f,y,g,x)),$=a}else{const G=e;j=Kr(G.length>1?G(f,{attrs:a,slots:o,emit:l}):G(f,null)),$=e.props?a:fx(a)}}catch(G){Wl.length=0,zd(G,n,1),j=at(_i)}let D=j;if($&&P!==!1){const G=Object.keys($),{shapeFlag:Z}=D;G.length&&Z&7&&(i&&G.some(_p)&&($=px($,i)),D=_a(D,$,!1,!0))}return t.dirs&&(D=_a(D,null,!1,!0),D.dirs=D.dirs?D.dirs.concat(t.dirs):t.dirs),t.transition&&Cp(D,t.transition),j=D,ad(S),j}const fx=n=>{let e;for(const t in n)(t==="class"||t==="style"||Md(t))&&((e||(e={}))[t]=n[t]);return e},px=(n,e)=>{const t={};for(const r in n)(!_p(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function mx(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?Mg(r,o,c):!!o;if(l&8){const d=e.dynamicProps;for(let f=0;f<d.length;f++){const g=d[f];if(o[g]!==r[g]&&!Kd(c,g))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Mg(r,o,c):!0:!!o;return!1}function Mg(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!Kd(t,i))return!0}return!1}function gx({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const h0=n=>n.__isSuspense;function vx(n,e){e&&e.pendingBranch?Oe(n)?e.effects.push(...n):e.effects.push(n):xT(n)}const gt=Symbol.for("v-fgt"),Hd=Symbol.for("v-txt"),_i=Symbol.for("v-cmt"),Uc=Symbol.for("v-stc"),Wl=[];let dr=null;function F(n=!1){Wl.push(dr=n?null:[])}function yx(){Wl.pop(),dr=Wl[Wl.length-1]||null}let ou=1;function Lg(n,e=!1){ou+=n,n<0&&dr&&e&&(dr.hasOnce=!0)}function f0(n){return n.dynamicChildren=ou>0?dr||aa:null,yx(),ou>0&&dr&&dr.push(n),n}function U(n,e,t,r,s,i){return f0(h(n,e,t,r,s,i,!0))}function au(n,e,t,r,s){return f0(at(n,e,t,r,s,!0))}function ud(n){return n?n.__v_isVNode===!0:!1}function El(n,e){return n.type===e.type&&n.key===e.key}const p0=({key:n})=>n??null,jc=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?Zt(n)||$n(n)||ze(n)?{i:cr,r:n,k:e,f:!!t}:n:null);function h(n,e=null,t=null,r=0,s=null,i=n===gt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&p0(e),ref:e&&jc(e),scopeId:q_,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:cr};return a?(Op(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=Zt(t)?8:16),ou>0&&!o&&dr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&dr.push(l),l}const at=_x;function _x(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===BT)&&(n=_i),ud(n)){const a=_a(n,e,!0);return t&&Op(a,t),ou>0&&!i&&dr&&(a.shapeFlag&6?dr[dr.indexOf(n)]=a:dr.push(a)),a.patchFlag=-2,a}if(Cx(n)&&(n=n.__vccOpts),e){e=bx(e);let{class:a,style:l}=e;a&&!Zt(a)&&(e.class=hn(a)),St(l)&&(Pp(l)&&!Oe(l)&&(l=In({},l)),e.style=ms(l))}const o=Zt(n)?1:h0(n)?128:ST(n)?64:St(n)?4:ze(n)?2:0;return h(n,e,t,r,s,o,i,!0)}function bx(n){return n?Pp(n)||n0(n)?In({},n):n:null}function _a(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?wx(s||{},e):s,d={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&p0(c),ref:e&&e.ref?t&&i?Oe(i)?i.concat(jc(e)):[i,jc(e)]:jc(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==gt?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&_a(n.ssContent),ssFallback:n.ssFallback&&_a(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&Cp(d,l.clone(d)),d}function Ln(n=" ",e=0){return at(Hd,null,n,e)}function lr(n,e){const t=at(Uc,null,n);return t.staticCount=e,t}function he(n="",e=!1){return e?(F(),au(_i,null,n)):at(_i,null,n)}function Kr(n){return n==null||typeof n=="boolean"?at(_i):Oe(n)?at(gt,null,n.slice()):ud(n)?ti(n):at(Hd,null,String(n))}function ti(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:_a(n)}function Op(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(Oe(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),Op(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!n0(e)?e._ctx=cr:s===3&&cr&&(cr.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else ze(e)?(e={default:e,_ctx:cr},t=32):(e=String(e),r&64?(t=16,e=[Ln(e)]):t=8);n.children=e,n.shapeFlag|=t}function wx(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=hn([e.class,r.class]));else if(s==="style")e.style=ms([e.style,r.style]);else if(Md(s)){const i=e[s],o=r[s];o&&i!==o&&!(Oe(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function zr(n,e,t,r=null){es(n,e,7,[t,r])}const Ix=Z_();let Ex=0;function Tx(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||Ix,i={uid:Ex++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new QE(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:s0(r,s),emitsOptions:d0(r,s),emit:null,emitted:null,propsDefaults:wt,inheritAttrs:r.inheritAttrs,ctx:wt,data:wt,props:wt,attrs:wt,slots:wt,refs:wt,setupState:wt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=hx.bind(null,i),n.ce&&n.ce(i),i}let Fn=null,cd,Vf;{const n=Ud(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};cd=e("__VUE_INSTANCE_SETTERS__",t=>Fn=t),Vf=e("__VUE_SSR_SETTERS__",t=>lu=t)}const Du=n=>{const e=Fn;return cd(n),n.scope.on(),()=>{n.scope.off(),cd(e)}},Fg=()=>{Fn&&Fn.scope.off(),cd(null)};function m0(n){return n.vnode.shapeFlag&4}let lu=!1;function xx(n,e=!1,t=!1){e&&Vf(e);const{props:r,children:s}=n.vnode,i=m0(n);XT(n,r,i,e),nx(n,s,t||e);const o=i?Ax(n,e):void 0;return e&&Vf(!1),o}function Ax(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,zT);const{setup:r}=t;if(r){Ts();const s=n.setupContext=r.length>1?Px(n):null,i=Du(n),o=ku(r,n,0,[n.props,s]),a=p_(o);if(xs(),i(),(a||n.sp)&&!Kl(n)&&W_(n),a){if(o.then(Fg,Fg),e)return o.then(l=>{$g(n,l,e)}).catch(l=>{zd(l,n,0)});n.asyncDep=o}else $g(n,o,e)}else g0(n,e)}function $g(n,e,t){ze(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:St(e)&&(n.setupState=F_(e)),g0(n,t)}let Ug;function g0(n,e,t){const r=n.type;if(!n.render){if(!e&&Ug&&!r.render){const s=r.template||kp(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=In(In({isCustomElement:i,delimiters:a},o),l);r.render=Ug(s,c)}}n.render=r.render||Vr}{const s=Du(n);Ts();try{GT(n)}finally{xs(),s()}}}const Sx={get(n,e){return Mn(n,"get",""),n[e]}};function Px(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,Sx),slots:n.slots,emit:n.emit,expose:e}}function Wd(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(F_(mT(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in Hl)return Hl[t](n)},has(e,t){return t in e||t in Hl}})):n.proxy}function Rx(n,e=!0){return ze(n)?n.displayName||n.name:n.name||e&&n.__name}function Cx(n){return ze(n)&&"__vccOpts"in n}const Be=(n,e)=>bT(n,e,lu);function v0(n,e,t){const r=arguments.length;return r===2?St(e)&&!Oe(e)?ud(e)?at(n,null,[e]):at(n,e):at(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&ud(t)&&(t=[t]),at(n,e,t))}const kx="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Nf;const jg=typeof window<"u"&&window.trustedTypes;if(jg)try{Nf=jg.createPolicy("vue",{createHTML:n=>n})}catch{}const y0=Nf?n=>Nf.createHTML(n):n=>n,Dx="http://www.w3.org/2000/svg",Vx="http://www.w3.org/1998/Math/MathML",ps=typeof document<"u"?document:null,Bg=ps&&ps.createElement("template"),Nx={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?ps.createElementNS(Dx,n):e==="mathml"?ps.createElementNS(Vx,n):t?ps.createElement(n,{is:t}):ps.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>ps.createTextNode(n),createComment:n=>ps.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>ps.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{Bg.innerHTML=y0(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=Bg.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Ox=Symbol("_vtc");function Mx(n,e,t){const r=n[Ox];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const dd=Symbol("_vod"),_0=Symbol("_vsh"),Xh={beforeMount(n,{value:e},{transition:t}){n[dd]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):Tl(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),Tl(n,!0),r.enter(n)):r.leave(n,()=>{Tl(n,!1)}):Tl(n,e))},beforeUnmount(n,{value:e}){Tl(n,e)}};function Tl(n,e){n.style.display=e?n[dd]:"none",n[_0]=!e}const Lx=Symbol(""),Fx=/(^|;)\s*display\s*:/;function $x(n,e,t){const r=n.style,s=Zt(t);let i=!1;if(t&&!s){if(e)if(Zt(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&Bc(r,a,"")}else for(const o in e)t[o]==null&&Bc(r,o,"");for(const o in t)o==="display"&&(i=!0),Bc(r,o,t[o])}else if(s){if(e!==t){const o=r[Lx];o&&(t+=";"+o),r.cssText=t,i=Fx.test(t)}}else e&&n.removeAttribute("style");dd in n&&(n[dd]=i?r.display:"",n[_0]&&(r.display="none"))}const qg=/\s*!important$/;function Bc(n,e,t){if(Oe(t))t.forEach(r=>Bc(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=Ux(n,e);qg.test(t)?n.setProperty(Ri(r),t.replace(qg,""),"important"):n[r]=t}}const zg=["Webkit","Moz","ms"],Zh={};function Ux(n,e){const t=Zh[e];if(t)return t;let r=Er(e);if(r!=="filter"&&r in n)return Zh[e]=r;r=$d(r);for(let s=0;s<zg.length;s++){const i=zg[s]+r;if(i in n)return Zh[e]=i}return e}const Gg="http://www.w3.org/1999/xlink";function Kg(n,e,t,r,s,i=HE(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(Gg,e.slice(6,e.length)):n.setAttributeNS(Gg,e,t):t==null||i&&!v_(t)?n.removeAttribute(e):n.setAttribute(e,i?"":Zr(t)?String(t):t)}function Hg(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?y0(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=v_(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function ro(n,e,t,r){n.addEventListener(e,t,r)}function jx(n,e,t,r){n.removeEventListener(e,t,r)}const Wg=Symbol("_vei");function Bx(n,e,t,r,s=null){const i=n[Wg]||(n[Wg]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=qx(e);if(r){const c=i[e]=Kx(r,s);ro(n,a,c,l)}else o&&(jx(n,a,o,l),i[e]=void 0)}}const Qg=/(?:Once|Passive|Capture)$/;function qx(n){let e;if(Qg.test(n)){e={};let r;for(;r=n.match(Qg);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Ri(n.slice(2)),e]}let ef=0;const zx=Promise.resolve(),Gx=()=>ef||(zx.then(()=>ef=0),ef=Date.now());function Kx(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;es(Hx(r,t.value),e,5,[r])};return t.value=n,t.attached=Gx(),t}function Hx(n,e){if(Oe(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const Jg=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,Wx=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?Mx(n,r,o):e==="style"?$x(n,t,r):Md(e)?_p(e)||Bx(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Qx(n,e,r,o))?(Hg(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Kg(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!Zt(r))?Hg(n,Er(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),Kg(n,e,r,o))};function Qx(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&Jg(e)&&ze(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Jg(e)&&Zt(t)?!1:e in n}const hd=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Oe(e)?t=>Lc(e,t):e};function Jx(n){n.target.composing=!0}function Yg(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const ha=Symbol("_assign"),At={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[ha]=hd(s);const i=r||s.props&&s.props.type==="number";ro(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=Ef(a)),n[ha](a)}),t&&ro(n,"change",()=>{n.value=n.value.trim()}),e||(ro(n,"compositionstart",Jx),ro(n,"compositionend",Yg),ro(n,"change",Yg))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[ha]=hd(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?Ef(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},ba={deep:!0,created(n,e,t){n[ha]=hd(t),ro(n,"change",()=>{const r=n._modelValue,s=Yx(n),i=n.checked,o=n[ha];if(Oe(r)){const a=y_(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(Ld(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(b0(n,i))})},mounted:Xg,beforeUpdate(n,e,t){n[ha]=hd(t),Xg(n,e,t)}};function Xg(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(Oe(e))s=y_(e,r.props.value)>-1;else if(Ld(e))s=e.has(r.props.value);else{if(e===t)return;s=jd(e,b0(n,!0))}n.checked!==s&&(n.checked=s)}function Yx(n){return"_value"in n?n._value:n.value}function b0(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const Xx=["ctrl","shift","alt","meta"],Zx={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>Xx.some(t=>n[`${t}Key`]&&!e.includes(t))},Dt=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=Zx[e[o]];if(a&&a(s,e))return}return n(s,...i)})},eA={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Nn=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=Ri(s.key);if(e.some(o=>o===i||eA[o]===i))return n(s)})},tA=In({patchProp:Wx},Nx);let Zg;function nA(){return Zg||(Zg=sx(tA))}const rA=(...n)=>{const e=nA().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=iA(r);if(!s)return;const i=e._component;!ze(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,sA(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function sA(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function iA(n){return Zt(n)?document.querySelector(n):n}const oA={__name:"App",setup(n){return(e,t)=>{const r=jT("router-view");return F(),au(r)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const ta=typeof document<"u";function w0(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function aA(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&w0(n.default)}const dt=Object.assign;function tf(n,e){const t={};for(const r in e){const s=e[r];t[r]=Mr(s)?s.map(n):n(s)}return t}const Ql=()=>{},Mr=Array.isArray,I0=/#/g,lA=/&/g,uA=/\//g,cA=/=/g,dA=/\?/g,E0=/\+/g,hA=/%5B/g,fA=/%5D/g,T0=/%5E/g,pA=/%60/g,x0=/%7B/g,mA=/%7C/g,A0=/%7D/g,gA=/%20/g;function Mp(n){return encodeURI(""+n).replace(mA,"|").replace(hA,"[").replace(fA,"]")}function vA(n){return Mp(n).replace(x0,"{").replace(A0,"}").replace(T0,"^")}function Of(n){return Mp(n).replace(E0,"%2B").replace(gA,"+").replace(I0,"%23").replace(lA,"%26").replace(pA,"`").replace(x0,"{").replace(A0,"}").replace(T0,"^")}function yA(n){return Of(n).replace(cA,"%3D")}function _A(n){return Mp(n).replace(I0,"%23").replace(dA,"%3F")}function bA(n){return n==null?"":_A(n).replace(uA,"%2F")}function uu(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const wA=/\/$/,IA=n=>n.replace(wA,"");function nf(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=AA(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:uu(o)}}function EA(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function ev(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function TA(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&wa(e.matched[r],t.matched[s])&&S0(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function wa(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function S0(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!xA(n[t],e[t]))return!1;return!0}function xA(n,e){return Mr(n)?tv(n,e):Mr(e)?tv(e,n):n===e}function tv(n,e){return Mr(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function AA(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const Js={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var cu;(function(n){n.pop="pop",n.push="push"})(cu||(cu={}));var Jl;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Jl||(Jl={}));function SA(n){if(!n)if(ta){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),IA(n)}const PA=/^[^#]+#/;function RA(n,e){return n.replace(PA,"#")+e}function CA(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const Qd=()=>({left:window.scrollX,top:window.scrollY});function kA(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=CA(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function nv(n,e){return(history.state?history.state.position-e:-1)+n}const Mf=new Map;function DA(n,e){Mf.set(n,e)}function VA(n){const e=Mf.get(n);return Mf.delete(n),e}let NA=()=>location.protocol+"//"+location.host;function P0(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),ev(l,"")}return ev(t,n)+r+s}function OA(n,e,t,r){let s=[],i=[],o=null;const a=({state:g})=>{const y=P0(n,location),x=t.value,P=e.value;let S=0;if(g){if(t.value=y,e.value=g,o&&o===x){o=null;return}S=P?g.position-P.position:0}else r(y);s.forEach(j=>{j(t.value,x,{delta:S,type:cu.pop,direction:S?S>0?Jl.forward:Jl.back:Jl.unknown})})};function l(){o=t.value}function c(g){s.push(g);const y=()=>{const x=s.indexOf(g);x>-1&&s.splice(x,1)};return i.push(y),y}function d(){const{history:g}=window;g.state&&g.replaceState(dt({},g.state,{scroll:Qd()}),"")}function f(){for(const g of i)g();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",d)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",d,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function rv(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?Qd():null}}function MA(n){const{history:e,location:t}=window,r={value:P0(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,d){const f=n.indexOf("#"),g=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:NA()+n+l;try{e[d?"replaceState":"pushState"](c,"",g),s.value=c}catch(y){console.error(y),t[d?"replace":"assign"](g)}}function o(l,c){const d=dt({},e.state,rv(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,d,!0),r.value=l}function a(l,c){const d=dt({},s.value,e.state,{forward:l,scroll:Qd()});i(d.current,d,!0);const f=dt({},rv(r.value,l,null),{position:d.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function LA(n){n=SA(n);const e=MA(n),t=OA(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=dt({location:"",base:n,go:r,createHref:RA.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function FA(n){return typeof n=="string"||n&&typeof n=="object"}function R0(n){return typeof n=="string"||typeof n=="symbol"}const C0=Symbol("");var sv;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(sv||(sv={}));function Ia(n,e){return dt(new Error,{type:n,[C0]:!0},e)}function fs(n,e){return n instanceof Error&&C0 in n&&(e==null||!!(n.type&e))}const iv="[^/]+?",$A={sensitive:!1,strict:!1,start:!0,end:!0},UA=/[.+*?^${}()[\]/\\]/g;function jA(n,e){const t=dt({},$A,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const d=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const g=c[f];let y=40+(t.sensitive?.25:0);if(g.type===0)f||(s+="/"),s+=g.value.replace(UA,"\\$&"),y+=40;else if(g.type===1){const{value:x,repeatable:P,optional:S,regexp:j}=g;i.push({name:x,repeatable:P,optional:S});const $=j||iv;if($!==iv){y+=10;try{new RegExp(`(${$})`)}catch(G){throw new Error(`Invalid custom RegExp for param "${x}" (${$}): `+G.message)}}let D=P?`((?:${$})(?:/(?:${$}))*)`:`(${$})`;f||(D=S&&c.length<2?`(?:/${D})`:"/"+D),S&&(D+="?"),s+=D,y+=20,S&&(y+=-8),P&&(y+=-20),$===".*"&&(y+=-50)}d.push(y)}r.push(d)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const d=c.match(o),f={};if(!d)return null;for(let g=1;g<d.length;g++){const y=d[g]||"",x=i[g-1];f[x.name]=y&&x.repeatable?y.split("/"):y}return f}function l(c){let d="",f=!1;for(const g of n){(!f||!d.endsWith("/"))&&(d+="/"),f=!1;for(const y of g)if(y.type===0)d+=y.value;else if(y.type===1){const{value:x,repeatable:P,optional:S}=y,j=x in c?c[x]:"";if(Mr(j)&&!P)throw new Error(`Provided param "${x}" is an array but it is not repeatable (* or + modifiers)`);const $=Mr(j)?j.join("/"):j;if(!$)if(S)g.length<2&&(d.endsWith("/")?d=d.slice(0,-1):f=!0);else throw new Error(`Missing required param "${x}"`);d+=$}}return d||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function BA(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function k0(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=BA(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(ov(r))return 1;if(ov(s))return-1}return s.length-r.length}function ov(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const qA={type:0,value:""},zA=/[a-zA-Z0-9_]/;function GA(n){if(!n)return[[]];if(n==="/")return[[qA]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(y){throw new Error(`ERR (${t})/"${c}": ${y}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",d="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:d,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function g(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):g();break;case 4:g(),t=r;break;case 1:l==="("?t=2:zA.test(l)?g():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?d[d.length-1]=="\\"?d=d.slice(0,-1)+l:t=3:d+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,d="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function KA(n,e,t){const r=jA(GA(n.path),t),s=dt(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function HA(n,e){const t=[],r=new Map;e=cv({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,g,y){const x=!y,P=lv(f);P.aliasOf=y&&y.record;const S=cv(e,f),j=[P];if("alias"in f){const G=typeof f.alias=="string"?[f.alias]:f.alias;for(const Z of G)j.push(lv(dt({},P,{components:y?y.record.components:P.components,path:Z,aliasOf:y?y.record:P})))}let $,D;for(const G of j){const{path:Z}=G;if(g&&Z[0]!=="/"){const pe=g.record.path,T=pe[pe.length-1]==="/"?"":"/";G.path=g.record.path+(Z&&T+Z)}if($=KA(G,g,S),y?y.alias.push($):(D=D||$,D!==$&&D.alias.push($),x&&f.name&&!uv($)&&o(f.name)),D0($)&&l($),P.children){const pe=P.children;for(let T=0;T<pe.length;T++)i(pe[T],$,y&&y.children[T])}y=y||$}return D?()=>{o(D)}:Ql}function o(f){if(R0(f)){const g=r.get(f);g&&(r.delete(f),t.splice(t.indexOf(g),1),g.children.forEach(o),g.alias.forEach(o))}else{const g=t.indexOf(f);g>-1&&(t.splice(g,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const g=JA(f,t);t.splice(g,0,f),f.record.name&&!uv(f)&&r.set(f.record.name,f)}function c(f,g){let y,x={},P,S;if("name"in f&&f.name){if(y=r.get(f.name),!y)throw Ia(1,{location:f});S=y.record.name,x=dt(av(g.params,y.keys.filter(D=>!D.optional).concat(y.parent?y.parent.keys.filter(D=>D.optional):[]).map(D=>D.name)),f.params&&av(f.params,y.keys.map(D=>D.name))),P=y.stringify(x)}else if(f.path!=null)P=f.path,y=t.find(D=>D.re.test(P)),y&&(x=y.parse(P),S=y.record.name);else{if(y=g.name?r.get(g.name):t.find(D=>D.re.test(g.path)),!y)throw Ia(1,{location:f,currentLocation:g});S=y.record.name,x=dt({},g.params,f.params),P=y.stringify(x)}const j=[];let $=y;for(;$;)j.unshift($.record),$=$.parent;return{name:S,path:P,params:x,matched:j,meta:QA(j)}}n.forEach(f=>i(f));function d(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:d,getRoutes:a,getRecordMatcher:s}}function av(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function lv(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:WA(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function WA(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function uv(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function QA(n){return n.reduce((e,t)=>dt(e,t.meta),{})}function cv(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function JA(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;k0(n,e[i])<0?r=i:t=i+1}const s=YA(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function YA(n){let e=n;for(;e=e.parent;)if(D0(e)&&k0(n,e)===0)return e}function D0({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function XA(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(E0," "),o=i.indexOf("="),a=uu(o<0?i:i.slice(0,o)),l=o<0?null:uu(i.slice(o+1));if(a in e){let c=e[a];Mr(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function dv(n){let e="";for(let t in n){const r=n[t];if(t=yA(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(Mr(r)?r.map(i=>i&&Of(i)):[r&&Of(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function ZA(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=Mr(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const eS=Symbol(""),hv=Symbol(""),Jd=Symbol(""),Lp=Symbol(""),Lf=Symbol("");function xl(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function ni(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=g=>{g===!1?l(Ia(4,{from:t,to:e})):g instanceof Error?l(g):FA(g)?l(Ia(2,{from:e,to:g})):(o&&r.enterCallbacks[s]===o&&typeof g=="function"&&o.push(g),a())},d=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(d);n.length<3&&(f=f.then(c)),f.catch(g=>l(g))})}function rf(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(w0(l)){const d=(l.__vccOpts||l)[e];d&&i.push(ni(d,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(d=>{if(!d)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=aA(d)?d.default:d;o.mods[a]=d,o.components[a]=f;const y=(f.__vccOpts||f)[e];return y&&ni(y,t,r,o,a,s)()}))}}return i}function fv(n){const e=Or(Jd),t=Or(Lp),r=Be(()=>{const l=Is(n.to);return e.resolve(l)}),s=Be(()=>{const{matched:l}=r.value,{length:c}=l,d=l[c-1],f=t.matched;if(!d||!f.length)return-1;const g=f.findIndex(wa.bind(null,d));if(g>-1)return g;const y=pv(l[c-2]);return c>1&&pv(d)===y&&f[f.length-1].path!==y?f.findIndex(wa.bind(null,l[c-2])):g}),i=Be(()=>s.value>-1&&iS(t.params,r.value.params)),o=Be(()=>s.value>-1&&s.value===t.matched.length-1&&S0(t.params,r.value.params));function a(l={}){if(sS(l)){const c=e[Is(n.replace)?"replace":"push"](Is(n.to)).catch(Ql);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:Be(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function tS(n){return n.length===1?n[0]:n}const nS=H_({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:fv,setup(n,{slots:e}){const t=qd(fv(n)),{options:r}=Or(Jd),s=Be(()=>({[mv(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[mv(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&tS(e.default(t));return n.custom?i:v0("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),rS=nS;function sS(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function iS(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!Mr(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function pv(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const mv=(n,e,t)=>n??e??t,oS=H_({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=Or(Lf),s=Be(()=>n.route||r.value),i=Or(hv,0),o=Be(()=>{let c=Is(i);const{matched:d}=s.value;let f;for(;(f=d[c])&&!f.components;)c++;return c}),a=Be(()=>s.value.matched[o.value]);$c(hv,Be(()=>o.value+1)),$c(eS,a),$c(Lf,s);const l=O();return Vt(()=>[l.value,a.value,n.name],([c,d,f],[g,y,x])=>{d&&(d.instances[f]=c,y&&y!==d&&c&&c===g&&(d.leaveGuards.size||(d.leaveGuards=y.leaveGuards),d.updateGuards.size||(d.updateGuards=y.updateGuards))),c&&d&&(!y||!wa(d,y)||!g)&&(d.enterCallbacks[f]||[]).forEach(P=>P(c))},{flush:"post"}),()=>{const c=s.value,d=n.name,f=a.value,g=f&&f.components[d];if(!g)return gv(t.default,{Component:g,route:c});const y=f.props[d],x=y?y===!0?c.params:typeof y=="function"?y(c):y:null,S=v0(g,dt({},x,e,{onVnodeUnmounted:j=>{j.component.isUnmounted&&(f.instances[d]=null)},ref:l}));return gv(t.default,{Component:S,route:c})||S}}});function gv(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const aS=oS;function lS(n){const e=HA(n.routes,n),t=n.parseQuery||XA,r=n.stringifyQuery||dv,s=n.history,i=xl(),o=xl(),a=xl(),l=gT(Js);let c=Js;ta&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=tf.bind(null,k=>""+k),f=tf.bind(null,bA),g=tf.bind(null,uu);function y(k,M){let Q,X;return R0(k)?(Q=e.getRecordMatcher(k),X=M):X=k,e.addRoute(X,Q)}function x(k){const M=e.getRecordMatcher(k);M&&e.removeRoute(M)}function P(){return e.getRoutes().map(k=>k.record)}function S(k){return!!e.getRecordMatcher(k)}function j(k,M){if(M=dt({},M||l.value),typeof k=="string"){const A=nf(t,k,M.path),L=e.resolve({path:A.path},M),ee=s.createHref(A.fullPath);return dt(A,L,{params:g(L.params),hash:uu(A.hash),redirectedFrom:void 0,href:ee})}let Q;if(k.path!=null)Q=dt({},k,{path:nf(t,k.path,M.path).path});else{const A=dt({},k.params);for(const L in A)A[L]==null&&delete A[L];Q=dt({},k,{params:f(A)}),M.params=f(M.params)}const X=e.resolve(Q,M),Pe=k.hash||"";X.params=d(g(X.params));const Ne=EA(r,dt({},k,{hash:vA(Pe),path:X.path})),E=s.createHref(Ne);return dt({fullPath:Ne,hash:Pe,query:r===dv?ZA(k.query):k.query||{}},X,{redirectedFrom:void 0,href:E})}function $(k){return typeof k=="string"?nf(t,k,l.value.path):dt({},k)}function D(k,M){if(c!==k)return Ia(8,{from:M,to:k})}function G(k){return T(k)}function Z(k){return G(dt($(k),{replace:!0}))}function pe(k){const M=k.matched[k.matched.length-1];if(M&&M.redirect){const{redirect:Q}=M;let X=typeof Q=="function"?Q(k):Q;return typeof X=="string"&&(X=X.includes("?")||X.includes("#")?X=$(X):{path:X},X.params={}),dt({query:k.query,hash:k.hash,params:X.path!=null?{}:k.params},X)}}function T(k,M){const Q=c=j(k),X=l.value,Pe=k.state,Ne=k.force,E=k.replace===!0,A=pe(Q);if(A)return T(dt($(A),{state:typeof A=="object"?dt({},Pe,A.state):Pe,force:Ne,replace:E}),M||Q);const L=Q;L.redirectedFrom=M;let ee;return!Ne&&TA(r,X,Q)&&(ee=Ia(16,{to:L,from:X}),Ct(X,X,!0,!1)),(ee?Promise.resolve(ee):C(L,X)).catch(J=>fs(J)?fs(J,2)?J:en(J):Le(J,L,X)).then(J=>{if(J){if(fs(J,2))return T(dt({replace:E},$(J.to),{state:typeof J.to=="object"?dt({},Pe,J.to.state):Pe,force:Ne}),M||L)}else J=B(L,X,!0,E,Pe);return V(L,X,J),J})}function w(k,M){const Q=D(k,M);return Q?Promise.reject(Q):Promise.resolve()}function I(k){const M=qe.values().next().value;return M&&typeof M.runWithContext=="function"?M.runWithContext(k):k()}function C(k,M){let Q;const[X,Pe,Ne]=uS(k,M);Q=rf(X.reverse(),"beforeRouteLeave",k,M);for(const A of X)A.leaveGuards.forEach(L=>{Q.push(ni(L,k,M))});const E=w.bind(null,k,M);return Q.push(E),ut(Q).then(()=>{Q=[];for(const A of i.list())Q.push(ni(A,k,M));return Q.push(E),ut(Q)}).then(()=>{Q=rf(Pe,"beforeRouteUpdate",k,M);for(const A of Pe)A.updateGuards.forEach(L=>{Q.push(ni(L,k,M))});return Q.push(E),ut(Q)}).then(()=>{Q=[];for(const A of Ne)if(A.beforeEnter)if(Mr(A.beforeEnter))for(const L of A.beforeEnter)Q.push(ni(L,k,M));else Q.push(ni(A.beforeEnter,k,M));return Q.push(E),ut(Q)}).then(()=>(k.matched.forEach(A=>A.enterCallbacks={}),Q=rf(Ne,"beforeRouteEnter",k,M,I),Q.push(E),ut(Q))).then(()=>{Q=[];for(const A of o.list())Q.push(ni(A,k,M));return Q.push(E),ut(Q)}).catch(A=>fs(A,8)?A:Promise.reject(A))}function V(k,M,Q){a.list().forEach(X=>I(()=>X(k,M,Q)))}function B(k,M,Q,X,Pe){const Ne=D(k,M);if(Ne)return Ne;const E=M===Js,A=ta?history.state:{};Q&&(X||E?s.replace(k.fullPath,dt({scroll:E&&A&&A.scroll},Pe)):s.push(k.fullPath,Pe)),l.value=k,Ct(k,M,Q,E),en()}let R;function Rt(){R||(R=s.listen((k,M,Q)=>{if(!tt.listening)return;const X=j(k),Pe=pe(X);if(Pe){T(dt(Pe,{replace:!0,force:!0}),X).catch(Ql);return}c=X;const Ne=l.value;ta&&DA(nv(Ne.fullPath,Q.delta),Qd()),C(X,Ne).catch(E=>fs(E,12)?E:fs(E,2)?(T(dt($(E.to),{force:!0}),X).then(A=>{fs(A,20)&&!Q.delta&&Q.type===cu.pop&&s.go(-1,!1)}).catch(Ql),Promise.reject()):(Q.delta&&s.go(-Q.delta,!1),Le(E,X,Ne))).then(E=>{E=E||B(X,Ne,!1),E&&(Q.delta&&!fs(E,8)?s.go(-Q.delta,!1):Q.type===cu.pop&&fs(E,20)&&s.go(-1,!1)),V(X,Ne,E)}).catch(Ql)}))}let Et=xl(),Ye=xl(),Me;function Le(k,M,Q){en(k);const X=Ye.list();return X.length?X.forEach(Pe=>Pe(k,M,Q)):console.error(k),Promise.reject(k)}function ln(){return Me&&l.value!==Js?Promise.resolve():new Promise((k,M)=>{Et.add([k,M])})}function en(k){return Me||(Me=!k,Rt(),Et.list().forEach(([M,Q])=>k?Q(k):M()),Et.reset()),k}function Ct(k,M,Q,X){const{scrollBehavior:Pe}=n;if(!ta||!Pe)return Promise.resolve();const Ne=!Q&&VA(nv(k.fullPath,0))||(X||!Q)&&history.state&&history.state.scroll||null;return dn().then(()=>Pe(k,M,Ne)).then(E=>E&&kA(E)).catch(E=>Le(E,k,M))}const fe=k=>s.go(k);let se;const qe=new Set,tt={currentRoute:l,listening:!0,addRoute:y,removeRoute:x,clearRoutes:e.clearRoutes,hasRoute:S,getRoutes:P,resolve:j,options:n,push:G,replace:Z,go:fe,back:()=>fe(-1),forward:()=>fe(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:Ye.add,isReady:ln,install(k){const M=this;k.component("RouterLink",rS),k.component("RouterView",aS),k.config.globalProperties.$router=M,Object.defineProperty(k.config.globalProperties,"$route",{enumerable:!0,get:()=>Is(l)}),ta&&!se&&l.value===Js&&(se=!0,G(s.location).catch(Pe=>{}));const Q={};for(const Pe in Js)Object.defineProperty(Q,Pe,{get:()=>l.value[Pe],enumerable:!0});k.provide(Jd,M),k.provide(Lp,O_(Q)),k.provide(Lf,l);const X=k.unmount;qe.add(k),k.unmount=function(){qe.delete(k),qe.size<1&&(c=Js,R&&R(),R=null,l.value=Js,se=!1,Me=!1),X()}}};function ut(k){return k.reduce((M,Q)=>M.then(()=>I(Q)),Promise.resolve())}return tt}function uS(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>wa(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>wa(c,l))||s.push(l))}return[t,r,s]}function Vu(){return Or(Jd)}function ja(n){return Or(Lp)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V0=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},cS=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},N0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,d=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|c>>6,y=c&63;l||(y=64,o||(g=64)),r.push(t[d],t[f],t[g],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(V0(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):cS(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new dS;const g=i<<2|a>>4;if(r.push(g),c!==64){const y=a<<4&240|c>>2;if(r.push(y),f!==64){const x=c<<6&192|f;r.push(x)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class dS extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const hS=function(n){const e=V0(n);return N0.encodeByteArray(e,!0)},fd=function(n){return hS(n).replace(/\./g,"")},O0=function(n){try{return N0.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fS(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pS=()=>fS().__FIREBASE_DEFAULTS__,mS=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},gS=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&O0(n[1]);return e&&JSON.parse(e)},Yd=()=>{try{return pS()||mS()||gS()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},M0=n=>{var e,t;return(t=(e=Yd())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},vS=n=>{const e=M0(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},L0=()=>{var n;return(n=Yd())===null||n===void 0?void 0:n.config},F0=n=>{var e;return(e=Yd())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yS{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _S(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[fd(JSON.stringify(t)),fd(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function bS(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(pn())}function wS(){var n;const e=(n=Yd())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function IS(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function ES(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function TS(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function xS(){const n=pn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function $0(){return!wS()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function U0(){try{return typeof indexedDB=="object"}catch{return!1}}function AS(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SS="FirebaseError";class Vs extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=SS,Object.setPrototypeOf(this,Vs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Nu.prototype.create)}}class Nu{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?PS(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Vs(s,a,r)}}function PS(n,e){return n.replace(RS,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const RS=/\{\$([^}]+)}/g;function CS(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function bi(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(vv(i)&&vv(o)){if(!bi(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function vv(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ba(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Nl(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Ol(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function kS(n,e){const t=new DS(n,e);return t.subscribe.bind(t)}class DS{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");VS(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=sf),s.error===void 0&&(s.error=sf),s.complete===void 0&&(s.complete=sf);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function VS(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function sf(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function De(n){return n&&n._delegate?n._delegate:n}class go{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NS{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new yS;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(MS(e))try{this.getOrInitializeService({instanceIdentifier:Zi})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Zi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Zi){return this.instances.has(e)}getOptions(e=Zi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:OS(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Zi){return this.component?this.component.multipleInstances?e:Zi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function OS(n){return n===Zi?void 0:n}function MS(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LS{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new NS(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xe;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Xe||(Xe={}));const FS={debug:Xe.DEBUG,verbose:Xe.VERBOSE,info:Xe.INFO,warn:Xe.WARN,error:Xe.ERROR,silent:Xe.SILENT},$S=Xe.INFO,US={[Xe.DEBUG]:"log",[Xe.VERBOSE]:"log",[Xe.INFO]:"info",[Xe.WARN]:"warn",[Xe.ERROR]:"error"},jS=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=US[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Fp{constructor(e){this.name=e,this._logLevel=$S,this._logHandler=jS,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Xe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?FS[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Xe.DEBUG,...e),this._logHandler(this,Xe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Xe.VERBOSE,...e),this._logHandler(this,Xe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Xe.INFO,...e),this._logHandler(this,Xe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Xe.WARN,...e),this._logHandler(this,Xe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Xe.ERROR,...e),this._logHandler(this,Xe.ERROR,...e)}}const BS=(n,e)=>e.some(t=>n instanceof t);let yv,_v;function qS(){return yv||(yv=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function zS(){return _v||(_v=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const j0=new WeakMap,Ff=new WeakMap,B0=new WeakMap,of=new WeakMap,$p=new WeakMap;function GS(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(hi(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&j0.set(t,n)}).catch(()=>{}),$p.set(e,n),e}function KS(n){if(Ff.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});Ff.set(n,e)}let $f={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Ff.get(n);if(e==="objectStoreNames")return n.objectStoreNames||B0.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return hi(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function HS(n){$f=n($f)}function WS(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(af(this),e,...t);return B0.set(r,e.sort?e.sort():[e]),hi(r)}:zS().includes(n)?function(...e){return n.apply(af(this),e),hi(j0.get(this))}:function(...e){return hi(n.apply(af(this),e))}}function QS(n){return typeof n=="function"?WS(n):(n instanceof IDBTransaction&&KS(n),BS(n,qS())?new Proxy(n,$f):n)}function hi(n){if(n instanceof IDBRequest)return GS(n);if(of.has(n))return of.get(n);const e=QS(n);return e!==n&&(of.set(n,e),$p.set(e,n)),e}const af=n=>$p.get(n);function JS(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=hi(o);return r&&o.addEventListener("upgradeneeded",l=>{r(hi(o.result),l.oldVersion,l.newVersion,hi(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const YS=["get","getKey","getAll","getAllKeys","count"],XS=["put","add","delete","clear"],lf=new Map;function bv(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(lf.get(e))return lf.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=XS.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||YS.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return lf.set(e,i),i}HS(n=>({...n,get:(e,t,r)=>bv(e,t)||n.get(e,t,r),has:(e,t)=>!!bv(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZS{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(eP(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function eP(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Uf="@firebase/app",wv="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const As=new Fp("@firebase/app"),tP="@firebase/app-compat",nP="@firebase/analytics-compat",rP="@firebase/analytics",sP="@firebase/app-check-compat",iP="@firebase/app-check",oP="@firebase/auth",aP="@firebase/auth-compat",lP="@firebase/database",uP="@firebase/data-connect",cP="@firebase/database-compat",dP="@firebase/functions",hP="@firebase/functions-compat",fP="@firebase/installations",pP="@firebase/installations-compat",mP="@firebase/messaging",gP="@firebase/messaging-compat",vP="@firebase/performance",yP="@firebase/performance-compat",_P="@firebase/remote-config",bP="@firebase/remote-config-compat",wP="@firebase/storage",IP="@firebase/storage-compat",EP="@firebase/firestore",TP="@firebase/vertexai-preview",xP="@firebase/firestore-compat",AP="firebase",SP="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pd="[DEFAULT]",PP={[Uf]:"fire-core",[tP]:"fire-core-compat",[rP]:"fire-analytics",[nP]:"fire-analytics-compat",[iP]:"fire-app-check",[sP]:"fire-app-check-compat",[oP]:"fire-auth",[aP]:"fire-auth-compat",[lP]:"fire-rtdb",[uP]:"fire-data-connect",[cP]:"fire-rtdb-compat",[dP]:"fire-fn",[hP]:"fire-fn-compat",[fP]:"fire-iid",[pP]:"fire-iid-compat",[mP]:"fire-fcm",[gP]:"fire-fcm-compat",[vP]:"fire-perf",[yP]:"fire-perf-compat",[_P]:"fire-rc",[bP]:"fire-rc-compat",[wP]:"fire-gcs",[IP]:"fire-gcs-compat",[EP]:"fire-fst",[xP]:"fire-fst-compat",[TP]:"fire-vertex","fire-js":"fire-js",[AP]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const md=new Map,RP=new Map,jf=new Map;function Iv(n,e){try{n.container.addComponent(e)}catch(t){As.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ea(n){const e=n.name;if(jf.has(e))return As.debug(`There were multiple attempts to register component ${e}.`),!1;jf.set(e,n);for(const t of md.values())Iv(t,n);for(const t of RP.values())Iv(t,n);return!0}function Ou(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function CP(n,e,t=pd){Ou(n,e).clearInstance(t)}function Jt(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kP={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},fi=new Nu("app","Firebase",kP);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DP{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new go("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw fi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qa=SP;function q0(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:pd,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw fi.create("bad-app-name",{appName:String(s)});if(t||(t=L0()),!t)throw fi.create("no-options");const i=md.get(s);if(i){if(bi(t,i.options)&&bi(r,i.config))return i;throw fi.create("duplicate-app",{appName:s})}const o=new LS(s);for(const l of jf.values())o.addComponent(l);const a=new DP(t,r,o);return md.set(s,a),a}function z0(n=pd){const e=md.get(n);if(!e&&n===pd&&L0())return q0();if(!e)throw fi.create("no-app",{appName:n});return e}function pi(n,e,t){var r;let s=(r=PP[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),As.warn(a.join(" "));return}Ea(new go(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VP="firebase-heartbeat-database",NP=1,du="firebase-heartbeat-store";let uf=null;function G0(){return uf||(uf=JS(VP,NP,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(du)}catch(t){console.warn(t)}}}}).catch(n=>{throw fi.create("idb-open",{originalErrorMessage:n.message})})),uf}async function OP(n){try{const t=(await G0()).transaction(du),r=await t.objectStore(du).get(K0(n));return await t.done,r}catch(e){if(e instanceof Vs)As.warn(e.message);else{const t=fi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});As.warn(t.message)}}}async function Ev(n,e){try{const r=(await G0()).transaction(du,"readwrite");await r.objectStore(du).put(e,K0(n)),await r.done}catch(t){if(t instanceof Vs)As.warn(t.message);else{const r=fi.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});As.warn(r.message)}}}function K0(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MP=1024,LP=30*24*60*60*1e3;class FP{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new UP(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Tv();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=LP}),this._storage.overwrite(this._heartbeatsCache))}catch(r){As.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Tv(),{heartbeatsToSend:r,unsentEntries:s}=$P(this._heartbeatsCache.heartbeats),i=fd(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return As.warn(t),""}}}function Tv(){return new Date().toISOString().substring(0,10)}function $P(n,e=MP){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),xv(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),xv(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class UP{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return U0()?AS().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await OP(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Ev(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Ev(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function xv(n){return fd(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jP(n){Ea(new go("platform-logger",e=>new ZS(e),"PRIVATE")),Ea(new go("heartbeat",e=>new FP(e),"PRIVATE")),pi(Uf,wv,n),pi(Uf,wv,"esm2017"),pi("fire-js","")}jP("");var BP="firebase",qP="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */pi(BP,qP,"app");var Av=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ho,H0;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(T,w){function I(){}I.prototype=w.prototype,T.D=w.prototype,T.prototype=new I,T.prototype.constructor=T,T.C=function(C,V,B){for(var R=Array(arguments.length-2),Rt=2;Rt<arguments.length;Rt++)R[Rt-2]=arguments[Rt];return w.prototype[V].apply(C,R)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,w,I){I||(I=0);var C=Array(16);if(typeof w=="string")for(var V=0;16>V;++V)C[V]=w.charCodeAt(I++)|w.charCodeAt(I++)<<8|w.charCodeAt(I++)<<16|w.charCodeAt(I++)<<24;else for(V=0;16>V;++V)C[V]=w[I++]|w[I++]<<8|w[I++]<<16|w[I++]<<24;w=T.g[0],I=T.g[1],V=T.g[2];var B=T.g[3],R=w+(B^I&(V^B))+C[0]+3614090360&4294967295;w=I+(R<<7&4294967295|R>>>25),R=B+(V^w&(I^V))+C[1]+3905402710&4294967295,B=w+(R<<12&4294967295|R>>>20),R=V+(I^B&(w^I))+C[2]+606105819&4294967295,V=B+(R<<17&4294967295|R>>>15),R=I+(w^V&(B^w))+C[3]+3250441966&4294967295,I=V+(R<<22&4294967295|R>>>10),R=w+(B^I&(V^B))+C[4]+4118548399&4294967295,w=I+(R<<7&4294967295|R>>>25),R=B+(V^w&(I^V))+C[5]+1200080426&4294967295,B=w+(R<<12&4294967295|R>>>20),R=V+(I^B&(w^I))+C[6]+2821735955&4294967295,V=B+(R<<17&4294967295|R>>>15),R=I+(w^V&(B^w))+C[7]+4249261313&4294967295,I=V+(R<<22&4294967295|R>>>10),R=w+(B^I&(V^B))+C[8]+1770035416&4294967295,w=I+(R<<7&4294967295|R>>>25),R=B+(V^w&(I^V))+C[9]+2336552879&4294967295,B=w+(R<<12&4294967295|R>>>20),R=V+(I^B&(w^I))+C[10]+4294925233&4294967295,V=B+(R<<17&4294967295|R>>>15),R=I+(w^V&(B^w))+C[11]+2304563134&4294967295,I=V+(R<<22&4294967295|R>>>10),R=w+(B^I&(V^B))+C[12]+1804603682&4294967295,w=I+(R<<7&4294967295|R>>>25),R=B+(V^w&(I^V))+C[13]+4254626195&4294967295,B=w+(R<<12&4294967295|R>>>20),R=V+(I^B&(w^I))+C[14]+2792965006&4294967295,V=B+(R<<17&4294967295|R>>>15),R=I+(w^V&(B^w))+C[15]+1236535329&4294967295,I=V+(R<<22&4294967295|R>>>10),R=w+(V^B&(I^V))+C[1]+4129170786&4294967295,w=I+(R<<5&4294967295|R>>>27),R=B+(I^V&(w^I))+C[6]+3225465664&4294967295,B=w+(R<<9&4294967295|R>>>23),R=V+(w^I&(B^w))+C[11]+643717713&4294967295,V=B+(R<<14&4294967295|R>>>18),R=I+(B^w&(V^B))+C[0]+3921069994&4294967295,I=V+(R<<20&4294967295|R>>>12),R=w+(V^B&(I^V))+C[5]+3593408605&4294967295,w=I+(R<<5&4294967295|R>>>27),R=B+(I^V&(w^I))+C[10]+38016083&4294967295,B=w+(R<<9&4294967295|R>>>23),R=V+(w^I&(B^w))+C[15]+3634488961&4294967295,V=B+(R<<14&4294967295|R>>>18),R=I+(B^w&(V^B))+C[4]+3889429448&4294967295,I=V+(R<<20&4294967295|R>>>12),R=w+(V^B&(I^V))+C[9]+568446438&4294967295,w=I+(R<<5&4294967295|R>>>27),R=B+(I^V&(w^I))+C[14]+3275163606&4294967295,B=w+(R<<9&4294967295|R>>>23),R=V+(w^I&(B^w))+C[3]+4107603335&4294967295,V=B+(R<<14&4294967295|R>>>18),R=I+(B^w&(V^B))+C[8]+1163531501&4294967295,I=V+(R<<20&4294967295|R>>>12),R=w+(V^B&(I^V))+C[13]+2850285829&4294967295,w=I+(R<<5&4294967295|R>>>27),R=B+(I^V&(w^I))+C[2]+4243563512&4294967295,B=w+(R<<9&4294967295|R>>>23),R=V+(w^I&(B^w))+C[7]+1735328473&4294967295,V=B+(R<<14&4294967295|R>>>18),R=I+(B^w&(V^B))+C[12]+2368359562&4294967295,I=V+(R<<20&4294967295|R>>>12),R=w+(I^V^B)+C[5]+4294588738&4294967295,w=I+(R<<4&4294967295|R>>>28),R=B+(w^I^V)+C[8]+2272392833&4294967295,B=w+(R<<11&4294967295|R>>>21),R=V+(B^w^I)+C[11]+1839030562&4294967295,V=B+(R<<16&4294967295|R>>>16),R=I+(V^B^w)+C[14]+4259657740&4294967295,I=V+(R<<23&4294967295|R>>>9),R=w+(I^V^B)+C[1]+2763975236&4294967295,w=I+(R<<4&4294967295|R>>>28),R=B+(w^I^V)+C[4]+1272893353&4294967295,B=w+(R<<11&4294967295|R>>>21),R=V+(B^w^I)+C[7]+4139469664&4294967295,V=B+(R<<16&4294967295|R>>>16),R=I+(V^B^w)+C[10]+3200236656&4294967295,I=V+(R<<23&4294967295|R>>>9),R=w+(I^V^B)+C[13]+681279174&4294967295,w=I+(R<<4&4294967295|R>>>28),R=B+(w^I^V)+C[0]+3936430074&4294967295,B=w+(R<<11&4294967295|R>>>21),R=V+(B^w^I)+C[3]+3572445317&4294967295,V=B+(R<<16&4294967295|R>>>16),R=I+(V^B^w)+C[6]+76029189&4294967295,I=V+(R<<23&4294967295|R>>>9),R=w+(I^V^B)+C[9]+3654602809&4294967295,w=I+(R<<4&4294967295|R>>>28),R=B+(w^I^V)+C[12]+3873151461&4294967295,B=w+(R<<11&4294967295|R>>>21),R=V+(B^w^I)+C[15]+530742520&4294967295,V=B+(R<<16&4294967295|R>>>16),R=I+(V^B^w)+C[2]+3299628645&4294967295,I=V+(R<<23&4294967295|R>>>9),R=w+(V^(I|~B))+C[0]+4096336452&4294967295,w=I+(R<<6&4294967295|R>>>26),R=B+(I^(w|~V))+C[7]+1126891415&4294967295,B=w+(R<<10&4294967295|R>>>22),R=V+(w^(B|~I))+C[14]+2878612391&4294967295,V=B+(R<<15&4294967295|R>>>17),R=I+(B^(V|~w))+C[5]+4237533241&4294967295,I=V+(R<<21&4294967295|R>>>11),R=w+(V^(I|~B))+C[12]+1700485571&4294967295,w=I+(R<<6&4294967295|R>>>26),R=B+(I^(w|~V))+C[3]+2399980690&4294967295,B=w+(R<<10&4294967295|R>>>22),R=V+(w^(B|~I))+C[10]+4293915773&4294967295,V=B+(R<<15&4294967295|R>>>17),R=I+(B^(V|~w))+C[1]+2240044497&4294967295,I=V+(R<<21&4294967295|R>>>11),R=w+(V^(I|~B))+C[8]+1873313359&4294967295,w=I+(R<<6&4294967295|R>>>26),R=B+(I^(w|~V))+C[15]+4264355552&4294967295,B=w+(R<<10&4294967295|R>>>22),R=V+(w^(B|~I))+C[6]+2734768916&4294967295,V=B+(R<<15&4294967295|R>>>17),R=I+(B^(V|~w))+C[13]+1309151649&4294967295,I=V+(R<<21&4294967295|R>>>11),R=w+(V^(I|~B))+C[4]+4149444226&4294967295,w=I+(R<<6&4294967295|R>>>26),R=B+(I^(w|~V))+C[11]+3174756917&4294967295,B=w+(R<<10&4294967295|R>>>22),R=V+(w^(B|~I))+C[2]+718787259&4294967295,V=B+(R<<15&4294967295|R>>>17),R=I+(B^(V|~w))+C[9]+3951481745&4294967295,T.g[0]=T.g[0]+w&4294967295,T.g[1]=T.g[1]+(V+(R<<21&4294967295|R>>>11))&4294967295,T.g[2]=T.g[2]+V&4294967295,T.g[3]=T.g[3]+B&4294967295}r.prototype.u=function(T,w){w===void 0&&(w=T.length);for(var I=w-this.blockSize,C=this.B,V=this.h,B=0;B<w;){if(V==0)for(;B<=I;)s(this,T,B),B+=this.blockSize;if(typeof T=="string"){for(;B<w;)if(C[V++]=T.charCodeAt(B++),V==this.blockSize){s(this,C),V=0;break}}else for(;B<w;)if(C[V++]=T[B++],V==this.blockSize){s(this,C),V=0;break}}this.h=V,this.o+=w},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var w=1;w<T.length-8;++w)T[w]=0;var I=8*this.o;for(w=T.length-8;w<T.length;++w)T[w]=I&255,I/=256;for(this.u(T),T=Array(16),w=I=0;4>w;++w)for(var C=0;32>C;C+=8)T[I++]=this.g[w]>>>C&255;return T};function i(T,w){var I=a;return Object.prototype.hasOwnProperty.call(I,T)?I[T]:I[T]=w(T)}function o(T,w){this.h=w;for(var I=[],C=!0,V=T.length-1;0<=V;V--){var B=T[V]|0;C&&B==w||(I[V]=B,C=!1)}this.g=I}var a={};function l(T){return-128<=T&&128>T?i(T,function(w){return new o([w|0],0>w?-1:0)}):new o([T|0],0>T?-1:0)}function c(T){if(isNaN(T)||!isFinite(T))return f;if(0>T)return S(c(-T));for(var w=[],I=1,C=0;T>=I;C++)w[C]=T/I|0,I*=4294967296;return new o(w,0)}function d(T,w){if(T.length==0)throw Error("number format error: empty string");if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(T.charAt(0)=="-")return S(d(T.substring(1),w));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=c(Math.pow(w,8)),C=f,V=0;V<T.length;V+=8){var B=Math.min(8,T.length-V),R=parseInt(T.substring(V,V+B),w);8>B?(B=c(Math.pow(w,B)),C=C.j(B).add(c(R))):(C=C.j(I),C=C.add(c(R)))}return C}var f=l(0),g=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(P(this))return-S(this).m();for(var T=0,w=1,I=0;I<this.g.length;I++){var C=this.i(I);T+=(0<=C?C:4294967296+C)*w,w*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(x(this))return"0";if(P(this))return"-"+S(this).toString(T);for(var w=c(Math.pow(T,6)),I=this,C="";;){var V=G(I,w).g;I=j(I,V.j(w));var B=((0<I.g.length?I.g[0]:I.h)>>>0).toString(T);if(I=V,x(I))return B+C;for(;6>B.length;)B="0"+B;C=B+C}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function x(T){if(T.h!=0)return!1;for(var w=0;w<T.g.length;w++)if(T.g[w]!=0)return!1;return!0}function P(T){return T.h==-1}n.l=function(T){return T=j(this,T),P(T)?-1:x(T)?0:1};function S(T){for(var w=T.g.length,I=[],C=0;C<w;C++)I[C]=~T.g[C];return new o(I,~T.h).add(g)}n.abs=function(){return P(this)?S(this):this},n.add=function(T){for(var w=Math.max(this.g.length,T.g.length),I=[],C=0,V=0;V<=w;V++){var B=C+(this.i(V)&65535)+(T.i(V)&65535),R=(B>>>16)+(this.i(V)>>>16)+(T.i(V)>>>16);C=R>>>16,B&=65535,R&=65535,I[V]=R<<16|B}return new o(I,I[I.length-1]&-2147483648?-1:0)};function j(T,w){return T.add(S(w))}n.j=function(T){if(x(this)||x(T))return f;if(P(this))return P(T)?S(this).j(S(T)):S(S(this).j(T));if(P(T))return S(this.j(S(T)));if(0>this.l(y)&&0>T.l(y))return c(this.m()*T.m());for(var w=this.g.length+T.g.length,I=[],C=0;C<2*w;C++)I[C]=0;for(C=0;C<this.g.length;C++)for(var V=0;V<T.g.length;V++){var B=this.i(C)>>>16,R=this.i(C)&65535,Rt=T.i(V)>>>16,Et=T.i(V)&65535;I[2*C+2*V]+=R*Et,$(I,2*C+2*V),I[2*C+2*V+1]+=B*Et,$(I,2*C+2*V+1),I[2*C+2*V+1]+=R*Rt,$(I,2*C+2*V+1),I[2*C+2*V+2]+=B*Rt,$(I,2*C+2*V+2)}for(C=0;C<w;C++)I[C]=I[2*C+1]<<16|I[2*C];for(C=w;C<2*w;C++)I[C]=0;return new o(I,0)};function $(T,w){for(;(T[w]&65535)!=T[w];)T[w+1]+=T[w]>>>16,T[w]&=65535,w++}function D(T,w){this.g=T,this.h=w}function G(T,w){if(x(w))throw Error("division by zero");if(x(T))return new D(f,f);if(P(T))return w=G(S(T),w),new D(S(w.g),S(w.h));if(P(w))return w=G(T,S(w)),new D(S(w.g),w.h);if(30<T.g.length){if(P(T)||P(w))throw Error("slowDivide_ only works with positive integers.");for(var I=g,C=w;0>=C.l(T);)I=Z(I),C=Z(C);var V=pe(I,1),B=pe(C,1);for(C=pe(C,2),I=pe(I,2);!x(C);){var R=B.add(C);0>=R.l(T)&&(V=V.add(I),B=R),C=pe(C,1),I=pe(I,1)}return w=j(T,V.j(w)),new D(V,w)}for(V=f;0<=T.l(w);){for(I=Math.max(1,Math.floor(T.m()/w.m())),C=Math.ceil(Math.log(I)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),B=c(I),R=B.j(w);P(R)||0<R.l(T);)I-=C,B=c(I),R=B.j(w);x(B)&&(B=g),V=V.add(B),T=j(T,R)}return new D(V,T)}n.A=function(T){return G(this,T).h},n.and=function(T){for(var w=Math.max(this.g.length,T.g.length),I=[],C=0;C<w;C++)I[C]=this.i(C)&T.i(C);return new o(I,this.h&T.h)},n.or=function(T){for(var w=Math.max(this.g.length,T.g.length),I=[],C=0;C<w;C++)I[C]=this.i(C)|T.i(C);return new o(I,this.h|T.h)},n.xor=function(T){for(var w=Math.max(this.g.length,T.g.length),I=[],C=0;C<w;C++)I[C]=this.i(C)^T.i(C);return new o(I,this.h^T.h)};function Z(T){for(var w=T.g.length+1,I=[],C=0;C<w;C++)I[C]=T.i(C)<<1|T.i(C-1)>>>31;return new o(I,T.h)}function pe(T,w){var I=w>>5;w%=32;for(var C=T.g.length-I,V=[],B=0;B<C;B++)V[B]=0<w?T.i(B+I)>>>w|T.i(B+I+1)<<32-w:T.i(B+I);return new o(V,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,H0=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,ho=o}).apply(typeof Av<"u"?Av:typeof self<"u"?self:typeof window<"u"?window:{});var Sc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var W0,Ml,Q0,qc,Bf,J0,Y0,X0;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,v){return u==Array.prototype||u==Object.prototype||(u[p]=v.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Sc=="object"&&Sc];for(var p=0;p<u.length;++p){var v=u[p];if(v&&v.Math==Math)return v}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var v=r;u=u.split(".");for(var b=0;b<u.length-1;b++){var q=u[b];if(!(q in v))break e;v=v[q]}u=u[u.length-1],b=v[u],p=p(b),p!=b&&p!=null&&e(v,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var v=0,b=!1,q={next:function(){if(!b&&v<u.length){var H=v++;return{value:p(H,u[H]),done:!1}}return b=!0,{done:!0,value:void 0}}};return q[Symbol.iterator]=function(){return q},q}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,v){return v})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function c(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function d(u,p,v){return u.call.apply(u.bind,arguments)}function f(u,p,v){if(!u)throw Error();if(2<arguments.length){var b=Array.prototype.slice.call(arguments,2);return function(){var q=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(q,b),u.apply(p,q)}}return function(){return u.apply(p,arguments)}}function g(u,p,v){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,g.apply(null,arguments)}function y(u,p){var v=Array.prototype.slice.call(arguments,1);return function(){var b=v.slice();return b.push.apply(b,arguments),u.apply(this,b)}}function x(u,p){function v(){}v.prototype=p.prototype,u.aa=p.prototype,u.prototype=new v,u.prototype.constructor=u,u.Qb=function(b,q,H){for(var ye=Array(arguments.length-2),mt=2;mt<arguments.length;mt++)ye[mt-2]=arguments[mt];return p.prototype[q].apply(b,ye)}}function P(u){const p=u.length;if(0<p){const v=Array(p);for(let b=0;b<p;b++)v[b]=u[b];return v}return[]}function S(u,p){for(let v=1;v<arguments.length;v++){const b=arguments[v];if(l(b)){const q=u.length||0,H=b.length||0;u.length=q+H;for(let ye=0;ye<H;ye++)u[q+ye]=b[ye]}else u.push(b)}}class j{constructor(p,v){this.i=p,this.j=v,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function $(u){return/^[\s\xa0]*$/.test(u)}function D(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function G(u){return G[" "](u),u}G[" "]=function(){};var Z=D().indexOf("Gecko")!=-1&&!(D().toLowerCase().indexOf("webkit")!=-1&&D().indexOf("Edge")==-1)&&!(D().indexOf("Trident")!=-1||D().indexOf("MSIE")!=-1)&&D().indexOf("Edge")==-1;function pe(u,p,v){for(const b in u)p.call(v,u[b],b,u)}function T(u,p){for(const v in u)p.call(void 0,u[v],v,u)}function w(u){const p={};for(const v in u)p[v]=u[v];return p}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(u,p){let v,b;for(let q=1;q<arguments.length;q++){b=arguments[q];for(v in b)u[v]=b[v];for(let H=0;H<I.length;H++)v=I[H],Object.prototype.hasOwnProperty.call(b,v)&&(u[v]=b[v])}}function V(u){var p=1;u=u.split(":");const v=[];for(;0<p&&u.length;)v.push(u.shift()),p--;return u.length&&v.push(u.join(":")),v}function B(u){a.setTimeout(()=>{throw u},0)}function R(){var u=ln;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class Rt{constructor(){this.h=this.g=null}add(p,v){const b=Et.get();b.set(p,v),this.h?this.h.next=b:this.g=b,this.h=b}}var Et=new j(()=>new Ye,u=>u.reset());class Ye{constructor(){this.next=this.g=this.h=null}set(p,v){this.h=p,this.g=v,this.next=null}reset(){this.next=this.g=this.h=null}}let Me,Le=!1,ln=new Rt,en=()=>{const u=a.Promise.resolve(void 0);Me=()=>{u.then(Ct)}};var Ct=()=>{for(var u;u=R();){try{u.h.call(u.g)}catch(v){B(v)}var p=Et;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}Le=!1};function fe(){this.s=this.s,this.C=this.C}fe.prototype.s=!1,fe.prototype.ma=function(){this.s||(this.s=!0,this.N())},fe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function se(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}se.prototype.h=function(){this.defaultPrevented=!0};var qe=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const v=()=>{};a.addEventListener("test",v,p),a.removeEventListener("test",v,p)}catch{}return u}();function tt(u,p){if(se.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var v=this.type=u.type,b=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(Z){e:{try{G(p.nodeName);var q=!0;break e}catch{}q=!1}q||(p=null)}}else v=="mouseover"?p=u.fromElement:v=="mouseout"&&(p=u.toElement);this.relatedTarget=p,b?(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:ut[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&tt.aa.h.call(this)}}x(tt,se);var ut={2:"touch",3:"pen",4:"mouse"};tt.prototype.h=function(){tt.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var k="closure_listenable_"+(1e6*Math.random()|0),M=0;function Q(u,p,v,b,q){this.listener=u,this.proxy=null,this.src=p,this.type=v,this.capture=!!b,this.ha=q,this.key=++M,this.da=this.fa=!1}function X(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function Pe(u){this.src=u,this.g={},this.h=0}Pe.prototype.add=function(u,p,v,b,q){var H=u.toString();u=this.g[H],u||(u=this.g[H]=[],this.h++);var ye=E(u,p,b,q);return-1<ye?(p=u[ye],v||(p.fa=!1)):(p=new Q(p,this.src,H,!!b,q),p.fa=v,u.push(p)),p};function Ne(u,p){var v=p.type;if(v in u.g){var b=u.g[v],q=Array.prototype.indexOf.call(b,p,void 0),H;(H=0<=q)&&Array.prototype.splice.call(b,q,1),H&&(X(p),u.g[v].length==0&&(delete u.g[v],u.h--))}}function E(u,p,v,b){for(var q=0;q<u.length;++q){var H=u[q];if(!H.da&&H.listener==p&&H.capture==!!v&&H.ha==b)return q}return-1}var A="closure_lm_"+(1e6*Math.random()|0),L={};function ee(u,p,v,b,q){if(b&&b.once)return me(u,p,v,b,q);if(Array.isArray(p)){for(var H=0;H<p.length;H++)ee(u,p[H],v,b,q);return null}return v=Re(v),u&&u[k]?u.K(p,v,c(b)?!!b.capture:!!b,q):J(u,p,v,!1,b,q)}function J(u,p,v,b,q,H){if(!p)throw Error("Invalid event type");var ye=c(q)?!!q.capture:!!q,mt=be(u);if(mt||(u[A]=mt=new Pe(u)),v=mt.add(p,v,b,ye,H),v.proxy)return v;if(b=te(),v.proxy=b,b.src=u,b.listener=v,u.addEventListener)qe||(q=ye),q===void 0&&(q=!1),u.addEventListener(p.toString(),b,q);else if(u.attachEvent)u.attachEvent(ie(p.toString()),b);else if(u.addListener&&u.removeListener)u.addListener(b);else throw Error("addEventListener and attachEvent are unavailable.");return v}function te(){function u(v){return p.call(u.src,u.listener,v)}const p=Ee;return u}function me(u,p,v,b,q){if(Array.isArray(p)){for(var H=0;H<p.length;H++)me(u,p[H],v,b,q);return null}return v=Re(v),u&&u[k]?u.L(p,v,c(b)?!!b.capture:!!b,q):J(u,p,v,!0,b,q)}function ce(u,p,v,b,q){if(Array.isArray(p))for(var H=0;H<p.length;H++)ce(u,p[H],v,b,q);else b=c(b)?!!b.capture:!!b,v=Re(v),u&&u[k]?(u=u.i,p=String(p).toString(),p in u.g&&(H=u.g[p],v=E(H,v,b,q),-1<v&&(X(H[v]),Array.prototype.splice.call(H,v,1),H.length==0&&(delete u.g[p],u.h--)))):u&&(u=be(u))&&(p=u.g[p.toString()],u=-1,p&&(u=E(p,v,b,q)),(v=-1<u?p[u]:null)&&de(v))}function de(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[k])Ne(p.i,u);else{var v=u.type,b=u.proxy;p.removeEventListener?p.removeEventListener(v,b,u.capture):p.detachEvent?p.detachEvent(ie(v),b):p.addListener&&p.removeListener&&p.removeListener(b),(v=be(p))?(Ne(v,u),v.h==0&&(v.src=null,p[A]=null)):X(u)}}}function ie(u){return u in L?L[u]:L[u]="on"+u}function Ee(u,p){if(u.da)u=!0;else{p=new tt(p,this);var v=u.listener,b=u.ha||u.src;u.fa&&de(u),u=v.call(b,p)}return u}function be(u){return u=u[A],u instanceof Pe?u:null}var Te="__closure_events_fn_"+(1e9*Math.random()>>>0);function Re(u){return typeof u=="function"?u:(u[Te]||(u[Te]=function(p){return u.handleEvent(p)}),u[Te])}function Ve(){fe.call(this),this.i=new Pe(this),this.M=this,this.F=null}x(Ve,fe),Ve.prototype[k]=!0,Ve.prototype.removeEventListener=function(u,p,v,b){ce(this,u,p,v,b)};function $e(u,p){var v,b=u.F;if(b)for(v=[];b;b=b.F)v.push(b);if(u=u.M,b=p.type||p,typeof p=="string")p=new se(p,u);else if(p instanceof se)p.target=p.target||u;else{var q=p;p=new se(b,u),C(p,q)}if(q=!0,v)for(var H=v.length-1;0<=H;H--){var ye=p.g=v[H];q=Qe(ye,b,!0,p)&&q}if(ye=p.g=u,q=Qe(ye,b,!0,p)&&q,q=Qe(ye,b,!1,p)&&q,v)for(H=0;H<v.length;H++)ye=p.g=v[H],q=Qe(ye,b,!1,p)&&q}Ve.prototype.N=function(){if(Ve.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var v=u.g[p],b=0;b<v.length;b++)X(v[b]);delete u.g[p],u.h--}}this.F=null},Ve.prototype.K=function(u,p,v,b){return this.i.add(String(u),p,!1,v,b)},Ve.prototype.L=function(u,p,v,b){return this.i.add(String(u),p,!0,v,b)};function Qe(u,p,v,b){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var q=!0,H=0;H<p.length;++H){var ye=p[H];if(ye&&!ye.da&&ye.capture==v){var mt=ye.listener,cn=ye.ha||ye.src;ye.fa&&Ne(u.i,ye),q=mt.call(cn,b)!==!1&&q}}return q&&!b.defaultPrevented}function zt(u,p,v){if(typeof u=="function")v&&(u=g(u,v));else if(u&&typeof u.handleEvent=="function")u=g(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(u,p||0)}function Lt(u){u.g=zt(()=>{u.g=null,u.i&&(u.i=!1,Lt(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class gn extends fe{constructor(p,v){super(),this.m=p,this.l=v,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Lt(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function kt(u){fe.call(this),this.h=u,this.g={}}x(kt,fe);var fr=[];function Lr(u){pe(u.g,function(p,v){this.g.hasOwnProperty(v)&&de(p)},u),u.g={}}kt.prototype.N=function(){kt.aa.N.call(this),Lr(this)},kt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var tn=a.JSON.stringify,Pn=a.JSON.parse,Oi=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function il(){}il.prototype.h=null;function rc(u){return u.h||(u.h=u.i())}function sc(){}var Mi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ol(){se.call(this,"d")}x(ol,se);function Ar(){se.call(this,"c")}x(Ar,se);var Jn={},Sr=null;function Pr(){return Sr=Sr||new Ve}Jn.La="serverreachability";function Rr(u){se.call(this,Jn.La,u)}x(Rr,se);function Us(u){const p=Pr();$e(p,new Rr(p))}Jn.STAT_EVENT="statevent";function Li(u,p){se.call(this,Jn.STAT_EVENT,u),this.stat=p}x(Li,se);function un(u){const p=Pr();$e(p,new Li(p,u))}Jn.Ma="timingevent";function ic(u,p){se.call(this,Jn.Ma,u),this.size=p}x(ic,se);function Rn(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function js(){this.g=!0}js.prototype.xa=function(){this.g=!1};function oc(u,p,v,b,q,H){u.info(function(){if(u.g)if(H)for(var ye="",mt=H.split("&"),cn=0;cn<mt.length;cn++){var it=mt[cn].split("=");if(1<it.length){var nn=it[0];it=it[1];var vn=nn.split("_");ye=2<=vn.length&&vn[1]=="type"?ye+(nn+"="+it+"&"):ye+(nn+"=redacted&")}}else ye=null;else ye=H;return"XMLHTTP REQ ("+b+") [attempt "+q+"]: "+p+`
`+v+`
`+ye})}function al(u,p,v,b,q,H,ye){u.info(function(){return"XMLHTTP RESP ("+b+") [ attempt "+q+"]: "+p+`
`+v+`
`+H+" "+ye})}function Bs(u,p,v,b){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+Vo(u,v)+(b?" "+b:"")})}function qn(u,p){u.info(function(){return"TIMEOUT: "+p})}js.prototype.info=function(){};function Vo(u,p){if(!u.g)return p;if(!p)return null;try{var v=JSON.parse(p);if(v){for(u=0;u<v.length;u++)if(Array.isArray(v[u])){var b=v[u];if(!(2>b.length)){var q=b[1];if(Array.isArray(q)&&!(1>q.length)){var H=q[0];if(H!="noop"&&H!="stop"&&H!="close")for(var ye=1;ye<q.length;ye++)q[ye]=""}}}}return tn(v)}catch{return p}}var zn={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ll={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},No;function Fr(){}x(Fr,il),Fr.prototype.g=function(){return new XMLHttpRequest},Fr.prototype.i=function(){return{}},No=new Fr;function Yn(u,p,v,b){this.j=u,this.i=p,this.l=v,this.R=b||1,this.U=new kt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Fi}function Fi(){this.i=null,this.g="",this.h=!1}var ns={},Oo={};function qs(u,p,v){u.L=1,u.v=Ur(vr(p)),u.m=v,u.P=!0,pr(u,null)}function pr(u,p){u.F=Date.now(),Mo(u),u.A=vr(u.v);var v=u.A,b=u.R;Array.isArray(b)||(b=[String(b)]),Gt(v.i,"t",b),u.C=0,v=u.j.J,u.h=new Fi,u.g=bc(u.j,v?p:null,!u.m),0<u.O&&(u.M=new gn(g(u.Y,u,u.g),u.O)),p=u.U,v=u.g,b=u.ca;var q="readystatechange";Array.isArray(q)||(q&&(fr[0]=q.toString()),q=fr);for(var H=0;H<q.length;H++){var ye=ee(v,q[H],b||p.handleEvent,!1,p.h||p);if(!ye)break;p.g[ye.key]=ye}p=u.H?w(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),Us(),oc(u.i,u.u,u.A,u.l,u.R,u.m)}Yn.prototype.ca=function(u){u=u.target;const p=this.M;p&&or(u)==3?p.j():this.Y(u)},Yn.prototype.Y=function(u){try{if(u==this.g)e:{const vn=or(this.g);var p=this.g.Ba();const cs=this.g.Z();if(!(3>vn)&&(vn!=3||this.g&&(this.h.h||this.g.oa()||vl(this.g)))){this.J||vn!=4||p==7||(p==8||0>=cs?Us(3):Us(2)),mr(this);var v=this.g.Z();this.X=v;t:if(ac(this)){var b=vl(this.g);u="";var q=b.length,H=or(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){$r(this),rs(this);var ye="";break t}this.h.i=new a.TextDecoder}for(p=0;p<q;p++)this.h.h=!0,u+=this.h.i.decode(b[p],{stream:!(H&&p==q-1)});b.length=0,this.h.g+=u,this.C=0,ye=this.h.g}else ye=this.g.oa();if(this.o=v==200,al(this.i,this.u,this.A,this.l,this.R,vn,v),this.o){if(this.T&&!this.K){t:{if(this.g){var mt,cn=this.g;if((mt=cn.g?cn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(mt)){var it=mt;break t}}it=null}if(v=it)Bs(this.i,this.l,v,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Lo(this,v);else{this.o=!1,this.s=3,un(12),$r(this),rs(this);break e}}if(this.P){v=!0;let ar;for(;!this.J&&this.C<ye.length;)if(ar=Oh(this,ye),ar==Oo){vn==4&&(this.s=4,un(14),v=!1),Bs(this.i,this.l,null,"[Incomplete Response]");break}else if(ar==ns){this.s=4,un(15),Bs(this.i,this.l,ye,"[Invalid Chunk]"),v=!1;break}else Bs(this.i,this.l,ar,null),Lo(this,ar);if(ac(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),vn!=4||ye.length!=0||this.h.h||(this.s=1,un(16),v=!1),this.o=this.o&&v,!v)Bs(this.i,this.l,ye,"[Invalid Chunked Response]"),$r(this),rs(this);else if(0<ye.length&&!this.W){this.W=!0;var nn=this.j;nn.g==this&&nn.ba&&!nn.M&&(nn.j.info("Great, no buffering proxy detected. Bytes received: "+ye.length),_l(nn),nn.M=!0,un(11))}}else Bs(this.i,this.l,ye,null),Lo(this,ye);vn==4&&$r(this),this.o&&!this.J&&(vn==4?bl(this.j,this):(this.o=!1,Mo(this)))}else Uh(this.g),v==400&&0<ye.indexOf("Unknown SID")?(this.s=3,un(12)):(this.s=0,un(13)),$r(this),rs(this)}}}catch{}finally{}};function ac(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function Oh(u,p){var v=u.C,b=p.indexOf(`
`,v);return b==-1?Oo:(v=Number(p.substring(v,b)),isNaN(v)?ns:(b+=1,b+v>p.length?Oo:(p=p.slice(b,b+v),u.C=b+v,p)))}Yn.prototype.cancel=function(){this.J=!0,$r(this)};function Mo(u){u.S=Date.now()+u.I,ul(u,u.I)}function ul(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=Rn(g(u.ba,u),p)}function mr(u){u.B&&(a.clearTimeout(u.B),u.B=null)}Yn.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(qn(this.i,this.A),this.L!=2&&(Us(),un(17)),$r(this),this.s=2,rs(this)):ul(this,this.S-u)};function rs(u){u.j.G==0||u.J||bl(u.j,u)}function $r(u){mr(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,Lr(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function Lo(u,p){try{var v=u.j;if(v.G!=0&&(v.g==u||$o(v.h,u))){if(!u.K&&$o(v.h,u)&&v.G==3){try{var b=v.Da.g.parse(p)}catch{b=null}if(Array.isArray(b)&&b.length==3){var q=b;if(q[0]==0){e:if(!v.u){if(v.g)if(v.g.F+3e3<u.F)Ko(v),as(v);else break e;ls(v),un(18)}}else v.za=q[1],0<v.za-v.T&&37500>q[2]&&v.F&&v.v==0&&!v.C&&(v.C=Rn(g(v.Za,v),6e3));if(1>=dl(v.h)&&v.ca){try{v.ca()}catch{}v.ca=void 0}}else qr(v,11)}else if((u.K||v.g==u)&&Ko(v),!$(p))for(q=v.Da.g.parse(p),p=0;p<q.length;p++){let it=q[p];if(v.T=it[0],it=it[1],v.G==2)if(it[0]=="c"){v.K=it[1],v.ia=it[2];const nn=it[3];nn!=null&&(v.la=nn,v.j.info("VER="+v.la));const vn=it[4];vn!=null&&(v.Aa=vn,v.j.info("SVER="+v.Aa));const cs=it[5];cs!=null&&typeof cs=="number"&&0<cs&&(b=1.5*cs,v.L=b,v.j.info("backChannelRequestTimeoutMs_="+b)),b=v;const ar=u.g;if(ar){const Ws=ar.g?ar.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ws){var H=b.h;H.g||Ws.indexOf("spdy")==-1&&Ws.indexOf("quic")==-1&&Ws.indexOf("h2")==-1||(H.j=H.l,H.g=new Set,H.h&&(zs(H,H.h),H.h=null))}if(b.D){const Wo=ar.g?ar.g.getResponseHeader("X-HTTP-Session-Id"):null;Wo&&(b.ya=Wo,_t(b.I,b.D,Wo))}}v.G=3,v.l&&v.l.ua(),v.ba&&(v.R=Date.now()-u.F,v.j.info("Handshake RTT: "+v.R+"ms")),b=v;var ye=u;if(b.qa=_c(b,b.J?b.ia:null,b.W),ye.K){$i(b.h,ye);var mt=ye,cn=b.L;cn&&(mt.I=cn),mt.B&&(mr(mt),Mo(mt)),b.g=ye}else mc(b);0<v.i.length&&Go(v)}else it[0]!="stop"&&it[0]!="close"||qr(v,7);else v.G==3&&(it[0]=="stop"||it[0]=="close"?it[0]=="stop"?qr(v,7):Ki(v):it[0]!="noop"&&v.l&&v.l.ta(it),v.v=0)}}Us(4)}catch{}}var cl=class{constructor(u,p){this.g=u,this.map=p}};function lc(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Fo(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function dl(u){return u.h?1:u.g?u.g.size:0}function $o(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function zs(u,p){u.g?u.g.add(p):u.h=p}function $i(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}lc.prototype.cancel=function(){if(this.i=Ui(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function Ui(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const v of u.g.values())p=p.concat(v.D);return p}return P(u.i)}function hl(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],v=u.length,b=0;b<v;b++)p.push(u[b]);return p}p=[],v=0;for(b in u)p[v++]=u[b];return p}function Ce(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var v=0;v<u;v++)p.push(v);return p}p=[],v=0;for(const b in u)p[v++]=b;return p}}}function st(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var v=Ce(u),b=hl(u),q=b.length,H=0;H<q;H++)p.call(void 0,b[H],v&&v[H],u)}var gr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ji(u,p){if(u){u=u.split("&");for(var v=0;v<u.length;v++){var b=u[v].indexOf("="),q=null;if(0<=b){var H=u[v].substring(0,b);q=u[v].substring(b+1)}else H=u[v];p(H,q?decodeURIComponent(q.replace(/\+/g," ")):"")}}}function ss(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof ss){this.h=u.h,Uo(this,u.j),this.o=u.o,this.g=u.g,jo(this,u.s),this.l=u.l;var p=u.i,v=new qi;v.i=p.i,p.g&&(v.g=new Map(p.g),v.h=p.h),Bo(this,v),this.m=u.m}else u&&(p=String(u).match(gr))?(this.h=!1,Uo(this,p[1]||"",!0),this.o=jr(p[2]||""),this.g=jr(p[3]||"",!0),jo(this,p[4]),this.l=jr(p[5]||"",!0),Bo(this,p[6]||"",!0),this.m=jr(p[7]||"")):(this.h=!1,this.i=new qi(null,this.h))}ss.prototype.toString=function(){var u=[],p=this.j;p&&u.push(yr(p,Ks,!0),":");var v=this.g;return(v||p=="file")&&(u.push("//"),(p=this.o)&&u.push(yr(p,Ks,!0),"@"),u.push(encodeURIComponent(String(v)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v=this.s,v!=null&&u.push(":",String(v))),(v=this.l)&&(this.g&&v.charAt(0)!="/"&&u.push("/"),u.push(yr(v,v.charAt(0)=="/"?qo:Bi,!0))),(v=this.i.toString())&&u.push("?",v),(v=this.m)&&u.push("#",yr(v,Lh)),u.join("")};function vr(u){return new ss(u)}function Uo(u,p,v){u.j=v?jr(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function jo(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function Bo(u,p,v){p instanceof qi?(u.i=p,Fh(u.i,u.h)):(v||(p=yr(p,Mh)),u.i=new qi(p,u.h))}function _t(u,p,v){u.i.set(p,v)}function Ur(u){return _t(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function jr(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function yr(u,p,v){return typeof u=="string"?(u=encodeURI(u).replace(p,Gs),v&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Gs(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var Ks=/[#\/\?@]/g,Bi=/[#\?:]/g,qo=/[#\?]/g,Mh=/[#\?@]/g,Lh=/#/g;function qi(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Cr(u){u.g||(u.g=new Map,u.h=0,u.i&&ji(u.i,function(p,v){u.add(decodeURIComponent(p.replace(/\+/g," ")),v)}))}n=qi.prototype,n.add=function(u,p){Cr(this),this.i=null,u=lt(this,u);var v=this.g.get(u);return v||this.g.set(u,v=[]),v.push(p),this.h+=1,this};function Ue(u,p){Cr(u),p=lt(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function We(u,p){return Cr(u),p=lt(u,p),u.g.has(p)}n.forEach=function(u,p){Cr(this),this.g.forEach(function(v,b){v.forEach(function(q){u.call(p,q,b,this)},this)},this)},n.na=function(){Cr(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),v=[];for(let b=0;b<p.length;b++){const q=u[b];for(let H=0;H<q.length;H++)v.push(p[b])}return v},n.V=function(u){Cr(this);let p=[];if(typeof u=="string")We(this,u)&&(p=p.concat(this.g.get(lt(this,u))));else{u=Array.from(this.g.values());for(let v=0;v<u.length;v++)p=p.concat(u[v])}return p},n.set=function(u,p){return Cr(this),this.i=null,u=lt(this,u),We(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function Gt(u,p,v){Ue(u,p),0<v.length&&(u.i=null,u.g.set(lt(u,p),P(v)),u.h+=v.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var v=0;v<p.length;v++){var b=p[v];const H=encodeURIComponent(String(b)),ye=this.V(b);for(b=0;b<ye.length;b++){var q=H;ye[b]!==""&&(q+="="+encodeURIComponent(String(ye[b]))),u.push(q)}}return this.i=u.join("&")};function lt(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function Fh(u,p){p&&!u.j&&(Cr(u),u.i=null,u.g.forEach(function(v,b){var q=b.toLowerCase();b!=q&&(Ue(this,b),Gt(this,q,v))},u)),u.j=p}function fl(u,p){const v=new js;if(a.Image){const b=new Image;b.onload=y(Xn,v,"TestLoadImage: loaded",!0,p,b),b.onerror=y(Xn,v,"TestLoadImage: error",!1,p,b),b.onabort=y(Xn,v,"TestLoadImage: abort",!1,p,b),b.ontimeout=y(Xn,v,"TestLoadImage: timeout",!1,p,b),a.setTimeout(function(){b.ontimeout&&b.ontimeout()},1e4),b.src=u}else p(!1)}function uc(u,p){const v=new js,b=new AbortController,q=setTimeout(()=>{b.abort(),Xn(v,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:b.signal}).then(H=>{clearTimeout(q),H.ok?Xn(v,"TestPingServer: ok",!0,p):Xn(v,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(q),Xn(v,"TestPingServer: error",!1,p)})}function Xn(u,p,v,b,q){try{q&&(q.onload=null,q.onerror=null,q.onabort=null,q.ontimeout=null),b(v)}catch{}}function pl(){this.g=new Oi}function $h(u,p,v){const b=v||"";try{st(u,function(q,H){let ye=q;c(q)&&(ye=tn(q)),p.push(b+H+"="+encodeURIComponent(ye))})}catch(q){throw p.push(b+"type="+encodeURIComponent("_badmap")),q}}function kr(u){this.l=u.Ub||null,this.j=u.eb||!1}x(kr,il),kr.prototype.g=function(){return new Cn(this.l,this.j)},kr.prototype.i=function(u){return function(){return u}}({});function Cn(u,p){Ve.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(Cn,Ve),n=Cn.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,is(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Br(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,is(this)),this.g&&(this.readyState=3,is(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;cc(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function cc(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?Br(this):is(this),this.readyState==3&&cc(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,Br(this))},n.Qa=function(u){this.g&&(this.response=u,Br(this))},n.ga=function(){this.g&&Br(this)};function Br(u){u.readyState=4,u.l=null,u.j=null,u.v=null,is(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var v=p.next();!v.done;)v=v.value,u.push(v[0]+": "+v[1]),v=p.next();return u.join(`\r
`)};function is(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(Cn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function _r(u){let p="";return pe(u,function(v,b){p+=b,p+=":",p+=v,p+=`\r
`}),p}function ml(u,p,v){e:{for(b in v){var b=!1;break e}b=!0}b||(v=_r(v),typeof u=="string"?v!=null&&encodeURIComponent(String(v)):_t(u,p,v))}function Ft(u){Ve.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(Ft,Ve);var dc=/^https?$/i,gl=["POST","PUT"];n=Ft.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,v,b){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():No.g(),this.v=this.o?rc(this.o):rc(No),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(H){hc(this,H);return}if(u=v||"",v=new Map(this.headers),b)if(Object.getPrototypeOf(b)===Object.prototype)for(var q in b)v.set(q,b[q]);else if(typeof b.keys=="function"&&typeof b.get=="function")for(const H of b.keys())v.set(H,b.get(H));else throw Error("Unknown input type for opt_headers: "+String(b));b=Array.from(v.keys()).find(H=>H.toLowerCase()=="content-type"),q=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(gl,p,void 0))||b||q||v.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[H,ye]of v)this.g.setRequestHeader(H,ye);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{zi(this),this.u=!0,this.g.send(u),this.u=!1}catch(H){hc(this,H)}};function hc(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,zo(u),Hs(u)}function zo(u){u.A||(u.A=!0,$e(u,"complete"),$e(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,$e(this,"complete"),$e(this,"abort"),Hs(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Hs(this,!0)),Ft.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?os(this):this.bb())},n.bb=function(){os(this)};function os(u){if(u.h&&typeof o<"u"&&(!u.v[1]||or(u)!=4||u.Z()!=2)){if(u.u&&or(u)==4)zt(u.Ea,0,u);else if($e(u,"readystatechange"),or(u)==4){u.h=!1;try{const ye=u.Z();e:switch(ye){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var v;if(!(v=p)){var b;if(b=ye===0){var q=String(u.D).match(gr)[1]||null;!q&&a.self&&a.self.location&&(q=a.self.location.protocol.slice(0,-1)),b=!dc.test(q?q.toLowerCase():"")}v=b}if(v)$e(u,"complete"),$e(u,"success");else{u.m=6;try{var H=2<or(u)?u.g.statusText:""}catch{H=""}u.l=H+" ["+u.Z()+"]",zo(u)}}finally{Hs(u)}}}}function Hs(u,p){if(u.g){zi(u);const v=u.g,b=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||$e(u,"ready");try{v.onreadystatechange=b}catch{}}}function zi(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function or(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<or(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),Pn(p)}};function vl(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Uh(u){const p={};u=(u.g&&2<=or(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let b=0;b<u.length;b++){if($(u[b]))continue;var v=V(u[b]);const q=v[0];if(v=v[1],typeof v!="string")continue;v=v.trim();const H=p[q]||[];p[q]=H,H.push(v)}T(p,function(b){return b.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Gi(u,p,v){return v&&v.internalChannelParams&&v.internalChannelParams[u]||p}function yl(u){this.Aa=0,this.i=[],this.j=new js,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Gi("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Gi("baseRetryDelayMs",5e3,u),this.cb=Gi("retryDelaySeedMs",1e4,u),this.Wa=Gi("forwardChannelMaxRetries",2,u),this.wa=Gi("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new lc(u&&u.concurrentRequestLimit),this.Da=new pl,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=yl.prototype,n.la=8,n.G=1,n.connect=function(u,p,v,b){un(0),this.W=u,this.H=p||{},v&&b!==void 0&&(this.H.OSID=v,this.H.OAID=b),this.F=this.X,this.I=_c(this,null,this.W),Go(this)};function Ki(u){if(Hi(u),u.G==3){var p=u.U++,v=vr(u.I);if(_t(v,"SID",u.K),_t(v,"RID",p),_t(v,"TYPE","terminate"),Wi(u,v),p=new Yn(u,u.j,p),p.L=2,p.v=Ur(vr(v)),v=!1,a.navigator&&a.navigator.sendBeacon)try{v=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!v&&a.Image&&(new Image().src=p.v,v=!0),v||(p.g=bc(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Mo(p)}yc(u)}function as(u){u.g&&(_l(u),u.g.cancel(),u.g=null)}function Hi(u){as(u),u.u&&(a.clearTimeout(u.u),u.u=null),Ko(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function Go(u){if(!Fo(u.h)&&!u.s){u.s=!0;var p=u.Ga;Me||en(),Le||(Me(),Le=!0),ln.add(p,u),u.B=0}}function jh(u,p){return dl(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=Rn(g(u.Ga,u,p),vc(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const q=new Yn(this,this.j,u);let H=this.o;if(this.S&&(H?(H=w(H),C(H,this.S)):H=this.S),this.m!==null||this.O||(q.H=H,H=null),this.P)e:{for(var p=0,v=0;v<this.i.length;v++){t:{var b=this.i[v];if("__data__"in b.map&&(b=b.map.__data__,typeof b=="string")){b=b.length;break t}b=void 0}if(b===void 0)break;if(p+=b,4096<p){p=v;break e}if(p===4096||v===this.i.length-1){p=v+1;break e}}p=1e3}else p=1e3;p=pc(this,q,p),v=vr(this.I),_t(v,"RID",u),_t(v,"CVER",22),this.D&&_t(v,"X-HTTP-Session-Id",this.D),Wi(this,v),H&&(this.O?p="headers="+encodeURIComponent(String(_r(H)))+"&"+p:this.m&&ml(v,this.m,H)),zs(this.h,q),this.Ua&&_t(v,"TYPE","init"),this.P?(_t(v,"$req",p),_t(v,"SID","null"),q.T=!0,qs(q,v,null)):qs(q,v,p),this.G=2}}else this.G==3&&(u?fc(this,u):this.i.length==0||Fo(this.h)||fc(this))};function fc(u,p){var v;p?v=p.l:v=u.U++;const b=vr(u.I);_t(b,"SID",u.K),_t(b,"RID",v),_t(b,"AID",u.T),Wi(u,b),u.m&&u.o&&ml(b,u.m,u.o),v=new Yn(u,u.j,v,u.B+1),u.m===null&&(v.H=u.o),p&&(u.i=p.D.concat(u.i)),p=pc(u,v,1e3),v.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),zs(u.h,v),qs(v,b,p)}function Wi(u,p){u.H&&pe(u.H,function(v,b){_t(p,b,v)}),u.l&&st({},function(v,b){_t(p,b,v)})}function pc(u,p,v){v=Math.min(u.i.length,v);var b=u.l?g(u.l.Na,u.l,u):null;e:{var q=u.i;let H=-1;for(;;){const ye=["count="+v];H==-1?0<v?(H=q[0].g,ye.push("ofs="+H)):H=0:ye.push("ofs="+H);let mt=!0;for(let cn=0;cn<v;cn++){let it=q[cn].g;const nn=q[cn].map;if(it-=H,0>it)H=Math.max(0,q[cn].g-100),mt=!1;else try{$h(nn,ye,"req"+it+"_")}catch{b&&b(nn)}}if(mt){b=ye.join("&");break e}}}return u=u.i.splice(0,v),p.D=u,b}function mc(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;Me||en(),Le||(Me(),Le=!0),ln.add(p,u),u.v=0}}function ls(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=Rn(g(u.Fa,u),vc(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,gc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=Rn(g(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,un(10),as(this),gc(this))};function _l(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function gc(u){u.g=new Yn(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=vr(u.qa);_t(p,"RID","rpc"),_t(p,"SID",u.K),_t(p,"AID",u.T),_t(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&_t(p,"TO",u.ja),_t(p,"TYPE","xmlhttp"),Wi(u,p),u.m&&u.o&&ml(p,u.m,u.o),u.L&&(u.g.I=u.L);var v=u.g;u=u.ia,v.L=1,v.v=Ur(vr(p)),v.m=null,v.P=!0,pr(v,u)}n.Za=function(){this.C!=null&&(this.C=null,as(this),ls(this),un(19))};function Ko(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function bl(u,p){var v=null;if(u.g==p){Ko(u),_l(u),u.g=null;var b=2}else if($o(u.h,p))v=p.D,$i(u.h,p),b=1;else return;if(u.G!=0){if(p.o)if(b==1){v=p.m?p.m.length:0,p=Date.now()-p.F;var q=u.B;b=Pr(),$e(b,new ic(b,v)),Go(u)}else mc(u);else if(q=p.s,q==3||q==0&&0<p.X||!(b==1&&jh(u,p)||b==2&&ls(u)))switch(v&&0<v.length&&(p=u.h,p.i=p.i.concat(v)),q){case 1:qr(u,5);break;case 4:qr(u,10);break;case 3:qr(u,6);break;default:qr(u,2)}}}function vc(u,p){let v=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(v*=2),v*p}function qr(u,p){if(u.j.info("Error code "+p),p==2){var v=g(u.fb,u),b=u.Xa;const q=!b;b=new ss(b||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Uo(b,"https"),Ur(b),q?fl(b.toString(),v):uc(b.toString(),v)}else un(2);u.G=0,u.l&&u.l.sa(p),yc(u),Hi(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),un(2)):(this.j.info("Failed to ping google.com"),un(1))};function yc(u){if(u.G=0,u.ka=[],u.l){const p=Ui(u.h);(p.length!=0||u.i.length!=0)&&(S(u.ka,p),S(u.ka,u.i),u.h.i.length=0,P(u.i),u.i.length=0),u.l.ra()}}function _c(u,p,v){var b=v instanceof ss?vr(v):new ss(v);if(b.g!="")p&&(b.g=p+"."+b.g),jo(b,b.s);else{var q=a.location;b=q.protocol,p=p?p+"."+q.hostname:q.hostname,q=+q.port;var H=new ss(null);b&&Uo(H,b),p&&(H.g=p),q&&jo(H,q),v&&(H.l=v),b=H}return v=u.D,p=u.ya,v&&p&&_t(b,v,p),_t(b,"VER",u.la),Wi(u,b),b}function bc(u,p,v){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new Ft(new kr({eb:v})):new Ft(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function wc(){}n=wc.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function br(){}br.prototype.g=function(u,p){return new Gn(u,p)};function Gn(u,p){Ve.call(this),this.g=new yl(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!$(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!$(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new us(this)}x(Gn,Ve),Gn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Gn.prototype.close=function(){Ki(this.g)},Gn.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var v={};v.__data__=u,u=v}else this.u&&(v={},v.__data__=tn(u),u=v);p.i.push(new cl(p.Ya++,u)),p.G==3&&Go(p)},Gn.prototype.N=function(){this.g.l=null,delete this.j,Ki(this.g),delete this.g,Gn.aa.N.call(this)};function wl(u){ol.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const v in p){u=v;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}x(wl,ol);function Ho(){Ar.call(this),this.status=1}x(Ho,Ar);function us(u){this.g=u}x(us,wc),us.prototype.ua=function(){$e(this.g,"a")},us.prototype.ta=function(u){$e(this.g,new wl(u))},us.prototype.sa=function(u){$e(this.g,new Ho)},us.prototype.ra=function(){$e(this.g,"b")},br.prototype.createWebChannel=br.prototype.g,Gn.prototype.send=Gn.prototype.o,Gn.prototype.open=Gn.prototype.m,Gn.prototype.close=Gn.prototype.close,X0=function(){return new br},Y0=function(){return Pr()},J0=Jn,Bf={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},zn.NO_ERROR=0,zn.TIMEOUT=8,zn.HTTP_ERROR=6,qc=zn,ll.COMPLETE="complete",Q0=ll,sc.EventType=Mi,Mi.OPEN="a",Mi.CLOSE="b",Mi.ERROR="c",Mi.MESSAGE="d",Ve.prototype.listen=Ve.prototype.K,Ml=sc,Ft.prototype.listenOnce=Ft.prototype.L,Ft.prototype.getLastError=Ft.prototype.Ka,Ft.prototype.getLastErrorCode=Ft.prototype.Ba,Ft.prototype.getStatus=Ft.prototype.Z,Ft.prototype.getResponseJson=Ft.prototype.Oa,Ft.prototype.getResponseText=Ft.prototype.oa,Ft.prototype.send=Ft.prototype.ea,Ft.prototype.setWithCredentials=Ft.prototype.Ha,W0=Ft}).apply(typeof Sc<"u"?Sc:typeof self<"u"?self:typeof window<"u"?window:{});const Sv="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _n{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}_n.UNAUTHENTICATED=new _n(null),_n.GOOGLE_CREDENTIALS=new _n("google-credentials-uid"),_n.FIRST_PARTY=new _n("first-party-uid"),_n.MOCK_USER=new _n("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let za="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wi=new Fp("@firebase/firestore");function na(){return wi.logLevel}function S$(n){wi.setLogLevel(n)}function ne(n,...e){if(wi.logLevel<=Xe.DEBUG){const t=e.map(Up);wi.debug(`Firestore (${za}): ${n}`,...t)}}function Qt(n,...e){if(wi.logLevel<=Xe.ERROR){const t=e.map(Up);wi.error(`Firestore (${za}): ${n}`,...t)}}function Tr(n,...e){if(wi.logLevel<=Xe.WARN){const t=e.map(Up);wi.warn(`Firestore (${za}): ${n}`,...t)}}function Up(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xe(n="Unexpected state"){const e=`FIRESTORE (${za}) INTERNAL ASSERTION FAILED: `+n;throw Qt(e),new Error(e)}function Se(n,e){n||xe()}function P$(n,e){n||xe()}function _e(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class re extends Vs{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z0{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class zP{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(_n.UNAUTHENTICATED))}shutdown(){}}class GP{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class KP{constructor(e){this.t=e,this.currentUser=_n.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Se(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new bn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new bn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{ne("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(ne("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new bn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(ne("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Se(typeof r.accessToken=="string"),new Z0(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Se(e===null||typeof e=="string"),new _n(e)}}class HP{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=_n.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class WP{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new HP(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(_n.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class eb{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class QP{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Se(this.o===void 0);const r=i=>{i.error!=null&&ne("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,ne("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{ne("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):ne("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Se(typeof t.token=="string"),this.R=t.token,new eb(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class R${getToken(){return Promise.resolve(new eb(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JP(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tb{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=JP(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Fe(n,e){return n<e?-1:n>e?1:0}function Ta(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function nb(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new re(K.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new re(K.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new re(K.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new re(K.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Bt.fromMillis(Date.now())}static fromDate(e){return Bt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Bt(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Fe(this.nanoseconds,e.nanoseconds):Fe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ke{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ke(e)}static min(){return new ke(new Bt(0,0))}static max(){return new ke(new Bt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu{constructor(e,t,r){t===void 0?t=0:t>e.length&&xe(),r===void 0?r=e.length-t:r>e.length-t&&xe(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return hu.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof hu?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ze extends hu{construct(e,t,r){return new Ze(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new re(K.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new Ze(t)}static emptyPath(){return new Ze([])}}const YP=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ut extends hu{construct(e,t,r){return new Ut(e,t,r)}static isValidIdentifier(e){return YP.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ut.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ut(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new re(K.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new re(K.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new re(K.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new re(K.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ut(t)}static emptyPath(){return new Ut([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class we{constructor(e){this.path=e}static fromPath(e){return new we(Ze.fromString(e))}static fromName(e){return new we(Ze.fromString(e).popFirst(5))}static empty(){return new we(Ze.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ze.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ze.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new we(new Ze(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function qf(n){return n.fields.find(e=>e.kind===2)}function eo(n){return n.fields.filter(e=>e.kind!==2)}function XP(n,e){let t=Fe(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=ZP(n.fields[r],e.fields[r]),t!==0)return t;return Fe(n.fields.length,e.fields.length)}xa.UNKNOWN_ID=-1;class fo{constructor(e,t){this.fieldPath=e,this.kind=t}}function ZP(n,e){const t=Ut.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Fe(n.kind,e.kind)}class Aa{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Aa(0,hr.min())}}function rb(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=ke.fromTimestamp(r===1e9?new Bt(t+1,0):new Bt(t,r));return new hr(s,we.empty(),e)}function sb(n){return new hr(n.readTime,n.key,-1)}class hr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new hr(ke.min(),we.empty(),-1)}static max(){return new hr(ke.max(),we.empty(),-1)}}function jp(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=we.comparator(n.documentKey,e.documentKey),t!==0?t:Fe(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ib="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ob{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ci(n){if(n.code!==K.FAILED_PRECONDITION||n.message!==ib)throw n;ne("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&xe(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new z((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof z?t:z.resolve(t)}catch(t){return z.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):z.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):z.reject(t)}static resolve(e){return new z((t,r)=>{t(e)})}static reject(e){return new z((t,r)=>{r(e)})}static waitFor(e){return new z((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=z.resolve(!1);for(const r of e)t=t.next(s=>s?z.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new z((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(d=>{o[c]=d,++a,a===i&&r(o)},d=>s(d))}})}static doWhile(e,t){return new z((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xd{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new bn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Yl(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=Bp(r.target.error);this.V.reject(new Yl(e,s))}}static open(e,t,r,s){try{return new Xd(t,e.transaction(s,r))}catch(i){throw new Yl(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(ne("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new t1(t)}}class Jr{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Jr.S(pn())===12.2&&Qt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return ne("SimpleDb","Removing database:",e),so(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!U0())return!1;if(Jr.v())return!0;const e=pn(),t=Jr.S(e),r=0<t&&t<10,s=ab(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(ne("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Yl(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new re(K.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new re(K.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Yl(e,o))},s.onupgradeneeded=i=>{ne("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{ne("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=Xd.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),z.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(ne("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ab(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class e1{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return so(this.B.delete())}}class Yl extends re{constructor(e,t){super(K.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ki(n){return n.name==="IndexedDbTransactionError"}class t1{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(ne("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(ne("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),so(r)}add(e){return ne("SimpleDb","ADD",this.store.name,e,e),so(this.store.add(e))}get(e){return so(this.store.get(e)).next(t=>(t===void 0&&(t=null),ne("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return ne("SimpleDb","DELETE",this.store.name,e),so(this.store.delete(e))}count(){return ne("SimpleDb","COUNT",this.store.name),so(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new z((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new z((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){ne("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new z((r,s)=>{t.onerror=i=>{const o=Bp(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new z((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new e1(a),c=t(a.primaryKey,a.value,l);if(c instanceof z){const d=c.catch(f=>(l.done(),z.reject(f)));r.push(d)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>z.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function so(n){return new z((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Bp(r.target.error);t(s)}})}let Pv=!1;function Bp(n){const e=Jr.S(pn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new re("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Pv||(Pv=!0,setTimeout(()=>{throw r},0)),r}}return n}class n1{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){ne("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{ne("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){ki(t)?ne("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await Ci(t)}await this.X(6e4)})}}class r1{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return z.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return ne("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(ne("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=sb(i);jp(o,r)>0&&(r=o)}),new hr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}nr.oe=-1;function Mu(n){return n==null}function fu(n){return n===0&&1/n==-1/0}function lb(n){return typeof n=="number"&&Number.isInteger(n)&&!fu(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Un(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Rv(e)),e=s1(n.get(t),e);return Rv(e)}function s1(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function Rv(n){return n+""}function Hr(n){const e=n.length;if(Se(e>=2),e===2)return Se(n.charAt(0)===""&&n.charAt(1)===""),Ze.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&xe(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:xe()}i=o+2}return new Ze(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cv=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zc(n,e){return[n,Un(e)]}function ub(n,e,t){return[n,Un(e),t]}const i1={},o1=["prefixPath","collectionGroup","readTime","documentId"],a1=["prefixPath","collectionGroup","documentId"],l1=["collectionGroup","readTime","prefixPath","documentId"],u1=["canonicalId","targetId"],c1=["targetId","path"],d1=["path","targetId"],h1=["collectionId","parent"],f1=["indexId","uid"],p1=["uid","sequenceNumber"],m1=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],g1=["indexId","uid","orderedDocumentKey"],v1=["userId","collectionPath","documentId"],y1=["userId","collectionPath","largestBatchId"],_1=["userId","collectionGroup","largestBatchId"],cb=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],b1=[...cb,"documentOverlays"],db=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],hb=db,qp=[...hb,"indexConfiguration","indexState","indexEntries"],w1=qp,I1=[...qp,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zf extends ob{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function mn(n,e){const t=_e(n);return Jr.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kv(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Di(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function fb(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function pb(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pt{constructor(e,t){this.comparator=e,this.root=t||En.EMPTY}insert(e,t){return new Pt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,En.BLACK,null,null))}remove(e){return new Pt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,En.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Pc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Pc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Pc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Pc(this.root,e,this.comparator,!0)}}class Pc{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class En{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??En.RED,this.left=s??En.EMPTY,this.right=i??En.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new En(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return En.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return En.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,En.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,En.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw xe();const e=this.left.check();if(e!==this.right.check())throw xe();return e+(this.isRed()?0:1)}}En.EMPTY=null,En.RED=!0,En.BLACK=!1;En.EMPTY=new class{constructor(){this.size=0}get key(){throw xe()}get value(){throw xe()}get color(){throw xe()}get left(){throw xe()}get right(){throw xe()}copy(e,t,r,s,i){return this}insert(e,t,r){return new En(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt{constructor(e){this.comparator=e,this.data=new Pt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Dv(this.data.getIterator())}getIteratorFrom(e){return new Dv(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof yt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new yt(this.comparator);return t.data=e,t}}class Dv{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Jo(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(e){this.fields=e,e.sort(Ut.comparator)}static empty(){return new rr([])}unionWith(e){let t=new yt(Ut.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new rr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ta(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mb extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k$(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new mb("Invalid base64 string: "+i):i}}(e);return new Kt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Kt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Fe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Kt.EMPTY_BYTE_STRING=new Kt("");const E1=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ss(n){if(Se(!!n),typeof n=="string"){let e=0;const t=E1.exec(n);if(Se(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:$t(n.seconds),nanos:$t(n.nanos)}}function $t(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ps(n){return typeof n=="string"?Kt.fromBase64String(n):Kt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zd(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function eh(n){const e=n.mapValue.fields.__previous_value__;return Zd(e)?eh(e):e}function pu(n){const e=Ss(n.mapValue.fields.__local_write_time__.timestampValue);return new Bt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T1{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class vo{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new vo("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof vo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ci={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Gc={nullValue:"NULL_VALUE"};function Ii(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Zd(n)?4:gb(n)?9007199254740991:th(n)?10:11:xe()}function ts(n,e){if(n===e)return!0;const t=Ii(n);if(t!==Ii(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return pu(n).isEqual(pu(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Ss(s.timestampValue),a=Ss(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Ps(s.bytesValue).isEqual(Ps(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return $t(s.geoPointValue.latitude)===$t(i.geoPointValue.latitude)&&$t(s.geoPointValue.longitude)===$t(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return $t(s.integerValue)===$t(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=$t(s.doubleValue),a=$t(i.doubleValue);return o===a?fu(o)===fu(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Ta(n.arrayValue.values||[],e.arrayValue.values||[],ts);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(kv(o)!==kv(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!ts(o[l],a[l])))return!1;return!0}(n,e);default:return xe()}}function mu(n,e){return(n.values||[]).find(t=>ts(t,e))!==void 0}function Ei(n,e){if(n===e)return 0;const t=Ii(n),r=Ii(e);if(t!==r)return Fe(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Fe(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=$t(i.integerValue||i.doubleValue),l=$t(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return Vv(n.timestampValue,e.timestampValue);case 4:return Vv(pu(n),pu(e));case 5:return Fe(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Ps(i),l=Ps(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const d=Fe(a[c],l[c]);if(d!==0)return d}return Fe(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Fe($t(i.latitude),$t(o.latitude));return a!==0?a:Fe($t(i.longitude),$t(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Nv(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,d;const f=i.fields||{},g=o.fields||{},y=(a=f.value)===null||a===void 0?void 0:a.arrayValue,x=(l=g.value)===null||l===void 0?void 0:l.arrayValue,P=Fe(((c=y==null?void 0:y.values)===null||c===void 0?void 0:c.length)||0,((d=x==null?void 0:x.values)===null||d===void 0?void 0:d.length)||0);return P!==0?P:Nv(y,x)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===ci.mapValue&&o===ci.mapValue)return 0;if(i===ci.mapValue)return 1;if(o===ci.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},d=Object.keys(c);l.sort(),d.sort();for(let f=0;f<l.length&&f<d.length;++f){const g=Fe(l[f],d[f]);if(g!==0)return g;const y=Ei(a[l[f]],c[d[f]]);if(y!==0)return y}return Fe(l.length,d.length)}(n.mapValue,e.mapValue);default:throw xe()}}function Vv(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Fe(n,e);const t=Ss(n),r=Ss(e),s=Fe(t.seconds,r.seconds);return s!==0?s:Fe(t.nanos,r.nanos)}function Nv(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Ei(t[s],r[s]);if(i)return i}return Fe(t.length,r.length)}function Sa(n){return Gf(n)}function Gf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Ss(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Ps(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return we.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=Gf(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${Gf(t.fields[o])}`;return s+"}"}(n.mapValue):xe()}function Kc(n){switch(Ii(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=eh(n);return e?16+Kc(e):16;case 5:return 2*n.stringValue.length;case 6:return Ps(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Kc(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Di(r.fields,(i,o)=>{s+=i.length+Kc(o)}),s}(n.mapValue);default:throw xe()}}function yo(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Kf(n){return!!n&&"integerValue"in n}function gu(n){return!!n&&"arrayValue"in n}function Ov(n){return!!n&&"nullValue"in n}function Mv(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Hc(n){return!!n&&"mapValue"in n}function th(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Xl(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Di(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Xl(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Xl(n.arrayValue.values[t]);return e}return Object.assign({},n)}function gb(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const vb={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function x1(n){return"nullValue"in n?Gc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?yo(vo.empty(),we.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?th(n)?vb:{mapValue:{}}:xe()}function A1(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?yo(vo.empty(),we.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?vb:"mapValue"in n?th(n)?{mapValue:{}}:ci:xe()}function Lv(n,e){const t=Ei(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Fv(n,e){const t=Ei(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xn{constructor(e){this.value=e}static empty(){return new xn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Hc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Xl(t)}setAll(e){let t=Ut.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Xl(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Hc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ts(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Hc(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Di(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new xn(Xl(this.value))}}function yb(n){const e=[];return Di(n.fields,(t,r)=>{const s=new Ut([t]);if(Hc(r)){const i=yb(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new rr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Nt(e,0,ke.min(),ke.min(),ke.min(),xn.empty(),0)}static newFoundDocument(e,t,r,s){return new Nt(e,1,t,ke.min(),r,s,0)}static newNoDocument(e,t){return new Nt(e,2,t,ke.min(),ke.min(),xn.empty(),0)}static newUnknownDocument(e,t){return new Nt(e,3,t,ke.min(),ke.min(),xn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ke.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=xn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=xn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ke.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Nt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Nt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ti{constructor(e,t){this.position=e,this.inclusive=t}}function $v(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=we.comparator(we.fromName(o.referenceValue),t.key):r=Ei(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Uv(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ts(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vu{constructor(e,t="asc"){this.field=e,this.dir=t}}function S1(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _b{}class et extends _b{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new P1(e,t,r):t==="array-contains"?new k1(e,r):t==="in"?new xb(e,r):t==="not-in"?new D1(e,r):t==="array-contains-any"?new V1(e,r):new et(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new R1(e,r):new C1(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ei(t,this.value)):t!==null&&Ii(this.value)===Ii(t)&&this.matchesComparison(Ei(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return xe()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class vt extends _b{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new vt(e,t)}matches(e){return Pa(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Pa(n){return n.op==="and"}function Hf(n){return n.op==="or"}function zp(n){return bb(n)&&Pa(n)}function bb(n){for(const e of n.filters)if(e instanceof vt)return!1;return!0}function Wf(n){if(n instanceof et)return n.field.canonicalString()+n.op.toString()+Sa(n.value);if(zp(n))return n.filters.map(e=>Wf(e)).join(",");{const e=n.filters.map(t=>Wf(t)).join(",");return`${n.op}(${e})`}}function wb(n,e){return n instanceof et?function(r,s){return s instanceof et&&r.op===s.op&&r.field.isEqual(s.field)&&ts(r.value,s.value)}(n,e):n instanceof vt?function(r,s){return s instanceof vt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&wb(o,s.filters[a]),!0):!1}(n,e):void xe()}function Ib(n,e){const t=n.filters.concat(e);return vt.create(t,n.op)}function Eb(n){return n instanceof et?function(t){return`${t.field.canonicalString()} ${t.op} ${Sa(t.value)}`}(n):n instanceof vt?function(t){return t.op.toString()+" {"+t.getFilters().map(Eb).join(" ,")+"}"}(n):"Filter"}class P1 extends et{constructor(e,t,r){super(e,t,r),this.key=we.fromName(r.referenceValue)}matches(e){const t=we.comparator(e.key,this.key);return this.matchesComparison(t)}}class R1 extends et{constructor(e,t){super(e,"in",t),this.keys=Tb("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class C1 extends et{constructor(e,t){super(e,"not-in",t),this.keys=Tb("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Tb(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>we.fromName(r.referenceValue))}class k1 extends et{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return gu(t)&&mu(t.arrayValue,this.value)}}class xb extends et{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&mu(this.value.arrayValue,t)}}class D1 extends et{constructor(e,t){super(e,"not-in",t)}matches(e){if(mu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!mu(this.value.arrayValue,t)}}class V1 extends et{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!gu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>mu(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N1{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function Qf(n,e=null,t=[],r=[],s=null,i=null,o=null){return new N1(n,e,t,r,s,i,o)}function _o(n){const e=_e(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Wf(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Mu(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Sa(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Sa(r)).join(",")),e.ue=t}return e.ue}function Lu(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!S1(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!wb(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Uv(n.startAt,e.startAt)&&Uv(n.endAt,e.endAt)}function gd(n){return we.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function vd(n,e){return n.filters.filter(t=>t instanceof et&&t.field.isEqual(e))}function jv(n,e,t){let r=Gc,s=!0;for(const i of vd(n,e)){let o=Gc,a=!0;switch(i.op){case"<":case"<=":o=x1(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Gc}Lv({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Lv({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function Bv(n,e,t){let r=ci,s=!0;for(const i of vd(n,e)){let o=ci,a=!0;switch(i.op){case">=":case">":o=A1(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=ci}Fv({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Fv({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Ab(n,e,t,r,s,i,o,a){return new Ns(n,e,t,r,s,i,o,a)}function Ga(n){return new Ns(n)}function qv(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Gp(n){return n.collectionGroup!==null}function fa(n){const e=_e(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new yt(Ut.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new vu(i,r))}),t.has(Ut.keyField().canonicalString())||e.ce.push(new vu(Ut.keyField(),r))}return e.ce}function jn(n){const e=_e(n);return e.le||(e.le=Pb(e,fa(n))),e.le}function Sb(n){const e=_e(n);return e.he||(e.he=Pb(e,n.explicitOrderBy)),e.he}function Pb(n,e){if(n.limitType==="F")return Qf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new vu(s.field,i)});const t=n.endAt?new Ti(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Ti(n.startAt.position,n.startAt.inclusive):null;return Qf(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Jf(n,e){const t=n.filters.concat([e]);return new Ns(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function yd(n,e,t){return new Ns(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Fu(n,e){return Lu(jn(n),jn(e))&&n.limitType===e.limitType}function Rb(n){return`${_o(jn(n))}|lt:${n.limitType}`}function ra(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>Eb(s)).join(", ")}]`),Mu(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Sa(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Sa(s)).join(",")),`Target(${r})`}(jn(n))}; limitType=${n.limitType})`}function $u(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):we.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of fa(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=$v(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,fa(r),s)||r.endAt&&!function(o,a,l){const c=$v(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,fa(r),s))}(n,e)}function Cb(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function kb(n){return(e,t)=>{let r=!1;for(const s of fa(n)){const i=O1(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function O1(n,e,t){const r=n.field.isKeyField()?we.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?Ei(l,c):xe()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return xe()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Os{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Di(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return pb(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M1=new Pt(we.comparator);function sr(){return M1}const Db=new Pt(we.comparator);function Ll(...n){let e=Db;for(const t of n)e=e.insert(t.key,t);return e}function Vb(n){let e=Db;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Wr(){return Zl()}function Nb(){return Zl()}function Zl(){return new Os(n=>n.toString(),(n,e)=>n.isEqual(e))}const L1=new Pt(we.comparator),F1=new yt(we.comparator);function Ke(...n){let e=F1;for(const t of n)e=e.add(t);return e}const $1=new yt(Fe);function Kp(){return $1}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hp(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fu(e)?"-0":e}}function Ob(n){return{integerValue:""+n}}function Mb(n,e){return lb(e)?Ob(e):Hp(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh{constructor(){this._=void 0}}function U1(n,e,t){return n instanceof Ra?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Zd(i)&&(i=eh(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof bo?Fb(n,e):n instanceof wo?$b(n,e):function(s,i){const o=Lb(s,i),a=zv(o)+zv(s.Pe);return Kf(o)&&Kf(s.Pe)?Ob(a):Hp(s.serializer,a)}(n,e)}function j1(n,e,t){return n instanceof bo?Fb(n,e):n instanceof wo?$b(n,e):t}function Lb(n,e){return n instanceof Ca?function(r){return Kf(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Ra extends nh{}class bo extends nh{constructor(e){super(),this.elements=e}}function Fb(n,e){const t=Ub(e);for(const r of n.elements)t.some(s=>ts(s,r))||t.push(r);return{arrayValue:{values:t}}}class wo extends nh{constructor(e){super(),this.elements=e}}function $b(n,e){let t=Ub(e);for(const r of n.elements)t=t.filter(s=>!ts(s,r));return{arrayValue:{values:t}}}class Ca extends nh{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function zv(n){return $t(n.integerValue||n.doubleValue)}function Ub(n){return gu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uu{constructor(e,t){this.field=e,this.transform=t}}function B1(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof bo&&s instanceof bo||r instanceof wo&&s instanceof wo?Ta(r.elements,s.elements,ts):r instanceof Ca&&s instanceof Ca?ts(r.Pe,s.Pe):r instanceof Ra&&s instanceof Ra}(n.transform,e.transform)}class q1{constructor(e,t){this.version=e,this.transformResults=t}}class jt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new jt}static exists(e){return new jt(void 0,e)}static updateTime(e){return new jt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Wc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class rh{}function jb(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ha(n.key,jt.none()):new Ka(n.key,n.data,jt.none());{const t=n.data,r=xn.empty();let s=new yt(Ut.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Ms(n.key,r,new rr(s.toArray()),jt.none())}}function z1(n,e,t){n instanceof Ka?function(s,i,o){const a=s.value.clone(),l=Kv(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Ms?function(s,i,o){if(!Wc(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=Kv(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(Bb(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function eu(n,e,t,r){return n instanceof Ka?function(i,o,a,l){if(!Wc(i.precondition,o))return a;const c=i.value.clone(),d=Hv(i.fieldTransforms,l,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof Ms?function(i,o,a,l){if(!Wc(i.precondition,o))return a;const c=Hv(i.fieldTransforms,l,o),d=o.data;return d.setAll(Bb(i)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Wc(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function G1(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Lb(r.transform,s||null);i!=null&&(t===null&&(t=xn.empty()),t.set(r.field,i))}return t||null}function Gv(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ta(r,s,(i,o)=>B1(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Ka extends rh{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ms extends rh{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Bb(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Kv(n,e,t){const r=new Map;Se(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,j1(o,a,t[s]))}return r}function Hv(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,U1(i,o,e))}return r}class Ha extends rh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Wp extends rh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qp{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&z1(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=eu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=eu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Nb();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=jb(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(ke.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ke())}isEqual(e){return this.batchId===e.batchId&&Ta(this.mutations,e.mutations,(t,r)=>Gv(t,r))&&Ta(this.baseMutations,e.baseMutations,(t,r)=>Gv(t,r))}}class Jp{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Se(e.mutations.length===r.length);let s=function(){return L1}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Jp(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yp{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qb{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K1{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rn,ot;function zb(n){switch(n){default:return xe();case K.CANCELLED:case K.UNKNOWN:case K.DEADLINE_EXCEEDED:case K.RESOURCE_EXHAUSTED:case K.INTERNAL:case K.UNAVAILABLE:case K.UNAUTHENTICATED:return!1;case K.INVALID_ARGUMENT:case K.NOT_FOUND:case K.ALREADY_EXISTS:case K.PERMISSION_DENIED:case K.FAILED_PRECONDITION:case K.ABORTED:case K.OUT_OF_RANGE:case K.UNIMPLEMENTED:case K.DATA_LOSS:return!0}}function Gb(n){if(n===void 0)return Qt("GRPC error has no .code"),K.UNKNOWN;switch(n){case rn.OK:return K.OK;case rn.CANCELLED:return K.CANCELLED;case rn.UNKNOWN:return K.UNKNOWN;case rn.DEADLINE_EXCEEDED:return K.DEADLINE_EXCEEDED;case rn.RESOURCE_EXHAUSTED:return K.RESOURCE_EXHAUSTED;case rn.INTERNAL:return K.INTERNAL;case rn.UNAVAILABLE:return K.UNAVAILABLE;case rn.UNAUTHENTICATED:return K.UNAUTHENTICATED;case rn.INVALID_ARGUMENT:return K.INVALID_ARGUMENT;case rn.NOT_FOUND:return K.NOT_FOUND;case rn.ALREADY_EXISTS:return K.ALREADY_EXISTS;case rn.PERMISSION_DENIED:return K.PERMISSION_DENIED;case rn.FAILED_PRECONDITION:return K.FAILED_PRECONDITION;case rn.ABORTED:return K.ABORTED;case rn.OUT_OF_RANGE:return K.OUT_OF_RANGE;case rn.UNIMPLEMENTED:return K.UNIMPLEMENTED;case rn.DATA_LOSS:return K.DATA_LOSS;default:return xe()}}(ot=rn||(rn={}))[ot.OK=0]="OK",ot[ot.CANCELLED=1]="CANCELLED",ot[ot.UNKNOWN=2]="UNKNOWN",ot[ot.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ot[ot.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ot[ot.NOT_FOUND=5]="NOT_FOUND",ot[ot.ALREADY_EXISTS=6]="ALREADY_EXISTS",ot[ot.PERMISSION_DENIED=7]="PERMISSION_DENIED",ot[ot.UNAUTHENTICATED=16]="UNAUTHENTICATED",ot[ot.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ot[ot.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ot[ot.ABORTED=10]="ABORTED",ot[ot.OUT_OF_RANGE=11]="OUT_OF_RANGE",ot[ot.UNIMPLEMENTED=12]="UNIMPLEMENTED",ot[ot.INTERNAL=13]="INTERNAL",ot[ot.UNAVAILABLE=14]="UNAVAILABLE",ot[ot.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _d=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kb(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H1=new ho([4294967295,4294967295],0);function Wv(n){const e=Kb().encode(n),t=new H0;return t.update(e),new Uint8Array(t.digest())}function Qv(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new ho([t,r],0),new ho([s,i],0)]}class Xp{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Fl(`Invalid padding: ${t}`);if(r<0)throw new Fl(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Fl(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Fl(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=ho.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(ho.fromNumber(r)));return s.compare(H1)===1&&(s=new ho([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Wv(e),[r,s]=Qv(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Xp(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=Wv(e),[r,s]=Qv(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Fl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Bu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new ju(ke.min(),s,new Pt(Fe),sr(),Ke())}}class Bu{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Bu(r,t,Ke(),Ke(),Ke())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qc{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class Hb{constructor(e,t){this.targetId=e,this.me=t}}class Wb{constructor(e,t,r=Kt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Jv{constructor(){this.fe=0,this.ge=Xv(),this.pe=Kt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Ke(),t=Ke(),r=Ke();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:xe()}}),new Bu(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=Xv()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Se(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class W1{constructor(e){this.Le=e,this.Be=new Map,this.ke=sr(),this.qe=Yv(),this.Qe=new Pt(Fe)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:xe()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(gd(i))if(r===0){const o=new we(i.path);this.Ue(t,o,Nt.newNoDocument(o,ke.min()))}else Se(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}_d==null||_d.et(function(d,f,g,y,x){var P,S,j,$,D,G;const Z={localCacheCount:d,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},pe=f.unchangedNames;return pe&&(Z.bloomFilter={applied:x===0,hashCount:(P=pe==null?void 0:pe.hashCount)!==null&&P!==void 0?P:0,bitmapLength:($=(j=(S=pe==null?void 0:pe.bits)===null||S===void 0?void 0:S.bitmap)===null||j===void 0?void 0:j.length)!==null&&$!==void 0?$:0,padding:(G=(D=pe==null?void 0:pe.bits)===null||D===void 0?void 0:D.padding)!==null&&G!==void 0?G:0,mightContain:T=>{var w;return(w=y==null?void 0:y.mightContain(T))!==null&&w!==void 0&&w}}),Z}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Ps(r).toUint8Array()}catch(l){if(l instanceof mb)return Tr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Xp(o,s,i)}catch(l){return Tr(l instanceof Fl?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&gd(a.target)){const l=new we(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,Nt.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=Ke();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new ju(e,t,this.Qe,this.ke,r);return this.ke=sr(),this.qe=Yv(),this.Qe=new Pt(Fe),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Jv,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new yt(Fe),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||ne("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Jv),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Yv(){return new Pt(we.comparator)}function Xv(){return new Pt(we.comparator)}const Q1=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),J1=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),Y1=(()=>({and:"AND",or:"OR"}))();class X1{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Yf(n,e){return n.useProto3Json||Mu(e)?e:{value:e}}function ka(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Qb(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Z1(n,e){return ka(n,e.toTimestamp())}function Yt(n){return Se(!!n),ke.fromTimestamp(function(t){const r=Ss(t);return new Bt(r.seconds,r.nanos)}(n))}function Zp(n,e){return Xf(n,e).canonicalString()}function Xf(n,e){const t=function(s){return new Ze(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Jb(n){const e=Ze.fromString(n);return Se(ow(e)),e}function yu(n,e){return Zp(n.databaseId,e.path)}function Yr(n,e){const t=Jb(e);if(t.get(1)!==n.databaseId.projectId)throw new re(K.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new re(K.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new we(Zb(t))}function Yb(n,e){return Zp(n.databaseId,e)}function Xb(n){const e=Jb(n);return e.length===4?Ze.emptyPath():Zb(e)}function Zf(n){return new Ze(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Zb(n){return Se(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Zv(n,e,t){return{name:yu(n,e),fields:t.value.mapValue.fields}}function ew(n,e,t){const r=Yr(n,e.name),s=Yt(e.updateTime),i=e.createTime?Yt(e.createTime):ke.min(),o=new xn({mapValue:{fields:e.fields}}),a=Nt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function eR(n,e){return"found"in e?function(r,s){Se(!!s.found),s.found.name,s.found.updateTime;const i=Yr(r,s.found.name),o=Yt(s.found.updateTime),a=s.found.createTime?Yt(s.found.createTime):ke.min(),l=new xn({mapValue:{fields:s.found.fields}});return Nt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Se(!!s.missing),Se(!!s.readTime);const i=Yr(r,s.missing),o=Yt(s.readTime);return Nt.newNoDocument(i,o)}(n,e):xe()}function tR(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:xe()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,d){return c.useProto3Json?(Se(d===void 0||typeof d=="string"),Kt.fromBase64String(d||"")):(Se(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Kt.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const d=c.code===void 0?K.UNKNOWN:Gb(c.code);return new re(d,c.message||"")}(o);t=new Wb(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Yr(n,r.document.name),i=Yt(r.document.updateTime),o=r.document.createTime?Yt(r.document.createTime):ke.min(),a=new xn({mapValue:{fields:r.document.fields}}),l=Nt.newFoundDocument(s,i,o,a),c=r.targetIds||[],d=r.removedTargetIds||[];t=new Qc(c,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Yr(n,r.document),i=r.readTime?Yt(r.readTime):ke.min(),o=Nt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Qc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Yr(n,r.document),i=r.removedTargetIds||[];t=new Qc([],i,s,null)}else{if(!("filter"in e))return xe();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new K1(s,i),a=r.targetId;t=new Hb(a,o)}}return t}function _u(n,e){let t;if(e instanceof Ka)t={update:Zv(n,e.key,e.value)};else if(e instanceof Ha)t={delete:yu(n,e.key)};else if(e instanceof Ms)t={update:Zv(n,e.key,e.data),updateMask:aR(e.fieldMask)};else{if(!(e instanceof Wp))return xe();t={verify:yu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Ra)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof bo)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof wo)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Ca)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw xe()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:Z1(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:xe()}(n,e.precondition)),t}function ep(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?jt.updateTime(Yt(i.updateTime)):i.exists!==void 0?jt.exists(i.exists):jt.none()}(e.currentDocument):jt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Se(a.setToServerValue==="REQUEST_TIME"),l=new Ra;else if("appendMissingElements"in a){const d=a.appendMissingElements.values||[];l=new bo(d)}else if("removeAllFromArray"in a){const d=a.removeAllFromArray.values||[];l=new wo(d)}else"increment"in a?l=new Ca(o,a.increment):xe();const c=Ut.fromServerFormat(a.fieldPath);return new Uu(c,l)}(n,s)):[];if(e.update){e.update.name;const s=Yr(n,e.update.name),i=new xn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new rr(c.map(d=>Ut.fromServerFormat(d)))}(e.updateMask);return new Ms(s,i,o,t,r)}return new Ka(s,i,t,r)}if(e.delete){const s=Yr(n,e.delete);return new Ha(s,t)}if(e.verify){const s=Yr(n,e.verify);return new Wp(s,t)}return xe()}function nR(n,e){return n&&n.length>0?(Se(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?Yt(s.updateTime):Yt(i);return o.isEqual(ke.min())&&(o=Yt(i)),new q1(o,s.transformResults||[])}(t,e))):[]}function tw(n,e){return{documents:[Yb(n,e.path)]}}function sh(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Yb(n,s);const i=function(c){if(c.length!==0)return iw(vt.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(d=>function(g){return{field:ri(g.field),direction:sR(g.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Yf(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function nw(n,e,t,r){const{_t:s,parent:i}=sh(n,e),o={},a=[];let l=0;return t.forEach(c=>{const d=r?c.alias:"aggregate_"+l++;o[d]=c.alias,c.aggregateType==="count"?a.push({alias:d,count:{}}):c.aggregateType==="avg"?a.push({alias:d,avg:{field:ri(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:d,sum:{field:ri(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function rw(n){let e=Xb(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Se(r===1);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(f){const g=sw(f);return g instanceof vt&&zp(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(x){return new vu(sa(x.field),function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,Mu(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,y=f.values||[];return new Ti(y,g)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const g=!f.before,y=f.values||[];return new Ti(y,g)}(t.endAt)),Ab(e,s,o,i,a,"F",l,c)}function rR(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return xe()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function sw(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=sa(t.unaryFilter.field);return et.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=sa(t.unaryFilter.field);return et.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=sa(t.unaryFilter.field);return et.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=sa(t.unaryFilter.field);return et.create(o,"!=",{nullValue:"NULL_VALUE"});default:return xe()}}(n):n.fieldFilter!==void 0?function(t){return et.create(sa(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return xe()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return vt.create(t.compositeFilter.filters.map(r=>sw(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return xe()}}(t.compositeFilter.op))}(n):xe()}function sR(n){return Q1[n]}function iR(n){return J1[n]}function oR(n){return Y1[n]}function ri(n){return{fieldPath:n.canonicalString()}}function sa(n){return Ut.fromServerFormat(n.fieldPath)}function iw(n){return n instanceof et?function(t){if(t.op==="=="){if(Mv(t.value))return{unaryFilter:{field:ri(t.field),op:"IS_NAN"}};if(Ov(t.value))return{unaryFilter:{field:ri(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Mv(t.value))return{unaryFilter:{field:ri(t.field),op:"IS_NOT_NAN"}};if(Ov(t.value))return{unaryFilter:{field:ri(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ri(t.field),op:iR(t.op),value:t.value}}}(n):n instanceof vt?function(t){const r=t.getFilters().map(s=>iw(s));return r.length===1?r[0]:{compositeFilter:{op:oR(t.op),filters:r}}}(n):xe()}function aR(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function ow(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(e,t,r,s,i=ke.min(),o=ke.min(),a=Kt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new ys(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ys(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ys(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ys(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aw{constructor(e){this.ct=e}}function lR(n,e){let t;if(e.document)t=ew(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=we.fromSegments(e.noDocument.path),s=Eo(e.noDocument.readTime);t=Nt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return xe();{const r=we.fromSegments(e.unknownDocument.path),s=Eo(e.unknownDocument.version);t=Nt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Bt(s[0],s[1]);return ke.fromTimestamp(i)}(e.readTime)),t}function ey(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:bd(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:yu(i,o.key),fields:o.data.value.mapValue.fields,updateTime:ka(i,o.version.toTimestamp()),createTime:ka(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Io(e.version)};else{if(!e.isUnknownDocument())return xe();r.unknownDocument={path:t.path.toArray(),version:Io(e.version)}}return r}function bd(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Io(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Eo(n){const e=new Bt(n.seconds,n.nanoseconds);return ke.fromTimestamp(e)}function io(n,e){const t=(e.baseMutations||[]).map(i=>ep(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>ep(n.ct,i)),s=Bt.fromMillis(e.localWriteTimeMs);return new Qp(e.batchId,s,t,r)}function $l(n){const e=Eo(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Eo(n.lastLimboFreeSnapshotVersion):ke.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Se(i.documents.length===1),jn(Ga(Xb(i.documents[0])))}(n.query):function(i){return jn(rw(i))}(n.query),new ys(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Kt.fromBase64String(n.resumeToken))}function lw(n,e){const t=Io(e.snapshotVersion),r=Io(e.lastLimboFreeSnapshotVersion);let s;s=gd(e.target)?tw(n.ct,e.target):sh(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:_o(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function em(n){const e=rw({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?yd(e,e.limit,"L"):e}function cf(n,e){return new Yp(e.largestBatchId,ep(n.ct,e.overlayMutation))}function ty(n,e){const t=e.path.lastSegment();return[n,Un(e.path.popLast()),t]}function ny(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Io(r.readTime),documentKey:Un(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uR{getBundleMetadata(e,t){return ry(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Eo(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return ry(e).put(function(s){return{bundleId:s.id,createTime:Io(Yt(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return sy(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:em(i.bundledQuery),readTime:Eo(i.readTime)}}(r)})}saveNamedQuery(e,t){return sy(e).put(function(s){return{name:s.name,readTime:Io(Yt(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function ry(n){return mn(n,"bundles")}function sy(n){return mn(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ih{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new ih(e,r)}getOverlay(e,t){return Al(e).get(ty(this.userId,t)).next(r=>r?cf(this.serializer,r):null)}getOverlays(e,t){const r=Wr();return z.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Yp(t,o);s.push(this.ht(e,a))}),z.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(Un(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Al(e).j("collectionPathOverlayIndex",a))}),z.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Wr(),i=Un(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Al(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=cf(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Wr();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Al(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,d)=>{const f=cf(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>i)}ht(e,t){return Al(e).put(function(s,i,o){const[a,l,c]=ty(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:_u(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function Al(n){return mn(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cR{Pt(e){return mn(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?Kt.fromUint8Array(r):Kt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oo{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At($t(e.integerValue));else if("doubleValue"in e){const r=$t(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),fu(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=Ss(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Ps(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?gb(e)?this.dt(t,Number.MAX_SAFE_INTEGER):th(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):xe()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At($t(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),we.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}oo.vt=new oo;function dR(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function iy(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=dR(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class hR{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=iy(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=iy(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class fR{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class pR{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class Sl{constructor(){this.jt=new hR,this.Ht=new fR(this.jt),this.Jt=new pR(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new ao(this.indexId,this.documentKey,this.arrayValue,r)}}function Ys(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=oy(n.arrayValue,e.arrayValue),t!==0?t:(t=oy(n.directionalValue,e.directionalValue),t!==0?t:we.comparator(n.documentKey,e.documentKey)))}function oy(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ay{constructor(e){this.Xt=new yt((t,r)=>Ut.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Se(e.collectionGroup===this.collectionId),this.nn)return!1;const t=qf(e);if(t!==void 0&&!this.sn(t))return!1;const r=eo(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new yt(Ut.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new fo(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new fo(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new fo(r.field,r.dir==="asc"?0:1)));return new xa(xa.UNKNOWN_ID,this.collectionId,t,Aa.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uw(n){var e,t;if(Se(n instanceof et||n instanceof vt),n instanceof et){if(n instanceof xb){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>et.create(n.field,"==",i)))||[];return vt.create(s,"or")}return n}const r=n.filters.map(s=>uw(s));return vt.create(r,n.op)}function mR(n){if(n.getFilters().length===0)return[];const e=rp(uw(n));return Se(cw(e)),tp(e)||np(e)?[e]:e.getFilters()}function tp(n){return n instanceof et}function np(n){return n instanceof vt&&zp(n)}function cw(n){return tp(n)||np(n)||function(t){if(t instanceof vt&&Hf(t)){for(const r of t.getFilters())if(!tp(r)&&!np(r))return!1;return!0}return!1}(n)}function rp(n){if(Se(n instanceof et||n instanceof vt),n instanceof et)return n;if(n.filters.length===1)return rp(n.filters[0]);const e=n.filters.map(r=>rp(r));let t=vt.create(e,n.op);return t=wd(t),cw(t)?t:(Se(t instanceof vt),Se(Pa(t)),Se(t.filters.length>1),t.filters.reduce((r,s)=>tm(r,s)))}function tm(n,e){let t;return Se(n instanceof et||n instanceof vt),Se(e instanceof et||e instanceof vt),t=n instanceof et?e instanceof et?function(s,i){return vt.create([s,i],"and")}(n,e):ly(n,e):e instanceof et?ly(e,n):function(s,i){if(Se(s.filters.length>0&&i.filters.length>0),Pa(s)&&Pa(i))return Ib(s,i.getFilters());const o=Hf(s)?s:i,a=Hf(s)?i:s,l=o.filters.map(c=>tm(c,a));return vt.create(l,"or")}(n,e),wd(t)}function ly(n,e){if(Pa(e))return Ib(e,n.getFilters());{const t=e.filters.map(r=>tm(n,r));return vt.create(t,"or")}}function wd(n){if(Se(n instanceof et||n instanceof vt),n instanceof et)return n;const e=n.getFilters();if(e.length===1)return wd(e[0]);if(bb(n))return n;const t=e.map(s=>wd(s)),r=[];return t.forEach(s=>{s instanceof et?r.push(s):s instanceof vt&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:vt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(){this.un=new nm}addToCollectionParentIndex(e,t){return this.un.add(t),z.resolve()}getCollectionParents(e,t){return z.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return z.resolve()}deleteFieldIndex(e,t){return z.resolve()}deleteAllFieldIndexes(e){return z.resolve()}createTargetIndexes(e,t){return z.resolve()}getDocumentsMatchingTarget(e,t){return z.resolve(null)}getIndexType(e,t){return z.resolve(0)}getFieldIndexes(e,t){return z.resolve([])}getNextCollectionGroupToUpdate(e){return z.resolve(null)}getMinOffset(e,t){return z.resolve(hr.min())}getMinOffsetFromCollectionGroup(e,t){return z.resolve(hr.min())}updateCollectionGroup(e,t,r){return z.resolve()}updateIndexEntries(e,t){return z.resolve()}}class nm{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new yt(Ze.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new yt(Ze.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rc=new Uint8Array(0);class vR{constructor(e,t){this.databaseId=t,this.cn=new nm,this.ln=new Os(r=>_o(r),(r,s)=>Lu(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:Un(s)};return uy(e).put(i)}return z.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[nb(t),""],!1,!0);return uy(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Hr(o.parent))}return r})}addFieldIndex(e,t){const r=Pl(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Xo(e);return i.next(a=>{o.put(ny(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=Pl(e),s=Xo(e),i=Yo(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Pl(e),r=Yo(e),s=Xo(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return z.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new ay(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Yo(e);let s=!0;const i=new Map;return z.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Ke();const a=[];return z.forEach(i,(l,c)=>{ne("IndexedDbIndexManager",`Using index ${function(D){return`id=${D.indexId}|cg=${D.collectionGroup}|f=${D.fields.map(G=>`${G.fieldPath}:${G.kind}`).join(",")}`}(l)} to execute ${_o(t)}`);const d=function(D,G){const Z=qf(G);if(Z===void 0)return null;for(const pe of vd(D,Z.fieldPath))switch(pe.op){case"array-contains-any":return pe.value.arrayValue.values||[];case"array-contains":return[pe.value]}return null}(c,l),f=function(D,G){const Z=new Map;for(const pe of eo(G))for(const T of vd(D,pe.fieldPath))switch(T.op){case"==":case"in":Z.set(pe.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return Z.set(pe.fieldPath.canonicalString(),T.value),Array.from(Z.values())}return null}(c,l),g=function(D,G){const Z=[];let pe=!0;for(const T of eo(G)){const w=T.kind===0?jv(D,T.fieldPath,D.startAt):Bv(D,T.fieldPath,D.startAt);Z.push(w.value),pe&&(pe=w.inclusive)}return new Ti(Z,pe)}(c,l),y=function(D,G){const Z=[];let pe=!0;for(const T of eo(G)){const w=T.kind===0?Bv(D,T.fieldPath,D.endAt):jv(D,T.fieldPath,D.endAt);Z.push(w.value),pe&&(pe=w.inclusive)}return new Ti(Z,pe)}(c,l),x=this.In(l,c,g),P=this.In(l,c,y),S=this.Tn(l,c,f),j=this.En(l.indexId,d,x,g.inclusive,P,y.inclusive,S);return z.forEach(j,$=>r.G($,t.limit).next(D=>{D.forEach(G=>{const Z=we.fromSegments(G.documentKey);o.has(Z)||(o=o.add(Z),a.push(Z))})}))}).next(()=>a)}return z.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=mR(vt.create(e.filters,"and")).map(r=>Qf(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),d=[];for(let f=0;f<l;++f){const g=t?this.dn(t[f/c]):Rc,y=this.An(e,g,r[f%c],s),x=this.Rn(e,g,i[f%c],o),P=a.map(S=>this.An(e,g,S,!0));d.push(...this.createRange(y,x,P))}return d}An(e,t,r,s){const i=new ao(e,we.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new ao(e,we.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new ay(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return z.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new yt(Ut.comparator),d=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?d=!0:c=c.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(d?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new Sl;for(const s of eo(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);oo.vt.It(i,o)}return r.zt()}dn(e){const t=new Sl;return oo.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new Sl;return oo.vt.It(yo(this.databaseId,t),r.Yt(function(i){const o=eo(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new Sl);let i=0;for(const o of eo(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&gu(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);oo.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new Sl;l.seed(a.zt()),oo.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof et&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=Pl(e),s=Xo(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return z.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(d,f){const g=f?new Aa(f.sequenceNumber,new hr(Eo(f.readTime),new we(Hr(f.documentKey)),f.largestBatchId)):Aa.empty(),y=d.fields.map(([x,P])=>new fo(Ut.fromServerFormat(x),P));return new xa(d.indexId,d.collectionGroup,y,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Fe(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=Pl(e),i=Xo(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>z.forEach(a,l=>i.put(ny(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return z.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?z.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),z.forEach(a,l=>this.wn(e,s,l).next(c=>{const d=this.Sn(i,l);return c.isEqual(d)?z.resolve():this.bn(e,i,l,c,d)}))))})}Dn(e,t,r,s){return Yo(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return Yo(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=Yo(e);let i=new yt(Ys);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new ao(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new yt(Ys);const s=this.Vn(t,e);if(s==null)return r;const i=qf(t);if(i!=null){const o=e.data.field(i.fieldPath);if(gu(o))for(const a of o.arrayValue.values||[])r=r.add(new ao(t.indexId,e.key,this.dn(a),s))}else r=r.add(new ao(t.indexId,e.key,Rc,s));return r}bn(e,t,r,s,i){ne("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,d,f,g){const y=l.getIterator(),x=c.getIterator();let P=Jo(y),S=Jo(x);for(;P||S;){let j=!1,$=!1;if(P&&S){const D=d(P,S);D<0?$=!0:D>0&&(j=!0)}else P!=null?$=!0:j=!0;j?(f(S),S=Jo(x)):$?(g(P),P=Jo(y)):(P=Jo(y),S=Jo(x))}}(s,i,Ys,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),z.waitFor(o)}yn(e){let t=1;return Xo(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Ys(o,a)).filter((o,a,l)=>!a||Ys(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Ys(o,e),l=Ys(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Rc,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Rc,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return Ys(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(cy)}getMinOffset(e,t){return z.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||xe())).next(cy)}}function uy(n){return mn(n,"collectionParents")}function Yo(n){return mn(n,"indexEntries")}function Pl(n){return mn(n,"indexConfiguration")}function Xo(n){return mn(n,"indexState")}function cy(n){Se(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;jp(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new hr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dy={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class On{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new On(e,On.DEFAULT_COLLECTION_PERCENTILE,On.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dw(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(d,f,g)=>(a++,g.delete()));i.push(l.next(()=>{Se(a===1)}));const c=[];for(const d of t.mutations){const f=ub(e,d.key.path,t.batchId);i.push(s.delete(f)),c.push(d.key)}return z.waitFor(i).next(()=>c)}function Id(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw xe();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */On.DEFAULT_COLLECTION_PERCENTILE=10,On.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,On.DEFAULT=new On(41943040,On.DEFAULT_COLLECTION_PERCENTILE,On.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),On.DISABLED=new On(-1,0,0);class oh{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Se(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new oh(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Xs(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=ia(e),o=Xs(e);return o.add({}).next(a=>{Se(typeof a=="number");const l=new Qp(a,t,r,s),c=function(y,x,P){const S=P.baseMutations.map($=>_u(y.ct,$)),j=P.mutations.map($=>_u(y.ct,$));return{userId:x,batchId:P.batchId,localWriteTimeMs:P.localWriteTime.toMillis(),baseMutations:S,mutations:j}}(this.serializer,this.userId,l),d=[];let f=new yt((g,y)=>Fe(g.canonicalString(),y.canonicalString()));for(const g of s){const y=ub(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),d.push(o.put(c)),d.push(i.put(y,i1))}return f.forEach(g=>{d.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),z.waitFor(d).next(()=>l)})}lookupMutationBatch(e,t){return Xs(e).get(t).next(r=>r?(Se(r.userId===this.userId),io(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?z.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Xs(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Se(a.batchId>=r),i=io(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Xs(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Xs(e).U("userMutationsIndex",t).next(r=>r.map(s=>io(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=zc(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return ia(e).J({range:s},(o,a,l)=>{const[c,d,f]=o,g=Hr(d);if(c===this.userId&&t.path.isEqual(g))return Xs(e).get(f).next(y=>{if(!y)throw xe();Se(y.userId===this.userId),i.push(io(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new yt(Fe);const s=[];return t.forEach(i=>{const o=zc(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=ia(e).J({range:a},(c,d,f)=>{const[g,y,x]=c,P=Hr(y);g===this.userId&&i.path.isEqual(P)?r=r.add(x):f.done()});s.push(l)}),z.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=zc(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new yt(Fe);return ia(e).J({range:o},(l,c,d)=>{const[f,g,y]=l,x=Hr(g);f===this.userId&&r.isPrefixOf(x)?x.length===s&&(a=a.add(y)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(Xs(e).get(i).next(o=>{if(o===null)throw xe();Se(o.userId===this.userId),r.push(io(this.serializer,o))}))}),z.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return dw(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),z.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return z.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return ia(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=Hr(i[1]);s.push(l)}else a.done()}).next(()=>{Se(s.length===0)})})}containsKey(e,t){return hw(e,this.userId,t)}Nn(e){return fw(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function hw(n,e,t){const r=zc(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return ia(n).J({range:i,H:!0},(a,l,c)=>{const[d,f,g]=a;d===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function Xs(n){return mn(n,"mutations")}function ia(n){return mn(n,"documentMutations")}function fw(n){return mn(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new To(0)}static kn(){return new To(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yR{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new To(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>ke.fromTimestamp(new Bt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Zo(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Se(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Zo(e).J((o,a)=>{const l=$l(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>z.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Zo(e).J((r,s)=>{const i=$l(s);t(i)})}qn(e){return hy(e).get("targetGlobalKey").next(t=>(Se(t!==null),t))}Qn(e,t){return hy(e).put("targetGlobalKey",t)}Kn(e,t){return Zo(e).put(lw(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=_o(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Zo(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=$l(a);Lu(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=si(e);return t.forEach(o=>{const a=Un(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),z.waitFor(s)}removeMatchingKeys(e,t,r){const s=si(e);return z.forEach(t,i=>{const o=Un(i.path);return z.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=si(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=si(e);let i=Ke();return s.J({range:r,H:!0},(o,a,l)=>{const c=Hr(o[1]),d=new we(c);i=i.add(d)}).next(()=>i)}containsKey(e,t){const r=Un(t.path),s=IDBKeyRange.bound([r],[nb(r)],!1,!0);let i=0;return si(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return Zo(e).get(t).next(r=>r?$l(r):null)}}function Zo(n){return mn(n,"targets")}function hy(n){return mn(n,"targetGlobal")}function si(n){return mn(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fy([n,e],[t,r]){const s=Fe(n,t);return s===0?Fe(e,r):s}class _R{constructor(e){this.Un=e,this.buffer=new yt(fy),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();fy(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class pw{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){ne("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ki(t)?ne("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Ci(t)}await this.Hn(3e5)})}}class bR{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return z.resolve(nr.oe);const r=new _R(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(ne("LruGarbageCollector","Garbage collection skipped; disabled"),z.resolve(dy)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(ne("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),dy):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(ne("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),na()<=Xe.DEBUG&&ne("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-d}ms`),z.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function mw(n,e){return new bR(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{constructor(e,t){this.db=e,this.garbageCollector=mw(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return Cc(e,r)}removeReference(e,t,r){return Cc(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Cc(e,t)}nr(e,t){return function(s,i){let o=!1;return fw(s).Y(a=>hw(s,a,i).next(l=>(l&&(o=!0),z.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,ke.min()),si(e).delete(function(f){return[0,Un(f.path)]}(o))))});s.push(l)}}).next(()=>z.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Cc(e,t)}tr(e,t){const r=si(e);let s,i=nr.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==nr.oe&&t(new we(Hr(s)),i),i=c,s=l):i=nr.oe}).next(()=>{i!==nr.oe&&t(new we(Hr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Cc(n,e){return si(n).put(function(r,s){return{targetId:0,path:Un(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gw{constructor(){this.changes=new Os(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Nt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?z.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IR{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Yi(e).put(r)}removeEntry(e,t,r){return Yi(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],bd(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Nt.newInvalidDocument(t);return Yi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Rl(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:Nt.newInvalidDocument(t)};return Yi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Rl(t))},(s,i)=>{r={document:this.ir(t,i),size:Id(i)}}).next(()=>r)}getEntries(e,t){let r=sr();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=sr(),s=new Pt(we.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,Id(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return z.resolve();let s=new yt(gy);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Rl(s.first()),Rl(s.last())),o=s.getIterator();let a=o.getNext();return Yi(e).J({index:"documentKeyIndex",range:i},(l,c,d)=>{const f=we.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&gy(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?d.$(Rl(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),bd(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Yi(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let d=sr();for(const f of c){const g=this.ir(we.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&($u(t,g)||s.has(g.key))&&(d=d.insert(g.key,g))}return d})}getAllFromCollectionGroup(e,t,r,s){let i=sr();const o=my(t,r),a=my(t,hr.max());return Yi(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,d)=>{const f=this.ir(we.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&d.done()}).next(()=>i)}newChangeBuffer(e){return new ER(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return py(e).get("remoteDocumentGlobalKey").next(t=>(Se(!!t),t))}rr(e,t){return py(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=lR(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(ke.min())))return r}return Nt.newInvalidDocument(e)}}function vw(n){return new IR(n)}class ER extends gw{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Os(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new yt((i,o)=>Fe(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=ey(this.cr.serializer,o);s=s.add(i.path.popLast());const c=Id(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=ey(this.cr.serializer,o.convertToNoDocument(ke.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),z.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function py(n){return mn(n,"remoteDocumentGlobal")}function Yi(n){return mn(n,"remoteDocumentsV14")}function Rl(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function my(n,e){const t=e.documentKey.path.toArray();return[n,bd(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function gy(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Fe(t[i],r[i]),s)return s;return s=Fe(t.length,r.length),s||(s=Fe(t[t.length-2],r[r.length-2]),s||Fe(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TR{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yw{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&eu(r.mutation,s,rr.empty(),Bt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Ke()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Ke()){const s=Wr();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Ll();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Wr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Ke()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=sr();const o=Zl(),a=function(){return Zl()}();return t.forEach((l,c)=>{const d=r.get(c.key);s.has(c.key)&&(d===void 0||d.mutation instanceof Ms)?i=i.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),eu(d.mutation,c,d.mutation.getFieldMask(),Bt.now())):o.set(c.key,rr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var f;return a.set(c,new TR(d,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Zl();let s=new Pt((o,a)=>o-a),i=Ke();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let d=r.get(l)||rr.empty();d=a.applyToLocalView(c,d),r.set(l,d);const f=(s.get(a.batchId)||Ke()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,d=l.value,f=Nb();d.forEach(g=>{if(!i.has(g)){const y=jb(t.get(g),r.get(g));y!==null&&f.set(g,y),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return z.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return we.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Gp(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):z.resolve(Wr());let a=-1,l=i;return o.next(c=>z.forEach(c,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(d)?z.resolve():this.remoteDocumentCache.getEntry(e,d).next(g=>{l=l.insert(d,g)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,Ke())).next(d=>({batchId:a,changes:Vb(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new we(t)).next(r=>{let s=Ll();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Ll();return this.indexManager.getCollectionParents(e,i).next(a=>z.forEach(a,l=>{const c=function(f,g){return new Ns(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(d=>{d.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const d=c.getKey();o.get(d)===null&&(o=o.insert(d,Nt.newInvalidDocument(d)))});let a=Ll();return o.forEach((l,c)=>{const d=i.get(l);d!==void 0&&eu(d.mutation,c,rr.empty(),Bt.now()),$u(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xR{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return z.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Yt(s.createTime)}}(t)),z.resolve()}getNamedQuery(e,t){return z.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:em(s.bundledQuery),readTime:Yt(s.readTime)}}(t)),z.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AR{constructor(){this.overlays=new Pt(we.comparator),this.Ir=new Map}getOverlay(e,t){return z.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Wr();return z.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),z.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),z.resolve()}getOverlaysForCollection(e,t,r){const s=Wr(),i=t.length+1,o=new we(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return z.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Pt((c,d)=>c-d);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let d=i.get(c.largestBatchId);d===null&&(d=Wr(),i=i.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}const a=Wr(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=s)););return z.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Yp(t,r));let i=this.Ir.get(t);i===void 0&&(i=Ke(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR{constructor(){this.sessionToken=Kt.EMPTY_BYTE_STRING}getSessionToken(e){return z.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,z.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm{constructor(){this.Tr=new yt(yn.Er),this.dr=new yt(yn.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new yn(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new yn(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new we(new Ze([])),r=new yn(t,e),s=new yn(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new we(new Ze([])),r=new yn(t,e),s=new yn(t,e+1);let i=Ke();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new yn(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class yn{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return we.comparator(e.key,t.key)||Fe(e.wr,t.wr)}static Ar(e,t){return Fe(e.wr,t.wr)||we.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PR{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new yt(yn.Er)}checkEmpty(e){return z.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Qp(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new yn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return z.resolve(o)}lookupMutationBatch(e,t){return z.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return z.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return z.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return z.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new yn(t,0),s=new yn(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),z.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new yt(Fe);return t.forEach(s=>{const i=new yn(s,0),o=new yn(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),z.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;we.isDocumentKey(i)||(i=i.child(""));const o=new yn(new we(i),0);let a=new yt(Fe);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),z.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Se(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return z.forEach(t.mutations,s=>{const i=new yn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new yn(t,0),s=this.br.firstAfterOrEqual(r);return z.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,z.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RR{constructor(e){this.Mr=e,this.docs=function(){return new Pt(we.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return z.resolve(r?r.document.mutableCopy():Nt.newInvalidDocument(t))}getEntries(e,t){let r=sr();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Nt.newInvalidDocument(s))}),z.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=sr();const o=t.path,a=new we(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:d}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||jp(sb(d),r)<=0||(s.has(d.key)||$u(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return z.resolve(i)}getAllFromCollectionGroup(e,t,r,s){xe()}Or(e,t){return z.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new CR(this)}getSize(e){return z.resolve(this.size)}}class CR extends gw{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),z.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kR{constructor(e){this.persistence=e,this.Nr=new Os(t=>_o(t),Lu),this.lastRemoteSnapshotVersion=ke.min(),this.highestTargetId=0,this.Lr=0,this.Br=new rm,this.targetCount=0,this.kr=To.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),z.resolve()}getLastRemoteSnapshotVersion(e){return z.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return z.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),z.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),z.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new To(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,z.resolve()}updateTargetData(e,t){return this.Kn(t),z.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,z.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),z.waitFor(i).next(()=>s)}getTargetCount(e){return z.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return z.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),z.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),z.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),z.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return z.resolve(r)}containsKey(e,t){return z.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sm{constructor(e,t){this.qr={},this.overlays={},this.Qr=new nr(0),this.Kr=!1,this.Kr=!0,this.$r=new SR,this.referenceDelegate=e(this),this.Ur=new kR(this),this.indexManager=new gR,this.remoteDocumentCache=function(s){return new RR(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new aw(t),this.Gr=new xR(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new AR,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new PR(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){ne("MemoryPersistence","Starting transaction:",e);const s=new DR(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return z.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class DR extends ob{constructor(e){super(),this.currentSequenceNumber=e}}class ah{constructor(e){this.persistence=e,this.Jr=new rm,this.Yr=null}static Zr(e){return new ah(e)}get Xr(){if(this.Yr)return this.Yr;throw xe()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),z.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),z.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),z.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return z.forEach(this.Xr,r=>{const s=we.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,ke.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return z.or([()=>z.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Ed{constructor(e,t){this.persistence=e,this.ti=new Os(r=>Un(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=mw(this,t)}static Zr(e,t){return new Ed(e,t)}zr(){}jr(e){return z.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return z.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?z.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,ke.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),z.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),z.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),z.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),z.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Kc(e.data.value)),t}nr(e,t,r){return z.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return z.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VR{constructor(e){this.serializer=e}O(e,t,r,s){const i=new Xd("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Cv,{unique:!0}),l.createObjectStore("documentMutations")}(e),vy(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=z.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),vy(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ke.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(d=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Cv,{unique:!0});const f=c.store("mutations"),g=d.map(y=>f.put(y));return z.waitFor(g)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:v1});c.createIndex("collectionPathOverlayIndex",y1,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",_1,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:o1});c.createIndex("documentKeyIndex",a1),c.createIndex("collectionGroupIndex",l1)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:f1}).createIndex("sequenceNumberIndex",p1,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:m1}).createIndex("documentKeyIndex",g1,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Id(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>z.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>z.forEach(a,l=>{Se(l.userId===i.userId);const c=io(this.serializer,l);return dw(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new Ze(o),c=function(f){return[0,Un(f)]}(l);i.push(t.get(c).next(d=>d?z.resolve():(f=>t.put({targetId:0,path:Un(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>z.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:h1});const r=t.store("collectionParents"),s=new nm,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Un(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new Ze(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const d=Hr(a);return i(d.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=$l(s),o=lw(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new we(Ze.fromString(f.document.name).popFirst(5)):f.noDocument?we.fromSegments(f.noDocument.path):f.unknownDocument?we.fromSegments(f.unknownDocument.path):xe()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>z.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=vw(this.serializer),i=new sm(ah.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let d=(c=a.get(l.userId))!==null&&c!==void 0?c:Ke();io(this.serializer,l).keys().forEach(f=>d=d.add(f)),a.set(l.userId,d)}),z.forEach(a,(l,c)=>{const d=new _n(c),f=ih.lt(this.serializer,d),g=i.getIndexManager(d),y=oh.lt(d,this.serializer,g,i.referenceDelegate);return new yw(s,y,f,g).recalculateAndSaveOverlaysForDocumentKeys(new zf(t,nr.oe),l).next()})})}}function vy(n){n.createObjectStore("targetDocuments",{keyPath:c1}).createIndex("documentTargetsIndex",d1,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",u1,{unique:!0}),n.createObjectStore("targetGlobal")}const df="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class im{constructor(e,t,r,s,i,o,a,l,c,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!im.D())throw new re(K.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new wR(this,s),this.Ai=t+"main",this.serializer=new aw(l),this.Ri=new Jr(this.Ai,this.hi,new VR(this.serializer)),this.$r=new cR,this.Ur=new yR(this.referenceDelegate,this.serializer),this.remoteDocumentCache=vw(this.serializer),this.Gr=new uR,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&Qt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new re(K.FAILED_PRECONDITION,df);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new nr(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>kc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(ki(e))return ne("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ne("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Cl(e).get("owner").next(t=>z.resolve(this.vi(t)))}Ci(e){return kc(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=mn(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return z.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?z.resolve(!0):Cl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new re(K.FAILED_PRECONDITION,df);return!1}}return!(!this.networkEnabled||!this.inForeground)||kc(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&ne("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new zf(e,nr.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>kc(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return oh.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new vR(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return ih.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){ne("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?I1:l===16?w1:l===15?qp:l===14?hb:l===13?db:l===12?b1:l===11?cb:void xe()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new zf(a,this.Qr?this.Qr.next():nr.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw Qt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new re(K.FAILED_PRECONDITION,ib);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Cl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new re(K.FAILED_PRECONDITION,df)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Cl(e).put("owner",t)}static D(){return Jr.D()}bi(e){const t=Cl(e);return t.get("owner").next(r=>this.vi(r)?(ne("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):z.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Qt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;$0()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return ne("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Qt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Qt("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Cl(n){return mn(n,"owner")}function kc(n){return mn(n,"clientMetadata")}function om(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class am{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=Ke(),s=Ke();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new am(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NR{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _w{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return $0()?8:ab(pn())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new NR;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(na()<=Xe.DEBUG&&ne("QueryEngine","SDK will not create cache indexes for query:",ra(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),z.resolve()):(na()<=Xe.DEBUG&&ne("QueryEngine","Query:",ra(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(na()<=Xe.DEBUG&&ne("QueryEngine","The SDK decides to create cache indexes for query:",ra(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,jn(t))):z.resolve())}Yi(e,t){if(qv(t))return z.resolve(null);let r=jn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=yd(t,null,"F"),r=jn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Ke(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,yd(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return qv(t)||s.isEqual(ke.min())?z.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?z.resolve(null):(na()<=Xe.DEBUG&&ne("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ra(t)),this.rs(e,o,t,rb(s,-1)).next(a=>a))})}ts(e,t){let r=new yt(kb(e));return t.forEach((s,i)=>{$u(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return na()<=Xe.DEBUG&&ne("QueryEngine","Using full collection scan to execute query:",ra(t)),this.Ji.getDocumentsMatchingQuery(e,t,hr.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OR{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Pt(Fe),this._s=new Os(i=>_o(i),Lu),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new yw(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function bw(n,e,t,r){return new OR(n,e,t,r)}async function ww(n,e){const t=_e(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=Ke();for(const c of s){o.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}for(const c of i){a.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function MR(n,e){const t=_e(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,d){const f=c.batch,g=f.keys();let y=z.resolve();return g.forEach(x=>{y=y.next(()=>d.getEntry(l,x)).next(P=>{const S=c.docVersions.get(x);Se(S!==null),P.version.compareTo(S)<0&&(f.applyToRemoteDocument(P,c),P.isValidDocument()&&(P.setReadTime(c.commitVersion),d.addEntry(P)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=Ke();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function Iw(n){const e=_e(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function LR(n,e){const t=_e(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((d,f)=>{const g=s.get(f);if(!g)return;a.push(t.Ur.removeMatchingKeys(i,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,d.addedDocuments,f)));let y=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(Kt.EMPTY_BYTE_STRING,ke.min()).withLastLimboFreeSnapshotVersion(ke.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,r)),s=s.insert(f,y),function(P,S,j){return P.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-P.snapshotVersion.toMicroseconds()>=3e8?!0:j.addedDocuments.size+j.modifiedDocuments.size+j.removedDocuments.size>0}(g,y,d)&&a.push(t.Ur.updateTargetData(i,y))});let l=sr(),c=Ke();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),a.push(Ew(i,o,e.documentUpdates).next(d=>{l=d.Ps,c=d.Is})),!r.isEqual(ke.min())){const d=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(d)}return z.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function Ew(n,e,t){let r=Ke(),s=Ke();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=sr();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(ke.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):ne("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function FR(n,e){const t=_e(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Da(n,e){const t=_e(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,z.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new ys(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function Va(n,e,t){const r=_e(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!ki(o))throw o;ne("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Td(n,e,t){const r=_e(n);let s=ke.min(),i=Ke();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,d){const f=_e(l),g=f._s.get(d);return g!==void 0?z.resolve(f.os.get(g)):f.Ur.getTargetData(c,d)}(r,o,jn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:ke.min(),t?i:Ke())).next(a=>(Aw(r,Cb(e),a),{documents:a,Ts:i})))}function Tw(n,e){const t=_e(n),r=_e(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function xw(n,e){const t=_e(n),r=t.us.get(e)||ke.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,rb(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(Aw(t,e,s),s))}function Aw(n,e,t){let r=n.us.get(e)||ke.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function $R(n,e,t,r){const s=_e(n);let i=Ke(),o=sr();for(const c of t){const d=e.Es(c.metadata.name);c.document&&(i=i.add(d));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(d,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await Da(s,function(d){return jn(Ga(Ze.fromString(`__bundle__/docs/${d}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>Ew(c,a,o).next(d=>(a.apply(c),d)).next(d=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,d.Ps,d.Is)).next(()=>d.Ps)))}async function UR(n,e,t=Ke()){const r=await Da(n,jn(em(e.bundledQuery))),s=_e(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=Yt(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(Kt.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function yy(n,e){return`firestore_clients_${n}_${e}`}function _y(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function hf(n,e){return`firestore_targets_${n}_${e}`}class xd{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new re(s.error.code,s.error.message))),o?new xd(e,t,s.state,i):(Qt("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class tu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new re(r.error.code,r.error.message))),i?new tu(e,r.state,s):(Qt("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ad{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Kp();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=lb(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Ad(e,i):(Qt("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class lm{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new lm(t.clientId,t.onlineState):(Qt("SharedClientState",`Failed to parse online state: ${e}`),null)}}class sp{constructor(){this.activeTargetIds=Kp()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ff{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Pt(Fe),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=yy(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new sp),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(yy(this.persistenceKey,r));if(s){const i=Ad.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(hf(this.persistenceKey,e));if(s){const i=tu.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(hf(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return ne("SharedClientState","READ",e,t),t}setItem(e,t){ne("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){ne("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(ne("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Qt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=nr.oe;if(i!=null)try{const a=JSON.parse(i);Se(typeof a=="number"),o=a}catch(a){Qt("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==nr.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new xd(this.currentUser,e,t,r),i=_y(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=_y(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=hf(this.persistenceKey,e),i=new tu(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Ad.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return xd.Rs(new _n(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return tu.Rs(s,t)}Ls(e){return lm.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);ne("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Kp();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class Sw{constructor(){this.so=new sp,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new sp,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jR{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class by{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){ne("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){ne("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dc=null;function pf(){return Dc===null?Dc=function(){return 268435456+Math.round(2147483648*Math.random())}():Dc++,"0x"+Dc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qR{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vn="WebChannelConnection";class zR extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=pf(),l=this.xo(t,r.toUriEncodedString());ne("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(d=>(ne("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw Tr("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",l,"request:",s),d})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+za}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=BR[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=pf();return new Promise((o,a)=>{const l=new W0;l.setWithCredentials(!0),l.listenOnce(Q0.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case qc.NO_ERROR:const d=l.getResponseJson();ne(Vn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(d)),o(d);break;case qc.TIMEOUT:ne(Vn,`RPC '${e}' ${i} timed out`),a(new re(K.DEADLINE_EXCEEDED,"Request time out"));break;case qc.HTTP_ERROR:const f=l.getStatus();if(ne(Vn,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const y=g==null?void 0:g.error;if(y&&y.status&&y.message){const x=function(S){const j=S.toLowerCase().replace(/_/g,"-");return Object.values(K).indexOf(j)>=0?j:K.UNKNOWN}(y.status);a(new re(x,y.message))}else a(new re(K.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new re(K.UNAVAILABLE,"Connection failed."));break;default:xe()}}finally{ne(Vn,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);ne(Vn,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=pf(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=X0(),a=Y0(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=i.join("");ne(Vn,`Creating RPC '${e}' stream ${s}: ${d}`,l);const f=o.createWebChannel(d,l);let g=!1,y=!1;const x=new qR({Io:S=>{y?ne(Vn,`Not sending because RPC '${e}' stream ${s} is closed:`,S):(g||(ne(Vn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),ne(Vn,`RPC '${e}' stream ${s} sending:`,S),f.send(S))},To:()=>f.close()}),P=(S,j,$)=>{S.listen(j,D=>{try{$(D)}catch(G){setTimeout(()=>{throw G},0)}})};return P(f,Ml.EventType.OPEN,()=>{y||(ne(Vn,`RPC '${e}' stream ${s} transport opened.`),x.yo())}),P(f,Ml.EventType.CLOSE,()=>{y||(y=!0,ne(Vn,`RPC '${e}' stream ${s} transport closed`),x.So())}),P(f,Ml.EventType.ERROR,S=>{y||(y=!0,Tr(Vn,`RPC '${e}' stream ${s} transport errored:`,S),x.So(new re(K.UNAVAILABLE,"The operation could not be completed")))}),P(f,Ml.EventType.MESSAGE,S=>{var j;if(!y){const $=S.data[0];Se(!!$);const D=$,G=D.error||((j=D[0])===null||j===void 0?void 0:j.error);if(G){ne(Vn,`RPC '${e}' stream ${s} received error:`,G);const Z=G.status;let pe=function(I){const C=rn[I];if(C!==void 0)return Gb(C)}(Z),T=G.message;pe===void 0&&(pe=K.INTERNAL,T="Unknown error status: "+Z+" with message "+G.message),y=!0,x.So(new re(pe,T)),f.close()}else ne(Vn,`RPC '${e}' stream ${s} received:`,$),x.bo($)}}),P(a,J0.STAT_EVENT,S=>{S.stat===Bf.PROXY?ne(Vn,`RPC '${e}' stream ${s} detected buffering proxy`):S.stat===Bf.NOPROXY&&ne(Vn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{x.wo()},0),x}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pw(){return typeof window<"u"?window:null}function Jc(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qu(n){return new X1(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class um{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&ne("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rw{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new um(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===K.RESOURCE_EXHAUSTED?(Qt(t.toString()),Qt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===K.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new re(K.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return ne("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(ne("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class GR extends Rw{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=tR(this.serializer,e),r=function(i){if(!("targetChange"in i))return ke.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?ke.min():o.readTime?Yt(o.readTime):ke.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=Zf(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=gd(l)?{documents:tw(i,l)}:{query:sh(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Qb(i,o.resumeToken);const c=Yf(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(ke.min())>0){a.readTime=ka(i,o.snapshotVersion.toTimestamp());const c=Yf(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=rR(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=Zf(this.serializer),t.removeTarget=e,this.a_(t)}}class KR extends Rw{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Se(!!e.streamToken),this.lastStreamToken=e.streamToken,Se(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Se(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=nR(e.writeResults,e.commitTime),r=Yt(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=Zf(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>_u(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HR extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new re(K.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Xf(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===K.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new re(K.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Xf(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===K.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new re(K.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class WR{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Qt(t),this.D_=!1):ne("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QR{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Vi(this)&&(ne("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=_e(l);c.L_.add(4),await Wa(c),c.q_.set("Unknown"),c.L_.delete(4),await zu(c)}(this))})}),this.q_=new WR(r,s)}}async function zu(n){if(Vi(n))for(const e of n.B_)await e(!0)}async function Wa(n){for(const e of n.B_)await e(!1)}function lh(n,e){const t=_e(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),hm(t)?dm(t):Ja(t).r_()&&cm(t,e))}function Na(n,e){const t=_e(n),r=Ja(t);t.N_.delete(e),r.r_()&&Cw(t,e),t.N_.size===0&&(r.r_()?r.o_():Vi(t)&&t.q_.set("Unknown"))}function cm(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ke.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ja(n).A_(e)}function Cw(n,e){n.Q_.xe(e),Ja(n).R_(e)}function dm(n){n.Q_=new W1({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Ja(n).start(),n.q_.v_()}function hm(n){return Vi(n)&&!Ja(n).n_()&&n.N_.size>0}function Vi(n){return _e(n).L_.size===0}function kw(n){n.Q_=void 0}async function JR(n){n.q_.set("Online")}async function YR(n){n.N_.forEach((e,t)=>{cm(n,e)})}async function XR(n,e){kw(n),hm(n)?(n.q_.M_(e),dm(n)):n.q_.set("Unknown")}async function ZR(n,e,t){if(n.q_.set("Online"),e instanceof Wb&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){ne("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Sd(n,r)}else if(e instanceof Qc?n.Q_.Ke(e):e instanceof Hb?n.Q_.He(e):n.Q_.We(e),!t.isEqual(ke.min()))try{const r=await Iw(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.N_.get(c);d&&i.N_.set(c,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const d=i.N_.get(l);if(!d)return;i.N_.set(l,d.withResumeToken(Kt.EMPTY_BYTE_STRING,d.snapshotVersion)),Cw(i,l);const f=new ys(d.target,l,c,d.sequenceNumber);cm(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){ne("RemoteStore","Failed to raise snapshot:",r),await Sd(n,r)}}async function Sd(n,e,t){if(!ki(e))throw e;n.L_.add(1),await Wa(n),n.q_.set("Offline"),t||(t=()=>Iw(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{ne("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await zu(n)})}function Dw(n,e){return e().catch(t=>Sd(n,t,e))}async function Qa(n){const e=_e(n),t=xi(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;eC(e);)try{const s=await FR(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,tC(e,s)}catch(s){await Sd(e,s)}Vw(e)&&Nw(e)}function eC(n){return Vi(n)&&n.O_.length<10}function tC(n,e){n.O_.push(e);const t=xi(n);t.r_()&&t.V_&&t.m_(e.mutations)}function Vw(n){return Vi(n)&&!xi(n).n_()&&n.O_.length>0}function Nw(n){xi(n).start()}async function nC(n){xi(n).p_()}async function rC(n){const e=xi(n);for(const t of n.O_)e.m_(t.mutations)}async function sC(n,e,t){const r=n.O_.shift(),s=Jp.from(r,e,t);await Dw(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Qa(n)}async function iC(n,e){e&&xi(n).V_&&await async function(r,s){if(function(o){return zb(o)&&o!==K.ABORTED}(s.code)){const i=r.O_.shift();xi(r).s_(),await Dw(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Qa(r)}}(n,e),Vw(n)&&Nw(n)}async function wy(n,e){const t=_e(n);t.asyncQueue.verifyOperationInProgress(),ne("RemoteStore","RemoteStore received new credentials");const r=Vi(t);t.L_.add(3),await Wa(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await zu(t)}async function ip(n,e){const t=_e(n);e?(t.L_.delete(2),await zu(t)):e||(t.L_.add(2),await Wa(t),t.q_.set("Unknown"))}function Ja(n){return n.K_||(n.K_=function(t,r,s){const i=_e(t);return i.w_(),new GR(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:JR.bind(null,n),Ro:YR.bind(null,n),mo:XR.bind(null,n),d_:ZR.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),hm(n)?dm(n):n.q_.set("Unknown")):(await n.K_.stop(),kw(n))})),n.K_}function xi(n){return n.U_||(n.U_=function(t,r,s){const i=_e(t);return i.w_(),new KR(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:nC.bind(null,n),mo:iC.bind(null,n),f_:rC.bind(null,n),g_:sC.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await Qa(n)):(await n.U_.stop(),n.O_.length>0&&(ne("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fm{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new bn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new fm(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new re(K.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ya(n,e){if(Qt("AsyncQueue",`${e}: ${n}`),ki(n))return new re(K.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pa{constructor(e){this.comparator=e?(t,r)=>e(t,r)||we.comparator(t.key,r.key):(t,r)=>we.comparator(t.key,r.key),this.keyedMap=Ll(),this.sortedSet=new Pt(this.comparator)}static emptySet(e){return new pa(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof pa)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new pa;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iy{constructor(){this.W_=new Pt(we.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):xe():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Oa{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Oa(e,t,pa.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Fu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oC{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class aC{constructor(){this.queries=Ey(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=_e(t),i=s.queries;s.queries=Ey(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new re(K.ABORTED,"Firestore shutting down"))}}function Ey(){return new Os(n=>Rb(n),Fu)}async function pm(n,e){const t=_e(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new oC,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Ya(o,`Initialization of query '${ra(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&gm(t)}async function mm(n,e){const t=_e(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function lC(n,e){const t=_e(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&gm(t)}function uC(n,e,t){const r=_e(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function gm(n){n.Y_.forEach(e=>{e.next()})}var op,Ty;(Ty=op||(op={})).ea="default",Ty.Cache="cache";class vm{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Oa(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Oa.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==op.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cC{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xy{constructor(e){this.serializer=e}Es(e){return Yr(this.serializer,e)}ds(e){return e.metadata.exists?ew(this.serializer,e.document,!1):Nt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Yt(e)}}class dC{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Ow(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=Ze.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new xy(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Ke()).add(i);t.set(o,a)}}return t}async complete(){const e=await $R(this.localStore,new xy(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await UR(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function Ow(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mw{constructor(e){this.key=e}}class Lw{constructor(e){this.key=e}}class Fw{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Ke(),this.mutatedKeys=Ke(),this.Aa=kb(e),this.Ra=new pa(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new Iy,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,f)=>{const g=s.get(d),y=$u(this.query,f)?f:null,x=!!g&&this.mutatedKeys.has(g.key),P=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let S=!1;g&&y?g.data.isEqual(y.data)?x!==P&&(r.track({type:3,doc:y}),S=!0):this.ga(g,y)||(r.track({type:2,doc:y}),S=!0,(l&&this.Aa(y,l)>0||c&&this.Aa(y,c)<0)&&(a=!0)):!g&&y?(r.track({type:0,doc:y}),S=!0):g&&!y&&(r.track({type:1,doc:g}),S=!0,(l||c)&&(a=!0)),S&&(y?(o=o.add(y),i=P?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((d,f)=>function(y,x){const P=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return xe()}};return P(y)-P(x)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new Oa(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Iy,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Ke(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new Lw(r))}),this.da.forEach(r=>{e.has(r)||t.push(new Mw(r))}),t}ba(e){this.Ta=e.Ts,this.da=Ke();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Oa.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class hC{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class fC{constructor(e){this.key=e,this.va=!1}}class pC{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Os(a=>Rb(a),Fu),this.Ma=new Map,this.xa=new Set,this.Oa=new Pt(we.comparator),this.Na=new Map,this.La=new rm,this.Ba={},this.ka=new Map,this.qa=To.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function mC(n,e,t=!0){const r=uh(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await $w(r,e,t,!0),s}async function gC(n,e){const t=uh(n);await $w(t,e,!0,!1)}async function $w(n,e,t,r){const s=await Da(n.localStore,jn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await ym(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&lh(n.remoteStore,s),a}async function ym(n,e,t,r,s){n.Ka=(f,g,y)=>async function(P,S,j,$){let D=S.view.ma(j);D.ns&&(D=await Td(P.localStore,S.query,!1).then(({documents:T})=>S.view.ma(T,D)));const G=$&&$.targetChanges.get(S.targetId),Z=$&&$.targetMismatches.get(S.targetId)!=null,pe=S.view.applyChanges(D,P.isPrimaryClient,G,Z);return ap(P,S.targetId,pe.wa),pe.snapshot}(n,f,g,y);const i=await Td(n.localStore,e,!0),o=new Fw(e,i.Ts),a=o.ma(i.documents),l=Bu.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);ap(n,t,c.wa);const d=new hC(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function vC(n,e,t){const r=_e(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Fu(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Va(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Na(r.remoteStore,s.targetId),Ma(r,s.targetId)}).catch(Ci)):(Ma(r,s.targetId),await Va(r.localStore,s.targetId,!0))}async function yC(n,e){const t=_e(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Na(t.remoteStore,r.targetId))}async function _C(n,e,t){const r=Im(n);try{const s=await function(o,a){const l=_e(o),c=Bt.now(),d=a.reduce((y,x)=>y.add(x.key),Ke());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let x=sr(),P=Ke();return l.cs.getEntries(y,d).next(S=>{x=S,x.forEach((j,$)=>{$.isValidDocument()||(P=P.add(j))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,x)).next(S=>{f=S;const j=[];for(const $ of a){const D=G1($,f.get($.key).overlayedDocument);D!=null&&j.push(new Ms($.key,D,yb(D.value.mapValue),jt.exists(!0)))}return l.mutationQueue.addMutationBatch(y,c,j,a)}).next(S=>{g=S;const j=S.applyToLocalDocumentSet(f,P);return l.documentOverlayCache.saveOverlays(y,S.batchId,j)})}).then(()=>({batchId:g.batchId,changes:Vb(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new Pt(Fe)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await Ls(r,s.changes),await Qa(r.remoteStore)}catch(s){const i=Ya(s,"Failed to persist write");t.reject(i)}}async function Uw(n,e){const t=_e(n);try{const r=await LR(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Se(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Se(o.va):s.removedDocuments.size>0&&(Se(o.va),o.va=!1))}),await Ls(t,r,e)}catch(r){await Ci(r)}}function Ay(n,e,t){const r=_e(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=_e(o);l.onlineState=a;let c=!1;l.queries.forEach((d,f)=>{for(const g of f.j_)g.Z_(a)&&(c=!0)}),c&&gm(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function bC(n,e,t){const r=_e(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Pt(we.comparator);o=o.insert(i,Nt.newNoDocument(i,ke.min()));const a=Ke().add(i),l=new ju(ke.min(),new Map,new Pt(Fe),o,a);await Uw(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),wm(r)}else await Va(r.localStore,e,!1).then(()=>Ma(r,e,t)).catch(Ci)}async function wC(n,e){const t=_e(n),r=e.batch.batchId;try{const s=await MR(t.localStore,e);bm(t,r,null),_m(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Ls(t,s)}catch(s){await Ci(s)}}async function IC(n,e,t){const r=_e(n);try{const s=await function(o,a){const l=_e(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(Se(f!==null),d=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>l.localDocuments.getDocuments(c,d))})}(r.localStore,e);bm(r,e,t),_m(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Ls(r,s)}catch(s){await Ci(s)}}async function EC(n,e){const t=_e(n);Vi(t.remoteStore)||ne("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=_e(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Ya(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function _m(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function bm(n,e,t){const r=_e(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Ma(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||jw(n,r)})}function jw(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Na(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),wm(n))}function ap(n,e,t){for(const r of t)r instanceof Mw?(n.La.addReference(r.key,e),TC(n,r)):r instanceof Lw?(ne("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||jw(n,r.key)):xe()}function TC(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(ne("SyncEngine","New document in limbo: "+t),n.xa.add(r),wm(n))}function wm(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new we(Ze.fromString(e)),r=n.qa.next();n.Na.set(r,new fC(t)),n.Oa=n.Oa.insert(t,r),lh(n.remoteStore,new ys(jn(Ga(t.path)),r,"TargetPurposeLimboResolution",nr.oe))}}async function Ls(n,e,t){const r=_e(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var d;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(d=t==null?void 0:t.targetChanges.get(l.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=am.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const d=_e(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>z.forEach(c,g=>z.forEach(g.$i,y=>d.persistence.referenceDelegate.addReference(f,g.targetId,y)).next(()=>z.forEach(g.Ui,y=>d.persistence.referenceDelegate.removeReference(f,g.targetId,y)))))}catch(f){if(!ki(f))throw f;ne("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const g=f.targetId;if(!f.fromCache){const y=d.os.get(g),x=y.snapshotVersion,P=y.withLastLimboFreeSnapshotVersion(x);d.os=d.os.insert(g,P)}}}(r.localStore,i))}async function xC(n,e){const t=_e(n);if(!t.currentUser.isEqual(e)){ne("SyncEngine","User change. New user:",e.toKey());const r=await ww(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new re(K.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Ls(t,r.hs)}}function AC(n,e){const t=_e(n),r=t.Na.get(e);if(r&&r.va)return Ke().add(r.key);{let s=Ke();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function SC(n,e){const t=_e(n),r=await Td(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&ap(t,e.targetId,s.wa),s}async function PC(n,e){const t=_e(n);return xw(t.localStore,e).then(r=>Ls(t,r))}async function RC(n,e,t,r){const s=_e(n),i=await function(a,l){const c=_e(a),d=_e(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,l).next(g=>g?c.localDocuments.getDocuments(f,g):z.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Qa(s.remoteStore):t==="acknowledged"||t==="rejected"?(bm(s,e,r||null),_m(s,e),function(a,l){_e(_e(a).mutationQueue).On(l)}(s.localStore,e)):xe(),await Ls(s,i)):ne("SyncEngine","Cannot apply mutation batch with id: "+e)}async function CC(n,e){const t=_e(n);if(uh(t),Im(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await Sy(t,r.toArray());t.Qa=!0,await ip(t.remoteStore,!0);for(const i of s)lh(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Ma(t,o),Va(t.localStore,o,!0))),Na(t.remoteStore,o)}),await s,await Sy(t,r),function(o){const a=_e(o);a.Na.forEach((l,c)=>{Na(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Pt(we.comparator)}(t),t.Qa=!1,await ip(t.remoteStore,!1)}}async function Sy(n,e,t){const r=_e(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await Da(r.localStore,jn(l[0]));for(const c of l){const d=r.Fa.get(c),f=await SC(r,d);f.snapshot&&i.push(f.snapshot)}}else{const c=await Tw(r.localStore,o);a=await Da(r.localStore,c),await ym(r,Bw(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function Bw(n){return Ab(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function kC(n){return function(t){return _e(_e(t).persistence).Qi()}(_e(n).localStore)}async function DC(n,e,t,r){const s=_e(n);if(s.Qa)return void ne("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await xw(s.localStore,Cb(i[0])),a=ju.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Kt.EMPTY_BYTE_STRING);await Ls(s,o,a);break}case"rejected":await Va(s.localStore,e,!0),Ma(s,e,r);break;default:xe()}}async function VC(n,e,t){const r=uh(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){ne("SyncEngine","Adding an already active target "+s);continue}const i=await Tw(r.localStore,s),o=await Da(r.localStore,i);await ym(r,Bw(i),o.targetId,!1,o.resumeToken),lh(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await Va(r.localStore,s,!1).then(()=>{Na(r.remoteStore,s),Ma(r,s)}).catch(Ci)}}function uh(n){const e=_e(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Uw.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=AC.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=bC.bind(null,e),e.Ca.d_=lC.bind(null,e.eventManager),e.Ca.$a=uC.bind(null,e.eventManager),e}function Im(n){const e=_e(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=wC.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=IC.bind(null,e),e}function NC(n,e,t){const r=_e(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,x){const P=_e(y),S=Yt(x.createTime);return P.persistence.runTransaction("hasNewerBundle","readonly",j=>P.Gr.getBundleMetadata(j,x.id)).then(j=>!!j&&j.createTime.compareTo(S)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(Ow(l));const c=new dC(l,i.localStore,o.serializer);let d=await o.Ua();for(;d;){const g=await c.la(d);g&&a._updateProgress(g),d=await o.Ua()}const f=await c.complete();return await Ls(i,f.Ia,void 0),await function(y,x){const P=_e(y);return P.persistence.runTransaction("Save bundle","readwrite",S=>P.Gr.saveBundleMetadata(S,x))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return Tr("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Ai{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=qu(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return bw(this.persistence,new _w,e.initialUser,this.serializer)}Ga(e){return new sm(ah.Zr,this.serializer)}Wa(e){return new Sw}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ai.provider={build:()=>new Ai};class OC extends Ai{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Se(this.persistence.referenceDelegate instanceof Ed);const r=this.persistence.referenceDelegate.garbageCollector;return new pw(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?On.withCacheSize(this.cacheSizeBytes):On.DEFAULT;return new sm(r=>Ed.Zr(r,t),this.serializer)}}class Em extends Ai{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await Im(this.Ja.syncEngine),await Qa(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return bw(this.persistence,new _w,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new pw(r,e.asyncQueue,t)}Ha(e,t){const r=new r1(t,this.persistence);return new n1(e.asyncQueue,r)}Ga(e){const t=om(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?On.withCacheSize(this.cacheSizeBytes):On.DEFAULT;return new im(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Pw(),Jc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new Sw}}class qw extends Em{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof ff&&(this.sharedClientState.syncEngine={no:RC.bind(null,t),ro:DC.bind(null,t),io:VC.bind(null,t),Qi:kC.bind(null,t),eo:PC.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await CC(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=Pw();if(!ff.D(t))throw new re(K.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=om(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ff(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Si{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ay(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=xC.bind(null,this.syncEngine),await ip(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new aC}()}createDatastore(e){const t=qu(e.databaseInfo.databaseId),r=function(i){return new zR(i)}(e.databaseInfo);return function(i,o,a,l){return new HR(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new QR(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>Ay(this.syncEngine,t,0),function(){return by.D()?new by:new jR}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,d){const f=new pC(s,i,o,a,l,c);return d&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=_e(s);ne("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Wa(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Si.provider={build:()=>new Si};function Py(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ch{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Qt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MC{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new bn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new cC(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LC{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new re(K.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=_e(s),a={documents:i.map(f=>yu(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,Ze.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const g=eR(o.serializer,f);c.set(g.key.toString(),g)});const d=[];return i.forEach(f=>{const g=c.get(f.toString());Se(!!g),d.push(g)}),d}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ha(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=we.fromPath(r);this.mutations.push(new Wp(s,this.precondition(s)))}),await async function(r,s){const i=_e(r),o={writes:s.map(a=>_u(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,Ze.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw xe();t=ke.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new re(K.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ke.min())?jt.exists(!1):jt.updateTime(t):jt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ke.min()))throw new re(K.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return jt.updateTime(t)}return jt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new um(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new LC(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!Mu(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!zb(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $C{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=_n.UNAUTHENTICATED,this.clientId=tb.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{ne("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(ne("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new bn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Ya(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function mf(n,e){n.asyncQueue.verifyOperationInProgress(),ne("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await ww(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function Ry(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Tm(n);ne("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>wy(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>wy(e.remoteStore,s)),n._onlineComponents=e}async function Tm(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){ne("FirestoreClient","Using user provided OfflineComponentProvider");try{await mf(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===K.FAILED_PRECONDITION||s.code===K.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Tr("Error using user provided cache. Falling back to memory cache: "+t),await mf(n,new Ai)}}else ne("FirestoreClient","Using default OfflineComponentProvider"),await mf(n,new Ai);return n._offlineComponents}async function dh(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(ne("FirestoreClient","Using user provided OnlineComponentProvider"),await Ry(n,n._uninitializedComponentsProvider._online)):(ne("FirestoreClient","Using default OnlineComponentProvider"),await Ry(n,new Si))),n._onlineComponents}function zw(n){return Tm(n).then(e=>e.persistence)}function Xa(n){return Tm(n).then(e=>e.localStore)}function Gw(n){return dh(n).then(e=>e.remoteStore)}function xm(n){return dh(n).then(e=>e.syncEngine)}function Kw(n){return dh(n).then(e=>e.datastore)}async function La(n){const e=await dh(n),t=e.eventManager;return t.onListen=mC.bind(null,e.syncEngine),t.onUnlisten=vC.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=gC.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=yC.bind(null,e.syncEngine),t}function UC(n){return n.asyncQueue.enqueue(async()=>{const e=await zw(n),t=await Gw(n);return e.setNetworkEnabled(!0),function(s){const i=_e(s);return i.L_.delete(0),zu(i)}(t)})}function jC(n){return n.asyncQueue.enqueue(async()=>{const e=await zw(n),t=await Gw(n);return e.setNetworkEnabled(!1),async function(s){const i=_e(s);i.L_.add(0),await Wa(i),i.q_.set("Offline")}(t)})}function BC(n,e){const t=new bn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,d){const f=_e(c);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,d))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new re(K.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Ya(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Xa(n),e,t)),t.promise}function Hw(n,e,t={}){const r=new bn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new ch({next:g=>{d.Za(),o.enqueueAndForget(()=>mm(i,f));const y=g.docs.has(a);!y&&g.fromCache?c.reject(new re(K.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&g.fromCache&&l&&l.source==="server"?c.reject(new re(K.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new vm(Ga(a.path),d,{includeMetadataChanges:!0,_a:!0});return pm(i,f)}(await La(n),n.asyncQueue,e,t,r)),r.promise}function qC(n,e){const t=new bn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await Td(s,i,!0),l=new Fw(i,a.Ts),c=l.ma(a.documents),d=l.applyChanges(c,!1);o.resolve(d.snapshot)}catch(a){const l=Ya(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Xa(n),e,t)),t.promise}function Ww(n,e,t={}){const r=new bn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new ch({next:g=>{d.Za(),o.enqueueAndForget(()=>mm(i,f)),g.fromCache&&l.source==="server"?c.reject(new re(K.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new vm(a,d,{includeMetadataChanges:!0,_a:!0});return pm(i,f)}(await La(n),n.asyncQueue,e,t,r)),r.promise}function zC(n,e,t){const r=new bn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await Kw(n);r.resolve(async function(o,a,l){var c;const d=_e(o),{request:f,ut:g,parent:y}=nw(d.serializer,Sb(a),l);d.connection.Fo||delete f.parent;const x=(await d.Lo("RunAggregationQuery",d.serializer.databaseId,y,f,1)).filter(S=>!!S.result);Se(x.length===1);const P=(c=x[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(P).reduce((S,j)=>(S[g[j]]=P[j],S),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function GC(n,e){const t=new ch(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){_e(s).Y_.add(i),i.next()}(await La(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){_e(s).Y_.delete(i)}(await La(n),t))}}function KC(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?Kb().encode(o):o,function(d,f){return new MC(d,f)}(function(d,f){if(d instanceof Uint8Array)return Py(d,f);if(d instanceof ArrayBuffer)return Py(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,qu(e));n.asyncQueue.enqueueAndForget(async()=>{NC(await xm(n),s,r)})}function HC(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=_e(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await Xa(n),e))}function WC(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=_e(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,g,y,x,P){f=[...f],g=[...g],f.sort(y),g.sort(y);const S=f.length,j=g.length;let $=0,D=0;for(;$<j&&D<S;){const G=y(f[D],g[$]);G<0?P(f[D++]):G>0?x(g[$++]):($++,D++)}for(;$<j;)x(g[$++]);for(;D<S;)P(f[D++])}(c,s,XP,d=>{a.push(o.addFieldIndex(l,d))},d=>{a.push(o.deleteFieldIndex(l,d))})).next(()=>z.waitFor(a)))}(await Xa(n),e))}function QC(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){_e(r).ss.zi=s}(await Xa(n),e))}function JC(n){return n.asyncQueue.enqueue(async()=>function(t){const r=_e(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Xa(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qw(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cy=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Am(n,e,t){if(!t)throw new re(K.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function YC(n,e,t,r){if(e===!0&&r===!0)throw new re(K.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ky(n){if(!we.isDocumentKey(n))throw new re(K.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Dy(n){if(we.isDocumentKey(n))throw new re(K.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function hh(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":xe()}function Je(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new re(K.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=hh(n);throw new re(K.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Jw(n,e){if(e<=0)throw new re(K.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vy{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new re(K.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new re(K.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}YC("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Qw((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new re(K.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new re(K.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new re(K.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Gu{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Vy({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new re(K.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new re(K.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Vy(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new zP;switch(r.type){case"firstParty":return new WP(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new re(K.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=Cy.get(t);r&&(ne("ComponentProvider","Removing Datastore"),Cy.delete(t),r.terminate())}(this),Promise.resolve()}}function XC(n,e,t,r={}){var s;const i=(n=Je(n,Gu))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Tr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=_n.MOCK_USER;else{a=_S(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new re(K.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new _n(c)}n._authCredentials=new GP(new Z0(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class An{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new An(this.firestore,e,this._query)}}class Xt{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Xr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Xt(this.firestore,e,this._key)}}class Xr extends An{constructor(e,t,r){super(e,t,Ga(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Xt(this.firestore,null,new we(e))}withConverter(e){return new Xr(this.firestore,e,this._path)}}function He(n,e,...t){if(n=De(n),Am("collection","path",e),n instanceof Gu){const r=Ze.fromString(e,...t);return Dy(r),new Xr(n,null,r)}{if(!(n instanceof Xt||n instanceof Xr))throw new re(K.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ze.fromString(e,...t));return Dy(r),new Xr(n.firestore,null,r)}}function N$(n,e){if(n=Je(n,Gu),Am("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new re(K.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new An(n,null,function(r){return new Ns(Ze.emptyPath(),r)}(e))}function Ae(n,e,...t){if(n=De(n),arguments.length===1&&(e=tb.newId()),Am("doc","path",e),n instanceof Gu){const r=Ze.fromString(e,...t);return ky(r),new Xt(n,null,new we(r))}{if(!(n instanceof Xt||n instanceof Xr))throw new re(K.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ze.fromString(e,...t));return ky(r),new Xt(n.firestore,n instanceof Xr?n.converter:null,new we(r))}}function O$(n,e){return n=De(n),e=De(e),(n instanceof Xt||n instanceof Xr)&&(e instanceof Xt||e instanceof Xr)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Yw(n,e){return n=De(n),e=De(e),n instanceof An&&e instanceof An&&n.firestore===e.firestore&&Fu(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ny{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new um(this,"async_queue_retry"),this.Vu=()=>{const r=Jc();r&&ne("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Jc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Jc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new bn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!ki(e))throw e;ne("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Qt("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=fm.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&xe()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function lp(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class ZC{constructor(){this._progressObserver={},this._taskCompletionResolver=new bn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M$=-1;class It extends Gu{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Ny,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Ny(e),this._firestoreClient=void 0,await e}}}function L$(n,e,t){t||(t="(default)");const r=Ou(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(bi(i,e))return s;throw new re(K.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new re(K.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new re(K.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function ek(n,e){const t=typeof n=="object"?n:z0(),r=typeof n=="string"?n:e||"(default)",s=Ou(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=vS("firestore");i&&XC(s,...i)}return s}function qt(n){if(n._terminated)throw new re(K.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Xw(n),n._firestoreClient}function Xw(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,d){return new T1(a,l,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,Qw(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new $C(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function tk(n,e){Tr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return Zw(n,Si.provider,{build:r=>new Em(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function F$(n){Tr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();Zw(n,Si.provider,{build:t=>new qw(t,e.cacheSizeBytes)})}function Zw(n,e,t){if((n=Je(n,It))._firestoreClient||n._terminated)throw new re(K.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new re(K.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},Xw(n)}function $$(n){if(n._initialized&&!n._terminated)throw new re(K.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new bn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Jr.D())return Promise.resolve();const s=r+"main";await Jr.delete(s)}(om(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function U$(n){return function(t){const r=new bn;return t.asyncQueue.enqueueAndForget(async()=>EC(await xm(t),r)),r.promise}(qt(n=Je(n,It)))}function j$(n){return UC(qt(n=Je(n,It)))}function B$(n){return jC(qt(n=Je(n,It)))}function q$(n){return CP(n.app,"firestore",n._databaseId.database),n._delete()}function z$(n,e){const t=qt(n=Je(n,It)),r=new ZC;return KC(t,n._databaseId,e,r),r}function G$(n,e){return HC(qt(n=Je(n,It)),e).then(t=>t?new An(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bu{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class nk{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo{constructor(e){this._byteString=e}static fromBase64String(e){try{return new xo(Kt.fromBase64String(e))}catch(t){throw new re(K.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new xo(Kt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class So{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new re(K.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ut(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function K$(){return new So("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Po{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new re(K.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new re(K.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Fe(this._lat,e._lat)||Fe(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fh{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rk=/^__.*__$/;class sk{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ms(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ka(e,this.data,t,this.fieldTransforms)}}class eI{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ms(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function tI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw xe()}}class ph{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new ph(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Pd(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(tI(this.Cu)&&rk.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class ik{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||qu(e)}Qu(e,t,r,s=!1){return new ph({Cu:e,methodName:t,qu:r,path:Ut.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ro(n){const e=n._freezeSettings(),t=qu(n._databaseId);return new ik(n._databaseId,!!e.ignoreUndefinedProperties,t)}function mh(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);Nm("Data must be an object, but it was:",o,r);const a=sI(r,o);let l,c;if(i.merge)l=new rr(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const f of i.mergeFields){const g=wu(e,f,t);if(!o.contains(g))throw new re(K.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);oI(d,g)||d.push(g)}l=new rr(d),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new sk(new xn(a),l,c)}class Ku extends Po{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ku}}function nI(n,e,t){return new ph({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Pm extends Po{_toFieldTransform(e){return new Uu(e.path,new Ra)}isEqual(e){return e instanceof Pm}}class Rm extends Po{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=nI(this,e,!0),r=this.Ku.map(i=>Co(i,t)),s=new bo(r);return new Uu(e.path,s)}isEqual(e){return e instanceof Rm&&bi(this.Ku,e.Ku)}}class Cm extends Po{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=nI(this,e,!0),r=this.Ku.map(i=>Co(i,t)),s=new wo(r);return new Uu(e.path,s)}isEqual(e){return e instanceof Cm&&bi(this.Ku,e.Ku)}}class km extends Po{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new Ca(e.serializer,Mb(e.serializer,this.$u));return new Uu(e.path,t)}isEqual(e){return e instanceof km&&this.$u===e.$u}}function Dm(n,e,t,r){const s=n.Qu(1,e,t);Nm("Data must be an object, but it was:",s,r);const i=[],o=xn.empty();Di(r,(l,c)=>{const d=gh(e,l,t);c=De(c);const f=s.Nu(d);if(c instanceof Ku)i.push(d);else{const g=Co(c,f);g!=null&&(i.push(d),o.set(d,g))}});const a=new rr(i);return new eI(o,a,s.fieldTransforms)}function Vm(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[wu(e,r,t)],l=[s];if(i.length%2!=0)throw new re(K.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(wu(e,i[g])),l.push(i[g+1]);const c=[],d=xn.empty();for(let g=a.length-1;g>=0;--g)if(!oI(c,a[g])){const y=a[g];let x=l[g];x=De(x);const P=o.Nu(y);if(x instanceof Ku)c.push(y);else{const S=Co(x,P);S!=null&&(c.push(y),d.set(y,S))}}const f=new rr(c);return new eI(d,f,o.fieldTransforms)}function rI(n,e,t,r=!1){return Co(t,n.Qu(r?4:3,e))}function Co(n,e){if(iI(n=De(n)))return Nm("Unsupported field value:",e,n),sI(n,e);if(n instanceof Po)return function(r,s){if(!tI(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=Co(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=De(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Mb(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Bt.fromDate(r);return{timestampValue:ka(s.serializer,i)}}if(r instanceof Bt){const i=new Bt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ka(s.serializer,i)}}if(r instanceof Sm)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof xo)return{bytesValue:Qb(s.serializer,r._byteString)};if(r instanceof Xt){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Zp(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof fh)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Hp(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${hh(r)}`)}(n,e)}function sI(n,e){const t={};return pb(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Di(n,(r,s)=>{const i=Co(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function iI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Bt||n instanceof Sm||n instanceof xo||n instanceof Xt||n instanceof Po||n instanceof fh)}function Nm(n,e,t){if(!iI(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=hh(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function wu(n,e,t){if((e=De(e))instanceof So)return e._internalPath;if(typeof e=="string")return gh(n,e);throw Pd("Field path arguments must be of type string or ",n,!1,void 0,t)}const ok=new RegExp("[~\\*/\\[\\]]");function gh(n,e,t){if(e.search(ok)>=0)throw Pd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new So(...e.split("."))._internalPath}catch{throw Pd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Pd(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new re(K.INVALID_ARGUMENT,a+n+l)}function oI(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iu{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Xt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new ak(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(vh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class ak extends Iu{data(){return super.data()}}function vh(n,e){return typeof e=="string"?gh(n,e):e instanceof So?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new re(K.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Om{}class Hu extends Om{}function Eu(n,e,...t){let r=[];e instanceof Om&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Za).length,a=i.filter(l=>l instanceof Wu).length;if(o>1||o>0&&a>0)throw new re(K.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Wu extends Hu{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Wu(e,t,r)}_apply(e){const t=this._parse(e);return uI(e._query,t),new An(e.firestore,e.converter,Jf(e._query,t))}_parse(e){const t=Ro(e.firestore);return function(i,o,a,l,c,d,f){let g;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new re(K.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){My(f,d);const y=[];for(const x of f)y.push(Oy(l,i,x));g={arrayValue:{values:y}}}else g=Oy(l,i,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||My(f,d),g=rI(a,o,f,d==="in"||d==="not-in");return et.create(c,d,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Rd(n,e,t){const r=e,s=vh("where",n);return Wu._create(s,r,t)}class Za extends Om{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Za(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:vt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)uI(o,l),o=Jf(o,l)}(e._query,t),new An(e.firestore,e.converter,Jf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function H$(...n){return n.forEach(e=>cI("or",e)),Za._create("or",n)}function W$(...n){return n.forEach(e=>cI("and",e)),Za._create("and",n)}class Mm extends Hu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Mm(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new re(K.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new re(K.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new vu(i,o)}(e._query,this._field,this._direction);return new An(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Ns(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function lk(n,e="asc"){const t=e,r=vh("orderBy",n);return Mm._create(r,t)}class yh extends Hu{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new yh(e,t,r)}_apply(e){return new An(e.firestore,e.converter,yd(e._query,this._limit,this._limitType))}}function Q$(n){return Jw("limit",n),yh._create("limit",n,"F")}function J$(n){return Jw("limitToLast",n),yh._create("limitToLast",n,"L")}class _h extends Hu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new _h(e,t,r)}_apply(e){const t=lI(e,this.type,this._docOrFields,this._inclusive);return new An(e.firestore,e.converter,function(s,i){return new Ns(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function Y$(...n){return _h._create("startAt",n,!0)}function X$(...n){return _h._create("startAfter",n,!1)}class bh extends Hu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new bh(e,t,r)}_apply(e){const t=lI(e,this.type,this._docOrFields,this._inclusive);return new An(e.firestore,e.converter,function(s,i){return new Ns(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function Z$(...n){return bh._create("endBefore",n,!1)}function e6(...n){return bh._create("endAt",n,!0)}function lI(n,e,t,r){if(t[0]=De(t[0]),t[0]instanceof Iu)return function(i,o,a,l,c){if(!l)throw new re(K.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const d=[];for(const f of fa(i))if(f.field.isKeyField())d.push(yo(o,l.key));else{const g=l.data.field(f.field);if(Zd(g))throw new re(K.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const y=f.field.canonicalString();throw new re(K.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(g)}return new Ti(d,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Ro(n.firestore);return function(o,a,l,c,d,f){const g=o.explicitOrderBy;if(d.length>g.length)throw new re(K.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let x=0;x<d.length;x++){const P=d[x];if(g[x].field.isKeyField()){if(typeof P!="string")throw new re(K.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof P}`);if(!Gp(o)&&P.indexOf("/")!==-1)throw new re(K.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${P}' contains a slash.`);const S=o.path.child(Ze.fromString(P));if(!we.isDocumentKey(S))throw new re(K.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${S}' is not because it contains an odd number of segments.`);const j=new we(S);y.push(yo(a,j))}else{const S=rI(l,c,P);y.push(S)}}return new Ti(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function Oy(n,e,t){if(typeof(t=De(t))=="string"){if(t==="")throw new re(K.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Gp(e)&&t.indexOf("/")!==-1)throw new re(K.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Ze.fromString(t));if(!we.isDocumentKey(r))throw new re(K.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return yo(n,new we(r))}if(t instanceof Xt)return yo(n,t._key);throw new re(K.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${hh(t)}.`)}function My(n,e){if(!Array.isArray(n)||n.length===0)throw new re(K.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function uI(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new re(K.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new re(K.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function cI(n,e){if(!(e instanceof Wu||e instanceof Za))throw new re(K.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class dI{convertValue(e,t="none"){switch(Ii(e)){case 0:return null;case 1:return e.booleanValue;case 2:return $t(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ps(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw xe()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Di(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>$t(o.doubleValue));return new fh(i)}convertGeoPoint(e){return new Sm($t(e.latitude),$t(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=eh(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(pu(e));default:return null}}convertTimestamp(e){const t=Ss(e);return new Bt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Ze.fromString(e);Se(ow(r));const s=new vo(r.get(1),r.get(3)),i=new we(r.popFirst(5));return s.isEqual(t)||Qt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class uk extends dI{constructor(e){super(),this.firestore=e}convertBytes(e){return new xo(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Xt(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t6(n){return new bu("sum",wu("sum",n))}function n6(n){return new bu("avg",wu("average",n))}function ck(){return new bu("count")}function r6(n,e){var t,r;return n instanceof bu&&e instanceof bu&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function s6(n,e){return Yw(n.query,e.query)&&bi(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Fa extends Iu{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Yc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(vh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Yc extends Fa{data(e={}){return super.data(e)}}class $a{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new lo(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Yc(this._firestore,this._userDataWriter,r.key,r,new lo(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new re(K.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Yc(s._firestore,s._userDataWriter,a.doc.key,a.doc,new lo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Yc(s._firestore,s._userDataWriter,a.doc.key,a.doc,new lo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,d=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:dk(a.type),doc:l,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function dk(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return xe()}}function i6(n,e){return n instanceof Fa&&e instanceof Fa?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof $a&&e instanceof $a&&n._firestore===e._firestore&&Yw(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sn(n){n=Je(n,Xt);const e=Je(n.firestore,It);return Hw(qt(e),n._key).then(t=>Lm(e,n,t))}class Ni extends dI{constructor(e){super(),this.firestore=e}convertBytes(e){return new xo(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Xt(this.firestore,null,t)}}function o6(n){n=Je(n,Xt);const e=Je(n.firestore,It),t=qt(e),r=new Ni(e);return BC(t,n._key).then(s=>new Fa(e,r,n._key,s,new lo(s!==null&&s.hasLocalMutations,!0),n.converter))}function a6(n){n=Je(n,Xt);const e=Je(n.firestore,It);return Hw(qt(e),n._key,{source:"server"}).then(t=>Lm(e,n,t))}function pt(n){n=Je(n,An);const e=Je(n.firestore,It),t=qt(e),r=new Ni(e);return aI(n._query),Ww(t,n._query).then(s=>new $a(e,r,n,s))}function l6(n){n=Je(n,An);const e=Je(n.firestore,It),t=qt(e),r=new Ni(e);return qC(t,n._query).then(s=>new $a(e,r,n,s))}function u6(n){n=Je(n,An);const e=Je(n.firestore,It),t=qt(e),r=new Ni(e);return Ww(t,n._query,{source:"server"}).then(s=>new $a(e,r,n,s))}function fn(n,e,t){n=Je(n,Xt);const r=Je(n.firestore,It),s=wh(n.converter,e,t);return Qu(r,[mh(Ro(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,jt.none())])}function el(n,e,t,...r){n=Je(n,Xt);const s=Je(n.firestore,It),i=Ro(s);let o;return o=typeof(e=De(e))=="string"||e instanceof So?Vm(i,"updateDoc",n._key,e,t,r):Dm(i,"updateDoc",n._key,e),Qu(s,[o.toMutation(n._key,jt.exists(!0))])}function Ua(n){return Qu(Je(n.firestore,It),[new Ha(n._key,jt.none())])}function Ih(n,e){const t=Je(n.firestore,It),r=Ae(n),s=wh(n.converter,e);return Qu(t,[mh(Ro(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,jt.exists(!1))]).then(()=>r)}function c6(n,...e){var t,r,s;n=De(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||lp(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(lp(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,d;if(n instanceof Xt)c=Je(n.firestore,It),d=Ga(n._key.path),l={next:f=>{e[o]&&e[o](Lm(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=Je(n,An);c=Je(f.firestore,It),d=f._query;const g=new Ni(c);l={next:y=>{e[o]&&e[o](new $a(c,g,f,y))},error:e[o+1],complete:e[o+2]},aI(n._query)}return function(g,y,x,P){const S=new ch(P),j=new vm(y,S,x);return g.asyncQueue.enqueueAndForget(async()=>pm(await La(g),j)),()=>{S.Za(),g.asyncQueue.enqueueAndForget(async()=>mm(await La(g),j))}}(qt(c),d,a,l)}function d6(n,e){return GC(qt(n=Je(n,It)),lp(e)?e:{next:e})}function Qu(n,e){return function(r,s){const i=new bn;return r.asyncQueue.enqueueAndForget(async()=>_C(await xm(r),s,i)),i.promise}(qt(n),e)}function Lm(n,e,t){const r=t.docs.get(e._key),s=new Ni(n);return new Fa(n,s,e._key,r,new lo(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h6(n){return hk(n,{count:ck()})}function hk(n,e){const t=Je(n.firestore,It),r=qt(t),s=fb(e,(i,o)=>new qb(o,i.aggregateType,i._internalFieldPath));return zC(r,n._query,s).then(i=>function(a,l,c){const d=new Ni(a);return new nk(l,d,c)}(t,n,i))}class fk{constructor(e){this.kind="memory",this._onlineComponentProvider=Si.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=Ai.provider}toJSON(){return{kind:this.kind}}}class pk{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=_k(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class mk{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Ai.provider}toJSON(){return{kind:this.kind}}}class gk{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new OC(e)}}toJSON(){return{kind:this.kind}}}function f6(){return new mk}function p6(n){return new gk(n==null?void 0:n.cacheSizeBytes)}function m6(n){return new fk(n)}function g6(n){return new pk(n)}class vk{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Si.provider,this._offlineComponentProvider={build:t=>new Em(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class yk{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Si.provider,this._offlineComponentProvider={build:t=>new qw(t,e==null?void 0:e.cacheSizeBytes)}}}function _k(n){return new vk(n==null?void 0:n.forceOwnership)}function v6(){return new yk}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bk={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ro(e)}set(e,t,r){this._verifyNotCommitted();const s=ii(e,this._firestore),i=wh(s.converter,t,r),o=mh(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,jt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=ii(e,this._firestore);let o;return o=typeof(t=De(t))=="string"||t instanceof So?Vm(this._dataReader,"WriteBatch.update",i._key,t,r,s):Dm(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,jt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ii(e,this._firestore);return this._mutations=this._mutations.concat(new Ha(t._key,jt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new re(K.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ii(n,e){if((n=De(n)).firestore!==e)throw new re(K.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ik extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Ro(t)}get(t){const r=ii(t,this._firestore),s=new uk(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return xe();const o=i[0];if(o.isFoundDocument())return new Iu(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new Iu(this._firestore,s,r._key,null,r.converter);throw xe()})}set(t,r,s){const i=ii(t,this._firestore),o=wh(i.converter,r,s),a=mh(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=ii(t,this._firestore);let a;return a=typeof(r=De(r))=="string"||r instanceof So?Vm(this._dataReader,"Transaction.update",o._key,r,s,i):Dm(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=ii(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ii(e,this._firestore),r=new Ni(this._firestore);return super.get(e).then(s=>new Fa(this._firestore,r,t._key,s._document,new lo(!1,!1),t.converter))}}function _6(n,e,t){n=Je(n,It);const r=Object.assign(Object.assign({},bk),t);return function(i){if(i.maxAttempts<1)throw new re(K.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new bn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await Kw(i);new FC(i.asyncQueue,c,a,o,l).au()}),l.promise}(qt(n),s=>e(new Ik(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b6(){return new Ku("deleteField")}function Ju(){return new Pm("serverTimestamp")}function w6(...n){return new Rm("arrayUnion",n)}function I6(...n){return new Cm("arrayRemove",n)}function E6(n){return new km("increment",n)}function T6(n){return new fh(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fm(n){return qt(n=Je(n,It)),new wk(n,e=>Qu(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x6(n,e){const t=qt(n=Je(n,It));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Tr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(d){throw new re(K.INVALID_ARGUMENT,"Failed to parse JSON: "+(d==null?void 0:d.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=Ly(l,"collectionGroup"),d=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=gh("setIndexConfiguration",Ly(f,"fieldPath"));f.arrayConfig==="CONTAINS"?d.push(new fo(g,2)):f.order==="ASCENDING"?d.push(new fo(g,0)):f.order==="DESCENDING"&&d.push(new fo(g,1))}a.push(new xa(xa.UNKNOWN_ID,c,d,Aa.empty()))}return a}(e);return WC(t,r)}function Ly(n,e){if(typeof n[e]!="string")throw new re(K.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function A6(n){var e;n=Je(n,It);const t=Fy.get(n);if(t)return t;if(((e=qt(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new Ek(n);return Fy.set(n,r),r}function S6(n){hI(n,!0)}function P6(n){hI(n,!1)}function R6(n){JC(qt(n._firestore)).then(e=>ne("deleting all persistent cache indexes succeeded")).catch(e=>Tr("deleting all persistent cache indexes failed",e))}function hI(n,e){QC(qt(n._firestore),e).then(t=>ne(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>Tr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const Fy=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C6(n){var e;const t=(e=qt(Je(n.firestore,It))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:sh(t,jn(n._query))._t}function k6(n,e){var t;const r=fb(e,(i,o)=>new qb(o,i.aggregateType,i._internalFieldPath)),s=(t=qt(Je(n.firestore,It))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:nw(s,Sb(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D6{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return $m.instance.onExistenceFilterMismatch(e)}}class $m{constructor(){this.Uu=new Map}static get instance(){return Vc||(Vc=new $m,function(t){if(_d)throw new Error("a TestingHooksSpi instance is already set");_d=t}(Vc)),Vc}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let Vc=null;(function(e,t=!0){(function(s){za=s})(qa),Ea(new go("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new It(new KP(r.getProvider("auth-internal")),new QP(r.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new re(K.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vo(c.options.projectId,d)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),pi(Sv,"4.7.3",e),pi(Sv,"4.7.3","esm2017")})();function Um(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V6={PHONE:"phone",TOTP:"totp"},N6={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},O6={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},M6={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},L6={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tk(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function fI(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const F6=Tk,xk=fI,pI=new Nu("auth","Firebase",fI()),$6={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cd=new Fp("@firebase/auth");function Ak(n,...e){Cd.logLevel<=Xe.WARN&&Cd.warn(`Auth (${qa}): ${n}`,...e)}function Xc(n,...e){Cd.logLevel<=Xe.ERROR&&Cd.error(`Auth (${qa}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ir(n,...e){throw Bm(n,...e)}function Qn(n,...e){return Bm(n,...e)}function jm(n,e,t){const r=Object.assign(Object.assign({},xk()),{[e]:t});return new Nu("auth","Firebase",r).create(e,{appName:n.name})}function wn(n){return jm(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function tl(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&ir(n,"argument-error"),jm(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Bm(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return pI.create(n,...e)}function ge(n,e,...t){if(!n)throw Bm(e,...t)}function Qr(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Xc(e),new Error(e)}function Rs(n,e){n||Qr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tu(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function qm(){return $y()==="http:"||$y()==="https:"}function $y(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sk(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(qm()||ES()||"connection"in navigator)?navigator.onLine:!0}function Pk(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu{constructor(e,t){this.shortDelay=e,this.longDelay=t,Rs(t>e,"Short delay should be less than long delay!"),this.isMobile=bS()||TS()}get(){return Sk()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zm(n,e){Rs(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mI{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Qr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Qr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Qr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ck=new Yu(3e4,6e4);function Ot(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Mt(n,e,t,r,s={}){return gI(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Ba(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return IS()||(c.referrerPolicy="no-referrer"),mI.fetch()(vI(n,n.config.apiHost,t,a),c)})}async function gI(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},Rk),e);try{const s=new Dk(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Ul(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ul(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Ul(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Ul(n,"user-disabled",o);const d=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw jm(n,d,c);ir(n,d)}}catch(s){if(s instanceof Vs)throw s;ir(n,"network-request-failed",{message:String(s)})}}async function Fs(n,e,t,r,s={}){const i=await Mt(n,e,t,r,s);return"mfaPendingCredential"in i&&ir(n,"multi-factor-auth-required",{_serverResponse:i}),i}function vI(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?zm(n.config,s):`${n.config.apiScheme}://${s}`}function kk(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Dk{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Qn(this.auth,"network-request-failed")),Ck.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ul(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Qn(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uy(n){return n!==void 0&&n.getResponse!==void 0}function jy(n){return n!==void 0&&n.enterprise!==void 0}class yI{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return kk(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vk(n){return(await Mt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function _I(n,e){return Mt(n,"GET","/v2/recaptchaConfig",Ot(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nk(n,e){return Mt(n,"POST","/v1/accounts:delete",e)}async function Ok(n,e){return Mt(n,"POST","/v1/accounts:update",e)}async function bI(n,e){return Mt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nu(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U6(n,e=!1){return De(n).getIdToken(e)}async function Mk(n,e=!1){const t=De(n),r=await t.getIdToken(e),s=Eh(r);ge(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:nu(gf(s.auth_time)),issuedAtTime:nu(gf(s.iat)),expirationTime:nu(gf(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function gf(n){return Number(n)*1e3}function Eh(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Xc("JWT malformed, contained fewer than 3 sections"),null;try{const s=O0(t);return s?JSON.parse(s):(Xc("Failed to decode base64 JWT payload"),null)}catch(s){return Xc("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function By(n){const e=Eh(n);return ge(e,"internal-error"),ge(typeof e.exp<"u","internal-error"),ge(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cs(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Vs&&Lk(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Lk({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class up{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=nu(this.lastLoginAt),this.creationTime=nu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xu(n){var e;const t=n.auth,r=await n.getIdToken(),s=await Cs(n,bI(t,{idToken:r}));ge(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?wI(i.providerUserInfo):[],a=Uk(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new up(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function $k(n){const e=De(n);await xu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Uk(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function wI(n){return n.map(e=>{var{providerId:t}=e,r=Um(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jk(n,e){const t=await gI(n,{},async()=>{const r=Ba({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=vI(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",mI.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Bk(n,e){return Mt(n,"POST","/v2/accounts:revokeToken",Ot(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ma{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ge(e.idToken,"internal-error"),ge(typeof e.idToken<"u","internal-error"),ge(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):By(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ge(e.length!==0,"internal-error");const t=By(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ge(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await jk(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new ma;return r&&(ge(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(ge(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(ge(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ma,this.toJSON())}_performRefresh(){return Qr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zs(n,e){ge(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class _s{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=Um(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Fk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new up(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Cs(this,this.stsTokenManager.getToken(this.auth,e));return ge(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Mk(this,e)}reload(){return $k(this)}_assign(e){this!==e&&(ge(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new _s(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){ge(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await xu(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Jt(this.auth.app))return Promise.reject(wn(this.auth));const e=await this.getIdToken();return await Cs(this,Nk(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,d;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(s=t.email)!==null&&s!==void 0?s:void 0,y=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,x=(o=t.photoURL)!==null&&o!==void 0?o:void 0,P=(a=t.tenantId)!==null&&a!==void 0?a:void 0,S=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,j=(c=t.createdAt)!==null&&c!==void 0?c:void 0,$=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:D,emailVerified:G,isAnonymous:Z,providerData:pe,stsTokenManager:T}=t;ge(D&&T,e,"internal-error");const w=ma.fromJSON(this.name,T);ge(typeof D=="string",e,"internal-error"),Zs(f,e.name),Zs(g,e.name),ge(typeof G=="boolean",e,"internal-error"),ge(typeof Z=="boolean",e,"internal-error"),Zs(y,e.name),Zs(x,e.name),Zs(P,e.name),Zs(S,e.name),Zs(j,e.name),Zs($,e.name);const I=new _s({uid:D,auth:e,email:g,emailVerified:G,displayName:f,isAnonymous:Z,photoURL:x,phoneNumber:y,tenantId:P,stsTokenManager:w,createdAt:j,lastLoginAt:$});return pe&&Array.isArray(pe)&&(I.providerData=pe.map(C=>Object.assign({},C))),S&&(I._redirectEventId=S),I}static async _fromIdTokenResponse(e,t,r=!1){const s=new ma;s.updateFromServerResponse(t);const i=new _s({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await xu(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];ge(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?wI(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new ma;a.updateFromIdToken(r);const l=new _s({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new up(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qy=new Map;function bs(n){Rs(n instanceof Function,"Expected a class definition");let e=qy.get(n);return e?(Rs(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,qy.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class II{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}II.type="NONE";const zy=II;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zc(n,e,t){return`firebase:${n}:${e}:${t}`}class ga{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Zc(this.userKey,s.apiKey,i),this.fullPersistenceKey=Zc("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?_s._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new ga(bs(zy),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||bs(zy);const o=Zc(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const d=await c._get(o);if(d){const f=_s._fromJSON(e,d);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new ga(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new ga(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gy(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(AI(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(EI(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(PI(e))return"Blackberry";if(RI(e))return"Webos";if(TI(e))return"Safari";if((e.includes("chrome/")||xI(e))&&!e.includes("edge/"))return"Chrome";if(SI(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function EI(n=pn()){return/firefox\//i.test(n)}function TI(n=pn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function xI(n=pn()){return/crios\//i.test(n)}function AI(n=pn()){return/iemobile/i.test(n)}function SI(n=pn()){return/android/i.test(n)}function PI(n=pn()){return/blackberry/i.test(n)}function RI(n=pn()){return/webos/i.test(n)}function Gm(n=pn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function qk(n=pn()){var e;return Gm(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function zk(){return xS()&&document.documentMode===10}function CI(n=pn()){return Gm(n)||SI(n)||RI(n)||PI(n)||/windows phone/i.test(n)||AI(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kI(n,e=[]){let t;switch(n){case"Browser":t=Gy(pn());break;case"Worker":t=`${Gy(pn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${qa}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gk{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kk(n,e={}){return Mt(n,"GET","/v2/passwordPolicy",Ot(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hk=6;class Wk{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:Hk,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qk{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ky(this),this.idTokenSubscription=new Ky(this),this.beforeStateQueue=new Gk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=pI,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=bs(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await ga.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await bI(this,{idToken:e}),r=await _s._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Jt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return ge(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await xu(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Pk()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Jt(this.app))return Promise.reject(wn(this));const t=e?De(e):null;return t&&ge(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ge(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Jt(this.app)?Promise.reject(wn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Jt(this.app)?Promise.reject(wn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(bs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Kk(this),t=new Wk(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Nu("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Bk(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&bs(e)||this._popupRedirectResolver;ge(t,this,"argument-error"),this.redirectPersistenceManager=await ga.create(this,[bs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ge(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ge(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=kI(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&Ak(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Ht(n){return De(n)}class Ky{constructor(e){this.auth=e,this.observer=null,this.addObserver=kS(t=>this.observer=t)}get next(){return ge(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Jk(n){Xu=n}function Km(n){return Xu.loadJS(n)}function Yk(){return Xu.recaptchaV2Script}function Xk(){return Xu.recaptchaEnterpriseScript}function Zk(){return Xu.gapiScript}function DI(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const eD="recaptcha-enterprise",tD="NO_RECAPTCHA";class VI{constructor(e){this.type=eD,this.auth=Ht(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{_I(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new yI(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;jy(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(tD)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&jy(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=Xk();l.length!==0&&(l+=a),Km(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function Hy(n,e,t,r=!1){const s=new VI(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Au(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Hy(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Hy(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function nD(n){const e=Ht(n),t=await _I(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new yI(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new VI(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rD(n,e){const t=Ou(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(bi(i,e??{}))return s;ir(s,"already-initialized")}return t.initialize({options:e})}function sD(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(bs);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function iD(n,e,t){const r=Ht(n);ge(r._canInitEmulator,r,"emulator-config-failed"),ge(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=NI(e),{host:o,port:a}=oD(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||aD()}function NI(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function oD(n){const e=NI(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Wy(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:Wy(o)}}}function Wy(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function aD(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zu{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Qr("not implemented")}_getIdTokenResponse(e){return Qr("not implemented")}_linkToIdToken(e,t){return Qr("not implemented")}_getReauthenticationResolver(e){return Qr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OI(n,e){return Mt(n,"POST","/v1/accounts:resetPassword",Ot(n,e))}async function lD(n,e){return Mt(n,"POST","/v1/accounts:update",e)}async function uD(n,e){return Mt(n,"POST","/v1/accounts:signUp",e)}async function cD(n,e){return Mt(n,"POST","/v1/accounts:update",Ot(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dD(n,e){return Fs(n,"POST","/v1/accounts:signInWithPassword",Ot(n,e))}async function Th(n,e){return Mt(n,"POST","/v1/accounts:sendOobCode",Ot(n,e))}async function hD(n,e){return Th(n,e)}async function fD(n,e){return Th(n,e)}async function pD(n,e){return Th(n,e)}async function mD(n,e){return Th(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gD(n,e){return Fs(n,"POST","/v1/accounts:signInWithEmailLink",Ot(n,e))}async function vD(n,e){return Fs(n,"POST","/v1/accounts:signInWithEmailLink",Ot(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Su extends Zu{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Su(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Su(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Au(e,t,"signInWithPassword",dD);case"emailLink":return gD(e,{email:this._email,oobCode:this._password});default:ir(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Au(e,r,"signUpPassword",uD);case"emailLink":return vD(e,{idToken:t,email:this._email,oobCode:this._password});default:ir(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Es(n,e){return Fs(n,"POST","/v1/accounts:signInWithIdp",Ot(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yD="http://localhost";class ks extends Zu{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ks(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ir("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=Um(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new ks(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Es(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Es(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Es(e,t)}buildRequest(){const e={requestUri:yD,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ba(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _D(n,e){return Mt(n,"POST","/v1/accounts:sendVerificationCode",Ot(n,e))}async function bD(n,e){return Fs(n,"POST","/v1/accounts:signInWithPhoneNumber",Ot(n,e))}async function wD(n,e){const t=await Fs(n,"POST","/v1/accounts:signInWithPhoneNumber",Ot(n,e));if(t.temporaryProof)throw Ul(n,"account-exists-with-different-credential",t);return t}const ID={USER_NOT_FOUND:"user-not-found"};async function ED(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Fs(n,"POST","/v1/accounts:signInWithPhoneNumber",Ot(n,t),ID)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class po extends Zu{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new po({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new po({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return bD(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return wD(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return ED(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new po({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TD(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function xD(n){const e=Nl(Ol(n)).link,t=e?Nl(Ol(e)).deep_link_id:null,r=Nl(Ol(n)).deep_link_id;return(r?Nl(Ol(r)).link:null)||r||t||e||n}class ec{constructor(e){var t,r,s,i,o,a;const l=Nl(Ol(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,d=(r=l.oobCode)!==null&&r!==void 0?r:null,f=TD((s=l.mode)!==null&&s!==void 0?s:null);ge(c&&d&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=d,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=xD(e);try{return new ec(t)}catch{return null}}}function j6(n){return ec.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{constructor(){this.providerId=ko.PROVIDER_ID}static credential(e,t){return Su._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=ec.parseLink(t);return ge(r,"argument-error"),Su._fromEmailAndCode(e,r.code,r.tenantId)}}ko.PROVIDER_ID="password";ko.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ko.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl extends $s{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ed extends nl{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return ge("providerId"in t&&"signInMethod"in t,"argument-error"),ks._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return ge(e.idToken||e.accessToken,"argument-error"),ks._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return ed.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return ed.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new ed(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oi extends nl{constructor(){super("facebook.com")}static credential(e){return ks._fromParams({providerId:oi.PROVIDER_ID,signInMethod:oi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return oi.credentialFromTaggedObject(e)}static credentialFromError(e){return oi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return oi.credential(e.oauthAccessToken)}catch{return null}}}oi.FACEBOOK_SIGN_IN_METHOD="facebook.com";oi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai extends nl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ks._fromParams({providerId:ai.PROVIDER_ID,signInMethod:ai.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ai.credentialFromTaggedObject(e)}static credentialFromError(e){return ai.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return ai.credential(t,r)}catch{return null}}}ai.GOOGLE_SIGN_IN_METHOD="google.com";ai.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class li extends nl{constructor(){super("github.com")}static credential(e){return ks._fromParams({providerId:li.PROVIDER_ID,signInMethod:li.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return li.credentialFromTaggedObject(e)}static credentialFromError(e){return li.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return li.credential(e.oauthAccessToken)}catch{return null}}}li.GITHUB_SIGN_IN_METHOD="github.com";li.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AD="http://localhost";class Pu extends Zu{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Es(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Es(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Es(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Pu(r,i)}static _create(e,t){return new Pu(e,t)}buildRequest(){return{requestUri:AD,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SD="saml.";class cp extends $s{constructor(e){ge(e.startsWith(SD),"argument-error"),super(e)}static credentialFromResult(e){return cp.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return cp.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Pu.fromJSON(e);return ge(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Pu._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui extends nl{constructor(){super("twitter.com")}static credential(e,t){return ks._fromParams({providerId:ui.PROVIDER_ID,signInMethod:ui.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ui.credentialFromTaggedObject(e)}static credentialFromError(e){return ui.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return ui.credential(t,r)}catch{return null}}}ui.TWITTER_SIGN_IN_METHOD="twitter.com";ui.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MI(n,e){return Fs(n,"POST","/v1/accounts:signUp",Ot(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await _s._fromIdTokenResponse(e,r,s),o=Qy(r);return new xr({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Qy(r);return new xr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Qy(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PD(n){var e;if(Jt(n.app))return Promise.reject(wn(n));const t=Ht(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new xr({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await MI(t,{returnSecureToken:!0}),s=await xr._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kd extends Vs{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,kd.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new kd(e,t,r,s)}}function LI(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?kd._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FI(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function B6(n,e){const t=De(n);await xh(!0,t,e);const{providerUserInfo:r}=await Ok(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=FI(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Hm(n,e,t=!1){const r=await Cs(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return xr._forOperation(n,"link",r)}async function xh(n,e,t){await xu(e);const r=FI(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";ge(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $I(n,e,t=!1){const{auth:r}=n;if(Jt(r.app))return Promise.reject(wn(r));const s="reauthenticate";try{const i=await Cs(n,LI(r,s,e,n),t);ge(i.idToken,r,"internal-error");const o=Eh(i.idToken);ge(o,r,"internal-error");const{sub:a}=o;return ge(n.uid===a,r,"user-mismatch"),xr._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&ir(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UI(n,e,t=!1){if(Jt(n.app))return Promise.reject(wn(n));const r="signIn",s=await LI(n,r,e),i=await xr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Wm(n,e){return UI(Ht(n),e)}async function RD(n,e){const t=De(n);return await xh(!1,t,e.providerId),Hm(t,e)}async function CD(n,e){return $I(De(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kD(n,e){return Fs(n,"POST","/v1/accounts:signInWithCustomToken",Ot(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function q6(n,e){if(Jt(n.app))return Promise.reject(wn(n));const t=Ht(n),r=await kD(t,{token:e,returnSecureToken:!0}),s=await xr._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Qm._fromServerResponse(e,t):"totpInfo"in t?Jm._fromServerResponse(e,t):ir(e,"internal-error")}}class Qm extends tc{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Qm(t)}}class Jm extends tc{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Jm(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ah(n,e,t){var r;ge(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),ge(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(ge(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(ge(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ym(n){const e=Ht(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function DD(n,e,t){const r=Ht(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Ah(r,s,t),await Au(r,s,"getOobCode",fD)}async function VD(n,e,t){await OI(De(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Ym(n),r})}async function z6(n,e){await cD(De(n),{oobCode:e})}async function ND(n,e){const t=De(n),r=await OI(t,{oobCode:e}),s=r.requestType;switch(ge(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":ge(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":ge(r.mfaInfo,t,"internal-error");default:ge(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=tc._fromServerResponse(Ht(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function G6(n,e){const{data:t}=await ND(De(n),e);return t.email}async function OD(n,e,t){if(Jt(n.app))return Promise.reject(wn(n));const r=Ht(n),o=await Au(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",MI).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Ym(n),l}),a=await xr._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function MD(n,e,t){return Jt(n.app)?Promise.reject(wn(n)):Wm(De(n),ko.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Ym(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function K6(n,e,t){const r=Ht(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){ge(a.handleCodeInApp,r,"argument-error"),a&&Ah(r,o,a)}i(s,t),await Au(r,s,"getOobCode",pD)}function H6(n,e){const t=ec.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function W6(n,e,t){if(Jt(n.app))return Promise.reject(wn(n));const r=De(n),s=ko.credentialWithLink(e,t||Tu());return ge(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Wm(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LD(n,e){return Mt(n,"POST","/v1/accounts:createAuthUri",Ot(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q6(n,e){const t=qm()?Tu():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await LD(De(n),r);return s||[]}async function J6(n,e){const t=De(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Ah(t.auth,s,e);const{email:i}=await hD(t.auth,s);i!==n.email&&await n.reload()}async function Y6(n,e,t){const r=De(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Ah(r.auth,i,t);const{email:o}=await mD(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FD(n,e){return Mt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function X6(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=De(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Cs(r,FD(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function $D(n,e){const t=De(n);return Jt(t.auth.app)?Promise.reject(wn(t.auth)):jI(t,e,null)}function UD(n,e){return jI(De(n),null,e)}async function jI(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Cs(n,lD(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jD(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=Eh(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new va(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new BD(i,s);case"github.com":return new qD(i,s);case"google.com":return new zD(i,s);case"twitter.com":return new GD(i,s,n.screenName||null);case"custom":case"anonymous":return new va(i,null);default:return new va(i,r,s)}}class va{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class BI extends va{constructor(e,t,r,s){super(e,t,r),this.username=s}}class BD extends va{constructor(e,t){super(e,"facebook.com",t)}}class qD extends BI{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class zD extends va{constructor(e,t){super(e,"google.com",t)}}class GD extends BI{constructor(e,t,r){super(e,"twitter.com",t,r)}}function Z6(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:jD(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KD(n,e){return De(n).setPersistence(e)}function eU(n){return nD(n)}async function tU(n,e){return Ht(n).validatePassword(e)}function HD(n,e,t,r){return De(n).onIdTokenChanged(e,t,r)}function WD(n,e,t){return De(n).beforeAuthStateChanged(e,t)}function QD(n,e,t,r){return De(n).onAuthStateChanged(e,t,r)}function nU(n){De(n).useDeviceLanguage()}function rU(n,e){return De(n).updateCurrentUser(e)}function JD(n){return De(n).signOut()}function sU(n,e){return Ht(n).revokeAccessToken(e)}async function iU(n){return De(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uo{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new uo("enroll",e,t)}static _fromMfaPendingCredential(e){return new uo("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return uo._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return uo._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=Ht(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>tc._fromServerResponse(r,a));ge(s.mfaPendingCredential,r,"internal-error");const o=uo._fromMfaPendingCredential(s.mfaPendingCredential);return new Xm(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const d=await xr._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(d.user),d;case"reauthenticate":return ge(t.user,r,"internal-error"),xr._forOperation(t.user,t.operationType,c);default:ir(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function oU(n,e){var t;const r=De(n),s=e;return ge(e.customData.operationType,r,"argument-error"),ge((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Xm._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YD(n,e){return Mt(n,"POST","/v2/accounts/mfaEnrollment:start",Ot(n,e))}function XD(n,e){return Mt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Ot(n,e))}function ZD(n,e){return Mt(n,"POST","/v2/accounts/mfaEnrollment:start",Ot(n,e))}function e2(n,e){return Mt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Ot(n,e))}function t2(n,e){return Mt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Ot(n,e))}class Zm{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>tc._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Zm(e)}async getSession(){return uo._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Cs(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Cs(this.user,t2(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const vf=new WeakMap;function aU(n){const e=De(n);return vf.has(e)||vf.set(e,Zm._fromUser(e)),vf.get(e)}const Dd="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Dd,"1"),this.storage.removeItem(Dd),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n2=1e3,r2=10;class zI extends qI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=CI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);zk()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,r2):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},n2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}zI.type="LOCAL";const GI=zI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KI extends qI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}KI.type="SESSION";const HI=KI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s2(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Sh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await s2(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Sh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ph(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=Ph("",20);s.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===c)switch(g.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sn(){return window}function o2(n){sn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eg(){return typeof sn().WorkerGlobalScope<"u"&&typeof sn().importScripts=="function"}async function a2(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function l2(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function u2(){return eg()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WI="firebaseLocalStorageDb",c2=1,Vd="firebaseLocalStorage",QI="fbase_key";class nc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Rh(n,e){return n.transaction([Vd],e?"readwrite":"readonly").objectStore(Vd)}function d2(){const n=indexedDB.deleteDatabase(WI);return new nc(n).toPromise()}function dp(){const n=indexedDB.open(WI,c2);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Vd,{keyPath:QI})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Vd)?e(r):(r.close(),await d2(),e(await dp()))})})}async function Jy(n,e,t){const r=Rh(n,!0).put({[QI]:e,value:t});return new nc(r).toPromise()}async function h2(n,e){const t=Rh(n,!1).get(e),r=await new nc(t).toPromise();return r===void 0?null:r.value}function Yy(n,e){const t=Rh(n,!0).delete(e);return new nc(t).toPromise()}const f2=800,p2=3;class JI{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await dp(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>p2)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return eg()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Sh._getInstance(u2()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await a2(),!this.activeServiceWorker)return;this.sender=new i2(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||l2()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await dp();return await Jy(e,Dd,"1"),await Yy(e,Dd),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Jy(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>h2(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Yy(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Rh(s,!1).getAll();return new nc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),f2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}JI.type="LOCAL";const m2=JI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g2(n,e){return Mt(n,"POST","/v2/accounts/mfaSignIn:start",Ot(n,e))}function v2(n,e){return Mt(n,"POST","/v2/accounts/mfaSignIn:finalize",Ot(n,e))}function y2(n,e){return Mt(n,"POST","/v2/accounts/mfaSignIn:finalize",Ot(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _2=500,b2=6e4,Nc=1e12;class w2{constructor(e){this.auth=e,this.counter=Nc,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new I2(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Nc;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Nc;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Nc;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class I2{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;ge(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=E2(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},b2)},_2))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function E2(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yf=DI("rcb"),T2=new Yu(3e4,6e4);class x2{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=sn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return ge(A2(t),e,"argument-error"),this.shouldResolveImmediately(t)&&Uy(sn().grecaptcha)?Promise.resolve(sn().grecaptcha):new Promise((r,s)=>{const i=sn().setTimeout(()=>{s(Qn(e,"network-request-failed"))},T2.get());sn()[yf]=()=>{sn().clearTimeout(i),delete sn()[yf];const a=sn().grecaptcha;if(!a||!Uy(a)){s(Qn(e,"internal-error"));return}const l=a.render;a.render=(c,d)=>{const f=l(c,d);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${Yk()}?${Ba({onload:yf,render:"explicit",hl:t})}`;Km(o).catch(()=>{clearTimeout(i),s(Qn(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=sn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function A2(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class S2{async load(e){return new w2(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YI="recaptcha",P2={theme:"light",type:"image"};class lU{constructor(e,t,r=Object.assign({},P2)){this.parameters=r,this.type=YI,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Ht(e),this.isInvisible=this.parameters.size==="invisible",ge(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;ge(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new S2:new x2,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){ge(!this.parameters.sitekey,this.auth,"argument-error"),ge(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),ge(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=sn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){ge(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){ge(qm()&&!eg(),this.auth,"internal-error"),await R2(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await Vk(this.auth);ge(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return ge(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function R2(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tg{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=po._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function uU(n,e,t){if(Jt(n.app))return Promise.reject(wn(n));const r=Ht(n),s=await Ch(r,e,De(t));return new tg(s,i=>Wm(r,i))}async function cU(n,e,t){const r=De(n);await xh(!1,r,"phone");const s=await Ch(r.auth,e,De(t));return new tg(s,i=>RD(r,i))}async function dU(n,e,t){const r=De(n);if(Jt(r.auth.app))return Promise.reject(wn(r.auth));const s=await Ch(r.auth,e,De(t));return new tg(s,i=>CD(r,i))}async function Ch(n,e,t){var r;const s=await t.verify();try{ge(typeof s=="string",n,"argument-error"),ge(t.type===YI,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return ge(o.type==="enroll",n,"internal-error"),(await YD(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{ge(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return ge(a,n,"missing-multi-factor-info"),(await g2(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await _D(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function hU(n,e){const t=De(n);if(Jt(t.auth.app))return Promise.reject(wn(t.auth));await Hm(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ya{constructor(e){this.providerId=ya.PROVIDER_ID,this.auth=Ht(e)}verifyPhoneNumber(e,t){return Ch(this.auth,e,De(t))}static credential(e,t){return po._fromVerification(e,t)}static credentialFromResult(e){const t=e;return ya.credentialFromTaggedObject(t)}static credentialFromError(e){return ya.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?po._fromTokenResponse(t,r):null}}ya.PROVIDER_ID="phone";ya.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Do(n,e){return e?bs(e):(ge(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ng extends Zu{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Es(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Es(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Es(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function C2(n){return UI(n.auth,new ng(n),n.bypassAuthState)}function k2(n){const{auth:e,user:t}=n;return ge(t,e,"internal-error"),$I(t,new ng(n),n.bypassAuthState)}async function D2(n){const{auth:e,user:t}=n;return ge(t,e,"internal-error"),Hm(t,new ng(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XI{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return C2;case"linkViaPopup":case"linkViaRedirect":return D2;case"reauthViaPopup":case"reauthViaRedirect":return k2;default:ir(this.auth,"internal-error")}}resolve(e){Rs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Rs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V2=new Yu(2e3,1e4);async function fU(n,e,t){if(Jt(n.app))return Promise.reject(Qn(n,"operation-not-supported-in-this-environment"));const r=Ht(n);tl(n,e,$s);const s=Do(r,t);return new ws(r,"signInViaPopup",e,s).executeNotNull()}async function pU(n,e,t){const r=De(n);if(Jt(r.auth.app))return Promise.reject(Qn(r.auth,"operation-not-supported-in-this-environment"));tl(r.auth,e,$s);const s=Do(r.auth,t);return new ws(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function mU(n,e,t){const r=De(n);tl(r.auth,e,$s);const s=Do(r.auth,t);return new ws(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class ws extends XI{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,ws.currentPopupAction&&ws.currentPopupAction.cancel(),ws.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ge(e,this.auth,"internal-error"),e}async onExecution(){Rs(this.filter.length===1,"Popup operations only handle one event");const e=Ph();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Qn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Qn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ws.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Qn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,V2.get())};e()}}ws.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N2="pendingRedirect",td=new Map;class O2 extends XI{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=td.get(this.auth._key());if(!e){try{const r=await M2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}td.set(this.auth._key(),e)}return this.bypassAuthState||td.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function M2(n,e){const t=eE(e),r=ZI(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function rg(n,e){return ZI(n)._set(eE(e),"true")}function L2(n,e){td.set(n._key(),e)}function ZI(n){return bs(n._redirectPersistence)}function eE(n){return Zc(N2,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gU(n,e,t){return F2(n,e,t)}async function F2(n,e,t){if(Jt(n.app))return Promise.reject(wn(n));const r=Ht(n);tl(n,e,$s),await r._initializationPromise;const s=Do(r,t);return await rg(s,r),s._openRedirect(r,e,"signInViaRedirect")}function vU(n,e,t){return $2(n,e,t)}async function $2(n,e,t){const r=De(n);if(tl(r.auth,e,$s),Jt(r.auth.app))return Promise.reject(wn(r.auth));await r.auth._initializationPromise;const s=Do(r.auth,t);await rg(s,r.auth);const i=await nE(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function yU(n,e,t){return U2(n,e,t)}async function U2(n,e,t){const r=De(n);tl(r.auth,e,$s),await r.auth._initializationPromise;const s=Do(r.auth,t);await xh(!1,r,e.providerId),await rg(s,r.auth);const i=await nE(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function _U(n,e){return await Ht(n)._initializationPromise,tE(n,e,!1)}async function tE(n,e,t=!1){if(Jt(n.app))return Promise.reject(wn(n));const r=Ht(n),s=Do(r,e),o=await new O2(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function nE(n){const e=Ph(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j2=10*60*1e3;class B2{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!q2(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!rE(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Qn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=j2&&this.cachedEventUids.clear(),this.cachedEventUids.has(Xy(e))}saveEventToCache(e){this.cachedEventUids.add(Xy(e)),this.lastProcessedEventTime=Date.now()}}function Xy(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function rE({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function q2(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return rE(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function z2(n,e={}){return Mt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G2=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,K2=/^https?/;async function H2(n){if(n.config.emulator)return;const{authorizedDomains:e}=await z2(n);for(const t of e)try{if(W2(t))return}catch{}ir(n,"unauthorized-domain")}function W2(n){const e=Tu(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!K2.test(t))return!1;if(G2.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q2=new Yu(3e4,6e4);function Zy(){const n=sn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function J2(n){return new Promise((e,t)=>{var r,s,i;function o(){Zy(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Zy(),t(Qn(n,"network-request-failed"))},timeout:Q2.get()})}if(!((s=(r=sn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=sn().gapi)===null||i===void 0)&&i.load)o();else{const a=DI("iframefcb");return sn()[a]=()=>{gapi.load?o():t(Qn(n,"network-request-failed"))},Km(`${Zk()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw nd=null,e})}let nd=null;function Y2(n){return nd=nd||J2(n),nd}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X2=new Yu(5e3,15e3),Z2="__/auth/iframe",eV="emulator/auth/iframe",tV={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},nV=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function rV(n){const e=n.config;ge(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?zm(e,eV):`https://${n.config.authDomain}/${Z2}`,r={apiKey:e.apiKey,appName:n.name,v:qa},s=nV.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Ba(r).slice(1)}`}async function sV(n){const e=await Y2(n),t=sn().gapi;return ge(t,n,"internal-error"),e.open({where:document.body,url:rV(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:tV,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Qn(n,"network-request-failed"),a=sn().setTimeout(()=>{i(o)},X2.get());function l(){sn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iV={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},oV=500,aV=600,lV="_blank",uV="http://localhost";class e_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function cV(n,e,t,r=oV,s=aV){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},iV),{width:r.toString(),height:s.toString(),top:i,left:o}),c=pn().toLowerCase();t&&(a=xI(c)?lV:t),EI(c)&&(e=e||uV,l.scrollbars="yes");const d=Object.entries(l).reduce((g,[y,x])=>`${g}${y}=${x},`,"");if(qk(c)&&a!=="_self")return dV(e||"",a),new e_(null);const f=window.open(e||"",a,d);ge(f,n,"popup-blocked");try{f.focus()}catch{}return new e_(f)}function dV(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hV="__/auth/handler",fV="emulator/auth/handler",pV=encodeURIComponent("fac");async function t_(n,e,t,r,s,i){ge(n.config.authDomain,n,"auth-domain-config-required"),ge(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:qa,eventId:s};if(e instanceof $s){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",CS(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,f]of Object.entries(i||{}))o[d]=f}if(e instanceof nl){const d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const l=await n._getAppCheckToken(),c=l?`#${pV}=${encodeURIComponent(l)}`:"";return`${mV(n)}?${Ba(a).slice(1)}${c}`}function mV({config:n}){return n.emulator?zm(n,fV):`https://${n.authDomain}/${hV}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _f="webStorageSupport";class gV{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=HI,this._completeRedirectFn=tE,this._overrideRedirectResult=L2}async _openPopup(e,t,r,s){var i;Rs((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await t_(e,t,r,Tu(),s);return cV(e,o,Ph())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await t_(e,t,r,Tu(),s);return o2(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Rs(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await sV(e),r=new B2(e);return t.register("authEvent",s=>(ge(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(_f,{type:_f},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[_f];o!==void 0&&t(!!o),ir(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=H2(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return CI()||TI()||Gm()}}const vV=gV;class sE{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Qr("unexpected MultiFactorSessionType")}}}class sg extends sE{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new sg(e)}_finalizeEnroll(e,t,r){return XD(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return v2(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class yV{constructor(){}static assertion(e){return sg._fromCredential(e)}}yV.FACTOR_ID="phone";class _V{static assertionForEnrollment(e,t){return Ru._fromSecret(e,t)}static assertionForSignIn(e,t){return Ru._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;ge(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await ZD(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return ig._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}_V.FACTOR_ID="totp";class Ru extends sE{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Ru(t,void 0,e)}static _fromEnrollmentId(e,t){return new Ru(t,e)}async _finalizeEnroll(e,t,r){return ge(typeof this.secret<"u",e,"argument-error"),e2(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){ge(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return y2(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class ig{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new ig(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(Oc(e)||Oc(t))&&(s=!0),s&&(Oc(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),Oc(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Oc(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var n_="@firebase/auth",r_="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bV{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ge(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wV(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function IV(n){Ea(new go("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;ge(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:kI(n)},c=new Qk(r,s,i,l);return sD(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Ea(new go("auth-internal",e=>{const t=Ht(e.getProvider("auth").getImmediate());return(r=>new bV(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),pi(n_,r_,wV(n)),pi(n_,r_,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EV=5*60,TV=F0("authIdTokenMaxAge")||EV;let s_=null;const xV=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>TV)return;const s=t==null?void 0:t.token;s_!==s&&(s_=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function AV(n=z0()){const e=Ou(n,"auth");if(e.isInitialized())return e.getImmediate();const t=rD(n,{popupRedirectResolver:vV,persistence:[m2,GI,HI]}),r=F0("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=xV(i.toString());WD(t,o,()=>o(t.currentUser)),HD(t,a=>o(a))}}const s=M0("auth");return s&&iD(t,`http://${s}`),t}function SV(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}Jk({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Qn("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",SV().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});IV("Browser");const PV={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},iE=q0(PV),ue=ek(iE),on=AV(iE);try{tk(ue)}catch{}try{KD(on,GI)}catch{}QD(on,n=>{n||PD(on)});async function RV(n,e){try{return(await OD(on,n,e)).user}catch(t){throw t}}async function oE(n,e){try{return(await MD(on,n,e)).user}catch(t){throw t}}async function aE(n){try{await DD(on,n)}catch(e){throw e}}async function CV(n){try{const e=on.currentUser;if(e)await UD(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const mi=Object.freeze(Object.defineProperty({__proto__:null,auth:on,createPlayerAccount:RV,db:ue,resetPlayerPassword:aE,signInPlayer:oE,updatePlayerPassword:CV},Symbol.toStringTag,{value:"Module"})),rl="seasons";async function kV(n,e,t){return await Ih(He(ue,rl),{name:n,slug:e,pinCode:t,createdAt:Ju()})}async function DV(n){return await Ua(Ae(ue,rl,n))}async function bf(){const n=Eu(He(ue,rl),lk("createdAt","desc"));return(await pt(n)).docs.map(t=>({id:t.id,...t.data()}))}async function Nd(n,e){const t=await Sn(Ae(ue,rl,n));return t.exists()?t.data().pinCode===e:!1}async function hp(n){const e=await Sn(Ae(ue,rl,n));return e.exists()?e.data().pinCode:null}async function kl(n,e){const t=Ae(ue,rl,n);await el(t,{sortOrder:e})}const wf=7*24*60*60*1e3,Dl="impro_selector_pin_session";class VV{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(Dl);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<wf){try{t.timestamp=Date.now(),localStorage.setItem(Dl,JSON.stringify(t))}catch{}return t}else this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(Dl,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){if(!this.sessionData)return!1;const t=this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<wf;if(t)try{this.sessionData.timestamp=Date.now(),localStorage.setItem(Dl,JSON.stringify(this.sessionData))}catch{}return t}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(Dl),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=wf-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const tr=new VV,NV={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},OV={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},MV={class:"text-center mb-6"},LV={class:"text-gray-300"},FV={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},$V={class:"text-sm text-green-400"},UV={class:"mb-6"},jV={class:"mb-4"},BV={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},qV={class:"flex justify-end space-x-3"},zV=["disabled"],lE={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=O(""),i=O(""),o=O(null);Vt(()=>t.show,d=>{d&&(s.value="",i.value="",dn(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(d,f)=>n.show?(F(),U("div",NV,[h("div",OV,[h("div",MV,[f[1]||(f[1]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),h("p",LV,le(n.message),1),n.sessionInfo?(F(),U("div",FV,[h("p",$V," Session active : "+le(n.sessionInfo.timeRemaining)+" min restantes ",1)])):he("",!0)]),h("div",UV,[h("div",jV,[f[3]||(f[3]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),rt(h("input",{"onUpdate:modelValue":f[0]||(f[0]=g=>s.value=g),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[Nn(l,["enter"]),Nn(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[At,s.value]])]),f[4]||(f[4]=h("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(F(),U("div",BV,le(i.value||t.error),1)):he("",!0),h("div",qV,[h("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,zV)])])])):he("",!0)}},GV={class:"relative p-6 pb-4 border-b border-white/10"},KV={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},uE={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(F(),U("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=Dt(()=>{},["stop"]))},[h("div",GV,[h("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=h("div",{class:"flex items-center gap-3"},[h("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"❓"),h("div",null,[h("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Kezako ?"),h("p",{class:"text-sm text-purple-300"},"L'appli pour sélectionner les joueurs d'impro de manière simple et apaisée")])],-1))]),s[5]||(s[5]=lr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">C&#39;est quoi ?</h3><p> Tu joues quand ? est une appli conçue pour faciliter <span class="text-white">la sélection des joueurs d&#39;impro</span> pour les spectacles. L&#39;idée est née au sein de <span class="text-purple-300">La Malice</span> pour <span class="text-white">dépersonnaliser une tâche délicate</span> qui créait des tensions depuis des années. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">Comment ça marche</h3><p> L&#39;asso déclare ses dates et le nombre de personnes nécessaires. Les joueurs indiquent leurs disponibilités. L&#39;appli propose des sélections. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Sélection auto ou manuelle</h3><p> Le <span class="text-white">mode sélection auto</span> s&#39;appuie sur le hasard (pondéré) pour simplifier la vie. Vous pouvez aussi repasser en mode <span class="text-white">manuel</span> si besoin. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Pensée mobile • Libre d&#39;utilisation</h3><p> L&#39;appli est <span class="text-white">pensée pour le mobile</span> et peut être utilisée librement par La Malice ou <span class="text-white">toute autre troupe</span>. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Comptes (facultatif)</h3><p> Les joueurs qui le souhaitent peuvent créer un compte via leur email pour <span class="text-white">recevoir des notifications</span>, <span class="text-white">protéger leurs saisies</span> et bénéficier d&#39;un meilleur confort d&#39;utilisation. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2 text-sm"><h3 class="text-white font-semibold">Statut &amp; licence</h3><p> Application <span class="text-white">en cours de développement</span>, <span class="text-white">sans garanties</span> à ce stade. Licence libre <span class="text-white">MIT</span>. </p><p>Contact &amp; retours : <a href="mailto:impropick@gmail.com" class="text-blue-300 underline">impropick@gmail.com</a></p></div></div>',1)),h("div",KV,[h("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):he("",!0)}},HV=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function WV(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function cE(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function QV(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function dE(n){if(!n)return!1;const e=String(n).toLowerCase();return HV.some(t=>e.includes(t.toLowerCase()))}function fp(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?QV(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>fp(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=dE(t)?"••••":fp(r);return e}return n}function JV(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&dE(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(fp(r))}return e}const YV=cE(WV());function Mc(n,e){const t=cE(n);return(...r)=>{if(t<YV)return;const s=JV(r);console[e](...s)}}const ve={debug:Mc("debug","log"),info:Mc("info","info"),warn:Mc("warn","warn"),error:Mc("error","error")};let Bn="mock",gi=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],Ao=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function hE(n){Bn=n}async function XV(){if(Bn!=="firebase"||!(await pt(He(ue,"seasons"))).empty)return;const e=Ae(He(ue,"seasons"));await fn(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:Ju()});const t=await pt(He(ue,"players"));for(const o of t.docs)await fn(Ae(e,"players",o.id),o.data());const r=await pt(He(ue,"events"));for(const o of r.docs)await fn(Ae(e,"events",o.id),o.data());const s=await pt(He(ue,"availability"));for(const o of s.docs)await fn(Ae(e,"availability",o.id),o.data());const i=await pt(He(ue,"selections"));for(const o of i.docs)await fn(Ae(e,"selections",o.id),o.data())}async function ZV(){Bn==="firebase"&&await XV()}async function pp(n=null){return(Bn==="firebase"?n?(await pt(He(ue,"seasons",n,"events"))).docs.map(t=>({id:t.id,...t.data()})):(await pt(He(ue,"events"))).docs.map(t=>({id:t.id,...t.data()})):Ao).sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const d=new Date(c);return isNaN(d.getTime())?null:d},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function rd(n=null){return(Bn==="firebase"?n?(await pt(He(ue,"seasons",n,"players"))).docs.map(t=>({id:t.id,...t.data()})):(await pt(He(ue,"players"))).docs.map(t=>({id:t.id,...t.data()})):gi).sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function fE(n,e=null){if(Bn==="firebase"){const t=Ae(e?He(ue,"seasons",e,"players"):He(ue,"players"));return await fn(t,{name:n}),t.id}else{const t=`p${gi.length+1}`;return gi.push({id:t,name:n}),t}}async function eN(n,e=null){if(Bn==="firebase"){const t=e?Ae(ue,"seasons",e,"players",n):Ae(ue,"players",n);await Ua(t);const r=e?await pt(He(ue,"seasons",e,"availability")):await pt(He(ue,"availability")),s=Fm(ue);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else gi=gi.filter(t=>t.id!==n)}async function tN(n,e,t=null){if(Bn==="firebase"){const r=t?Ae(ue,"seasons",t,"players",n):Ae(ue,"players",n),s=await Sn(r),i=s.exists()&&s.data().name||null;if(await fn(r,{name:e},{merge:!0}),i&&i!==e){const o=Fm(ue);try{const a=t?Ae(ue,"seasons",t,"availability",i):Ae(ue,"availability",i),l=await Sn(a);if(l.exists()){const c=l.data()||{},d=t?Ae(ue,"seasons",t,"availability",e):Ae(ue,"availability",e);o.set(d,c,{merge:!0}),o.delete(a)}}catch{}try{const a=t?He(ue,"seasons",t,"selections"):He(ue,"selections");(await pt(a)).forEach(c=>{var f;const d=Array.isArray((f=c.data())==null?void 0:f.players)?c.data().players:[];if(d.includes(i)){const g=d.map(y=>y===i?e:y);o.update(c.ref,{players:g})}})}catch{}await o.commit()}}else{const r=gi.findIndex(s=>s.id===n);r!==-1&&(gi[r]={...gi[r],name:e})}}async function to(n,e,t=null){if(Bn==="firebase"){const r=t?await pt(He(ue,"seasons",t,"availability")):await pt(He(ue,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function no(n=null){if(Bn==="firebase"){const e=n?await pt(He(ue,"seasons",n,"selections")):await pt(He(ue,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function i_(n,e,t=null){if(Bn==="firebase"){const r=t?Ae(ue,"seasons",t,"availability",n):Ae(ue,"availability",n);await fn(r,e)}}async function nN({seasonId:n,playerName:e,eventId:t,value:r}){if(Bn!=="firebase")return;const s=n?Ae(ue,"seasons",n,"availability",e):Ae(ue,"availability",e),i=await Sn(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await fn(s,a)}async function o_(n,e,t=null){if(Bn==="firebase"){const r=t?Ae(ue,"seasons",t,"selections",n):Ae(ue,"selections",n);await fn(r,{players:e})}}async function rN(n,e=null){if(ve.info("Suppression de l'événement",{eventId:n}),Bn==="firebase")try{ve.debug("Suppression de l'événement dans Firestore");const t=e?Ae(ue,"seasons",e,"events",n):Ae(ue,"events",n);await Ua(t),ve.debug("Suppression de la sélection associée");const r=e?Ae(ue,"seasons",e,"selections",n):Ae(ue,"selections",n);await Ua(r),ve.debug("Suppression des disponibilités");const s=e?await pt(He(ue,"seasons",e,"availability")):await pt(He(ue,"availability")),i=Fm(ue);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){ve.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),ve.info("Opérations de suppression terminées avec succès")}catch(t){throw ve.error("Erreur lors de la suppression",t),t}else Ao=Ao.filter(t=>t.id!==n)}async function sN(n,e=null){if(Bn==="firebase"){const t=Ae(e?He(ue,"seasons",e,"events"):He(ue,"events"));return await fn(t,n),t.id}else{const t=`event${Ao.length+1}`;return Ao.push({id:t,...n}),t}}async function a_(n,e,t=null){if(Bn==="firebase"){const r=t?Ae(ue,"seasons",t,"events",n):Ae(ue,"events",n);await fn(r,e,{merge:!0})}else{const r=Ao.findIndex(s=>s.id===n);r!==-1&&(Ao[r]={id:n,...e})}}const iN={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},oN={class:"text-center py-16 px-4 relative"},aN=["aria-busy"],lN={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto animate-pulse"},uN={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto"},cN=["onClick"],dN={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},hN={class:"absolute top-4 right-4"},fN=["onClick","aria-expanded"],pN={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},mN=["onClick"],gN=["onClick"],vN=["onClick"],yN=["onClick"],_N={key:2,class:"flex justify-center mt-12"},bN={key:3,class:"text-center py-16"},wN={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},IN={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},EN={class:"mb-6"},TN={class:"mb-6"},xN={class:"mb-6"},AN={class:"flex justify-end space-x-3"},SN=["disabled"],PN={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},RN={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},CN={class:"text-center mb-6"},kN={class:"text-gray-300"},DN={__name:"Home",setup(n){const e=O([]),t=O(!0),r=Vu(),s=O(null),i=O(!1),o=O(!1),a=O(""),l=O(""),c=O(""),d=O(null),f=O(!1),g=O(null),y=O(""),x=O(!1);wr(async()=>{var k;try{e.value=await bf(),ve.info("Saisons chargées",{count:((k=e.value)==null?void 0:k.length)||0}),D().catch(M=>ve.error("Migration sortOrder échouée",M))}finally{t.value=!1}});const P=Be(()=>[...e.value].sort((k,M)=>{var E,A;const Q=typeof k.sortOrder=="number"?k.sortOrder:Number.MAX_SAFE_INTEGER,X=typeof M.sortOrder=="number"?M.sortOrder:Number.MAX_SAFE_INTEGER;if(Q!==X)return Q-X;const Pe=(E=k.createdAt)!=null&&E.toMillis?k.createdAt.toMillis():0,Ne=(A=M.createdAt)!=null&&A.toMillis?M.createdAt.toMillis():0;return Pe!==Ne?Ne-Pe:(k.name||"").localeCompare(M.name||"")}));function S(k){r.push(`/season/${k}`)}function j(k){s.value=s.value===k?null:k}function $(){s.value=null}async function D(){if(!e.value.length)return;const k=e.value.map(Q=>typeof Q.sortOrder=="number"?Q.sortOrder:null).filter(Q=>Q!==null);let M=k.length?Math.max(...k):0;for(const Q of e.value)if(typeof Q.sortOrder!="number"){M+=1;try{await kl(Q.id,M),Q.sortOrder=M}catch(X){ve.error("Erreur migration sortOrder",{seasonName:Q==null?void 0:Q.name,error:X})}}}async function G(k){try{if(!(k!=null&&k.id)){alert("Saison introuvable");return}const[M,Q]=await Promise.all([pp(k.id),rd(k.id)]),[X,Pe]=await Promise.all([to(Q,M,k.id),no(k.id)]),Ne=["Joueur",...M.map(ce=>pe(ce))],E=[];for(const ce of Q){const de=(ce==null?void 0:ce.name)||"",ie=(X==null?void 0:X[de])||{},Ee=[de,...M.map(be=>V(ie[be.id],Pe==null?void 0:Pe[be.id],de))];E.push(Ee)}const A=w([Ne,...E]),L=new Blob(["\uFEFF"+A],{type:"text/csv;charset=utf-8;"}),ee=(k==null?void 0:k.name)||(k==null?void 0:k.slug)||"saison",J=`${C(ee)}-disponibilites.csv`,te=URL.createObjectURL(L),me=document.createElement("a");me.href=te,me.download=J,document.body.appendChild(me),me.click(),document.body.removeChild(me),URL.revokeObjectURL(te),ve.info("Export CSV saison",{seasonId:k.id,events:M.length,players:Q.length})}catch(M){ve.error("Erreur export CSV",M),alert("Erreur lors de l'export CSV. Veuillez réessayer.")}}function Z(k){if(!k)return null;if(k instanceof Date)return k;if(typeof(k==null?void 0:k.toDate)=="function")return k.toDate();if(typeof k=="string"||typeof k=="number"){const M=new Date(k);return isNaN(M.getTime())?null:M}return null}function pe(k){const M=Z(k==null?void 0:k.date),Q=M?`${M.getFullYear()}-${String(M.getMonth()+1).padStart(2,"0")}-${String(M.getDate()).padStart(2,"0")}`:"",X=(k==null?void 0:k.title)||"Sans titre";return`${Q} · ${X}`.trim()}function T(k){return k===!0||k==="oui"?"disponible":k===!1||k==="non"?"non disponible":""}function w(k){return k.map(M=>M.map(I).join(",")).join(`
`)}function I(k){const M=String(k??"");return/[",\n\r]/.test(M)?'"'+M.replace(/"/g,'""')+'"':M}function C(k){return String(k||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9\-_. ]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$|^\.+|\.+$/g,"")||"fichier"}function V(k,M,Q){return Array.isArray(M)&&M.includes(Q)?k===!1||k==="non"?"non disponible":"sélectionné":T(k)}async function B(k){if($(),k<=0)return;const M=[...P.value],Q=M[k],X=M[k-1],Pe=Q.sortOrder;Q.sortOrder=X.sortOrder,X.sortOrder=Pe;try{await Promise.all([kl(Q.id,Q.sortOrder),kl(X.id,X.sortOrder)])}catch(Ne){ve.error("Erreur lors du déplacement vers le haut",Ne)}}async function R(k){$();const M=[...P.value];if(k>=M.length-1)return;const Q=M[k],X=M[k+1],Pe=Q.sortOrder;Q.sortOrder=X.sortOrder,X.sortOrder=Pe;try{await Promise.all([kl(Q.id,Q.sortOrder),kl(X.id,X.sortOrder)])}catch(Ne){ve.error("Erreur lors du déplacement vers le bas",Ne)}}function Rt(){a.value&&(l.value=a.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function Et(){c.value=c.value.replace(/[^0-9]/g,""),c.value.length>4&&(c.value=c.value.slice(0,4))}async function Ye(){if(!a.value.trim()||!l.value.trim()||!c.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(c.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await kV(a.value.trim(),l.value.trim(),c.value.trim()),e.value=await bf(),await D(),Me()}catch(k){ve.error("Erreur lors de la création de la saison",k),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function Me(){i.value=!1,a.value="",l.value="",c.value=""}function Le(k){d.value=k,o.value=!0}async function ln(){o.value=!1,await fe({type:"deleteSeason",data:{seasonId:d.value.id,seasonName:d.value.name}})}function en(){o.value=!1,d.value=null}function Ct(){return g.value?{deleteSeason:"Suppression de saison - Code PIN requis"}[g.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function fe(k){if(tr.isPinCached(d.value.id)){const M=tr.getCachedPin(d.value.id);if(ve.debug("PIN en cache trouvé, utilisation automatique"),await Nd(d.value.id,M)){await ut(k);return}else tr.clearSession()}g.value=k,f.value=!0}async function se(k){var M,Q,X,Pe;ve.debug("PIN soumis pour l'opération",{operationType:(M=g.value)==null?void 0:M.type});try{const Ne=((X=(Q=g.value)==null?void 0:Q.data)==null?void 0:X.seasonId)||((Pe=d.value)==null?void 0:Pe.id),E=await Nd(Ne,k);if(ve.debug("PIN validé",{valid:E}),E){tr.saveSession(Ne,k),ve.debug("PIN correct, fermeture de la modal et exécution de l'opération"),f.value=!1;const A=g.value;g.value=null,ve.debug("Appel de executePendingOperation",{operationType:A==null?void 0:A.type}),await ut(A)}else y.value="Code PIN incorrect",setTimeout(()=>{y.value=""},3e3)}catch(Ne){ve.error("Erreur lors de la vérification du PIN",Ne),y.value="Erreur lors de la vérification du code PIN"}}function qe(){f.value=!1,g.value=null,y.value=""}function tt(){return d.value&&tr.isPinCached(d.value.id)?{timeRemaining:tr.getTimeRemaining(),isExpiringSoon:tr.isExpiringSoon()}:null}async function ut(k){var X;if(ve.debug("executePendingOperation appelé",{hasOperation:!!k}),!k){ve.warn("Aucune opération à exécuter");return}const{type:M,data:Q}=k;ve.info("Exécution de l'opération",{type:M});try{switch(M){case"deleteSeason":ve.info("Suppression de la saison",{seasonId:Q.seasonId}),await DV(Q.seasonId),ve.info("Saison supprimée, rechargement de la liste"),e.value=await bf(),ve.info("Liste des saisons rechargée",{count:((X=e.value)==null?void 0:X.length)||0});break;default:ve.warn("Type d'opération non reconnu",{type:M})}}catch(Pe){ve.error("Erreur lors de l'exécution de l'opération",Pe),alert("Erreur lors de l'opération. Veuillez réessayer.")}}return(k,M)=>{var Q;return F(),U("div",iN,[h("div",oN,[h("button",{onClick:M[0]||(M[0]=X=>x.value=!0),class:"absolute right-4 top-4 text-white/90 hover:text-white p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},M[8]||(M[8]=[h("span",{class:"text-2xl"},"❓",-1)])),M[9]||(M[9]=h("h1",{class:"text-6xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent animate-pulse"}," Tu joues quand ? ",-1)),M[10]||(M[10]=h("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto leading-relaxed"},"Arrêtez de vous prendre la tête pour savoir qui sera sur scène quand. Laissez chacun indiquer ses dispos et le hasard choisir pour vous !",-1))]),h("div",{class:"container mx-auto px-4 pb-16","aria-busy":t.value},[t.value?(F(),U("div",lN,[(F(),U(gt,null,ur(8,X=>h("div",{key:"skeleton-"+X,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8"},M[11]||(M[11]=[h("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),h("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),h("div",{class:"h-px bg-white/10 mb-4"},null,-1),h("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(F(),U("div",uN,[(F(!0),U(gt,null,ur(P.value,(X,Pe)=>(F(),U("div",{key:X.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20"},[h("div",{onClick:Ne=>S(X.slug),class:"text-center cursor-pointer"},[M[12]||(M[12]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg"},[h("span",{class:"text-2xl"},"🎭")],-1)),h("h2",dN,le(X.name),1),M[13]||(M[13]=h("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),M[14]||(M[14]=h("p",{class:"text-gray-300 text-sm"}," Cliquez pour accéder ",-1))],8,cN),h("div",hN,[h("div",{class:"relative",onClick:M[1]||(M[1]=Dt(()=>{},["stop"]))},[h("button",{onClick:Ne=>j(Pe),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===Pe,"aria-haspopup":"true",title:"Options"},M[15]||(M[15]=[h("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,fN),s.value===Pe?(F(),U("div",pN,[h("button",{onClick:Ne=>{G(X),$()},class:"w-full text-left px-4 py-2 text-sm text-emerald-300 hover:bg-white/10",role:"menuitem"}," Exporter CSV ",8,mN),M[16]||(M[16]=h("div",{class:"border-t border-white/10 my-1"},null,-1)),h("button",{onClick:Ne=>B(Pe),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Monter ",8,gN),h("button",{onClick:Ne=>R(Pe),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Descendre ",8,vN),M[17]||(M[17]=h("div",{class:"border-t border-white/10 my-1"},null,-1)),h("button",{onClick:Ne=>Le(X),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10",role:"menuitem"}," Supprimer ",8,yN)])):he("",!0)])])]))),128))])):he("",!0),!t.value&&e.value.length>0?(F(),U("div",_N,[h("button",{onClick:M[2]||(M[2]=X=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105"}," ✨ Nouvelle saison ")])):he("",!0),!t.value&&e.value.length===0?(F(),U("div",bN,[M[18]||(M[18]=h("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[h("span",{class:"text-4xl"},"🎪")],-1)),M[19]||(M[19]=h("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),M[20]||(M[20]=h("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),h("button",{onClick:M[3]||(M[3]=X=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):he("",!0)],8,aN),i.value?(F(),U("div",wN,[h("div",IN,[M[25]||(M[25]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),h("div",EN,[M[21]||(M[21]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),rt(h("input",{"onUpdate:modelValue":M[4]||(M[4]=X=>a.value=X),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:Rt},null,544),[[At,a.value]])]),h("div",TN,[M[22]||(M[22]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),rt(h("input",{"onUpdate:modelValue":M[5]||(M[5]=X=>l.value=X),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[At,l.value]])]),h("div",xN,[M[23]||(M[23]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),rt(h("input",{"onUpdate:modelValue":M[6]||(M[6]=X=>c.value=X),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:Et},null,544),[[At,c.value]]),M[24]||(M[24]=h("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),h("div",AN,[h("button",{onClick:Me,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:Ye,disabled:!a.value.trim()||!l.value.trim()||!c.value.trim()||c.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,SN)])])])):he("",!0),o.value?(F(),U("div",PN,[h("div",RN,[h("div",CN,[M[26]||(M[26]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"⚠️")],-1)),M[27]||(M[27]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),h("p",kN,'Êtes-vous sûr de vouloir supprimer la saison "'+le((Q=d.value)==null?void 0:Q.name)+'" ?',1)]),M[28]||(M[28]=h("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:en,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:ln,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):he("",!0),at(lE,{show:f.value,message:Ct(),error:y.value,"session-info":tt(),onSubmit:se,onCancel:qe},null,8,["show","message","error","session-info"]),at(uE,{show:x.value,onClose:M[7]||(M[7]=X=>x.value=!1)},null,8,["show"]),M[29]||(M[29]=lr('<footer class="mt-16 border-t border-white/10"><div class="container mx-auto px-4 py-6 text-center text-xs text-gray-400"><span>© Patrice Lamarque 2025</span><span class="mx-2">•</span><span>Licence MIT</span><span class="mx-2">•</span><a href="https://github.com/plamarque/impro-selector" target="_blank" rel="noopener noreferrer" class="underline decoration-white/20 hover:decoration-white/40 hover:text-gray-200">GitHub</a></div></footer>',1))])}}},VN="modulepreload",NN=function(n){return"/"+n},l_={},an=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=NN(i),i in l_)return;l_[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":VN,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((d,f)=>{c.addEventListener("load",d),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},kh="magicLinks";function Dh({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function og(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function mp({seasonId:n,playerId:e,eventId:t,action:r}){const s=Dh({seasonId:n,playerId:e,eventId:t,action:r}),i=og(40),o=Ae(ue,kh,s),a=Date.now()+1e3*60*60*24*7;await fn(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const c=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:c}}async function pE({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=Dh({seasonId:n,playerId:e,eventId:r,action:s}),o=og(40),a=Ae(ue,kh,i),l=Date.now()+1e3*60*60*24*7;await fn(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const d=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:d}}async function mE({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=Dh({seasonId:n,playerId:e,eventId:t,action:s}),o=Ae(ue,kh,i),a=await Sn(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function gp({seasonId:n,playerId:e,eventId:t,action:r}){const s=Dh({seasonId:n,playerId:e,eventId:t,action:r}),i=Ae(ue,kh,s);await Ua(i)}const ag="accountMagicLinks";function Vh(n){return`account__${n}`}async function gE({currentEmail:n,newEmail:e}){const t=og(40),r=Vh(t),s=Ae(ue,ag,r),i=Date.now()+1e3*60*60*24*7;await fn(s,{token:t,currentEmail:n,newEmail:e,action:"account_email_update",expiresAt:i});const a=`${window.location.origin+"/"}magic?a=account_email_update&t=${encodeURIComponent(t)}`;return{id:r,token:t,url:a}}async function vE({token:n}){const e=Vh(n),t=Ae(ue,ag,e),r=await Sn(t);if(!r.exists())return{valid:!1,reason:"not_found"};const s=r.data();return s.token!==n?{valid:!1,reason:"token_mismatch"}:typeof s.expiresAt=="number"&&Date.now()>s.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:s}}async function yE({token:n}){const e=Vh(n),t=Ae(ue,ag,e);await Ua(t)}const ON=Object.freeze(Object.defineProperty({__proto__:null,buildAccountId:Vh,consumeAccountEmailUpdateLink:yE,consumeMagicLink:gp,createAccountEmailUpdateLink:gE,createEmailVerificationLink:pE,createMagicLink:mp,verifyAccountEmailUpdateLink:vE,verifyMagicLink:mE},Symbol.toStringTag,{value:"Module"})),u_="impro_selector_trusted_players",c_=180*24*60*60*1e3;class MN{constructor(){this.trustedMap=this.load()}load(){try{const e=localStorage.getItem(u_);if(!e)return{};const t=JSON.parse(e);return typeof t=="object"&&t!==null?t:{}}catch{return{}}}persist(){try{localStorage.setItem(u_,JSON.stringify(this.trustedMap))}catch{}}isPasswordCached(e){if(!e)return!1;const t=this.trustedMap[e];if(!t)return!1;const r=Date.now(),s=r-t<c_;return s?(this.trustedMap[e]=r,this.persist()):(delete this.trustedMap[e],this.persist()),s}getCachedPassword(e){return null}saveSession(e,t){e&&(this.trustedMap[e]=Date.now(),this.persist())}clearSession(e){e&&(delete this.trustedMap[e],this.persist())}clearExpiredSessions(){const e=Date.now();let t=!1;for(const[r,s]of Object.entries(this.trustedMap))e-s>c_&&(delete this.trustedMap[r],t=!0);t&&this.persist()}clearAllSessions(){this.trustedMap={},this.persist()}}const Pi=new MN;function lg(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function Od(n){return`seasonPreferredPlayer:${n||"global"}`}async function _E(n,e,t,r=null){try{ve.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await sl(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await an(()=>import("./index.esm-d2ede4d0.js"),[]),{db:c}=await an(()=>Promise.resolve().then(()=>mi),void 0),d=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(d,a("email","==",e)),g=await l(f);if(!g.empty&&g.docs.find(D=>D.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");ve.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:y}=await an(()=>import("./index.esm-8135c0a2.js"),[]),{auth:x}=await an(()=>Promise.resolve().then(()=>mi),void 0),P=await y(x,e,t);ve.info("Compte Firebase Auth créé",{uid:P.user.uid});const S=lg(t),j=r?Ae(c,"seasons",r,"playerProtection",n):Ae(c,"playerProtection",n);await fn(j,{playerId:n,email:e,passwordHash:S,firebaseUid:P.user.uid,isProtected:!0,createdAt:new Date}),ve.info("Protection sauvegardée dans Firestore");try{r&&localStorage.setItem(Od(r),n)}catch{}return{success:!0}}catch(s){throw ve.error("Erreur lors de la protection du joueur",s),s}}async function bE({playerId:n,email:e,seasonId:t=null}){const r=t?Ae(ue,"seasons",t,"playerProtection",n):Ae(ue,"playerProtection",n);(await Sn(r)).exists()?await el(r,{email:e,updatedAt:new Date}):await fn(r,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:i}=await pE({seasonId:t,playerId:n,email:e});return{success:!0,url:i}}async function wE({playerId:n,seasonId:e=null}){const t=e?Ae(ue,"seasons",e,"playerProtection",n):Ae(ue,"playerProtection",n);if(!(await Sn(t)).exists())throw new Error("Protection introuvable");return await el(t,{emailVerifiedAt:new Date}),{success:!0}}async function IE({playerId:n,seasonId:e=null}){const t=e?Ae(ue,"seasons",e,"playerProtection",n):Ae(ue,"playerProtection",n);return await el(t,{emailVerifiedAt:null}),{success:!0}}async function EE(n,e=null){try{const t=e?Ae(ue,"seasons",e,"playerProtection",n):Ae(ue,"playerProtection",n);await fn(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date});try{if(e){const r=Od(e);localStorage.getItem(r)===n&&localStorage.removeItem(r)}}catch{}return{success:!0,email:""}}catch(t){throw ve.error("Erreur lors de la suppression de la protection",t),t}}async function vi(n,e=null){try{const t=e?Ae(ue,"seasons",e,"playerProtection",n):Ae(ue,"playerProtection",n),r=await Sn(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return ve.error("Erreur lors de la vérification de protection",t),!1}}async function sl(n,e=null){try{const t=e?Ae(ue,"seasons",e,"playerProtection",n):Ae(ue,"playerProtection",n),r=await Sn(t);return r.exists()?r.data():null}catch(t){return ve.error("Erreur lors de la récupération des données de protection",t),null}}async function TE(n,e=null){try{const t=await sl(n,e);return(t==null?void 0:t.email)||""}catch(t){return ve.error("Erreur lors de la récupération de l'email",t),""}}async function vp(n=null){try{const e=n?He(ue,"seasons",n,"playerProtection"):He(ue,"playerProtection");return(await pt(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return ve.error("Erreur lors du chargement des protections",e),[]}}async function xE(n){try{const e=[],t=Eu(He(ue,"playerProtection"),Rd("email","==",n));(await pt(t)).forEach(i=>{const o=i.data();o!=null&&o.isProtected&&e.push({seasonId:null,playerId:i.id,...o})});const s=await pt(He(ue,"seasons"));for(const i of s.docs){const o=i.id,a=Eu(He(ue,"seasons",o,"playerProtection"),Rd("email","==",n));(await pt(a)).forEach(c=>{var f;const d=c.data();d!=null&&d.isProtected&&e.push({seasonId:o,seasonName:(f=i.data())==null?void 0:f.name,playerId:c.id,...d})})}return e}catch(e){return ve.error("Erreur listAssociationsForEmail",e),[]}}async function AE(n,e,t=null){try{const r=await sl(n,t);if(!r||!r.isProtected)return!1;if(r.email){ve.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await an(()=>import("./index.esm-8135c0a2.js"),[]),{auth:i}=await an(()=>Promise.resolve().then(()=>mi),void 0);await s(i,r.email,e),ve.debug("Mot de passe Firebase Auth valide"),Pi.saveSession(n);try{t&&localStorage.setItem(Od(t),n)}catch{}return!0}catch(s){return ve.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{ve.debug("Vérification avec hash local");const s=lg(e),i=r.passwordHash===s;if(i){Pi.saveSession(n);try{t&&localStorage.setItem(Od(t),n)}catch{}}return i}}catch(r){return ve.error("Erreur lors de la vérification du mot de passe",r),!1}}async function SE({playerId:n,seasonId:e=null}){const t=e?Ae(ue,"seasons",e,"playerProtection",n):Ae(ue,"playerProtection",n),r=await Sn(t);if(!r.exists())throw new Error("Protection introuvable");const s=r.data();if(s!=null&&s.email)return await el(t,{isProtected:!0,updatedAt:new Date}),{success:!0};throw new Error("Email non défini pour cette protection")}function mo(n){return Pi.isPasswordCached(n)}function LN(n){return null}async function PE(n,e=null){try{ve.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await sl(n,e);if(ve.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(ve.debug("Email à utiliser (masqué)"),t.firebaseUid){ve.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await an(()=>import("./index.esm-8135c0a2.js"),[]),{auth:s}=await an(()=>Promise.resolve().then(()=>mi),void 0);ve.debug("Tentative d'envoi d'email"),await r(s,t.email),ve.info("Email envoyé avec succès via Firebase Auth")}else{ve.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await an(()=>import("./index.esm-8135c0a2.js"),[]),{auth:i}=await an(()=>Promise.resolve().then(()=>mi),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);ve.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),ve.info("Email envoyé avec succès");const{updateDoc:l}=await an(()=>import("./index.esm-d2ede4d0.js"),[]),{db:c}=await an(()=>Promise.resolve().then(()=>mi),void 0),d=e?Ae(c,"seasons",e,"playerProtection",n):Ae(c,"playerProtection",n);await l(d,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")ve.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),ve.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw ve.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function FN(n,e,t=null){try{const r=lg(e),s=t?Ae(ue,"seasons",t,"playerProtection",n):Ae(ue,"playerProtection",n);return await el(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw ve.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function $N(n){return new Promise((e,t)=>{ve.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const Nh=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:IE,finalizeProtectionAfterVerification:SE,getCachedPlayerPassword:LN,getPlayerEmail:TE,getPlayerProtectionData:sl,isPlayerPasswordCached:mo,isPlayerProtected:vi,listAssociationsForEmail:xE,listProtectedPlayers:vp,markEmailVerifiedForProtection:wE,protectPlayer:_E,requirePlayerPasswordForAvailability:$N,sendPasswordResetEmail:PE,startEmailVerificationForProtection:bE,unprotectPlayer:EE,updatePlayerPasswordInFirestore:FN,verifyPlayerPassword:AE},Symbol.toStringTag,{value:"Module"}));async function UN({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,reason:o="new_event",fromEmail:a=void 0}){try{const f=Ae(ue,"userPreferences",n),g=await Sn(f);if(g.exists()){const y=g.data();if((y==null?void 0:y.notifyAvailability)===!1)return{success:!0,skipped:!0}}}catch{}const l=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>Disponibilité demandée</h2>
      <p>Bonjour ${e},</p>
      <p>Peux-tu indiquer ta disponibilité pour <strong>${t}</strong> (${r}) ?</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;margin-right:8px;background:#16a34a;color:#fff;border-radius:8px;text-decoration:none;">Je suis dispo ✅</a>
        <a href="${i}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Pas dispo ❌</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: ${o}</p>
    </div>
  `,c=`Disponibilité demandée · ${t}`,d={to:n,message:{subject:c,html:l},createdAt:Ju(),meta:{reason:o,eventTitle:t,eventDate:r,playerName:e}};return a&&(d.from=a,d.replyTo=a),await Ih(He(ue,"mail"),d),{success:!0}}async function RE({toEmail:n,verifyUrl:e,purpose:t="player_protection",displayName:r="utilisateur",fromEmail:s=void 0}){const i=t==="account_email_update",o=i?"Vérification de votre nouvelle adresse email":"Vérification de votre email",a=`Bonjour ${r},`,l=i?"Pour sécuriser votre compte, merci de confirmer que vous avez accès à cette nouvelle adresse email.":"Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.",c=i?"Confirmer mon adresse email":"Vérifier mon email",d=i?"Confirmez votre nouvelle adresse email":"Confirmez votre email pour activer la protection",f=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>${o}</h2>
      <p>${a}</p>
      <p>${l}</p>
      <p>
        <a href="${e}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">${c}</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,g={to:n,message:{subject:d,html:f},createdAt:Ju(),meta:{reason:t,displayName:r}};s&&(g.from=s,g.replyTo=s),await Ih(He(ue,"mail"),g)}async function jN({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){return RE({toEmail:n,verifyUrl:t,purpose:"player_protection",displayName:e,fromEmail:r})}async function BN({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0}){try{const f=Ae(ue,"userPreferences",n),g=await Sn(f);if(g.exists()){const y=g.data();if((y==null?void 0:y.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}ve.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const l=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Tu as été sélectionné(e) !</h2>
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#8b5cf6;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,c=o||`🎭 Sélection confirmée · ${t}`;ve.debug("queueSelectionEmail html/subject ready");const d={to:n,message:{subject:c,html:l},createdAt:Ju(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}};a&&(d.from=a,d.replyTo=a),ve.debug("queueSelectionEmail firestore payload ready");try{return await Ih(He(ue,"mail"),d),ve.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(f){throw ve.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:f}),f}}async function qN({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(ve.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await an(()=>Promise.resolve().then(()=>Nh),void 0),{createMagicLink:a}=await an(()=>Promise.resolve().then(()=>ON),void 0),l=`${window.location.origin}/season/${s}/event/${n}`,c=t.join(", "),d=`🎭 Sélection confirmée · ${e.title}`,f=[];for(const g of t){ve.debug("Traitement du joueur",{playerName:g});try{const y=i==null?void 0:i.find(D=>D.name===g);if(!y){ve.warn("Joueur non trouvé",{playerName:g});continue}ve.debug("Joueur trouvé");const x=await o(y.id,r);if(!x){ve.warn("Pas d'email pour le joueur",{playerName:g});continue}ve.debug("Email trouvé pour joueur");const S=`${(await a({seasonId:r,playerId:y.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,j=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection confirmée</h2>
          <p>Bonjour <strong>${g}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${d_(e.date)}).</p>
          <p>Sélection complète : <strong>${c}</strong>.</p>
          <p>Tu n'es plus disponible ? Signale le rapidement ici :</p>
          <p>
            <a href="${S}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Signaler que je ne suis plus disponible</a>
          </p>
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 16px;background:#8b5cf6;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;ve.debug("HTML généré pour joueur");const $=BN({toEmail:x,playerName:g,eventTitle:e.title,eventDate:d_(e.date),eventUrl:l,html:j,subject:d});f.push($),ve.info("Email ajouté à la queue",{playerName:g})}catch(y){ve.error("Erreur lors de l'envoi de l'email de sélection",{playerName:g,error:y})}}return ve.info("Nombre total d'emails à envoyer",{count:f.length}),await Promise.all(f),ve.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:f.length}}function d_(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}const zN={class:"relative p-5 pb-4 border-b border-white/10"},GN={class:"text-xl md:text-2xl font-bold text-white pr-10"},KN={key:0,class:"text-sm text-purple-300 mt-1"},HN={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},WN={class:"bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20 p-3"},QN={class:"text-blue-200 text-sm"},JN={class:"flex space-x-1 bg-gray-800 rounded-lg p-1"},YN=["onClick"],XN={key:0,class:"space-y-4"},ZN={class:"bg-gray-800 border border-gray-600 rounded-lg p-4 text-white whitespace-pre-line"},eO={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},tO={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},nO={class:"text-blue-200 text-sm"},rO={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},sO={key:0,class:"space-y-2"},iO={class:"flex flex-wrap gap-2"},oO={key:1,class:"text-amber-400 text-sm"},aO={key:1,class:"space-y-4"},lO={class:"relative"},uO=["value"],cO=["title"],dO={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},hO={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},fO={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},pO=["disabled"],mO={key:0},gO={key:1},CE={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]}},emits:["close","notifications-sent","send-email-notifications"],setup(n,{emit:e}){const t=n,r=e,s=O("email"),i=O(!1),o=O("Copier le message"),a=O(!1),l=O(!1),c=[{id:"email",label:"📧 Email"},{id:"copy",label:"📋 Copie"}],d=Be(()=>!t.event||!t.seasonSlug?"":`${window.location.origin}/season/${t.seasonSlug}/event/${t.event.id}`),f=Be(()=>{if(!t.event)return"";const D=S(t.event.date);if(t.mode==="selection"){const G=t.selectedPlayers.join(", ");return`Sélection pour ${t.event.title} du ${D} : ${G}`}else return`Bonjour !

Nouvel événement : ${t.event.title}
Date : ${D}

Lien direct vers l'événement : ${d.value}

Merci de confirmer votre disponibilité.`}),g=Be(()=>{if(!t.event||!t.selectedPlayers)return"";if(t.mode==="selection"){const D=t.selectedPlayers.join(", ");return`Sélection confirmée

Bonjour [Nom du joueur],

Tu as été sélectionné(e) pour ${t.event.title} (${S(t.event.date)}).

Sélection complète : ${D}.

Tu n'es plus disponible ? Signale le rapidement ici : [Lien de désistement]`}else return`Disponibilité demandée

Bonjour [Nom du joueur],

Peux-tu indiquer ta disponibilité pour ${t.event.title} (${S(t.event.date)}) ?`}),y=O([]);async function x(){if(!t.seasonId)return;let D=[];t.mode==="selection"?D=t.players.filter(Z=>t.selectedPlayers.includes(Z.name)):D=t.players.filter(Z=>Z.isProtected);const G=[];for(const Z of D)try{const{getPlayerEmail:pe}=await an(()=>Promise.resolve().then(()=>Nh),void 0),T=await pe(Z.id,t.seasonId);T&&G.push({...Z,email:T})}catch(pe){console.warn(`Impossible de charger l'email pour ${Z.name}:`,pe)}y.value=G}function P(){r("close")}function S(D){var Z;return D?(typeof D=="string"?new Date(D):((Z=D.toDate)==null?void 0:Z.call(D))||D).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function j(){const D=f.value;navigator.clipboard.writeText(D).then(()=>{i.value=!0,o.value="Copié !",setTimeout(()=>{i.value=!1,o.value="Copier le message"},2e3)}).catch(G=>{console.warn("Erreur lors de la copie du texte"),alert("Impossible de copier le message.")})}async function $(){if(!(!t.event||y.value.length===0)){a.value=!0;try{t.mode==="selection"?r("send-email-notifications",{eventId:t.event.id,eventData:t.event,reason:"selection",selectedPlayers:t.selectedPlayers}):r("send-email-notifications",{eventId:t.event.id,eventData:t.event,reason:"manual"})}catch{console.error("Erreur lors de l'envoi des notifications"),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer.")}finally{a.value=!1}}}return wr(()=>{t.show&&(s.value="email",x())}),Vt(()=>t.show,D=>{D&&(s.value="email",x())}),Vt(()=>t.selectedPlayers,()=>{t.show&&t.mode==="selection"&&x()}),(D,G)=>n.show?(F(),U("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:P},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:G[1]||(G[1]=Dt(()=>{},["stop"]))},[h("div",zN,[h("button",{onClick:P,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),h("h2",GN,le(n.mode==="selection"?"Annoncer la sélection":"Annoncer l'événement"),1),n.event?(F(),U("p",KN,le(n.event.title)+" — "+le(S(n.event.date)),1)):he("",!0)]),h("div",HN,[h("div",WN,[h("p",QN,le(n.mode==="selection"?"Choisis comment annoncer cette sélection aux joueurs :":"Choisis comment annoncer cet événement aux joueurs :"),1)]),h("div",JN,[(F(),U(gt,null,ur(c,Z=>h("button",{key:Z.id,onClick:pe=>s.value=Z.id,class:hn(["flex-1 px-4 py-2 rounded-md text-sm font-medium transition-all duration-200",s.value===Z.id?"bg-purple-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-700"])},le(Z.label),11,YN)),64))]),s.value==="email"?(F(),U("div",XN,[h("div",null,[G[2]||(G[2]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Prévisualisation du message :",-1)),h("div",ZN,le(g.value),1)]),h("div",null,[h("label",eO,[G[3]||(G[3]=Ln(" Destinataires ")),h("button",{onClick:G[0]||(G[0]=Z=>l.value=!l.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),l.value?(F(),U("div",tO,[h("p",nO,le(n.mode==="selection"?"Les destinataires sont les joueurs sélectionnés qui ont renseigné une adresse email en utilisant la fonction Protéger.":"Les destinataires sont les joueurs qui ont renseigné une adresse email en utilisant la fonction Protéger."),1)])):he("",!0),h("div",rO,[y.value.length>0?(F(),U("div",sO,[h("div",iO,[(F(!0),U(gt,null,ur(y.value,Z=>(F(),U("span",{key:Z.id,class:"px-3 py-1 bg-gray-700 text-white rounded text-sm"},le(Z.name),1))),128))])])):(F(),U("div",oO," ⚠️ "+le(n.mode==="selection"?"Aucun joueur sélectionné avec email renseigné. Les notifications ne pourront pas être envoyées.":"Aucun joueur protégé avec email renseigné. Les notifications ne pourront pas être envoyées."),1))])])])):he("",!0),s.value==="copy"?(F(),U("div",aO,[G[6]||(G[6]=h("div",{class:"bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-500/20 p-3"},[h("p",{class:"text-purple-200 text-sm"},"📋 Copie du message pour partage manuel")],-1)),h("div",lO,[h("textarea",{value:f.value,class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",rows:"6",readonly:""},null,8,uO),h("button",{onClick:j,class:"absolute top-2 right-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg p-2 hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:o.value},[i.value?(F(),U("svg",hO,G[5]||(G[5]=[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(F(),U("svg",dO,G[4]||(G[4]=[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2z"},null,-1)])))],8,cO)])])):he("",!0)]),h("div",fO,[s.value==="email"?(F(),U("button",{key:0,onClick:$,disabled:y.value.length===0||a.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[a.value?(F(),U("span",gO,"📧 Envoi en cours...")):(F(),U("span",mO,"📧 Envoyer les notifications email"))],8,pO)):he("",!0),s.value==="copy"?(F(),U("button",{key:1,onClick:j,class:"h-12 px-6 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 flex-1"}," 📋 Copier le message ")):he("",!0),h("button",{onClick:P,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):he("",!0)}},vO={class:"text-center mb-6"},yO={class:"text-lg text-gray-300"},_O={class:"mb-6"},bO={class:"space-y-4"},wO={class:"flex items-center gap-2 text-gray-300 text-sm"},IO=["disabled"],EO={key:0,class:"animate-spin"},TO={key:1},xO={class:"mb-6 text-center"},AO={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},SO={class:"text-red-300 text-sm"},PO={class:"text-center mb-6"},RO={class:"text-lg text-gray-300"},CO={class:"mb-6"},kO=["disabled"],DO={key:0,class:"animate-spin"},VO={key:1},NO={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},OO={class:"text-red-300 text-sm"},MO={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},LO={class:"text-green-300 text-sm"},FO={class:"flex justify-center"},ug={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=O(""),i=O(!1),o=O(""),a=O(!1),l=O(""),c=O(""),d=O(null),f=O(!0);async function g(){if(s.value){i.value=!0,o.value="";try{const P=await hp(t.seasonId);if(s.value===P){if(f.value)try{Pi.saveSession(t.player.id)}catch{}r("verified",{type:"season_pin"}),x();return}if(await AE(t.player.id,s.value,t.seasonId)){if(f.value)try{Pi.saveSession(t.player.id)}catch{}r("verified",{type:"player_password"}),x()}else o.value="Mot de passe incorrect. Veuillez réessayer."}catch(P){ve.error("Erreur lors de la vérification",P),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function y(){i.value=!0,l.value="",c.value="";try{const P=await PE(t.player.id,t.seasonId);c.value=P.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(P){ve.error("Erreur lors de l'envoi de l'email",P),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function x(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return Vt(()=>t.show,P=>{P&&dn(()=>{d.value&&d.value.focus()})}),(P,S)=>{var j,$;return F(),U(gt,null,[n.show?(F(),U("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:x},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:S[3]||(S[3]=Dt(()=>{},["stop"]))},[h("div",vO,[S[7]||(S[7]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔐")],-1)),S[8]||(S[8]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),h("p",yO,le((j=n.player)==null?void 0:j.name),1),S[9]||(S[9]=h("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),h("div",_O,[h("div",bO,[h("div",null,[S[10]||(S[10]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),rt(h("input",{"onUpdate:modelValue":S[0]||(S[0]=D=>s.value=D),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:Nn(g,["enter"]),ref_key:"passwordInput",ref:d},null,544),[[At,s.value]])]),h("div",wO,[rt(h("input",{id:"staySignedIn",type:"checkbox","onUpdate:modelValue":S[1]||(S[1]=D=>f.value=D),class:"w-4 h-4"},null,512),[[ba,f.value]]),S[11]||(S[11]=h("label",{for:"staySignedIn"},"Rester connecté sur cet appareil",-1))])]),h("button",{onClick:g,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(F(),U("span",EO,"⏳")):(F(),U("span",TO,"🔓")),h("span",null,le(i.value?"Vérification...":"Vérifier"),1)],8,IO)]),h("div",xO,[h("button",{onClick:S[2]||(S[2]=D=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(F(),U("div",AO,[h("div",SO,le(o.value),1)])):he("",!0),h("div",{class:"flex justify-center"},[h("button",{onClick:x,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):he("",!0),a.value?(F(),U("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:S[6]||(S[6]=D=>a.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:S[5]||(S[5]=Dt(()=>{},["stop"]))},[h("div",PO,[S[12]||(S[12]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"📧")],-1)),S[13]||(S[13]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),h("p",RO,le(($=n.player)==null?void 0:$.name),1)]),h("div",CO,[S[14]||(S[14]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:y,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(F(),U("span",DO,"⏳")):(F(),U("span",VO,"📧")),h("span",null,le(i.value?"Envoi...":"Envoyer l'email"),1)],8,kO)]),l.value?(F(),U("div",NO,[h("div",OO,le(l.value),1)])):he("",!0),c.value?(F(),U("div",MO,[h("div",LO,le(c.value),1)])):he("",!0),h("div",FO,[h("button",{onClick:S[4]||(S[4]=D=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):he("",!0)],64)}}},$O={class:"text-center mb-6"},UO={class:"text-sm text-gray-300"},jO={key:0,class:"space-y-4"},BO={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},qO={key:1,class:"space-y-4"},zO=["disabled"],GO={key:0,class:"animate-spin"},KO={key:1},HO={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},WO={class:"mt-6 flex justify-center gap-3"},QO=["disabled"],JO={key:0,class:"animate-spin"},YO={key:1},kE={__name:"AccountClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=O(1),i=O(""),o=O(""),a=O(""),l=O(!1),c=O(""),d=O(!1),f=ja(),g=Be(()=>i.value&&i.value.includes("@")),y=Be(()=>o.value&&a.value&&o.value===a.value&&o.value.length>=6);async function x(){var $,D,G;if(!(!g.value||!(($=t.player)!=null&&$.id))){l.value=!0,c.value="";try{const Z=await bE({playerId:t.player.id,email:i.value.trim(),seasonId:t.seasonId}),pe=(D=f.params)==null?void 0:D.slug,T=`${Z.url}${pe?`&slug=${encodeURIComponent(pe)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await jN({toEmail:i.value,playerName:((G=t.player)==null?void 0:G.name)||"joueur",verifyUrl:T}),d.value=!0}catch{c.value="Impossible d'envoyer l'email de vérification"}finally{l.value=!1}}}async function P(){try{await IE({playerId:t.player.id,seasonId:t.seasonId})}catch{}s.value=1,d.value=!1,i.value="",o.value="",a.value=""}async function S(){var $;try{const D=await sl(($=t.player)==null?void 0:$.id,t.seasonId);D!=null&&D.email&&(D!=null&&D.emailVerifiedAt)?s.value=2:s.value=1}catch{s.value=1}}wr(()=>{S()}),Vt(()=>t.show,$=>{$&&S()});async function j(){if(y.value){l.value=!0,c.value="";try{await _E(t.player.id,i.value.trim(),o.value,t.seasonId),r("success")}catch($){c.value=($==null?void 0:$.message)||"Erreur lors de l'association"}finally{l.value=!1}}}return($,D)=>{var G;return n.show?(F(),U("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:D[6]||(D[6]=Z=>$.$emit("close"))},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:D[5]||(D[5]=Dt(()=>{},["stop"]))},[h("button",{onClick:D[0]||(D[0]=Z=>$.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),h("div",$O,[D[7]||(D[7]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"👤")],-1)),D[8]||(D[8]=h("h2",{class:"text-2xl font-bold text-white mb-1"},"Associer un compte",-1)),h("p",UO,"Pour sécuriser les saisies de "+le((G=n.player)==null?void 0:G.name),1)]),s.value===1?(F(),U("div",jO,[h("div",null,[D[9]||(D[9]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),rt(h("input",{"onUpdate:modelValue":D[1]||(D[1]=Z=>i.value=Z),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[At,i.value]])]),d.value?(F(),U("div",BO,[D[10]||(D[10]=h("span",null,"✅",-1)),h("span",null,"Un email a été envoyé à "+le(i.value)+". Cliquez sur le lien contenu dans l'email pour continuer.",1)])):he("",!0)])):s.value===2?(F(),U("div",qO,[h("div",{class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},[D[11]||(D[11]=h("span",null,"✅",-1)),D[12]||(D[12]=h("span",null,"Adresse email vérifiée",-1)),h("button",{type:"button",onClick:P,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")]),h("div",null,[D[13]||(D[13]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),rt(h("input",{"onUpdate:modelValue":D[2]||(D[2]=Z=>o.value=Z),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[At,o.value]])]),h("div",null,[D[14]||(D[14]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),rt(h("input",{"onUpdate:modelValue":D[3]||(D[3]=Z=>a.value=Z),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[At,a.value]])]),h("button",{onClick:j,disabled:!y.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(F(),U("span",GO,"⏳")):(F(),U("span",KO,"🔒")),h("span",null,le(l.value?"Association...":"Associer ce joueur"),1)],8,zO)])):he("",!0),c.value?(F(),U("div",HO,le(c.value),1)):he("",!0),h("div",WO,[h("button",{onClick:D[4]||(D[4]=Z=>$.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),s.value===1?(F(),U("button",{key:0,onClick:x,disabled:!g.value||l.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(F(),U("span",JO,"⏳")):(F(),U("span",YO,"✉️")),h("span",null,le(l.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,QO)):he("",!0)])])])):he("",!0)}}},XO={class:"mt-4"},ZO={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-2"},DE={__name:"AccountBenefitsHint",setup(n){const e=O(!1);return(t,r)=>(F(),U("div",XO,[h("button",{onClick:r[0]||(r[0]=s=>e.value=!e.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[r[1]||(r[1]=h("h3",{class:"text-sm font-semibold text-blue-300"},"💡 A quoi sert un compte ?",-1)),h("span",{class:hn(["text-blue-300 transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(F(),U("div",ZO,r[2]||(r[2]=[h("div",{class:"text-gray-300"},"Ça fonctionne très bien sans compte. Mais si vous en créez un, vous aurez quelques trucs sympas en plus :",-1),h("div",null,[Ln("• "),h("span",{class:"text-blue-300"},"Protégez vos saisies :"),Ln(" vous êtes sûr que personne n'a changé vos dispos car vous êtes le seul à pouvoir les modifier")],-1),h("div",null,[Ln("• "),h("span",{class:"text-blue-300"},"Notifications :"),Ln(" nouveaux spectacles, disponibilités et sélections dans votre boite mail")],-1),h("div",null,[Ln("• "),h("span",{class:"text-blue-300"},"Saisie simplifiée :"),Ln(" votre joueur reste toujours en haut de la liste")],-1)]))):he("",!0)]))}},eM={class:"text-center mb-6"},tM={class:"text-2xl font-bold text-white mb-2"},nM={class:"text-lg text-gray-300"},rM={class:"mb-6"},sM={class:"flex items-center space-x-3"},iM={class:"text-2xl"},oM={class:"font-semibold text-white"},aM={class:"text-sm text-gray-300"},lM={key:0,class:"mb-6"},uM={key:1,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},cM={class:"text-red-300 text-sm"},dM={key:2,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},hM={class:"text-green-300 text-sm"},fM={class:"flex justify-center gap-3"},pM=["disabled"],mM={__name:"PlayerClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=O(!1),i=O(!1),o=O(!1),a=O(""),l=O(""),c=O(!1);ja();const d=O(!1);Be(()=>!1),Be(()=>!1);function f(){l.value="Compte créé et joueur associé !",s.value=!0,c.value=!1,r("update")}async function g(){var j;if((j=t.player)!=null&&j.id){s.value=await vi(t.player.id,t.seasonId);try{const{isPlayerPasswordCached:$}=await an(()=>Promise.resolve().then(()=>Nh),void 0);i.value=$(t.player.id)}catch{i.value=!1}}}function y(){var j;a.value="";try{if((j=t.player)!=null&&j.id&&mo(t.player.id)){x();return}}catch{}d.value=!0}async function x(){o.value=!0,a.value="",l.value="";try{const j=await EE(t.player.id,t.seasonId);l.value="Joueur déverrouillé!",s.value=!1,j.email&&(email.value=j.email),r("update")}catch(j){logger.error("Erreur lors de la désactivation de la protection",j),a.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{o.value=!1}}function P(){d.value=!1,x()}function S(){r("close")}return Vt(()=>t.player,()=>{t.show&&t.player&&g()},{immediate:!0}),Vt(()=>t.show,j=>{j&&t.player&&(a.value="",l.value="",d.value=!1,g(),t.onboarding&&dn(()=>{}))}),(j,$)=>{var D;return F(),U(gt,null,[n.show?(F(),U("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:S},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:$[1]||($[1]=Dt(()=>{},["stop"]))},[h("button",{onClick:S,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),h("div",eM,[$[4]||($[4]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔒")],-1)),h("h2",tM,le(s.value?"Déverrouiller ce joueur":"Verrouiller ce joueur"),1),h("p",nM,le((D=n.player)==null?void 0:D.name),1)]),h("div",rM,[h("div",{class:hn(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[h("div",sM,[h("span",iM,le(s.value?"🔒":"🔓"),1),h("div",null,[h("div",oM,le(s.value?i.value?"Joueur associé à votre compte":"Ce joueur est associé à un compte utilisateur":"Joueur sans compte"),1),h("div",aM,le(s.value?i.value?"Seul vous pouvez modifier":"Seul le titulaire peut modifier les disponibilités":"Tout le monde peut modifier les disponibilités"),1)])])],2)]),s.value?he("",!0):(F(),U("div",lM,$[5]||($[5]=[h("div",{class:"text-sm text-gray-300"},"Vous pouvez protéger vos saisies de disponibilités avec un compte utilisateur.",-1)]))),a.value?(F(),U("div",uM,[h("div",cM,le(a.value),1)])):he("",!0),l.value?(F(),U("div",dM,[h("div",hM,le(l.value),1)])):he("",!0),h("div",fM,[h("button",{onClick:S,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer "),s.value?(F(),U("button",{key:1,onClick:y,disabled:o.value,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," 🔓 Dissocier ",8,pM)):(F(),U("button",{key:0,onClick:$[0]||($[0]=G=>c.value=!0),class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300"}," Associer un compte "))]),s.value?he("",!0):(F(),au(DE,{key:3}))])])):he("",!0),at(kE,{show:c.value,player:n.player,"season-id":n.seasonId,onClose:$[2]||($[2]=G=>c.value=!1),onSuccess:f},null,8,["show","player","season-id"]),at(ug,{show:d.value,player:n.player,seasonId:n.seasonId,onClose:$[3]||($[3]=G=>d.value=!1),onVerified:P},null,8,["show","player","seasonId"])],64)}}};const gM=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},vM={class:"relative text-center p-6 pb-4 border-b border-white/10"},yM={class:"text-2xl md:text-3xl font-bold text-white mb-1"},_M={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},bM={class:"grid grid-cols-3 gap-3 md:gap-4"},wM={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},IM={class:"text-xl md:text-2xl font-bold text-white"},EM={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},TM={class:"text-xl md:text-2xl font-bold text-white"},xM={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},AM={class:"text-xl md:text-2xl font-bold text-white"},SM={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},PM={key:0,class:"md:hidden mt-3 space-y-2"},RM={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},CM={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},kM={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},DM={class:"mb-6"},VM={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=O(!1),o=O(""),a=O(null),l=O(!1),c=O(!1),d=O(null),f=O(!1),g=O(!1),y=O(!1);function x(){s("close")}function P(){var w;o.value=((w=r.player)==null?void 0:w.name)||"",i.value=!0,dn(()=>{a.value&&a.value.focus()})}function S(){i.value=!1,o.value=""}async function j(){var I,C;if(!o.value.trim())return;if(await vi((I=r.player)==null?void 0:I.id,r.seasonId)){mo((C=r.player)==null?void 0:C.id)?$():(d.value="update",c.value=!0);return}$()}function $(){var w;s("update",{playerId:(w=r.player)==null?void 0:w.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function D(){var I,C;if(await vi((I=r.player)==null?void 0:I.id,r.seasonId)){mo((C=r.player)==null?void 0:C.id)?G():(d.value="delete",c.value=!0);return}G()}function G(){var w;s("delete",(w=r.player)==null?void 0:w.id)}function Z(){s("refresh")}function pe(w){d.value==="update"?$():d.value==="delete"&&G(),d.value=null}Vt(()=>r.show,w=>{var I;w||(i.value=!1,o.value="",d.value=null,l.value=!1),w&&((I=r.player)!=null&&I.id)&&(vi(r.player.id,r.seasonId).then(C=>{g.value=!!C}),an(()=>Promise.resolve().then(()=>Nh),void 0).then(C=>{try{y.value=!!C.isPlayerPasswordCached(r.player.id)}catch{y.value=!1}}))}),e({openProtection(){l.value=!0}});const T=O({position:null});return Vt(()=>r.show,w=>{w&&r.onboardingStep===4?dn(()=>{const I=document.querySelectorAll("button");let C=null;if(I.forEach(V=>{!C&&V.textContent&&V.textContent.includes("Protection")&&(C=V)}),C){const V=C.getBoundingClientRect();T.value.position={x:Math.round(V.right+8),y:Math.round(V.top+window.scrollY-4)}}}):w||(T.value.position=null)}),(w,I)=>{var C;return F(),U(gt,null,[n.show?(F(),U("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:x},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:I[5]||(I[5]=Dt(()=>{},["stop"]))},[h("div",vM,[h("button",{onClick:x,class:"absolute right-3 top-3 text-white/80 hover:text-white"},"✖️"),I[10]||(I[10]=h("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[h("span",{class:"text-2xl md:text-3xl"},"👤")],-1)),h("h2",yM,le((C=n.player)==null?void 0:C.name),1)]),h("div",_M,[h("div",null,[h("div",bM,[h("div",wM,[h("div",IM,le(r.stats.availability),1),I[11]||(I[11]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibilités",-1))]),h("div",EM,[h("div",TM,le(r.stats.selection),1),I[12]||(I[12]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Sélections",-1))]),h("div",xM,[h("div",AM,le(r.stats.ratio),1),I[13]||(I[13]=h("div",{class:"text-xs md:text-sm text-gray-300"},"% de sélection",-1))])])]),h("div",SM,[h("button",{onClick:P,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},I[14]||(I[14]=[h("span",null,"✏️",-1),h("span",null,"Renommer",-1)])),h("button",{onClick:I[0]||(I[0]=V=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},[h("span",null,le(g.value?"🔓":"🔒"),1),h("span",null,le(g.value?"Déverrouiller":"Verrouiller"),1)]),h("button",{onClick:D,class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},I[15]||(I[15]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)])),h("button",{onClick:x,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")]),f.value?(F(),U("div",PM,[h("button",{onClick:I[1]||(I[1]=V=>{P(),f.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"}," ✏️ Renommer "),h("button",{onClick:I[2]||(I[2]=V=>{D(),f.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"}," 🗑️ Supprimer ")])):he("",!0)]),h("div",RM,[h("button",{onClick:I[3]||(I[3]=V=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},le(g.value?"🔓 Déverrouiller":"🔒 Verrouiller"),1),h("button",{onClick:x,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer "),h("button",{onClick:I[4]||(I[4]=V=>f.value=!f.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ ")])])])):he("",!0),i.value?(F(),U("div",CM,[h("div",kM,[I[17]||(I[17]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Renommer le joueur",-1)),h("div",DM,[I[16]||(I[16]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),rt(h("input",{"onUpdate:modelValue":I[6]||(I[6]=V=>o.value=V),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Nn(S,["esc"]),Nn(j,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[At,o.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:S,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:j,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):he("",!0),at(mM,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:I[7]||(I[7]=V=>l.value=!1),onUpdate:Z,onOnboardingFinished:I[8]||(I[8]=V=>w.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),at(ug,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:I[9]||(I[9]=V=>c.value=!1),onVerified:pe},null,8,["show","player","seasonId"])],64)}}},NM=gM(VM,[["__scopeId","data-v-731bb3fb"]]),OM={class:"relative p-6 pb-4 border-b border-white/10"},MM={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},LM={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(F(),U("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=Dt(()=>{},["stop"]))},[h("div",OM,[h("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=h("div",{class:"flex items-center gap-3"},[h("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),h("div",null,[h("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),h("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=lr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),h("div",MM,[h("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):he("",!0)}},FM={class:"relative text-center p-6 pb-4 border-b border-white/10"},$M={class:"text-2xl md:text-3xl font-bold text-white mb-1"},UM={class:"text-sm md:text-base text-purple-300"},jM={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},BM={class:"mb-3"},qM={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},zM={key:0,class:"flex items-center justify-between gap-2"},GM=["title"],KM={key:0,class:"text-purple-400 mr-2"},HM={key:1,class:"text-green-400 mr-2"},WM={key:2,class:"text-red-400 mr-2"},QM={key:3,class:"text-gray-400 mr-2"},JM=["onClick"],YM={key:1,class:"flex items-center justify-center"},XM=["onChange"],ZM=["value"],eL=["onClick"],tL={key:0,class:"mb-3"},nL={class:"grid grid-cols-3 gap-2 md:gap-3 mb-3"},rL={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},sL={class:"text-cyan-300 text-lg md:text-xl font-semibold"},iL={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},oL={class:"text-green-400 text-lg md:text-xl font-semibold"},aL={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},lL={class:"text-purple-400 text-lg md:text-xl font-semibold"},uL={key:1,class:"mb-3"},cL={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},dL={class:"flex-1"},hL={class:"text-blue-300 text-sm font-medium"},fL={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},pL=["disabled","title"],mL=["disabled"],gL=["disabled"],vL={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-email-notifications","update-selection"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=O(!1),o=O("Copier le message"),a=O(!1),l=O(!1),c=O(""),d=O(!1),f=O(!1),g=Be(()=>{var fe;return((fe=r.event)==null?void 0:fe.playerCount)||6}),y=O([]),x=O(null),P=Be(()=>Array.from({length:g.value},(se,qe)=>{var tt;return((tt=r.currentSelection)==null?void 0:tt[qe])||null})),S=Be(()=>JSON.stringify(y.value)!==JSON.stringify(P.value)),j=Be(()=>(r.players||[]).map(fe=>fe.name).filter(fe=>{var se;return((se=r.playerAvailability)==null?void 0:se[fe])===!0}).sort((fe,se)=>fe.localeCompare(se,"fr",{sensitivity:"base"})));function $(fe){const se=new Set(y.value.filter(Boolean)),qe=y.value[fe];return qe&&se.delete(qe),j.value.filter(tt=>!se.has(tt))}function D(fe){x.value=fe}function G(){x.value=null}function Z(fe,se){var tt;const qe=((tt=fe==null?void 0:fe.target)==null?void 0:tt.value)||"";qe&&(y.value[se]=qe),x.value=null}function pe(fe){y.value[fe]=null}Be(()=>($(-1).length<g.value,""));const T=Be(()=>r.currentSelection&&r.currentSelection.length>0),w=Be(()=>{var tt;if(!T.value)return!1;const fe=r.currentSelection.some(ut=>!Ye(ut)),se=((tt=r.event)==null?void 0:tt.playerCount)||6,qe=r.availableCount<se;return fe||qe});Be(()=>{var qe;if(!w.value)return"";const fe=r.currentSelection.filter(tt=>!Ye(tt)),se=((qe=r.event)==null?void 0:qe.playerCount)||6;return fe.length>0?fe.length===1?`${fe[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${fe.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<se?`Seulement ${r.availableCount} joueurs disponibles pour ${se} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),Be(()=>{if(!r.event||!T.value)return"";const fe=I(r.event.date),se=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${fe} : ${se}`}),Vt(()=>r.show,fe=>{if(fe){i.value=!1,o.value="Copier le message",l.value=!1,c.value="",d.value=!1,a.value=!1;const se=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],qe=g.value;y.value=Array.from({length:qe},(tt,ut)=>se[ut]||null),x.value=null}}),Vt([g,()=>r.currentSelection,()=>{var fe;return(fe=r.event)==null?void 0:fe.id}],()=>{if(!r.show)return;const fe=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],se=g.value,qe=Array.from({length:se},(tt,ut)=>fe[ut]||y.value[ut]||null);y.value=qe.slice(0,se)});function I(fe){var qe;return fe?(typeof fe=="string"?new Date(fe):((qe=fe.toDate)==null?void 0:qe.call(fe))||fe).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function C(){s("selection")}function V(){s("perfect")}function B(){var se;if(!((se=r.event)!=null&&se.id))return;const fe=y.value.filter(Boolean);s("update-selection",{eventId:r.event.id,players:fe})}function R(){s("close")}function Rt(){a.value=!0}function Et(){f.value=!0}function Ye(fe){return r.playerAvailability[fe]===!0}function Me(fe){return r.playerAvailability[fe]===!1}function Le(fe){return r.currentSelection.includes(fe)&&Ye(fe)}function ln(fe=!1,se=!1){if(d.value=fe,fe){const qe=I(r.event.date),tt=r.currentSelection.join(", ");se?c.value=`Sélection mise à jour pour ${r.event.title} du ${qe} : ${tt}`:c.value=`Nouvelle sélection pour ${r.event.title} du ${qe} : ${tt}`}else c.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function en(){l.value=!1}e({showSuccess:ln});function Ct(fe){s("send-email-notifications",fe),a.value=!1}return(fe,se)=>{var qe,tt,ut;return F(),U(gt,null,[n.show?(F(),U("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:R},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:se[1]||(se[1]=Dt(()=>{},["stop"]))},[h("div",FM,[h("button",{onClick:R,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),se[5]||(se[5]=h("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-3xl"},"🎭")],-1)),h("h2",$M,"Sélection pour "+le((qe=n.event)==null?void 0:qe.title),1),h("p",UM,le(I((tt=n.event)==null?void 0:tt.date)),1),h("div",{class:"mt-3"},[h("button",{onClick:Et,class:"inline-flex items-center gap-2 text-sm text-blue-300 hover:text-blue-200"},se[4]||(se[4]=[h("span",null,"❓",-1),Ln(),h("span",null,"Kezako ?",-1)]))])]),h("div",jM,[h("div",BM,[se[8]||(se[8]=h("h3",{class:"text-base md:text-lg font-semibold text-white mb-2"},"Joueurs sélectionnés",-1)),h("div",qM,[(F(!0),U(gt,null,ur(y.value,(k,M)=>(F(),U("div",{key:"sel-slot-"+M,class:hn(["relative p-3 rounded-lg border text-center transition-colors",k?["bg-gradient-to-r",Me(k)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":Ye(k)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[k?(F(),U("div",zM,[h("div",{class:"flex-1 text-white font-medium truncate",title:k},[Le(k)?(F(),U("span",KM,"🎭")):Ye(k)?(F(),U("span",HM,"✅")):Me(k)?(F(),U("span",WM,"❌")):(F(),U("span",QM,"–")),Ln(" "+le(k),1)],8,GM),h("button",{onClick:Q=>pe(M),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer ce joueur"}," × ",8,JM)])):(F(),U("div",YM,[x.value===M?(F(),U("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:Q=>Z(Q,M),onBlur:se[0]||(se[0]=Q=>G())},[se[6]||(se[6]=h("option",{value:""},"— Choisir —",-1)),(F(!0),U(gt,null,ur($(M),Q=>(F(),U("option",{key:Q,value:Q},le(Q),9,ZM))),128))],40,XM)):(F(),U("button",{key:1,onClick:Q=>D(M),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter un joueur"},se[7]||(se[7]=[h("span",{class:"text-lg"},"＋",-1),h("span",{class:"text-sm"},"Ajouter",-1)]),8,eL))]))],2))),128))])]),w.value?(F(),U("div",tL,se[9]||(se[9]=[h("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[h("div",{class:"text-yellow-400"},"⚠️"),h("div",{class:"text-yellow-200 text-sm"},"Sélection incomplète. Vérifie ci-dessous.")],-1)]))):he("",!0),h("div",nL,[h("div",rL,[h("div",sL,le(((ut=n.event)==null?void 0:ut.playerCount)||6),1),se[10]||(se[10]=h("div",{class:"text-xs md:text-sm text-gray-400"},"À sélectionner",-1))]),h("div",iL,[h("div",oL,le(n.availableCount),1),se[11]||(se[11]=h("div",{class:"text-xs md:text-sm text-gray-400"},"Disponibles",-1))]),h("div",aL,[h("div",lL,le(n.selectedCount),1),se[12]||(se[12]=h("div",{class:"text-xs md:text-sm text-gray-400"},"Sélectionnés",-1))])]),l.value?(F(),U("div",uL,[h("div",cL,[se[14]||(se[14]=h("div",{class:"text-blue-400 text-xl"},"✨",-1)),h("div",dL,[h("p",hL,le(c.value),1)]),h("button",{onClick:en,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},se[13]||(se[13]=[h("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):he("",!0)]),h("div",fL,[h("button",{onClick:C,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":T.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},se[15]||(se[15]=[Ln(" ✨ "),h("span",{class:"hidden sm:inline"},"Sélection Auto",-1),h("span",{class:"sm:hidden"},"Auto",-1)]),8,pL),h("button",{onClick:B,disabled:!S.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",title:"Enregistrer cette composition manuelle"},se[16]||(se[16]=[Ln(" 💾 "),h("span",{class:"hidden sm:inline"},"Enregistrer",-1),h("span",{class:"sm:hidden"},"Save",-1)]),8,mL),T.value?(F(),U("button",{key:0,onClick:V,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap"},se[17]||(se[17]=[Ln(" 👍 "),h("span",{class:"hidden sm:inline"},"Parfait",-1)]))):he("",!0),h("button",{onClick:Rt,disabled:!T.value,class:"h-12 px-3 md:px-4 bg-gray-700 text-white rounded-lg flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},se[18]||(se[18]=[Ln(" 📣 "),h("span",{class:"hidden sm:inline"},"Annoncer",-1)]),8,gL)])])])):he("",!0),at(CE,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:se[2]||(se[2]=k=>a.value=!1),onSendEmailNotifications:Ct},null,8,["show","event","season-id","season-slug","players","selected-players"]),at(LM,{show:f.value,onClose:se[3]||(se[3]=k=>f.value=!1)},null,8,["show"])],64)}}},yL={class:"flex items-center justify-center gap-2"},_L=["title"],bL=["title"],wL=["title"],IL=["title"],EL=["title"],h_={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=O(!1),i=Be(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=Be(()=>t.disabled?"Événement archivé — désarchivez pour modifier":t.isSelected?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){t.disabled||r("toggle",t.playerName,t.eventId)}return(l,c)=>(F(),U("div",{class:hn(["flex items-center justify-center transition-all duration-200 min-h-20 p-3 md:p-5",[n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer hover:bg-white/10"]]),onClick:a,onMouseenter:c[0]||(c[0]=d=>s.value=!0),onMouseleave:c[1]||(c[1]=d=>s.value=!1)},[h("div",yL,[i.value&&s.value?(F(),U("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},le(n.chancePercent)+"% ",9,_L)):(F(),U(gt,{key:1},[n.isSelected?(F(),U("span",{key:0,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," 🎭 ",8,bL)):n.isAvailable===!0?(F(),U("span",{key:1,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," ✅ ",8,wL)):n.isAvailable===!1?(F(),U("span",{key:2,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," ❌ ",8,IL)):(F(),U("span",{key:3,class:hn(["text-gray-500 transition-colors duration-200 text-xl",n.disabled?"":"hover:text-white"]),title:o.value}," – ",10,EL))],64))])],34))}},TL={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},xL={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},AL={class:"text-2xl md:text-3xl font-bold text-white mb-3"},SL={class:"text-gray-300 mb-6"},PL={class:"flex flex-col items-stretch justify-center gap-3"},RL=["value"],CL={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=Be(()=>`${s}/season/${t.seasonSlug}`),o=O(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=Be(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=Be(()=>a.value>0),c=O(l.value);Vt(a,S=>{c.value=S>0});const d=Be(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=Be(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function g(){c.value=!1,r("create-event")}function y(){c.value=!1,r("add-player")}function x(){var S;try{(S=navigator.clipboard)==null||S.writeText(i.value)}catch{}r("copy-link")}async function P(){try{if(t.seasonId){const{db:S}=await an(()=>Promise.resolve().then(()=>mi),void 0),{doc:j,updateDoc:$}=await an(()=>import("./index.esm-d2ede4d0.js"),[]);await $(j(S,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(S,j)=>l.value&&c.value?(F(),U("div",TL,[h("div",xL,[j[1]||(j[1]=h("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[h("span",{class:"text-3xl"},"🎬")],-1)),h("h2",AL,le(d.value),1),h("p",SL,le(f.value),1),h("div",PL,[a.value===1?(F(),U("button",{key:0,onClick:g,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(F(),U("button",{key:1,onClick:y,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(F(),U(gt,{key:2},[h("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:j[0]||(j[0]=$=>$.target.select())},null,40,RL),h("div",{class:"flex gap-3 justify-center"},[h("button",{onClick:x,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),h("button",{onClick:P,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):he("",!0)])])])):he("",!0)}},kL={class:"flex justify-center gap-2 mb-4"},DL={class:"space-y-3"},VL={key:0},NL={key:0,class:"text-sm text-gray-400"},OL={key:1,class:"space-y-2"},ML={class:"flex items-center justify-between gap-3"},LL={class:"truncate"},FL={class:"text-white font-semibold"},$L={class:"text-gray-400 text-xs"},UL=["onClick"],jL={key:1,class:"text-sm text-gray-300"},BL={class:"p-3 rounded-lg border border-white/10 bg-white/5 space-y-3"},qL={class:"flex items-center justify-between"},zL={class:"flex items-center gap-2"},GL={class:"flex items-center justify-between"},KL={class:"flex items-center gap-2"},HL={class:"text-right"},WL=["disabled"],QL={key:0,class:"text-xs text-red-300"},JL={key:1,class:"text-xs text-green-300"},YL={key:2,class:"flex flex-col gap-3"},XL={class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},ZL={class:"flex items-center gap-2"},eF=["disabled"],tF={key:0,class:"mt-2 text-xs text-red-300"},nF={key:1,class:"mt-2 text-xs text-green-300"},rF={__name:"AccountMenu",props:{show:{type:Boolean,default:!1},seasonId:{type:String,default:null}},emits:["close","manage-player","change-password","logout-device","delete-account"],setup(n,{emit:e}){const t=n,r=e,s=O(""),i=O([]),o=O("players");function a(T){return["px-4 py-2 rounded-full text-sm transition-colors",o.value===T?"bg-gradient-to-r from-pink-500 to-purple-600 text-white shadow-lg":"bg-white/5 text-gray-300 hover:bg-white/10 border border-white/10"]}function l(T){return`${T.seasonId||"global"}__${T.playerId}`}async function c(){var T;try{s.value=((T=on==null?void 0:on.currentUser)==null?void 0:T.email)||""}catch{}try{const w=s.value?await xE(s.value):[],I=[];for(const C of w){let V=C.playerId;try{if(C.seasonId){const B=Ae(ue,"seasons",C.seasonId,"players",C.playerId),R=await Sn(B);R.exists()&&(V=R.data().name||V)}}catch{}I.push({...C,playerName:V})}i.value=I}catch{i.value=[]}}function d(){r("close")}Vt(()=>t.show,T=>{T&&(c(),Z())}),wr(()=>{t.show&&(c(),Z())});const f=O(""),g=O(!1),y=O(""),x=O(""),P=O(!1);Vt(s,T=>{f.value=T||""}),Vt(f,T=>{P.value=!!T&&T.includes("@")&&T!==s.value});async function S(){if(P.value){g.value=!0,y.value="",x.value="";try{const T=await gE({currentEmail:s.value,newEmail:f.value.trim()});await RE({toEmail:f.value.trim(),verifyUrl:T.url,purpose:"account_email_update",displayName:"utilisateur"}),x.value=`Un email de vérification a été envoyé à ${f.value.trim()}. Cliquez sur le lien pour confirmer le changement.`}catch(T){y.value=(T==null?void 0:T.code)==="auth/requires-recent-login"?"Veuillez vous reconnecter pour modifier votre email":"Impossible de mettre à jour l'email"}finally{g.value=!1}}}const j=O({notifyAvailability:!0,notifySelection:!0}),$=O(!1),D=O(""),G=O("");async function Z(){try{if(!s.value)return;const T=Ae(ue,"userPreferences",s.value),w=await Sn(T);if(w.exists()){const I=w.data()||{};j.value.notifyAvailability=I.notifyAvailability!==!1,j.value.notifySelection=I.notifySelection!==!1}else j.value={notifyAvailability:!0,notifySelection:!0}}catch{}}async function pe(){if(s.value){$.value=!0,D.value="",G.value="";try{const T=Ae(ue,"userPreferences",s.value);await fn(T,{...j.value},{merge:!0}),G.value="Préférences sauvegardées"}catch{D.value="Impossible de sauvegarder vos préférences"}finally{$.value=!1}}}return(T,w)=>n.show?(F(),U("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:d},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:w[9]||(w[9]=Dt(()=>{},["stop"]))},[h("button",{onClick:d,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),w[15]||(w[15]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Mon compte</h2><p class="text-sm text-gray-300">Gérez votre compte et vos préférences</p></div>',1)),h("div",kL,[h("button",{onClick:w[0]||(w[0]=I=>o.value="manage"),class:hn(a("manage"))},"Gérer",2),h("button",{onClick:w[1]||(w[1]=I=>o.value="notifications"),class:hn(a("notifications"))},"Notifications",2),h("button",{onClick:w[2]||(w[2]=I=>o.value="players"),class:hn(a("players"))},"Joueurs",2)]),h("div",DL,[o.value==="players"?(F(),U("div",VL,[w[10]||(w[10]=h("h3",{class:"text-white font-semibold mb-2"},"Mes joueurs associés",-1)),i.value.length===0?(F(),U("div",NL,"Aucun joueur associé pour le moment.")):(F(),U("ul",OL,[(F(!0),U(gt,null,ur(i.value,I=>(F(),U("li",{key:l(I),class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},[h("div",ML,[h("div",LL,[h("div",FL,le(I.seasonName||I.seasonId||"—"),1),h("div",$L,"Joueur : "+le(I.playerName||"—"),1)]),h("button",{onClick:C=>T.$emit("manage-player",I),class:"px-3 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-xs"},"Gérer",8,UL)])]))),128))]))])):o.value==="notifications"?(F(),U("div",jL,[h("div",BL,[h("div",qL,[h("label",zL,[rt(h("input",{type:"checkbox","onUpdate:modelValue":w[3]||(w[3]=I=>j.value.notifyAvailability=I),class:"w-4 h-4"},null,512),[[ba,j.value.notifyAvailability]]),w[11]||(w[11]=h("span",null,"Recevoir les demandes de disponibilités",-1))])]),h("div",GL,[h("label",KL,[rt(h("input",{type:"checkbox","onUpdate:modelValue":w[4]||(w[4]=I=>j.value.notifySelection=I),class:"w-4 h-4"},null,512),[[ba,j.value.notifySelection]]),w[12]||(w[12]=h("span",null,"Recevoir les emails de sélection",-1))])]),h("div",HL,[h("button",{onClick:pe,disabled:$.value,class:"px-4 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-500 disabled:opacity-50"},le($.value?"⏳":"Sauvegarder"),9,WL)]),D.value?(F(),U("div",QL,le(D.value),1)):he("",!0),G.value?(F(),U("div",JL,le(G.value),1)):he("",!0)])])):(F(),U("div",YL,[h("div",XL,[w[13]||(w[13]=h("label",{class:"block text-xs text-gray-400 mb-2"},"Email",-1)),h("div",ZL,[rt(h("input",{"onUpdate:modelValue":w[5]||(w[5]=I=>f.value=I),type:"email",class:"flex-1 p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"nouvel@email.com"},null,512),[[At,f.value]]),h("button",{onClick:S,disabled:!P.value||g.value,class:"px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},le(g.value?"⏳":"Mettre à jour"),9,eF)]),y.value?(F(),U("div",tF,le(y.value),1)):he("",!0),x.value?(F(),U("div",nF,le(x.value),1)):he("",!0)]),w[14]||(w[14]=h("div",{class:"text-sm text-gray-400"},"Vous pouvez changer votre mot de passe pour sécuriser vos opérations sensibles.",-1)),h("button",{onClick:w[6]||(w[6]=I=>T.$emit("change-password")),class:"w-full px-4 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500"},"Changer de mot de passe"),h("button",{onClick:w[7]||(w[7]=I=>T.$emit("logout-device")),class:"w-full px-4 py-3 rounded-lg bg-gray-700 text-white hover:bg-gray-600"},"Déconnexion de cet appareil"),h("button",{onClick:w[8]||(w[8]=I=>T.$emit("delete-account")),class:"w-full px-4 py-3 rounded-lg bg-red-600 text-white hover:bg-red-500"},"Supprimer mon compte")]))]),h("div",{class:"mt-6 text-center"},[h("button",{onClick:d,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):he("",!0)}},sF={class:"space-y-4"},iF={class:"flex items-center justify-between"},oF={class:"flex items-center gap-2 text-gray-300 text-sm"},aF={key:0,class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},lF={key:1,class:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm"},uF={class:"flex justify-center gap-3 mt-2"},cF=["disabled"],dF={key:0,class:"animate-spin"},hF={key:1},fF={__name:"AccountLoginModal",props:{show:{type:Boolean,default:!1}},emits:["close","success"],setup(n,{emit:e}){const t=e,r=O(""),s=O(""),i=O(!1),o=O(""),a=O(""),l=O(!0),c=Be(()=>!!r.value&&r.value.includes("@")&&!!s.value);async function d(){if(c.value){i.value=!0,o.value="",a.value="";try{if(await oE(r.value.trim(),s.value),l.value)try{Pi.saveSession(r.value.trim())}catch{}t("success")}catch{o.value="Email ou mot de passe incorrect"}finally{i.value=!1}}}async function f(){if(!r.value||!r.value.includes("@")){o.value="Saisissez votre email pour recevoir un lien de réinitialisation",setTimeout(()=>{o.value=""},2500);return}i.value=!0,o.value="",a.value="";try{await aE(r.value.trim()),a.value="Email de réinitialisation envoyé"}catch{o.value="Impossible d'envoyer l'email de réinitialisation"}finally{i.value=!1}}return(g,y)=>n.show?(F(),U("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:y[6]||(y[6]=x=>g.$emit("close"))},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:y[5]||(y[5]=Dt(()=>{},["stop"]))},[h("button",{onClick:y[0]||(y[0]=x=>g.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),y[10]||(y[10]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Mon compte</h2><p class="text-sm text-gray-300">Connectez-vous pour gérer votre compte et vos préférences</p></div>',1)),h("div",sF,[at(DE),h("div",null,[y[7]||(y[7]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Email",-1)),rt(h("input",{"onUpdate:modelValue":y[1]||(y[1]=x=>r.value=x),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[At,r.value]])]),h("div",null,[y[8]||(y[8]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),rt(h("input",{"onUpdate:modelValue":y[2]||(y[2]=x=>s.value=x),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe"},null,512),[[At,s.value]])]),h("div",iF,[h("label",oF,[rt(h("input",{type:"checkbox","onUpdate:modelValue":y[3]||(y[3]=x=>l.value=x),class:"w-4 h-4"},null,512),[[ba,l.value]]),y[9]||(y[9]=h("span",null,"Rester connecté sur cet appareil",-1))]),h("button",{onClick:f,class:"text-sm text-blue-400 hover:text-blue-300 underline"},"Mot de passe oublié ?")]),o.value?(F(),U("div",aF,le(o.value),1)):he("",!0),a.value?(F(),U("div",lF,le(a.value),1)):he("",!0),h("div",uF,[h("button",{onClick:y[4]||(y[4]=x=>g.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),h("button",{onClick:d,disabled:!c.value||i.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(F(),U("span",dF,"⏳")):(F(),U("span",hF,"Se connecter"))],8,cF)])])])])):he("",!0)}};const pF={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},mF={ref:"pageHeaderRef",class:"sticky top-0 z-[60] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},gF={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},vF={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},yF={class:"hidden md:flex items-center gap-2"},_F={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},bF={class:"flex items-stretch relative"},wF={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},IF={class:"flex-1 overflow-hidden"},EF=["data-event-id","onClick"],TF=["title"],xF=["title"],AF={key:0,class:"mt-1 text-xs text-gray-400"},SF=["title","onClick"],PF=["title","onClick"],RF=["title","aria-label"],CF={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},kF={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},DF={key:0,class:"pointer-events-none"},VF={class:"flex items-center justify-between"},NF={key:1,class:"pointer-events-none"},OF={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},MF={class:"flex items-center justify-between"},LF={key:2,class:"pointer-events-none"},FF={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},$F={class:"flex items-center justify-between"},UF={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},jF=["data-player-id"],BF={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},qF={class:"px-4 md:px-5 font-bold text-xl md:text-2xl flex items-center w-full min-w-0"},zF={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},GF=["onClick","title"],KF=["data-event-id"],HF={class:"border-t border-white/10"},WF={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},QF={class:"px-4 md:px-5 flex items-center"},JF=["data-event-id"],YF={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},XF={class:"text-center"},ZF={class:"text-white text-lg"},e4={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},t4={class:"text-white/60 text-xs mt-2"},n4={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},r4={class:"flex items-center space-x-2"},s4={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},i4={class:"flex items-center space-x-2"},o4={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},a4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},l4={class:"mb-6"},u4={class:"mb-6"},c4={class:"mb-6"},d4={class:"mb-6 flex items-center gap-3"},h4={class:"mb-6"},f4={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},p4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},m4={class:"mb-6"},g4={class:"flex justify-end space-x-3"},v4={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},y4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},_4={class:"flex justify-end space-x-3"},b4={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},w4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},I4={class:"flex justify-end space-x-3"},E4={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},T4={class:"relative text-center p-6 pb-4 border-b border-white/10"},x4={class:"text-2xl md:text-3xl font-bold text-white mb-1"},A4={class:"text-sm md:text-base text-purple-300"},S4={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},P4={key:0,class:"mb-4 md:mb-6"},R4={class:"text-gray-300 bg-gray-800/50 p-4 rounded-lg border border-gray-600/50"},C4={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},k4={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},D4={class:"text-xl md:text-2xl font-bold text-white"},V4={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},N4={class:"text-xl md:text-2xl font-bold text-white"},O4={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},M4={class:"text-xl md:text-2xl font-bold text-white"},L4={key:1,class:"mb-4 md:mb-6"},F4={class:"bg-gray-800 border border-gray-600 rounded-lg overflow-hidden"},$4={class:"col-span-4 p-3 flex items-center min-w-0"},U4=["title"],j4={key:0,class:"text-yellow-400 ml-2 text-lg",title:"Joueur protégé"},B4={class:"col-span-8 p-0"},q4={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},z4=["disabled","title"],G4=["title"],K4={key:2,class:"md:hidden mt-3 space-y-2"},H4=["disabled","title"],W4={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},Q4={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},J4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},Y4={class:"mb-6"},X4={class:"mb-6"},Z4={class:"mb-6"},e3={class:"mb-6 flex items-center gap-3"},t3={class:"mb-6"},n3={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},r3={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},s3={class:"mb-6"},i3={class:"space-y-4"},o3=["disabled"],a3={key:0,class:"animate-spin"},l3={key:1},u3={class:"mb-6 text-center"},c3={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},d3={class:"text-red-300 text-sm"},h3={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},f3={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},p3={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},m3={class:"space-y-4"},g3={class:"mt-2 text-center"},v3={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},y3={class:"text-red-300 text-sm"},_3={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},b3=["disabled"],w3={key:0,class:"animate-spin"},I3={key:1},E3={class:"mb-6"},T3=["disabled"],x3={key:0,class:"animate-spin"},A3={key:1},S3={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},P3={class:"text-red-300 text-sm"},R3={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},C3={class:"text-green-300 text-sm"},k3={class:"flex justify-center"},D3={class:"mb-6"},V3=["disabled"],N3={key:0,class:"animate-spin"},O3={key:1},M3={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},L3={class:"text-red-300 text-sm"},F3={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},$3={class:"text-green-300 text-sm"},U3={class:"flex justify-center"},j3={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},B3={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},q3={class:"flex gap-3"},f_={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=Vu(),r=ja(),s=e.slug,i=O(""),o=O(""),a=O({}),l=O(!1),c=O(null),d=O(null),f=O(""),g=O(""),y=O(6),x=O(!1),P=O(""),S=O(null),j=O(null),$=O(null),D=O({position:null,side:null}),G=O({position:null}),Z=O({position:null}),pe=O(!1),T=O(null),w=O(!1),I=O(null),C=O(null),V=O(!1),B=O(null),R=O(""),Rt=O(!1),Et=O(null),Ye=O(""),Me=O(""),Le=O(!1),ln=O(null),en=O(!1),Ct=O(null),fe=O(""),se=O(""),qe=O(!1),tt=O(null),ut=O(!1),k=O(!1),M=O(""),Q=O(""),X=O(!1),Pe=O(!1),Ne=O(""),E=O(""),A=O(!1),L=O(null),ee=O(""),J=O(!1),te=O(!1),me=O(!1),ce=O(null),de=O(null),ie=O(null),Ee=O(0);function be(){try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||Ue.value.length===0)return;const _=localStorage.getItem(`playerTourCompleted:${o.value}`),m=localStorage.getItem(`startPlayerTour:${o.value}`);!_&&m&&(Ee.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`),dn(()=>{const N=document.querySelector('button[data-onboarding="add-player"]');if(N){N.scrollIntoView({behavior:"smooth",block:"end"});const Y=N.getBoundingClientRect(),oe=document.getElementById("coachmark-add"),ae=280,Ie=100,je=(oe==null?void 0:oe.offsetWidth)||ae,Ge=(oe==null?void 0:oe.offsetHeight)||Ie,ct=Math.round(Y.right+12);if(ct+je<=window.innerWidth-12){const Tt=Y.top+Y.height/2-Ge/2,Wt=-14,nt=12,kn=window.innerHeight-Ge-12,Dr=Math.max(nt,Math.min(Math.round(Tt+Wt),kn));D.value={position:{x:ct,y:Dr},side:"right"}}else{const Tt=Math.round(Y.left+Y.width/2-je/2),Wt=Math.round(Y.top-Ge-8),nt=8,kn=window.innerWidth-je-8;D.value={position:{x:Math.max(nt,Math.min(Tt,kn)),y:Wt},side:null}}}}))}catch{}}const Te=O(!1),Re=O(null),Ve=O(null),$e=O(!1),Qe=O(null),zt=O(!1),Lt=O(null),gn=O(!1),kt=O(!1),fr=O(!1),Lr=O(!1),tn=O(null);function Pn(){kt.value=!1}function Oi(){try{const _=on==null?void 0:on.currentUser;if(!_||_.isAnonymous){let m=null;pl.value&&(m=We.value.find(N=>N.id===pl.value)||null),m||(m=We.value[0]||null),Lr.value=!0,m&&(tn.value=m);return}}catch{}kt.value=!0}async function il(){var _;try{const m=(_=on==null?void 0:on.currentUser)==null?void 0:_.email;if(!m)return;const{resetPlayerPassword:N}=await an(()=>Promise.resolve().then(()=>mi),void 0);await N(m),Ce.value=!0,st.value="Email de réinitialisation envoyé.",setTimeout(()=>{Ce.value=!1},3e3)}catch{gr.value=!0,ji.value="Impossible d'envoyer l'email de réinitialisation.",setTimeout(()=>{gr.value=!1},3e3)}}async function rc(){try{await JD(on),Pn(),Ce.value=!0,st.value="Déconnecté de cet appareil.",setTimeout(()=>{Ce.value=!1},2500)}catch{gr.value=!0,ji.value="Déconnexion impossible.",setTimeout(()=>{gr.value=!1},3e3)}}async function sc(){alert("Suppression de compte: contactez l'organisateur pour dissocier vos joueurs. Fonction complète à venir.")}async function Mi(_){var m;Pn();try{if(_.seasonId&&_.seasonId!==o.value){const N=Ae(ue,"seasons",_.seasonId),oe=(await pt(He(ue,"seasons"))).docs.find(Ie=>Ie.id===_.seasonId),ae=(m=oe==null?void 0:oe.data())==null?void 0:m.slug;if(ae){t.push(`/season/${ae}?player=${encodeURIComponent(_.playerId)}&open=protection`);return}}else{const N=We.value.find(Y=>Y.id===_.playerId);if(N){H(N);return}t.push(`?player=${encodeURIComponent(_.playerId)}&open=protection`)}}catch{}}wr(()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}});function ol(){dn(()=>{ll()})}const Ar=O(new Set),Jn=O(!0),Sr=O(0),Pr=O("Préparation de la grille"),Rr=O(e.eventId||null),Us=O(!1),Li=O(null);Vt(()=>e.eventId,_=>{if(_)if(Rr.value=_,Ue.value.length>0)fg(_);else{const m=Vt(Ue,N=>{N.length>0&&(fg(_),m())},{immediate:!0})}});const un=Be(()=>We.value.map(_=>({..._,isProtected:Ar.value.has(_.id),email:null}))),ic=Be(()=>Rr.value?Cn.value.findIndex(_=>_.id===Rr.value):-1);Be(()=>{if(!Rr.value||ic.value===-1)return!1;if(window.innerWidth<=768){const _=document.querySelector(`[data-event-id="${Rr.value}"]`);if(_){const m=_.getBoundingClientRect();return m.left>=0&&m.right<=window.innerWidth}}return!0});const Rn=O(null),js=O(!1),oc=O(!1),al=O(0),Bs=O(null),qn=O(null),Vo=O(null);function zn(){const _=Rn.value;if(!_)return;const{scrollLeft:m,scrollWidth:N,clientWidth:Y}=_;js.value=m>2,oc.value=m<N-Y-2}function ll(){var _;try{zn(),al.value=((_=Rn.value)==null?void 0:_.scrollLeft)||0}catch{}}function No(_){const m=Rn.value;if(!m)return;let N=0;const Y=m.querySelector("tbody tr td[data-event-id]");if(Y)N=Y.getBoundingClientRect().width;else if(qn!=null&&qn.value){const ae=qn.value.querySelector(".col-event");ae&&(N=ae.getBoundingClientRect().width)}(!N||!isFinite(N))&&(N=m.clientWidth*.6);const oe=m.scrollLeft+_*N;m.scrollTo({left:oe,behavior:"smooth"})}const Fr=O(null);O(0);const Yn=O(!1),Fi=O(!1),ns=O(0);function Oo(_,m){m&&typeof m.preventDefault=="function"&&m.preventDefault(),pr(),No(_)}function qs(_,m){if(m&&typeof m.preventDefault=="function"&&m.preventDefault(),Yn.value)return;Yn.value=!0,ns.value=_,Fi.value=!1;const N=Rn.value;if(!N)return;let Y=0;const oe=N.querySelector("tbody tr td[data-event-id]");if(oe)Y=oe.getBoundingClientRect().width;else if(qn!=null&&qn.value){const Ge=qn.value.querySelector(".col-event");Ge&&(Y=Ge.getBoundingClientRect().width)}(!Y||!isFinite(Y))&&(Y=N.clientWidth*.6);const ae=Y/6,Ie=120,je=()=>{if(!Yn.value||ns.value===0)return;Fi.value||(Fi.value=!0);const Ge=N.scrollLeft+ns.value*ae;N.scrollTo({left:Ge,behavior:"auto"}),Fr.value=window.setTimeout(je,Ie)};Fr.value=window.setTimeout(je,250)}function pr(_){_&&typeof _.preventDefault=="function"&&_.preventDefault();const m=Yn.value,N=Fi.value;if(Yn.value=!1,Fr.value&&(clearTimeout(Fr.value),Fr.value=null),_&&typeof _.type=="string"&&_.type.startsWith("touch")&&!N){const Y=ns.value||0;Y!==0&&No(Y),ns.value=0;return}ns.value=0,m&&N&&ac()}function ac(){const _=Rn.value;if(!_)return;let m=0;const N=_.querySelector("tbody tr td[data-event-id]");if(N)m=N.getBoundingClientRect().width;else if(qn!=null&&qn.value){const Ie=qn.value.querySelector(".col-event");Ie&&(m=Ie.getBoundingClientRect().width)}if(!m||!isFinite(m)||m<=0)return;const Y=_.scrollLeft,ae=Math.round(Y/m)*m;_.scrollTo({left:ae,behavior:"smooth"})}function Oh(_){S.value=_;const m=document.querySelector(`[data-player-id="${_}"]`);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),Ce.value=!0,st.value="Nouveau joueur ajouté !",setTimeout(()=>{Ce.value=!1},3e3)}function Mo(){if(Ee.value!==1)return;const _=document.querySelector('button[data-onboarding="add-player"]');if(!_)return;const m=_.getBoundingClientRect(),N=document.getElementById("coachmark-add"),Y=280,oe=100,ae=N!=null&&N.offsetWidth&&N.offsetWidth>0?N.offsetWidth:Y,Ie=N!=null&&N.offsetHeight&&N.offsetHeight>0?N.offsetHeight:oe,je=Math.round(m.right+12);if(je+ae<=window.innerWidth-12){const ct=m.top+m.height/2-Ie/2,Tt=ul(ct+-14,Ie);D.value={position:{x:je,y:Tt},side:"right"}}else{const ct=Math.round(m.left+m.width/2-ae/2),bt=ul(m.top-Ie-8,Ie),Tt=8,Wt=window.innerWidth-ae-8;D.value={position:{x:Math.max(Tt,Math.min(ct,Wt)),y:bt},side:null}}}function ul(_,m){const N=pageHeaderRef==null?void 0:pageHeaderRef.value,Y=N?Math.max(0,Math.round(N.getBoundingClientRect().height||0)):0,oe=Math.max(12,Y+8),ae=window.innerHeight-m-12;return Math.max(oe,Math.min(Math.round(_),ae))}const mr=O(!1),rs=O(null),$r=O(null),Lo=O({position:"fixed",top:"0px",right:"0px"});function cl(){try{const _=rs.value;if(!_)return;const m=_.getBoundingClientRect(),N=8,Y=Math.max(N,Math.round(m.bottom+N)),oe=Math.max(N,Math.round(window.innerWidth-m.right));Lo.value={position:"fixed",top:`${Y}px`,right:`${oe}px`,zIndex:400}}catch{}}function lc(){mr.value=!mr.value,mr.value&&dn(()=>cl())}function Fo(){mr.value=!1}function dl(_){if(!mr.value)return;const m=rs.value,N=$r.value,Y=m&&m.contains(_.target),oe=N&&N.contains(_.target);!Y&&!oe&&(mr.value=!1)}function $o(_){_.key==="Escape"&&Fo()}function zs(){mr.value&&cl()}wr(()=>{document.addEventListener("click",dl),document.addEventListener("keydown",$o),window.addEventListener("scroll",zs,{passive:!0}),window.addEventListener("resize",zs)}),oa(()=>{document.removeEventListener("click",dl),document.removeEventListener("keydown",$o),window.removeEventListener("scroll",zs),window.removeEventListener("resize",zs)});function $i(){var _;Ee.value===1&&((_=D.value)!=null&&_.position)&&Mo()}wr(()=>{window.addEventListener("scroll",$i,{passive:!0}),window.addEventListener("resize",$i)}),oa(()=>{window.removeEventListener("scroll",$i),window.removeEventListener("resize",$i)});function Ui(_){return Ar.value.has(_)}async function hl(){if(o.value)try{const _=await vp(o.value),m=new Set;_.forEach(N=>{N.isProtected&&m.add(N.playerId||N.id)}),Ar.value=m}catch{const m=new Set;for(const N of We.value)await vi(N.id,o.value)&&m.add(N.id);Ar.value=m}}const Ce=O(!1),st=O(""),gr=O(!1),ji=O("");function ss(){try{const _=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(_),Ce.value=!0,st.value="Lien copié dans le presse-papiers",setTimeout(()=>{Ce.value=!1},2500)}catch{gr.value=!0,ji.value="Impossible de copier le lien",setTimeout(()=>{gr.value=!1},2500)}}async function vr(_){await ls({type:"deleteEvent",data:{eventId:_}})}async function Uo(_=null){const m=_||c.value;if(console.debug("deleteEventConfirmed"),!m){console.error("Aucun événement à supprimer");return}try{await rN(m,o.value),Ue.value=Ue.value.filter(N=>N.id!==m),await Promise.all([pp(o.value),to(We.value,Ue.value,o.value),no(o.value)]).then(([N,Y,oe])=>{Ue.value=N,Gt.value=Y,lt.value=oe}),l.value=!1,c.value=null,Ce.value=!0,st.value="Événement supprimé avec succès !",setTimeout(()=>{Ce.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function jo(){l.value=!1,c.value=null}async function Bo(){if(!d.value||!f.value.trim()||!g.value)return;const _=parseInt(y.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const m={title:f.value.trim(),date:g.value,description:ee.value.trim()||"",playerCount:_,archived:!!J.value};await a_(d.value,m,o.value),!m.archived&&We.value.length>0&&Ar.value.size>0&&(Lt.value={id:d.value,...m},zt.value=!0),await Promise.all([pp(o.value),to(We.value,Ue.value,o.value),no(o.value)]).then(([N,Y,oe])=>{Ue.value=N,Gt.value=Y,lt.value=oe}),d.value=null,f.value="",g.value="",ee.value="",y.value=6,J.value=!1,Ce.value=!0,st.value="Événement mis à jour avec succès !",setTimeout(()=>{Ce.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function _t(){if(P.value.trim())try{const _=P.value.trim(),m=await fE(_,o.value);await Promise.all([rd(o.value),to(We.value,Ue.value,o.value),no(o.value)]).then(([N,Y,oe])=>{We.value=N,Gt.value=Y,lt.value=oe,hl();const ae=We.value.find(je=>je.id===m);Oh(m),j.value=m,$.value=Cn.value&&Cn.value[0]&&Cn.value[0].id?Cn.value[0].id:null;try{o.value&&localStorage.setItem(`lastAddedPlayerId:${o.value}`,m)}catch{}try{typeof Ee<"u"&&(Ee.value=2)}catch{}const Ie=document.querySelector(`[data-player-id="${m}"]`);Ie&&Ie.scrollIntoView({behavior:"smooth",block:"center"}),dn(()=>{const je=`[data-player-id="${j.value}"] td[data-event-id="${$.value}"]`,Ge=document.querySelector(je);if(Ge){const ct=Ge.getBoundingClientRect();G.value.position={x:Math.round(ct.left),y:Math.round(ct.top+window.scrollY-48)}}}),Ce.value=!0,st.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Ce.value=!1},3e3),setTimeout(()=>{Ce.value=!1,st.value=""},5e3)}),x.value=!1,P.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function Ur(){d.value=null,f.value="",g.value="",ee.value="",y.value=6}O(null);const jr=O(!1),yr=O(""),Gs=O(""),Ks=O(""),Bi=O(6),qo=O(!1);async function Mh(){if(!yr.value.trim()||!Gs.value){alert("Veuillez remplir le titre et la date de l'événement");return}const _=parseInt(Bi.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const m={title:yr.value.trim(),date:Gs.value,description:Ks.value.trim()||"",playerCount:_,archived:!!qo.value};await Lh(m)}async function Lh(_){try{const m=await sN(_,o.value);Ue.value=[...Ue.value,{id:m,..._}];const N={};for(const Y of We.value)N[Y.name]=Gt.value[Y.name]||{},N[Y.name][m]=null,await i_(Y.name,N[Y.name],o.value);yr.value="",Gs.value="",Ks.value="",Bi.value=6,qo.value=!1,jr.value=!1,await Promise.resolve(),Ce.value=!0,st.value="Événement créé avec succès !",!_.archived&&We.value.length>0&&Ar.value.size>0&&(Lt.value={id:m,..._},zt.value=!0),setTimeout(()=>{Ce.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function qi(){yr.value="",Gs.value="",Ks.value="",Bi.value=6,jr.value=!1}async function Cr(){await ls({type:"addEvent",data:{}})}const Ue=O([]),We=O([]),Gt=O({}),lt=O({}),Fh=O({}),fl=O({});Vt([()=>Ue.value.length,()=>We.value.length,Jn],()=>{Jn.value||dn(()=>{ll()})}),Vt([()=>We.value.length,()=>Ue.value.length,o],()=>{be()}),wr(async()=>{hE("firebase"),await ZV();const _=Eu(He(ue,"seasons"),Rd("slug","==",e.slug)),m=await pt(_);if(m.empty){t.push("/");return}else{const ae=m.docs[0];o.value=ae.id;const Ie=ae.data();i.value=Ie.name,a.value=Ie,document.title=`Saison : ${i.value}`}if(o.value){Pr.value="Chargement des événements de la saison",Sr.value=20;const ae=await pt(He(ue,"seasons",o.value,"events"));Ue.value=ae.docs.map(nt=>({id:nt.id,...nt.data(),playerCount:nt.data().playerCount||6})),Pr.value="Chargement des joueurs",Sr.value=45;const Ie=await pt(He(ue,"seasons",o.value,"players"));We.value=Ie.docs.map(nt=>({id:nt.id,...nt.data()})),Pr.value="Chargement des disponibilités",Sr.value=70;const je=await pt(He(ue,"seasons",o.value,"availability")),Ge={};je.docs.forEach(nt=>{const kn=nt.data(),Dr={};Object.keys(kn).forEach(ds=>{const Qs=kn[ds];Dr[ds]=Qs==="oui"?!0:Qs==="non"?!1:Qs}),Ge[nt.id]=Dr}),Gt.value=Ge,Pr.value="Chargement des sélections",Sr.value=85;const ct=await pt(He(ue,"seasons",o.value,"selections")),bt={};ct.docs.forEach(nt=>{bt[nt.id]=nt.data().players||[]}),lt.value=bt;const Tt=await vp(o.value),Wt=new Set;Array.isArray(Tt)&&Tt.forEach(nt=>{nt.isProtected&&Wt.add(nt.playerId||nt.id)}),Ar.value=Wt}const N=ae=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>ae()):setTimeout(ae,0)};Pr.value="Préparation de l'interface",Sr.value=95,N(()=>{yl(),Ki()}),console.debug("players (deduplicated)"),console.debug("availability loaded"),await dn(),Sr.value=100,Jn.value=!1,dn(()=>{zn(),requestAnimationFrame(()=>zn()),setTimeout(()=>zn(),250);const ae=Rn.value;ae&&(ae.addEventListener("scroll",Ie=>{zn(),al.value=ae.scrollLeft||0},{passive:!0}),window.addEventListener("resize",zn),typeof ResizeObserver<"u"&&(Vo.value=new ResizeObserver(()=>{zn()}),Vo.value.observe(ae)))});const Y=r.query.event;if(Y&&Ue.value.length>0){const ae=Ue.value.find(Ie=>Ie.id===Y);ae?(console.debug("Événement trouvé depuis l'URL"),await qh(Y,ae)):(console.warn("Événement non trouvé avec l'ID"),gr.value=!0,ji.value="Événement non trouvé",setTimeout(()=>{gr.value=!1},3e3))}const oe=r.query.player;if(oe&&We.value.length>0){const ae=We.value.find(Ie=>Ie.id===oe);ae&&(H(ae),await dn(),r.query.verified==="1"&&(Ce.value=!0,st.value="Joueur associé à votre compte.",setTimeout(()=>{Ce.value=!1},2500)))}}),Vt(()=>r.params.eventId,_=>{if(_){const m=()=>{const N=Ue.value.find(Y=>Y.id===_);return N?(wl(N),!0):!1};if(Ue.value.length>0)m();else{const N=Vt(Ue,Y=>{Y.length>0&&m()&&N()},{immediate:!0})}}},{immediate:!0});function uc(_){if(!_)return null;if(_ instanceof Date)return _;if(typeof(_==null?void 0:_.toDate)=="function")return _.toDate();if(typeof _=="string"||typeof _=="number"){const m=new Date(_);return isNaN(m.getTime())?null:m}return null}const Xn=Be(()=>{let _=null;try{o.value&&(_=localStorage.getItem(`seasonPreferredPlayer:${o.value}`))}catch{}const m=[...We.value].sort((ae,Ie)=>(ae.name||"").localeCompare(Ie.name||"","fr",{sensitivity:"base"}));if(!_)return m;const N=m.findIndex(ae=>ae.id===_);if(N<=0)return m;const Y=m[N],oe=m.slice(0,N).concat(m.slice(N+1));return[Y,...oe]}),pl=Be(()=>{try{if(o.value)return localStorage.getItem(`seasonPreferredPlayer:${o.value}`)}catch{}return null}),$h=Be(()=>[...Ue.value].sort((_,m)=>{const N=uc(_.date),Y=uc(m.date),oe=N?N.getTime():Number.POSITIVE_INFINITY,ae=Y?Y.getTime():Number.POSITIVE_INFINITY;return oe!==ae?oe-ae:(_.title||"").localeCompare(m.title||"","fr",{sensitivity:"base"})})),kr=O(!1),Cn=Be(()=>{const _=$h.value;return kr.value?_:_.filter(m=>!m.archived)});function cc(){kr.value=!kr.value}async function Br(_,m){const N=We.value.find(ae=>ae.name===_);if(!N){console.error("Joueur non trouvé");return}const Y=Ue.value.find(ae=>ae.id===m);if(!Y){console.error("Événement non trouvé");return}if(Y.archived){Ce.value=!0,st.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Ce.value=!1},3e3);return}if(Ui(N.id)){const ae=mo(N.id),Ie=ie.value===N.id;console.debug("Joueur protégé:",{playerId:N.id,hasCachedPassword:ae,wasRecentlyVerified:Ie,recentlyVerifiedPlayer:ie.value}),ae||Ie?(console.debug("Session active ou joueur récemment vérifié, procéder au toggle"),Ie&&(console.debug("Nettoyage du flag recentlyVerifiedPlayer"),ie.value=null),is(N,m)):(console.debug("Pas de session, affichage de la modal de vérification"),de.value={playerName:_,eventId:m},ce.value=N,me.value=!0);return}is(N,m)}function is(_,m){var oe,ae,Ie;const N=(oe=Gt.value[_.name])==null?void 0:oe[m];console.debug("toggleAvailability");let Y;N===!0?Y=!1:N===!1?Y=void 0:Y=!0,Y===void 0?Gt.value[_.name]&&delete Gt.value[_.name][m]:(Gt.value[_.name]||(Gt.value[_.name]={}),Gt.value[_.name][m]=Y);try{typeof Ee<"u"&&Ee.value===1&&_.id===(j.value||((ae=Xn.value[0])==null?void 0:ae.id))&&m===($.value||((Ie=Cn.value[0])==null?void 0:Ie.id))&&(Ee.value=3,dn(()=>{const Ge=document.querySelector(`[data-player-id="${_.id}"]`);if(Ge){const ct=Ge.querySelector(".player-name");if(ct){const bt=ct.getBoundingClientRect();Z.value.position={x:Math.round(bt.right+8),y:Math.round(bt.top+window.scrollY-4)}}}}),oa(()=>{try{window.removeEventListener("resize",zn)}catch{}try{Vo.value&&Vo.value.disconnect()}catch{}}))}catch{}i_(_.name,Gt.value[_.name],o.value).then(async()=>{await dn(),Ki(),Ce.value=!0,st.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Ce.value=!1},3e3)}).catch(je=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function _r(_,m){var N;return(N=Gt.value[_])==null?void 0:N[m]}function ml(_,m){var oe;const N=lt.value[m]||[],Y=(oe=Gt.value[_])==null?void 0:oe[m];return N.includes(_)&&Y===!0}async function Ft(_,m=6){const N=Ue.value.find(Ie=>Ie.id===_),Y=(N==null?void 0:N.playerCount)||6,oe=lt.value[_]||[];if(oe.length>0&&oe.every(Ie=>_r(Ie,_))){console.debug("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const je=We.value.filter(bt=>_r(bt.name,_)).map(bt=>{const Tt=os(bt.name);return{name:bt.name,weight:1/(1+Tt)}}),Ge=[],ct=[...je];for(;Ge.length<Y&&ct.length>0;){const bt=ct.reduce((nt,kn)=>nt+kn.weight,0);let Tt=Math.random()*bt;const Wt=ct.findIndex(nt=>(Tt-=nt.weight,Tt<=0));Wt>=0&&(Ge.push(ct[Wt].name),ct.splice(Wt,1))}lt.value[_]=Ge}else{const Ie=oe.filter(Ge=>_r(Ge,_)),je=Y-Ie.length;if(je<=0)lt.value[_]=Ie;else{const Ge=new Set(Ie),bt=We.value.filter(nt=>_r(nt.name,_)&&!Ge.has(nt.name)).map(nt=>{const kn=os(nt.name);return{name:nt.name,weight:1/(1+kn)}}),Tt=[],Wt=[...bt];for(;Tt.length<je&&Wt.length>0;){const nt=Wt.reduce((ds,Qs)=>ds+Qs.weight,0);let kn=Math.random()*nt;const Dr=Wt.findIndex(ds=>(kn-=ds.weight,kn<=0));Dr>=0&&(Tt.push(Wt[Dr].name),Wt.splice(Dr,1))}lt.value[_]=[...Ie,...Tt]}}await o_(_,lt.value[_],o.value),yl(),Ki()}async function dc(_,m=6){var Ie,je;console.debug("tirerProtected appelé"),console.debug("etat modal selection avant");const N=Te.value,Y=(Ie=Re.value)==null?void 0:Ie.id,oe=lt.value[_]&&lt.value[_].length>0,ae=oe?[...lt.value[_]]:[];if(await Ft(_,m),console.debug("etat modal selection apres"),N&&!Te.value&&(console.debug("Restauration de la popin de sélection..."),Te.value=!0,Re.value=Ue.value.find(Ge=>Ge.id===Y)),Te.value&&((je=Re.value)==null?void 0:je.id)===_)if(console.debug("Popin de sélection ouverte, mise à jour..."),await dn(),Ve.value&&Ve.value.showSuccess){console.debug("Appel de showSuccess sur la popin de sélection");const Ge=lt.value[_]||[],ct=ae.filter(Tt=>Ge.includes(Tt)),bt=ct.length>0&&ct.length<ae.length;Ve.value.showSuccess(oe,bt)}else console.debug("showSuccess indisponible");else console.debug("Popin de sélection fermée, affichage message global"),Ce.value=!0,Ue.value.find(Ge=>Ge.id===_),lt.value[_],oe?st.value="Sélection mise à jour avec succès !":st.value="Sélection effectuée avec succès !",setTimeout(()=>{Ce.value=!1},3e3)}function gl(_){_===0?D.value.position=null:_===1?G.value.position=null:_===2&&(Z.value.position=null)}function hc(_){var N;return _?(typeof _=="string"?new Date(_):((N=_.toDate)==null?void 0:N.call(_))||_).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function zo(_){var N;return _?(typeof _=="string"?new Date(_):((N=_.toDate)==null?void 0:N.call(_))||_).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function os(_){return Object.values(lt.value).filter(m=>m.includes(_)).length}function Hs(_){const m=Gt.value[_]||{};return Object.values(m).filter(N=>N===!0).length}function zi(_){return _?Object.values(Gt.value).filter(m=>m[_]===!0).length:0}function or(_){return _?(lt.value[_]||[]).length:0}function vl(_){const m=Ue.value.find(Y=>Y.id===_),N=(m==null?void 0:m.playerCount)||6;return or(_)>=N}function Uh(_){const m=Hs(_),N=os(_);return m===0?0:N/m}function Gi(_){Fh.value[_]={availability:Hs(_),selection:os(_),ratio:Uh(_)}}function yl(){We.value.forEach(_=>Gi(_.name))}function Ki(){const _={};Ue.value.forEach(m=>{const N=m.playerCount||6,oe=We.value.filter(Ie=>_r(Ie.name,m.id)===!0).map(Ie=>{const je=os(Ie.name);return{name:Ie.name,weight:1/(1+je)}}),ae=oe.reduce((Ie,je)=>Ie+je.weight,0);oe.forEach(Ie=>{const je=Math.min(1,Ie.weight/ae*N);_[Ie.name]||(_[Ie.name]={}),_[Ie.name][m.id]=Math.round(je*100)})}),fl.value=_}const as=O(null),Hi=O(!1);async function Go(_=null){const m=_||as.value;if(!m){console.error("Aucun joueur à supprimer");return}try{await eN(m,o.value),We.value=We.value.filter(N=>N.id!==m),Hi.value=!1,as.value=null,Ce.value=!0,st.value="Joueur supprimé avec succès !",setTimeout(()=>{Ce.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function jh(){Hi.value=!1,as.value=null}async function fc(_){ye(),await vi(_,o.value)?await _l({type:"deletePlayer",data:{playerId:_}}):await ls({type:"deletePlayer",data:{playerId:_}})}async function Wi(){if(T.value){const _=Ue.value.find(N=>N.id===T.value),m=(_==null?void 0:_.playerCount)||6;await dc(T.value,m),pe.value=!1,T.value=null}}function pc(){pe.value=!1,T.value=null}function mc(){return B.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis",updateSelection:"Mise à jour de sélection - Code PIN requis"}[B.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function ls(_){if(tr.isPinCached(o.value)){const m=tr.getCachedPin(o.value);if(console.debug("PIN en cache trouvé, utilisation automatique"),await Nd(o.value,m)){await br(_);return}else tr.clearSession()}B.value=_,V.value=!0}async function _l(_){const m=_.data.playerId;if(mo(m)){console.debug("Mot de passe du joueur en cache trouvé, utilisation automatique"),await br(_);return}Et.value=_,Rt.value=!0}async function gc(_){try{if(await Nd(o.value,_)){tr.saveSession(o.value,_),V.value=!1;const N=B.value;B.value=null,await br(N)}else R.value="Code PIN incorrect",setTimeout(()=>{R.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),R.value="Erreur lors de la vérification du code PIN"}}function Ko(){V.value=!1,B.value=null,R.value=""}async function bl(_){if(_){Le.value=!0,Ye.value="";try{const m=Et.value.data.playerId,N=await hp(o.value);if(_===N){try{Pi.saveSession(Et.value.data.playerId,_)}catch{}Rt.value=!1;const oe=Et.value;Et.value=null,Me.value="",await br(oe);return}if(await verifyPlayerPassword(m,_,o.value)){Rt.value=!1;const oe=Et.value;Et.value=null,Me.value="",await br(oe)}else Ye.value="Mot de passe incorrect",setTimeout(()=>{Ye.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),Ye.value="Erreur lors de la vérification du mot de passe"}finally{Le.value=!1}}}function vc(){Rt.value=!1,Et.value=null,Ye.value="",Me.value="",Le.value=!1}async function qr(_){if(_){qe.value=!0,fe.value="";try{const m=Ct.value.data.player,N=await hp(o.value);if(_===N){try{Pi.saveSession(Ct.value.data.player.id,_)}catch{}en.value=!1;const oe=Ct.value;Ct.value=null,se.value="",await br(oe);return}if(await verifyPlayerPassword(m.id,_,o.value)){en.value=!1;const oe=Ct.value;Ct.value=null,se.value="",await br(oe)}else fe.value="Mot de passe incorrect",setTimeout(()=>{fe.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),fe.value="Erreur lors de la vérification du mot de passe"}finally{qe.value=!1}}}function yc(){en.value=!1,Ct.value=null,fe.value="",se.value="",qe.value=!1}async function _c(){k.value=!0,M.value="",Q.value="";try{const _=Ct.value.data.player,m=await sendPasswordResetEmail(_.id,o.value);Q.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),M.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{k.value=!1}}async function bc(){Pe.value=!0,Ne.value="",E.value="";try{const _=Et.value.data.playerId,m=await sendPasswordResetEmail(_,o.value);E.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),Ne.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{Pe.value=!1}}function wc(){return tr.isPinCached(o.value)?{timeRemaining:tr.getTimeRemaining(),isExpiringSoon:tr.isExpiringSoon()}:null}async function br(_){var Y;if(!_)return;const{type:m,data:N}=_;try{switch(m){case"deleteEvent":console.debug("executePendingOperation - data.eventId reçu"),c.value=N.eventId,l.value=!0;break;case"addEvent":jr.value=!0;break;case"deletePlayer":as.value=N.playerId,Hi.value=!0;break;case"launchSelection":lt.value[N.eventId]&&lt.value[N.eventId].length>0?(T.value=N.eventId,pe.value=!0,A.value=!1):(await dc(N.eventId,N.count),A.value=!1);break;case"toggleAvailability":is(N.player,N.eventId);break;case"toggleArchive":await setEventArchived(N.eventId,N.archived,o.value);{const oe=Ue.value.findIndex(ae=>ae.id===N.eventId);oe!==-1&&(Ue.value[oe]={...Ue.value[oe],archived:!!N.archived}),J.value=!!N.archived}break;case"updateSelection":{const{eventId:oe,players:ae}=N;await o_(oe,Array.isArray(ae)?ae:[],o.value),lt.value[oe]=Array.isArray(ae)?ae:[];try{(Y=Ve.value)==null||Y.showSuccess(!0,!0)}catch{}}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),Ce.value=!0,st.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Ce.value=!1},3e3)}}function Gn(){t.push("/")}oa(()=>{const _=Rn.value;_&&_.removeEventListener("scroll",zn),window.removeEventListener("resize",zn)});async function wl(_){L.value=_,ee.value=_.description||"",J.value=!!_.archived;try{const[m,N]=await Promise.all([to(We.value,Ue.value,o.value),no(o.value)]);Gt.value=m,lt.value=N}catch(m){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",m)}A.value=!0}function Ho(){A.value=!1,L.value=null,ee.value="",te.value=!1}function us(){Ho(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function u(_,m){console.debug("handleAvailabilityToggle appelé");const N=We.value.find(ae=>ae.name===_);if(!N){console.error("Joueur non trouvé");return}const Y=Ue.value.find(ae=>ae.id===m);if(Y!=null&&Y.archived){Ce.value=!0,st.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Ce.value=!1},3e3);return}console.debug("Joueur trouvé");const oe=Ui(N.id);if(console.debug("Joueur protégé"),oe){mo(N.id)?(console.debug("Session active, procéder au toggle"),await Br(_,m)):(console.debug("Demande du mot de passe pour joueur protégé"),de.value={playerName:_,eventId:m},ce.value=N,me.value=!0);return}console.debug("Joueur non protégé, procéder au toggle"),await Br(_,m)}function p(_,m){return(lt.value[m]||[]).includes(_)}async function v(_){if(console.debug("Mot de passe vérifié"),ce.value&&(ie.value=ce.value.id,console.debug("Joueur marqué comme récemment vérifié")),de.value){const{playerName:m,eventId:N}=de.value;console.debug("Exécution de l'action en attente"),await Br(m,N),de.value=null}else console.debug("Aucune action en attente trouvée");me.value=!1,ce.value=null}function b(){d.value=L.value.id,f.value=L.value.title,g.value=L.value.date,ee.value=L.value.description||"",y.value=L.value.playerCount||6,A.value=!1}async function q(){if(L.value)try{const _=!L.value.archived,m={...L.value,archived:_};await a_(L.value.id,m,o.value),L.value.archived=_;const N=Ue.value.findIndex(Y=>Y.id===L.value.id);N!==-1&&(Ue.value[N].archived=_),Ce.value=!0,st.value=_?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{Ce.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function H(_){I.value=_,w.value=!0;try{typeof Ee<"u"&&Ee.value}catch{}}function ye(){w.value=!1,I.value=null}async function mt({playerId:_,newName:m}){try{await tN(_,m,o.value),await Promise.all([rd(o.value),to(We.value,Ue.value,o.value),no(o.value)]).then(([N,Y,oe])=>{if(We.value=N,Gt.value=Y,lt.value=oe,hl(),I.value&&I.value.id===_){const ae=N.find(Ie=>Ie.id===_);ae&&(I.value=ae)}}),Ce.value=!0,st.value="Joueur mis à jour avec succès !",setTimeout(()=>{Ce.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function cn(){try{await Promise.all([rd(o.value),to(We.value,Ue.value,o.value),no(o.value)]).then(([_,m,N])=>{if(We.value=_,Gt.value=m,lt.value=N,hl(),I.value){const Y=_.find(oe=>oe.id===I.value.id);Y&&(I.value=Y)}}),Ce.value=!0,st.value="Données mises à jour !",setTimeout(()=>{Ce.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function it(_){if(!_)return{availability:0,selection:0,ratio:0};const m=Hs(_.name),N=os(_.name),Y=m===0?0:Math.round(N/m*100);return{availability:m,selection:N,ratio:Y}}function nn(_){const m=lt.value[_]||[],N=Ue.value.find(ae=>ae.id===_),Y=(N==null?void 0:N.playerCount)||6,oe=zi(_);if(m.length>0){const ae=m.some(je=>!_r(je,_)),Ie=oe<Y;if(ae||Ie)return{type:"incomplete",hasUnavailablePlayers:ae,hasInsufficientPlayers:Ie,unavailablePlayers:m.filter(je=>!_r(je,_)),availableCount:oe,requiredCount:Y}}return oe<Y?{type:"insufficient",availableCount:oe,requiredCount:Y}:m.length===0?{type:"ready",availableCount:oe,requiredCount:Y}:{type:"complete",availableCount:oe,requiredCount:Y}}function vn(_){const m=nn(_);return m.type==="incomplete"||m.type==="insufficient"}function cs(_){const m=nn(_);switch(m.type){case"incomplete":return m.hasUnavailablePlayers?m.unavailablePlayers.length===1?`Sélection incomplète : ${m.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${m.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${m.availableCount} joueurs disponibles pour ${m.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${m.availableCount} disponibles pour ${m.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${m.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${m.availableCount} joueurs disponibles`;default:return""}}async function ar({eventId:_,eventData:m,reason:N}){if(!o.value)return;const Y={id:_,...m};if(Y.archived){console.debug("Événement archivé, aucune notification envoyée"),Ce.value=!0,st.value="Aucune notification envoyée : événement archivé",setTimeout(()=>{Ce.value=!1},3e3);return}const oe=[];for(const ae of We.value){if(!await vi(ae.id,o.value))continue;const je=await TE(ae.id,o.value);if(je)try{const Ge=await mp({seasonId:o.value,playerId:ae.id,eventId:Y.id,action:"yes"}),ct=await mp({seasonId:o.value,playerId:ae.id,eventId:Y.id,action:"no"}),bt=`${Ge.url}&slug=${encodeURIComponent(s)}`,Tt=`${ct.url}&slug=${encodeURIComponent(s)}`;await UN({toEmail:je,playerName:ae.name,eventTitle:Y.title,eventDate:zo(Y.date),yesUrl:bt,noUrl:Tt,reason:N})}catch{console.error("Email non envoyé pour un joueur"),oe.push(ae.id)}}Ce.value=!0,st.value=oe.length>0?`Emails envoyés (avec ${oe.length} échec(s))`:"Emails envoyés aux joueurs protégés.",setTimeout(()=>{Ce.value=!1},3e3)}function Ws(_){if(_!=null&&_.archived){Ce.value=!0,st.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{Ce.value=!1},3e3);return}cg(),Qe.value=_,$e.value=!0}function Wo(){$e.value=!1,Qe.value=null}function cg(){zt.value=!1,Lt.value=null}async function dg({eventId:_,eventData:m,reason:N,selectedPlayers:Y}){try{N==="selection"?(await qN({eventId:_,eventData:m,selectedPlayers:Y,seasonId:o.value,seasonSlug:s,players:un.value}),Bh(),Ce.value=!0,st.value="Notifications de sélection envoyées avec succès !",setTimeout(()=>{Ce.value=!1},3e3)):(await ar({eventId:_,eventData:m,reason:N}),Wo(),Ce.value=!0,st.value="Notifications envoyées avec succès !",setTimeout(()=>{Ce.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),Ce.value=!0,st.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Ce.value=!1},3e3)}}function hg(_){if(!_)return{};const m={};return We.value.forEach(N=>{m[N.name]=_r(N.name,_)}),m}function Ic(_){if(_!=null&&_.archived){Ce.value=!0,st.value="Impossible d'ouvrir la sélection sur un événement archivé",setTimeout(()=>{Ce.value=!1},3e3);return}Re.value=_,Te.value=!0}function Bh(){Te.value=!1,Re.value=null}async function VE(){if(!Re.value)return;const _=Re.value.id,m=Re.value.playerCount||6;if(zi(_)===0){Ce.value=!0,st.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Ce.value=!1},3e3);return}await ls({type:"launchSelection",data:{eventId:_,count:m}})}function NE(){Bh(),Ce.value=!0,st.value="Sélection validée !",setTimeout(()=>{Ce.value=!1},3e3)}async function OE(_){if(!_||!_.eventId)return;const{eventId:m,players:N}=_;await ls({type:"updateSelection",data:{eventId:m,players:N}})}async function qh(_,m){if(!_||!m)return;pg(),Rr.value=_,Us.value=!0,await dn();const N=document.querySelector(`[data-event-id="${_}"]`);if(!N){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(Ie=>{Ie.classList.remove("focused-event-highlight")});const Y=document.querySelectorAll(`[data-event-id="${_}"]`);Y.forEach(Ie=>{Ie.classList.add("focused-event-highlight")});const oe=Y[0],ae=Y[Y.length-1];oe&&oe.classList.add("focused-event-column-start"),ae&&ae.classList.add("focused-event-column-end"),await ME(N),Ce.value=!0,st.value=`Événement ciblé : ${m.title}`,setTimeout(()=>{Ce.value=!1},4e3),Li.value=setTimeout(()=>{pg()},8e3)}function fg(_){if(!_)return;const m=Ue.value.find(N=>N.id===_);if(!m){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const N=Ue.value.find(Y=>Y.id===_);N?qh(_,N):console.error("Événement toujours introuvable après retry")},500);return}qh(_,m)}async function ME(_){if(!_)return;if(await new Promise(N=>setTimeout(N,100)),window.innerWidth<=768){const N=Rn.value;if(N){const Y=_.offsetLeft,oe=_.offsetWidth,ae=N.clientWidth,Ie=Y-ae/2+oe/2,je=N.scrollWidth-ae,Ge=Math.max(0,Math.min(Ie,je));N.scrollTo({left:Ge,behavior:"smooth"}),setTimeout(()=>{const ct=_.getBoundingClientRect();if(ct.left<0||ct.right>window.innerWidth){const bt=Y-20;N.scrollTo({left:Math.max(0,bt),behavior:"smooth"})}},500)}}else _.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const m=Rn.value;m&&setTimeout(()=>{const N=document.querySelector(`[data-event-id="${Rr.value}"]`);if(N&&N.closest("tbody")){const Y=N.offsetLeft,oe=N.offsetWidth,ae=m.clientWidth,Ie=Y-ae/2+oe/2,je=m.scrollWidth-ae,Ge=Math.max(0,Math.min(Ie,je));m.scrollTo({left:Ge,behavior:"smooth"})}},300)}function pg(){Li.value&&(clearTimeout(Li.value),Li.value=null),Rr.value=null,Us.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(_=>{_.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(_=>{_.classList.remove("focused-event-column-start","focused-event-column-end")})}return(_,m)=>{var N,Y,oe,ae,Ie,je,Ge,ct,bt,Tt,Wt,nt,kn,Dr,ds,Qs,mg,gg,vg;return F(),U(gt,null,[h("div",pF,[h("div",mF,[h("button",{onClick:Gn,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour à l'accueil"},m[69]||(m[69]=[h("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),h("h1",gF,le(i.value?i.value:"Chargement..."),1),h("div",vF,[h("div",yF,[h("button",{onClick:Oi,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte"},m[70]||(m[70]=[h("span",{class:"text-2xl"},"👤",-1)])),h("button",{onClick:m[0]||(m[0]=W=>gn.value=!0),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},m[71]||(m[71]=[h("span",{class:"text-2xl"},"❓",-1)]))]),h("div",{class:"relative md:hidden",ref_key:"headerMenuRef",ref:rs},[h("button",{onClick:m[1]||(m[1]=Dt(W=>{lc(),cl()},["stop"])),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Menu","aria-label":"Menu"},m[72]||(m[72]=[h("span",{class:"text-2xl"},"⋯",-1)]))],512),(F(),au(RT,{to:"body"},[mr.value?(F(),U("div",{key:0,ref_key:"headerMenuDropdownRef",ref:$r,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:ms(Lo.value)},[h("button",{onClick:m[2]||(m[2]=W=>{Oi(),Fo()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[73]||(m[73]=[h("span",null,"👤",-1),h("span",{class:"text-sm"},"Mon compte",-1)])),h("button",{onClick:m[3]||(m[3]=W=>{gn.value=!0,Fo()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[74]||(m[74]=[h("span",null,"❓",-1),h("span",{class:"text-sm"},"Kezako ?",-1)]))],4)):he("",!0)]))])],512),h("div",_F,[h("div",{ref_key:"headerBarRef",ref:Bs,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[h("div",bF,[Ue.value.length===0&&We.value.length===0?he("",!0):(F(),U("div",wF,[h("div",{class:"flex items-center justify-center h-full gap-2"},[h("button",{onClick:Cr,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},m[75]||(m[75]=[h("span",{class:"text-lg"},"➕",-1),h("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),h("span",{class:"sm:hidden"},"Événement",-1)]))])])),h("div",IF,[h("div",{ref_key:"headerEventsRef",ref:qn,class:"flex relative z-[60]",style:ms({transform:`translateX(-${al.value}px)`})},[(F(!0),U(gt,null,ur(Cn.value,W=>(F(),U("div",{key:"h-"+W.id,"data-event-id":W.id,class:hn(["col-event flex-shrink-0 p-3 text-center cursor-pointer",{"archived-header":W.archived}]),onClick:Dn=>wl(W)},[h("div",{class:"header-date text-[16px] md:text-base text-gray-300",title:zo(W.date)},le(hc(W.date)),9,TF),h("div",{class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2",title:W.title},le(W.title||"Sans titre"),9,xF),W.archived?(F(),U("div",AF,"(Archivé)")):he("",!0),vn(W.id)?(F(),U("div",{key:1,class:"mt-1 w-4 h-4 bg-yellow-500 rounded-full mx-auto flex items-center justify-center hover:bg-yellow-400 transition-colors duration-200",title:cs(W.id)+" - Cliquez pour ouvrir la sélection",onClick:Dt(Dn=>Ic(W),["stop"])},m[76]||(m[76]=[h("span",{class:"text-xs text-white font-bold"},"⚠️",-1)]),8,SF)):nn(W.id).type==="ready"?(F(),U("div",{key:2,class:"mt-1 w-4 h-4 bg-green-500 rounded-full mx-auto flex items-center justify-center hover:bg-green-400 transition-colors duration-200",title:cs(W.id)+" - Cliquez pour ouvrir la sélection",onClick:Dt(Dn=>Ic(W),["stop"])},m[77]||(m[77]=[h("span",{class:"text-xs text-white font-bold"},"🎲",-1)]),8,PF)):he("",!0)],10,EF))),128))],4)]),m[80]||(m[80]=h("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),h("button",{onClick:cc,class:"absolute right-2 top-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[86] backdrop-blur-sm",title:kr.value?"Masquer les événements archivés":"Afficher les événements archivés","aria-label":kr.value?"Masquer les événements archivés":"Afficher les événements archivés"},[(F(),U("svg",CF,[m[78]||(m[78]=h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),m[79]||(m[79]=h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),kr.value?he("",!0):(F(),U("path",kF))]))],8,RF),rt(h("button",{onClick:m[4]||(m[4]=Dt(W=>Oo(-1,W),["prevent"])),onMousedown:m[5]||(m[5]=Dt(W=>qs(-1,W),["prevent"])),onMouseup:m[6]||(m[6]=W=>pr(W)),onMouseleave:m[7]||(m[7]=W=>pr(W)),onTouchstart:m[8]||(m[8]=Dt(W=>qs(-1,W),["prevent"])),onTouchend:m[9]||(m[9]=W=>pr(W)),onTouchcancel:m[10]||(m[10]=W=>pr(W)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[Xh,js.value]]),rt(h("button",{onClick:m[11]||(m[11]=Dt(W=>Oo(1,W),["prevent"])),onMousedown:m[12]||(m[12]=Dt(W=>qs(1,W),["prevent"])),onMouseup:m[13]||(m[13]=W=>pr(W)),onMouseleave:m[14]||(m[14]=W=>pr(W)),onTouchstart:m[15]||(m[15]=Dt(W=>qs(1,W),["prevent"])),onTouchend:m[16]||(m[16]=W=>pr(W)),onTouchcancel:m[17]||(m[17]=W=>pr(W)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[Xh,oc.value]])])],512),rt(h("div",{ref_key:"gridboardRef",ref:Rn,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[Ee.value===1?(F(),U("div",DF,[D.value.position?(F(),U("div",{key:0,class:"fixed z-[400]",style:ms({left:D.value.position.x+"px",top:D.value.position.y+"px"})},[h("div",{id:"coachmark-add",class:hn(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":D.value.side==="right","coachmark-left":D.value.side==="left"}])},[m[82]||(m[82]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),m[83]||(m[83]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),h("div",VF,[m[81]||(m[81]=h("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),h("button",{onClick:m[18]||(m[18]=W=>gl(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):he("",!0)])):he("",!0),Ee.value===2&&j.value&&$.value?(F(),U("div",NF,[G.value.position?(F(),U("div",{key:0,class:"fixed z-[400]",style:ms({position:"absolute",left:G.value.position.x+"px",top:G.value.position.y+"px"})},[h("div",OF,[m[85]||(m[85]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),m[86]||(m[86]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),h("div",MF,[m[84]||(m[84]=h("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),h("button",{onClick:m[19]||(m[19]=W=>gl(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):he("",!0)])):he("",!0),Ee.value===3&&j.value?(F(),U("div",LF,[Z.value.position?(F(),U("div",{key:0,class:"fixed z-[400]",style:ms({position:"absolute",left:Z.value.position.x+"px",top:Z.value.position.y+"px"})},[h("div",FF,[m[88]||(m[88]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),m[89]||(m[89]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),h("div",$F,[m[87]||(m[87]=h("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),h("button",{onClick:m[20]||(m[20]=W=>gl(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):he("",!0)])):he("",!0),h("table",UF,[h("colgroup",null,[m[90]||(m[90]=h("col",{class:"col-left"},null,-1)),(F(!0),U(gt,null,ur(Cn.value,(W,Dn)=>(F(),U("col",{key:"c"+Dn,class:"col-event"}))),128)),m[91]||(m[91]=h("col",{class:"col-right"},null,-1))]),m[95]||(m[95]=h("thead",{class:"hidden"},null,-1)),h("tbody",null,[(F(!0),U(gt,null,ur(Xn.value,W=>{var Dn;return F(),U("tr",{key:W.id,class:hn(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":W.id===S.value,"preferred-player":W.id===pl.value}]),"data-player-id":W.id},[h("td",BF,[h("div",qF,[Ui(W.id)?(F(),U("span",zF," 🔒 ")):he("",!0),h("span",{onClick:Zn=>H(W),class:hn(["player-name hover:border-b-2 hover:border-dashed hover:border-purple-400 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight block truncate max-w-full flex-1 min-w-0",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":Ee.value===3&&W.id===(j.value||((Dn=Xn.value[0])==null?void 0:Dn.id))}]),title:"Cliquez pour voir les détails : "+W.name},le(W.name),11,GF)])]),(F(!0),U(gt,null,ur(Cn.value,Zn=>{var yg,_g,bg;return F(),U("td",{key:Zn.id,"data-event-id":Zn.id,class:hn(["p-0",Zn.archived?"archived-col":"",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":Ee.value===2&&W.id===(j.value||((yg=Xn.value[0])==null?void 0:yg.id))&&Zn.id===($.value||((_g=Cn.value[0])==null?void 0:_g.id))}])},[at(h_,{"player-name":W.name,"event-id":Zn.id,"is-available":_r(W.name,Zn.id),"is-selected":ml(W.name,Zn.id),"chance-percent":((bg=fl.value[W.name])==null?void 0:bg[Zn.id])??null,"show-selected-chance":vl(Zn.id),disabled:Zn.archived===!0,onToggle:Br},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])],10,KF)}),128)),m[92]||(m[92]=h("td",{class:"p-3 md:p-4"},null,-1))],10,jF)}),128)),h("tr",HF,[h("td",WF,[h("div",QF,[h("button",{onClick:m[21]||(m[21]=W=>x.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},m[93]||(m[93]=[h("span",{class:"text-lg"},"➕",-1),h("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),h("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(F(!0),U(gt,null,ur(Cn.value,W=>(F(),U("td",{key:"add-row-"+W.id,"data-event-id":W.id,class:hn(["p-3 md:p-5",W.archived?"archived-col":""])},null,10,JF))),128)),m[94]||(m[94]=h("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[Xh,!Jn.value]])])]),Jn.value?(F(),U("div",YF,[h("div",XF,[m[96]||(m[96]=h("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[h("span",{class:"text-3xl"},"🎭")],-1)),h("p",ZF,le(Pr.value)+"…",1),h("div",e4,[h("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:ms({width:Sr.value+"%"})},null,4)]),h("p",t4,le(Sr.value)+"%",1)])])):he("",!0),Jn.value?he("",!0):(F(),au(CL,{key:1,"season-id":o.value,"season-slug":Is(s),"players-count":We.value.length,"events-count":Ue.value.length,"onboarding-done":((N=a.value)==null?void 0:N.onboardingCreatorDone)===!0,onCreateEvent:Cr,onAddPlayer:m[22]||(m[22]=()=>{x.value=!0}),onCopyLink:ss,onDismissed:ol},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),he("",!0),Ce.value?(F(),U("div",n4,[h("div",r4,[m[97]||(m[97]=h("span",{class:"text-xl"},"✨",-1)),h("span",null,le(st.value),1)])])):he("",!0),gr.value?(F(),U("div",s4,[h("div",i4,[m[98]||(m[98]=h("span",{class:"text-xl"},"⚠️",-1)),h("span",null,le(ji.value),1)])])):he("",!0),jr.value?(F(),U("div",o4,[h("div",a4,[m[104]||(m[104]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),h("div",l4,[m[99]||(m[99]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),rt(h("input",{"onUpdate:modelValue":m[23]||(m[23]=W=>yr.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[At,yr.value]])]),h("div",u4,[m[100]||(m[100]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),rt(h("input",{"onUpdate:modelValue":m[24]||(m[24]=W=>Gs.value=W),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[At,Gs.value]])]),h("div",c4,[m[101]||(m[101]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),rt(h("textarea",{"onUpdate:modelValue":m[25]||(m[25]=W=>Ks.value=W),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[At,Ks.value]])]),h("div",d4,[rt(h("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":m[26]||(m[26]=W=>qo.value=W),class:"w-4 h-4"},null,512),[[ba,qo.value]]),m[102]||(m[102]=h("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),h("div",h4,[m[103]||(m[103]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),rt(h("input",{"onUpdate:modelValue":m[27]||(m[27]=W=>Bi.value=W),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[At,Bi.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:qi,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:Mh,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):he("",!0),x.value?(F(),U("div",f4,[h("div",p4,[m[106]||(m[106]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),h("div",m4,[m[105]||(m[105]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),rt(h("input",{"onUpdate:modelValue":m[28]||(m[28]=W=>P.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[At,P.value]])]),h("div",g4,[h("button",{onClick:m[29]||(m[29]=W=>x.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:_t,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):he("",!0),l.value?(F(),U("div",v4,[h("div",y4,[m[107]||(m[107]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),h("div",_4,[h("button",{onClick:jo,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:m[30]||(m[30]=()=>Uo()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):he("",!0),Hi.value?(F(),U("div",b4,[h("div",w4,[m[108]||(m[108]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),h("div",I4,[h("button",{onClick:jh,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{onClick:m[31]||(m[31]=()=>Go()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):he("",!0),pe.value?(F(),U("div",E4,[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},[m[109]||(m[109]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🎭</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.</p></div><p class="mb-6 text-sm text-yellow-400 bg-yellow-900/20 p-3 rounded-lg border border-yellow-500/20"> ⚠️ Pensez à prévenir les gens du changement ! </p>',2)),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:pc,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{onClick:Wi,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):he("",!0),A.value?(F(),U("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:Ho},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:m[41]||(m[41]=Dt(()=>{},["stop"]))},[h("div",T4,[h("button",{onClick:Ho,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),m[110]||(m[110]=h("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[h("span",{class:"text-2xl md:text-3xl"},"🎭")],-1)),h("h2",x4,le((Y=L.value)==null?void 0:Y.title),1),h("p",A4,le(zo((oe=L.value)==null?void 0:oe.date)),1)]),h("div",S4,[(ae=L.value)!=null&&ae.description?(F(),U("div",P4,[h("p",R4,le(L.value.description),1)])):he("",!0),h("div",C4,[h("div",k4,[h("div",D4,le(zi((Ie=L.value)==null?void 0:Ie.id)),1),m[111]||(m[111]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),h("div",V4,[h("div",N4,le(or((je=L.value)==null?void 0:je.id)),1),m[112]||(m[112]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),h("div",O4,[h("div",M4,le(((Ge=L.value)==null?void 0:Ge.playerCount)||6),1),m[113]||(m[113]=h("div",{class:"text-xs md:text-sm text-gray-300"},"À sélectionner",-1))])]),L.value?(F(),U("div",L4,[m[115]||(m[115]=h("h3",{class:"text-lg font-semibold text-white mb-3"},"Disponibilités des joueurs",-1)),h("div",F4,[m[114]||(m[114]=h("div",{class:"grid grid-cols-12 gap-0 bg-gray-700 border-b border-gray-600"},[h("div",{class:"col-span-4 p-3 font-medium text-gray-300"},"Joueur"),h("div",{class:"col-span-8 p-3 font-medium text-gray-300 text-center"},"Disponibilité")],-1)),(F(!0),U(gt,null,ur(Xn.value,W=>{var Dn,Zn;return F(),U("div",{key:W.id,class:"grid grid-cols-12 gap-0 border-b border-gray-600 last:border-b-0 hover:bg-gray-700/50 transition-colors"},[h("div",$4,[h("span",{class:"font-medium text-white block truncate max-w-full flex-1 min-w-0",title:W.name},le(W.name),9,U4),Ui(W.id)?(F(),U("span",j4,"🔒")):he("",!0)]),h("div",B4,[at(h_,{"player-name":W.name,"event-id":L.value.id,"is-available":hg(L.value.id)[W.name],"is-selected":p(W.name,L.value.id),"chance-percent":((Dn=fl.value[W.name])==null?void 0:Dn[L.value.id])??null,"show-selected-chance":vl(L.value.id),disabled:((Zn=L.value)==null?void 0:Zn.archived)===!0,onToggle:u},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])])])}),128))])])):he("",!0),h("div",q4,[h("button",{onClick:b,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},m[116]||(m[116]=[h("span",null,"✏️",-1),h("span",null,"Modifier",-1)])),h("button",{onClick:m[32]||(m[32]=W=>Ws(L.value)),disabled:(ct=L.value)==null?void 0:ct.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(bt=L.value)!=null&&bt.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[117]||(m[117]=[h("span",null,"📢",-1),h("span",null,"Annoncer",-1)]),8,z4),h("button",{onClick:q,class:"px-5 py-3 bg-gradient-to-r from-indigo-500 to-blue-600 text-white rounded-lg hover:from-indigo-600 hover:to-blue-700 transition-all duration-300 flex items-center gap-2",title:(Tt=L.value)!=null&&Tt.archived?"Désarchiver cet événement":"Archiver cet événement"},[h("span",null,le((Wt=L.value)!=null&&Wt.archived?"📂":"📁"),1),h("span",null,le((nt=L.value)!=null&&nt.archived?"Désarchiver":"Archiver"),1)],8,G4),h("button",{onClick:m[33]||(m[33]=W=>Ic(L.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},m[118]||(m[118]=[h("span",null,"🎭",-1),h("span",null,"Sélectionner",-1)])),h("button",{onClick:m[34]||(m[34]=W=>{var Dn;return vr((Dn=L.value)==null?void 0:Dn.id)}),class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},m[119]||(m[119]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)])),h("button",{onClick:us,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")]),te.value?(F(),U("div",K4,[h("button",{onClick:m[35]||(m[35]=W=>{b(),te.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"},"✏️ Modifier"),h("button",{onClick:m[36]||(m[36]=W=>{Ws(L.value),te.value=!1}),disabled:(kn=L.value)==null?void 0:kn.archived,class:"w-full px-4 py-3 rounded-lg bg-amber-600/20 text-amber-200 border border-amber-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(Dr=L.value)!=null&&Dr.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[120]||(m[120]=[h("span",null,"📢",-1),h("span",null,"Annoncer",-1)]),8,H4),h("button",{onClick:m[37]||(m[37]=W=>{q(),te.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-indigo-600/20 text-indigo-200 border border-indigo-500/30"},le((ds=L.value)!=null&&ds.archived?"📂 Désarchiver":"📁 Archiver"),1),h("button",{onClick:m[38]||(m[38]=W=>{var Dn;vr((Dn=L.value)==null?void 0:Dn.id),te.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"},"🗑️ Supprimer")])):he("",!0)]),h("div",W4,[h("button",{onClick:m[39]||(m[39]=W=>Ic(L.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),h("button",{onClick:us,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),h("button",{onClick:m[40]||(m[40]=W=>te.value=!te.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):he("",!0),at(ug,{show:me.value,player:ce.value,seasonId:o.value,onClose:m[42]||(m[42]=W=>me.value=!1),onVerified:v},null,8,["show","player","seasonId"]),d.value?(F(),U("div",Q4,[h("div",J4,[m[126]||(m[126]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),h("div",Y4,[m[121]||(m[121]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),rt(h("input",{"onUpdate:modelValue":m[43]||(m[43]=W=>f.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Nn(Ur,["esc"]),Nn(Bo,["enter"])],ref:"editTitleInput"},null,544),[[At,f.value]])]),h("div",X4,[m[122]||(m[122]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),rt(h("input",{"onUpdate:modelValue":m[44]||(m[44]=W=>g.value=W),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[Nn(Ur,["esc"]),Nn(Bo,["enter"])]},null,544),[[At,g.value]])]),h("div",Z4,[m[123]||(m[123]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),rt(h("textarea",{"onUpdate:modelValue":m[45]||(m[45]=W=>ee.value=W),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:Nn(Ur,["esc"])},null,544),[[At,ee.value]])]),h("div",e3,[rt(h("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":m[46]||(m[46]=W=>J.value=W),class:"w-4 h-4"},null,512),[[ba,J.value]]),m[124]||(m[124]=h("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),h("div",t3,[m[125]||(m[125]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),rt(h("input",{"onUpdate:modelValue":m[47]||(m[47]=W=>y.value=W),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:Nn(Ur,["esc"])},null,544),[[At,y.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:Ur,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:Bo,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):he("",!0),at(lE,{show:V.value,message:mc(),error:R.value,"session-info":wc(),onSubmit:gc,onCancel:Ko},null,8,["show","message","error","session-info"]),Rt.value?(F(),U("div",n3,[h("div",r3,[m[128]||(m[128]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),h("div",s3,[h("div",i3,[h("div",null,[m[127]||(m[127]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),rt(h("input",{"onUpdate:modelValue":m[48]||(m[48]=W=>Me.value=W),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[49]||(m[49]=Nn(W=>bl(Me.value),["enter"])),ref_key:"playerPasswordInputRef",ref:ln},null,544),[[At,Me.value]])])]),h("button",{onClick:m[50]||(m[50]=W=>bl(Me.value)),disabled:!Me.value||Le.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Le.value?(F(),U("span",a3,"⏳")):(F(),U("span",l3,"🔓")),h("span",null,le(Le.value?"Vérification...":"Vérifier et supprimer"),1)],8,o3)]),h("div",u3,[h("button",{onClick:m[51]||(m[51]=W=>X.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),Ye.value?(F(),U("div",c3,[h("div",d3,le(Ye.value),1)])):he("",!0),h("div",{class:"flex justify-center"},[h("button",{onClick:vc,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):he("",!0),en.value?(F(),U("div",h3,[h("div",f3,[m[131]||(m[131]=lr('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),h("div",p3,[h("div",m3,[h("div",null,[m[129]||(m[129]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),rt(h("input",{"onUpdate:modelValue":m[52]||(m[52]=W=>se.value=W),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[53]||(m[53]=Nn(W=>qr(se.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:tt},null,544),[[At,se.value]])])]),h("div",g3,[h("button",{onClick:m[54]||(m[54]=W=>ut.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),fe.value?(F(),U("div",v3,[h("div",y3,le(fe.value),1)])):he("",!0)]),h("div",_3,[h("button",{onClick:yc,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),h("button",{onClick:m[55]||(m[55]=W=>qr(se.value)),disabled:!se.value||qe.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[qe.value?(F(),U("span",w3,"⏳")):(F(),U("span",I3,"🔓")),h("span",null,[Ln(le(qe.value?"Vérification...":"Vérifier"),1),m[130]||(m[130]=h("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,b3)])])])):he("",!0),ut.value?(F(),U("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[58]||(m[58]=W=>ut.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[57]||(m[57]=Dt(()=>{},["stop"]))},[m[133]||(m[133]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),h("div",E3,[m[132]||(m[132]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:_c,disabled:k.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[k.value?(F(),U("span",x3,"⏳")):(F(),U("span",A3,"📧")),h("span",null,le(k.value?"Envoi...":"Envoyer l'email"),1)],8,T3)]),M.value?(F(),U("div",S3,[h("div",P3,le(M.value),1)])):he("",!0),Q.value?(F(),U("div",R3,[h("div",C3,le(Q.value),1)])):he("",!0),h("div",k3,[h("button",{onClick:m[56]||(m[56]=W=>ut.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):he("",!0),X.value?(F(),U("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[61]||(m[61]=W=>X.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[60]||(m[60]=Dt(()=>{},["stop"]))},[m[135]||(m[135]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),h("div",D3,[m[134]||(m[134]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:bc,disabled:Pe.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Pe.value?(F(),U("span",N3,"⏳")):(F(),U("span",O3,"📧")),h("span",null,le(Pe.value?"Envoi...":"Envoyer l'email"),1)],8,V3)]),Ne.value?(F(),U("div",M3,[h("div",L3,le(Ne.value),1)])):he("",!0),E.value?(F(),U("div",F3,[h("div",$3,le(E.value),1)])):he("",!0),h("div",U3,[h("button",{onClick:m[59]||(m[59]=W=>X.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):he("",!0),at(NM,{ref_key:"playerModalRef",ref:C,show:w.value,player:I.value,stats:it(I.value),seasonId:o.value,"onboarding-step":Ee.value,"onboarding-player-id":j.value,onClose:ye,onUpdate:mt,onDelete:fc,onRefresh:cn,onAdvanceOnboarding:m[62]||(m[62]=W=>{try{typeof Ee.value<"u"&&(Ee.value.value=W)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id"]),at(vL,{ref_key:"selectionModalRef",ref:Ve,show:Te.value,event:Re.value,"current-selection":lt.value[(Qs=Re.value)==null?void 0:Qs.id]||[],"available-count":zi((mg=Re.value)==null?void 0:mg.id),"selected-count":or((gg=Re.value)==null?void 0:gg.id),"player-availability":hg((vg=Re.value)==null?void 0:vg.id),"season-id":o.value,"season-slug":Is(s),players:un.value,onClose:Bh,onSelection:VE,onPerfect:NE,onSendEmailNotifications:dg,onUpdateSelection:OE},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),at(CE,{show:$e.value,event:Qe.value,"season-id":o.value,"season-slug":Is(s),players:un.value,onClose:Wo,onSendEmailNotifications:dg},null,8,["show","event","season-id","season-slug","players"]),at(uE,{show:gn.value,onClose:m[63]||(m[63]=W=>gn.value=!1)},null,8,["show"]),at(rF,{show:kt.value,"season-id":o.value,onClose:Pn,onManagePlayer:Mi,onChangePassword:il,onLogoutDevice:rc,onDeleteAccount:sc},null,8,["show","season-id"]),at(kE,{show:fr.value,player:tn.value,"season-id":o.value,onClose:m[64]||(m[64]=W=>fr.value=!1),onSuccess:m[65]||(m[65]=()=>{fr.value=!1,kt.value=!0})},null,8,["show","player","season-id"]),at(fF,{show:Lr.value,onClose:m[66]||(m[66]=W=>Lr.value=!1),onSuccess:m[67]||(m[67]=()=>{Lr.value=!1,kt.value=!0})},null,8,["show"]),zt.value?(F(),U("div",j3,[h("div",B3,[m[136]||(m[136]=h("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),m[137]||(m[137]=h("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),h("div",q3,[h("button",{onClick:m[68]||(m[68]=W=>Ws(Lt.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),h("button",{onClick:cg,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):he("",!0)],64)}}},z3={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},G3={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},K3={key:0,class:"text-center py-8"},H3={key:1,class:"text-center py-8"},W3={class:"text-gray-300 mb-6"},Q3={key:2,class:"space-y-6"},J3={class:"text-center"},Y3={class:"text-gray-300"},X3={class:"font-semibold text-white"},Z3={class:"space-y-4"},e$=["disabled"],t$={key:0,class:"animate-spin"},n$={key:1},r$={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},s$={class:"text-red-300 text-sm"},i$={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},o$={class:"text-green-300 text-sm"},a$={__name:"PasswordReset",setup(n){const e=ja(),t=Vu(),r=O(!0),s=O(""),i=O(""),o=O(""),a=O(""),l=O(""),c=O(!1),d=O(""),f=O(""),g=Be(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);wr(async()=>{try{const{oobCode:P}=e.query;if(ve.debug("Token reçu (masqué)"),!P){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=P,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(P){ve.error("Erreur lors de la vérification du lien",P),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function y(){if(g.value){c.value=!0,d.value="",f.value="";try{ve.debug("Début réinitialisation avec token (masqué)"),await VD(on,o.value,a.value),ve.info("Mot de passe Firebase Auth mis à jour"),ve.info("Réinitialisation terminée avec Firebase Auth"),f.value="Mot de passe réinitialisé avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{x()},3e3)}catch(P){ve.error("Erreur lors de la réinitialisation",P),P.code==="auth/weak-password"?d.value="Le mot de passe doit contenir au moins 6 caractères":P.code==="auth/invalid-action-code"?d.value="Lien de réinitialisation invalide ou expiré":d.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}function x(){t.push("/")}return(P,S)=>(F(),U("div",z3,[h("div",G3,[S[8]||(S[8]=lr('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(F(),U("div",K3,S[2]||(S[2]=[h("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),h("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(F(),U("div",H3,[S[3]||(S[3]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"❌")],-1)),S[4]||(S[4]=h("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),h("p",W3,le(s.value),1),h("button",{onClick:x,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):i.value?(F(),U("div",Q3,[h("div",J3,[h("p",Y3,[S[5]||(S[5]=Ln("Email : ")),h("span",X3,le(i.value),1)])]),h("div",Z3,[h("div",null,[S[6]||(S[6]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),rt(h("input",{"onUpdate:modelValue":S[0]||(S[0]=j=>a.value=j),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:Nn(y,["enter"])},null,544),[[At,a.value]])]),h("div",null,[S[7]||(S[7]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),rt(h("input",{"onUpdate:modelValue":S[1]||(S[1]=j=>l.value=j),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:Nn(y,["enter"])},null,544),[[At,l.value]])])]),h("button",{onClick:y,disabled:!g.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(F(),U("span",t$,"⏳")):(F(),U("span",n$,"🔑")),h("span",null,le(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,e$),d.value?(F(),U("div",r$,[h("div",s$,le(d.value),1)])):he("",!0),f.value?(F(),U("div",i$,[h("div",o$,le(f.value),1)])):he("",!0)])):he("",!0)])]))}},l$={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},u$={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},c$={class:"text-3xl"},d$={class:"text-2xl font-bold text-white mb-2"},h$={class:"text-gray-300 mb-6"},f$={__name:"MagicLink",setup(n){const e=ja(),t=Vu(),r=O("loading"),s=O("Traitement en cours..."),i=O("Merci de patienter pendant la validation du lien."),o=Be(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/")}return wr(async()=>{try{hE("firebase");const l=String(e.query.sid||""),c=String(e.query.pid||"");let d=String(e.query.eid||"");const f=String(e.query.t||""),g=String(e.query.a||""),y=String(e.query.slug||"");if(!f||!g){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(g==="account_email_update"){const D=await vE({token:f});if(!D.valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}try{await $D(on.currentUser,D.data.newEmail),await yE({token:f}),r.value="ok",s.value="Email mis à jour",i.value="Votre adresse email a été mise à jour avec succès."}catch{r.value="error",s.value="Action impossible",i.value="Veuillez vous reconnecter puis réessayer."}return}if(g==="verify_email"&&(d="protection"),!(await mE({seasonId:l,playerId:c,eventId:d,token:f,action:g})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(g==="verify_email"){await wE({playerId:c,seasonId:l});try{await SE({playerId:c,seasonId:l})}catch{}await gp({seasonId:l,playerId:c,eventId:"protection",action:g}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(y?()=>t.push(`/season/${y}?player=${encodeURIComponent(c)}&verified=1`):()=>t.push("/"),800);return}const P=Ae(ue,"seasons",l,"players",c),S=await Sn(P),j=S.exists()&&S.data().name||"";if(!j){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}await nN({seasonId:l,playerName:j,eventId:d,value:g==="yes"}),await gp({seasonId:l,playerId:c,eventId:d,action:g}),r.value="ok",s.value="Merci !",i.value=g==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible.",setTimeout(y?()=>t.push(`/season/${y}/event/${d}`):()=>t.push("/"),1200)}catch(l){ve.error("Magic link error",l),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(F(),U("div",l$,[h("div",u$,[h("div",{class:hn(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[h("span",c$,le(o.value),1)],2),h("h1",d$,le(s.value),1),h("p",h$,le(i.value),1),h("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},p$={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},m$={class:"text-center py-12 px-4"},g$={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},v$={class:"container mx-auto px-4 pb-16"},y$={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},_$={class:"space-y-5"},b$=["onKeydown"],w$={class:"flex items-center justify-end gap-3 pt-2"},I$=["disabled"],E$={key:0,class:"mt-6 text-sm text-gray-200"},T$={__name:"JoinSeason",setup(n){const e=ja(),t=Vu(),r=e.params.slug,s=O(""),i=O(""),o=O(""),a=O(!1),l=O("");wr(async()=>{const f=Eu(He(ue,"seasons"),Rd("slug","==",r)),g=await pt(f);if(g.empty)l.value="Saison introuvable";else{const y=g.docs[0];s.value=y.id,i.value=y.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function d(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await fE(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){ve.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,g)=>(F(),U("div",p$,[h("div",m$,[h("h1",g$,le(i.value||"Rejoindre la saison"),1),g[1]||(g[1]=h("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),h("div",v$,[h("div",y$,[g[3]||(g[3]=h("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),h("div",_$,[h("div",null,[g[2]||(g[2]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),rt(h("input",{"onUpdate:modelValue":g[0]||(g[0]=y=>o.value=y),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:Nn(Dt(d,["prevent"]),["enter"])},null,40,b$),[[At,o.value]])]),h("div",w$,[h("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{disabled:!o.value.trim()||a.value,onClick:d,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,I$)])]),l.value?(F(),U("div",E$,le(l.value),1)):he("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const x$=[{path:"/",component:DN},{path:"/season/:slug",component:f_,props:!0},{path:"/season/:slug/event/:eventId",component:f_,props:!0},{path:"/season/:slug/join",component:T$,props:!0},{path:"/reset-password",component:a$},{path:"/magic",component:f$}],A$=lS({history:LA("/"),routes:x$});rA(oA).use(A$).mount("#app");export{He as $,dI as A,xo as B,Xr as C,Xt as D,k6 as E,So as F,Sm as G,C6 as H,k$ as I,Tr as J,YC as K,ZC as L,Ih as M,r6 as N,s6 as O,Ek as P,An as Q,W$ as R,M$ as S,Bt as T,I6 as U,fh as V,wk as W,w6 as X,n6 as Y,$$ as Z,tb as _,bu as a,ec as a$,N$ as a0,XC as a1,ck as a2,R6 as a3,Ua as a4,b6 as a5,B$ as a6,P6 as a7,Ae as a8,K$ as a9,G$ as aA,c6 as aB,d6 as aC,H$ as aD,lk as aE,g6 as aF,v6 as aG,_k as aH,Eu as aI,Yw as aJ,O$ as aK,_6 as aL,Ju as aM,fn as aN,x6 as aO,S$ as aP,i6 as aQ,X$ as aR,Y$ as aS,t6 as aT,q$ as aU,el as aV,T6 as aW,U$ as aX,Rd as aY,Fm as aZ,L6 as a_,tk as aa,F$ as ab,j$ as ac,S6 as ad,e6 as ae,Z$ as af,qt as ag,Qu as ah,hk as ai,h6 as aj,Sn as ak,o6 as al,a6 as am,pt as an,l6 as ao,u6 as ap,ek as aq,A6 as ar,E6 as as,L$ as at,Q$ as au,J$ as av,z$ as aw,f6 as ax,m6 as ay,p6 as az,nk as b,PD as b$,Zu as b0,$6 as b1,Su as b2,ko as b3,oi as b4,V6 as b5,li as b6,ai as b7,ks as b8,ed as b9,Mk as bA,oU as bB,_U as bC,zy as bD,m2 as bE,rD as bF,eU as bG,H6 as bH,RD as bI,cU as bJ,mU as bK,yU as bL,aU as bM,QD as bN,HD as bO,j6 as bP,xk as bQ,CD as bR,dU as bS,pU as bT,vU as bU,$k as bV,sU as bW,J6 as bX,DD as bY,K6 as bZ,KD as b_,M6 as ba,po as bb,ya as bc,yV as bd,N6 as be,lU as bf,cp as bg,O6 as bh,_V as bi,ig as bj,ui as bk,z6 as bl,WD as bm,GI as bn,vV as bo,HI as bp,ND as bq,VD as br,iD as bs,OD as bt,F6 as bu,iU as bv,Q6 as bw,Z6 as bx,AV as by,U6 as bz,Fa as c,Wm as c0,q6 as c1,MD as c2,W6 as c3,uU as c4,fU as c5,gU as c6,JD as c7,B6 as c8,rU as c9,$D as ca,UD as cb,hU as cc,X6 as cd,nU as ce,tU as cf,Y6 as cg,G6 as ch,Po as d,It as e,re as f,Za as g,Hu as h,Yc as i,bh as j,Wu as k,yh as l,Mm as m,$a as n,_h as o,lo as p,Ik as q,Kt as r,vo as s,we as t,R$ as u,zP as v,Ut as w,D6 as x,Je as y,P$ as z};
